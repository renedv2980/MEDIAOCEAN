*          DATA SET NTXROUTS   AT LEVEL 164 AS OF 03/02/21                      
*CATALP NTXROUTS                                                                
         TITLE 'EXTRACT ROUTINES FOR NET EXTRACT'                               
         PRINT NOGEN                                                            
NTXROUTS CSECT                                                                  
         ENTRY NTTMDC            MEDIA                                          
         ENTRY NTTCNC            CLIENT                                         
         ENTRY NTTPDC            PRODUCT                                        
         ENTRY NTTPLC            CLIENT PRODUCT LIST                            
         ENTRY NTTESC            ESTIMATE                                       
         ENTRY NTTSTC            STATION                                        
         ENTRY NTTPGM            PROGRAM                                        
         ENTRY NTTDPT            DAYPART                                        
         ENTRY NTTEDC            ESTIMATE DEMO LIST                             
         ENTRY NTTPAK            PACKAGE                                        
         ENTRY NTTUNI            UNIT                                           
         ENTRY NTTGOL            NET GOAL                                       
         ENTRY NTTPDG            PRODUCT GROUP RECORDS                          
         ENTRY NTTUAD            UNIT ACTUAL DEMOS                              
         ENTRY NTTECT            EARNED COST                                    
         ENTRY NTTSGR            STATION GROUP                                  
         ENTRY NTTCGR            CLIENT GROUP                                   
         ENTRY NTTGXL            NET GOAL                                       
         ENTRY NTTREP            REP                                            
         ENTRY NTTFLT            FLIGHT                                         
         ENTRY NTTUCM            UCOM                                           
         ENTRY NTTCML            COMMERCIAL                                     
         ENTRY NTTMKT            MARKET                                         
         ENTRY NTTBFM            BFORM                                          
         ENTRY NTTUNV            UNIVERSE                                       
         ENTRY NTTPAT            PATTERN                                        
                                                                                
EQXIT    CR    RB,RB                                                            
         J     EXIT                                                             
NEQXIT   LTR   RB,RB                                                            
EXIT     XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* EXTRACT MEDIA INFORMATION                                                     
***********************************************************************         
NTTMDC   NMOD1 WORKL,*NTTMED*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         L     RA,NTTMDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTTMDD,R2           R2=A(EXTRACT RECORD)                         
         USING AGYHDR,R3           R3=A(AGENCY RECORD)                          
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTMDLEN,NTTMDLEN                                                
         MVC   NTTMDLEN(2),=AL2(NTTMDDL)                                        
         MVC   NTTMDTYP,NTMDQ                                                   
                                                                                
         MVI   NTTMDAGY-1,MXTRTQ                                                
         MVI   NTTMDMED-1,MXTRTQ                                                
         MVI   NTTMDAGN-1,MXTRTQ                                                
         MVI   NTTMDMDN-1,MXTRTQ                                                
         MVI   NTTMDDX,MXTRTQ                                                   
         MVI   NTTMDDX+1,MXTRTQ                                                 
                                                                                
         MVC   NTTMDAGY,SXDTAGY    ALPHA AGENCY                                 
                                                                                
         LR    R6,R3                                                            
         USING AGYEL,R6                                                         
         MVI   ELCODE,X'01'        AGENCY ELEMENT                               
         BRAS  RE,GETEL                                                         
         BNE   *+10                                                             
         MVC   NTTMDAGN,AGYNAME    AGENCY NAME                                  
         DROP  R6                                                               
                                                                                
         SR    R9,R9               LOOP COUNTER                                 
         ZIC   R7,1(R8)            ELEMENT COUNTER                              
                                                                                
         LR    R6,R3               A(RECORD)                                    
         USING AGYMEDEL,R6                                                      
         MVI   ELCODE,X'02'        MEDIA ELEMENT                                
         BRAS  RE,GETEL                                                         
NTTM05   JNE   NEQXIT                                                           
         AHI   R9,1                                                             
         CR    R9,R7                                                            
         BNH   NTTM10                                                           
         MVC   NTTMDMDN,AGYMEDEX   MEDIA NAME                                   
         MVC   NTTMDMED,AGYMEDCD   MEDIA 1-LETTER CODE                          
         STC   R9,1(R8)            SAVE ELEMENT COUNT                           
         B     NTTMX                                                            
         DROP  R6                                                               
                                                                                
NTTM10   BRAS  RE,NEXTEL                                                        
         B     NTTM05                                                           
                                                                                
NTTMX    TR    NTTMDAGY,MXTRT                                                   
         TR    NTTMDMED,MXTRT                                                   
         TR    NTTMDAGN,MXTRT                                                   
         TR    NTTMDMDN,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTMDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT CLIENT RECORD                                                         
***********************************************************************         
NTTCNC   NMOD1 WORKL,*NTTCNC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         MVC   VOFFICER,4(R8)      A(OFFICER)                                   
                                                                                
         L     RA,NTTCNLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTTCND,R2           R2=A(EXTRACT RECORD)                         
         USING CLTHDR,R3           R3=A(CLIENT RECORD)                          
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTCNLEN,NTTCNLEN                                                
         MVC   NTTCNLEN(2),=AL2(NTTCNDL)                                        
         MVC   NTTCNTYP,NTCNQ                                                   
         MVC   NTTCNAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,CKEYAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTCNMED,BYTE       MEDIA                                        
                                                                                
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,CKEYCLT),NTTCNCNT    CLIENT                   
                                                                                
         MVC   NTTCNOFF,COFFICE    OFFICE                                       
         CLC   =C'M2',SXDTAGY      MEDIACOM?                                    
         BNE   *+8                                                              
         MVI   NTTCNOFF,C' '                                                    
                                                                                
         MVC   NTTCNNME,CNAME      CLIEN NAME                                   
         MVC   NTTCNPU1,CPU1       PRODUCT USER 1                               
         MVC   NTTCNPU2,CPU2       PRODUCT USER 2                               
         MVC   NTTCNEU1,CEU1       ESTIMATE USER 1                              
         MVC   NTTCNEU2,CEU2       ESTIMATE USER 2                              
         MVC   NTTCNINT,CCLTIFC    CLIENT INTERFACE CODE                        
         MVC   NTTCNRAT,CPROF+14   CLIENT RATE CNTRL                            
                                                                                
         MVI   NTTCNEQU,C'N'       EQUIVILIZATION                               
         TM    COPT3,COP3T                                                      
         BZ    *+12                                                             
         MVI   NTTCNEQU,C'Y'       TIME                                         
         B     NTTCN05                                                          
                                                                                
         TM    COPT3,COP3TI                                                     
         BZ    *+8                                                              
         MVI   NTTCNEQU,C'B'       TIME & INTEGRATION                           
                                                                                
NTTCN05  XC    WORK,WORK                                                        
         LA    R6,WORK                                                          
         USING OFFICED,R6                                                       
         MVI   OFCSYS,C'S'                                                      
         MVC   OFCAGY,SXDTAGY                                                   
         MVC   OFCOFC,COFFICE                                                   
                                                                                
         GOTO1 VOFFICER,DMCB,(C'2',OFFICED),(0,COMFACS)                         
                                                                                
         MVC   NTTCNOF2(1),COFFICE                                              
         MVC   NTTCNOF2,OFCOFC2                                                 
         MVC   NTTCNAOF,CACCOFC    ACC OFFICE CODE                              
         MVC   NTTCNAAO,CACCAGY    ACC AGENCY OVERRIDE                          
         MVC   NTTCNBAG,CBUYAGIN   BUYING AGENCY                                
         DROP  R6                                                               
                                                                                
         MVI   NTTCNAGY-1,MXTRTQ                                                
         MVI   NTTCNMED-1,MXTRTQ                                                
         MVI   NTTCNCNT-1,MXTRTQ                                                
         MVI   NTTCNNME-1,MXTRTQ                                                
         MVI   NTTCNOFF-1,MXTRTQ                                                
         MVI   NTTCNPU1-1,MXTRTQ                                                
         MVI   NTTCNPU2-1,MXTRTQ                                                
         MVI   NTTCNEU1-1,MXTRTQ                                                
         MVI   NTTCNEU2-1,MXTRTQ                                                
         MVI   NTTCNINT-1,MXTRTQ                                                
         MVI   NTTCNEQU-1,MXTRTQ                                                
         MVI   NTTCNOF2-1,MXTRTQ                                                
         MVI   NTTCNRAT-1,MXTRTQ                                                
         MVI   NTTCNAOF-1,MXTRTQ                                                
         MVI   NTTCNAAO-1,MXTRTQ                                                
         MVI   NTTCNBAG-1,MXTRTQ                                                
         MVI   NTTCNDX,MXTRTQ                                                   
         MVI   NTTCNDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTCNAGY,MXTRT                                                   
         TR    NTTCNMED,MXTRT                                                   
         TR    NTTCNCNT,MXTRT                                                   
         TR    NTTCNNME,MXTRT                                                   
         TR    NTTCNOFF,MXTRT                                                   
         TR    NTTCNPU1,MXTRT                                                   
         TR    NTTCNPU2,MXTRT                                                   
         TR    NTTCNEU1,MXTRT                                                   
         TR    NTTCNEU2,MXTRT                                                   
         TR    NTTCNINT,MXTRT                                                   
         TR    NTTCNEQU,MXTRT                                                   
         TR    NTTCNOF2,MXTRT                                                   
         TR    NTTCNRAT,MXTRT                                                   
         TR    NTTCNAOF,MXTRT                                                   
         TR    NTTCNAAO,MXTRT                                                   
         TR    NTTCNBAG,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTCNLIT DC    A(LITERAL)                                                       
         DROP  R2,R3,R4                                                         
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT CLIENT PRODUCT LIST                                                   
***********************************************************************         
NTTPLC   NMOD1 WORKL,*NTTPLC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTPLLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         L     R8,16(R1)                                                        
         USING NTTPLD,R2           R2=A(EXTRACT RECORD)                         
         USING PRDHDR,R3           R3=A(PRODUCT RECORD)                         
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTPLLEN,NTTPLLEN                                                
         MVC   NTTPLLEN(2),=AL2(NTTPLDL)                                        
         MVC   NTTPLTYP,NTPLQ                                                   
         MVC   NTTPLAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,PKEYAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTPLMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,PKEYAM       AGY/MEDIA                                    
         MVC   CKEYCLT,PKEYCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,PKEYCLT),NTTPLCNT     CLIENT                  
         DROP  R5                                                               
                                                                                
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
         MVC   SPTKEY,0(R3)        RESTORE PRODUCT KEY                          
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
                                                                                
         MVC   NTTPLPRD,PKEYPRD    PRODUCT                                      
                                                                                
         MVC   BYTE,PCODE+1                                                     
         EDIT  BYTE,NTTPLNUM,ZERO=NOBLANK,FILL=0   PRODUCT NUMBER               
                                                                                
         MVI   NTTPLAGY-1,MXTRTQ                                                
         MVI   NTTPLMED-1,MXTRTQ                                                
         MVI   NTTPLCNT-1,MXTRTQ                                                
         MVI   NTTPLPRD-1,MXTRTQ                                                
         MVI   NTTPLNUM-1,MXTRTQ                                                
         MVI   NTTPLDX,MXTRTQ                                                   
         MVI   NTTPLDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTPLAGY,MXTRT                                                   
         TR    NTTPLMED,MXTRT                                                   
         TR    NTTPLCNT,MXTRT                                                   
         TR    NTTPLPRD,MXTRT                                                   
         TR    NTTPLNUM,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTPLLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT PRODUCT RECORD                                                        
***********************************************************************         
NTTPDC   NMOD1 WORKL,*NTTPDC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTPDLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTTPDD,R2           R2=A(EXTRACT RECORD)                         
         USING PRDHDR,R3           R3=A(PRODUCT RECORD)                         
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTPDLEN,NTTPDLEN                                                
         MVC   NTTPDLEN(2),=AL2(NTTPDDL)                                        
         MVC   NTTPDTYP,NTPDQ                                                   
         MVC   NTTPDAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,PKEYAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTPDMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,PKEYAM       AGY/MEDIA                                    
         MVC   CKEYCLT,PKEYCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,PKEYCLT),NTTPDCNT       CLIENT                
         DROP  R5                                                               
                                                                                
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY(13),0(R3)    RESTORE PRODUCT KEY                          
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
                                                                                
         MVC   NTTPDPRD,PKEYPRD    PRODUCT                                      
         MVC   NTTPDNME,PNAME      NAME                                         
                                                                                
         MVI   NTTPDBBG,C'Y'       BILL BASE GROSS                              
         TM    PBILLBAS,X'F0'      BILL BASE GROSS??                            
         BZ    *+8                                                              
         MVI   NTTPDBBG,C'N'                                                    
                                                                                
         MVI   NTTPDCBG,C'Y'       COMM BASE GROSS                              
         TM    PBILLBAS,X'0F'      COMM BASE GROSS??                            
         BZ    *+8                                                              
         MVI   NTTPDCBG,C'N'                                                    
                                                                                
         MVC   NTTPDUV1,PUSER1     USER1 VALUE                                  
         MVC   NTTPDUV2,PUSER2     USER2 VALUE                                  
         MVC   NTTPDTAX,PGSTCODE   TAX CODE                                     
         MVC   NTTPDINT,PACCT      PRODUCT INTERFACE                            
                                                                                
         MVC   NTTPDBTN,PADDR1     BILL TO NAME                                 
         MVC   NTTPDAD1,PADDR2     ADDRESS LINE                                 
         MVC   NTTPDAD2,PADDR3     ADDRESS LINE                                 
         MVC   NTTPDAD3,PADDR4     ADDRESS LINE                                 
                                                                                
         OC    PBILLCOM,PBILLCOM   ANY COMM PCT?                                
         JZ    NPDC10                                                           
         ICM   R5,15,PBILLCOM      ANY COMM PCT?                                
         LPR   RF,R5                                                            
         C     RF,=F'1000000'        IF COM BASIS IS 100% MOVE 100              
         JNE   NPDC02                TO SCREEN                                  
         MVC   NTTPDCP+1(3),=C'100'                                             
         J     NPDC04                                                           
*                                                                               
*                                    OTHERWISE ...                              
*                                    EDIT COM.% INTO SCREEN FIELD               
NPDC02   EDIT  (R5),(8,NTTPDCP),4,FLOAT=+,ALIGN=LEFT                            
                                                                                
NPDC04   LTR   R5,R5                                                            
         BNM   *+8                   COM.% NEGATIVE, MINUS SIGN                 
         MVI   NTTPDCP,C'-'                                                     
                                                                                
NPDC10   MVI   NTTPDAGY-1,MXTRTQ                                                
         MVI   NTTPDMED-1,MXTRTQ                                                
         MVI   NTTPDCNT-1,MXTRTQ                                                
         MVI   NTTPDPRD-1,MXTRTQ                                                
         MVI   NTTPDNME-1,MXTRTQ                                                
         MVI   NTTPDBBG-1,MXTRTQ                                                
         MVI   NTTPDCBG-1,MXTRTQ                                                
         MVI   NTTPDUV1-1,MXTRTQ                                                
         MVI   NTTPDUV2-1,MXTRTQ                                                
         MVI   NTTPDTAX-1,MXTRTQ                                                
         MVI   NTTPDINT-1,MXTRTQ                                                
         MVI   NTTPDCP-1,MXTRTQ                                                 
         MVI   NTTPDBTN-1,MXTRTQ                                                
         MVI   NTTPDAD1-1,MXTRTQ                                                
         MVI   NTTPDAD2-1,MXTRTQ                                                
         MVI   NTTPDAD2-1,MXTRTQ                                                
         MVI   NTTPDDX,MXTRTQ                                                   
         MVI   NTTPDDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTPDAGY,MXTRT                                                   
         TR    NTTPDMED,MXTRT                                                   
         TR    NTTPDCNT,MXTRT                                                   
         TR    NTTPDPRD,MXTRT                                                   
         TR    NTTPDNME,MXTRT                                                   
         TR    NTTPDBBG,MXTRT                                                   
         TR    NTTPDCBG,MXTRT                                                   
         TR    NTTPDUV1,MXTRT                                                   
         TR    NTTPDUV2,MXTRT                                                   
         TR    NTTPDTAX,MXTRT                                                   
         TR    NTTPDINT,MXTRT                                                   
         TR    NTTPDCP,MXTRT                                                    
         TR    NTTPDBTN,MXTRT                                                   
         TR    NTTPDAD1,MXTRT                                                   
         TR    NTTPDAD2,MXTRT                                                   
         TR    NTTPDAD2,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTPDLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT ESTIMATE RECORD                                                       
***********************************************************************         
NTTESC   NMOD1 WORKL,*NTTESC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTESLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTTESD,R2           R2=A(EXTRACT RECORD)                         
         USING ESTHDR,R3           R3=A(SPOT ESTIMATE RECORD)                   
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTESLEN,NTTESLEN                                                
         MVC   NTTESLEN(2),=AL2(NTTESDL)                                        
         MVC   NTTESTYP,NTESQ                                                   
         MVC   NTTESAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,EKEYAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTESMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,EKEYAM       AGY/MEDIA                                    
         MVC   CKEYCLT,EKEYCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,EKEYCLT),NTTESCNT     CLIENT                  
         DROP  R5                                                               
                                                                                
         XC    SPTKEY,SPTKEY       RESTORE ESTIMATE KEY                         
         MVC   SPTKEY,0(R3)                                                     
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
                                                                                
         MVC   NTTESPRD,EKEYPRD                        PRODUCT                  
         EDIT  EKEYEST,NTTESEST,FILL=0                 ESTIMATE                 
         MVC   NTTESNAM,EDESC                          NAME                     
         GOTO1 DATCON,DMCB,(0,ESTART),(10,NTTESSRT)    START DATE               
         GOTO1 DATCON,DMCB,(0,EEND),(10,NTTESEND)      END DATE                 
                                                                                
         MVI   NTTESBBG,C'Y'                                                    
         TM    EBILLBAS,X'F0'      BILL BASE GROSS??                            
         BZ    *+8                                                              
         MVI   NTTESBBG,C'N'                                                    
                                                                                
         MVI   NTTESCBG,C'Y'                                                    
         TM    EBILLBAS,X'0F'      COMM BASE GROSS??                            
         BZ    *+8                                                              
         MVI   NTTESCBG,C'N'                                                    
                                                                                
         MVI   NTTESSTW,C'N'                                                    
         CLI   ETYPE,ETYPSTW       STEWARDSHIP ESTIMATE?                        
         JNE   *+8                                                              
         MVI   NTTESSTW,C'Y'                                                    
                                                                                
         MVC   NTTESUV1,EUSER1     USER 1 VALUE                                 
         MVC   NTTESUV2,EUSER2     USER 2 VALUE                                 
                                                                                
         MVC   NTTESFLT,EPROF      FILTERS                                      
                                                                                
         OC    EBILLCOM,EBILLCOM   ANY COMM PCT?                                
         JZ    NESC10                                                           
         ICM   R5,15,EBILLCOM      ANY COMM PCT?                                
         LPR   RF,R5                                                            
         C     RF,=F'1000000'        IF COM BASIS IS 100% MOVE 100              
         JNE   NESC02                TO SCREEN                                  
         MVC   NTTESCP+1(3),=C'100'                                             
         J     NESC04                                                           
*                                                                               
*                                    OTHERWISE ...                              
*                                    EDIT COM.% INTO SCREEN FIELD               
NESC02   EDIT  (R5),(8,NTTESCP),4,FLOAT=+,ALIGN=LEFT                            
                                                                                
NESC04   LTR   R5,R5                                                            
         BNM   *+8                   COM.% NEGATIVE, MINUS SIGN                 
         MVI   NTTESCP,C'-'                                                     
                                                                                
NESC10   MVI   NTTESAGY-1,MXTRTQ                                                
         MVI   NTTESMED-1,MXTRTQ                                                
         MVI   NTTESCNT-1,MXTRTQ                                                
         MVI   NTTESPRD-1,MXTRTQ                                                
         MVI   NTTESEST-1,MXTRTQ                                                
         MVI   NTTESNAM-1,MXTRTQ                                                
         MVI   NTTESSRT-1,MXTRTQ                                                
         MVI   NTTESEND-1,MXTRTQ                                                
         MVI   NTTESBBG-1,MXTRTQ                                                
         MVI   NTTESCBG-1,MXTRTQ                                                
         MVI   NTTESUV1-1,MXTRTQ                                                
         MVI   NTTESUV2-1,MXTRTQ                                                
         MVI   NTTESSTW-1,MXTRTQ                                                
         MVI   NTTESFLT-1,MXTRTQ                                                
         MVI   NTTESCP-1,MXTRTQ                                                 
         MVI   NTTESDX,MXTRTQ                                                   
         MVI   NTTESDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTESAGY,MXTRT                                                   
         TR    NTTESMED,MXTRT                                                   
         TR    NTTESCNT,MXTRT                                                   
         TR    NTTESPRD,MXTRT                                                   
         TR    NTTESEST,MXTRT                                                   
         TR    NTTESNAM,MXTRT                                                   
         TR    NTTESSRT,MXTRT                                                   
         TR    NTTESEND,MXTRT                                                   
         TR    NTTESBBG,MXTRT                                                   
         TR    NTTESCBG,MXTRT                                                   
         TR    NTTESUV1,MXTRT                                                   
         TR    NTTESUV2,MXTRT                                                   
         TR    NTTESSTW,MXTRT                                                   
         TR    NTTESFLT,MXTRT                                                   
         TR    NTTESCP,MXTRT                                                    
         J     EQXIT                                                            
                                                                                
NTTESLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT EARNED COST                                                           
***********************************************************************         
NTTECT   NMOD1 WORKL,*NTTECT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTECLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AUNITREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         USING UINFOD,R8                                                        
                                                                                
         MVC   UUNTKEY,UIUNTKEY     UNIT KEY                                    
         MVC   ACLTREC,UICLTREC     A(CLIENT RECORD)                            
         DROP  R8                                                               
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDECT              BUILD THE UNIT TABLES                        
         J     ECTOUT              OUTPUT UNIT RECORD                           
                                                                                
NTTECLIT DC    A(LITERAL)                                                       
NTXECTC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
                                                                                
ECTOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
ECTOUTX  J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD TABLES FROM UNIT RECORD                                                 
***********************************************************************         
BLDECT   L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
         MVC   DATADISP,=H'27'     UNIT FILE                                    
                                                                                
         L     R2,NTXECTC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         L     R5,ACLTREC          GET ADDRESS OF PRODUCT LIST                  
         USING CLTHDR,R5                                                        
         LA    R5,CLIST                                                         
         ST    R5,APLIST                                                        
         L     R5,ACLTREC                                                       
         LA    R5,CLIST2                                                        
         ST    R5,APLIST2                                                       
         DROP  R5                                                               
                                                                                
         BRAS  RE,BLDPRDT          BUILD PRODUCT TABLE                          
                                                                                
         L     RF,ACURPRD          CURRENT PRODUCT TO START WITH                
         MVI   PRDPOS,X'01'        DEFAULT TO POSITION 1                        
                                                                                
         CLC   0(2,RF),=XL2'FFFF'  UNALLOCATED UNIT?                            
         BNE   BLDECT05            NO                                           
                                                                                
         MVI   0(RF),X'FF'         DENOTE POL                                   
         MVC   1(3,RF),=C'POL'                                                  
         MVC   4(2,RF),=XL2'2710'                                               
         MVC   10(2,RF),=XL2'FFFF'                                              
                                                                                
BLDECT05 L     RF,ACURPRD                                                       
         CLC   0(2,RF),=XL2'FFFF'  FINISHED ALL PRODUCTS?                       
         BE    BLDECTX                                                          
                                                                                
         BRAS  RE,ECT              BUILD ECT TABLE                              
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         ZIC   RF,PRDPOS           BUMP UP PRODUCT POSITION #                   
         AHI   RF,1                                                             
         STC   RF,PRDPOS                                                        
         B     BLDECT05                                                         
                                                                                
BLDECTX  L     R2,NTXECTC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD ECT TABLE                                                               
***********************************************************************         
ECT      NTR1  BASE=*,LABEL=*                                                   
         L     RA,ECTLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTECD,R2                                                        
         LA    R1,NTTECDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTECD,R2                                                        
         L     R3,AUNITREC         UNIT RECORD                                  
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
                                                                                
         XC    NTTECLEN,NTTECLEN                                                
         MVC   NTTECLEN(2),=AL2(NTTECDL)                                        
         MVC   NTTECTYP,NTECQ                                                   
         MVC   NTTECAGY,SXDTAGY    AGENCY                                       
         MVC   NTTECUID(L'NUKEY-2),2(R3)                                        
                                                                                
         EDIT  PRDPOS,NTTECPOS,FILL=0        PRODUCT POSITION                   
                                                                                
         BRAS  RE,GETPROD          GET PRODUCT                                  
         L     R5,FULL                                                          
                                                                                
         MVC   NTTECPRD,=C'POL'                                                 
         CLI   0(R5),X'FF'         UNALLOCATED?                                 
         BE    *+10                                                             
         MVC   NTTECPRD,1(R5)      3 CHAR PRODUCT CODE                          
                                                                                
         XC    HALF,HALF                                                        
         CLI   0(R5),X'FF'         UNALLOCATED PRODUCT?                         
         BE    *+10                                                             
         MVC   HALF,4(R5)          PRD %                                        
                                                                                
         MVC   FULL,NUASSIGN                                                    
         BRAS  RE,GETCST                                                        
         EDIT  (P8,DUB),NTTECASS,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
                                                                                
         MVI   9(R5),C'X'          FINISHED PROCESSING THIS PRODUCT             
         LA    R5,10(R5)                                                        
         ST    R5,ACURPRD                                                       
                                                                                
         MVI   NTTECAGY-1,MXTRTQ                                                
         MVI   NTTECUID-1,MXTRTQ                                                
         MVI   NTTECPRD-1,MXTRTQ                                                
         MVI   NTTECPOS-1,MXTRTQ                                                
         MVI   NTTECASS-1,MXTRTQ                                                
         MVI   NTTECDX,MXTRTQ                                                   
         MVI   NTTECDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTECAGY,MXTRT                                                   
         TR    NTTECPRD,MXTRT                                                   
         TR    NTTECPOS,MXTRT                                                   
         TR    NTTECASS,MXTRT                                                   
         J     EXIT                                                             
                                                                                
ECTLIT   DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT STATION RECORD                                                        
***********************************************************************         
NTTSTC   NMOD1 WORKL,*NTTSTC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTSTLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTTSTD,R2           R2=A(EXTRACT RECORD)                         
         USING STAREC,R3           R3=A(STATION RECORD)                         
         USING SXDTABD,R4                                                       
                                                                                
         USING DXBLOCKD,R7                                                      
         MVC   MODE,DXMODE         GET THE DXMODE                               
         DROP  R7                                                               
                                                                                
         XC    NTTSTLEN,NTTSTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTSTLEN(2),=AL2(NTTSTDL)                                        
         MVC   NTTSTTYP,NTSTQ                                                   
         MVC   NTTSTAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   NTTSTMED,STAKMED    MEDIA                                        
         MVC   NTTSTSTA,STAKCALL   STATION                                      
                                                                                
         XC    STAKNEW,STAKNEW                                                  
         MVI   STAKNEW,C'M'                                                     
         MVC   STAKNEW+1(1),STAKEY+1    MEDIA                                   
         MVC   STAKNEW+2(4),SMKT        MARKET NUMBER                           
         MVC   STAKNEW+6(2),STAKEY+7    AGENCY                                  
         MVC   STAKNEW+8(7),=C'0000000'                                         
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
                                                                                
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'STATION',STAKNEW,STAIO,WORK          
                                                                                
         LA    R6,STAIO                                                         
         USING MKTREC,R6                                                        
         CLC   STAKNEW,STAIO                                                    
         BNE   *+10                                                             
         MVC   NTTSTNAM,MKTNAME                                                 
         DROP  R6                                                               
                                                                                
         CLI   MODE,DXUPDTQ        CHECK UPDATE MODE ?                          
         JE    NTTST10                                                          
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'STATION',STAKEY,0(R3),WORK           
                                                                                
NTTST10  MVC   NTTSTNMD,STYPE      STATION TYPE                                 
         MVC   NTTSTPTY,SPTYPE     POSTING TYPE                                 
         MVC   NTTSTNTI(4),SNTISTA NTI STATION                                  
         MVI   NTTSTNTI+4,C'N'                                                  
                                                                                
         MVC   NTTSTTTP,STRTYPE                                                 
         MVC   NTTSTMKT,SMKT       MARKET                                       
                                                                                
         MVI   NTTSTAGY-1,MXTRTQ                                                
         MVI   NTTSTMED-1,MXTRTQ                                                
         MVI   NTTSTSTA-1,MXTRTQ                                                
         MVI   NTTSTNAM-1,MXTRTQ                                                
         MVI   NTTSTNMD-1,MXTRTQ                                                
         MVI   NTTSTPTY-1,MXTRTQ                                                
         MVI   NTTSTNTI-1,MXTRTQ                                                
         MVI   NTTSTTTP-1,MXTRTQ                                                
         MVI   NTTSTMKT-1,MXTRTQ                                                
         MVI   NTTSTDX,MXTRTQ                                                   
         MVI   NTTSTDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTSTAGY,MXTRT                                                   
         TR    NTTSTMED,MXTRT                                                   
         TR    NTTSTSTA,MXTRT                                                   
         TR    NTTSTNAM,MXTRT                                                   
         TR    NTTSTNMD,MXTRT                                                   
         TR    NTTSTPTY,MXTRT                                                   
         TR    NTTSTNTI,MXTRT                                                   
         TR    NTTSTTTP,MXTRT                                                   
         TR    NTTSTMKT,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTSTLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT MARKET RECORD                                                         
***********************************************************************         
NTTMKT   NMOD1 WORKL,*NTTMKT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTMKLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTTMKD,R2           R2=A(EXTRACT RECORD)                         
         USING MKTREC,R3           R3=A(STATION RECORD)                         
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTMKLEN,NTTMKLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTMKLEN(2),=AL2(NTTMKDL)                                        
         MVC   NTTMKTYP,NTMKTQ                                                  
         MVC   NTTMKAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   NTTMKMED,MKTKMED    MEDIA                                        
         MVC   NTTMKMKT,MKTKMKT    MARKET                                       
         MVC   NTTMKNAM,MKTNAME    MARKET NAME                                  
                                                                                
         MVI   NTTMKAGY-1,MXTRTQ                                                
         MVI   NTTMKMED-1,MXTRTQ                                                
         MVI   NTTMKMKT-1,MXTRTQ                                                
         MVI   NTTMKNAM-1,MXTRTQ                                                
         MVI   NTTMKDX,MXTRTQ                                                   
         MVI   NTTMKDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTMKAGY,MXTRT                                                   
         TR    NTTMKMED,MXTRT                                                   
         TR    NTTMKMKT,MXTRT                                                   
         TR    NTTMKNAM,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTMKLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT REP RECORD                                                            
***********************************************************************         
NTTREP   NMOD1 WORKL,*NTTREP*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTREPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTREPD,R2           R2=A(EXTRACT RECORD)                         
         USING REPD,R3             R3=A(REP RECORD)                             
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTREPLEN,NTREPLEN                                                
         MVC   NTREPLEN(2),=AL2(NTREPDL)                                        
         MVC   NTREPTYP,NTREPQ                                                  
         MVC   NTREPAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   NTREPMED,REPKMED    MEDIA                                        
         MVC   NTREPCOD,REPKREP    REP                                          
         MVC   NTREPNAM,RNAME      NAME                                         
         MVC   NTREPADD,R1LINE     ADDRESS                                      
         MVC   NTREPCIT,R2LINE                                                  
         MVC   NTREPSTA,R3LINE                                                  
         MVC   NTREPZIP,RBIGZIP                                                 
         MVI   NTREPUNW,C'N'                                                    
         CLI   RUNWNET,C'Y'                                                     
         BNE   *+10                                                             
         MVC   NTREPUNW,RUNWNET                                                 
                                                                                
         MVI   NTREPCON,C'U'                                                    
         CLC   =C'CANAD',RZIP                                                   
         BNE   *+8                                                              
         MVI   NTREPCON,C'C'                                                    
                                                                                
         MVI   NTREPAGY-1,MXTRTQ                                                
         MVI   NTREPMED-1,MXTRTQ                                                
         MVI   NTREPCOD-1,MXTRTQ                                                
         MVI   NTREPNAM-1,MXTRTQ                                                
         MVI   NTREPADD-1,MXTRTQ                                                
         MVI   NTREPCIT-1,MXTRTQ                                                
         MVI   NTREPSTA-1,MXTRTQ                                                
         MVI   NTREPZIP-1,MXTRTQ                                                
         MVI   NTREPCON-1,MXTRTQ                                                
         MVI   NTREPUNW-1,MXTRTQ                                                
         MVI   NTREPDX,MXTRTQ                                                   
         MVI   NTREPDX+1,MXTRTQ                                                 
                                                                                
         TR    NTREPAGY,MXTRT                                                   
         TR    NTREPMED,MXTRT                                                   
         TR    NTREPCOD,MXTRT                                                   
         TR    NTREPNAM,MXTRT                                                   
         TR    NTREPADD,MXTRT                                                   
         TR    NTREPCIT,MXTRT                                                   
         TR    NTREPSTA,MXTRT                                                   
         TR    NTREPZIP,MXTRT                                                   
         TR    NTREPCON,MXTRT                                                   
         TR    NTREPUNW,MXTRT                                                   
         J     EQXIT                                                            
*                                                                               
NTREPLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT PROGRAM RECORD                                                        
***********************************************************************         
NTTPGM   NMOD1 WORKL,*NTTPGM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTPGLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         L     R8,16(R1)                                                        
         USING NTTPRD,R2           R2=A(EXTRACT RECORD)                         
         USING NPGRECD,R3          R3=A(PROGRAM RECORD)                         
         USING SXDTABD,R4                                                       
         MVC   DATADISP,=H'24'                                                  
                                                                                
         XC    NTTPRLEN,NTTPRLEN                                                
         MVC   NTTPRLEN(2),=AL2(NTTPRDL)                                        
         MVC   NTTPRTYP,NTPRQ                                                   
         MVC   NTTPRAGY,SXDTAGY    AGENCY                                       
                                                                                
         XC    NTTPRSTD,NTTPRSTD                                                
                                                                                
         MVC   HALF,NPGKNET                                                     
         BAS   RE,GETNET           GET NETWORK FROM NETMKT #                    
         MVC   NTTPRSTA,DUB        STATION                                      
                                                                                
         MVC   BYTE,NPGKAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTPRMED,BYTE       MEDIA                                        
                                                                                
         MVC   NTTPRPGM,NPGKPROG   PROGRAM CODE                                 
         GOTO1 DATCON,DMCB,(2,NPGKEND),(10,NTTPREND)   END DATE                 
                                                                                
         LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'92'        AGENCY ELEMENT                               
         BRAS  RE,GETEL                                                         
         BNE   NTTPG05                                                          
         USING NPGEL92,R6                                                       
                                                                                
         MVC   NTTPRNAM,NPGNAME    NAME                                         
         MVC   NTTPRSTT,=C'00:00 AM'      DEFAULT                               
         MVC   NTTPRENT,=C'00:00 AM'                                            
         CLC   NPGTIME(4),=C'VARY'        VARIOUS TIME?                         
         BE    NTTPG05                                                          
                                                                                
         MVC   HALF,NPGTIME        START IN MILITARY TIME                       
         BAS   RE,CONVTIME         CONVERT TO PRINTABLE TIME                    
         MVC   NTTPRSTT,CHARTIME   START TIME                                   
                                                                                
         MVC   HALF,NPGTIME+2      START IN MILITARY TIME                       
         BAS   RE,CONVTIME         CONVERT TO PRINTABLE TIME                    
         MVC   NTTPRENT,CHARTIME   END TIME                                     
                                                                                
         LA    R0,7                R0 - NUMBER OF DAYS IN A WEEK                
         LA    R1,X'40'            BIT MASK, START WITH MONDAY                  
         LA    RE,NTTPRDAY                                                      
*                                                                               
NTTPG03  MVI   0(RE),C'N'                                                       
         EX    R1,*+8              IS THIS DAY SET ON?                          
         B     *+8                 NO                                           
         TM    NPGDAY,0                                                         
         BZ    *+8                 NO                                           
         MVI   0(RE),C'Y'          SET DAY AS A YES                             
         AHI   RE,1                MOVE TO NEXT DAY                             
         SRL   R1,1                SHIFT FOR NEXT DAY                           
         BCT   R0,NTTPG03                                                       
*                                                                               
         DROP  R6                                                               
*                                                                               
NTTPG05  LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'93'        AGENCY ELEMENT                               
         BRAS  RE,GETEL                                                         
         BNE   NTTPG10                                                          
         USING NPGEL93,R6                                                       
                                                                                
         OC    NPG2STD,NPG2STD                                                  
         BZ    NTTPG08                                                          
                                                                                
         GOTO1 DATCON,DMCB,(2,NPG2STD),(10,NTTPRSTD)   START DATE               
                                                                                
NTTPG08  DS    0H                                                               
         MVC   NTTPRDPT(1),NPG2DYP                                              
         OC    NPG2DYPA,NPG2DYPA                                                
         BZ    *+10                                                             
         MVC   NTTPRDPT,NPG2DYPA                                                
         OC    NTTPRDPT,SPACES                                                  
                                                                                
         DROP  R6                                                               
                                                                                
NTTPG10  MVI   NTTPRNEW,C'N'                                                    
         MVI   NTTPRRET,C'N'                                                    
                                                                                
         LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'03'                                                     
         BRAS  RE,GETEL                                                         
         BNE   NTTPG20                                                          
         USING NPGEL03,R6                                                       
                                                                                
         MVC   NTTPRMIR,NPGMIRCD   MIRROR CODE                                  
         MVC   NTTPRPTY,NPPRGTYP  PROGRAM TYPE                                  
         MVC   NTTPRSPT,NPPRGSTP  SUB PROGRAM TYPE                              
         MVC   NTTPRRAT,NPPRGRAT  PROGRAM RATING (CONTENT TYPE)                 
         MVC   NTTPRTIE,NPTIER    TIER                                          
                                                                                
         CLI   NPPRNEW,0                                                        
         BE    NTTPG20                                                          
         CLI   NPPRNEW,C'Y'                                                     
         BNE   *+12                                                             
         MVI   NTTPRNEW,C'Y'                                                    
         B     NTTPG20                                                          
         MVI   NTTPRRET,C'Y'                                                    
         DROP  R6                                                               
*                                                                               
NTTPG20  LR    R6,R3                                                            
         MVI   ELCODE,X'F1'                                                     
         BAS   RE,GETEL                                                         
         BNE   NTTPGX                                                           
         USING ACTVD,R6                                                         
         GOTO1 DATCON,DMCB,(3,ACTVADDT),(10,NTTPRCDT)    CREATION DATE          
                                                                                
         OC    ACTVCHDT,ACTVCHDT                                                
         BZ    NTTPGX                                                           
         GOTO1 DATCON,DMCB,(3,ACTVCHDT),(10,NTTPRCDT)    CHANGE DATE            
                                                                                
NTTPGX   MVI   NTTPRAGY-1,MXTRTQ                                                
         MVI   NTTPRMED-1,MXTRTQ                                                
         MVI   NTTPRSTA-1,MXTRTQ                                                
         MVI   NTTPRPGM-1,MXTRTQ                                                
         MVI   NTTPRNAM-1,MXTRTQ                                                
         MVI   NTTPRSTD-1,MXTRTQ                                                
         MVI   NTTPREND-1,MXTRTQ                                                
         MVI   NTTPRSTT-1,MXTRTQ                                                
         MVI   NTTPRENT-1,MXTRTQ                                                
         MVI   NTTPRMIR-1,MXTRTQ                                                
         MVI   NTTPRPTY-1,MXTRTQ                                                
         MVI   NTTPRSPT-1,MXTRTQ                                                
         MVI   NTTPRNEW-1,MXTRTQ                                                
         MVI   NTTPRRET-1,MXTRTQ                                                
         MVI   NTTPRRAT-1,MXTRTQ                                                
         MVI   NTTPRTIE-1,MXTRTQ                                                
         MVI   NTTPRDPT-1,MXTRTQ                                                
         MVI   NTTPRDAY-1,MXTRTQ                                                
         MVI   NTTPRCDT-1,MXTRTQ                                                
         MVI   NTTPRDX,MXTRTQ                                                   
         MVI   NTTPRDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTPRAGY,MXTRT                                                   
         TR    NTTPRMED,MXTRT                                                   
         TR    NTTPRSTA,MXTRT                                                   
         TR    NTTPRPGM,MXTRT                                                   
         TR    NTTPRNAM,MXTRT                                                   
         TR    NTTPRSTD,MXTRT                                                   
         TR    NTTPREND,MXTRT                                                   
         TR    NTTPRSTT,MXTRT                                                   
         TR    NTTPRENT,MXTRT                                                   
         TR    NTTPRMIR,MXTRT                                                   
         TR    NTTPRPTY,MXTRT                                                   
         TR    NTTPRSPT,MXTRT                                                   
         TR    NTTPRNEW,MXTRT                                                   
         TR    NTTPRRET,MXTRT                                                   
         TR    NTTPRRAT,MXTRT                                                   
         TR    NTTPRTIE,MXTRT                                                   
         TR    NTTPRDPT,MXTRT                                                   
         TR    NTTPRDAY,MXTRT                                                   
         TR    NTTPRCDT,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTPGLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CONVERT MILITARY TO PRINTABLE TIME                                            
***********************************************************************         
CONVTIME NTR1  BASE=*,LABEL=*                                                   
         LH    R5,HALF                                                          
         CH    R5,=H'2400'         12AM?                                        
         BNE   *+14                                                             
         MVC   CHARTIME(8),=C'12:00 AM'                                         
         B     CTIMEX                                                           
                                                                                
         SH    R5,=H'1200'                                                      
         BP    CTIME10             PM                                           
         BZ    CTIME05             12PM                                         
                                                                                
         EDIT  HALF,FULL,FILL=0    TIME IN MILITARY                             
         XC    CHARTIME,CHARTIME                                                
         MVI   CHARTIME+2,C':'                                                  
         MVC   CHARTIME(2),FULL    HOUR                                         
         MVC   CHARTIME+3(2),FULL+2 MINUTES                                     
         MVC   CHARTIME+6(2),=C'AM'                                             
         B     CTIMEX                                                           
                                                                                
CTIME05  MVC   CHARTIME(8),=C'12:00 PM'                                         
         B     CTIMEX                                                           
                                                                                
CTIME10  STH   R5,HALF                                                          
         EDIT  HALF,FULL,FILL=0    TIME IN MILITARY                             
         XC    CHARTIME,CHARTIME                                                
         MVI   CHARTIME+2,C':'                                                  
         MVC   CHARTIME(2),FULL    HOUR                                         
         LH    R5,HALF                                                          
         CH    R5,=H'1300'                                                      
         BNH   *+10                                                             
         MVC   CHARTIME(2),=C'12'                                               
                                                                                
         MVC   CHARTIME+3(2),FULL+2 MINUTES                                     
         MVC   CHARTIME+6(2),=C'PM'                                             
                                                                                
CTIMEX   TR    CHARTIME,MXTRT                                                   
         CLC   CHARTIME(2),=C'00'                                               
         BNE   *+10                                                             
         MVC   CHARTIME(2),=C'12'                                               
         J     EQXIT                                                            
         EJECT                                                                  
***********************************************************************         
* GET NETWORK FROM MARKET NUMBER                                                
***********************************************************************         
GETNET   NTR1  BASE=*,LABEL=*                                                   
GETNET05 CLI   0(R8),X'FF'                                                      
         BE    GETNETX                                                          
         CLC   4(2,R8),HALF        SAME MARKET #?                               
         BE    *+12                                                             
         AHI   R8,6                                                             
         B     GETNET05                                                         
                                                                                
         MVC   DUB(4),0(R8)                                                     
         MVI   DUB+4,C'N'                                                       
                                                                                
GETNETX  J     EQXIT                                                            
         EJECT                                                                  
***********************************************************************         
* DAYPART RECORD                                                                
***********************************************************************         
NTTDPT   NMOD1 WORKL,*NTTDPT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTDPLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         L     R8,16(R1)                                                        
         USING NTTDPD,R2           R2=A(EXTRACT RECORD)                         
         USING NDPTHDR,R3          R3=A(DAYPART KEY)                            
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTTDPLEN,NTTDPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTDPLEN(2),=AL2(NTTDPTL)                                        
         MVC   NTTDPTYP,NTDPQ                                                   
         MVC   NTTDPAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,NDPTAGM                                                     
         BRAS  RE,GETMED                                                        
         MVC   NTTDPMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,NDPTAGM      AGY/MEDIA                                    
         MVC   CKEYCLT,NDPTCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,NDPTCLT),NTTDPCNT    CLIENT                   
         DROP  R5                                                               
                                                                                
         XC    UNTKEY,UNTKEY       RESTORE DAYPART KEY                          
         MVC   UNTKEY,0(R3)                                                     
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'UNTDIR',UNTKEY,UNTKEY,WORK           
                                                                                
         MVC   NTTDPDPT,NDPTDPTA   2 BYTE DAYPART CODE                          
         MVC   NTTDPNAM,NDPTDES    DAYPART NAME                                 
                                                                                
         MVI   NTTDPAGY-1,MXTRTQ                                                
         MVI   NTTDPMED-1,MXTRTQ                                                
         MVI   NTTDPCNT-1,MXTRTQ                                                
         MVI   NTTDPDPT-1,MXTRTQ                                                
         MVI   NTTDPNAM-1,MXTRTQ                                                
         MVI   NTTDPTX,MXTRTQ                                                   
         MVI   NTTDPTX+1,MXTRTQ                                                 
                                                                                
         TR    NTTDPAGY,MXTRT                                                   
         TR    NTTDPMED,MXTRT                                                   
         TR    NTTDPCNT,MXTRT                                                   
         TR    NTTDPDPT,MXTRT                                                   
         TR    NTTDPNAM,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTDPLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT ESTIMATE DEMO LIST                                                    
***********************************************************************         
NTTEDC   NMOD1 WORKL,*NTTEDC*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTEDCIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R8,16(R1)                                                        
         ST    R2,ADXAXREC                                                      
         ST    R3,AESTREC                                                       
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDEDC              BUILD THE TABLES                             
         J     EDCOUT              OUTPUT RECORD                                
                                                                                
NTTEDCIT DC    A(LITERAL)                                                       
NTXEDCC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
                                                                                
BLDEDC   L     R2,NTXEDCC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         L     R3,AESTREC          BUILD DEMO LIST                              
         USING ESTHDR,R3                                                        
                                                                                
         XC    DEMOLIST,DEMOLIST                                                
         MVC   DEMOLIST(60),EDEMLST                                             
         MVC   DEMOLIST+60(60),EDEMLST1                                         
         MVC   DEMOLIST+120(60),EDEMLST2                                        
                                                                                
         OC    EDEM21,EDEM21                                                    
         BZ    *+10                                                             
         MVC   DEMOLIST+60(60),EDEM21                                           
         DROP  R3                                                               
                                                                                
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
                                                                                
         BRAS  RE,BLDEDL           BUILD ESTIMATE DEMO LIST                     
                                                                                
BLDED05  L     RF,ACURDEMO                                                      
         CLI   0(RF),X'FF'         FINISHED ALL DEMOS?                          
         BE    BLDEDX                                                           
                                                                                
         BRAS  RE,EDLREC           BUILD ESTIMATE DEMO                          
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
         B     BLDED05                                                          
                                                                                
BLDEDX   L     R2,NTXEDCC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD ESTIMATE DEMOS                                                          
***********************************************************************         
EDLREC   NTR1  BASE=*,LABEL=*                                                   
         L     RA,EDCLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTEDD,R2                                                        
         LA    R1,NTTEDDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTEDD,R2                                                        
         L     R3,AESTREC                                                       
         USING ESTHDR,R3                                                        
         L     R8,ABIGWORK                                                      
                                                                                
         XC    NTTEDLEN,NTTEDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTEDLEN(2),=AL2(NTTEDDL)                                        
         MVC   NTTEDTYP,NTEDQ                                                   
         MVC   NTTEDAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,EKEYAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTEDMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,EKEYAM       AGY/MEDIA                                    
         MVC   CKEYCLT,EKEYCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,EKEYCLT),NTTEDCNT     CLIENT                  
         DROP  R5                                                               
                                                                                
         XC    SPTKEY,SPTKEY       RESTORE ESTIMATE KEY                         
         MVC   SPTKEY,0(R3)                                                     
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
                                                                                
         MVC   NTTEDPRD,EKEYPRD    PRODUCT                                      
         EDIT  EKEYEST,NTTEDEST,FILL=0        ESTIMATE                          
                                                                                
         L     R8,ABIGWORK                                                      
         LA    R8,200(R8)                                                       
         BRAS  RE,GETDEMO          GET NEXT DEMO FROM DEMO LIST                 
         L     R8,FULL                                                          
                                                                                
         MVC   BYTE2,0(R8)                                                      
         EDIT  BYTE2,NTTEDNAD,FILL=0   NAD CATEGORY                             
         MVC   NTTEDMOD,1(R8)          MODIFIER                                 
         MVC   BYTE2,2(R8)                                                      
         EDIT  BYTE2,NTTEDASC,FILL=0   AGE SEX CATEGORY                         
         EDIT  BYTE,NTTEDPOS,FILL=0    POSITION                                 
                                                                                
         MVI   3(R8),C'X'          MARK THIS DEMO PROCESSED                     
         LA    R8,4(R8)                                                         
         ST    R8,ACURDEMO                                                      
                                                                                
         MVI   NTTEDAGY-1,MXTRTQ                                                
         MVI   NTTEDMED-1,MXTRTQ                                                
         MVI   NTTEDCNT-1,MXTRTQ                                                
         MVI   NTTEDPRD-1,MXTRTQ                                                
         MVI   NTTEDEST-1,MXTRTQ                                                
         MVI   NTTEDNAD-1,MXTRTQ                                                
         MVI   NTTEDMOD-1,MXTRTQ                                                
         MVI   NTTEDASC-1,MXTRTQ                                                
         MVI   NTTEDPOS-1,MXTRTQ                                                
         MVI   NTTEDDX,MXTRTQ                                                   
         MVI   NTTEDDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTEDAGY,MXTRT                                                   
         TR    NTTEDMED,MXTRT                                                   
         TR    NTTEDCNT,MXTRT                                                   
         TR    NTTEDPRD,MXTRT                                                   
         TR    NTTEDEST,MXTRT                                                   
         TR    NTTEDNAD,MXTRT                                                   
         TR    NTTEDMOD,MXTRT                                                   
         TR    NTTEDASC,MXTRT                                                   
         TR    NTTEDPOS,MXTRT                                                   
         J     EXIT                                                             
                                                                                
EDCLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
                                                                                
EDCOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
EDCOUTX  J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* GETDEMO                                                                       
* R8 IS EXPECTED TO ADDRESS BIGWORK (DEMLIST)                                   
* ON EXIT, FULL WILL CONTAIN THE ADDRESS OF DEMO IN TABLE                       
*          AND BYTE WILL CONTAIN POSITION                                       
***********************************************************************         
GETDEMO  NTR1  BASE=*,LABEL=*                                                   
         XC    FULL,FULL                                                        
         MVI   BYTE,1                                                           
         LA    R5,1                                                             
                                                                                
GDEMO05  CLI   0(R8),X'FF'                                                      
         BE    GDEMOX                                                           
                                                                                
         CLI   3(R8),0             PROCESSED THIS ONE YET?                      
         BE    GDEMO10                                                          
         AHI   R8,4                                                             
         AHI   R5,1                                                             
         B     GDEMO05                                                          
                                                                                
GDEMO10  ST    R8,FULL             SAVE AWAY ADDRESS IN TABLE                   
         STC   R5,BYTE             SAVE AWAY POSITION                           
                                                                                
GDEMOX   J     EQXIT                                                            
***********************************************************************         
* CHECK FOR DUPLICATE AGE/SEX CATEGORY IN ESTIMATE DEMO LIST                    
* R8 IS EXPECTED TO ADDRESS BIGWORK (DEMLIST)                                   
* ON EXIT, FULL WILL CONTAIN THE ADDRESS OF DEMO IN TABLE                       
*          AND BYTE WILL CONTAIN POSITION                                       
***********************************************************************         
CHKDUPD  NTR1  BASE=*,LABEL=*                                                   
         CLI   SXDTVER,5                                                        
         BNL   CHKDX               IF < VERSION 5, THEN DO THIS CHECK           
                                                                                
         L     R8,AEDEMLST                                                      
CHKD05   CLI   0(R8),X'FF'                                                      
         BE    CHKDX                                                            
                                                                                
         CLI   3(R8),0             PROCESSED THIS ONE YET?                      
         BE    CHKD10                                                           
         AHI   R8,4                                                             
         B     CHKD05                                                           
                                                                                
CHKD10   MVC   FULL,0(R8)          SAVE AWAY DEMO TO COMPARE WITH               
         ST    R8,ACURCOMP                                                      
         AHI   R8,4                BUMP TO NEXT ENTRY                           
                                                                                
CHKD15   CLI   0(R8),X'FF'                                                      
         BE    CHKDX                                                            
                                                                                
         CLI   3(R8),0             PROCESSED THIS ONE YET?                      
         BNE   CHKD20                                                           
         CLC   0(1,R8),FULL        SAME NAD CATEGORY?                           
         BNE   CHKD20                                                           
         CLC   2(1,R8),FULL+2      FOUND DUPLICATE AGE/SEX CATEGORY?            
         BNE   CHKD20                                                           
                                                                                
         MVI   3(R8),C'X'          MARK THIS DUPLICATE PROCESSED                
         L     R8,ACURCOMP                                                      
         MVI   1(R8),C'B'          RETURN BOTH RATING AND IMPRESSION            
                                                                                
CHKD20   AHI   R8,4                                                             
         B     CHKD15                                                           
                                                                                
CHKDX    J     EQXIT                                                            
         EJECT                                                                  
***********************************************************************         
* EXTRACT PACKAGE RECORD                                                        
***********************************************************************         
NTTPAK   NMOD1 WORKL,*NTTPAK*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTPKLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         L     R8,16(R1)                                                        
         USING NTTPKD,R2           R2=A(EXTRACT RECORD)                         
         USING NPRECD,R3           R3=A(PACKAGE RECORD)                         
         USING SXDTABD,R4                                                       
         MVC   DATADISP,=H'27'                                                  
                                                                                
         XC    NTTPKLEN,NTTPKLEN                                                
         MVC   NTTPKLEN(2),=AL2(NTTPKDL)                                        
         MVC   NTTPKTYP,NTPKQ                                                   
         MVC   NTTPKAGY,SXDTAGY    AGENCY                                       
                                                                                
         MVC   BYTE,NPKAM                                                       
         BRAS  RE,GETMED                                                        
         MVC   NTTPKMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,NPKAM        AGY/MEDIA                                    
         MVC   CKEYCLT,NPKCLT      CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,NPKCLT),NTTPKCNT    CLIENT                    
         DROP  R5                                                               
                                                                                
         XC    UNTKEY,UNTKEY       RESTORE PACKAGE KEY                          
         MVC   UNTKEY,0(R3)                                                     
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'UNTDIR',UNTKEY,UNTKEY,WORK           
                                                                                
         MVC   NTTPKSTA(4),NPKNET     NETWORK                                   
         MVI   NTTPKSTA+4,C'N'                                                  
         EDIT  NPKEST,NTTPKEST,FILL=0        ESTIMATE                           
         EDIT  NPKPACK,NTTPKPAK,FILL=0       PACKAGE                            
         MVC   NTTPKDPT,0(R8)      DAYPART 2 CHAR ALPHA                         
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'01'                                                     
         BAS   RE,GETEL                                                         
         BNE   NTTPK05                                                          
         USING NPAKEL,R6                                                        
                                                                                
         MVC   NTTPKNAM,NPAKNAME   NAME                                         
         EDIT  NPAKCOST,NTTPKCST,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                
         EDIT  NPAKGCPM,NTTPKCPM,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-              
                                                                                
         MVI   NTTPKFRZ,C'N'       FROZEN DEFAULT TO 'N'                        
         TM    NPAKSTAT,X'80'                                                   
         BZ    *+8                                                              
         MVI   NTTPKFRZ,C'Y'                                                    
                                                                                
         MVI   NTTPKLCK,C'N'       LOCKED DEFAULT TO 'N'                        
         TM    NPAKSTAT,X'20'                                                   
         BZ    *+8                                                              
         MVI   NTTPKLCK,C'Y'                                                    
                                                                                
         MVI   NTTPKCUP,C'N'                                                    
         TM    NPAKCNTL,X'10'      CABLE UPLOAD?                                
         BZ    *+8                                                              
         MVI   NTTPKCUP,C'Y'                                                    
                                                                                
NTTPK05  LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   NTTPK10                                                          
         USING NPK2D,R6                                                         
                                                                                
         MVC   NTTPKNA2,NPK2NME2   NAME 2                                       
         MVC   NTTPKBTY,NPK2BTYP   BUY TYPE                                     
                                                                                
         EDIT  (B1,NPAKGDEM),NTTPKCAT,FILL=0   NAD CATEGORY                     
         MVC   NTTPKMOD,NPAKGDEM+1    MODIFIER                                  
         EDIT  (B1,NPAKGDEM+2),NTTPKASX,FILL=0   AGE SEX CATEGORY               
                                                                                
NTTPK10  LR    R6,R3                                                            
         MVI   ELCODE,X'08'                                                     
         BAS   RE,GETEL                                                         
         BNE   NTTPK15                                                          
         USING NPFILD,R6                                                        
                                                                                
         MVC   NTTPKFL1,NPFILTER     FILTER                                     
         MVC   NTTPKFL2,NPFILTER+1   FILTER                                     
         MVC   NTTPKFL3,NPFILTER+2   FILTER                                     
         MVC   NTTPKFL4,NPFILTER+3   FILTER                                     
         MVC   NTTPKFL5,NPFILTER+4   FILTER                                     
         MVC   NTTPKFL6,NPFILTER+5   FILTER                                     
                                                                                
NTTPK15  LR    R6,R3                                                            
         MVI   ELCODE,X'09'                                                     
         BAS   RE,GETEL                                                         
         BNE   NTTPKX                                                           
         USING NAUDD,R6                                                         
                                                                                
         MVC   NTTPKAGR,NAUDGRP    AUDIT GROUP                                  
         MVC   NTTPKANM,NAUDCOM    AUDIT NAME                                   
         DROP  R6                                                               
                                                                                
NTTPKX   MVI   NTTPKAGY-1,MXTRTQ                                                
         MVI   NTTPKMED-1,MXTRTQ                                                
         MVI   NTTPKCNT-1,MXTRTQ                                                
         MVI   NTTPKSTA-1,MXTRTQ                                                
         MVI   NTTPKEST-1,MXTRTQ                                                
         MVI   NTTPKPAK-1,MXTRTQ                                                
         MVI   NTTPKNAM-1,MXTRTQ                                                
         MVI   NTTPKNA2-1,MXTRTQ                                                
         MVI   NTTPKDPT-1,MXTRTQ                                                
         MVI   NTTPKCST-1,MXTRTQ                                                
         MVI   NTTPKCUP-1,MXTRTQ                                                
         MVI   NTTPKCPM-1,MXTRTQ                                                
         MVI   NTTPKFL1-1,MXTRTQ                                                
         MVI   NTTPKFL2-1,MXTRTQ                                                
         MVI   NTTPKFL3-1,MXTRTQ                                                
         MVI   NTTPKFL4-1,MXTRTQ                                                
         MVI   NTTPKFL5-1,MXTRTQ                                                
         MVI   NTTPKFL6-1,MXTRTQ                                                
         MVI   NTTPKAGR-1,MXTRTQ                                                
         MVI   NTTPKANM-1,MXTRTQ                                                
         MVI   NTTPKFRZ-1,MXTRTQ                                                
         MVI   NTTPKLCK-1,MXTRTQ                                                
         MVI   NTTPKBTY-1,MXTRTQ                                                
         MVI   NTTPKCAT-1,MXTRTQ                                                
         MVI   NTTPKMOD-1,MXTRTQ                                                
         MVI   NTTPKASX-1,MXTRTQ                                                
         MVI   NTTPKDX,MXTRTQ                                                   
         MVI   NTTPKDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTPKAGY,MXTRT                                                   
         TR    NTTPKMED,MXTRT                                                   
         TR    NTTPKCNT,MXTRT                                                   
         TR    NTTPKSTA,MXTRT                                                   
         TR    NTTPKEST,MXTRT                                                   
         TR    NTTPKPAK,MXTRT                                                   
         TR    NTTPKNAM,MXTRT                                                   
         TR    NTTPKNA2,MXTRT                                                   
         TR    NTTPKDPT,MXTRT                                                   
         TR    NTTPKCST,MXTRT                                                   
         TR    NTTPKCUP,MXTRT                                                   
         TR    NTTPKCPM,MXTRT                                                   
         TR    NTTPKFL1,MXTRT                                                   
         TR    NTTPKFL2,MXTRT                                                   
         TR    NTTPKFL3,MXTRT                                                   
         TR    NTTPKFL4,MXTRT                                                   
         TR    NTTPKFL5,MXTRT                                                   
         TR    NTTPKFL6,MXTRT                                                   
         TR    NTTPKAGR,MXTRT                                                   
         TR    NTTPKANM,MXTRT                                                   
         TR    NTTPKFRZ,MXTRT                                                   
         TR    NTTPKLCK,MXTRT                                                   
         TR    NTTPKBTY,MXTRT                                                   
         TR    NTTPKCAT,MXTRT                                                   
         TR    NTTPKMOD,MXTRT                                                   
         TR    NTTPKASX,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTPKLIT DC    A(LITERAL)                                                       
         DROP  R2,R3                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT UNIT ACUTAL DEMOS                                                     
***********************************************************************         
NTTUAD   NMOD1 WORKL,*NTTUAD*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTADLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AUNITREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         USING UINFOD,R8                                                        
                                                                                
         MVC   UUNTKEY,UIUNTKEY     UNIT KEY                                    
         MVC   SVCOFF,UICLOFF       CLIENT OFFICE                               
         MVC   SVCPROF,UICLPROF     CLIENT PROFILE                              
         MVC   VUNDAY,UIUNDAY       A(UNDAY)                                    
         MVC   VTRPACK,UITRPACK     A(TRPACK)                                   
         MVC   VDEMCON,UIDEMCON     A(DEMCON)                                   
         MVC   VDEFINE,UIDEFINE     A(DEFINE)                                   
         MVC   ACLTREC,UICLTREC     A(CLIENT RECORD)                            
         MVC   AESTREC,UIESTREC     A(ESTIMATE RECORD)                          
         MVC   UDPTA,UIDPTA         ALPHA DAYPART                               
         MVC   UN0PROF,UIN0PROF     N0 PROFILE                                  
         MVC   UN2PROF,UIN2PROF     N2 PROFILE                                  
         MVC   UN1PROF,UIN1PROF     N1 PROFILE                                  
         MVC   SVNTI,UINTISTA       NTI STATION                                 
         MVC   AGYFLG2,UIAGYFL2     AGENCY FLAG                                 
         MVC   ANETBLRD,UINTBLRD                                                
         DROP  R8                                                               
                                                                                
         BRAS  RE,ADEMS            GET A(DEMO MODULES)                          
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDUAD              BUILD THE UNIT TABLES                        
         J     UADOUT              OUTPUT UNIT RECORD                           
                                                                                
NTTADLIT DC    A(LITERAL)                                                       
NTXUADC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
         LTORG                                                                  
                                                                                
UADOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
UADOUTX  J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD TABLES FROM UNIT RECORD                                                 
***********************************************************************         
BLDUAD   L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
         MVC   DATADISP,=H'27'     UNIT FILE                                    
                                                                                
         L     R2,NTXUADC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         XC    SVNCODE,SVNCODE                                                  
         XC    SVNRES,SVNRES                                                    
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
*        EDIT  (2,NUNTI),DUB,ALIGN=RIGHT,FILL=0,MINUS=NO   NTI CODE             
         ZICM  RE,NUNTI,2                                                       
         EDIT  (RE),DUB,ALIGN=RIGHT,FILL=0      NTI CODE                        
         MVC   SVNCODE,DUB+3       SAVE NTI CODE                                
         DROP  R3                                                               
                                                                                
         L     R5,AESTREC          BUILD DEMO LIST                              
         USING ESTHDR,R5                                                        
                                                                                
         XC    DEMOLIST,DEMOLIST                                                
         MVC   DEMOLIST(60),EDEMLST                                             
         MVC   DEMOLIST+60(60),EDEMLST1                                         
         MVC   DEMOLIST+120(60),EDEMLST2                                        
                                                                                
         OC    EDEM21,EDEM21                                                    
         BZ    *+10                                                             
         MVC   DEMOLIST+60(60),EDEM21                                           
         DROP  R5                                                               
                                                                                
         BRAS  RE,GETAVAL          GET ACTUAL DEMOS                             
         BRAS  RE,BLDEDL           BUILD TABLE OF DEMOS                         
                                                                                
         MVI   NUMDEMOS,0                                                       
BLDUAD05 L     RF,ACURDEMO                                                      
         CLI   0(RF),X'FF'         FINISHED ALL DEMOS?                          
         BE    BLDUAD10                                                         
         CLI   2(RF),0             COMSCORE?                                    
         JE    BLDUAD07                                                         
                                                                                
         BRAS  RE,UNITADL          BUILD UNIT ACTUAL DEMO RECORD                
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDUAD07 ZIC   RF,NUMDEMOS         KEEP COUNT OF DEMO CATEGORIES                
         LA    RF,1(RF)                                                         
         STC   RF,NUMDEMOS                                                      
         B     BLDUAD05                                                         
                                                                                
BLDUAD10 CLI   SVNRES,0            ANY ACTUAL RESULT CODE?                      
         BNE   BLDUAD15                                                         
                                                                                
         CLI   UN2PROF+5,C'Y'                                                   
         BE    BLDUAD15                                                         
         CLI   UN2PROF+5,C'N'                                                   
         BE    BLDUAD15                                                         
         CLI   UN2PROF+5,X'40'                                                  
         BNH   BLDUAD15                                                         
         MVC   SVNRES,SVUSER2+5                                                 
         OI    SVNRFLG,SVNRPROF    CAME FROM PROFILE                            
                                                                                
BLDUAD15 CLC   SVNCODE,=C'00000'                                                
         BNE   *+12                                                             
         CLI   SVNRES,0                                                         
         BE    BLDUADX                                                          
                                                                                
         BRAS  RE,UNITNTI          BUILD UNIT NTI TABLE                         
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDUADX  L     R2,NTXUADC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* EXTRACT UNIT RECORD                                                           
***********************************************************************         
NTTUNI   NMOD1 WORKL,*NTTUNI*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTUNLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AUNITREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         USING UINFOD,R8                                                        
                                                                                
         MVC   UUNTKEY,UIUNTKEY     UNIT KEY                                    
         MVC   SVCOFF,UICLOFF       CLIENT OFFICE                               
         MVC   SVCPROF,UICLPROF     CLIENT PROFILE                              
         MVC   VUNDAY,UIUNDAY       A(UNDAY)                                    
         MVC   VTRPACK,UITRPACK     A(TRPACK)                                   
         MVC   VDEMCON,UIDEMCON     A(DEMCON)                                   
         MVC   VDEFINE,UIDEFINE     A(DEFINE)                                   
         MVC   ACLTREC,UICLTREC     A(CLIENT RECORD)                            
         MVC   AESTREC,UIESTREC     A(ESTIMATE RECORD)                          
         MVC   UDPTA,UIDPTA         ALPHA DAYPART                               
         MVC   UN0PROF,UIN0PROF     N0 PROFILE                                  
         MVC   UN2PROF,UIN2PROF     N2 PROFILE                                  
         MVC   UN1PROF,UIN1PROF     N1 PROFILE                                  
         MVC   SVNTI,UINTISTA       NTI STATION                                 
         MVC   AGYFLG2,UIAGYFL2     AGENCY FLAG                                 
         MVC   ANETBLRD,UINTBLRD                                                
         DROP  R8                                                               
                                                                                
         USING DXBLOCKD,R7                                                      
         MVC   MODE,DXMODE         GET THE DXMODE                               
         DROP  R7                                                               
                                                                                
         BRAS  RE,ADEMS            GET A(DEMO MODULES)                          
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDUNIT             BUILD THE UNIT TABLES                        
         J     UNITOUT             OUTPUT UNIT RECORD                           
                                                                                
NTTUNLIT DC    A(LITERAL)                                                       
NTXUNITC DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
         LTORG                                                                  
***********************************************************************         
* BUILD TABLES FROM UNIT RECORD                                                 
***********************************************************************         
BLDUNIT  L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
         MVC   DATADISP,=H'27'     UNIT FILE                                    
                                                                                
         L     R2,NTXUNITC         A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         XC    SVNCODE,SVNCODE                                                  
         XC    SVNRES,SVNRES                                                    
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         L     R5,ACLTREC          GET ADDRESS OF PRODUCT LIST                  
         USING CLTHDR,R5                                                        
         LA    R5,CLIST                                                         
         ST    R5,APLIST                                                        
         L     R5,ACLTREC                                                       
         LA    R5,CLIST2                                                        
         ST    R5,APLIST2                                                       
         DROP  R5                                                               
                                                                                
         BRAS  RE,UNIT             BUILD UNIT TABLE                             
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         BRAS  RE,BLDPRDT          BUILD PRODUCT TABLE                          
                                                                                
         L     RF,ACURPRD          CURRENT PRODUCT TO START WITH                
         MVI   PRDPOS,X'01'        DEFAULT TO POSITION 1                        
                                                                                
         CLC   0(2,RF),=XL2'FFFF'  UNALLOCATED UNIT?                            
         BNE   BLDU60              NO                                           
                                                                                
         MVI   0(RF),X'FF'         DENOTE POL                                   
         MVC   1(3,RF),=C'POL'                                                  
         MVC   4(2,RF),=XL2'2710'                                               
         MVC   10(2,RF),=XL2'FFFF'                                              
                                                                                
BLDU60   L     RF,ACURPRD                                                       
         CLC   0(2,RF),=XL2'FFFF'  FINISHED ALL PRODUCTS?                       
         BE    BLDU70                                                           
                                                                                
         BRAS  RE,UNITPAL          BUILD UNIT PRODUCT ALLOCATION                
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         ZIC   RF,PRDPOS           BUMP UP PRODUCT POSITION #                   
         AHI   RF,1                                                             
         STC   RF,PRDPOS                                                        
         B     BLDU60                                                           
                                                                                
BLDU70   LR    R6,R3                                                            
         MVI   ELCODE,X'12'        IF NO PAY ELEMENTS, NO ENTRY                 
         BAS   RE,GETEL                                                         
         BNE   BLDU75                                                           
                                                                                
         BRAS  RE,UNITPAY          BUILD UNIT PAID SUMMARY TABLE                
                                                                                
         L     R2,ANEXT                                                         
         L     R5,ADXAXREC                                                      
         USING NTTUPD,R5                                                        
                                                                                
         MVC   0(NTTUPDL,R2),0(R5) PUT ENTRY INTO BUFFER                        
                                                                                
         LA    R2,NTTUPDL(R2)      POINT TO NEXT BUFFER SLOT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT                                                         
         DROP  R5                                                               
                                                                                
BLDU75   LR    R6,R3                                                            
         MVI   ELCODE,X'03'        IF NO SPCIAL CHARGES, NO ENTRY               
         BAS   RE,GETEL                                                         
         BNE   BLDU76                                                           
                                                                                
         BRAS  RE,UNITSPC          BUILD UNIT SECIAL CHARGES                    
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDU76   CLI   SXDTVER,5           MUST BE VERSION 5 OR HIGHER                  
         JL    BLDU78                                                           
                                                                                
         BRAS  RE,UNITBRTR         BUILD UNIT BARTER CREDITS                    
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDU78   BRAS  RE,BLDPRDT          BUILD PRODUCT TABLE                          
         L     RF,ACURPRD          CURRENT PRODUCT TO START WITH                
         MVI   PRDPOS,X'01'        DEFAULT TO POSITION 1                        
                                                                                
         CLC   0(2,RF),=XL2'FFFF'  UNALLOCATED UNIT?                            
         BNE   BLDU80              NO                                           
                                                                                
         MVI   0(RF),X'FF'         DENOTE POL                                   
         MVC   1(3,RF),=C'POL'                                                  
         MVC   4(2,RF),=XL2'2710'                                               
         MVC   10(2,RF),=XL2'FFFF'                                              
                                                                                
BLDU80   L     RF,ACURPRD                                                       
         CLC   0(2,RF),=XL2'FFFF'  FINISHED ALL PRODUCTS?                       
         BE    BLDU100                                                          
                                                                                
         BRAS  RE,UNITSUM          BUILD UNIT SUMMARY TABLE                     
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         ZIC   RF,PRDPOS           BUMP UP PRODUCT POSITION #                   
         AHI   RF,1                                                             
         STC   RF,PRDPOS                                                        
         B     BLDU80                                                           
                                                                                
BLDU100  L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R5,AESTREC          GET ADDRESS OF DEMOS LIST                    
         USING ESTHDR,R5                                                        
                                                                                
         XC    DEMOLIST,DEMOLIST                                                
         MVC   DEMOLIST(60),EDEMLST                                             
         MVC   DEMOLIST+60(60),EDEMLST1                                         
         MVC   DEMOLIST+120(60),EDEMLST2                                        
                                                                                
         OC    EDEM21,EDEM21                                                    
         BZ    *+10                                                             
         MVC   DEMOLIST+60(60),EDEM21                                           
         DROP  R5                                                               
                                                                                
         BRAS  RE,GETEVAL          GET ESTIMATED DEMOS                          
         BRAS  RE,BLDEDL           BUILD TABLE OF DEMOS                         
                                                                                
         MVI   NUMDEMOS,0                                                       
BLDU120  L     RF,ACURDEMO                                                      
         CLI   0(RF),X'FF'         FINISHED ALL DEMOS?                          
         BE    BLDU140                                                          
         CLI   2(RF),0             COMSCORE?                                    
         JE    BLDU125                                                          
                                                                                
         BRAS  RE,UNITEDL          BUILD UNIT ESTIMATE DEMO                     
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDU125  ZIC   RF,NUMDEMOS                                                      
         LA    RF,1(RF)                                                         
         STC   RF,NUMDEMOS                                                      
         B     BLDU120                                                          
                                                                                
BLDU140  CLI   MODE,DXUPDTQ        CHECK UPDATE MODE ?                          
         JNE   BLDUNITX            NO ACTUAL DEMOS IF NOT UPDATE MODE           
                                                                                
         L     R5,AESTREC          BUILD DEMO LIST                              
         USING ESTHDR,R5                                                        
                                                                                
         XC    DEMOLIST,DEMOLIST                                                
         MVC   DEMOLIST(60),EDEMLST                                             
         MVC   DEMOLIST+60(60),EDEMLST1                                         
         MVC   DEMOLIST+120(60),EDEMLST2                                        
                                                                                
         OC    EDEM21,EDEM21                                                    
         BZ    *+10                                                             
         MVC   DEMOLIST+60(60),EDEM21                                           
         DROP  R5                                                               
                                                                                
         BRAS  RE,GETAVAL          GET ACTUAL DEMOS                             
         BRAS  RE,BLDEDL           BUILD TABLE OF DEMOS                         
                                                                                
         MVI   NUMDEMOS,0                                                       
BLDU160  L     RF,ACURDEMO                                                      
         CLI   0(RF),X'FF'         FINISHED ALL DEMOS?                          
         BE    BLDUNITX                                                         
         CLI   2(RF),0             COMSCORE                                     
         JE    BLDU165                                                          
                                                                                
         BRAS  RE,UNITADL          BUILD UNIT ACTUAL DEMO RECORD                
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDU165  ZIC   RF,NUMDEMOS         KEEP COUNT OF DEMO CATEGORIES                
         LA    RF,1(RF)                                                         
         STC   RF,NUMDEMOS                                                      
         B     BLDU160                                                          
                                                                                
BLDUNITX L     R2,NTXUNITC         A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD TABLE OF UNIT PRODUCTS                                                  
***********************************************************************         
BLDPRDT  NTR1  BASE=*,LABEL=*                                                   
         L     RE,ABIGWORK                                                      
         LA    RE,200(RE)                                                       
         LA    RF,1000                                                          
         XCEF                                                                   
                                                                                
         L     R5,ABIGWORK                                                      
         LA    R5,200(R5)                                                       
         MVC   0(2,R5),=XL2'FFFF'                                               
         ST    R5,ACURPRD          SET FIRST ENTRY AS DEFAULT                   
                                                                                
         XC    UFRSTPRD,UFRSTPRD                                                
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'01'                                                     
         BAS   RE,GETEL                                                         
         BNE   BLDPRDTX                                                         
         USING NUMAINEL,R6                                                      
                                                                                
         CLI   NUPRD,X'FF'         POL                                          
         BE    BLDPRDTX                                                         
                                                                                
         CLI   NUPRD,0                                                          
         BE    BPRDT15                CHECK X'14' ELEMENTS                      
                                                                                
         MVC   0(1,R5),NUPRD          1ST PRODUCT                               
                                                                                
         MVC   BYTE,NUPRD                                                       
         BRAS  RE,GETAPRD                                                       
         MVC   1(3,R5),FULL           MOVE IN ALPHA PRODUCT INTO TABLE          
         MVC   UFRSTPRD,FULL          SAVE AROUND UNIT'S 1ST PRODUCT            
                                                                                
         MVC   4(2,R5),NUP1SHR        1ST PRODUCT %                             
         OC    NUP1SHR,NUP1SHR                                                  
         BNZ   *+10                                                             
         MVC   4(2,R5),=X'2710'       DEFAULT PRD % TO 100%                     
                                                                                
         MVC   6(2,R5),NUFEED         1ST PRODUCT FEED %                        
         MVC   10(2,R5),=XL2'FFFF'    DENOTE END OF TABLE                       
                                                                                
         CLI   NUPRD2,0                                                         
         BE    BLDPRDTX                                                         
         MVC   10(1,R5),NUPRD2        2ND PRODUCT                               
                                                                                
         MVC   BYTE,NUPRD2                                                      
         BRAS  RE,GETAPRD                                                       
         MVC   11(3,R5),FULL          MOVE IN ALPHA PRODUCT INTO TABLE          
                                                                                
         OC    NUP1SHR,NUP1SHR     IF 1ST PROD IS 0%, THEN 2ND                  
         BNZ   BPRDT05             PRODUCT IS 100%                              
         MVC   4(2,R5),=X'1388'    SPLIT PRD% 50/50                             
         MVC   14(2,R5),=X'1388'                                                
         B     BPRDT10                                                          
                                                                                
BPRDT05  LH    RF,=H'10000'                                                     
         ICM   RE,3,NUP1SHR                                                     
         SR    RF,RE                                                            
         STCM  RF,3,14(R5)         GET 2ND PRODUCT  %                           
                                                                                
         OC    NUFEED,NUFEED       IF 1ST PRD FEED % IS ZERO                    
         BZ    BPRDT10             THEN 2ND PRD FEED % IS ZERO ALSO             
         LH    RF,=H'10000'                                                     
         ICM   RE,3,NUFEED                                                      
         SR    RF,RE                                                            
         STCM  RF,3,16(R5)             GET 2ND FEED  %                          
                                                                                
BPRDT10  MVC   20(2,R5),=XL2'FFFF'       DENOTE END OF TABLE                    
         B     BLDPRDTX                                                         
                                                                                
BPRDT15  L     R6,AUNITREC                                                      
         MVI   ELCODE,X'19'                                                     
         BAS   RE,GETEL                                                         
         BNE   BPRDT30                                                          
                                                                                
         SR    RE,RE                                                            
         ZIC   RF,1(R6)            ELEMENT LENGTH                               
         SH    RF,=H'3'                                                         
         D     RE,=F'7'                                                         
         LR    R3,RF                                                            
         STC   R3,BYTE             # OF PRODUCTS                                
                                                                                
         LA    R6,3(R6)            1ST PRODUCT                                  
BPRDT20  MVI   0(R5),0                                                          
         MVC   1(3,R5),0(R6)       PRODUCT ALPHA                                
         MVC   4(2,R5),3(R6)       PRODUCT %                                    
         MVC   6(2,R5),5(R6)       FEED %                                       
                                                                                
         OC    UFRSTPRD,UFRSTPRD                                                
         BNZ   *+10                                                             
         MVC   UFRSTPRD,0(R6)      SAVE AROUND UNIT'S 1ST PRODUCT               
                                                                                
         CLI   BYTE,X'01'          1 PRODUCT?                                   
         BH    BPRDT25                                                          
         OC    3(2,R6),3(R6)       ANY PRODUCT %?                               
         BNZ   *+10                                                             
         MVC   4(2,R5),=X'2710'    DEFAULT PRD % TO 100%                        
                                                                                
BPRDT25  LA    R5,10(R5)                                                        
         LA    R6,7(R6)                                                         
         BCT   R3,BPRDT20                                                       
                                                                                
         MVC   0(2,R5),=XL2'FFFF'    DENOTE END OF TABLE                        
         B     BLDPRDTX                                                         
                                                                                
BPRDT30  L     R6,AUNITREC                                                      
         MVI   ELCODE,X'14'                                                     
         BAS   RE,GETEL                                                         
         BNE   BLDPRDTX                                                         
                                                                                
         SR    RE,RE                                                            
         ZIC   RF,1(R6)            ELEMENT LENGTH                               
         SH    RF,=H'3'                                                         
         D     RE,=F'6'                                                         
         LR    R3,RF                                                            
         STC   R3,BYTE             # OF PRODUCTS                                
                                                                                
         LA    R6,3(R6)            1ST PRODUCT                                  
BPRDT35  MVC   0(1,R5),0(R6)       PRODUCT CODE                                 
                                                                                
         MVC   BYTE,0(R6)                                                       
         BRAS  RE,GETAPRD                                                       
         MVC   1(3,R5),FULL        MOVE IN ALPHA PRODUCT INTO TABLE             
                                                                                
         OC    UFRSTPRD,UFRSTPRD                                                
         BNZ   *+10                                                             
         MVC   UFRSTPRD,FULL       SAVE AROUND UNIT'S 1ST PRODUCT               
                                                                                
         MVC   4(2,R5),2(R6)       PRODUCT %                                    
         MVC   6(2,R5),4(R6)       FEED %                                       
                                                                                
         LA    R5,10(R5)                                                        
         LA    R6,6(R6)                                                         
         BCT   R3,BPRDT35                                                       
                                                                                
         MVC   0(2,R5),=XL2'FFFF'    DENOTE END OF TABLE                        
                                                                                
BLDPRDTX J     EXIT                                                             
         DROP  R6                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* INITIALIZE DXAXREC FOR TABLE ENTRY                                            
***********************************************************************         
INITREC  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
                                                                                
         L     R3,ADXAXREC                                                      
         USING NTTUPD,R3                                                        
                                                                                
         MVC   NTTUPLEN,SVLEN                                                   
         MVC   NTTUPTYP,SVTYP                                                   
         MVC   NTTUPACT,SVACT                                                   
         MVC   NTTUPDAT,SVDAT                                                   
         MVC   NTTUPTME,SVTME                                                   
                                                                                
         MVI   NTTUPACT-1,MXTRTQ                                                
         MVI   NTTUPDAT-1,MXTRTQ                                                
         MVI   NTTUPTME-1,MXTRTQ                                                
                                                                                
INITRECX J     EXIT                                                             
         DROP  R3                                                               
         LTORG                                                                  
***********************************************************************         
* BUILD UNIT NTI                                                                
***********************************************************************         
UNITNTI  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNTLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUTD,R2                                                        
         LA    R1,NTTUTDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUTD,R2                                                        
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
         MVC   DATADISP,=H'27'                                                  
                                                                                
         XC    NTTUTLEN,NTTUTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTUTLEN(2),=AL2(NTTUTDL)                                        
         MVC   NTTUTTYP,NTUTQ                                                   
         MVC   NTTUTAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUTUID(L'NUKEY-2),2(R3)                                        
                                                                                
         MVC   NTTUTCOD,SVNCODE    NTI CODE                                     
         MVC   NTTUTRES(1),SVNRES  NTI RESULT CODE                              
                                                                                
         MVI   NTTUTRFR,C'A'       DEFAULT TO CAME FROM ACTUAL                  
         TM    SVNRFLG,SVNRPROF    CAME FROM PROFILE?                           
         BZ    *+8                                                              
         MVI   NTTUTRFR,C'P'       CAME FROM PROFILE                            
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'DE'                                                     
         BAS   RE,GETEL                                                         
         BNE   *+8                                                              
         MVI   NTTUTRES+1,C'M'                                                  
                                                                                
         MVI   NTTUTAGY-1,MXTRTQ                                                
         MVI   NTTUTUID-1,MXTRTQ                                                
         MVI   NTTUTCOD-1,MXTRTQ                                                
         MVI   NTTUTRES-1,MXTRTQ                                                
         MVI   NTTUTRFR-1,MXTRTQ                                                
         MVI   NTTUTDX,MXTRTQ                                                   
         MVI   NTTUTDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTUTAGY,MXTRT                                                   
         TR    NTTUTCOD,MXTRT                                                   
         TR    NTTUTRES,MXTRT                                                   
         TR    NTTUTRFR,MXTRT                                                   
                                                                                
UNITNTIX J     EXIT                                                             
UNTLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD UNIT PRODUCT ALLOCATION                                                 
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
UNITPAL  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNALIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD UNIT TABLE ENTRY                       
         USING NTTUPDD,R2                                                       
         LA    R1,NTTUPDDL                                                      
         BRAS  RE,INITREC                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD UNIT TABLE ENTRY                       
         USING NTTUPDD,R2                                                       
         L     R3,AUNITREC         UNIT RECORD                                  
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
*                                                                               
         MVC   DATADISP,=H'27'                                                  
*                                                                               
         XC    NTTUPDLE,NTTUPDLE   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTUPDLE(2),=AL2(NTTUPDDL)                                       
         MVC   NTTUPDTY,NTUAQ                                                   
*                                                                               
         MVI   NTTUPDAG-1,MXTRTQ                                                
         MVI   NTTUPDID-1,MXTRTQ                                                
         MVI   NTTUPPOS-1,MXTRTQ                                                
         MVI   NTTUPDPR-1,MXTRTQ                                                
         MVI   NTTUPDAL-1,MXTRTQ                                                
         MVI   NTTUPFED-1,MXTRTQ                                                
         MVI   NTTUPISR-1,MXTRTQ                                                
         MVI   NTTUPDDX,MXTRTQ                                                  
         MVI   NTTUPDDX+1,MXTRTQ                                                
*                                                                               
         MVC   NTTUPDAG,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUPDID(L'NUKEY-2),2(R3)                                        
*                                                                               
         EDIT  PRDPOS,NTTUPPOS,FILL=0        PRODUCT POSITION                   
*                                                                               
         BRAS  RE,GETPROD          GET PRODUCT                                  
         L     R5,FULL                                                          
*                                                                               
         MVC   NTTUPDPR,=C'POL'                                                 
         CLI   BYTE,X'FF'          UNALLOCATED UNIT?                            
         BE    *+10                                                             
         MVC   NTTUPDPR,1(R5)                                                   
*                                                                               
UNPA10   XC    HALF,HALF                                                        
         CLI   0(R5),X'FF'         UNALLOCATED PRODUCT?                         
         BE    *+10                                                             
         MVC   HALF,4(R5)          PRODUCT %                                    
*                                                                               
         EDIT  HALF,NTTUPDAL,2,ALIGN=RIGHT                                      
*                                                                               
         XC    HALF,HALF                                                        
         CLI   0(R5),X'FF'         UNALLOCATED PRODUCT?                         
         BE    *+10                                                             
         MVC   HALF,6(R5)          FEED %                                       
*                                                                               
         EDIT  HALF,NTTUPFED,2,ALIGN=RIGHT                                      
*                                                                               
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'02'        SECONDARY ELEMENT                            
         BAS   RE,GETEL                                                         
         BNE   UNPA50                                                           
         USING NUSDRD,R6                                                        
*                                                                               
         MVI   NTTUPISR,C'N'                                                    
         TM    NUSDST3,X'01'       FEED % EFFECTS RATINGS?                      
         BZ    *+8                                                              
         MVI   NTTUPISR,C'Y'                                                    
         DROP  R6                                                               
*                                                                               
UNPA50   MVI   9(R5),C'X'          FINISHED PROCESSING THIS PRODUCT             
         LA    R5,10(R5)                                                        
         ST    R5,ACURPRD                                                       
*                                                                               
         TR    NTTUPDAG,MXTRT                                                   
         TR    NTTUPPOS,MXTRT                                                   
         TR    NTTUPDPR,MXTRT                                                   
         TR    NTTUPDAL,MXTRT                                                   
         TR    NTTUPFED,MXTRT                                                   
         TR    NTTUPISR,MXTRT                                                   
*                                                                               
UNITPALX J     EXIT                                                             
*                                                                               
UNALIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD UNIT SUMMARY TABLE                                                      
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
UNITSUM  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNSLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD UNIT TABLE ENTRY                       
         USING NTTUSD,R2                                                        
         LA    R1,NTTUSDL                                                       
         BRAS  RE,INITREC                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD UNIT TABLE ENTRY                       
         USING NTTUSD,R2                                                        
         L     R3,AUNITREC         UNIT RECORD                                  
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
*                                                                               
         MVC   DATADISP,=H'27'                                                  
*                                                                               
         XC    NTTUSLEN,NTTUSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTUSLEN(2),=AL2(NTTUSDL)                                        
         MVC   NTTUSTYP,NTUSQ                                                   
*                                                                               
         MVI   NTTUSAGY-1,MXTRTQ                                                
         MVI   NTTUSUID-1,MXTRTQ                                                
         MVI   NTTUSPRD-1,MXTRTQ                                                
         MVI   NTTUSPOS-1,MXTRTQ                                                
         MVI   NTTUSSCC-1,MXTRTQ                                                
         MVI   NTTUSACC-1,MXTRTQ                                                
         MVI   NTTUSANM-1,MXTRTQ                                                
         MVI   NTTUSSEC-1,MXTRTQ                                                
         MVI   NTTUSPCT-1,MXTRTQ                                                
         MVI   NTTUSASS-1,MXTRTQ                                                
         MVI   NTTUSACT-1,MXTRTQ                                                
         MVI   NTTUSINT-1,MXTRTQ                                                
         MVI   NTTUSMAX-1,MXTRTQ                                                
         MVI   NTTUSEAR-1,MXTRTQ                                                
         MVI   NTTUSAIC-1,MXTRTQ                                                
         MVI   NTTUSSNM-1,MXTRTQ                                                
         MVI   NTTUSAN2-1,MXTRTQ                                                
         MVI   NTTUSAN3-1,MXTRTQ                                                
         MVI   NTTUSSN2-1,MXTRTQ                                                
         MVI   NTTUSSN3-1,MXTRTQ                                                
         MVI   NTTUSCO1-1,MXTRTQ                                                
         MVI   NTTUSCO2-1,MXTRTQ                                                
         MVI   NTTUSBLG-1,MXTRTQ                                                
         MVI   NTTUSBLN-1,MXTRTQ                                                
         MVI   NTTUSNET-1,MXTRTQ                                                
         MVI   NTTUSFLT-1,MXTRTQ                                                
         MVI   NTTUSDX,MXTRTQ                                                   
         MVI   NTTUSDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTTUSAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUSUID(L'NUKEY-2),2(R3)                                        
*                                                                               
         XC    FULL,FULL           INITIALIZE TO 0                              
         EDIT  FULL,NTTUSBLG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         EDIT  FULL,NTTUSBLN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
*                                                                               
         EDIT  PRDPOS,NTTUSPOS,FILL=0        PRODUCT POSITION                   
*                                                                               
         BRAS  RE,GETPROD          GET PRODUCT                                  
         L     R5,FULL                                                          
*                                                                               
         MVC   NTTUSPRD,=C'POL'                                                 
         CLI   BYTE,X'FF'          UNALLOCATED PRODUCT?                         
         BE    *+10                                                             
         MVC   NTTUSPRD,1(R5)                                                   
*                                                                               
UNS10    XC    HALF,HALF                                                        
         CLI   0(R5),X'FF'         UNALLOCATED PRODUCT?                         
         BE    *+10                                                             
         MVC   HALF,4(R5)          PRODUCT %                                    
*                                                                               
         EDIT  HALF,NTTUSPCT,2,ALIGN=RIGHT                                      
*                                                                               
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'01'        AGENCY ELEMENT                               
         BAS   RE,GETEL                                                         
         BNE   UNS20                                                            
         USING NUMAINEL,R6                                                      
*                                                                               
         EDIT  NULEN,NTTUSSEC,FILL=0      SECONDS                               
*                                                                               
         MVC   NTTUSASS(4),=C'NULL'                                             
         OC    NUASSIGN,NUASSIGN   ASSIGNED COST                                
         BNZ   *+12                                                             
         TM    NUUNITST,NUUNIGCI   ASSIGNED COST INPUT?                         
         JZ    UNS15                                                            
         MVC   HALF,4(R5)          PRD %                                        
         MVC   FULL,NUASSIGN                                                    
         BRAS  RE,GETCST                                                        
         EDIT  (P8,DUB),NTTUSASS,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
*                                                                               
UNS15    MVC   HALF,4(R5)          PRD %                                        
         MVC   FULL,NUACTUAL                                                    
         MVC   CHAR8(4),NUACTUAL   SAVE AWAY FOR AIC COST                       
         BRAS  RE,GETCST                                                        
         EDIT  (P8,DUB),NTTUSACS,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
*                                                                               
         MVC   HALF,4(R5)          PRD %                                        
         MVC   FULL,NUINTEG                                                     
         BRAS  RE,GETCST                                                        
         EDIT  (P8,DUB),NTTUSINT,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
         DROP  R6                                                               
*                                                                               
UNS20    XC    FULL,FULL           INITIALIZE TO 0                              
         EDIT  FULL,NTTUSMAX,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUSAIC,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUSEAR,2,ALIGN=RIGHT,ZERO=NOBLANK                         
*                                                                               
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'15'        MAX COST ELEMENT                             
         BAS   RE,GETEL                                                         
         BNE   UNS30                                                            
         USING NUMCSTD,R6                                                       
*                                                                               
         MVC   HALF,4(R5)          PRD %                                        
         MVC   FULL,NUMCSMCS       MAX COST                                     
         BRAS  RE,GETCST                                                        
         EDIT  (P8,DUB),NTTUSMAX,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
*                                                                               
         MVC   HALF,4(R5)          PRD %                                        
         MVC   FULL,NUMCSMCS       MAX COST                                     
         BRAS  RE,GETAIC           GET AIC COST                                 
         EDIT  (P8,DUB),NTTUSAIC,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
*                                                                               
         MVC   HALF,4(R5)          PRD %                                        
         MVC   FULL,NUMCEIC        EARNED COST                                  
         BRAS  RE,GETCST                                                        
         EDIT  (P8,DUB),NTTUSEAR,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
         DROP  R6                                                               
*                                                                               
UNS30    CLI   0(R5),X'FF'         UNALLOCATED UNIT?                            
         BE    UNS80                                                            
*                                                                               
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'21'        NETWORK COMMERCIAL ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   UNS40                                                            
         USING NUCMLEL,R6                                                       
*                                                                               
         MVC   NTTUSSCC_P,NUCML1   COMML CODE OR PACKED AD-ID                   
*                                                                               
         XC    NTTUSSCC,NTTUSSCC                                                
         MVC   NTTUSSCC(8),NUCML1     SCHEDULE COMMERCIAL CODE                  
*                                                                               
         TM    NUCMADFL,NUCMADF1   AD-ID?                                       
         BZ    UNS40                                                            
         GOTO1 VTRPACK,DMCB,(C'U',NUCML1),WORK                                  
         BNE   UNS40                                                            
         MVC   NTTUSSCC,WORK                                                    
         DROP  R6                                                               
*                                                                               
UNS40    L     R6,AUNITREC                                                      
         MVI   ELCODE,X'24'        NETWORK PAY COMMERCIAL                       
         BAS   RE,GETEL                                                         
         BNE   UNS50                                                            
         USING NUPCELD,R6                                                       
*                                                                               
         CLC   NUPCCML,SPACES      SKIP BAD X'24' ELEMS                         
         BNE   *+12                                                             
         BAS   RE,NEXTEL                                                        
         BNE   UNS50                                                            
*                                                                               
         MVC   NTTUSACC_P,NUPCCML  ACTUAL COMMERCIAL CODE OR AD-ID              
*                                                                               
         XC    NTTUSACC,NTTUSACC                                                
         MVC   NTTUSACC(8),NUPCCML    ACTUAL COMMERCIAL CODE                    
*                                                                               
         TM    NUPCMLFL,NUPCADF1   AD-ID?                                       
         BZ    UNS50                                                            
         GOTO1 VTRPACK,DMCB,(C'U',NUPCCML),WORK                                 
         BNE   UNS50                                                            
         MVC   NTTUSACC,WORK                                                    
         DROP  R6                                                               
*                                                                               
UNS50    CLC   NTTUSACC,SPACES                                                  
         BE    UNS55                                                            
*                                                                               
         XC    SPTKEY,SPTKEY       BUILD COMMERCIAL KEY AND GET NAME            
         LA    R6,SPTKEY                                                        
         USING CMLRECD,R6                                                       
*                                                                               
         MVC   CMLKEY(2),=X'0A21'                                               
         MVC   CMLKEY+2(1),NUKAM   AGY/MEDIA                                    
         MVC   CMLKEY+3(2),NUKCLT  CLIENT                                       
*        MVC   CMLKCML,NTTUSACC    COMMERCIAL CODE                              
         MVC   CMLKCML,NTTUSACC_P  COMMERCIAL CODE OR PACKED AD-ID              
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
*                                                                               
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR ',SPTKEY,SPTKEY,WORK          
*        CLC   CMLKCML,NTTUSACC                                                 
         CLC   CMLKCML,NTTUSACC_P                                               
         BNE   UNS60               CHECK OTHER COMMERCIAL CODE                  
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL ',SPTKEY+14,MYIO,WORK         
*                                                                               
         LA    R6,MYIO             COMMERCIAL RECORD                            
         MVC   DATADISP,=H'24'                                                  
         MVI   ELCODE,X'30'        NETWORK PAY COMMERCIAL                       
         BAS   RE,GETEL                                                         
         BNE   UNS60                                                            
*                                                                               
         MVC   NTTUSANM,3(R6)      ACTUAL COMMERCIAL NAME                       
*                                                                               
         BAS   RE,NEXTEL                                                        
         BNE   UNS55                                                            
         MVC   NTTUSAN2,3(R6)      ACTUAL COMMERCIAL NAME 2                     
         BAS   RE,NEXTEL                                                        
         BNE   UNS55                                                            
         MVC   NTTUSAN3,3(R6)      ACTUAL COMMERCIAL NAME 2                     
         DROP  R6                                                               
*                                                                               
UNS55    CLC   NTTUSSCC,SPACES                                                  
         BE    UNS80                                                            
*                                                                               
         XC    SPTKEY,SPTKEY       BUILD COMMERCIAL KEY AND GET NAME            
         LA    R6,SPTKEY                                                        
         USING CMLRECD,R6                                                       
*                                                                               
         MVC   CMLKEY(2),=X'0A21'                                               
         MVC   CMLKEY+2(1),NUKAM   AGY/MEDIA                                    
         MVC   CMLKEY+3(2),NUKCLT  CLIENT                                       
*        MVC   CMLKCML,NTTUSSCC    COMMERCIAL CODE                              
         MVC   CMLKCML,NTTUSSCC_P  COMMERCIAL CODE OR PACKED AD-ID              
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
*                                                                               
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR ',SPTKEY,SPTKEY,WORK          
*        CLC   CMLKCML,NTTUSSCC                                                 
         CLC   CMLKCML,NTTUSSCC_P                                               
         BNE   UNS60                                                            
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL ',SPTKEY+14,MYIO,WORK         
*                                                                               
         LA    R6,MYIO             COMMERCIAL RECORD                            
         MVC   DATADISP,=H'24'                                                  
         MVI   ELCODE,X'30'        NETWORK PAY COMMERCIAL                       
         BAS   RE,GETEL                                                         
         BNE   UNS60                                                            
*                                                                               
         MVC   NTTUSSNM,3(R6)      SCHED COMMERCIAL NAME                        
*                                                                               
         BAS   RE,NEXTEL                                                        
         BNE   UNS60                                                            
         MVC   NTTUSSN2,3(R6)      SCHED COMMERCIAL NAME 2                      
         BAS   RE,NEXTEL                                                        
         BNE   UNS60                                                            
         MVC   NTTUSSN3,3(R6)      SCHED COMMERCIAL NAME 2                      
         DROP  R6                                                               
*                                                                               
UNS60    MVC   DATADISP,=H'27'     RESET TO UNIT FILE                           
*                                                                               
UNS80    MVI   9(R5),C'X'          FINISHED PROCESSING THIS PRODUCT             
         LA    R5,10(R5)                                                        
         ST    R5,ACURPRD          A(NEXT PRODUCT TABLE ENTRY)                  
*                                                                               
UNS90    L     R6,AUNITREC                                                      
         MVI   ELCODE,X'04'        BUY COMMENT ELEMENT                          
         BAS   RE,GETEL                                                         
         BNE   UNS100                                                           
         USING NUCOMD,R6                                                        
*                                                                               
         ZIC   R1,NUCOMLEN                                                      
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   NTTUSCO1(0),NUCOMMNT                                             
*                                                                               
         BAS   RE,NEXTEL                                                        
         BNE   UNS100                                                           
*                                                                               
         ZIC   R1,NUCOMLEN                                                      
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   NTTUSCO2(0),NUCOMMNT                                             
         DROP  R6                                                               
*                                                                               
UNS100   L     R6,AUNITREC                                                      
         LA    RE,MYIO                                                          
         LA    RF,2500                                                          
         XCEF                                                                   
*                                                                               
         LA    R5,MYIO             NETBLOCK                                     
         ST    R5,ANBLOCK                                                       
         USING NBLOCKD,R5                                                       
*                                                                               
         MVI   NBWHERE,C'I'                                                     
         MVC   NBSELAGY,SXDTAGY    ALPHA AGENCY                                 
*                                                                               
         L     RF,AUNITREC                                                      
         STCM  RF,15,NBAIO         A(UNIT)                                      
         L     RF,COMFACS                                                       
         L     RF,0(RF)                                                         
         STCM  RF,15,NBDM          A(DATAMGR)                                   
         L     RF,COMFACS                                                       
         L     RF,20(RF)                                                        
         STCM  RF,15,NBHELLO       A(HELLO)                                     
         L     RF,COMFACS                                                       
         L     RF,68(RF)                                                        
         STCM  RF,15,NBGTPROF     A(GETPROF)                                    
         LA    RF,WORK                                                          
         ST    RF,NBABILRD        A(BILL READER BLOCK)                          
*                                                                               
         XC    WORK,WORK                                                        
E        USING NBLBILLD,WORK                                                    
         MVC   E.NBLUNAIO,AUNITREC                                              
         MVC   E.NBLNTBLK,ANBLOCK                                               
         OI    E.NBLFUNC,NBLSEED                                                
         OI    E.NBLFUNC2,NBLWBFLT                                              
         DROP  E                                                                
*                                                                               
         GOTOR ANETBLRD,DMCB,NETBLOCK                                           
         DROP  R5                                                               
*                                                                               
         XC    FULL,FULL                                                        
         XC    FULL2,FULL2                                                      
*                                                                               
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'10'        BILLING ELEMENT                              
         BAS   RE,GETEL                                                         
         BNE   UNS110                                                           
         USING NUBILD,R6                                                        
*                                                                               
UNS105   TM    NUBILST,NUBILUBQ    UNBILLED?                                    
         JO    UNS109                                                           
         CLC   NTTUSPRD,=C'POL'                                                 
         BE    UNS107                                                           
         CLI   NUBILLEN,NUBILLN1                                                
         BNH   UNS107                                                           
         CLC   NUBILPRC,NTTUSPRD   SAME PRODUCT CODE?                           
         BNE   UNS109                                                           
*                                                                               
UNS107   ICM   RF,15,NUBILGRS      GROSS AMOUNT                                 
         L     RE,FULL                                                          
         AR    RE,RF                                                            
         ST    RE,FULL                                                          
*                                                                               
         ICM   RF,15,NUBILNET      NET AMOUNT                                   
         L     RE,FULL2                                                         
         AR    RE,RF                                                            
         ST    RE,FULL2                                                         
*                                                                               
         CLI   NUBILLEN,NUBILLN2                                                
         BNH   *+10                                                             
         MVC   NTTUSFLT,NUBILFLT   BILLED FLIGHT ID                             
*                                                                               
UNS109   BAS   RE,NEXTEL           GET NEXT BILLING ELEMENT                     
         BE    UNS105                                                           
*                                                                               
UNS110   EDIT  FULL,NTTUSBLG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         EDIT  FULL2,NTTUSBLN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                
         DROP  R6                                                               
*                                                                               
UNS120   GOTOR VNETNET,DMCB,NUACTUAL,FULL                                       
         EDIT  FULL2,NTTUSNET,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                
*                                                                               
UNS130   DS    0H                                                               
*                                                                               
NTTUS100 TR    NTTUSAGY,MXTRT                                                   
         TR    NTTUSPRD,MXTRT                                                   
         TR    NTTUSSCC,MXTRT                                                   
         TR    NTTUSACC,MXTRT                                                   
         TR    NTTUSANM,MXTRT                                                   
         TR    NTTUSSEC,MXTRT                                                   
         TR    NTTUSPCT,MXTRT                                                   
         TR    NTTUSASS,MXTRT                                                   
         TR    NTTUSACT,MXTRT                                                   
         TR    NTTUSINT,MXTRT                                                   
         TR    NTTUSMAX,MXTRT                                                   
         TR    NTTUSEAR,MXTRT                                                   
         TR    NTTUSAIC,MXTRT                                                   
         TR    NTTUSSNM,MXTRT                                                   
         TR    NTTUSAN2,MXTRT                                                   
         TR    NTTUSAN3,MXTRT                                                   
         TR    NTTUSSN2,MXTRT                                                   
         TR    NTTUSSN3,MXTRT                                                   
         TR    NTTUSCO1,MXTRT                                                   
         TR    NTTUSCO2,MXTRT                                                   
         TR    NTTUSBLG,MXTRT                                                   
         TR    NTTUSBLN,MXTRT                                                   
         TR    NTTUSNET,MXTRT                                                   
         TR    NTTUSFLT,MXTRT                                                   
*                                                                               
UNITSUMX J     EXIT                                                             
*                                                                               
UNSLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD UNIT TABLE                                                              
***********************************************************************         
UNIT     NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNILIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUND,R2                                                        
         LA    R1,NTTUNDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUND,R2                                                        
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
         MVC   DATADISP,=H'27'                                                  
                                                                                
         XC    NTTUNLEN,NTTUNLEN                                                
         MVC   NTTUNLEN(2),=AL2(NTTUNDL)                                        
         MVC   NTTUNTYP,NTUNQ                                                   
         MVC   NTTUNAGY,SXDTAGY    AGENCY                                       
         MVC   NTTUNUID(L'NUKEY-2),2(R3)                                        
                                                                                
         MVC   BYTE,NUKAM                                                       
         BRAS  RE,GETMED                                                        
         MVC   NTTUNMED,BYTE       MEDIA                                        
                                                                                
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(SVCPROF+6,NUKCLT),NTTUNCNT    CLIENT                  
         GOTO1 DATCON,DMCB,(2,NUKDATE),(10,NTTUNAIR)    AIR DATE                
                                                                                
         XC    WORK,WORK                                                        
         GOTO1 DATCON,DMCB,(2,NUKDATE),(0,WORK)                                 
         GOTO1 GETBROAD,DMCB,WORK,WORK+10,VGETDAY,VADDAY                        
                                                                                
         XC    DUB,DUB                                                          
         LA    R6,DUB                                                           
         LA    R7,5                                                             
         MVC   WORK(6),WORK+10                                                  
                                                                                
UNIT05   GOTO1 DATCON,DMCB,(0,WORK),(2,(R6))                                    
         GOTO1 VADDAY,DMCB,WORK,WORK+10,7                                       
         MVC   WORK(6),WORK+10                                                  
         AHI   R6,2                                                             
         BCT   R7,UNIT05                                                        
                                                                                
         LA    R6,DUB                                                           
         LA    R7,5                                                             
         MVC   HALF,0(R6)                                                       
UNIT10   CLC   0(2,R6),NUKDATE                                                  
         BH    UNIT15                                                           
                                                                                
         MVC   HALF,0(R6)                                                       
         AHI   R6,2                                                             
         BCT   R7,UNIT10                                                        
                                                                                
UNIT15   GOTO1 DATCON,DMCB,(2,HALF),(10,NTTUNBRD)    BROADCAST WEEK             
                                                                                
         EDIT  NUKTIME,NTTUNQTR,FILL=0       START QUARTE HOUR                  
         MVC   NTTUNSTA(4),NUKNET            NETWORK                            
         MVI   NTTUNSTA+4,C'N'                                                  
         MVC   NTTUNPGM,NUKPROG              PROGRAM NAME                       
         EDIT  NUKEST,NTTUNEST,FILL=0        ESTIMATE                           
         EDIT  NUKSUB,NTTUNSUB,FILL=0        SUB-LINE                           
         MVC   NTTUNDPT,UDPTA                DAYPART 2 CHAR ALPHA               
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'01'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT25                                                           
         USING NUMAINEL,R6                                                      
                                                                                
         MVI   NTTUNCPY,C'N'       INITIALIZE COPY SPLIT                        
         MVI   NTTUNPIG,C'N'       PIGGYBACK                                    
         MVI   NTTUNTRI,C'N'       AND TRIBACKS                                 
         EDIT  NUPACK,NTTUNPAK,FILL=0                  PACKAGE                  
*        EDIT  NUNTI,NTTUNNTI,ALIGN=RIGHT,FILL=0                                
         ZICM  RE,NUNTI,2                                                       
         EDIT  (RE),NTTUNNTI,ALIGN=RIGHT,FILL=0                                 
         MVC   SVNCODE,NTTUNNTI    SAVE NTI CODE                                
         EDIT  NUSREP,NTTUREP                          SREP                     
                                                                                
         CLI   NUPRD2,0            ANY 2ND PRODUCT?                             
         BE    *+8                                                              
         MVI   NTTUNPIG,C'Y'       DEFAULT TO PIGGYBACK                         
                                                                                
         LA    R5,NTTUNNSI                                                      
         OC    NUNSI,NUNSI                                                      
         BZ    UNIT20                                                           
                                                                                
         TM    NUNSI,X'80'                                                      
         BNO   *+12                                                             
         MVI   0(R5),C'T'          PUT OUT PREFIX OF 'T'                        
         LA    R5,1(R5)                                                         
                                                                                
         MVC   HALF,NUNSI                                                       
         NI    HALF,X'7F'                                                       
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(4,R5),DUB                                                      
                                                                                
UNIT20   DS    0H                                                               
         BCDAY NTTUNDAY,NUDAY      DAY                                          
                                                                                
         MVI   NTTUNIMU,C'N'       MINUS UNIT?                                  
         TM    NUUNITST,X'80'                                                   
         BZ    *+8                                                              
         MVI   NTTUNIMU,C'Y'                                                    
                                                                                
         MVI   NTTUNIPU,C'N'       PREEMPTED UNIT?                              
         TM    NUUNITST,X'40'                                                   
         BZ    *+8                                                              
         MVI   NTTUNIPU,C'Y'                                                    
                                                                                
         MVI   NTTUNIMS,C'N'       MISSED UNIT?                                 
         TM    NUUNITST,X'02'                                                   
         BZ    *+8                                                              
         MVI   NTTUNIMS,C'Y'                                                    
                                                                                
         MVI   NTTUNIMG,C'N'       MAKE GOOD?                                   
         TM    NUUNITST,X'01'                                                   
         BZ    *+8                                                              
         MVI   NTTUNIMG,C'Y'                                                    
                                                                                
         MVI   NTTUNPFB,C'N'       PFB?                                         
         TM    NUUNITST,X'04'                                                   
         BZ    *+8                                                              
         MVI   NTTUNPFB,C'Y'                                                    
                                                                                
         MVC   NTTUNPGN,NUPROGNM   PROGRAM NAME                                 
         EDIT  NULEN,NTTUNSEC,FILL=0        LENGTH IN SECONDS                   
                                                                                
         MVC   HALF,NUTIME                                                      
         BRAS  RE,CONVTIME                                                      
         MVC   NTTUNSTT,CHARTIME                                                
                                                                                
         MVC   HALF,NUTIME+2                                                    
         BRAS  RE,CONVTIME                                                      
         MVC   NTTUNENT,CHARTIME                                                
                                                                                
         MVI   NTTUIAT,C'N'                                                     
         MVC   HALF,NUAFFTIM       AFFADAVIT TIME                               
         BRAS  RE,CONVTIME                                                      
         MVC   NTTUNATM,CHARTIME                                                
         OC    NUAFFTIM,NUAFFTIM                                                
         JZ    *+8                                                              
         MVI   NTTUIAT,C'Y'        IS AFFID TIME?                               
                                                                                
UNIT25   L     R6,AUNITREC                                                      
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNI25                                                            
         USING NUSDRD,R6                                                        
                                                                                
         MVC   NTTUNRTE,NUSDSRT    RATE TYPE                                    
         GOTO1 VUNDAY,DMCB,NUSDROT,NTTUNROT        ROTATION                     
         MVC   NTTUNMIR,NUMIRTYP   MIRROR CODE                                  
                                                                                
         MVI   NTTUNCPY,C'N'                                                    
         TM    NUSDST3,X'40'       COPY SPLIT?                                  
         BZ    *+12                                                             
         MVI   NTTUNCPY,C'Y'                                                    
         MVI   NTTUNPIG,C'N'                                                    
                                                                                
         MVI   NTTUNADU,C'N'                                                    
         TM    NUSDST3,X'02'       ADU UNIT?                                    
         BZ    *+8                                                              
         MVI   NTTUNADU,C'Y'                                                    
                                                                                
         MVC   NTTUNADT,NTTUNAIR   AFFADAVIT DATE = AIR DATE (DEFAULT)          
         OC    NUSDAFDT,NUSDAFDT                                                
         BZ    UNI25                                                            
         GOTO1 DATCON,DMCB,(2,NUSDAFDT),(10,NTTUNADT)  AFFADAVIT DATE           
                                                                                
UNI25    MVI   NTTUNIBB,C'N'       IS BILLBOARD Y/N?                            
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'21'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT35                                                           
         USING NUCMLEL,R6                                                       
                                                                                
         TM    NUCMLFLG,X'04'      HAS BILLBOARD                                
         BZ    UNIT35                                                           
         MVI   NTTUNIBB,C'Y'                                                    
                                                                                
UNIT35   L     R6,AUNITREC                                                      
         MVI   ELCODE,X'60'                                                     
         BAS   RE,GETEL                                                         
         BE    UNIT45                                                           
         B     UNIT50                                                           
         USING NUOTH,R6                                                         
                                                                                
UNIT40   BAS   RE,NEXTEL                                                        
         BNE   UNIT50                                                           
                                                                                
UNIT45   CLI   NUOTTYP,C'D'         OLD STYLE DAYPARTS?                         
         BNE   *+14                                                             
         MVC   NTTUNSDP(1),NUOTHER SUB-DAYPART                                  
         B     UNIT40                                                           
                                                                                
         CLI   NUOTTYP,C'Y'         POD POSITION?                               
         BNE   *+14                                                             
         MVC   NTTUNPOD,NUOTHER     POD                                         
         B     UNIT40                                                           
*                                                                               
         CLI   NUOTTYP,C'U'         USER DEFINED DAYPART?                       
         BNE   *+14                                                             
         MVC   NTTUNSDP,NUOTHER                                                 
         B     UNIT40                                                           
*                                                                               
         CLI   NUOTTYP,C'F'         BUY TYPE?                                   
         BNE   *+14                                                             
         MVC   NTTUBTY,NUOTHER                                                  
         B     UNIT40                                                           
*                                                                               
         B     UNIT40                                                           
*                                                                               
UNIT50   MVC   NTTUNADP,NTTUNDPT   ALLDPT = DAYPART (DEFAULT)                   
         CLC   NTTUNSDP,=C'  '     ANY SUB-DAYPART                              
         BE    *+10                                                             
         MVC   NTTUNADP,NTTUNSDP   OVERRIDE TO SUB-DAYPART                      
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'14'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT55                                                           
         USING NUPRDD,R6                                                        
                                                                                
         TM    NUPRDIND,X'80'      TRIGGYBACK?                                  
         BZ    *+8                                                              
         MVI   NTTUNTRI,C'Y'                                                    
                                                                                
UNIT55   XC    SVNRES,SVNRES                                                    
         MVI   SVNRFLG,0                                                        
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'71'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT60                                                           
         USING NUNVD,R6                                                         
                                                                                
         MVC   NTTUNNTR,NUNVRES    NTI RESULT                                   
         MVC   SVNRES,NTTUNNTR     SAVE NTI RESULT CODE                         
                                                                                
         MVC   HALF,NUNVAFFT       AFFADAVIT TIME IN MILITARY                   
         BRAS  RE,CONVTIME         CONVERT TO PRINTABLE TIME                    
         MVC   NTTUNATM,CHARTIME   AFFADAVIT TIME                               
                                                                                
UNIT60   XC    FULL,FULL           INITIALIZE TO 0                              
         EDIT  FULL,NTTUNTSC,2,ALIGN=RIGHT,ZERO=NOBLANK                         
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'03'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT80                                                           
         B     UNIT70                                                           
         USING NUSPRD,R6                                                        
                                                                                
UNIT65   BAS   RE,NEXTEL                                                        
         BNE   UNIT75                                                           
                                                                                
UNIT70   CLI   NUSPRTYP,C'Q'       SKIP EARNED COST                             
         BE    UNIT65                                                           
                                                                                
         ICM   R0,15,NUSPRAMT                                                   
         A     R0,FULL                                                          
         ST    R0,FULL                                                          
         B     UNIT65                                                           
                                                                                
UNIT75   EDIT  FULL,NTTUNTSC,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
UNIT80   L     R6,AUNITREC                                                      
         MVI   ELCODE,X'75'        SEQUENCE AY COMMERCIAL                       
         BAS   RE,GETEL                                                         
         BNE   UNIT85                                                           
         USING NUSQD,R6                                                         
                                                                                
         MVC   NTTUNDEA,NUSQDEAL   DEAL #                                       
         MVC   NTTUNCON,NUSQCON    CONTRACT #                                   
         MVC   NTTUNSER,NUSQSER    SERIAL #                                     
                                                                                
UNIT85   MVI   NTTUNNPA,C'N'       NO PAY                                       
         MVI   NTTUNNIM,C'N'       NO IMP                                       
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'18'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT90                                                           
         USING NUDTAD,R6                                                        
                                                                                
         MVC   NTTUNVTY(2),NUDVTYPE   VTYPE                                     
         TM    NUUNST5,X'20'        TEST POD LOOKUP                             
         BZ    *+8                                                              
         MVI   NTTUNVTY+2,C'P'                                                  
                                                                                
         TM    NUUNST5,X'80'       NO PAY?                                      
         BZ    *+8                                                              
         MVI   NTTUNNPA,C'Y'                                                    
         TM    NUUNST5,X'40'       NO IMPRESSION UNIT?                          
         BZ    *+8                                                              
         MVI   NTTUNNIM,C'Y'                                                    
                                                                                
UNIT90   MVI   NTTUNPAI,C'N'       UNIT IS PAID?                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'12'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT95                                                           
         MVI   NTTUNPAI,C'Y'                                                    
                                                                                
UNIT95   MVI   NTTUNBIL,C'N'       UNIT IS BILLED?                              
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'10'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNIT100                                                          
         MVI   NTTUNBIL,C'Y'                                                    
                                                                                
UNIT100  L     R6,AUNITREC                                                      
         MVI   ELCODE,X'60'                                                     
         BAS   RE,GETEL                                                         
         B     *+8                                                              
UNIT105  BAS   RE,NEXTEL                                                        
         BNE   UNIT110                                                          
         USING NUOTH,R6                                                         
         CLI   NUOTTYP,C'1'         FLIGHT OVERRIDE                             
         BNE   UNIT105                                                          
         MVC   NTTUNFLT,NUOTHER                                                 
                                                                                
UNIT110  L     R6,AUNITREC                                                      
         MVI   ELCODE,X'99'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNITX                                                            
         USING NUACTD,R6                                                        
         GOTO1 DATCON,DMCB,(3,NUACTADT),(10,NTTUNBDT)    CREATION DATE          
                                                                                
         OC    NUACTCDT,NUACTCDT                                                
         BZ    UNITX                                                            
         GOTO1 DATCON,DMCB,(3,NUACTCDT),(10,NTTUCHDT)    CHANGE DATE            
                                                                                
         OC    NUACTCID,NUACTCID                                                
         BZ    UNITX                                                            
         LA    R1,NUACTCID                                                      
         BRAS  RE,DISPID                                                        
         MVC   NTTUPID,WORK                                                     
                                                                                
UNITX    MVI   NTTUNUID-1,MXTRTQ                                                
         MVI   NTTUNAGY-1,MXTRTQ                                                
         MVI   NTTUNMED-1,MXTRTQ                                                
         MVI   NTTUNCNT-1,MXTRTQ                                                
         MVI   NTTUNAIR-1,MXTRTQ                                                
         MVI   NTTUNQTR-1,MXTRTQ                                                
         MVI   NTTUNSTA-1,MXTRTQ                                                
         MVI   NTTUNPGM-1,MXTRTQ                                                
         MVI   NTTUNEST-1,MXTRTQ                                                
         MVI   NTTUNPAK-1,MXTRTQ                                                
         MVI   NTTUNSUB-1,MXTRTQ                                                
         MVI   NTTUNDPT-1,MXTRTQ                                                
         MVI   NTTUNSDP-1,MXTRTQ                                                
         MVI   NTTUNADP-1,MXTRTQ                                                
         MVI   NTTUNIMU-1,MXTRTQ                                                
         MVI   NTTUNIPU-1,MXTRTQ                                                
         MVI   NTTUNIMS-1,MXTRTQ                                                
         MVI   NTTUNIMG-1,MXTRTQ                                                
         MVI   NTTUNPFB-1,MXTRTQ                                                
         MVI   NTTUNIBB-1,MXTRTQ                                                
         MVI   NTTUNADU-1,MXTRTQ                                                
         MVI   NTTUNPGN-1,MXTRTQ                                                
         MVI   NTTUNSEC-1,MXTRTQ                                                
         MVI   NTTUNDAY-1,MXTRTQ                                                
         MVI   NTTUNROT-1,MXTRTQ                                                
         MVI   NTTUNSTT-1,MXTRTQ                                                
         MVI   NTTUNENT-1,MXTRTQ                                                
         MVI   NTTUNADT-1,MXTRTQ                                                
         MVI   NTTUNNTI-1,MXTRTQ                                                
         MVI   NTTUNTSC-1,MXTRTQ                                                
         MVI   NTTUNNTR-1,MXTRTQ                                                
         MVI   NTTUNCPY-1,MXTRTQ                                                
         MVI   NTTUNPIG-1,MXTRTQ                                                
         MVI   NTTUNTRI-1,MXTRTQ                                                
         MVI   NTTUNMIR-1,MXTRTQ                                                
         MVI   NTTUNDEA-1,MXTRTQ                                                
         MVI   NTTUNCON-1,MXTRTQ                                                
         MVI   NTTUNSER-1,MXTRTQ                                                
         MVI   NTTUNNPA-1,MXTRTQ                                                
         MVI   NTTUNNIM-1,MXTRTQ                                                
         MVI   NTTUNPAI-1,MXTRTQ                                                
         MVI   NTTUNBIL-1,MXTRTQ                                                
         MVI   NTTUNBRD-1,MXTRTQ                                                
         MVI   NTTUNFLT-1,MXTRTQ                                                
         MVI   NTTUNRTE-1,MXTRTQ                                                
         MVI   NTTUNPOD-1,MXTRTQ                                                
         MVI   NTTUNBDT-1,MXTRTQ                                                
         MVI   NTTUNVTY-1,MXTRTQ                                                
         MVI   NTTUREP-1,MXTRTQ                                                 
         MVI   NTTUCHDT-1,MXTRTQ                                                
         MVI   NTTUPID-1,MXTRTQ                                                 
         MVI   NTTUBTY-1,MXTRTQ                                                 
         MVI   NTTUIAT-1,MXTRTQ                                                 
         MVI   NTTUNDX,MXTRTQ                                                   
         MVI   NTTUNDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTUNAGY,MXTRT                                                   
         TR    NTTUNMED,MXTRT                                                   
         TR    NTTUNCNT,MXTRT                                                   
         TR    NTTUNAIR,MXTRT                                                   
         TR    NTTUNQTR,MXTRT                                                   
         TR    NTTUNSTA,MXTRT                                                   
         TR    NTTUNPGM,MXTRT                                                   
         TR    NTTUNEST,MXTRT                                                   
         TR    NTTUNPAK,MXTRT                                                   
         TR    NTTUNSUB,MXTRT                                                   
         TR    NTTUNDPT,MXTRT                                                   
         TR    NTTUNSDP,MXTRT                                                   
         TR    NTTUNADP,MXTRT                                                   
         TR    NTTUNIMU,MXTRT                                                   
         TR    NTTUNIPU,MXTRT                                                   
         TR    NTTUNIMS,MXTRT                                                   
         TR    NTTUNIMG,MXTRT                                                   
         TR    NTTUNPFB,MXTRT                                                   
         TR    NTTUNIBB,MXTRT                                                   
         TR    NTTUNADU,MXTRT                                                   
         TR    NTTUNPGN,MXTRT                                                   
         TR    NTTUNSEC,MXTRT                                                   
         TR    NTTUNDAY,MXTRT                                                   
         TR    NTTUNROT,MXTRT                                                   
         TR    NTTUNSTT,MXTRT                                                   
         TR    NTTUNENT,MXTRT                                                   
         TR    NTTUNADT,MXTRT                                                   
         TR    NTTUNNTI,MXTRT                                                   
         TR    NTTUNTSC,MXTRT                                                   
         TR    NTTUNNTR,MXTRT                                                   
         TR    NTTUNCPY,MXTRT                                                   
         TR    NTTUNPIG,MXTRT                                                   
         TR    NTTUNTRI,MXTRT                                                   
         TR    NTTUNMIR,MXTRT                                                   
         TR    NTTUNDEA,MXTRT                                                   
         TR    NTTUNCON,MXTRT                                                   
         TR    NTTUNSER,MXTRT                                                   
         TR    NTTUNNPA,MXTRT                                                   
         TR    NTTUNNIM,MXTRT                                                   
         TR    NTTUNPAI,MXTRT                                                   
         TR    NTTUNBIL,MXTRT                                                   
         TR    NTTUNBRD,MXTRT                                                   
         TR    NTTUNFLT,MXTRT                                                   
         TR    NTTUNRTE,MXTRT                                                   
         TR    NTTUNPOD,MXTRT                                                   
         TR    NTTUNBDT,MXTRT                                                   
         TR    NTTUNVTY,MXTRT                                                   
         TR    NTTUREP,MXTRT                                                    
         TR    NTTUCHDT,MXTRT                                                   
         TR    NTTUPID,MXTRT                                                    
         TR    NTTUBTY,MXTRT                                                    
         TR    NTTUIAT,MXTRT                                                    
         J     EXIT                                                             
         DROP  R6                                                               
                                                                                
UNILIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD UNIT PAID SUMMARY TABLE                                                 
***********************************************************************         
UNITPAY  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNPLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUPD,R2                                                        
         LA    R1,NTTUPDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUPD,R2                                                        
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
                                                                                
         XC    NTTUPLEN,NTTUPLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTUPLEN(2),=AL2(NTTUPDL)                                        
         MVC   NTTUPTYP,NTUPQ                                                   
         MVC   NTTUPAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUPUID(L'NUKEY-2),2(R3)                                        
                                                                                
         XC    FULL,FULL           INITIALIZE TO 0                              
         EDIT  FULL,NTTUPPTG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUPPTN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUPPIG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUPPIN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUPPSG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUPPSN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
                                                                                
         XC    50(25,R8),50(R8)    CLEAR OUT BLOCK TO HOLD TOTALS               
         LA    R5,50(R8)           START OF TOTALS BLOCK                        
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'12'                                                     
         BAS   RE,GETEL                                                         
         BE    UNP10                                                            
         B     UNPX                                                             
         USING NUPAYD,R6                                                        
                                                                                
UNP05    BAS   RE,NEXTEL                                                        
         BNE   UNP20                                                            
                                                                                
UNP10    CLI   NUPAYTYP,C'T'       TIME?                                        
         BE    UNP15                                                            
         AHI   R5,8                                                             
         CLI   NUPAYTYP,C'I'       INTEGRATION?                                 
         BE    UNP15                                                            
         AHI   R5,8                MUST BE SPECIAL                              
                                                                                
UNP15    MVC   FULL,0(R5)                                                       
         L     R0,FULL                                                          
         MVC   FULL,NUPAYGRS       GROSS                                        
         A     R0,FULL             ACCUMULATE GROSS                             
         ST    R0,FULL                                                          
         MVC   0(4,R5),FULL                                                     
                                                                                
         MVC   FULL,4(R5)                                                       
         L     R0,FULL                                                          
         MVC   FULL,NUPAYNET       NET                                          
         A     R0,FULL             ACCUMULATE NET                               
         ST    R0,FULL                                                          
         MVC   4(4,R5),FULL                                                     
                                                                                
         LA    R5,50(R8)                                                        
         B     UNP05                                                            
         DROP  R6                                                               
                                                                                
UNP20    LA    R5,50(R8)                                                        
                                                                                
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUPPTG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUPPTN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,8(R5)                                                       
         EDIT  FULL,NTTUPPIG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,12(R5)                                                      
         EDIT  FULL,NTTUPPIN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,16(R5)                                                      
         EDIT  FULL,NTTUPPSG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,20(R5)                                                      
         EDIT  FULL,NTTUPPSN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
UNPX     MVI   NTTUPAGY-1,MXTRTQ                                                
         MVI   NTTUPUID-1,MXTRTQ                                                
         MVI   NTTUPPTG-1,MXTRTQ                                                
         MVI   NTTUPPTN-1,MXTRTQ                                                
         MVI   NTTUPPIG-1,MXTRTQ                                                
         MVI   NTTUPPIN-1,MXTRTQ                                                
         MVI   NTTUPPSG-1,MXTRTQ                                                
         MVI   NTTUPPSN-1,MXTRTQ                                                
         MVI   NTTUPDX,MXTRTQ                                                   
         MVI   NTTUPDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTUPAGY,MXTRT                                                   
         TR    NTTUPPTG,MXTRT                                                   
         TR    NTTUPPTN,MXTRT                                                   
         TR    NTTUPPIG,MXTRT                                                   
         TR    NTTUPPIN,MXTRT                                                   
         TR    NTTUPPSG,MXTRT                                                   
         TR    NTTUPPSN,MXTRT                                                   
         J     EXIT                                                             
                                                                                
UNPLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD UNIT SPECIAL CHARGES TABLE                                              
***********************************************************************         
UNITSPC  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNSCLIT                                                       
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUCD,R2                                                        
         LA    R1,NTTUCDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R2,ADXAXREC                                                      
         USING NTTUCD,R2                                                        
         L     R8,ABIGWORK                                                      
                                                                                
         MVC   NTTUCLEN(2),=AL2(NTTUCDL)                                        
         MVC   NTTUCTYP,NTUCQ                                                   
         MVC   NTTUCAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUCUID(L'NUKEY-2),2(R3)                                        
                                                                                
         XC    FULL,FULL           INITIALIZE TO 0                              
         EDIT  FULL,NTTUCADG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCADN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCBOG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCBON,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCCSG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCCSN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCCIG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCCIN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCDAG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCDAN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCECG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCECN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCLCG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCLCN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCOTG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCOTN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCSEG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCSEN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCTXG,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUCTXN,2,ALIGN=RIGHT,ZERO=NOBLANK                         
                                                                                
UNSC10   XC    50(100,R8),50(R8)    CLEAR OUT BLOCK TO HOLD TOTALS              
         LA    R5,50(R8)            START OF TOTALS BLOCK                       
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'03'                                                     
         BAS   RE,GETEL                                                         
         BE    UNSC20                                                           
         B     UNSCX                                                            
         USING NUSPRD,R6                                                        
                                                                                
UNSC15   BAS   RE,NEXTEL                                                        
         BNE   UNSC60                                                           
                                                                                
UNSC20   CLI   NUSPRTYP,NUSPRADM                                                
         BE    UNSC22                                                           
         CLI   NUSPRTYP,NUSPRBLK                                                
         BE    UNSC24                                                           
         CLI   NUSPRTYP,NUSPRCSP                                                
         BE    UNSC26                                                           
         CLI   NUSPRTYP,NUSPRCUT                                                
         BE    UNSC28                                                           
         CLI   NUSPRTYP,NUSPRDEL                                                
         BE    UNSC30                                                           
         CLI   NUSPRTYP,NUSPREAR                                                
         BE    UNSC32                                                           
         CLI   NUSPRTYP,NUSPRLAT                                                
         BE    UNSC34                                                           
         CLI   NUSPRTYP,NUPSROTH                                                
         BE    UNSC36                                                           
         CLI   NUSPRTYP,NUSPRSEC                                                
         BE    UNSC38                                                           
         CLI   NUSPRTYP,NUSPRTAX                                                
         BE    UNSC40                                                           
         B     UNSC15                                                           
                                                                                
UNSC22   LA    R5,NTTUCADL(R5)                                                  
         B     UNSC50                                                           
UNSC24   LA    R5,NTTUCBOL(R5)                                                  
         B     UNSC50                                                           
UNSC26   LA    R5,NTTUCCSL(R5)                                                  
         B     UNSC50                                                           
UNSC28   LA    R5,NTTUCCIL(R5)                                                  
         B     UNSC50                                                           
UNSC30   LA    R5,NTTUCDAL(R5)                                                  
         B     UNSC50                                                           
UNSC32   LA    R5,NTTUCECL(R5)                                                  
         B     UNSC50                                                           
UNSC34   LA    R5,NTTUCLCL(R5)                                                  
         B     UNSC50                                                           
UNSC36   LA    R5,NTTUCOTL(R5)                                                  
         B     UNSC50                                                           
UNSC38   LA    R5,NTTUCSEL(R5)                                                  
         B     UNSC50                                                           
UNSC40   LA    R5,NTTUCTXL(R5)                                                  
         B     UNSC50                                                           
                                                                                
UNSC50   MVC   FULL,0(R5)                                                       
         L     R0,FULL                                                          
         MVC   FULL,NUSPRAMT       AMOUNT                                       
         A     R0,FULL             ACCUMULATE GROSS                             
         ST    R0,FULL                                                          
         MVC   0(4,R5),FULL                                                     
                                                                                
         GOTOR VNETNET,DMCB,NUSPRAMT,FULL  NET IN FULL2                         
         MVC   FULL,4(R5)                                                       
         L     R0,FULL                                                          
         A     R0,FULL2            ACCUMULATE NET                               
         ST    R0,FULL                                                          
         MVC   4(4,R5),FULL                                                     
                                                                                
         LA    R5,50(R8)                                                        
         B     UNSC15                                                           
         DROP  R6                                                               
                                                                                
UNSC60   LA    R5,50(R8)                                                        
         LA    R5,NTTUCADL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCADG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCADN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCBOL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCBOG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCBON,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCCSL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCCSG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCCSN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCCIL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCCIG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCCIN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCDAL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCDAG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCDAN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCECL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCECG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCECN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCLCL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCLCG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCLCN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCSEL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCSEG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCSEN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCOTL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCOTG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCOTN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
         LA    R5,50(R8)                                                        
         LA    R5,NTTUCTXL(R5)                                                  
         MVC   FULL,0(R5)                                                       
         EDIT  FULL,NTTUCTXG,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
         MVC   FULL,4(R5)                                                       
         EDIT  FULL,NTTUCTXN,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-                 
                                                                                
UNSCX    MVI   NTTUCAGY-1,MXTRTQ                                                
         MVI   NTTUCUID-1,MXTRTQ                                                
         MVI   NTTUCADG-1,MXTRTQ                                                
         MVI   NTTUCADN-1,MXTRTQ                                                
         MVI   NTTUCBOG-1,MXTRTQ                                                
         MVI   NTTUCBON-1,MXTRTQ                                                
         MVI   NTTUCCSG-1,MXTRTQ                                                
         MVI   NTTUCCSN-1,MXTRTQ                                                
         MVI   NTTUCCIG-1,MXTRTQ                                                
         MVI   NTTUCCIN-1,MXTRTQ                                                
         MVI   NTTUCDAG-1,MXTRTQ                                                
         MVI   NTTUCDAN-1,MXTRTQ                                                
         MVI   NTTUCECG-1,MXTRTQ                                                
         MVI   NTTUCECN-1,MXTRTQ                                                
         MVI   NTTUCLCG-1,MXTRTQ                                                
         MVI   NTTUCLCN-1,MXTRTQ                                                
         MVI   NTTUCOTG-1,MXTRTQ                                                
         MVI   NTTUCOTN-1,MXTRTQ                                                
         MVI   NTTUCSEG-1,MXTRTQ                                                
         MVI   NTTUCSEN-1,MXTRTQ                                                
         MVI   NTTUCTXG-1,MXTRTQ                                                
         MVI   NTTUCTXN-1,MXTRTQ                                                
         MVI   NTTUCDX,MXTRTQ                                                   
         MVI   NTTUCDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTUCAGY,MXTRT                                                   
         TR    NTTUCADG,MXTRT                                                   
         TR    NTTUCADN,MXTRT                                                   
         TR    NTTUCBOG,MXTRT                                                   
         TR    NTTUCBON,MXTRT                                                   
         TR    NTTUCCSG,MXTRT                                                   
         TR    NTTUCCSN,MXTRT                                                   
         TR    NTTUCCIG,MXTRT                                                   
         TR    NTTUCCIN,MXTRT                                                   
         TR    NTTUCDAG,MXTRT                                                   
         TR    NTTUCDAN,MXTRT                                                   
         TR    NTTUCECG,MXTRT                                                   
         TR    NTTUCECN,MXTRT                                                   
         TR    NTTUCLCG,MXTRT                                                   
         TR    NTTUCLCN,MXTRT                                                   
         TR    NTTUCOTG,MXTRT                                                   
         TR    NTTUCOTN,MXTRT                                                   
         TR    NTTUCSEG,MXTRT                                                   
         TR    NTTUCSEN,MXTRT                                                   
         TR    NTTUCTXG,MXTRT                                                   
         TR    NTTUCTXN,MXTRT                                                   
         J     EXIT                                                             
                                                                                
UNSCLIT  DC    A(LITERAL)                                                       
         EJECT                                                                  
***********************************************************************         
* BUILD UNIT BARTER CREDIT TABLE                                                
***********************************************************************         
UNITBRTR NTR1  BASE=*,LABEL=*                                                   
         L     RA,UNBLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUBD,R2                                                        
         LA    R1,NTTUBDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R2,ADXAXREC                                                      
         USING NTTUBD,R2                                                        
         L     R8,ABIGWORK                                                      
         MVC   DATADISP,=H'27'                                                  
                                                                                
         MVC   NTTUBLEN(2),=AL2(NTTUBDL)                                        
         MVC   NTTUBTYP,NTUBQ                                                   
         MVC   NTTUBAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUBUID(L'NUKEY-2),2(R3)                                        
                                                                                
         MVC   NTTUBACP,UFRSTPRD   DEFAULT TO 1ST PRODUCT ON UNIT               
         MVC   NTTUBASP,UFRSTPRD   DEFAULT TO 1ST PRODUCT ON UNIT               
                                                                                
         XC    FULL,FULL           INITIALIZE TO 0                              
         EDIT  FULL,NTTUBACC,2,ALIGN=RIGHT,ZERO=NOBLANK                         
         EDIT  FULL,NTTUBASC,2,ALIGN=RIGHT,ZERO=NOBLANK                         
                                                                                
         L     R6,AUNITREC                                                      
         MVI   ELCODE,X'03'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNB05                                                            
         USING NUSPRD,R6                                                        
                                                                                
         CLI   NUSPRTYP,C'C'       BARTER ACTUAL CREDIT?                        
         BNE   UNB05                                                            
         OC    NUSPRBPC,NUSPRBPC   ANY BARTER PRODUCT?                          
         BZ    *+10                                                             
         MVC   NTTUBACP,NUSPRBPC                                                
         EDIT  NUSPRAMT,NTTUBACC,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
                                                                                
UNB05    L     R6,AUNITREC                                                      
         MVI   ELCODE,X'76'                                                     
         BAS   RE,GETEL                                                         
         BNE   UNBX                                                             
         USING NUASCD,R6                                                        
                                                                                
         OC    NUASCBPC,NUASCBPC   ANY BARTER PRODUCT?                          
         BZ    *+10                                                             
         MVC   NTTUBASP,NUASCBPC                                                
         EDIT  NUASCAMT,NTTUBASC,2,ALIGN=RIGHT,ZERO=NOBLANK,FLOAT=-             
         DROP  R6                                                               
                                                                                
UNBX     MVI   NTTUBAGY-1,MXTRTQ                                                
         MVI   NTTUBUID-1,MXTRTQ                                                
         MVI   NTTUBACP-1,MXTRTQ                                                
         MVI   NTTUBACC-1,MXTRTQ                                                
         MVI   NTTUBASP-1,MXTRTQ                                                
         MVI   NTTUBASC-1,MXTRTQ                                                
         MVI   NTTUBDX,MXTRTQ                                                   
         MVI   NTTUBDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTUBAGY,MXTRT                                                   
         TR    NTTUBACP,MXTRT                                                   
         TR    NTTUBACC,MXTRT                                                   
         TR    NTTUBASP,MXTRT                                                   
         TR    NTTUBASP,MXTRT                                                   
         J     EXIT                                                             
                                                                                
UNBLIT   DC    A(LITERAL)                                                       
         EJECT                                                                  
                                                                                
UNITOUT  L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
UNITOUTX J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* GET CATEGORY VALUES TO OUTPUT IN LIST                                         
***********************************************************************         
GETCATV  NTR1  BASE=*,LABEL=*                                                   
         L     R5,ANDEMOV                                                       
         ST    R5,ACURCATV                                                      
                                                                                
         CLI   APOSCATV,0                                                       
         BE    GETCATVX                                                         
         ZIC   R3,APOSCATV         OFFSET INTO THE LIST (XDESTDEM)              
                                                                                
GETCV05  ST    R5,ACURCATV         CURRENT CATEGORY VALUES                      
         LA    R5,8(R5)                                                         
         BCT   R3,GETCV05                                                       
                                                                                
GETCATVX J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* GET DEMOS VALUES FROM NETIO                                                   
*                                                                               
* MYIO - BYTES 0000-1200 => NETBLOCK                                            
*      - BYTES 1200-2500 => NETDEMOP                                            
***********************************************************************         
GETEVAL  NTR1  BASE=*,LABEL=*                                                   
         LA    RE,MYIO                                                          
         LA    RF,2500                                                          
         XCEF                                                                   
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         LA    R5,MYIO             NETBLOCK                                     
         ST    R5,ANBLOCK                                                       
         USING NBLOCKD,R5                                                       
                                                                                
         LA    R6,MYIO+1200        NETDEMOP                                     
         USING NDEMOPD,R6                                                       
         LA    RF,XDDEMOS                                                       
         STCM  RF,15,NBADEM        A(DEMOBLOCK)                                 
         MVC   XDDEMOS,DEMOLIST    ESTIMATE DEMO LIST                           
         OI    NBINDS6,NBI6XDEM                                                 
                                                                                
         L     RF,ACLTREC                                                       
         ST    RF,NBACLI                                                        
         MVC   NBDEFINE,VDEFINE    A(DEFINE)                                    
                                                                                
         MVI   NBPREOPT,C'N'                                                    
         MVI   NBHUNOPT,C'N'                                                    
         MVI   SVPOSTYP,C'N'                                                    
                                                                                
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BZ    *+8                                                              
         OI    NBINDS3,NBI3A2DC                                                 
                                                                                
         NI    NBINDS3,X'FF'-NBI3B2DC     YES/CLEAR NEW BOOK BITS               
         LR    R6,R3                                                            
         MVI   ELCODE,X'5D'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETEV05                                                          
         USING NUBKD,R6                                                         
                                                                                
         CLC   NUBKBOOK,=X'5901'                                                
         BL    *+8                                                              
         OI    NBINDS3,NBI3B2DC    SET NEW 2 DEC BOOK                           
                                                                                
GETEV05  LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETEV15                                                          
         USING NUSDRD,R6                                                        
                                                                                
         CLI   NUSTATYP,X'40'                                                   
         BNH   GETEV15                                                          
         MVC   SVPOSTYP,NUPOSTYP                                                
                                                                                
         CLI   SVPOSTYP,C'C'                                                    
         BE    GETEV10                                                          
         CLI   SVPOSTYP,C'D'                                                    
         BE    GETEV10                                                          
         CLI   SVPOSTYP,C'O'                                                    
         BNE   GETEV15                                                          
                                                                                
GETEV10  MVI   NBPREOPT,C'Y'       IT'S CABLE                                   
         MVI   NBHUNOPT,C'Y'       IMPS IN HUNDREDS                             
                                                                                
GETEV15  MVC   SVPREOPT,NBPREOPT                                                
                                                                                
         MVI   NBFUNCT,NBFVAL      NBAIO CONTAINS A(RECORD)                     
         MVI   NBESTOPT,C'M'       RETURN ESTIMATED DEMOS                       
         MVC   NBSELAGY,SXDTAGY    ALPHA AGENCY                                 
                                                                                
         BAS   RE,SETSURV          SET NBSURVEY                                 
         MVC   NBSURVEY,BYTE                                                    
                                                                                
         L     RF,AUNITREC                                                      
         STCM  RF,15,NBAIO                                                      
                                                                                
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(SVCPROF+6,NUKCLT),NBCLICOD     3 CHAR CLIENT          
                                                                                
         MVC   NBACTAM,NUKAM       AGENCY/MEDIA                                 
         MVC   NBNTISTA,SVNTI      NTI STATION                                  
                                                                                
         MVI   NBUPUNIT,C'N'                                                    
         MVI   NBNOWRIT,C'N'                                                    
         MVC   NBUSER,UN0PROF      N0 PROFILES                                  
         MVC   NBUSER1,UN1PROF     N1 PROFILES                                  
         MVC   NBUSER2,UN2PROF     N2 PROFILES                                  
         MVI   NBN0B2,0            RAW DEMOS                                    
         MVI   NBN2B1,0                                                         
                                                                                
         L     RF,VNETVALU         A(NETVALUE)                                  
         STCM  RF,15,NBNETVAL                                                   
         L     RF,VDEMOUT          A(DEMOUT)                                    
         STCM  RF,15,NBDEMOUT                                                   
         L     RF,COMFACS                                                       
         STCM  RF,15,NBACOM        A(COMFACS)                                   
                                                                                
         MVI   NBDATA,C'U'           UNITS ONLY                                 
         MVC   NBKEY,UUNTKEY                                                    
         GOTO1 VNETIO,DMCB,NBLOCKD                                              
                                                                                
         ICM   RF,15,NBDM          GET LAST KEY DATAMGR READ                    
         GOTO1 (RF),DMCB,=CL7'DMKEY',=CL7'UNTDIR',NBKEY,,WORK                   
                                                                                
         CLC   UUNTKEY(20),NBKEY     MISMATCH IN UNIT KEY?                      
         BNE   GETEV20                                                          
         L     RF,AUNITREC                                                      
         L     RE,NBAIO                                                         
         CLC   0(20,RF),0(RE)                                                   
         BE    GETEV25                                                          
                                                                                
GETEV20  L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(X'08',=CL7'DMREAD'),=CL7'UNTDIR',UUNTKEY,    *        
               UNTKEY,WORK                                                      
         CLC   UNTKEY(20),UUNTKEY                                               
         BE    GETEV25                                                          
         CLI   MODE,DXUPDTQ        CHECK UPDATE MODE ?                          
         JE    *+6                                                              
         DC    H'00'                                                            
         DROP  R6,R5                                                            
                                                                                
GETEV25  LA    RF,MYIO+1200                                                     
         USING NDEMOPD,RF                                                       
         MVC   RAWDEMOS(200),XDESTDEM                                           
         MVC   RAWDEMOS+200(200),XDESTDM2                                       
         DROP  RF                                                               
                                                                                
         LA    RF,MYIO                                                          
         USING NBLOCKD,RF                                                       
         MVC   SVNRES,NBRESULT                                                  
         DROP  RF                                                               
                                                                                
         LA    RE,MYIO+1200        CLEAR NETDEMOP                               
         LA    RF,1300                                                          
         XCEF                                                                   
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         LA    R5,MYIO             NETBLOCK                                     
         ST    R5,ANBLOCK                                                       
         USING NBLOCKD,R5                                                       
                                                                                
         LA    R6,MYIO+1200        NETDEMOP                                     
         USING NDEMOPD,R6                                                       
         LA    RF,XDDEMOS                                                       
         STCM  RF,15,NBADEM        A(DEMOBLOCK)                                 
         MVC   XDDEMOS,DEMOLIST    ESTIMATE DEMO LIST                           
         OI    NBINDS6,NBI6XDEM                                                 
                                                                                
         L     RF,ACLTREC                                                       
         ST    RF,NBACLI                                                        
         MVC   NBDEFINE,VDEFINE    A(DEFINE)                                    
                                                                                
         MVI   NBPREOPT,C'N'                                                    
         MVI   NBHUNOPT,C'N'                                                    
         MVI   SVPOSTYP,C'N'                                                    
                                                                                
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BZ    *+8                                                              
         OI    NBINDS3,NBI3A2DC                                                 
                                                                                
         NI    NBINDS3,X'FF'-NBI3B2DC     YES/CLEAR NEW BOOK BITS               
         LR    R6,R3                                                            
         MVI   ELCODE,X'5D'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETEV30                                                          
         USING NUBKD,R6                                                         
                                                                                
         CLC   NUBKBOOK,=X'5901'                                                
         BL    *+8                                                              
         OI    NBINDS3,NBI3B2DC    SET NEW 2 DEC BOOK                           
                                                                                
GETEV30  LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETEV40                                                          
         USING NUSDRD,R6                                                        
                                                                                
         CLI   NUSTATYP,X'40'                                                   
         BNH   GETEV40                                                          
         MVC   SVPOSTYP,NUPOSTYP                                                
                                                                                
         CLI   SVPOSTYP,C'C'                                                    
         BE    GETEV35                                                          
         CLI   SVPOSTYP,C'D'                                                    
         BE    GETEV35                                                          
         CLI   SVPOSTYP,C'O'                                                    
         BNE   GETEV40                                                          
                                                                                
GETEV35  MVI   NBPREOPT,C'Y'       IT'S CABLE                                   
         MVI   NBHUNOPT,C'Y'       IMPS IN HUNDREDS                             
                                                                                
GETEV40  MVC   SVPREOPT,NBPREOPT                                                
         MVI   NBFUNCT,NBFVAL      NBAIO CONTAINS A(RECORD)                     
         MVI   NBESTOPT,C'M'       RETURN ESTIMATED DEMOS                       
         MVC   NBSELAGY,SXDTAGY    ALPHA AGENCY                                 
                                                                                
         BAS   RE,SETSURV          SET NBSURVEY                                 
         MVC   NBSURVEY,BYTE                                                    
                                                                                
         L     RF,AUNITREC                                                      
         STCM  RF,15,NBAIO                                                      
                                                                                
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(SVCPROF+6,NUKCLT),NBCLICOD     3 CHAR CLIENT          
                                                                                
         MVC   NBACTAM,NUKAM       AGENCY/MEDIA                                 
         MVC   NBNTISTA,SVNTI      NTI STATION                                  
         MVC   NBUSER,UN0PROF      N0 PROFILES                                  
         MVC   NBUSER1,UN1PROF     N1 PROFILES                                  
         MVC   NBUSER2,UN2PROF     N2 PROFILES                                  
         MVI   NBDEMRAW,0                                                       
         MVI   NBUPUNIT,C'N'                                                    
         MVI   NBNOWRIT,C'N'                                                    
                                                                                
         L     RF,VNETVALU         A(NETVALUE)                                  
         STCM  RF,15,NBNETVAL                                                   
         L     RF,VDEMOUT          A(DEMOUT)                                    
         STCM  RF,15,NBDEMOUT                                                   
         L     RF,COMFACS                                                       
         STCM  RF,15,NBACOM        A(COMFACS)                                   
                                                                                
         MVI   NBDATA,C'U'           UNITS ONLY                                 
         MVC   NBKEY,UUNTKEY                                                    
         GOTO1 VNETIO,DMCB,NBLOCKD                                              
                                                                                
         ICM   RF,15,NBDM          GET LAST KEY DATAMGR READ                    
         GOTO1 (RF),DMCB,=CL7'DMKEY',=CL7'UNTDIR',NBKEY,,WORK                   
                                                                                
         CLC   UUNTKEY(20),NBKEY     MISMATCH IN UNIT KEY?                      
         BNE   GETEV45                                                          
         L     RF,AUNITREC                                                      
         L     RE,NBAIO                                                         
         CLC   0(20,RF),0(RE)                                                   
         BE    GETEV50                                                          
                                                                                
GETEV45  L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(X'08',=CL7'DMREAD'),=CL7'UNTDIR',UUNTKEY,    *        
               UNTKEY,WORK                                                      
         CLC   UNTKEY(20),UUNTKEY                                               
         BE    GETEV50                                                          
         CLI   MODE,DXUPDTQ        CHECK UPDATE MODE ?                          
         JE    *+6                                                              
         DC    H'00'                                                            
         DROP  R6,R5                                                            
                                                                                
GETEV50  LA    RF,MYIO+1200                                                     
         USING NDEMOPD,RF                                                       
         MVC   EQVDEMOS(200),XDESTDEM                                           
         MVC   EQVDEMOS+200(200),XDESTDM2                                       
         DROP  R3,RF                                                            
                                                                                
GETEVX   J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* GET DEMOS VALUES FROM NETIO                                                   
* MYIO - BYTES 0000-1200 => NETBLOCK                                            
*      - BYTES 1200-2500 => NETDEMOP                                            
***********************************************************************         
GETAVAL  NTR1  BASE=*,LABEL=*                                                   
         LA    RE,MYIO                                                          
         LA    RF,2500                                                          
         XCEF                                                                   
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         LA    R5,MYIO             NETBLOCK                                     
         ST    R5,ANBLOCK                                                       
         USING NBLOCKD,R5                                                       
                                                                                
         LA    R6,MYIO+1200        NETDEMOP                                     
         USING NDEMOPD,R6                                                       
         LA    RF,XDDEMOS                                                       
         STCM  RF,15,NBADEM        A(DEMOBLOCK)                                 
         MVC   XDDEMOS,DEMOLIST    ESTIMATE DEMO LIST                           
         OI    NBINDS6,NBI6XDEM                                                 
                                                                                
         L     RF,ACLTREC                                                       
         ST    RF,NBACLI                                                        
         MVC   NBDEFINE,VDEFINE    A(DEFINE)                                    
                                                                                
         MVI   NBPREOPT,C'N'                                                    
         MVI   NBHUNOPT,C'N'                                                    
         MVI   SVPOSTYP,C'N'                                                    
                                                                                
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BZ    *+8                                                              
         OI    NBINDS3,NBI3A2DC                                                 
                                                                                
         NI    NBINDS3,X'FF'-NBI3B2DC     YES/CLEAR NEW BOOK BITS               
         LR    R6,R3                                                            
         MVI   ELCODE,X'5D'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETAV05                                                          
         USING NUBKD,R6                                                         
                                                                                
         CLC   NUBKBOOK,=X'5901'                                                
         BL    *+8                                                              
         OI    NBINDS3,NBI3B2DC    SET NEW 2 DEC BOOK                           
                                                                                
GETAV05  LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETAV15                                                          
         USING NUSDRD,R6                                                        
                                                                                
         CLI   NUSTATYP,X'40'                                                   
         BNH   GETAV15                                                          
         MVC   SVPOSTYP,NUPOSTYP                                                
                                                                                
         CLI   SVPOSTYP,C'C'                                                    
         BE    GETAV10                                                          
         CLI   SVPOSTYP,C'D'                                                    
         BE    GETAV10                                                          
         CLI   SVPOSTYP,C'O'                                                    
         BNE   GETAV15                                                          
                                                                                
GETAV10  MVI   NBPREOPT,C'Y'       IT'S CABLE                                   
         MVI   NBHUNOPT,C'Y'       IMPS IN HUNDREDS                             
                                                                                
GETAV15  MVC   SVPREOPT,NBPREOPT                                                
                                                                                
         MVI   NBFUNCT,NBFVAL      NBAIO CONTAINS A(RECORD)                     
         MVI   NBACTOPT,C'Y'       RETURN ACTUAL DEMOS                          
         MVC   NBSELAGY,SXDTAGY    ALPHA AGENCY                                 
                                                                                
         BAS   RE,SETSURV          SET NBSURVEY                                 
         MVC   NBSURVEY,BYTE                                                    
                                                                                
         L     RF,AUNITREC                                                      
         STCM  RF,15,NBAIO                                                      
                                                                                
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(SVCPROF+6,NUKCLT),NBCLICOD     3 CHAR CLIENT          
                                                                                
         MVC   NBACTAM,NUKAM       AGENCY/MEDIA                                 
         MVC   NBNTISTA,SVNTI      NTI STATION                                  
                                                                                
         MVI   NBUPUNIT,C'N'                                                    
         MVI   NBNOWRIT,C'N'                                                    
         MVC   NBUSER,UN0PROF      N0 PROFILES                                  
         MVC   NBUSER1,UN1PROF     N1 PROFILES                                  
         MVC   NBUSER2,UN2PROF     N2 PROFILES                                  
         MVI   NBN0B2,0            RAW DEMOS                                    
         MVI   NBN2B1,0                                                         
                                                                                
         L     RF,VNETVALU         A(NETVALUE)                                  
         STCM  RF,15,NBNETVAL                                                   
         L     RF,VDEMOUT          A(DEMOUT)                                    
         STCM  RF,15,NBDEMOUT                                                   
         L     RF,COMFACS                                                       
         STCM  RF,15,NBACOM        A(COMFACS)                                   
                                                                                
         MVI   NBDATA,C'U'           UNITS ONLY                                 
         MVC   NBKEY,UUNTKEY                                                    
         GOTO1 VNETIO,DMCB,NBLOCKD                                              
                                                                                
         ICM   RF,15,NBDM          GET LAST KEY DATAMGR READ                    
         GOTO1 (RF),DMCB,=CL7'DMKEY',=CL7'UNTDIR',NBKEY,,WORK                   
                                                                                
         CLC   UUNTKEY(20),NBKEY     MISMATCH IN UNIT KEY?                      
         BNE   GETAV20                                                          
         L     RF,AUNITREC                                                      
         L     RE,NBAIO                                                         
         CLC   0(20,RF),0(RE)                                                   
         BE    GETAV25                                                          
                                                                                
GETAV20  L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(X'08',=CL7'DMREAD'),=CL7'UNTDIR',UUNTKEY,    *        
               UNTKEY,WORK                                                      
         CLC   UNTKEY(20),UUNTKEY                                               
         BE    GETAV25                                                          
         CLI   MODE,DXUPDTQ        CHECK UPDATE MODE ?                          
         JE    *+6                                                              
         DC    H'00'                                                            
         DROP  R6,R5                                                            
                                                                                
GETAV25  LA    RF,MYIO+1200                                                     
         USING NDEMOPD,RF                                                       
         MVC   RAWDEMOS(200),XDACTDEM                                           
         MVC   RAWDEMOS+200(200),XDACTDM2                                       
         DROP  RF                                                               
                                                                                
         LA    RF,MYIO                                                          
         USING NBLOCKD,RF                                                       
         MVC   SVNRES,NBRESULT                                                  
         DROP  RF                                                               
                                                                                
         LA    RE,MYIO+1200        CLEAR NETDEMOP                               
         LA    RF,1300                                                          
         XCEF                                                                   
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         LA    R5,MYIO             NETBLOCK                                     
         ST    R5,ANBLOCK                                                       
         USING NBLOCKD,R5                                                       
                                                                                
         LA    R6,MYIO+1200        NETDEMOP                                     
         USING NDEMOPD,R6                                                       
         LA    RF,XDDEMOS                                                       
         STCM  RF,15,NBADEM        A(DEMOBLOCK)                                 
         MVC   XDDEMOS,DEMOLIST    ESTIMATE DEMO LIST                           
         OI    NBINDS6,NBI6XDEM                                                 
                                                                                
         L     RF,ACLTREC                                                       
         ST    RF,NBACLI                                                        
         MVC   NBDEFINE,VDEFINE    A(DEFINE)                                    
                                                                                
         MVI   NBPREOPT,C'N'                                                    
         MVI   NBHUNOPT,C'N'                                                    
         MVI   SVPOSTYP,C'N'                                                    
                                                                                
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BZ    *+8                                                              
         OI    NBINDS3,NBI3A2DC                                                 
                                                                                
         NI    NBINDS3,X'FF'-NBI3B2DC     YES/CLEAR NEW BOOK BITS               
         LR    R6,R3                                                            
         MVI   ELCODE,X'5D'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETAV30                                                          
         USING NUBKD,R6                                                         
                                                                                
         CLC   NUBKBOOK,=X'5901'                                                
         BL    *+8                                                              
         OI    NBINDS3,NBI3B2DC    SET NEW 2 DEC BOOK                           
                                                                                
GETAV30  LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   GETAV40                                                          
         USING NUSDRD,R6                                                        
                                                                                
         CLI   NUSTATYP,X'40'                                                   
         BNH   GETAV40                                                          
         MVC   SVPOSTYP,NUPOSTYP                                                
                                                                                
         CLI   SVPOSTYP,C'C'                                                    
         BE    GETAV35                                                          
         CLI   SVPOSTYP,C'D'                                                    
         BE    GETAV35                                                          
         CLI   SVPOSTYP,C'O'                                                    
         BNE   GETAV40                                                          
                                                                                
GETAV35  MVI   NBPREOPT,C'Y'       IT'S CABLE                                   
         MVI   NBHUNOPT,C'Y'       IMPS IN HUNDREDS                             
                                                                                
GETAV40  MVC   SVPREOPT,NBPREOPT                                                
         MVI   NBFUNCT,NBFVAL      NBAIO CONTAINS A(RECORD)                     
         MVI   NBACTOPT,C'Y'       RETURN ACTUAL DEMOS                          
         MVC   NBSELAGY,SXDTAGY    ALPHA AGENCY                                 
                                                                                
         BAS   RE,SETSURV          SET NBSURVEY                                 
         MVC   NBSURVEY,BYTE                                                    
                                                                                
         L     RF,AUNITREC                                                      
         STCM  RF,15,NBAIO                                                      
                                                                                
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(SVCPROF+6,NUKCLT),NBCLICOD     3 CHAR CLIENT          
                                                                                
         MVC   NBACTAM,NUKAM       AGENCY/MEDIA                                 
         MVC   NBNTISTA,SVNTI      NTI STATION                                  
         MVC   NBUSER,UN0PROF      N0 PROFILES                                  
         MVC   NBUSER1,UN1PROF     N1 PROFILES                                  
         MVC   NBUSER2,UN2PROF     N2 PROFILES                                  
         MVI   NBDEMRAW,0                                                       
         MVI   NBUPUNIT,C'N'                                                    
         MVI   NBNOWRIT,C'N'                                                    
                                                                                
         L     RF,VNETVALU         A(NETVALUE)                                  
         STCM  RF,15,NBNETVAL                                                   
         L     RF,VDEMOUT          A(DEMOUT)                                    
         STCM  RF,15,NBDEMOUT                                                   
         L     RF,COMFACS                                                       
         STCM  RF,15,NBACOM        A(COMFACS)                                   
                                                                                
         MVI   NBDATA,C'U'           UNITS ONLY                                 
         MVC   NBKEY,UUNTKEY                                                    
         GOTO1 VNETIO,DMCB,NBLOCKD                                              
                                                                                
         ICM   RF,15,NBDM          GET LAST KEY DATAMGR READ                    
         GOTO1 (RF),DMCB,=CL7'DMKEY',=CL7'UNTDIR',NBKEY,,WORK                   
                                                                                
         CLC   UUNTKEY(20),NBKEY     MISMATCH IN UNIT KEY?                      
         BNE   GETAV45                                                          
         L     RF,AUNITREC                                                      
         L     RE,NBAIO                                                         
         CLC   0(20,RF),0(RE)                                                   
         BE    GETAV50                                                          
                                                                                
GETAV45  L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(X'08',=CL7'DMREAD'),=CL7'UNTDIR',UUNTKEY,    *        
               UNTKEY,WORK                                                      
         CLC   UNTKEY(20),UUNTKEY                                               
         BE    GETAV50                                                          
         CLI   MODE,DXUPDTQ        CHECK UPDATE MODE ?                          
         JE    *+6                                                              
         DC    H'00'                                                            
         DROP  R6,R5                                                            
                                                                                
GETAV50  LA    RF,MYIO+1200                                                     
         USING NDEMOPD,RF                                                       
         MVC   EQVDEMOS(200),XDACTDEM                                           
         MVC   EQVDEMOS+200(200),XDACTDM2                                       
         DROP  R3,RF                                                            
                                                                                
GETAVX   J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* GET NBSURVEY FROM UNIT REC                                                    
***********************************************************************         
SETSURV  NTR1  BASE=*,LABEL=*                                                   
         MVI   BYTE,0                                                           
                                                                                
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   SETSRV05                                                         
         USING NUSDRD,R6                                                        
                                                                                
         MVC   BYTE,NUPOSTYP            PRECISION TYPE                          
         CLI   NUBKTYP,X'40'                                                    
         BNH   *+10                                                             
         MVC   BYTE,NUBKTYP              BOOK TYPE                              
         B     SETSURVX                                                         
         DROP  R6                                                               
                                                                                
SETSRV05 LA    RF,SURVLIST                                                      
SETSRV10 CLI   0(RF),X'FF'                                                      
         BE    SETSURVX                                                         
         CLC   NUKNET,0(RF)        SAME STATION?                                
         BE    SERSRV15                                                         
         AHI   RF,5                                                             
         B     SETSRV10                                                         
         DROP  R3                                                               
                                                                                
SERSRV15 MVC   BYTE,4(RF)                                                       
                                                                                
SETSURVX J     EXIT                                                             
                                                                                
SURVLIST DC    C'ABC ',C'N'                                                     
         DC    C'CBS ',C'N'                                                     
         DC    C'NBC ',C'N'                                                     
         DC    C'FOX ',C'N'                                                     
         DC    C'TCF ',C'N'                                                     
         DC    C'FBC ',C'N'                                                     
         DC    C'CNN ',C'C'                                                     
         DC    C'WTBS',C'C'                                                     
         DC    C'TBS ',C'C'                                                     
         DC    C'USA ',C'C'                                                     
         DC    C'CBN ',C'C'                                                     
         DC    C'ESPN',C'C'                                                     
         DC    C'MTV ',C'C'                                                     
         DC    C'NICK',C'C'                                                     
         DC    C'NIK ',C'C'                                                     
         DC    C'AEN ',C'C'                                                     
         DC    C'LFTM',C'C'                                                     
         DC    C'FF'                                                            
         EJECT                                                                  
***********************************************************************         
* BUILD UNIT ESTIMATE DEMOS                                                     
***********************************************************************         
UNITEDL  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UEDLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUEDD,R2                                                       
         LA    R1,NTTUEDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTUEDD,R2                                                       
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
                                                                                
         XC    NTTUELEN,NTTUELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTUELEN(2),=AL2(NTTUEDL)                                        
         MVC   NTTUETYP,NTUEQ                                                   
         MVC   NTTUEAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTUEUID(L'NUKEY-2),2(R3)                                        
                                                                                
         MVC   NTTUERRA(3),=C'.00'  INITIALIZE RATINGS & IMPS                   
         MVC   NTTUEREQ(3),=C'.00'                                              
         MVC   NTTUEIRA(1),=C'0'                                                
         MVC   NTTUEIEQ(1),=C'0'                                                
                                                                                
         LA    R8,200(R8)          POINT TO ESTIMATE DEMO LIST                  
         ST    R8,AEDEMLST                                                      
                                                                                
         BRAS  RE,CHKDUPD          CHECK FOR DUPLICATE AGE/SEX                  
                                                                                
         L     R8,AEDEMLST         POINT TO ESTIMATE DEMO LIST                  
         BRAS  RE,GETDEMO          GET DEMO                                     
         L     R5,FULL                                                          
         MVC   APOSCATV,BYTE       CATEGORY POSITION (OFFSET)                   
                                                                                
         MVC   BYTE,0(R5)                                                       
         EDIT  BYTE,NTTUENAD,FILL=0   NAD CATEGORY                              
         MVC   NTTUEMOD,1(R5)         MODIFIER                                  
         MVC   BYTE,2(R5)                                                       
         EDIT  BYTE,NTTUEASC,FILL=0   AGE SEX CATEGORY                          
                                                                                
         MVI   3(R5),C'X'          FINISHED PROCESSING THIS PRODUCT             
         AHI   R5,4                                                             
                                                                                
UNE05    CLI   0(R5),X'FF'         END OF LIST?                                 
         BE    UNE10                                                            
         CLI   2(R5),0             COMSCORE?                                    
         BNE   *+8                                                              
         MVI   3(R5),C'X'          MARK IT PROCESSED SO IT SKIPS                
         CLI   3(R5),C'X'          ALREADY PROCESSED?                           
         BNE   *+12                                                             
         AHI   R5,4                                                             
         B     UNE05                                                            
                                                                                
UNE10    ST    R5,ACURDEMO                                                      
         LA    RF,RAWDEMOS         DO RAW VALUES                                
         ST    RF,ANDEMOV                                                       
         BRAS  RE,GETCATV          GET THIS CATEGORY'S DEMO VALUES              
         L     R5,ACURCATV                                                      
                                                                                
         SR    RF,RF               RATINGS                                      
         ICM   RF,3,2(R5)                                                       
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNE15                                                            
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNE15                                                            
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNE15    EDIT  FULL,NTTUERRA,2,ALIGN=LEFT,ZERO=NOBLANK                          
         L     RF,FULL                                                          
         C     RF,=F'10000'      OVER 100%?                                     
         BL    *+10                                                             
         MVC   NTTUERRA(11),=C'00.00      '                                     
                                                                                
         L     RF,4(R5)            IMPRESSIONS                                  
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNE20                                                            
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNE20                                                            
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNE20    EDIT  FULL,NTTUEIRA,1,ALIGN=LEFT,ZERO=NOBLANK                          
                                                                                
         LA    RF,EQVDEMOS         DO EQUIVALENCY VALUES                        
         ST    RF,ANDEMOV                                                       
         BRAS  RE,GETCATV          GET THIS CATEGORY'S DEMO VALUES              
         L     R5,ACURCATV                                                      
                                                                                
         SR    RF,RF                                                            
         ICM   RF,3,2(R5)                                                       
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNE25                                                            
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNE25                                                            
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNE25    EDIT  FULL,NTTUEREQ,2,ALIGN=LEFT,ZERO=NOBLANK                          
         L     RF,FULL                                                          
         C     RF,=F'10000'      OVER 100%?                                     
         BL    *+10                                                             
         MVC   NTTUEREQ(11),=C'00.00      '                                     
                                                                                
         L     RF,4(R5)                                                         
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNE30                                                            
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNE30                                                            
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNE30    EDIT  FULL,NTTUEIEQ,1,ALIGN=LEFT,ZERO=NOBLANK                          
                                                                                
         MVI   NTTUEAGY-1,MXTRTQ                                                
         MVI   NTTUEUID-1,MXTRTQ                                                
         MVI   NTTUENAD-1,MXTRTQ                                                
         MVI   NTTUEASC-1,MXTRTQ                                                
         MVI   NTTUEMOD-1,MXTRTQ                                                
         MVI   NTTUERRA-1,MXTRTQ                                                
         MVI   NTTUEREQ-1,MXTRTQ                                                
         MVI   NTTUEIRA-1,MXTRTQ                                                
         MVI   NTTUEIEQ-1,MXTRTQ                                                
         MVI   NTTUEDX,MXTRTQ                                                   
         MVI   NTTUEDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTUEAGY,MXTRT                                                   
         TR    NTTUENAD,MXTRT                                                   
         TR    NTTUEASC,MXTRT                                                   
         TR    NTTUEMOD,MXTRT                                                   
         TR    NTTUERRA,MXTRT                                                   
         TR    NTTUEREQ,MXTRT                                                   
         TR    NTTUEIRA,MXTRT                                                   
         TR    NTTUEIEQ,MXTRT                                                   
         J     EXIT                                                             
                                                                                
UEDLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD UNIT ACTUAL DEMOS                                                       
***********************************************************************         
UNITADL  NTR1  BASE=*,LABEL=*                                                   
         L     RA,UADLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTADD,R2                                                        
         LA    R1,NTTADDL                                                       
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTADD,R2                                                        
         L     R3,AUNITREC                                                      
         USING NURECD,R3                                                        
         L     R8,ABIGWORK                                                      
                                                                                
         XC    NTTADLEN,NTTADLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTADLEN(2),=AL2(NTTADDL)                                        
         MVC   NTTADTYP,NTADQ                                                   
         MVC   NTTADAGY,SXDTAGY    ALPHA AGENCY                                 
         MVC   NTTADUID(L'NUKEY-2),2(R3)                                        
                                                                                
         MVC   NTTADRRA(3),=C'.00'  INITIALIZE RATINGS & IMPS                   
         MVC   NTTADREQ(3),=C'.00'                                              
         MVC   NTTADIRA(1),=C'0'                                                
         MVC   NTTADIEQ(1),=C'0'                                                
                                                                                
         LA    R8,200(R8)          POINT TO ESTIMATE DEMO LIST                  
         ST    R8,AEDEMLST                                                      
                                                                                
         BRAS  RE,CHKDUPD          CHECK FOR DUPLICATE AGE/SEX                  
                                                                                
         L     R8,AEDEMLST         POINT TO ESTIMATE DEMO LIST                  
         BRAS  RE,GETDEMO          GET DEMO                                     
         L     R5,FULL                                                          
         MVC   APOSCATV,BYTE       CATEGORY POSITION (OFFSET)                   
                                                                                
         MVC   BYTE,0(R5)                                                       
         EDIT  BYTE,NTTADNAD,FILL=0   NAD CATEGORY                              
         MVC   NTTADMOD,1(R5)         MODIFIER                                  
         MVC   BYTE,2(R5)                                                       
         EDIT  BYTE,NTTADASC,FILL=0   AGE SEX CATEGORY                          
                                                                                
         MVI   3(R5),C'X'          FINISHED PROCESSING THIS PRODUCT             
         AHI   R5,4                                                             
                                                                                
UNAD05   CLI   0(R5),X'FF'         END OF LIST?                                 
         BE    UNAD10                                                           
         CLI   2(R5),0             COMSCORE?                                    
         BNE   *+8                                                              
         MVI   3(R5),C'X'          MARK IT PROCESSED SO IT SKIPS                
         CLI   3(R5),C'X'          ALREADY PROCESSED?                           
         BNE   *+12                                                             
         AHI   R5,4                                                             
         B     UNAD05                                                           
                                                                                
UNAD10   ST    R5,ACURDEMO                                                      
         LA    RF,RAWDEMOS     DO RAW VALUES                                    
         ST    RF,ANDEMOV                                                       
         BRAS  RE,GETCATV          GET THIS CATEGORY'S DEMO VALUES              
         L     R5,ACURCATV                                                      
                                                                                
         SR    RF,RF               RATING                                       
         ICM   RF,3,2(R5)                                                       
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK                                      
         BNE   UNAD15                                                           
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNAD15                                                           
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNAD15   EDIT  FULL,NTTADRRA,2,ALIGN=LEFT,ZERO=NOBLANK                          
         L     RF,FULL                                                          
         C     RF,=F'10000'      OVER 100%?                                     
         BL    *+10                                                             
         MVC   NTTADRRA(11),=C'00.00      '                                     
                                                                                
         L     RF,4(R5)                                                         
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNAD20                                                           
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNAD20                                                           
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNAD20   EDIT  FULL,NTTADIRA,1,ALIGN=LEFT,ZERO=NOBLANK                          
                                                                                
         LA    RF,EQVDEMOS     DO EQUIVALENCY VALUES                            
         ST    RF,ANDEMOV                                                       
         BRAS  RE,GETCATV          GET THIS CATEGORY'S DEMO VALUES              
         L     R5,ACURCATV                                                      
                                                                                
         SR    RF,RF               RATING                                       
         ICM   RF,3,2(R5)                                                       
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNAD25                                                           
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNAD25                                                           
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNAD25   EDIT  FULL,NTTADREQ,2,ALIGN=LEFT,ZERO=NOBLANK                          
         L     RF,FULL                                                          
         C     RF,=F'10000'       OVER 100%?                                    
         BL    *+10                                                             
         MVC   NTTADREQ(11),=C'00.00      '                                     
                                                                                
         L     RF,4(R5)                                                         
         ST    RF,FULL                                                          
                                                                                
         CLI   SVPREOPT,C'N'       NETWORK?                                     
         BNE   UNAD30                                                           
         TM    AGYFLG2,AGYFLG2_2DP+AGYFLG2_BDP                                  
         BNZ   UNAD30                                                           
         SR    R6,R6                                                            
         L     R7,FULL                                                          
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
                                                                                
UNAD30   EDIT  FULL,NTTADIEQ,1,ALIGN=LEFT,ZERO=NOBLANK                          
                                                                                
         MVI   NTTADAGY-1,MXTRTQ                                                
         MVI   NTTADUID-1,MXTRTQ                                                
         MVI   NTTADNAD-1,MXTRTQ                                                
         MVI   NTTADASC-1,MXTRTQ                                                
         MVI   NTTADMOD-1,MXTRTQ                                                
         MVI   NTTADRRA-1,MXTRTQ                                                
         MVI   NTTADREQ-1,MXTRTQ                                                
         MVI   NTTADIRA-1,MXTRTQ                                                
         MVI   NTTADIEQ-1,MXTRTQ                                                
         MVI   NTTADDX,MXTRTQ                                                   
         MVI   NTTADDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTADAGY,MXTRT                                                   
         TR    NTTADNAD,MXTRT                                                   
         TR    NTTADASC,MXTRT                                                   
         TR    NTTADMOD,MXTRT                                                   
         TR    NTTADRRA,MXTRT                                                   
         TR    NTTADREQ,MXTRT                                                   
         TR    NTTADIRA,MXTRT                                                   
         TR    NTTADIEQ,MXTRT                                                   
                                                                                
UNITADLX J     EXIT                                                             
UADLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD ESTIMATE DEMO LIST                                                      
***********************************************************************         
BLDEDL   NTR1  BASE=*,LABEL=*                                                   
         L     RE,ABIGWORK                                                      
         LA    RE,200(RE)                                                       
         LA    RF,2000                                                          
         XCEF                                                                   
                                                                                
         L     R5,ABIGWORK                                                      
         LA    R5,200(R5)                                                       
         MVI   0(R5),X'FF'                                                      
         ST    R5,ACURDEMO         SET FIRST DEMO DEFAULT                       
                                                                                
         LA    R3,DEMOLIST         ESTIMATE DEMO LIST FROM EST REC              
         LA    R4,50                                                            
                                                                                
BLDEDL05 OC    0(3,R3),0(R3)       ANY MORE DEMOS?                              
         BZ    BLDEDLX                                                          
         MVC   0(3,R5),0(R3)                                                    
         AHI   R5,4                                                             
         AHI   R3,3                                                             
         BCT   R4,BLDEDL05                                                      
                                                                                
BLDEDLX  MVI   0(R5),X'FF'         DENOTE END OF TABLE                          
         J     EXIT                                                             
***********************************************************************         
* GET AIC COST                                                                  
* ON EXIT, FULL WILL HAVE THE AIC COST                                          
***********************************************************************         
GETAIC   NTR1  BASE=*,LABEL=*                                                   
         OC    FULL,FULL           ANY MAX COST?                                
         BZ    GETAICX                                                          
                                                                                
         L     R6,FULL                                                          
         L     R5,CHAR8            SAVED AWAY ACTUAL COST                       
         SR    R6,R5               AIC COST = MAX COST - ACTUAL COST            
         ST    R6,FULL                                                          
                                                                                
GETAICX  J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* FULL HAS THE FULL WORD TO CONVERT FOR FEED PERCENTAGE                         
* HALF HAS FEED PERCENTAGE                                                      
* ON EXIT, FULL WILL THE PERCENTAGE OF COST                                     
***********************************************************************         
GETCST   NTR1  BASE=*,LABEL=*                                                   
         ZAP   DUB,=P'0'                                                        
                                                                                
         L     RF,FULL             COST                                         
         CVD   RF,DUB                                                           
         ZAP   WORK(16),DUB                                                     
                                                                                
         LH    RF,HALF             PERCENTAGE                                   
         CVD   RF,DUB                                                           
                                                                                
         MP    WORK(16),DUB        COST X PERCENTAGE                            
         SRP   WORK(16),64-4,0                                                  
                                                                                
         ZAP   DUB,WORK(16)                                                     
                                                                                
GETCSTX  J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* R8 IS EXPECTED TO ADDRESS BIGWORK (DEMLIST)                                   
* ON EXIT, FULL WILL CONTAIN THE ADDRESS OF PROD IN TABLE                       
***********************************************************************         
GETPROD  NTR1  BASE=*,LABEL=*                                                   
         XC    FULL,FULL                                                        
         L     R5,ABIGWORK                                                      
         LA    R5,200(R5)           POINT TO PRODUCT TABLE                      
                                                                                
GETPRD05 CLC   0(2,R5),=XL2'FFFF'   END OF TABLE?                               
         BE    GETPRDX                                                          
                                                                                
         CLI   9(R5),0              PROCESSED THIS ONE YET?                     
         BE    GETPRD10                                                         
         LA    R5,10(R5)                                                        
         B     GETPRD05                                                         
                                                                                
GETPRD10 ST    R5,FULL              SAVE AWAY ADDRESS IN TABLE                  
GETPRDX  J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BYTE CONTAINS 1 BYTE PRODUCT CODE                                             
* R8 IS EXPECTED TO ADDRESS PLIST                                               
* ON EXIT FULL CONTAINS 3 BYTE PRODUCT CODE                                     
***********************************************************************         
GETAPRD  NTR1  BASE=*,LABEL=*                                                   
         L     R5,APLIST                                                        
         LA    R0,880(R5)                                                       
                                                                                
GETAP05  CLC   BYTE,3(R5)                                                       
         BE    GETAPRDX                                                         
         AHI   R5,4                                                             
         CR    R5,R0                                                            
         BNH   GETAP05                                                          
                                                                                
         L     R5,APLIST2                                                       
         LA    R0,140(R5)                                                       
                                                                                
GETAP10  CLC   BYTE,3(R5)                                                       
         BE    GETAPRDX                                                         
         AHI   R5,4                                                             
         CR    R5,R0                                                            
         BNH   GETAP10                                                          
         J     EXIT                                                             
                                                                                
GETAPRDX MVC   FULL(3),0(R5)                                                    
         J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* BYTE IS EXPECTED TO HAVE A/M                                                  
* ON EXIT, BYTE CONTAINS MEDIA CODE                                             
**********************************************************************          
GETMED   NTR1  BASE=*,LABEL=*                                                   
         NI    BYTE,X'0F'             TURN OFF AGENCY BITS                      
                                                                                
         LA    R5,MEDTAB                                                        
GETMED05 CLC   BYTE,1(R5)                                                       
         BE    GETMED10                                                         
         AHI   R5,MEDTABLQ                                                      
         CLI   0(R5),X'FF'                                                      
         BNE   GETMED05                                                         
GETMED10 MVC   BYTE,0(R5)         COPY MEDIA CODE TO REPORT                     
         J     EXIT                                                             
                                                                                
MEDTAB   DS    0X                                                               
         DC    CL1'T',XL1'01'                                                   
MEDTABLQ EQU   *-MEDTAB                                                         
         DC    CL1'R',XL1'02'                                                   
         DC    CL1'N',XL1'03'                                                   
         DC    CL1'X',XL1'04'                                                   
         DC    CL1'C',XL1'08'                                                   
         DC    X'FF'                                                            
         EJECT                                                                  
***********************************************************************         
* EXTRACT GOAL RECORD (SPOT FILE)                                               
***********************************************************************         
NTTGOL   NMOD1 WORKL,*NTTGOL*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTGOLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AGOALREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
         MVC   DATADISP,=H'24'                                                  
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         MVC   VGETBRD,50(R8)      A(GETBROAD)                                  
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDGOL              BUILD THE GOAL TABLES                        
         J     GOALOUT             OUTPUT UNIT RECORD                           
                                                                                
NTTGOLIT DC    A(LITERAL)                                                       
NTXGOLC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
         LTORG                                                                  
         EJECT                                                                  
                                                                                
BLDGOL   L     R2,NTXGOLC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         L     R3,AGOALREC                                                      
         USING GOALHDRD,R3                                                      
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY                                                    
                                                                                
         MVC   CKEYAM,GKEYAM       AGY/MEDIA                                    
         MVC   CKEYCLT,GKEYCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO              GET ADDRESS OF PRODUCT LIST                 
         LA    R5,CLIST                                                         
         ST    R5,APLIST                                                        
         LA    R5,MYIO                                                          
         LA    R5,CLIST2                                                        
         ST    R5,APLIST2                                                       
         DROP  R5                                                               
                                                                                
         LA    R5,TEMPKEY                                                       
         USING NDPTHDR,R5                                                       
         XC    TEMPKEY,TEMPKEY     GET AGY OR CLIENT LEVEL DAYPART              
                                                                                
         MVC   NDPTKTYP,=X'0D07'                                                
         MVC   NDPTAGM,GKEYAM      AGENCY MEDIA                                 
         MVC   NDPTDPTE,GKEYDPT    DAYPART EQUATE                               
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'UNTDIR',TEMPKEY,UNTKEY,WORK          
         CLC   UNTKEY(6),TEMPKEY                                                
         BE    BLDGOL05                                                         
                                                                                
         XC    TEMPKEY,TEMPKEY                                                  
                                                                                
         MVC   NDPTKTYP,=X'0D07'                                                
         MVC   NDPTAGM,GKEYAM      AGENCY MEDIA                                 
         MVC   NDPTCLT,GKEYCLT     CLIENT                                       
         MVC   NDPTDPTE,GKEYDPT    DAYPART EQUATE                               
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'UNTDIR',TEMPKEY,UNTKEY,WORK          
                                                                                
BLDGOL05 LA    R5,UNTKEY                                                        
         MVC   SVDPTA,NDPTDPTA     2 CHAR DAYPART                               
         DROP  R5                                                               
                                                                                
BLDGOL10 L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
                                                                                
         BRAS  RE,GOALHDR          BUILD UNIT TABLE                             
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'21'                                                     
         BRAS  RE,GETEL                                                         
         BNE   BLDGOALX                                                         
                                                                                
BLDGOL15 CLI   0(R6),X'21'                                                      
         BNE   BLDGOALX                                                         
         ST    R6,ACURWK                                                        
                                                                                
         BRAS  RE,GOALWEEK                                                      
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         L     R6,ACURWK           BUMP TO NEXT ELEMENT                         
         ZIC   RF,1(R6)                                                         
         AR    R6,RF                                                            
         B     BLDGOL15                                                         
                                                                                
BLDGOALX L     R2,NTXGOLC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD GOAL HEADER RECORD                                                      
***********************************************************************         
GOALHDR  NTR1  BASE=*,LABEL=*                                                   
         L     RA,GOLHDLIT                                                      
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTGHDD,R2                                                       
         LA    R1,NTTGHDL                                                       
         BRAS  RE,INITGOL                                                       
         L     R8,ABIGWORK                                                      
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTGHDD,R2                                                       
         L     R3,AGOALREC                                                      
         USING GOALHDRD,R3                                                      
                                                                                
         XC    NTTGHLEN,NTTGHLEN                                                
         MVC   NTTGHLEN(2),=AL2(NTTGHDL)                                        
         MVC   NTTGHTYP,NTGHQ                                                   
         MVC   NTTGHAGY,SXDTAGY             ALPHA AGENCY                        
         MVC   NTTGHUID(L'GKEY),0(R8)       GOAL ID                             
                                                                                
         MVC   BYTE,GKEYAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTTGHMED,BYTE                MEDIA                               
                                                                                
         LA    R5,MYIO                                                          
         USING CLTHDR,R5                                                        
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,GKEYCLT),NTTGHCNT   CLIENT                    
         DROP  R5                                                               
                                                                                
         MVI   NTTGHPLN,C'N'                                                    
         TM    GKEYAGY,GKEYTAR        PLANNED GOALS?                            
         BZ    *+8                                                              
         MVI   NTTGHPLN,C'Y'                                                    
                                                                                
         MVC   BYTE,GKEYPRD                                                     
         BRAS  RE,GETAPRD                                                       
         MVC   NTTGHPRD,FULL                PRODUCT CODE                        
                                                                                
         EDIT  GKEYEST,NTTGHEST,FILL=0      ESTIMATE                            
         MVC   NTTGHDPT,SVDPTA              DAYPART                             
         EDIT  GKEYSLN,NTTGHSEC,FILL=0      SECONDS                             
                                                                                
         CLC   GKEYMKT,=X'0309'       DEFAULT TO NETWORK                        
         BNE   *+12                   0777                                      
         MVI   NTTGHNET,C'N'                                                    
         B     GOLHDRX                                                          
                                                                                
         CLC   GKEYMKT,=X'0306'       SYNDICATION?                              
         BNE   *+12                                                             
         MVI   NTTGHNET,C'S'                                                    
         B     GOLHDRX                                                          
                                                                                
         CLC   GKEYMKT,=X'0307'       CABLE?                                    
         BNE   *+12                                                             
         MVI   NTTGHNET,C'C'                                                    
         B     GOLHDRX                                                          
                                                                                
         LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'20'        DESCRIPTION ELEMENT                          
         BRAS  RE,GETEL                                                         
         BNE   GOLHDRX                                                          
         USING GDELEM,R6                                                        
                                                                                
         OC    GDNETWK,GDNETWK                                                  
         BZ    GOLHDRX                                                          
         MVC   NTTGHNET(4),GDNETWK    NETWORK                                   
         MVI   NTTGHNET+4,C'N'                                                  
         DROP  R6                                                               
                                                                                
GOLHDRX  MVI   NTTGHAGY-1,MXTRTQ                                                
         MVI   NTTGHUID-1,MXTRTQ                                                
         MVI   NTTGHMED-1,MXTRTQ                                                
         MVI   NTTGHCNT-1,MXTRTQ                                                
         MVI   NTTGHPRD-1,MXTRTQ                                                
         MVI   NTTGHNET-1,MXTRTQ                                                
         MVI   NTTGHEST-1,MXTRTQ                                                
         MVI   NTTGHDPT-1,MXTRTQ                                                
         MVI   NTTGHSEC-1,MXTRTQ                                                
         MVI   NTTGHPLN-1,MXTRTQ                                                
         MVI   NTTGHDX,MXTRTQ                                                   
         MVI   NTTGHDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTGHAGY,MXTRT                                                   
         TR    NTTGHMED,MXTRT                                                   
         TR    NTTGHCNT,MXTRT                                                   
         TR    NTTGHPRD,MXTRT                                                   
         TR    NTTGHNET,MXTRT                                                   
         TR    NTTGHEST,MXTRT                                                   
         TR    NTTGHDPT,MXTRT                                                   
         TR    NTTGHSEC,MXTRT                                                   
         TR    NTTGHPLN,MXTRT                                                   
         J     EXIT                                                             
                                                                                
GOLHDLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* BUILD GOAL WEEKLY RECORD                                                      
***********************************************************************         
GOALWEEK NTR1  BASE=*,LABEL=*                                                   
         L     RA,GOLWKLIT                                                      
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTGDDD,R2                                                       
         LA    R1,NTTGHDL                                                       
         BRAS  RE,INITGOL                                                       
         L     R8,ABIGWORK                                                      
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTGDDD,R2                                                       
         L     R3,ACURWK                                                        
         USING GLEMENT,R3                                                       
                                                                                
         XC    NTTGDLEN,NTTGDLEN                                                
         MVC   NTTGDLEN(2),=AL2(NTTGDDL)                                        
         MVC   NTTGDTYP,NTGDQ                                                   
         MVC   NTTGDAGY,SXDTAGY             ALPHA AGENCY                        
         MVC   NTTGDUID(L'GKEY),0(R8)       GOAL ID                             
                                                                                
         XC    NTTGDDOL,NTTGDDOL                                                
         XC    NTTGDRP1,NTTGDRP1                                                
         XC    NTTGDRP2,NTTGDRP2                                                
         XC    NTTGDRP3,NTTGDRP3                                                
                                                                                
         MVC   NTTGDDOL(4),=C'0.00'    INITIALIZE VALUES                        
         MVC   NTTGDRP1(4),=C'0.00'    INITIALIZE VALUES                        
         MVC   NTTGDRP2(4),=C'0.00'    INITIALIZE VALUES                        
         MVC   NTTGDRP3(4),=C'0.00'    INITIALIZE VALUES                        
                                                                                
         GOTO1 DATCON,DMCB,(2,GLWEEK),(10,NTTGDWK)                              
         GOTO1 DATCON,DMCB,(2,GLWEEK),(0,WORK)                                  
         GOTO1 VGETBRD,DMCB,WORK,WORK+10,VGETDAY,VADDAY                         
                                                                                
         XC    DUB,DUB                                                          
         MVC   DUB(6),WORK+16      END OF BROADCAST MONTH                       
         MVC   DUB+4(2),=C'01'     DEFAULT TO FIRST OF THE MONTH                
                                                                                
         GOTO1 DATCON,DMCB,(0,DUB),(10,NTTGDBM)                                 
         EDIT  GLBUDGET,NTTGDDOL,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-              
                                                                                
         OC    GLGRP,GLGRP                                                      
         BZ    GOLWK05                                                          
                                                                                
         XC    FULL,FULL                                                        
         SR    R6,R6                                                            
         ICM   R7,15,GLGRP                                                      
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
         EDIT  FULL,NTTGDRP1,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                  
                                                                                
GOLWK05  CLI   GLEN,GLEN1Q                                                      
         BE    GOLWKX                                                           
         OC    GLGRP2,GLGRP2                                                    
         BZ    GOLWK10                                                          
                                                                                
         XC    FULL,FULL                                                        
         SR    R6,R6                                                            
         ICM   R7,15,GLGRP2                                                     
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
         EDIT  FULL,NTTGDRP2,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                  
                                                                                
GOLWK10  CLI   GLEN,GLEN3Q                                                      
         BNH   GOLWKX                                                           
         OC    GLGRP3,GLGRP3                                                    
         BZ    GOLWKX                                                           
                                                                                
         XC    FULL,FULL                                                        
         SR    R6,R6                                                            
         ICM   R7,15,GLGRP3                                                     
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
         EDIT  FULL,NTTGDRP3,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                  
                                                                                
GOLWKX   MVI   NTTGDAGY-1,MXTRTQ                                                
         MVI   NTTGDUID-1,MXTRTQ                                                
         MVI   NTTGDWK-1,MXTRTQ                                                 
         MVI   NTTGDBM-1,MXTRTQ                                                 
         MVI   NTTGDDOL-1,MXTRTQ                                                
         MVI   NTTGDRP1-1,MXTRTQ                                                
         MVI   NTTGDRP2-1,MXTRTQ                                                
         MVI   NTTGDRP3-1,MXTRTQ                                                
         MVI   NTTGDDX,MXTRTQ                                                   
         MVI   NTTGDDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTGDAGY,MXTRT                                                   
         TR    NTTGDWK,MXTRT                                                    
         TR    NTTGDBM,MXTRT                                                    
         TR    NTTGDDOL,MXTRT                                                   
         TR    NTTGDRP1,MXTRT                                                   
         TR    NTTGDRP2,MXTRT                                                   
         TR    NTTGDRP3,MXTRT                                                   
         J     EXIT                                                             
                                                                                
GOLWKLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
         EJECT                                                                  
                                                                                
GOALOUT  L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
GOALOUTX J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
                                                                                
INITGOL  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
                                                                                
         L     R3,ADXAXREC                                                      
         USING NTTGHDD,R3                                                       
                                                                                
         MVI   NTTGHACT-1,MXTRTQ                                                
         MVI   NTTGHDAT-1,MXTRTQ                                                
         MVI   NTTGHTME-1,MXTRTQ                                                
                                                                                
         MVC   NTTGHLEN,SVLEN                                                   
         MVC   NTTGHTYP,SVTYP                                                   
         MVC   NTTGHACT,SVACT                                                   
         MVC   NTTGHDAT,SVDAT                                                   
         MVC   NTTGHTME,SVTME                                                   
         DROP  R3                                                               
                                                                                
INITGOLX J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* NTTPDG - PRODUCT GROUP                                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GOAL RECORD)                                                  *         
* AL4 A(BIGWORK)                                                      *         
***********************************************************************         
NTTPDG   NMOD1 WORKL,*NTTPDG*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTPDGIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,APDGREC                                                       
*                                                                               
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
*                                                                               
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
*                                                                               
         CLI   8(R1),1                                                          
         JE    BLDPDG              BUILD THE PRODUCT GROUP TABLES               
         J     PDGOUT              OUTPUT THE RECORD                            
*                                                                               
NTTPDGIT DC    A(LITERAL)                                                       
         DS    F                                                                
NTXPDGC  DC    A(BUFFER1)          OUTPUT BUFFER OF PDG TABLES                  
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD TABLES FROM PRODUCT GROUP RECORD                                        
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
BLDPDG   DS    0H                                                               
         L     R2,NTXPDGC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
*                                                                               
         L     R3,APDGREC                                                       
*                                                                               
         XC    SVBKLN1,SVBKLN1                                                  
         XC    SVBKLN2,SVBKLN2                                                  
         XC    SVBK1,SVBK1                                                      
         XC    SVBK2,SVBK2                                                      
         XC    SVBK3,SVBK3                                                      
*                                                                               
         XC    SPTKEY,SPTKEY                                                    
         LA    R5,SPTKEY                                                        
*                                                                               
         MVC   SPTKEY(6),0(R3)     GET GRP X'0000' RECORD                       
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         L     R5,AMYIO2                                                        
         USING PRGRECD,R5                                                       
*                                                                               
         LA    R5,PRGEL            1ST ELEMENT                                  
         DROP  R5                                                               
         USING PRGEL01,R5                                                       
*                                                                               
         MVC   SVBK1,PRGBK1        BREAK 1                                      
         MVC   SVBKLN1,PRGBK1LN                                                 
         MVC   SVBK2,PRGBK2        BREAK 2                                      
         MVC   SVBKLN2,PRGBK2LN                                                 
         MVC   SVBK3,PRGBK3        BREAK 3                                      
         MVC   SVBKLN3,PRGBK3LN                                                 
         DROP  R5                                                               
*                                                                               
         L     R3,APDGREC                                                       
         USING PRGRECD,R3                                                       
*                                                                               
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
*                                                                               
         BRAS  RE,PDGHDR           BUILD PRODUCT GROUP HEADER TABLE             
         DROP  R3                                                               
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         XC    SPTKEY,SPTKEY       BUILD PASSIVE PRODUCT KEYS                   
         LA    R5,SPTKEY                                                        
         USING PRGRECD,R5                                                       
*                                                                               
         L     R3,APDGREC                                                       
         MVC   PRGPTYP,=X'0D81'                                                 
         MVC   PRGPAGMD,2(R3)      AGENCY/MEDIA                                 
         MVC   PRGPCLT,3(R3)       CLIENT                                       
         MVC   PRGPID,5(R3)        GROUP ID                                     
         MVC   PRGPGRP,6(R3)       GROUP NUMBER                                 
         DROP  R5                                                               
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
BLDPD50  DS    0H                                                               
         L     R3,APDGREC                                                       
         CLC   SPTKEY+2(6),2(R3)                                                
         BNE   BLDPDGX                                                          
*                                                                               
         BRAS  RE,PDGPRD           BUILD PRODUCT GROUP PRODUCT ENTRY            
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRSEQ',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         B     BLDPD50                                                          
*                                                                               
BLDPDGX  DS    0H                                                               
         L     R2,NTXPDGC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD PRODUCT GROUP HEADER                                                    
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
PDGHDR   NTR1  BASE=*,LABEL=*                                                   
         L     RA,PDGLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTTPHD,R2                                                        
         LA    R1,NTTPHDL                                                       
         BRAS  RE,INITPDG                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTTPHD,R2                                                        
         L     R3,APDGREC          GOAL RECORD                                  
         USING PRGRECD,R3                                                       
*                                                                               
         XC    NTTPHLEN,NTTPHLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTPHLEN(2),=AL2(NTTPHDL)                                        
         MVC   NTTPHTYP,NTPHQ                                                   
*                                                                               
         MVI   NTTPHAGY-1,MXTRTQ                                                
         MVI   NTTPHMED-1,MXTRTQ                                                
         MVI   NTTPHCLT-1,MXTRTQ                                                
         MVI   NTTPHID-1,MXTRTQ                                                 
         MVI   NTTPHBK1-1,MXTRTQ                                                
         MVI   NTTPHNM1-1,MXTRTQ                                                
         MVI   NTTPHBK2-1,MXTRTQ                                                
         MVI   NTTPHNM2-1,MXTRTQ                                                
         MVI   NTTPHBK3-1,MXTRTQ                                                
         MVI   NTTPHNM3-1,MXTRTQ                                                
         MVI   NTTPHAD1-1,MXTRTQ                                                
         MVI   NTTPHAD2-1,MXTRTQ                                                
         MVI   NTTPHAD3-1,MXTRTQ                                                
         MVI   NTTPHAD4-1,MXTRTQ                                                
         MVI   NTTPHMPR-1,MXTRTQ                                                
         MVI   NTTPHDX,MXTRTQ                                                   
         MVI   NTTPHDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTTPHAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,PRGKAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTTPHMED,BYTE                MEDIA                               
*                                                                               
         XC    TMPKEY,TMPKEY                                                    
         LA    R5,TMPKEY                                                        
         USING CLTHDR,R5                                                        
*                                                                               
         MVC   CKEYAM,PRGKAGMD     AGY/MEDIA                                    
         MVC   CKEYCLT,PRGKCLT     CLIENT                                       
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',TMPKEY,TMPKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',TMPKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         L     R5,AMYIO2            GET ADDRESS OF PRODUCT LIST                 
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,PRGKCLT),NTTPHCLT   CLIENT                    
         DROP  R5                                                               
*                                                                               
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY,0(R3)                                                     
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
         MVC   NTTPHID(1),PRGKID   GROUP ID                                     
*                                                                               
         XC    FULL,FULL                                                        
         MVC   FULL(2),PRGKGRP                                                  
         UNPK  WORK(5),FULL(3)                                                  
*                                                                               
         ZIC   R5,SVBKLN1                                                       
         ZIC   R6,SVBKLN2                                                       
         AR    R5,R6               GET LENGTH OF ID                             
         STC   R5,SVIDLEN          SO WE CAN DISPLAY ID CORRECTLY               
*                                                                               
         BCTR  R5,0                                                             
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   NTTPHID+1(0),WORK   DISPLAY GROUP NUMBER                         
*                                                                               
         MVC   SVPGID,NTTPHID      SAVE FOR PRODUCT GROUP PRODUCTS              
*                                                                               
         CLI   SVBKLN1,0                                                        
         BE    *+10                                                             
         MVC   NTTPHBK1,SVBK1      BREAK 1                                      
*                                                                               
         CLI   SVBKLN2,0                                                        
         BE    *+10                                                             
         MVC   NTTPHBK2,SVBK2      BREAK 2                                      
*                                                                               
         CLI   SVBKLN3,0                                                        
         BE    *+10                                                             
         MVC   NTTPHBK3,SVBK3      BREAK 3                                      
*                                                                               
         MVC   DATADISP,=H'24'                                                  
         LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         BNE   PDG50                                                            
         USING PRGEL10,R6                                                       
*                                                                               
         MVC   NTTPHNM1,PRGNAM1    NAME 1                                       
         MVC   NTTPHNM2,PRGNAM2    NAME 2                                       
         MVC   NTTPHNM3,PRGNAM3    NAME 3                                       
         DROP  R6                                                               
*                                                                               
PDG50    DS    0H                                                               
         LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,GETEL                                                         
         BNE   PDG55                                                            
         USING PRGEL20,R6                                                       
*                                                                               
         MVC   NTTPHAD1,PRGADDR1   ADDRESS LINE 1                               
         MVC   NTTPHAD2,PRGADDR2   ADDRESS LINE 2                               
         MVC   NTTPHAD3,PRGADDR3   ADDRESS LINE 3                               
         MVC   NTTPHAD4,PRGADDR4   ADDRESS LINE 4                               
         DROP  R6                                                               
*                                                                               
PDG55    DS    0H                                                               
         LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'30'                                                     
         BRAS  RE,GETEL                                                         
         BNE   PDG200                                                           
         USING PRGEL30,R6                                                       
*                                                                               
         MVC   NTTPHMPR,PRGUSER    MASTER PRODUCT                               
         DROP  R3,R6                                                            
*                                                                               
PDG200   DS    0H                                                               
         TR    NTTPHAGY,MXTRT                                                   
         TR    NTTPHMED,MXTRT                                                   
         TR    NTTPHCLT,MXTRT                                                   
         TR    NTTPHID,MXTRT                                                    
         TR    NTTPHBK1,MXTRT                                                   
         TR    NTTPHNM1,MXTRT                                                   
         TR    NTTPHBK2,MXTRT                                                   
         TR    NTTPHNM2,MXTRT                                                   
         TR    NTTPHBK3,MXTRT                                                   
         TR    NTTPHNM3,MXTRT                                                   
         TR    NTTPHAD1,MXTRT                                                   
         TR    NTTPHAD2,MXTRT                                                   
         TR    NTTPHAD3,MXTRT                                                   
         TR    NTTPHAD4,MXTRT                                                   
         TR    NTTPHMPR,MXTRT                                                   
*                                                                               
PDGHDRX  DS    0H                                                               
         J     PDGXIT                                                           
*                                                                               
PDGLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD PRODUCT GROUP PRODUCT                                                   
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
PDGPRD   NTR1  BASE=*,LABEL=*                                                   
         L     RA,PGPLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTTPGD,R2                                                        
         LA    R1,NTTPGDL                                                       
         BRAS  RE,INITPDG                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTTPGD,R2                                                        
         LA    R3,SPTKEY           PRODUCT GROUP PRODUCT KEY                    
         USING PRGRECD,R3                                                       
*                                                                               
         XC    NTTPGLEN,NTTPGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTTPGLEN(2),=AL2(NTTPGDL)                                        
         MVC   NTTPGTYP,NTPGQ                                                   
*                                                                               
         MVI   NTTPGAGY-1,MXTRTQ                                                
         MVI   NTTPGMED-1,MXTRTQ                                                
         MVI   NTTPGCLT-1,MXTRTQ                                                
         MVI   NTTPGID-1,MXTRTQ                                                 
         MVI   NTTPGPRD-1,MXTRTQ                                                
         MVI   NTTPGDX,MXTRTQ                                                   
         MVI   NTTPGDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTTPGAGY,SXDTAGY             ALPHA AGENCY                        
         MVC   NTTPGID,SVPGID      PRODUCT GROUP ID                             
*                                                                               
         MVC   BYTE,PRGPAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTTPGMED,BYTE                MEDIA                               
*                                                                               
         XC    TMPKEY,TMPKEY                                                    
         LA    R5,TMPKEY                                                        
         USING CLTHDR,R5                                                        
*                                                                               
         MVC   CKEYAM,PRGPAGMD     AGY/MEDIA                                    
         MVC   CKEYCLT,PRGPCLT     CLIENT                                       
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',TMPKEY,TMPKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',TMPKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         L     R5,AMYIO2            GET ADDRESS OF PRODUCT LIST                 
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,PRGPCLT),NTTPGCLT    CLIENT                   
         DROP  R5                                                               
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
         MVC   NTTPGPRD,PRGPPRD    PRODUCT                                      
         DROP  R3                                                               
*                                                                               
PGP200   DS    0H                                                               
         TR    NTTPGAGY,MXTRT                                                   
         TR    NTTPGMED,MXTRT                                                   
         TR    NTTPGCLT,MXTRT                                                   
         TR    NTTPGID,MXTRT                                                    
         TR    NTTPGPRD,MXTRT                                                   
*                                                                               
PDGPRDX  DS    0H                                                               
         J     PDGXIT                                                           
*                                                                               
PGPLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
PDGOUT   DS    0H                                                               
         L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
*                                                                               
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
*                                                                               
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
PDGOUTX  DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* INITIALIZE DXAXREC FOR TABLE ENTRY                                            
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
INITPDG  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
*                                                                               
         L     R3,ADXAXREC                                                      
         USING NTTPHD,R3                                                        
*                                                                               
         MVI   NTTPHACT-1,MXTRTQ                                                
         MVI   NTTPHDAT-1,MXTRTQ                                                
         MVI   NTTPHTME-1,MXTRTQ                                                
*                                                                               
         MVC   NTTPHLEN,SVLEN                                                   
         MVC   NTTPHTYP,SVTYP                                                   
         MVC   NTTPHACT,SVACT                                                   
         MVC   NTTPHDAT,SVDAT                                                   
         MVC   NTTPHTME,SVTME                                                   
         DROP  R3                                                               
*                                                                               
INITPDGX DS    0H                                                               
         J     PDGXIT                                                           
         LTORG                                                                  
*                                                                               
PDGXIT   XIT1                                                                   
***********************************************************************         
* NTTSGR - STATION GROUP                                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GOAL RECORD)                                                  *         
* AL4 A(BIGWORK)                                                      *         
***********************************************************************         
NTTSGR   NMOD1 WORKL,*NTTSGR*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTSGRIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,ASGRREC                                                       
*                                                                               
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
*                                                                               
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
*                                                                               
         CLI   8(R1),1                                                          
         JE    BLDSGR              BUILD THE PRODUCT GROUP TABLES               
         J     SGROUT              OUTPUT THE RECORD                            
*                                                                               
NTTSGRIT DC    A(LITERAL)                                                       
         DS    F                                                                
NTXSGRC  DC    A(BUFFER1)          OUTPUT BUFFER OF SGR TABLES                  
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD TABLES FROM PRODUCT GROUP RECORD                                        
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
BLDSGR   DS    0H                                                               
         L     R2,NTXSGRC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
*                                                                               
         L     R3,ASGRREC                                                       
*                                                                               
         XC    SVBKLN1,SVBKLN1                                                  
         XC    SVBKLN2,SVBKLN2                                                  
         XC    SVBK1,SVBK1                                                      
         XC    SVBK2,SVBK2                                                      
         XC    SVBK3,SVBK3                                                      
*                                                                               
         XC    SPTKEY,SPTKEY                                                    
         LA    R5,SPTKEY                                                        
*                                                                               
         MVC   SPTKEY(4),0(R3)     GET GRP X'0000' RECORD                       
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         L     R5,AMYIO2                                                        
         USING GRPRECD,R5                                                       
*                                                                               
         LA    R5,GRPEL            1ST ELEMENT                                  
         DROP  R5                                                               
         USING GRPBRKD,R5                                                       
*                                                                               
         MVC   SVBK1,GRPBK1        BREAK 1                                      
         MVC   SVBKLN1,GRPBK1LN                                                 
         MVC   SVBK2,GRPBK2        BREAK 2                                      
         MVC   SVBKLN2,GRPBK2LN                                                 
         DROP  R5                                                               
*                                                                               
         L     R3,ASGRREC                                                       
         USING GRPRECD,R3                                                       
*                                                                               
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
*                                                                               
         BRAS  RE,SGRDEF           BUILD STATION GROUP DEFINITION               
         DROP  R3                                                               
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVC   SVSPTKEY,SPTKEY                                                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRSEQ',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
BLDSG50  DS    0H                                                               
         CLC   SPTKEY(4),SVSPTKEY  SAME GROUP ID?                               
         BNE   BLDSGRX                                                          
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         BRAS  RE,SGRGRP           BUILD STATION GROUPS                         
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         L     R6,AMYIO2                                                        
         MVI   ELCODE,X'30'                                                     
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
BLDSG60  BRAS  RE,NEXTEL                                                        
         BNE   BLDSG90                                                          
*                                                                               
         ST    R6,ASGSTEL                                                       
         BRAS  RE,SGRSTA           BUILD STATION GROUPS                         
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
         B     BLDSG60                                                          
*                                                                               
BLDSG90  DS    0H                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRSEQ',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         B     BLDSG50                                                          
*                                                                               
BLDSG100 DS    0H                                                               
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY(13),SVSPTKEY                                              
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
BLDSGRX  DS    0H                                                               
         L     R2,NTXSGRC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD STATION GROUP DEFINITION                                                
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
SGRDEF   NTR1  BASE=*,LABEL=*                                                   
         L     RA,SGDLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTSGDD,R2                                                        
         LA    R1,NTSGDDL                                                       
         BRAS  RE,INITSGR                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTSGDD,R2                                                        
         L     R3,ASGRREC          GOAL RECORD                                  
         USING GRPRECD,R3                                                       
*                                                                               
         XC    NTSGDLEN,NTSGDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTSGDLEN(2),=AL2(NTSGDDL)                                        
         MVC   NTSGDTYP,NTSGDQ                                                  
*                                                                               
         MVI   NTSGDAGY-1,MXTRTQ                                                
         MVI   NTSGDMED-1,MXTRTQ                                                
         MVI   NTSGDID-1,MXTRTQ                                                 
         MVI   NTSGDD1-1,MXTRTQ                                                 
         MVI   NTSGDLN1-1,MXTRTQ                                                
         MVI   NTSGDD2-1,MXTRTQ                                                 
         MVI   NTSGDLN2-1,MXTRTQ                                                
         MVI   NTSGDDX,MXTRTQ                                                   
         MVI   NTSGDDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTSGDAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,GRPKAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTSGDMED,BYTE                MEDIA                               
*                                                                               
         MVC   NTSGDID(1),GRPKID   GROUP ID                                     
*                                                                               
         CLI   SVBKLN1,0                                                        
         BE    SGD50                                                            
         MVC   NTSGDD1,SVBK1      BREAK 1                                       
         EDIT  SVBKLN1,NTSGDLN1,FILL=0      L'BREAK1                            
*                                                                               
SGD50    CLI   SVBKLN2,0                                                        
         BE    SGD200                                                           
         MVC   NTSGDD2,SVBK2      BREAK 2                                       
         EDIT  SVBKLN2,NTSGDLN2,FILL=0      L'BREAK2                            
*                                                                               
         DROP  R3                                                               
*                                                                               
SGD200   DS    0H                                                               
         TR    NTSGDAGY,MXTRT                                                   
         TR    NTSGDMED,MXTRT                                                   
         TR    NTSGDID,MXTRT                                                    
         TR    NTSGDD1,MXTRT                                                    
         TR    NTSGDLN1,MXTRT                                                   
         TR    NTSGDD2,MXTRT                                                    
         TR    NTSGDLN2,MXTRT                                                   
*                                                                               
SGRDEFX  DS    0H                                                               
         J     SGRXIT                                                           
*                                                                               
SGDLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD STATIONG GROUPS                                                         
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
SGRGRP   NTR1  BASE=*,LABEL=*                                                   
         L     RA,SGGLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTSGGD,R2                                                        
         LA    R1,NTSGGDL                                                       
         BRAS  RE,INITSGR                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTSGGD,R2                                                        
         L     R3,AMYIO2            GOAL RECORD                                 
         USING GRPRECD,R3                                                       
*                                                                               
         XC    NTSGGLEN,NTSGGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTSGGLEN(2),=AL2(NTSGGDL)                                        
         MVC   NTSGGTYP,NTSGQ                                                   
*                                                                               
         MVI   NTSGGAGY-1,MXTRTQ                                                
         MVI   NTSGGMED-1,MXTRTQ                                                
         MVI   NTSGGID-1,MXTRTQ                                                 
         MVI   NTSGGGRP-1,MXTRTQ                                                
         MVI   NTSGGSGR-1,MXTRTQ                                                
         MVI   NTSGGC1-1,MXTRTQ                                                 
         MVI   NTSGGC2-1,MXTRTQ                                                 
         MVI   NTSGGN1-1,MXTRTQ                                                 
         MVI   NTSGGN2-1,MXTRTQ                                                 
         MVI   NTSGGDX,MXTRTQ                                                   
         MVI   NTSGGDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTSGGAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,GRPKAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTSGGMED,BYTE                MEDIA                               
*                                                                               
         MVC   NTSGGID(1),GRPKID   GROUP ID                                     
*                                                                               
         LA    R0,GRPKCODE                                                      
         LA    R1,NTSGGGRP                                                      
         BRAS  RE,GROUT                                                         
*                                                                               
         ZIC   R0,SVBKLN1                                                       
         ZIC   R1,SVBKLN2                                                       
         AR    R0,R1                                                            
         STC   R0,DUB                                                           
*                                                                               
         XC    FULL,FULL                                                        
         GOTO1 =V(HEXOUT),DMCB,GRPKCODE,FULL,L'GRPKCODE,=C'TOG',0               
         ZIC   RE,DUB                                                           
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   NTSGGSGR+1(0),FULL                                               
         MVC   NTSGGSGR(1),NTSGGID                                              
*                                                                               
         LA    R5,NTSGGGRP         STATION GROUP CODE                           
         ZIC   RF,SVBKLN1          SAVED BREAK LENGTHS                          
         BCTR  RF,0                                                             
         CHI   RF,0                                                             
         BL    SGRG40                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NTSGGC1(0),0(R5)                                                 
*                                                                               
         AHI   RF,1                                                             
         LA    R5,NTSGGGRP(RF)                                                  
         ZIC   RF,SVBKLN2                                                       
         BCTR  RF,0                                                             
         CHI   RF,0                                                             
         BL    SGRG40                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NTSGGC2(0),0(R5)                                                 
*                                                                               
SGRG40   LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'20'        BREAK NAMES                                  
         BRAS  RE,GETEL                                                         
         BNE   SGRG50                                                           
         USING GRPGRPD,R6                                                       
*                                                                               
         MVC   NTSGGN1,GRPGNAM1    GROUP NAME 1                                 
         MVC   NTSGGN2,GRPGNAM2    GROUP NAME 2                                 
         DROP  R6                                                               
*                                                                               
SGRG50   DS    0H                                                               
         TR    NTSGGAGY,MXTRT                                                   
         TR    NTSGGMED,MXTRT                                                   
         TR    NTSGGID,MXTRT                                                    
         TR    NTSGGGRP,MXTRT                                                   
         TR    NTSGGSGR,MXTRT                                                   
         TR    NTSGGC1,MXTRT                                                    
         TR    NTSGGC2,MXTRT                                                    
         TR    NTSGGN1,MXTRT                                                    
         TR    NTSGGN2,MXTRT                                                    
         TR    NTSGGDX,MXTRT                                                    
*                                                                               
SGRGRPX  DS    0H                                                               
         J     SGRXIT                                                           
*                                                                               
SGGLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R3                                                               
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD STATION GROUP STATIONS                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
SGRSTA   NTR1  BASE=*,LABEL=*                                                   
         L     RA,SGSLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTSGSD,R2                                                        
         LA    R1,NTSGSDL                                                       
         BRAS  RE,INITSGR                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTSGSD,R2                                                        
         L     R3,AMYIO2            GOAL RECORD                                 
         USING GRPRECD,R3                                                       
*                                                                               
         XC    NTSGSLEN,NTSGSLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTSGSLEN(2),=AL2(NTSGSDL)                                        
         MVC   NTSGSTYP,NTSGSQ                                                  
*                                                                               
         MVI   NTSGSAGY-1,MXTRTQ                                                
         MVI   NTSGSMED-1,MXTRTQ                                                
         MVI   NTSGSGRP-1,MXTRTQ                                                
         MVI   NTSGSSTA-1,MXTRTQ                                                
         MVI   NTSGSDX,MXTRTQ                                                   
         MVI   NTSGSDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTSGSAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,GRPKAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTSGSMED,BYTE                MEDIA                               
*                                                                               
         ZIC   R0,SVBKLN1                                                       
         ZIC   R1,SVBKLN2                                                       
         AR    R0,R1                                                            
         STC   R0,DUB                                                           
*                                                                               
         XC    FULL,FULL                                                        
         GOTO1 =V(HEXOUT),DMCB,GRPKCODE,FULL,L'GRPKCODE,=C'TOG',0               
         ZIC   RE,DUB                                                           
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   NTSGSGRP+1(0),FULL                                               
         MVC   NTSGSGRP(1),GRPKID                                               
*                                                                               
         L     R6,ASGSTEL                                                       
         USING GRPVALD,R6                                                       
*                                                                               
         MVC   NTSGSSTA,GRPVALUE   STATION                                      
         DROP  R6                                                               
*                                                                               
         TR    NTSGSAGY,MXTRT                                                   
         TR    NTSGSMED,MXTRT                                                   
         TR    NTSGSGRP,MXTRT                                                   
         TR    NTSGSSTA,MXTRT                                                   
         TR    NTSGSDX,MXTRT                                                    
*                                                                               
SGRSTAX  DS    0H                                                               
         J     SGRXIT                                                           
*                                                                               
SGSLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R3                                                               
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
SGROUT   DS    0H                                                               
         L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
*                                                                               
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
*                                                                               
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
SGROUTX  DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* INITIALIZE DXAXREC FOR TABLE ENTRY                                            
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
INITSGR  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
*                                                                               
         L     R3,ADXAXREC                                                      
         USING NTSGDD,R3                                                        
*                                                                               
         MVI   NTSGDACT-1,MXTRTQ                                                
         MVI   NTSGDDAT-1,MXTRTQ                                                
         MVI   NTSGDTME-1,MXTRTQ                                                
*                                                                               
         MVC   NTSGDLEN,SVLEN                                                   
         MVC   NTSGDTYP,SVTYP                                                   
         MVC   NTSGDACT,SVACT                                                   
         MVC   NTSGDDAT,SVDAT                                                   
         MVC   NTSGDTME,SVTME                                                   
         DROP  R3                                                               
*                                                                               
INITSGRX DS    0H                                                               
         J     SGRXIT                                                           
         LTORG                                                                  
*                                                                               
SGRXIT   XIT1                                                                   
         EJECT                                                                  
***********************************************************************         
* NTTCGR - CLIENT  GROUP                                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GOAL RECORD)                                                  *         
* AL4 A(BIGWORK)                                                      *         
***********************************************************************         
NTTCGR   NMOD1 WORKL,*NTTCGR*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTCGRIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,ACGRREC                                                       
*                                                                               
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
*                                                                               
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
*                                                                               
         CLI   8(R1),1                                                          
         JE    BLDCGR              BUILD THE PRODUCT GROUP TABLES               
         J     CGROUT              OUTPUT THE RECORD                            
*                                                                               
NTTCGRIT DC    A(LITERAL)                                                       
         DS    F                                                                
NTXCGRC  DC    A(BUFFER1)          OUTPUT BUFFER OF CGR TABLES                  
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD TABLES FROM CLIENT GROUP RECORD                                         
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
BLDCGR   DS    0H                                                               
         L     R2,NTXCGRC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
*                                                                               
         L     R3,ACGRREC                                                       
*                                                                               
         XC    SVBKLN1,SVBKLN1                                                  
         XC    SVBKLN2,SVBKLN2                                                  
         XC    SVBK1,SVBK1                                                      
         XC    SVBK2,SVBK2                                                      
         XC    SVBK3,SVBK3                                                      
*                                                                               
         XC    SPTKEY,SPTKEY                                                    
         LA    R5,SPTKEY                                                        
*                                                                               
         MVC   SPTKEY(4),0(R3)     GET GRP X'0000' RECORD                       
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         L     R5,AMYIO2                                                        
         USING CLGRECD,R5                                                       
*                                                                               
         MVC   SVBK1,CLGBK1        BREAK 1                                      
         MVC   SVBKLN1,CLGBK1LN                                                 
         MVC   SVBK2,CLGBK2        BREAK 2                                      
         MVC   SVBKLN2,CLGBK2LN                                                 
         DROP  R5                                                               
*                                                                               
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
*                                                                               
         BRAS  RE,CGRDEF           BUILD STATION GROUP DEFINITION               
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVC   SVSPTKEY,SPTKEY                                                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRSEQ',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
BLDCG50  DS    0H                                                               
         CLC   SPTKEY(4),SVSPTKEY  SAME GROUP ID?                               
         BNE   BLDCGRX                                                          
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         BRAS  RE,CGRGRP           BUILD STATION GROUPS                         
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         XC    TEMPKEY,TEMPKEY                                                  
         MVC   TEMPKEY(13),SPTKEY                                               
*                                                                               
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY(3),TEMPKEY   FIND CLIENT GROUP PASSIVES                   
         MVI   SPTKEY+1,X'86'                                                   
         MVC   SPTKEY+5(3),TEMPKEY+3                                            
         MVC   SVSPTKEY,SPTKEY                                                  
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
BLDCG60  CLC   SPTKEY(8),SVSPTKEY  SAME GROUP ID?                               
         BNE   BLDCG80                                                          
*                                                                               
         BRAS  RE,CGRCLT                                                        
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'DMRSEQ',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         B     BLDCG60                                                          
*                                                                               
BLDCG80  DS    0H                                                               
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY,TEMPKEY      RESTORE SEQUENCE                             
*                                                                               
         MVC   SVSPTKEY,SPTKEY                                                  
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
BLDCG90  DS    0H                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRSEQ',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         B     BLDCG50                                                          
*                                                                               
BLDCG100 DS    0H                                                               
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY(13),SVSPTKEY                                              
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
BLDCGRX  DS    0H                                                               
         L     R2,NTXCGRC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD CLIENT  GROUP DEFINITION                                                
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
CGRDEF   NTR1  BASE=*,LABEL=*                                                   
         L     RA,CGDLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTCGDD,R2                                                        
         LA    R1,NTCGDDL                                                       
         BRAS  RE,INITCGR                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTCGDD,R2                                                        
         L     R3,ACGRREC          GOAL RECORD                                  
         USING CLGRECD,R3                                                       
*                                                                               
         XC    NTCGDLEN,NTCGDLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTCGDLEN(2),=AL2(NTCGDDL)                                        
         MVC   NTCGDTYP,NTCGDQ                                                  
*                                                                               
         MVI   NTCGDAGY-1,MXTRTQ                                                
         MVI   NTCGDMED-1,MXTRTQ                                                
         MVI   NTCGDID-1,MXTRTQ                                                 
         MVI   NTCGDD1-1,MXTRTQ                                                 
         MVI   NTCGDLN1-1,MXTRTQ                                                
         MVI   NTCGDD2-1,MXTRTQ                                                 
         MVI   NTCGDLN2-1,MXTRTQ                                                
         MVI   NTCGDD3-1,MXTRTQ                                                 
         MVI   NTCGDLN3-1,MXTRTQ                                                
         MVI   NTCGDDX,MXTRTQ                                                   
         MVI   NTCGDDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTCGDAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,CLGKAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTCGDMED,BYTE                MEDIA                               
*                                                                               
         MVC   NTCGDID(1),CLGKID   GROUP ID                                     
*                                                                               
         LA    R1,NTCGDID                                                       
         ICM   R1,8,=C'C'                                                       
         BRAS  RE,GETGRP                                                        
*                                                                               
         CLI   SVBKLN1,0                                                        
         BE    CGD50                                                            
         MVC   NTCGDD1,SVBK1      BREAK 1                                       
         EDIT  SVBKLN1,NTCGDLN1,FILL=0      L'BREAK1                            
*                                                                               
CGD50    CLI   SVBKLN2,0                                                        
         BE    CGD200                                                           
         MVC   NTCGDD2,SVBK2      BREAK 2                                       
         EDIT  SVBKLN2,NTCGDLN2,FILL=0      L'BREAK2                            
         DROP  R3                                                               
*                                                                               
CGD200   DS    0H                                                               
         TR    NTCGDAGY,MXTRT                                                   
         TR    NTCGDMED,MXTRT                                                   
         TR    NTCGDID,MXTRT                                                    
         TR    NTCGDD1,MXTRT                                                    
         TR    NTCGDLN1,MXTRT                                                   
         TR    NTCGDD2,MXTRT                                                    
         TR    NTCGDLN2,MXTRT                                                   
         TR    NTCGDD3,MXTRT                                                    
         TR    NTCGDLN3,MXTRT                                                   
*                                                                               
CGRDEFX  DS    0H                                                               
         J     CGRXIT                                                           
*                                                                               
CGDLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD CLIENT GROUPS                                                           
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
CGRGRP   NTR1  BASE=*,LABEL=*                                                   
         L     RA,CGGLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTCGGD,R2                                                        
         LA    R1,NTCGGDL                                                       
         BRAS  RE,INITCGR                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTCGGD,R2                                                        
         L     R3,AMYIO2            GOAL RECORD                                 
         USING CLGRECD,R3                                                       
*                                                                               
         XC    NTCGGLEN,NTCGGLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTCGGLEN(2),=AL2(NTCGGDL)                                        
         MVC   NTCGGTYP,NTCGGQ                                                  
*                                                                               
         MVI   NTCGGAGY-1,MXTRTQ                                                
         MVI   NTCGGMED-1,MXTRTQ                                                
         MVI   NTCGGID-1,MXTRTQ                                                 
         MVI   NTCGGGRP-1,MXTRTQ                                                
         MVI   NTCGGCGR-1,MXTRTQ                                                
         MVI   NTCGGC1-1,MXTRTQ                                                 
         MVI   NTCGGC2-1,MXTRTQ                                                 
         MVI   NTCGGC3-1,MXTRTQ                                                 
         MVI   NTCGGN1-1,MXTRTQ                                                 
         MVI   NTCGGN2-1,MXTRTQ                                                 
         MVI   NTCGGN3-1,MXTRTQ                                                 
         MVI   NTCGGDX,MXTRTQ                                                   
         MVI   NTCGGDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTCGGAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,CLGKAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTCGGMED,BYTE                MEDIA                               
*                                                                               
         MVC   NTCGGID(1),CLGKID   GROUP ID                                     
*                                                                               
         LA    R1,NTCGGID                                                       
         ICM   R1,8,=C'C'                                                       
         BRAS  RE,GETGRP                                                        
*                                                                               
         LA    R0,CLGKGRP                                                       
         LA    R1,NTCGGGRP                                                      
         BRAS  RE,GROUT                                                         
*                                                                               
         ZIC   R0,SVBKLN1                                                       
         ZIC   R1,SVBKLN2                                                       
         AR    R0,R1                                                            
         STC   R0,DUB                                                           
*                                                                               
         LA    R4,NTCGGCGR                                                      
         MVC   0(2,R4),NTCGGID                                                  
         LA    R4,1(R4)                                                         
         CLI   0(R4),C' '                                                       
         BNH   *+8                                                              
         LA    R4,1(R4)                                                         
*                                                                               
         XC    FULL,FULL                                                        
         GOTO1 =V(HEXOUT),DMCB,CLGKGRP,FULL,L'CLGKGRP,=C'TOG',0                 
         ZIC   RE,DUB                                                           
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),FULL                                                     
*                                                                               
         LA    R5,NTCGGGRP         STATION GROUP CODE                           
         ZIC   RF,SVBKLN1          SAVED BREAK LENGTHS                          
         BCTR  RF,0                                                             
         CHI   RF,0                                                             
         BL    CGRG40                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NTCGGC1(0),0(R5)                                                 
*                                                                               
         AHI   RF,1                                                             
         LA    R5,NTCGGGRP(RF)                                                  
         ZIC   RF,SVBKLN2                                                       
         BCTR  RF,0                                                             
         CHI   RF,0                                                             
         BL    CGRG40                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NTCGGC2(0),0(R5)                                                 
*&&DO                                                                           
         AHI   RF,1                                                             
         LA    R5,NTCGGGRP(RF)                                                  
         ZIC   RF,SVBKLN2                                                       
         BCTR  RF,0                                                             
         CHI   RF,0                                                             
         BL    CGRG40                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NTCGGC3(0),0(R5)                                                 
*&&                                                                             
CGRG40   LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'20'        BREAK NAMES                                  
         BRAS  RE,GETEL                                                         
         BNE   CGRG50                                                           
         USING CLGMEMD,R6                                                       
*                                                                               
         MVC   NTCGGN1,CLGNAM1     GROUP NAME 1                                 
         MVC   NTCGGN2,CLGNAM2     GROUP NAME 2                                 
*        MVC   NTCGGN3,CLGNAM3     GROUP NAME 3                                 
         DROP  R6                                                               
*                                                                               
CGRG50   DS    0H                                                               
         TR    NTCGGAGY,MXTRT                                                   
         TR    NTCGGMED,MXTRT                                                   
         TR    NTCGGID,MXTRT                                                    
         TR    NTCGGGRP,MXTRT                                                   
         TR    NTCGGCGR,MXTRT                                                   
         TR    NTCGGC1,MXTRT                                                    
         TR    NTCGGC2,MXTRT                                                    
         TR    NTCGGC3,MXTRT                                                    
         TR    NTCGGN1,MXTRT                                                    
         TR    NTCGGN2,MXTRT                                                    
         TR    NTCGGN3,MXTRT                                                    
         TR    NTCGGDX,MXTRT                                                    
*                                                                               
CGRGRPX  DS    0H                                                               
         J     CGRXIT                                                           
*                                                                               
CGGLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R3                                                               
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* BUILD CLIENT GROUP CLIENTS                                                    
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
CGRCLT   NTR1  BASE=*,LABEL=*                                                   
         L     RA,CGCLIT                                                        
         USING LITERAL,RA                                                       
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTCGCD,R2                                                        
         LA    R1,NTCGCDL                                                       
         BRAS  RE,INITCGR                                                       
         L     R8,ABIGWORK                                                      
*                                                                               
         L     R2,ADXAXREC         BUILD PRODUCT HEADER ENTRY                   
         USING NTCGCD,R2                                                        
         LA    R3,SPTKEY           GOAL RECORD                                  
         USING CLGRECD,R3                                                       
*                                                                               
         XC    NTCGCLEN,NTCGCLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTCGCLEN(2),=AL2(NTCGCDL)                                        
         MVC   NTCGCTYP,NTCGCQ                                                  
*                                                                               
         MVI   NTCGCAGY-1,MXTRTQ                                                
         MVI   NTCGCMED-1,MXTRTQ                                                
         MVI   NTCGCGRP-1,MXTRTQ                                                
         MVI   NTCGCCLT-1,MXTRTQ                                                
         MVI   NTCGCDX,MXTRTQ                                                   
         MVI   NTCGCDX+1,MXTRTQ                                                 
*                                                                               
         MVC   NTCGCAGY,SXDTAGY             ALPHA AGENCY                        
*                                                                               
         MVC   BYTE,CLGCAGMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTCGCMED,BYTE                MEDIA                               
*                                                                               
         MVC   NTCGCGRP(1),CLGCID   GROUP ID                                    
*                                                                               
         LA    R1,NTCGCGRP                                                      
         ICM   R1,8,=C'C'                                                       
         BRAS  RE,GETGRP                                                        
*                                                                               
         ZIC   R0,SVBKLN1                                                       
         ZIC   R1,SVBKLN2                                                       
         AR    R0,R1                                                            
         STC   R0,DUB                                                           
*                                                                               
         LA    R4,NTCGCGRP                                                      
         LA    R4,1(R4)                                                         
         CLI   0(R4),C' '                                                       
         BNH   *+8                                                              
         LA    R4,1(R4)                                                         
*                                                                               
         XC    FULL,FULL                                                        
         GOTO1 =V(HEXOUT),DMCB,CLGCGRP,FULL,L'CLGCGRP,=C'TOG',0                 
         ZIC   RE,DUB                                                           
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),FULL                                                     
*                                                                               
         XC    TMPKEY,TMPKEY                                                    
         LA    R5,TMPKEY                                                        
         USING CLTHDR,R5                                                        
*                                                                               
         MVC   CKEYAM,CLGCAGMD     AGY/MEDIA                                    
         MVC   CKEYCLT,CLGCCLT     CLIENT                                       
*                                                                               
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',TMPKEY,TMPKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',TMPKEY+14,AMYIO2,   *        
               WORK                                                             
*                                                                               
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,CLGCCLT),NTCGCCLT    CLIENT                   
         DROP  R5                                                               
*                                                                               
         TR    NTCGCAGY,MXTRT                                                   
         TR    NTCGCMED,MXTRT                                                   
         TR    NTCGCGRP,MXTRT                                                   
         TR    NTCGCCLT,MXTRT                                                   
         TR    NTCGCDX,MXTRT                                                    
*                                                                               
CGRCLTX  DS    0H                                                               
         J     CGRXIT                                                           
*                                                                               
CGCLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
         DROP  R3                                                               
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
CGROUT   DS    0H                                                               
         L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
*                                                                               
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
*                                                                               
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
*                                                                               
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
*                                                                               
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
CGROUTX  DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
* INITIALIZE DXAXREC FOR TABLE ENTRY                                            
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = *         
INITCGR  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
*                                                                               
         L     R3,ADXAXREC                                                      
         USING NTCGDD,R3                                                        
*                                                                               
         MVI   NTCGDACT-1,MXTRTQ                                                
         MVI   NTCGDDAT-1,MXTRTQ                                                
         MVI   NTCGDTME-1,MXTRTQ                                                
*                                                                               
         MVC   NTCGDLEN,SVLEN                                                   
         MVC   NTCGDTYP,SVTYP                                                   
         MVC   NTCGDACT,SVACT                                                   
         MVC   NTCGDDAT,SVDAT                                                   
         MVC   NTCGDTME,SVTME                                                   
         DROP  R3                                                               
*                                                                               
INITCGRX DS    0H                                                               
         J     CGRXIT                                                           
         LTORG                                                                  
*                                                                               
CGRXIT   XIT1                                                                   
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =         
* R1 IS EXPECTED TO ADDRESS THE GROUP (AS IN RECORD KEY)                        
* R1 HIGH ORDER BYTE - 'C' FOR CLIENT, 'M' FOR MARKET                           
* ON EXIT, TWO BYTES AT 0(R1) WILL BE REPLACED WITH                             
* THE TWO-CHARACTER MARKET GROUP                                                
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =         
GETGRP   NTR1  BASE=*,LABEL=*                                                   
         STCM  R1,8,BYTE                                                        
*                                                                               
         LA    RE,SPCGRTAB                                                      
         LHI   RF,(SPCGRTBX-SPCGRTAB)/3                                         
*                                                                               
GETGRP50 DS    0H                                                               
         CLC   0(1,R1),2(RE)                                                    
         BE    *+16                                                             
         LA    RE,3(RE)                                                         
         BCT   RF,*-14                                                          
         J     NEQXIT                                                           
*                                                                               
         MVC   0(2,R1),0(RE)                                                    
         J     EQXIT                                                            
         LTORG                                                                  
       ++INCLUDE SPCGRTAB                                                       
*                                                                               
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =         
* R0 IS EXPECTED TO ADDRESS THE GROUP CODE (AS IN RECORD KEY)                   
* R1 IS EXPECTED TO ADDRESS THE OUTPUT AREA (4 BYTES AT LEAST)                  
* = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =         
GROUT    NTR1  BASE=*,LABEL=*                                                   
         LR    R2,R0                                                            
         LR    R3,R1                                                            
*                                                                               
         UNPK  DUB,0(3,R2)                                                      
*                                                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         LHI   R0,3                                                             
         LA    R1,SVBKLN1          SAVED BREAK LENGHTS                          
*                                                                               
         IC    RE,0(R1)                                                         
         AR    RF,RE                                                            
         LA    R1,1(R1)                                                         
         BCT   R0,*-10                                                          
*                                                                               
         BCTR  RF,0                                                             
         CHI   RF,0                                                             
         JL    NEQXIT                                                           
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),DUB+3                                                    
*                                                                               
         J     EQXIT                                                            
         LTORG                                                                  
***********************************************************************         
* EXTRACT GOALS XFILE                                                           
***********************************************************************         
NTTGXL   NMOD1 WORKL,*NTTGXL*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTGXLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AGOALREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
         MVC   DATADISP,=H'42'                                                  
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         MVC   VGETBRD,50(R8)      A(GETBROAD)                                  
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDGXL              BUILD THE GOAL TABLES                        
         J     GXLOUT                                                           
                                                                                
NTTGXLIT DC    A(LITERAL)                                                       
NTXGXLC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
         LTORG                                                                  
                                                                                
BLDGXL   L     R2,NTXGXLC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         L     R3,AGOALREC                                                      
         USING GOALHDRD,R3                                                      
                                                                                
         LA    R5,TEMPKEY                                                       
         USING NDPTHDR,R5                                                       
         XC    TEMPKEY,TEMPKEY     GET AGY OR CLIENT LEVEL DAYPART              
                                                                                
         MVC   NDPTKTYP,=X'0D07'                                                
         MVC   NDPTAGM,GXKEYAM      AGENCY MEDIA                                
         MVC   NDPTDPTE,GXKEYDPT    DAYPART EQUATE                              
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'UNTDIR',TEMPKEY,UNTKEY,WORK          
         CLC   UNTKEY(6),TEMPKEY                                                
         BE    BLDGX05                                                          
                                                                                
         XC    TEMPKEY,TEMPKEY                                                  
         MVC   NDPTKTYP,=X'0D07'                                                
         MVC   NDPTAGM,GXKEYAM      AGENCY MEDIA                                
         MVC   NDPTCLT,GXKEYCLT     CLIENT                                      
         MVC   NDPTDPTE,GXKEYDPT    DAYPART EQUATE                              
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'UNTDIR',TEMPKEY,UNTKEY,WORK          
                                                                                
BLDGX05  LA    R5,UNTKEY                                                        
         MVC   SVDPTA,NDPTDPTA     2 CHAR DAYPART                               
         DROP  R5                                                               
                                                                                
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
                                                                                
         BRAS  RE,GXLHDR           BUILD UNIT TABLE                             
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'21'                                                     
         BRAS  RE,GETEL                                                         
         BNE   BLDGXLX                                                          
                                                                                
BLDGX10  CLI   0(R6),X'21'                                                      
         BNE   BLDGXLX                                                          
         ST    R6,ACURWK                                                        
                                                                                
         BRAS  RE,GXLWEEK                                                       
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         L     R6,ACURWK           BUMP TO NEXT ELEMENT                         
         ZIC   RF,1(R6)                                                         
         AR    R6,RF                                                            
         B     BLDGX10                                                          
                                                                                
BLDGXLX  L     R2,NTXGXLC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* BUILD GOAL HEADER RECORD                                                      
***********************************************************************         
GXLHDR   NTR1  BASE=*,LABEL=*                                                   
         L     RA,GXLHLIT                                                       
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTGXHDD,R2                                                       
         LA    R1,NTGXHDL                                                       
         BRAS  RE,INITGXL                                                       
         L     R8,ABIGWORK                                                      
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTGXHDD,R2                                                       
         L     R3,AGOALREC                                                      
         USING GOALHDRD,R3                                                      
                                                                                
         XC    NTGXHLEN,NTGXHLEN                                                
         MVC   NTGXHLEN(2),=AL2(NTGXHDL)                                        
         MVC   NTGXHTYP,NTGXHQ                                                  
         MVC   NTGXHAGY,SXDTAGY             ALPHA AGENCY                        
         MVC   NTGXHUID(L'GXKEY),0(R8)      GOAL ID                             
                                                                                
         MVC   BYTE,GXKEYAM                                                     
         BRAS  RE,GETMED                                                        
         MVC   NTGXHMED,BYTE        MEDIA                                       
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY        GET CLIENT RECORD FOR CPROF+6               
                                                                                
         MVC   CKEYAM,GXKEYAM       AGY/MEDIA                                   
         MVC   CKEYCLT,GXKEYCLT     CLIENT                                      
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,GXKEYCLT),NTGXHCNT   CLIENT                   
         DROP  R5                                                               
                                                                                
         XC    XSPKEY,XSPKEY       RESET GOAL KEY                               
         MVC   XSPKEY(L'GXKEY),0(R3)                                            
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'XSPDIR',XSPKEY,XSPKEY,WORK           
                                                                                
         MVI   NTGXHPLN,C'N'                                                    
         TM    GXKEYAGY,GXKEYTAR        PLANNED GOALS?                          
         BZ    *+8                                                              
         MVI   NTGXHPLN,C'Y'                                                    
                                                                                
         MVC   NTGXHPRD,GXKPRDA            PRODUCT CODE                         
         EDIT  GXKEYEST,NTGXHEST,FILL=0    ESTIMATE                             
         MVC   NTGXHDPT,SVDPTA             DAYPART                              
         EDIT  GXKEYSLN,NTGXHSEC,FILL=0    SECONDS                              
                                                                                
         CLC   GXKEYMKT,=X'0309'       DEFAULT TO NETWORK                       
         BNE   *+12                   0777                                      
         MVI   NTGXHNET,C'N'                                                    
         B     GXLH10                                                           
                                                                                
         CLC   GXKEYMKT,=X'0306'       SYNDICATION?                             
         BNE   *+12                                                             
         MVI   NTGXHNET,C'S'                                                    
         B     GXLH10                                                           
                                                                                
         CLC   GXKEYMKT,=X'0307'       CABLE?                                   
         BNE   *+12                                                             
         MVI   NTGXHNET,C'C'                                                    
         B     GXLH10                                                           
                                                                                
GXLH05   LR    R6,R3               A(RECORD)                                    
         MVI   ELCODE,X'20'        DESCRIPTION ELEMENT                          
         BRAS  RE,GETEL                                                         
         BNE   GXLH10                                                           
         USING GDELEM,R6                                                        
         OC    GDNETWK,GDNETWK                                                  
         BZ    GXLH10                                                           
         MVC   NTGXHNET(4),GDNETWK    NETWORK                                   
         MVI   NTGXHNET+4,C'N'                                                  
         DROP  R6                                                               
                                                                                
GXLH10   MVI   NTGXHAGY-1,MXTRTQ                                                
         MVI   NTGXHUID-1,MXTRTQ                                                
         MVI   NTGXHMED-1,MXTRTQ                                                
         MVI   NTGXHCNT-1,MXTRTQ                                                
         MVI   NTGXHPRD-1,MXTRTQ                                                
         MVI   NTGXHNET-1,MXTRTQ                                                
         MVI   NTGXHEST-1,MXTRTQ                                                
         MVI   NTGXHDPT-1,MXTRTQ                                                
         MVI   NTGXHSEC-1,MXTRTQ                                                
         MVI   NTGXHPLN-1,MXTRTQ                                                
         MVI   NTGXHDX,MXTRTQ                                                   
         MVI   NTGXHDX+1,MXTRTQ                                                 
                                                                                
         TR    NTGXHAGY,MXTRT                                                   
         TR    NTGXHMED,MXTRT                                                   
         TR    NTGXHCNT,MXTRT                                                   
         TR    NTGXHPRD,MXTRT                                                   
         TR    NTGXHNET,MXTRT                                                   
         TR    NTGXHEST,MXTRT                                                   
         TR    NTGXHDPT,MXTRT                                                   
         TR    NTGXHSEC,MXTRT                                                   
         TR    NTGXHPLN,MXTRT                                                   
         J     EXIT                                                             
                                                                                
GXLHLIT  DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD GOAL WEEKLY RECORD                                                      
***********************************************************************         
GXLWEEK  NTR1  BASE=*,LABEL=*                                                   
         L     RA,GXLWLIT                                                       
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTGXDDD,R2                                                       
         LA    R1,NTGXHDL                                                       
         BRAS  RE,INITGXL                                                       
         L     R8,ABIGWORK                                                      
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTGXDDD,R2                                                       
         L     R3,ACURWK           CURRENT WEEK                                 
         USING GLEMENT,R3                                                       
                                                                                
         XC    NTGXDLEN,NTGXDLEN                                                
         MVC   NTGXDLEN(2),=AL2(NTGXDDL)                                        
         MVC   NTGXDTYP,NTGXDQ                                                  
         MVC   NTGXDAGY,SXDTAGY             ALPHA AGENCY                        
         MVC   NTGXDUID(L'GXKEY),0(R8)      GOAL ID                             
                                                                                
         XC    NTGXDDOL,NTGXDDOL                                                
         XC    NTGXDRP1,NTGXDRP1                                                
         XC    NTGXDRP2,NTGXDRP2                                                
         XC    NTGXDRP3,NTGXDRP3                                                
                                                                                
         MVC   NTGXDDOL(4),=C'0.00'    INITIALIZE VALUES                        
         MVC   NTGXDRP1(4),=C'0.00'    INITIALIZE VALUES                        
         MVC   NTGXDRP2(4),=C'0.00'    INITIALIZE VALUES                        
         MVC   NTGXDRP3(4),=C'0.00'    INITIALIZE VALUES                        
                                                                                
         GOTO1 DATCON,DMCB,(2,GLWEEK),(10,NTGXDWK)                              
         GOTO1 DATCON,DMCB,(2,GLWEEK),(0,WORK)                                  
         GOTO1 VGETBRD,DMCB,WORK,WORK+10,VGETDAY,VADDAY                         
                                                                                
         XC    DUB,DUB                                                          
         MVC   DUB(6),WORK+16      END OF BROADCAST MONTH                       
         MVC   DUB+4(2),=C'01'     DEFAULT TO FIRST OF THE MONTH                
         GOTO1 DATCON,DMCB,(0,DUB),(10,NTGXDBM)                                 
                                                                                
         EDIT  GLBUDGET,NTGXDDOL,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-              
                                                                                
         OC    GLGRP,GLGRP                                                      
         BZ    GXLW05                                                           
                                                                                
         XC    FULL,FULL                                                        
         SR    R6,R6                                                            
         ICM   R7,15,GLGRP                                                      
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
         EDIT  FULL,NTGXDRP1,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                  
                                                                                
GXLW05   CLI   GLEN,GLEN1Q                                                      
         BE    GXLW15                                                           
         OC    GLGRP2,GLGRP2                                                    
         BZ    GXLW10                                                           
                                                                                
         XC    FULL,FULL                                                        
         SR    R6,R6                                                            
         ICM   R7,15,GLGRP2                                                     
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
         EDIT  FULL,NTGXDRP2,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                  
                                                                                
GXLW10   CLI   GLEN,GLEN3Q                                                      
         BNH   GXLW15                                                           
         OC    GLGRP3,GLGRP3                                                    
         BZ    GXLW15                                                           
                                                                                
         XC    FULL,FULL                                                        
         SR    R6,R6                                                            
         ICM   R7,15,GLGRP3                                                     
         M     R6,=F'10'                                                        
         ST    R7,FULL                                                          
         EDIT  FULL,NTGXDRP3,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                  
                                                                                
GXLW15   MVI   NTGXDAGY-1,MXTRTQ                                                
         MVI   NTGXDUID-1,MXTRTQ                                                
         MVI   NTGXDWK-1,MXTRTQ                                                 
         MVI   NTGXDBM-1,MXTRTQ                                                 
         MVI   NTGXDDOL-1,MXTRTQ                                                
         MVI   NTGXDRP1-1,MXTRTQ                                                
         MVI   NTGXDRP2-1,MXTRTQ                                                
         MVI   NTGXDRP3-1,MXTRTQ                                                
         MVI   NTGXDDX,MXTRTQ                                                   
         MVI   NTGXDDX+1,MXTRTQ                                                 
                                                                                
         TR    NTGXDAGY,MXTRT                                                   
         TR    NTGXDWK,MXTRT                                                    
         TR    NTGXDBM,MXTRT                                                    
         TR    NTGXDDOL,MXTRT                                                   
         TR    NTGXDRP1,MXTRT                                                   
         TR    NTGXDRP2,MXTRT                                                   
         TR    NTGXDRP3,MXTRT                                                   
         J     EXIT                                                             
                                                                                
GXLWLIT  DC    A(LITERAL)                                                       
         LTORG                                                                  
                                                                                
GXLOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
GXLOUTX  J     EXIT                                                             
         LTORG                                                                  
                                                                                
INITGXL  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
                                                                                
         L     R3,ADXAXREC                                                      
         USING NTGXHDD,R3                                                       
                                                                                
         MVI   NTGXHACT-1,MXTRTQ                                                
         MVI   NTGXHDAT-1,MXTRTQ                                                
         MVI   NTGXHTME-1,MXTRTQ                                                
                                                                                
         MVC   NTGXHLEN,SVLEN                                                   
         MVC   NTGXHTYP,SVTYP                                                   
         MVC   NTGXHACT,SVACT                                                   
         MVC   NTGXHDAT,SVDAT                                                   
         MVC   NTGXHTME,SVTME                                                   
         DROP  R3                                                               
                                                                                
INITGXLX J     EXIT                                                             
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT NET FLIGHTS                                                           
***********************************************************************         
NTTFLT   NMOD1 WORKL,*NTTFLT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTFLTLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AFLTREC                                                       
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         MVC   FDPTA,50(R8)        FLIGHT DAYPART                               
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDFLT              BUILD THE GOAL TABLES                        
         J     FLTOUT                                                           
                                                                                
NTFLTLIT DC    A(LITERAL)                                                       
NTXFLTC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
         LTORG                                                                  
         EJECT                                                                  
                                                                                
BLDFLT   L     R2,NTXFLTC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         L     R3,AFLTREC                                                       
         USING WFLIGHTD,R3                                                      
                                                                                
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
                                                                                
         BRAS  RE,FLTHDR           BUILD UNIT TABLE                             
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BLDFLTX  L     R2,NTXFLTC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD FLIGHTS                                                                 
***********************************************************************         
FLTHDR   NTR1  BASE=*,LABEL=*                                                   
         L     RA,FLTLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC         BUILD UNIT TABLE ENTRY                       
         USING NTFLTD,R2                                                        
         LA    R1,NTFLTDL                                                       
         BRAS  RE,INITFLT                                                       
         L     R8,ABIGWORK                                                      
                                                                                
         L     R2,ADXAXREC         BUILD GOAL TABLE ENTRY                       
         USING NTFLTD,R2                                                        
         L     R3,AFLTREC          FLIGHT RECORD                                
         USING WFLIGHTD,R3                                                      
                                                                                
         XC    NTFLTLEN,NTFLTLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTFLTLEN(2),=AL2(NTFLTDL)                                        
         MVC   NTFLTTYP,NTFLTQ                                                  
         MVC   NTFLTAGY,SXDTAGY             ALPHA AGENCY                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY        GET CLIENT RECORD FOR CPROF+6               
                                                                                
         MVC   CKEYAM,WFKAM         AGY/MEDIA                                   
         MVC   CKEYCLT,WFKCLT       CLIENT                                      
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)             A(DATAMGR)                                  
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,WFKCLT),NTFLTCNT   CLIENT                     
         DROP  R5                                                               
                                                                                
         XC    XSPKEY,XSPKEY       RESTORE FLIGHT KEY                           
         MVC   XSPKEY(L'WFKEY),0(R3)                                            
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'XSPDIR',XSPKEY,XSPKEY,WORK           
                                                                                
         L     R3,AFLTREC          FLIGHT RECORD                                
         MVC   NTFLTINT,WFKIFLT                                                 
         MVC   NTFLTPRD,WFKPRD                                                  
         MVC   NTFLTSTA,=C'ACTIVE  '                                            
         TM    WFRCNTRL,WFKINACT                                                
         JZ    *+10                                                             
         MVC   NTFLTSTA,=C'INACTIVE'                                            
         MVC   NTFLTID,WFIWFID                                                  
         MVC   NTFLTTPE,WFIFTYPE                                                
         MVC   NTFLTDPT,FDPTA                                                   
         GOTO1 DATCON,DMCB,(2,WFISTD),(10,NTFLTSTD)    AIR DATE                 
         GOTO1 DATCON,DMCB,(2,WFIEND),(10,NTFLTEND)    AIR DATE                 
         DROP  R3                                                               
                                                                                
         MVI   NTFLTAGY-1,MXTRTQ                                                
         MVI   NTFLTCNT-1,MXTRTQ                                                
         MVI   NTFLTINT-1,MXTRTQ                                                
         MVI   NTFLTID-1,MXTRTQ                                                 
         MVI   NTFLTTPE-1,MXTRTQ                                                
         MVI   NTFLTDPT-1,MXTRTQ                                                
         MVI   NTFLTSTD-1,MXTRTQ                                                
         MVI   NTFLTEND-1,MXTRTQ                                                
         MVI   NTFLTPRD-1,MXTRTQ                                                
         MVI   NTFLTSTA-1,MXTRTQ                                                
         MVI   NTFLTDX,MXTRTQ                                                   
         MVI   NTFLTDX+1,MXTRTQ                                                 
                                                                                
         TR    NTFLTAGY,MXTRT                                                   
         TR    NTFLTCNT,MXTRT                                                   
         TR    NTFLTINT,MXTRT                                                   
         TR    NTFLTID,MXTRT                                                    
         TR    NTFLTTPE,MXTRT                                                   
         TR    NTFLTDPT,MXTRT                                                   
         TR    NTFLTSTD,MXTRT                                                   
         TR    NTFLTEND,MXTRT                                                   
         TR    NTFLTPRD,MXTRT                                                   
         TR    NTFLTSTA,MXTRT                                                   
         J     EXIT                                                             
         DROP  R2                                                               
                                                                                
FLTLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
                                                                                
FLTOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
         J     EXIT                                                             
         LTORG                                                                  
                                                                                
INITFLT  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
                                                                                
         L     R3,ADXAXREC                                                      
         USING NTFLTD,R3                                                        
                                                                                
         MVI   NTFLTACT-1,MXTRTQ                                                
         MVI   NTFLTDAT-1,MXTRTQ                                                
         MVI   NTFLTTME-1,MXTRTQ                                                
                                                                                
         MVC   NTFLTLEN,SVLEN                                                   
         MVC   NTFLTTYP,SVTYP                                                   
         MVC   NTFLTACT,SVACT                                                   
         MVC   NTFLTDAT,SVDAT                                                   
         MVC   NTFLTTME,SVTME                                                   
         J     EXIT                                                             
         DROP  R3                                                               
         LTORG                                                                  
***********************************************************************         
* EXTRACT UCOM                                                                  
***********************************************************************         
NTTUCM   NMOD1 WORKL,*NTTUCM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTUCMLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,AUCOMREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDUCM              BUILD THE UCOM RECORD                        
         J     UCMOUT                                                           
                                                                                
NTUCMLIT DC    A(LITERAL)                                                       
NTXUCMC  DC    A(BUFFER1)          OUTPUT BUFFER OF UCOM TABLES                 
         LTORG                                                                  
         EJECT                                                                  
                                                                                
BLDUCM   L     R2,NTXUCMC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         L     R3,AUCOMREC                                                      
         USING UCOMHDRD,R3                                                      
                                                                                
         L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
                                                                                
         BRAS  RE,UCMHDR           BUILD UCOM TABLE                             
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       SET END OF TABLE                             
                                                                                
BLDUCMX  L     R2,NTXUCMC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD UCOM                                                                    
***********************************************************************         
UCMHDR   NTR1  BASE=*,LABEL=*                                                   
         L     RA,UCMLIT                                                        
         USING LITERAL,RA                                                       
                                                                                
         L     R2,ADXAXREC         BUILD UCOM TABLE ENTRY                       
         USING NTUCMD,R2                                                        
         LA    R1,NTUCMDL                                                       
         BRAS  RE,INITUCM                                                       
         L     R8,ABIGWORK                                                      
                                                                                
         L     R2,ADXAXREC         BUILD UCOM TABLE ENTRY                       
         USING NTUCMD,R2                                                        
         L     R3,AUCOMREC         UCOM RECORD                                  
         USING UCOMHDRD,R3                                                      
                                                                                
         MVI   NTUCMAGY-1,MXTRTQ                                                
         MVI   NTUCMMED-1,MXTRTQ                                                
         MVI   NTUCMCNT-1,MXTRTQ                                                
         MVI   NTUCMPRD-1,MXTRTQ                                                
         MVI   NTUCMEST-1,MXTRTQ                                                
         MVI   NTUCMSQN-1,MXTRTQ                                                
         MVI   NTUCMFNM-1,MXTRTQ                                                
         MVI   NTUCMFDT-1,MXTRTQ                                                
         MVI   NTUCMMLN-1,MXTRTQ                                                
         MVI   NTUCMETP-1,MXTRTQ                                                
         MVI   NTUCMMBI-1,MXTRTQ                                                
         MVI   NTUCMDX,MXTRTQ                                                   
         MVI   NTUCMDX+1,MXTRTQ                                                 
                                                                                
         XC    NTUCMLEN,NTUCMLEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   NTUCMLEN(2),=AL2(NTUCMDL)                                        
         MVC   NTUCMTYP,NTUCMQ                                                  
         MVC   NTUCMAGY,SXDTAGY             ALPHA AGENCY                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY        GET CLIENT RECORD FOR CPROF+6               
                                                                                
         MVC   CKEYAM,UCOMKAGY      AGY/MEDIA                                   
         MVC   CKEYCLT,UCOMKCLT     CLIENT                                      
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)             A(DATAMGR)                                  
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,UCOMKCLT),NTUCMCNT   CLIENT                   
         DROP  R5                                                               
                                                                                
         XC    XSPKEY,XSPKEY       RESTORE UCOM KEY                             
         MVC   XSPKEY(L'UCOMKEY),0(R3)                                          
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',XSPKEY,XSPKEY,WORK           
                                                                                
         LA    R6,SUCMELEM                                                      
         CLI   0(R6),0                                                          
         JE    EXIT                                                             
UCOMH20  CLI   0(R6),X'60'          CHECK FOR VALID ELEMENT                     
         JNL   UCOMH200                                                         
         L     R2,ADXAXREC          RESET UCOM RECORD AREA                      
*                                                                               
         MVI   NTUCMMED,C'N'                                                    
         EDIT  UCOMKEST,NTUCMEST,FILL=0                 ESTIMATE                
         MVC   NTUCMPRD,UCOMKPRD                                                
*                                                                               
*  PROCESS ELEMENTS                                                             
         L     R8,ABIGWORK                                                      
         LA    R8,20(R8)            START OF ELEMENT TABLE                      
UCOMH60  CLI   0(R8),X'FF'                                                      
         JE    UCOMH200                                                         
         CLC   0(1,R6),0(R8)                                                    
         JE    UCOMH100                                                         
         ZIC   RF,1(R8)                                                         
         AR    R8,RF                GET TO NEXT ELEMENT IN TABLE                
         J     UCOMH60                                                          
*                                                                               
UCOMH100 DS    0H                                                               
         MVC   BYTE,0(R6)                                                       
         NI    BYTE,X'0F'                                                       
         EDIT  BYTE,NTUCMSQN,FILL=0                 SEQUENCE NUMBER             
         MVC   BYTE,SUCMLEN-SUCMELEM(R8)                                        
         EDIT  BYTE,NTUCMMLN,FILL=0                 FIELD LENGTH                
         MVC   NTUCMETP,SUCMEDIT-SUCMELEM(R8)       EDIT TYPE                   
         TM    SUCMUSE1-SUCMELEM(R8),X'08'                                      
         JZ    *+8                                                              
         MVI   NTUCMMBI,C'Y'                        MBI                         
*                                                                               
         XC    NTUCMFNM,NTUCMFNM                                                
         ZIC   RF,1(R8)                                                         
         SH    RF,=H'7'                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NTUCMFNM(0),SUCMDT-SUCMELEM(R8)       FIELD NAME                 
         XC    NTUCMFDT,NTUCMFDT                                                
         ZIC   RF,1(R6)                                                         
         SH    RF,=H'7'                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NTUCMFDT(0),SUCMDT-SUCMELEM(R6)                                  
*                                                                               
         TR    NTUCMAGY,MXTRT                                                   
         TR    NTUCMMED,MXTRT                                                   
         TR    NTUCMCNT,MXTRT                                                   
         TR    NTUCMPRD,MXTRT                                                   
         TR    NTUCMEST,MXTRT                                                   
         TR    NTUCMSQN,MXTRT                                                   
         TR    NTUCMFNM,MXTRT                                                   
         TR    NTUCMFDT,MXTRT                                                   
         TR    NTUCMMLN,MXTRT                                                   
         TR    NTUCMETP,MXTRT                                                   
         TR    NTUCMMBI,MXTRT                                                   
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
******   MVC   0(2,R2),=X'FFFF'    SET END OF RECORDS                           
*                                                                               
*  CHECK FOR MORE ELEMENTS                                                      
*                                                                               
UCOMH200 ZIC   RF,1(R6)                                                         
         AR    R6,RF                                                            
         CLI   0(R6),0                                                          
         JNE   UCOMH20                                                          
         J     EXIT                                                             
         DROP  R2                                                               
                                                                                
UCMLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
                                                                                
UCMOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
         J     EXIT                                                             
         LTORG                                                                  
                                                                                
INITUCM  NTR1  BASE=*,LABEL=*                                                   
         L     R0,ADXAXREC                                                      
         XR    RE,RE                                                            
         XR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORDS TO ALL SPACES                    
                                                                                
         L     R3,ADXAXREC                                                      
         USING NTUCMD,R3                                                        
                                                                                
         MVI   NTUCMACT-1,MXTRTQ                                                
         MVI   NTUCMDAT-1,MXTRTQ                                                
         MVI   NTUCMTME-1,MXTRTQ                                                
                                                                                
         MVC   NTUCMLEN,SVLEN                                                   
         MVC   NTUCMTYP,SVTYP                                                   
         MVC   NTUCMACT,SVACT                                                   
         MVC   NTUCMDAT,SVDAT                                                   
         MVC   NTUCMTME,SVTME                                                   
         J     EXIT                                                             
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT BFORM RECORD                                                          
***********************************************************************         
NTTBFM   NMOD1 WORKL,*NTTBFM*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTBFLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         ST    R2,ADXAXREC                                                      
         ST    R3,ABFREC                                                        
         L     R4,12(R1)                                                        
         USING NTTBFD,R2           R2=A(EXTRACT RECORD)                         
         USING BFREC,R3            R3=A(BFORM RECORD)                           
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         MVC   VOFFICER,4(R8)      A(OFFICER)                                   
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDBFM              BUILD THE TABLES                             
         J     BFMOUT              OUTPUT RECORD                                
                                                                                
NTTBFMIT DC    A(LITERAL)                                                       
NTXBFMC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
                                                                                
BFMOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
BFMOUTX  J     EXIT                                                             
         LTORG                                                                  
                                                                                
BLDBFM   L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
         MVC   DATADISP,=H'24'                                                  
                                                                                
         L     R2,NTXBFMC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
*                                                                               
         L     R6,ABFREC                                                        
         USING BFRCDELD,R6                                                      
         MVI   ELCODE,BFRCDELQ                                                  
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
BBFM10   BRAS  RE,NEXTEL                                                        
         BNE   BLDBFMX                                                          
*                                                                               
         BRAS  RE,BLDBFH           BUILD BFORM DETAILS                          
*                                                                               
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
*                                                                               
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
         B     BBFM10                                                           
*                                                                               
BLDBFMX  L     R2,NTXBFMC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
*                                                                               
***********************************************************************         
* BUILD BFORM HEADER                                                            
***********************************************************************         
BLDBFH   NTR1  BASE=*,LABEL=*                                                   
         L     RA,NTTBFLIT                                                      
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTTBFD,R2                                                        
         LA    R1,NTTBFDL                                                       
         BRAS  RE,INITREC                                                       
         MVC   DATADISP,=H'24'                                                  
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTTBFD,R2                                                        
         L     R3,ABFREC                                                        
         USING BFREC,R3            R3=A(BFORM RECORD)                           
                                                                                
         XC    NTTBFLEN,NTTBFLEN                                                
         MVC   NTTBFLEN(2),=AL2(NTTBFDL)                                        
         MVC   NTTBFTYP,NTBFQ                                                   
         MVC   NTTBFAGY,SXDTAGY    AGENCY                                       
         MVC   NTTBFID(L'BFKEY-3),3(R3)                                         
                                                                                
         MVC   BYTE,BFKAGYMD                                                    
         BRAS  RE,GETMED                                                        
         MVC   NTTBFMED,BYTE       MEDIA                                        
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,BFKAGYMD     AGY/MEDIA                                    
         MVC   CKEYCLT,BFKCLT      CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,BFKCLT),NTTBFCLT     CLIENT                   
         DROP  R5                                                               
                                                                                
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY,0(R3)        RESTORE BFORM KEY                            
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
                                                                                
         MVC   NTTBFPRD,BFKPRD     PRODUCT                                      
         CLC   =C'AAA',BFKPRD                                                   
         JNE   *+10                                                             
         MVC   NTTBFPRD,=C'ALL'                                                 
                                                                                
         EDIT  BFKEST,NTTBFEST,FILL=0                 ESTIMATE                  
         CLI   BFKEST,0                                                         
         JNE   *+10                                                             
         MVC   NTTBFEST,=C'ALL'                                                 
*                                                                               
         MVC   NTTBFSMD,BFSUBMED   SUB MEDIA                                    
*                                                                               
         USING BFRCDELD,R6                                                      
         MVI   NTTBFMOS,C'*'                                                    
         CLC   BFRCDDTE,=2X'FF'                                                 
         BE    BBFH05                                                           
*                                                                               
         MVC   FULL,BFRCDDTE                                                    
         XC    FULL(2),=2X'FF'                                                  
         MVI   FULL+2,X'01'                                                     
         GOTO1 DATCON,DMCB,(3,FULL),(9,NTTBFMOS)                                
*                                                                               
BBFH05   MVC   BFORMULA,BFRCDFML                                                
         LA    R3,NTTBFBFM         R3 = A(1ST BYTE IN FORMULA TEXT)             
         TM    BBILLBAS,X'50'      FIGURE OUT WHICH BILL BASIS WE HAVE          
         BNO   BBFH10                                                           
         MVC   0(4,R3),=C'CNET'                                                 
         AHI   R3,4                                                             
         B     BBFH50                                                           
*                                                                               
BBFH10   TM    BBILLBAS,X'10'                                                   
         BNO   BBFH20                                                           
         MVC   0(3,R3),=C'NET'                                                  
         AHI   R3,3                                                             
         B     BBFH50                                                           
*                                                                               
BBFH20   TM    BBILLBAS,X'40'                                                   
         BNO   BBFH30                                                           
         MVC   0(5,R3),=C'CGROS'                                                
         AHI   R3,5                                                             
         B     BBFH50                                                           
*                                                                               
BBFH30   MVC   0(5,R3),=C'GROSS'                                                
         AHI   R3,5                                                             
*                                                                               
BBFH50   ICM   R5,15,BBILLCOM      IF NO COMMISSION                             
         BZ    BBFH100             THEN JUST BILL BASIS                         
*                                                                               
         MVI   0(R3),C','          OTHERWISE SEPARATE FIELD WITH COMMAS         
         AHI   R3,1                                                             
*                                                                               
         LPR   RF,R5                                                            
         C     RF,=F'1000000'      +/-100.0000 WON'T FIT NICELY                 
         BNE   BBFH60                                                           
         MVC   0(5,R3),=C'+100,'                                                
         LTR   R5,R5                                                            
         BNM   *+8                                                              
         MVI   0(R3),C'-'                                                       
         AHI   R3,5                                                             
         B     BBFH70                                                           
*                                                                               
BBFH60   EDIT  (R5),(8,0(R3)),4,FLOAT=+,ALIGN=LEFT                              
         LTR   R5,R5                                                            
         BNM   *+8                                                              
         MVI   0(R3),C'-'                                                       
*                                                                               
         LA    R1,7(R3)                                                         
BBFH65   CLI   0(R1),C' '                                                       
         BNE   *+12                                                             
         SHI   R1,1                                                             
         B     BBFH65                                                           
*                                                                               
         LA    R3,1(R1)                                                         
         SHI   R3,1                                                             
         MVI   0(R3),C','                                                       
         AHI   R3,1                                                             
*                                                                               
BBFH70   MVC   0(3,R3),=C'NET'                                                  
         TM    BBILLBAS,X'01'                                                   
         BO    BBFH100                                                          
         MVC   0(5,R3),=C'GROSS'                                                
*                                                                               
BBFH100  MVI   NTTBFAGY-1,MXTRTQ                                                
         MVI   NTTBFID-1,MXTRTQ                                                 
         MVI   NTTBFMED-1,MXTRTQ                                                
         MVI   NTTBFCLT-1,MXTRTQ                                                
         MVI   NTTBFPRD-1,MXTRTQ                                                
         MVI   NTTBFEST-1,MXTRTQ                                                
         MVI   NTTBFMOS-1,MXTRTQ                                                
         MVI   NTTBFBFM-1,MXTRTQ                                                
         MVI   NTTBFDX,MXTRTQ                                                   
         MVI   NTTBFDX+1,MXTRTQ                                                 
                                                                                
         TR    NTTBFAGY,MXTRT                                                   
         TR    NTTBFMED,MXTRT                                                   
         TR    NTTBFCLT,MXTRT                                                   
         TR    NTTBFPRD,MXTRT                                                   
         TR    NTTBFEST,MXTRT                                                   
         TR    NTTBFMOS,MXTRT                                                   
         TR    NTTBFBFM,MXTRT                                                   
         J     EQXIT                                                            
                                                                                
NTTBFLIT DC    A(LITERAL)                                                       
         DROP  R2,R3,R4                                                         
BFORMULA DS    0XL(L'BFRCDFML)     BINARY REPRESENTATION OF FORMULA             
BBILLBAS DS    XL(L'EBILLBAS)      2 4-BIT FIELDS - BILL BASE/COMM BASE         
*                                  B'0000'=GROSS, B'0001'=NET                   
BBILLCOM DS    XL(L'EBILLCOM)      SIGNED COMMISSION RATE (99.9999)             
         LTORG                                                                  
*&&DO                                                                           
         LA    R7,NTTBFM1                                                       
                                                                                
         USING BFRCDELD,R6                                                      
         LR    R6,R3                                                            
         MVI   ELCODE,BFRCDELQ                                                  
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
NBFM10   BRAS  RE,NEXTEL                                                        
NBFM12   BNE   NBFM50                                                           
                                                                                
         MVI   0(R7),C'*'                                                       
         CLC   BFRCDDTE,=X'FFFF'   ANY DATE?                                    
         JE    NBFM14                                                           
         MVC   FULL,BFRCDDTE                                                    
         XC    FULL(2),=2X'FF'                                                  
         MVI   FULL+2,X'01'                                                     
         GOTO1 DATCON,DMCB,(3,FULL),(9,0(R7))                                   
                                                                                
NBFM14   AHI   R7,L'NTTBFM1                                                     
         AHI   R7,1                                                             
                                                                                
         MVC   BFORMULA,BFRCDFML                                                
                                                                                
         TM    BBILLBAS,X'50'         IS BILLBASEGROSS?                         
         BZ    *+8                                                              
         MVI   0(R7),C'N'                                                       
                                                                                
         AHI   R7,L'NTTBFB1                                                     
         AHI   R7,1                                                             
                                                                                
         TM    BBILLBAS,X'01'      IS COMMBASEGROSS?                            
         BZ    *+8                                                              
         MVI   0(R7),C'N'                                                       
                                                                                
         AHI   R7,L'NTTBFC1                                                     
         AHI   R7,1                                                             
                                                                                
         ICM   R5,15,BBILLCOM      ANY COMM PCT?                                
         LPR   RF,R5                                                            
         C     RF,=F'1000000'        IF COM BASIS IS 100% MOVE 100              
         JNE   NBFM16                TO SCREEN                                  
         MVC   0(3,R7),=C'100'                                                  
         J     NBFM18                                                           
*                                                                               
*                                    OTHERWISE ...                              
*                                    EDIT COM.% INTO SCREEN FIELD               
NBFM16   EDIT  (R5),(8,0(R7)),4,FLOAT=+,ALIGN=LEFT                              
                                                                                
NBFM18   LTR   R5,R5                                                            
         BNM   *+8                   COM.% NEGATIVE, MINUS SIGN                 
         MVI   0(R7),C'-'                                                       
                                                                                
         AHI   R7,L'NTTBFP1                                                     
         AHI   R7,1                                                             
         J     NBFM10                                                           
         DROP  R6                                                               
*&&                                                                             
         EJECT                                                                  
***********************************************************************         
* EXTRACT UNIVERSE RECORD                                                       
***********************************************************************         
NTTUNV   NMOD1 WORKL,*NTTUNV*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTUNVIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R8,16(R1)                                                        
         ST    R2,ADXAXREC                                                      
         ST    R3,AUNIVREC                                                      
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDUNV              BUILD THE TABLES                             
         J     UNVOUT              OUTPUT RECORD                                
                                                                                
NTTUNVIT DC    A(LITERAL)                                                       
NTXUNVC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
                                                                                
BLDUNV   L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
                                                                                
         L     R2,NTXUNVC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         BRAS  RE,BLDUV            BUILD UNIVERSE                               
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         MVI   BYTE3,1                                                          
*                                                                               
         LR    R6,R3                                                            
         MVI   ELCODE,X'02'                                                     
         BRAS  RE,GETEL                                                         
         JNE   BUNV20                                                           
         USING NUNEL02,R6                                                       
*                                                                               
         SR    RE,RE                                                            
         ZIC   RF,NUNLEN                                                        
         SHI   RF,4                                                             
         D     RE,=F'4'            # OF DEMO CATEGORIES                         
         LR    R7,RF                                                            
*                                                                               
         LA    R6,NUNIVES                                                       
         LA    R5,UDEMBLK          TABLE OF DEMO CATEGORIES IN NUNIVES          
BUNV10   CLI   0(R5),X'FF'         END OF TABLE?                                
         JE    BUNV20                                                           
*                                                                               
         MVC   FULL,0(R6)          DEMO VALUE                                   
         BRAS  RE,BLDUD            BUILD UNIVERSE DEMOS                         
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
         AHI   R5,UDEMBLKL                                                      
         AHI   R6,L'NUNIVES                                                     
         ZIC   RF,BYTE3            INCREMENT POSITION                           
         AHI   RF,1                                                             
         STC   RF,BYTE3                                                         
         BCT   R7,BUNV10                                                        
*        J     BUNV10                                                           
*                                                                               
BUNV20   LR    R6,R3               NOW DO X'DD' ELEMENTS (NAD CATS)             
         MVI   ELCODE,X'DD'                                                     
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
BUNV22   BRAS  RE,NEXTEL                                                        
         JNE   BUNV30                                                           
         USING NUNELDD,R6                                                       
*                                                                               
         LA    R5,NUNDCAT          DEMO CATEGORY                                
         MVC   FULL,NUNDAMT        DEMO VALUE                                   
         BRAS  RE,BLDUD            BUILD UNIVERSE DEMOS                         
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
         ZIC   RF,BYTE3            INCREMENT POSITION                           
         AHI   RF,1                                                             
         STC   RF,BYTE3                                                         
         J     BUNV22                                                           
                                                                                
BUNV30   MVI   BYTE3,1                                                          
         LR    R6,R3               NOW DO USER DEMOS                            
         MVI   ELCODE,X'C1'                                                     
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
BUNV32   BRAS  RE,NEXTEL                                                        
         JNE   BLDUNVX                                                          
                                                                                
         MVC   FULL,9(R6)          DEMO VALUE                                   
         BRAS  RE,BLDUU            BUILD UNIVERSE USER DEMOS                    
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
         ZIC   RF,BYTE3            INCREMENT POSITION                           
         AHI   RF,1                                                             
         STC   RF,BYTE3                                                         
         J     BUNV32                                                           
                                                                                
BLDUNVX  L     R2,NTXUNVC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
                                                                                
UNVOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
UVOUTX   J     EXIT                                                             
                                                                                
UDEMBLK  DC    XL3'00C97A'         DEMO CATEGORIES IN NUNIVES                   
UDEMBLKL EQU   *-UDEMBLK                                                        
         DC    XL3'00C901'                                                      
         DC    XL3'00C935'                                                      
         DC    XL3'00C967'                                                      
         DC    XL3'00C943'                                                      
         DC    XL3'00C947'                                                      
         DC    XL3'00C92F'                                                      
         DC    XL3'00C915'                                                      
         DC    XL3'00C977'                                                      
         DC    XL3'00C922'                                                      
         DC    XL3'00C976'                                                      
         DC    XL3'00C973'                                                      
         DC    XL3'00C961'                                                      
         DC    XL3'00C916'                                                      
         DC    XL3'00C914'                                                      
         DC    XL3'00C954'                                                      
         DC    XL3'00C9FC'                                                      
         DC    XL3'00C9ED'                                                      
         DC    XL3'00C9EE'                                                      
         DC    XL3'00C9A2'                                                      
         DC    XL3'00C97F'                                                      
         DC    XL3'00C929'                                                      
         DC    XL3'00C92A'                                                      
         DC    XL3'00C930'                                                      
         DC    XL3'00C9CE'                                                      
         DC    XL3'00C93B'                                                      
         DC    XL3'00C92D'                                                      
         DC    XL3'00C95B'                                                      
         DC    XL3'00C95C'                                                      
         DC    XL3'00C962'                                                      
         DC    XL3'00C9D8'                                                      
         DC    XL3'00C96D'                                                      
         DC    XL3'00C95F'                                                      
         DC    XL3'00C93E'                                                      
         DC    XL3'00E62D'                                                      
         DC    XL3'00C94B'                                                      
         DC    XL3'00C919'                                                      
         DC    XL3'00C97D'                                                      
         DC    XL3'00C93D'                                                      
         DC    XL3'00C97B'                                                      
         DC    XL3'00C978'                                                      
         DC    XL3'00C9F2'                                                      
         DC    XL3'00C9F1'                                                      
         DC    XL3'00C9F0'                                                      
         DC    X'FF'                                                            
         LTORG                                                                  
***********************************************************************         
* BUILD UNIVERSE RECORD                                                         
***********************************************************************         
BLDUV    NTR1  BASE=*,LABEL=*                                                   
         L     RA,UVLIT                                                         
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTUVD,R2                                                         
         LA    R1,NTUVDL                                                        
         BRAS  RE,INITREC                                                       
         MVC   DATADISP,=H'24'                                                  
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTUVD,R2                                                         
         L     R3,AUNIVREC                                                      
         USING NUNRECD,R3                                                       
                                                                                
         XC    NTUVLEN,NTUVLEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTUVLEN(2),=AL2(NTUVDL)                                          
         MVC   NTUVTYP,NTUVQ                                                    
         MVC   NTUVAGY,NUNKAGY    AGENCY                                        
         MVC   NTUVID,NUNKTYPE                                                  
                                                                                
         CLI   NUNKTYPE,NUNKTEDQ   END DATE?                                    
         JNE   BUV02                                                            
         GOTO1 DATCON,DMCB,(2,NUNKEND),(10,NTUVEND)                             
         J     BUV04                                                            
                                                                                
BUV02    UNPK  WORK(5),NUNKCODE(3) CODE                                         
         MVC   NTUVCODE,WORK                                                    
                                                                                
BUV04    LR    R6,R3                                                            
         MVI   ELCODE,X'66'        COMMENT                                      
         BRAS  RE,GETEL                                                         
         BNE   BUV06                                                            
*                                                                               
         ZIC   RF,1(R6)                                                         
         SHI   RF,3                                                             
         BM    BUV06                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NTUVCOM(0),2(R6)                                                 
*                                                                               
BUV06    MVI   NTUVAGY-1,MXTRTQ                                                 
         MVI   NTUVID-1,MXTRTQ                                                  
         MVI   NTUVCODE-1,MXTRTQ                                                
         MVI   NTUVEND-1,MXTRTQ                                                 
         MVI   NTUVCOM-1,MXTRTQ                                                 
         MVI   NTUVDX,MXTRTQ                                                    
         MVI   NTUVDX+1,MXTRTQ                                                  
                                                                                
         TR    NTUVAGY,MXTRT                                                    
         TR    NTUVCODE,MXTRT                                                   
         TR    NTUVEND,MXTRT                                                    
         TR    NTUVCOM,MXTRT                                                    
*                                                                               
         J     EXIT                                                             
                                                                                
UVLIT    DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD UNIVERSE DEMO RECORD                                                    
* ON ENTRY, R5 POINTS TO DEMO CATEGORY                                          
*           FULL CONTAINS DEMO VALUE                                            
***********************************************************************         
BLDUD    NTR1  BASE=*,LABEL=*                                                   
         L     RA,UDLIT                                                         
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTUDD,R2                                                         
         LA    R1,NTUDDL                                                        
         BRAS  RE,INITREC                                                       
         MVC   DATADISP,=H'24'                                                  
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTUDD,R2                                                         
         L     R3,AUNIVREC                                                      
         USING NUNRECD,R3                                                       
                                                                                
         XC    NTUDLEN,NTUDLEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTUDLEN(2),=AL2(NTUDDL)                                          
         MVC   NTUDTYP,NTUDQ                                                    
         MVC   NTUDAGY,NUNKAGY    AGENCY                                        
         MVC   NTUDID,NUNKTYPE                                                  
         EDIT  BYTE3,NTUDPOS,ALIGN=LEFT                                         
                                                                                
         MVC   BYTE2,0(R5)                                                      
         EDIT  BYTE2,NTUDNAD,FILL=0    NAD CATEGORY                             
         MVC   NTUDMOD,1(R5)           MODIFIER                                 
*                                                                               
         CLI   1(R5),X'A4'                                                      
         JNE   *+8                                                              
         MVI   NTUDMOD,C'$'                                                     
         CLI   1(R5),X'A5'                                                      
         JNE   *+8                                                              
         MVI   NTUDMOD,C'?'                                                     
         CLI   1(R5),X'A6'                                                      
         JNE   *+8                                                              
         MVI   NTUDMOD,C'@'                                                     
         CLI   1(R5),X'A7'                                                      
         JNE   *+8                                                              
         MVI   NTUDMOD,C'!'                                                     
         CLI   1(R5),X'A8'                                                      
         JNE   *+8                                                              
         MVI   NTUDMOD,X'50'                                                    
*                                                                               
         MVC   BYTE2,2(R5)                                                      
         EDIT  BYTE2,NTUDASC,FILL=0   AGE SEX CATEGORY                          
         EDIT  FULL,NTUDVALU,ALIGN=LEFT,ZERO=NOBLANK                            
*                                                                               
         MVI   NTUDAGY-1,MXTRTQ                                                 
         MVI   NTUDID-1,MXTRTQ                                                  
         MVI   NTUDNAD-1,MXTRTQ                                                 
         MVI   NTUDMOD-1,MXTRTQ                                                 
         MVI   NTUDASC-1,MXTRTQ                                                 
         MVI   NTUDPOS-1,MXTRTQ                                                 
         MVI   NTUDVALU-1,MXTRTQ                                                
         MVI   NTUDDX,MXTRTQ                                                    
         MVI   NTUDDX+1,MXTRTQ                                                  
                                                                                
         TR    NTUDAGY,MXTRT                                                    
         TR    NTUDNAD,MXTRT                                                    
         TR    NTUDMOD,MXTRT                                                    
         TR    NTUDASC,MXTRT                                                    
         TR    NTUDPOS,MXTRT                                                    
         TR    NTUDVALU,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
                                                                                
UDLIT    DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD UNIVERSE USER DEMO RECORD                                               
* ON ENTRY, R6 POINTS TO C1 ELEMENT                                             
*           FULL HAS THE DEMO VALUE                                             
***********************************************************************         
BLDUU    NTR1  BASE=*,LABEL=*                                                   
         L     RA,UULIT                                                         
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTUUD,R2                                                         
         LA    R1,NTUUDL                                                        
         BRAS  RE,INITREC                                                       
         MVC   DATADISP,=H'24'                                                  
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTUUD,R2                                                         
         L     R3,AUNIVREC                                                      
         USING NUNRECD,R3                                                       
                                                                                
         XC    NTUULEN,NTUULEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTUULEN(2),=AL2(NTUUDL)                                          
         MVC   NTUUTYP,NTUUQ                                                    
         MVC   NTUUAGY,NUNKAGY    AGENCY                                        
         MVC   NTUUID,NUNKTYPE                                                  
         EDIT  BYTE3,NTUUPOS,ALIGN=LEFT                                         
                                                                                
         MVC   NTUUDEMO,2(R6)      DEMO CATEGORY                                
         EDIT  FULL,NTUUVALU,ALIGN=LEFT,ZERO=NOBLANK                            
                                                                                
         MVI   NTUUAGY-1,MXTRTQ                                                 
         MVI   NTUUID-1,MXTRTQ                                                  
         MVI   NTUUDEMO-1,MXTRTQ                                                
         MVI   NTUUPOS-1,MXTRTQ                                                 
         MVI   NTUUVALU-1,MXTRTQ                                                
         MVI   NTUUDX,MXTRTQ                                                    
         MVI   NTUUDX+1,MXTRTQ                                                  
                                                                                
         TR    NTUUAGY,MXTRT                                                    
         TR    NTUUDEMO,MXTRT                                                   
         TR    NTUUPOS,MXTRT                                                    
         TR    NTUUVALU,MXTRT                                                   
         J     EXIT                                                             
*                                                                               
UULIT    DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* EXTRACT COMMERCIAL RECORD                                                     
***********************************************************************         
NTTCML   NMOD1 WORKL,*NTTCML*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTCMLIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING NTCMD,R2            R2=A(EXTRACT RECORD)                         
         USING CMLRECD,R3           R3=A(AGENCY RECORD)                         
         USING SXDTABD,R4                                                       
                                                                                
         XC    NTCMLEN,NTCMLEN                                                  
         MVC   NTCMLEN(2),=AL2(NTCMDL)                                          
         MVC   NTCMTYP,NTCMLQ                                                   
                                                                                
         MVI   NTCMAGY-1,MXTRTQ                                                 
         MVI   NTCMMED-1,MXTRTQ                                                 
         MVI   NTCMCNT-1,MXTRTQ                                                 
         MVI   NTCMCML-1,MXTRTQ                                                 
         MVI   NTCMTTL1-1,MXTRTQ                                                
         MVI   NTCMTTL2-1,MXTRTQ                                                
         MVI   NTCMTTL3-1,MXTRTQ                                                
         MVI   NTCMHD-1,MXTRTQ                                                  
         MVI   NTCMCCN-1,MXTRTQ                                                 
         MVI   NTCMAC1-1,MXTRTQ                                                 
         MVI   NTCMAC2-1,MXTRTQ                                                 
         MVI   NTCMAC3-1,MXTRTQ                                                 
         MVI   NTCMAC4-1,MXTRTQ                                                 
         MVI   NTCMCLS-1,MXTRTQ                                                 
         MVI   NTCMDX,MXTRTQ                                                    
         MVI   NTCMDX+1,MXTRTQ                                                  
                                                                                
         MVC   NTCMAGY,SXDTAGY    ALPHA AGENCY                                  
*                                                                               
         MVC   BYTE,CMLKAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTCMMED,BYTE       MEDIA                                         
                                                                                
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,CMLKAM       AGY/MEDIA                                    
         MVC   CKEYCLT,CMLKCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,CMLKCLT),NTCMCNT       CLIENT                 
         DROP  R5                                                               
                                                                                
         XC    SPTKEY,SPTKEY                                                    
         MVC   SPTKEY(13),0(R3)    RESTORE PRODUCT KEY                          
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
*                                                                               
         TM    CMLRSTAT,X'01'      CMLKCML PACKED?                              
         BO    *+14                YES, DON'T FILL IN THE 8-CHAR FIELD          
         MVC   NTCMCML(L'CMLKCML),CMLKCML                                       
         B     NTTCML05                                                         
*                                                                               
         L     RF,=V(NTXCOMM)                                                   
         L     RF,ATRPACK-NTXCOMMD(RF)                                          
         GOTO1 (RF),DMCB,(C'U',CMLKCML),NTCMCML                                 
*                                                                               
* PROCESS ELEMENTS NOW                                                          
*                                                                               
NTTCML05 DS    0H                                                               
         LA    R6,CMLDTAEL         1ST ELEMENT                                  
         MVI   BYTE2,0             X'30' ELEMENT COUNT                          
         MVI   BYTE3,0             X'60' ELEMENT COUNT                          
*                                                                               
NTTCML10 DS    0H                                                               
         CLI   0(R6),0                                                          
         BE    NTTCML99                                                         
*                                                                               
         CLI   0(R6),X'10'         CMLDTAEL, CMML DATA ELEMENT                  
         BE    NTTCML30                                                         
         CLI   0(R6),X'24'         CMLXDTEL, EXTENDED DATA                      
         BE    NTTCML50                                                         
         CLI   0(R6),X'30'         CMLDSCEL, EXTRA DESCRIPTION                  
         BE    NTTCML40                                                         
         CLI   0(R6),X'60'         CMLACTEL, ACTUAL CMML ELEM                   
         BE    NTTCML60                                                         
*                                                                               
NTTCML20 DS    0H                  ADVANCE R6 TO NEXT ELEMENT                   
         LLC   R0,1(R6)                                                         
         CHI   R0,1                                                             
         BNH   NTTCML99                                                         
         AR    R6,R0                                                            
         B     NTTCML10                                                         
*                                                                               
         USING CMLDTAEL,R6         X'10', CMML DATA ELEMENT                     
NTTCML30 DS    0H                                                               
         MVC   NTCMTTL1(L'CMLTITLE),CMLTITLE   COMMERCIAL TITLE 1               
         MVC   NTCMCCN,CMLCLTNO    CLIENT COMMERCIAL NUMBER                     
         MVC   NTCMCLS,CMLCLASS    COMMERCIAL CLASS                             
*                                                                               
         B     NTTCML20            NEXT ELEMENT                                 
         DROP  R6                                                               
*                                                                               
         USING CMLDSCEL,R6         X'30', EXTRA DESCRIPTION                     
NTTCML40 DS    0H                                                               
         LLC   RF,BYTE2            X'30' ELEMENT COUNT                          
         MHI   RF,L'NTCMTTL1+1                                                  
         LA    RF,NTCMTTL1(RF)                                                  
         MVC   0(L'NTCMTTL1,RF),CMLDSC                                          
         LLC   RF,BYTE2                                                         
         AHI   RF,1                                                             
         STC   RF,BYTE2                                                         
*                                                                               
         B     NTTCML20            NEXT ELEMENT                                 
         DROP  R6                                                               
*                                                                               
         USING CMLXDTEL,R6         X'24', EXTENDED DATA                         
NTTCML50 DS    0H                                                               
         MVC   NTCMHD,CMLXHDEF                                                  
*                                                                               
         B     NTTCML20            NEXT ELEMENT                                 
         DROP  R6                                                               
*                                                                               
         USING CMLACTEL,R6         X'60', ACTUAL CMML ELEM                      
NTTCML60 DS    0H                                                               
         LLC   RF,BYTE3            X'60' ELEMENT COUNT                          
         MHI   RF,L'NTCMAC1+1                                                   
         LA    RF,NTCMAC1(RF)                                                   
*                                                                               
         LLC   RE,CMLACTLN         ELEMENT LENGTH                               
         CHI   RE,CMLACTL2                                                      
         BNH   *+8                                                              
         LHI   RE,CMLACTL2                                                      
         AHI   RE,-3               ELCODE, LENGTH, BCTR FOR EX MVC              
*                                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RF),CMLACTID    8 OR 12 CHAR, DEPENDING ON ELEM LEN          
*                                                                               
         LLC   RF,BYTE3                                                         
         AHI   RF,1                                                             
         STC   RF,BYTE3                                                         
*                                                                               
         B     NTTCML20            NEXT ELEMENT                                 
         DROP  R6                                                               
*                                                                               
*                                                                               
NTTCML99 DS    0H                                                               
*                                                                               
NTTCMLX  TR    NTCMAGY,MXTRT                                                    
         TR    NTCMMED,MXTRT                                                    
         TR    NTCMCNT,MXTRT                                                    
         TR    NTCMCML,MXTRT                                                    
         TR    NTCMTTL1,MXTRT                                                   
         TR    NTCMTTL2,MXTRT                                                   
         TR    NTCMTTL3,MXTRT                                                   
         TR    NTCMHD,MXTRT                                                     
         TR    NTCMCCN,MXTRT                                                    
         TR    NTCMAC1,MXTRT                                                    
         TR    NTCMAC2,MXTRT                                                    
         TR    NTCMAC3,MXTRT                                                    
         TR    NTCMAC4,MXTRT                                                    
         TR    NTCMCLS,MXTRT                                                    
         J     EQXIT                                                            
                                                                                
NTTCMLIT DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* EXTRACT PATTERN RECORD                                                        
***********************************************************************         
NTTPAT   NMOD1 WORKL,*NTTPAT*,CLEAR=Y                                           
         USING WORKD,RC                                                         
         L     RA,NTTPATIT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)                                                       
         LM    R2,R3,0(R1)                                                      
         L     R8,16(R1)                                                        
         ST    R2,ADXAXREC                                                      
         ST    R3,APATREC                                                       
         USING NPTRECD,R3                                                       
         L     R4,12(R1)                                                        
         USING SXDTABD,R4                                                       
         MVC   DATADISP,=H'42'                                                  
                                                                                
         L     R8,16(R1)                                                        
         ST    R8,ABIGWORK                                                      
         MVC   VDAYUNPK,0(R8)                                                   
         MVC   VUNTIME,4(R8)                                                    
         MVC   VTRPACK,8(R8)                                                    
                                                                                
         CLI   8(R1),1                                                          
         JE    BLDPAT              BUILD THE TABLES                             
         J     PATOUT              OUTPUT RECORD                                
                                                                                
NTTPATIT DC    A(LITERAL)                                                       
NTXPATC  DC    A(BUFFER1)          OUTPUT BUFFER OF UNIT TABLES                 
                                                                                
BLDPAT   L     RF,ADXAXREC         FIRST TIME THROUGH                           
         MVC   SVLEN,0(RF)         SAVE LENGTH                                  
         MVC   SVTYP,4(RF)         SAVE TYPE                                    
         MVC   SVACT,10(RF)        SAVE ACTION                                  
         MVC   SVDAT,12(RF)        SAVE DATE                                    
         MVC   SVTME,21(RF)        SAVE TIME                                    
         MVC   SVAGY,SXDTAGY                                                    
                                                                                
         L     R2,NTXPATC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         XC    0(8,R2),0(R2)       DENOTES NEXT AVAIABLE ENTRY                  
                                                                                
         LR    RF,RC                                                            
         AHI   RF,MYIO2-WORKD                                                   
         ST    RF,AMYIO2                                                        
         ST    RF,ACURELEM                                                      
         XC    0(L'NPTXNET,RF),0(RF)                                            
         MVI   L'NPTXNET(RF),X'FF' DO THIS AT LEAST ONCE                        
                                                                                
         CLI   NPTXNET,C'$'        NETWORK LIST?                                
         JE    BPAT10                                                           
         CLI   NPTXNET+2,X'FF'     MEDIA?                                       
         JE    BPAT20                                                           
         MVC   0(L'NPTXNET,RF),NPTXNET                                          
         J     BPAT20                                                           
*                                                                               
BPAT10   L     R4,AMYIO2                                                        
         LR    R6,R3               BUILD NETWORK LIST                           
         MVI   ELCODE,X'5B'                                                     
         BAS   RE,GETEL                                                         
         J     *+8                                                              
BPAT12   BAS   RE,NEXTEL                                                        
         JNE   BPAT20                                                           
         USING NPTNETEL,R6                                                      
*                                                                               
         TM    NPTNETST,X'80'      DELETED?                                     
         JO    BPAT12                                                           
         MVC   0(L'NPTNET,R4),NPTNET                                            
         MVI   L'NPTNET(R4),X'FF'                                               
         AHI   R4,L'NPTNET                                                      
         J     BPAT12                                                           
*                                                                               
BPAT20   L     RF,ACURELEM                                                      
         CLI   0(RF),X'FF'                                                      
         JE    BPAT30                                                           
         MVC   SVNET,0(RF)                                                      
*                                                                               
         BRAS  RE,BLDPT            BUILD PATTERN                                
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         L     RF,ACURELEM         DO NEXT NETWORK                              
         AHI   RF,L'NPTXNET                                                     
         ST    RF,ACURELEM                                                      
         J     BPAT20                                                           
                                                                                
BPAT30   LR    R6,R3                                                            
         MVI   ELCODE,X'10'                                                     
         BAS   RE,GETEL                                                         
         JNE   BPAT40                                                           
         USING NPTDTAEL,R6                                                      
*                                                                               
         MVI   BYTE,0                                                           
         TM    NPTSTAT,NPTS_ADID   ADID?                                        
         JZ    *+8                                                              
         OI    BYTE,ADIDYQ                                                      
*                                                                               
         LR    R6,R3                                                            
         MVI   ELCODE,X'36'        LOOK FOR ABSURD ROT ELEM                     
         BRAS  RE,GETEL                                                         
         JE    BPAT32                                                           
         LR    R6,R3                                                            
         MVI   ELCODE,X'34'        LOOK FOR NORMAL ROT ELEM                     
         BRAS  RE,GETEL                                                         
         JE    BPAT32                                                           
         SR    R4,R4               INDICATE NO ROT ELEM                         
         J     *+8                                                              
BPAT32   LA    R4,NPTPCTLT-NPTPCTEL(R6)  POINT TO FIRST PCT                     
*                                                                               
         LR    R6,R3                                                            
         MVI   ELCODE,X'30'        COMMERCIAL LIST ELEMENT                      
         BAS   RE,GETEL                                                         
         JNE   BPAT50                                                           
         USING NPTCMLEL,R6                                                      
*                                                                               
         LLC   R5,NPTCMLLN                                                      
         SRL   R5,4                GIVES NUMBER OF CMMLS                        
         LA    R6,NPTCML           FIRST CMML                                   
         MVI   BYTE2,1             SET POSITION 1 = A                           
*                                                                               
BPAT34   CLC   =X'5C00',0(R6)      DELETED?                                     
         JE    BPAT36                                                           
*                                                                               
         BRAS  RE,BLDPTC           BUILD PATTERN COMMERCIAL                     
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
                                                                                
BPAT36   AHI   R6,16               NEXT COMMERCIAL                              
*                                                                               
         LTR   R4,R4                                                            
         BZ    *+8                                                              
         AHI   R4,3                NEXT %                                       
*                                                                               
         ZIC   RF,BYTE2                                                         
         AHI   RF,1                                                             
         STC   RF,BYTE2            NEXT POSITION                                
         BCT   R5,BPAT34                                                        
                                                                                
BPAT40   LR    R6,R3                                                            
         MVI   ELCODE,X'40'        COMMENTS                                     
         BAS   RE,GETEL                                                         
         B     *+8                                                              
BPAT42   BAS   RE,NEXTEL                                                        
         BNE   BPAT50                                                           
                                                                                
         BRAS  RE,BLDPTM           BUILD PATTERN COMMENTS                       
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
         J     BPAT42                                                           
*                                                                               
BPAT50   MVI   BYTE,1              SET 1ST POSITION                             
                                                                                
         LR    R6,R3                                                            
         MVI   ELCODE,X'5C'        HIATUS                                       
         BAS   RE,GETEL                                                         
         B     *+8                                                              
BPAT52   BAS   RE,NEXTEL                                                        
         BNE   BLDPATX                                                          
*                                                                               
         BRAS  RE,BLDPTH           BUILD PATTERN HIATUS                         
                                                                                
         L     R0,ANEXT            CURRENT FREE SPOT IN BUFFER                  
         L     RE,ADXAXREC         RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
         L     R2,ANEXT                                                         
         XC    0(8,R2),0(R2)                                                    
*                                                                               
         ZIC   RF,BYTE             UPDATE POSITION                              
         AHI   RF,1                                                             
         STC   RF,BYTE                                                          
         J     BPAT52                                                           
*                                                                               
BLDPATX  L     R2,NTXPATC          A(BUFFER TABLE)                              
         ST    R2,ANEXT                                                         
         J     EXIT                                                             
                                                                                
PATOUT   L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)       ANY MORE RECORDS TO PUT                      
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'                                                      
         J     EXIT                                                             
                                                                                
         L     R0,ADXAXREC         CURRENT FREE SPOT IN BUFFER                  
         L     RE,ANEXT            RECORD TO ADD TO BUFFER                      
         SR    R1,R1                                                            
         ICM   R1,3,0(RE)          LENGTH OF RECORD                             
         L     R2,ANEXT                                                         
         AR    R2,R1               BUMP TO NEXT FREE BUFFER ENTRY               
         ST    R2,ANEXT                                                         
         LR    RF,R1                                                            
         MVCL  R0,RE               MOVE RECORD TO BUFFER                        
                                                                                
PATOUTX  J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* BUILD NESPATTERN RECORD                                                       
***********************************************************************         
BLDPT    NTR1  BASE=*,LABEL=*                                                   
         L     RA,PTLIT                                                         
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTPTD,R2                                                         
         LA    R1,NTPTDL                                                        
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTPTD,R2                                                         
         L     R3,APATREC                                                       
         USING NPTRECD,R3                                                       
                                                                                
         XC    NTPTLEN,NTPTLEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTPTLEN(2),=AL2(NTPTDL)                                          
         MVC   NTPTTYP,NTPTQ                                                    
         MVC   NTPTID(L'NPTXKEY-3),3(R3)                                        
         MVC   NTPTAGY,SVAGY      ALPHA AGENCY                                  
                                                                                
         MVC   BYTE,NPTXAM                                                      
         BRAS  RE,GETMED                                                        
         MVC   NTPTMED,BYTE        MEDIA                                        
*                                                                               
         LA    R5,SPTKEY                                                        
         USING CLTHDR,R5                                                        
         XC    SPTKEY,SPTKEY       GET CLIENT RECORD FOR CPROF+6                
                                                                                
         MVC   CKEYAM,NPTXAM       AGY/MEDIA                                    
         MVC   CKEYCLT,NPTXCLT     CLIENT                                       
                                                                                
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,=CL7'DMRDHI',=CL7'SPTDIR',SPTKEY,SPTKEY,WORK           
         GOTO1 (RF),DMCB,=CL7'GETREC',=CL7'SPTFIL',SPTKEY+14,MYIO,WORK          
                                                                                
         LA    R5,MYIO                                                          
         L     RF,ACLUNPK                                                       
         GOTO1 (RF),DMCB,(CPROF+6,NPTXCLT),NTPTCLI      CLIENT                  
         DROP  R5                                                               
*                                                                               
         MVC   NTPTPRD,NPTXPRD     PRODUCT                                      
         EDIT  NPTXSLN,(3,NTPTPRDL),FILL=0   PRODUCT LENGTH                     
         MVC   NTPTPTN,NPTXPRD2    PARTNER                                      
         EDIT  NPTXSLN2,(3,NTPTPTNL),FILL=0  PARTNET LENGTH                     
*                                                                               
         MVC   NTPTNET,SVNET       NETWORK                                      
*                                                                               
         CLI   NPTXNET+2,X'FF'                                                  
         JNE   *+10                                                             
         MVC   NTPTSMED,NPTXNET+1  SUBMEDIA                                     
*                                                                               
         CLI   NPTXPROG,X'FF'      PROGRAM?                                     
         JNE   BDPT10                                                           
         MVC   NTPTDPT,NPTXPROG+1  DAYPART                                      
         MVC   NTPTFEED,NPTXPROG+2 FEED                                         
         J     *+10                                                             
BDPT10   MVC   NTPTPGM,NPTXPROG    PROGRAM                                      
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,7,NPTXR3F                                                     
         X     R0,=XL4'00FFFFFF'                                                
         EDIT  (R0),(5,NTPTREF)                                                 
*                                                                               
         LR    R6,R3                                                            
         MVI   ELCODE,X'10'                                                     
         BAS   RE,GETEL                                                         
         BNE   BDPT22                                                           
         USING NPTDATA,R6                                                       
*                                                                               
         MVC   NTPTDESC,NPTDESC    DESCRIPTION                                  
*                                                                               
         TM    NPTSTAT,X'80'       SOFT DELETE?                                 
         JZ    *+8                                                              
         MVI   NTPTISD,C'Y'                                                     
*                                                                               
         TM    NPTSTAT,NPTS_TIME   TIME IN ELEMENT?                             
         JZ    BDPT20                                                           
         OC    NPTSTIM,NPTSTIM                                                  
         JZ    BDPT20                                                           
         XC    FULL,FULL                                                        
         MVC   FULL(2),NPTSTIM                                                  
         XC    WORK,WORK                                                        
         GOTO1 VUNTIME,DMCB,FULL,WORK                                           
         MVC   NTPTSTIM,WORK                                                    
*                                                                               
         OC    NPTETIM(4),NPTETIM                                               
         JZ    BDPT20                                                           
         XC    FULL,FULL                                                        
         MVC   FULL(2),NPTETIM                                                  
         XC    WORK,WORK                                                        
         GOTO1 VUNTIME,DMCB,FULL,WORK                                           
         MVC   NTPTETIM,WORK                                                    
*                                                                               
BDPT20   GOTO1 DATCON,DMCB,(3,NPTSTART),(10,NTPTSDAT)  START DATE               
         CLC   NPTEND,=XL3'FFFFFF'                                              
         BE    BDPT22                                                           
         GOTO1 DATCON,DMCB,(3,NPTEND),(10,NTPTEDAT)    END DATE                 
*                                                                               
BDPT22   LA    R4,NTPTDROT         IF HAVE PCTS, SHOW DERIVED ROT               
         LR    R6,R3                                                            
         MVI   ELCODE,X'34'        CHECK FOR PCT ELEM                           
         BRAS  RE,GETEL                                                         
         BE    *+8                                                              
         LA    R4,NTPTROT          IF NO PCT, SHOW ROT                          
*                                                                               
         LR    R6,R3                                                            
         MVI   ELCODE,X'32'        FIND ROTATION ELEMENT                        
         BRAS  RE,GETEL                                                         
         JNE   BDPT30                                                           
*                                                                               
         USING NPTPTNEL,R6                                                      
         LLC   R1,NPTPTNLN                                                      
         AHI   R1,-3                                                            
         EX    R1,*+8              MOVE IN ROTATION                             
         B     *+10                                                             
         MVC   0(0,(R4)),NPTPTN-NPTPTNEL(R6)                                    
*                                                                               
BDPT30   MVI   NTPTAGY-1,MXTRTQ                                                 
         MVI   NTPTID-1,MXTRTQ                                                  
         MVI   NTPTMED-1,MXTRTQ                                                 
         MVI   NTPTCLI-1,MXTRTQ                                                 
         MVI   NTPTSMED-1,MXTRTQ                                                
         MVI   NTPTNET-1,MXTRTQ                                                 
         MVI   NTPTPGM-1,MXTRTQ                                                 
         MVI   NTPTDPT-1,MXTRTQ                                                 
         MVI   NTPTFEED-1,MXTRTQ                                                
         MVI   NTPTPRD-1,MXTRTQ                                                 
         MVI   NTPTPRDL-1,MXTRTQ                                                
         MVI   NTPTPTN-1,MXTRTQ                                                 
         MVI   NTPTPTNL-1,MXTRTQ                                                
         MVI   NTPTREF-1,MXTRTQ                                                 
         MVI   NTPTISD-1,MXTRTQ                                                 
         MVI   NTPTDESC-1,MXTRTQ                                                
         MVI   NTPTSDAT-1,MXTRTQ                                                
         MVI   NTPTEDAT-1,MXTRTQ                                                
         MVI   NTPTSTIM-1,MXTRTQ                                                
         MVI   NTPTETIM-1,MXTRTQ                                                
         MVI   NTPTROT-1,MXTRTQ                                                 
         MVI   NTPTDROT-1,MXTRTQ                                                
         MVI   NTPTDX,MXTRTQ                                                    
         MVI   NTPTDX+1,MXTRTQ                                                  
                                                                                
         TR    NTPTAGY,MXTRT                                                    
         TR    NTPTMED,MXTRT                                                    
         TR    NTPTCLI,MXTRT                                                    
         TR    NTPTSMED,MXTRT                                                   
         TR    NTPTNET,MXTRT                                                    
         TR    NTPTPGM,MXTRT                                                    
         TR    NTPTDPT,MXTRT                                                    
         TR    NTPTFEED,MXTRT                                                   
         TR    NTPTPRD,MXTRT                                                    
         TR    NTPTPRDL,MXTRT                                                   
         TR    NTPTPTN,MXTRT                                                    
         TR    NTPTPTNL,MXTRT                                                   
         TR    NTPTREF,MXTRT                                                    
         TR    NTPTISD,MXTRT                                                    
         TR    NTPTDESC,MXTRT                                                   
         TR    NTPTSDAT,MXTRT                                                   
         TR    NTPTEDAT,MXTRT                                                   
         TR    NTPTSTIM,MXTRT                                                   
         TR    NTPTETIM,MXTRT                                                   
         TR    NTPTROT,MXTRT                                                    
         TR    NTPTDROT,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
                                                                                
PTLIT    DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD NESPATTERNCOMMERCIAL RECORD                                             
*       ON ENTRY R6 POINTS TO COMMERCIAL                                        
*                R4 POINTS TO PCT                                               
*                BYTE2 = POSITION                                               
***********************************************************************         
BLDPTC   NTR1  BASE=*,LABEL=*                                                   
         L     RA,PTCLIT                                                        
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTPCD,R2                                                         
         LA    R1,NTPCDL                                                        
         BRAS  RE,INITREC                                                       
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTPCD,R2                                                         
         L     R3,APATREC                                                       
         USING NPTRECD,R3                                                       
                                                                                
         XC    NTPCLEN,NTPCLEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTPCLEN(2),=AL2(NTPCDL)                                          
         MVC   NTPCTYP,NTPTCQ                                                   
         MVC   NTPCID(L'NPTXKEY-3),3(R3)                                        
         MVC   NTPCAGY,SVAGY      ALPHA AGENCY                                  
*                                                                               
         LA    RF,PTCROT           ROTATION                                     
         ZIC   R1,BYTE2                                                         
BPTC10   MVC   NTPCROT,0(RF)                                                    
         AHI   RF,1                                                             
         BCT   R1,BPTC10                                                        
*                                                                               
         MVC   NTPCPRDC(8),0(R6)   FIRST CMML                                   
         OC    8(8,R6),8(R6)       TEST FOR 2ND CMML                            
         JZ    *+10                                                             
         MVC   NTPCPTNC,8(R6)                                                   
*                                                                               
         TM    BYTE,ADIDYQ         ADID?                                        
         JZ    BPTC20                                                           
         GOTO1 VTRPACK,DMCB,(C'U',0(R6)),NTPCPRDC                               
         OC    8(8,R6),8(R6)       TEST FOR 2ND CMML                            
         JZ    BPTC20                                                           
         GOTO1 VTRPACK,DMCB,(C'U',8(R6)),NTPCPTNC                               
*                                                                               
BPTC20   MVC   NTPCPCT,=C'100'     DEFAULT                                      
         LTR   R4,R4               TEST HAVE PCTS                               
         BZ    BPTC30                                                           
         SR    R0,R0                                                            
         ICM   R0,3,1(R4)          GET PCT                                      
         EDIT  (R0),(3,NTPCPCT),0,ALIGN=LEFT                                    
*                                                                               
BPTC30   MVI   NTPCAGY-1,MXTRTQ                                                 
         MVI   NTPCID-1,MXTRTQ                                                  
         MVI   NTPCROT-1,MXTRTQ                                                 
         MVI   NTPCPRDC-1,MXTRTQ                                                
         MVI   NTPCPTNC-1,MXTRTQ                                                
         MVI   NTPCPCT-1,MXTRTQ                                                 
         MVI   NTPCISD-1,MXTRTQ                                                 
         MVI   NTPCDX,MXTRTQ                                                    
         MVI   NTPCDX+1,MXTRTQ                                                  
                                                                                
         TR    NTPCAGY,MXTRT                                                    
         TR    NTPCROT,MXTRT                                                    
         TR    NTPCPRDC,MXTRT                                                   
         TR    NTPCPTNC,MXTRT                                                   
         TR    NTPCPCT,MXTRT                                                    
         TR    NTPCISD,MXTRT                                                    
*                                                                               
         J     EXIT                                                             
                                                                                
PTCLIT   DC    A(LITERAL)                                                       
*                                                                               
ADIDYQ   EQU   X'01'                                                            
TIMEYQ   EQU   X'02'                                                            
PTCROT   DC    C'ABCDEFGHIJKL'                                                  
         LTORG                                                                  
***********************************************************************         
* BUILD NESPATTERNCOMMENT RECORD                                                
*       ON ENTRY, R6 POINTING TO COMMENT ELEMENT                                
***********************************************************************         
BLDPTM   NTR1  BASE=*,LABEL=*                                                   
         L     RA,PTMLIT                                                        
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTPMD,R2                                                         
         LA    R1,NTPMDL                                                        
         BRAS  RE,INITREC                                                       
         ST    R6,ACURELEM                                                      
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTPMD,R2                                                         
         L     R3,APATREC                                                       
         USING NPTRECD,R3                                                       
                                                                                
         XC    NTPMLEN,NTPMLEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTPMLEN(2),=AL2(NTPMDL)                                          
         MVC   NTPMTYP,NTPTMQ                                                   
         MVC   NTPMID(L'NPTXKEY-3),3(R3)                                        
         MVC   NTPMAGY,SVAGY      ALPHA AGENCY                                  
         EDIT  (1,2(R6)),NTPMLINE,ALIGN=LEFT LINE NUMBER                        
*                                                                               
         ZIC   R1,1(R6)                                                         
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   NTPMCOM(0),3(R6)                                                 
*                                                                               
         MVI   NTPMAGY-1,MXTRTQ                                                 
         MVI   NTPMID-1,MXTRTQ                                                  
         MVI   NTPMLINE-1,MXTRTQ                                                
         MVI   NTPMCOM-1,MXTRTQ                                                 
         MVI   NTPMDX,MXTRTQ                                                    
         MVI   NTPMDX+1,MXTRTQ                                                  
                                                                                
         TR    NTPMAGY,MXTRT                                                    
         TR    NTPMLINE,MXTRT                                                   
         TR    NTPMCOM,MXTRT                                                    
*                                                                               
         J     EXIT                                                             
                                                                                
PTMLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* BUILD NESPATTERNHIATUS RECORD                                                 
*       ON ENTRY, R6 POINTING TO HIATUS ELEMENT                                 
***********************************************************************         
BLDPTH   NTR1  BASE=*,LABEL=*                                                   
         L     RA,PTHLIT                                                        
         USING LITERAL,RA                                                       
         L     R2,ADXAXREC                                                      
         USING NTPHD,R2                                                         
         LA    R1,NTPHDL                                                        
         BRAS  RE,INITREC                                                       
         ST    R6,ACURELEM                                                      
         USING NPTHIAEL,R6                                                      
                                                                                
         L     R2,ADXAXREC                                                      
         USING NTPHD,R2                                                         
         L     R3,APATREC                                                       
         USING NUNRECD,R3                                                       
                                                                                
         XC    NTPHLEN,NTPHLEN   RECORD LENGTH/TYPE/ENDOFREC                    
         MVC   NTPHLEN(2),=AL2(NTPHDL)                                          
         MVC   NTPHTYP,NTPTHQ                                                   
         MVC   NTPHID(L'NPTXKEY-3),3(R3)                                        
         MVC   NTPHAGY,SVAGY      ALPHA AGENCY                                  
         EDIT  BYTE,NTPHPOS,ALIGN=LEFT  POSITION                                
*                                                                               
         CLI   NPTHIADT+1,0        TEST MONTH 0                                 
         BNE   BPTH10              NO - SO IT'S A DATE                          
* DISPLAY DAYS ENTRY                                                            
         GOTO1 VDAYUNPK,DMCB,NPTHIADT+2,NTPHDATA                                
         B     BPTH20                                                           
*                                                                               
BPTH10   GOTO1 DATCON,DMCB,(3,NPTHIADT),(5,NTPHDATA)                            
*                                                                               
BPTH20   OC    NPTHIATM,NPTHIATM   TEST TIME PRESENT                            
         BZ    BPTH30                                                           
*                                                                               
         LA    R5,NTPHDATA+19      POINT TO LAST POSSIBLE CHAR                  
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         MVI   1(R5),C','                                                       
         LA    R5,2(R5)                                                         
*                                                                               
         GOTO1 VUNTIME,(R1),NPTHIATM,(R5)                                       
*                                                                               
BPTH30   MVI   NTPHAGY-1,MXTRTQ                                                 
         MVI   NTPHID-1,MXTRTQ                                                  
         MVI   NTPHPOS-1,MXTRTQ                                                 
         MVI   NTPHDATA-1,MXTRTQ                                                
         MVI   NTPHDX,MXTRTQ                                                    
         MVI   NTPHDX+1,MXTRTQ                                                  
                                                                                
         TR    NTPHAGY,MXTRT                                                    
         TR    NTPHPOS,MXTRT                                                    
         TR    NTPHDATA,MXTRT                                                   
*                                                                               
         J     EXIT                                                             
                                                                                
PTHLIT   DC    A(LITERAL)                                                       
         LTORG                                                                  
***********************************************************************         
* LITERALS AND CONSTANTS REQUIRED FOR ALL ROUTINES                    *         
***********************************************************************         
         SPACE 1                                                                
LITERAL  DS    0D                                                               
GETBROAD DC    V(GETBROAD)                                                      
DATCON   DC    V(DATCON)                                                        
VGETDAY  DC    V(GETDAY)                                                        
VADDAY   DC    V(ADDAY)                                                         
VLOADER  DC    V(LOADER)                                                        
COMFACS  DC    V(COMFACS)                                                       
ACLUNPK  DC    V(CLUNPK)                                                        
VNETIO   DC    V(NETIO)                                                         
VNETVALU DC    V(NETVALUE)                                                      
VGETPROF DC    V(GETPROF)                                                       
VNETNET  DC    V(NETNET)                                                        
GETINS   DC    A(0)                                                             
ANEXT    DC    F'0'                                                             
REPSWICH DC    C' '                                                             
CAPSWICH DC    X'01'             SWICH FOR CAP1= X'01' CAP2= X'02'              
DATADISP DC    X'0018'                                                          
*                                                                               
SPACES   DC    CL80' '                                                          
*                                                                               
**********************************************************************          
*                                                                               
LOADER   ICM   RF,15,GETINS                                                     
         BNZR  RE                                                               
         NTR1  ,                                                                
         MVC   WORK,=CL8'T00AAB'                                                
         XC    PLIST(6*4),PLIST                                                 
         GOTO1 VLOADER,PLIST,WORK,0                                             
         MVC   GETINS,4(R1)                                                     
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
ADEMS    NTR1  BASE=*,LABEL=*                                                   
         L     RF,COMFACS                                                       
         USING MYCFACSD,RF                                                      
*                                                                               
         MVC   VDEMADDR,MDEMADDR                                                
         MVC   VDEMDISP,MDEMDISP                                                
         MVC   VDEMOUT,MDEMOUT                                                  
         MVC   VDEMEL,MDEMEL                                                    
         MVC   VDEMAINT,MDEMAINT                                                
         MVC   VDEMAND,MDEMAND                                                  
         MVC   VDEMMATH,MDEMMATH                                                
         MVC   VDEMOVAL,MDEMOVAL                                                
*                                                                               
ADEMSX   DS    0H                                                               
         J     EXIT                                                             
                                                                                
                                                                                
                                                                                
* ON ENTRANCE R1 EXPECTED TO ADDRESS 2 BYTE PID                                 
* ON EXIT WORK WILL HAVE THE 8-CHAR PID                                         
DISPID   NTR1  BASE=*,LABEL=*                                                   
         CLC   0(2,R1),=X'0FFF'   DDS PID?                                      
         BH    *+14                NO                                           
         MVC   WORK(8),=CL8'DDS'                                                
         J     EQXIT                                                            
*                                                                               
         MVC   SVDTDISP,DATADISP                                                
         LAY   RF,MYIO2                                                         
         ST    RF,AMYIO2                                                        
*                                                                               
         LR    R2,R1               SAVE A(PID)                                  
         XC    WORK(8),WORK                                                     
*                                                                               
* GET THE SECURITY AGY FROM ACCESS RECORD                                       
*                                                                               
         XC    TEMPKEY,TEMPKEY                                                  
         LA    R1,TEMPKEY                                                       
*                                                                               
         USING CT5REC,R1                                                        
         MVI   CT5KTYP,CT5KTYPQ                                                 
         MVC   CT5KALPH,SXDTAGY                                                 
         DROP  R1                                                               
*                                                                               
         L     RF,=V(UTL)                                                       
         MVC   SVUTLSYS,4(RF)                                                   
         MVI   4(RF),X'0A'         CONTROL                                      
*                                                                               
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,=CL7'DMRDHI'),=CL7'CTFILE',TEMPKEY,AMYIO2,0         
         L     R6,AMYIO2                                                        
         CLC   TEMPKEY(L'CT5KEY),0(R6)                                          
         BNE   DISPD10                                                          
*                                                                               
         MVI   ELCODE,CTSEAELQ                                                  
         MVC   DATADISP,=AL2(28)   FOR CTFILE                                   
         BRAS  RE,GETEL                                                         
         BNE   DISPD10                  NO NAME ELEMENT                         
         MVC   SVSECAGY,2(R6)                                                   
*                                                                               
* READ PASSWORD RECORD                                                          
*                                                                               
DISPD10  DS    0H                                                               
         XC    TEMPKEY,TEMPKEY                                                  
         MVI   TEMPKEY,C'0'                                                     
         MVC   TEMPKEY+1(2),SVSECAGY                                            
         CLC   SVSECAGY,=C'  '     DO WE HAVE SECURITY AGY?                     
         BH    *+10                YES, USE IT INSTEAD OF AGENCY                
         MVC   TEMPKEY+1(2),SXDTAGY                                             
         MVC   TEMPKEY+23(2),0(R2)     PID                                      
         L     RF,COMFACS                                                       
         L     RF,0(RF)            A(DATAMGR)                                   
         GOTO1 (RF),DMCB,(0,=CL7'DMRDHI'),=CL7'CTFILE',TEMPKEY,AMYIO2,0         
         L     R6,AMYIO2                                                        
         CLC   TEMPKEY(L'CT5KEY),0(R6)                                          
         BNE   DISPIDX                                                          
*                                                                               
         MVI   ELCODE,X'C3'                                                     
         MVC   DATADISP,=AL2(28)   FOR CTFILE                                   
         BRAS  RE,GETEL                                                         
         BNE   DISPIDX                  NO NAME ELEMENT                         
         MVC   WORK(8),2(R6)                                                    
*                                                                               
DISPIDX  DS    0H                                                               
         MVC   DATADISP,SVDTDISP                                                
         L     RF,=V(UTL)                                                       
         MVC   4(1,RF),SVUTLSYS                                                 
         J     EQXIT                                                            
         LTORG                                                                  
                                                                                
                                                                                
                                                                                
                                                                                
**********************************************************************          
       ++INCLUDE MXTRT                                                          
       ++INCLUDE NTXRECID                                                       
       ++INCLUDE PTXRECID                                                       
*                                                                               
         GETEL R6,DATADISP,ELCODE                                               
*                                                                               
         DC    CL8'BUFFER01'                                                    
BUFFER1  DC    5000XL8'00'         HOLDS RECORDS FOR WRITING TO FILE            
BUFFER1L EQU   *-BUFFER1                                                        
*                                                                               
         SPACE 2                                                                
*                                                                               
***********************************************************************         
* WORKING STORAGE REQUIREMENTS                                        *         
***********************************************************************         
         SPACE 1                                                                
WORKD    DSECT                                                                  
DUB      DS    D                                                                
DUB1     DS    D                                                                
DOUBLE   DS    D                                                                
APARM    DS    A                   A(PARAMETER LIST)                            
*                                                                               
PARM     DS    0XL24               PARAMETER LIST                               
AXREC    DS    A                   A(EXTRACT RECORD)                            
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
*                                                                               
DMCB     DS    0F                                                               
PLIST    DS    6F                                                               
ADCONLST DS    0A                  FORCE RESETVAL TO ASSEMBLE                   
FULL     DS    F                                                                
FULL2    DS    F                                                                
HALF     DS    H                                                                
BYTE     DS    X                                                                
ELCODE   DS    X                                                                
CHAR8    DS    CL8                                                              
         DS    C                                                                
STAKNEW  DS    CL15                                                             
BYTE2    DS    XL1                                                              
BYTE3    DS    XL1                                                              
ADXAXREC DS    A                                                                
ABIGWORK DS    A                                                                
ADAYPTBL DS    A                                                                
ACLTREC  DS    A                                                                
AESTREC  DS    A                                                                
AUNITREC DS    A                                                                
AGOALREC DS    A                                                                
AFLTREC  DS    A                                                                
AUCOMREC DS    A                                                                
APDGREC  DS    A                                                                
AUNIVREC DS    A                                                                
APATREC  DS    A                                                                
ABFREC   DS    A                                                                
APLIST   DS    A                   ADDRESS OF PRODUCT LIST                      
APLIST2  DS    A                   ADDRESS OF PRODUCT LIST                      
AEDLIST  DS    A                   ADDRESS OF ESTIMATE DEMO LIST                
NUMPRDS  DS    XL1                 NUMBER OF PRODUCTS IN UNIT                   
CHARTIME DS    CL8                                                              
SPTKEY   DS    XL32                                                             
UNTKEY   DS    XL32                                                             
XSPKEY   DS    XL48                                                             
TEMPKEY  DS    XL32                                                             
TMPKEY   DS    XL32                                                             
SVSPTKEY DS    XL13                                                             
SVDTDISP DS    XL2                                                              
SVSECAGY DS    CL2                                                              
SVUTLSYS DS    X                                                                
*                                                                               
ACURPRD  DS    A                   CURRENT PRODUCT TO PROCESS                   
ACURDEMO DS    A                   CURRENT DEMO TO PROCESS                      
ACURCATV DS    A                   CURRENT CATEGORY VALUES TO OUTPUT            
APOSCATV DS    A                   CURRENT POSITION OF DEMO (OFFSET)            
AEDEMLST DS    A                   A(ESTIMATE DEMO LIST)                        
ACURCOMP DS    A                   A(CURRENT DEMO TO COMPARE)                   
ACURELEM DS    A                   CURRENT ELEMENT                              
*                                                                               
ACURWK   DS    A                   A(CURRENT WEEK)                              
*                                                                               
ANDEMOV  DS    A                   A(NETDEMOVALUES)                             
ANBLOCK  DS    A                   A(NETBLOCK)                                  
*                                                                               
SVPREOPT DS    CL1                 PRECISION                                    
SVPOSTYP DS    CL1                 POST TYPE                                    
*                                                                               
SVDPTA   DS    CL2                 DAYPART                                      
SVDEM21  DS    XL3                 DEMO 21 FROM ESTIMATE                        
SVDEM21W DS    XL1                 DEMO 21 WEIGHT FACTOR                        
*                                                                               
UUNTKEY  DS    XL42                UNIT KEY                                     
UDPTA    DS    XL2                 ALPHA DAYPART                                
UN0PROF  DS    XL16                N0PROFILE                                    
UN2PROF  DS    XL16                N2PROFILE                                    
UN1PROF  DS    XL16                N1PROFILE                                    
UNTISTA  DS    XL4                 NTI STATION                                  
*                                                                               
UFRSTPRD DS    CL3                 FIRST PRODUCT ON UNIT                        
*                                                                               
FDPTA    DS    XL2                 FLIGHT ALPHA DAYPART                         
*                                                                               
SVAGY    DS    CL2                 AGENCY                                       
SVMOD    DS    XL1                 MODIFIER                                     
SVLEN    DS    CL4                                                              
SVTYP    DS    CL5                                                              
SVACT    DS    CL1                                                              
SVDAT    DS    CL8                                                              
SVTME    DS    CL6                                                              
SVCOFF   DS    XL1                 OFFICE FROM CLIENT RECORD                    
SVUSER   DS    XL16                N0 PROFILE                                   
SVUSER2  DS    XL16                N2 PROFILE                                   
SVUSER1  DS    XL16                N1 PROFILE                                   
SVNET    DS    XL4                 NETWORK                                      
*                                                                               
SVNTI    DS    CL4                 NTI STATION                                  
*                                                                               
AGYFLG2  DS    XL1                 AGENCY FLAGS                                 
AGYFLG2_2DP    EQU  X'20'          2 DECIMAL PRECISION                          
AGYFLG2_BDP    EQU  X'10'          USER DEFINED?                                
*                                                                               
DAYPSRCH DS    XL3                 SEARCH ARGUMENT FOR DAYPART                  
*                                                                               
SVNCODE  DS    CL5                 NTI CODE                                     
SVNRES   DS    CL1                 NTI RESULT CODE                              
SVNRFLG  DS    XL1                 NTI RESULT FLAG                              
SVNRPROF EQU   X'01'               CAME FROM PROFILE                            
*                                                                               
* PRODUCT GROUP FIELDS                                                          
*                                                                               
SVPGID   DS    CL4                 PRODUCT GROUP ID                             
SVSGID   DS    CL4                 PRODUCT GROUP ID                             
SVBKLN1  DS    XL1                 L'BREAK1                                     
SVBKLN2  DS    XL1                 L'BREAK2                                     
SVBKLN3  DS    XL1                 L'BREAK3                                     
SVBK1    DS    CL12                BREAK 1                                      
SVBK2    DS    CL12                BREAK 2                                      
SVBK3    DS    CL12                BREAK 3                                      
SVIDLEN  DS    XL1                 L'GROUP ID                                   
*                                                                               
ASGRREC  DS    A                   A(STATION GROUP DEF)                         
ASGSTEL  DS    A                   A(STATION ELEMENT)                           
*                                                                               
ACGRREC  DS    A                   A(CLIENT GROUP DEF)                          
ANETBLRD DS    A                   A(NET BILL READER)                           
*                                                                               
PRDPOS   DS    XL1                 PRODUCT POSTION #                            
*                                                                               
NUMDEMOS DS    XL1                 NUMBER OF DEMOS TO DISPLAY                   
*                                                                               
SVCPROF  DS    CL16                CLIENT PROFILES                              
*                                                                               
MODE     DS    XL1                                                              
*                                                                               
ADATAMGR DS    A                                                                
*                                                                               
MYDUB    DS    D                                                                
*                                                                               
FULL666  DS    F                                                                
         DS    10C                                                              
*                                                                               
VDEGET   DS    A                   A(DEGET)                                     
VUNDAY   DS    A                   A(UNDAY)                                     
VTRPACK  DS    A                   A(TRPACK)                                    
VGETBRD  DS    A                   A(GETBRD)                                    
VDEMCON  DS    A                  A(DEMOCON)                                    
VDEFINE  DS    A                  A(DEFINE)                                     
VBINSRCH DS    A                  A(BINSRCH)                                    
VOFFICER DS    A                   A(OFFICER)                                   
VCALLOFF DS    A                   A(CALLOV)                                    
*                                                                               
VDEMADDR DS    A                                                                
VDEMDISP DS    A                                                                
VDEMOUT  DS    A                                                                
VDEMEL   DS    A                                                                
VDEMAINT DS    A                                                                
VDEMAND  DS    A                                                                
VDEMMATH DS    A                                                                
VDEMOVAL DS    A                                                                
VDAYUNPK DS    A                                                                
VUNTIME  DS    A                                                                
*                                                                               
         DS    D                                                                
WORK     DS    XL256                                                            
         DS    XL024               DBLOCK IS BUILT AT WORK+10 FOR 280           
STAIO    DS    XL200                                                            
         ORG   STAIO                                                            
DEMOLIST DS    XL200                                                            
*                                                                               
NUMBIN   DS    H                                                                
AMYIO2   DS    A                                                                
*                                                                               
ADCONSD  DS    0A                                                               
*                                                                               
DEMOFLAG DS    X                                                                
MOREDEM  EQU   X'01'               MORE THAN 25 DEMOS                           
*                                                                               
NTTUSSCC_P DS  XL8                 COMMERCIAL OR PACKED AD-ID                   
NTTUSACC_P DS  XL8                 COMMERCIAL OR PACKED AD-ID                   
*                                                                               
RAWDEMOS DS    XL400                                                            
EQVDEMOS DS    XL400                                                            
*                                                                               
MYIO     DS    XL2500                                                           
         DS    0F                                                               
MYIO2    DS    XL3000                                                           
*                                                                               
WORKL    EQU   *-WORKD                                                          
         EJECT                                                                  
***********************************************************************         
* DSECT TO COVER UNIT INFO PASSED TO UNIT/UAD LOAD                    *         
***********************************************************************         
UINFOD   DSECT                                                                  
UIUNTKEY DS    XL20                UNIT KEY                                     
UICLOFF  DS    XL1                 CLIENT OFFICE                                
UICLPROF DS    XL16                CLIENT PROFILES                              
UIUNDAY  DS    XL4                 A(UNDAY)                                     
UITRPACK DS    XL4                 A(TRPACK)                                    
UIDEMCON DS    XL4                 A(DEMCON)                                    
UIDEFINE DS    XL4                 A(DEFINE)                                    
UICLTREC DS    XL4                 A(CLIENT RECORD)                             
UIESTREC DS    XL4                 A(ESTIMATE RECORD)                           
UIDPTA   DS    XL2                 ALPHA DAYPART                                
UIN0PROF DS    XL16                N0PROFILE                                    
UIN2PROF DS    XL16                N2PROFILE                                    
UIN1PROF DS    XL16                N1PROFILE                                    
UINTISTA DS    XL4                 NTI STATION                                  
UIAGYFL2 DS    XL1                 AGENCYFLAG2                                  
UINTBLRD DS    XL4                 A(NET BILL READER)                           
UINFOLQ  EQU   *-UINFOD                                                         
         EJECT                                                                  
***********************************************************************         
* OTHER INCLUDED DSECTS                                               *         
***********************************************************************         
MYCFACSD DSECT                                                                  
MDATAMGR DS    A                                                                
         DS    A                                                                
         DS    A                   GETMSG)                                      
         DS    A                   GETTXT)                                      
         DS    A                   SWITCH)                                      
MHELLO   DS    A                   HELLO)                                       
         DS    A                   SCANNER)                                     
         DS    A                   UNSCAN)                                      
         DS    A                   HEXIN)                                       
         DS    A                   HEXOUT)                                      
         DS    A                   CASHVAL)                                     
         DS    A                   DATVAL)                                      
         DS    A                   DATCON)                                      
         DS    A                   TERMVAL)                                     
         DS    A                   SCUNKEY)                                     
         DS    A                   ADDAY)                                       
         DS    A                   GETDAY)                                      
MGETPROF DS    A                   GETPROF)                                     
         DS    A                   PERVERT)                                     
         DS    A                   GETFACT)                                     
         DS    A                   XSORT)                                       
         DS    A                   REQTWA)                                      
         DS    A                   GETFLD)                                      
*&&US                                                                           
         DS    A                   DDISPSRT)                                    
MDEMADDR DS    A                                                                
MDEMDISP DS    A                   DEMDISP)                                     
         DS    A                   DBOOK)                                       
         DS    A                   DSTATION)                                    
         DS    A                   DMASTER)                                     
         DS    A                   DFORMULA)                                    
         DS    A                   DNAME)                                       
         DS    A                   DCODE)                                       
         DS    A                   DCONTROL)                                    
         DS    A                   DADJUST)                                     
MDEMOUT  DS    A                   DEMOUT)                                      
MDEMEL   DS    A                   DEMEL)                                       
MDEMAINT DS    A                   DEMAINT)                                     
MDEMAND  DS    A                   DEMAND)                                      
MDEMMATH DS    A                   DEMOMATH)                                    
MDEMOVAL DS    A                   DEMOVAL)                                     
         DS    A                   GENERAL)                                     
         DS    A                   PERVAL)                                      
         DS    A                   DLFLD)                                       
         DS    A                                                                
*&&                                                                             
         DS    A                   GLOBBER)                                     
         DS    A                   MINIO)                                       
         DS    A                   PARSNIP)                                     
         DS    A                   DICTATE)                                     
         DS    A                   EDITOR)                                      
         DS    A                   GETHELP)                                     
         DS    A                   CUREDIT)                                     
         DS    A                   GETRET)                                      
         DS    A                   REPORT)                                      
         DS    A                   BLDSUR)                                      
         DS    A                   GETCUR)                                      
         DS    A                   GETNARR)                                     
         DS    A                   DEJAVU)                                      
         DS    A                   SECRET)                                      
         DS    A                   BILLIT)                                      
         DS    A                                                                
         DS    A                   PQPROF)                                      
         DS    2A                                                               
         DS    A                   BINSRCH)                                     
         DS    A                   PROTON)                                      
         DS    A                   PROTOFF)                                     
         DS    A                   HELEN)                                       
         DS    A                   MQIO)                                        
         DS    A                   EUREKA                                       
         DS    A                                                                
         DS    A                   MASTC                                        
         DS    A                   LOCKSPACE                                    
         DS    8A                  SPARE                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE RXUSERD                                                        
       ++INCLUDE NTXRECD                                                        
       ++INCLUDE SPGENAGY                                                       
       ++INCLUDE SPGENGRP                                                       
       ++INCLUDE SPGENCLT                                                       
       ++INCLUDE SPGENPRD                                                       
       ++INCLUDE SPGENEST                                                       
       ++INCLUDE SPGENMKT                                                       
       ++INCLUDE SPGENSTA                                                       
       ++INCLUDE SPGENADD                                                       
       ++INCLUDE SPGENPROG                                                      
       ++INCLUDE SPGENCLG                                                       
       ++INCLUDE SPGENWBFLT                                                     
       ++INCLUDE NEGENDPT                                                       
       ++INCLUDE NEGENPACK                                                      
       ++INCLUDE NEGENUNIT                                                      
GOALHDRD DSECT                                                                  
       ++INCLUDE SPGENGOAL                                                      
UCOMHDRD DSECT                                                                  
       ++INCLUDE SPGENUCOM                                                      
REPD     DSECT                                                                  
       ++INCLUDE SPGENREP                                                       
       ++INCLUDE SPTRCMML                                                       
       ++INCLUDE SPGENPRG                                                       
       ++INCLUDE DDOFFICED                                                      
       ++INCLUDE DDCOMFACS                                                      
NBLOCKD  DSECT                                                                  
       ++INCLUDE NETBLOCKN                                                      
       ++INCLUDE NETBILLRD                                                      
NDEMOTD  DSECT                                                                  
       ++INCLUDE NETDEMOT                                                       
NDEMOPD  DSECT                                                                  
       ++INCLUDE NETDEMOP                                                       
       ++INCLUDE DXDSECTS                                                       
       ++INCLUDE DEDBLOCK                                                       
       ++INCLUDE FASYSFAC                                                       
CMMNT    DSECT                                                                  
       ++INCLUDE PCOMELEM                                                       
ZZZPOOLD DSECT                                                                  
       ++INCLUDE PPRELEM                                                        
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE NTXCOMMON                                                      
       ++INCLUDE SPGENBFML                                                      
       ++INCLUDE SPGENUNIV                                                      
       ++INCLUDE SPTRNPAT                                                       
       ++INCLUDE DDACTIVD                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'164NTXROUTS  03/02/21'                                      
         END                                                                    

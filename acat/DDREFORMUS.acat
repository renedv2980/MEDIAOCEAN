*          DATA SET DDREFORMUS AT LEVEL 005 AS OF 11/22/01                      
*CATALP REFORM                                                                  
         TITLE 'REFORM - REPORT TRANSFORMATION ROUTINE'                         
**********************************************************************          
* REFORM - REPORT TRANSFORMATION ROUTINE                             *          
* PARAMETERS:                                                        *          
*                                                                    *          
* AL4=A(REFORM DATA BLOCK, AS IN DDREFORMD)                          *          
*                                                                    *          
* AL4=A(REFORM WORK AREA WHICH CAN TAKE VALUES:                      *          
*                                                                    *          
*     ON ENTRY IN INITIALISATION MODE:                               *          
*     A(REQUEST DETAIL LINES BLOCK - I.E. ALL THE LINES OF THE FIRST *          
*       PAGE OF THE REPORT SEPARTED BY X'00', TERMINATED BY X'0000'  *          
*     ON RETURN:                                                     *          
*     A(AREA FOR RETURNED OUTPUT DATA)                               *          
*                                                                    *          
* AL4=A(COMFACS)                                                     *          
*                                                                    *          
**********************************************************************          
         SPACE 1                                                                
         PRINT NOGEN                                                            
REFORM   CSECT                                                                  
         NMOD1 WORKX-WORKD,**RFRM**,RA,R9,CLEAR=YES,RR=RE                       
         USING WORKD,RC                                                         
         ST    R1,APARM                                                         
         ST    RE,RELO                                                          
         MVC   PARM,0(R1)                                                       
         L     R2,0(R1)                                                         
         USING REFORMD,R2                                                       
         L     RF,8(R1)                                                         
         USING COMFACSD,RF                                                      
         MVC   VDATAMGR,CDATAMGR                                                
         MVC   VHELLO,CHELLO                                                    
         MVC   VDATCON,CDATCON                                                  
         MVC   VPERVAL,CPERVAL                                                  
         DROP  RF                                                               
         TM    REFSFLG1,REFSENDQ                                                
         BO    PROCEND                                                          
         MVI   DATAFLAG,C'N'                                                    
         TM    REFSFLG1,REFSDATQ                                                
         BZ    *+8                                                              
         MVI   DATAFLAG,C'Y'                                                    
         TM    REFSFLG1,REFSINIQ                                                
         BO    INITIAL                                                          
         B     PROCLINE                                                         
*                                                                               
ERREXIT  BAS   RE,EREPORT                                                       
         OI    REFSFLG1,REFSERRQ                                                
         TM    REFERFLG,REFEFCOQ   TEST CONTINUE AFTER ERROR                    
         BZ    EXIT                                                             
*                                                                               
GETNEXT  OI    REFSFLG1,REFSGETQ                                                
         OC    REFDER,REFDER                                                    
         BNZ   *+12                                                             
         OI    REFSFLG1,REFSCBAQ                                                
         B     EXIT                                                             
         CLM   RF,15,REFDER                                                     
         BNL   PDATEND                                                          
         OI    REFSFLG1,REFSCBAQ                                                
         B     EXIT                                                             
*                                                                               
CALLBACK OI    REFSFLG1,REFSCBAQ                                                
         B     EXIT                                                             
*                                                                               
EXIT     EQU   *                                                                
         XMOD1 1                                                                
         EJECT                                                                  
**********************************************************************          
* RETURN TO CALLER                                                   *          
**********************************************************************          
         SPACE 1                                                                
RETURN   EQU   *                                                                
         B     EXIT                EXIT TO CALLER                               
         EJECT                                                                  
**********************************************************************          
* INITIALISE REFORM DATA BLOCK                                       *          
**********************************************************************          
         SPACE 1                                                                
INITIAL  EQU   *                                                                
         MVI   REFSFLG1,0                                                       
         LA    RE,REFFORM                                                       
         ICM   RF,15,=AL4(L'REFFORM)                                            
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
*                                  INITIALISE DEBUG BUFFER                      
         LH    RE,=Y(REFDEBUG-REFORMD)                                          
         LA    RE,REFORMD(RE)                                                   
         ICM   RF,15,=AL4(L'REFDEBUG)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         XC    REFDEPTR,REFDEPTR                                                
         XC    REFDROW,REFDROW                                                  
*                                  INITIALISE DEBUG BUFFER                      
         LA    R4,IOAREA                                                        
         USING GREFD,R4                                                         
         XC    GREFKEY,GREFKEY                                                  
         MVI   GREFKREC,GREFRECQ                                                
         MVC   GREFAGY,REFAGY                                                   
         MVC   GREFID,REFID                                                     
         MVC   IOKEY,GREFKEY                                                    
         GOTO1 VDATAMGR,DMCB,(X'24',DMREAD),GENDIR,IOKEY,(R4),DMWORK            
         CLI   8(R1),0                                                          
         BNE   INITER10                                                         
*                                                                               
         MVC   DMDA,GRDDA                                                       
         GOTO1 VDATAMGR,DMCB,(X'24',GETREC),GENFIL,DMDA,(R4),DMWORK             
         CLI   8(R1),0                                                          
         BNE   INITER10                                                         
         LA    R3,GRFIRST(R4)                                                   
*                                                                               
INIT010  CLI   0(R3),0                                                          
         BE    INIT100                                                          
         CLI   0(R3),GRTDELQ                                                    
         BE    INIT030                                                          
INIT020  SR    RF,RF                                                            
         IC    RF,1(R3)                                                         
         AR    R3,RF                                                            
         B     INIT010                                                          
*                                                                               
         USING GRTDEL,R3                                                        
INIT030  EQU   *                   PROCESS TRASFORM DEFINITION ELEMENT          
         MVC   REFXSYS,GRTDSYS                                                  
         MVC   REFXSUB,GRTDSUB                                                  
         MVC   REFTAB,GRTDTAB                                                   
         MVC   REFTABN,GRTDTABN                                                 
         MVC   REFACT,GRTDACT                                                   
         MVC   REFDTM,GRTDDTM                                                   
         CLI   REFDTM,0                                                         
         BNE   *+8                                                              
         MVI   REFDTM,C'N'                                                      
         MVC   REFSPC,GRTDSPC                                                   
         CLI   REFSPC,0                                                         
         BNE   *+8                                                              
*&&UK*&& MVI   REFSPC,C'Y'                                                      
*&&US*&& MVI   REFSPC,C'N'                                                      
         CLI   GRTDBDE,C'Y'                                                     
         BNE   *+8                                                              
         OI    REFMODE,REFMBDEQ                                                 
         MVC   REFHSR,GRTDHSR                                                   
         MVC   REFHER,GRTDHER                                                   
         MVC   REFDSR,GRTDDSR                                                   
         MVC   REFDER,GRTDDER                                                   
         MVC   REFDSC,GRTDDSC                                                   
         MVC   REFDEC,GRTDDEC                                                   
         MVC   REFDCN,GRTDDCN                                                   
         MVC   REFTCODE,GRTDTCOD                                                
         MVC   REFPLFM,GRTDPLFM                                                 
         MVC   REFDELM,GRTDDELM                                                 
         MVC   REFEOR,GRTDEOR                                                   
         MVC   REFTEXT,GRTDTEXT                                                 
         MVC   REFNULL,GRTDNULL                                                 
         MVC   REFMONY,GRTDMONY                                                 
         MVC   REFKEY,GRTDKEY                                                   
         MVC   REFVER,GRTDVER                                                   
         MVC   REFLEV,GRTDLEV                                                   
         MVC   REFSQLB,GRTDSQLB                                                 
         MVC   REFSQLA,GRTDSQLA                                                 
         MVC   REFSQLI,GRTDSQLI                                                 
         CLI   REFSQLI,0                                                        
         BNE   *+8                                                              
         MVI   REFSQLI,C'N'                                                     
         B     INIT020                                                          
*                                                                               
         USING GRTFEL,R3                                                        
INIT100  EQU   *                                                                
         LA    R5,1                                                             
         LA    R6,6                                                             
         LA    R7,REFFORM                                                       
         LA    R3,ELEMENT                                                       
*                                                                               
INIT110  XC    ELEMENT,ELEMENT                                                  
         MVI   ELEMENT,GRTFELQ    FIND NEXT COMMENT ELEMENT                     
         MVI   ELEMENT+1,2                                                      
         STH   R5,ELEMENT+2                                                     
         GOTO1 VHELLO,DMCB,(C'G',GENFIL),(ELEMENT,(R4)),               *        
               (ELEMENT+1,ELEMENT+2)                                            
         CLI   12(R1),0                                                         
         BNE   INIT120                                                          
         ICM   R3,15,12(R1)                                                     
         BZ    INIT120                                                          
         SR    RE,RE                                                            
         IC    RE,GRTFELL                                                       
         LA    RF,GRTFELLQ+1                                                    
         SR    RE,RF                                                            
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R7),GRTFDAT                                                  
*                                                                               
INIT120  LA    RE,1(RE)                                                         
         AR    R7,RE                                                            
         LA    R5,1(R5)                                                         
         BCT   R6,INIT110                                                       
*                                                                               
INIT200  EQU   *                                                                
         LA    RE,1                                                             
         STCM  RE,15,REFROW                                                     
         OC    REFDSC,REFDSC                                                    
         BZ    *+10                                                             
         ICM   RE,15,REFDSC                                                     
         STCM  RE,15,REFCOL                                                     
         STCM  RE,15,REFPCOL                                                    
         XC    REFHDRP,REFHDRP                                                  
         XC    REFDBPTR,REFDBPTR                                                
         LA    RE,REFDBUFF                                                      
         ICM   RF,15,=AL4(L'REFDBUFF)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
*                                  GET THE CURRENT MVS DATE/TIME                
         CLI   REFDTM,C'N'                                                      
         BE    INIT300                                                          
*                                  GET THE CURRENT MVS DATE/TIME                
         SR    R0,R0                                                            
         SR    R1,R1                                                            
         TIME                                                                   
         LTR   R0,R0                                                            
         BZ    INITER20                                                         
         ST    R0,MVSTIME                                                       
         ST    R1,MVSDATE                                                       
*                                  GET DATE NOW IN EBCDIC                       
         MVC   DATEN,SPACES                                                     
         MVC   TIMEN,SPACES                                                     
         CLI   REFSQLI,C'N'                                                     
         BE    INIT210                                                          
         GOTO1 VDATCON,DMCB,(5,0),(10,DATEN)                                    
         B     INIT220                                                          
INIT210  GOTO1 VDATCON,DMCB,(5,0),(10,DATEN)                                    
*                                                                               
INIT220  L     R1,MVSTIME                                                       
*                                  CONVERT TIME NOW TO EBCDIC                   
         SRL   R1,28                                                            
         STC   R1,TIMEN                                                         
         OI    TIMEN,X'F0'                                                      
         L     R1,MVSTIME                                                       
         SRL   R1,24                                                            
         STC   R1,TIMEN+1                                                       
         OI    TIMEN+1,X'F0'                                                    
         MVI   TIMEN+2,C':'                                                     
         L     R1,MVSTIME                                                       
         SRL   R1,20                                                            
         STC   R1,TIMEN+3                                                       
         OI    TIMEN+3,X'F0'                                                    
         L     R1,MVSTIME                                                       
         SRL   R1,16                                                            
         STC   R1,TIMEN+4                                                       
         OI    TIMEN+4,X'F0'                                                    
         MVI   TIMEN+5,C':'                                                     
         L     R1,MVSTIME                                                       
         SRL   R1,12                                                            
         STC   R1,TIMEN+6                                                       
         OI    TIMEN+6,X'F0'                                                    
         L     R1,MVSTIME                                                       
         SRL   R1,8                                                             
         STC   R1,TIMEN+7                                                       
         OI    TIMEN+7,X'F0'                                                    
*                                                                               
         MVC   REFDATIM,SPACES                                                  
         MVC   REFDATIM(8),DATEN                                                
         MVC   REFDATIM+9(8),TIMEN                                              
         B     INIT300                                                          
*                                                                               
INIT300  EQU   *                                                                
         OC    AREFAREA,AREFAREA                                                
         BZ    INIT310                                                          
         BAS   RE,TRANSRQD                                                      
         BNE   ERREXIT                                                          
*                                                                               
INIT310  EQU   *                                                                
         MVI   REFSQFLG,X'00'                                                   
         OC    REFSQLB,REFSQLB                                                  
         BZ    INIT320                                                          
         LH    RF,=Y(REFSQBUF-REFORMD)                                          
         LA    RF,REFORMD(RF)                                                   
         GOTO1 LOADSQL,DMCB,REFSQLB,(RF)                                        
         BNE   ERREXIT                                                          
         LH    RF,=Y(REFSQBUF-REFORMD)                                          
         LA    RF,REFORMD(RF)                                                   
         GOTO1 TRANSSQL,DMCB,(RF)                                               
         BNE   ERREXIT                                                          
         OI    REFSQFLG,REFSFBEQ                                                
         XC    REFSQPTR,REFSQPTR                                                
*                                                                               
INIT320  EQU   *                                                                
         OC    REFSQLA,REFSQLA                                                  
         BZ    INIT330                                                          
         LH    RF,=Y(REFSQAFB-REFORMD)                                          
         LA    RF,REFORMD(RF)                                                   
         GOTO1 LOADSQL,DMCB,REFSQLA,(RF)                                        
         BNE   ERREXIT                                                          
         LH    RF,=Y(REFSQAFB-REFORMD)                                          
         LA    RF,REFORMD(RF)                                                   
         GOTO1 TRANSSQL,DMCB,(RF)                                               
         BNE   ERREXIT                                                          
         OI    REFSQFLG,REFSFAFQ                                                
         XC    REFSQPTR,REFSQPTR                                                
*                                                                               
INIT330  EQU   *                                                                
         CLI   DATAFLAG,C'N'                                                    
         BE    EXIT                                                             
         ICM   RF,15,AREFAREA                                                   
         BZ    INITER30                                                         
         LA    RE,4                                                             
         SLL   RE,16                                                            
         STCM  RE,15,0(RF)                                                      
         B     PROCLINE                                                         
         DROP  R3,R4                                                            
*                                                                               
INITER10 EQU   *                                                                
         MVC   REFSCODE,=AL3(110)                                               
         B     ERREXIT                                                          
*                                                                               
INITER20 EQU   *                                                                
         MVC   REFSCODE,=AL3(120)                                               
         B     ERREXIT                                                          
*                                                                               
INITER30 EQU   *                                                                
         MVC   REFSCODE,=AL3(130)                                               
         B     ERREXIT                                                          
         EJECT                                                                  
**********************************************************************          
* TRANSLATE REQUEST DETAILS COMMAND IN FORMULA TO VALUE FROM BLOCK   *          
**********************************************************************          
         SPACE 1                                                                
TRANSRQD NTR1  *                                                                
         LA    RE,FORMWORK                                                      
         ICM   RF,15,=AL4(L'FORMWORK)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         LA    R3,REFFORM                                                       
         LA    R4,L'REFFORM                                                     
         LA    R5,FORMWORK                                                      
         MVI   LITFLAG,C'N'                                                     
*                                                                               
TRQD010  CLI   LITFLAG,C'N'                                                     
         BE    TRQD012                                                          
         CLI   0(R3),C'"'                                                       
         BNE   TRQD022                                                          
         MVI   LITFLAG,C'N'                                                     
         B     TRQD022                                                          
TRQD012  CLI   0(R3),C';'                                                       
         BE    TRQD020                                                          
         CLI   0(R3),C'"'                                                       
         BNE   TRQD014                                                          
         MVI   LITFLAG,C'Y'                                                     
         B     TRQD022                                                          
TRQD014  CLI   0(R3),C' '                                                       
         BE    TRQD022                                                          
         CLI   0(R3),C'R'                                                       
         BE    TRQD030                                                          
         B     TRQD022                                                          
*                                                                               
TRQD020  CLI   1(R3),C';'                                                       
         BE    TRQD100                                                          
*                                                                               
TRQD022  MVC   0(1,R5),0(R3)                                                    
         LA    R5,1(R5)                                                         
         LA    R3,1(R3)                                                         
         BCT   R4,TRQD010                                                       
         B     TRQDE010                                                         
*                                                                               
TRQD030  EQU   *                                                                
         BAS   RE,RQDFORM                                                       
         BNE   TRQDNO                                                           
         BAS   RE,GETRQD                                                        
         BNE   TRQDNO                                                           
         TM    DATATYPE,DATADATQ                                                
         BNZ   TRQD040                                                          
         MVI   0(R5),C'"'                                                       
         LA    R5,1(R5)                                                         
         ICM   RF,15,RQDLEN                                                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R5),WORK                                                     
         LA    R5,1(RF,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,1(R5)                                                         
         B     TRQD050                                                          
*                                                                               
TRQD040  EQU   *                                                                
         MVC   FIELD,SPACES                                                     
         MVC   FIELD,WORK                                                       
         MVI   0(R5),C'"'                                                       
         LA    R5,1(R5)                                                         
         MVI   BYTE,0                                                           
         OI    BYTE,PVINSGLO+PVINSGLS                                           
         ICM   RF,15,RQDLEN                                                     
         BZ    TRQD040C                                                         
         LA    RE,FIELD                                                         
TRQD040A CLI   0(RE),X'81'                                                      
         BL    TRQD040B                                                         
         CLI   0(RE),X'A9'                                                      
         BH    TRQD040B                                                         
         OI    0(RE),X'40'                                                      
TRQD040B LA    RE,1(RE)                                                         
         BCT   RF,TRQD040A                                                      
TRQD040C EQU   *                                                                
*                                                                               
         CLI   REFVER,1                                                         
         BL    TRQD041                                                          
         ICM   RF,15,RQDLEN                                                     
         BZ    PFLDE010                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   FIELD(0),SPACES                                                  
         BE    PFLDE010                                                         
*                                                                               
TRQD041  EQU   *                                                                
         ICM   RF,15,RQDLEN                                                     
         GOTO1 VPERVAL,DMCB,((RF),FIELD),(BYTE,WORK)                            
         CLI   4(R1),PVRCONE                                                    
         BNE   PFLDE010                                                         
         MVC   DATEB,WORK+PVALCSTA-PERVALD                                      
*        GOTO1 VDATCON,DMCB,(2,DATEB),(10,FIELD)                                
*                                  FORCE UK DATE FORMAT ALWAYS ??               
*                                  UNLESS US PIANO REFORM ??                    
         CLI   REFSQLI,C'N'                                                     
         BE    TRQD042                                                          
*&&UK*&& B     TRQD042                                                          
         MVC   FIELD(2),WORK+PVALESTA+2-PERVALD                                 
         MVC   FIELD+3(2),WORK+PVALESTA+4-PERVALD                               
         MVC   FIELD+6(2),WORK+PVALESTA-PERVALD                                 
         B     TRQD044                                                          
TRQD042  MVC   FIELD(2),WORK+PVALESTA+4-PERVALD                                 
         MVC   FIELD+3(2),WORK+PVALESTA+2-PERVALD                               
         MVC   FIELD+6(2),WORK+PVALESTA-PERVALD                                 
TRQD044  MVI   FIELD+2,C'/'                                                     
         MVI   FIELD+5,C'/'                                                     
         CLI   FIELD+6,C'9'        MAKE Y2K FORMAT YEAR DISPLAYABLE             
         BNH   *+18                                                             
         SR    RF,RF                                                            
         IC    RF,FIELD+6                                                       
         AHI   RF,-10                                                           
         STC   RF,FIELD+6                                                       
         LA    RF,8                                                             
         STCM  RF,15,RQDLEN                                                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R5),FIELD                                                    
         LA    R5,1(RF,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,1(R5)                                                         
*                                                                               
TRQD050  EQU   *                                                                
         ICM   R3,15,NEXTFORM                                                   
         B     TRQD010                                                          
*                                                                               
TRQD100  MVC   0(2,R5),0(R3)                                                    
         LA    RE,REFFORM                                                       
         ICM   RF,15,=AL4(L'REFFORM)                                            
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         LA    RE,REFFORM                                                       
         ICM   RF,15,=AL4(L'REFFORM)                                            
         LA    R0,FORMWORK                                                      
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
         B     TRQDOK                                                           
*                                                                               
TRQDE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(210)                                               
         B     TRQDNO                                                           
*                                                                               
TRQDNO   B     NO                                                               
TRQDOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* TRANSLATE SQL STATMENT BUFFER COMMAND TO FORMULA VALUE FROM BLOCK  *          
**********************************************************************          
         SPACE 1                                                                
TRANSSQL NTR1  *                                                                
         L     R6,0(R1)                                                         
         LA    RE,SQLWORK                                                       
         ICM   RF,15,=AL4(L'SQLWORK)                                            
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         LR    R3,R6                                                            
         ICM   R4,15,=AL4(L'REFSQBUF)                                           
         LA    R5,SQLWORK                                                       
*                                                                               
TSQL010  EQU   *                                                                
         CLI   0(R3),X'00'                                                      
         BE    TSQL020                                                          
         CLI   0(R3),C'{'                                                       
         BE    TSQL030                                                          
         B     TSQL022                                                          
*                                                                               
TSQL020  CLI   1(R3),X'00'                                                      
         BE    TSQL100                                                          
*                                                                               
TSQL022  MVC   0(1,R5),0(R3)                                                    
         LA    R5,1(R5)                                                         
         LA    R3,1(R3)                                                         
         BCT   R4,TSQL010                                                       
         B     TSQLE010                                                         
*                                                                               
TSQL030  EQU   *                                                                
         LA    R3,1(R3)                                                         
         CLI   0(R3),C'R'                                                       
         BNE   TSQLE010                                                         
         BAS   RE,RQDFORM                                                       
         BNE   TSQLNO                                                           
         BAS   RE,GETRQD                                                        
         BNE   TSQLNO                                                           
         ICM   RF,15,RQDLEN                                                     
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R5),WORK                                                     
         LA    R5,1(RF,R5)                                                      
         ICM   R3,15,NEXTFORM                                                   
         CLI   0(R3),C'}'                                                       
         BNE   TSQLE020                                                         
         LA    R3,1(R3)                                                         
         B     TSQL010                                                          
*                                                                               
TSQL100  MVC   0(2,R5),0(R3)                                                    
         LR    RE,R6                                                            
         ICM   RF,15,=AL4(L'REFSQBUF)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         LR    RE,R6                                                            
         ICM   RF,15,=AL4(L'REFSQBUF)                                           
         LA    R0,SQLWORK                                                       
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
         B     TSQLOK                                                           
*                                                                               
TSQLE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(710)                                               
         B     TSQLNO                                                           
*                                                                               
TSQLE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(720)                                               
         B     TSQLNO                                                           
*                                                                               
TSQLNO   B     NO                                                               
TSQLOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* INTERPRET REQUEST DETAILS FORMULA COMMAND, GET ROW, COLUMN, RQDLEN *          
* R3=A(COMMAND), RETURN NEXTFORM=A(END OF FORMULA COMMAND)           *          
**********************************************************************          
         SPACE 1                                                                
RQDFORM  NTR1                                                                   
         MVI   DATATYPE,DATATXTQ                                                
         CLI   1(R3),C'('                                                       
         BNE   RQDFE010                                                         
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         LA    R4,2(R3)                                                         
         SR    R6,R6                                                            
*                                                                               
RQDF010  CLI   0(R4),C'0'                                                       
         BL    RQDF020                                                          
         CLI   0(R4),C'9'                                                       
         BH    RQDF020                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     RQDF010                                                          
*                                                                               
RQDF020  CLI   0(R4),C','                                                       
         BNE   RQDFE020                                                         
         GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   RQDFE030                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,ROW                                                        
         LR    R7,R6                                                            
*                                                                               
         LA    R4,1(R4)                                                         
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         SR    R6,R6                                                            
*                                                                               
RQDF030  CLI   0(R4),C'0'                                                       
         BL    RQDF040                                                          
         CLI   0(R4),C'9'                                                       
         BH    RQDF040                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     RQDF030                                                          
*                                                                               
RQDF040  CLI   0(R4),C','                                                       
         BNE   RQDFE040                                                         
         GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   RQDFE050                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,COLUMN                                                     
*                                                                               
         LA    R4,1(R4)                                                         
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         SR    R6,R6                                                            
*                                                                               
RQDF050  CLI   0(R4),C'0'                                                       
         BL    RQDF060                                                          
         CLI   0(R4),C'9'                                                       
         BH    RQDF060                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     RQDF050                                                          
*                                                                               
RQDF060  CLI   0(R4),C')'                                                       
         BNE   RQDFE060                                                         
         GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   RQDFE070                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,RQDLEN                                                     
         LA    R4,1(R4)                                                         
*                                                                               
         CLI   0(R4),C'D'                                                       
         BNE   RQDF070                                                          
         MVI   DATATYPE,DATADATQ                                                
         LA    R4,1(R4)                                                         
*                                                                               
RQDF070  EQU   *                                                                
         STCM  R4,15,NEXTFORM                                                   
         B     RQDFOK                                                           
*                                                                               
RQDFE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(310)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(320)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFE030 EQU   *                                                                
         MVC   REFSCODE,=AL3(330)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFE040 EQU   *                                                                
         MVC   REFSCODE,=AL3(340)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFE050 EQU   *                                                                
         MVC   REFSCODE,=AL3(350)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFE060 EQU   *                                                                
         MVC   REFSCODE,=AL3(360)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFE070 EQU   *                                                                
         MVC   REFSCODE,=AL3(370)                                               
         B     RQDFNO                                                           
*                                                                               
RQDFNO   B     NO                                                               
RQDFOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* GET REQUEST DETAIL VALUE FROM BLOCK, GIVEN ROW, COLUMN, RQDLEN     *          
* RETURN IN WORK                                                     *          
**********************************************************************          
         SPACE 1                                                                
GETRQD   NTR1                                                                   
         XC    WORK,WORK                                                        
         ICM   R4,15,AREFAREA                                                   
         BZ    GRQDE040                                                         
         ICM   R5,15,ROW                                                        
         BZ    GRQDE050                                                         
GRQD010  BCT   R5,GRQD020                                                       
         B     GRQD040                                                          
GRQD020  CLI   0(R4),0                                                          
         BE    GRQD030                                                          
         LA    R4,1(R4)                                                         
         B     GRQD020                                                          
GRQD030  CLI   1(R4),0                                                          
         BE    GRQDE010                                                         
         LA    R4,1(R4)                                                         
         B     GRQD010                                                          
*                                                                               
GRQD040  ICM   R5,15,COLUMN                                                     
         BZ    GRQDE060                                                         
*                                                                               
GRQD050  BCT   R5,GRQD060                                                       
         B     GRQD070                                                          
GRQD060  CLI   0(R4),0                                                          
         BE    GRQDE020                                                         
         LA    R4,1(R4)                                                         
         B     GRQD050                                                          
*                                                                               
GRQD070  ICM   R5,15,RQDLEN                                                     
         BZ    GRQDE070                                                         
         LA    RF,WORK                                                          
GRQD080  EQU   *                                                                
         MVC   0(1,RF),0(R4)                                                    
         CLI   REFVER,1                                                         
         BL    GRQD084                                                          
         CLI   0(RF),0                                                          
         BE    GRQD082                                                          
         CLI   0(RF),C';'                                                       
         BE    GRQD082                                                          
         CLI   0(RF),C':'                                                       
         BE    GRQD082                                                          
         B     GRQD084                                                          
GRQD082  EQU   *                                                                
         MVI   0(RF),C' '                                                       
GRQD084  EQU   *                                                                
         LA    RF,1(RF)                                                         
         LA    R4,1(R4)                                                         
         BCT   R5,GRQD080                                                       
         B     GRQDOK                                                           
*                                                                               
GRQDE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(410)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(420)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDE030 EQU   *                                                                
         MVC   REFSCODE,=AL3(430)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDE040 EQU   *                                                                
         MVC   REFSCODE,=AL3(440)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDE050 EQU   *                                                                
         MVC   REFSCODE,=AL3(450)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDE060 EQU   *                                                                
         MVC   REFSCODE,=AL3(460)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDE070 EQU   *                                                                
         MVC   REFSCODE,=AL3(470)                                               
         B     GRQDNO                                                           
*                                                                               
GRQDNO   B     NO                                                               
GRQDOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* LOAD SQL STATEMENTS INTO REFORM BUFFERS FROM BOOK RECORDS          *          
**********************************************************************          
         SPACE 1                                                                
LOADSQL  NTR1  *                                                                
         LM    R3,R4,0(R1)                                                      
         LR    R6,R4                                                            
         ICM   RF,15,=AL4(L'REFSQBUF)                                           
         AR    R6,RF                                                            
         LA    R5,IOAREA                                                        
         USING CTLREC,R5           R5=A(BOOK RECORD)                            
         XC    CTLKEY,CTLKEY                                                    
         MVI   CTLKTYP,CTLKTYPQ                                                 
         MVI   CTLKSCR,CTLKXTRQ                                                 
         MVC   CTLKNAME,0(R3)                                                   
*                                  GET BOOK RECORD LINES                        
LSQL010  GOTO1 =V(GETBOOK),DMCB,(R5),(R4),VDATAMGR,RR=RELO                      
         LA    R1,DMCB                                                          
         TM    8(R1),X'80'         END OF BOOK                                  
         BO    LSQL100                                                          
         CLI   8(R1),0             OK                                           
         BE    LSQL020                                                          
         TM    8(R1),X'02'         DELETED - CAN IGNORE IT                      
         BO    LSQL010                                                          
*                                                                               
LSQL020  CLI   0(R4),C'*'          COMMENT LINE - IGNORE IT                     
         BE    LSQL010                                                          
         LA    RE,67(R4)                                                        
         CLI   0(RE),C' '                                                       
         BE    LSQL030                                                          
         CLI   0(RE),C'*'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         B     LSQL042                                                          
LSQL030  BCTR  RE,0                                                             
         CR    RE,R4                                                            
         BNH   LSQL050                                                          
         CLI   0(RE),C' '                                                       
         BE    LSQL030                                                          
LSQL040  LA    RE,1(RE)                                                         
         MVI   0(RE),X'00'                                                      
LSQL042  LA    R4,1(RE)                                                         
LSQL050  CR    R4,R6                                                            
         BNL   LSQLE010                                                         
         B     LSQL010                                                          
*                                                                               
LSQL100  EQU   *                                                                
         MVI   0(R4),X'00'                                                      
         B     LSQLOK                                                           
*                                                                               
LSQLE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(510)                                               
         B     LSQLNO                                                           
*                                                                               
LSQLNO   B     NO                                                               
LSQLOK   B     YES                                                              
         DROP  R5                                                               
         EJECT                                                                  
**********************************************************************          
* GET NEXT ROW BUMP ROW COUNT                                        *          
**********************************************************************          
         SPACE 1                                                                
NEXTROW  EQU   *                                                                
         CLI   REFVER,1                                                         
         BL    NROW010                                                          
         ICM   RF,15,REFDLEN                                                    
         BZ    GETNEXT                                                          
         BCTR  RF,0                                                             
         LA    R1,REFDATA                                                       
         AR    R1,RF                                                            
         CLI   0(R1),C';'                                                       
         BNE   GETNEXT                                                          
*                                                                               
NROW010  EQU   *                                                                
         ICM   RF,15,REFROW                                                     
         LA    RF,1(RF)                                                         
         STCM  RF,15,REFROW                                                     
         B     GETNEXT                                                          
         SPACE 1                                                                
**********************************************************************          
* PROCESS REPORT LINE                                                *          
**********************************************************************          
         SPACE 1                                                                
PROCLINE EQU   *                                                                
         MVI   REFSFLG1,0                                                       
         MVI   NULLFLAG,C'N'                                                    
         TM    REFSQFLG,REFSFBEQ                                                
         BZ    PLIN010                                                          
         ICM   RE,15,REFSQPTR                                                   
         LH    R6,=Y(REFSQBUF-REFORMD)                                          
         LA    R6,REFORMD(R6)                                                   
         AR    RE,R6                                                            
         CLI   0(RE),X'00'                                                      
         BNE   PROCSQL                                                          
*                                                                               
PLIN010  OC    REFHSR,REFHSR                                                    
         BZ    PROCDATA                                                         
         CLC   REFROW,REFHSR                                                    
         BL    NEXTROW                                                          
         CLC   REFROW,REFHER                                                    
         BH    PROCDATA                                                         
         B     PROCHDR                                                          
         SPACE 1                                                                
**********************************************************************          
* PROCESS END OF REPORT                                              *          
**********************************************************************          
         SPACE 1                                                                
PROCEND  EQU   *                                                                
         NI    REFSFLG1,REFSENDQ                                                
         TM    REFSQFLG,REFSFAFQ                                                
         BZ    EXIT                                                             
         ICM   RE,15,REFSQPTR                                                   
         LH    R6,=Y(REFSQAFB-REFORMD)                                          
         LA    R6,REFORMD(R6)                                                   
         AR    RE,R6                                                            
         CLI   0(RE),X'00'                                                      
         BNE   PROCSQL                                                          
         B     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* PROCESS SQL BEFORE STATEMENTS                                      *          
**********************************************************************          
         SPACE 1                                                                
PROCSQL  EQU   *                                                                
*                                                                               
PSQL010  ICM   RF,15,AREFAREA                                                   
         BZ    PSQLE020                                                         
         LA    RE,4                                                             
         SLL   RE,16                                                            
         STCM  RE,15,0(RF)                                                      
         LA    RF,4(RF)                                                         
         STCM  RF,15,OUTPOSN                                                    
         CLI   REFSQLI,C'N'                                                     
         BNE   PSQL100                                                          
         OC    REFTAB,REFTAB                                                    
         BZ    PSQL020                                                          
         MVC   FIELD,SPACES                                                     
         MVC   FIELD(5),=CL5'00001'                                             
         LA    RF,5                                                             
         STCM  RF,15,FLDLEN                                                     
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
*                                                                               
PSQL020  OC    REFACT,REFACT                                                    
         BZ    PSQL030                                                          
         MVC   FIELD,SPACES                                                     
         MVI   FIELD,C'S'                                                       
         LA    RF,1                                                             
         STCM  RF,15,FLDLEN                                                     
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
*                                                                               
PSQL030  EQU   *                                                                
*                                                                               
PSQL100  EQU   *                                                                
         ICM   R4,15,REFSQPTR                                                   
         LR    RF,R6                                                            
         AR    R4,RF                                                            
         MVC   FIELD,SPACES                                                     
         LA    R1,FIELD                                                         
         SR    RF,RF                                                            
         LA    R0,L'FIELD                                                       
PSQL110  CLI   0(R4),X'00'                                                      
         BE    PSQL120                                                          
         MVC   0(1,R1),0(R4)                                                    
         LA    R4,1(R4)                                                         
         LA    R1,1(R1)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,PSQL110                                                       
         B     PSQLE010                                                         
PSQL120  LTR   RF,RF                                                            
         BZ    PSQL200                                                          
         STCM  RF,15,FLDLEN                                                     
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
         CLI   REFSQLI,C'N'                                                     
         BE    PSQL122                                                          
         ICM   RF,15,OUTPOSN                                                    
         BCTR  RF,0                                                             
         MVI   0(RF),C' '                                                       
PSQL122  OI    REFSFLG1,REFSOUTQ                                                
         LA    R4,1(R4)                                                         
         CLI   0(R4),X'00'                                                      
         BE    PSQL200                                                          
         LR    RF,R6                                                            
         SR    R4,RF                                                            
         STCM  R4,15,REFSQPTR                                                   
         B     CALLBACK                                                         
*                                                                               
PSQL200  EQU   *                                                                
         NI    REFSQFLG,X'FF'-REFSFBEQ                                          
         XC    REFSQPTR,REFSQPTR                                                
         LR    RE,R6                                                            
         ICM   RF,15,=AL4(L'REFSQBUF)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         OI    REFSFLG1,REFSOUTQ                                                
         B     CALLBACK                                                         
*                                                                               
PSQLE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(910)                                               
         B     ERREXIT                                                          
*                                                                               
PSQLE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(920)                                               
         B     ERREXIT                                                          
         SPACE 1                                                                
**********************************************************************          
* PROCESS REPORT HEADER LINE                                         *          
**********************************************************************          
         SPACE 1                                                                
PROCHDR  EQU   *                                                                
         CLI   DATAFLAG,C'N'                                                    
         BE    PROCDATA                                                         
         ICM   RE,15,REFHDRP                                                    
         LA    RF,REFHDR1                                                       
         AR    RE,RF                                                            
         LA    RF,REFHDR4                                                       
         CR    RE,RF                                                            
         BH    PROCDATA                                                         
         BAS   RE,LOADBUFF                                                      
         BNE   PHDRE010                                                         
         CLI   DATAFLAG,C'E'                                                    
         BNE   GETNEXT                                                          
         LA    R0,REFDBUFF                                                      
         ICM   RE,15,REFHDRP                                                    
         LA    RF,REFHDR1                                                       
         AR    RE,RF                                                            
         LA    R1,L'REFDBUFF                                                    
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         ICM   RE,15,REFHDRP                                                    
         LA    RE,L'REFHDR1(RE)                                                 
         STCM  RE,15,REFHDRP                                                    
         XC    REFDBPTR,REFDBPTR                                                
         LA    RE,REFDBUFF                                                      
         ICM   RF,15,=AL4(L'REFDBUFF)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         B     NEXTROW                                                          
*                                                                               
PHDRE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(810)                                               
         B     ERREXIT                                                          
         SPACE 1                                                                
**********************************************************************          
* PROCESS REPORT DATA LINE                                           *          
**********************************************************************          
         SPACE 1                                                                
PROCDATA EQU   *                                                                
         OC    REFDSR,REFDSR                                                    
         BZ    PDATE010                                                         
         CLC   REFROW,REFDSR                                                    
         BL    NEXTROW                                                          
         OC    REFDER,REFDER                                                    
         BZ    *+14                                                             
         CLC   REFROW,REFDER                                                    
         BH    PDATEND                                                          
         CLI   DATAFLAG,C'N'                                                    
         BE    PDAT010                                                          
         BAS   RE,LOADBUFF                                                      
         BNE   PDATE011                                                         
         CLI   DATAFLAG,C'E'                                                    
         BNE   GETNEXT                                                          
         XC    REFDBPTR,REFDBPTR                                                
*                                                                               
PDAT010  EQU   *                                                                
*                                  INITIALISE DEBUG BUFFER                      
         LH    RE,=Y(REFDEBUG-REFORMD)                                          
         LA    RE,REFORMD(RE)                                                   
         ICM   RF,15,=AL4(L'REFDEBUG)                                           
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         LH    RE,=Y(REFDEBUG-REFORMD)                                          
         LA    RE,REFORMD(RE)                                                   
         STCM  RE,15,REFDEPTR                                                   
*                                                                               
         ICM   RF,15,AREFAREA                                                   
         BZ    PDATE078                                                         
         LA    RE,4                                                             
         SLL   RE,16                                                            
         STCM  RE,15,0(RF)                                                      
         LA    RF,4(RF)                                                         
         STCM  RF,15,OUTPOSN                                                    
         CLI   REFSQLI,C'N'                                                     
         BE    PDAT020                                                          
         MVC   FIELD,SPACES                                                     
         MVC   FIELD(L'INSERTQ),INSERTQ                                         
         MVC   FIELD+12(L'REFTABN),REFTABN                                      
         LA    RF,L'INSERTQ                                                     
         STCM  RF,15,FLDLEN                                                     
         MVI   DATATYPE,X'00'                                                   
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
         ICM   RF,15,OUTPOSN                                                    
         BCTR  RF,0                                                             
         STCM  RF,15,OUTPOSN                                                    
         MVI   0(RF),C')'                                                       
         ICM   R1,15,AREFAREA                                                   
         BZ    PDATE079                                                         
         ICM   RE,15,0(R1)                                                      
         SRL   RE,16                                                            
         BCTR  RE,0                                                             
         SLL   RE,16                                                            
         STCM  RE,15,0(R1)                                                      
*                                                                               
PDAT020  EQU   *                                                                
         OC    REFTAB,REFTAB                                                    
         BZ    PDAT030                                                          
         MVC   FIELD,SPACES                                                     
         MVC   FIELD(L'REFTAB),REFTAB                                           
         LA    RF,L'REFTAB                                                      
         STCM  RF,15,FLDLEN                                                     
         MVI   DATATYPE,DATATXTQ                                                
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
*                                                                               
PDAT030  OC    REFACT,REFACT                                                    
         BZ    PDAT040                                                          
         MVC   FIELD,SPACES                                                     
         CLI   REFACT,C'U'                                                      
         BNE   PDAT032                                                          
         CLI   REFKDFLG,0                                                       
         BE    *+12                                                             
         MVI   FIELD,C'A'                                                       
         B     PDAT034                                                          
         MVI   FIELD,C'K'                                                       
         B     PDAT034                                                          
PDAT032  MVC   FIELD(L'REFACT),REFACT                                           
PDAT034  LA    RF,L'REFACT                                                      
         STCM  RF,15,FLDLEN                                                     
         MVI   DATATYPE,DATATXTQ                                                
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
*                                                                               
PDAT040  CLI   REFDTM,C'N'                                                      
         BE    PDAT100                                                          
         MVC   FIELD,SPACES                                                     
         MVC   FIELD(L'REFDATIM),REFDATIM                                       
         LA    RF,L'REFDATIM                                                    
         STCM  RF,15,FLDLEN                                                     
         MVI   DATATYPE,DATATXTQ                                                
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
         B     PDAT100                                                          
*                                                                               
PDAT100  EQU   *                                                                
         B     FORMULA                                                          
*                                                                               
PDATE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(10)                                                
         B     ERREXIT                                                          
PDATE011 EQU   *                                                                
         MVC   REFSCODE,=AL3(11)                                                
         B     ERREXIT                                                          
PDATE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(20)                                                
         B     ERREXIT                                                          
PDATE021 EQU   *                                                                
         MVC   REFSCODE,=AL3(21)                                                
         B     ERREXIT                                                          
PDATE030 EQU   *                                                                
         MVC   REFSCODE,=AL3(30)                                                
         B     ERREXIT                                                          
PDATE031 EQU   *                                                                
         MVC   REFSCODE,=AL3(31)                                                
         B     ERREXIT                                                          
PDATE032 EQU   *                                                                
         MVC   REFSCODE,=AL3(32)                                                
         B     ERREXIT                                                          
PDATE033 EQU   *                                                                
         MVC   REFSCODE,=AL3(33)                                                
         B     ERREXIT                                                          
PDATE034 EQU   *                                                                
         MVC   REFSCODE,=AL3(34)                                                
         B     ERREXIT                                                          
PDATE035 EQU   *                                                                
         MVC   REFSCODE,=AL3(35)                                                
         B     ERREXIT                                                          
PDATE050 EQU   *                                                                
         MVC   REFSCODE,=AL3(50)                                                
         B     ERREXIT                                                          
PDATE051 EQU   *                                                                
         MVC   REFSCODE,=AL3(51)                                                
         B     ERREXIT                                                          
PDATE052 EQU   *                                                                
         MVC   REFSCODE,=AL3(52)                                                
         B     ERREXIT                                                          
PDATE053 EQU   *                                                                
         MVC   REFSCODE,=AL3(53)                                                
         B     ERREXIT                                                          
PDATE054 EQU   *                                                                
         MVC   REFSCODE,=AL3(54)                                                
         B     ERREXIT                                                          
PDATE056 EQU   *                                                                
         MVC   REFSCODE,=AL3(56)                                                
         B     ERREXIT                                                          
PDATE057 EQU   *                                                                
         MVC   REFSCODE,=AL3(59)                                                
         B     ERREXIT                                                          
PDATE058 EQU   *                                                                
         MVC   REFSCODE,=AL3(59)                                                
         B     ERREXIT                                                          
PDATE070 EQU   *                                                                
         MVC   REFSCODE,=AL3(70)                                                
         B     ERREXIT                                                          
PDATE072 EQU   *                                                                
         MVC   REFSCODE,=AL3(72)                                                
         B     ERREXIT                                                          
PDATE073 EQU   *                                                                
         MVC   REFSCODE,=AL3(73)                                                
         B     ERREXIT                                                          
PDATE074 EQU   *                                                                
         MVC   REFSCODE,=AL3(74)                                                
         B     ERREXIT                                                          
PDATE075 EQU   *                                                                
         MVC   REFSCODE,=AL3(75)                                                
         B     ERREXIT                                                          
PDATE076 EQU   *                                                                
         MVC   REFSCODE,=AL3(76)                                                
         B     ERREXIT                                                          
PDATE077 EQU   *                                                                
         MVC   REFSCODE,=AL3(77)                                                
         B     ERREXIT                                                          
PDATE078 EQU   *                                                                
         MVC   REFSCODE,=AL3(78)                                                
         B     ERREXIT                                                          
PDATE079 EQU   *                                                                
         MVC   REFSCODE,=AL3(79)                                                
         B     ERREXIT                                                          
         SPACE 1                                                                
**********************************************************************          
* PROCESS END OF DATA LINES IF REACHED SET MAXIMUM ROW VALUE         *          
**********************************************************************          
         SPACE 1                                                                
PDATEND  EQU   *                                                                
         OI    REFSFLG1,REFSENDQ                                                
         B     PROCLINE                                                         
         EJECT                                                                  
**********************************************************************          
* PROCESS REPORT DATA LINE WITH NORMALISING FORMULA                  *          
**********************************************************************          
         SPACE 1                                                                
FORMULA  EQU   *                                                                
         LA    R3,REFFORM                                                       
         LA    R5,L'REFFORM                                                     
         ICM   RF,15,REFDROW                                                    
         LA    RF,1(RF)                                                         
         STCM  RF,15,REFDROW                                                    
*                                                                               
FORMNEXT CLI   0(R3),C';'                                                       
         BE    FORM020                                                          
         CLI   0(R3),C' '                                                       
         BE    FORM030                                                          
*                                  SAVE OFFSET INTO FORMULA FOR DEBUG           
         ICM   RE,15,REFDEPTR                                                   
         LR    RF,R3                                                            
         LA    R1,REFFORM                                                       
         SR    RF,R1                                                            
         STCM  RF,3,6(RE)                                                       
*                                                                               
         CLI   0(R3),C'D'                                                       
         BE    DATAFORM                                                         
         CLI   0(R3),C'H'                                                       
         BE    HDRFORM                                                          
         CLI   0(R3),C'"'                                                       
         BE    LITFORM                                                          
         B     PDATE020                                                         
*                                                                               
FORM020  CLI   1(R3),C';'                                                       
         BE    FORMEND                                                          
*                                                                               
FORM030  LA    R3,1(R3)                                                         
         BCT   R5,FORMNEXT                                                      
         B     PDATE021                                                         
*                                                                               
FORMEND  EQU   *                                                                
         OC    REFNULL,REFNULL                                                  
         BZ    FEND010                                                          
         CLC   REFNULL(4),=CL4'DROP'                                            
         BNE   FEND010                                                          
         CLI   NULLFLAG,C'Y'                                                    
         BNE   FEND010                                                          
         B     FEND012                                                          
FEND010  OI    REFSFLG1,REFSOUTQ                                                
FEND012  CLI   REFSQLI,C'N'                                                     
         BE    FEND020                                                          
         ICM   RF,15,OUTPOSN                                                    
         BCTR  RF,0                                                             
         MVI   0(RF),C')'                                                       
*                                                                               
FEND020  OC    REFDEC,REFDEC                                                    
         BZ    FEND030                                                          
         ICM   RF,15,REFCOL                                                     
         CLM   RF,15,REFDEC                                                     
         BNH   CALLBACK                                                         
         LA    RF,1                                                             
         OC    REFDSC,REFDSC                                                    
         BZ    *+10                                                             
         ICM   RF,15,REFDSC                                                     
         STCM  RF,15,REFCOL                                                     
FEND030  CLI   REFACT,C'U'                                                      
         BNE   NEXTROW                                                          
         CLI   REFKDFLG,0                                                       
         BNE   *+12                                                             
         MVI   REFKDFLG,X'FF'                                                   
         B     CALLBACK                                                         
         MVI   REFKDFLG,0                                                       
         B     NEXTROW                                                          
         SPACE 1                                                                
**********************************************************************          
* PROCESS REPORT TRANSFORM FORMULA DATA FIELD COMMAND                *          
**********************************************************************          
         SPACE 1                                                                
DATAFORM EQU   *                                                                
         XC    COLUMN,COLUMN                                                    
         CLI   1(R3),C'('                                                       
         BNE   PDATE030                                                         
         MVI   NORMFLAG,C'N'                                                    
         CLI   2(R3),C'C'                                                       
         BNE   *+12                                                             
         MVI   NORMFLAG,C'Y'                                                    
         B     DATF100                                                          
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         LA    R4,2(R3)                                                         
         SR    R6,R6                                                            
*                                                                               
DATF010  CLI   0(R4),C'0'                                                       
         BL    DATF020                                                          
         CLI   0(R4),C'9'                                                       
         BH    DATF020                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     DATF010                                                          
*                                                                               
DATF020  CLI   0(R4),C')'                                                       
         BNE   PDATE031                                                         
         GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   PDATE032                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,COLUMN                                                     
         B     DATF120                                                          
*                                                                               
DATF100  CLI   3(R3),C')'                                                       
         BNE   PDATE033                                                         
         LA    R6,1                                                             
         SR    R4,R4                                                            
         ICM   R4,1,REFDCN                                                      
         BNZ   *+8                                                              
         LA    R4,1                                                             
         MVC   REFPCOL,REFCOL                                                   
*                                                                               
DATF110  EQU   *                                                                
         MVC   COLUMN,REFCOL                                                    
         ICM   RF,15,REFCOL                                                     
         LA    RF,1(RF)                                                         
         STCM  RF,15,REFCOL                                                     
*                                                                               
DATF120  LA    RF,REFDBUFF                                                      
         STCM  RF,15,AREPLINE                                                   
         LA    R6,3(R6)                                                         
         LA    R3,0(R6,R3)                                                      
         SR    R5,R6                                                            
         BZ    PDATE034                                                         
         BAS   RE,GETFIELD                                                      
         BE    DATF121                                                          
         CLI   NORMFLAG,C'N'                                                    
         BE    ERREXIT                                                          
         XC    REFSCODE,REFSCODE                                                
         LA    RF,1                                                             
         OC    REFDSC,REFDSC                                                    
         BZ    *+10                                                             
         ICM   RF,15,REFDSC                                                     
         STCM  RF,15,REFCOL                                                     
         B     NEXTROW                                                          
*                                                                               
DATF121  EQU   *                                                                
         CLI   0(R3),C' '                                                       
         BE    DATF130                                                          
         CLI   0(R3),C';'                                                       
         BE    DATF130                                                          
         CLI   0(R3),C'N'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATANUMQ                                                
         B     DATF128                                                          
         CLI   0(R3),C'T'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATATXTQ                                                
         B     DATF128                                                          
         CLI   0(R3),C'D'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATADATQ                                                
         B     DATF128                                                          
         B     PDATE073                                                         
*                                                                               
DATF128  LA    R3,1(R3)                                                         
         LA    R6,1(R6)                                                         
         BCTR  R5,0                                                             
         LTR   R5,R5                                                            
         BZ    PDATE035                                                         
*                                                                               
DATF130  EQU   *                                                                
*                                  SAVE OFFSET INTO OUTPUT FOR DEBUG            
         ICM   RE,15,REFDEPTR                                                   
         ICM   RF,15,OUTPOSN                                                    
         ICM   R1,15,AREFAREA                                                   
         LA    R1,4(R1)                                                         
         SR    RF,R1                                                            
         STCM  RF,3,4(RE)                                                       
*                                  BUMP DEBUG BUFFER POINTER                    
         LA    RE,8(RE)                                                         
         STCM  RE,15,REFDEPTR                                                   
*                                                                               
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
         CLI   NORMFLAG,C'N'                                                    
         BE    FORMNEXT                                                         
         BCT   R4,*+8                                                           
         B     FORMNEXT                                                         
         AR    R5,R6                                                            
         SR    R3,R6                                                            
         LA    R6,1                                                             
         B     DATF110                                                          
*                                                                               
         EJECT                                                                  
**********************************************************************          
* PROCESS REPORT TRANSFORM FORMULA HEADER FIELD COMMAND              *          
**********************************************************************          
         SPACE 1                                                                
HDRFORM  EQU   *                                                                
         XC    ROW,ROW                                                          
         XC    COLUMN,COLUMN                                                    
         XC    OFFSET,OFFSET                                                    
         CLI   1(R3),C'('                                                       
         BNE   PDATE050                                                         
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         LA    R4,2(R3)                                                         
         SR    R6,R6                                                            
*                                                                               
HDRF010  CLI   0(R4),C'0'                                                       
         BL    HDRF020                                                          
         CLI   0(R4),C'9'                                                       
         BH    HDRF020                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     HDRF010                                                          
*                                                                               
HDRF020  CLI   0(R4),C','                                                       
         BNE   PDATE051                                                         
         GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   PDATE052                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,ROW                                                        
         LR    R7,R6                                                            
*                                                                               
         LA    R4,1(R4)                                                         
         LA    R7,1(R7)                                                         
         CLI   0(R4),C'C'                                                       
         BE    HDRF130                                                          
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         SR    R6,R6                                                            
*                                                                               
HDRF110  CLI   0(R4),C'0'                                                       
         BL    HDRF120                                                          
         CLI   0(R4),C'9'                                                       
         BH    HDRF120                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     HDRF110                                                          
*                                                                               
HDRF120  GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   PDATE054                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,COLUMN                                                     
         B     HDRF200                                                          
*                                                                               
HDRF130  LA    R6,1                                                             
         MVC   COLUMN,REFCOL                                                    
         LA    R4,1(R4)                                                         
*                                                                               
HDRF200  CLI   0(R4),C')'                                                       
         BE    HDRF400                                                          
         AR    R7,R6                                                            
         CLI   0(R4),C','                                                       
         BNE   PDATE076                                                         
         LA    R7,1(R7)                                                         
         LA    R4,1(R4)                                                         
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         SR    R6,R6                                                            
*                                                                               
HDRF210  CLI   0(R4),C'0'                                                       
         BL    HDRF220                                                          
         CLI   0(R4),C'9'                                                       
         BH    HDRF220                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     HDRF210                                                          
*                                                                               
HDRF220  CLI   0(R4),C')'                                                       
         BNE   PDATE053                                                         
         GOTO1 CONVNUM,DMCB,WORK,(R6)                                           
         CLI   0(R1),0                                                          
         BNE   PDATE075                                                         
         L     R1,4(R1)                                                         
         STCM  R1,15,OFFSET                                                     
         B     HDRF400                                                          
         EJECT                                                                  
HDRF400  LA    RF,REFHDR1                                                       
         LA    RE,REFHDR4                                                       
         ICM   R1,15,ROW                                                        
*                                                                               
HDRF410  BCT   R1,*+8                                                           
         B     HDRF420                                                          
         LA    RF,L'REFHDR1(RF)                                                 
         CR    RF,RE                                                            
         BNH   HDRF410                                                          
         B     PDATE056                                                         
*                                                                               
HDRF420  STCM  RF,15,AREPLINE                                                   
         LA    R6,3(R7,R6)                                                      
         LA    R3,0(R6,R3)                                                      
         SR    R5,R6                                                            
         BZ    PDATE057                                                         
         BAS   RE,GETFIELD                                                      
         BNE   ERREXIT                                                          
*                                                                               
         CLI   0(R3),C' '                                                       
         BE    HDRF440                                                          
         CLI   0(R3),C';'                                                       
         BE    HDRF440                                                          
         CLI   0(R3),C'N'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATANUMQ                                                
         B     HDRF430                                                          
         CLI   0(R3),C'T'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATATXTQ                                                
         B     HDRF430                                                          
         CLI   0(R3),C'D'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATADATQ                                                
         B     HDRF430                                                          
         B     PDATE074                                                         
*                                                                               
HDRF430  LA    R3,1(R3)                                                         
         BCTR  R5,0                                                             
         LTR   R5,R5                                                            
         BZ    PDATE058                                                         
*                                                                               
HDRF440  EQU   *                                                                
*                                  SAVE OFFSET INTO OUTPUT FOR DEBUG            
         ICM   RE,15,REFDEPTR                                                   
         ICM   RF,15,OUTPOSN                                                    
         ICM   R1,15,AREFAREA                                                   
         LA    R1,4(R1)                                                         
         SR    RF,R1                                                            
         STCM  RF,3,4(RE)                                                       
*                                  BUMP DEBUG BUFFER POINTER                    
         LA    RE,8(RE)                                                         
         STCM  RE,15,REFDEPTR                                                   
*                                                                               
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
         B     FORMNEXT                                                         
         SPACE 1                                                                
**********************************************************************          
* PROCESS REPORT TRANSFORM FORMULA LITERAL FIELD                     *          
**********************************************************************          
         SPACE 1                                                                
LITFORM  EQU   *                                                                
         XC    FIELD,FIELD                                                      
         LA    RE,FIELD                                                         
         LA    R4,1(R3)                                                         
         SR    R6,R6                                                            
*                                                                               
LITF010  CLI   0(R4),C'"'                                                       
         BE    LITF020                                                          
         MVC   0(1,RE),0(R4)                                                    
         LA    RE,1(RE)                                                         
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
         B     LITF010                                                          
*                                                                               
LITF020  STCM  R6,15,FLDLEN                                                     
         LTR   R6,R6                                                            
         BZ    PDATE070                                                         
*                                  SAVE A(INPUT FIELD) FOR DEBUG                
         ICM   RE,15,REFDEPTR                                                   
         STCM  R3,15,0(RE)                                                      
*                                                                               
         CLI   1(R4),C' '                                                       
         BE    LITF040                                                          
         CLI   1(R4),C';'                                                       
         BE    LITF040                                                          
         CLI   1(R4),C'N'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATANUMQ                                                
         B     LITF030                                                          
         CLI   1(R4),C'T'                                                       
         BNE   *+12                                                             
         MVI   DATATYPE,DATATXTQ                                                
         B     LITF030                                                          
         CLI   1(R4),C'F'                                                       
         BE    LITF100                                                          
         B     PDATE077                                                         
*                                                                               
LITF030  LA    R6,1(R6)                                                         
*                                                                               
LITF040  EQU   *                                                                
*                                  SAVE OFFSET INTO OUTPUT FOR DEBUG            
         ICM   RE,15,REFDEPTR                                                   
         ICM   RF,15,OUTPOSN                                                    
         ICM   R1,15,AREFAREA                                                   
         LA    R1,4(R1)                                                         
         SR    RF,R1                                                            
         STCM  RF,3,4(RE)                                                       
*                                  BUMP DEBUG BUFFER POINTER                    
         LA    RE,8(RE)                                                         
         STCM  RE,15,REFDEPTR                                                   
*                                                                               
         BAS   RE,PUTFIELD                                                      
         BNE   ERREXIT                                                          
         LA    R6,2(R6)                                                         
         LA    R3,0(R6,R3)                                                      
         SR    R5,R6                                                            
         BM    PDATE072                                                         
         B     FORMNEXT                                                         
*                                  HERE IF LITERAL FILTER                       
LITF100  LA    R6,1(R6)                                                         
*                                                                               
LITF110  EQU   *                                                                
*                                  SAVE OFFSET INTO OUTPUT FOR DEBUG            
         ICM   RE,15,REFDEPTR                                                   
         ICM   RF,15,OUTPOSN                                                    
         ICM   R1,15,AREFAREA                                                   
         LA    R1,4(R1)                                                         
         SR    RF,R1                                                            
         STCM  RF,3,4(RE)                                                       
*                                  BUMP DEBUG BUFFER POINTER                    
         LA    RE,8(RE)                                                         
         STCM  RE,15,REFDEPTR                                                   
*                                                                               
         MVC   FILTFLD,FIELD                                                    
         MVC   FILTLEN,FLDLEN                                                   
         LA    RF,1                                                             
         STCM  RF,15,COLUMN                                                     
         LA    RF,REFDBUFF                                                      
         STCM  RF,15,AREPLINE                                                   
         BAS   RE,GETFIELD                                                      
         BNE   NEXTROW                                                          
         CLC   FILTLEN,FLDLEN                                                   
         BNE   NEXTROW                                                          
         ICM   RF,15,FILTLEN                                                    
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   FILTFLD(0),FIELD                                                 
         BNE   NEXTROW                                                          
         LA    R6,2(R6)                                                         
         LA    R3,0(R6,R3)                                                      
         SR    R5,R6                                                            
         BM    PDATE072                                                         
         B     FORMNEXT                                                         
         EJECT                                                                  
**********************************************************************          
* GET FIELD FROM REPORT LINE                                         *          
* ON ENTRY:                                                          *          
* AREPLINE=A(REPORT LINE)                                            *          
* COLUMN IS COLUMN NUMBER OF FIELD                                   *          
* ON RETURN:                                                         *          
* FIELD - FIELD TEXT VALUE                                           *          
* FLDLEN - LENGTH OF FIELD TEXT                                      *          
**********************************************************************          
         SPACE 1                                                                
GETFIELD NTR1                                                                   
         ICM   R3,15,AREPLINE                                                   
         BZ    GFLDE080                                                         
         MVI   DINKFLAG,C'N'                                                    
         MVI   DATATYPE,DATANUMQ                                                
         LA    R4,1                                                             
         LA    R5,L'REFDBUFF                                                    
         OC    COLUMN,COLUMN                                                    
         BZ    GFLDE090                                                         
*                                                                               
GFLD010  EQU   *                                                                
         CLI   REFVER,1                                                         
         BL    GFLD012                                                          
         CLI   0(R3),0                                                          
         BE    GFLDE070                                                         
         CLI   0(R3),C';'                                                       
         BE    GFLDE070                                                         
         CLI   0(R3),C':'                                                       
         BE    GFLDE070                                                         
GFLD012  CLI   0(R3),C' '                                                       
         BNE   GFLD020                                                          
         LA    R3,1(R3)                                                         
         BCT   R5,GFLD010                                                       
         B     GFLDE010                                                         
GFLD020  CLM   R4,15,COLUMN                                                     
         BNL   GFLD100                                                          
         LA    R4,1(R4)                                                         
*                                                                               
GFLD030  CLI   DINKFLAG,C'Y'                                                    
         BE    GFLD032                                                          
         CLI   0(R3),C'"'                                                       
         BNE   GFLD034                                                          
         MVI   DINKFLAG,C'Y'                                                    
         B     GFLD036                                                          
GFLD032  CLI   0(R3),C'"'                                                       
         BNE   GFLD036                                                          
         MVI   DINKFLAG,C'N'                                                    
GFLD034  CLI   0(R3),C' '                                                       
         BE    GFLD040                                                          
GFLD036  LA    R3,1(R3)                                                         
         BCT   R5,GFLD030                                                       
         B     GFLDE020                                                         
GFLD040  LA    R3,1(R3)                                                         
         BCT   R5,GFLD010                                                       
         B     GFLDE030                                                         
*                                                                               
GFLD100  LA    R6,FIELD                                                         
         MVC   FIELD,SPACES                                                     
         ICM   R7,15,OFFSET                                                     
         LA    R4,0                                                             
*                                  SAVE A(INPUT FIELD) FOR DEBUG                
         ICM   RE,15,REFDEPTR                                                   
         STCM  R3,15,0(RE)                                                      
*                                                                               
         CLI   0(R3),C'"'                                                       
         BNE   GFLD120                                                          
         MVI   DATATYPE,DATATXTQ                                                
         LA    R3,1(R3)                                                         
         BCT   R5,GFLD110                                                       
         B     GFLDE040                                                         
*                                                                               
GFLD110  EQU   *                                                                
         CLI   0(R3),C'"'                                                       
         BE    GFLD200                                                          
         LTR   R7,R7                                                            
         BZ    GFLD113                                                          
         BCTR  R7,0                                                             
         B     GFLD114                                                          
GFLD113  MVC   0(1,R6),0(R3)                                                    
         CLI   REFVER,1                                                         
         BL    GFLD113B                                                         
         CLI   0(R6),0                                                          
         BE    GFLD113A                                                         
         CLI   0(R6),C';'                                                       
         BE    GFLD113A                                                         
         CLI   0(R6),C':'                                                       
         BE    GFLD113A                                                         
         B     GFLD113B                                                         
GFLD113A EQU   *                                                                
         MVI   0(R6),C' '                                                       
GFLD113B EQU   *                                                                
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
GFLD114  LA    R3,1(R3)                                                         
         BCT   R5,GFLD110                                                       
         B     GFLDE050                                                         
*                                                                               
GFLD120  EQU   *                                                                
         CLI   REFVER,1                                                         
         BL    GFLD122                                                          
         CLI   0(R3),0                                                          
         BE    GFLDE070                                                         
         CLI   0(R3),C':'                                                       
         BE    GFLDE070                                                         
*                                                                               
GFLD122  CLI   0(R3),C' '                                                       
         BE    GFLD200                                                          
         CLI   0(R3),C';'                                                       
         BE    GFLD200                                                          
         LTR   R7,R7                                                            
         BZ    GFLD123                                                          
         BCTR  R7,0                                                             
         B     GFLD124                                                          
GFLD123  MVC   0(1,R6),0(R3)                                                    
         LA    R4,1(R4)                                                         
         LA    R6,1(R6)                                                         
GFLD124  LA    R3,1(R3)                                                         
         BCT   R5,GFLD120                                                       
         B     GFLDE060                                                         
*                                                                               
GFLD200  STCM  R4,15,FLDLEN                                                     
         B     GFLDOK                                                           
*                                                                               
GFLDE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(1010)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(1020)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE030 EQU   *                                                                
         MVC   REFSCODE,=AL3(1030)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE040 EQU   *                                                                
         MVC   REFSCODE,=AL3(1040)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE050 EQU   *                                                                
         MVC   REFSCODE,=AL3(1050)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE060 EQU   *                                                                
         MVC   REFSCODE,=AL3(1060)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE070 EQU   *                                                                
         MVC   REFSCODE,=AL3(1070)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE080 EQU   *                                                                
         MVC   REFSCODE,=AL3(1080)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDE090 EQU   *                                                                
         MVC   REFSCODE,=AL3(1090)                                              
         B     GFLDNO                                                           
*                                                                               
GFLDNO   B     NO                                                               
GFLDOK   B     YES                                                              
*                                                                               
* CHECK END OF BUFFER REACHED - ONLY FOR VERSION > 0                            
* R3 = A(CURRENT POSITION IN REPORT DATA BUFFER)                                
* RETURN CC .EQ. IF END OF BUFFER REACHED, ELSE CC .NE.                         
*                                                                               
CHKEOB   NTR1                                                                   
         CLI   REFVER,1                                                         
         BL    CEOBNO                                                           
         CLI   0(R3),0                                                          
         BE    CEOBOK                                                           
         CLI   0(R3),C';'                                                       
         BE    CEOBOK                                                           
         CLI   0(R3),C':'                                                       
         BE    CEOBOK                                                           
         B     CEOBNO                                                           
CEOBNO   B     NO                                                               
CEOBOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* PUT FIELD TO OUTPUT DATA AREA                                      *          
* ON ENTRY:                                                          *          
* FIELD - FIELD TEXT VALUE                                           *          
* FLDLEN - LENGTH OF FIELD TEXT                                      *          
* OUTPOSN=A(CURRENT POSITION IN OUTPUT DATA AREA)                    *          
* ON RETURN:                                                         *          
* OUTPOSN=A(CURRENT POSITION IN OUTPUT DATA AREA)                    *          
**********************************************************************          
         SPACE 1                                                                
PUTFIELD NTR1                                                                   
         ICM   R3,15,OUTPOSN                                                    
         ICM   R4,15,FLDLEN                                                     
         BZ    PFLD200                                                          
         TM    DATATYPE,DATANUMQ                                                
         BZ    PFLD010                                                          
         OC    REFNULL,REFNULL                                                  
         BZ    PFLD010                                                          
         LR    RE,R4                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         CLC   FIELD(0),SPACES                                                  
         BNE   PFLD130                                                          
         MVC   FIELD,SPACES                                                     
         MVC   FIELD(4),=CL4'NULL'                                              
         LA    R4,4                                                             
         STCM  R4,15,FLDLEN                                                     
         MVI   NULLFLAG,C'Y'                                                    
         B     PFLD130                                                          
*                                                                               
PFLD010  EQU   *                                                                
         CLI   REFSPC,C'N'                                                      
         BE    PFLD060                                                          
         LA    RE,FIELD                                                         
         AR    RE,R4                                                            
*                                                                               
PFLD020  BCTR  RE,0                                                             
         CLI   0(RE),C' '                                                       
         BNE   PFLD030                                                          
         BCT   R4,PFLD020                                                       
         LA    R4,1(R4)                                                         
         STCM  R4,15,FLDLEN                                                     
         B     PFLD060                                                          
*                                                                               
PFLD030  STCM  R4,15,FLDLEN                                                     
         CLI   FIELD,C' '                                                       
         BNE   PFLD060                                                          
         MVC   WORK,FIELD                                                       
         LA    RE,WORK                                                          
*                                                                               
PFLD040  CLI   0(RE),C' '                                                       
         BNE   PFLD050                                                          
         LA    RE,1(RE)                                                         
         BCT   R4,PFLD040                                                       
         B     PFLDOK                                                           
*                                                                               
PFLD050  MVC   FIELD,SPACES                                                     
         LR    RF,R4                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   FIELD(0),0(RE)                                                   
         STCM  R4,15,FLDLEN                                                     
*                                                                               
PFLD060  EQU   *                                                                
         TM    DATATYPE,DATANUMQ                                                
         BO    PFLD130                                                          
         CLI   REFSQLI,C'N'                                                     
         BE    PFLD100                                                          
         TM    DATATYPE,DATATXTQ                                                
         BZ    PFLD100                                                          
         LA    RE,FIELD                                                         
         LR    RF,R4                                                            
         LA    R1,WORK                                                          
*                                                                               
PFLD062  EQU   *                                                                
         MVC   0(1,R1),0(RE)                                                    
         CLI   0(RE),C''''                                                      
         BNE   PFLD064                                                          
         LA    R1,1(R1)                                                         
         MVI   0(R1),C''''                                                      
         LA    R4,1(R4)                                                         
PFLD064  LA    R1,1(R1)                                                         
         LA    RE,1(RE)                                                         
         BCT   RF,PFLD062                                                       
*                                                                               
PFLD066  MVC   FIELD,SPACES                                                     
         LR    RF,R4                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   FIELD(0),WORK                                                    
         STCM  R4,15,FLDLEN                                                     
*                                                                               
PFLD100  CLI   REFSQLI,C'N'                                                     
         BE    PFLD120                                                          
         TM    DATATYPE,DATATXTQ+DATADATQ                                       
         BZ    PFLD130                                                          
         MVI   0(R3),C''''                                                      
         LA    R3,1(R3)                                                         
         B     PFLD120                                                          
*                                                                               
PFLD120  TM    DATATYPE,DATADATQ                                                
         BZ    PFLD130                                                          
         MVI   BYTE,0                                                           
         OI    BYTE,PVINSGLO+PVINSGLS                                           
*                                                                               
*&&UK                                                                           
*                                  CONVERT TO UPPER CASE IN UK ONLY             
         LTR   R4,R4                                                            
         BZ    PFLD120C                                                         
         LR    RF,R4                                                            
         LA    RE,FIELD                                                         
PFLD120A CLI   0(RE),X'81'                                                      
         BL    PFLD120B                                                         
         CLI   0(RE),X'A9'                                                      
         BH    PFLD120B                                                         
         OI    0(RE),X'40'                                                      
PFLD120B LA    RE,1(RE)                                                         
         BCT   RF,PFLD120A                                                      
PFLD120C EQU   *                                                                
*&&                                                                             
         CLI   REFVER,1                                                         
         BL    PFLD121                                                          
         ICM   RF,15,FLDLEN                                                     
         BZ    PFLDE010                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   FIELD(0),SPACES                                                  
         BE    PFLDE010                                                         
*                                                                               
PFLD121  EQU   *                                                                
         GOTO1 VPERVAL,DMCB,((R4),FIELD),(BYTE,WORK)                            
         CLI   4(R1),PVRCONE                                                    
         BNE   PFLDE010                                                         
         MVC   DATEB,WORK+PVALCSTA-PERVALD                                      
*        GOTO1 VDATCON,DMCB,(2,DATEB),(10,FIELD)                                
*                                  FORCE UK DATE FORMAT ALWAYS ??               
*                                  UNLESS US PIANO REFORM ??                    
         CLI   REFSQLI,C'N'                                                     
         BE    PFLD122                                                          
*&&UK*&& B     PFLD122                                                          
         MVC   FIELD(2),WORK+PVALESTA+2-PERVALD                                 
         MVC   FIELD+3(2),WORK+PVALESTA+4-PERVALD                               
         MVC   FIELD+6(2),WORK+PVALESTA-PERVALD                                 
         B     PFLD124                                                          
PFLD122  MVC   FIELD(2),WORK+PVALESTA+4-PERVALD                                 
         MVC   FIELD+3(2),WORK+PVALESTA+2-PERVALD                               
         MVC   FIELD+6(2),WORK+PVALESTA-PERVALD                                 
PFLD124  MVI   FIELD+2,C'/'                                                     
         MVI   FIELD+5,C'/'                                                     
         CLI   FIELD+6,C'9'        MAKE Y2K FORMAT YEAR DISPLAYABLE             
         BNH   *+18                                                             
         SR    R4,R4                                                            
         IC    R4,FIELD+6                                                       
         AHI   R4,-10                                                           
         STC   R4,FIELD+6                                                       
         LA    R4,8                                                             
         STCM  R4,15,FLDLEN                                                     
         B     PFLD130                                                          
*                                                                               
PFLD130  BCTR  R4,0                                                             
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),FIELD                                                    
         ICM   R3,15,OUTPOSN                                                    
*                                                                               
         ICM   RF,15,FLDLEN                                                     
         AR    R3,RF                                                            
         CLI   REFSQLI,C'N'                                                     
         BE    PFLD150                                                          
         TM    DATATYPE,DATATXTQ+DATADATQ                                       
         BZ    PFLD140                                                          
         LA    R3,1(R3)                                                         
         MVI   0(R3),C''''                                                      
         LA    R3,1(R3)                                                         
         LA    RF,2(RF)                                                         
PFLD140  MVI   0(R3),C','                                                       
         B     PFLD160                                                          
PFLD150  MVI   0(R3),C';'                                                       
PFLD160  LA    RF,1(RF)                                                         
         LA    R3,1(R3)                                                         
         STCM  R3,15,OUTPOSN                                                    
         ICM   R1,15,AREFAREA                                                   
         BZ    PFLDE020                                                         
         ICM   RE,15,0(R1)                                                      
         SRL   RE,16                                                            
         AR    RE,RF                                                            
         SLL   RE,16                                                            
         STCM  RE,15,0(R1)                                                      
         B     PFLDOK                                                           
*                                                                               
PFLD200  EQU   *                  PROCESS NULL FIELD HERE                       
         CLI   REFVER,1                                                         
         BL    PFLDOK                                                           
         SR    RF,RF                                                            
         CLI   REFSQLI,C'N'                                                     
         BE    PFLD220                                                          
         TM    DATATYPE,DATATXTQ+DATADATQ                                       
         BZ    PFLD210                                                          
         LA    R3,1(R3)                                                         
         MVC   0(2,R3),=XL2'7D7D'                                               
         LA    R3,2(R3)                                                         
         LA    RF,2(RF)                                                         
PFLD210  MVI   0(R3),C','                                                       
         B     PFLD230                                                          
PFLD220  MVI   0(R3),C';'                                                       
PFLD230  LA    RF,1(RF)                                                         
         LA    R3,1(R3)                                                         
         STCM  R3,15,OUTPOSN                                                    
         ICM   R1,15,AREFAREA                                                   
         BZ    PFLDE020                                                         
         ICM   RE,15,0(R1)                                                      
         SRL   RE,16                                                            
         AR    RE,RF                                                            
         SLL   RE,16                                                            
         STCM  RE,15,0(R1)                                                      
         B     PFLDOK                                                           
*                                                                               
PFLDE010 EQU   *                                                                
         MVC   REFSCODE,=AL3(1110)                                              
         B     PFLDNO                                                           
*                                                                               
PFLDE020 EQU   *                                                                
         MVC   REFSCODE,=AL3(1120)                                              
         B     PFLDNO                                                           
*                                                                               
PFLDNO   B     NO                                                               
PFLDOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* LOAD REPORT LINE DATA BUFFER FROM INPUT LINE                       *          
* ON ENTRY:                                                          *          
* REFDBPTR=A(CURRENT OFFSET IN DATA BUFFER)                          *          
* REFDLEN=REPORT DATA LINE LENGTH                                    *          
* REFDATA=REPORT DATA LINE                                           *          
* ON RETURN:                                                         *          
* DATAFLAG=C'E' IF END OF DATA LINE FOUND (C';' AT END )             *          
* REFDBPTR=A(CURRENT OFFSET IN DATA BUFFER)                          *          
**********************************************************************          
         SPACE 1                                                                
LOADBUFF NTR1                                                                   
         ICM   R3,15,REFDBPTR                                                   
         LA    RF,REFDBUFF                                                      
         AR    R3,RF                                                            
         ICM   RF,15,REFDLEN                                                    
         BZ    LBUFNO                                                           
         BCTR  RF,0                                                             
         LR    RE,R3                                                            
         AR    RE,RF                                                            
         LA    R1,REFDBUFF                                                      
         LA    R0,L'REFDBUFF                                                    
         AR    R1,R0                                                            
         CR    RE,R1                                                            
         BNL   LBUFNO                                                           
         LA    R1,REFDATA                                                       
         AR    R1,RF                                                            
         CLI   0(R1),C';'                                                       
         BNE   *+8                                                              
         MVI   DATAFLAG,C'E'                                                    
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),REFDATA                                                  
         LA    RE,1(RE)                                                         
         LA    RF,REFDBUFF                                                      
         LR    R1,RE                                                            
         SR    R1,RF                                                            
         STCM  R1,15,REFDBPTR                                                   
         CLI   DATAFLAG,C'E'                                                    
         BE    LBUFOK                                                           
         MVI   0(RE),C' '                                                       
         LA    RE,1(RE)                                                         
         LA    RF,REFDBUFF                                                      
         LR    R1,RE                                                            
         SR    R1,RF                                                            
         STCM  R1,15,REFDBPTR                                                   
         B     LBUFOK                                                           
*                                                                               
LBUFNO   B     NO                                                               
LBUFOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* CONVERT INTEGER FROM TEXT TO BINARY FORMAT.                        *          
* ON ENTRY:                                                          *          
* P1=A(NUMBER)                                                       *          
* P2=LENGTH OF NUMBER                                                *          
* ON RETURN                                                          *          
* P1 BYTE 1 = 0 IF OK OR = X'FF' IF ERROR                            *          
* P2=BINARY VALUE FULL WORD                                          *          
* USES WORK AREA 'DUB'                                               *          
**********************************************************************          
         SPACE 1                                                                
CONVNUM  NTR1                                                                   
         LM    R3,R4,0(R1)        SAVE ADDRESS AND LENGTH OF FIELD              
         LR    R7,R1                                                            
         LR    R5,R3                                                            
         LR    R6,R4                                                            
*                                                                               
CNUM2    TM    0(R3),X'F0'        NUMERIC ?                                     
         BO    CNUM4              VALID                                         
         CLI   0(R3),X'40'        SPACE ?                                       
         BNE   CNUM6              INVALID ZONE                                  
         OI    0(R3),X'F0'        SET TO VALID ZONE                             
*                                                                               
CNUM4    LA    R3,1(R3)           BUMP TO NEXT BYTE                             
         BCT   R4,CNUM2           LOOP TO LENGTH                                
         BCTR  R6,R0              LENGTH-1 FOR EXECUTE                          
         EX    R6,*+8             CONVERT TO PACKED (LENGTH MODIFIED)           
         B     CNUM8              VALID EXIT                                    
         PACK  DUB,0(0,R5)        ZONED TO PACKED                               
*                                                                               
CNUM6    MVI   0(R7),X'FF'                                                      
         B     CNUMNO                                                           
*                                                                               
CNUM8    EQU   *                                                                
         MVI   0(R7),0                                                          
         CVB   RF,DUB                                                           
         STCM  RF,15,4(R7)                                                      
         B     CNUMOK                                                           
*                                                                               
CNUMNO   B     NO                                                               
CNUMOK   B     YES                                                              
         EJECT                                                                  
**********************************************************************          
* ERROR REPORT                                                       *          
**********************************************************************          
         SPACE 1                                                                
EREPORT  NTR1                                                                   
         MVC   REFEREP,SPACES                                                   
         ICM   R4,15,=A(ERRTAB)                                                 
         A     R4,RELO                                                          
         USING ERRTABD,R4                                                       
*                                                                               
EREP010  CLC   ERTCODE,=AL3(0)                                                  
         BE    EREP020                                                          
         CLC   ERTCODE,REFSCODE                                                 
         BE    EREP020                                                          
         LA    R4,ERRTABL(R4)                                                   
         B     EREP010                                                          
*                                                                               
EREP020  EQU   *                                                                
         MVC   REFEREP,ERTMSG                                                   
         MVC   REFERFLG,ERTFLAG                                                 
         B     EREPOK                                                           
*                                                                               
EREPNO   B     NO                                                               
EREPOK   B     YES                                                              
         DROP  R4                                                               
         EJECT                                                                  
*                                                                               
YES      SR    RC,RC                                                            
NO       LTR   RC,RC                                                            
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
         DS    0D                                                               
ROWVALUE DC    XL4'00'                                                          
COLVALUE DC    XL4'00'                                                          
FIRST    DC    C' '                                                             
SPACES   DC    128C' '                                                          
ZEROES   DC    128C'0'                                                          
DMOPEN   DC    C'OPEN   '                                                       
DMREAD   DC    C'DMREAD '                                                       
DMRSEQ   DC    C'DMRSEQ '                                                       
DMRDHI   DC    C'DMRDHI '                                                       
DMADD    DC    C'DMADD  '                                                       
DMWRT    DC    C'DMWRT  '                                                       
DMCLSE   DC    C'DMCLSE '                                                       
DMFAST   DC    C'DMFAST '                                                       
GFILE    DC    C'GFILE  '                                                       
GETREC   DC    C'GETREC '                                                       
PUTREC   DC    C'PUTREC '                                                       
ADDREC   DC    C'ADDREC '                                                       
CTFILE   DC    C'CTFILE '                                                       
GENDIR   DC    C'GENDIR '                                                       
GENFIL   DC    C'GENFIL '                                                       
INSERTQ  DC    C'INSERT INTO SQL_TABLE_NAME_GOES_HERE VALUES ('                 
         DS    0D                                                               
DMDA     DC    F'0'                                                             
         DS    0D                                                               
VDATAMGR DC    V(DATAMGR)                                                       
VHELLO   DC    V(HELLO)                                                         
VDATCON  DC    V(DATCON)                                                        
VPERVAL  DC    V(PERVAL)                                                        
         EJECT                                                                  
WORKD    DSECT                                                                  
*                                                                               
DMCB     DS    6F                                                               
DATAMGR  DS    V                                                                
RELO     DS    A                                                                
DUB      DS    D                                                                
APARM    DS    A                   A(PARAMETER LIST)                            
*                                                                               
PARM     DS    0XL12               PARAMETER LIST                               
AREFORMC DS    AL4                 A(REFORM BLOCK)                              
*                                                                               
AREFAREA DS    AL4                 A(REFORM WORK AREA)                          
*                                                                               
ACOMFACS DS    AL4                 A(COMFACS)                                   
*                                                                               
*                                                                               
AREPLINE DS    AL4                                                              
OUTPOSN  DS    AL4                                                              
ROW      DS    XL4                                                              
COLUMN   DS    XL4                                                              
OFFSET   DS    XL4                                                              
RQDLEN   DS    XL4                                                              
NEXTFORM DS    AL4                                                              
FLDLEN   DS    XL4                                                              
FIELD    DS    XL255                                                            
FILTLEN  DS    XL4                                                              
FILTFLD  DS    XL255                                                            
BYTE     DS    XL1                                                              
NORMFLAG DS    CL1                                                              
DATAFLAG DS    CL1                                                              
LITFLAG  DS    CL1                                                              
DINKFLAG DS    CL1                                                              
NULLFLAG DS    CL1                                                              
DATATYPE DS    XL1                                                              
DATATXTQ EQU   X'01'                                                            
DATANUMQ EQU   X'02'                                                            
DATADATQ EQU   X'04'                                                            
*                                                                               
MVSTIME  DS    F                   IBM TIME BINARY 100S SECS                    
MVSDATE  DS    F                   IBM DATE JULIAN                              
*                                                                               
CENTURY  DS    CL2                 CURRENT CENTURY EBCDIC VALUE                 
DATEN    DS    CL8                 DATE NOW EBCDIC                              
TIMEN    DS    CL8                 TIME NOW EBCDIC (HHMMSSTH)                   
DATEB    DS    XL2                 DATE IN BINARY FROM PERVAL                   
*                                                                               
WORK     DS    XL255                                                            
DMWORK   DS    12D                                                              
ELEMENT  DS    XL255                                                            
IOERR    DS    XL1                 IO ERROR BYTE                                
IOKEY    DS    XL(L'GREFKEY)       CONTROL GEN FILE KEY                         
FORMWORK DS    XL(L'REFFORM)       TRANSFORM FORMULA WORK AREA                  
SQLWORK  DS    XL(L'REFSQBUF)      SQL STATEMENT BUFFER WORK AREA               
IOAREA   DS    2000C               IO AREA                                      
*                                                                               
WORKX    EQU   *                                                                
         EJECT                                                                  
       ++INCLUDE DDREFORMD                                                      
*                                                                               
       ++INCLUDE GEGENREF                                                       
*                                                                               
       ++INCLUDE DDCOMFACS                                                      
*                                                                               
       ++INCLUDE DDPERVALD                                                      
*                                                                               
         PRINT OFF                                                              
       ++INCLUDE CTGENFILE                                                      
         PRINT ON                                                               
         EJECT                                                                  
*                                                                               
* DSECT FOR ERROR REPORT TABLE                                                  
*                                                                               
ERRTABD  DSECT                                                                  
*                                                                               
ERTCODE  DS    AL3                 ERROR CODE NUMBER                            
ERTFLAG  DS    XL1                 ERROR TABLE CONTROL FLAGS                    
ERTMSG   DS    CL80                ERROR MESSAGE                                
*                                                                               
ERRTABL  EQU   *-ERRTABD                                                        
         SPACE 1                                                                
*                                                                               
* CSECT FOR ERROR REPORT TABLE                                                  
*                                                                               
         DS    0D                                                               
ERRTAB   CSECT                                                                  
         DC    AL3(0110),XL1'00'                                                
         DC    CL80'REFORM ID RECORD NOT FOUND'                                 
         DC    AL3(0120),XL1'00'                                                
         DC    CL80'MVS TIME MACRO FAILED'                                      
         DC    AL3(0130),XL1'00'                                                
         DC    CL80'INITIALISATION RETURN AREA ADDRESS INVALID'                 
         DC    AL3(0210),XL1'00'                                                
         DC    CL80'INVALID TRANSFORMATION FORMULA SYNTAX'                      
         DC    AL3(0710),XL1'00'                                                
         DC    CL80'INVALID SQL STATEMENT SYNTAX'                               
         DC    AL3(0720),XL1'00'                                                
         DC    CL80'INVALID SQL STATEMENT SYNTAX'                               
         DC    AL3(0310),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0320),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0330),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0340),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0350),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0360),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0370),XL1'00'                                                
         DC    CL80'INVALID REQUEST DETAILS FORMULA SYNTAX'                     
         DC    AL3(0410),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0420),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0430),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0440),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0450),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0460),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0470),XL1'00'                                                
         DC    CL80'ERROR EXTRACTING REQUEST DETAIL VALUE'                      
         DC    AL3(0510),XL1'00'                                                
         DC    CL80'ERROR READING SQL BOOK RECORD'                              
         DC    AL3(0910),XL1'00'                                                
         DC    CL80'UNDEFINED ERROR CODE - PLEASE CONTACT JOMUDDLO'             
         DC    AL3(0920),XL1'00'                                                
         DC    CL80'SQL BEFORE PROCESS RETURN AREA ADDRESS INVALID'             
         DC    AL3(0010),XL1'00'                                                
         DC    CL80'DATA DETAIL LINE START ROW DEFINITION INVALID'              
         DC    AL3(0011),XL1'00'                                                
         DC    CL80'ERROR REPORT DATA DETAIL LINE - LOADING MEMORY'             
         DC    AL3(0020),XL1'00'                                                
         DC    CL36'ERROR IN TRANSFORM FORMULA SYNTAX - '                       
         DC    CL44'CHECK SEPARATORS (;) AND TERMINATORS (;;)'                  
         DC    AL3(0021),XL1'00'                                                
         DC    CL80'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0030),XL1'00'                                                
         DC    CL39'DATALINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING ( LEFT BRACKET CHARACTER '                          
         DC    AL3(0031),XL1'00'                                                
         DC    CL39'DATALINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING ) RIGHT BRACKET CHARACTER '                         
         DC    AL3(0032),XL1'00'                                                
         DC    CL39'DATALINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'INVALID NUMERIC COMPONENT'                                  
         DC    AL3(0033),XL1'00'                                                
         DC    CL39'DATALINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING ) RIGHT BRACKET CHARACTER '                         
         DC    AL3(0034),XL1'00'                                                
         DC    CL35'DATA FIELD FORMULA ELEMENT ERROR - '                        
         DC    CL45'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0035),XL1'00'                                                
         DC    CL35'DATA FIELD FORMULA ELEMENT ERROR - '                        
         DC    CL45'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0050),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING ( LEFT BRACKET CHARACTER'                           
         DC    AL3(0051),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING , COMMA CHARACTER'                                  
         DC    AL3(0052),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'INVALID NUMERIC COMPONENT'                                  
         DC    AL3(0053),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING ) RIGHT BRACKET CHARACTER'                          
         DC    AL3(0054),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'INVALID NUMERIC COMPONENT'                                  
         DC    AL3(0056),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'HEADLINE LENGTH OVERFLOW'                                   
         DC    AL3(0057),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0058),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0070),XL1'00'                                                
         DC    CL38'LITERAL FIELD FORMULA ELEMENT ERROR - '                     
         DC    CL42'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0072),XL1'00'                                                
         DC    CL38'LITERAL FIELD FORMULA ELEMENT ERROR - '                     
         DC    CL42'TRANSFORM FORMULA TOO LONG - MEMORY OVERFLOW'               
         DC    AL3(0073),XL1'00'                                                
         DC    CL35'DATA FIELD FORMULA ELEMENT ERROR - '                        
         DC    CL45'TRAILING DATA TYPE CODE INVALID NOT N, T OR D'              
         DC    AL3(0074),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'TRAILING DATA TYPE CODE INVALID NOT N, T OR D'              
         DC    AL3(0075),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'INVALID NUMERIC COMPONENT'                                  
         DC    AL3(0076),XL1'00'                                                
         DC    CL39'HEADLINE FIELD FORMULA ELEMENT ERROR - '                    
         DC    CL41'MISSING , COMMA CHARACTER'                                  
         DC    AL3(0077),XL1'00'                                                
         DC    CL38'LITERAL FIELD FORMULA ELEMENT ERROR - '                     
         DC    CL42'TRAILING DATA TYPE CODE INVALID NOT N OR T'                 
         DC    AL3(0078),XL1'00'                                                
         DC    CL27'PROCESS REPORT DATA LINE - '                                
         DC    CL53'RETURN AREA ADDRESS INVALID'                                
         DC    AL3(0079),XL1'00'                                                
         DC    CL27'PROCESS REPORT DATA LINE - '                                
         DC    CL53'RETURN AREA ADDRESS INVALID'                                
         DC    AL3(1010),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1020),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1030),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1040),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1050),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1060),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1070),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MAX. NUMBER OF REPORT LINE FIELDS EXCEEDED'                 
         DC    AL3(1080),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'MISSING REPORT LINE ADDRESS               '                 
         DC    AL3(1090),XL1'01'                                                
         DC    CL37'ERROR IN READING REPORT LINE FIELD - '                      
         DC    CL43'ZERO COLUMN NUMBER IS INVALID             '                 
         DC    AL3(1110),XL1'00'                                                
         DC    CL80'INVALID DATE FIELD CONVERSION'                              
         DC    AL3(1120),XL1'00'                                                
         DC    CL80'OUTPUT FIELD RETURN AREA ADDRESS INVALID'                   
ERRTABX  DS    AL3(0)                                                           
         DC    CL80'UNDEFINED ERROR CODE - PLEASE CONTACT JOMUDDLO'             
         DC    CL80' '                                                          
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'005DDREFORMUS11/22/01'                                      
         END                                                                    

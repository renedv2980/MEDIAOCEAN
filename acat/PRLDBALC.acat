*          DATA SET PRLDBALC   AT LEVEL 033 AS OF 10/31/19                      
*PROCESS USING(WARN(15))                                                        
*CATALP PRLDBALC                                                                
*        TITLE 'LOAD/DUMP - PRINT FILE BALANCE'                                 
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE'                      
***********************************************************************         
*                                                                     *         
*  CHANGE LOG                                                         *         
*                                                                     *         
* KWAN 07/15/19 GENERATE ESTIMATE BUCKET F4 CARD (PEC-34747)                    
*                                                                     *         
* BOBY 09/00/09 ADD BILLED DATA TO REPORT                             *         
*               MAKE REPORT MORE READABLE                             *         
*                                                                     *         
* BOBY 10/16/07 INCREASE SIZE OF BUCKETS TO PL8                       *         
*                                                                     *         
* KWAN 09/14/07 DISPLAY BILLIONS FOR TOTALS                           *         
*                                                                     *         
* BPLA AUG/02   CLIENT TABLE EXPANDED TO 3250 (CTABMAX)               *         
*                                                                     *         
* BPLA SEP10/01 CLIENT TABLE EXPANDED TO 3000 (CTABMAX)               *         
*                                                                     *         
* BPLA 5/22/95  CLIENT TABLE EXPANDED FROM 2000 TO 2500  (CTABMAX)    *         
*                                                                     *         
* BPLA 12/14/92 CLIENT TABLE EXPANDED FROM 1000 TO 2000  (CTABMAX)    *         
*                                                                     *         
***********************************************************************         
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE- INIT'                
***********************************************************************         
*                                                                     *         
*        INITIALIZATION                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
LDBALCK  CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 WKDL,PPLDBALC                                                    
*                                                                               
         USING WKD,RC              ESTABLISH WORKING STORAGE                    
*                                                                               
*        PARAM1    BYTE 0     X'01' = RECORD,X'FF'=EOF                          
*                       1-3   A(REC)                                            
*        PARAM2               A(FILE NAME)                                      
*                                                                               
         ST    R1,SAVR1            SAVE PARAMETER POINTER                       
*                                                                               
         L     RA,=V(CPRINT)       ESTABLISH DDPRINT WORKAREA                   
         USING DPRINT,RA                                                        
*                                                                               
         CLI   FRST,0              SKIP IF NOT FIRST TIME                       
         BNE   PCFRSTX                                                          
*                                                                               
         MVI   FRST,X'FF'          TURN OFF FIRST TIME SWITCH                   
*                                                                               
         MVC   LINE,=PL2'75'       FORCE NEW PAGE                               
*                                                                               
*        FORMAT REPORT TITLES                                                   
*                                                                               
         L     RF,4(R1)            POINT TO FILE NAME                           
         MVC   SAVEFILE,0(RF)      SAVE FILE NAME                               
*                                                                               
         MVC   TITLE,SPACES                                                     
         MVC   TITLE+14(26),=C'PRINTPAK FILE BALANCING - '                      
         MVC   TITLE+40(8),0(RF)   FILE NAME                                    
*                                                                               
         MVI   MID1,0                                                           
*                                                                               
         MVC   MID2,SPACES         INIT MIDLINE                                 
         MVC   MID2+16(38),=C'-------------O R D E R E D------------'           
         MVC   MID2+55(38),=C'----------------P A I D---------------'           
         MVC   MID2+94(38),=C'--------------B I L L E D-------------'           
*                                                                               
         MVC   MID3,SPACES         INIT MIDLINE                                 
         MVC   MID3+00(11),=C'AGY  MED  CLT'                                    
         MVC   MID3+16(38),=C'GROSS AMOUNT    GROSS LCD  NET LESS CD'           
         MVC   MID3+55(38),=C'GROSS AMOUNT    GROSS LCD  NET LESS CD'           
         MVC   MID3+94(38),=C'GROSS AMOUNT    GROSS LCD  NET LESS CD'           
*                                                                               
         MVC   MID4,SPACES         INIT MIDLINE                                 
         MVC   MID4+00(11),=C'---  ---  ---'                                    
         MVC   MID4+16(38),=C'------------    ---------  -----------'           
         MVC   MID4+55(38),=C'------------    ---------  -----------'           
         MVC   MID4+94(38),=C'------------    ---------  -----------'           
*                                                                               
*        SET BINSRCH PARS                                                       
*                                                                               
         SR    R0,R0               A(RECORD TO BE INSERTED)                     
         LAY   R1,CTAB             A(BINSRCH TABLE)                             
         SR    R2,R2               NUMBER OF RECORDS IN TABLE                   
         LA    R3,CTABDL           LENGTH OF RECORD                             
         LA    R4,3                AL1(DISP OF KEY),AL3(KEY LENGTH)             
         LA    R5,CTABMAX          MAX NUMBER OF RECORDS IN TABLE               
         STM   R0,R5,BSPARS                                                     
*                                                                               
         MVI   ANYPF4,0                                                         
         OPEN  (RQFILPF4,OUTPUT)        OPEN FILE                               
*                                                                               
PCFRSTX  DS    0H                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE- PCNXT'               
***********************************************************************         
*                                                                     *         
*        NEXT RECORD                                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PCNXT    DS    0H                                                               
*                                                                               
         L     R1,SAVR1            POINT TO NEXT RECORD                         
         L     R2,0(R1)            A(RECORD)                                    
*                                                                               
         CLI   0(R1),X'FF'         IF EOF                                       
         BNE   *+12                                                             
         LA    R2,=X'FFFFFFFF'        SET RECORD ID TO HIGH                     
         B     PCNXT10                                                          
*                                                                               
         CLC   OLDAGM,0(R2)        IF AGENCY/MEDIA CHANGES                      
         BE    PCREC                                                            
*                                                                               
         CLI   OLDAGM,0            AND NOT FIRST AGENCY/MEDIA                   
         BE    PCREC                                                            
*                                                                               
         CLC   OLDAGM(2),0(R2)     FORCE TOTALS IF NEW AGY                      
         BNE   PCNXT10                                                          
*                                                                               
         CLI   OLDAGM+2,0          SKIP IF NO OLD MEDIA KNOWN                   
         BE    PCREC                                                            
*                                                                               
PCNXT10  DS    0H                                                               
*                                                                               
*        END OF AGY/MED                                                         
*                                                                               
*        PRINT CLT/AGM/MED/FILE TOTALS                                          
*                                                                               
         BRAS  RE,PRLSTS                                                        
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE- PCREC'               
***********************************************************************         
*                                                                     *         
*        PROCESS RECORD                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PCREC    DS    0H                                                               
*                                                                               
         LA    RF,SKIPLST          LIST OF AGENCIES TO SKIP                     
         LA    R0,SKIPLN           # OF AGENCIES IN LIST                        
*                                                                               
PC32     DS    0H                                                               
*                                                                               
         CLC   0(2,R2),0(RF)                                                    
         BE    EXIT                SKIP IF IN LIST                              
*                                                                               
         LA    RF,2(RF)                                                         
         BCT   R0,PC32                                                          
*                                                                               
*        ANALYZE INCOMING RECORD                                                
*                                                                               
         CLI   3(R2),PBUYKIDQ      BUY REC                                      
         BE    PCBUY                                                            
*                                                                               
         CLI   3(R2),PBKKIDQ      BUCKET RECORD                                 
         BE    PCBKT                                                            
*                                                                               
         CLI   3(R2),PBILKIDQ     BILL   RECORD                                 
         BE    PCBIL                                                            
*                                                                               
         B     EXIT                                                             
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE- PCBKT'               
***********************************************************************         
*                                                                     *         
*        BUCKET  RECORD                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PCBKT    DS    0H                                                               
*                                                                               
         USING PBKRECD,R2          ESTABLISH BUCKET RECORD                      
*                                                                               
         MVC   OLDAGM,PBKKAGY      SAVE AGY/MED                                 
*                                                                               
         TM    PBKCNTL,X'80'       SKIP DELETED                                 
         BO    PCBKTX                                                           
*                                                                               
         LA    RE,PBKREC+33        POINT TO FIRST ELM IN RECORD                 
*                                                                               
PCBKTLP  DS    0H                                                               
*                                                                               
         CLI   0(RE),0                                                          
         BE    PCBKTDN         NO ELEMS                                         
*                                                                               
         CLI   1(RE),X'2E'   OK SINCE 21,22,23 ELEMS ALL SAME LENGTH            
         BE    PCBKTFD                                                          
*                                                                               
PCBKTCN  DS    0H                                                               
         LLC   R0,1(RE)            BUMP TO NEXT ELEMENT                         
         AR    RE,R0                                                            
         B     PCBKTLP                                                          
*                                                                               
         USING BKELEMD,RE          ESTABLISH ELEMENT                            
*                                                                               
PCBKTFD  TM    BKIND,X'01'         SEE IF TEST EST BUCKET                       
         BO    PCBKTX          SKIP TEST EST BUCKET FROM BALANCE CHK            
*                                                                               
         DROP  RE                                                               
*                                                                               
*        GET BUCKET DATA FROM RECORD                                            
*              RESULTS IN PL6 BUCKETS                                           
*                                                                               
PCBKTDN  GOTO1 =V(BUCKPRT),DMCB,(C'P',PBKREC),P,TEMPTOTS,VDATCON,0              
*                                                                               
*        MOVE TOTALS TO PL8 BUCKETS                                             
*                                                                               
         LA    R0,12               NUMBER OF BUCKETS                            
         LA    RE,WKTOTS           REGULAR AND SPECIAL BUCKETS                  
         LA    RF,TEMPTOTS                                                      
*                                                                               
         ZAP   0(8,RE),0(6,RF)                                                  
         LA    RE,8(RE)                                                         
         LA    RF,6(RF)                                                         
         BCT   R0,*-14                                                          
*                                                                               
         CLC   WKTOTS(6*8),WKTOTS+6*8   OK IF REGULAR MATCH                     
         BE    PC36                        SPECIAL TOTALS                       
*                                  PRINT BUCKETS                                
         GOTO1 =V(BUCKPRT),(R1),,,,,VPRINT                                      
*                                                                               
         MVC   P(11),=CL11'**BKT BAD**'                                         
         GOTO1 VPRINT                                                           
*                                                                               
         MVI   ERRSW,C'Y'          INDICATE ERROR                               
*                                                                               
         TM    MSGFLAG,MSGBKTQ     SKIP IF BUCKET MESSAGE ALREADY SENT          
         BO    PC36                                                             
*                                                                               
         OI    MSGFLAG,MSGBKTQ     INDICATE BUCKET MSG SENT                     
*                                                                               
         MVC   BCKTMSGF(L'SAVEFILE),SAVEFILE SET FILE NAME                      
         MVC   BCKTMSGA,PBKKAGY    AGENCY                                       
         MVC   BCKTMSGM,PBKKMED    MEDIA                                        
         MVC   BCKTMSGC,PBKKCLT    CLIENT                                       
         MVC   BCKTMSGP,PBKKPRD    PRODUCT                                      
         SR    RF,RF                                                            
         ICM   RF,3,PBKKEST                                                     
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'         FORCE SIGN                                   
         UNPK  BCKTMSGE,DUB        ESTIMATE                                     
         MVC   P(BCKTMSGQ),BCKTMSG                                              
*                                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'OPMSG',('BCKTMSGQ',P)                        
*                                                                               
PC36     DS    0H                                                               
*                                                                               
         MVI   BYTE,C'B'           INDICATE BUCKET DATA                         
         BRAS  RE,POST             POST TO ACCUMULATORS                         
*                                                                               
PCBKTX   DS    0H                                                               
         B     EXIT                                                             
*                                                                               
         DROP  R2                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE- PCBIL'               
***********************************************************************         
*                                                                     *         
*        BILL    RECORD                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PCBIL    DS    0H                                                               
*                                                                               
         USING PBILLRCD,R2         ESTABLISH BUCKET RECORD                      
*                                                                               
         MVC   OLDAGM,PBILKAGY     SAVE AGY/MED                                 
*                                                                               
         TM    PBILLCTL,X'80'      SKIP DELETED                                 
         BO    PCBILX                                                           
*                                                                               
         TM    PBILCMSW,X'20'      SKIP AOR BILLS                               
         BO    PCBILX                                                           
*                                                                               
         OC    PBILKEST,PBILKEST   SKIP OLD BILLS                               
         BZ    PCBILX                                                           
*                                                                               
         CLI   PBRETAIL,X'41'      SKIP CORP SUMMARY BILLS                      
         BE    PCBILX                                                           
*                                                                               
         CLI   PBILLTYP,C'M'       IF MANUAL BILL                               
         BNE   *+14                                                             
         CLC   PBILMCAN,=6C'0'     SKIP IF NOT REVERSED                         
         BNH   PCBILX                                                           
*                                                                               
*        BREAKOUT AMOUNTS IN BILL HEADER                                        
*                                                                               
         GOTO1 VPPBVAL,DMCB,(C'B',PBILLREC),PPBVALC                             
*                                                                               
         LA    R3,PPBVALC          ESTABLISH PPBVAL OUTPUT                      
         USING PPBVALD,R3                                                       
*                                                                               
*        MOVE TOTALS TO PL8 BUCKETS                                             
*                                                                               
         LA    R0,6                NUMBER OF ORDERED & PAID BUCKETS             
         LA    RE,WKTOTS                                                        
*                                                                               
*        CLEAR ORDERED AND PAID BUCKETS                                         
*                                                                               
         ZAP   0(8,RE),=P'0'                                                    
         LA    RE,8(RE)                                                         
         BCT   R0,*-10                                                          
*                                                                               
*        FILL BILLED BUCKETS                                                    
*                                                                               
         LA    RE,WKTOTS                                                        
         USING BKTSD,RE            ESTABLISH WORK BUCKETS                       
*                                                                               
         ZAP   BKTBGRS,PPBVEBG     BILLED GROSS                                 
         ZAP   BKTBNET,PPBVEBN     BILLED NET                                   
         AP    BKTBNET,PPBVEBC                                                  
         ZAP   BKTBCD,PPBVEBC      BILLED CD                                    
*                                                                               
         MVI   BYTE,C'I'           INDICATE BILL DATA                           
         BRAS  RE,POST             POST TO ACCUMULATORS                         
*                                                                               
PCBILX   DS    0H                                                               
         B     EXIT                                                             
*                                                                               
         DROP  R2                                                               
         DROP  RE                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE- PCBUY'               
***********************************************************************         
*                                                                     *         
*        BUY     RECORD                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PCBUY    DS    0H                                                               
*                                                                               
         USING PBUYREC,R2          ESTABLISH AS BUY RECORD                      
*                                                                               
         TM    PBUYCNTL,X'40'      SKIP CLOSED-OUT                              
         BNZ   PCBUYX                                                           
*                                                                               
         MVC   OLDAGM,PBUYKAGY     SAVE AGY/MED                                 
*                                                                               
         CLI   PBDBFD,C'T'         SKIP TEST BUYS                               
         BE    PCBUYX                                                           
*                                                                               
*        FIND BUY DOLLARS VIA GETINS                                            
*                                                                               
         GOTO1 =V(GETINS),DMCB,(R2),GROSS,7(R2)                                 
*                                                                               
         TM    PBUYCNTL,X'80'      IF DELETED                                   
         BZ    *+10                                                             
         XC    GROSS(12),GROSS        CLEAR ORDERED                             
*                                                                               
         LA    R3,WKTOTS           ESTABLISH BUCKETS                            
         USING BKTSD,R3                                                         
*                                                                               
         L     R1,GROSS                                                         
         CVD   R1,DUB                                                           
         ZAP   BKTGRS,DUB          GROSS                                        
*                                                                               
         S     R1,AGYCOM                                                        
         CVD   R1,DUB                                                           
         ZAP   BKTNET,DUB          NET                                          
*                                                                               
         L     R1,CSHDSC                                                        
         CVD   R1,DUB                                                           
         ZAP   BKTCD,DUB           CASH DISCOUNT                                
*                                                                               
         L     R1,PGROSS                                                        
         CVD   R1,DUB                                                           
         ZAP   BKTPGRS,DUB         PAID GROSS                                   
*                                                                               
         S     R1,PAGYCOM                                                       
         CVD   R1,DUB                                                           
         ZAP   BKTPNET,DUB         PAID NET                                     
*                                                                               
         L     R1,PCSHDSC                                                       
         CVD   R1,DUB                                                           
         ZAP   BKTPCD,DUB          PAID CASH DISCOUNT                           
*                                                                               
         L     R1,BGROSS                                                        
         CVD   R1,DUB                                                           
         ZAP   BKTBGRS,DUB         BILLED GROSS                                 
*                                                                               
         S     R1,BAGYCOM                                                       
         CVD   R1,DUB                                                           
         ZAP   BKTBNET,DUB         BILLED NET                                   
*                                                                               
         L     R1,BCSCHDSC                                                      
         CVD   R1,DUB                                                           
         ZAP   BKTBCD,DUB          BILLED CASH DISCOUNT                         
*                                                                               
         MVI   BYTE,C'F'           INDICATE DATA FROM FILE RECS                 
         BRAS  RE,POST                                                          
*                                                                               
PCBUYX   DS    0H                                                               
         B     EXIT                                                             
*                                                                               
EXIT     DS    0H                                                               
         XIT1                                                                   
*                                                                               
         DROP  R2                                                               
         DROP  R3                                                               
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - POST'               
***********************************************************************         
*                                                                     *         
*        POST TO CLIENT TABLE                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
POST     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    X,X                 ESTABLISH WORKAREA FOR CLIENT TABLE          
         LA    R4,X                                                             
         USING CTABD,R4                                                         
*                                                                               
         MVC   CTCLT,4(R2)         SAVE CLIENT                                  
*                                                                               
         CLI   BYTE,C'F'           IF FILE RECORD                               
         BNE   POST4                                                            
*                                                                               
         MVC   CTFTOTS(BKTSL),WKTOTS       FILE AMOUNTS                         
*                                                                               
         MVC   CTBTOTS(BKTSL),=9PL8'0'     CLEAR BUCKET AMOUNTS                 
*                                                                               
         B     POST5                                                            
*                                                                               
POST4    DS    0H                                                               
*                                                                               
         MVC   CTFTOTS(BKTSL),=9PL8'0'     CLEAR FILE   AMOUNTS                 
*                                                                               
         CLI   BYTE,C'I'           IF BILL RECORD                               
         BNE   *+14                                                             
         MVC   CTBTOTS(BKTSL),WKTOTS    SAVE BILL DATA                          
         B     POST5                                                            
*                                                                               
         MVC   CTBTOTS(BKTSL),=9PL8'0'     CLEAR BUCKET AMOUNTS                 
         MVC   CTBTOTS(6*8),WKTOTS         SAVE  6 BUCKET AMOUNTS               
*                                            ORDERED AND PAID BUCKETS           
POST5    DS    0H                                                               
*                                                                               
         CLC   OLDCLT,4(R2)        IF CLIENT UNCHANGED                          
         BNE   *+12                                                             
         L     RF,SVTAB               USE LAST ENTRY IN TABLE                   
         B     POST6B                                                           
*                                                                               
*        NEW CLIENT                                                             
*                                                                               
         MVC   OLDCLT,4(R2)        RESET CLIENT                                 
*                                                                               
*        ADD/FIND CLIENT TO CTAB                                                
*                                                                               
         GOTO1 =V(BINSRCH),BSPARS,(1,(R4))                                      
         OC    1(3,R1),1(R1)       TEST TABLE FULL                              
         BNZ   POST6                                                            
*                                                                               
         TM    MSGFLAG,MSGCLTQ     SKIP IF CLIENT MESSAGE ALREADY SENT          
         BO    POST5A                                                           
*                                                                               
         OI    MSGFLAG,MSGCLTQ     INDICATE TABLE FULL MSG SENT                 
*                                                                               
         MVC   CLTABFLC,OLDCLT                                                  
         MVC   P(CLTABFLQ),CLTABFL                                              
*                                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'OPMSG',('CLTABFLQ',P)                        
*                                                                               
POST5A   DS    0H                                                               
*                                                                               
         MVC   P,SPACES                                                         
*                                                                               
         MVC   P(54),=C'**CLIENT TABLE FULL - CLIENT XXX TOTALS NOT INCX        
               LUDED**'                                                         
         MVC   P+29(3),OLDCLT                                                   
*                                                                               
         GOTO1 VPRINT                                                           
*                                                                               
         MVI   ERRSW,C'Y'          INDICATE ERROR OCCURRED                      
*                                                                               
         B     POSTX                                                            
*                                                                               
POST6    DS    0H                                                               
*                                                                               
         MVC   SVTAB,0(R1)         SAVE A(TABLE ENTRY)                          
*                                                                               
         CLI   0(R1),1        IF ADDED THIS TIME                                
         BE    POSTX             DONE                                           
*                                                                               
*                             ELSE-ADD AMOUNTS TO TABLE ENTRY                   
*                                                                               
         L     RF,0(R1)            POINT TO FOUND TABLE ENTRY                   
*                                                                               
*        ADD NEW AMOUNTS TO TABLE ENTRY                                         
*                                                                               
POST6B   DS    0H                                                               
*                                                                               
         LA    RF,4(RF)            POINT TO FIRST BUCKET                        
         LA    R4,X+4              POINT TO FIRST BUCKET                        
         LA    R0,18               NUMBER OF BUCKETS                            
*                                                                               
         B     POSTLOOP                                                         
*                                                                               
         CLI   BYTE,C'F'           SKIP IF FILE BUCKETS                         
         BE    POSTLOOP                                                         
*                                                                               
         LA    RF,BKTSL(RF)        POINT TO EST BUCKET BUCKETS                  
         LA    R4,BKTSL(R4)                                                     
*                                                                               
POSTLOOP DS    0H                                                               
*                                                                               
         AP    0(8,RF),0(8,R4)     UPDATE BUCKETS                               
*                                                                               
         LA    RF,8(RF)                                                         
         LA    R4,8(R4)                                                         
         BCT   R0,POSTLOOP                                                      
*                                                                               
POSTX    DS    0H                                                               
         J     EXIT                                                             
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - EDCTOTS'            
***********************************************************************         
*                                                                     *         
*        EDIT CLIENT TOTALS                                           *         
*                                                                     *         
*NTRY    R7==> BUCKETS TO PRINT                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
EDCTOTS  NTR1  BASE=*,LABEL=*                                                   
*                                  RE-ARRANGE TOTALS                            
         USING PLD,R6              ESTABLISH PRINT LINE                         
*                                                                               
         LA    R3,WKTOTS           POINT TO TOTAL BUCKETS                       
         USING TOTSD,R3            ESTABLISH TOTAL BUCKETS                      
*                                                                               
         USING BKTSD,R7            ESTABLISH BUCKETS                            
*                                                                               
         ZAP   TOTGRS,BKTGRS            GROSS     -ORDERED                      
         ZAP   TOTGCD,BKTGRS                                                    
         SP    TOTGCD,BKTCD             LESS CD                                 
         ZAP   TOTNCD,BKTNET            NET                                     
         SP    TOTNCD,BKTCD             LESS CD                                 
*                                                                               
         ZAP   TOTPGRS,BKTPGRS          GROSS     -PAID                         
         ZAP   TOTPGCD,BKTPGRS                                                  
         SP    TOTPGCD,BKTPCD           LESS CD                                 
         ZAP   TOTPNCD,BKTPNET          NET                                     
         SP    TOTPNCD,BKTPCD           LESS CD                                 
*                                                                               
         ZAP   TOTBGRS,BKTBGRS          GROSS     -BILLED                       
         ZAP   TOTBGCD,BKTBGRS                                                  
         SP    TOTBGCD,BKTBCD           LESS CD                                 
         ZAP   TOTBNCD,BKTBNET          NET                                     
         SP    TOTBNCD,BKTBCD           LESS CD                                 
*                                                                               
*        PRINT TOTALS                                                           
*                                                                               
         LA    R7,WKTOTS                                                        
         LA    R8,PLAMTS                                                        
         LA    RF,9                                                             
*                                                                               
EDCT2    DS    0H                                                               
*                                                                               
         MVC   WORK(15),=X'40202020202020202020214B2020'                        
         LA    R1,WORK+9                                                        
         EDMK  WORK(13),1(R7)                                                   
*                                                                               
         BCTR  R1,0                                                             
*                                                                               
         CP    0(8,R7),=P'0'                                                    
         BNL   *+8                 TO MVC WORK(15) . .                          
         MVI   0(R1),C'-'                                                       
*                                                                               
         MVC   0(13,R8),WORK                                                    
*                                                                               
         LA    R7,8(R7)                                                         
         LA    R8,15(R8)                                                        
*                                                                               
         BCT   RF,EDCT2                                                         
*                                                                               
         J     EXIT                                                             
*                                                                               
         DROP  R3,R7                                                            
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - EDTOTS'             
***********************************************************************         
*                                                                     *         
*        EDIT OTHER  TOTALS                                           *         
*                                                                     *         
*NTRY    R7==> BUCKETS TO PRINT                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
EDTOTS   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
*        RE-ARRANGE TOTALS FOR PRINTING                                         
*                                                                               
         LA    R3,WKTOTS           POINT TO TOTAL BUCKETS                       
         USING TOTSD,R3            ESTABLISH TOTAL BUCKETS                      
*                                                                               
         USING BKTSD,R7            ESTABLISH BUCKETS                            
*                                                                               
         ZAP   TOTGRS,BKTGRS            GROSS     -ORDERED                      
         ZAP   TOTGCD,BKTGRS                                                    
         SP    TOTGCD,BKTCD             LESS CD                                 
         ZAP   TOTNCD,BKTNET            NET                                     
         SP    TOTNCD,BKTCD             LESS CD                                 
*                                                                               
         ZAP   TOTPGRS,BKTPGRS          GROSS     -PAID                         
         ZAP   TOTPGCD,BKTPGRS                                                  
         SP    TOTPGCD,BKTPCD           LESS CD                                 
         ZAP   TOTPNCD,BKTPNET          NET                                     
         SP    TOTPNCD,BKTPCD           LESS CD                                 
*                                                                               
         ZAP   TOTBGRS,BKTBGRS          GROSS     -BILLED                       
         ZAP   TOTBGCD,BKTBGRS                                                  
         SP    TOTBGCD,BKTBCD           LESS CD                                 
         ZAP   TOTBNCD,BKTBNET          NET                                     
         SP    TOTBNCD,BKTBCD           LESS CD                                 
*                                                                               
*        CHECK FOR BUCKETS OVER 10 MILLION                                      
*                                                                               
         LA    R7,WKTOTS                                                        
         LA    RF,9                                                             
*                                                                               
EDTCHKLP DS    0H                                                               
*                                                                               
         CP    0(8,R7),=P'1000000000' IF >= 10,000,000.00                       
         BNL   EDTSTG                 USE STAGGERED PRINT ROUTINE               
*                                                                               
EDTCHKCN DS    0H                                                               
         LA    R7,8(R7)            BUMP TO NEXT BUCKET                          
         BCT   RF,EDTCHKLP                                                      
*                                                                               
EDTCHKDN DS    0H                                                               
*                                                                               
*        PRINT WORK TOTALS - NORMAL                                             
*                                                                               
         LA    R7,WKTOTS                                                        
         LA    R8,PLAMTS                                                        
         LA    RF,9                                                             
*                                                                               
EDTLOOP  DS    0H                                                               
*                                                                               
         MVC   WORK(13),=X'40206B2020206B2020214B2020'  EDIT MASK               
         LA    R1,WORK+9           DEFAULT FIRST DIGIT POSITION                 
         EDMK  WORK(13),3(R7)      PRINT BUCKET                                 
*                                                                               
         BCTR  R1,0                BACK UP TO LEADING BLANK                     
*                                                                               
         CP    0(8,R7),=P'0'       IF AMOUNT NEGATIVE                           
         BNL   *+8                                                              
         MVI   0(R1),C'-'             SET LEADING MINUS SIGN                    
*                                                                               
         MVC   0(13,R8),WORK       MOVE RESULT TO PRINT LINE                    
*                                                                               
EDTCONT  DS    0H                                                               
         LA    R7,8(R7)            BUMP TO NEXT BUCKET                          
         LA    R8,13(R8)           BUMP TO NEXT PRINT AREA                      
         BCT   RF,EDTLOOP                                                       
*                                                                               
EDTDONE  DS    0H                                                               
*                                                                               
         B     EDTOTSX                                                          
*                                                                               
*        PRINT WORK TOTALS - STAGGERED                                          
*                                                                               
EDTSTG   DS    0H                                                               
*                                                                               
         ZAP   DUB,LINE            MAKE SURE THERE IS ROOM ON PAGE              
         AP    DUB,=P'2'                                                        
         CP    DUB,MAXLINE                                                      
         BL    *+10                                                             
         ZAP   LINE,=P'75'            FORCE NEW PAGE                            
*                                                                               
         LA    R7,WKTOTS           POINT TO TOTALS                              
         LA    R8,PLSTG1           POINT TO FIRST LARGE PRINT AREA              
         LA    RF,5                FIVE AMOUNTS ON FIRST LINE                   
*                                                                               
EDTSTG1L DS    0H                                                               
*                                                                               
         MVC   WORK(18),=X'4020206B2020206B2020206B2020214B2020'  MASK          
         LA    R1,WORK+14          DEFAULT FIRST DIGIT POSITION                 
         EDMK  WORK(18),1(R7)      PRINT BUCKET                                 
*                                                                               
         BCTR  R1,0                BACK UP TO LEADING BLANK                     
*                                                                               
         CP    0(8,R7),=P'0'       IF AMOUNT NEGATIVE                           
         BNL   *+8                                                              
         MVI   0(R1),C'-'             SET LEADING MINUS SIGN                    
*                                                                               
         MVC   0(17,R8),WORK+1     MOVE RESULT TO PRINT LINE                    
*                                                                               
EDTSTG1C DS    0H                                                               
         LA    R7,16(R7)           BUMP 2 BUCKETS                               
         LA    R8,26(R8)           BUMP TO NEXT PRINT AREA                      
         BCT   RF,EDTSTG1L                                                      
*                                                                               
EDTSTG1D DS    0H                                                               
*                                                                               
         GOTO1 VPRINT              PRINT LINE                                   
*                                                                               
*        PRINT SECOND STAGGERED LINE                                            
*                                                                               
         LA    R7,WKTOTS+8         POINT TOT TOTALS                             
         LA    R8,PLSTG2           POINT TO FIRST LARGE PRINT AREA              
         LA    RF,4                FOUR AMOUNTS ON SECOND LINE                  
*                                                                               
EDTSTG2L DS    0H                                                               
*                                                                               
         MVC   WORK(18),=X'4020206B2020206B2020206B2020214B2020'  MASK          
         LA    R1,WORK+14          DEFAULT FIRST DIGIT POSITION                 
         EDMK  WORK(18),1(R7)      PRINT BUCKET                                 
*                                                                               
         BCTR  R1,0                BACK UP TO LEADING BLANK                     
*                                                                               
         CP    0(8,R7),=P'0'       IF AMOUNT NEGATIVE                           
         BNL   *+8                                                              
         MVI   0(R1),C'-'             SET LEADING MINUS SIGN                    
*                                                                               
         MVC   0(17,R8),WORK+1     MOVE RESULT TO PRINT LINE                    
*                                                                               
EDTSTG2C DS    0H                                                               
         LA    R7,16(R7)           BUMP TWO BUCKETS                             
         LA    R8,26(R8)           BUMP TO NEXT PRINT AREA                      
         BCT   RF,EDTSTG2L                                                      
*                                                                               
EDTSTG2D DS    0H                                                               
*                                                                               
         B     EDTOTSX                                                          
*                                                                               
EDTOTSX  DS    0H                                                               
         J     EXIT                                                             
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - PRLSTS'             
***********************************************************************         
*                                                                     *         
*        PRINT EST/PRD/CLIENT LISTS                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PRLSTS   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
*        PRINT CLIENT LIST                                                      
*                                                                               
         LA    R6,P                ESTABLISH PRINT LINE                         
         USING PLD,R6                                                           
*                                                                               
         L     R4,BSPARS+4         A(START OF TABLE)                            
         ICM   R3,15,BSPARS+8      COUNT                                        
         BNP   PRMTOTX                SKIP IF TABLE EMPTY                       
*                                                                               
         USING CTABD,R4            ESTABLISH CLIENT TABLE ENTRY                 
*                                                                               
PRLSTLP  DS    0H                                                               
*                                                                               
         MVC   PLAGY,OLDAGM        PRINT AGENCY                                 
         MVC   PLMED,OLDAGM+2      PRINT MEDIA                                  
         MVC   PLCLT,CTCLT         PRINT CLIENT                                 
*                                                                               
         LA    R7,CTFTOTS          FORMAT CLIENT FILE TOTALS                    
         BRAS  RE,EDTOTS                                                        
*                                                                               
         GOTO1 VPRINT              PRINT LINE                                   
*                                                                               
         MVC   BBMSG,=C'*BKTS OFF* '  BUCKETS DIFFER FROM FILE TOTALS           
         CLC   CTFTOTS(CTFTOTSL),CTBTOTS  SKIP IF CLIENT FILE TOTALS            
         BE    PRLST20                MATCH BUCKET TOTALS                       
         LA    R7,CTBTOTS             POINT TO  BUCKET TOTALS                   
         BRAS  RE,PRBALER             PRINT UNBALANCED MESSAGE                  
*                                                                               
         LA    R8,RQFILPF4                                                      
*        TM    ANYPF4,HAVEPF4       ALREADY OPENED?                             
*        JNZ   SETRQ12                                                          
*        OPEN  ((R8),OUTPUT)        OPEN FILE                                   
*        OI    ANYPF4,HAVEPF4                                                   
SETRQ12  MVC   REQSTPF4,SPACES      INIT PF4 REQUEST TO SPACES                  
         LA    R7,REQSTPF4                                                      
         USING FQRECORD,R7                                                      
         MVC   FQCODE,=C'F4'        F4 REQUEST                                  
         MVC   FQAGY,OLDAGM         AGENCY                                      
         MVC   FQMED,OLDAGM+2       MEDIA                                       
         MVC   FQCLT,CTCLT          CLIENT                                      
         MVC   FQPRD,=C'ALL'        PRODUCT                                     
         MVC   FQEST,=C'ALL'        ESTIMATE                                    
         PUT   (R8),(R7)                                                        
         DROP  R7                                                               
*                                                                               
*        ROLL CLIENT FILE AND BUCKET TOTALS TO AGY/MED TOTALS                   
*                                                                               
PRLST20  LA    R7,MTOTSF           AGY/MED  TOTALS                              
         LA    R8,CTFTOTS          CLIENT   TOTALS                              
         BRAS  RE,ROLTOT                                                        
*                                                                               
         XC    CTCLT,CTCLT         ERASE CLIENT                                 
*                                                                               
PRLSTCN  DS    0H                                                               
*                                                                               
         A     R4,BSPARS+12        BUMP TO NEXT CLIENT ACCUM - LENGTH           
         BCT   R3,PRLSTLP          NEXT CLT                                     
*                                                                               
PRLSTDN  DS    0H                                                               
*                                                                               
         XC    BSPARS+8(4),BSPARS+8     CLEAR CLIENT TABLE                      
         XC    OLDCLT,OLDCLT                                                    
*                                                                               
*        PRINT AGY/MED TOTALS                                                   
*                                                                               
PRMTOT   DS    0H                                                               
*                                                                               
         GOTO1 VPRINT                                                           
*                                                                               
         MVC   PLAGY(10),=C'*MED TOTS*'  TOTALS TITLE                           
         MVC   PLAGY+1(3),OLDAGM   PRINT AGENCY/MEDIA                           
*                                                                               
         LA    R7,MTOTSF           POINT TO FILE TOTALS                         
         BRAS  RE,EDTOTS           PRINT THEM                                   
         GOTO1 VPRINT                                                           
*                                                                               
         MVC   BBMSG,=C'*TOTS OFF* '                                            
         CLC   MTOTSF(CTFTOTSL),MTOTSB SKIP IF FILE & BKT TOTS AGREE            
         BE    *+12                                                             
         LA    R7,MTOTSB           POINT TO PRODUCT BUCKET TOTALS               
         BRAS  RE,PRBALER                                                       
*                                                                               
         GOTO1 VPRINT              SPACING LINE                                 
*                                                                               
*        ROLL AGY/MED TOTALS TO AGENCY TOTALS                                   
*                                                                               
         LA    R7,ATOTSF           MEDIA TOTALS                                 
         LA    R8,MTOTSF           AGENCY TOTALS                                
         BRAS  RE,ROLTOT                                                        
*                                                                               
PRMTOTX  DS    0H                                                               
*                                                                               
         MVI   OLDAGM+2,0          CLEAR OLD MEDIA                              
*                                                                               
         CLC   OLDAGM(2),0(R2)     SKIP IF AGENCY UNCHANGED                     
         BE    PRATOTX                                                          
*                                                                               
         OC    OLDAGM(2),OLDAGM    SKIP IF NO AGENCY TOTALS                     
         BZ    PRATOT90                                                         
*                                                                               
*        PRINT AGENCY TOTALS                                                    
*                                                                               
         GOTO1 VPRINT                                                           
*                                                                               
         MVC   PLAGY(10),=C'*AG  TOTS*'  TOTALS TITLE                           
         MVC   PLAGY+1(2),OLDAGM   PRINT AGENCY                                 
*                                                                               
         LA    R7,ATOTSF           POINT TO FILE TOTALS                         
         BRAS  RE,EDTOTS           PRINT THEM                                   
         GOTO1 VPRINT                                                           
*                                                                               
         MVC   BBMSG,=C'*TOTS OFF* '                                            
         CLC   ATOTSF(CTFTOTSL),ATOTSB   SKIP IF FILE & BKT TOTS AGREE          
         BE    *+12                                                             
         LA    R7,ATOTSB           PRINT BUCKET TOTALS                          
         BRAS  RE,PRBALER                                                       
*                                                                               
         GOTO1 VPRINT              SPACING LINE                                 
*                                                                               
*        ROLL TO FILE TOTALS                                                    
*                                                                               
         LA    R7,FTOTSF                                                        
         LA    R8,ATOTSF                                                        
         BRAS  RE,ROLTOT                                                        
*                                                                               
PRATOT90 DS    0H                                                               
*                                                                               
         XC    OLDAGM,OLDAGM                                                    
*                                                                               
PRATOTX  DS    0H                                                               
*                                                                               
         CLI   0(R2),X'FF'         IF EOF                                       
         BNE   PRFTOTX                                                          
*                                                                               
         GOTO1 VPRINT                                                           
*                                                                               
         MVC   PLAGY(10),=C'*FILE TOT*'                                         
*                                                                               
         LA    R7,FTOTSF                                                        
         BRAS  RE,EDTOTS                                                        
         GOTO1 VPRINT                                                           
*                                                                               
         MVC   BBMSG,=C'*TOTS OFF* '                                            
         CLC   FTOTSF(CTFTOTSL),FTOTSB TEST TOTALS AGREE                        
         BE    *+12                                                             
         LA    R7,FTOTSB           PRINT FILE BUCKETS                           
         BRAS  RE,PRBALER                                                       
*                                                                               
         GOTO1 VPRINT              SPACING LINE                                 
*                                                                               
         CLI   ERRSW,0             SKIP IF NO ERRORS FOUND                      
         BE    PRFTOTX                                                          
*                                                                               
         GOTO1 VPRINT                                                           
         MVC   P(71),=C'**BALANCE ERRORS HAVE OCCURRED** LOOK FOR "*BKT+        
               S OFF*" IN THIS LISTING.'                                        
         GOTO1 VPRINT                                                           
         GOTO1 VPRINT              BLANK LINE                                   
*                                                                               
PRFTOTX  DS    0H                                                               
*                                                                               
PRLSTSX  DS    0H                                                               
         J     EXIT                                                             
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - PRBALER'            
***********************************************************************         
*                                                                     *         
*        PRINT BALANCING ERROR AND BUCKET TOTALS                      *         
*                                                                     *         
*NTRY    R7==> BUCKET TOTALS                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PRBALER  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   P(11),BBMSG         SET ERROR MESSAGE                            
         MVI   ERRSW,C'Y'          SET ERROR SWITCH                             
*                                                                               
         BRAS  RE,EDTOTS           FORMAT BUCKET TOTALS                         
*                                                                               
         GOTO1 VPRINT              PRINT LINE                                   
*                                                                               
         TM    MSGFLAG,MSGUNBQ     SKIP IF UNBALANCE MSG ALREADY SENT           
         BO    PRBALER1                                                         
*                                                                               
         OI    MSGFLAG,MSGUNBQ     INDICATE UNBALANCE MSG SENT                  
*                                                                               
         MVC   WORK(9),=C'AUTONOTE*'   SEND AUTONOTE VIA DATAMGR                
*                                                                               
         L     R5,=V(EID)           EMAIL ID                                    
         L     R5,12(R5)            A(EMAIL LIST)                               
*                                                                               
         CLC   0(70,R5),SPACES      HAVE ANY EMAIL TO SEND?                     
         BNH   PRBALER1             NO - DONE                                   
*                                                                               
         MVC   WORK+9(70),0(R5)     MOVE THE LIST TO WORK                       
*                                                                               
         LA    R5,WORK+78           POINT TO END OF E-MAIL LIST                 
*                                                                               
         CLI   0(R5),X'40'          LAST CHAR OF E-MAIL LIST?                   
         BH    *+8                  YES                                         
         BCT   R5,*-8               NO - LOOK AT PREVIOUS CHAR                  
*                                                                               
         MVC   1(L'UNBLMSG,R5),UNBLMSG  MOVE IN THE REST OF THE MESSAGE         
         MVC   7(L'SAVEFILE,R5),SAVEFILE FILL IN FILE NAME                      
*                                                                               
         LA    RF,WORK              START OF AUTONOTE                           
         SR    R5,RF                LENGTH OF E-MAIL LIST                       
         AHI   R5,L'UNBLMSG         LENGTH OF REST OF MESSAGE                   
*                                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'OPMSG',((R5),WORK)                           
*                                                                               
PRBALER1 DS    0H                                                               
*                                                                               
PRBALERX DS    0H                                                               
         J     EXIT                                                             
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - ROLTOT'             
***********************************************************************         
*                                                                     *         
*        ROLL TOTALS TO NEXT LEVEL                                    *         
*                                                                     *         
*NTRY    R7==> NEXT LEVEL OF TOTALS                                   *         
*        R8==> CURRENT TOTALS                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ROLTOT   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    R0,CTTOTSNQ         NUMBER OF ACCUMULATORS                       
*                                                                               
ROLTOTLP DS    0H                                                               
*                                                                               
         AP    0(8,R7),0(8,R8)     ROLL ACCUMULATOR                             
         ZAP   0(8,R8),=P'0'       CLEAR OLD ACCUMULATOR                        
*                                                                               
ROLTOTCN DS    0H                                                               
*                                                                               
         LA    R7,8(R7)            BUMP POINTERS                                
         LA    R8,8(R8)                                                         
         BCT   R0,ROLTOTLP         NEXT ACCUMULATOR                             
*                                                                               
ROLTOTDN DS    0H                                                               
*                                                                               
ROLTOTX  DS    0H                                                               
         J     EXIT                                                             
         DROP  RB                                                               
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - GLOBALS'            
***********************************************************************         
*                                                                     *         
*        EDIT OTHER  TOTALS                                           *         
*                                                                     *         
***********************************************************************         
*                                                                               
GLOBALS  DS    0D                                                               
         LTORG                                                                  
*                                  LIST OF AGENCIES TO SKIP                     
SKIPLST  DS    0C                                                               
         DC    C'HDSJSXT1T2Z1Z2Z3Z4Z5Z6ZZXX'                                    
SKIPLN   EQU   (*-SKIPLST)/2                                                    
         EJECT                                                                  
*                                                                               
VPRINT   DC    V(PRINTER)                                                       
VPPBVAL  DC    V(PPBVAL)                                                        
*                                                                               
UNBLMSG  DC    C':PRLD PRINTFIL BUCKET IMBALANCE! SEE SYSPRINT FOR DETA+        
               ILS.'                                                            
*                                                                               
BCKTMSG  DC    C'AUTONOTE*KWAN,DEIS,SKUI:PRLD '                                 
BCKTMSGF DS    CL8                                                              
         DC    C' BAD BUCKET RECORD. '                                          
BCKTMSGA DS    CL2                                                              
         DC    C'/'                                                             
BCKTMSGM DS    C                                                                
         DC    C'/'                                                             
BCKTMSGC DS    CL3                                                              
         DC    C'/'                                                             
BCKTMSGP DS    CL3                                                              
         DC    C'/'                                                             
BCKTMSGE DS    CL3                                                              
BCKTMSGQ EQU   *-BCKTMSG                                                        
*                                                                               
CLTABFL  DC    C'AUTONOTE*KWAN,DEIS,SKUI:**CLIENT TABLE FULL - CLIENT '         
CLTABFLC DS    CL3                                                              
         DC    C' TOTALS NOT INCLUDED**'                                        
CLTABFLQ EQU   *-CLTABFL                                                        
*                                                                               
BBMSG    DS    CL11'*BKTS OFF* '   "*BKTS OFF* " OR "*TOTS* OFF "               
ERRSW    DC    X'00'                                                            
*                                                                               
SAVEFILE DC    CL8' '              FILE NAME SAVEAREA                           
*                                                                               
MSGFLAG  DC    X'00'               FLAGS FOR MESSAGES                           
MSGCLTQ  EQU   X'80'               CLIENT TABLE FULL MSG SENT                   
MSGUNBQ  EQU   X'40'               UNBALANCED        MSG SENT                   
MSGBKTQ  EQU   X'20'               BAD BUCKET RECORD MSG SENT                   
*                                                                               
FRST     DC    X'0'                                                             
OLDAGM   DC    XL3'00'                                                          
OLDCLT   DC    XL3'00'                                                          
*                                                                               
ANYPF4   DS    CL1                 F4 REQUEST FLAG                              
WANTPF4  EQU   X'80'                                                            
HAVEPF4  EQU   X'40'                                                            
*                                                                               
         DS    0D                                                               
MTOTSF   DC    9PL8'0'             AGY/MED TOTALS FOR FILE                      
MTOTSB   DC    9PL8'0'             AGY/MED TOTALS FOR BUCKETS                   
ATOTSF   DC    9PL8'0'             AGENCY  TOTALS FOR FILE                      
ATOTSB   DC    9PL8'0'             AGENCY  TOTALS FOR BUCKETS                   
FTOTSF   DC    9PL8'0'             FILE    TOTALS FOR FILE                      
FTOTSB   DC    9PL8'0'             FILE    TOTALS FOR BUCKETS                   
*                                                                               
BSPARS   DC    6F'0'                                                            
SVTAB    DS    F                                                                
VDATCON  DC    V(DATCON)                                                        
*                                                                               
         SPACE 3                                                                
         DS    0D                  ALIGNMENT                                    
PPBVALC  DC    XL(PPBVALDL)'00'    PPBVAL WORKAREA                              
*                                                                               
***********************************************************************         
*                                                                               
*                                                                               
REQSTPF4 DS    CL80                                                             
         DS    0D                                                               
RQFILPF4 DCB   DDNAME=RQFILPF4,DSORG=PS,RECFM=FB,BLKSIZE=3200,         X        
               LRECL=80,MACRF=PM                                                
*                                                                               
         EJECT                                                                  
*                                                                               
***********************************************************************         
*                                                                               
CTAB     DS    0D                                                               
         ORG   *+CTABDL*CTABMAX                                                 
         DC    X'0000'                                                          
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - WKD'                
***********************************************************************         
*                                                                     *         
*        DSECT FOR WORKING STORAGE                                    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WKD      DSECT                                                                  
DUB      DS    D                                                                
SAVR1    DS    F                                                                
DMCB     DS    6F                                                               
WORK     DS    XL256                                                            
X        DS    XL256                                                            
BYTE     DS    X                                                                
         DS    XL3                 SPARE                                        
WKTOTS   DS    12PL8               SET OF PL8 BUCKETS                           
TEMPTOTS DS    12PL6               TEMPORARY PL6 BUCKETS                        
*                                                                               
       ++INCLUDE PVALUES                                                        
WKDL     EQU   *-WKD               WORKING STORAGE LENGTH                       
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - PLD'                
***********************************************************************         
*                                                                     *         
*        DSECT FOR PRINT LINE                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PLD      DSECT                                                                  
PLAGY    DS    CL2                 AGENCY                                       
         DS    CL3                                                              
PLMED    DS    CL1                 MEDIA                                        
         DS    CL2                                                              
PLCLT    DS    CL3                 CLIENT                                       
         DS    CL4                                                              
*                                                                               
PLAMTS   DS    0CL117              AMOUNTS                                      
         DS    9CL13                                                            
*                                                                               
         ORG   PLD+11                                                           
PLSTG1   DS    CL17                FIRST STAGGERED AMOUNT                       
         ORG   PLD+24                                                           
PLSTG2   DS    CL17                SECOND STAGGERED AMOUNT                      
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - BKSTD'              
***********************************************************************         
*                                                                     *         
*        DSECT FOR BUCKETS                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
BKTSD    DSECT                                                                  
BKTGRS   DS    PL8                 GROSS                                        
BKTNET   DS    PL8                 NET                                          
BKTCD    DS    PL8                 CASH   DISCOUNT                              
BKTPGRS  DS    PL8                 PAID   GROSS                                 
BKTPNET  DS    PL8                 PAID   NET                                   
BKTPCD   DS    PL8                 PAID   CASH DISCOUNT                         
BKTBGRS  DS    PL8                 BILLED GROSS                                 
BKTBNET  DS    PL8                 BILLED NET                                   
BKTBCD   DS    PL8                 BILLED CASH DISCOUNT                         
BKTSL    EQU   *-BKTSD             LENGTH OF BUCKETS                            
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - TOTSD'              
***********************************************************************         
*                                                                     *         
*        DSECT FOR TOTALS                                             *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
TOTSD    DSECT                                                                  
TOTGRS   DS    PL8                 GROSS                                        
TOTGCD   DS    PL8                 GROSS  LESS CD                               
TOTNCD   DS    PL8                 NET    LESS CD                               
TOTPGRS  DS    PL8                 PAID   GROSS                                 
TOTPGCD  DS    PL8                 PAID   GROSS LESS CD                         
TOTPNCD  DS    PL8                 PAID   NET   LESS CD                         
TOTBGRS  DS    PL8                 BILLED GROSS                                 
TOTBGCD  DS    PL8                 BILLED GROSS LESS CD                         
TOTBNCD  DS    PL8                 BILLED NET   LESS CD                         
TOTSL    EQU   *-TOTSD             LENGTH OF TOTALS                             
*                                                                               
         TITLE 'PRLDBALC - LOAD/DUMP - PRINT FILE BALANCE - CTABD'              
***********************************************************************         
*                                                                     *         
*        DSECT FOR CLIENT TABLE                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CTABD    DSECT                                                                  
CTCLT    DS    CL3                 CLIENT                                       
         DS    XL1                 SPARE                                        
CTFTOTS  DS    9PL8                                                             
CTFTOTSL EQU   *-CTFTOTS           LENGTH OF TOTALS                             
CTBTOTS  DS    9PL8                                                             
CTBTOTSL EQU   *-CTBTOTS           LENGTH OF TOTALS                             
CTTOTSNQ EQU   2*(CTFTOTSL/8)      NUMBER OF BUCKETS                            
*                                  LENGTH OF TABLE ENTRY                        
CTABDL   EQU   *-CTABD                                                          
*                                                                               
CTABMAX  EQU   3250                MAX NUMBER OF ENTRIES IN TABLE               
*                                                                               
***********************************************************************         
*                                                                               
FQRECORD DSECT                     SPONSOR STYLE REQUEST CARD                   
FQAREA   DS    0CL80   COLUMN                                                   
FQPROG   DS    0CL2    ------                                                   
FQCODE   DS    CL2        1        PROGRAM CODE                                 
FQAGY    DS    CL2        3        AGENCY CODE                                  
FQMED    DS    CL1        5        MEDIA CODE (R/T)                             
FQCLT    DS    CL3        6        CLIENT CODE                                  
FQDIV    DS    CL3        9                                                     
FQPRD    DS    CL3       12                                                     
FQREG    DS    CL3       15                                                     
FQDST    DS    CL3       18                                                     
FQEST    DS    CL3       21                                                     
FQESTEND DS    CL3       24                                                     
FQPUBALL DS    0CL11     27                                                     
FQPUB    DS    CL8       27                                                     
FQZONE   DS    CL2       35                                                     
FQEDIT   DS    CL1       37                                                     
FQSTART  DS    CL6       38                                                     
FQEND    DS    CL6       44                                                     
*                                                                               
FQBPDATE DS    CL1       50                                                     
FQSORT   DS    CL2       51                                                     
FQPAY    DS    F         53                                                     
FQBILMOD DS    CL1       57                                                     
FQPUBCLA DS    CL2       58                                                     
FQPUBFRE DS    CL1       60                                                     
FQCONTRE DS    CL1       61                                                     
FQOPTION DS    0CL7      62                                                     
FQOPT1   DS    CL1       62                                                     
FQOPT2   DS    CL1       63                                                     
FQOPT3   DS    CL1       64                                                     
FQOPT4   DS    CL1       65                                                     
FQOPT5   DS    CL1       66                                                     
FQOPT6   DS    CL1       67                                                     
FQOPT7   DS    CL1       68                                                     
FQUESTOR DS    CL12      69                                                     
         EJECT                                                                  
*                                                                               
***********************************************************************         
*                                                                               
       ++INCLUDE PRGENFILE                                                      
         EJECT                                                                  
       ++INCLUDE DDDPRINT                                                       
*                                                                               
         EJECT                                                                  
         DSECT                                                                  
       ++INCLUDE PPBVALD                                                        
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'033PRLDBALC  10/31/19'                                      
         END                                                                    

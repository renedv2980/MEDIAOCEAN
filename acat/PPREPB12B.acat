*          DATA SET PPREPB12B  AT LEVEL 031 AS OF 05/01/02                      
*CATALP PPB12B                                                                  
         TITLE 'RMBILL - READ OLD MANUAL BILLS'                                 
***********************************************************************         
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                 *** THIS MODULE IS DEAD ***                                   
*                                                                               
*                                                                               
*              IT HAS BEEN REPLACED BY PPREPB102                                
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
***********************************************************************         
* CHANGE LOG                                                                    
*                                                                               
*  BPLA   10/00    INCREASE VALUES IN CKMAX TO                                  
*                  REFLECT CHANGE TO PL6   $999,999,999.99                      
*                                                                               
*  BPLA   08/00    COPY OF PPREPB12B AT LEVEL 17 7/24/00                        
*                  COPY MADE 8/16/00                                            
*                  CHANGES TO CATALP AND PPREPB1WKN                             
*                  (WHICH INCLUDES PNNEWFILE IN PLACE OF                        
*                  PPNEWFILE)                                                   
*                  PNNEWFILE INCLUDES PNBILREC IN PLACE                         
*                  OF PBILLREC                                                  
*            ALSO  OTHER CHANGES  - LOOK FOR **BIG                              
*                                                                               
*  BPLA    7/00  WHEN PRINTING REGISTER - CHECK AGYXTBL                         
*                TO SEE IF I SHOULD DISPLAY COST2 OR OPEN                       
*                                                                               
*  BPLA    4/00  DIE IF AMOUNT EXCEEDS CAPACITY OF PL5                          
*                BILL REC FIELDS                                                
*                                                                               
*  BPLA    6/99  CHANGES FOR COST2                                              
*                                                                               
*  BPLA    6/99  COPY OF PPB12B AT LEVEL 6 MADE 6/15/99                         
*                                                                               
*  BPLA   10/98  RENAMED FROM PPB12BE                                           
*                                                                               
*  BPLA   1/98 PPB12B AT LEVEL 14 COPIED 1/12/98                                
*              CHANGES FOR EDI BILLING - SEE **EDI**                            
*                                                                               
*  BPLA  12/97 ADD DUMMY CSECT AT END (TO GET BOOK= MESSAGE)                    
*                                                                               
*  BPLA 12/97 DO NOT ATTEMPT TO READ FOR PRIOR MANUAL                           
*             BILLS IF REQUEST ID FOR ONE PUB                                   
*             SINCE THE CREDITS FOR THE PREVIOUS MANUAL                         
*             BILL WILL BE ON A SEPERATE INVOICE                                
*             THERE IS THE POTENTIAL WNBILL TO                                  
*             SKIP A PEPTAB ENTRY (SINCE PEPTSTAT IS X'40')                     
*             IF THE PEPTAB KEY IS THE SAME.                                    
*             THIS FINALLY HAPPENED ON 12/17/97 FOR MKTOA                       
*                                                                               
*                                                                               
*  BPLA 5/97  FIX CHECK FOR FINANCIAL BILLS IN REGISTER                         
*             SOME MAY HAVE SALES TAX IN WHICH CASE                             
*             THE ELEMENT LENGTH WILL BE 32 (X'20) NOT 30 (X'1E')               
*                                                                               
*  BPLA 9/96     PPB12BO SOURCE MADE LIVE - NOW INCLUDES PPREPB1WRK             
*                NEEDS PPB1ACC                                                  
*                                                                               
*  BPLA 4/96     CHANGES FOR ZENITH - MOLSON                                    
*                                                                               
*  BPLA 7/95     SAVE SVINVMO IN PBILLREC AT PBILIMO                            
*                THIS FIELD WAS PBILESTS (START EST FOR EST RANGE-ONLY          
*                USED BY "OLD" BILLING)                                         
*                                                                               
* BPLA 3/95       INCORPORATE INVREG CHANGES FROM PPB12BR                       
*                 (LEVEL 10 - 2/21/95)                                          
*                 FIXES PROBLEM OF AMOUNTS OVER 21 MILLION                      
*                 BY SWITCHING TO PL8 ACCUMULATORS                              
*                                                                               
* BPLA 7/14/94    FIX BUG IN WNBILL - AT WN64C                                  
*                 NEW PEPTAB KEY CHANGE                                         
*                                                                               
* BPLA 6/94       STORE FINANSW IN PEPTAB (PEPTFIN)                             
*                 AND CHECK IT WHEN WRITING THE BILLS                           
*                                                                               
* BPLA 5/94       CHECK FOR PBILOTH ELEM BEFORE CHECKING                        
*                 PBILLIND (FINANCIAL IND)                                      
*                                                                               
* BPLA 1/94       CHANGES FOR PST                                               
*                                                                               
* BPLA 10/5/93    CHANGES FOR NEW CDSEP OPTION -'R' - SPECIAL                   
*                 CD HANDLING WITH 'APPLY' MESSAGES                             
*                                                                               
* BPLA 1/11/93    CHANGE TO ALLOW CD SEP BILL WITH UFC COMMISSION               
*                 BILL                                                          
* BPLA 10/13/92   USE PPBVAL IN INVREG (INVOICE REGISTER)                       
*                                                                               
* BPLA 6/16/92  NET INDICATOR IN PBILCMSW  NO COMMISSION ONLY                   
*            INDICATOR FOR UPFRONT COMMISSION BILL, AOR BIT                     
*            ON NET BILL (IF AOR EVEN THOUGH NO AOR BILL IS PRODUCED)           
*            SPECIAL TREATMENT OF UFC BILLS IN REGISTER.                        
*                                                                               
* BPLA 4/29/92  CHANGES FOR COMMISSION BILLING                                  
*                                                                               
* BPLA 4/20/92  COPY OF PPB12BL                                                 
*                                                                               
* BPLA 4/15/92  CHANGE CHECK OF PCTCTL IN RMBILL FROM "N" TO "F"                
*               SO THAT I ONLY READ OLD MANUAL BILLS WITH A                     
*               MANPCT IF I'M NOT APPLING THE PERCENTAGE TO                     
*               PREVIOUS BILLING                                                
* BPLA 4/1/92   READ OLD MANUAL BILLS - EVEN IF MANPCT IS NOT ZERO              
*               BUT SKIP IF PCTCTL IS "N"                                       
* BPLA 1/15/92  CLEAR END OF RECORD IN INVREG                                   
*                                                                               
* BPLA 11/27/91 DON'T READ MANUAL BILLS IF DOING A PERCENTAGE                   
*               BILL - IT WON'T GET CERDITED PROPERLY AND CAUSES                
*               AN IMBALANCE.                                                   
* BPLA 10/1/91 SET AOR INDICATOR IN SEPERATE COMM. AND CD BILLS                 
*                                                                               
* BPLA 7/10/91 IN WBILL (WB6)  CHECK FOR AOR ACCOUNT INSTEAD OF                 
*              AOR AMOUNT WHEN SETTING ON X'10' IN PBILCMSW                     
* BPLA 6/20/91 IN WBILL (WB6C) CONDITIONALLY SET ON X'04'                       
*              IN PBILCMSW (SUBTRACT TAX FROM AOR BASIS)                        
* BPLA         BUG FIXED IN WNBILL (WN64C)  WAS ST  R0,X+20 SHOULD              
*              HAVE BEEN 20(R2)                                                 
* BPLA 6/14/91 STORE TAX IN PBILLTAX (IN PBILOTH ELEMENT)                       
*                                                                               
* BPLA 5/16/91 AOR KILL DATE AND VAT CODE                                       
*                                                                               
* BPLA 3/26/91 DRAFT REBATE BILLING (RD)                                        
*                                                                               
* BPLA 3/12/91 GRANT'S AOR FEATURES                                             
*                                                                               
* BPLA 2/1/91    IN INVREG ADD GST TO X+8 (BILL AMOUNT)                         
*                                                                               
         PRINT NOGEN                                                            
RMBILL   CSECT                                                                  
         NMOD1 0,RMBILL                                                         
         USING PPWORKD,RA                                                       
         USING PPWORK2D,R9                                                      
         USING BILWRKD,RC                                                       
         LA    RC,SPACEND                                                       
***E***                                                                         
         CLC   QPROG,=C'E1'       NO READING FOR ESTIMATES                      
         BE    RMBX                                                             
*                                                                               
         CLI   QPUB,C' '          SEE IF FOR ONE PUB                            
         BH    RMBX               DON'T READ FOR PRIOR MANUAL BILLS             
*                                 IT CAN CAUSE PROBLEMS                         
***E***                                                                         
***R***                                                                         
         CLC   QPROG,=C'R1'       NO MANUAL BILLS FOR REBATES                   
         BE    RMBX                                                             
         CLC   QPROG,=C'RD'       NO MANUAL BILLS FOR REBATES DRAFT             
         BE    RMBX                                                             
***R***                                                                         
         OC   MANGRS(12),MANGRS   SEE IF MANUAL BILL                            
         BNZ   RMBX              YES - SKIP READ OF OLD MANUAL BILLS            
         CLI   QMANUAL,C'G'       DOUBLE CHECK FOR MANUAL BILL                  
         BE    RMBX                                                             
         CLI   QMANUAL,C'F'                                                     
         BE    RMBX                                                             
*                                                                               
         OC    MANPCT,MANPCT      SEE IF PERCENTAGE BILL                        
         BZ    RMB2                                                             
         CLI   PCTCTL,C'F' SEE IF NOT APPLING PCT TO PREVIOUS BILLING           
         BNE   RMBX       OTHERWISE SKIP READ OF OLD MANUAL BILLS               
*                                                                               
RMB2     CLI   FINANSW,0         SEE IF FINANCIAL CLIENT                        
         BNE   RMBX              YES - THEN CAN NOT HAVE MANUAL BILLS           
*                                                                               
*              PASS AS DUMMY BUYS TO APRBUY                                     
*                                                                               
         NI    DMINBTS,X'F7'       SET FOR NO DELETES                           
*                                                                               
         XC    KEY,KEY                                                          
         L     RF,ADPRD                                                         
         MVC   KEY(10),0(RF)                                                    
         MVI   KEY+3,X'02'                                                      
         L     RE,ADCLT                                                         
         CLC   KEY(7),0(RE)       SEE IF PRD FOR MY CLIENT                      
         BNE   RMBX               NO - SKIP READ OF MANUALS                     
*                                 SINCE I MAY GET HERE FROM                     
*                                 PRDLAST EVEN WITH NO BUYS READ                
         MVI   KEY+3,X'88'                                                      
         GOTO1 HIGH                                                             
         B     RMB5                                                             
RMB3     GOTO1 SEQ                                                              
RMB5     CLC   KEY(10),KEYSAVE                                                  
         BNE   RMBX                                                             
         CLI   QEST,C' '                                                        
         BE    RMB5F                                                            
         CLC   QEST,=C'ALL'                                                     
         BE    RMB5F                                                            
         CLC   KEY+10(2),BQEST                                                  
         BL    RMB3                                                             
         BE    RMB5W                                                            
         CLC   QESTEND,C' '                                                     
         BE    RMB3                                                             
         CLC   KEY+10(2),BQESTEND        RANGE OF ESTS                          
         BH    RMBX                                                             
         B     RMB5W                                                            
*                                                                               
RMB5F    CLC   QESTEND,SPACES            SEE IF FILTER SPECIFIED                
         BE    RMB5W                     NO                                     
         L     R7,ADEST                                                         
         USING PESTREC,R7                                                       
         MVC   SVRMKEY,KEY                                                      
         XC    KEY+12(12),KEY+12                                                
         MVI   KEY+3,X'07'                                                      
         CLC   KEY(12),PESTKEY                                                  
         BE    RMB5H                                                            
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
RMB5H    MVC   KEY(64),SVRMKEY    RESTORE KEY AND KEYSAVE                       
         GOTO1 HIGH                                                             
*                                                                               
         LA    RE,QESTEND                                                       
         LA    RF,PESTGRPS                                                      
         LA    R0,3                                                             
*                                                                               
RMB5H5   DS    0H                                                               
         CLI   0(RE),C'*'                                                       
         BE    RMB5H8                                                           
         CLI   0(RE),C' '                                                       
         BE    RMB5H8                                                           
         TM    0(RE),X'40'        TEST NEGATIVE FILTER                          
         BZ    RMB5H7                                                           
         CLC   0(1,RE),0(RF)                                                    
         BNE   RMB3               SKIP THIS BILL                                
         B     RMB5H8                                                           
*                                                                               
RMB5H7   MVC   DUB(1),0(RE)        NEGATIVE FILTER                              
         OI    DUB,X'40'                                                        
         CLC   DUB(1),0(RF)                                                     
         BE    RMB3                SKIP THIS BILL                               
*                                                                               
RMB5H8   LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,RMB5H5           GO DO NEXT FILTER                            
*                                                                               
         DROP  R7                                                               
*                                                                               
RMB5W    GOTO1 GETBILL                                                          
         L     R7,ADBILL                                                        
         USING PBILLREC,R7                                                      
*                                                                               
         CLI   SCBNCSW,C'C'        SEE IF COMMISSION BILLING                    
         BNE   RMB5W4                                                           
         TM    PBILCMSW,BSTSCOMQ                                                
         BNO   RMB3                ONLY READ MANUAL COMMISSION BILLS            
*                                                                               
RMB5W4   OC    MANRVNO,MANRVNO     SEE IF DOING MANUAL REVERSAL                 
         BNZ   RMB5X5              YES - MUST MATCH                             
RMB5X    CLC   PBILMCAN,ZEROS      SEE IF THIS BILL WAS 'REBILLED'              
         BE    RMB6                NO - OK TO PROCESS                           
         B     RMB3                YES - SKIP                                   
*                                                                               
RMB5X5   LH    R0,MANRVNO                                                       
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(4),DUB                                                      
         CLC   PBILMCAN+2(4),WORK  CHK RIGHT INV NO                             
         BNE   RMB3                                                             
         GOTO1 DATCON,DMCB,(3,MANRVDTP),(0,WORK)                                
         CLC   PBILMCAN(2),WORK+2  MONTH                                        
         BNE   RMB3                                                             
         CLC   PBILMDAT,WORK       CHK RIGHT DATE                               
         BNE   RMB3                                                             
*              ATTEMPT TO REVERSE A 'REBILLED' OLD MANUAL BILL                  
*                                  NOT ABLE TO HANDLE                           
*                                  AS I WOULD NOT BE ABLE TO UNBILL             
*                                  AND A8 WOULD BE OUT OF BALANCE               
         GOTO1 BUFFALO,DMCB,=C'RESET',ABUFFC                                    
*                                                                               
         OI    DMINBTS,X'08'       RESET TO PASS DELETES                        
         MVI   ERR,11              SET ERRCODE                                  
         GOTO1 AERRPROC                                                         
*              CAN'T DO SINCE MANUAL MUST STILL BE MARKED "REVERSED"            
*              BY ORIGINAL BILL SO I CAN'T RESET PBILMCAN TO ZEROS              
*              OR TO THE REVERSALS DATE AND INVOICE NUMBER                      
*              FOR NOW THEY MUST STILL UNBILL                                   
*                                                                               
*                                  NO - SET UP DUMMY BUY AND POST IT            
RMB6     L     RF,ADWKREC                                                       
         XC    0(250,RF),0(RF)                                                  
         USING PBUYREC,RF                                                       
         MVC   PBUYKCLT,PBILKCLT                                                
         MVI   PBUYKRCD,X'88'      SET SPECIAL RECORD CODE                      
         MVC   PBUYKPRD,PBILKPRD                                                
         MVC   PBUYKEST,PBILKEST                                                
         MVC   PBUYKPUB(6),XXPUB                                                
         MVC   PBDELEM(2),=X'2074'                                              
         MVC   PBDBDATE(2),PBILKMOS                                             
         MVI   PBDBDATE+2,X'01'                                                 
*                                                                               
*                                     SAVE INVOICE NUMBER AND MONTH             
*                                     IN PBDPDATE - SO I CAN DISPLAY            
*                                     THEM IN LDESC (IN PPB12C)                 
*                                     IN PRBUY THESE FIELDS ARE PUT             
*                                     AFTER X'FC' IN ADESC                      
*                                                                               
         MVC   PBDPDATE(2),PBILKBNO   INVOICE NUMBER                            
         MVC   PBDPDATE+2(1),PBILKBMN+1   BILLING MONTH                         
*                                                                               
*              USED WITH PBDBDATE IN PRBUY TO INSURE                            
*              UNIQUE DECSRIPTIONS                                              
*                                                                               
         ZAP   DUB,PBILLGRS                                                     
         CVB   R0,DUB                                                           
         ST    R0,BGROSS                                                        
         ZAP   DUB,PBILLBIL        GR-CD                                        
         CVB   R1,DUB                                                           
         SR    R0,R1                                                            
         ST    R0,BCSHDSC                                                       
         ZAP   DUB,PBILLNET                                                     
         CVB   R1,DUB        GR-AC-CD                                           
         AR    R1,R0          RE-ADD CD - R1 NOW GR-AC                          
         ZAP   DUB,PBILLGRS                                                     
         CVB   R0,DUB                                                           
         SR    R0,R1                                                            
         ST    R0,BAGYCOM                                                       
         XC    GROSS(12),GROSS     NO ORDERED                                   
         XC    PGROSS(12),PGROSS     NO ORDERED                                 
*                                                                               
*              SET UP DUMMY BILLELEM                                            
*                                                                               
         MVC   PBDELEM+116(2),=X'2617'                                          
         MVC   PBDELEM+116+2(3),PBILKPRD                                        
         GOTO1 DATCON,DMCB,PBILLDAT,(3,WORK)                                    
         L     RF,ADWKREC                                                       
         MVC   PBDELEM+116+5(3),WORK                                            
         MVC   PBDELEM+116+8(2),PBILKBNO                                        
         MVC   PBDELEM+116+11(12),BGROSS                                        
         OC    MANRVNO,MANRVNO      SEE IF DOING MANUAL REVERSAL                
         BZ    RMB9                                                             
*                                   YES - MUST SET DATE AND INV NO              
*                                   SO PRBUY WILL PROCESS                       
*                                   ALSO COMPLEMENT BGROSS(12)                  
*                                                                               
*                                                                               
         MVC   PBDELEM+116+5(3),MANRVDTP                                        
         MVC   PBDELEM+116+8(2),MANRVNO                                         
         L     R0,BGROSS                                                        
         LCR   R0,R0                                                            
         ST    R0,BGROSS                                                        
         L     R0,BGROSS+4                                                      
         LCR   R0,R0                                                            
         ST    R0,BGROSS+4                                                      
         L     R0,BGROSS+8                                                      
         LCR   R0,R0                                                            
         ST    R0,BGROSS+8                                                      
         MVC   PBDELEM+116+11(12),BGROSS                                        
*                                                                               
*                                                                               
RMB9     MVC   SAVR1,ADBUY         SAVE REAL ADDR OF PBUYREC                    
         MVC   ADBUY,ADWKREC      FOOL PRBUY                                    
         MVI   PUBSW,0    SO PRBUY WILL ALWAYS PROCESS THESE                    
*                                  'DUMMY' INSERTIONS                           
         GOTO1 APRBUY              PROCESS MANUAL AS DUMMY BUYS                 
         MVC   ADBUY,SAVR1         RESTORE REAL ADDR OF PBUYREC                 
         B     RMB3                GO DO NEXT MANUAL BILL                       
*                                                                               
RMBX     OI    DMINBTS,X'08'     RESET TO PASS DELETES                          
         XIT1                                                                   
         SPACE 3                                                                
*                                                                               
SVRMKEY  DS    CL64                                                             
*                                                                               
         LTORG                                                                  
         TITLE 'WNBILL - WRITE NEW BILL RECORDS'                                
WNBILL   CSECT                                                                  
         NMOD1 0,WNBILL                                                         
         USING PPWORKD,RA                                                       
         USING PPWORK2D,R9                                                      
         USING BILWRKD,RC                                                       
         LA    RC,SPACEND                                                       
         SPACE 2                                                                
         MVC   SAVR1,DMCB+3        SAVE CALLING CODE                            
*                                                                               
         CLI   PASSNO,1            ONLY FOR PASS 1                              
         BNE   WNEXT                                                            
         CLI   SORTTRCE,C'Y'                                                    
         BNE   WN1                                                              
*                                                                               
         MVC   P1+1(6),=C'WNBILL'                                               
         GOTO1 APRNT                                                            
WN1      DS    0H                                                               
         CLI   UPASS,C'T'          SKIP FOR RETAIL TEST PASS                    
         BE    WNEXT                                                            
*                                                                               
         CLI   SAVR1,1             JUST POSTING TO PEP TAB                      
         BE    WN50                                                             
*                                  MARKING MANUAL BILLS                         
*                                                                               
         L     R4,ASORTDTA                                                      
         OC    0(ROWTL,R4),0(R4)         NO $  (WAS ROW2L)                      
         BNZ   WN8                                                              
         CLI   ZEROSW,C'Y'                                                      
         BNE   WNEXT                                                            
*                                                                               
WN8      DS    0H                                                               
*                                       ADD TO PRD-EST-PER TAB                  
WN50     DS    0H                                                               
         L     R4,BRKCODE-BRKTABD(R3)   R3 POINTS TO BRK LEVEL                  
         L     R4,ATOTS(R4)      POINT TO ACCUM                                 
         LA    R5,PERLIST          DATE LIST                                    
*                                                                               
WN58     DS    0H                                                               
         CLI   0(R5),0             SKIP NON-EXISTENT MONTHS                     
         BE    WN69                                                             
         CLI   0(R5),X'FF'                                                      
         BE    WN69                                                             
         OC    0(ROWTL,R4),0(R4)        NO $  (WAS ROWL)                        
         BNZ   WN58A                                                            
         CLI   ZEROSW,C'Y'                                                      
         BNE   WN69                                                             
*                                                                               
WN58A    DS    0H                                                               
         LR    R3,R4                                                            
WN58B    DS    0H                                                               
         LR    RF,R3                                                            
         CLC   0(ROWHL,RF),ROWHL(RF)   NO $                                     
         BNE   WN58D                                                            
         CLC   ROWTL(ROWHL,RF),ROWTL+ROWHL(RF)    CHK OPEN $                    
         BNE   WN58D                                                            
         CLI   ZEROSW,C'Y'                                                      
         BNE   WN68                                                             
*                                                                               
WN58D    DS    0H                                                               
         LA    R2,W                                                             
         LA    R0,5                BCT   NOW 5 TO INCLUDE TAX                   
WN59     DS    0H                                                               
         L     R1,0(RF)                 ORD                                     
         S     R1,ROWHL(RF)        LESS BILLED                                  
         ST    R1,0(R2)                                                         
         LA    R2,4(R2)                                                         
         LA    RF,4(RF)                                                         
         BCT   R0,WN59                                                          
*                                                                               
         LA    R2,W+20             FOR OPEN AMOUNTS                             
         LA    R0,4                BCT                                          
         LR    RF,R3               RESET TO START OF ACCUM                      
         LA    RF,ROWTL(RF)                                                     
WN62     DS    0H                                                               
         L     R1,0(RF)               ORD                                       
         S     R1,ROWHL(RF)        LESS BILLED                                  
         ST    R1,0(R2)                                                         
         LA    R2,4(R2)                                                         
         LA    RF,4(RF)                                                         
         BCT   R0,WN62                                                          
*                                                                               
*                                                                               
         L     R0,=V(PEPTWRK)      CLEAR PEPTAB WORK AREA                       
         A     R0,RELO                                                          
         LA    R1,PEPTABRL                                                      
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,=V(PEPTWRK)                                                   
         A     RE,RELO                                                          
         USING PEPTD,RE                                                         
         OC    AMED,AMED                                                        
         BZ    WN64                                                             
         L     RF,AMED                                                          
         MVC   PEPTMED,0(RF)                                                    
WN64     L     RF,APRD                                                          
         MVC   PEPTPRD,0(RF)       PRD                                          
         L     RF,AEST                                                          
         MVC   PEPTEST,0(RF)       EST                                          
**JOB                                                                           
         MVI   PEPTFIN,0                                                        
         CLI   FINANSW,0           SEE IF DOING FINANCIAL CLIENT                
         BE    WN64C               NO                                           
         MVC   PEPTFIN,FINANSW     SET FINANCIAL IND INTO PEPTAB                
*                                                                               
         OC    AJOB,AJOB           SEE IF DOINGS JOBS                           
         BZ    WN64C                                                            
         L     RF,AJOB                                                          
         MVC   PEPTJOB,3(RF)       DON'T MOVE PRODUCT                           
*                                                                               
*        ABOVE CODE IS SPECIAL FOR FINANCIAL CLIENTS                            
*        SHOULD WORK SINCE FOR DOREMUS ALWAYS BILLS BY                          
*        JOB AND USES ONE JOB FOR EACH ESTIMATE                                 
*        THIS CODE ADDED TO PUT JOB IN PEPTAB SO THEY                           
*        CAN REBATE JOBS TOGETHER                                               
*        SHOULD STILL WORK FOR THEIR REGULAR BILLING ALSO                       
*                                                                               
WN64C    MVC   PEPTMOS,0(R5)        Y/M                                         
         MVC   PEPTGRS(16),W        GROSS AND NET AND CD AND AC                 
         MVC   PEPTTAX(4),W+16      TAX NOW IN PEPTAB  (CONTRACT)               
         MVC   PEPTOGRS(16),W+20    OPEN GROSS AND NET AND CD AND AC            
         DROP  RE                                                               
*                                                                               
         L     RF,=V(PEPTWRK)                                                   
         A     RF,RELO                                                          
         GOTO1 BINSRCH,PEPPARS,(1,(RF))                                         
         OC    1(3,R1),1(R1)                                                    
         BNZ   *+6                                                              
         DC    H'0'                TABLE FULL                                   
         CLI   0(R1),1                                                          
         BE    WN68                                                             
*                                  ADD TOTALS IN                                
         L     RF,=V(PEPTWRK)                                                   
         A     RF,RELO                                                          
         MVC   X(64),0(RF)                                                      
*                                                                               
         L     R2,0(R1)                                                         
         L     R0,12(R2)                                                        
         A     R0,X+12             GROSS                                        
         ST    R0,12(R2)                                                        
         L     R0,16(R2)                                                        
         A     R0,X+16             NET                                          
         ST    R0,16(R2)                                                        
         L     R0,20(R2)                                                        
         A     R0,X+20             CD                                           
         ST    R0,20(R2)                                                        
         L     R0,24(R2)           AC                                           
         A     R0,X+24                                                          
         ST    R0,24(R2)                                                        
*                                                                               
         L     R0,36(R2)                                                        
         A     R0,X+36             OPEN GROSS                                   
         ST    R0,36(R2)                                                        
         L     R0,40(R2)                                                        
         A     R0,X+40             OPEN NET                                     
         ST    R0,40(R2)                                                        
         L     R0,44(R2)                                                        
         A     R0,X+44             CD (REALLY CONTRACT)                         
         ST    R0,44(R2)                                                        
         L     R0,48(R2)                                                        
         A     R0,X+48             AC                                           
         ST    R0,48(R2)                                                        
*                                                                               
         L     R0,60(R2)                                                        
         A     R0,X+60             TAX                                          
         ST    R0,60(R2)                                                        
*                                                                               
WN68     DS    0H                                                               
*                                                                               
WN69     DS    0H                                                               
         LA    R4,ROWL(R4)         NEXT MONTH                                   
         LA    R5,8(R5)                                                         
         LA    R0,PERLIST+8*MAXMOS                                              
         CR    R5,R0                                                            
         BL    WN58                                                             
*                                                                               
WNEXT    DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
         LTORG                                                                  
         TITLE 'WBILL - WRITE BILL RECS'                                        
         SPACE 2                                                                
WBILL    CSECT                                                                  
         NMOD1 0,WBILL                                                          
         LA    RC,SPACEND                                                       
         SPACE 2                                                                
         CLI   UPASS,C'T'          SKIP FOR TEST PASS                           
         BE    WBILLX                                                           
***E***                                                                         
         CLC   QPROG,=C'E1'          WRITE NO BILLS FOR ESTIMATES               
         BE    WBILLX                                                           
***E***                                                                         
         CLI   SORTTRCE,C'B'      BILL TRACE ONLY                               
         BE    WB0                                                              
         CLI   SORTTRCE,C'Y'                                                    
         BNE   WB1                                                              
WB0      DS    0H                                                               
         MVC   P1+1(14),=C'WRITE OLD BILL'                                      
         GOTO1 APRNT                                                            
WB1      DS    0H                                                               
         L     R7,ADBILL                                                        
         USING PBILLREC,R7                                                      
*                                                                               
         XC    PBILLREC(255),PBILLREC                                           
**BIG                                                                           
         XC    PBILLREC+255(70),PBILLREC+255                                    
**BIG                                                                           
         L     RF,ADCLT                                                         
         MVC   PBILLREC(7),0(RF)   AGY,MED,CLT                                  
         MVI   PBILLREC+3,X'08'                                                 
         MVC   PBILKBMN,TODAYB     YEAR MONTH                                   
         MVC   PBILKBNO,INVNO                                                   
******** MVC   PBILLLEN,=H'103'                                                 
******** MVC   PBILLEL(2),=X'0846'    ELEM CODE +LENGHT                         
**BIG                                                                           
         MVC   PBILLLEN,=H'133'                                                 
         MVC   PBILLEL(2),=X'0864'    ELEM CODE +LENGHT                         
**BIG                                                                           
*                                                                               
WB1C     MVC   PBILLDAT,TODAY                                                   
         MVI   PBILSEP,C'R'        SET FOR REGULAR                              
         MVI   PBILLTYP,C'B'                                                    
         OC   MANGRS(12),MANGRS                                                 
         BZ    *+8                                                              
         MVI   PBILLTYP,C'M'        NEW MANUAL BILL                             
         MVC   PBILLTYP+1(1),TYPE                                               
***R***                                                                         
         CLC   QPROG,=C'R1'          FINANCIAL REBATE BILL                      
         BNE   *+8                                                              
         MVI   PBILLTYP,C'R'                                                    
         CLC   QPROG,=C'RD'          FINANCIAL REBATE BILL DRAFT                
         BNE   *+8                                                              
         MVI   PBILLTYP,C'R'                                                    
***R***                                                                         
WB1E     MVC   PBILLCAN(12),ZEROS                                               
*                                                                               
*                                                                               
         MVC   PBILINVD,BINVDTE                                                 
*                                                                               
         MVC   PBILIMO,SVINVMO   INV MONTH - AS DISPLAYED                       
*                              SVINVMO GET SET BY PPFMTINO IN GETNUM            
*                                                                               
         MVC   PBILDUED,BDUEDTE                                                 
*                                                                               
*                             CREATE BILLS FROM PRD-EST-PER TABLE               
         L     R4,PEPPARS+4        A(TABLE)                                     
**NEW 10/18/89                                                                  
         USING PEPTD,R4                                                         
**NEW 10/18/89                                                                  
         L     R6,PEPTABN          FOR BCT                                      
         LTR   R6,R6                                                            
         BNZ   WB4                                                              
         CLI   UPASS,C'S'          OK IF CORP SUMMARY BILL                      
         BE    WBILLX                                                           
         DC    H'0'                                                             
*                                                                               
WB4      DS    0H                                                               
*                                                                               
**NEW 3/12/91                                                                   
         CLI   DUESW,C'R'          SEE IF AOR OR ADJ SEP OR CD SEP              
         BE    WB4C                                                             
         CLI   DUESW,C'A'                                                       
***NEW 5/16/91                                                                  
         BE    WB4A                                                             
***NEW 5/16/91                    WAS BE  WB4C                                  
         CLI   DUESW,C'C'                                                       
         BE    WB4C                                                             
         TM    PEPTSTAT,X'40'                                                   
         BNZ   WB8B5              SKIP TO NEXT PEPTAB ENTRY                     
         OI    PEPTSTAT,X'40'                                                   
***NEW 5/16/91                                                                  
         B     WB4C                                                             
*                                                                               
WB4A     TM    PEPTSTAT,X'20'      TEST ALREADY DONE                            
         BNZ   WB8B5               YES, SKIP                                    
         OI    PEPTSTAT,X'20'                                                   
         B     WB4C                                                             
***NEW 5/16/91                                                                  
**NEW 3/12/91                                                                   
*                                                                               
*                                  PRODUCT CODE                                 
WB4C     MVI   PBILLREC+3,X'08'    MUST RESET FOR MANUALS                       
         CLI   PEPTMED,0           SEE IF MEDIA IN PEPTAB                       
         BE    *+10                                                             
         MVC   PBILKMED,PEPTMED                                                 
         MVC   PBILKPRD,PEPTPRD                                                 
*                                                                               
         MVC   PBILKEST,PEPTEST    EST                                          
         MVC   PBILKMOS,PEPTMOS    MOS                                          
         CLI   PEPTFIN,0           SEE IF FINANCIAL CLIENT                      
         BE    WB4C5                                                            
******   MVC   PBILLLEN,=H'133'                                                 
**BIG                                                                           
         MVC   PBILLLEN,=H'163'      133+30                                     
**BIG                                                                           
         MVC   PBILOTH(2),=X'091E'    NEW ELEM CODE +LENGHT                     
         MVC   PBILLIND,PEPTFIN       SET PEPTFIN INTO PBILLREC                 
         ZAP   PBILLOPG,=P'0'                                                   
         ZAP   PBILLOPN,=P'0'                                                   
         ZAP   PBILLCNR,=P'0'                                                   
*                                                                               
WB4C5    MVI   PBILCMSW,0                                                       
         MVI   PBILCDSW,C'R'    SET FOR REGULAR CD HANDLING                     
         CLI   CDSEP,C'N'                                                       
         BE    WB5                                                              
         MVI   PBILCDSW,C'S'    SEPERATE CD INV                                 
         CLI   CDSEP,C'Y'                                                       
         BE    WB5                                                              
         MVI   PBILCDSW,C'C'     FOR 'C' - SPECIAL CD HANDLING                  
         CLI   CDSEP,C'C'                                                       
         BE    WB5                                                              
*                                                                               
         CLI   CDSEP,C'R'        ALSO SPECIAL CD HANDLING                       
         BE    WB5                                                              
*                                                                               
         MVI   PBILCDSW,C'N'     MUST BE NO CD                                  
*                                                                               
WB5      MVI   PBRETAIL,0                                                       
         MVC   PBILBASA(5),PEPTBILF  BILL FORMULA                               
         MVC   PBILLCAN(12),ZEROS                                               
         OC   MANGRS(12),MANGRS                                                 
         BNZ   WB6                 IF MANUAL LEAVE AS ZEROS                     
         XC    PNBPGR1,PNBPGR1                                                  
         XC    PNBMGR1,PNBMGR1                                                  
         XC    PNBMGR2,PNBMGR2                                                  
*                                                                               
WB6      TM    PEPTSTAT,X'80'      TEST COMM ONLY BILL (NOT ADJ INV)            
         BZ    *+8                                                              
         OI    PBILCMSW,BSTCMONQ   COMMISSION ONLY                              
*                                                                               
         CLI   DUESW,C'R'          SEE IF THIS IS AOR BILL                      
         BE    WB6A                                                             
*                                                                               
*        PBILCMSW WASN'T BEING SET FOR SEPERATE COMM. AND CD BILLS              
*                                                                               
         OC    PEPTAORA,PEPTAORA  CHECK FOR AOR AMOUNT                          
         BZ    WB6A                                                             
         OI    PBILCMSW,BSTCAORQ   MEANS AOR BILL WILL FOLLOW                   
*                                                                               
WB6A     DS    0H                                                               
         CLI   SCBNCSW,C'N'       NET BILL IN SEP COMM SITUATION                
         BNE   *+8                                                              
         OI    PBILCMSW,BSTSNETQ                                                
*                                                                               
         CLI   SCBNCSW,C'C'       SEE IF COMMISSION BILL                        
         BNE   WB6A5                                                            
         CLI   DUESW,C'R'         AND NOT AOR INV                               
         BE    WB6B                                                             
         CLI   DUESW,C'C'         AND NOT CD INV                                
         BE    WB6B                                                             
         OI    PBILCMSW,BSTSCOMQ     SEP COMM                                   
         ZAP   PBILLGRS,=P'0'                                                   
         ZAP   PBILLBIL,=P'0'                                                   
         ZAP   PBILLNET,=P'0'                                                   
         L     R0,PEPTDUE           DUE                                         
         S     R0,PEPTNET           LESS NET                                    
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB                                                     
***                                                                             
***      NOTE- PUTTING GROSS AND NET IN SCB TYPE COMMISSION BILLS               
***            TO PROVIDE A CROSS CHECK WITH INSERTIONS.                        
***            SOME PROGRAMS THAT TOTAL BILLS WILL HAVE TO BE                   
***            CHANGED TO AVOID INFLATED AMOUNTS                                
***                                                                             
         L     R0,PEPTGRS          GROSS                                        
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLGRS,DUB                                                     
         L     R1,PEPTCD           CD                                           
         SR    R0,R1                                                            
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLBIL,DUB        GROSS-CD                                     
         L     R0,PEPTNET           NET                                         
         SR    R0,R1                                                            
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLNET,DUB        NET-CD                                       
         B     WB7                                                              
*                                                                               
WB6A5    DS    0H                                                               
WB6AX    CLI   DUESW,C'A'          FOR ADJ INV ZERO BILL AMT AND NET            
         BNE   WB6B                                                             
***NEW 5/16/91                                                                  
         OC    PEPTADJ,PEPTADJ    SKIP IF NO ADJUSTMENT AMOUNT                  
         BZ    WB8B5         (AT LEAST ONE ENTRY SHOULD BE NON-ZERO)            
***NEW 5/16/91                                                                  
         ZAP   PBILLGRS,=P'0'                                                   
         ZAP   PBILLBIL,=P'0'                                                   
         ZAP   PBILLNET,=P'0'                                                   
         L     R0,PEPTADJ          ADJ                                          
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB                                                     
         MVI   PBILSEP,C'A'                                                     
*                                                                               
WB6A8    CLI   PEPTFIN,0           CHK FINANCIAL PEPTAB ENTRY                   
         BE    WB7                                                              
         ZAP   PBILLCNR,DUB        SET CONTRACT RCV                             
         L     R0,PEPTOADJ         OPEN ADJ                                     
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB                                                     
         B     WB7                                                              
*                                                                               
WB6B     DS    0H                                                               
         CLI   DUESW,C'C'          FOR CD INV ZERO BILL AMT AND NET             
         BNE   WB6C                                                             
         ZAP   PBILLGRS,=P'0'                                                   
         ZAP   PBILLBIL,=P'0'                                                   
         ZAP   PBILLNET,=P'0'                                                   
         L     R0,PEPTCD           CD TO PBILLRCV                               
         LCR   R0,R0               FOR CD INV MUST COMPLIMENT CD                
         CVD   R0,DUB                                                           
         ZAP   PBILLRCV,DUB                                                     
         MVI   PBILSEP,C'C'                                                     
         CLI   PEPTFIN,0           CHK FINANCIAL PEPTAB ENTRY                   
         BE    WB7                                                              
         ZAP   PBILLCNR,DUB        MUST ALSO SET CONTRACT RCV                   
****                                                                            
****                          ** NOTE OPEN CD IS SAME AS CONTRACT**             
****                                                                            
         B     WB7                                                              
*                                                                               
WB6C     DS    0H                                                               
         CLI   DUESW,C'R'          FOR AOR INVOICE                              
         BNE   WB6C5                                                            
***NEW 5/16/91                                                                  
         CLI   PEPTAORA,C' '       SKIP IF NO AOR ACCOUNT                       
         BNH   WB8B5                                                            
***NEW 5/16/91                                                                  
         ZAP   PBILLGRS,=P'0'                                                   
         ZAP   PBILLBIL,=P'0'                                                   
         L     RF,PEPTDUE          DUE                                          
         S     RF,PEPTNET           MINUS NET                                   
         CVD   RF,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLACM,DUB        SAME AS PBILLNET                             
         L     R0,PEPTAOR          AOR AMOUNT                                   
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB        PUT IN RECEIVABLE                            
         OI    PBILCMSW,BSTTAORQ   SET AOR BILL BIT                             
*                                                                               
         TM    PEPTAORB,X'80'       SEE IF AOR BASIS IS AC                      
         BO    WB6C1X                                                           
         CLI   AORTXOPT,C'Y'                                                    
         BE    WB6C1                                                            
WB6C1    OI    PBILCMSW,X'04'      SUBTRACT TAX FROM AOR BASIS                  
*                                                                               
WB6C1X   DS    0H                                                               
**NEW 3/12/91                                                                   
         CLI   AORLOPT,C'N'                                                     
         BE    WB7                                                              
         MVC   PBILKBNO,PEPTAORI     SET INVOIVE NUMBER FROM PEPTAB             
**NEW 3/12/91                                                                   
*                                                                               
WB6C2    B     WB7                                                              
*                                                                               
*                             NOTE : WHAT ABOUT FINANCIAL CLIENTS               
*                                                                               
WB6C5    CLI   UPASS,0             IS IT RETAIL                                 
         BH    WB6D                YES                                          
*                                  NO                                           
*               8(R4)=GROSS                                                     
*              12(R4)=NET                                                       
*              16(R4)=CD                                                        
*              20(R4)=AC                                                        
*              24(R4)=ADJ                                                       
*              28(R4)=DUE                                                       
*              32(R4)=GROSS        OPEN                                         
*              36(R4)=NET          OPEN                                         
*              40(R4)=CD           ALWAYS CONTRACT                              
*              44(R4)=AC                                                        
*              48(R4)=ADJ          OPEN                                         
*              52(R4)=DUE          OPEN                                         
*              56(R4)=TAX                                                       
*              60(R4)=AOR AMOUNT                                                
*              64(R4)=AOR BASE AMOUNT                                           
*              68(R4)=RET SHR ACTUAL                                            
*              72(R4)=RET SHR GROSS                                             
*              76(R4)=RET SHR NET                                               
*              80(R4)=RET SHR CD                                                
*              84(R4)=RET SHR AC                                                
*              88(R4)=RET SHR AC                                                
*              92(R4)=RET SHR VAT                                               
*                                                                               
*              96(R4)=VAT MAIN BILL                                             
*             100(R4)=VAT ADJ SEP BILL                                          
*             104(R4)=VAT CD SEP BILL                                           
*             108(R4)=VAT AOR BILL                                              
*                                                                               
*             112(R4)=PRD ACCT                                                  
*             116(R4)=STATUS    X'80'=COMM ONLY                                 
*              2 SPARE                                                          
*             119(R4)=BILLING FORMULA (5)                                       
*             124(R4)=JOB CODE(6) (FOR FINANCIAL)                               
*              3 SPARE                                                          
*              133(R4)=AOR RCVBL/PAYABLE ACCNT (14)                             
*              147(R4)=AOR PCT (4)                                              
*              151(R4)=AOR BASIS (1)                                            
*              152(R4)=AOR RECORD DISK ADDR (4)                                 
*              156(R4)=AOR INVOICE NUMBER (2)                                   
*              158(R4)=VAT CODE                                                 
*              159(R4)=VAT SW                                                   
*                                                                               
*        ALSO SEE PEPTD DSECT IN PPREPB1WKR                                     
*                                                                               
         L     R0,PEPTGRS          GROSS                                        
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLGRS,DUB                                                     
         L     R1,PEPTCD           CD                                           
         SR    R0,R1                                                            
         CVD   R0,DUB                                                           
         ZAP   PBILLBIL,DUB        GROSS-CD                                     
         L     R0,PEPTNET           NET                                         
         SR    R0,R1                                                            
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLNET,DUB        NET-CD                                       
         L     R0,PEPTDUE          ACTUAL                                       
         CLI   ADJSEP,C'Y'         IF THIS IS NORMAL BILL                       
         BNE   *+8                 BUT ADJ IS SEP                               
         S     R0,PEPTADJ          THEN SUBTRACT ADJ FROM THIS BILL             
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB                                                     
         CLI   PEPTFIN,0         SEE IF DOING FINANCIAL PEPTAB ENTRY            
         BE    WB7                                                              
*                                                                               
         ZAP   PBILLCNR,PBILLRCV   SET CONTRACT RCV IN NEW ELEM                 
         L     R0,PEPTOGRS          OPEN GROSS                                  
         CVD   R0,DUB                                                           
         ZAP   PBILLOPG,DUB                                                     
         L     R0,PEPTONET          OPEN NET                                    
         CVD   R0,DUB                                                           
         ZAP   PBILLOPN,DUB                                                     
         L     R0,PEPTODUE         ACTUAL  - OPEN                               
         CLI   ADJSEP,C'Y'         IF THIS IS NORMAL BILL                       
         BNE   *+8                 BUT ADJ IS SEP                               
         S     R0,PEPTOADJ    THEN SUBTRACT OPEN ADJ FROM THIS BILL             
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB         NOW OPEN RCV                                
         B     WB7                                                              
*                                  RETAIL                                       
WB6D     DS    0H                                                               
**NEW 10/31/89                     IF RETAIL SET PBRACCT TO SPACES              
         MVC   PBRACCT(12),SPACES                                               
**NEW 10/31/89                                                                  
         MVC   PBRETAIL,UPASS      1 = CORP 'OUTLET',2+ = DISTRIB               
         CLI   CORPZ,C'Y'          IF CORP NOT AN INVOICE                       
         BNE   *+8                                                              
         OI    PBRETAIL,X'80'      CORPORATE CONTROL                            
*                                                                               
         CLI   UPASS,2                                                          
         BL    *+8                                                              
         MVI   PBRETAIL,2          ALL DISTRIBS = 2                             
         CLI   UPASS,C'S'          SUMMARY PASS                                 
         BNE   *+8                                                              
         MVI   PBRETAIL,X'41'      SUMMARY                                      
*                                                                               
         L     R0,PEPTRETG         GROSS  - RETAIL                              
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLGRS,DUB                                                     
         L     R1,PEPTRETC         CD   - RETAIL                                
         SR    R0,R1                                                            
         CVD   R0,DUB                                                           
         ZAP   PBILLBIL,DUB        GROSS-CD                                     
         L     R0,PEPTRETN         NET                                          
         SR    R0,R1               NET-CD                                       
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLNET,DUB        NET - CD                                     
         L     R0,PEPTRETA         ACTUAL - RETAIL                              
         CVD   R0,DUB                                                           
*                                                                               
         BAS   RE,CKMAX                                                         
*                                                                               
         ZAP   PBILLRCV,DUB                                                     
*                                                                               
*                                                                               
         L     R5,AGDAREA                                                       
         USING GDSECT,R5                                                        
         CLI   UPASS,C'S'          FOR SUMMARY                                  
         BNE   *+10                                                             
         MVC   GDMGR(8),SPACES     NO MGR OR MKT                                
*******  MVC   DUB(5),PBILLGRS     SAVE PBILLGRS                                
**BIG                                                                           
         MVC   DUB(6),PBILLGRS     SAVE PBILLGRS                                
**BIG                                                                           
         MVC   PBRACCT(6),GDMGR                                                 
         ZIC   RF,GDMGRLEN                                                      
         LA    RF,PBRACCT(RF)                                                   
         CLI   GDMKTLEN,0          OK - SINCE GDMKTLEN ALWAYS 0                 
         BE    *+14                FOR PRINT                                    
         MVC   0(4,RF),GDMKT                                                    
         LA    RF,4(RF)                                                         
         L     RE,GDOUTAD                                                       
**NEW 11/15/89     TO PREVENT BAD RETAIL BILLS TO BE ADDED                      
*               TO THE FILE (WITHOUT OR WITH A BAD OUTLET CODE)                 
         CLI   0(RE),C'A'                                                       
         BNL   *+6                                                              
         DC    H'0'       OUTLET CODE MUST BEGIN WITH A CHARACTER               
*                         FUNNY DATA WAS THERE ONCE FOR FCSA 10/89              
*                         NEVER FOUND OUT WHY                                   
*                                                                               
**NEW 11/15/89                                                                  
         MVC   0(L'GDOCODE,RF),0(RE)                                            
*                                                                               
WB6H2    DS    0H                                                               
         CLI   MOLSON,C'Y'         IF MOLSON SPECIAL                            
         BNE   WB6H4                                                            
         CLC   0(6,RF),=C'000001'  GIVE CORPORATE A DIFFERENT                   
         BNE   WB6H4                                                            
         MVI   5(RF),C'5'          OUTLET CODE (FOR RCVBLS)                     
*                                                                               
WB6H4    DS    0H                                                               
         MVC   PBILLGRS,DUB        RESTORE PBILLGRS                             
*                                  IT MAY HAVE BEEN CLOBBERED BY ABOVE          
         B     WB7D                                                             
*                                                                               
WB7      DS    0H                  NON-REATIL - SET MGR                         
********                                                                        
         OC   MANGRS(12),MANGRS    IF MANUAL LEAVE AS ZEROS                     
         BNZ   WB7D                                                             
         OC    AMGR1BRK,AMGR1BRK   SEE IF DOING MKTGRPS                         
         BZ    WB7D                                                             
         CLC   AMGR1BRK,AINVBRK    TEST MGR SEP                                 
         BH    WB7D                                                             
         MVC   PNBPGR1,PGR1        DIVISION                                     
         MVC   PNBMGR1,MGR1        REGION                                       
         MVC   PNBMGR2,MGR2        DISTRICT                                     
*                                                                               
WB7D     DS    0H                                                               
*                                                                               
*        IF DOING SEPERATE INVOICE PER AD CODE                                  
*        ADD PBILOTH ELEM                                                       
*                                                                               
         OC    AJOBBRK,AJOBBRK     SEE IF DOING AD CODES                        
         BZ    WB7D6                                                            
         OC    PEPTJOB,PEPTJOB     SEE IF JOB IN PEPTAB                         
         BZ    WB7D3               WILL BE FOR DOREMUS FINANCIAL CLTS           
         MVC   PBILLJOB,PEPTJOB                                                 
         B     WB7D5                                                            
*                                                                               
WB7D3    CLC   AJOBBRK,AINVBRK     TEST SEPERATE JOB PER INVOICE                
         BH    WB7D6                                                            
         L     RF,AJOB                                                          
         MVC   PBILLJOB,3(RF)      DON'T MOVE PRD CODE                          
WB7D5    CLI   PEPTFIN,0           CHECK FINANCIAL                              
         BNE   WB7D6                                                            
         ZAP   PBILLOPG,=P'0'                                                   
         ZAP   PBILLOPN,=P'0'                                                   
         ZAP   PBILLCNR,=P'0'                                                   
         MVC   PBILOTH(2),=X'091E'                                              
*****    MVC   PBILLLEN,=H'133'    RESET RECORD LENGHT                          
**BIG                                                                           
         MVC   PBILLLEN,=H'163'      133+30                                     
**BIG                                                                           
*                                                                               
WB7D6    OC    PEPTTAX,PEPTTAX     CKECK FOR SALES TAX                          
         BZ    WB7D8                                                            
         CLI   PBILOTH,X'09'       SEE IF 09 ELEMNET ALREADY THERE              
         BE    WB7D6H                                                           
         ZAP   PBILLOPG,=P'0'                                                   
         ZAP   PBILLOPN,=P'0'                                                   
         ZAP   PBILLCNR,=P'0'                                                   
         MVC   PBILOTH(2),=X'0920'  "BIG" PBILOTH ELEMENT                       
******** MVC   PBILLLEN,=H'135'    RESET RECORD LENGHT                          
**BIG                                                                           
         MVC   PBILLLEN,=H'165'    RESET RECORD LENGHT 133+32                   
**BIG                                                                           
         MVC   PBILLTAX,PEPTTAX                                                 
         CLI   PBRETAIL,0           SEE IF RETAIL                               
         BE    WB7D8                                                            
         MVC   PBILLTAX,PEPTRETT    USE RETAIL SHRARE OF TAX                    
         B     WB7D8                                                            
*                                                                               
WB7D6H   MVC   PBILOTH(2),=X'0920'   "BIG" PBILOTH ELEMENT                      
*******  MVC   PBILLLEN,=H'135'                                                 
**BIG                                                                           
         MVC   PBILLLEN,=H'165'     133+32                                      
**BIG                                                                           
         MVC   PBILLTAX,PEPTTAX                                                 
         CLI   PBRETAIL,0           SEE IF RETAIL                               
         BE    WB7D8                                                            
         MVC   PBILLTAX,PEPTRETT    USE RETAIL SHRARE OF TAX                    
         B     WB7D8                                                            
*                                                                               
*                                                                               
*                                  ADD INTO REQ TOTALS                          
WB7D8    CLI   PBRETAIL,X'41'      SKIP CORP SUMMARY                            
         BE    WB7F                                                             
         CLI   DUESW,C'A'          ADJ INV SKIP OBTOTS                          
         BE    WB7F                                                             
         CLI   DUESW,C'C'          CD INV                                       
         BE    WB7F                                                             
         CLI   DUESW,C'R'          OR AOR INV                                   
         BE    WB7F                                                             
*                                                                               
*              NOTE - R4 STILL SET TO PEPTAB ENTRY                              
*                                                                               
         L     R0,OBTOTS                                                        
         A     R0,PEPTGRS          GROSS                                        
         ST    R0,OBTOTS                                                        
         L     R0,OBTOTS+4                                                      
         A     R0,PEPTNET           NET                                         
         ST    R0,OBTOTS+4                                                      
         L     R0,OBTOTS+8                                                      
         A     R0,PEPTCD            CD                                          
         ST    R0,OBTOTS+8                                                      
*                                                                               
WB7F     DS    0H                                                               
**GST                                                                           
         CLI   PEPTVSW,0           SEE IF BILL IS VATABLE                       
         BE    WB7F6                                                            
         XC    ELEM(15),ELEM        ADD VAT ELEMENT                             
         MVC   ELEM(2),=X'0A0E'                                                 
         LA    RF,ELEM                                                          
         USING PBILVEL,RF                                                       
*                                                                               
         MVC   PBILLVCD,PEPTVCD                                                 
         MVC   PBILLVAT,PEPTVATC   VAT FOR COMMISSION BILL                      
         MVC   PBILLVBS,PEPTADJ    VAT BASIS FOR ADJ BILL                       
         CLI   DUESW,C'A'                                                       
         BE    WB7F4                                                            
         L     R0,PEPTVATD          CD VAT                                      
         LCR   R0,R0                MUST COMPLIMENT                             
         ST    R0,PBILLVAT                                                      
         L     R0,PEPTCD            CD VAT BASIS                                
         LCR   R0,R0                MUST COMPLIMENT                             
         ST    R0,PBILLVBS                                                      
*                                                                               
         CLI   DUESW,C'C'                                                       
         BE    WB7F4                                                            
         MVC   PBILLVAT,PEPTVATA    VAT FOR AOR BILL                            
         MVC   PBILLVBS,PEPTAOR                                                 
         CLI   DUESW,C'R'                                                       
         BE    WB7F4                                                            
         MVC   PBILLVAT,PEPTVAT      SET FOR MAIN BILL VAT                      
*                                    SET VAT BASIS                              
         L     R0,PEPTDUE            AMOUNT DUE                                 
         S     R0,PEPTTAX            MINUS TAX                                  
         CLI   ADJSEP,C'Y'           SEE IF ADJ ON SEPERATE                     
         BNE   *+8                                                              
         S     R0,PEPTADJ                                                       
*                                                                               
         CLI   CDSEP,C'R'         SPECIAL CD HANDLING USING 'APPLY'             
         BE    WB7F1                                                            
*                                                                               
         CLI   CDSEP,C'C'            CHECK FOR SPECIAL CD HANDLING              
         BNE   WB7F2                                                            
WB7F1    TM    PBILBASA,X'04'        SEE IF CD IN FORMULA                       
         BNO   WB7F2                                                            
         A     R0,PEPTCD             RESTORE CD                                 
WB7F2    ST    R0,PBILLVBS                                                      
***********                                                                     
***********               WHAT IF RETAIL AND COMM SEP OR CD SEP???              
***********                                                                     
         CLI   PBRETAIL,0          SEE IF RETAIL BILL                           
         BE    WB7F4                                                            
         MVC   PBILLVAT,PEPTRETV    USE RETAIL VAT                              
         L     R0,PEPTRETA          ACTUAL                                      
         S     R0,PEPTRETT          MINUS TAX                                   
         ST    R0,PBILLVBS                                                      
         DROP  RF                                                               
****                                                                            
WB7F4    DS    0H                                                               
         LA    R2,PBILLEL                                                       
         MVI   ELCODE,X'FF'                                                     
         BAS   RE,NEXTEL       ADD TO END OF RECORD                             
         GOTO1 RECUP,DMCB,(1,PBILLREC),ELEM,(R2)                                
*                                                                               
         BAS   RE,SETPVAT          NOW DO PROV VATS                             
*                                                                               
WB7F6    DS    0H                                                               
**GST                                                                           
         CLC   QPROG,=C'R1'        FINANCIAL REBATE                             
         BE    WB7F9                                                            
         CLC   QPROG,=C'RD'        FINANCIAL REBATE BILL - DRAFT                
         BNE   WB7X                ALTER BILLAMTS                               
WB7F9    ZAP   PBILLOPG,=P'0'                                                   
         ZAP   PBILLOPN,=P'0'                                                   
         ZAP   PBILLGRS,=P'0'                                                   
         ZAP   PBILLBIL,=P'0'                                                   
         ZAP   PBILLNET,=P'0'                                                   
         ZAP   PBILLRCV,PBILLCNR     SET PBILLRCV TO PBILLCNR                   
***R***                                                                         
WB7X     CLI   RCWRITE,C'Y'                                                     
         BNE   WB7X5                                                            
         CLI   TEST,C'T'           ALL DRAFT BILLING                            
         BE    WB7X5   MAY STILL NEED TO DO EDI (WAS BE   WB8)                  
         MVC   KEY,PBILLREC                                                     
***NEW 5/16/91                      DIE IF BILL ALREADY ON FILE                 
         GOTO1 HIGH                                                             
         CLC   KEY(20),KEYSAVE                                                  
         BNE   *+6                                                              
         DC    H'0'                                                             
         MVC   KEY,PBILLREC                                                     
***NEW 5/16/91                                                                  
         MVC   AREC,ADBILL                                                      
         GOTO1 ADDPRT                                                           
         OC    SAVEDA,SAVEDA                                                    
         BNZ   *+10                                                             
         MVC   SAVEDA,KEY          SAVE DA OF FIRST BILL ADDED                  
**EDI**                                                                         
WB7X5    DS    0H                                                               
         GOTO1 ABILLEDI,DMCB,('EDMHDR',0) EDI CALL                              
         CLI   RCWRITE,C'Y'                                                     
         BNE   WB8                                                              
**EDI**                                                                         
         OC   MANGRS(12),MANGRS    SEE IF MANUAL BILL                           
         BZ    WB8                                                              
         MVC   FULL,KEY            SAVE DA                                      
         MVC   KEY,PBILLREC        ADD SECOND POINTER                           
         MVC   KEY+27(4),FULL      PUT DA IN KEY                                
         MVI   KEY+3,X'88'                                                      
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMADD),PRTDIR,KEY,KEY                      
         MVC   BYTE,DMCB+8                                                      
         NC    BYTE,DMOUTBTS                                                    
         BZ    *+6                                                              
         DC    H'0'                DATAMGR ERROR                                
*                                                                               
WB8      DS    0H                                                               
         CLI   SORTTRCE,C'B'       TRACE OF BILLS ONLY                          
         BE    WB8A                                                             
         CLI   SORTTRCE,C'Y'                                                    
         BNE   WB8B                                                             
*                                  DUMP OF RECORD                               
WB8A     DS    0H                                                               
         GOTO1 HEXOUT,DMCB,PBILLREC,P1+10,50,=C'N'                              
         GOTO1 (RF),(R1),PBILLREC+50,P2+10,50                                   
         GOTO1 (RF),(R1),PBILLREC+100,P3+10,50                                  
         GOTO1 (RF),(R1),PBILLREC+150,P4+10,50                                  
         GOTO1 (RF),(R1),PBILLREC+200,P5+10,50                                  
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
WB8B     DS    0H                                                               
         LA    R2,PBILLEL                                                       
         MVI   ELCODE,X'0A'        DELETE 0A ELEM                               
         BAS   RE,NEXTEL                                                        
         BNE   WB8B3                                                            
         GOTO1 RECUP,DMCB,(1,PBILLREC),(R2),0                                   
*                                                                               
WB8B3    LA    R2,PBILLEL                                                       
         MVI   ELCODE,X'09'        DELETE 09 ELEM                               
         BAS   RE,NEXTEL                                                        
         BNE   WB8B3V                                                           
         GOTO1 RECUP,DMCB,(1,PBILLREC),(R2),0                                   
*                                                                               
WB8B3V   DS    0H                      DELETE PST ELEMS                         
         LA    R2,PBILLEL                                                       
         MVI   ELCODE,X'84'                                                     
         BAS   RE,NEXTEL                                                        
         BNE   WB8B4                                                            
         GOTO1 RECUP,DMCB,(1,PBILLREC),(R2),0                                   
         B     WB8B3V                   MORE                                    
*                                                                               
WB8B4    XC    PBILOTH(50),PBILOTH      CLEAR PBILLREC                          
*                                                                               
WB8B5    A     R4,PEPPARS+12       NEXT PEPTAB ENTRY                            
*******  MVC   PBILLLEN,=H'103'      RESET TO "NORMAL" BILL LENGTH              
**BIG                                                                           
         MVC   PBILLLEN,=H'133'   RESET TO "NORMAL" BILL LEN 100+33             
**BIG                                                                           
         XC    PBILOTH(50),PBILOTH      CLEAR PBILOTH AND 0A ELEM               
         BCT   R6,WB4                                                           
*                                                                               
WBILLX  DS    0H                                                                
         XIT1                                                                   
         SPACE 3                                                                
NEXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0        END OF RECORD                                     
         BE    NEXTEL2                                                          
         CLC   0(1,R2),ELCODE                                                   
         BER   RE                                                               
         B     NEXTEL                                                           
*                                                                               
NEXTEL2  DS    0H                                                               
         LTR   RE,RE                                                            
         BR    RE                                                               
*                                                                               
*                                                                               
CKMAX    CP    DUB,=P'99999999999'    OVER MAX                                  
         BNH   *+6                                                              
         DC    H'0'             MUST DIE                                        
         CP    DUB,=P'-99999999999'   UNDER MINIMUM                             
         BNL   *+6                                                              
         DC    H'0'            MUST DIE                                         
         BR    RE              RETURN                                           
*                                                                               
         EJECT                                                                  
**********************************************************************          
*                                                                               
*        SETPVAT - SET PROVINCIAL VAT AMOUNTS                                   
*                                                                               
*         NOTE- +1'S AND +4'S ARE TO BYPASS NATIONAL VAT                        
**********************************************************************          
         SPACE 1                                                                
SETPVAT  NTR1                                                                   
*                                                                               
         LA    R2,PEPTVCDS+1       VAT CODES                                    
         LA    R3,PEPTVSWS+1       VAT SWITCHES                                 
*                                                                               
SPV4     DS    0H                                                               
         CLI   DUESW,C'R'          AOR BILLS                                    
         BNE   SPV5                                                             
         LA    R2,PEPTAOVS+1       USE AOR VAT CODES                            
         LA    R3,PEPTAOVS+1       ALSO USE AS SWITCHES                         
         LA    R5,PEPTVTAS+4       VAT AMOUNTS                                  
         L     R6,PEPTAOR          AOR AMOUNT IS VAT BASIS                      
         A     R6,PEPTVTAS         ADD GST FOR PROV VAT BASES                   
         ST    R6,FULL                                                          
         LA    R6,FULL                                                          
         B     SPV10                                                            
*                                                                               
SPV5     DS    0H                                                               
         CLI   DUESW,C'A'          COMM ADJ BILLS                               
         BNE   SPV5CD                                                           
         LA    R5,PEPTVTCS+4       VAT AMOUNTS                                  
         LA    R6,PEPTCVTB+4       VAT BASES                                    
         B     SPV10                                                            
*                                                                               
SPV5CD   DS    0H                                                               
         CLI   DUESW,C'C'          CD SEP BILLS                                 
         BNE   SPV6                                                             
         LA    R5,PEPTVTDS+4       VAT AMOUNTS                                  
         LA    R6,PEPTDVTB+4       VAT BASES                                    
         B     SPV10                                                            
*                                                                               
SPV6     DS    0H                                                               
         CLI   UPASS,0             RETAIL                                       
         BE    SPV7                                                             
         LA    R5,PEPTRTVS+4       VAT AMOUNTS                                  
         LA    R6,PEPTRVTB+4       VAT BASES                                    
         B     SPV10                                                            
*                                                                               
SPV7     DS    0H                  'NORMAL' BILL                                
         LA    R5,PEPTVTS+4        VAT AMOUNTS                                  
         LA    R6,PEPTVTB+4        VAT BASES                                    
*                                                                               
SPV10    DS    0H                                                               
         LA    R0,NPROVS                                                        
         SR    RF,RF                                                            
         B     SPV14                                                            
*                                                                               
SPV12    DS    0H                                                               
         LA    RE,ELEM             START OF PROV VAT 'ELEMENTS'                 
         XC    ELEM,ELEM                                                        
         USING PBLPSTEL,RE                                                      
         MVC   ELEM(2),=X'840F'    SET ELEM CODE AND LENGHT                     
         LA    R2,1(R2)            NEXT CODE                                    
         LA    R3,1(R3)            SWITCH                                       
         LA    R5,4(R5)            NEXT AMOUNT                                  
         CLI   DUESW,C'R'          FOR AOR BASIS IS CONTSTANT                   
         BE    *+8                                                              
         LA    R6,4(R6)            NEXT BASIS AMOUNT                            
*                                                                               
SPV14    DS    0H                                                               
         CLI   0(R3),C' '          TEST VAT SWITCH                              
         BNH   SPV50                                                            
*                                                                               
         MVC   PBLPVCOD,0(R2)   VAT CODE                                        
         CLI   0(R2),X'FF'                    IF MIXED                          
         BNE   *+8                                                              
         MVI   PBLPVCOD,C'?'                                                    
         MVC   PBLPVBAS,0(R6)   VAT BASIS                                       
         MVC   PBLPVAMT,0(R5)   VAT AMOUNT                                      
*                                                                               
         CLI   DUESW,C'C'        SEE IF CD BILL                                 
         BNE   SPV20                                                            
*                                                                               
         L     R1,PBLPVBAS          IF SO MUST COMPLIMENT BASE                  
         LCR   R1,R1                                                            
         ST    R1,PBLPVBAS                                                      
         L     R1,PBLPVAMT          AND VAT                                     
         LCR   R1,R1                                                            
         ST    R1,PBLPVAMT                                                      
*                                                                               
SPV20    LH    R1,=H'11'                PROVINCE = 11 - BCT COUNTER             
         SR    R1,R0                                                            
         STC   R1,PBLPVPRV                                                      
         DROP  RE                                                               
*                                                                               
         ST    RF,MYRF                                                          
         ST    R2,MYR2                                                          
         ST    R0,MYR0                                                          
         LA    R2,PBILLEL                                                       
         MVI   ELCODE,X'FF'                                                     
         BAS   RE,NEXTEL                                                        
         GOTO1 RECUP,DMCB,(1,PBILLREC),ELEM,(R2)                                
         L     RF,MYRF                                                          
         L     R2,MYR2                                                          
         L     R0,MYR0                                                          
         XC    ELEM,ELEM                                                        
         LA    RF,1(RF)            COUNT OF ELEMS                               
*                                                                               
SPV50    DS    0H                                                               
         BCT   R0,SPV12                                                         
*                                                                               
SPVX     DS    0H                                                               
         XIT1                                                                   
         DROP  R4                                                               
*                                                                               
MYRF     DS    F                 USED TO SAVE REGISTER F                        
MYR2     DS    F                                                                
MYR0     DS    F                                                                
         LTORG                                                                  
         TITLE 'INVREG - INVOICE REGISTER MODULE'                               
INVREG   CSECT                                                                  
         NMOD1 0,INVREG                                                         
         LA    RC,SPACEND                                                       
         SPACE 2                                                                
*                                                                               
         B     INVR0                                                            
         B     INVR                                                             
PATCHDA  DC    F'0'            USE TO RERUN REGISTER                            
INVR     MVC   SAVEDA,PATCHDA                                                   
*                                                                               
INVR0    DS    0H                                                               
*                                                                               
*        CHECK TABLE OF FINANCIAL AGENCIES                                      
*        IF AGENCY IS NOT IN THIS TABLE                                         
*        "OPEN" BILLING WILL DISPLAY AS "COST2"                                 
*                                                                               
         MVI   ROPENSW,C'N'                                                     
         LA    R1,FAGYTAB                                                       
INVR0A   CLI   0(R1),X'FF'            END OF FINANCIAL AGENCIES                 
         BE    INVR0F                                                           
         CLC   RCSVAGY(2),0(R1)                                                 
         BNE   INVR0C                                                           
         MVI   ROPENSW,C'Y'                                                     
         B     INVR0F                                                           
*                                                                               
INVR0C   LA    R1,2(R1)                                                         
         B     INVR0A                                                           
*                                                                               
INVR0F   DS    0H                                                               
         MVI   AORSW,0      WILL BE SET TO X'01' IF AOR BILL FOUND              
         MVC   SAVR1,SAVEDA      SAVE FIRST DISK ADDR                           
*                           AND SET TO X'02' WHEN DOING AOR REGISTER            
INVR1    DS    0H                                                               
         OC    SAVEDA,SAVEDA                                                    
         BZ    INVRX               NO BILLS ADDED                               
*                                                                               
         MVC   QUESTOR,=C'INVOICE REG.' PRINT SMTH TO INDICATE INV REG          
         GOTO1 VREQREP,DMCB         FORCE GENERATION OF REQUEST HEADER          
         L     R8,=V(DICSECT)                                                   
         USING DICSECT,R8                                                       
*                                                                               
         LA    R2,P1                                                            
         USING ILINED,R2                                                        
         MVI   FORCEHED,C'Y'                                                    
         MVC   PAGE,=H'1'                                                       
         MVI   RCSUBPRG,20                                                      
         TM    AORSW,X'02'         SEE IF DOING AOR REGISTER                    
         BNO   INVR1C                                                           
         ZIC   R3,RCSUBPRG                                                      
         LA    R3,1(R3)                                                         
         STC   R3,RCSUBPRG                                                      
*                                                                               
INVR1C   DS    0H                  CLEAR ALL TOTALS                             
         LA    R3,BILLTOTS                                                      
         BAS   RE,CLRTOTS                                                       
         LA    R3,IRITOTS                                                       
         BAS   RE,CLRTOTS                                                       
         LA    R3,IRCTOTS                                                       
         BAS   RE,CLRTOTS                                                       
         LA    R3,IRMTOTS                                                       
         BAS   RE,CLRTOTS                                                       
*                                                                               
         ZIC   R0,SAVEDA+2                                                      
         BCTR  R0,R0                                                            
         STC   R0,SAVEDA+2                                                      
         XC    KEY1,KEY1                                                        
         MVC   AREC,ADWKREC                                                     
         XC    DBTOTS,DBTOTS                                                    
INVR2    DS    0H                                                               
         L     R7,AREC                                                          
         USING PBILLREC,R7                                                      
         XC    PBILOTH(60),PBILOTH                                              
         GOTO1 DATAMGR,DMCB,DMRSEQ,PRTFILE,SAVEDA,AREC                          
*                                                                               
         TM    DMCB+8,X'7F'                                                     
         BZ    *+6                                                              
         DC    H'0'                                                             
         TM    DMCB+8,X'80'                                                     
         BZ    INVR2B                                                           
INVR2A   MVI   PBILLREC,X'FF'                                                   
         MVC   PBILLREC+1(24),PBILLREC                                          
         B     INVR3                                                            
*                                                                               
INVR2B   DS    0H                                                               
         CLC   PBILLREC(2),RCSVAGY                                              
         BNE   INVR2                                                            
         CLI   PBILLREC+3,X'08'                                                 
         BNE   INVR2               NOT A BILL                                   
*                                                                               
         MVC   HALF,PBILLLEN                                                    
         LA    RE,PBILLREC                                                      
         AH    RE,HALF                                                          
         MVC   0(2,RE),=X'0000'      ZERO END OF RECORD                         
*                                                                               
         CLI   PBILLTYP,C'0'       SEE IF "NEW" BILL                            
         BH    INVR2               OLD - SKIP                                   
*                                                                               
*                                  FIRST TEST FOR INVOICE BRK                   
INVR3    DS    0H                                                               
         CLI   PBILLREC,X'FF'      LAST BILL                                    
         BE    INVR3AX                                                          
*                                                                               
         TM    AORSW,X'02'         SEE IF DOING AOR REGISTER                    
         BNO   INVR3A                                                           
         TM    PBILCMSW,BSTTAORQ   SEE IF AOR BILL                              
         BNO   INVR2               NO SKIP                                      
         B     INVR3AX                                                          
*                                                                               
INVR3A   TM    PBILCMSW,BSTTAORQ                                                
         BNO   INVR3AX                                                          
         OI    AORSW,X'01'         SET AOR BILLS FOUND                          
         B     INVR2               SKIP AOR THIS TIME                           
*                                                                               
INVR3AX  CLC   RCSVAGY,=C'DM'      FOR DOREMUS IGNORE MEDIA BREAKS              
         BE    INVR3B                                                           
         CLC   RCSVAGY,=C'SJ'      OR SJR                                       
         BNE   INVR3D                                                           
INVR3B   CLC   PBILLREC+4(3),KEY1+4  CHK FOR CLT BREAK                          
         BNE   INVR4                                                            
         B     INVR3F                                                           
*                                                                               
INVR3D   CLC   PBILLREC(7),KEY1    CLT                                          
         BNE   INVR4                                                            
INVR3F   CLC   PBILLREC+16(2),KEY1+16    CHK FOR INVOICE BREAK                  
         BE    INVR16                                                           
INVR4    DS    0H                                                               
         OC    KEY1,KEY1                                                        
         BZ    INVR12                                                           
*                                                                               
         CLC   DBTOTS(4),=F'1'     IF ONLY 1 INV FOR THIS NUMBER                
         BNH   INVR6               DONT PRINT A TOTAL                           
*                                                                               
         MVC   BILLTOTS(56),IRITOTS     PRINT INVOICE TOTALS                    
*                                                                               
         BAS   RE,IRFMTL                                                        
         MVC   ILINV,W                                                          
*--->    MVC   ILPRD(5),=C'TOTAL'                                               
         MVC   ILPRD(L'PP@TOTAL),PP@TOTAL                                       
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
INVR6    DS    0H                                                               
         LA    R3,IRITOTS          CLEAR                                        
         BAS   RE,CLRTOTS                                                       
         XC    DBTOTS,DBTOTS                                                    
*                                                                               
         CLC   RCSVAGY,=C'DM'      DOREMUS - IGNORE MEDIA BREAKS                
         BE    INVR6A                                                           
         CLC   RCSVAGY,=C'SJ'      OR SJR                                       
         BNE   INVR6C                                                           
INVR6A   CLC   PBILLKEY+4(3),KEY1+4      TEST CLT BREAK                         
         BE    INVR16                                                           
         B     INVR6E                                                           
*                                                                               
INVR6C   CLC   PBILLKEY(7),KEY1    TEST CLIENT BRK                              
         BE    INVR16                                                           
INVR6E   OC    KEY1,KEY1                                                        
         BZ    INVR12                                                           
*                                  FINSIH UP LAST CLIENT                        
         MVC   BILLTOTS(56),IRCTOTS  MOVE CLT TOTS TO BILLTOTS                  
*                                FOR PRINTING                                   
         MVC   TOTSTAR,=C'* '                                                   
         BAS   RE,IRFMTL                                                        
*--->    MVC   P1(7),=C'*CLIENT'                                                
         MVC   P1(L'PP7CLI),PP7CLI                                              
         MVC   P1+8(3),KEY1+4                                                   
*--->    MVC   P1+12(7),=C'TOTALS*'                                             
         MVC   P1+12(L'PP7TOTAL),PP7TOTAL                                       
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
         LA    R3,IRCTOTS          ROLL CLIENT TOTALS TO MEDIA TOTALS           
         LA    R4,IRMTOTS                                                       
         BAS   RE,ROLTOTS                                                       
*                                                                               
         LA    R3,IRCTOTS          THEN CLEAR CLIENT TOTALS                     
         BAS   RE,CLRTOTS                                                       
*                                                                               
         CLC   RCSVAGY,=C'DM'      DOREMUS - IGNORE MEDIA BREAKS                
         BE    INVR7                                                            
         CLC   RCSVAGY,=C'SJ'      OR SJR                                       
         BNE   INVR8                                                            
INVR7    CLI   PBILLREC,X'FF'      SEE IF END OF FILE                           
         BNE   INVR14                                                           
*                                                                               
         MVC   BILLTOTS(56),IRMTOTS  MOVE MEDIA TOTALS FOR PRINTING             
*                                                                               
         MVC   TOTSTAR,=C'**'                                                   
         BAS   RE,IRFMTL                                                        
*--->    MVC   P1(16),=C'**GRAND TOTALS**'                                      
         MVC   P1(L'PP@GRTOT),PP@GRTOT                                          
         GOTO1 APRNT                                                            
         B     INVR30              GO SEE IF I MUST DO AOR REGISTER             
*                                                                               
INVR8    CLC   PBILLREC(3),KEY1    TEST MEDIA BRK                               
         BE    INVR14                                                           
*                                                                               
         MVC   BILLTOTS(56),IRMTOTS  MOVE MEDIA TOTALS FOR PRINTING             
*                                                                               
         MVC   TOTSTAR,=C'**'                                                   
         BAS   RE,IRFMTL                                                        
*--->    MVC   P1(16),=C'**MEDIA TOTALS**'                                      
         MVC   P1(L'PP@MDTOT),PP@MDTOT                                          
         GOTO1 APRNT                                                            
         CLI   PBILLREC,X'FF'                                                   
         BE    INVR30               SEE IF I MUST DO AOR REGISTER               
*                                                                               
         LA    R3,IRMTOTS           CLEAR MEDIA TOTALS                          
         BAS   RE,CLRTOTS                                                       
*                             NEW MEDIA                                         
INVR12   DS    0H                                                               
         CLI   PBILLREC,X'FF'                                                   
         BE    INVR30               SEE IF I MUST DO AOR REGISTER               
         CLC   RCSVAGY,=C'DM'        NO MEDIA FOR DOREMUS                       
         BE    INVR12F                                                          
         CLC   RCSVAGY,=C'SJ'        OR SJR                                     
         BE    INVR12F                                                          
*                                                                               
         MVC   MEDNEWS+1(L'PP@NEWS),PP@NEWS                                     
         MVC   MEDMAG+1(L'PP@MAG),PP@MAG                                        
         MVC   MEDTRD+1(L'PP@TRD),PP@TRD                                        
         MVC   MEDSPL+1(L'PP@SPL),PP@SPL                                        
         MVC   MEDOUT+1(L'PP@OUT),PP@OUT                                        
*                                                                               
         LA    R3,MEDLIST                                                       
INVR12C  CLI   0(R3),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(1,R3),PBILKMED                                                 
         BE    INVR12E                                                          
         LA    R3,11(R3)                                                        
         B     INVR12C                                                          
*                                                                               
INVR12E  MVC   MED,0(R3)                                                        
         MVC   MEDNM,1(R3)                                                      
*                                                                               
INVR12F  MVI   FORCEHED,C'Y'                                                    
*                                                                               
*                             NEW CLIENT                                        
INVR14   DS    0H                                                               
         CLI   AGMCLOPT,C'N'                                                    
         BE    *+8                                                              
         MVI   FORCEHED,C'Y'                                                    
*--->    MVC   P1(6),=C'CLIENT'                                                 
         MVC   P1(L'PP@CLI),PP@CLI                                              
         MVC   P1+7(3),PBILKCLT                                                 
         MVC   P2(9),DASHES                                                     
         CLI   P1+9,C' '                                                        
         BE    *+8                                                              
         MVI   P2+9,C'-'                                                        
         MVI   ALLOWLIN,6                                                       
         GOTO1 APRNT                                                            
         XC    BINVDTE,BINVDTE                                                  
         XC    BDUEDTE,BDUEDTE                                                  
*                                                                               
INVR16   DS    0H                                                               
         CLC   PBILINVD,BINVDTE                                                 
         BE    INVR17                                                           
         GOTO1 DATCON,DMCB,(3,PBILINVD),(5,P1+23)                               
*--->    MVC   P1+9(14),=C'INVOICE DATE ='                                      
         MVC   P1+9(L'PP@INVDT),PP@INVDT                                        
         MVI   ALLOWLIN,3                                                       
         GOTO1 APRNT                                                            
*                                                                               
INVR17   DS    0H                                                               
         CLC   PBILDUED,BDUEDTE                                                 
         BE    INVR18                                                           
         GOTO1 DATCON,DMCB,(3,PBILDUED),(5,P1+23)                               
*--->    MVC   P1+13(10),=C'DUE DATE ='                                         
         MVC   P1+9(L'PP@DUEDT),PP@DUEDT                                        
         MVI   ALLOWLIN,3                                                       
         GOTO1 APRNT                                                            
*                                                                               
*                                                                               
INVR18   DS    0H                                                               
*                                                                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  ILINV(4),DUB+5(3)                                                
         MVI   ILINV+4,C' '                                                     
         CLI   PBRETAIL,X'41'      SUMMARY BILL                                 
         BNE   INVR18C                                                          
         MVI   ILINV+4,C'S'                                                     
         B     INVR19                                                           
*                                                                               
INVR18C  CLI   PBRETAIL,X'81'      CORP CONTROL                                 
         BNE   INVR18D                                                          
         MVI   ILINV+4,C'C'                                                     
         B     INVR19                                                           
*                                                                               
INVR18D  CLC   RCSVAGY,=C'DM'           SPECIAL FOR DOREMUS                     
         BE    INVR18F                                                          
         CLC   RCSVAGY,=C'SJ'           OR SJR                                  
         BNE   INVR19                                                           
INVR18F  MVC   ILINV+4(1),PBILKMED                                              
*                                                                               
INVR19   MVC   W(4),ILINV                                                       
*                                                                               
         MVC   ILPRD,PBILKPRD           PRODUCT                                 
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    RF,HALF                                                          
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  ILEST,DUB                                                        
*                                                                               
*                                                                               
INVR20   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(6,WORK)                                
         MVC   ILPER(3),WORK                                                    
         MVC   ILPER+3(2),WORK+4   YR                                           
*                                                                               
INVR22   DS    0H                                                               
*                                                                               
         MVC   ILTYPE(2),=C'AJ'                                                 
         CLI   PBILSEP,C'A'       ADJ SEP                                       
         BE    INVR22B                                                          
*--->    MVC   ILTYPE(2),=C'CD'                                                 
*                                                                               
         MVC   ILTYPE(2),PP@CD                                                  
*                                                                               
         CLI   PBILSEP,C'C'       CD SEP                                        
         BE    INVR22B                                                          
*--->    MVC   ILTYPE-1(3),=C'AOR'                                              
         MVC   ILTYPE-1(3),PP@AOR                                               
         TM    PBILCMSW,BSTTAORQ  AOR BILL                                      
         BO    INVR22B                                                          
         MVI   ILTYPE-1,C' '                                                    
         MVC   ILTYPE(2),PBILLTYP                                               
*                                                                               
         TM    PBILCMSW,BSTSCOMQ        SEP COMM BILL                           
         BZ    *+8                                                              
         MVI   ILTYPE,C'C'                                                      
*                                                                               
         TM    PBILCMSW,BSTSNETQ        SEP COMM BILL - NET                     
         BZ    *+8                                                              
         MVI   ILTYPE,C'N'                                                      
*                                                                               
INVR22B  CLI   PBRETAIL,0                                                       
         BE    INVR23                                                           
*                                                                               
         MVC   ILPER+132(6),PBRACCT    RETAIL ACCT NO.                          
         MVC   ILPER+264(6),PBRACCT+6                                           
*                                                                               
INVR23   DS    0H                                                               
         XC    X(28),X                                                          
*                                                                               
         GOTO1 APPBVAL,DMCB,(C'B',PBILLREC),PPBVALD                             
*                                                                               
*        MOVE "EFFECTIVE" VALUES INTO PBILLREC                                  
*        NOTE - USE PPBVEBC FOR CD                                              
*        NOTE PPBVGST HAS GST                                                   
*             AND PPBVPST HAS PST                                               
*                                                                               
         MVC   PBILLGRS,PPBVEBG                                                 
         MVC   PBILLBIL,PPBVEBB                                                 
         MVC   PBILLNET,PPBVEBN                                                 
*                                                                               
         ZAP   DUB,PBILLBIL        GROSS-CD                                     
         CVB   R0,DUB                                                           
         ST    R0,X           GROSS  - BAMT                                     
         ZAP   DUB,PBILLNET        NET-CD                                       
         CVB   R0,DUB                                                           
         ST    R0,X+4         NET - BNET                                        
         ZAP   DUB,PBILLRCV                                                     
         CVB   R0,DUB                                                           
         ST    R0,X+8         NET - BACTUAL                                     
         ZAP   DUB,PPBVEBC         EFFECTIVE CD                                 
         CVB   R0,DUB                                                           
         ST    R0,X+16             CD                                           
*                                                                               
         CLC   PBILOTH(2),=X'091E'    FIRST CHECK FOR OTHER ELEM                
         BE    INVR23A   (IT WILL ALWAYS BE IN THE SAME PLACE)                  
*                                                                               
         CLC   PBILOTH(2),=X'0920'  OR OTHER ELEM (+TAX)                        
         BNE   INVR23B   (IT WILL ALWAYS BE IN THE SAME PLACE)                  
*                                                                               
INVR23A  TM    PBILLIND,X'83'      SEE IF FINANCIAL (ANY TYPE)                  
         BZ    INVR23B                                                          
         ZAP   DUB,PBILLCNR                                                     
         CVB   R0,DUB                                                           
         ST    R0,X+8              SET TO CONTRACT RECEIVABLE                   
         ZAP   DUB,PBILLRCV                                                     
         CVB   R0,DUB                                                           
         ST    R0,X+20             OPEN RECEIVABLE                              
         ZAP   DUB,PBILLOPG                                                     
         CVB   R0,DUB                                                           
         ST    R0,X+24             OPEN GROSS                                   
*                                                                               
INVR23B  L     R0,X+4              NET-CD                                       
         A     R0,X+16                                                          
         ST    R0,X+4              NOW NET                                      
*****                                                                           
         L     R0,X                GROSS-CD                                     
         A     R0,X+16                                                          
         ST    R0,X                NOW GROSS                                    
*****                                                                           
         L     R0,X+8              PBILLRCV                                     
         LTR   R0,R0                                                            
         BNP   INVR23C                                                          
         CLI   PBILCDSW,C'C'        CHK FOR SPECIAL CD HANDLING                 
         BNE   INVR23C              NO                                          
         TM    PBILBASA,X'04'       CD IN BASE                                  
         BZ    INVR23C                                                          
         ZAP   DUB,PPBVEBC          "EFFECTIVE" CD                              
         BNP   INVR23C              CD MUST ALSO BE POSTIVE                     
         L     R0,X+8                                                           
         A     R0,X+16              ADD CD BACK TO RECVBL                       
         ST    R0,X+8                                                           
*                                                                               
         CLC   PBILOTH(2),=X'091E'    FIRST CHECK FOR OTHER ELEM                
         BE    INVR23B5  (IT WILL ALWAYS BE IN THE SAME PLACE)                  
*                                                                               
         CLC   PBILOTH(2),=X'0920'   OR OTHER ELEM WITH TAX                     
         BNE   INVR23C   (IT WILL ALWAYS BE IN THE SAME PLACE)                  
*                                                                               
INVR23B5 TM    PBILLIND,X'83'       SEE IF FINANCIAL BILL (ANY TYPE)            
         BZ    INVR23C                                                          
         L     R0,X+20                                                          
         A     R0,X+16              ADD CD BACK TO OPEN RECVBL                  
         ST    R0,X+20                                                          
*                                                                               
INVR23C  DS    0H                                                               
         ZAP   DUB,PBILLRCV                                                     
*                                                                               
         CLC   PBILOTH(2),=X'091E'    FIRST CHECK FOR OTHER ELEM                
         BE    INVR23C5  (IT WILL ALWAYS BE IN THE SAME PLACE)                  
*                                                                               
         CLC   PBILOTH(2),=X'0920'   OR OTHER ELEM WITH TAX                     
         BNE   INVR23D   (IT WILL ALWAYS BE IN THE SAME PLACE)                  
*                                                                               
*                                                                               
INVR23C5 TM    PBILLIND,X'83'       SEE IF FINANCIAL BILL (ANY TYPE)            
         BZ    INVR23D                                                          
         ZAP   DUB,PBILLCNR         YES - USE CONTRACT RECIEVABLE               
*                                                                               
         TM    PBILLIND,X'80'       SEE IF COST2 TYPE                           
         BZ    *+10                                                             
         ZAP   DUB,PBILLRCV        USE REAL RCVBL                               
*                                                                               
INVR23D  TM    PBILBASA,X'04'                                                   
         BNZ   INVR23D5                                                         
         SP    DUB,PPBVEBC          SUBTRACT CD OUT NOW                         
*                                                                               
INVR23D5 CLI   PBILSEP,C'C'         SEE IF SEPERATE CD INV                      
         BNE   *+10                                                             
         SR    R0,R0                                                            
         B     *+10                                                             
         SP    DUB,PBILLNET                                                     
         CVB   R0,DUB                                                           
         ST    R0,X+12              EFFECTIVE AGY COMM                          
*                                                                               
*   NOTE - FOR COST2 TYPE FINANCIAL  AGY COMM = OPEN RCVBL                      
*          MINUS CONTRACT NET                                                   
*                                                                               
         TM    PBILCMSW,BSTCMONQ    TEST COMMISSION ONLY BILL                   
         BZ    INVR23E                                                          
         MVC   X+12(4),X+8          SET EFF AC = BILL ACTUAL                    
         XC    X+4(4),X+4           CLEAR NET                                   
         B     INVR23E                                                          
**NO-OP                                                                         
**       L     R0,X                 SET AC=GROSS SO NET =0                      
**       L     RF,ADAGY                                                         
**       CLI   PAGYPROF+14-PAGYREC(RF),C'0'                                     
**       BNE   *+8                                                              
**       S     R0,X+16              INCLUDE CD                                  
**       ST    R0,X+4                                                           
*                                                                               
INVR23E  DS    0H                                                               
         TM    PBILCMSW,BSTTAORQ    TEST AOR BILL                               
         BNO   INVR23X                                                          
         MVC   X+12(4),X+8          SET EFF AC = BILL ACTUAL                    
         XC    X+4(4),X+4           CLEAR NET                                   
         B     INVR23X                                                          
***NO-OP***                                                                     
****     TM    PBILCMSW,X'C2'       TEST COMM ONLY BILL                         
***                                ALSO ADJ SEP OR CD SEP                       
***                                                                             
****     BZ    *+10                                                             
****     XC    X+4(4),X+4          IF SO SET NET=0 (COMM = ACTUAL)              
****     L     R0,X+8              ACT                                          
****     S     R0,X+4              -NET                                         
****     A     R0,X+16             PLUS CD                                      
****     ST    R0,X+12             = COMM                                       
****     L     R0,X                GROSS-CD                                     
****     A     R0,X+16                                                          
****     ST    R0,X                NOW GROSS                                    
*                                                                               
INVR23X  DS    0H                                                               
*                                                                               
*        BELIEVE IT OR NOT                                                      
*        X = GROSS                                                              
*        X+4 = NET                                                              
*        X+8 = ACTUAL                                                           
*        X+12 = COMMISSION                                                      
*        X+16 = CD                                                              
*        X+20 = OPEN ACTUAL (RECVBL)                                            
*        X+24 = OPEN GROSS                                                      
*                                                                               
*                                                                               
INVR24   DS    0H                                                               
***R***                                                                         
*        FINALLY ADD GST AND PST TO X+8 (ACTUAL)                                
         L     R0,X+8                                                           
         A     R0,PPBVGST                                                       
         A     R0,PPBVPST                                                       
         ST    R0,X+8                                                           
*                                                                               
INVR24A  DS    0H                                                               
         CLI   PBILLTYP,C'R'       SEE IF DOING FINANCIAL REBATE BILL           
         BNE   INVR24B                                                          
         XC    X+12(4),X+12        NO COMMISSION ON REBATE REGISTER             
         XC    X+20(4),X+20        NO OPEN ACTUAL FOR REBATE REGISTER           
***R***                                                                         
*                                                                               
INVR24B  DS    0H                  MOVE VALUES FROM X (28)                      
*                                  TO BILLTOTS FOR PRINTING                     
         LA    R3,BILLTOTS         FIRST CLEAR BILLTOTS                         
         BAS   RE,CLRTOTS                                                       
*                                                                               
         LA    R3,X                                                             
         LA    R4,BILLTOTS                                                      
         LA    R1,7                FOR BCT                                      
*                                                                               
INVR24C  L     R0,0(R3)                                                         
         CVD   R0,DUB                                                           
         ZAP   0(8,R4),DUB                                                      
         LA    R3,4(R3)                                                         
         LA    R4,8(R4)                                                         
         BCT   R1,INVR24C                                                       
*                                                                               
INVR24D  BAS   RE,IRFMTL                                                        
         CLI   PBRETAIL,X'81'      TEST CORP CONTROL                            
         BNE   INVR24X                                                          
         LA    R4,ILCOL2-1         YES-* BEFORE ACT                             
         CLI   1(R4),C' '                                                       
         BNE   *+12                                                             
         LA    R4,1(R4)                                                         
         B     *-12                                                             
         MVI   0(R4),C'*'                                                       
INVR24X  DS    0H                                                               
*                                                                               
         LA    R3,BILLTOTS        ROLL TO INVOICE TOTALS                        
         LA    R4,IRITOTS                                                       
         BAS   RE,ROLTOTS                                                       
*                                                                               
         L     R4,DBTOTS           ADD TO BILL COUNTER                          
         LA    R4,1(R4)                                                         
         ST    R4,DBTOTS                                                        
*                                                                               
         CLI   PBRETAIL,X'81'      DONT ADD FOR CORP CONTROL                    
         BE    INVR26                                                           
*                                                                               
         LA    R3,BILLTOTS        ROLL TO CLIENT TOTALS                         
         LA    R4,IRCTOTS                                                       
         BAS   RE,ROLTOTS                                                       
*                                                                               
         LM    R3,R6,IRCTOTS       ROLL TO CLIENT TOTALS                        
*                                                                               
INVR26   DS    0H                                                               
         MVI   ALLOWLIN,3                                                       
         MVC   KEY1,PBILLKEY                                                    
         MVC   BINVDTE,PBILINVD                                                 
         MVC   BDUEDTE,PBILDUED                                                 
         GOTO1 APRNT                                                            
         B     INVR2                                                            
*                                                                               
INVR30   TM    AORSW,X'02'         SEE IF I JUST DID AOR REGISTER               
         BO    INVRX               YES - THEN DONE                              
         TM    AORSW,X'01'         SEE IF AOR BILLS FOUND                       
         BNO   INVRX               NO - THEN NO AOR REGISTER                    
         OI    AORSW,X'02'         NO DO AOR REGISTER                           
         MVC   SAVEDA,SAVR1        MUST RESTORE FIRST DISK ADDR                 
         B     INVR1                                                            
*                                  FORMAT AMOUNTS                               
         SPACE 3                                                                
IRFMTL   NTR1                                                                   
         SPACE 2                                                                
         LA    R3,BILLTOTS+16      ACTUAL                                       
         LA    R5,ILCOL1                                                        
         BAS   RE,IRFEDT                                                        
         ZAP   MYDUB,BILLTOTS+8(8)     NET                                      
         L     RF,ADAGY                                                         
         CLI   PAGYPROF+14-PAGYREC(RF),C'0'                                     
         BNE   *+10                                                             
         SP    MYDUB,BILLTOTS+32(8)  SUBTRACT CD                                
         LA    R3,MYDUB                                                         
         LA    R5,ILCOL2                                                        
         BAS   RE,IRFEDT                                                        
*                                                                               
         LA    R3,BILLTOTS+24      COMMISSION                                   
         LA    R5,ILCOL3                                                        
         BAS   RE,IRFEDT                                                        
         LA    R3,BILLTOTS+0       GROSS                                        
         LA    R5,ILCOL4                                                        
         BAS   RE,IRFEDT                                                        
         LA    R3,BILLTOTS+32      CD                                           
         LA    R5,ILSTRIP                                                       
         BAS   RE,IRFEDT                                                        
         CP    BILLTOTS+40(8),=P'0'   CHK FOR OPEN ACTUAL (RECVBL)              
         BE    IRFMTL5                                                          
         LA    R3,BILLTOTS+40                                                   
*--->    MVC   ILCOL1+127(5),=C'OPEN='                                          
         MVC   ILCOL1+127(L'PP@OPEN),PP@OPEN                                    
**CARAT                                                                         
         CLI   ROPENSW,C'Y'                                                     
         BE    *+10                                                             
*******  CLC   RCSVAGY,=C'UB'                                                   
*******  BNE   *+10                                                             
         MVC   ILCOL1+127(5),=C'COST2'                                          
*                                                                               
         LA    R5,ILCOL1+132      PUT IN SECOND LINE                            
         BAS   RE,IRFEDT                                                        
*                                                                               
IRFMTL5  CP    BILLTOTS+48(8),=P'0'  CHK FOR OPEN GROSS                         
         BE    INVRX                                                            
         LA    R3,BILLTOTS+48                                                   
*--->    MVC   ILCOL4+127(5),=C'OPEN='                                          
         MVC   ILCOL4+127(L'PP@OPEN),PP@OPEN                                    
**CARAT                                                                         
         CLI   ROPENSW,C'Y'                                                     
         BE    *+10                                                             
******** CLC   RCSVAGY,=C'UB'                                                   
******** BNE   *+10                                                             
         MVC   ILCOL4+127(5),=C'COST2'                                          
*                                                                               
         LA    R5,ILCOL4+132      PUT IN SECOND LINE                            
         BAS   RE,IRFEDT                                                        
         B     INVRX                                                            
         SPACE 2                                                                
IRFEDT   DS    0H                                                               
         ST    RE,DUB                                                           
*--->    EDIT  (R0),(16,0(R5)),2,COMMAS=YES,CR=YES                              
         CURED (P8,0(R3)),(16,0(R5)),CURTAB,COMMAS=YES,CR=YES                   
         CLI   14(R5),C' '                                                      
         BNE   *+10                                                             
         MVC   14(2,R5),TOTSTAR                                                 
         MVC   TOTSTAR,SPACES                                                   
         L     RE,DUB                                                           
         BR    RE                                                               
         SPACE 2                                                                
INVRX    DS    0H                                                               
         DROP  R8                                                               
         XIT1                                                                   
         SPACE 3                                                                
*                                                                               
INXTEL   DS    0H                                                               
         ZIC   R0,1(R3)                                                         
         AR    R3,R0                                                            
         CLI   0(R3),0                                                          
         BE    INXTEL2                                                          
         CLC   0(1,R3),ELCODE                                                   
         BER   RE                                                               
         B     INXTEL                                                           
*                                                                               
INXTEL2  LTR   RE,RE                                                            
         BR    RE                                                               
*                                                                               
ROLTOTS  DS    0H                                                               
         LA    R0,7           FOR BCT                                           
ROLTOTS2 DS    0H                                                               
         AP    0(8,R4),0(8,R3)                                                  
         LA    R4,8(R4)                                                         
         LA    R3,8(R3)                                                         
         BCT   R0,ROLTOTS2                                                      
         BR    RE                                                               
         SPACE 3                                                                
CLRTOTS  DS    0H                                                               
         LA    R0,7                                                             
         ZAP   0(8,R3),=PL8'0'                                                  
         LA    R3,8(R3)                                                         
         BCT   R0,*-10                                                          
         BR    RE                                                               
*                                                                               
         SPACE 3                                                                
MEDLIST  DS    0C                                                               
MEDNEWS  DC    C'NNEWSPAPERS'                                                   
MEDMAG   DC    C'MMAGAZINES '                                                   
MEDTRD   DC    C'TTRADE     '                                                   
MEDINTR  DC    C'IINTERACTV '                                                   
MEDSPL   DC    C'SSUPLEMENTS'                                                   
MEDOUT   DC    C'OOUTDOOR   '                                                   
         DC    X'FFFF'                                                          
         SPACE 3                                                                
MYDUB    DS    PL8                                                              
         DS    0D              FOR ALIGNMENT                                    
BILLTOTS DS    7PL8                                                             
IRITOTS  DS    7PL8                                                             
IRCTOTS  DS    7PL8                                                             
IRMTOTS  DS    7PL8                                                             
*                                                                               
         SPACE 2                                                                
       ++INCLUDE PNBVALD                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
ROPENSW  DC    C'N'                                                             
*                                                                               
*        LIST OF FINANCIAL AGENCIES - IF NOT IN THIS TABLE                      
*        "OPEN" REGISTER AMOUNCS WILL DISPLAY AS "COST2"                        
*                                                                               
FAGYTAB  DC    C'DMMKMXWIWJWTXD'                                                
         DC    X'FF'          END OF TABLE                                      
*                                                                               
         EJECT                                                                  
BSTCMONQ EQU   X'02'                                                            
BSTCAORQ EQU   X'10'                                                            
BSTTAORQ EQU   X'20'                                                            
BSTSADJQ EQU   X'80'                                                            
BSTNTXAQ EQU   X'04'                                                            
BSTSCOMQ EQU   X'01'                                                            
BSTSNETQ EQU   X'08'                                                            
*                                                                               
       ++INCLUDE PBLPSTEL                                                       
*                                                                               
       ++INCLUDE PPREPB1WRK                                                     
       ++INCLUDE PPBDICS                                                        
*                                                                               
INVREG   CSECT                                                                  
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'031PPREPB12B 05/01/02'                                      
         END                                                                    

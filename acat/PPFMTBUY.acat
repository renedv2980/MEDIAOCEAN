*          DATA SET PPFMTBUY   AT LEVEL 234 AS OF 06/30/08                      
*CATALP PPFMTBUY                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'INSERTION ORDERS - BUY DESCRIPTION'                             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* KWAN 03/06/08 COPY SPLIT COMMENTS                                             
*                                                                               
* KWAN 04/11/06 BUY MOVE INSERTION CHANGES                                      
*                                                                               
* KWAN 10/17/05 DO NOT STRIP LEADING SPACES FOR COMMENTS                        
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMTBUY   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 FMTBUYDX-FMTBUYD,*FMTBUY*,RR=RE,CLEAR=YES                        
*                                                                               
         LR    R6,RC                                                            
         USING FMTBUYD,R6          R6 = A(LOCAL STORAGE)                        
*                                                                               
         ST    RE,RELO                                                          
*                                                                               
         L     RC,0(R1)                                                         
         USING POLWRKD,RC                                                       
         USING T41FFFD,RA                                                       
         USING IOWORKD,R8                                                       
         L     R9,PPFILEC                                                       
         USING POLFILED,R9                                                      
*                                                                               
         BRAS  RE,INITWKST                                                      
*                                                                               
         BRAS  RE,LEGALW           LOOK UP LW AND QU COMMENT CODES              
*                                                                               
         MVC   THISBUY,SPACES                                                   
         L     R2,LASTIOEL                                                      
         USING PIOELEM,R2                                                       
         CLI   CHANGSW,C'D'                                                     
         BNE   FB2                                                              
*                                                                               
* IF DELETE USE LAST IO ELEM, MOVE FLDS INTO PBDELEM, SAVE REAL PBDELEM         
*                                                                               
         LA    R4,SAVEBEL                                                       
         MVC   0(256,R4),PBDELEM                                                
         MVC   PBDSPACE,PIOSPACE                                                
         CLI   QMEDIA,C'N'                                                      
         BNE   FB2                                                              
         MVC   PBDCL,PIOPRM                                                     
         ZAP   PBDUNITS,PIOUNITS                                                
         ZAP   PBDCLMS,PIOCLMS                                                  
         MVC   PBDUIND,PIOUIND                                                  
         MVC   PBDSPACE(6),PIOSAU                                               
         XC    PBDSPACE+6(11),PBDSPACE+6                                        
         OC    PBDSPACE,SPACES                                                  
*                                                                               
FB2      DS    0H                                                               
         MVC   DAYOFWK,SPACES                                                   
         CLI   DOWOPT,C'Y'         SEE IF SHOWING DAY OF WEEK                   
         BNE   FB2X                                                             
         CLI   PBDFREQ,C'M'                                                     
         BE    FB2X                                                             
         CLI   PBDBFD,C'B'         DON'T DO FOR BEST FOOD DAY                   
         BE    FB2X                                                             
         CLI   PBDBFD,C'W'         OR WEEK OF                                   
         BE    FB2X                                                             
         GOTOR DATCON,DMCB,(3,PBUYKDAT),(0,WORK)                                
         GOTOR VGETDAY,DMCB,WORK,WORK+6                                         
         MVC   DAYOFWK,WORK+6                                                   
         CLI   LANG,C'F'           FRENCH I/O?                                  
         BNE   FB2X                                                             
         BRAS  RE,BFRDAY                                                        
         MVC   DAYOFWK,WORK+6      FRENCH DAY OF WEEK                           
*                                                                               
FB2X     DS    0H                                                               
         LA    R7,BUYOUTA                                                       
         USING PPBYOUTD,R7                                                      
         XC    PBYOINPT(24),PBYOINPT                                            
         LA    R3,PBUYREC                                                       
         L     R4,DATCON                                                        
         LA    R5,GROSS                                                         
         STM   R3,R5,PBYOINPT                                                   
         OI    PBYOCTL,X'03'       NO LINE NO. + NET RATES                      
*                                                                               
         CLI   LANG,C'F'           SEE IF FRENCH LANG I/O                       
         BNE   *+8                                                              
         OI    PBYOCLT2,X'40'      FRENCH DATA                                  
*                                                                               
         MVC   SVCTYP,PBDCTYP      SAVE REAL COST TYPE                          
         MVI   NETSW,C'N'                                                       
         CLI   COSTOPT,C'Y'        SHOWING NET ONLY IF INPUT AS NET?            
         BNE   FB3A2                                                            
         CLI   PBDCOSIN,C'S'       SHOW NET FOR "S" RATE BUYS?                  
         BE    FB3A1                                                            
         CLI   PBDCTYP,C'N'                                                     
         BNE   FB3A8                                                            
FB3A1    MVI   NETSW,C'Y'                                                       
         B     FB3A8                                                            
*                                                                               
FB3A2    CLI   COSTOPT,C'T'        SEE IF SHOWING NET                           
         BNE   FB3A4                                                            
FB3A3    MVI   PBDCTYP,C'N'        FOOL PPBYOUT TO RETURN NET RATE              
         MVI   NETSW,C'Y'                                                       
         B     FB3A8                                                            
*                                                                               
FB3A4    DS    0H                                                               
         CLI   COSTOPT,C'B'        SHOWING GROSS AND NET?                       
         BE    FB3A5                                                            
         CLI   COSTOPT,C'B'        SEE IF SHOWING GROSS                         
         BNE   *+8                                                              
FB3A5    MVI   PBDCTYP,C' '        FOOL PPBYOUT TO RETURN GROSS RATE            
*                                                                               
FB3A8    GOTO1 APPBYOUT,DMCB,BUYOUTA                                            
*                                                                               
         MVC   PBDCTYP,SVCTYP      RESTORE SAVED COST TYPE                      
*                                                                               
         IC    RF,LINE                                                          
         LA    RF,8(RF)                                                         
         STC   RF,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BL    *+10                                                             
         XC    LASTBUY,LASTBUY                                                  
*                                                                               
         OC    LASTBUY,LASTBUY                                                  
         BNZ   FB3A15                                                           
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
*--->    MVC   P(80),BUYHD1                                                     
*--->    MVC   PSECOND(80),BUYHD2                                               
         MVC   P(L'PP@IOF1),PP@IOF1                                             
         MVC   PSECOND(L'PP@IOF2),PP@IOF2                                       
         DROP  RF                                                               
*                                                                               
         CLI   COPYOPT,C'Y'        SUPPRESSING COPY?                            
         BNE   FB3A12                                                           
         MVC   P+33(11),SPACES                                                  
         MVC   PSECOND+33(11),SPACES                                            
*                                                                               
FB3A12   CLI   QMEDIA,C'O'                                                      
         BNE   FB3A12C                                                          
         MVC   P+1(13),SPACES                                                   
         MVC   PSECOND+1(13),SPACES                                             
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
*--->    MVC   P+3(11),=C'  DATE     '                                          
*--->    MVC   PSECOND+9(3),SPACES                                              
         MVC   P+3(L'PP@DATE),PP@DATE                                           
         MVC   PSECOND+3(L'PP@DATE),DASHES                                      
         DROP  RF                                                               
*                                                                               
FB3A12C  MVI   LINENEED,8                                                       
         B     FB3A18                                                           
*                                                                               
FB3A15   MVI   LINENEED,6                                                       
FB3A18   GOTOR AIOPRNT,DMCB,(RC)                                                
         CLI   PBDBFD,C'W'                                                      
         BNE   FB3B                                                             
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
*--->    MVC   P+1(9),=C'WEEK OF -'                                             
         MVC   P+1(L'PP@WKOF),PP@WKOF                                           
         DROP  RF                                                               
         B     FB3B10                                                           
*                                                                               
FB3B     CLI   PBDBFD,C'B'                                                      
         BNE   FB3D                                                             
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
*--->    MVC   P+1(13),=C'BEST FOOD DAY'                                        
*--->    MVC   PSECOND+1(9),=C'WEEK OF -'                                       
         MVC   P+1(L'PP@BFD),PP@BFD                                             
         MVC   PSECOND+1(L'PP@WKOF),PP@WKOF                                     
         DROP  RF                                                               
*                                                                               
FB3B10   DS    0H                                                               
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
FB3D     DS    0H                                                               
         MVI   LINENEED,3                                                       
         CLI   CHANGSW,C'D'                                                     
         BNE   FB3D10                                                           
         LA    R5,PIOIDATE                                                      
         GOTO1 DATCON,DMCB,(3,0(R5)),(5,WORK)                                   
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
*                                                                               
         MVC   P+1(8),WORK         MMMDD/YY                                     
         CLI   PBDFREQ,C'M'                                                     
         BNE   *+10                                                             
         MVC   P+4(5),P+6          MMM/YY                                       
         B     FB3D10B             THEN DO 2ND DATE IF ANY                      
*                                  (NOTE - 2ND DATE FROM CURRENT REC)           
FB3D10   DS    0H                                                               
         MVC   WORK(8),PBYOMDY                                                  
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
*                                                                               
         MVC   P+1(8),WORK                                                      
*                                                                               
FB3D10B  DS    0H                                                               
         CLI   PBYOMDY2,C' '                                                    
         BE    FB3D20                                                           
         MVI   PSECOND+1,C'-'                                                   
         MVC   WORK(8),PBYOMDY2                                                 
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   PSECOND+2(8),WORK                                                
*                                                                               
         CLI   QMEDIA,C'N'         MMM/YY, -MMM/YY FOR NON-NEWS?                
         BNE   FB3D25                                                           
         MVI   PSECOND,C'+'                                                     
         MVC   PSECOND+1(8),WORK                                                
         MVI   PSECOND+9,C' '                                                   
         CLI   PBUYKLIN,1          LINE 1?                                      
         BH    *+16                                                             
*                                  SET E/M INDS                                 
         MVC   P+9(2),PBYOINS+5                                                 
         MVC   PSECOND+9(2),PBYOINS2+5                                          
         B     FB3D25                                                           
*                                                                               
FB3D20   DS    0H                                                               
         CLC   PBYOISNM,SPACES                                                  
         BE    FB3D25                                                           
         MVC   PSECOND+2(11),PBYOISNM                                           
         B     FB3D25                                                           
*                                                                               
FB3D25   DS    0H                  SPACE/LINES                                  
         BRAS  RE,BLDCTAB                                                       
*                                                                               
         CLI   QMEDIA,C'N'                                                      
         BNE   FB3D30                                                           
*                                  NON-NEWS SPACES                              
         CLI   PBYOSPC,C' '                                                     
         BE    FB4                                                              
*                                                                               
* FOR OUTDOOR PAINT AND ROTARY, USED TO SUPPRESS PBYOSPC DISPLAY                
*                                                                               
FB3D30   DS    0H                                                               
         MVC   P+15(17),PBYOSPC                                                 
         MVC   PSECOND+15(20),PBYOSPC2                                          
         CLI   QMEDIA,C'N'                                                      
         BNE   FB3F10                                                           
         CLI   PBDCL,C' '                                                       
         BNH   FB3F10                                                           
         LA    R3,PSECOND+15                                                    
         CLI   0(R3),C' '                                                       
         BE    FB3F5                                                            
         LA    R4,1(R3)                                                         
         LA    R3,3(R3)                                                         
         LA    R5,19                                                            
FB3F2    CLI   0(R4),C' '                                                       
         BE    FB3F5                                                            
         LA    R4,1(R4)                                                         
         LA    R3,1(R3)                                                         
         BCT   R5,FB3F2                                                         
*                                                                               
FB3F5    MVC   0(1,R3),PBDCL                                                    
         MVI   1(R3),C'C'                                                       
*                                                                               
FB3F10   DS    0H                                                               
         MVC   W,SPACES                                                         
         CLI   PSECOND+15,C' '                                                  
         BNE   FB6                                                              
*                                                                               
         CLI   DSPOPT,C'Y'         SEE IF DOUBLE SPACING                        
         BE    FB6                 DON'T USE PSECOND FOR COMTAB DATA            
*                                                                               
         CLC   PJOBCAP2,SPACES     SEE IF I HAVE SECOND CAPTION LINE            
         BH    FB6                 YES - IT USES PSECOND SO I CAN'T             
*                                                                               
* YES I KNOW I'M NOT CHECKING HERE FOR CAP= OVERRIDES                           
*                                                                               
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BE    FB3F20              YES - CAN USE PSECOND                        
         CLC   QPROG,=C'73'        PROOF RUN SHOWS AD NUMBER                    
         BE    FB6                                                              
         CLI   ADOPT,C'Y'          SHOWING AD NUMBER                            
         BE    FB6                 AD NUMBER USES PSECOND                       
FB3F20   BRAS  RE,FNDIOC                                                        
         OC    W(5),W              FIRST CHECK FOR ZEROS                        
         BZ    FB3F22                                                           
         CLC   W(5),SPACES                                                      
         BNE   FB3F24                                                           
FB3F22   MVC   PSECOND+15(65),W+5                                               
         MVC   W,SPACES                                                         
         B     FB6                                                              
*                                                                               
FB3F24   DS    0H                                                               
         MVC   PSECOND+10(70),W                                                 
         MVC   W,SPACES                                                         
         B     FB6                                                              
*                                  NEWS                                         
FB4      DS    0H                                                               
         BRAS  RE,FMT_NSPD         RETURN OUPUT IN TMPWK1                       
         MVC   P+15(17),TMPWK1                                                  
*                                                                               
         MVC   PSECOND+15(17),PBYOLBC                                           
         MVC   W,SPACES                                                         
*                                                                               
FB5      DS    0H                                                               
         CLI   PSECOND+15,C' '                                                  
         BNE   FB6                                                              
*                                                                               
         CLI   DSPOPT,C'Y'         SEE IF DOUBLE SPACING                        
         BE    FB6                 DON'T USE PSECOND FOR COMTAB DATA            
*                                                                               
         CLC   PJOBCAP2,SPACES                                                  
         BH    FB6                 CAN'T USE PSECOND                            
*                                                                               
* YES,I KNOW I'M NOT CHECKING HERE FOR CAP= OVERRIDES                           
*                                                                               
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BE    FB5C                YES - CAN USE PSECOND                        
         CLC   QPROG,=C'73'        PROOF RUN SHOWS AD NUMBER                    
         BE    FB6                                                              
         CLI   ADOPT,C'Y'          SHOWING AD NUMBER                            
         BE    FB6                                                              
FB5C     BRAS  RE,FNDIOC                                                        
         OC    W(5),W              FIRST CHECK FOR ZEROS                        
         BZ    FB5E                                                             
         CLC   W(5),SPACES                                                      
         BNE   FB5G                                                             
FB5E     MVC   PSECOND+15(65),W+5                                               
         MVC   W,SPACES                                                         
         B     FB6                                                              
*                                                                               
FB5G     DS    0H                                                               
         MVC   PSECOND+10(70),W                                                 
         MVC   W,SPACES                                                         
*                                  COPY NUMBER                                  
FB6      DS    0H                                                               
         MVI   BYTE,0                                                           
         CLI   CHANGSW,C'D'                                                     
         BNE   FB6B                                                             
         CLC   PBDJOB,PIOJOB       DIFFERENT JOBS                               
         BNE   FB6D                                                             
*                                  COPY NUMBER                                  
FB6B     DS    0H                                                               
         CLI   COPYOPT,C'Y'        SEE IF SUPPRESSING COPY                      
         BE    FB6B4                                                            
         MVC   P+33(17),PJOBCPY                                                 
*                                                                               
* SEE IF OVERRIDING COPY WITH COPY= COMMENT ELEMENT IN BUY                      
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'66'                                                     
FB6B2    BRAS  RE,NXTEL                                                         
         BNE   FB6B4                                                            
         CLC   2(5,R2),=C'COPY='                                                
         BNE   FB6B2               KEEP LOOKING                                 
         MVC   P+33(17),SPACES                                                  
         ZIC   R1,1(R2)                                                         
         AHI   R1,-8                                                            
         BNP   FB6B4                                                            
         CHI   R5,16                                                            
         BNH   *+8                                                              
         LHI   R5,16               MAX IS 17 CHARS                              
         EX    R1,*+8                                                           
         B     *+10                                                             
*                                                                               
         MVC   P+33(0),7(R2)       EXECUTED                                     
         OI    DITTOSW,X'01'       TO SUPPRESS DITTOS - COPY                    
         OI    BYTE,X'01'          COPY OVERRIDE                                
*                                                                               
FB6B4    CLI   ADOPT,C'Y'          SEE IF SHOWING AD NUMBER                     
         BE    FB6B5                                                            
*                                                                               
         CLC   QPROG,=C'73'        TEST PROOF RUN                               
         BNE   FB6C                                                             
*                                                                               
FB6B5    DS    0H                                                               
         CLI   COPYOPT,C'Y'       SEE IF SUPPRESSING COPY                       
         BNE   FB6B6              IF YES  - USE P                               
*--->    MVC   P+33(17),=C'(AD NO. =       )'                                   
         MVI   P+33,C'('                                                        
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   P+34(L'PP@ADNO),PP@ADNO                                          
         DROP  RF                                                               
         MVI   P+49,C')'                                                        
*                                                                               
         MVC   P+43(6),PBDJOB                                                   
         LA    R1,P+48                                                          
         B     FB6B7                                                            
*                                                                               
FB6B6    DS    0H                                                               
*--->    MVC   PSECOND+33(17),=C'(AD NO. =       )'                             
         MVI   PSECOND+33,C'('                                                  
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   PSECOND+34(L'PP@ADNO),PP@ADNO                                    
         DROP  RF                                                               
         MVI   PSECOND+49,C')'                                                  
*                                                                               
         MVC   PSECOND+43(6),PBDJOB                                             
         LA    R1,PSECOND+48       LEFT ALIGN LAST )                            
FB6B7    LA    R2,5                                                             
FB6B8    CLI   0(R1),C' '                                                       
         BNE   FB6C                                                             
         MVI   0(R1),C')'                                                       
         MVI   1(R1),C' '          BLANK OUT OLD                                
         BCTR  R1,0                                                             
         BCT   R2,FB6B8                                                         
*                                  CAPTION                                      
FB6C     DS    0H                                                               
*                                                                               
* SEE IF OVERRIDING CAPTION WITH CAP= COMMENT ELEMENT IN BUY                    
*                                                                               
         LA    R1,P+52                                                          
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'66'                                                     
FB6C2    BRAS  RE,NXTEL                                                         
         BNE   FB6D                                                             
         CLC   2(4,R2),=C'CAP='                                                 
         BNE   FB6C2               KEEP LOOKING                                 
         ZIC   R5,1(R2)                                                         
         AHI   R5,-7                                                            
         BNP   FB6C4                                                            
         CHI   R5,24                                                            
         BNH   *+8                                                              
         LHI   R5,24               MAX IS 25 CHARS                              
         EX    R5,*+8                                                           
         B     *+10                                                             
*                                                                               
         MVC   0(0,R1),6(R2)       EXECUTED                                     
*                                                                               
FB6C4    LA    R1,132(R1)                                                       
         OI    BYTE,X'02'                                                       
         OI    DITTOSW,X'02'       SUPPRESS DITTOS CAPTION                      
         B     FB6C2               DO MORE ELEMENTS                             
*                                                                               
FB6D     DS    0H                                                               
         TM    BYTE,2              SEE IF CAP= ELEMENTS FOUND                   
         BO    FB6D3                                                            
         LA    R1,P+52                                                          
         MVC   0(25,R1),PJOBCAP1                                                
         CLC   PJOBCAP2,SPACES     SEE IF THERE IS A SECOND CAPTION             
         BNH   FB6D3               NO- SO I WON'T CLOBBER COMMENT IN            
*                                  PSECOND                                      
         MVC   132(25,R1),PJOBCAP2                                              
*                                                                               
FB6D3    DS    0H                                                               
*                                                                               
         MVC   THISBUY(17),P+15                                                 
         MVC   THISBUY+17(17),PSECOND+15                                        
*                                                                               
         MVC   THISBUY(6),PBDJOB   SAVE JOB SO I CAN CHECK CHANGE               
*                                                                               
         OC    LASTBUY,LASTBUY     TEST IF FIRST FOR THIS IO OR PAGE            
         BZ    FB6H                YES                                          
*                                                                               
         CLC   LASTBUY(6),THISBUY  CHECK FOR CHANGE OF JOB                      
         BNE   FB6H                YES  - CAN'T DO DITTOS                       
*                                                                               
         CLC   LASTBUY,THISBUY                                                  
         BNE   FB6F                                                             
         CLI   THISBUY+34,C'C'     TEST IOC'S THIS TIME OR LAST TIME            
         BE    FB6F                NO DITTOS HERE                               
*                                                                               
         TM    DITTOSW,X'01'       COPY OVERRIDE                                
         BO    FB6F                - NO DITTOS                                  
*                                                                               
         CLI   COSTOPT,C'N'        SHOWING COST?                                
         BNE   FB6E                                                             
         CLI   ACOPT,C'Y'          OR AC                                        
         BE    FB6E                                                             
         CLI   ACOPT,C'$'          OR AC $                                      
         BE    FB6E                                                             
         CLI   CDOPT,C'Y'          OR CD                                        
         BE    FB6E                                                             
         CLI   CDOPT,C'$'          OR CD $                                      
         BE    FB6E                                                             
*                                                                               
* THEN DITTOS ONLY FOR COPY AND CAPTION, LEAVE SPACE ALONE                      
*                                                                               
         MVC   P+15(17),SPACES                                                  
*--->    CLC   PSECOND+15(3),=C'*MA'                                            
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         CLC   PSECOND+15(3),PP@MATCD                                           
         BE    *+10                                                             
         MVC   PSECOND+15(17),SPACES                                            
         MVC   W,SPACES                                                         
         MVC   P+15+1(2),DITTOS                                                 
         DROP  RF                                                               
*                                                                               
FB6E     DS    0H                                                               
         MVC   P+33(17),SPACES                                                  
         MVC   P+33+4(2),DITTOS                                                 
*                                                                               
FB6F     DS    0H                                                               
         TM    DITTOSW,X'02'       CAPTION OVERRIDE                             
         BO    FB6H                                                             
         MVC   P+52(25),SPACES                                                  
         MVC   PSECOND+52(25),SPACES                                            
         MVC   P+52+4(2),DITTOS                                                 
*                                                                               
FB6H     DS    0H                                                               
         CLI   BYTE,0                                                           
         BNE   *+8                                                              
         MVI   DITTOSW,0                                                        
*                                                                               
* IF BUY JUST PRINTED OVERRODE, COPY OR CAPTION                                 
* - YES, LEAVE DITTOSW                                                          
* - NO,  RESET TO X'00' SO DITTOS APPEAR                                        
*                                                                               
         CLC   DAYOFWK,SPACES                                                   
         BE    FB6HX5                                                           
         CLC   PSECOND+1(6),SPACES                                              
         BNE   FB6HX5                                                           
         MVC   PSECOND+1(3),DAYOFWK                                             
         MVC   DAYOFWK,SPACES                                                   
*                                                                               
FB6HX5   DS    0H                                                               
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
         CLC   W,SPACES            MAY STILL NEED TO PRINT W                    
         BE    FB7                                                              
         MVC   P+15(45),W                                                       
         CLC   DAYOFWK,SPACES      SEE IF PRINTED YET                           
         BE    FB6HX7                                                           
         MVC   P+1(3),DAYOFWK      PRINT AND CLEAR                              
         MVC   DAYOFWK,SPACES                                                   
*                                                                               
FB6HX7   DS    0H                                                               
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
FB7      DS    0H                                                               
         BRAS  RE,FNDIOC                                                        
         CLC   W(70),SPACES                                                     
         BE    FB8                                                              
         MVC   P+10(70),W                                                       
*                                                                               
         CLC   DAYOFWK,SPACES                                                   
         BE    FB7BX                                                            
         MVC   P+1(3),DAYOFWK   PRINT AND CLEAR                                 
         MVC   DAYOFWK,SPACES                                                   
FB7BX    DS    0H                                                               
         GOTOR AIOPRNT,DMCB,(RC)                                                
         B     FB7                                                              
FB8      DS    0H                                                               
*                                                                               
* IT IS POSSIBLE THAT DAY OF WEEK NOT YET PRINTED, THIS ENSURES IT              
*                                                                               
         CLC   DAYOFWK,SPACES                                                   
         BE    FB8X                                                             
         MVC   P+1(3),DAYOFWK      PRINT AND CLEAR                              
         MVC   DAYOFWK,SPACES                                                   
         GOTOR AIOPRNT,DMCB,(RC)                                                
*                                                                               
FB8X     DS    0H                                                               
         MVC   LASTBUY,THISBUY                                                  
         CLI   CHANGSW,C'D'                                                     
         JNE   EXIT                                                             
*                                  RESTORE "REAL" PBDELEM IF DELETE             
         LA    R4,SAVEBEL                                                       
         SR    R5,R5                                                            
         IC    R5,1(R4)                                                         
         BCTR  R5,R0                                                            
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   PBDELEM(0),0(R4)                                                 
*                                                                               
EXITY    CR    RB,RB               EQUAL                                        
         J     *+6                                                              
EXITN    LTR   RB,RB               NOT EQUAL                                    
*                                                                               
EXIT     XIT1                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FNDIOC   DS    0H                  GET IOC COMMENT                              
         MVC   W(70),SPACES                                                     
         L     R3,ANXTCOM                                                       
         CLI   0(R3),X'FF'         END OF TABLE                                 
         BER   RE                                                               
*                                                                               
         MVC   W(70),0(R3)                                                      
         LA    R3,70(R3)                                                        
         ST    R3,ANXTCOM                                                       
         BR    RE                                                               
*                                                                               
FBEDL    DS    0H                                                               
         CLI   PBDUIND,X'89'       INCHES - 2 DECIMALS                          
         JNE   FBEDL5                                                           
         EDITR (P8,DUB),(10,(R4)),2,ALIGN=LEFT                                  
         J     FBEDLX                                                           
*                                                                               
FBEDL5   EDITR (P8,DUB),(10,(R4)),ALIGN=LEFT                                    
FBEDLX   BR    RE                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
NXTEL    ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLC   ELCODE,0(R2)                                                     
         JE    NXTELX              CC IS EQUAL                                  
         CLI   0(R2),0                                                          
         JNE   NXTEL                                                            
         LTR   R2,R2               CC IS NOT EQUAL                              
NXTELX   BR    RE                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DITTOS   DC    C''''''                                                          
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
INITWKST NTR1  BASE=*,LABEL=*      INITIALIZE WORKING STORAGE                   
*                                                                               
         L     RE,=V(DICSECTF)                                                  
         A     RE,RELO                                                          
         ST    RE,ADICSECT                                                      
*                                                                               
         L     RE,=V(CHOPPER)                                                   
         A     RE,RELO                                                          
         ST    RE,ACHOPPER                                                      
*                                                                               
         BRAS  RE,INICHGTB                                                      
*                                                                               
         XC    SVPUBZEC,SVPUBZEC   INIT PUB, ZONE AND EDITION                   
         XC    SVPUBZNM,SVPUBZNM   PUBLICATION ZONE NAME                        
*                                                                               
         XC    SVCONKEY,SVCONKEY   INIT CONTRACT SAVING FIELDS                  
         XC    D_CONNUM,D_CONNUM   CONTRACT NUMBER                              
         XC    D_CONSDT,D_CONSDT   CONTRACT START DATE                          
         XC    D_CONEDT,D_CONEDT   CONTRACT END DATE                            
         XC    D_CONLVL,D_CONLVL   CONTRACT LEVEL                               
*                                                                               
         L     R5,ADICSECT                                                      
         USING DICSECTF,R5                                                      
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVI   DDLANG,0            DEFAULT TO ENGLISH                           
         CLI   LANG,C'F'           FRENCH?                                      
         BNE   *+8                                                              
         MVI   DDLANG,4                                                         
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
         GOTO1 CDICTATE                                                         
*                                                                               
         ZAP   PACK1BIL,=P'1000000000'                                          
         MVC   R_MCTXT1,T_MCTXT1                                                
         MVC   R_MCTXT2,T_MCTXT2                                                
         MVC   R_MCTXT3,T_MCTXT3                                                
*                                                                               
         J     EXIT                                                             
*                                                                               
T_MCTXT1 DC    C'YOU HAVE MATERIALS. AD IS A REPEAT OF '                        
T_MCTXT2 DC    C'AD CODE '                                                      
T_MCTXT3 DC    C'AD ID '                                                        
*                                                                               
         LTORG                                                                  
         DROP  RB,R1,R5,RF                                                      
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMT_NSPD NTR1  BASE=*,LABEL=*      FORMAT NEWSPAPER SPACE DESCRIPTION           
*                                                                               
         LA    R4,TMPWK1                                                        
         XC    TMPWK1,TMPWK1                                                    
         CP    PBDUNITS,=P'0'                                                   
         BE    FB4D                                                             
         MVI   0(R4),C'0'                                                       
         LA    R0,1                                                             
         ZAP   DUB,PBDUNITS                                                     
         BZ    *+8                                                              
         BRAS  RE,FBEDL                                                         
         AR    R4,R0                                                            
         MVI   0(R4),C'L'          LINES                                        
         CLI   PBDUIND,C'L'                                                     
         BE    FB4D                                                             
         TM    ADBSW,AS_WEBIO      EIO?                                         
         BZ    FB4B                                                             
         MVI   0(R4),C'I'                                                       
         CP    PBDCLMS,=P'0'                                                    
         JE    EXIT                                                             
         MVI   1(R4),C'/'                                                       
         EDITR PBDCLMS,(3,2(R4)),0,ALIGN=LEFT                                   
         J     EXIT                                                             
*                                                                               
FB4B     L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
*--->    MVC   0(2,R4),=C'IN'      INCHES                                       
         MVC   0(L'PP@INCH,R4),PP@INCH                                          
         DROP  RF                                                               
         LA    R4,1(R4)                                                         
*                                                                               
FB4D     CLI   PBDCL,C' '          PREM                                         
         BNH   *+14                                                             
         MVC   2(1,R4),PBDCL                                                    
         MVI   3(R4),C'C'                                                       
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LEGALW   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVI   LWCCODE,0           WILL PASS BACK LW CODE IF FOUND              
         MVI   QUCCODE,0           WILL PASS BACK QU CODE IF FOUND              
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'94'        LEGAL WARNINGS ELEM IN BUY REC               
         BRAS  RE,NXTEL                                                         
         BNE   LEGW50              OVERRIDE NOT FOUND IN BUY, CK PRD            
*                                                                               
         CLI   2(R2),C'X'          X=NONE FOR LEGAL WARNINGS COMMENT?           
         BE    LEGALWX                                                          
         MVC   LWCCODE,2(R2)       SAVE LW COMENT CODE                          
*                                                                               
         CLI   3(R2),C'X'          X=NONE FOR QUARTERLY COMMENT?                
         BE    LEGALWX                                                          
         CLI   3(R2),0             USE QUARTER FROM INSERTION DATE?             
         BE    LEGW40                                                           
         MVC   QUCCODE,3(R2)       SAVE QUARTERLY COMENT CODE                   
         B     LEGALWX                                                          
LEGW40   BRAS  RE,LWQUARTR         GET QUARTER NUMBER                           
         MVC   QUCCODE,LWINSDT     QUARTERLY COMMENT CODE (COMPUTED)            
         B     LEGALWX                                                          
*                                                                               
LEGW50   LA    R2,PPRDREC+33                                                    
         MVI   ELCODE,X'40'        LEGAL WARNINGS ELEM IN PRD REC               
         BRAS  RE,NXTEL                                                         
         BNE   LEGALWX             LEGAL WARNINGS NOT FOUND IN PRD              
         MVC   LWSVPRDC,2(R2)                                                   
*                                                                               
         BRAS  RE,LWQUARTR         GET QUARTER NUMBER                           
         CLI   LWINSDT,C'1'        QUARTER 1?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+0                                               
         B     LEGW60                                                           
         CLI   LWINSDT,C'2'        QUARTER 2?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+1                                               
         B     LEGW60                                                           
         CLI   LWINSDT,C'3'        QUARTER 3?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+2                                               
         B     LEGW60                                                           
         CLI   LWINSDT,C'4'        QUARTER 4?                                   
         BNE   *+14                                                             
         MVC   LWCCODE,LWSVPRDC+3                                               
         B     LEGW60                                                           
         DC    H'0'                THERE ARE ONLY 4 QUARTERS IN A YEAR!         
*                                                                               
LEGW60   DS    0H                                                               
         MVC   QUCCODE,LWINSDT                                                  
*                                                                               
LEGALWX  J     EXIT                                                             
*                                                                               
LWQUARTR DS    0H                  DETERMING QUARTER FROM INS DATE              
         CLI   PBUYKDAT+1,X'03'    MONTH IS GREATER THAN MARCH?                 
         BH    *+10                                                             
         MVI   LWINSDT,C'1'        QUARTER 1                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'06'    MONTH IS GREATER THAN JUNE?                  
         BH    *+10                                                             
         MVI   LWINSDT,C'2'        QUARTER 2                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'09'    MONTH IS GREATER THAN SEPTEMBER?             
         BH    *+10                                                             
         MVI   LWINSDT,C'3'        QUARTER 3                                    
         BR    RE                                                               
         CLI   PBUYKDAT+1,X'0C'    MONTH IS GREATER THAN DECEMBER?              
         BH    *+10                                                             
         MVI   LWINSDT,C'4'        QUARTER 4                                    
         BR    RE                                                               
         DC    H'0'                GREATER THAN DECEMBER, BAD!                  
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BLDCTAB  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PPBYOUTD,R7                                                      
*                                                                               
         L     R4,ACOMTAB                                                       
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
*                                                                               
         CLI   ZEOPT,C'Y'          TEST MULTI Z/E                               
         BNE   BCTB8                                                            
*                                  YES- SET ZONE AS FIRST COMMENT LINE          
         CLC   SVZONNM,SPACES                                                   
         BH    BCTB2                                                            
*--->    MVC   SVZONNM(19),=C'**NO EDITION NAME**'                              
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   5(L'PP@NOEDN,R4),PP@NOEDN                                        
         DROP  RF                                                               
         B     BCTB2C                                                           
*                                                                               
BCTB2    MVC   5(20,R4),SVZONNM                                                 
BCTB2C   LA    R5,25(R4)                                                        
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
*                                  (ZZ,EDT)                                     
         MVI   2(R5),C'('                                                       
         XC    DUB,DUB                                                          
         UNPK  DUB(3),SVZON(2)                                                  
         MVC   3(2,R5),DUB                                                      
         CLI   SVEDIT,0                                                         
         BNE   BCTB6                                                            
         MVI   5(R5),C')'                                                       
         B     BCTB7                                                            
*                                                                               
BCTB6    DS    0H                                                               
         MVI   5(R5),C','                                                       
         XC    DUB,DUB             SET FOR PUBEDIT                              
         MVI   DUB+4,1                                                          
         MVC   DUB+5(1),SVEDIT                                                  
         GOTO1 APUBEDIT,DMCB,(8,DUB),WORK                                       
         MVC   6(3,R5),WORK+14     EDT FROM N-NNN-NNNN,ZZ,EDT                   
         LA    R5,9(R5)                                                         
         CLI   0(R5),C' '                                                       
         BH    *+8                                                              
         BCT   R5,*-8                                                           
         MVI   1(R5),C')'                                                       
*                                                                               
BCTB7    DS    0H                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
BCTB8    DS    0H                                                               
         BRAS  RE,DATEPRT                                                       
*                                                                               
         CLI   COSTOPT,C'B'        BOTH GROSS AND NET                           
         BE    BCTB9                                                            
         CLI   COSTOPT,C'T'        SEE IF SHOWING NET COST                      
         BE    BCTB9                                                            
         CLI   COSTOPT,C'G'        SEE IF SHOWING GROSS                         
         BE    BCTB9                                                            
         CLI   COSTOPT,C'Y'        SEE IF SHOWING COST                          
         BNE   BC2                                                              
*                                                                               
* I WILL RETURN HERE IF COSTOPT IS B                                            
*                                                                               
BCTB9    LA    R4,SAVEP            BUILD COST AS FIRST COMMENT LINE             
         MVC   0(70,R4),SPACES                                                  
*--->    MVC   0(5,R4),=C'COST='                                                
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   0(L'PP@COST,R4),PP@COST                                          
         DROP  RF                                                               
         MVI   4(R4),C'='                                                       
         L     R0,GROSS                                                         
         CLI   NETSW,C'Y'          SEE IF SHOWING NET                           
         BE    BCTB9C                                                           
         B     BCTB9D                                                           
*                                                                               
BCTB9C   S     R0,AGYCOM                                                        
*                                                                               
BCTB9D   EDIT  (R0),(14,5(R4)),2,ALIGN=LEFT,MINUS=YES,COMMAS=YES                
         CLI   LANG,C'F'           SEE IF FRENCH                                
         BNE   BCTB9DX                                                          
         LA    R1,5(R4)                                                         
         LA    RE,14               FOR BCT                                      
BCTB9D2  CLI   0(R1),C','                                                       
         BNE   BCTB9D4                                                          
         MVI   0(R1),C' '          CHANGE COMMA TO SPACE                        
BCTB9D4  LA    R1,1(R1)                                                         
         BCT   RE,BCTB9D2                                                       
*                                                                               
         LA    R1,5(R4)                                                         
         LA    RE,14               FOR BCT                                      
BCTB9D6  CLI   0(R1),C'.'                                                       
         BNE   BCTB9D8                                                          
         MVI   0(R1),C','          CHANGE PERIOD TO COMMA                       
BCTB9D8  LA    R1,1(R1)                                                         
         BCT   RE,BCTB9D6                                                       
*                                                                               
* CAN'T USE CURED SINCE IT GETS COUNTRY AND LANGUAGE FROM =V(SSB)               
*                                                                               
BCTB9DX  DS    0H                                                               
         CLI   QMEDIA,C'N'                                                      
         BE    BLDC2                                                            
*                                                                               
BCTB9E   LA    R4,22(R4)           SCAN BACKWARDS FOR LAST DIGIT                
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
         MVI   THISBUY+34,C'C'      CAN'T USE DITTOS                            
*                                                                               
*--->    MVC   2(5,R4),=C'(NET)'                                                
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   2(L'PP@NETP,R4),PP@NETP                                          
         CLI   NETSW,C'Y'                                                       
         BE    BCTBC                                                            
*--->    MVC   2(7,R4),=C'(GROSS)'                                              
         MVC   2(L'PP@GROSP,R4),PP@GROSP                                        
         DROP  RF                                                               
*                                                                               
BCTBC    L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
         B     BC1                                                              
*                                                                               
BLDC2    DS    0H                  FOR NEWSPAPERS SHOW RATE AND PREMIUM         
         LR    R5,R4               SAVE R4                                      
         MVI   THISBUY+34,C'C'     CAN'T USE DITTOS                             
         LA    R4,22(R4)                                                        
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
*--->    MVC   2(5,R4),=C'(NET)'                                                
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   2(L'PP@NETP,R4),PP@NETP                                          
         LA    R4,6(R4)                                                         
         CLI   NETSW,C'Y'                                                       
         BE    BCTB9H                                                           
         AHI   R4,-6               BACK UP R4                                   
*--->    MVC   2(7,R4),=C'(GROSS)'                                              
         MVC   2(L'PP@GROSP,R4),PP@GROSP                                        
         LA    R4,8(R4)                                                         
         DROP  RF                                                               
*                                                                               
BCTB9H   DS    0H                                                               
         MVI   2(R4),C'('                                                       
         CLI   PBDCOSTY,C'U'       TEST UNIT RATE                               
         BNE   BC0C2               SKIP TO PREMIUM                              
*                                                                               
         MVC   3(6,R4),PBYOUR+2                                                 
         CLC   PBYOUR(2),=C'  '    SEE IF STARTS WITH 2 SPACES                  
         BNH   BCTB9H2             YES - THEN JUST MOVE 6 CHARS                 
         MVC   3(7,R4),PBYOUR+1                                                 
         CLI   PBYOUR,C' '         SEE IF STARTS WITH ONE SPACE                 
         BNH   *+10                YES - THE JUST MOVE 7 CHARS                  
         MVC   3(8,R4),PBYOUR                                                   
*                                                                               
BCTB9H2  DS    0H                                                               
         LA    R4,11(R4)                                                        
*                                                                               
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
         MVC   1(3,R4),=C'/LI'                                                  
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         CLI   PBDUIND,C'L'                                                     
         BE    *+10                                                             
*--->    MVC   2(2,R4),=C'IN'                                                   
         MVC   2(L'PP@INCH,R4),PP@INCH                                          
         DROP  RF                                                               
         LA    R4,2(R4)                                                         
BC0C     DS    0H                                                               
         CLI   NETSW,C'Y'          SEE IF SHOWING NET                           
         BE    BC0C1                                                            
         B     BC0C2               I DON'T NEED TO SHOW (GROSS)                 
*                                  NEXT TO LINE RATES                           
BC0C1    MVC   3(4,R4),=C'NET)'                                                 
         LA    R4,6(R4)                                                         
         MVI   2(R4),C'('                                                       
*                                                                               
BC0C2    MVC   3(11,R4),PBYOPRM                                                 
         LA    R4,18(R4)                                                        
         CLI   0(R4),C' '                                                       
         BH    *+8                                                              
         BCT   R4,*-8                                                           
         MVI   1(R4),C')'                                                       
*                                                                               
         CLI   0(R4),C'('                                                       
         BNE   BC0C4                                                            
         MVC   0(2,R4),SPACES                                                   
         AHI   R4,-2                                                            
         B     BC0C5                                                            
*                                                                               
BC0C4    DS    0H                                                               
         LA    R4,1(R4)            FOR LAST ")"                                 
*                                                                               
BC0C5    LR    RF,R4                                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
*                                                                               
         SR    RE,RE               SEE IF I CAN FIT ON ONE LINE                 
         LA    RE,SAVEP                                                         
         SR    RF,RE                                                            
         CHI   RF,35                                                            
         BNH   BC1                                                              
*                                  MUST USE TWO LINES, BREAK AFTER COST         
         LA    R5,SAVEP                                                         
         LR    R2,R4                                                            
         LA    R2,5(R2)                                                         
         MVC   0(35,R2),SPACES                                                  
*                                                                               
BC0C8    CLC   0(2,R5),=C' ('      MEANS I'M AT END OF COST                     
         BE    BC0C8X              NOTE THAT COST IS ALWAYS FOLLOWED            
*                                  BY (NET) OR (GROSS)                          
         MVC   0(1,R2),0(R5)                                                    
         LA    R5,1(R5)                                                         
         LA    R2,1(R2)                                                         
         B     BC0C8                                                            
*                                                                               
* IF SPLITTING - SHOW (NET) OR (GROSS) HERE                                     
*                                                                               
BC0C8X   DS    0H                                                               
*--->    MVC   1(5,R2),=C'(NET)'                                                
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   1(L'PP@NETP,R2),PP@NETP                                          
         LA    R5,6(R5)                                                         
         CLI   NETSW,C'Y'                                                       
         BE    BC0C9                                                            
         LA    R5,2(R5)                                                         
*--->    MVC   1(7,R2),=C'(GROSS)'                                              
         MVC   1(L'PP@GROSP,R2),PP@GROSP                                        
         DROP  RF                                                               
*                                                                               
BC0C9    LA    R4,70(R4)                                                        
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),1(R5)                                                   
         MVI   THISBUY+34,C' '     MAY USE DITTOS                               
         B     BC1                                                              
*                                                                               
BC1      DS    0H                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
         CLI   COSTOPT,C'B'        SEE IF DOING BOTH GROSS AND NET              
         BNE   BC2                                                              
         CLI   NETSW,C'Y'          DID I JUST DO NET?                           
         BE    BC1X                YES - THEN DONE                              
*                                                                               
         MVC   BSVCTYP,PBDCTYP     SAVE REAL PBDCTYP                            
         MVI   PBDCTYP,C'N'        FOOL PPBYOUT TO HAVE IT RETURN NET           
         MVI   NETSW,C'Y'                                                       
*                                  GO TO PPBYOUT AGAIN                          
         GOTO1 APPBYOUT,DMCB,0(R7)                                              
         MVC   PBYOPRM,SPACES      CLEAR PREMIUM FOR NET LINES                  
         B     BCTB9               NOW GO DO NET                                
*                                                                               
BC1X     MVC   PBDCTYP,BSVCTYP     RESTORE PBDCTYP                              
*                                                                               
BC2      DS    0H                                                               
         LA    R5,SAVEP                                                         
         MVC   0(35,R5),SPACES                                                  
         CLI   ACOPT,C'$'          SEE IF SHOWING AC $                          
         BE    BC2A                                                             
         CLI   ACOPT,C'Y'          SEE IF SHOWING AC                            
         BNE   BC3                                                              
*--->    MVC   0(3,R5),=C'AC='                                                  
BC2A     L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   0(L'PP@AGYCM,R5),PP@AGYCM                                        
         DROP  RF                                                               
         MVI   2(R5),C'='                                                       
*                                                                               
         CLI   ACOPT,C'$'          SEE IF SHOWING AC $                          
         BE    BC2D2                                                            
         ZAP   TMPPL4,PBDACP                                                    
         CP    PBDACP,=P'-1'                                                    
         BNE   BC2B                                                             
         ZAP   TMPPL4,=P'100000'                                                
BC2B     EDIT  (P4,TMPPL4),(7,3(R5)),3,ALIGN=LEFT,DROP=2                        
*                                                                               
         LA    RE,11(R5)           SCAN BACKWARD FOR FIRST NON-SPACE            
BC2C     CLI   0(RE),C' '                                                       
         BNE   BC2D                                                             
         BCT   RE,BC2C                                                          
*                                                                               
BC2D     MVC   2(4,RE),=C'PCT,'                                                 
         B     BC2DX                                                            
*                                                                               
BC2D2    DS    0H                                                               
         EDIT  (B4,AGYCOM),(10,3(R5)),2,ALIGN=LEFT,FLOAT=$                      
*                                                                               
         LA    RE,12(R5)           SCAN BACKWARD FOR FIRST NON-SPACE            
BC2D4    CLI   0(RE),C' '                                                       
         BNE   BC2D6                                                            
         BCT   RE,BC2D4                                                         
*                                                                               
BC2D6    MVI   1(RE),C','                                                       
         LR    R5,RE                                                            
         LA    R5,3(R5)                                                         
         CLI   CDOPT,C'Y'                                                       
         BE    BC3D                                                             
         CLI   CDOPT,C'$'                                                       
         BE    BC3D                                                             
         MVI   1(RE),C' '          BLANK OUT LAST COMMA                         
         B     BC2DX5                                                           
*                                                                               
BC2DX    DS    0H                                                               
         LR    R5,RE                                                            
         LA    R5,7(R5)                                                         
         CLI   CDOPT,C'Y'                                                       
         BE    BC3D                                                             
         CLI   CDOPT,C'$'          OR CD $                                      
         BE    BC3D                                                             
         MVI   5(RE),C' '          BLANK OUT COMMA IF NOT SHOWING CD            
*                                                                               
BC2DX5   DS    0H                                                               
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
         B     BC3E                                                             
*                                                                               
BC3      DS    0H                                                               
         CLI   CDOPT,C'Y'                                                       
         BE    BC3D                                                             
         CLI   CDOPT,C'$'          SEE IF SHOWING CD $                          
         BNE   BC3E                                                             
*--->    MVC   0(3,R5),=C'CD='     BC3D                                         
BC3D     L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   0(L'PP@CD,R5),PP@CD 2 BYTES                                      
         DROP  RF                                                               
         MVI   2(R5),C'='                                                       
         CLI   CDOPT,C'$'          SEE IF SHOWING $                             
         BE    BC3D2                                                            
*                                                                               
         EDIT  (P2,PBDCD),(4,3(R5)),1,ALIGN=LEFT                                
*                                                                               
         LA    RE,3(R5)                                                         
         AR    RE,R0               ADD LENGTH OF OUTPUT                         
         MVC   1(3,RE),=C'PCT'                                                  
         B     BC3DX                                                            
*                                                                               
BC3D2    EDIT  (B4,CSHDSC),(10,3(R5)),2,ALIGN=LEFT,FLOAT=$                      
*                                                                               
BC3DX    L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(35,R4),SAVEP                                                   
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
BC3E     DS    0H                                                               
         OC    PYBLDT(4),PYBLDT    REALLY TAX                                   
         BZ    BC3E30                                                           
         CLI   TAXOPT,C'N'                                                      
         BE    BC3E30                                                           
         CLI   PBDELEM+1,105       BE SURE NOT "SMALL" ELEM                     
         BL    BC3E30              CAN'T HAVE TAX                               
         OC    PBDTAX,PBDTAX       CHECK TAX PERCENTAGE                         
         BZ    BC3E30                                                           
         CLI   TAXOPT,C'%'         SEE IF JUST SHOWING TAX PERCENT              
         BE    BC3E05                                                           
         CLI   TAXOPT,C'B'         OR PERCENT AND $                             
         BE    BC3E05                                                           
         CLI   TAXOPT,C'$'         ONLY TAX $                                   
         BNE   BC3E20              UNKNOWN VALUE - SKIP                         
         L     R3,ANXTCOM                                                       
         XC    0(70,R3),0(R3)                                                   
         LA    R3,5(R3)                                                         
         B     BC3E10                                                           
*                                                                               
BC3E05   DS    0H                  TAX PERCENT                                  
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    BC3E05F                                                          
         MVC   5(5,R4),=C'TAX%='                                                
         EDIT  (B3,PBDTAX),(8,11(R4)),4,ALIGN=LEFT                              
         CLI   TAXOPT,C'B'                                                      
         BNE   BC3E20                                                           
         LA    R3,20(R4)                                                        
         B     BC3E10                                                           
*                                                                               
BC3E05F  DS    0H                                                               
         MVC   5(6,R4),=C'TAXE%='                                               
         EDIT  (B3,PBDTAX),(8,12(R4)),4,ALIGN=LEFT                              
         CLI   TAXOPT,C'B'                                                      
         BNE   BC3E20                                                           
         LA    R3,21(R4)                                                        
*                                                                               
BC3E10   DS    0H                                                               
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    BC3E10F                                                          
         MVC   0(5,R3),=C'TAX$='                                                
         EDIT  (B4,PYBLDT),(11,6(R3)),2,ALIGN=LEFT                              
         CLI   COSTOPT,C'N'        SEE IF SHOWING COST                          
         BE    BC3E20                                                           
         B     BC3E15                                                           
*                                                                               
BC3E10F  DS    0H                                                               
         MVC   0(6,R3),=C'TAXE$='                                               
         EDIT  (B4,PYBLDT),(11,7(R3)),2,ALIGN=LEFT                              
         CLI   COSTOPT,C'N'        SEE IF SHOWING COST                          
         BE    BC3E20                                                           
*                                                                               
BC3E15   LA    R4,70(R4)                                                        
         XC    0(70,R4),0(R4)                                                   
         MVC   5(16,R4),=C'(INCLUS EN COUT)'                                    
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    *+10                                                             
         MVC   5(18,R4),=C'(INCLUDED IN COST)'                                  
*                                                                               
BC3E20   DS    0H                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
BC3E30   DS    0H                                                               
         CLI   PVCTOPT,C'Y'        SEE IF SUPPRESSING PAGEVIEWS AND             
         BE    BC3FX               CLICK THRUS AND IMPRESSIONS                  
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'87'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3F                                                             
         USING PPAGED,R2                                                        
         CP    PPAGEVS,=P'0'                                                    
         BE    BC3F                                                             
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(11,R4),=C'PAGE VIEWS='                                         
         EDIT  PPAGEVS,(11,16(R4)),0,ALIGN=LEFT,COMMAS=YES                      
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3F     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'88'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3F5                                                            
         USING PCLICKD,R2                                                       
         CP    PCLCKTS,=P'0'                                                    
         BE    BC3F5                                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(12,R4),=C'CLICK THRUS='                                        
         EDIT  PCLCKTS,(11,17(R4)),0,ALIGN=LEFT,COMMAS=YES                      
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3F5    DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'92'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3FX                                                            
         USING PIMPRSD,R2                                                       
         CP    PIMPRS,=P'0'                                                     
         BE    BC3FX                                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(22,R4),=C'ESTIMATED IMPRESSIONS='                              
         EDIT  PIMPRS,(11,27(R4)),0,ALIGN=LEFT,COMMAS=YES                       
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3FX    DS    0H                                                               
         CLI   AIMPSOPT,C'Y'       DISPLAY ACTUAL IMPS?                         
         BNE   BC3G                                                             
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'93'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3G                                                             
         USING PAIMPRSD,R2                                                      
         CP    PAIMPRS,=P'0'                                                    
         BE    BC3G                                                             
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(19,R4),=C'ACTUAL IMPRESSIONS='                                 
         EDIT  PAIMPRS,(11,24(R4)),0,ALIGN=LEFT,COMMAS=YES                      
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3G     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'82'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3H                                                             
         USING PFREESID,R2                                                      
         CP    PBFSI,=P'0'                                                      
         BE    BC3H                                                             
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(4,R4),=C'FSI='                                                 
         EDIT  PBFSI,(8,9(R4)),0,ALIGN=LEFT                                     
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3H     DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'83'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   BC3I                                                             
         USING PBREFELD,R2                                                      
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   5(4,R4),=C'REF='                                                 
         MVC   9(L'PBREFNO,R4),PBREFNO                                          
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
         DROP  R2                                                               
*                                                                               
BC3I     DS    0H                                                               
         BRAS  RE,WEBIODET         REPLY WEB IO INSERTION DETAIL                
*                                                                               
         BRAS  RE,IOTRNCOM         IO TO EIO TRANSITION                         
*                                                                               
         BRAS  RE,BYMVTRCM         BUY MOVE TRANSITION COMMENT                  
*                                                                               
         BRAS  RE,ACHARGE          CK FOR ADDITIONAL CHARGES                    
*                                                                               
         BRAS  RE,CCOLRTN          CK FOR CUSTOM COLUMNS                        
*                                                                               
         BRAS  RE,RPYPHOUS         REPY PRODUCTION HOUSE INFO                   
*                                                                               
         BRAS  RE,REVCOMNT         CK FOR REASONS FOR REVISION                  
*                                                                               
         BRAS  RE,CANCOMNT         CK FOR CANCELLATION COMMENTS                 
*                                                                               
         L     R4,ANXTCOM                                                       
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM                                                       
*                                                                               
BC3X00   DS    0H                                                               
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
*                                                                               
* OUTPUT COMMENT FROM INS SCREEN                                                
*                                                                               
         CLC   INSCOMM(50),SPACES  COMMENT PRESENT?                             
         BNH   BC3X01                                                           
         MVC   0(50,R4),INSCOMM    FIRST LINE                                   
         LA    R4,70(R4)                                                        
BC3X01   DS    0H                                                               
*                                                                               
         XC    0(70,R4),0(R4)                                                   
         CLC   INSCOMM+50(50),SPACES                                            
         BNH   BC3X02                                                           
         MVC   0(50,R4),INSCOMM+50                                              
         LA    R4,70(R4)                                                        
*                                                                               
BC3X02   DS    0H                                                               
         XC    0(70,R4),0(R4)                                                   
         CLC   INSCOMM+100(50),SPACES                                           
         BNH   BC3X03                                                           
         MVC   0(50,R4),INSCOMM+100                                             
         LA    R4,70(R4)                                                        
BC3X03   DS    0H                                                               
*                                                                               
         ST    R4,ANXTCOM                                                       
*                                                                               
         BRAS  RE,REGCOMM          CHECK FOR REGIONAL COMMENT                   
*                                                                               
         BRAS  RE,IOPICOMM         PROCESS IO AND PI COMMENTS                   
*                                                                               
         L     R3,ANXTCOM                                                       
         CLC   ANXTCOM,ACOMTAB     SEE IF NO ENTRIES                            
         BE    BCX5                                                             
         AHI   R3,-70              SEE IF LAST LINE EMPTY                       
         OC    0(70,R3),0(R3)                                                   
         BZ    BCX5                                                             
         LA    R3,70(R3)           RESET TO LAST                                
BCX5     DS    0H                                                               
         MVI   0(R3),X'FF'         SET END OF TABLE                             
         L     R3,ACOMTAB                                                       
         ST    R3,ANXTCOM          INITIALIZE ANXTCOM TO FIRST                  
*                                                                               
         BRAS  RE,RPYMATCM         REPY MATERIAL COMMENTS                       
*                                                                               
         BRAS  RE,RPYCPYCM         REPY COPY SPLIT COMMENTS                     
*                                                                               
         J     EXIT                                                             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CKDOUBSP DS    0H                  CK FOR DOUBLE SPACING                        
         LA    R4,70(R4)                                                        
         CLI   DSPOPT,C'Y'                                                      
         JNE   *+14                                                             
         XC    0(70,R4),0(R4)                                                   
         LA    R4,70(R4)           DOUBLE SPACE INSERTION INFORMATION           
         XC    0(70,R4),0(R4)      CLR CURRENT PRINT LINE TO BE USED            
         ST    R4,ANXTCOM                                                       
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
IOTRNCOM NTR1  BASE=*,LABEL=*      IO TO EIO TRANSITION                         
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         CLC   LIOBPCV1,=AL1(03,02,00,17)                                       
         JL    EXIT                                                             
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PWIOELCQ     EIO ELEM CODE                                
         BRAS  RE,NXTEL                                                         
         JE    EXIT                EIO ELEM EXIST, NO NEED TO CONTINUE          
*                                                                               
         LA    R2,PBUYREC+33                                                    
         XC    TMPWK1,TMPWK1                                                    
         MVI   ELCODE,X'70'        IO ELEM CODE                                 
IOTCM20  BRAS  RE,NXTEL                                                         
         BNE   IOTCM24                                                          
         USING PIOELEM,R2                                                       
         OC    PIODATE,PIODATE                                                  
         BZ    IOTCM20                                                          
         CLC   PIODATE,TMPWK1+(PIODATE-PIOELEM)                                 
         BL    IOTCM20                                                          
         SR    RE,RE                                                            
         IC    RE,1(R2)                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),PIOELEM                                                
         B     IOTCM20                                                          
*                                                                               
IOTCM24  OC    TMPWK1,TMPWK1       LASTIO FOUND?                                
         JZ    EXIT                                                             
*                                                                               
         BRAS  RE,RPY#IOTC         REPLY TRANSITION COMMENT REC CODE            
*                                                                               
         LA    R2,TMPWK1                                                        
         XC    TMPWK2,TMPWK2                                                    
         MVC   TMPWK2(1),PBUYKMED                                               
         MVI   TMPWK2+1,C'-'                                                    
         GOTOR DATCON,DMCB,(3,PIODATE),(0,DUB)                                  
         MVC   TMPWK2+2(5),DUB+1                                                
         MVI   TMPWK2+7,C'-'                                                    
         SR    R0,R0                                                            
         ICM   R0,3,PIONUM                                                      
         CVD   R0,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TMPWK2+8(4),DUB                                                  
         MVI   TMPWK2+12,C' '                                                   
         MVC   TMPWK2+13(3),=C'NEW'                                             
         CLI   PIOTYP,C'N'                                                      
         BE    IOTCM30                                                          
         MVC   TMPWK2+13(3),=C'CHA'                                             
         CLI   PIOTYP,C'C'                                                      
         BE    IOTCM30                                                          
         MVC   TMPWK2+13(3),=C'CAN'                                             
         CLI   PIOTYP,C'D'                                                      
         BE    IOTCM30                                                          
         XC    TMPWK2+13(3),TMPWK2+13                                           
*                                                                               
IOTCM30  GOTOR DATCON,DMCB,(3,PIODATE),(5,DUB)                                  
*                                                                               
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'IOTCMTX1),IOTCMTX1                                      
         MVC   TMPWK1+L'IOTCMTX1(08),DUB                                        
         MVC   TMPWK1+L'IOTCMTX1+08(06),=C', IO# '                              
         MVC   TMPWK1+L'IOTCMTX1+08+06(20),TMPWK2                               
*                                                                               
         BRAS  RE,RPY#TRCM         REPLY TRANSITION COMMENT                     
*                                                                               
         J     EXIT                                                             
*                                                                               
IOTCMTX1 DC    C'PREVIOUSLY TRAFFICKED ON '                                     
*                                                                               
RPY#IOTC LR    R0,RE                                                            
         TM    ADRPYSW3,RPYTRCMQ   SUB REC REPLY CODE REPLIED?                  
         JNZ   RPY#IOTX                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#IOTCOM)              
         OI    ADRPYSW3,RPYTRCMQ                                                
RPY#IOTX LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB,R2                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BYMVTRCM NTR1  BASE=*,LABEL=*      BUY MOVE TRANSITION COMMENT                  
*                                                                               
         TM    WKEIOFLG,E_IOBM_Q   BUY MOVE ELEM PRESENT?                       
         JZ    EXIT                                                             
         TM    WKEIOFLG,E_IOBM#Q   BUY MOVE ORDER HAS BEEN ISSUED?              
         JNZ   EXIT                                                             
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         CLC   LIOBPCV1,=AL1(03,04,00,05)                                       
         JL    EXIT                                                             
*                                                                               
         MVI   WKBYMCSW,0          INIT BUY MOVE COMMENT SWITCH                 
         NI    ADRPYSW3,X'FF'-RPYTRCMQ                                          
*                                                                               
         TM    WKEIOFLG,E_IOBMFQ   BUY MOVE "FROM" ELEM PRESENT?                
         BZ    BYMVT_50                                                         
         OI    WKBYMCSW,B_MVFROQ                                                
         NI    WKBYMCSW,X'FF'-B_MVTO_Q                                          
         BRAS  RE,BYMCM_TF         DO "FROM" BUY MOVE COMMENT                   
*                                                                               
BYMVT_50 TM    WKEIOFLG,E_IOBMTQ   BUY MOVE "TO" ELEM PRESENT?                  
         BZ    BYMVT_X                                                          
         OI    WKBYMCSW,B_MVTO_Q                                                
         NI    WKBYMCSW,X'FF'-B_MVFROQ                                          
         BRAS  RE,BYMCM_TF         DO "TO" BUY MOVE COMMENT                     
*                                                                               
BYMVT_X  J     EXIT                                                             
*                                                                               
BYMCM_TF ST    RE,TMPSVRE          "TO" & "FROM" BUY MOVE COMMENT               
         USING PBYMELEM,R2                                                      
         LA    R2,PBUYREC+33                                                    
BYMCM20  MVI   ELCODE,PBYMELCQ     BUY MOVE ELEM CODE                           
BYMCM24  BRAS  RE,NXTEL                                                         
         BNE   BYMCM36                                                          
*                                                                               
         TM    WKBYMCSW,B_MVFROQ   PROCESS BUY MOVE "FROM" COMMENT?             
         BZ    *+12                                                             
         TM    PBYMSTAT,PBYMFROQ   BUY MOVED "FROM" ELEM?                       
         BZ    BYMCM24                                                          
*                                                                               
         TM    WKBYMCSW,B_MVTO_Q   PROCESS BUY MOVE "TO" COMMENT?               
         BZ    *+12                                                             
         TM    PBYMSTAT,PBYMTO_Q   BUY MOVED "TO" ELEM?                         
         BZ    BYMCM24                                                          
*                                                                               
         ZAP   WKBYSER#,PBYMSER#   SERIAL# OF "FROM" INSERTION                  
         BRAS  RE,GBUYR_S#         GET BUY RECORD FROM SERIAL#                  
         BNE   BYMCM_X                                                          
         LA    R2,TMPWKAIO+33                                                   
         BRAS  RE,FND_BEIO         LASTEST EIO ELEM FOUND?                      
         BNE   BYMCM28                                                          
*                                                                               
         USING PWIOELEM,R2                                                      
BYMCM26  XC    TMPWK1,TMPWK1       PREPARE TO REPLY TRANSITION COMMENT          
         BRAS  RE,RPY#IOTC         REPLY TRANSITION COMMENT REC CODE            
         GOTOR DATCON,DMCB,(3,PWIODATE),(21,WKIOCDAT)                           
         TM    WKBYMCSW,B_MVFROQ   PROCESS BUY MOVE "FROM" COMMENT?             
         BZ    BYMCM26M                                                         
         MVC   TMPWK1(L'BYMCMTX3),BYMCMTX3                                      
         MVC   WKINSDT,TMPWKAIO+(PBUYKDAT-PBUYKEY)                              
         MVC   WKFREQU,TMPWKAIO+33+(PBDFREQ-PBDELEM)                            
         MVC   WKBUYLN,TMPWKAIO+(PBUYKLIN-PBUYKEY)                              
         GOTOR FMTBUYL#            GET INSERTION DATE WITH REF#                 
         MVC   TMPWK1+L'BYMCMTX3(L'D_INSDLN),TMPCL20                            
         LA    RF,TMPWK1+L'BYMCMTX3+L'D_INSDLN                                  
         BRAS  RE,LAST_CHR                                                      
         MVC   02(10,RF),BYMCMTX3                                               
         MVC   12(03,RF),=C'FOR'                                                
         MVC   16(03,RF),TMPWKAIO+(PBUYKCLT-PBUYKEY)                            
         MVI   19(RF),C'/'                                                      
         MVC   20(03,RF),TMPWKAIO+(PBUYKPRD-PBUYKEY)                            
         BRAS  RE,RPY#TRCM         REPLY TRANSITION COMMENT                     
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'BYMCMTX4),BYMCMTX4                                      
         BRAS  RE,FMT_BIO#         FORMAT BUY INSERTION ORDER #                 
         MVC   TMPWK1+L'BYMCMTX4(25),TMPWK2                                     
         LA    RF,TMPWK1+L'BYMCMTX4+25+1                                        
         BRAS  RE,LAST_CHR                                                      
         MVC   02(10,RF),=C'CREATED ON'                                         
         MVC   13(10,RF),WKIOCDAT                                               
         BRAS  RE,RPY#TRCM         REPLY TRANSITION COMMENT                     
BYMCM26M TM    WKBYMCSW,B_MVTO_Q   PROCESS BUY MOVE "TO" COMMENT?               
         BZ    BYMCM26X                                                         
         MVC   TMPWK1(L'BYMCMTX2),BYMCMTX2                                      
         BRAS  RE,FMT_BIO#         FORMAT BUY INSERTION ORDER #                 
         MVC   TMPWK1+L'BYMCMTX2(25),TMPWK2                                     
         LA    RF,TMPWK1+L'BYMCMTX2+25+1                                        
         BRAS  RE,LAST_CHR                                                      
         MVC   02(03,RF),=C'FOR'                                                
         MVC   06(03,RF),TMPWKAIO+(PBUYKCLT-PBUYKEY)                            
         MVI   09(RF),C'/'                                                      
         MVC   10(03,RF),TMPWKAIO+(PBUYKPRD-PBUYKEY)                            
         BRAS  RE,RPY#TRCM         REPLY TRANSITION COMMENT                     
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1+00(10),=C'CREATED ON'                                     
         MVC   TMPWK1+11(10),WKIOCDAT                                           
         BRAS  RE,RPY#TRCM         REPLY TRANSITION COMMENT                     
BYMCM26X B     BYMCM_X                                                          
*                                                                               
BYMCM28  LA    R2,TMPWKAIO+33                                                   
         BRAS  RE,FND_BSIO         LASTEST STANDARD IO ELEM FOUND?              
         BE    BYMCM26                                                          
*                                                                               
BYMCM32  LA    R2,TMPWKAIO+33      LOOK FOR BUY MOVE "FROM" ELEM AGAIN          
         B     BYMCM20                                                          
*                                                                               
BYMCM36  TM    WKBYMCSW,B_MVRTFQ   ALREADY REPLIED?                             
         BNZ   BYMCM_X                                                          
         TM    WKEIOFLG,E_IOBMTQ   HAS BUY MOVE "TO" INSERTION?                 
         BZ    BYMCM_X                                                          
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'BYMCMTX1),BYMCMTX1                                      
         BRAS  RE,RPY#IOTC         REPLY TRANSITION COMMENT REC CODE            
         BRAS  RE,RPY#TRCM         REPLY TRANSITION COMMENT                     
         OI    WKBYMCSW,B_MVRTFQ                                                
BYMCM_X  L     RE,TMPSVRE                                                       
         BR    RE                                                               
*                                                                               
GBUYR_S# LR    R0,RE               GET BUY RECORD FROM SERIAL#                  
         MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
         XC    KEY,KEY                                                          
         LA    RE,KEY                                                           
         USING PSERKEY,RE                                                       
         MVC   PSERKAGY,PBUYKAGY                                                
         MVC   PSERKMED,PBUYKMED                                                
         MVI   PSERKRCD,PSERKIDQ                                                
         MVC   PSERKCLT,PBUYKCLT                                                
         ZAP   DUB,PACK1BIL                                                     
         SP    DUB,WKBYSER#                                                     
         MVC   PSERKNUM,DUB+3                                                   
         MVC   WKDMINBT,DMINBTS    SAVE DATA MANAGER BITS                       
         OI    DMINBTS,X'08'       SET TO PASS DELETES                          
         GOTOR HIGH                                                             
         CLC   KEY(25),KEYSAVE     RECORD FOUND?                                
         JE    GB_S#50                                                          
         MVC   KEY,TMPSVKEY        RESTORE ORIGINAL SETTINGS                    
         MVC   AREC,TMPSVAIO                                                    
         MVC   DMINBTS,WKDMINBT                                                 
         LR    RE,R0                                                            
         J     RE_CCNEQ                                                         
*                                                                               
GB_S#50  LA    RE,TMPWKAIO                                                      
         ST    RE,AREC                                                          
         GOTOR GETPRT                                                           
         MVC   KEY,TMPSVKEY        RESTORE ORIGINAL SETTINGS                    
         MVC   AREC,TMPSVAIO                                                    
         MVC   DMINBTS,WKDMINBT                                                 
         LR    RE,R0                                                            
         J     RE_CCEQ                                                          
*                                                                               
FND_BSIO LR    R1,RE               FIND BUY STANDARD IO ELEM                    
         USING PIOELEM,R2                                                       
         MVI   ELCODE,X'70'                                                     
         LR    RF,R2                                                            
         BRAS  RE,NXTEL                                                         
         JE    *-6                                                              
         LR    R2,RF                                                            
         LR    RE,R1                                                            
         CLI   PIOELEM,X'70'       LATEST STANDARD IO ELEM FOUND?               
         JNE   RE_CCNEQ                                                         
         OC    PIODATE,PIODATE     ACTUAL STANDARD IO ELEM?                     
         JZ    RE_CCNEQ                                                         
RE_CCEQ  CR    RE,RE               CC EQUAL                                     
         J     *+6                                                              
RE_CCNEQ LTR   RE,RE               CC NOT EQUAL                                 
         BR    RE                                                               
*                                                                               
FND_BEIO LR    R1,RE               FIND BUY EIO ELEM                            
         USING PWIOELEM,R2                                                      
         MVI   ELCODE,PWIOELCQ                                                  
         LR    RF,R2                                                            
         BRAS  RE,NXTEL                                                         
         JE    *-6                                                              
         LR    R2,RF                                                            
         LR    RE,R1                                                            
         CLI   PWIOELEM,PWIOELCQ   LATEST EIO ELEM FOUND?                       
         JNE   RE_CCNEQ                                                         
         OC    PWIODATE,PWIODATE   ACTUAL EIO ELEM?                             
         JZ    RE_CCNEQ                                                         
         J     RE_CCEQ                                                          
*                                                                               
FMT_BIO# LR    R5,RE               FORMAT BUY INSERTION ORDER #                 
         XC    TMPWK2,TMPWK2                                                    
         USING PWIOELEM,R2                                                      
         CLI   PWIOELEM,PWIOELCQ   EIO ELEM?                                    
         JNE   FMT_BIO5                                                         
         USING EIOLKEYD,R4                                                      
         LA    R4,TMPWK2                                                        
         MVI   EIOLGKEY,C'-'                                                    
         MVC   EIOLGKEY+1(EIOLGKYL-1),EIOLGKEY                                  
         MVC   EIOLGMED,TMPWKAIO+(PBUYKMED-PBUYKEY)                             
         MVC   WORK(L'PWIODATE),PWIODATE                                        
         MVC   WORK(L'PWIO#YER),PWIO#YER                                        
         GOTOR DATCON,DMCB,(3,WORK),(10,DUB)                                    
         MVC   EIOLGYER,DUB+6                                                   
         MVC   EIOLGCLT,TMPWKAIO+(PBUYKCLT-PBUYKEY)                             
         CLI   EIOLGCLT+2,C' '                                                  
         JNE   *+8                                                              
         MVI   EIOLGCLT+2,C'-'                                                  
         EDITR PWIO#SQ#,EIOLGRNO,0,FILL=0                                       
         MVI   EIOLGRNO+L'EIOLGRNO,C' '                                         
         MVC   EIOLGRET,SPACES                                                  
         MVC   EIOLGRE#,SPACES                                                  
         CLI   PWIO#REV,0                                                       
         JE    FMT_BIOX            NO REVISION #                                
         MVI   EIOLGRNO+L'EIOLGRNO,C'-'                                         
         MVC   EIOLGRET,=C'REV'                                                 
         EDITR PWIO#REV,EIOLGRE#,0,FILL=0                                       
         SR    RE,RE                                                            
         ICM   RE,7,PWIO#SQ#                                                    
         CHI   RE,9999                                                          
         JH    FMT_BIOX                                                         
         MVC   EIOLGKEY+DISPER#Q(LNAERF#Q),EIOLGKEY+DISP_R#Q                    
         MVI   EIOLGKEY+(EIOLGKYL-L'EIOLGR#E),C' '                              
         J     FMT_BIOX                                                         
*                                                                               
         USING PIOELEM,R2                                                       
FMT_BIO5 MVC   TMPWK2+00(1),TMPWKAIO+(PBUYKMED-PBUYKEY)                         
         MVI   TMPWK2+01,C'-'                                                   
         GOTOR DATCON,DMCB,(3,PIODATE),(0,DUB)                                  
         MVC   TMPWK2+02(05),DUB+1                                              
         MVI   TMPWK2+07,C'-'                                                   
         SR    RE,RE                                                            
         ICM   RE,3,PIONUM                                                      
         CVD   RE,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TMPWK2+08(04),DUB                                                
FMT_BIOX LR    RE,R5                                                            
         BR    RE                                                               
*                                                                               
RPY#TRCM LR    R0,RE               REPLY TRANSITION COMMENT                     
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',TMPWK1),(L'EIOCOMLN,0)                               
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
BYMCMTX1 DC    C'REPLACEMENT INSERTION ORDER TO FOLLOW'                         
BYMCMTX2 DC    C'INSERTION HAS BEEN MOVED TO IO# '                              
BYMCMTX3 DC    C'INSERTION REPLACES '                                           
BYMCMTX4 DC    C'PREVIOUSLY ON INSERTION ORDER '                                
*                                                                               
         LTORG                                                                  
         DROP  RB,RE,R2,R3,R4                                                   
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
ACHARGE  NTR1  BASE=*,LABEL=*      ROUTINE FOR ADDITIONAL CHARGES               
*                                                                               
         CLI   COSTOPT,C'N'        SHOW INSERTION COST OPTION IS NO?            
         JE    EXIT                                                             
         CLI   SHWACHGR,C'Y'       PROFILE IS SET TO SHOW CHARGES?              
         JNE   EXIT                                                             
*                                                                               
         MVC   TMPSVKEY,KEY                                                     
         MVC   ACHPRD,PBUYKPRD                                                  
*                                                                               
         GOTO1 APPGETCG,DMCB,(C'T',PBUYREC),VDATAMGR,GETINS,ACHPRD              
         CLI   0(R1),X'FF'         ERROR IN CALL ?                              
         BNE   *+6                 NO                                           
         DC    H'0'                                                             
*                                                                               
         CLI   0(R1),X'00'         ANY ADD'L. CHARGES FOUND ?                   
         BE    ACHRGX              NO                                           
*                                                                               
         ZIC   R3,0(R1)            NUMBER OF LINES IN BLOCK                     
         STC   R3,NUMACLNS         SAVE IT FOR PRINT MANIPULATIONS              
*                                                                               
         ICM   RE,15,0(R1)         RE POINTING TO DATA BLOCK                    
         BNZ   *+6                                                              
         DC    H'0'                DATA BLOCK HAS TO BE THERE                   
*                                                                               
         LA    RF,ACHWORK          ADDRESS OF AREA FOR ADD'L. CHGS.             
         LA    R1,ADCDLNTH         LENGTH OF BLOCK                              
         MOVE  ((RF),(R1)),(RE)    MOVE BLOCK TO WORKING STORAGE AREA           
*                                                                               
         LA    R2,ACHWORK          POINT TO WORKING STORAGE AREA                
         USING ADDCHGD,R2                                                       
*                                                                               
         L     R4,ANXTCOM                                                       
         MVC   0(70,R4),SPACES                                                  
         MVC   0(24,R4),=C'** ADDITIONAL CHARGES **'                            
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM          NOTE - ACHRGS ARE NOT DOUBLE SPACED          
*                                                                               
ACHRG30  L     R4,ANXTCOM                                                       
         MVC   0(ADCLNLEN,R4),ADCCOD1                                           
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM          NOTE - ACHRGS ARE NOT DOUBLE SPACED          
         LA    R2,ADCLNLEN(R2)     BUMP TO NEXT LINE IN BLOCK                   
         BCT   R3,ACHRG30                                                       
         DROP  R2                                                               
*                                                                               
ACHRGX   BRAS  RE,RPYACHRG         REPLY ADDTIONAL CHARGES FOR WEB IO           
*                                                                               
         MVC   KEY,TMPSVKEY        RESTORE PPG SEQ                              
         MVC   KEYSAVE,KEY                                                      
*                                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* ROUTINE FOR REGIONAL COMMENTS, INTERNET SITE LOCATION                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
REGCOMM  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLC   QAGENCY,=C'SJ'                                                   
         BE    REGCM10                                                          
         CLC   QAGENCY,=C'H9'      STARCOM?                                     
         BNE   REGCOMX                                                          
*                                                                               
REGCM10  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'66'        BUY COMMENT ELEM CODE                        
REGCM15  BRAS  RE,NXTEL                                                         
         BNE   REGCOMX                                                          
         CLI   1(R2),6             LENGTH AT LEAST 6 (REG= +2)?                 
         BNH   REGCM15                                                          
         CLC   2(3,R2),=C'REG='    REGIONAL COMMENT NOTATION?                   
         BNE   REGCM15                                                          
*                                                                               
         MVC   SAVEP,SPACES                                                     
         MVC   SAVEP(8),=C'REGION: '                                            
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
*                                                                               
         ZIC   R5,1(R2)                                                         
         AHI   R5,-7               MINUS OVERHEAD (6) AND 1 FOR EX              
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   SAVEP+8(0),6(R2)                                                 
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)           NOTE - COMMENTS NOT DOUBLE SPACED            
         ST    R3,ANXTCOM                                                       
         B     REGCM15             LOOK FOR MORE X'66' ELEM                     
*                                                                               
REGCOMX  DS    0H                  END OF REGINAL COMMENT                       
*                                                                               
* CHECKING FOR INTERNET SITE LOCATION                                           
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'98'        INTERNET SITE LOCATION ELEM                  
ISITL20  BRAS  RE,NXTEL                                                         
         BNE   ISITELX                                                          
         MVC   SAVEP,SPACES                                                     
         MVC   SAVEP(15),=C'SITE LOCATION: '                                    
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   SAVEP+15(20),2(R2)                                               
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)           NOTE - SITE LOC IS NOT DOUBLE SPACED         
         ST    R3,ANXTCOM                                                       
         B     ISITL20             THERE SHOULDN'T BE ANOTHER ONE               
*                                                                               
ISITELX  DS    0H                  END OF INTERNET SITE LOCATION                
*                                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
DATEPRT  NTR1  BASE=*,LABEL=*      ROUTINE FOR PRINT DATES                      
*                                                                               
         CLI   CLOOPT,C'Y'         PRINT CLOSING DATE                           
         BNE   NOCLOSED                                                         
         OC    PBDCDATE,PBDCDATE   ANYTHING THERE                               
         BZ    NOCLOSED                                                         
         CLI   LANG,C'F'           SEE IF FRENCH I/O                            
         BE    CLOS5                                                            
         MVC   5(20,R4),=C'*SPACE CLOSING DATE '                                
         B     CLOS10                                                           
*                                                                               
CLOS5    MVC   5(19,R4),=C'*DATE DE FERMETURE '                                 
*                                                                               
CLOS10   DS    0H                                                               
         LA    R5,25(R4)           SCAN BACKWARD FOR NON-SAPCE                  
CLOS11   CLI   0(R5),C' '                                                       
         BH    CLOS12                                                           
         BCT   R5,CLOS11                                                        
*                                                                               
CLOS12   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBDCDATE),(8,WORK)                                
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   2(8,R5),WORK                                                     
*                                                                               
         MVI   10(R5),C'*'                                                      
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
NOCLOSED DS    0H                                                               
         CLI   MATEOPT,C'Y'        PRINT MATERIALS CL DATE                      
         BNE   NOMATCL                                                          
         OC    PBDMDATE,PBDMDATE   ANY MAT CLOSE DATE TO PRINT?                 
         BZ    PRTEXDS             NO, GO CHECK EXT DAYS AND DATE               
*                                                                               
*--->    MVC   5(24,R4),=C'*MATERIALS CLOSING DATE='                            
*--->    GOTO1 DATCON,DMCB,(3,PBDMDATE),(8,29(R4))                              
*--->    MVI   37(R4),C'*'                                                      
         MVI   5(R4),C'*'                                                       
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   6(L'PP@MATCD,R4),PP@MATCD                                        
         LA    R5,6+L'PP@MATCD(R4) SCAN BACKWARD FOR NON-SAPCE                  
         DROP  RF                                                               
BCTB8B   CLI   0(R5),C' '                                                       
         BH    BCTB8C                                                           
         BCT   R5,BCTB8B                                                        
*                                                                               
BCTB8C   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBDMDATE),(8,WORK)                                
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   2(8,R5),WORK                                                     
*                                                                               
         MVI   10(R5),C'*'                                                      
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
* PRINTING EXTENSION DAYS OR EXTENSION DATE                                     
*                                                                               
PRTEXDS  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'89'        EXTENSION DAYS ELEM FOUND?                   
         BRAS  RE,NXTEL                                                         
         BNE   NOEXDAYS                                                         
         USING PEXDAYEL,R2                                                      
         CP    PEXDAYS,=P'0'       ZERO EXT DAYS?                               
         BE    NOEXDAYS            YES, DONOT PRINT                             
         MVC   5(17,R4),=C'EXTENSION DAYS = '                                   
         EDIT  (P2,PEXDAYS),(3,22(R4)),0,ALIGN=LEFT                             
         BRAS  RE,CKDOUBSP                                                      
         B     NOEXDATE            DONE                                         
         DROP  R2                                                               
*                                                                               
NOEXDAYS DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'96'        EXTENSION DATE ELEM FOUND?                   
         BRAS  RE,NXTEL                                                         
         BNE   NOEXDATE                                                         
         USING PEXDATEL,R2                                                      
         MVC   5(17,R4),=C'EXTENSION DATE = '                                   
         GOTO1 DATCON,DMCB,(3,PEXDATE),(8,WORK)                                 
         DROP  R2                                                               
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   22(8,R4),WORK                                                    
         BRAS  RE,CKDOUBSP                                                      
NOEXDATE DS    0H                                                               
         LA    R2,PBUYREC+33       POINT TO FIRST ELEM AGAIN                    
*                                                                               
NOMATCL  DS    0H                                                               
         CLI   ONSOPT,C'Y'         PRINT ON-SALE DATE                           
         BNE   NOONSALE                                                         
         OC    PBDSDATE,PBDSDATE   ANYTHING THERE                               
         BZ    NOONSALE                                                         
*--->    MVC   5(14,R4),=C'*ON-SALE DATE='                                      
*--->    GOTO1 DATCON,DMCB,(3,PBDSDATE),(8,19(R4))                              
*--->    MVI   27(R4),C'*'                                                      
         MVI   5(R4),C'*'                                                       
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   6(L'PP@OSDAT,R4),PP@OSDAT                                        
         LA    R5,6+L'PP@OSDAT(R4) SACN BACKWARD FOR NON-SAPCE                  
         DROP  RF                                                               
MATB8B   CLI   0(R5),C' '                                                       
         BH    MATB8C                                                           
         BCT   R5,MATB8B                                                        
*                                                                               
MATB8C   DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,PBDSDATE),(8,WORK)                                
*                                                                               
         CLI   LANG,C'F'                                                        
         BNE   *+8                                                              
         BRAS  RE,FRDATE                                                        
         MVC   2(8,R5),WORK                                                     
*                                                                               
         MVI   10(R5),C'*'                                                      
*                                                                               
         BRAS  RE,CKDOUBSP         CHECKING DOUBLE SPACE OPTION                 
*                                                                               
NOONSALE DS    0H                  FOR FUTURE DATE USES                         
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
BFRDAY   NTR1  BASE=*,LABEL=*      CONVERT DAY IN WORK+6                        
*                                                                               
         LA    R1,BDAYTAB                                                       
BFRDAY2  CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMETHING VERY WRONG                         
*                                                                               
         CLC   WORK+6(3),0(R1)                                                  
         BE    BFRDAY10                                                         
         LA    R1,6(R1)                                                         
         B     BFRDAY2                                                          
*                                  TO FRENCH                                    
BFRDAY10 MVC   WORK+6(3),3(R1)                                                  
         J     EXIT                                                             
*                                                                               
BDAYTAB  DC    C'SUNDIM'                                                        
         DC    C'MONLUN'                                                        
         DC    C'TUEMAR'                                                        
         DC    C'WEDMER'                                                        
         DC    C'THUJEU'                                                        
         DC    C'FRIVEN'                                                        
         DC    C'SATSAM'                                                        
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
*                                                                               
FRDATE   NTR1  BASE=*,LABEL=*      CONVERT DATE IN WORK (MMMDD/YY)              
*                                                                               
         LA    R1,DATETAB                                                       
FRDAT2   CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLC   WORK(3),0(R1)                                                    
         BE    FRDAT5                                                           
         LA    R1,6(R1)                                                         
         B     FRDAT2                                                           
*                                  TO FRENCH                                    
FRDAT5   MVC   WORK(3),3(R1)                                                    
         J     EXIT                                                             
*                                                                               
DATETAB  DC    C'JANJAN'                                                        
         DC    C'FEBFEV'                                                        
         DC    C'MARMAR'                                                        
         DC    C'APRAVR'                                                        
         DC    C'MAYMAI'                                                        
         DC    C'JUNJUN'                                                        
         DC    C'JULJUL'                                                        
         DC    C'AUGAOU'                                                        
         DC    C'SEPSEP'                                                        
         DC    C'OCTOCT'                                                        
         DC    C'NOVNOV'                                                        
         DC    C'DECDEC'                                                        
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CCOLRTN  NTR1  BASE=*,LABEL=*      CUSTOM COLUMN                                
*                                                                               
         MVC   TMPSVKEY,KEY        SAVE BUY KEY                                 
*                                                                               
         LA    R2,PBUYREC+33                                                    
         USING BYCCELD,R2          BUY CUSTOM COLUMN ELEMENT                    
         MVI   ELCODE,BYCCIDQ                                                   
*                                                                               
CCOL20   DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   CCOLX               DONE WITH CUSTOM COLUMNS                     
*                                                                               
         CLC   BYCCSQN,=X'2000'    STANDARIZED CUSTOM COLUMN?                   
         BL    CCOL20F                                                          
         XC    GKEY,GKEY                                                        
C        USING GCOLPKEY,GKEY                                                    
         MVC   C.GCOLPRID,=AL3(GCOLPRIQ)  SET GENDIR PASSIVE KEY ID             
         MVI   C.GCOLPMED,C'A'       MEDIA ALWAYS A FOR CUST COL'S              
         MVI   C.GCOLPRCD,GCOLPRCQ   RECORD CODE FOR PASSIVE KEY                
         MVC   C.GCOLPSQN,BYCCSQN    SEQUENCE NUMBER                            
         XC    C.GCOLPSQN,=X'FFFF'   COMPLEMENT SEQUENCE NUMBER                 
         MVC   GKEYSAVE,GKEY                                                    
         GOTOR VDATAMGR,DMCB,(DMINBTS,=C'DMRDHI'),=C'GENDIR',          X        
               GKEY,GKEY,(TERMNAL,0)                                            
*                                                                               
         CLC   C.GCOLPKEY,GKEYSAVE                                              
         BE    *+6                                                              
         DC    H'0'                MUST BE THERE                                
         DROP  C                                                                
*                                                                               
         GOTOR VDATAMGR,DMCB,(DMINBTS,=C'GETREC'),=C'GENFILE',         X        
               GKEY+36,TMPWKAIO,(TERMNAL,DMWORK)                                
*                                                                               
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                NO ERRORS TOLERATED                          
*                                                                               
         LA    R5,TMPWKAIO                                                      
         LA    R5,GCOLFRST-GCOLKEY(R5)                                          
         USING PCOLELEM,R5                                                      
         B     CCOL20M                                                          
*                                                                               
CCOL20F  XC    KEY,KEY                                                          
C        USING PCOLRECD,KEY                                                     
         MVC   C.PCOLPAGY,QAGENCY  AGENCY                                       
         MVI   C.PCOLPMED,C'A'     MEDIA ALWAYS A FOR CUST COL'S                
         MVI   C.PCOLPRCD,X'D1'    RECORD CODE FOR PASSIVE KEY                  
         MVC   C.PCOLPSQN,BYCCSQN  SEQUENCE NUMBER                              
         XC    C.PCOLPSQN,=X'FFFF' COMPLEMENT SEQUENCE NUMBER                   
         DROP  C                                                                
*                                                                               
         GOTOR HIGH                                                             
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                NO ERRORS TOLERATED                          
*                                                                               
         LA    RE,TMPWKAIO         TEMP USE FOR CUSTOM COLUMN REC               
         ST    RE,AREC                                                          
*                                                                               
         GOTOR GETPRT                                                           
         LA    R5,TMPWKAIO+(PCOLFRST-PCOLREC)                                   
*                                                                               
CCOL20M  TM    PCOLINS,X'80'       USE IN INSERTION ORDERS?                     
         BNO   CCOL20              NO, TRY NEXT BUY CC ELEM                     
*                                                                               
         L     R4,ANXTCOM          OUTPUT CUSTOM COLUMN DATA                    
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         LR    R3,R4               LEAVE R4 POINTING TO NXTCOM                  
         MVC   0(12,R3),PCOLHDR1   COLUMN HEADER 1                              
*                                                                               
         LA    R3,11(R3)           POINT TO LAST CHAR IN HEADER 1               
CCOL22   CLI   0(R3),C' '          ANYTHING THERE?                              
         BH    CCOL24                                                           
         AHI   R3,-1               MOVE 1 "LEFT" ON LINE                        
         B     CCOL22              TEST AGAIN                                   
*                                                                               
CCOL24   DS    0H                  R3 POINTING TO END OF "HDR 1"                
         CLI   PCOLHDR2,C' '       ANYTHING IN HEADER 2                         
         BNH   CCOL26X             NO                                           
         LA    R3,2(R3)            MOVE 2 "RIGHT" ON LINE                       
         MVC   0(12,R3),PCOLHDR2   COLUMN HEADER 2                              
*                                                                               
         LA    R3,11(R3)           POINT R3 TO LAST POSSIBLE CHARACTER          
CCOL26   DS    0H                  IN PCOLHDR2                                  
         CLI   0(R3),C' '          ANYTHING THERE ?                             
         BH    CCOL26X             YES                                          
         AHI   R3,-1               MOVE 1 "LEFT" ON LINE                        
         B     CCOL26              TEST AGAIN                                   
*                                                                               
CCOL26X  DS    0H                                                               
         LA    R3,1(R3)            MOVE 1 "RIGHT" ON LINE                       
         MVI   0(R3),C':'          PLACE A COLON                                
         LA    R3,2(R3)            MOVE 2 "RIGHT" ON LINE                       
*                                                                               
         CLI   PCOLTYP,C'D'        DATE ?                                       
         BE    CCOL50              YES                                          
         CLI   PCOLTYP,C'P'        PERIOD ?                                     
         BE    CCOL60              YES                                          
         CLI   PCOLTYP,C'T'        TEXT ?                                       
         BNE   CCOL70              NO - MUST BE 1 OF 3 NUMERIC "TYPES"          
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* FOLLOWING CODE PROVIDES FOR PLACING VARIABLE LENGTH TEXT IN A                 
* VARIABLE LENGTH PRINT BLOCK                                                   
*                                                                               
* NTRY R4-> BEGINNING OF NEXT DATA "LINE"                                       
* NTRY R3-> BEGINNING OF VARIABLE LENGTH OUTPUT ON "LINE"                       
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         LA    RE,69(R4)           POINT RE TO LINE END                         
         SR    RE,R3               RE HAS MAXIMUM LINE LENGTH                   
         STC   RE,MAXLNTH          SAVE                                         
*                                                                               
         ZICM  RF,BYCCLEN          TOTAL ELEMENT LENGTH                         
         LA    R1,BYCCHDRL         HEADER LENGTH (OVERHEAD)                     
         SR    RF,R1               RF HAS LENGTH OF CUST COL DATA               
         LTR   RF,RF                                                            
         BNP   CCOL20              NO DATA - NEXT ELEMENT                       
*                                                                               
* USE PLISREC FOR OUTPUT BLOCK                                                  
*                                                                               
         GOTOR ACHOPPER,DMCB,((RF),BYCCDATA),(MAXLNTH,PLISREC),(70,7)           
*                                                                               
         L     RF,8(R1)            NUMBER OF LINES IN BLOCK                     
         LTR   RF,RF                                                            
         BNZ   *+6                                                              
         DC    H'0'                SHOULD NOT HAPPEN                            
*                                                                               
         LA    R5,PLISREC          POINT R5 TO PLISREC (OUTPUT BLOCK)           
*                                                                               
CCOL30   DS    0H                                                               
         ZIC   R1,MAXLNTH          PREP FOR EXECUTED MOVE                       
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),0(R5)       EXEC MOVE OF 1 LINE OF TEXT                  
         BCT   RF,CCOL36                                                        
*                                                                               
         B     CCOLBK              DONE WITH THIS TEXT - NEXT ELEM              
*                                                                               
CCOL36   DS    0H                                                               
         L     R4,ANXTCOM          NEXT REPORT LINE                             
         LA    R4,70(R4)                                                        
         ST    R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         LA    R3,70(R3)           NEXT TEXT AREA                               
         LA    R5,70(R5)           NEXT CHOPPER LINE                            
         B     CCOL30              OUTPUT PRINT LINE                            
*                                                                               
CCOL50   DS    0H                  OUTPUT A SINGLE DATE                         
         GOTOR DATCON,DMCB,(X'03',BYCCDATA),(5,0(R3))                           
         B     CCOLBK              NEXT ELEMENT                                 
*                                                                               
CCOL60   DS    0H                  OUTPUT A DATE RANGE (PERIOD)                 
         GOTOR DATCON,DMCB,(X'13',BYCCDATA),(5,0(R3))                           
         B     CCOLBK              NEXT ELEMENT                                 
*                                                                               
CCOL70   DS    0H                  OUTPUT A NUMERIC FIELD (N, $, OR %)          
*                                                                               
         XC    DUB,DUB             DUMMY CURRENCY DEFINITION FLD                
         MVC   DUB+3(1),PCOLDECS                                                
         LA    RF,DUB                                                           
         CURED (P8,BYCCDATA),(20,0(R3)),(RF),ALIGN=LEFT,FLOAT=-,       X        
               COMMAS=YES                                                       
*                                                                               
CCOLBK   DS    0H                                                               
         BRAS  RE,RPYCUCOL         REPLY CUSTOM COLUMN FOR WEB IO               
*                                                                               
         B     CCOL20              NEXT CUSTOM COLUMN BUY ELEMENT               
*                                                                               
CCOLX    DS    0H                                                               
         MVC   KEY,TMPSVKEY                                                     
         GOTOR HIGH                                                             
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                NO ERRORS TOLERATED                          
*                                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R5                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
REVCOMNT NTR1  BASE=*,LABEL=*      PROCESS REASONS FOR REVISION                 
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         OC    FIDCHGTB(2),FIDCHGTB                                             
         JZ    EXIT                                                             
*                                                                               
         XC    TMPHALF1,TMPHALF1   LOOP COUNTER                                 
         LA    R2,FIDCHGTB                                                      
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#REAREV)              
*                                                                               
REVCM20  LA    R4,REVCMTAB         POINT TO REVISION COMMENT TABLE              
         LH    RE,TMPHALF1                                                      
         CHI   RE,FIDCTMXQ         PROCESSED ENTIRE CHG MAP CODE TABLE?         
         BH    REVCM50                                                          
         OC    0(2,R2),0(R2)       CHANGE MAP CODE ENTRY PRESENT?               
         BZ    REVCM50                                                          
*                                                                               
REVCM30  CLC   0(2,R2),0(R4)                                                    
         BE    REVCM40                                                          
         SR    RF,RF                                                            
         IC    RF,2(R4)                                                         
         AR    R4,RF               POINT TO NEXT ENTRY                          
         OC    0(2,R4),0(R4)                                                    
         BNZ   REVCM30                                                          
         DC    H'0'                ENTRY MUST BE IN TABLE                       
*                                                                               
REVCM40  XC    TMPWK1,TMPWK1                                                    
         SR    RF,RF                                                            
         IC    RF,2(R4)                                                         
         SHI   RF,3                ACTUAL LENGTH OF REVISION TEXT               
         CHI   RF,256                                                           
         BNH   *+6                                                              
         DC    H'0'                LENGTH IS TOO BIG                            
         CHI   RF,0                                                             
         BNL   *+6                                                              
         DC    H'0'                BAD LENGTH                                   
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),3(R4)     GET REVISION TEXT                            
         AHI   RF,1                RESTORE LENGTH FROM EX                       
         LA    RE,TMPWK1                                                        
         AR    RE,RF               POINT TO END OF REVISION TEXT                
         AHI   RF,8                LENGTH FOR " CHANGED"                        
         CHI   RF,250                                                           
         BNH   *+6                                                              
         DC    H'0'                LENGTH IS NOT SUPPORTED BY LINKIO            
         MVC   0(8,RE),=C' CHANGED'                                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#REAREV),    +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
*                                                                               
         LA    R2,2(R2)            POINT TO NEXT CHG MAP CODE ENTRY             
         LH    RE,TMPHALF1                                                      
         AHI   RE,1                COUNTER INCREMENT                            
         STH   RE,TMPHALF1                                                      
         B     REVCM20                                                          
*                                                                               
REVCM50  MVC   WKSVADCD,PBDJOB                                                  
         BRAS  RE,GETINSRC         GET INSTRUCTION RECORD                       
         BNE   REVCM_X                                                          
         MVC   TMPFULL1(3),=C'RC='                                              
         BRAS  RE,RPYRC_DC         REPLY REVISION COMMENTS                      
*                                                                               
REVCM_X  J     EXIT                                                             
*                                                                               
* MAP CODE, LENGTH OF ENTRY (REVISION TEXT + 3), REVISION TEXT                  
*                                                                               
REVCMTAB DS    0X                                                               
         DC    AL2(D#SPECFH),AL1(L'R_TXT001+3)                                  
R_TXT001 DC    C'SPECIAL FINANCIAL HANDLING'                                    
*                                                                               
         DC    AL2(D#CLICK),AL1(L'R_TXT002+3)                                   
R_TXT002 DC    C'CLICK-THOUGH, PAGE VIEW, IMPRESSION'                           
*                                                                               
         DC    AL2(D#ACHCOD),AL1(L'R_TXT003+3)                                  
R_TXT003 DC    C'ADDITIONAL CHARGE'                                             
*                                                                               
         DC    AL2(D#LEGALW),AL1(L'R_TXT004+3)                                  
R_TXT004 DC    C'LEGAL WARNING'                                                 
*                                                                               
         DC    AL2(D#UNTRAT),AL1(L'R_TXT005+3)                                  
R_TXT005 DC    C'RATE'                                                          
*                                                                               
         DC    AL2(D#SPCDSC),AL1(L'R_TXT006+3)                                  
R_TXT006 DC    C'SPACE DESCRIPTION'                                             
*                                                                               
         DC    AL2(D#INSDAT),AL1(L'R_TXT007+3)                                  
R_TXT007 DC    C'INSERTION DATE'                                                
*                                                                               
         DC    AL2(D#PREMUM),AL1(L'R_TXT008+3)                                  
R_TXT008 DC    C'PREMIUM'                                                       
*                                                                               
         DC    AL2(D#IORCOM),AL1(L'R_TXT009+3)                                  
R_TXT009 DC    C'INSERTION ORDER COMMENT'                                       
*                                                                               
         DC    AL2(D#SPCDAT),AL1(L'R_TXT010+3)                                  
R_TXT010 DC    C'SPACE CLOSING DATE'                                            
*                                                                               
         DC    AL2(D#ONSDAT),AL1(L'R_TXT011+3)                                  
R_TXT011 DC    C'ON-SALE DATE'                                                  
*                                                                               
         DC    AL2(D#ADCODE),AL1(L'R_TXT012+3)                                  
R_TXT012 DC    C'AD CODE'                                                       
*                                                                               
         DC    AL2(D#COMPCT),AL1(L'R_TXT013+3)                                  
R_TXT013 DC    C'AGENCY COMMISSION %'                                           
*                                                                               
         DC    AL2(D#DSCPCT),AL1(L'R_TXT014+3)                                  
R_TXT014 DC    C'CASH DISCOUNT %'                                               
*                                                                               
         DC    AL2(D#INSDA2),AL1(L'R_TXT015+3)                                  
R_TXT015 DC    C'2ND INSERTION DATE'                                            
*                                                                               
         DC    AL2(D#TAXPCT),AL1(L'R_TXT016+3)                                  
R_TXT016 DC    C'TAX %'                                                         
*                                                                               
         DC    AL2(D#MCLDAT),AL1(L'R_TXT017+3)                                  
R_TXT017 DC    C'MATERIAL CLOSING DATE'                                         
*                                                                               
         DC    AL2(D#POSCOM),AL1(L'R_TXT018+3)                                  
R_TXT018 DC    C'POSITION INSTRUCTION'                                          
*                                                                               
         DC    AL2(D#FROINS),AL1(L'R_TXT019+3)                                  
R_TXT019 DC    C'MOVED INSERTION'                                               
*                                                                               
         DC    AL2(0)              END OF TABLE                                 
*                                                                               
         LTORG                                                                  
         DROP  RB,R3                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CANCOMNT NTR1  BASE=*,LABEL=*      CK FOR CANCELLATION COMMENTS                 
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
         TM    PBUYCNTL,X'80'      DELETED?                                     
         JZ    EXIT                                                             
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         MVC   WKSVADCD,PBDJOB                                                  
         BRAS  RE,GETINSRC         GET INSTRUCTION RECORD                       
         BNE   CANCM_X                                                          
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'                                                     
CANCM30  BRAS  RE,NXTEL                                                         
         BNE   CANCM_X                                                          
         CLI   1(R2),2+3           DC= AND MORE?                                
         BNH   CANCM30                                                          
         CLC   2(3,R2),=C'DC='     CANCELLATION COMMENT?                        
         BNE   CANCM30                                                          
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#CANLCM)              
*                                                                               
         MVC   TMPFULL1(3),=C'DC='                                              
         BRAS  RE,RPYRC_DC         REPLY CANCELLATION COMMENTS                  
*                                                                               
CANCM_X  J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R3                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
GETINSRC NTR1  BASE=*,LABEL=*      RETURN INSTRUCTION REC IN PINSREC            
*                                                                               
         MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),WKSVADCD  SET BY CALLER                                
         MVC   KEY+16(6),PBUYKPUB                                               
         CLI   ZEOPT,C'Y'          MULTI ZONE/EDIT?                             
         BNE   *+10                                                             
         XC    KEY+20(2),KEY+20    USE ONLY BASE PUB                            
         CLC   KEY(25),PINSREC     ALREADY HAVE?                                
         BE    GTIRC50                                                          
         GOTOR HIGH                                                             
         TM    KEY+25,X'80'        DELETED?                                     
         BNZ   GTIRC30                                                          
         CLC   KEY(25),KEYSAVE     RECORD FOUND?                                
         BE    GTIRC40                                                          
GTIRC30  MVC   KEYSAVE+16(6),=6X'FF'                                            
         CLC   KEY(25),KEYSAVE     FF DEFAULT?                                  
         BE    GTIRC40                                                          
         MVC   KEY,KEYSAVE                                                      
         GOTOR HIGH                                                             
         CLC   KEY(25),KEYSAVE     RECORD FOUND?                                
         BE    GTIRC40                                                          
         MVI   PINSREC+33,0        SET INSTRUCTION REC NOT FOUND                
         B     GTIRC_X                                                          
GTIRC40  LA    R0,PINSREC                                                       
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
*                                                                               
GTIRC50  CLI   PINSREC+33,X'01'    1ST INSTRUCTION REC ELEM PRESENT?            
         BNE   GTIRC_X                                                          
         SR    RE,RE                                                            
         ICM   RE,2,PINSREC+25     RECORD LENGTH                                
         CHI   RE,1000                                                          
         BL    *+6                                                              
         DC    H'0'                RECORD AREA NEEDS TO BE EXPANDED             
*                                                                               
GTIRC_X  MVC   KEY,TMPSVKEY        RESTORE ORIGINAL SETTINGS                    
         MVC   AREC,TMPSVAIO                                                    
         CLI   PINSREC+33,X'01'    INSTRUCTION REC FOUND?                       
         JE    EXITY                                                            
         J     EXITN                                                            
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYRC_DC NTR1  BASE=*,LABEL=*      REPLY RC OR DC COMMENTS                      
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
RPYRD30  BRAS  RE,NXTEL                                                         
         BNE   RPYRD_X                                                          
         CLI   1(R2),2+3           ELEM HAS NOTHING IN IT?                      
         BNH   RPYRD30                                                          
         LHI   R4,D#REAREV                                                      
         CLI   TMPFULL1,C'R'       REVISION COMMENT?                            
         BE    RPYRD40                                                          
         LHI   R4,D#CANLCM                                                      
         CLI   TMPFULL1,C'D'       CANCELLATION COMMENT?                        
         BE    RPYRD40                                                          
         DC    H'0'                INVALID PARAMETER                            
RPYRD40  CLC   2(3,R2),TMPFULL1    REVISION COMMENT?                            
         BNE   RPYRD30                                                          
         SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2+3+1            ADJUST OVERHEADS AND ONE FOR EX              
         CHI   RF,0                                                             
         BL    RPYRD30                                                          
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),2+3(R2)                                                
         AHI   RF,1                                                             
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',(R4)),        +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
         J     RPYRD30                                                          
*                                                                               
RPYRD_X  J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R3                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
INICHGTB NTR1  BASE=*,LABEL=*      CHG MAP CODE TABLE FOR FLD INDICATOR         
*                                                                               
         XC    FIDCHGTB(FIDCHGLQ),FIDCHGTB                                      
         MVI   WKEIOFLG,0                                                       
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         LA    R2,PBUYREC+33                                                    
         USING PBYMELEM,R2                                                      
         MVI   ELCODE,PBYMELCQ     BUY MOVE ELEM CODE                           
INICT14  BRAS  RE,NXTEL                                                         
         BNE   INICT16                                                          
         TM    PBYMSTAT,PBYMFROQ   MOVED "FROM"?                                
         BZ    *+8                                                              
         OI    WKEIOFLG,E_IOBMFQ   CONTAIN BUY MOVE "FROM" ELEM                 
         TM    PBYMSTAT,PBYMTO_Q   MOVED "TO"?                                  
         BZ    *+8                                                              
         OI    WKEIOFLG,E_IOBMTQ   CONTAIN BUY MOVE "TO" ELEM                   
         B     INICT14                                                          
*                                                                               
INICT16  TM    PBUYCNTL,X'80'      DELETED?                                     
         JNZ   EXIT                IGNORE CHG ACTIVITIES FOR DELETED            
*                                                                               
         XC    TMPFULL1,TMPFULL1                                                
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PWIOELCQ     WEB INSERTION ORDER ELEM CODE                
INICT20  BRAS  RE,NXTEL                                                         
         BNE   INICT30                                                          
         USING PWIOELEM,R2                                                      
         MVC   TMPFULL1(L'PWIODATE),PWIODATE                                    
         TM    PWIOSTAT,PWIODBMQ   DELETED BUY MOVE CHG ORDER ISSUED?           
         BZ    *+8                                                              
         OI    WKEIOFLG,E_IOBMDQ                                                
         TM    PWIOSTAT,PWIOBMOQ   BUY MOVE INSERTION ORDER ISSUED?             
         BZ    *+8                                                              
         OI    WKEIOFLG,E_IOBMOQ                                                
         LR    RF,R2                                                            
         B     INICT20                                                          
*                                                                               
INICT30  OC    TMPFULL1,TMPFULL1   LAST INSERTION ORDER DATE PRESENT?           
         BZ    *+12                                                             
         OI    WKEIOFLG,E_IOELMQ   EIO ELEM FOUND IN INSERTION                  
         B     INICT40                                                          
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'        INSERTION ORDER ELEM CODE                    
INICT34  BRAS  RE,NXTEL                                                         
         BNE   INICT36                                                          
         USING PIOELEM,R2                                                       
         MVC   TMPFULL1(L'PIODATE),PIODATE                                      
         LR    RF,R2                                                            
         B     INICT34                                                          
*                                                                               
INICT36  OC    TMPFULL1,TMPFULL1   LAST INSERTION ORDER DATE PRESENT?           
         BZ    INICT60                                                          
*                                                                               
INICT40  LR    R2,RF               CHG ELEMS RIGHT AFTER LAST WEB IO            
         MVI   ELCODE,X'24'        CHANGE ELEM CODE                             
INICT50  BRAS  RE,NXTEL                                                         
         BNE   INICT60                                                          
         USING PCHGELEM,R2                                                      
         GOTOR DATCON,DMCB,(2,PCHGDAT),(3,TMPFULL2)                             
         CLC   TMPFULL2,TMPFULL1                                                
         BL    INICT50                                                          
*                                                                               
         CLC   TMPFULL2,TMPFULL1   SAME DAY CHANGES?                            
         BNE   INICT52                                                          
         TM    WKEIOFLG,E_IOELMQ   EIO ELEM FOUND IN INSERTION?                 
         BZ    INICT52                                                          
         TM    WKEIOFLG,E_IOGENQ   EIO IS GENERATED IN SAME DAY?                
         BNZ   INICT52                                                          
         TM    PCHGIND4,X'02'      WEB IO GENERATED?                            
         BZ    INICT50                                                          
         OI    WKEIOFLG,E_IOGENQ   EIO IS GENERATED IN SAME DAY                 
*                                                                               
INICT52  TM    PCHGIND4,X'80'      SFH STATUS CHANGED?                          
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#SPECFH)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND4,X'20'      CT, PV,IMPRESSION CHANGED?                   
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#CLICK)                                           
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND4,X'10'      ADDITIONAL CHARGES CHANGED?                  
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#ACHCOD)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND4,X'08'      LEGAL WARNINGS CHANGED?                      
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#LEGALW)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND1,X'40'      RATE CHANGE D?                               
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#UNTRAT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND1,X'10'      DESCRIPTION CHANGED?                         
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#SPCDSC)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND1,X'08'      INSERTION DATE CHANGED?                      
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#INSDAT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND1,X'04'      PREMIUM CHANGED?                             
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#PREMUM)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND1,X'01'      IOC CHANGE?                                  
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#IORCOM)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND2,X'80'      SPACE CLOSE DATE CHANGED?                    
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#SPCDAT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND2,X'40'      SALE DATE CHANGED?                           
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#ONSDAT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND2,X'08'      JOB NUMBER CHANGED?                          
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#ADCODE)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND2,X'04'      AGY COMM CHANGED?                            
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#COMPCT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND2,X'02'      CASH DISCOUNT CHANGED?                       
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#DSCPCT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND3,X'80'      2ND INS DATE CHANGED?                        
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#INSDA2)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND3,X'08'      TAX CHANGED?                                 
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#TAXPCT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND3,X'02'      MATERIALS CLOSING DATE CHANGED?              
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#MCLDAT)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         TM    PCHGIND3,X'01'      POSITION INSTRUCTIONS CHANGED?               
         BZ    *+14                                                             
         MVC   TMPHALF1,=AL2(D#POSCOM)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
         B     INICT50                                                          
*                                                                               
INICT60  TM    WKEIOFLG,E_IOBMOQ   BUY MOVE INSERTION ORDER ISSUED?             
         BNZ   INICT70                                                          
         TM    WKEIOFLG,E_IOBMFQ   BUY MOVE "FROM" ELEM PRESENT?                
         BZ    INICT70                                                          
         TM    PBUYCNTL,X'80'      DELETED?                                     
         BZ    INICT70                                                          
         MVC   TMPHALF1,=AL2(D#FROINS)                                          
         BRAS  RE,INICTPUT                                                      
*                                                                               
INICT70  DS    0H                                                               
*                                                                               
INICTX   J     EXIT                                                             
*                                                                               
INICTPUT LR   R0,RE                                                             
         SR   RF,RF                                                             
         LA   RE,FIDCHGTB                                                       
INICTP10 CHI  RF,FIDCTMXQ          MAX ENTRIES REACHED?                         
         BL   *+6                                                               
         DC   H'0'                                                              
         OC   0(2,RE),0(RE)        BLANK ENTRY?                                 
         BZ   INICTP40                                                          
         CLC  0(2,RE),TMPHALF1     ALREADY IN TABLE?                            
         BE   INICTPX                                                           
         AHI  RF,1                 COUNTER INCREMENT                            
         LA   RE,2(RE)             POINT TO NEXT ENTRY                          
         B    INICTP10                                                          
INICTP40 MVC  0(2,RE),TMPHALF1     PUT MAP CODE IN TABLE                        
INICTPX  LR   RE,R0                                                             
         BR   RE                                                                
*                                                                               
         LTORG                                                                  
         DROP  RB,R2                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
IOPICOMM NTR1  BASE=*,LABEL=*      PROCESS IO AND PI COMMENTS                   
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'67'                                                     
*                                                                               
BC4      BRAS  RE,NXTEL                                                         
         BNE   BC20                                                             
         CLI   1(R2),2                                                          
         BE    BC4                                                              
*                                                                               
BC5      DS    0H                  CAN GET HERE FROM BC22                       
         MVI   THISBUY+34,C'C'     CAN'T USE DITTOS                             
         CLC   2(4,R2),=C'COM='                                                 
         BE    BC8                 STANDARD COMMENT                             
*                                                                               
         L     R4,ANXTCOM                                                       
         XC    0(70,R4),0(R4)                                                   
         MVC   SAVEP,SPACES                                                     
         ZIC   R5,1(R2)                                                         
         AHI   R5,-3                                                            
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   SAVEP(0),2(R2)                                                   
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)                                                        
*                                                                               
BC5H     ST    R3,ANXTCOM          NOTE: COMMENTS NOT DOUBLE SPACED             
*                                                                               
         XC    TMPFULL1,TMPFULL1                                                
         BRAS  RE,RPYIOPIC         REPLY IO AND PI COMMENTS                     
*                                                                               
         B     BC4                                                              
*                                                                               
BC8      DS    0H                                                               
         ST    R2,SAVER2           SAVE BUYREC'S R2                             
         MVC   SVELCOD,ELCODE      MUST SAVE ELCODE                             
         MVC   SVBUYKEY,KEY                                                     
         XC    KEY,KEY                                                          
         MVC   KEY(3),QAGENCY                                                   
         MVI   KEY+3,X'40'                                                      
         ZIC   R5,1(R2)                                                         
         SHI   R5,6                                                             
         LTR   R5,R5                                                            
         BZ    BC8X                NO NUMBER                                    
         MVC   WORK(10),SPACES                                                  
         LA    R7,WORK+6                                                        
         SR    R7,R5                                                            
         BCTR  R5,0                                                             
         EX    R5,*+8                                                           
         B     *+10                                                             
*                                                                               
         MVC   0(0,R7),6(R2)                                                    
*                                                                               
         MVC   KEY+4(6),WORK                                                    
         GOTOR HIGH                                                             
*                                                                               
         MVC   TMPFULL1,AREC                                                    
         LA    RE,PLISREC                                                       
         ST    RE,AREC                                                          
         GOTOR GETPRT                                                           
         MVC   AREC,TMPFULL1                                                    
*                                                                               
         LA    R2,PLISREC+33                                                    
         MVI   ELCODE,X'40'                                                     
         CLI   0(R2),X'40'                                                      
         BE    BC8D                                                             
*                                                                               
BC8C     BRAS  RE,NXTEL                                                         
         BNE   BC8X                                                             
*                                                                               
BC8D     DS    0H                                                               
         CLC   2(5,R2),=C'SHIP='                                                
         BE    BC8C                                                             
         CLC   2(6,R2),=C'LABEL='                                               
         BE    BC8C                                                             
         CLC   2(4,R2),=C'MAT='                                                 
         BE    BC8C                                                             
         CLC   2(3,R2),=C'RC='                                                  
         BE    BC8C                                                             
         LA    R4,2(R2)                                                         
         LR    R1,R4                                                            
         ZIC   R5,1(R2)                                                         
         AHI   R5,-3                                                            
         BM    BC8C                                                             
*                                                                               
         CLI   0(R4),C'+'                                                       
         BNE   *+8                                                              
         LA    R1,2(R1)                                                         
         SR    RF,RF                                                            
         CLC   0(3,R1),=C'DC='     ONLY DC= COMMNTS                             
         BNE   *+8                 ON CANCELS                                   
         LA    RF,1                                                             
         CLI   TSCHGSW-STATDIF,C'D'                                             
         BNE   *+6                                                              
         BCTR  RF,R0                                                            
         LTR   RF,RF                                                            
         BNZ   BC8C                                                             
*                                                                               
         CLI   0(R4),C'+'                                                       
         BNE   BC8F                                                             
         CLI   1(R4),C'1'          ONLY PACK IF NUMERIC                         
         BL    BC8F                ELSE TREAT AS REGULAR LINE                   
         PACK  DUB,1(1,R4)                                                      
         CVB   R7,DUB                                                           
*                                                                               
         MVC   TMPFULL1(2),0(R4)                                                
         MVC   TMPBYTE1,ELCODE                                                  
         MVC   ELCODE,SVELCOD                                                   
         BRAS  RE,RPYIOPIC         REPLY IO AND PI COMMENTS                     
         MVC   ELCODE,TMPBYTE1                                                  
*                                                                               
         L     R3,ANXTCOM                                                       
BC8E     XC    0(70,R3),0(R3)      CAN'T USE SPACES                             
         LA    R3,70(R3)                                                        
         BCT   R7,BC8E                                                          
         ST    R3,ANXTCOM                                                       
         LA    R4,2(R4)                                                         
         AHI   R5,-2                                                            
*                                                                               
BC8F     LTR   R5,R5                                                            
         BM    BC8C                                                             
         MVC   SAVEP,SPACES                                                     
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   SAVEP(0),0(R4)                                                   
         L     R3,ANXTCOM                                                       
         MVC   0(70,R3),SAVEP                                                   
         LA    R3,70(R3)                                                        
BC8H     ST    R3,ANXTCOM                                                       
*                                                                               
         XC    TMPFULL1,TMPFULL1                                                
         MVC   TMPBYTE1,ELCODE                                                  
         MVC   ELCODE,SVELCOD                                                   
         BRAS  RE,RPYIOPIC         REPLY IO AND PI COMMENTS                     
         MVC   ELCODE,TMPBYTE1                                                  
*                                                                               
         MVC   SAVEP,SPACES                                                     
         B     BC8C                                                             
*                                                                               
BC8X     MVC   ELCODE,SVELCOD      RESTORE ELCODE                               
         MVC   KEY,SVBUYKEY                                                     
         L     R2,SAVER2           RESTORE BUYREC'S R2                          
         B     BC4                                                              
*                                                                               
BC20     CLI   ELCODE,X'68'                                                     
         BE    BCX                                                              
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'68'                                                     
*                                                                               
BC22     BRAS  RE,NXTEL                                                         
         BNE   BCX                                                              
         CLI   1(R2),2                                                          
         BE    BC22                                                             
         L     R3,ANXTCOM                                                       
         XC    0(70,R3),0(R3)                                                   
         LA    R3,70(R3)                                                        
         XC    0(70,R3),0(R3)                                                   
*--->    MVC   0(29,R3),=C'*** POSITION INSTRUCTIONS ***'                       
         L     RF,ADICSECT                                                      
         USING DICSECTF,RF                                                      
         MVC   0(L'PP@POSI,R3),PP@POSI                                          
         DROP  RF                                                               
         LA    R3,70(R3)                                                        
         ST    R3,ANXTCOM                                                       
         B     BC5                 NOW GO PROCESS ELEM                          
*                                                                               
BCX      DS    0H                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
WEBIODET NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         BRAS  RE,SETWIODT         SET WEB IO DETAIL VALUES                     
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#IO2DET)              
         OI    ADRPYREC,RPYDETLQ   DETAIL SECTION REPLIED                       
*                                                                               
         L     RF,AWIODSST         POINT TO WIO STORAGE BLOCK                   
         USING WIODSD,RF                                                        
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#IOLKEY),    +        
               ('LD_CHARQ',H_IOLKEY),('H_IOLKYL',0)                             
         DROP  RF                                                               
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,NXTEL                                                         
         BE    *+6                                                              
         DC    H'0'                INSERTION SHOULD HAVE SERIAL#                
         USING PSERELEM,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#BYSER),     +        
               ('LD_SPAKQ',PSERNUM),(L'PSERNUM,0)                               
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSDAT),    +        
               ('LD_BDATQ',PBUYKDAT),(L'PBUYKDAT,0)                             
         MVC   TMPHALF1,=AL2(D#INSDAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
         CLC   LIOBPCV1,=AL1(03,02,00,17)                                       
         BL    WIOD026                                                          
         CLI   PBDFREQ,C'M'        MONTHLY?                                     
         BNE   *+12                                                             
         MVI   TMPWK1,C'M'                                                      
         B     WIOD024D                                                         
         MVC   TMPWK1(1),PBDBFD                                                 
         CLI   TMPWK1,C'W'         WEEK OF?                                     
         BE    WIOD024D                                                         
         CLI   TMPWK1,C'B'         BEST FOOD DAY?                               
         BE    WIOD024D                                                         
         MVI   TMPWK1,C'D'         DEFAULT TO DAILY                             
WIOD024D GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSFRQ),    +        
               ('LD_CHARQ',TMPWK1),(1,0)                                        
*                                                                               
WIOD026  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSBYL),    +        
               ('LD_CHARQ',D_INSDLN),(L'D_INSDLN,0)                             
                                                                                
         CLC   LIOBPCV1,=AL1(03,02,00,17)                                       
         BL    *+8                                                              
         BRAS  RE,RPYFLDID                                                      
*                                                                               
         CLI   ESTOPT,C'D'         PROFILE SET FOR BOTH EST # AND NAME?         
         BE    *+12                                                             
         CLI   ESTOPT,C'Y'         PROFILE SET FOR BOTH EST #?                  
         BNE   WIOD030                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTNUM),    +        
               ('LD_UBINQ',PBUYKEST),(L'PBUYKEST,0)                             
         CLI   ESTOPT,C'D'         PROFILE SET FOR BOTH EST # AND NAME?         
         BNE   WIOD030                                                          
         MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
         XC    KEY,KEY                                                          
         MVC   KEY(10),PBUYKEY     AGY/MED/RECODE/CLT/PRD                       
         MVI   KEY+3,X'07'         ESTIMATE RECORD CODE                         
         MVC   KEY+10(2),PBUYKEST  BINARY ESTIMATE NUMBER                       
         GOTOR HIGH                                                             
         LA    RE,TMPWKAIO                                                      
         ST    RE,AREC                                                          
         GOTOR GETPRT                                                           
         MVC   KEY,TMPSVKEY        RESTORE ORIGINAL SETTINGS                    
         MVC   AREC,TMPSVAIO                                                    
         LA    RE,TMPWKAIO                                                      
         LA    RE,PESTELEM-PESTKEY(RE)                                          
         CLI   0(RE),X'07'                                                      
         BE    *+6                                                              
         DC    H'0'                INVALID ESTIMATE RECORD                      
         MVC   TMPWK1(L'PESTNAME),PESTNAME-PESTELEM(RE)                         
         MVC   TMPWK2(L'PESTNAM2),PESTNAM2-PESTELEM(RE)                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTNAM),    +        
               ('LD_CHARQ',TMPWK1),(L'PESTNAME,0)                               
         OC    TMPWK2(L'PESTNAM2),SPACES                                        
         CLC   TMPWK2(L'PESTNAM2),SPACES                                        
         BE    WIOD030                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTNM2),    +        
               ('LD_CHARQ',TMPWK2),(L'PESTNAM2,0)                               
*                                                                               
WIOD030  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSTYP),    +        
               ('LD_CHARQ',D_MODCOD),(L'D_MODCOD,0)                             
*                                                                               
         OC    BPUB+4(2),BPUB+4    ALREADY SENT IN HEADER SECTION?              
         BNZ   WIOD036                                                          
         OC    PBUYKZON,PBUYKZON   PUB ZONE PRESENT?                            
         BZ    WIOD034D                                                         
         XC    TMPWK1,TMPWK1                                                    
         GOTOR APUBEDIT,DMCB,(X'08',PBUYKPUB),(C'S',TMPWK1)                     
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBZON),    +        
               ('LD_CHARQ',TMPWK1+8+1),(2,0)                                    
         BRAS  RE,RPYPZNAM         REPLY PUBLICATION ZONE NAME                  
*                                                                               
WIOD034D OC    PBUYKEDT,PBUYKEDT                                                
         BZ    WIOD036                                                          
         OC    PBUYKZON,PBUYKZON   PUB ZONE PRESENT?                            
         BNZ   WIOD034H                                                         
         XC    TMPWK1,TMPWK1                                                    
         GOTOR APUBEDIT,DMCB,(X'08',PBUYKPUB),(C'S',TMPWK1)                     
         LA    RF,TMPWK1+8+1                                                    
         B     *+8                                                              
WIOD034H LA    RF,TMPWK1+8+1+2+1                                                
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PUBEDT),    +        
               ('LD_CHARQ',0(RF)),(3,0)                                         
         GOTOR APUBEDIT,DMCB,(X'08',PBUYKPUB),(C'E',TMPWK1)                     
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#EDTEXP),    +        
               ('LD_CHARQ',TMPWK1),(11,0)                                       
*                                                                               
WIOD036  BRAS  RE,RPYCONTR         REPLY CONTRACT INFORMATION                   
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#IOTYPE),    +        
               ('LD_CHARQ',D_IORTYP),(L'D_IORTYP,0)                             
*                                                                               
         LA    RF,L'PBYOSPC1                                                    
         MVC   TMPWK1(L'PBYOSPC1),PBYOSPC1                                      
         OC    TMPWK1(L'PBYOSPC1),SPACES                                        
         CLC   TMPWK1(L'PBYOSPC1),SPACES                                        
         BNE   *+16                                                             
         CLI   QMEDIA,C'N'         NEWSPAPER?                                   
         BNE   *+12                                                             
         BRAS  RE,FMT_NSPD                                                      
         BRAS  RE,WIOD_SPD         REPLY SPACE DESCRIPTION                      
         LA    RF,L'PBYOSPC2                                                    
         MVC   TMPWK1(L'PBYOSPC2),PBYOSPC2                                      
         OC    TMPWK1(L'PBYOSPC2),SPACES                                        
         CLC   TMPWK1(L'PBYOSPC2),SPACES                                        
         BE    *+8                                                              
         BRAS  RE,WIOD_SPD         REPLY SPACE DESCRIPTION                      
*                                                                               
WIOD042  CLI   COPYOPT,C'N'        SUPPRESS COPY NUMBER?                        
         BNE   WIOD044                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CPYNUM),    +        
               ('LD_CHARQ',PJOBCPY),(L'PJOBCPY,0)                               
*                                                                               
WIOD044  MVC   TMPWK1(L'PJOBCAP1),PJOBCAP1                                      
         OC    TMPWK1(L'PJOBCAP1),SPACES                                        
         CLC   TMPWK1(L'PJOBCAP1),SPACES                                        
         BE    WIOD054                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADCAP),     +        
               ('LD_CHARQ',PJOBCAP1),(L'PJOBCAP1,0)                             
*                                                                               
WIOD054  MVC   TMPWK1(L'PJOBCAP2),PJOBCAP2                                      
         OC    TMPWK1(L'PJOBCAP2),SPACES                                        
         CLC   TMPWK1(L'PJOBCAP2),SPACES                                        
         BE    WIOD060                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADCAP2),    +        
               ('LD_CHARQ',PJOBCAP2),(L'PJOBCAP2,0)                             
*                                                                               
WIOD060  OC    PBDMDATE,PBDMDATE                                                
         BZ    WIOD066                                                          
         CLI   MATEOPT,C'Y'                                                     
         BNE   WIOD066                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MCLDAT),    +        
               ('LD_BDATQ',PBDMDATE),(L'PBDMDATE,0)                             
         MVC   TMPHALF1,=AL2(D#MCLDAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD066  CLI   ADOPT,C'Y'          PROFILE SET FOR AD CODE?                     
         BNE   WIOD068                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADCODE),    +        
               ('LD_CHARQ',PBDJOB),(L'PBDJOB,0)                                 
         MVC   TMPHALF1,=AL2(D#ADCODE)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD068  MVC   TMPWK1(L'PJOBADID),PJOBADID                                      
         OC    TMPWK1(L'PJOBADID),SPACES                                        
         CLC   TMPWK1(L'PJOBADID),SPACES                                        
         BE    WIOD070                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#AD_ID),     +        
               ('LD_CHARQ',PJOBADID),(L'PJOBADID,0)                             
         MVC   TMPHALF1,=AL2(D#ADCODE)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD070  CLI   ACOPT,C'Y'                                                       
         BNE   WIOD072                                                          
         EDITR PBDACP,(6,TMPWK1),3,ALIGN=LEFT,IZERO=Y                           
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMPCT),    +        
               ('LD_CHARQ',TMPWK1),(6,0)                                        
         MVC   TMPHALF1,=AL2(D#COMPCT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD072  CLI   ACOPT,C'$'                                                       
         BNE   WIOD076                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMAMT),    +        
               ('LD_CBINQ',AGYCOM),(L'AGYCOM,0)                                 
         MVC   TMPHALF1,=AL2(D#COMPCT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD076  CLI   CDOPT,C'Y'                                                       
         BNE   WIOD078                                                          
         EDITR PBDCD,(4,TMPWK1),1,ALIGN=LEFT,IZERO=Y                            
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#DSCPCT),    +        
               ('LD_CHARQ',TMPWK1),(4,0)                                        
         MVC   TMPHALF1,=AL2(D#DSCPCT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD078  CLI   CDOPT,C'$'                                                       
         BNE   WIOD082                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#DSCAMT),    +        
               ('LD_CBINQ',CSHDSC),(L'CSHDSC,0)                                 
         MVC   TMPHALF1,=AL2(D#DSCPCT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD082  CLI   TAXOPT,C'B'         BOTH % AND $?                                
         BE    *+12                                                             
         CLI   TAXOPT,C'%'         %?                                           
         BNE   WIOD084                                                          
         EDITR PBDTAX,(9,TMPWK1),4,ALIGN=LEFT,IZERO=Y                           
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#TAXPCT),    +        
               ('LD_CHARQ',TMPWK1),(9,0)                                        
         MVC   TMPHALF1,=AL2(D#TAXPCT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD084  CLI   TAXOPT,C'B'         BOTH % AND $?                                
         BE    *+12                                                             
         CLI   TAXOPT,C'$'         %?                                           
         BNE   WIOD088                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#TAXAMT),    +        
               ('LD_CBINQ',TAX),(L'TAX,0)                                       
         MVC   TMPHALF1,=AL2(D#TAXPCT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD088  CLI   ONSOPT,C'Y'         SHOW ON-SALE DATE?                           
         BNE   WIOD092                                                          
         OC    PBDSDATE,PBDSDATE                                                
         BZ    WIOD092                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ONSDAT),    +        
               ('LD_BDATQ',PBDSDATE),(L'PBDSDATE,0)                             
         MVC   TMPHALF1,=AL2(D#ONSDAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD092  OC    PBDCDATE,PBDCDATE                                                
         BZ    WIOD096                                                          
         CLI   CLOOPT,C'Y'                                                      
         BNE   WIOD096                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SPCDAT),    +        
               ('LD_BDATQ',PBDCDATE),(L'PBDCDATE,0)                             
         MVC   TMPHALF1,=AL2(D#SPCDAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD096  CLI   COSTOPT,C'N'        NOT TO SHOW COST?                            
         BE    WIOD098                                                          
         CLI   PBUYKMED,C'N'       NEWSPAPER?                                   
         BNE   WIOD096M                                                         
         CLC   LIOBPCV1,=AL1(03,03,00,19)                                       
         BL    WIOD096M                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#UNTRAT),    +        
               ('LD_CHARQ',D_INSRAT),(L'D_INSRAT,0)                             
         MVC   TMPHALF1,=AL2(D#UNTRAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD096M BRAS  RE,FMT_COST                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COSIND),    +        
               ('LD_CHARQ',D_COSIND),(L'D_COSIND,0)                             
         MVC   TMPHALF1,=AL2(D#UNTRAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
         LHI   RF,D#UNTRAT                                                      
         CLC   LIOBPCV1,=AL1(03,03,00,19)                                       
         BL    *+8                                                              
         LHI   RF,D#ICOST1                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',(RF)),        +        
               ('LD_CHARQ',D_INSCOS),(L'D_INSCOS,0)                             
         MVC   TMPHALF1,=AL2(D#UNTRAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
         CLI   COSTOPT,C'B'        BOTH GROSS AND NET?                          
         BNE   WIOD098                                                          
         CLC   LIOBPCV1,=AL1(03,03,00,02)                                       
         BL    WIOD098                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COSIN2),    +        
               ('LD_CHARQ',D_COSIN2),(L'D_COSIN2,0)                             
         MVC   TMPHALF1,=AL2(D#UNTRAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ICOST2),    +        
               ('LD_CHARQ',D_INSCO2),(L'D_INSCO2,0)                             
         MVC   TMPHALF1,=AL2(D#UNTRAT)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
*                                                                               
WIOD098  OC    PBYOPRM,SPACES                                                   
         CLC   PBYOPRM,SPACES      NOTHING IN PREMIUM?                          
         BE    WIOD100                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PREMUM),    +        
               ('LD_CHARQ',PBYOPRM),(L'PBYOPRM,0)                               
         MVC   TMPHALF1,=AL2(D#PREMUM)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD100  BRAS  RE,WEBIOD_2         REPLY WEB IO DETAIL PART 2                   
*                                                                               
         J     EXIT                                                             
*                                                                               
WIOD_SPD ST    RE,TMPSVRE                                                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SPCDSC),    +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
         MVC   TMPHALF1,=AL2(D#SPCDSC)                                          
         BRAS  RE,RPYFLDID                                                      
         L     RE,TMPSVRE                                                       
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R3                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
WEBIOD_2 NTR1  BASE=*,LABEL=*      PART OF WEB IO DETAIL DATA STREAM            
*                                                                               
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'88'        CLICK-THROUGH ELEM CODE                      
         BRAS  RE,NXTEL                                                         
         BNE   WIOD104                                                          
         USING PCLCKTEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CLICK),     +        
               ('LD_SPAKQ',PCLCKTS),(L'PCLCKTS,0)                               
         MVC   TMPHALF1,=AL2(D#CLICK)                                           
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD104  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'87'        PAGE VIEWS ELEM CODE                         
         BRAS  RE,NXTEL                                                         
         BNE   WIOD108                                                          
         USING PPAGEVEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#VIEWS),     +        
               ('LD_SPAKQ',PPAGEVS),(L'PPAGEVS,0)                               
         MVC   TMPHALF1,=AL2(D#CLICK)                                           
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD108  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'92'        ESTIMATED IMPRESSIONS ELEM CODE              
         BRAS  RE,NXTEL                                                         
         BNE   WIOD110                                                          
         USING PIMPRSEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ESTIMP),    +        
               ('LD_SPAKQ',PIMPRS),(L'PIMPRS,0)                                 
         MVC   TMPHALF1,=AL2(D#CLICK)                                           
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD110  CLI   AIMPSOPT,C'Y'       SHOW ACTUAL IMPRESSIONS?                     
         BNE   WIOD112                                                          
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'93'        ACTUAL IMPRESSIONS ELEM CODE                 
         BRAS  RE,NXTEL                                                         
         BNE   WIOD112                                                          
         USING PAIMSPEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ACTIMP),    +        
               ('LD_SPAKQ',PAIMPRS),(L'PAIMPRS,0)                               
         MVC   TMPHALF1,=AL2(D#CLICK)                                           
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD112  CLC   DAYOFWK,SPACES      PROFILE ALREADY SET FOR DAY OF WEEK?         
         BE    WIOD118                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSDWK),    +        
               ('LD_CHARQ',DAYOFWK),(L'DAYOFWK,0)                               
*                                                                               
WIOD118  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'96'        MATERIAL EXTENSION DATE ELEM CODE            
         BRAS  RE,NXTEL                                                         
         BNE   WIOD120                                                          
         USING PEXDATEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MCLXDT),    +        
               ('LD_BDATQ',PEXDATE),(L'PEXDATE,0)                               
*                                                                               
WIOD120  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'89'        MATERIAL EXTENSION DAYS ELEM CODE            
         BRAS  RE,NXTEL                                                         
         BNE   WIOD124                                                          
         USING PEXDAYEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MCLXDY),    +        
               ('LD_SPAKQ',PEXDAYS),(L'PEXDAYS,0)                               
*                                                                               
WIOD124  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'82'        FREE STANDING INSERTS ELEM CODE              
         BRAS  RE,NXTEL                                                         
         BNE   WIOD128                                                          
         USING PBFSIEL,R2                                                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#FSINS),     +        
               ('LD_SPAKQ',PBFSI),(L'PBFSI,0)                                   
*                                                                               
WIOD128  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'98'        SITE LOCATION ELEM CODE                      
         BRAS  RE,NXTEL                                                         
         BNE   WIOD132                                                          
         USING PISITEEL,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SITELO),    +        
               ('LD_CHARQ',PISITE),(L'PISITE,0)                                 
*                                                                               
WIOD132  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'83'        REFERENCE NUMBER ELEM CODE                   
         BRAS  RE,NXTEL                                                         
         BNE   WIOD136                                                          
         USING PBREFEL,R2                                                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#REFNUM),    +        
               ('LD_CHARQ',PBREFNO),(L'PBREFNO,0)                               
*                                                                               
WIOD136  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PISNMELQ     ISSUE NAME ELEM CODE                         
         BRAS  RE,NXTEL                                                         
         BNE   WIOD140                                                          
         USING PISNMELD,R2                                                      
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ISSNM),     +        
               ('LD_CHARQ',PISNAME),(L'PISNAME,0)                               
*                                                                               
WIOD140  OC    PBDIDAT2,PBDIDAT2                                                
         BZ    WIOD144                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#INSDA2),    +        
               ('LD_BDATQ',PBDIDAT2),(L'PBDIDAT2,0)                             
         MVC   TMPHALF1,=AL2(D#INSDA2)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD144  OC    D_NCONLE,D_NCONLE                                                
         BZ    WIOD148                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CONLIE),    +        
               ('LD_CHARQ',D_NCONLE),(L'D_NCONLE,0)                             
*                                                                               
WIOD148  CLI   PBDSPACE,X'FF'      OUTDOOR?                                     
         BNE   WIOD152                                                          
         MVC   TMPWK1(5),SPACES                                                 
         CP    PBDSHOW,=P'0'                                                    
         BE    WIOD148K                                                         
         CP    PBDSHOW,=P'99999'   SPECIAL VALUE FOR SPC (SPECIALS)             
         BNE   *+14                                                             
         MVC   TMPWK1(3),=C'SPC'                                                
         B     WIOD148H                                                         
         EDITR PBDSHOW,(5,TMPWK1),ALIGN=LEFT                                    
*                                                                               
WIOD148H GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SHOWGS),    +        
               ('LD_CHARQ',TMPWK1),(5,0)                                        
WIOD148K CP    PBDREG,=P'0'                                                     
         BE    WIOD148M                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#REGDSP),    +        
               ('LD_SPAKQ',PBDREG),(L'PBDREG,0)                                 
WIOD148M CP    PBDILLUM,=P'0'                                                   
         BE    WIOD152                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ILLPAN),    +        
               ('LD_SPAKQ',PBDILLUM),(L'PBDILLUM,0)                             
*                                                                               
WIOD152  MVC   TMPWK1(L'LWCCODE),LWCCODE                                        
         MVC   TMPWK1+L'LWCCODE(L'QUCCODE),QUCCODE                              
         OC    TMPWK1(L'LWCCODE+L'QUCCODE),TMPWK1                               
         BZ    WIOD156                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#LEGALW),    +        
               ('LD_CHARQ',TMPWK1),(L'LWCCODE+L'QUCCODE,0)                      
         MVC   TMPHALF1,=AL2(D#LEGALW)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
WIOD156  OC    RPTPUB,RPTPUB       ANYTHING IN REPEAT PUB?                      
         BZ    WIOD160                                                          
         GOTOR APUBEDIT,DMCB,(X'08',RPTPUB),(C'S',TMPWK1)                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#REPEPB),    +        
               ('LD_CHARQ',TMPWK1),(15,0)                                       
*                                                                               
WIOD160  OC    PJOBSIG,PJOBSIG     ANYTHING IN AGENCY SIGNATURE?                
         BZ    WIOD164                                                          
         CLC   PJOBSIG,SPACES      SPACES?                                      
         BE    WIOD164                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#AGYSIG),    +        
               ('LD_CHARQ',PJOBSIG),(L'PJOBSIG,0)                               
*                                                                               
WIOD164  DS    0H                                                               
*                                                                               
         BRAS  RE,CKSER#TB         CK AND UPDATE SERIAL# TABLE                  
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R2,R3                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SETWIODT NTR1  BASE=*,LABEL=*      SET WEB IO DETAIL VALUES                     
*                                                                               
         NI    ADRPYREC,X'FF'-RPYDETLQ                                          
         MVI   ADRPYSW2,0          RESET DETAIL SUB REC REPLY CODES             
*                                                                               
         LH    RE,NUMPRCIN         # OF INSERTION PROCESSED                     
         AHI   RE,1                                                             
         STH   RE,NUMPRCIN                                                      
*                                                                               
         LA    R0,D_SVSTRT                                                      
         LHI   R1,D_SVDLNQ                                                      
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE               CLEAR REPLY INFORMATION BLOCK                
*                                                                               
         MVC   WKINSDT,PBUYKDAT                                                 
         MVC   WKFREQU,PBDFREQ                                                  
         MVC   WKBUYLN,PBUYKLIN                                                 
         GOTOR FMTBUYL#            GET INSERTION DATE WITH REF#                 
         MVC   D_INSDLN,TMPCL20                                                 
*                                                                               
         BRAS  RE,SETMODCD         DETERMINE MODIFICATION CODE                  
*                                                                               
         MVI   D_IORTYP,D_IORTIQ   DEFAULT TO INSERTION ORDER                   
*                                                                               
         CLI   PBUYKMED,C'N'       NEWSPAPER?                                   
         BNE   *+16                                                             
         BRAS  RE,FMTNRT           FORMAT RATE FOR NEWSPAPER                    
         BRAS  RE,FMTNCLE          FORMAT CLE FOR NEWSPAPER                     
         B     *+8                                                              
         BRAS  RE,FMTORF           FORMAT RATE FOR OTHER MEDIAS                 
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMT_COST NTR1  BASE=*,LABEL=*      FORMAT INSERTION COST                        
*                                                                               
         MVC   D_INSCOS,SPACES                                                  
         MVC   D_INSCO2,SPACES                                                  
         GOTOR APPBYOUT,DMCB,BUYOUTA                                            
         MVI   D_COSIND,C'G'                                                    
         L     R0,GROSS                                                         
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         CLC   LIOBPCV1,=AL1(03,03,00,02)                                       
         BL    F_COS16                                                          
         CLI   COSTOPT,C'B'        BOTH GROSS AND NET?                          
         BNE   F_COS16                                                          
         EDIT  (R0),D_INSCOS,2,ALIGN=LEFT,MINUS=YES,COMMAS=YES                  
         L     R0,GROSS                                                         
         S     R0,AGYCOM                                                        
         MVI   D_COSIN2,C'N'                                                    
         EDIT  (R0),D_INSCO2,2,ALIGN=LEFT,MINUS=YES,COMMAS=YES                  
         J     EXIT                                                             
*                                                                               
F_COS16  CLI   COSTOPT,C'G'        GROSS?                                       
         BE    F_COS30                                                          
         CLI   COSTOPT,C'T'        NET?                                         
         BE    F_COS20                                                          
         CLI   PBDCTYP,C'N'        BUY IS ENETERED IN NET?                      
         BE    F_COS20                                                          
         CLI   PBDCOSIN,C'S'       SHOW NET FOR "S" RATE BUYS?                  
         BNE   F_COS30                                                          
F_COS20  S     R0,AGYCOM                                                        
         MVI   D_COSIND,C'N'                                                    
*                                                                               
F_COS30  EDIT  (R0),D_INSCOS,2,ALIGN=LEFT,MINUS=YES,COMMAS=YES                  
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R3                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYPZNAM NTR1  BASE=*,LABEL=*      REPLY PUBLICATION ZONE NAME                  
*                                                                               
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         LA    R4,1(R9)                                                         
         LA    R4,4095(R4)         EXTEND POLFILED COVERAGE                     
         USING POLFILED,R9,R4                                                   
*                                                                               
         MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
*                                                                               
         CLC   PBUYKPUB(L'SVPUBZEC),PUBKPUB                                     
         BE    RPYZN30                                                          
         CLC   PBUYKPUB(L'SVPUBZEC),SVPUBZEC                                    
         BE    RPYZN40                                                          
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'PUBKMED),PBUYKMED                                          
         MVC   KEY+L'PUBKMED(L'SVPUBZEC),PBUYKPUB                               
         MVC   KEY+L'PUBKMED+L'SVPUBZEC(L'PBUYKAGY),PBUYKAGY                    
         MVI   KEY+L'PUBKMED+L'SVPUBZEC+L'PBUYKAGY,X'81'                        
         GOTOR HIGHPB                                                           
         LA    RE,TMPWKAIO                                                      
         ST    RE,AREC                                                          
         GOTOR GETPUB                                                           
         LA    RE,TMPWKAIO+(PUBNAMEL-PUBKEY)                                    
         CLI   0(RE),X'10'                                                      
         BE    *+6                                                              
         DC    H'0'                INVALID PUB RECORD                           
*                                                                               
         MVC   TMPWK2(L'PUBZNAME),(PUBZNAME-PUBNAMEL)(RE)                       
         MVC   SVPUBZEC,KEY+L'PUBKMED                                           
         MVC   SVPUBZNM,(PUBZNAME-PUBNAMEL)(RE)                                 
         B     RPYZN60                                                          
*                                                                               
RPYZN30  MVC   TMPWK2(L'PUBZNAME),PUBZNAME                                      
         B     RPYZN60                                                          
*                                                                               
RPYZN40  MVC   TMPWK2(L'PUBZNAME),SVPUBZNM                                      
         B     RPYZN60                                                          
*                                                                               
RPYZN60  OC    TMPWK2(L'PUBZNAME),SPACES                                        
         CLC   TMPWK2(L'PUBZNAME),SPACES                                        
         BE    RPYZN_X                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PZNAME),    +        
               ('LD_CHARQ',TMPWK2),(L'PUBZNAME,0)                               
*                                                                               
RPYZN_X  MVC   KEY,TMPSVKEY        RESTORE ORIGINAL SETTINGS                    
         MVC   AREC,TMPSVAIO                                                    
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R3,R4                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYCONTR NTR1  BASE=*,LABEL=*      REPLY CONTRACT INFORMATION                   
*                                                                               
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         MVC   TMPSVKEY,KEY                                                     
         MVC   TMPSVAIO,AREC                                                    
*                                                                               
         CLI   CONOPT,C'N'         SHOW CONTRACT INFO?                          
         BE    RPYCN_XX                                                         
*                                                                               
         OC    SVCONKEY,SVCONKEY   HAVE CONTRACT KEY?                           
         BZ    RPYCN20                                                          
         CLC   PBUYKDAT,D_CONSDT   LESS THAN CONTRACT START DATE?               
         BL    RPYCN20                                                          
         CLC   PBUYKDAT,D_CONEDT   GREATER THAN CONTRACT END DATE?              
         BH    RPYCN20                                                          
*                                                                               
         B     RPYCN60             USE CONTRACT INFO GOTTEN PREVIOUSLY          
*                                                                               
RPYCN20  XC    KEY,KEY                                                          
         LA    RF,KEY                                                           
         USING PCONKEY,RF                                                       
         MVC   PCONKAGY,QAGENCY                                                 
         MVC   PCONKMED,QMEDIA                                                  
         MVI   PCONKRCD,X'10'      CONTRACT RECORD CODE                         
         MVC   PCONKCLT,PBUYKCLT                                                
         MVC   PCONKPUB,PBUYKPUB                                                
         MVC   PCONKZON,PBUYKZON                                                
         MVC   PCONKEDT,PBUYKEDT                                                
         LA    RE,TMPWKAIO                                                      
         ST    RE,AREC                                                          
         GOTOR HIGH                                                             
         B     RPYCN26                                                          
RPYCN24  GOTOR SEQ                                                              
RPYCN26  CLC   KEY(PCONKEDT-PCONKEY),KEYSAVE                                    
         BNE   RPYCN_X                                                          
         GOTOR GETPRT                                                           
         LA    R2,TMPWKAIO+(PCONDESC-PCONKEY)                                   
         CLI   0(R2),X'10'                                                      
         BE    *+6                                                              
         DC    H'0'                INVALID CONTRACT RECORD                      
         USING PCONDESC,R2                                                      
*                                                                               
         CLC   PBUYKDAT,PCONSDT    LESS THAN CONTRACT START DATE?               
         BL    RPYCN24                                                          
         CLC   PBUYKDAT,PCONEDT    GREATER THAN CONTRACT END DATE?              
         BH    RPYCN24                                                          
*                                                                               
         MVC   D_CONSDT,PCONSDT    SAVE CONTRACT START DATE                     
         MVC   D_CONEDT,PCONEDT    SAVE CONTRACT END DATE                       
*                                                                               
         MVI   ELCODE,X'20'        CURRENT LEVEL ELEM CODE                      
         BRAS  RE,NXTEL                                                         
         BNE   *+10                                                             
         USING PRBELEM,R2                                                       
         ZAP   D_CONLVL,PRBLEVEL   SAVE CONTRACT LEVEL                          
*                                                                               
         LA    RF,KEY                                                           
         MVC   D_CONNUM,PCONNUM    SAVE CONTRACT NUMBER                         
         MVC   SVCONKEY,KEY        SAVE CONTRACT KEY                            
*                                                                               
RPYCN60  OC    D_CONNUM,D_CONNUM   CONTRACT NUMBER PRESENT?                     
         BZ    RPYCN64                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CONTR#),    +        
               ('LD_UBINQ',D_CONNUM),(L'D_CONNUM,0)                             
*                                                                               
RPYCN64  CLI   CONOPT,C'D'         SHOW CONTRACT DATE?                          
         BE    *+12                                                             
         CLI   CONOPT,C'B'         SHOW BOTH DATE AND LEVEL?                    
         BNE   RPYCN72                                                          
         OC    D_CONSDT,D_CONSDT   CONTRACT START DATE PRESENT?                 
         BZ    RPYCN68                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CONSDT),    +        
               ('LD_BDATQ',D_CONSDT),(L'D_CONSDT,0)                             
*                                                                               
RPYCN68  OC    D_CONEDT,D_CONEDT   CONTRACT END DATE PRESENT?                   
         BZ    RPYCN72                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CONEDT),    +        
               ('LD_BDATQ',D_CONEDT),(L'D_CONEDT,0)                             
*                                                                               
RPYCN72  CLI   CONOPT,C'L'         SHOW CONTRACT LEVEL?                         
         BE    *+12                                                             
         CLI   CONOPT,C'B'         SHOW BOTH DATE AND LEVEL?                    
         BNE   RPYCN76                                                          
         OC    D_CONLVL,D_CONLVL   CONTRACT LEVEL PRESENT?                      
         BZ    RPYCN76                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CONLVL),    +        
               ('LD_SPAKQ',D_CONLVL),(L'D_CONLVL,0)                             
*                                                                               
RPYCN76  DS    0H                                                               
*                                                                               
RPYCN_X  MVC   KEY,TMPSVKEY                                                     
         MVC   AREC,TMPSVAIO                                                    
RPYCN_XX J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R3,R2,RF                                                      
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYFLDID NTR1  BASE=*,LABEL=*      REPLY FIELD INDICATOR                        
*                                                                               
         OC    FIDCHGTB(2),FIDCHGTB                                             
         JZ    EXIT                                                             
*                                                                               
         LA    RE,FIDCHGTB                                                      
         SR    RF,RF                                                            
RPYFI20  CHI   RF,FIDCTMXQ         NOT IN TABLE?                                
         BH    RPYFI_X                                                          
         CLC   TMPHALF1,0(RE)      MAP CODE MATCHED ENTRY IN TABLE?             
         BE    RPYFI30                                                          
         LA    RE,2(RE)            POINT TO NEXT ENTRY                          
         AHI   RF,1                COUNTER INCREMENT                            
         B     RPYFI20                                                          
*                                                                               
RPYFI30  L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         MVI   TMPBYTE3,C'C'                                                    
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#FLDIND),    +        
               ('LD_CHARQ',TMPBYTE3),(L'TMPBYTE3,0)                             
*                                                                               
RPYFI_X  J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R3                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMTBUYL# NTR1  BASE=*,LABEL=*      FORMAT INSERTION DATE W/ LINE #              
*                                                                               
         MVC   TMPCL20,SPACES      CLR RETURN VALUE                             
         LA    R5,TMPCL20                                                       
*                                                                               
         GOTOR DATCON,DMCB,(3,WKINSDT),(7,0(R5))                                
         AHI   R5,5                SET NEXT OUTPUT ADDRESS                      
         CLI   WKFREQU,C'M'        MONTHLY?                                     
         BNE   *+14                                                             
         SHI   R5,2                                                             
         MVC   0(2,R5),SPACES                                                   
*                                                                               
         GOTOR DATCON,DMCB,(3,WKINSDT),(6,DUB)                                  
         MVI   0(R5),C'/'                                                       
         MVC   1(2,R5),DUB+4       SET YY                                       
         AHI   R5,1+2                                                           
*                                                                               
         CLI   WKBUYLN,1           TEST SUBLINE TO DISPLAY                      
         BE    FMTBL#X                                                          
         MVI   0(R5),C'-'                                                       
         SR    R0,R0                                                            
         IC    R0,WKBUYLN                                                       
         CVD   R0,DUB                                                           
         CHI   R0,100                                                           
         BL    FMTBL#04                                                         
*                                                                               
         DP    DUB,=P'10'          DISPLAY 100 - 239 AS A0 - N9                 
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  2(1,R5),DUB+7                                                    
         ZAP   DUB,DUB(6)                                                       
         CVB   RF,DUB                                                           
         SHI   RF,10                                                            
         LA    RF,LINETAB(RF)                                                   
         MVC   1(1,R5),0(RF)                                                    
         B     FMTBL#X                                                          
*                                                                               
FMTBL#04 OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  1(2,R5),DUB                                                      
         CLI   1(R5),C'0'                                                       
         BNE   FMTBL#X                                                          
         MVC   1(2,R5),2(R5)                                                    
*                                                                               
FMTBL#X  J     EXIT                                                             
*                                                                               
LINETAB  DC    C'ABCDEFGHIJKLMNOP'                                              
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SETMODCD NTR1  BASE=*,LABEL=*      DETERMINE MODIFICATION CODE                  
*                                                                               
         MVI   D_MODCOD,C'N'       NEW                                          
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,PWIOELCQ     EIO ELEM CODE                                
SETMD20  BRAS  RE,NXTEL                                                         
         BNE   SETMD30                                                          
         USING PWIOELEM,R2                                                      
         OC    PWIODATE,PWIODATE                                                
         BZ    SETMD20                                                          
         B     SETMD40                                                          
*                                                                               
SETMD30  LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'        IO ELEM CODE                                 
SETMD34  BRAS  RE,NXTEL                                                         
         BNE   SETMD60                                                          
         USING PIOELEM,R2                                                       
         OC    PIODATE,PIODATE                                                  
         BZ    SETMD34                                                          
*                                                                               
SETMD40  MVI   D_MODCOD,C'C'       CHANGED                                      
         TM    PBUYCNTL,X'80'      DELETED?                                     
         BZ    SETMD46                                                          
         TM    WKEIOFLG,E_IOBMTQ   BUY MOVE "TO"?                               
         BNZ   *+8                 CHANGE ORDER FOR BUY MOVE "TO"               
         MVI   D_MODCOD,C'D'       DELETED                                      
         B     SETMD_X                                                          
*                                                                               
SETMD46  OC    FIDCHGTB(2),FIDCHGTB                                             
         BNZ   SETMD_X                                                          
         MVI   D_MODCOD,C'U'       UNCHANGED                                    
         B     SETMD_X                                                          
*                                                                               
SETMD60  TM    WKEIOFLG,E_IOBM_Q   BUY MOVE ELEM PRESENT?                       
         BZ    SETMD_X                                                          
         LA    R2,PBUYREC+33                                                    
         USING PBYMELEM,R2                                                      
         MVI   ELCODE,PBYMELCQ     BUY MOVE ELEM CODE                           
         XC    TMPWK1,TMPWK1                                                    
         LA    R4,TMPWK1                                                        
         SR    R5,R5                                                            
SETMD62  BRAS  RE,NXTEL                                                         
         BNE   SETMD62H                                                         
         ZAP   0(L'PBYMSER#,R4),PBYMSER#                                        
         LA    R4,L'PBYMSER#(R4)                                                
         AHI   R5,1                                                             
         B     SETMD62                                                          
SETMD62H LA    R4,TMPWK1                                                        
SETMD62M OC    0(L'PBYMSER#,R4),0(R4)                                           
         BZ    SETMD_X                                                          
         ZAP   WKBYSER#,0(L'PBYMSER#,R4)                                        
         BRAS  RE,FND_B_IO         SEARCH FOR BUY IO ELEMS                      
         BE    SETMD68                                                          
         LA    R2,TMPWKAIO+33                                                   
         MVI   ELCODE,PBYMELCQ     BUY MOVE ELEM CODE                           
SETMD62P BRAS  RE,NXTEL                                                         
         BNE   SETMD62U                                                         
         LA    RE,TMPWK1                                                        
SETMD62S CHI   R5,20               10 LEVELS OF BUY MOVE ENCOUNTERED?           
         BNH   *+6                                                              
         DC    H'0'                                                             
         OC    0(L'PBYMSER#,RE),0(RE)                                           
         BNZ   *+18                                                             
         AHI   R5,1                                                             
         ZAP   0(L'PBYMSER#,RE),PBYMSER#                                        
         B     SETMD62U                                                         
         CP    PBYMSER#,0(L'PBYMSER#,RE)                                        
         BE    SETMD62P                                                         
         LA    RE,L'PBYMSER#(RE)                                                
         B     SETMD62S                                                         
SETMD62U LA    R4,L'PBYMSER#(R4)   PROCESS NEXT BUY MOVE SERIAL#                
         B     SETMD62M                                                         
*                                                                               
SETMD68  MVI   D_MODCOD,C'C'       CHANGED                                      
*                                                                               
SETMD_X  J     EXIT                                                             
*                                                                               
FND_B_IO LR    R3,RE               FIND BUY INSERTION ORDER ELEMS               
         BRAS  RE,GBUYR_S#         GET BUY RECORD FROM SERIAL#                  
         JNE   F_B_IO55                                                         
         LA    R2,TMPWKAIO+33                                                   
         BRAS  RE,FND_BEIO         LASTEST EIO ELEM FOUND?                      
         JE    F_B_IO_X                                                         
         LA    R2,TMPWKAIO+33                                                   
         BRAS  RE,FND_BSIO         LASTEST STANDARD IO ELEM FOUND?              
         JE    F_B_IO_X                                                         
F_B_IO55 LR    RE,R3                                                            
         J     RE_CCNEQ                                                         
F_B_IO_X LR    RE,R3                                                            
         J     RE_CCEQ                                                          
                                                                                
         LTORG                                                                  
         DROP  RB,R2                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
CKSER#TB NTR1  BASE=*,LABEL=*      CK AND UPDATE SERIAL# TABLE                  
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'99'                                                     
         BRAS  RE,NXTEL                                                         
         BE    *+6                                                              
         DC    H'0'                INSERTION SHOULD HAVE SERIAL#                
         USING PSERELEM,R2                                                      
         L     R4,ASER#TAB         POINT TO TABLE OF SERIAL#S                   
         USING SER#TABD,R4                                                      
         SR    RE,RE                                                            
         ICM   RE,3,NUMSER#S                                                    
CKS#20   CP    PSERNUM,S#SERIAL    FOUND IN TABLE?                              
         BE    CKS#30                                                           
         LA    R4,SER#TBLQ(R4)                                                  
         BCT   RE,CKS#20                                                        
*                                                                               
         MVI   S#STATUS,S#ADDEDQ   SERIAL# IS ADDED IN PROCESS                  
         ZAP   S#SERIAL,PSERNUM                                                 
         ICM   RE,3,NUMSER#S                                                    
         AHI   RE,1                NEW ENTRY IS ADDED                           
         CHI   RE,MAXSER#Q                                                      
         BNH   *+6                                                              
         DC    H'0'                TABLE MAX REACHED                            
         STCM  RE,3,NUMSER#S                                                    
*                                                                               
CKS#30   CLI   S#STATUS,S#NOTU_Q   NOT USED?                                    
         BNE   *+6                                                              
         DC    H'0'                NOT USED INSERTION CANNOT GET HERE!          
         MVC   S#MODCOD,D_MODCOD   SAVE MODIFICATION CODE                       
         MVC   S#PRCCNT,NUMPRCIN   SAVE ORDER OF PROCESSING COUNTER             
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,R2,R4                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMTNRT   NTR1  BASE=*,LABEL=*      FORMAT NEWSPAPER RATES                       
*                                                                               
         MVI   TMPBYTE1,0          COUNTER FOR # OF CHARS IN COST IND           
*                                                                               
         MVC   D_RATIND,SPACES                                                  
         MVC   D_INSRAT,SPACES                                                  
         MVC   W,SPACES                                                         
         ZAP   DUB,PBDCOS                                                       
         CVB   R1,DUB                                                           
         CLI   PBDCTYP,C'N'        NET INPUT SO DISPLAY AS NET                  
         BNE   FMTNRT02                                                         
*                                                                               
         ZAP   DUB,PBDACP                                                       
         CVB   RF,DUB                                                           
         S     RF,=F'100000'                                                    
         LCR   RF,RF               = NET PCT                                    
         MR    R0,RF                                                            
         L     RF,=F'100000'                                                    
         SLDA  R0,1                                                             
         DR    R0,RF                                                            
         LTR   R1,R1                                                            
         BNP   *+8                                                              
         AHI   R1,1                                                             
         SRA   R1,1                                                             
*                                                                               
FMTNRT02 CLI   PBDCOSTY,C'U'       TEST UNIT RATE                               
         BE    FMTNRT06                                                         
         C     R1,=F'99999999'     SEE IF TOTAL RATE OVER 999,999.99            
         BNH   FMTNRT04                                                         
         LR    R0,R1                                                            
         SR    R1,R1                                                            
         SRDA  R0,31                                                            
         D     R0,=F'100'          HAVE ENTERED PENNIES WHEN BUYING             
         LTR   R1,R1               (NO ROOM)                                    
         BNP   *+8                                                              
         AHI   R1,1                                                             
         SRA   R1,1                                                             
         EDITR (R1),(9,W+5),0,FLOAT=-,ALIGN=LEFT                                
         B     FMTNRT08                                                         
*                                                                               
FMTNRT04 EDITR (R1),(9,W+5),2,FLOAT=-,ALIGN=LEFT                                
         B     FMTNRT08                                                         
*                                                                               
FMTNRT06 EDITR (R1),(11,W+5),5,FLOAT=-,ALIGN=LEFT                               
*                                                                               
         LA    R1,W+5-3            START OF OUTPUT                              
         AR    R1,R0               + LENGTH                                     
         CLC   =C'000',0(R1)                                                    
         BNE   FMTNRT08                                                         
         MVC   0(3,R1),SPACES      MOVE SOME BLANKS                             
*                                                                               
FMTNRT08 LA    R1,W+5                                                           
*                                                                               
* IF COST TYPE NOT 'U' DISPLAY IT, ELSE DISPLAY COST IND IF NOT C' '            
*                                                                               
         CLI   PBDCOSTY,C'U'       TEST UNIT RATE                               
         BE    FMTNRT10            YES - CHECK PBDCOSIN                         
         BCTR  R1,0                                                             
         MVC   0(1,R1),PBDCOSTY                                                 
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTNRT10 CLI   PBDCOSIN,C' '       TEST DEFAULT COST TYPE                       
         BE    FMTNRT12                                                         
         BCTR  R1,0                                                             
         MVC   0(1,R1),PBDCOSIN                                                 
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTNRT12 CLI   PBDCTYP,C'N'        NET INPUT                                    
         BNE   FMTNRT16                                                         
         BCTR  R1,0                                                             
         MVC   0(1,R1),PBDCTYP                                                  
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTNRT16 TM    PBDRLIND,X'08'      TEST FROZEN RATE                             
         BZ    FMTNRT20                                                         
         BCTR  R1,0                                                             
         MVI   0(R1),C'*'                                                       
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTNRT20 SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         LR    RE,R1               R1 POINTING TO FORMATTED RATE                
         AR    RE,RF                                                            
         MVC   D_INSRAT,0(RE)      FORMATTED RATE                               
         MVI   D_RATIND,C'G'       DEFAULT TO GROSS                             
         BCTR  RF,0                FOR EX                                       
         CHI   RF,0                                                             
         BL    FMTNRT28                                                         
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   D_RATIND(0),0(R1)   GET COST INDS                                
FMTNRT28 CP    PBDCOS,=P'0'                                                     
         BNE   FMTNRT30                                                         
         MVC   D_INSRAT,SPACES                                                  
         MVC   D_INSRAT(04),=C'FREE'                                            
         MVC   D_RATIND,SPACES                                                  
         MVI   D_RATIND,C'F'                                                    
         B     FMTNRTX                                                          
*                                                                               
FMTNRT30 CLI   PBDCOSTY,C'U'       UNIT RATE?                                   
         BNE   FMTNRTX                                                          
         LA    RF,D_INSRAT                                                      
         CLI   0(RF),C' '                                                       
         BNH   *+12                                                             
         LA    RF,1(RF)                                                         
         B     *-12                                                             
         MVI   0(RF),C'/'                                                       
         MVC   1(2,RF),=C'LI'      TO INDICATE LINES                            
         CLI   PBDUIND,C'L'                                                     
         BE    *+10                                                             
         MVC   1(2,RF),=C'IN'      TO INDICATE INCHES                           
*                                                                               
FMTNRTX  J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMTORF   NTR1  BASE=*,LABEL=*      FORMAT NON-NEWSPAPER RATE FORMAT             
*                                                                               
         MVI   TMPBYTE1,0          COUNTER FOR # OF CHARS IN COST IND           
*                                                                               
         MVC   D_RATIND,SPACES                                                  
         MVC   D_INSRAT,SPACES                                                  
         MVC   W,SPACES                                                         
         ZAP   DUB,PBDCOS                                                       
         CVB   R1,DUB                                                           
         CLI   PBDCTYP,C'N'        NET INPUT SO DISPLAY AS NET                  
         BNE   FMTORF02                                                         
*                                                                               
         ZAP   DUB,PBDACP                                                       
         CVB   RF,DUB                                                           
         S     RF,=F'100000'                                                    
         LCR   RF,RF               =NET PCT                                     
         MR    R0,RF                                                            
         L     RF,=F'100000'                                                    
         SLDA  R0,1                                                             
         DR    R0,RF                                                            
         LTR   R1,R1                                                            
         BNP   *+8                                                              
         AHI   R1,1                                                             
         SRA   R1,1                                                             
*                                                                               
FMTORF02 EDITR (R1),(10,W+2),2,ALIGN=LEFT,FLOAT=-                               
         LA    R1,W+2                                                           
         CLI   PBDCOSIN,C' '       TEST DEFAULT COST TYPE                       
         BE    FMTORF04                                                         
         BCTR  R1,0                                                             
         MVC   0(1,R1),PBDCOSIN                                                 
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTORF04 CLI   PBDCTYP,C'N'        DISPLAY AS NET                               
         BNE   FMTORF18                                                         
         BCTR  R1,0                                                             
         MVC   0(1,R1),PBDCTYP                                                  
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTORF18 TM    PBDRLIND,X'08'      TEST FROZEN                                  
         BZ    FMTORF20                                                         
         BCTR  R1,0                                                             
         MVI   0(R1),C'*'                                                       
         SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         AHI   RF,1                                                             
         STC   RF,TMPBYTE1                                                      
*                                                                               
FMTORF20 SR    RF,RF                                                            
         IC    RF,TMPBYTE1                                                      
         LR    RE,R1               R1 POINTING TO FORMATTED RATE                
         AR    RE,RF                                                            
         MVC   D_INSRAT,0(RE)      FORMATTED RATE                               
         MVI   D_RATIND,C'G'       DEFAULT TO GROSS                             
         BCTR  RF,0                FOR EX                                       
         CHI   RF,0                                                             
         BL    FMTORF28                                                         
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   D_RATIND(0),0(R1)   GET COST INDS                                
FMTORF28 CP    PBDCOS,=P'0'                                                     
         JNE   FMTORFX                                                          
         MVC   D_INSRAT,SPACES                                                  
         MVC   D_INSRAT(04),=C'FREE'                                            
         MVC   D_RATIND,SPACES                                                  
         MVI   D_RATIND,C'F'                                                    
*                                                                               
FMTORFX  J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* FORMAT NEWSPAPER CONTRACT LINEAGE EQUIVALENCY                                 
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
FMTNCLE  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLC   =X'7B00',PBDSPACE                                                
         BE    FMTNCLX                                                          
         CLC   =C'# ',PBDSPACE                                                  
         BE    FMTNCLX                                                          
         CLC   =C'* ',PBDSPACE     SEE IF SPACE BUY                             
         BNL   FMTNCLX             IF NOT - NO CLE                              
                                                                                
         MVC   D_NCONLE,SPACES                                                  
         LA    R5,D_NCONLE         SET CONTRACT LINEAGE EQUIVALENCY             
         CLI   PBDUIND,C'I'-X'40'  SEE IF LOWER CASE I                          
         BNE   FMTNCL02                                                         
         EDITR PBDUNITS,(6,0(R5)),2,ALIGN=LEFT                                  
         AR    R5,R0                                                            
         MVI   0(R5),C'I'                                                       
         B     FMTNCLX                                                          
                                                                                
FMTNCL02 EDITR PBDUNITS,(5,0(R5)),ALIGN=LEFT                                    
         AR    R5,R0                                                            
         CLI   PBDUIND,C'I'                                                     
         BNE   *+12                                                             
         MVI   0(R5),C'I'                                                       
         AHI   R5,1                                                             
         CP    PBDCLMS,=P'0'                                                    
         BE    FMTNCLX                                                          
         MVI   0(R5),C'/'                                                       
         AHI   R5,1                                                             
         EDITR PBDCLMS,(5,0(R5)),ALIGN=LEFT                                     
                                                                                
FMTNCLX  J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYIOPIC NTR1  BASE=*,LABEL=*      REPLY IO AND PI COMMENTS                     
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         CLI   ELCODE,X'67'        INSERTION ORDER COMMENT?                     
         BNE   RPYIPC22                                                         
RPYIPC20 LHI   RF,D#IORCOM                                                      
         STH   RF,TMPHALF1         MAP CODE FOR IO COMMENT                      
         LHI   RF,E#ICCOMN                                                      
         B     RPYIPC30                                                         
RPYIPC22 CLI   ELCODE,X'68'        POSITIONAL INSTRUCTION COMMENT?              
         BNE   RPYIPC20            DEFAULT TO INSERTION ORDER COMMENTS          
         LHI   RF,D#POSCOM                                                      
         STH   RF,TMPHALF1         MAP CODE FOR PI COMMENT                      
         LHI   RF,E#PICOMN                                                      
*                                                                               
RPYIPC30 CHI   RF,E#ICCOMN         IO COMMENT?                                  
         BNE   *+16                                                             
         TM    ADRPYSW2,RPYICCMQ   IO COMMENT SUB REC MAP CODE REPLIED?         
         BZ    RPYIPC31                                                         
         B     RPYIPC32                                                         
*                                                                               
         CHI   RF,E#PICOMN         PI COMMENT?                                  
         BNE   *+16                                                             
         TM    ADRPYSW2,RPYPICMQ   IO COMMENT SUB REC MAP CODE REPLIED?         
         BZ    RPYIPC31                                                         
         B     RPYIPC32                                                         
*                                                                               
         DC    H'0'                INVALID SUB REC REPLY MAP CODE               
*                                                                               
RPYIPC31 GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',(RF))                  
         LH    RF,TMPHALF1                                                      
         CHI   RF,D#IORCOM         IO COMMENT?                                  
         BNE   *+8                                                              
         OI    ADRPYSW2,RPYICCMQ   IO COMMENT SUB REC MAP CODE REPLIED          
         CHI   RF,D#POSCOM         PI COMMENT?                                  
         BNE   *+8                                                              
         OI    ADRPYSW2,RPYPICMQ   PI COMMENT SUB REC MAP CODE REPLIED          
*                                                                               
         BRAS  RE,RPYFLDID         TMPHALF1 IS SET                              
*                                                                               
RPYIPC32 CLI   TMPFULL1,C'+'       SKIPPING LINES?                              
         BNE   RPYIPC36                                                         
         SR    R4,R4                                                            
         PACK  DUB,TMPFULL1+1(1)                                                
         TP    DUB                                                              
         BNZ   *+8                                                              
         CVB   R4,DUB              +0 OR INVALID, PUT ONE LINE ANYWAY           
         MVI   TMPFULL1,C' '                                                    
RPYIPC34 LH    RF,TMPHALF1         SAVED COMMENT MAP CODE                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',(RF)),        +        
               ('LD_CHARQ',TMPFULL1),(1,0)                                      
         CHI   R4,0                                                             
         BE    RPYIPC_X                                                         
         BCT   R4,RPYIPC34                                                      
         B     RPYIPC_X                                                         
*                                                                               
RPYIPC36 LH    RF,TMPHALF1         SAVED COMMENT MAP CODE                       
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',(RF)),        +        
               ('LD_CHARQ',SAVEP),(L'EIOCOMLN,0)                                
*                                                                               
RPYIPC_X J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R3                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYACHRG NTR1  BASE=*,LABEL=*      REPLY ADDITIONAL CHARGES                     
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'44'        ADDITIONAL CHARGE                            
RPYAC20  BRAS  RE,NXTEL                                                         
         BNE   RPYAC60                                                          
         USING PACELEM,R2                                                       
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#ACR)                 
         MVC   TMPHALF1,=AL2(D#ACHCOD)                                          
         BRAS  RE,RPYFLDID                                                      
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ACHCOD),    +        
               ('LD_CHARQ',PACCODE),(L'PACCODE,0)                               
*                                                                               
         OC    PACAMT,PACAMT                                                    
         BNZ   *+10                                                             
         ZAP   PACAMT,=P'0'                                                     
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ACHGRS),    +        
               ('LD_SPAKQ',PACAMT),(L'PACAMT,0)                                 
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ACHSAC),    +        
               ('LD_CHARQ',PACAC),(L'PACAC,0)                                   
*                                                                               
         MVC   TMPWK1(L'SPACES),SPACES                                          
         OC    PACACOM,PACACOM                                                  
         BNZ   RPYAC52                                                          
         MVC   TMPWK1(2),=C'-1'    INDICATING N/A                               
         LHI   RF,2                                                             
         B     RPYAC54                                                          
RPYAC52  EDIT  PACACOM,(8,TMPWK1),3,COMMAS=NO,ALIGN=LEFT                        
         LR    RF,R0                                                            
RPYAC54  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ACHCPT),    +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ACHCDA),    +        
               ('LD_CHARQ',PACCD),(L'PACCD,0)                                   
*                                                                               
         B     RPYAC20             CK FOR MORE                                  
*                                                                               
RPYAC60  DS    0H                                                               
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R3                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYCUCOL NTR1  BASE=*,LABEL=*      REPLY CUSTOM COLUMNS                         
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         USING BYCCELD,R2                                                       
         CLI   BYCCELM,BYCCIDQ                                                  
         BE    *+6                                                              
         DC    H'0'                NO LONGER POINTING TO CC ELEM                
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#BCC)                 
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CCSEQN),    +        
               ('LD_UBINQ',BYCCSQN),(L'BYCCSQN,0)                               
*                                                                               
         LA    RE,TMPWKAIO                                                      
         USING PCOLRECD,RE                                                      
         CLI   PCOLKRCD,X'61'                                                   
         BE    *+6                                                              
         DC    H'0'                NO LONGER POINTING TO CUSTOM COL REC         
*                                                                               
         XC    TMPWK1,TMPWK1       PREPARE TO REPLY CUSTOM COL DATA FLD         
*                                                                               
         CLI   PCOLTYP,C'D'        DATE?                                        
         BE    RPYCC40                                                          
         CLI   PCOLTYP,C'P'        PERIOD?                                      
         BE    RPYCC44                                                          
         CLI   PCOLTYP,C'T'        TEXT?                                        
         BE    RPYCC48                                                          
         CLI   PCOLTYP,C'N'        NUMERIC?                                     
         BE    RPYCC52                                                          
         CLI   PCOLTYP,C'$'        DOLLAR?                                      
         BE    RPYCC52                                                          
         CLI   PCOLTYP,C'%'        PERCENT?                                     
         BE    RPYCC52                                                          
         DC    H'0'                UNKNOWN TYPE                                 
*                                                                               
RPYCC40  MVC   DUB(3),BYCCDATA                                                  
         BRAS  RE,GETBCCDT                                                      
         MVC   TMPWK1(10),WORK                                                  
         LA    RF,10               LENGTH OF DATE FORMAT MM/DD/YYYY             
         B     RPYCC70                                                          
*                                                                               
RPYCC44  MVC   DUB(3),BYCCDATA                                                  
         BRAS  RE,GETBCCDT                                                      
         MVC   TMPWK1(10),WORK                                                  
         MVI   TMPWK1+10,C'-'                                                   
         MVC   DUB(3),BYCCDATA+3                                                
         BRAS  RE,GETBCCDT                                                      
         MVC   TMPWK1+11(10),WORK                                               
         LA    RF,10+1+10          DATE RANGE (MM/DD/YYYY-MM/DD/YYYY)           
         B     RPYCC70                                                          
*                                                                               
RPYCC48  SR    RE,RE                                                            
         IC    RE,BYCCLEN                                                       
         SHI   RE,BYCCHDRL         MINUS OVERHEAD                               
         LR    RF,RE                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),BYCCDATA                                               
         B     RPYCC70                                                          
*                                                                               
RPYCC52  XC    DUB,DUB             DUMMY CURRENCY DEFINITION FLD                
         MVC   DUB+3(1),PCOLDECS                                                
         LA    RF,DUB                                                           
         CURED (P8,BYCCDATA),(20,TMPWK1),(RF),ALIGN=LEFT,FLOAT=-,      +        
               COMMAS=YES                                                       
         LR    RF,R0               # OF SIGNIFICANT CHARS                       
*                                                                               
RPYCC70  GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CCFDAT),    +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
*                                                                               
         J     EXIT                                                             
*                                                                               
GETBCCDT LR    R0,RE                                                            
         GOTOR DATCON,DMCB,(3,DUB),(23,TMPWK2)                                  
         MVC   WORK+0(2),TMPWK2+5                                               
         MVI   WORK+2,C'/'                                                      
         MVC   WORK+3(2),TMPWK2+8                                               
         MVI   WORK+5,C'/'                                                      
         MVC   WORK+6(4),TMPWK2+0                                               
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB,RE,R2,R3                                                      
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYPHOUS NTR1  BASE=*,LABEL=*      REPLY PRODUCTION HOUSE INFO                  
*                                                                               
         TM    ADBSW,AS_WEBIO      WEB IO?                                      
         JZ    EXIT                NO                                           
*                                                                               
         L     R4,AWIODSST         POINT TO WIO STORAGE BLOCK                   
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
*                                                                               
         CLC   SVPHCODE,SPACES     PRODUCTION HOUSE CODE PRESENT?               
         BE    RPYPH_X                                                          
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         NI    ADRPYSW2,X'FF'-(RPYMATCQ+RPYVARCQ)                               
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#PRDHOU)              
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#PRDUCD),    +        
               ('LD_CHARQ',SVPHCODE),(L'SVPHCODE,0)                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#REPNAM),    +        
               ('LD_CHARQ',SVRPNAME),(L'SVRPNAME,0)                             
*                                                                               
         CLI   PHOUSOPT,C'T'       PROFILE SAYS TO PRINT TEL?                   
         BE    *+12                                                             
         CLI   PHOUSOPT,C'B'       BOTH TEL AND FAX?                            
         BNE   RPYPH46                                                          
         CLC   SVRPTELN,SPACES     TEL PRESENT?                                 
         BE    RPYPH46                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#TELNUM),    +        
               ('LD_CHARQ',SVRPTELN),(L'SVRPTELN,0)                             
*                                                                               
RPYPH46  CLI   PHOUSOPT,C'F'       PROFILE SAYS TO PRINT FAX?                   
         BE    *+12                                                             
         CLI   PHOUSOPT,C'B'       BOTH TEL AND FAX?                            
         BNE   RPYPH50                                                          
         CLC   SVRPFAXN,SPACES     FAX PRESENT?                                 
         BE    RPYPH50                                                          
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#FAXNUM),    +        
               ('LD_CHARQ',SVRPFAXN),(L'SVRPFAXN,0)                             
*                                                                               
RPYPH50  DS    0H                                                               
*                                                                               
RPYPH_X  J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R3,R4                                                         
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYMATCM NTR1  BASE=*,LABEL=*      REPLY MATERIAL COMMENT                       
*                                                                               
         TM    ADBSW,AS_WEBIO      EIO?                                         
         JZ    EXIT                NO                                           
         TM    PBUYCNTL,X'80'      DELETED?                                     
         JNZ   EXIT                                                             
         CLI   PBDJOB,C'!'         MASTER AD CODE?                              
         JE    EXIT                                                             
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
         L     R4,AWIODSST                                                      
         USING WIODSD,R4           WEB IO STORAGE BLOCK                         
*                                                                               
         MVC   WKSVADCD,PBDJOB                                                  
         BRAS  RE,GETINSRC         GET INSTRUCTION RECORD                       
         BNE   RPYMAC_X                                                         
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
RPYMAC08 BRAS  RE,NXTEL                                                         
         BNE   RPYMAC_X                                                         
         CLI   1(R2),2+1           ELEM HAS NOTHING IN IT?                      
         BNH   RPYMAC08                                                         
         CLC   2(4,R2),=C'MAT='    MATERIAL COMMENT?                            
         BNE   RPYMAC08                                                         
*                                                                               
         MVC   WKDMINBT,DMINBTS    SAVE DATA MANAGER BITS                       
         NI    DMINBTS,X'FF'-X'08' NO DELETES                                   
         MVI   TMPBYTE1,0          INDICATING LOOPING OR NOT                    
         MVC   TMPSVKEY,KEY                                                     
         XC    KEY,KEY                                                          
         LA    R2,KEY                                                           
         USING PMTPKEY,R2                                                       
         MVC   PMTPKAGY,QAGENCY    AGENCY                                       
         MVC   PMTPKMED,QMEDIA     MEDIA                                        
         MVI   PMTPKRCD,PMTPKRCQ   MATERIAL COMMENT PASSIVE KEY                 
         MVC   PMTPKCLT,PBUYKCLT   CLIENT                                       
         MVC   PMTPKPRD,PBUYKPRD   PRODUCT                                      
         MVC   PMTPKADC,PBDJOB     AD CODE                                      
         MVC   PMTPKPUB,PBUYKPUB   PUB CODE                                     
         CLI   MATOPT,C'Y'         MATERIALS ACROSS Z/E?                        
         BE    *+16                                                             
         MVC   PMTPKZON,PBUYKZON   PUB ZONE                                     
         MVC   PMTPKEDT,PBUYKEDT   PUB EDITION                                  
         MVC   SVMPPKEY,KEY                                                     
*                                                                               
         GOTOR HIGH                                                             
         CLC   KEY(PMTPKDAT-PMTPKEY),KEYSAVE                                    
         BNE   RPYMAC20                                                         
*                                                                               
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,WORK)                                
         CLC   PBUYKDAT,WORK                                                    
         BL    RPYMAC20                                                         
         MVC   WKINSDL1(L'PBUYKDAT),WORK                                        
         MVC   WKINSDL1+L'PBUYKDAT(L'PMTPKLIN),PMTPKLIN                         
         MVC   WKINSDL2(L'PBUYKDAT),PBUYKDAT                                    
         MVC   WKINSDL2+L'PBUYKDAT(L'PBUYKLIN),PBUYKLIN                         
*                                                                               
         CLC   WKINSDL1,WKINSDL2   SAME AS REFERENCE INSERTION?                 
         BNE   *+14                                                             
         MVC   KEY,TMPSVKEY        RESTORE KEY                                  
         B     RPYMAC30                                                         
*                                                                               
RPYMAC14 MVC   SVPPMPUB,PMTPKPUB                                                
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,SVPPMIDT)                            
         MVC   SVPPMLIN,PMTPKLIN                                                
         MVC   SVPPMCN2,PMTPCNT2                                                
         GOTOR SEQ                                                              
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,WORK)                                
         CLC   KEY(PMTPKDAT-PMTPKEY),KEYSAVE                                    
         BNE   RPYMAC16                                                         
         CLC   PBUYKDAT,WORK                                                    
         BH    RPYMAC14                                                         
         CLC   PBUYKDAT,WORK                                                    
         BNE   RPYMAC16                                                         
         CLC   PBUYKLIN,PMTPKLIN                                                
         BH    RPYMAC14                                                         
*                                                                               
RPYMAC16 MVC   WKINSDT,SVPPMIDT                                                 
         MVI   WKFREQU,0                                                        
         TM    SVPPMCN2,PMTPC2MQ   INSERTION IS MONTHLY?                        
         BZ    *+8                                                              
         MVI   WKFREQU,C'M'                                                     
         MVC   WKBUYLN,SVPPMLIN                                                 
         GOTOR FMTBUYL#            GET INSERTION DATE WITH REF#                 
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'R_MCTXT1),R_MCTXT1                                      
         MVC   TMPWK1+L'R_MCTXT1(L'D_INSDLN),TMPCL20                            
         LA    RF,TMPWK1+L'R_MCTXT1+L'D_INSDLN-1                                
         BRAS  RE,LAST_CHR                                                      
         MVC   2(09,RF),=C'INSERTION'                                           
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   2(09,RF),=C'POSTING  '                                           
*                                                                               
         XC    TMPWK2,TMPWK2                                                    
         MVC   TMPWK2(03),=C'FOR'                                               
         LA    RF,TMPWK2+L'TMPWK2-1                                             
         BRAS  RE,LAST_CHR                                                      
         LA    RF,2(RF)                                                         
         LR    RE,RF                                                            
         B     RPYMAC17                                                         
*                                                                               
* DISPLAY PUB CODE AND NAME IS INCOMPLETE                                       
*                                                                               
         LA    R5,TMPWK2+4                                                      
         GOTOR APUBEDIT,DMCB,SVPPMPUB,0(R5)                                     
         XC    KEY,KEY                                                          
         MVC   KEY(L'QMEDIA),QMEDIA                                             
         MVC   KEY+L'QMEDIA(L'SVPPMPUB),SVPPMPUB                                
         MVC   KEY+L'QMEDIA+L'SVPPMPUB(L'QAGENCY),QAGENCY                       
         MVI   KEY+L'QMEDIA+L'SVPPMPUB+L'QAGENCY,X'81'                          
         GOTOR HIGHPB                                                           
         MVC   TMPSVAIO,AREC                                                    
         LA    RE,TMPWKAIO                                                      
         ST    RE,AREC                                                          
         GOTOR GETPUB                                                           
         MVC   AREC,TMPSVAIO                                                    
         LA    RF,TMPWK2+L'TMPWK2-1                                             
         BRAS  RE,LAST_CHR                                                      
         MVI   2(RF),C'('                                                       
         LA    RE,TMPWKAIO+(PUBNAMEL-PUBKEY)                                    
         CLI   0(RE),X'10'                                                      
         BE    *+6                                                              
         DC    H'0'                INVALID PUB RECORD                           
         MVC   3(L'PUBNAME,RF),2(RE)                                            
         LA    RF,TMPWK2+L'TMPWK2-1                                             
         BRAS  RE,LAST_CHR                                                      
         MVC   1(2,RF),=C'),'                                                   
         LA    RF,4(RF)                                                         
         LR    RE,RF                                                            
*                                                                               
RPYMAC17 MVC   0(L'R_MCTXT2,RF),R_MCTXT2                                        
         MVC   (0+L'R_MCTXT2)(L'PBDJOB,RF),PBDJOB                               
         CLC   LIOBPCV1,=AL1(03,03,00,02)                                       
         BL    RPYMAC18                                                         
         CLC   PJOBADID,SPACES                                                  
         BE    RPYMAC18                                                         
         OC    PJOBADID,PJOBADID                                                
         BZ    RPYMAC18                                                         
         LR    RF,RE                                                            
         MVC   0(L'R_MCTXT2,RF),SPACES                                          
         MVC   0(L'R_MCTXT3,RF),R_MCTXT3                                        
         MVC   (0+L'R_MCTXT3)(L'PJOBADID,RF),PJOBADID                           
*                                                                               
RPYMAC18 BRAS  RE,MATPPKEY         ADD MAT= REPEAT PASSIVE KEY                  
         MVC   KEY,TMPSVKEY        RESTORE KEY                                  
         B     RPYMAC60                                                         
*                                                                               
RPYMAC20 CLI   RCWRITE,C'Y'        WRITING MODE?                                
         BNE   *+8                                                              
         BRAS  RE,MATPPKEY         ADD MAT= REPEAT PASSIVE KEY                  
         MVC   KEY,TMPSVKEY        RESTORE KEY                                  
*                                                                               
RPYMAC30 MVC   WKSVADCD,PBDJOB                                                  
         BRAS  RE,GETINSRC         GET INSTRUCTION RECORD                       
         BNE   RPYMAC_X                                                         
         MVI   TMPBYTE1,C'Y'       INDICATOR FOR LOOP                           
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
RPYMAC40 BRAS  RE,NXTEL                                                         
         BNE   RPYMAC_X                                                         
         CLI   1(R2),2+4           ELEM HAS NOTHING IN IT?                      
         BNH   RPYMAC40                                                         
         CLC   2(4,R2),=C'MAT='    MATERIAL COMMENT?                            
         BNE   RPYMAC40                                                         
         SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2+4+1            ADJUST OVERHEADS AND ONE FOR EX              
         CHI   RF,0                                                             
         BL    RPYMAC40                                                         
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),2+4(R2)                                                
         AHI   RF,1                                                             
         STH   RF,TMPHALF1                                                      
*                                                                               
RPYMAC60 BRAS  RE,SNDMATCM         SEND MATERIAL COMMENT LINES                  
         CLI   TMPBYTE1,C'Y'       LOOPING?                                     
         BE    RPYMAC40                                                         
*                                                                               
RPYMAC_X MVC   DMINBTS,WKDMINBT    RESTORE DATA MANAGER BITS                    
         J     EXIT                                                             
*                                                                               
MATPPKEY ST    RE,TMPSVRE                                                       
         MVC   KEY(L'PBUYKEY),PBUYKEY                                           
         GOTOR HIGH                                                             
         CLC   PBUYKEY,KEY                                                      
         JE    *+6                                                              
         DC    H'0'                                                             
         MVC   SVBUYKEY,KEY                                                     
         GOTOR DATCON,DMCB,(3,PBUYKDAT),(2,TMPDUB1)                             
         XC    KEY,KEY                                                          
         MVC   KEY,SVMPPKEY                                                     
         MVC   PMTPKDAT,TMPDUB1                                                 
         MVC   PMTPKLIN,PBUYKLIN                                                
         CLI   PBDFREQ,C'M'        MONTHLY?                                     
         JNE   *+8                                                              
         OI    PMTPCNT2,PMTPC2MQ                                                
         CLI   PBDJOB,C'!'         MASTER AD CODE IN INSERTION?                 
         JNE   MATPPK30                                                         
         CLI   PMTPKADC,C'!'       MASTER AD CODE IN MAT PASSIVE KEY?           
         JE    MATPPK30                                                         
         OI    PMTPCNT2,PMTPC2SQ   AD CODE BELONGS TO A MASTER AD CODE          
MATPPK30 MVC   PMTPDISK,SVBUYKEY+27                                             
         MVC   SVMPPKEY,KEY                                                     
         OI    DMINBTS,X'08'       SET TO PASS DELETES                          
         GOTOR HIGH                                                             
         CLC   SVMPPKEY(L'PMTPKEY),KEY                                          
         JNE   MATPPK40                                                         
         TM    PMTPCNT1,PMTPC1DQ   DELETED?                                     
         JZ    MATPPK60                                                         
         NI    PMTPCNT1,X'FF'-PMTPC1DQ                                          
         GOTOR WRITE                                                            
         J     MATPPK60                                                         
MATPPK40 MVC   KEY,SVMPPKEY                                                     
         GOTOR ADD                                                              
MATPPK60 L     RE,TMPSVRE                                                       
         BR    RE                                                               
*                                                                               
LAST_CHR CLI   0(RF),0                                                          
         JE    *+8                                                              
         CLI   0(RF),C' '                                                       
         JNE   *+10                                                             
         BCTR  RF,0                                                             
         J     *-18                                                             
         BR    RE                                                               
*                                                                               
SNDMATCM LR    R0,RE                                                            
         TM    ADRPYSW2,RPYMATCQ   SUB REC REPLY CODE REPLIED?                  
         JNZ   S_MATCM2                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#MATCOM)              
         OI    ADRPYSW2,RPYMATCQ                                                
S_MATCM2 LH    RF,TMPHALF1         GET SAVED LENGTH                             
         CLI   TMPBYTE1,C'Y'       LOOPING?                                     
         JE    *+8                                                              
         LHI   RF,EIOCOMLQ         MAXIMUM OF CHARS PER LINE                    
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MATCOM),    +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
         CLI   TMPBYTE1,C'Y'       LOOPING?                                     
         JE    S_MATCMX                                                         
         LHI   RF,EIOCOMLQ         MAXIMUM OF CHARS PER LINE                    
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#MATCOM),    +        
               ('LD_CHARQ',TMPWK2),((RF),0)                                     
S_MATCMX LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R3,R4                                                      
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
RPYCPYCM NTR1  BASE=*,LABEL=*      REPY COPY SPLIT COMMENTS                     
*                                                                               
         TM    ADBSW,AS_WEBIO      EIO?                                         
         JZ    EXIT                NO                                           
         CLI   PBDJOB,C'!'         MASTER AD CODE?                              
         JNE   EXIT                                                             
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         MVC   WKDMINBT,DMINBTS    SAVE DATA MANAGER BITS                       
         MVC   WKSVKEY,KEY                                                      
         MVC   WKSVAIO,AREC                                                     
         NI    DMINBTS,X'FF'-X'08' NO DELETES                                   
         XC    SUBADCTB(SUBADTLQ),SUBADCTB                                      
         MVI   TMPBYTE1,0          INDICATING LOOPING OR NOT                    
*                                                                               
         CLI   ADOPT,C'Y'          PROFILE SET FOR AD CODE?                     
         BNE   RPYCPY_X                                                         
*                                                                               
         XC    KEY,KEY                                                          
         LA    R2,KEY                                                           
         USING PJOBKEY,R2                                                       
         MVC   PJOBKAGY,QAGENCY    AGENCY                                       
         MVC   PJOBKMED,QMEDIA     MEDIA                                        
         MVI   PJOBKRCD,X'15'      AD CODE RECORD                               
         MVC   PJOBKCLT,PBUYKCLT   CLIENT                                       
         MVC   PJOBKPRD,PBUYKPRD   PRODUCT                                      
         MVC   PJOBKJOB,PBDJOB     AD CODE                                      
         GOTOR HIGH                                                             
         CLC   KEY(L'PJOBKEY),KEYSAVE                                           
         BNE   RPYCPY_X                                                         
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         LA    R2,TMPWKAIO+33                                                   
         CLI   0(R2),X'15'         FIRST ELEM FOUND?                            
         BNE   RPYCPY_X                                                         
         MVI   ELCODE,PJSUBIDQ                                                  
         USING PJSUBEL,R2                                                       
         LA    RF,SUBADCTB                                                      
RPYCPY20 BRAS  RE,NXTEL                                                         
         BNE   RPYCPY24                                                         
         MVC   0(L'PJSUBCOD,RF),PJSUBCOD                                        
         LA    RF,L'PJSUBCOD(RF)                                                
         B     RPYCPY20                                                         
RPYCPY24 OC    SUBADCTB,SUBADCTB   HAVE ANY SUB AD CODES?                       
         BZ    RPYCPY_X                                                         
*                                                                               
         TM    PBUYCNTL,X'80'      DELETED?                                     
         BNZ   RPYCPY70            NO MATERIAL COMMENTS FOR DELETED             
*                                                                               
         XC    KEY,KEY                                                          
         LA    R2,KEY                                                           
         USING PMTPKEY,R2                                                       
         MVC   PMTPKAGY,QAGENCY    AGENCY                                       
         MVC   PMTPKMED,QMEDIA     MEDIA                                        
         MVI   PMTPKRCD,PMTPKRCQ   MATERIAL COMMENT PASSIVE KEY                 
         MVC   PMTPKCLT,PBUYKCLT   CLIENT                                       
         MVC   PMTPKPRD,PBUYKPRD   PRODUCT                                      
         MVC   PMTPKADC,PBDJOB     AD CODE                                      
         MVC   PMTPKPUB,PBUYKPUB   PUB CODE                                     
         CLI   MATOPT,C'Y'         MATERIALS ACROSS Z/E?                        
         BE    *+16                                                             
         MVC   PMTPKZON,PBUYKZON   PUB ZONE                                     
         MVC   PMTPKEDT,PBUYKEDT   PUB EDITION                                  
         MVC   SVMPPKEY,KEY                                                     
*                                                                               
         GOTOR HIGH                                                             
         CLC   KEY(PMTPKDAT-PMTPKEY),KEYSAVE                                    
         BNE   RPYCPY50                                                         
*                                                                               
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,WORK)                                
         CLC   PBUYKDAT,WORK                                                    
         BL    RPYCPY50                                                         
         MVC   WKINSDL1(L'PBUYKDAT),WORK                                        
         MVC   WKINSDL1+L'PBUYKDAT(L'PMTPKLIN),PMTPKLIN                         
         MVC   WKINSDL2(L'PBUYKDAT),PBUYKDAT                                    
         MVC   WKINSDL2+L'PBUYKDAT(L'PBUYKLIN),PBUYKLIN                         
*                                                                               
         CLC   WKINSDL1,WKINSDL2   SAME AS REFERENCE INSERTION?                 
         BE    RPYCPY56                                                         
*                                                                               
RPYCPY32 GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,SVPPMIDT)                            
         MVC   SVPPMLIN,PMTPKLIN                                                
         MVC   SVPPMCN2,PMTPCNT2                                                
         GOTOR SEQ                                                              
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,WORK)                                
         CLC   KEY(PMTPKDAT-PMTPKEY),KEYSAVE                                    
         BNE   RPYCPY34                                                         
         CLC   PBUYKDAT,WORK                                                    
         BH    RPYCPY32                                                         
         CLC   PBUYKDAT,WORK                                                    
         BNE   RPYCPY34                                                         
         CLC   PBUYKLIN,PMTPKLIN                                                
         BH    RPYCPY32                                                         
*                                                                               
RPYCPY34 MVC   WKINSDT,SVPPMIDT                                                 
         MVI   WKFREQU,0                                                        
         TM    SVPPMCN2,PMTPC2MQ   INSERTION IS MONTHLY?                        
         BZ    *+8                                                              
         MVI   WKFREQU,C'M'                                                     
         MVC   WKBUYLN,SVPPMLIN                                                 
         GOTOR FMTBUYL#            GET INSERTION DATE WITH REF#                 
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'R_MCTXT1),R_MCTXT1                                      
         MVC   TMPWK1+L'R_MCTXT1(L'D_INSDLN),TMPCL20                            
         LA    RF,TMPWK1+L'R_MCTXT1+L'D_INSDLN-1                                
         BRAS  RE,LAST_CHR                                                      
         MVC   2(09,RF),=C'INSERTION'                                           
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   2(09,RF),=C'POSTING  '                                           
*                                                                               
         XC    TMPWK2,TMPWK2                                                    
         MVC   TMPWK2(03),=C'FOR'                                               
         LA    RF,TMPWK2+L'TMPWK2-1                                             
         BRAS  RE,LAST_CHR                                                      
         LA    RF,2(RF)                                                         
         LR    RE,RF                                                            
*                                                                               
         MVC   0(L'R_MCTXT2,RF),R_MCTXT2                                        
         MVC   (0+L'R_MCTXT2)(L'PBDJOB,RF),PBDJOB                               
         CLC   LIOBPCV1,=AL1(03,03,00,02)                                       
         BL    RPYCPY38                                                         
         CLC   PJOBADID,SPACES                                                  
         BNH   RPYCPY38                                                         
         LR    RF,RE                                                            
         MVC   0(L'R_MCTXT2,RF),SPACES                                          
         MVC   0(L'R_MCTXT3,RF),R_MCTXT3                                        
         MVC   (0+L'R_MCTXT3)(L'PJOBADID,RF),PJOBADID                           
*                                                                               
RPYCPY38 BRAS  RE,MATPPKEY         ADD MAT= REPEAT PASSIVE KEY                  
         B     RPYCPY66                                                         
*                                                                               
RPYCPY50 CLI   RCWRITE,C'Y'        WRITING MODE?                                
         BNE   *+8                                                              
         BRAS  RE,MATPPKEY         ADD MAT= REPEAT PASSIVE KEY                  
*                                                                               
RPYCPY56 MVC   WKSVADCD,PBDJOB                                                  
         BRAS  RE,GETINSRC         GET INSTRUCTION RECORD                       
         BNE   RPYCPY70                                                         
         MVI   TMPBYTE1,C'Y'       INDICATOR FOR LOOP                           
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
RPYCPY60 BRAS  RE,NXTEL                                                         
         BNE   RPYCPY70                                                         
         CLI   1(R2),2+4           ELEM HAS NOTHING IN IT?                      
         BNH   RPYCPY60                                                         
         CLC   2(4,R2),=C'MAT='    MATERIAL COMMENT?                            
         BNE   RPYCPY60                                                         
         SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2+4+1            ADJUST OVERHEADS AND ONE FOR EX              
         CHI   RF,0                                                             
         BL    RPYCPY60                                                         
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   TMPWK1(0),2+4(R2)                                                
         AHI   RF,1                                                             
         STH   RF,TMPHALF1                                                      
*                                                                               
RPYCPY66 BRAS  RE,SNDMATCM         SEND MATERIAL COMMENT LINES                  
         CLI   TMPBYTE1,C'Y'       LOOPING?                                     
         BE    RPYCPY60                                                         
*                                                                               
RPYCPY70 LHI   R2,SUBADMXQ                                                      
         LA    R4,SUBADCTB                                                      
RPYCPY76 OC    0(L'PJSUBCOD,R4),0(R4)                                           
         BZ    RPYCPY_X                                                         
         XC    KEY,KEY                                                          
         LA    RE,KEY                                                           
         USING PJOBKEY,RE                                                       
         MVC   PJOBKAGY,QAGENCY    AGENCY                                       
         MVC   PJOBKMED,QMEDIA     MEDIA                                        
         MVI   PJOBKRCD,X'15'      AD CODE RECORD                               
         MVC   PJOBKCLT,PBUYKCLT   CLIENT                                       
         MVC   PJOBKPRD,PBUYKPRD   PRODUCT                                      
         MVC   PJOBKJOB,0(R4)      AD CODE                                      
         DROP  RE                                                               
         GOTOR HIGH                                                             
         CLC   KEY(L'PJOBKEY),KEYSAVE                                           
         BNE   *+8                                                              
         BRAS  RE,SNDSUBAD         SEND SUB AD CODE DATA                        
         LA    R4,L'PJSUBCOD(R4)                                                
         BCT   R2,RPYCPY76                                                      
*                                                                               
RPYCPY_X MVC   DMINBTS,WKDMINBT    RESTORE DATA MANAGER BITS                    
         MVC   KEY,WKSVKEY                                                      
         MVC   AREC,WKSVAIO                                                     
         J     EXIT                                                             
*                                                                               
         LTORG                                                                  
         DROP  RB,R2,R3                                                         
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SNDSUBAD NTR1  BASE=*,LABEL=*      SEND SUB AD CODE DATA                        
*                                                                               
         L     R3,AWRKREC                                                       
         USING LIOBD,R3            LINKIO INTERFACE BLOCK                       
*                                                                               
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         LA    R2,TMPWKAIO                                                      
         USING PJOBREC,R2                                                       
*                                                                               
         CLI   PJOBELEM,X'15'                                                   
         JNE   EXIT                                                             
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTMAP',E#CPYCOM)              
*                                                                               
         CLI   PJOBKJOB,X'FF'                                                   
         BE    S_SUBA22                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SUBADC),    +        
               ('LD_CHARQ',PJOBKJOB),(L'PJOBKJOB,0)                             
         B     S_SUBA28                                                         
*                                                                               
S_SUBA22 GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SUBADI),    +        
               ('LD_CHARQ',PJOBADID),(L'PJOBADID,0)                             
*                                                                               
S_SUBA28 CLC   PJOBSPC,SPACES                                                   
         BNH   S_SUBA30                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SPCDSC),    +        
               ('LD_CHARQ',PJOBSPC),(L'PJOBSPC,0)                               
         B     S_SUBA36                                                         
*                                                                               
S_SUBA30 CLI   PJOBKMED,C'N'       NEWSPAPER?                                   
         BNE   S_SUBA36                                                         
         XC    TMPWK1,TMPWK1                                                    
         OC    PJOBTUNS,PJOBTUNS                                                
         BZ    S_SUBA36                                                         
         CP    PJOBTUNS,=P'0'                                                   
         BE    S_SUBA36                                                         
         CLI   PJOBUIND,X'89'                                                   
         BNE   S_SUBA32                                                         
         EDIT  PJOBTUNS,(6,TMPWK1),2,ALIGN=LEFT                                 
         B     S_SUBA34                                                         
S_SUBA32 EDIT  PJOBTUNS,(5,TMPWK1),ALIGN=LEFT                                   
S_SUBA34 LA    RE,TMPWK1                                                        
         AR    RE,R0                                                            
         MVC   0(1,RE),PJOBUIND                                                 
         CLI   0(RE),C'I'                                                       
         BE    *+16                                                             
         CLI   0(RE),X'89'                                                      
         BNE   *+12                                                             
         OI    0(RE),X'40'                                                      
         MVI   1(RE),C'N'                                                       
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#SPCDSC),    +        
               ('LD_CHARQ',TMPWK1),(8,0)                                        
*                                                                               
S_SUBA36 CLI   COPYOPT,C'N'        SUPPRESS COPY NUMBER?                        
         BNE   S_SUBA38                                                         
         CLC   PJOBCPY,SPACES                                                   
         BNH   S_SUBA38                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#CPYNUM),    +        
               ('LD_CHARQ',PJOBCPY),(L'PJOBCPY,0)                               
*                                                                               
S_SUBA38 CLC   PJOBCAP1,SPACES                                                  
         BNH   S_SUBA44                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADCAP),     +        
               ('LD_CHARQ',PJOBCAP1),(L'PJOBCAP1,0)                             
*                                                                               
S_SUBA44 CLC   PJOBCAP2,SPACES                                                  
         BNH   S_SUBA52                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#ADCAP2),    +        
               ('LD_CHARQ',PJOBCAP2),(L'PJOBCAP2,0)                             
*                                                                               
S_SUBA52 MVC   WKSVADCD,PJOBKJOB                                                
         BRAS  RE,GETINSRC         GET INSTRUCTION RECORD                       
         BNE   S_SUBA_X                                                         
         DROP  R2                                                               
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
S_SUBA56 BRAS  RE,NXTEL                                                         
         BNE   S_SUBA70                                                         
         CLI   1(R2),2+1           ELEM HAS NOTHING IN IT?                      
         BNH   S_SUBA56                                                         
         CLC   2(5,R2),=C'SHIP='                                                
         BE    S_SUBA56                                                         
         CLC   2(6,R2),=C'LABEL='                                               
         BE    S_SUBA56                                                         
         CLC   2(4,R2),=C'MAT='                                                 
         BE    S_SUBA56                                                         
         CLC   2(3,R2),=C'RC='                                                  
         BE    S_SUBA56                                                         
         CLC   2(4,R2),=C'COM='                                                 
         BE    S_SUBA60                                                         
*                                                                               
         BRAS  RE,SUBACOMM         SUB AD CODE COMMENTS                         
         B     S_SUBA56                                                         
*                                                                               
S_SUBA60 LA    R4,2+4(R2)          POINT TO COMMENT CODE                        
         ST    R2,TMPFULL2                                                      
S_SUBA61 MVC   DUB,SPACES                                                       
         LA    RF,DUB+5            COMMENT CODE IS RIGHT JUSTIFIED              
S_SUBA62 CLI   0(R4),0             END OF RECORD?                               
         BE    S_SUBA64                                                         
         CLI   0(R4),C','          ANOTHER COMMENT CODE?                        
         BE    S_SUBA64                                                         
         CLI   0(R4),X'66'         NEXT COMMENT ELEM?                           
         BE    S_SUBA64                                                         
         MVC   0(1,RF),0(R4)                                                    
         SHI   RF,1                                                             
         LA    R4,1(R4)            NEXT COMMENT CODE CHAR                       
         B     S_SUBA62                                                         
*                                                                               
S_SUBA64 XC    KEY,KEY                                                          
         MVC   KEY+0(2),QAGENCY    AGENCY                                       
         MVC   KEY+2(1),QMEDIA     MEDIA                                        
         MVI   KEY+3,X'40'         STANDARD COMMENT RECORD                      
         MVC   KEY+4(6),DUB        COMMENT CODE                                 
         GOTOR HIGH                                                             
         CLC   KEY(25),KEYSAVE     STANDARD COMMENT FOUND?                      
         BNE   S_SUBA68                                                         
         LA    R0,TMPWKAIO                                                      
         ST    R0,AREC                                                          
         GOTOR GETPRT                                                           
         LA    R2,TMPWKAIO+33                                                   
S_SUBA66 CLI   0(R2),0             END OF RECORD?                               
         BE    S_SUBA68                                                         
         BRAS  RE,SUBACOMM         SUB AD CODE COMMENTS                         
         SR    RE,RE                                                            
         IC    RE,1(R2)                                                         
         AR    R2,RE                                                            
         B     S_SUBA66                                                         
*                                                                               
S_SUBA68 CLI   0(R4),C','          ANOTHER COMMENT CODE?                        
         BNE   *+12                                                             
         LA    R4,1(R4)                                                         
         B     S_SUBA61                                                         
         L     R2,TMPFULL2         POINT TO INSTRUCTION COMMENT                 
         B     S_SUBA56                                                         
*                                                                               
S_SUBA70 TM    PBUYCNTL,X'80'      DELETED?                                     
         BNZ   S_SUBA_X            NO MATERIAL COMMENTS FOR DELETED             
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
S_SUBA76 BRAS  RE,NXTEL                                                         
         BNE   S_SUBA_X                                                         
         CLI   1(R2),2+1           ELEM HAS NOTHING IN IT?                      
         BNH   S_SUBA76                                                         
         CLC   2(4,R2),=C'MAT='    MATERIAL COMMENT?                            
         BNE   S_SUBA76                                                         
         SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2+4              ADJUST OVERHEADS                             
         CHI   RF,0                                                             
         BNH   S_SUBA76            NO ACTUAL MATERIAL COMMENTS                  
*                                                                               
         NI    DMINBTS,X'FF'-X'08' NO DELETES                                   
         XC    KEY,KEY                                                          
         LA    R2,KEY                                                           
         USING PMTPKEY,R2                                                       
         MVC   PMTPKAGY,QAGENCY    AGENCY                                       
         MVC   PMTPKMED,QMEDIA     MEDIA                                        
         MVI   PMTPKRCD,PMTPKRCQ   MATERIAL COMMENT PASSIVE KEY                 
         MVC   PMTPKCLT,PBUYKCLT   CLIENT                                       
         MVC   PMTPKPRD,PBUYKPRD   PRODUCT                                      
         MVC   PMTPKADC,WKSVADCD   AD CODE                                      
         MVC   PMTPKPUB,PBUYKPUB   PUB CODE                                     
         CLI   MATOPT,C'Y'         MATERIALS ACROSS Z/E?                        
         BE    *+16                                                             
         MVC   PMTPKZON,PBUYKZON   PUB ZONE                                     
         MVC   PMTPKEDT,PBUYKEDT   PUB EDITION                                  
         MVC   SVMPPKEY,KEY                                                     
*                                                                               
         GOTOR HIGH                                                             
         CLC   KEY(PMTPKDAT-PMTPKEY),KEYSAVE                                    
         BNE   S_SUBA88                                                         
*                                                                               
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,WORK)                                
         CLC   PBUYKDAT,WORK                                                    
         BL    S_SUBA88                                                         
         MVC   WKINSDL1(L'PBUYKDAT),WORK                                        
         MVC   WKINSDL1+L'PBUYKDAT(L'PMTPKLIN),PMTPKLIN                         
         MVC   WKINSDL2(L'PBUYKDAT),PBUYKDAT                                    
         MVC   WKINSDL2+L'PBUYKDAT(L'PBUYKLIN),PBUYKLIN                         
*                                                                               
         CLC   WKINSDL1,WKINSDL2   SAME AS REFERENCE INSERTION?                 
         BE    S_SUBA90                                                         
*                                                                               
S_SUBA80 GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,SVPPMIDT)                            
         MVC   SVPPMLIN,PMTPKLIN                                                
         MVC   SVPPMCN2,PMTPCNT2                                                
         GOTOR SEQ                                                              
         GOTOR DATCON,DMCB,(2,PMTPKDAT),(3,WORK)                                
         CLC   KEY(PMTPKDAT-PMTPKEY),KEYSAVE                                    
         BNE   S_SUBA82                                                         
         CLC   PBUYKDAT,WORK                                                    
         BH    S_SUBA80                                                         
         CLC   PBUYKDAT,WORK                                                    
         BNE   S_SUBA82                                                         
         CLC   PBUYKLIN,PMTPKLIN                                                
         BH    S_SUBA80                                                         
*                                                                               
S_SUBA82 MVC   WKINSDT,SVPPMIDT                                                 
         MVI   WKFREQU,0                                                        
         TM    SVPPMCN2,PMTPC2MQ   INSERTION IS MONTHLY?                        
         BZ    *+8                                                              
         MVI   WKFREQU,C'M'                                                     
         MVC   WKBUYLN,SVPPMLIN                                                 
         GOTOR FMTBUYL#            GET INSERTION DATE WITH REF#                 
         XC    TMPWK1,TMPWK1                                                    
         MVC   TMPWK1(L'R_MCTXT1),R_MCTXT1                                      
         MVC   TMPWK1+L'R_MCTXT1(L'D_INSDLN),TMPCL20                            
         LA    RF,TMPWK1+L'R_MCTXT1+L'D_INSDLN-1                                
         BRAS  RE,LAST_CHR                                                      
         MVC   2(09,RF),=C'INSERTION'                                           
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   2(09,RF),=C'POSTING  '                                           
         XC    TMPWK2,TMPWK2                                                    
         MVC   TMPWK2(03),=C'FOR'                                               
         LA    RF,TMPWK2+L'TMPWK2-1                                             
         BRAS  RE,LAST_CHR                                                      
         LA    RF,2(RF)                                                         
         LR    RE,RF                                                            
         MVC   0(L'R_MCTXT2,RF),R_MCTXT2                                        
         MVC   (0+L'R_MCTXT2)(L'PBDJOB,RF),PBDJOB                               
         TM    SVPPMCN2,PMTPC2SQ   AD CODE BELONGS TO A MATER AD CODE?          
         BZ    *+10                                                             
         MVC   (0+L'R_MCTXT2)(L'WKSVADCD,RF),WKSVADCD                           
*                                                                               
         BRAS  RE,MATPPKEY         ADD MAT= REPEAT PASSIVE KEY                  
*                                                                               
         LHI   RF,EIOCOMLQ         MAXIMUM OF CHARS PER LINE                    
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',TMPWK1),((RF),0)                                     
*                                                                               
         LHI   RF,EIOCOMLQ         MAXIMUM OF CHARS PER LINE                    
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',TMPWK2),((RF),0)                                     
*                                                                               
         B     S_SUBA_X                                                         
*                                                                               
S_SUBA88 BRAS  RE,MATPPKEY         ADD MAT= REPEAT PASSIVE KEY                  
         DROP  R2                                                               
*                                                                               
S_SUBA90 LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'        COMMENT ELEM CODE                            
S_SUBA94 BRAS  RE,NXTEL                                                         
         BNE   S_SUBA_X                                                         
         CLI   1(R2),2+1           ELEM HAS NOTHING IN IT?                      
         BNH   S_SUBA94                                                         
         CLC   2(4,R2),=C'MAT='    MATERIAL COMMENT?                            
         BNE   S_SUBA94                                                         
         SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2+4              ADJUST OVERHEADS                             
         CHI   RF,0                                                             
         BNH   S_SUBA94            NO ACTUAL MATERIAL COMMENTS                  
*                                                                               
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',2+4(R2)),((RF),0)                                    
*                                                                               
         B     S_SUBA94            GO REPLY MORE MATERIAL COMMENTS              
*                                                                               
S_SUBA_X LA    RE,PINSREC                                                       
         LHI   RF,1000                                                          
         XCEFL                                                                  
         J     EXIT                                                             
*                                                                               
SUBACOMM LR    R0,RE                                                            
         CLI   2(R2),C'+'          SKIPPING LINES?                              
         BNE   SUBACM64                                                         
         SR    R4,R4                                                            
         PACK  DUB,2(3,R2)                                                      
         TP    DUB                                                              
         BNZ   *+8                                                              
         CVB   R4,DUB              +0 OR INVALID, PUT ONE LINE ANYWAY           
         MVI   TMPBYTE2,C' '                                                    
*                                                                               
SUBACM58 GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',TMPBYTE2),(1,0)                                      
         CHI   R4,0                                                             
         BE    SUBACM60                                                         
         BCT   R4,SUBACM58                                                      
*                                                                               
SUBACM60 SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2+2                                                           
         LA    R4,2+2(R2)          POINT TO COMMENT                             
         B     SUBACM66                                                         
                                                                                
SUBACM64 SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         SHI   RF,2                ADJUST OVERHEADS                             
SUBACM66 CHI   RF,0                                                             
         BNH   SUBACM_X                                                         
         LA    R4,2(R2)                                                         
         GOTOR ALINKIO,DMCB,('LIOAPUT',LIOBD),('LIOTRAW',D#COMMNT),    +        
               ('LD_CHARQ',0(R4)),((RF),0)                                      
SUBACM_X LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
         DROP  RB,R3                                                            
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         DROP                                                                   
*                                                                               
FMTBUYD  DSECT                                                                  
*                                                                               
RELO     DS    F                                                                
ADICSECT DS    A                                                                
*                                                                               
PACK1BIL DS    PL6                 PACK 1,000,000,000                           
R_MCTXT1 DS    CL(L'T_MCTXT1)                                                   
R_MCTXT2 DS    CL(L'T_MCTXT2)                                                   
R_MCTXT3 DS    CL(L'T_MCTXT3)                                                   
*                                                                               
DAYOFWK  DS    CL3                                                              
*                                                                               
SVCTYP   DS    CL1                                                              
*                                                                               
SAVEBEL  DS    256C                                                             
*                                                                               
BUYOUTA  DS    600C                                                             
*                                                                               
LWSVPRDC DS    CL4                 LW & QUARTERLY COM CODE (PRD REC)            
LWINSDT  DS    C                   QUARTER COMPUTED FROM INS DATE               
*                                                                               
SAVER2   DS    F                                                                
SVELCOD  DS    CL1                                                              
*                                                                               
BSVCTYP  DS    CL1                                                              
SVBUYKEY DS    XL(L'KEY)           SAVE BUY KEY                                 
SVCONKEY DS    XL(L'KEY)           SAVE CONTRACT KEY                            
SVMPPKEY DS    XL(L'KEY)           SAVE MAT= REPEAT PASSIVE KEY                 
*                                                                               
GKEY     DS    XL48                                                             
GKEYSAVE DS    XL48                                                             
*                                                                               
TMPSVKEY DS    XL(L'KEY)           TEMP SAVE KEY STORAGE                        
TMPSVAIO DS    XL(L'AREC)                                                       
WKSVKEY  DS    XL(L'KEY)                                                        
WKSVAIO  DS    XL(L'AREC)                                                       
*                                                                               
ACHWORK  DS    CL(ADCDLNTH)                                                     
ACHPRD   DS    CL(L'PBUYKPRD)                                                   
*                                                                               
MAXLNTH  DS    XL1                 MAX AVAILABLE O/P LNTH (CCOL "LINE")         
*                                                                               
SVPUBZEC DS    XL(L'PUBKPUB+L'PUBKZON+L'PUBKED)                                 
SVPUBZNM DS    XL(L'PUBZNAME)                                                   
SVPPMIDT DS    XL(L'PBUYKDAT)                                                   
SVPPMPUB DS    XL(L'PMTPKPUB+L'PMTPKZON+L'PMTPKEDT)                             
SVPPMLIN DS    XL(L'PMTPKLIN)                                                   
SVPPMCN2 DS    XL(L'PMTPCNT2)                                                   
*                                                                               
WKBFDAY  DS    XL(L'PBDBFD)                                                     
WKINSDT  DS    XL(L'PBUYKDAT)                                                   
WKFREQU  DS    XL(L'PBDFREQ)                                                    
WKBUYLN  DS    XL(L'PBUYKLIN)                                                   
WKINSDL1 DS    XL(L'PBUYKDAT+L'PBUYKLIN)                                        
WKINSDL2 DS    XL(L'PBUYKDAT+L'PBUYKLIN)                                        
WKDMINBT DS    XL(L'DMINBTS)                                                    
WKBYSER# DS    PL(L'PSERNUM)                                                    
WKIOCDAT DS    CL10                INS ORDER CREATED DATE - MMMDD/YYYY          
WKSVADCD DS    CL(L'PJOBKJOB)                                                   
*                                                                               
WKEIOFLG DS    X                   EIO WORK FLAG                                
E_IOGENQ EQU   X'80'               EIO GENERATED IN SAME DAY                    
E_IOELMQ EQU   X'40'               EIO ELEM EXIST IN INSERTION                  
E_IOBMFQ EQU   X'20'               CONTAIN BUY MOVE "FROM" INSERTION            
E_IOBMTQ EQU   X'10'               CONTAIN BUY MOVE "TO" INSERTION              
E_IOBMDQ EQU   X'08'               DELETED BUY MOVE CHANGE ORDER ISSUED         
E_IOBMOQ EQU   X'04'               BUY MOVE INSERTION ORDER ISSUED              
E_IOBM_Q EQU   E_IOBMFQ+E_IOBMTQ   BOTH BUY MOVE "FROM" AND "TO"                
E_IOBM#Q EQU   E_IOBMDQ+E_IOBMOQ   BUY MOVE ORDER HAS BEEN ISSUED               
*                                                                               
WKBYMCSW DS    X                   BUY MOVE COMMENT SWITCH                      
B_MVTO_Q EQU   X'80'               PROCESS "TO" COMMENT                         
B_MVFROQ EQU   X'40'               PROCESS "FROM" COMMENT                       
B_MVRTFQ EQU   X'20'               REPLACEMENT IO TO FOLLOW MSG REPLIED         
*                                                                               
TMPSVRE  DS    F                   FOR SAVING RETURN ADDRESSES                  
TMPFULL1 DS    F                   TEMP WORKING STORAGES                        
TMPFULL2 DS    F                                                                
TMPDUB1  DS    D                                                                
TMPDUB2  DS    D                                                                
TMPHALF1 DS    H                                                                
TMPHALF2 DS    H                                                                
TMPBYTE1 DS    X                                                                
TMPBYTE2 DS    X                                                                
TMPBYTE3 DS    X                                                                
TMPPL4   DS    PL4                                                              
TMPCL20  DS    CL20                                                             
TMPWK1   DS    XL256                                                            
TMPWK2   DS    XL256                                                            
*                                                                               
FIDCHGTB DS    (FIDCTMXQ)XL2       TABLE OF "CHANGED" MAP CODES                 
FIDCTMXQ EQU   100                 MAXIMUM ENTRIES IN TABLE                     
FIDCHGLQ EQU   *-FIDCHGTB                                                       
*                                                                               
* SAVED DATA FOR DETAIL SECTION OF DATA STREAM                                  
*                                                                               
D_SVSTRT DS    0X                                                               
D_INSDAT DS    XL(L'PBUYKDAT)      INSERTION DATE                               
D_INSDLN DS    CL15                INSERTION DATE WITH LINE NUMBER              
D_MODCOD DS    C                   MODIFICATION CODE (CHG/DEL/CAN ETC.)         
D_PUBZON DS    CL(L'QZONE)         PUBLICATION ZONE                             
D_PUBEDT DS    CL(L'QEDITION)      PUBLICATION EDITION                          
*                                                                               
D_CONNUM DS    CL(L'PCONNUM)       CONTRACT NUMBER                              
D_CONSDT DS    CL(L'PCONSDT)       CONTRACT START DATE                          
D_CONEDT DS    CL(L'PCONEDT)       CONTRACT END DATE                            
D_CONLVL DS    CL(L'PRBLEVEL)      CONTRACT LEVEL                               
*                                                                               
D_IORTYP DS    C                   INSERION ORDER TYPE                          
D_IORTIQ EQU   C'I'                INSERTION ORDER (DEFAULT)                    
D_IORTSQ EQU   C'S'                SPACE RESERVATION                            
*                                                                               
D_RATIND DS    CL3                 INSERTION RATE INDICATOR                     
D_INSRAT DS    CL14                INSERTION RATE                               
D_COSIND DS    CL1                 INSERTION COST INDICATOR                     
D_INSCOS DS    CL14                INSERTION COST                               
D_COSIN2 DS    CL1                 INSERTION COST INDICATOR 2                   
D_INSCO2 DS    CL14                INSERTION COST 2                             
D_NCONLE DS    CL12                CONTRACT LINEAGE EQUIVALENCY                 
D_SVDLNQ EQU  *-D_SVSTRT                                                        
*                                                                               
SUBADCTB DS    (SUBADTLQ)X                                                      
SUBADTLQ EQU   SUBADMXQ*L'PJSUBCOD                                              
SUBADMXQ EQU   10                                                               
*                                                                               
TMPWKAIO DS    XL4096              TEMP WORKING AIO                             
*                                                                               
FMTBUYDX EQU   *                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         EJECT                                                                  
*                                                                               
         PRINT OFF                                                              
*                                                                               
       ++INCLUDE PPBYOUTD                                                       
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPIOFMTD          DICTIONARY FOR PP72FMT AND PPFMTBUY          
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPINSWRK1                                                      
         EJECT                                                                  
*                                                                               
       ++INCLUDE POLFILE                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE PPINSWRK2                                                      
         EJECT                                                                  
*                                                                               
         PRINT ON                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'234PPFMTBUY  06/30/08'                                      
         END                                                                    
*                                                                               

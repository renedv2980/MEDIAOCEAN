*          DATA SET PP6602BN   AT LEVEL 072 AS OF 05/01/02                      
*CATALP PP6602BN                                                                
         TITLE 'PP6602 - MONTHLY PUB TOTALS'                                    
ENDPTOT  CSECT                                                                  
         NMOD1 0,ENDPTOT                                                        
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
*                                                                               
* PRINT MONTHLY PUB TOTALS                                                      
*                                                                               
         XC    FULL,FULL                                                        
         LA    R3,ESCDETS                                                       
         LA    R0,3                                                             
ENDPTOT2 CLI   0(R3),1                                                          
         BNE   *+8                                                              
         OI    FULL,X'01'                                                       
         CLI   0(R3),2                                                          
         BNE   *+8                                                              
         OI    FULL,X'02'                                                       
         LA    R3,1(R3)                                                         
         BCT   R0,ENDPTOT2                                                      
         SR    RE,RE               TOTALS TAKE 4 LINES ON 1 PAGE                
         IC    RE,LINE                                                          
         LA    RE,4(RE)                                                         
         TM    FULL,X'03'                                                       
         BNO   *+8                                                              
         LA    RE,4(RE)            4 MORE LINES FOR NET                         
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BL    *+8                                                              
         MVI   LINE,99                                                          
*                                                                               
         GOTO1 APRNT               SKIP A LINE                                  
*                                                                               
         MVC   P+10(14),=C'MONTHLY TOTALS'                                      
         TM    ESCPBTOT,X'04'       TEST ED/VEN TOTS                            
         BZ    ENDPTOT3            ONLY VENDOR                                  
         MVC   P+10(7),=C' VENDOR'                                              
         CLI   EDVENSW,C'V'                                                     
         BE    ENDPTOT3                                                         
         MVC   P+10(7),=C'EDITION'                                              
         CLI   QMEDIA,C'O'                                                      
         BNE   ENDPTOT3                                                         
         MVC   P+10(7),SPACES                                                   
ENDPTOT3 DS    0H                                                               
         CLI   EDVENSW,C'M'                                                     
         BNE   *+10                                                             
         MVC   P+10(7),=C' MARKET'                                              
         MVI   BYTE,1              SET MONTH CODE                               
         MVI   FULL+1,X'01'        GRS                                          
         TM    FULL,X'01'                                                       
         BNZ   *+8                                                              
         MVI   FULL+1,X'02'        NET                                          
         BAS   RE,ENDPFMT                                                       
         MVI   BYTE,2                                                           
         TM    FULL,X'03'               TEST DOING BOTH                         
         BNO   *+10                     NO                                      
         MVC   P+13(9),=C'**GROSS**'    YES - GROSS NOW                         
         BAS   RE,ENDPFMT                                                       
         MVI   BYTE,3                                                           
         MVI   SPACING,2                                                        
         BAS   RE,ENDPFMT                                                       
*                                                                               
         TM    FULL,X'03'          TEST DOING BOTH                              
         BNO   ENDPTOT4                                                         
         MVI   FULL+1,X'02'        NET NOW                                      
         MVI   BYTE,1                                                           
         BAS   RE,ENDPFMT                                                       
         MVI   BYTE,2                                                           
         MVC   P+14(7),=C'**NET**'                                              
         BAS   RE,ENDPFMT                                                       
         MVI   BYTE,3                                                           
         BAS   RE,ENDPFMT                                                       
*                                                                               
ENDPTOT4 DS    0H                                                               
*                                                                               
         CLI   EDVENSW,C'E'                                                     
         BNE   ENDPTOT6                                                         
         CLI   MODE,LBUYVEN                                                     
         BNE   ENDPTOT6                                                         
         GOTO1 APRNT               NO NEW PAGE FOR VEN TOTS                     
*                                                                               
         B     ENDPTOTX                                                         
ENDPTOT6 DS    0H                                                               
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
ENDPTOTX DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
ENDPFMT  LA    R4,P+27                                                          
         SR    R5,R5                                                            
         IC    R5,BYTE             BYTE HAS VALUES 1-3 FOR START MONTH          
         MH    R5,=H'3'                                                         
         LA    R5,MONTHS-3(R5)                                                  
         MVC   0(3,R4),0(R5)                                                    
         MVC   18(3,R4),9(R5)                                                   
         MVC   36(3,R4),18(R5)                                                  
         MVC   54(3,R4),27(R5)                                                  
*                                                                               
ENDPFMT1 LA    R5,RMTAB+12                                                      
ENDPFMT2 CLC   BYTE,1(R5)          FIND MONTH IN TABLE                          
         BE    ENDPFMT4                                                         
         LA    R5,2(R5)                                                         
         CLI   0(R5),0                                                          
         BNE   ENDPFMT2                                                         
         B     ENDPFMT6            TRY NEXT MONTH                               
ENDPFMT4 LA    R0,RMTAB            CLACULATE DISPLACEMENT                       
         SR    R5,R0               GET DSPL X 2                                 
         MH    R5,=Y(ROWL/2)                                                    
         L     R1,APUBTOT                                                       
         CLI   EDVENSW,C'E'                                                     
         BE    EPFMT4B                                                          
         L     R1,AVENTOT                                                       
         CLI   EDVENSW,C'V'                                                     
         BE    EPFMT4B                                                          
         L     R1,AMKTTOT                                                       
EPFMT4B  DS    0H                                                               
         LR    R6,R5                                                            
         AR    R6,R1                                                            
         ZAP   MYDUB,0(8,R6)                                                    
         CLI   FULL+1,X'01'                                                     
         BE    ENDPFMT5                                                         
         SP    MYDUB,16(8,R6)      LESS AGYCOM = NET                            
*                                                                               
ENDPFMT5 DS    0H                                                               
         CP    MYDUB,=P'0'                                                      
         BE    ENDPFMT6                                                         
         EDIT  (P8,MYDUB),(10,4(R4)),2,FLOAT=-                                  
*                                                                               
ENDPFMT6 LA    R4,18(R4)           POINT AHEAD 3 MONTHS                         
         IC    R5,BYTE                                                          
         LA    R5,3(R5)                                                         
         STC   R5,BYTE                                                          
         CLI   BYTE,12                                                          
         BNH   ENDPFMT1                                                         
ENDPFMT8 LR    R0,RE                                                            
         GOTO1 APRNT                                                            
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'PP5202 - END BREAK ROUTINES'                                    
ENDBRKS  CSECT                                                                  
         NMOD1 0,ENDBRKS                                                        
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
*                                                                               
         MVI   PRNTSW,C'S'                                                      
         CLI   ESTACTIV,0                                                       
         BE    ENDCB                                                            
         CLI   MODE,LBUYCLI                                                     
         BL    ENDCB                                                            
         CLI   MODE,LBUYDST                                                     
         BH    ENDCB                                                            
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         MVC   MID1,SPACES                                                      
         MVC   MID2,SPACES                                                      
         CLI   MODE,LBUYDST                                                     
         BE    ENDDST                                                           
         CLI   MODE,LBUYREG                                                     
         BE    ENDREG                                                           
         CLC   QEST,=C'ALL'                                                     
         BNE   *+12                                                             
         CLI   MODE,LBUYEST                                                     
         BE    ENDEST                                                           
         CLI   MODE,LBUYDIV                                                     
         BE    ENDDIV                                                           
         CLI   MODE,LBUYCLI                                                     
         BE    ENDCLT                                                           
         B     ENDCB                                                            
* END OF DISTRICT                                                               
*                                                                               
ENDDST   CLC   QDIST,=C'ALL'                                                    
         BNE   ENDDSTX                                                          
*                                                                               
         CLI   QOPT3,C'R'          SUPPRESS REG/DST SUMMARIES                   
         BNE   *+8                                                              
         MVI   PRNTSW,C'N'                                                      
*                                                                               
         TM    RDPACT,X'40'         TEST DIST ACTIVE                            
         BNZ   *+8                                                              
         MVI   PRNTSW,C'N'                                                      
*                                                                               
         LA    R4,MYSUMHD8+35                                                   
         MVC   0(12,R4),DSHD                                                    
         MVC   12(30,R4),IMHD                                                   
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   12(30,R4),PMHD      OUTDOOR - POSTING                            
         CLI   ESCOS,C'0'                                                       
         BE    *+10                                                             
         MVC   12(30,R4),OMHD                                                   
         GOTO1 AESSUM,DMCB,ADSTTOT                                              
*                                                                               
         MVC   WRITTOTS,GRDTOTS                                                 
         GOTO1 AWFMOD                                                           
*                                                                               
*                                                                               
         MVC   0(12,R4),DSHD                                                    
         MVC   12(30,R4),BMHD                                                   
         GOTO1 AESSUM,DMCB,ADSTTOTB                                             
*                                                                               
ENDDSTX  L     R2,ADSTTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,ADSTTOTB                                                      
         BAS   RE,ENDCLR                                                        
         MVI   LINE,99                                                          
         B     ENDCB                                                            
         EJECT                                                                  
* END OF REGION                                                                 
*                                                                               
ENDREG   CLC   QREGION,=C'ALL'                                                  
         BNE   ENDREGX                                                          
*                                                                               
         CLI   QOPT3,C'R'          SUPPRESS REG/DST SUMMARIES                   
         BNE   *+8                                                              
         MVI   PRNTSW,C'N'                                                      
*                                                                               
         TM    RDPACT,X'80'         TEST REG ACTIVE                             
         BNZ   *+8                                                              
         MVI   PRNTSW,C'N'                                                      
*                                                                               
         CLC   QDIST,=C'ALL'                                                    
         BNE   *+10                                                             
         XC    PDSTKEY,PDSTKEY                                                  
*                                                                               
         LA    R4,MYSUMHD8+35                                                   
         MVC   0(12,R4),RGHD                                                    
         MVC   10(30,R4),IMHD                                                   
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   10(30,R4),PMHD      OUTDOOR - POSTING                            
         CLI   ESCOS,C'0'                                                       
         BE    *+10                                                             
         MVC   10(30,R4),OMHD                                                   
         GOTO1 AESSUM,DMCB,AREGTOT                                              
*                                                                               
         MVC   WRITTOTS,GRDTOTS                                                 
         GOTO1 AWFMOD                                                           
*                                                                               
*                                                                               
         MVC   0(12,R4),RGHD                                                    
         MVC   10(30,R4),BMHD                                                   
         GOTO1 AESSUM,DMCB,AREGTOTB                                             
*                                                                               
ENDREGX  L     R2,AREGTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,AREGTOTB                                                      
         BAS   RE,ENDCLR                                                        
         MVI   LINE,99                                                          
         B     ENDCB                                                            
         EJECT                                                                  
* END OF ESTIMATE                                                               
*                                                                               
ENDEST   DS    0H                                                               
         CLC   QDIST,=C'ALL'                                                    
         BNE   *+10                                                             
         XC    PDSTKEY,PDSTKEY                                                  
*                                                                               
         CLC   QREGION,=C'ALL'                                                  
         BNE   *+10                                                             
         XC    PREGKEY,PREGKEY                                                  
*                                                                               
         CLC   QPROG,=C'53'                                                     
         BE    ENDESTX                                                          
         LA    R4,MYSUMHD8+35                                                   
         MVC   0(12,R4),ESHD                                                    
         MVC   12(30,R4),IMHD                                                   
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   12(30,R4),PMHD      OUTDOOR - POSTING                            
         CLI   ESCOS,C'0'                                                       
         BE    *+10                                                             
         MVC   12(30,R4),OMHD                                                   
         GOTO1 AESSUM,DMCB,AESTTOT                                              
*                                                                               
         CLC   QPAY(6),SPACES      TEST COMMENT TO PRINT                        
         BNE   EE2                                                              
         CLC   PESTCOM,SPACES                                                   
         BNH   ENDEST0                                                          
EE2      DS    0H                                                               
         MVI   SPACING,3                                                        
         GOTO1 APRNT                                                            
         MVI   COMSW,C'S'                                                       
         GOTO1 ACOMPRT                                                          
*                                                                               
*                                                                               
ENDEST0  DS    0H                                                               
         CLI   ESCPBREC,C'0'                                                    
         BNE   ENDEST1                                                          
         CLC   QREGION,=C'ALL'                                                  
         BE    ENDEST1                                                          
         CLC   QDIST,=C'ALL'                                                    
         BNE   ENDEST1D                                                         
ENDEST1  DS    0H                                                               
*                                                                               
         LA    RE,ROWL/8                                                        
         LA    RF,GRDTOTS                                                       
ENDEST1A CP    0(8,RF),=P'0'                                                    
         BNE   ENDEST1B                                                         
         LA    RF,8(RF)                                                         
         BCT   RE,ENDEST1A                                                      
         B     ENDEST1D                                                         
*                                                                               
ENDEST1B MVC   WRITTOTS,GRDTOTS                                                 
         GOTO1 AWFMOD                                                           
*                                                                               
ENDEST1D DS    0H                                                               
*                                                                               
ENDEST2  DS    0H                                                               
*                                                                               
         MVC   0(12,R4),ESHD                                                    
         MVC   12(30,R4),BMHD                                                   
         GOTO1 AESSUM,DMCB,AESTTOTB                                             
*                                                                               
ENDESTX  L     R2,AESTTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,AESTTOTB                                                      
         BAS   RE,ENDCLR                                                        
         MVI   LINE,99                                                          
*                                                                               
*                                  66 ALWAYS GIVES SUMMARIES                    
ENDESTX2 DS    0H                                                               
         GOTO1 ABRDSUM                                                          
*                                                                               
         B     ENDCLTX                                                          
         EJECT                                                                  
* END OF PRODUCT                                                                
*                                                                               
ENDPRO   DS    0H                                                               
         L     RF,AJOBLST               CLEAR JOBLST                            
         XC    0(200,RF),0(RF)                                                  
         CLI   QPRODUCT,C' '                                                    
         BE    ENDPROX                                                          
         CLC   QEST,=C'ALL'                                                     
         BE    ENDPRO2                                                          
         L     R2,APRDTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,APRDTOTB                                                      
         BAS   RE,ENDCLR                                                        
         B     ENDEST                                                           
*                                                                               
ENDPRO2  LA    R4,MYSUMHD8+35                                                   
         MVC   0(12,R4),PRHD                                                    
         MVC   11(30,R4),IMHD                                                   
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   11(30,R4),PMHD      OUTDOOR - POSTING                            
         CLI   ESCOS,C'0'                                                       
         BE    *+10                                                             
         MVC   11(30,R4),OMHD                                                   
         XC    PESTKEY,PESTKEY                                                  
         GOTO1 AESSUM,DMCB,APRDTOT                                              
*                                                                               
*                                                                               
         MVC   0(12,R4),PRHD                                                    
         MVC   11(30,R4),BMHD                                                   
         GOTO1 (RF),(R1),APRDTOTB                                               
*                                                                               
         MVI   LINE,99                                                          
ENDPROX  L     R2,APRDTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,APRDTOTB                                                      
         BAS   RE,ENDCLR                                                        
         B     ENDCB                                                            
         EJECT                                                                  
* END OF DIVISION                                                               
*                                                                               
ENDDIV   CLC   QDIV,SPACES                                                      
         BE    ENDDIVX                                                          
         XC    PPRDKEY,PPRDKEY                                                  
         CLI   QPRODUCT,C' '                                                    
         BNE   ENDDIV2                                                          
         CLC   QEST,SPACES                                                      
         BE    ENDDIV2                                                          
*                                                                               
         L     R2,ADIVTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,ADIVTOTB                                                      
         BAS   RE,ENDCLR                                                        
         B     ENDEST                                                           
*                                                                               
ENDDIV2  DS    0H                                                               
*                                                                               
         B     ENDDIVX             SKIPPED FOR PP66                             
*                                                                               
         CLC   QPRODUCT,=C'ALL'                                                 
         BNE   ENDDIVX                                                          
         LA    R4,MYSUMHD8+35                                                   
         MVC   0(12,R4),DVHD                                                    
         MVC   12(30,R4),IMHD                                                   
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   12(30,R4),PMHD      OUTDOOR - POSTING                            
         CLI   ESCOS,C'0'                                                       
         BE    *+10                                                             
         MVC   12(30,R4),OMHD                                                   
         GOTO1 AESSUM,DMCB,ADIVTOT                                              
*                                                                               
*                                                                               
         MVC   0(12,R4),DVHD                                                    
         MVC   12(30,R4),BMHD                                                   
         GOTO1 (RF),(R1),ADIVTOTB                                               
*                                                                               
ENDDIVX  L     R2,ADIVTOT                                                       
         BAS   RE,ENDCLR                                                        
         L     R2,ADIVTOTB                                                      
         BAS   RE,ENDCLR                                                        
         MVI   LINE,99                                                          
         B     ENDCB                                                            
         EJECT                                                                  
* END OF CLIENT                                                                 
*                                                                               
ENDCLT   DS    0H                                                               
ENDCLT1  DS    0H                                                               
         CLC   QDIV,=C'ALL'                                                     
         BE    ENDCLT1A                                                         
         CLI   QDIV,C' '                                                        
         BNE   ENDESTX                                                          
ENDCLT1A DS    0H                                                               
         XC    PDIVKEY,PDIVKEY                                                  
         XC    PPRDKEY,PPRDKEY                                                  
*                                                                               
         CLC   QEST,=C'ALL'                                                     
         BNE   *+10                                                             
         XC    PESTKEY,PESTKEY                                                  
*                                                                               
         CLI   QPRODUCT,C' '                                                    
         BNE   ENDCLT1D                                                         
         CLC   QEST,SPACES                                                      
         BE    ENDCLT1D                                                         
         B     ENDEST                                                           
*                                                                               
ENDCLT1D DS    0H                                                               
         GOTO1 ABRDSUM       AGY SUMMARY ALSO PRODUCES RECAP                    
*                                                                               
ENDCLTX  DS    0H                                                               
         LA    R0,15                                                            
         LA    R3,APUBTOT                                                       
         L     R2,0(R3)                                                         
         BAS   RE,ENDCLR                                                        
         LA    R3,4(R3)                                                         
         BCT   R0,*-12                                                          
*                                                                               
         SPACE 2                                                                
ENDCB    DS    0H                                                               
         MVI   PRNTSW,0                                                         
         XMOD1 1                                                                
         SPACE 2                                                                
*                                                                               
ENDCLR   LA    RF,ACCN        NUMBER OF ACCUMS                                  
ENDCLR5  ZAP   0(8,R2),=P'0'                                                    
         LA    R2,8(R2)                                                         
         BCT   RF,ENDCLR5                                                       
         XC    0(40,R2),0(R2)      CLEAR SPARE                                  
         ZAP   32(8,R2),=P'0'     USED FOR BUDGETS                              
         BR    RE                                                               
*                                                                               
         SPACE 2                                                                
DSHD     DC    C'** DISTRICT '                                                  
RGHD     DC    C'** REGION   '                                                  
ESHD     DC    C'** REPORT   '                                                  
PRHD     DC    C'** PRODUCT  '                                                  
DVHD     DC    C'** DIVISION '                                                  
CLHD     DC    C'** CLIENT   '                                                  
IMHD     DC    C'INSERTION MONTH SUMMARY **    '                                
OMHD     DC    C'ON-SALE MONTH SUMMARY **      '                                
BMHD     DC    C'BILLING MONTH SUMMARY **      '                                
PMHD     DC    C'POSTING MONTH SUMMARY **      '                                
         SPACE 3                                                                
         LTORG                                                                  
         TITLE 'PP5202 - SET UP CONTRACT PRINT LINES'                           
BUYCON   CSECT                                                                  
         NMOD1 0,BUYCON                                                         
         USING PPWORKD,RA          RA=V(PPWORKC)                                
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9       R9=RC+4096                                   
         USING PP66WRKD,R8         R8=A(PP66WRKC)                               
*                                                                               
         L     R6,AKLINES          LINE 1                                       
         CLI   0(R6),0             FIND FIRST 0                                 
         BE    *+12                                                             
         LA    R6,30(R6)                                                        
         B     *-12                                                             
*                                                                               
* SEE IF CONTRACT EXISTS                                                        
*                                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(7),PBUYKEY     BUILD CON KEY                                
         MVC   WORK(2),PCLTAGYR                                                 
         CLI   PCLTPROF+5,C'2'                                                  
         BNE   *+10                                                             
         MVC   WORK+4(3),PCLTPROF+6  MASTER CLIENT                              
         MVI   WORK+3,X'10'                                                     
         MVC   WORK+7(6),PBUYKEY+10                                             
         CLC   WORK(13),PCONKEY                                                 
         BNE   BC4                                                              
         CLC   PCONSDT,PBUYKDAT                                                 
         BH    BC4                                                              
         CLC   PCONEDT,PBUYKDAT                                                 
         BNL   BC8                                                              
*                                                                               
BC4      DS    0H                  NO CONTRACT                                  
         CLI   CONSW,C'C'                                                       
         BNE   *+8                                                              
         BAS   RE,ENDCON                                                        
         CLI   QMEDIA,C'N'                                                      
         BE    BC5                                                              
         L     R6,AKLINES                                                       
         MVC   0(21,R6),=C'**** NO CONTRACT ****'                               
         B     BUYCONX                                                          
*                                                                               
BC5      LA    R2,PUBREC+33                                                     
         MVI   ELCODE,X'20'                                                     
         BAS   RE,BCNEXTEL                                                      
         BNE   BUYCONX                                                          
         USING PUBGENEL,R2                                                      
         CLI   PUBFLAT,C' '                                                     
         BNH   BUYCONX                                                          
         CLC   CONWRK(13),WORK     TEST ALREADY PRINTED FLAT/OPEN               
         BE    BUYCONX             YEA                                          
*                                  SET UP DUMMY CONTRACT                        
         MVI   CONSW,C'N'                                                       
         XC    CONWRK,CONWRK                                                    
         MVC   CONWRK(13),WORK     PART OF KEY                                  
         LA    R7,CONWRK                                                        
         MVC   PCONELEM-PCONREC(2,R7),=X'1025'                                  
         MVC   PCONSDT-PCONREC(6,R7),BSTART                                     
         MVC   PRBELEM-PCONREC(2,R7),=X'202A'                                   
         ZAP   PRBLEVEL-PCONREC(5,R7),=P'0'                                     
         CLI   PUBFLAT,C'F'                                                     
         BNE   *+8                                                              
         MVI   PRBIND-PCONREC(R7),X'01'                                         
         GOTO1 ARTLOOK,DMCB,0,PUBREC,CONWRK,ARTLKELS                            
*                                                                               
         L     RF,ARTLKELS                                                      
         CLI   0(RF),0           NO RATE ON FILE                                
         BNE   BC10                                                             
         MVC   0(4,R6),=C'FLAT'                                                 
         CLI   PUBFLAT,C'F'                                                     
         BE    *+10                                                             
         MVC   0(4,R6),=C'OPEN'                                                 
         B     BUYCONX                                                          
         DROP  R2                                                               
*                                                                               
BC8      DS    0H                                                               
*                                                                               
         CLI   CONSW,0                                                          
         BE    BC9                                                              
         CLC   CONWRK(25),PCONKEY  SAME CONTRACT                                
         BE    BUYCONXX            YES- DONE                                    
         BAS   RE,ENDCON                                                        
BC9      DS    0H                                                               
         MVI   CONSW,C'C'                                                       
         MVC   CONWRK(25),PCONKEY                                               
         MVC   0(8,R6),=C'CONTRACT'                                             
         MVC   HALF,PCONNUM                                                     
         LH    R0,HALF                                                          
         EDIT  (R0),(3,9(R6)),ALIGN=LEFT                                        
*                                                                               
         GOTO1 DTCNV,DMCB,(1,PCONSDT),(3,12(R6))                                
         GOTO1 (RF),(R1),(1,PCONEDT),(3,21(R6))                                 
         MVI   20(R6),C'-'                                                      
*                                                                               
         LA    R6,30(R6)           LINE 2                                       
* CHECK FOR RATELOOK REQUIRED                                                   
         LA    R2,PCONREC+33                                                    
         MVI   ELCODE,X'20'                                                     
         BAS   RE,BCNEXTEL                                                      
         BNE    BUYCON20                                                        
         LA    R7,PRBIND-PRBELEM(R2)                                            
         TM    0(R7),X'80'                                                      
         BO    BCRTX                                                            
         CLI   QMEDIA,C'N'                                                      
         BNE   BCRTX                                                            
* AWAY WE GO                                                                    
         GOTO1 ARTLOOK,DMCB,0,PUBREC,PCONREC,ARTLKELS                           
*                                                                               
BC10     DS    0H                                                               
         L     RF,ARTLKELS                                                      
         CLI   0(RF),0                                                          
         BE    BUYCON20                                                         
         CLI   0(R1),0                                                          
         BNE   BCRTX                                                            
         L     R2,ARTLKELS                                                      
*                                                                               
BCRTX    B     *+12                                                             
*                                                                               
BUYCON2  BAS   RE,BCNEXTEL                                                      
         BNE   BUYCON20                                                         
         CLI   QMEDIA,C'N'                                                      
         BE    BUYCON2B                                                         
         CLI   QPRODUCT,C' '                                                    
         BE    BUYCON2B                                                         
         LA    R4,PRBOPEN-PRBELEM(R2)                                           
         OC    0(3,R4),0(R4)                                                    
         BZ    BUYCON2B                                                         
         CLC   0(3,R4),PPRDKPRD    TEST RIGHT PRODUCT                           
         BNE   BUYCON2                                                          
BUYCON2B DS    0H                                                               
         LA    R4,PRBDATE-PRBELEM(R2)                                           
         OC    0(3,R4),0(R4)                                                    
         BZ    BUYCON4                                                          
         MVC   0(09,R6),=C'EFFECTIVE'                                           
         LA    R5,10(R6)                                                        
         CLI   ESCCONC,C'S'                                                     
         BNE   *+14                                                             
         MVC   0(14,R6),=C'RATE CHANGE - '                                      
         LA    R5,14(R6)                                                        
         GOTO1 DTCNV,DMCB,(1,(R4)),(3,(R5))                                     
         LA    R6,30(R6)                                                        
*                                                                               
BUYCON4  LA    R4,PRBLIND-PRBELEM(R2)                                           
         CLI   0(R4),C'S'                                                       
         BNE   *+12                                                             
         LA    R7,0(R6)            IF S, DONT PRINT ANYTHING                    
         B     BUYCON6A                                                         
         LA    R4,PRBLEVEL-PRBELEM(R2)                                          
         CP    0(L'PRBLEVEL,R4),=P'0'                                           
         BNZ   BUYCON5                                                          
         MVC   0(4,R6),=C'OPEN'                                                 
         LA    R4,PRBIND-PRBELEM(R2)                                            
         TM    0(R4),X'01'                                                      
         BZ    BUYCON6                                                          
         MVC   0(4,R6),=C'FLAT'                                                 
         B     BUYCON6                                                          
*                                                                               
* LEVEL NOT 0 SO DISPLAY IT                                                     
*                                                                               
BUYCON5  XC    WORK2,WORK2                                                      
         EDIT  (P5,(R4)),(10,WORK2),ALIGN=LEFT                                  
         LA    R4,PRBLIND-PRBELEM(R2)                                           
         CLI   0(R4),C'$'                                                       
         BNE   BUYCON5A                                                         
         MVI   0(R6),C'$'                                                       
         MVC   1(10,R6),WORK2                                                   
         B     BUYCON6                                                          
BUYCON5A LA    R7,WORK2                                                         
         AR    R7,R0               POINT PAST LAST CHAR                         
         MVC   0(1,R7),0(R4)       MOVE IND                                     
         MVC   0(10,R6),WORK2                                                   
*                                                                               
BUYCON6  LA    R7,12(R6)           FLOAT REST OF LINE                           
         BAS   RE,BCFLOAT                                                       
         LA    R7,2(R7)            START OF NEXT FIELD                          
*                                                                               
BUYCON6A LA    R4,PRBPCT-PRBELEM(R2)                                            
         CP    0(L'PRBPCT,R4),=P'0'                                             
         BZ    BUYCON8                                                          
         EDIT  (P3,(R4)),(5,(R7)),2,ALIGN=LEFT                                  
         AR    R7,R0                                                            
         SH    R7,=H'3'                                                         
         CLC   0(3,R7),=C'.00'                                                  
         BE    *+8                                                              
         LA    R7,3(R7)                                                         
         MVC   0(4,R7),=C' PCT'                                                 
         LA    R7,5(R7)                                                         
*                                                                               
BUYCON8  LA    R4,PRBRATE-PRBELEM(R2)                                           
         CLI   ESCCONC,C'S'        TEST SUPPRESS RATE/DATE                      
*                                                                               
         BE    BUYCON18            YES                                          
*                                                                               
         CP    0(L'PRBRATE,R4),=P'0'                                            
         BZ    BUYCON10                                                         
         CLI   QMEDIA,C'N'                                                      
         BE    BUYCON8A                                                         
         EDIT  (P5,(R4)),(10,(R7)),2,COMMAS=YES,ALIGN=LEFT,FLOAT=$              
*                                                                               
         LR    RF,R7                                                            
         AR    RF,R0                                                            
         SH    RF,=H'3'                                                         
         CLC   0(3,RF),=C'.00'                                                  
         BNE   *+10                                                             
         MVC   0(3,RF),SPACES                                                   
*                                                                               
         B     BUYCON10                                                         
BUYCON8A EDIT  (P5,(R4)),(10,(R7)),5,ALIGN=LEFT                                 
*                                                                               
         LR    RF,R7                                                            
         AR    RF,R0                                                            
         LR    RE,RF                                                            
         SH    RE,=H'3'                                                         
BUYCON8B DS    0H                                                               
         CLI   0(RF),C'0'                                                       
         BH    BUYCON8C                                                         
         MVI   0(RF),C' '                                                       
         BCTR  RF,R0                                                            
         CR    RF,RE                                                            
         BNL   BUYCON8B                                                         
BUYCON8C DS    0H                                                               
*                                                                               
BUYCON10 LA    R7,10(R7)                                                        
         BAS   RE,BCFLOAT                                                       
         LA    R7,2(R7)            NEXT SLOT IS +2                              
*                                                                               
         LA    R4,PRBDESC-PRBELEM(R2)  FILL REST OF LINE WITH DESC              
         CLI   0(R4),X'FF'         TEST FOR SPECIAL OUTDOOR FIELDS              
         BE    BUYCON12               YES                                       
         LR    RF,R7               SAVE R7                                      
         LA    R7,16(R4)                                                        
         BAS   RE,BCFLOAT                                                       
         SR    R7,R4                                                            
         LR    R0,R7               R0 = LENGTH OF DESC - 1                      
         LR    R7,RF               RESTORE R7                                   
         LA    RE,28(R6)                                                        
         SR    RE,R7               SET RE FOR EX MOVE                           
         CR    RE,R0                                                            
         BL    BUYCON11            WILL NOT FIT                                 
         CH    RE,=H'16'                                                        
         BNH   *+8                                                              
         LA    RE,16                                                            
         EX    RE,BUYCONMV                                                      
         B     BUYCON18                                                         
BUYCON11 DS    0H                                                               
         LA    R6,30(R6)                                                        
         MVC   0(17,R6),0(R4)      WHOLE DESC ON 2ND LINE                       
         B     BUYCON18                                                         
*                                                                               
BUYCON12 DS    0H                  SPECIAL OUTDOOR FIELDS                       
         MVC   WORK,SPACES                                                      
         GOTO1 AOUTER,DMCB,(1,(R4)),WORK,WORK+40                                
*                                                                               
         CLI   WORK+40,C' '                                                     
         BE    BUYCON13                                                         
         LA    R7,WORK+20                                                       
         BAS   RE,BCFLOAT                                                       
         MVI   1(R7),C'-'                                                       
         MVC   3(20,R7),WORK+40                                                 
BUYCON13 DS    0H                                                               
         MVC   0(30,R6),WORK                                                    
*                                                                               
*                                                                               
BUYCON18 DS    0H                                                               
         LR    RF,R6                                                            
         SH    RF,=H'30'                                                        
         CLC   0(30,RF),0(R6)      CHECK FOR LINE DUPLICATION                   
         BNE   BUYCON19                                                         
         XC    0(30,R6),0(R6)                                                   
         B     BUYCON2                                                          
BUYCON19 DS    0H                                                               
         SH    RF,=H'60'                                                        
         CLC   0(60,RF),60(RF)     CHECK FOR 2 LINE DUPLICATION                 
         BNE   BUYCN19B                                                         
         XC    60(60,RF),60(RF)                                                 
         SH    R6,=H'30'                                                        
         B     BUYCON2                                                          
BUYCN19B DS    0H                                                               
         CLI   0(R6),0                                                          
         BE    BUYCON2                                                          
         LA    R6,30(R6)           NEXT DISPLAY LINE                            
         B     BUYCON2                                                          
*                                                                               
BUYCON20 LA    R2,PCONREC+33                                                    
*                                                                               
BUYCON22 MVI   ELCODE,X'40'                                                     
         BAS   RE,BCNEXTEL                                                      
         BNE   BUYCONX                                                          
         CLC   2(2,R2),=C'E-'                                                   
         BE    BUYCON24                                                         
         CLC   2(2,R2),=C'E+'                                                   
         BNE   BUYCON22                                                         
BUYCON24 SR    RE,RE                                                            
         IC    RE,1(R2)                                                         
         SH    RE,=H'5'            CODE/LEN/E- +1 TO SET FOR EX                 
         BNP   BUYCON22                                                         
         LR    R7,R6                                                            
         LA    R4,4(R2)                                                         
         EX    RE,BUYCONMV                                                      
*                                                                               
         LA    R6,30(R6)           NEXT DISPLAY LINE                            
         B     BUYCON22                                                         
*                                                                               
* STORE PRINT LINES REQUIRED IN HOB OF ACURKLN                                  
*                                                                               
BUYCONX  L     RE,AKLINES                                                       
         SR    R0,R0               SET BCT COUNTER                              
         CLI   0(RE),0                                                          
         BE    *+12                                                             
         LA    RE,30(RE)                                                        
         BCT   R0,*-12                                                          
         LPR   R0,R0                                                            
         STC   R0,ACURKLN                                                       
*                                                                               
BUYCONXX DS    0H                                                               
         XMOD1 1                                                                
BUYCONMV MVC   0(0,R7),0(R4)       * EXECUTED *                                 
         EJECT                                                                  
BCFLOAT  CLI   0(R7),C' '                                                       
         BH    BCFLOATX                                                         
         BCT   R7,BCFLOAT                                                       
BCFLOATX BR    RE                                                               
         SPACE 2                                                                
BCNEXTEL SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    BCNXTELX                                                         
         CLC   ELCODE,0(R2)                                                     
         BCR   8,RE                                                             
         B     BCNEXTEL                                                         
BCNXTELX LTR   R2,R2                                                            
         BR    RE                                                               
         SPACE 3                                                                
ENDCON   DS    0H                  FINISH CONTRACT                              
         LR    R0,RE                                                            
         MVI   CONSW,0                                                          
ENDC1    DS    0H                                                               
         L     RE,ACURKLN          PRINT ANY REMAINING K LINES                  
         CLI   0(RE),0                                                          
         BE    ENDC2                                                            
         MVC   P+1(30),0(RE)                                                    
         LA    RE,30(RE)                                                        
         ST    RE,ACURKLN                                                       
         GOTO1 APRNT                                                            
*                                                                               
         B     ENDC1                                                            
ENDC2    DS    0H                                                               
         L     RE,AKLINES                                                       
         LA    RF,3600          120 X 30 COLS                                   
         XCEF                                                                   
         SPACE 2                                                                
         L     R6,AKLINES                                                       
         ST    R6,ACURKLN                                                       
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'PP5202 - ESSUM - PRINT MONTHLY SUMMARIES'                       
ESSUM    CSECT                                                                  
         NMOD1 0,ESSUM                                                          
         USING PPWORKD,RA          RA=V(PPWORKC)                                
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9       R9=RC+4096                                   
         USING PP66WRKD,R8         R8=A(PP66WRKC)                               
*                                                                               
*                                                                               
         MVI   SUMSW,C'I'          INSERT SUMMARY                               
         MVC   SUMSUMS,ESCSUMS                                                  
         CLC   0(4,R1),ADSTTOTB                                                 
         BL    *+14                                                             
         MVI   SUMSW,C'B'          BILL SUMMARY                                 
         MVC   SUMSUMS,ESCSUMSB                                                 
*                                 CLEAR QUARTER AND GRAND TOTALS                
         LA    R3,5               FOR BCT                                       
         LA    R4,QTRTOTS                                                       
ESSUA    ZAP   0(8,R4),=P'0'                                                    
         LA    R4,8(R4)                                                         
         BCT   R3,ESSUA                                                         
         LA    R3,5               FOR BCT                                       
         LA    R4,GRDTOTS                                                       
ESSUB    ZAP   0(8,R4),=P'0'                                                    
         LA    R4,8(R4)                                                         
         BCT   R3,ESSUB                                                         
*                                                                               
         L     R3,0(R1)            GET ACCUM ADDRESS                            
         ST    R3,ATOT             SAVE ADDR OF ACCUM                           
         LA    R4,ACCN                                                          
ESSUC    CP    0(8,R3),=P'0'                                                    
         BNE   ESSUF                                                            
         LA    R3,8(R3)                                                         
         BCT   R4,ESSUC                                                         
         B     ESSUMX          NO ACTIVITY                                      
*                                                                               
ESSUF    MVI   LINE,99                                                          
         MVI   SPACING,1                                                        
*                                                                               
*                                                                               
*                                                                               
         CLI   SUMSW,C'B'                                                       
         BE    ESSUM1                                                           
*********                                                                       
         B     ESSUM1     FOR BUDGET DATA FOR PP66                              
*********                                                                       
         CLI   ESCBUDG,0                                                        
         BE    ESSUM1                                                           
         GOTO1 AGETBUD                                                          
*                                                                               
*                                  SEE IF ANY BUDGET $                          
*                                  NOTE - BUDSW REMAINS SET FOR                 
*                                  RECAPS AND BRD SUMMARIES                     
         MVI   BUDSW,0                                                          
         OC    ACCL-8(4,R3),ACCL-8(R3)   TEST HAVE NON-MONTHLY                  
         BZ    *+12                                                             
         MVI   BUDSW,1             HAVE BUDGET $                                
         B     ESSUMA                                                           
*                                                                               
         LA    R4,ROWL                                                          
         LA    R5,ACCL-9(R3)                                                    
         OC    DBUD(4,R3),DBUD(R3)                                              
         BZ    *+12                                                             
         MVI   BUDSW,1             HAVE BUDGET $                                
         B     *+8                                                              
         BXLE  R3,R4,*-18                                                       
         L     R3,ATOT                                                          
*                                                                               
ESSUMA   DS    0H                                                               
         CLI   BUDSW,0             TEST BUDGET DATA                             
         BNE   *+10                YES                                          
         MVC   SUMSUMS,ESCSUMSB    NO- SUPRESS BUDGET COLS                      
ESSUM1   DS    0H                                                               
*                                                                               
         LA    R2,RMTAB                                                         
ESSUM2   LA    R4,5    FOR BCT                                                  
         LR    RE,R3                                                            
ESSUM2A  CP    0(8,RE),=P'0'                                                    
         BNE   ESSUM2B                                                          
         LA    RE,8(RE)                                                         
         BCT   R4,ESSUM2A                                                       
ESSUM2B  TM    ESCBUDG,X'01'            TEST MONTHLY BUDG                       
         BNZ   ESSUM2C                  YES - OK                                
         CP    ROWL-8(8,R3),=P'0'       NO - NEED OTHER DOLLARS                 
         BE    ESSUM2B                                                          
ESSUM2C  LA    R4,P+17                                                          
         GOTO1 DTCNV,DMCB,(1,(R2)),(5,(R4))                                     
         GOTO1 ASUMFMT,DMCB,(R3)                                                
*                                                                               
         BAS   RE,ESSUMPRT                                                      
*                                                                               
ESSUM2D  DS    0H                                                               
         LA    R0,ROWL/8        8 BYTES PER ACCUM                               
         LR    R4,R3                                                            
         LA    R5,QTRTOTS                                                       
ESSUM2E  DS    0H                                                               
         AP    0(8,R5),0(8,R4)                                                  
         LA    R5,8(R5)                                                         
         LA    R4,8(R4)                                                         
         BCT   R0,ESSUM2E                                                       
*                                                                               
*                                                                               
ESSUM4   DS    0H                                                               
         SR    R1,R1                                                            
         SR    R0,R0                                                            
         IC    R1,1(R2)                                                         
         LA    R1,1(R1)                                                         
         D     R0,=F'3'                                                         
         LTR   R0,R0                                                            
         BNZ   *+8                                                              
         LA    R0,3                                                             
         STC   R0,BYTE                                                          
         CLC   BYTE,ESCQTRS                                                     
         BE    ESQTR                                                            
         CLI   BYTE,1                                                           
         BNE   ESSUM6                                                           
         CLI   ESCQTRS,0                                                        
         BE    ESQTR                                                            
*                                                                               
*                                                                               
ESSUM6   LA    R2,2(R2)                                                         
         LA    R3,ROWL(R3)         NEXT ACCUM                                   
         OC    0(2,R2),0(R2)       TEST DONE                                    
         BNZ   ESSUM2                                                           
*                                                                               
         B     ESQTR                                                            
ESSUM6A  DS    0H                                                               
         BAS   RE,ESSUMPRT                                                      
         L     R3,ATOT                                                          
         CP    ACCL-8(8,R3),=P'0'                                               
         BE    ESSUM6C                                                          
         CP    GRDTOTS+32(8),=P'0'      TEST MONTHLY BUDGET DATA                
         BE    ESSUM6B                                                          
*                                                                               
         LA    R4,QTRTOTS                                                       
ESSUM6A5 ZAP   0(8,R4),=P'0'                                                    
         LA    R4,8(R4)                                                         
         BCT   R3,ESSUM6A5                                                      
         ZAP   QTRTOTS+32(8),ACCL-8(8,R3)                                       
         GOTO1 ASUMFMT,DMCB,QTRTOTS                                             
*                                                                               
         MVC   P+14(11),=C'NON-MONTHLY'                                         
         MVC   PSECOND+14(14),=C'AUTHORIZATIONS'                                
         MVI   SPACING,2                                                        
         BAS   RE,ESSUMPRT                                                      
*                                                                               
ESSUM6B  AP    GRDTOTS+32(8),ACCL-8(8,R3)                                       
*                                                                               
ESSUM6C  DS    0H                                                               
         MVC   P+17(8),=C'*TOTALS*'                                             
         GOTO1 ASUMFMT,DMCB,(1,GRDTOTS)                                         
         BAS   RE,ESSUMPRT                                                      
         CLI   SUMSW,C'B'                                                       
         BE    ESSUMX                                                           
         TM    ESCBUDG,X'02'       TEST YEARLY BUDGET OPT                       
         BZ    ESSUMX                                                           
         CP    GRDTOTS+32(8),=P'0'          NO BUDGET $ THERE                   
         BE    ESSUMX                                                           
*                                                                               
         BAS   RE,ESSUMPRT         SKIP A LINE                                  
         MVI   BYTE,1              GROSS                                        
         TM    ESCBUDG,X'80'                                                    
         BZ    *+8                                                              
         MVI   BYTE,2              NET                                          
         LA    R5,ESCSUMS          FIND RIGHT COLLUMN                           
         LA    R4,P+17                                                          
         LA    R0,5                                                             
ESSUM7   DS    0H                                                               
         CLC   BYTE,0(R5)                                                       
         BE    ESSUM8                                                           
         LA    R5,1(R5)                                                         
         LA    R4,15(R4)                                                        
         BCT   R0,ESSUM7                                                        
         B     ESSUMX              NO PLACE TO PUT BUDG                         
*                                                                               
ESSUM8   DS    0H                                                               
         MVC   0(15,R4),=C'LESS AUTHORIZED'                                     
         LA    R4,15(R4)                                                        
         MVC   SUMSUMS,=5X'FF'                                                  
         LA    R0,ESCSUMS                                                       
         SR    R5,R0                                                            
         LA    R5,SUMSUMS(R5)      POINT TO RIGHT COL                           
         MVI   0(R5),10            AUTH                                         
         GOTO1 ASUMFMT,DMCB,(1,GRDTOTS)                                         
*                                                                               
         LR    R7,R4                                                            
         CLI   0(R7),C' '                                                       
         BNE   *+12                                                             
         LA    R7,1(R7)                                                         
         B     *-12                                                             
         ST    R7,ATOT             ADDRESS OF 1ST NON-BLANK                     
         BAS   RE,ESSUMPRT                                                      
         MVI   0(R5),12            GROSS LESS AUTH                              
         TM    ESCBUDG,X'80'                                                    
         BZ    *+8                                                              
         MVI   0(R5),13            NET LESS AUTH                                
         GOTO1 ASUMFMT,DMCB,(1,GRDTOTS)                                         
*                                                                               
         MVI   SPACING,2                                                        
         LR    R7,R4                                                            
         BCTR  R7,R0                                                            
         CLI   1(R7),C' '                                                       
         BNE   *+12                                                             
         LA    R7,1(R7)                                                         
         B     *-12                                                             
         CLI   1(R7),C'-'                                                       
         BE    *+8                                                              
         MVI   0(R7),C'+'                                                       
         C     R7,ATOT                                                          
         BNH   *+8                                                              
         L     R7,ATOT                                                          
         MVC   132(17,R4),0(R4)    MOVE TO PSECOND                              
         MVC   P,SPACES                                                         
         LA    R4,14(R4)                                                        
         SR    R4,R7                                                            
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R7),DASHES      UNDERLINE                                    
         BAS   RE,ESSUMPRT                                                      
*                                                                               
ESSUMX   XMOD1 1                                                                
         EJECT                                                                  
ESQTR    CLI   ESCQTRS,0        TEST OPTION                                     
         BE    ESQTRX                                                           
         LA    R0,ROWL/8                                                        
         LA    R4,QTRTOTS                                                       
ESQTR3   CP    0(8,R4),=P'0'                                                    
         BNE   ESQTR5                                                           
         LA    R4,8(R4)                                                         
         BCT   R0,ESQTR3                                                        
         B     ESQTRX                                                           
*                                                                               
ESQTR5   MVC   P+17(8),=C'QTR TOTS'                                             
         GOTO1 ASUMFMT,DMCB,(1,QTRTOTS)                                         
         MVI   SPACING,2                                                        
         BAS   RE,ESSUMPRT                                                      
ESQTRX   LA    R0,ROWL/8                                                        
         LA    R4,QTRTOTS                                                       
         LA    R5,GRDTOTS                                                       
ESQTRX2  AP    0(8,R5),0(R4)                                                    
         LA    R5,8(R5)                                                         
         LA    R4,8(R4)                                                         
         BCT   R0,ESQTRX2                                                       
         LA    R0,ROWL/8                                                        
         LA    R4,QTRTOTS                                                       
ESQTRX5  ZAP   0(8,R4),=P'0'                                                    
         LA    R4,8(R4)                                                         
         BCT   R0,ESQTRX5                                                       
         CLI   0(R2),0                                                          
         BE    ESSUM6A                                                          
         B     ESSUM6                                                           
         SPACE 3                                                                
ESSUMPRT DS    0H                                                               
         LR    R0,RE                                                            
         MVC   HEAD8,MYSUMHD8                                                   
         MVC   HEAD9,SPACES                                                     
         MVC   HEAD10,MYSUMH10                                                  
         MVC   HEAD11,MYSUMH11                                                  
         MVC   HEAD12,MYSUMH12                                                  
         CLI   SUMSW,C'B'                                                       
         BE    ESSUMP2                                                          
         CLI   BUDSW,0             TEST BUDGET DATA                             
         BNE   ESSUMP3             YES                                          
*                                  SUPPRESS BUDGET COLLS                        
ESSUMP2  DS    0H                                                               
         MVC   HEAD10,MYSMBH10                                                  
         MVC   HEAD11,MYSMBH11                                                  
         MVC   HEAD12,MYSMBH12                                                  
ESSUMP3  DS    0H                                                               
         MVC   HEAD11+17(5),=C'MONTH'                                           
         MVC   HEAD12+17(5),=C'-----'                                           
         GOTO1 APRNT                                                            
*                                                                               
         LR    RE,R0                                                            
         BR    RE                                                               
         EJECT                                                                  
         LTORG                                                                  
         TITLE 'PP5202 - BRDSUM - PRINT BRAND SUMMARIES'                        
BRDSUM   CSECT                                                                  
         NMOD1 0,**BRDSUM                                                       
         USING PPWORKD,RA          RA=V(PPWORKC)                                
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9       R9=RC+4096                                   
         USING PP66WRKD,R8         R8=A(PP66WRKC)                               
*                                                                               
         LA    R3,ROWL/8          FOR BCT                                       
         LA    R4,QTRTOTS                                                       
BRDSUM1  ZAP   0(8,R4),=P'0'                                                    
         LA    R4,8(R4)                                                         
         BCT   R3,BRDSUM1                                                       
         LA    R3,ROWL/8          FOR BCT                                       
         LA    R4,GRDTOTS                                                       
BRDSUM1B ZAP   0(8,R4),=P'0'                                                    
         LA    R4,8(R4)                                                         
         BCT   R3,BRDSUM1B                                                      
*                                                                               
         MVI   LINE,99             FORCE PAGE                                   
         SPACE 2                                                                
* GET TABLES IN ALPHA SEQUENCE                                                  
         L     R3,ABRDT                                                         
         L     R5,ABRDTX                                                        
         BAS   RE,BRDSRT                                                        
         L     R3,ABRDTB                                                        
         L     R5,ABRDTBX                                                       
         BAS   RE,BRDSRT                                                        
BRDSUM2  DS    0H                                                               
         EJECT                                                                  
*                                                                               
BRDS0    DS    0H                                                               
         MVI   SUMSW,C'I'                                                       
         MVC   MYSUMHD8,SPACES                                                  
         LA    R4,MYSUMHD8+35                                                   
         MVC   0(36,R4),BRIMHD                                                  
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   0(36,R4),BRPMHD                                                  
         CLI   ESCOS,C'0'                                                       
         BE    *+10                                                             
         MVC   0(36,R4),BROMHD                                                  
         MVC   SUMSUMS,ESCSUMS                                                  
         CLI   BUDSW,0             TEST BUDGET DATA                             
         BNE   *+10                YES                                          
         MVC   SUMSUMS,ESCSUMSB    NO- SUPRESS BUDGET COLS                      
BRDS1    LA    R2,RMTAB                                                         
*                                                                               
         XC    IMDSPL(8),IMDSPL    CLEAR MONTH INDEX                            
BRDS2    L     R3,ABRDT                                                         
         LA    R4,ACCL                                                          
         L     R5,ABRDTX                                                        
         CLI   SUMSW,C'B'                                                       
         BNE   *+12                                                             
         L     R3,ABRDTB                                                        
         L     R5,ABRDTBX                                                       
*                                                                               
         GOTO1 DTCNV,DMCB,(1,(R2)),(5,P+4)                                      
*                                                                               
* TEST FOR ACTIVITY IN ANY AGY FOR THIS MONTH                                   
         A     R3,IMDSPL           POINT TO PROPER ACCUM                        
BRDS3    LA    RF,ROWL/8                                                        
         LR    RE,R3                                                            
BRDS3B   CP    0(8,RE),=P'0'                                                    
         BNE   BRDS4                                                            
         LA    RE,8(RE)                                                         
         BCT   RF,BRDS3B                                                        
         B     BRDS6                NO ACTIVITY                                 
BRDS4    TM    ESCBUDG,X'01'            TEST MONTHLY BUDG                       
         BNZ   BRDS5                    YES - OK                                
         LA    RF,ROWL/8            ELSE NEED NONE BUDGET ACTIVITY              
         SH    RF,=H'1'      DON'T CHK BUDGET ACTIVITY                          
         LR    RE,R3                                                            
BRDS4B   CP    0(8,RE),=P'0'                                                    
         BNE   BRDS5                                                            
         LA    RE,8(RE)                                                         
         BCT   RF,BRDS4B                                                        
         B     BRDS6                NO ACTIVITY                                 
*                                                                               
BRDS5    LR    R6,R3                                                            
         S     R6,IMDSPL                                                        
         MVC   P+16(13),ACCL-13(R6)         ASPO                                
         BAS   RE,BRDSFMT                                                       
*                                                                               
         OC    IMDSPL,IMDSPL       TEST FIRST TIME                              
         BZ    BRDS6               YES                                          
* ROLL TO BRD TOTAL AT 0(R6)                                                    
         AP    0(8,R6),0(8,R3)                                                  
         AP    8(8,R6),8(8,R3)                                                  
         AP    16(8,R6),16(8,R3)                                                
         AP    24(8,R6),24(8,R3)                                                
         AP    32(8,R6),32(8,R3)                                                
*                                                                               
BRDS6    BXLE  R3,R4,BRDS3         LOOP FOR EACH AGY                            
*                                                                               
BRDS10   MVC   P,SPACES                                                         
         MVC   P+16(7),=C'*TOTAL*'                                              
         BAS   RE,BRDSTOT          PRINT MONTH TOTAL (IF NON-ZERO)              
*                                                                               
         LA    R3,ROWL/8          FOR BCT                                       
         LA    RF,GRDTOTS                                                       
BRDS12   ZAP   0(8,RF),=P'0'                                                    
         LA    RF,8(RF)                                                         
         BCT   R3,BRDS12                                                        
*                                                                               
*                                                                               
         LA    R2,2(R2)                                                         
         OC    0(2,R2),0(R2)       TEST LAST MONTH                              
         BZ    BRDS15                                                           
         L     R1,IMDSPL           BUMP MONTH DISPLACEMENT                      
         LA    R1,ROWL(R1)                                                      
         ST    R1,IMDSPL                                                        
         B     BRDS2               DO NEXT MONTH                                
         SPACE 2                                                                
BRDS15   MVC   P,SPACES                                                         
         BAS   RE,BRDSPRT                                                       
*                                  NOW SEE IF ANY NON-MONTHLY                   
*                                  BUDG $ TO PRINT                              
         CLI   SUMSW,C'B'                                                       
         BE    BRDS20A                                                          
         CLI   BUDSW,0                                                          
         BE    BRDS20A                                                          
*                                                                               
         MVC   P+4(11),=C'NON-MONTHLY'                                          
         MVC   PSECOND+4(14),=C'AUTHORIZATIONS'                                 
         MVI   SPACING,2                                                        
*                                                                               
         L     R3,ABRDT                                                         
BRDS16   DS    0H                                                               
         OC    ACCL-13(5,R3),ACCL-13(R3)        TEST LAST                       
         BZ    BRDS19                                                           
*                                                                               
         CP    ACCL-8(8,R3),=P'0'                                               
         BE    BRDS18                                                           
         CP    32(8,R3),=P'0'                                                   
         BE    BRDS17                                                           
*                                                                               
         CLI   P+4,C' '                                                         
         BE    *+8                                                              
         BAS   RE,BRDSPRT                                                       
         MVC   P+16(13),ACCL-13(R3)                                             
         MVC   QTRTOTS,0(R3)                                                    
         ZAP   0(8,R3),=P'0'                                                    
         ZAP   8(8,R3),=P'0'                                                    
         ZAP   16(8,R3),=P'0'                                                   
         ZAP   24(8,R3),=P'0'                                                   
         ZAP   32(8,R3),ACCL-8(8,R3)                                            
         BAS   RE,BRDSFMT                                                       
         MVC   0(ROWL,R3),QTRTOTS                                               
*                                                                               
BRDS17   AP    32(8,R3),ACCL-8(8,R3)                                            
*                                                                               
BRDS18   BXLE  R3,R4,BRDS16                                                     
*                                                                               
BRDS19   DS    0H                                                               
         MVC   P+16(7),=C'*TOTAL*'                                              
         BAS   RE,BRDSTOT                                                       
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         LA    RF,ROWL/8                                                        
         LA    RE,GRDTOTS                                                       
BRDS19A  CP    0(8,RE),=P'0'                                                    
         BNE   BRDS19C                                                          
         LA    RE,8(RE)                                                         
         BCT   RF,BRDS19A                                                       
         B     BRDS20A                                                          
*                                                                               
BRDS19C  LA    RF,ROWL/8                                                        
         LA    RE,GRDTOTS                                                       
BRDS19F  ZAP   0(8,RE),=P'0'                                                    
         LA    RE,8(RE)                                                         
         BCT   RF,BRDS19F                                                       
         BAS   RE,BRDSPRT                                                       
*                                                                               
*                                                                               
BRDS20A  L     R3,ABRDT            NOW PRINT AGENCY TOTALS                      
         CLI   SUMSW,C'B'                                                       
         BNE   *+8                                                              
         L     R3,ABRDTB                                                        
*                                                                               
         MVC   P+04(5),=C'TOTALS'                                               
BRDS21   OC    ACCL-13(5,R3),ACCL-13(R3)       TEST LAST                        
         BZ    BRDS30                                                           
*                                                                               
         MVC   P+16(13),ACCL-13(R3)                                             
         BAS   RE,BRDSFMT                                                       
*                                                                               
         BXLE  R3,R4,BRDS21                                                     
*                                                                               
BRDS30   BAS   RE,BRDSPRT          SKIP A LINE                                  
*                                                                               
         MVC   P+10(13),=C'REPORT TOTALS'                                       
         BAS   RE,BRDSTOT                                                       
*                                                                               
         CLI   SUMSW,C'B'                                                       
         BE    BRDSX                                                            
         LA    RF,ROWL/8                                                        
         LA    RE,GRDTOTS                                                       
BRDS30F  ZAP   0(8,RE),=P'0'                                                    
         LA    RE,8(RE)                                                         
         BCT   RF,BRDS30F                                                       
         MVC   MYSUMHD8+35(36),BRBMHD                                           
         MVI   SUMSW,C'B'                                                       
         MVC   SUMSUMS,ESCSUMSB                                                 
         MVI   LINE,99                                                          
         B     BRDS1                                                            
*                                                                               
BRDSX    DS    0H                                                               
         CLI   ESCPBREC,C'0'                                                    
         BE    BRDSXX                                                           
         LA    RE,ROWL/8                                                        
         LA    RF,GRDTOTS                                                       
BRDSX3   CP    0(8,RF),=P'0'                                                    
         BNE   BRDSX5                                                           
         LA    RF,8(RF)                                                         
         BCT   RE,BRDSX3                                                        
         B     BRDSXX                                                           
*                                                                               
BRDSX5   MVC   WRITTOTS,GRDTOTS                                                 
         GOTO1 AWFMOD           PRINT RECAP                                     
*                                                                               
BRDSXX   L     R1,ABRDT                                                         
         BAS   RE,CLEARPK                                                       
         L     R1,ABRDTB                                                        
         BAS   RE,CLEARPK                                                       
*                                                                               
         MVI   LINE,99                                                          
         XMOD1 1                                                                
         EJECT                                                                  
*                                                                               
*                                                                               
CLEARPK  LA    R2,15           BIG BCT                                          
CLPK3    LA    R3,110          SMALL BCT                                        
         LR    R4,R1           SAVE R1                                          
CLPK5    ZAP   0(8,R1),=P'0'                                                    
         LA    R1,8(R1)                                                         
         BCT   R3,CLPK5                                                         
         LR    R1,R4                                                            
         LA    R1,ACCL(R1)                                                      
         BCT   R2,CLPK3                                                         
         BR    RE                                                               
*                                                                               
         EJECT                                                                  
* R3 POINTS TO GROSS/CSH DISC                                                   
BRDSFMT  ST    RE,SAVERE                                                        
         GOTO1 ASUMFMT,DMCB,(R3)                                                
*                                                                               
         LA    R1,ROWL/8                                                        
         LA    RF,GRDTOT                                                        
         LR    RE,R3                                                            
BRDSFMT2 AP    0(8,RF),0(8,RE)                                                  
         LA    RF,8(RF)                                                         
         LA    RE,8(RE)                                                         
         BCT   R1,BRDSFMT2                                                      
*                                                                               
         BAS   RE,BRDSPRT                                                       
         L     RE,SAVERE                                                        
         BR    RE                                                               
         SPACE 2                                                                
*                                                                               
BRDSTOT  DS    0H                                                               
         ST    RE,SAVERE                                                        
         LA    RE,ROWL/8                                                        
         LA    RF,GRDTOTS                                                       
BRDSTOT5 CP    0(8,RF),=P'0'                                                    
         BNE   BRDSTOT8                                                         
         LA    RF,8(RF)                                                         
         BCT   RE,BRDSTOT5                                                      
         B     BRDSTOTX                                                         
*                                                                               
BRDSTOT8 GOTO1 ASUMFMT,DMCB,(1,GRDTOTS)                                         
         MVI   SPACING,2                                                        
         BAS   RE,BRDSPRT                                                       
*                                                                               
BRDSTOTX MVC   P,SPACES                                                         
         L     RE,SAVERE                                                        
         BR    RE                                                               
         SPACE 2                                                                
         SPACE 2                                                                
BRDSPRT  DS    0H                                                               
*                                                                               
         MVC   HEAD8,MYSUMHD8                                                   
         MVC   HEAD9,SPACES                                                     
         MVC   HEAD10,MYSUMH10                                                  
         MVC   HEAD11,MYSUMH11                                                  
         MVC   HEAD12,MYSUMH12                                                  
*                                                                               
         CLI   SUMSW,C'B'                                                       
         BE    BRDSPRT2                                                         
         CLI   BUDSW,0             TEST BUDGET DATA                             
         BNE   BRDSPRT3            YES                                          
*                                  NO SUPPRESS BUDGET COLS                      
BRDSPRT2 DS    0H                                                               
         MVC   HEAD10,MYSMBH10                                                  
         MVC   HEAD11,MYSMBH11                                                  
         MVC   HEAD12,MYSMBH12                                                  
*                                                                               
BRDSPRT3 DS    0H                                                               
         MVC   HEAD11+04(5),=C'MONTH'                                           
         MVC   HEAD12+04(5),=C'-----'                                           
         MVC   HEAD11+16(6),=C'AGENCY'                                          
         MVC   HEAD12+16(6),=C'------'                                          
*                                                                               
         LR    R0,RE                                                            
         GOTO1 APRNT                                                            
*                                                                               
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
BRDSRT   DS    0H                                                               
         LR    R7,R3                                                            
         LA    R4,ACCL                                                          
         OC    ACCL-13(5,R3),ACCL-13(R3)        TEST LAST                       
         BZ    *+8                                                              
         BXLE  R3,R4,*-10                                                       
         SH    R3,=Y(ACCL+1)                                                    
         CR    R3,R7                                                            
         BNHR  RE                  ONE OR NONE                                  
         LR    R5,R3               R5 = A(LAST) -1                              
         LR    R3,R7                                                            
         LCR   R2,R4               R2 = COMPL OF LENGTH                         
         SR    R6,R6                                                            
BRDSRT2  CLC   ACCL-13(5,R3),ACCL*2-13(R3)                                      
         BNH   BRDSRT4                       NO EXCH                            
         XC    0(256,R3),ACCL(R3)                                               
         XC    256(256,R3),ACCL+256(R3)                                         
         XC    512(256,R3),ACCL+512(R3)                                         
         XC    768(ACCL-768,R3),ACCL+768(R3)                                    
         XC    ACCL(256,R3),0(R3)                                               
         XC    256+ACCL(256,R3),256(R3)                                         
         XC    512+ACCL(256,R3),512(R3)                                         
         XC    768+ACCL(ACCL-768,R3),768(R3)                                    
         XC    0(256,R3),ACCL(R3)                                               
         XC    256(256,R3),ACCL+256(R3)                                         
         XC    512(256,R3),ACCL+512(R3)                                         
         XC    768(ACCL-768,R3),ACCL+768(R3)                                    
         LA    R6,1                          EX SW                              
BRDSRT4  BXLE  R3,R4,BRDSRT2                 NEXT COMP                          
         BCTR  R6,RE                         EXIT IF NO EXCHS                   
         LR    R3,R7                         RESTORE START                      
         BXH   R5,R2,BRDSRT2                 SHORTEN AND DO NEXT PASS           
         BR    RE                                                               
         SPACE 3                                                                
BRIMHD   DC    C'** AGENCY INSERTION MONTH SUMMARY **'                          
BROMHD   DC    C'** AGENCY ON-SALE MONTH SUMMARY **  '                          
BRBMHD   DC    C'** AGENCY BILLING MONTH SUMMARY **  '                          
BRPMHD   DC    C'** AGENCY POSTING MONTH SUMMARY **  '                          
         SPACE 2                                                                
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'PP5202 - ESMONTHS - BUILD LIST OF REQUESTED MONTHS'             
         TITLE 'PP5202 - FORMAT SUMMARY LINES'                                  
SUMFMT   CSECT                                                                  
         NMOD1 0,SUMFMT                                                         
         SPACE 1                                                                
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
*                                                                               
         L     R3,0(R1)            R3 POINTS TO ACCUM                           
         MVC   BYTE,0(R1)          TOTAL SW                                     
SUMF2    DS    0H                                                               
         LA    R4,P+32                                                          
         LA    R5,SUMSUMS                                                       
         LA    R6,5                                                             
SUMF4    CLI   0(R5),0                                                          
         BE    SUMF6                                                            
         CLI   0(R5),X'FF'                                                      
         BE    SUMF4B                                                           
         SR    RF,RF                                                            
         IC    RF,0(R5)                                                         
         SLL   RF,2                X4                                           
         BAS   RE,SUMBRTAB-4(RF)                                                
SUMF4B   DS    0H                                                               
         LA    R4,15(R4)                                                        
         LA    R5,1(R5)                                                         
         BCT   R6,SUMF4                                                         
         B     SUMFX               NO ROOM FOR LINES                            
*                                                                               
SUMF6    TM    ESCLINS,X'02'       TEST LINES ON SUMS                           
         BZ    SUMFX                                                            
         ZAP   DUB,24(8,R3)                                                     
         CVB   R1,DUB                                                           
         TM    ESCLINS,X'20'       LINES VS INCHES                              
         BNZ   SUMF6A                                                           
         SR    R0,R0                                                            
         AH    R1,=H'7'                                                         
         D     R0,=F'14'           INCH = 14 LINES                              
SUMF6A   DS    0H                                                               
         EDIT  (R1),(14,1(R4)),COMMAS=YES                                       
         CLI   BYTE,1                                                           
         BNE   *+8                                                              
         MVI   15(R4),C'*'                                                      
SUMFX    XMOD1 1                                                                
*                                                                               
*                                                                               
SUMBRTAB DS    0H                                                               
         B     SUMGR                                                            
         B     SUMNT                                                            
         B     SUMCD                                                            
         B     SUMGLCD                                                          
         B     SUMNLCD                                                          
         B     SUMBNLCD            BILLED NET LESS CD                           
         DC    4X'00'                                                           
         DC    4X'00'                                                           
         DC    4X'00'                                                           
         B     SUMBUD                                                           
         B     SUMBUD                                                           
         B     SUMGLBD                                                          
         B     SUMNLBD                                                          
*                                                                               
SUMGR    ZAP   MYDUB,0(8,R3)                                                    
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMNT    ZAP   MYDUB,0(8,R3)       GROSS                                        
         SP    MYDUB,16(8,R3)      LESS AGY COM                                 
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMCD    ZAP   MYDUB,8(8,R3)       CD                                           
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMGLCD  ZAP   MYDUB,0(8,R3)       GROSS                                        
         SP    MYDUB,8(8,R3)       LESS CD                                      
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMNLCD  ZAP   MYDUB,0(8,R3)       GROSS                                        
         SP    MYDUB,8(8,R3)       LESS CD                                      
         SP    MYDUB,16(8,R3)      LESS AC                                      
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMBNLCD L     R0,16(R3)                                                        
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMBUD   ZAP   MYDUB,32(8,R3)      BUDGET                                       
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMGLBD  ZAP   MYDUB,0(8,R3)      GROSS                                         
         SP    MYDUB,32(8,R3)     LESS BUDGET                                   
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMNLBD  ZAP   MYDUB,0(8,R3)   GROSS                                            
         SP    MYDUB,16(8,R3)  LESS AGY COM                                     
         SP    MYDUB,32(8,R3)  LESS BUDGET                                      
         BAS   R7,SUMED                                                         
         BR    RE                                                               
*                                                                               
SUMED    CLI   BYTE,1                                                           
         BE    SUMED2                                                           
         CP    MYDUB,=P'0'                                                      
         BER   R7                                                               
SUMED2   DS    0H                                                               
         CLI   ESCCENTS,C'$'                                                    
         BNE   SUMED4                                                           
         EDIT  (P8,MYDUB),(14,1(R4)),0,COMMAS=YES FLOAT=-                       
         B     SUMED6                                                           
SUMED4   EDIT  (P8,MYDUB),(14,1(R4)),2,COMMAS=YES,FLOAT=-                       
SUMED6   CLI   BYTE,1                                                           
         BNER  R7                                                               
         MVI   15(R4),C'*'                                                      
         BR    R7                                                               
         SPACE 3                                                                
         LTORG                                                                  
*                                                                               
       ++INCLUDE PP66WRKN                                                       
*                                                                               
         PRINT OFF                                                              
*                                                                               
       ++INCLUDE PPWORKD                                                        
       ++INCLUDE PPNEWFILE                                                      
       ++INCLUDE PPMODEQU                                                       
*                                                                               
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'072PP6602BN  05/01/02'                                      
         END                                                                    

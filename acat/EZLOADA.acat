*          DATA SET EZLOADA    AT LEVEL 115 AS OF 08/24/00                      
*CATALP EZLOADA                                                                 
*INCLUDE QSORT                                                                  
*        TITLE 'EASI - TAPE TO WORKER FILE'                                     
***********************************************************************         
*                                                                     *         
*  REGISTER USAGE                                                     *         
*  R0 - OS & WORK                                                     *         
*  R1 - OS & WORK                                                     *         
*  R2 - WORK                                                          *         
*  R3 - WORK                                                          *         
*  R4 - WORK                                                          *         
*  R5 - WORK                                                          *         
*  R6 - WORK                                                          *         
*  R7 - WORK                                                          *         
*  R8 -               NOT USED                                        *         
*  R9 - SECOND BASE                                                   *         
*  RA - DPRINT                                                        *         
*  RB - FIRST BASE REG                                                *         
*  RC - EZLDWKD DSECT FROM NMOD CHAIN                                 *         
*  RD - STD REG SAVE CHAIN                                            *         
*  RE - OS & WORK                                                     *         
*  RF - OS & WORK                                                     *         
*                                                                     *         
***********************************************************************         
*                                                                     *         
* LEV 10    JAN24/90 ADD SOURCE CODE & PUT IN WRKRCOMMENT FIELD       *         
*                    AND NEW FIXED BLOCKED DCB - CT CLT/PRD/EST       *         
* LEV 11    JAN30/90 CHANGE CODE1/2 TO CODE                           *         
* LEV 12    FEB14/90 BOMB IF INVALID LENGTH OR UNKNOWN CODE FOUND     *         
*                    VALIDATE TOTAL RECORD IF FOUND                   *         
* LEV 13    FEB15/90 ADD ACCUM AND PRINT DOLLAR TOTALS                *         
* LEV 14    MAR02/90 ADD BAD BATCH TOTAL                              *         
* LEV 15    MAR07/90 ADD ERROR MSG FOR BAD CODE                       *         
* LEV 16    SEP10/90 FIX 3 CHAR STATION=+                             *         
* LEV 17    SEP25/90 FIX DATE =                                       *         
* LEV 18-19 NOV13/90 CHANGE TO ACCEPT END OF RECORD OK INSTEAD OF 15  *         
*                    LOOK FOR MINUS SIGN, ALLOW EMPTY 34 REC          *         
* LEV 20    FEB12/91 CHECK FOR VARIOUS MEDIAS                         *         
* LEV 21    APR04/91 SHOW TOTALS BY STATION AND AGENCY                *         
* LEV 22    JUL08/91 SUCCESS, RAN OVER REGISTER TOTALS MAX CAPACITY!  *         
* LEV 23    SEP16/91 FIX BAD STATION COMPARE                          *         
* LEV 24    SEP25/91 CK FOR NEW INVOICE DELETE FEATURE                *         
* LEV 25    NOV12/91 ACCUMULATE TOTAL BYTES PER LOAD TAPE             *         
* LEV 26    FEB05/92 ADD NETWORK CABLE AND SYNDICATION                *         
* LEV 27    MAR05/92 CHANGE MESSAGES FOR UNKNOWN & FIX TOTALS BUG     *         
* LEV 28    MAR09/92 MAKE MEDIA IN TOTALS TABLE AND BATCH AGREE       *         
* LEV 29    MAR09/92 PRINT TABLES BEFORE DUMP                         *         
* LEV 30    MAR10/92 ADD AGENCY TOTALS TABLE                          *         
* LEV 31    MAR19/92 ADD TO CORRECT AGENCY TOTALS TABLE               *         
* LEV 32    MAR31/92 FIX DUPE ENTRIES IN AGENCY TOTALS TABLE          *         
* LEV 33    AUG07/92 FIX OFFICE SEARCH, PUT UNKNOWN INDICATOR IN AGY  *         
*                     ADD MEDIA TOTALS TABLE                          *         
* LEV 34    OCT06/92 FIX STATION TABLE BUG                            *         
* LEV 35    OCT21/92 ALLOW IMBEDDED TOTAL RECS - CK TOTALS SO FAR     *         
* LEV 36    NOV16/92 FIX MEDIA TOTAL PRINTING                         *         
* LEV 37    FEB11/93 BIGGER DOLLAR COUNTER FOR MEDIA TOTALS           *         
* LEV 38    MAR16/93 CHGE STATION TABLE FROM 100 TO 300, PRT TOTAL STA*         
* LEV 39    MAR19/93 TREAT MEDIA S SAME AS MEDIA N & C                *         
* LEV 40    APR02/93 ADD CABLE HEAD - NET FIELD IN INVOICE HEADER     *         
* LEV 41    APR16/93 LOCAL CABLE STATION TO 4 DIGITS                  *         
* LEV 42    JUN22/93 FIX PRINT TEST IF NO SOURCE, IMBEDDED TOTALS BUG *         
*                    MAKE TOTFILES LARGER - FROM 256 TO 512           *         
* LEV 43    AUG06/93 CHANGE GROSS DOLLARS TO NET                      *         
* LEV 44    AUG19/93 ADD BILLING RECORD DCB, FIX SPOT COUNTS          *         
* LEV 45    AUG25/93 BYPASS ZERO LENGTH FIELDS                        *         
* LEV 46    OCT07/93 ADD LOCAL CABLE-MED T, SV AGY ADDR, MED IN TOT TB*         
* LEV 47    OCT19/93 FIX BILL FILE AGENCY/STATION ADDRESS BUG         *         
* LEV 48    OCT20/93 ADD UNKNOWN BATCH SAVE, REDO                     *         
* LEV 49    NOV01/93 TAKE OUT UNKNOWN BATCH, FORCE BDS CABLE TO SJR   *         
* LEV 50    DEC01/93 ADD UNKNOWN/FULL WORKER FILE HOLDER FILE         *         
*                    REQUIRE SOURCE PARAMETER CARD                    *         
* LEV 51    JAN19/94 FIX MEDIA X IN MEDBITAB                          *         
* LEV 52    MAR02/94 USE LABEL FOR 41 SCHEDULE LINE RECORD            *         
* LEV 53    APR07/94 SET UP SVMEDIA FIELD FOR RECAP TOTALS            *         
* LEV 54    MAY20/94 SAVE STD TOP/BOTTOM COMMENTS                     *         
* LEV 55    JUN06/94 NEW WRKF                                         *         
* LEV 56    MAR03/94 ADD DDSIO VCON FOR TEST DDSIO                    *         
*                    SET RETAIN TIME FOREVER, FIX DESCRIPTION         *         
* LEV 57-58 JUL25/95 FIX RECORD LENGTH/POSITION                       *         
* LEV 59    MAY18/96 FORCE ALL DATA TO UPPER CASE                     *         
*           CK FOR DUPE BATCH NUMBER ENTRIES                          *         
* LEV 60    JUL23/96 COMPRESS INV #'S OVER TEN, FORCE ALL UPPER CASE  *         
*                    FORCE 3 DIGIT STATIONS TO ZERO                   *         
* LEV 62    AUG02/96 CHANGE DUPSEQTB FROM 1000 ENTRIES TO 2000        *         
* LEV 63    OCT17/96 EDIT 5 DIGITS OF WORKER FILE SEQ                 *         
*                    SHOW WORKER FILE #                               *         
* LEV 64    NOV07/96 READ ADVNAME RECS TO DIVERT BATCHES              *         
* LEV 65    JAN23/97 ADD CODE TO CK DATAMGR CALLS                     *         
* LEV 66    MAR07/97 CHECK AGY ID EXCLSW=Y BEFORE STATION IN NEWIND   *         
* LEV 67    MAY13/97 FIX EXCLSW=Y                                     *         
* LEV 68    JUN16/97                                                  *         
*             NEED TO FIX BILLING, DONE AT ENDINV TIME, NO ADV LOOKUP *         
*              DONE YET, SAME WITH EZAGYCTB - ADDED TO WRONG AGY      *         
* LEV 69    OCT17/97 FIX SVADVNM                                      *         
* LEV 70    OCT21/97 FIX TOTALS                                       *         
* LEV 72    NOV26/97 FIX CKADV                                        *         
* LEV 73    DEC19/97 FORCE TODAYC FOR WRKF OPEN                       *         
* LEV 74    FEB23/98 FIX EXCLSW RESET, PUT OUT WRK CTS FOR TEST       *         
* LEV 75    MAR13/98 USE RFRECST IN CKADV                             *         
* LEV 76    APR09/98 FIX UNKNOWN BATCHES FROM HOLD FILE               *         
* LEV 77    APR14/98 FIX SVEXCLSW FOR 1 INVOICE LOAD ONLY, CLEAR      *         
*              ALL SAVED RECS AT EOF HOLD FILE                        *         
* LEV 78    JUN02/98 DROP BAD INV TOTALS COMPARE                      *         
* LEV 79    JUL01/98 FIX BAD TOTAL COMPARE                            *         
* LEV 80    JUL08/98 FIX CKADV - VARIABLE RECS                        *         
* LEV 81    AUG05/98 FIX HOLD 31 REC SAVE                             *         
* LEV 82    AUG28/98 FIX EXCLUDE STATION/AGENCY ID                    *         
* LEV 83    SEP09/98 NEW DMWRKF, BREAK BATCH ON MOS                   *         
* LEV 84    SEP15/98 LARGER DUPSEQTB - WAS 2000 ENTRIES, NOW 4000     *         
* LEV 85    SEP18/98 FIX SEQ CK                                       *         
* LEV 86    NOV05/98 CK BATCH TO BE ON FILE AFTER CLOSE & BEFORE OPEN *         
* LEV 87    NOV19/98 CHECK FILE IN ADDITION TO INDEX                  *         
* LEV 88    DEC29/98 FIX UNKNOWN DATE MS, STATION TABLE FROM 600-900  *         
* LEV 89    JAN22/99 FIX TOTALS (12 REC) FOR EVERY INVOICE            *         
* LEV 90    FEB10/99 USE BAND, AND NOT MEDIA FOR PRINTED REPORT       *         
* LEV 91 BG MAR23/99 MAX OF JUST OVER 3000 RECS PER BATCH             *         
*                    FIX UNKNOWNS THERE IS A AGYNAME REC, BUT NO MEDIA*         
*                    FORCE NUMERIC STA (CABLE HEAD) TO MEDIA T        *         
* LEV 92 BG APR19/99 CHANGE SVINDXTB FROM 26000 TO 64000              *         
* LEV 93 BG MAY14/99 MAX OF JUST OVER 2800 RECS PER BATCH             *         
* LEV 94 BG JUN30/99 FIX OFFICE ELEMENT SEARCH IN AGY REC             *         
* LEV 95 BG JUL16/99 BYPASS STRATA BUYS ON INVOICE INPUT              *         
* LEV 96 BG DEC17/99 SET UP ADVNAME TOP PRIORITY, THEN OFFICE, THEN   *         
*                    AGENCY                                           *         
* LEV 97 BG JAN03/00 MAX OF 2700 RECS PER BATCH, CK BYTES AS WELL     *         
* LEV 98 BG MAR22/00 IF RECFM = U, SCAN FOR NEXT REC                  *         
*                    CREATE MOS TOTALS                                *         
* LEV 99 BG APR10/00 IF SOURCE = WIM, FORCE TO WIBIS, FIX MOS TOTALS  *         
* LEV100 BG MAY04/00 ADD STA EQUIV BY ADVERTISER                      *         
* LEV101 BG JUN08/00 ADD STA EQUIV BY MULTI-ADVERTISER                *         
* LEV102    AUG09/00 REDIRECT PRINTER OUTPUT TO PQ REPORT W/ UID=SJR  *         
*                                                                     *         
***********************************************************************         
         TITLE 'EASI - TAPE TO WORKER FILE'                                     
EZLOAD   CSECT                                                                  
         ENTRY UTL                                                              
*                                                                               
         PRINT NOGEN                                                            
         NBASE EZLDWKL,**EZLD,=A(REGSAVE),R9                                    
         USING EZLDWKD,RC                                                       
         L     RA,=V(CPRINT)                                                    
         USING DPRINT,RA                                                        
         BRAS  RE,OPENPQ                                                        
         GOTO1 =A(INIT),DMCB,(RC)                                               
         SPACE                                                                  
         BE    EZREAD                                                           
         SPACE                                                                  
EOJ      GOTO1 =V(PRINT),DMCB,=C'CLOSE'                                         
         CLI   ABNDOPT,C'Y'                                                     
         BNE   *+6                                                              
         DC    H'0'                                                             
         XBASE                                                                  
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*              READ INPUT DATA SET                                              
         SPACE 2                                                                
EZREAD   DS    0H                                                               
         MVI   FDELIM,X'5E'        FIELD DELIMITER - SEMI COLON                 
         MVI   RDELIM,X'15'        RECORD DELIMITER - NEW LINE                  
         LA    RE,RFVALS                                                        
         LA    RF,RFVALSL                                                       
         XCEF                                                                   
*                                                                               
         L     RE,=A(EZOTREC)                                                   
         ST    RE,WRCURPOS                                                      
         ST    RE,WRECST                                                        
         LA    RF,EZOTRECL                                                      
         XCEF                                                                   
*                                                                               
EZR010   DS    0H                                                               
         GOTO1 =A(GETFLD),DMCB,(RC)                                             
         BAS   RE,TRCRET           TRACE GETFLD RETURNS                         
*                                                                               
         TM    RFCTL,RFCTLEOF      TEST EOFILE                                  
         BNZ   EZR090                                                           
*                                                                               
         TM    RFCTL,RFCTLEOR      TEST END OF A RECORD                         
         BZ    EZR014                                                           
         BAS   RE,ENDREC                                                        
         L     RE,=A(EZOTREC)                                                   
         ST    RE,WRCURPOS                                                      
         ST    RE,WRECST                                                        
         LA    RF,EZOTRECL                                                      
         XCEF                                                                   
         B     EZR010                                                           
*                                                                               
*                                  HANDLE FIELD                                 
*                                  ------------                                 
*        NOTE- THIS CODE INVOLVING RECORD TYPES AND                             
*              FIELD NUMBERS IS NOT EXACTLY SOFT                                
*                                                                               
*                                                                               
EZR014   DS    0H                                                               
         CLI   RFFLDNO,1           FLD 1 IS RECORD TYPE                         
         BNE   EZR030                                                           
         CLI   RFLEN,2             RECORD TYPE MUST BE 2 CHARS LONG             
         BE    EZR015                                                           
         CLC   SOURCE,=C'STRA'                                                  
         BNE   TYPLENER                                                         
         CLI   RFDATA+3,C'*'       THIS POSSIBLE STRATA BUY REC                 
         BNE   TYPLENER                                                         
         SPACE                                                                  
* CHECK FOR INTERMIXED STRATA BUY DATA GARBAGE                                  
         SPACE                                                                  
         CLC   =C'BUY',RFDATA                                                   
         BE    STRATAG              DROP IT                                     
         CLC   =C'DEM',RFDATA                                                   
         BE    STRATAG              DROP IT                                     
         CLC   =C'EOF',RFDATA                                                   
         BE    STRATAG              DROP IT                                     
         CLC   =C'HDR',RFDATA                                                   
         BE    STRATAG              DROP IT                                     
         CLC   =C'SKD',RFDATA                                                   
         BNE   TYPLENER                                                         
STRATAG  DS   0H                                                                
         OI    RFCTL2,RFCTL2RD     SET NEED READ NEXT REC                       
         B     EZR010                                                           
         SPACE                                                                  
EZR015   DS    0H                                                               
         LA    R0,TYPETLEN                                                      
         LA    R1,TYPETABL                                                      
EZR016   CLC   RFDATA(2),0(R1)                                                  
         BE    EZR018                                                           
         LA    R1,2(,R1)                                                        
         BCT   R0,EZR016                                                        
         DC    H'0'                                                             
         SPACE                                                                  
EZR018   MVC   RFRECST,RFFLDST     SET START OF RECORD                          
         MVC   RECTYP,RFDATA       SAVE RECORD TYPE                             
         EJECT                                                                  
         CLC   RECTYP,SCTRTYP      STANDARD TOP COMMENT                         
         BNE   EZR020                                                           
         SPACE                                                                  
* WILL READ AND SAVE UP TO 5 STD TOP COMMENTS                                   
* IF ANOTHER SET IS READ, THE SAVED ONES ARE CLEARED,                           
* AND THE NEW SET IS SAVED                                                      
         SPACE                                                                  
         TM    STDCMTSW,STDCMTOP   READING STD TOP COMMENTS                     
         BO    EZR010                                                           
         L     RE,=A(SAVSCT)                                                    
         LA    RF,SAVSCTLN         GET LENGTH                                   
         XCEF                                                                   
         OI    STDCMTSW,STDCMTOP   SET ON READING STD TOP COMMENTS              
         B     EZR010                                                           
*                                                                               
EZR020   DS    0H                                                               
         CLC   RECTYP,SCBRTYP      STANDARD BOTTOM COMMENT                      
         BNE   EZR021                                                           
         SPACE                                                                  
         TM    STDCMTSW,STDCMBOT   READING STD TOP COMMENTS                     
         BO    EZR010                                                           
         L     RE,=A(SAVSCB)                                                    
         LA    RF,SAVSCBLN         GET LENGTH                                   
         XCEF                                                                   
         OI    STDCMTSW,STDCMBOT   SET ON READING STD BOTTOM COMMENTS           
         B     EZR010                                                           
*                                                                               
EZR021   DS    0H                                                               
         NI    STDCMTSW,X'FF'-STDCMTOP-STDCMBOT  SET OFF STD COMMENT SW         
         SPACE                                                                  
         CLC   RECTYP,STARTYP      FOR STATION RECORD                           
         BNE   EZR022                                                           
         XC    STAFLDS,STAFLDS     CLEAR STATION FIELDS                         
         XC    STAFLDSA,STAFLDSA                                                
         B     EZR010                                                           
*                                                                               
EZR022   DS    0H                                                               
         CLC   RECTYP,AGYRTYP      FOR AGENCY RECORD                            
         BNE   EZR024                                                           
         XC    AGYFLDS,AGYFLDS     CLEAR AGENCY FIELDS                          
         B     EZR010                                                           
*                                                                               
EZR024   DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BNE   EZR029                                                           
         SPACE                                                                  
         BAS   RE,ENDINV           FINISH OLD INVOICE                           
         SPACE                                                                  
         MVC   SVUSID,USID        SAVE LAST ID                                  
         MVC   SVEXCLSW,EXCLSW    SAVE LAST EXCLUDE SW STATE                    
         SPACE                                                                  
         GOTO1 =A(GETUID),DMCB,(RC)                                             
         SPACE                                                                  
         CLI   EXCLSW,C'Y'         BAD BATCH                                    
         BE    EZR026                                                           
         CLI   EXCLSW,C'*'         UNKNOWN AGENCY                               
         BE    EZR026                                                           
         CLI   EXCLSW,C'I'         EXCLUDE USER ID                              
         BE    EZR026                                                           
         CLI   EXCLSW,C'S'         EXCLUDE STATION                              
         BE    EZR026                                                           
         SPACE                                                                  
*        SEE IF CHANGED ADVERT SHOULD FORCE NEW BAT *                           
         SPACE                                                                  
         GOTO1 =A(CKADV),DMCB,(RC)                                              
         SPACE                                                                  
EZR026   DS    0H                                                               
         CLC   SVUSID,USID         CHANGE FROM LAST ID                          
         BNE   EZR027                                                           
         SPACE                                                                  
         CLC   SVINVMOS,INVMOS     CHANGE OF MONTH OF SERVICE                   
         BNE   EZR027                                                           
         SPACE                                                                  
         CLC   STAFLDS,OLDSTA      TEST CHANGE OF STATION                       
         BNE   EZR027                                                           
         SPACE                                                                  
         CLI   NEWBATSW,C'Y'       FORCED NEW BATCH (READING HOLD FILE)         
         BE    EZR027               YES, CHANGED DATE OR SOURCE                 
         SPACE                                                                  
         CLC   BRECS,=F'2700'      NO MORE BIG BATCHES (BAT MOV PROB)           
         BH    EZR027               YES, BREAK IT UP                            
         SPACE                                                                  
         CP    BBYTS,=P'140000'    NO MORE BIG BATCHES (BAT MOV PROB)           
         BH    EZR027               YES, BREAK IT UP                            
         SPACE                                                                  
         CLC   AGYFLDS,OLDAGY      OR AGENCY                                    
         BE    EZR010                                                           
*                                                                               
EZR027   DS    0H                     NEW BATCH                                 
         MVI   NEWBATSW,C'N'          SET OFF AGAIN                             
         SPACE                                                                  
         GOTO1 =A(ENDBTCH),DMCB,(RC)  PROCESS END OF BATCH                      
         SPACE                                                                  
         GOTO1 =A(NEWIND),DMCB,(RC)   SET NEW WORKER INDEX AND PRINT            
         MVC   SVINVMOS,INVMOS     SAVE MONTH OF SERVICE                        
         B     EZR010                                                           
         SPACE                                                                  
EZR029   CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD                         
         BNE   EZR010                                                           
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BNZ   EZR010               OK                                          
         DC    H'0'                                                             
*                                                                               
EZR030   DS    0H                                                               
         CLI   RFFLDNO,2           TEST FIELD 2                                 
         BNE   EZR032                                                           
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR031                                                           
         MVC   STATION,RFDATA      SAVE STATION                                 
         SPACE                                                                  
         CLI   STATION+3,C' '      IF 3 CHAR STATION                            
         BNE   *+8                                                              
         MVI   STATION+3,0         FORCE TO NULL                                
         SPACE                                                                  
         BAS   RE,CKSTA            CK FOR LOCAL CABLE NUMERICS                  
         B     EZR010                                                           
*                                                                               
EZR031   DS    0H                                                               
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BNE   EZR031A                                                          
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         CVB   R0,DUB                                                           
         A     R0,TOTINVS          NOW ACCUMULATE TOTALS                        
         ST    R0,TOTINVS                                                       
         B     EZR010                                                           
*                                                                               
EZR031A  DS    0H                                                               
         CLC   RECTYP,SPTRTYP      THIS A SPOT DETAIL RECORD                    
         BNE   EZR031B                                                          
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         CLI   RFDATA,C'Y'         DID THIS SPOT RUN?                           
         BNE   EZR010               BYPASS                                      
         SPACE                                                                  
         L     RF,ISPTS            BUMP SPOT COUNT                              
         LA    RF,1(,RF)                                                        
         ST    RF,ISPTS                                                         
         B     EZR010                                                           
*                                                                               
EZR031B  DS    0H                                                               
         CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD                         
         BNE   EZR010                                                           
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BNE   *+6                  BIG PROBLEM                                 
         DC    H'0'                                                             
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BNZ   *+6                  OK                                          
         DC    H'0'                                                             
         CLC   SOURCE,RFDATA                                                    
         BE    EZR010                                                           
         SPACE                                                                  
         MVC   SOURCE,RFDATA                                                    
         B     EZR010                                                           
         SPACE                                                                  
*                                                                               
EZR032   DS    0H                                                               
         CLI   RFFLDNO,3           TEST FIELD 3                                 
         BNE   EZR040                                                           
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR034                                                           
         SPACE                                                                  
         CLI   STATION,C'0'        IF CABLE HEAD, FORCE TO TV                   
         BL    *+10                                                             
         MVC   RFDATA(2),=C'TV'                                                 
         SPACE                                                                  
         MVC   MEDIA,RFDATA        SAVE MEDIA                                   
         CLI   MEDIA,C'A'          IF AM, FORCE TO  RADIO                       
         BE    *+12                                                             
         CLI   MEDIA,C'F'          IF FM, FORCE TO  RADIO                       
         BNE   EZR010                                                           
         MVC   MEDIA,=C'R '                                                     
         B     EZR010                                                           
*                                                                               
EZR034   DS    0H                                                               
         CLC   RECTYP,AGYRTYP      TEST AGENCY RECORD                           
         BNE   EZR036                                                           
         MVC   AGYNAME,RFDATA      SAVE AGENCY NAME                             
         B     EZR010                                                           
*                                                                               
EZR036   DS    0H                                                               
         CLC   RECTYP,INTRTYP      TEST INVOICE TOTAL                           
         BNE   EZR038                                                           
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         BAS   RE,CKMINUS          CHECK FOR MINUS SIGN                         
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         SPACE                                                                  
         CLI   HOLDSIGN,C'-'       WAS THERE A MINUS                            
         BNE   *+8                  NO                                          
         XI    DUB+7,X'02'         FORCE TO MINUS VALUE                         
         SPACE                                                                  
         CVB   R0,DUB                                                           
         ST    R0,IDOLG                                                         
         B     EZR010                                                           
         SPACE                                                                  
EZR038   DS    0H                                                               
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BNE   EZR039                                                           
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         AP    TOTDOLS,DUB                                                      
         B     EZR010                                                           
         SPACE                                                                  
EZR039   CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD                         
         BNE   EZR010                                                           
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BNE   *+6                  BIG PROBLEM                                 
         DC    H'0'                                                             
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BNZ   *+6                  OK                                          
         DC    H'0'                                                             
         CLC   HOLDDATE,RFDATA     DIFFERENT DATE?                              
         BE    EZR010                                                           
         SPACE                                                                  
         MVI   NEWBATSW,C'Y'       FORCE NEW BATCH                              
         MVC   HOLDDATE,RFDATA     SAVE ORIGINAL DATE                           
         B     EZR010                                                           
         SPACE                                                                  
*                                                                               
EZR040   DS    0H                                                               
         CLI   RFFLDNO,4           TEST FIELD 4                                 
         BNE   EZR050                                                           
         CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR042                                                           
         SPACE                                                                  
         CLI   STATION,C'0'        IF CABLE HEAD, FORCE TO TV                   
         BL    *+10                                                             
         MVC   RFDATA(2),=C'TV'                                                 
         SPACE                                                                  
         MVC   BAND,RFDATA         SAVE BAND                                    
         B     EZR010                                                           
*                                                                               
EZR042   DS    0H                                                               
         CLC   RECTYP,AGYRTYP      TEST AGENCY RECORD                           
         BNE   EZR044                                                           
         MVC   AGYLIN1,RFDATA      SAVE AGENCY ADDR 1                           
         B     EZR010                                                           
*                                                                               
EZR044   DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE RECORD                          
         BNE   EZR010                                                           
         MVC   ADVNAM,RFDATA       SAVE ADVERTISER NAME                         
         B     EZR010                                                           
*                                                                               
EZR050   DS    0H                                                               
         CLI   RFFLDNO,5           FIELD 5                                      
         BNE   EZR056                                                           
         CLC   RECTYP,AGYRTYP      AGENCY RECORD                                
         BNE   EZR052                                                           
         MVC   AGYLIN2,RFDATA      SAVE AGENCY ADDR 2                           
         B     EZR010                                                           
*                                                                               
EZR052   DS    0H                                                               
         CLC   RECTYP,INVRTYP      INVOICE RECORD                               
         BNE   EZR054                                                           
         MVC   PRDNAM,RFDATA       SAVE PRODUCT NAME                            
         B     EZR010                                                           
         SPACE                                                                  
EZR054   DS    0H                                                               
         CLC   RECTYP,INTRTYP      TEST INVOICE TOTAL                           
         BNE   EZR055                                                           
         SPACE                                                                  
         CLI   RFLEN,0             IF NO INPUT                                  
         BE    EZR010               BYPASS                                      
         SPACE                                                                  
         BAS   RE,CKMINUS          CHECK FOR MINUS SIGN                         
         SPACE                                                                  
         ZIC   RF,RFLEN                                                         
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,RFDATA(0)                                                    
         SPACE                                                                  
         CLI   HOLDSIGN,C'-'       WAS THERE A MINUS                            
         BNE   *+8                  NO                                          
         XI    DUB+7,X'02'         FORCE TO MINUS VALUE                         
         SPACE                                                                  
         CVB   R0,DUB                                                           
         ST    R0,IDOLN                                                         
         B     EZR010                                                           
         SPACE                                                                  
EZR055   CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STANAME,RFDATA      SAVE STATION NAME                            
         B     EZR010                                                           
         SPACE                                                                  
EZR056   DS    0H                                                               
         CLI   RFFLDNO,6           FIELD 6                                      
         BNE   EZR058                                                           
         CLC   RECTYP,AGYRTYP      AGENCY RECORD                                
         BNE   EZR057                                                           
         MVC   AGYLIN3,RFDATA      SAVE AGENCY ADDR 3                           
         B     EZR010                                                           
         SPACE                                                                  
EZR057   CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN1,RFDATA      SAVE STATION ADDR LINE 1                     
         B     EZR010                                                           
*                                                                               
EZR058   DS    0H                                                               
         CLI   RFFLDNO,7           FIELD 7                                      
         BNE   EZR060                                                           
         CLC   RECTYP,AGYRTYP      AGENCY RECORD                                
         BNE   EZR059                                                           
         MVC   AGYLIN4,RFDATA      SAVE AGENCY ADDR 4                           
         B     EZR010                                                           
         SPACE                                                                  
EZR059   CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN2,RFDATA      SAVE STATION ADDR LINE 2                     
         B     EZR010                                                           
*                                                                               
EZR060   DS    0H                                                               
         CLI   RFFLDNO,8           FIELD 8                                      
         BNE   EZR064                                                           
         CLC   RECTYP,INVRTYP      INVOICE RECORD                               
         BNE   EZR062                                                           
         MVC   ESTNO,RFDATA        SAVE ESTIMATE NUMBER                         
         B     EZR010                                                           
         SPACE                                                                  
EZR062   CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN3,RFDATA      SAVE STATION ADDR LINE 3                     
         B     EZR010                                                           
*                                                                               
EZR064   DS    0H                                                               
         CLI   RFFLDNO,9           FIELD 9                                      
         BNE   EZR066                                                           
         CLC   RECTYP,INVRTYP      INVOICE HEADER RECORD                        
         BNE   EZR065                                                           
         MVC   INVNO,RFDATA        SAVE INVOICE NUMBER                          
         SPACE                                                                  
         CLI   RFLEN,11            IS INVOICE NUMBER TOO LONG                   
         BL    EZR010               NO, JUST FINE                               
         BAS   RE,FIXINVNO                                                      
         B     EZR010                                                           
         SPACE                                                                  
EZR065   CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STALIN4,RFDATA      SAVE STATION ADDR LINE 4                     
         B     EZR010                                                           
*                                                                               
EZR066   DS    0H                                                               
         CLI   RFFLDNO,10          FIELD 10                                     
         BNE   EZR068                                                           
         CLC   RECTYP,INVRTYP      INVOICE HEADER RECORD                        
         BNE   EZR067                                                           
         MVC   INVMOS,RFDATA       SAVE MONTH OF SERVICE                        
         B     EZR010                                                           
EZR067   CLC   RECTYP,STARTYP      TEST STATION RECORD                          
         BNE   EZR010                                                           
         MVC   STACSYS,RFDATA      SAVE STATION COMPUTER SYSTEM                 
         B     EZR010                                                           
*                                                                               
EZR068   DS    0H                                                               
         CLI   RFFLDNO,17          FIELD 17                                     
         BNE   EZR070                                                           
         CLC   RECTYP,INVRTYP      INVOICE HEADER RECORD                        
         BNE   EZR010                                                           
         CLC   =C'BILLING INVOICE REVERSAL',RFDATA  THIS DELETE PRE INV         
         BNE   EZR010                                NO                         
         MVI   INVDEL,C'Y'         SET AS DELETE PREV INV                       
         L     RF,TDELINV          BUMP DEL PREV INVOICE COUNT                  
         LA    RF,1(,RF)                                                        
         ST    RF,TDELINV                                                       
         B     EZR010                                                           
*                                                                               
EZR070   DS    0H                                                               
         CLI   RFFLDNO,25          FIELD 25                                     
         BNE   EZR074                                                           
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BNE   EZR010                                                           
         MVC   ADVCD,RFDATA        SAVE INTERNAL ADVERTISER CODE                
         B     EZR010                                                           
*                                                                               
EZR074   DS    0H                                                               
         CLI   RFFLDNO,27          FIELD 27                                     
         BNE   EZR076                                                           
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BNE   EZR010                                                           
         MVC   PRDCD,RFDATA        SAVE INTERNAL PRODUCT CODE                   
         B     EZR010                                                           
*                                                                               
EZR076   DS    0H                                                               
         CLI   RFFLDNO,31          FIELD 31                                     
         BNE   EZR080                                                           
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BNE   EZR010                                                           
         MVC   STANET,RFDATA       SAVE CABLE HEAD NETWORK                      
         B     EZR010                                                           
*                                                                               
EZR080   DS    0H                                                               
         CLI   RFFLDNO,35          FIELD 34 MAX EXPECTED                        
         BL    EZR010                                                           
         DC    H'0'                                                             
         EJECT                                                                  
* END OF INPUT EZHOLDR FILE, THEN EASI TAPE *                                   
         SPACE                                                                  
EZR090   DS    0H                  EOFILE                                       
         SPACE                                                                  
* PUT CHECK HERE FOR EZHOLD FILE, IF SO CLOSE IT,                               
* RESET SOURCE, AND START READING AEZINPT                                       
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       ARE WE WORKING ON HOLD FILE                  
         BZ    EZR096                                                           
         MVC   SOURCE,SVSRCE                                                    
         XC    SVSRCE,SVSRCE       ZERO OUT SOURCE                              
         XC    HOLDDATE,HOLDDATE        AND DATE                                
         XC    OLDSTA,OLDSTA       FORCE CHANGE OF STATION                      
         XC    OLDAGY,OLDAGY       AND AGENCY                                   
         SPACE                                                                  
         L     R2,=A(EZHOLDR)                                                   
         CLOSE ((R2),)                                                          
         SPACE                                                                  
         NI    RFCTL2,X'FF'-RFCTL2EF     SET OFF DO EOFILE AFTER                
         NI    RFCTL,X'FF'-RFCTLEOF      SET OFF EOFILE                         
         OI    SVRECSW,SVRECSRC          SET NEED TO SAVE SOURCE & DATE         
         B     EZREAD                                                           
         SPACE                                                                  
EZR096   DS    0H                  EOFILE                                       
         BAS   RE,ENDINV           FINISH ANY OLD INVOICE                       
         SPACE                                                                  
         SPACE                                                                  
         MVC   SVUSID,USID        SAVE LAST ID                                  
         MVC   SVEXCLSW,EXCLSW    SAVE LAST EXCLUDE SW STATE                    
         SPACE                                                                  
         GOTO1 =A(ENDBTCH),DMCB,(RC)  PROCESS END OF BATCH                      
         SPACE                                                                  
         L     R2,AEZINPT                                                       
         CLOSE ((R2),)                                                          
         SPACE                                                                  
         MVC   LINE,=PL2'200'      FORCE NEW PAGE                               
         SPACE                                                                  
         SR    R2,R2                                                            
         CLI   TEST,C'Y'           THIS A TEST RUN                              
         BE    EZR110                                                           
         SPACE                                                                  
         L     R2,=A(EZBILLF)                                                   
         CLOSE ((R2),)                                                          
         SPACE                                                                  
         L     R2,=A(EZWORKW)                                                   
         CLOSE ((R2),)                                                          
         FREEPOOL (R2)                                                          
         SPACE                                                                  
         SR    R2,R2                                                            
         LM    R3,R4,=A(EZWORKR,EZHOLDW)                                        
         SPACE                                                                  
         OPEN  ((R3),(INPUT))                                                   
         LTR   RF,RF               WAS OPEN GOOD                                
         BZ    *+6                                                              
         DC    H'0'                                                             
         OPEN  ((R4),(OUTPUT))                                                  
         LTR   RF,RF               WAS OPEN GOOD                                
         BZ    *+6                                                              
         DC    H'0'                                                             
         L     R5,=A(EZINREC)                                                   
         XC    0(256,R5),0(R5)                                                  
*                                                                               
EZR100   DS   0H                                                                
         GET   (R3),(R5)                                                        
         SPACE                                                                  
         LA    R2,1(,R2)                                                        
         SPACE                                                                  
         CLI   TRACEHLD,C'Y'                                                    
         BNE   EZR104                                                           
         CVD   R2,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R5)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'H'                                                        
         MVC   P+16(80),4(R5)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR104   DS   0H                                                                
         PUT   (R4),(R5)                                                        
         XC    0(256,R5),0(R5)                                                  
         B     EZR100                                                           
         SPACE                                                                  
EOFWORK  DS    0H                                                               
         CLOSE ((R3),)                                                          
         SPACE                                                                  
         LTR   R2,R2               ANY HOLD RECS                                
         BZ    EZR108               NO                                          
         SPACE                                                                  
* WRITE OUT '12' TOTALS RECORD FOR CONTENTS OF HOLD FILE *                      
         SPACE                                                                  
         XC    0(256,R5),0(R5)                                                  
         MVI   1(R5),26                                                         
         MVC   4(3,R5),=X'F1F25E'                                               
         SPACE                                                                  
         L     RF,HOINVS                                                        
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  7(5,R5),DUB                                                      
         MVI   12(R5),X'5E'                                                     
         SPACE                                                                  
         OI    HODOLG+7,X'0F'                                                   
         UNPK  13(11,R5),HODOLG                                                 
         MVC   24(2,R5),=X'5E15'                                                
         SPACE                                                                  
         CLI   TRACEHLD,C'Y'                                                    
         BNE   EZR106                                                           
         LA    RF,1(,R2)                                                        
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R5)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'H'                                                        
         MVC   P+16(80),4(R5)                                                   
         OC    P+16(80),SPACES                                                  
         SPACE                                                                  
EZR106   DS   0H                                                                
         PUT   (R4),(R5)                                                        
         SPACE                                                                  
EZR108   DS   0H                                                                
         CLOSE ((R4),)                                                          
         SPACE                                                                  
         L     R1,WORKCT                                                        
         A     R1,WORKCT9                                                       
         CR    R2,R1                                                            
         BE    *+6                                                              
         DC    H'0'                                                             
EZR110   DS   0H                                                                
         GOTO1 =A(RUNTOT),DMCB,(RC)                                             
         SPACE                                                                  
         B     EOJ                                                              
         EJECT                                                                  
* CHECK STATION FOR NUMERICS, AND IF SO, FORCE TO 4 DIGITS                      
         SPACE                                                                  
         DS    0H                                                               
CKSTA    NTR1                                                                   
         CLI   RFDATA,4            IF ALREADY 4 CHARACTERS, DONE                
         BE    EXIT                                                             
         SPACE                                                                  
         ZIC   R0,RFLEN                                                         
         LA    R1,RFDATA                                                        
CKSTA10  CLI   0(R1),C'0'          SEE IF ALL NUMERIC                           
         BL    EXIT                 NO, GET OUT                                 
         LA    R1,1(,R1)                                                        
         BCT   R0,CKSTA10                                                       
         SPACE                                                                  
         MVC   STATION,=C'0000'    PRE FILL ZEROS                               
         ZIC   RF,RFLEN                                                         
         LA    RE,RFDATA-1(RF)     START FROM END OF FIELD                      
         SPACE                                                                  
         CLI   RFLEN,4             CAN'T MOVE MORE THAN 4                       
         BNH   *+8                                                              
         LA    RF,4                                                             
         SPACE                                                                  
         LA    R1,STATION+3        ALSO START FROM END                          
CKSTA20  MVC   0(1,R1),0(RE)                                                    
         BCTR  R1,0                                                             
         BCTR  RE,0                                                             
         BCT   RF,CKSTA20                                                       
         B     EXIT                                                             
         EJECT                                                                  
*          DATA SET EZLOAD     AT LEVEL 059 AS OF 07/02/96                      
* INVOICE # IS MORE THAN 10 BYTES, REMOVE ANY BLANKS/ SPEC CHAR                 
* AND REFORMAT 31 (INV HDR) RECORD                                              
         SPACE                                                                  
FIXINVNO NTR1                                                                   
         ZIC   R0,RFLEN                                                         
         LA    R1,RFDATA                                                        
         LA    RE,WORK                                                          
         SR    RF,RF                                                            
         XC    WORK,WORK                                                        
FXI010   CLI   0(R1),C' '          DROP SPACES                                  
         BE    FXI020                                                           
         CLI   0(R1),C'-'          AND DASHES                                   
         BE    FXI020                                                           
         MVC   0(1,RE),0(R1)                                                    
         LA    RE,1(,RE)                                                        
         LA    RF,1(,RF)           ADD TO COUNT                                 
         SPACE                                                                  
FXI020   LA    R1,1(,R1)                                                        
         BCT   R0,FXI010                                                        
         SPACE                                                                  
         STC   RF,BYTE             STORE NEW LEN                                
         SPACE                                                                  
         CLI   BYTE,10             THIS GET IT UNDER 10                         
         BH    EXIT                 NO, CAN'T FIX IT                            
         SPACE                                                                  
         STC   RF,RFLEN                                                         
         MVC   OLDINVNO,RFDATA                                                  
         MVC   INVNO,WORK                                                       
         XC    RFDATA,RFDATA                                                    
         MVC   RFDATA(L'WORK),WORK                                              
         SPACE                                                                  
         L     R2,WRCURPOS                                                      
         LH    R1,WLEN                                                          
         SR    R2,R1                                                            
         EX    R1,*+8                                                           
         B     *+10                                                             
         XC    0(0,R2),0(R2)       CLEAR INV NO + 1                             
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),WORK        MOVE IN SHORTER INV NO                       
         SPACE                                                                  
         LA    R6,1(R2,RF)                                                      
         MVC   0(L'FDELIM,R6),FDELIM                                            
         LA    RF,L'FDELIM+1(,RF)      ADD LENGTH                               
         LA    R2,0(R2,RF)                                                      
         STH   RF,WLEN               SET WORK FIELD LENGTH                      
         ST    R2,WRCURPOS                                                      
         B     EXIT                                                             
         EJECT                                                                  
*        ENDREC - ROUTINE AT END OF RECORD                                      
*                                                                               
         DS    0H                                                               
ENDREC   NTR1                                                                   
         L     RF,WRCURPOS         CURRENT POS                                  
         S     RF,WRECST           LESS REC START                               
         BNP   ENDRX               = RECORD LENGTH (SKIP IF NONE)               
         ST    RF,RECLEN                                                        
*                                                                               
         BAS   RE,SAVREC           SAVE SOME RECORDS                            
         CLI   SAVSW,C'Y'          IF SAVED THIS REC, DONE                      
         BE    ENDRX                YES                                         
*                                                                               
*                                  ELSE WRITE TO FILE                           
*                                                                               
         BAS   RE,PUTSAV           DO SAVED RECORDS FIRST                       
         SPACE                                                                  
         CLI   SAVSW,C'Y'          IF SAVED THIS REC, DONE                      
         BE    ENDRX                DON'T PUT IT TO WORKER FILE                 
         SPACE                                                                  
         L     R1,WKRREC           THEN THIS ONE                                
         BAS   RE,SAVRN            MOVE TO RECORD AREA                          
         BAS   RE,INVPROC          HANDLE INVOICE HEADER REC                    
         SPACE                                                                  
         CLC   RECTYP,TRTOTYP      TEST TRANSMISSION TOTAL REC                  
         BE    ENDRX                DON'T PUT IT TO WORKER FILE                 
         SPACE                                                                  
         BAS   RE,ADDWKR                                                        
*                                                                               
ENDRX    DS    0H                                                               
         B     EXIT                                                             
         EJECT                                                                  
*        SAVREC - SAVE CERTAIN RECORDS                                          
*                                                                               
SAVREC   DS    0H                                                               
         MVI   SAVSW,C'Y'          SET HAVE SAVED                               
*                                                                               
         CLC   RECTYP,SRCETYP      THIS A SOURCE RECORD (HOLD FILE)             
         BER   RE                   ALREADY SAVED, DO NOT PROCESS               
*                                                                               
         CLC   RECTYP,STARTYP      STATION RECORD                               
         BNE   SAVR20                                                           
         L     R1,=A(SAVSTA)                                                    
         OI    SVRECSW,SVRECSTA                                                 
         B     SAVRN                                                            
*                                                                               
SAVR20   DS    0H                                                               
         CLC   RECTYP,PAYRTYP      PAYEE                                        
         BNE   SAVR40                                                           
         L     R1,=A(SAVPAY)                                                    
         OI    SVRECSW,SVRECPAY                                                 
         B     SAVRN                                                            
*                                                                               
SAVR40   DS    0H                                                               
         CLC   RECTYP,AGYRTYP      AGENCY                                       
         BNE   SAVR60                                                           
         L     R1,=A(SAVAGY)                                                    
         OI    SVRECSW,SVRECAGY                                                 
         B     SAVRN                                                            
*                                                                               
SAVR60   DS    0H                                                               
         CLC   RECTYP,SCTRTYP      STANDARD COMMENT TOP                         
         BNE   SAVR70                                                           
         CLC   RECLEN,=F'136'      FROM LENGTH                                  
         BNH   *+6                                                              
         DC    H'0'                                                             
         L     R1,=A(SAVSCT)                                                    
         LA    R0,5                SAVE 5 MAX                                   
SAVR66   OC    0(140,R1),0(R1)                                                  
         BZ    SAVR68                                                           
         LA    R1,140(,R1)                                                      
         BCT   R0,SAVR66                                                        
         SH    R1,=H'140'          STORE ALL OVER 5 IN LAST SLOT                
         SPACE                                                                  
SAVR68   OI    SVRECSW,SVRECSCT                                                 
         B     SAVRN                                                            
*                                                                               
SAVR70   DS    0H                                                               
         CLC   RECTYP,SCBRTYP      STANDARD COMMENT BOTTOM                      
         BNE   SAVR80                                                           
         CLC   RECLEN,=F'136'      FROM LENGTH                                  
         BNH   *+6                                                              
         DC    H'0'                                                             
         L     R1,=A(SAVSCB)                                                    
         LA    R0,5                SAVE 5 MAX                                   
SAVR76   OC    0(140,R1),0(R1)                                                  
         BZ    SAVR78                                                           
         LA    R1,140(,R1)                                                      
         BCT   R0,SAVR76                                                        
         SH    R1,=H'140'          STORE ALL OVER 5 IN LAST SLOT                
         SPACE                                                                  
SAVR78   OI    SVRECSW,SVRECSCB                                                 
         B     SAVRN                                                            
*                                                                               
SAVR80   DS    0H                                                               
         MVI   SAVSW,C'N'          SET NOT SAVED                                
         BR    RE                                                               
*                                                                               
         DS    0H                                                               
SAVRN    NTR1                                                                   
         L     RE,WRECST           START OF RECORD = FROM ADDRESS               
         L     RF,RECLEN           FROM LENGTH                                  
         LA    RF,4(RF)                                                         
         CH    RF,=H'1024'         CANNOT BE MORE THAN 1024                     
         BNH   *+6                                                              
         DC    H'0'                FOR NOW BLOW UP                              
         STH   RF,0(R1)                                                         
         SH    RF,=H'4'                                                         
         LA    R0,4(R1)            TO ADDRESS                                   
         LA    R1,1020             TO LENGTH                                    
         SPACE                                                                  
         CLC   RECTYP,SCBRTYP      STANDARD COMMENT BOTTOM                      
         BE    SAVRN10                                                          
         CLC   RECTYP,SCTRTYP      STANDARD COMMENT TOP                         
         BNE   SAVRN20                                                          
         SPACE                                                                  
SAVRN10  LA    R1,140              TO LENGTH                                    
         SPACE                                                                  
SAVRN20  MVCL  R0,RE                                                            
         SPACE                                                                  
         CR    RD,RD               SET CC =                                     
         B     EXIT                                                             
         EJECT                                                                  
*        PUTSAV - PUT SAVED RECORDS                                             
*                                                                               
         DS    0H                                                               
PUTSAV   NTR1                                                                   
         TM    SVRECSW,SVRECAGY    TEST NEED AGENCY                             
         BZ    PSV20                                                            
         NI    SVRECSW,X'FF'-SVRECAGY                                           
         L     R2,=A(SAVAGY)       AGENCY - FROM ADDRESS                        
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,SAVAGYLN         TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
*                                                                               
PSV20    DS    0H                                                               
         TM    SVRECSW,SVRECSTA    TEST NEED STATION                            
         BZ    PSV40                                                            
         NI    SVRECSW,X'FF'-SVRECSTA                                           
         L     R2,=A(SAVSTA)       STATION - FROM ADDRESS                       
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,SAVSTALN         TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
*                                                                               
PSV40    DS    0H                                                               
         TM    SVRECSW,SVRECPAY    TEST NEED PAYEE                              
         BZ    PSV60                                                            
         NI    SVRECSW,X'FF'-SVRECPAY                                           
         L     R2,=A(SAVPAY)       PAYEE - FROM ADDRESS                         
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,SAVPAYLN         TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
*                                                                               
PSV60    DS    0H                                                               
         TM    SVRECSW,SVRECSCT    TEST NEED STD CMT TOP                        
         BZ    PSV70                                                            
         NI    SVRECSW,X'FF'-SVRECSCT                                           
         L     R2,=A(SAVSCT)       STD CMT TOP - FROM ADDRESS                   
         LA    R4,5                MAX RECS                                     
         SPACE                                                                  
PSV64    LR    R6,R2                                                            
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,140              TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
         SPACE                                                                  
         LA    R2,140(R6)                                                       
         OC    0(140,R2),0(R2)     ANOTHER REC                                  
         BZ    PSV70                NO                                          
         BCT   R4,PSV64                                                         
*                                                                               
PSV70    DS    0H                                                               
         TM    SVRECSW,SVRECSCB    TEST NEED STD CMT BOTTOM                     
         BZ    PSV80                                                            
         NI    SVRECSW,X'FF'-SVRECSCB                                           
         L     R2,=A(SAVSCB)       STD CMT BOT - FROM ADDRESS                   
         LA    R4,5                MAX RECS                                     
         SPACE                                                                  
PSV74    LR    R6,R2                                                            
         LH    R3,0(R2)            FROM LENGTH                                  
         L     R0,WKRREC           TO ADDRESS                                   
         LA    R1,140              TO LENGTH                                    
         MVCL  R0,R2                                                            
         BAS   RE,ADDWKR                                                        
         SPACE                                                                  
         LA    R2,140(R6)                                                       
         OC    0(140,R2),0(R2)     ANOTHER REC                                  
         BZ    PSV80                NO                                          
         BCT   R4,PSV74                                                         
*                                                                               
PSV80    B     EXIT                                                             
         EJECT                                                                  
*        INVPROC - HANDLE INVOICE HEADER RECORD                                 
*                (ADD 12 BYTE STATUS FIELD + DELIMITER, AND PRINT)              
*                                                                               
INVPROC  DS    0H                                                               
         CLC   RECTYP,INVRTYP      TEST INVOICE HEADER                          
         BNER  RE                                                               
*                                                                               
         DS    0H                                                               
INVP     NTR1                                                                   
         L     RF,BINVS            BUMP INVOICE COUNT                           
         LA    RF,1(RF)                                                         
         ST    RF,BINVS                                                         
*                                                                               
         L     R2,WKRREC           FROM WKRREC                                  
         LH    R3,0(R2)            FROM LENGTH                                  
         CH    R3,=H'1024'         MAX LENGTH                                   
         BL    *+6                                                              
         DC    H'0'                                                             
         L     R0,=A(RECWRK)       TO WORK AREA                                 
         LR    R1,R3               TO LENGTH                                    
         MVCL  R0,R2                                                            
*                                                                               
         L     R2,WKRREC                                                        
         CLC   6(1,R2),FDELIM      FIELD DELIMITER AFTER REC CODE               
         BE    *+6                 AT END OF REC CODE                           
         DC    H'0'                BAD RECORD                                   
*                                                                               
         XC    7(12,R2),7(R2)      SET TWELVE BYTE STATUS FIELD                 
         OI    7(R2),X'80'         EZMOD DROPS LEADING BLANKS                   
         MVC   19(1,R2),FDELIM                                                  
*                                                                               
         LH    RF,0(R2)            BUMP RECORD LENGTH                           
         LA    RF,13(RF)                                                        
         STH   RF,0(R2)                                                         
*                                                                               
         LA    R0,20(R2)           TO ADDRESS                                   
         L     R2,=A(RECWRK)                                                    
         LH    R3,0(R2)                                                         
         LA    R2,7(,R2)           FROM ADDRESS                                 
         SH    R3,=H'7'            FROM LENGTH                                  
         LR    R1,R3               TO LENGTH = FROM LENGTH                      
         CH    R3,=H'1024'                                                      
         BL    *+6                                                              
         DC    H'0'                                                             
         MVCL  R0,R2                                                            
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
*        ENDINV  - END OF AN INVOICE                                            
*                                                                               
ENDINV   DS    0H                                                               
         OC    INVFLDS,INVFLDS                                                  
         BZR   RE                                                               
*                                                                               
         DS    0H                                                               
ENDI     NTR1                                                                   
         CLI   EXCLSW,C'N'         SKIP EXPRESSLY EXCLUDED BATCHES              
         BNE   ENDI40                                                           
*                                                                               
         MVC   ILADV,ADVNAM                                                     
         MVC   ILPRD,PRDNAM                                                     
         MVC   ILINV,INVNO                                                      
         SPACE                                                                  
         OC    OLDINVNO,OLDINVNO   WAS INV # LONGER THAN 10                     
         BZ    *+10                                                             
         MVC   ERRLINE+ILINV-5-P(20),OLDINVNO                                   
         SPACE                                                                  
         MVC   ILMOS,INVMOS                                                     
         SPACE                                                                  
         CLI   INVDEL,C'Y'         SET AS DELETE PREV INV                       
         BNE   ENDI02                                                           
         MVC   ERRLINE(32),=C'* NOTE * DELETE PREVIOUS INVOICE'                 
         SPACE                                                                  
ENDI02   OC    ADVCD,ADVCD         ANY ADVERTISER CODE                          
         BZ    ENDI10                                                           
         MVC   ILADVCD,ADVCD                                                    
         SPACE                                                                  
* CHECK FOR OBVIOUS ERRORS *                                                    
         SPACE                                                                  
         CLI   ADVCD,C'A'                                                       
         BL    ENDI08                                                           
         CLI   ADVCD,C'Z'                                                       
         BH    ENDI08                                                           
         CLI   ADVCD+1,C'A'                                                     
         BL    ENDI08                                                           
         CLI   ADVCD+1,C'Z'                                                     
         BH    ENDI08                                                           
         CLI   ADVCD+2,0                                                        
         BE    ENDI06                                                           
         CLI   ADVCD+2,C' '                                                     
         BE    ENDI06                                                           
         CLI   ADVCD+3,C' '                                                     
         BH    ENDI08                                                           
         CLI   ADVCD+2,C'A'                                                     
         BL    ENDI08                                                           
         CLI   ADVCD+2,C'9'                                                     
         BH    ENDI08                                                           
ENDI06   L     R1,TCLTCDS                                                       
         LA    R1,1(,R1)                                                        
         ST    R1,TCLTCDS                                                       
         B     ENDI10                                                           
ENDI08   MVC   ERRLINE+ILADVCD-P(3),=C'***'                                     
*                                                                               
ENDI10   OC    PRDCD,PRDCD         ANY PRODUCT CODE(S)                          
         BZ    ENDI20                                                           
         MVC   ILPRDCD,PRDCD                                                    
         SPACE                                                                  
* CHECK FOR OBVIOUS ERRORS *                                                    
         SPACE                                                                  
         CLI   PRDCD,C'A'                                                       
         BL    ENDI12                                                           
         CLI   PRDCD,C'Z'                                                       
         BH    ENDI12                                                           
         CLI   PRDCD+1,C'A'                                                     
         BL    ENDI12                                                           
         CLI   PRDCD+1,C'Z'                                                     
         BH    ENDI12                                                           
         CLI   PRDCD+2,0                                                        
         BE    ENDI11                                                           
         CLI   PRDCD+2,C' '                                                     
         BE    ENDI11                                                           
         CLI   PRDCD+3,C' '                                                     
         BH    ENDI12                                                           
         CLI   PRDCD+2,C'A'                                                     
         BL    ENDI12                                                           
         CLI   PRDCD+2,C'Z'                                                     
         BH    ENDI12                                                           
ENDI11   L     R1,TPRDCDS                                                       
         LA    R1,1(,R1)                                                        
         ST    R1,TPRDCDS                                                       
         B     ENDI13                                                           
ENDI12   MVC   ERRLINE+ILPRDCD-P(3),=C'***'                                     
*                                                                               
ENDI13   LA    R0,8                                                             
         LA    RF,PRDCD                                                         
ENDI14   CLI   0(RF),C' '          LOOK FOR BLANK SEPARATOR                     
         BNH   *+16                                                             
         LA    RF,1(,RF)                                                        
         BCT   R0,ENDI14                                                        
         B     ENDI20                                                           
         LA    RF,1(,RF)                                                        
         BCTR  R0,0                                                             
         LTR   R0,R0                                                            
         BZ    ENDI20           GET OUT IF END OF FIELD                         
*                                                                               
ENDI16   CLI   0(RF),C' '          LOOK FOR NON-BLK PROD2                       
         BH    *+16                                                             
         LA    RF,1(,RF)                                                        
         BCT   R0,ENDI16                                                        
         B     ENDI20                                                           
*                                                                               
         XC    WORK,WORK                                                        
         LA    RE,WORK                                                          
         MVC   0(1,RE),0(RF)                                                    
         LA    RE,1(,RE)                                                        
         LA    RF,1(,RF)                                                        
         BCT   R0,*-14                                                          
*                                                                               
         CLI   WORK,C'A'                                                        
         BL    ENDI18                                                           
         CLI   WORK,C'Z'                                                        
         BH    ENDI18                                                           
         CLI   WORK+1,C'A'                                                      
         BL    ENDI18                                                           
         CLI   WORK+1,C'Z'                                                      
         BH    ENDI18                                                           
         CLI   WORK+2,0                                                         
         BE    ENDI20                                                           
         CLI   WORK+2,C' '                                                      
         BE    ENDI20                                                           
         CLI   WORK+2,C'A'                                                      
         BL    ENDI18                                                           
         CLI   WORK+2,C'Z'                                                      
         BNH   ENDI20                                                           
ENDI18   MVC   ERRLINE+ILPRDCD-P(3),=C'***'                                     
*                                                                               
ENDI20   OC    ESTNO,ESTNO         ANY ESTIMATE                                 
         BZ    ENDI30                                                           
         MVC   ILEST,ESTNO                                                      
         XC    FULL,FULL                                                        
         LA    R0,10                                                            
         LA    R1,FULL                                                          
         LA    RE,ESTNO                                                         
         LA    RF,3                                                             
         MVI   BYTE,0                                                           
         SPACE                                                                  
         CLI   0(RE),C' '                                                       
         BH    ENDI21                                                           
         LA    RE,1(,RE)                                                        
         BCT   R0,*-12                                                          
         DC    H'0'                                                             
ENDI21   CLI   0(RE),C'0'                                                       
         BNE   ENDI22                                                           
         LA    RE,1(,RE)                                                        
         BCT   R0,*-12                                                          
         MVI   BYTE,1                                                           
         B     ENDI26                                                           
         SPACE                                                                  
ENDI22   CLI   0(RE),C'0'                                                       
         BL    ENDI24                                                           
         CLI   0(RE),C'9'                                                       
         BH    ENDI25                                                           
         MVC   0(1,R1),0(RE)                                                    
         LA    R1,1(,R1)                                                        
         LA    RE,1(,RE)                                                        
         BCT   RF,*+8              GET FIRST 3 DIGITS ONLY                      
         B     ENDI24                                                           
         BCT   R0,ENDI22           ALLOW MAX EST FIELD LENGTH                   
ENDI24   LA    R0,3                                                             
         LA    R1,FULL                                                          
         SR    RF,RF                                                            
         CLI   0(R1),0                                                          
         BE    *+14                                                             
         LA    R1,1(,R1)                                                        
         BCTR  RF,0                                                             
         BCT   R0,*-14                                                          
         LPR   RF,RF                                                            
         BZ    ENDI28                                                           
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         PACK  DUB,FULL(0)                                                      
         CVB   R0,DUB                                                           
         CH    R0,=H'256'                                                       
         BL    ENDI26                                                           
         SPACE                                                                  
ENDI25   MVI   BYTE,1                                                           
         SPACE                                                                  
ENDI26   DS    0H                                                               
         CLI   BYTE,1                                                           
         BNE   ENDI29                                                           
ENDI28   MVC   ERRLINE+ILEST-P(3),=C'***'                                       
         B     ENDI30                                                           
ENDI29   L     R1,TESTCDS                                                       
         LA    R1,1(,R1)                                                        
         ST    R1,TESTCDS                                                       
         SPACE                                                                  
ENDI30   DS    0H                                                               
         L     R2,ISPTS                                                         
         LA    R3,ILSPTS                                                        
         BAS   RE,EDIT0                                                         
         SPACE                                                                  
         L     R2,IDOLN                                                         
         LA    R3,ILDOLS                                                        
         BAS   RE,EDIT2                                                         
         SPACE                                                                  
*        MVC   ILADVCD,USID                                                     
         SPACE                                                                  
         MVC   ILNET,STANET                                                     
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         CLI   INVDEL,C'Y'         SET AS DELETE PREV INV                       
         BNE   ENDI34                                                           
         OC    IDOLG,IDOLG         WAS THIS ZERO INVOICE                        
         BZ    ENDI34               YES                                         
         MVC   ERRLINE+ILDOLS-P-14(26),=C'ERROR-DEL INV MUST BE ZERO'           
         SPACE                                                                  
ENDI34   OC    ERRLINE,ERRLINE                                                  
         BZ    ENDI40                                                           
         MVC   P,ERRLINE                                                        
         XC    ERRLINE,ERRLINE                                                  
*                                                                               
         GOTO1 =V(PRINTER)                                                      
*                                                                               
ENDI40   DS    0H                                                               
         OC    SVSRCE,SVSRCE       ARE WE WORKING ON HOLD FILE                  
         BNZ   ENDI50                                                           
         SPACE                                                                  
         CLI   EXCLSW,C'Y'         BAD BATCH                                    
         BE    ENDI50                                                           
         CLI   EXCLSW,C'*'         UNKNOWN AGENCY                               
         BE    ENDI50                                                           
         CLI   EXCLSW,C'I'         EXCLUDE USER ID                              
         BE    ENDI50                                                           
         CLI   EXCLSW,C'S'         EXCLUDE STATION                              
         BE    ENDI50                                                           
         SPACE                                                                  
         L     RF,=A(MOSTABLE)                                                  
         LA    RE,MOSTABLN                                                      
CTMOS10  DS    0H                                                               
         OC    0(4,RF),0(RF)                                                    
         BZ    CTMOS20                                                          
         CLC   SVINVMOS,0(RF)                                                   
         BE    CTMOS30                                                          
         LA    RF,6(,RF)           NEXT ENTRY                                   
         BCT   RE,CTMOS10                                                       
         DC    H'0'                MAKE MOSTABLE LARGER                         
*                                                                               
CTMOS20  MVC   0(4,RF),SVINVMOS                                                 
*                                                                               
CTMOS30  DS    0H                                                               
         LH    R1,4(RF)                                                         
         LA    R1,1(,R1)                                                        
         STH   R1,4(RF)                                                         
*                                                                               
ENDI50   DS    0H                                                               
         CLI   TEST,C'Y'           SKIP BILLING IF TEST RUN                     
         BE    ENDI60                                                           
*                                                                               
         CLI   EXCLSW,C'N'         SKIP BILLING IF EXCLUDE                      
         BNE   ENDI60                                                           
*                                                                               
* BUILD AND WRITE EZ BILLING RECORD TO SEQUENTIAL FILE                          
*                                                                               
         XC    EZBILL(256),EZBILL                                               
         XC    EZBILL+256(256),EZBILL+256                                       
         LA    R2,EZBILL                                                        
         USING EZBILLD,R2                                                       
         SPACE                                                                  
         MVC   EZBAGY,USID                                                      
         MVC   EZBSRC,SOURCE                                                    
         MVC   EZBMEDIA,MEDIA                                                   
         MVC   EZBCALL,BILSTA                                                   
         MVC   EZBNET,STANET                                                    
         MVC   EZBMOS,INVMOS                                                    
         MVC   EZBTODAY,TODAY                                                   
         MVC   EZBADVNM,ADVNAM                                                  
         MVC   EZBPRDNM,PRDNAM                                                  
         MVC   EZBINVNO,INVNO                                                   
         L     R0,ISPTS                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EZBNSPTS,DUB                                                     
         L     R0,IDOLG                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EZBGDOL,DUB                                                      
         L     R0,IDOLN                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  EZBNDOL,DUB                                                      
         MVC   EZBAGYNM(150),SVAGYFL                                            
         MVC   EZBSTADR,OLDSTAD                                                 
         SPACE                                                                  
         L     R0,=A(EZBILLF)                                                   
         PUT   (0),EZBILL                                                       
         DROP  R2                                                               
         XC    EZBILL(256),EZBILL                                               
         XC    EZBILL+256(256),EZBILL+256                                       
         SPACE                                                                  
ENDI60   DS    0H                                                               
         XC    INVFLDS,INVFLDS                                                  
         L     RF,ISPTS            ROLL UP TO BATCH TOTALS                      
         A     RF,BSPTS                                                         
         ST    RF,BSPTS                                                         
         L     RF,IDOLN            ROLL UP TO BATCH TOTALS                      
         A     RF,BDOLN                                                         
         ST    RF,BDOLN                                                         
         L     RF,IDOLG            ROLL UP TO BATCH TOTALS                      
         A     RF,BDOLG                                                         
         ST    RF,BDOLG                                                         
         SPACE                                                                  
         CLI   EXCLSW,C'N'         SKIP EXPRESSLY EXCLUDED BATCHES              
         BNE   ENDI80                                                           
         SPACE                                                                  
* ADD BOTH UNKNOWN AGENCY AND WORKER FILE FULL COUNTS                           
         SPACE                                                                  
         BAS   RE,ADDSTA           ADD TO STATION COUNTERS                      
         SPACE                                                                  
         BAS   RE,ADDAGY           ADD TO AGENCY COUNTERS                       
         SPACE                                                                  
ENDI80   DS    0H                                                               
         XC    ITOTS,ITOTS         CLEAR INVOICE TOTALS                         
         SPACE                                                                  
         CLI   EXCLSW,C'*'         UNKNOWN AGENCY                               
         BNE   ENDI84                                                           
         SPACE                                                                  
         L     RF,TUNKINV                                                       
         LA    RF,1(,RF)                                                        
         ST    RF,TUNKINV                                                       
         SPACE                                                                  
ENDI84   DS    0H                                                               
         CLI   EXCLSW,C'#'         FULL WORKER FILE                             
         BNE   ENDI86                                                           
         SPACE                                                                  
         L     RF,TFULINV                                                       
         LA    RF,1(,RF)                                                        
         ST    RF,TFULINV                                                       
         SPACE                                                                  
ENDI86   DS    0H                                                               
         B     EXIT                                                             
         SPACE 3                                                                
EDIT0    NTR1                                                                   
         EDIT  ((R2)),(5,(R3)),ZERO=NOBLANK                                     
         B     EXIT                                                             
EDIT2    NTR1                                                                   
         EDIT  ((R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES             
         B     EXIT                                                             
         EJECT                                                                  
*        ADDWKR - ADD RECORD TO WORKER FILE                                     
*                                                                               
         DS    0H                                                               
ADDWKR   NTR1                                                                   
         L     R4,WKRREC                                                        
         LH    R5,0(R4)            LENGTH                                       
         CH    R5,=H'6'            SKIP IF NO REAL RECORD                       
         BNH   ADDWKRX                                                          
         CH    R5,=H'1020'         MAX REC SIZE                                 
         BNH   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   EXCLSW,C'N'         SKIP ADDS IF EXCLUDE                         
         BNE   ADDW20                                                           
         SPACE                                                                  
         L     R1,BRECS            ADD 1 TO BATCH RECORDS                       
         LA    R1,1(,R1)           CAN'T MAKE BATCH TOO LARGE                   
         ST    R1,BRECS            BATCH MOVE CAN'T HANDLE IT                   
         SPACE                                                                  
         CVD   R5,DUB              GET BYTES                                    
         AP    BBYTS,DUB           ADD TO TOTAL BATCH BYTES                     
         SPACE                                                                  
         CLI   TEST,C'Y'           SKIP ADDS IF TESTING                         
         BE    ADDW10                                                           
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,=C'ADD',WKRFIL,0,WKRREC,WKRBUF                  
         CLI   8(R1),0                                                          
         BE    ADDW10                                                           
         DC    H'0'                                                             
ADDW10   BAS   RE,DMPREC                                                        
         B     ADDWKRX                                                          
         SPACE                                                                  
* WRITE TO HOLD FILE HERE IF UNKNOWN AGENCY OR FULL WORKER FILE *               
         SPACE                                                                  
ADDW20   DS    0H                                                               
         CLI   EXCLSW,C'Y'         SKIP EXPRESSLY EXCLUDED BATCHES              
         BE    ADDWKRX                                                          
         SPACE                                                                  
         CLI   EXCLSW,C'I'         SET TO EXCLUDE USER ID                       
         BE    ADDWKRX                                                          
         SPACE                                                                  
         CLI   EXCLSW,C'S'         SET TO EXCLUDE STATION                       
         BE    ADDWKRX                                                          
         SPACE                                                                  
         CLI   EXCLSW,C'#'         SET TO EXCLUDE WORKER FILE FULL              
         BE    ADDW24                                                           
         SPACE                                                                  
         CLI   EXCLSW,C'*'         SET TO EXCLUDE UNKNOWN                       
         BE    ADDW24                                                           
         DC    H'0'                                                             
         SPACE                                                                  
ADDW24   TM    SVRECSW,SVRECSRC                                                 
         BZ    ADDW40                                                           
         NI    SVRECSW,X'FF'-SVRECSRC                                           
         L     R2,=A(HLDREC)                                                    
         XC    0(256,R2),0(R2)                                                  
         MVI   1(R2),20                                                         
         MVC   4(3,R2),=X'F9F95E'                                               
         MVC   7(4,R2),SOURCE                                                   
         MVI   11(R2),X'5E'                                                     
         MVC   12(6,R2),HOLDDATE                                                
         SPACE                                                                  
         OC    HOLDDATE,HOLDDATE   IS THIS AN OLD BATCH?                        
         BNZ   *+10                 YES                                         
         MVC   12(6,R2),TODAY                                                   
         SPACE                                                                  
         MVC   18(2,R2),=X'5E15'                                                
         SPACE                                                                  
         L     RF,WORKCT9                                                       
         LA    RF,1(,RF)                                                        
         ST    RF,WORKCT9                                                       
         SPACE                                                                  
         CLI   TRACEWRK,C'Y'       PRINT OUT WORK FILE                          
         BNE   ADDW30                                                           
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R2)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'W'                                                        
         MVC   P+16(80),4(R2)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
ADDW30   DS    0H                                                               
         CLI   TEST,C'Y'           THIS A TEST RUN                              
         BE    ADDW40                                                           
         SPACE                                                                  
         L     R0,=A(EZWORKW)                                                   
         PUT   (0),(R2)                                                         
         SPACE                                                                  
* MOVE TO WRITE RECORD AREA, ADD 4 TO LEN, SAVE IT, ZERO NEXT 2 BYTES           
* MOVE REST OF RECORD TO +4                                                     
         SPACE                                                                  
ADDW40   L     R2,=A(HLDREC)                                                    
         XC    0(256,R2),0(R2)                                                  
         STH   R5,0(,R2)           STORE LENGTH                                 
         LA    R0,4(,R2)           POINT TO START OF RECORD                     
         AHI   R5,-4               GET RECORD LEN                               
         LA    R4,4(,R4)           MOVE RECORD ONLY                             
         LR    R1,R5                                                            
         SPACE                                                                  
         CLC   =X'F3F15E',0(R4)    THIS INVOICE HEADER REC                      
         BNE   ADDW50               NOPE                                        
         SPACE                                                                  
* NEED TO DROP 12 BYTE SAVE AREA FIELD + SEMI-COLON *                           
         SPACE                                                                  
         AHI   R5,-9               GET NEW LEN WITHOUT 12 BYTE FIELD            
         STH   R5,0(,R2)           STORE NEW LENGTH + 4                         
         AHI   R5,-4               NOW SUB 4 FOR REAL LEN                       
         LR    RF,R0                                                            
         MVC   0(3,RF),0(R4)       DROP                                         
         LA    R0,3(,RF)                INTERNAL                                
         LA    R4,16(,R4)                        12 BYTE FIELD                  
         AHI   R5,-3                                                            
         LR    R1,R5                                                            
         SPACE                                                                  
ADDW50   MVCL  (R0),(R4)                                                        
         SPACE                                                                  
         L     RF,WORKCT                                                        
         LA    RF,1(,RF)                                                        
         ST    RF,WORKCT                                                        
         SPACE                                                                  
         CLI   TRACEWRK,C'Y'       PRINT OUT WORK FILE                          
         BNE   ADDW60                                                           
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+1(4),DUB                                                       
         LH    R0,0(R2)                                                         
         SH    R0,=H'4'                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         CH    R0,=H'372'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         UNPK  P+6(3),DUB                                                       
         MVC   P+10(3),=C'LEN'                                                  
         MVI   P+14,C'W'                                                        
         MVC   P+16(80),4(R2)                                                   
         OC    P+16(80),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
ADDW60   DS   0H                                                                
         CLI   TEST,C'Y'           THIS A TEST RUN                              
         BE    ADDWKRX                                                          
         SPACE                                                                  
         L     R0,=A(EZWORKW)                                                   
         PUT   (0),(R2)                                                         
         SPACE                                                                  
ADDWKRX  DS    0H                                                               
         B     EXIT                                                             
         SPACE 2                                                                
*        DMPREC - RECORD ADDED TO WORKER FILE                                   
*                                                                               
DMPREC   CLI   TRACEWKR,C'Y'                                                    
         BNER  RE                                                               
*                                                                               
         DS    0H                                                               
DMP      NTR1                                                                   
         L     R6,WKRREC                                                        
         MVC   P(4),=C'WRKR'                                                    
         EDIT  (B2,0(R6)),(4,P+6),FILL=0                                        
         MVC   P+12(120),2(R6)                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
*        CKMINUS - CHECK FOR MINUS AT START OR END OF RFDATA                    
*                                                                               
         SPACE                                                                  
CKMINUS  MVI   HOLDSIGN,0                                                       
         ZIC   RF,RFLEN                                                         
         CLI   RFDATA,C'-'         PRECEDED BY MINUS                            
         BNE   CKMIN10                                                          
         SPACE                                                                  
         EX    RF,CKMMVC                                                        
         BCTR  RF,0                                                             
         B     CKMIN20                                                          
         SPACE                                                                  
CKMIN10  BCTR  RF,0                                                             
         LA    R1,RFDATA(RF)                                                    
         CLI   0(R1),C'-'          LAST CHAR A MINUS                            
         BNE   CKMINX                                                           
         MVI   0(R1),0             BLANK MINUS                                  
CKMIN20  STC   RF,RFLEN                                                         
         MVI   HOLDSIGN,C'-'                                                    
         SPACE                                                                  
CKMINX   BR    RE                                                               
         SPACE                                                                  
CKMMVC   MVC   RFDATA(0),RFDATA+1                                               
         EJECT                                                                  
*        ADDSTA - ADD TO STATION TABLE - 1 FOR INVOICE, SPOTS, $                
*                                                                               
ADDSTA   LA    R0,EZSTALEN-1                                                    
         L     R1,=A(EZSTATAB)                                                  
ADDSTA10 OC    0(5,R1),0(R1)       EMPTY ENTRY                                  
         BZ    ADDSTA20                                                         
         CLC   OLDSTA(5),0(R1)                                                  
         BE    ADDSTA24                                                         
         LA    R1,21(R1)                                                        
         BCT   R0,ADDSTA10                                                      
         SPACE                                                                  
         MVC   0(5,R1),=C'*****'                                                
         B     ADDSTA24                                                         
         SPACE                                                                  
ADDSTA20 MVC   0(5,R1),OLDSTA                                                   
         SPACE                                                                  
ADDSTA24 DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNER  RE                   SKIP COUNTS                                 
         SPACE                                                                  
         ICM   RF,15,5(R1)                                                      
         LA    RF,1(,RF)                                                        
         STCM  RF,15,5(R1)                                                      
         ICM   RF,15,9(R1)                                                      
         A     RF,ISPTS                                                         
         STCM  RF,15,9(R1)                                                      
         ICM   RF,15,13(R1)                                                     
         A     RF,IDOLN                                                         
         STCM  RF,15,13(R1)                                                     
         ICM   RF,15,17(R1)                                                     
         A     RF,IDOLG                                                         
         STCM  RF,15,17(R1)                                                     
         BR    RE                                                               
         EJECT                                                                  
*        ADDAGY - ADD TO AGENCY TABLE - 1 FOR INVOICE, SPOTS, $                 
*                                                                               
ADDAGY   DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNER  RE                   SKIP COUNTS                                 
         LA    R0,100                                                           
         L     R1,=A(EZAGYCTB)                                                  
ADDAGY10 OC    0(8,R1),0(R1)       EMPTY ENTRY                                  
         BZ    ADDAGY20                                                         
         CLC   USID,0(R1)                                                       
         BE    ADDAGY24                                                         
         LA    R1,24(,R1)                                                       
         BCT   R0,ADDAGY10                                                      
         DC    H'0'                                                             
         SPACE                                                                  
ADDAGY20 MVC   0(8,R1),USID                                                     
         SPACE                                                                  
ADDAGY24 DS   0H                                                                
         SPACE                                                                  
         ICM   RF,15,8(R1)                                                      
         LA    RF,1(,RF)                                                        
         STCM  RF,15,8(R1)                                                      
         ICM   RF,15,12(R1)                                                     
         A     RF,ISPTS                                                         
         STCM  RF,15,12(R1)                                                     
         ICM   RF,15,16(R1)                                                     
         A     RF,IDOLN                                                         
         STCM  RF,15,16(R1)                                                     
         ICM   RF,15,20(R1)                                                     
         A     RF,IDOLG                                                         
         STCM  RF,15,20(R1)                                                     
         SPACE                                                                  
*        ADDAGY - ADD TO AGENCY NAME TABLE - 1 FOR INVOICE, SPOTS, $            
*                                                                               
ADDAGY26 LA    R0,100                                                           
         L     R1,=A(EZAGYNTB)                                                  
         OC    SVAGYFL(130),SPACES                                              
         OC    SVAGYFL+130(20),SPACES                                           
ADDAGY30 OC    0(170,R1),0(R1)      EMPTY ENTRY                                 
         BZ    ADDAGY40                                                         
         SPACE                                                                  
         CLC   SVAGYFL,0(R1)                                                    
         BE    ADDAGY44                                                         
         LA    R1,170(,R1)                                                      
         BCT   R0,ADDAGY30                                                      
         DC    H'0'                                                             
         SPACE                                                                  
ADDAGY40 MVC   0(150,R1),SVAGYFL                                                
         SPACE                                                                  
ADDAGY44 DS   0H                                                                
         ICM   RF,15,152(R1)                                                    
         LA    RF,1(,RF)                                                        
         STCM  RF,15,152(R1)                                                    
         ICM   RF,15,156(R1)                                                    
         A     RF,ISPTS                                                         
         STCM  RF,15,156(R1)                                                    
         ICM   RF,15,160(R1)                                                    
         A     RF,IDOLN                                                         
         STCM  RF,15,160(R1)                                                    
         ICM   RF,15,164(R1)                                                    
         A     RF,IDOLG                                                         
         STCM  RF,15,164(R1)                                                    
         SPACE                                                                  
ADDAGY46 MVC   168(2,R1),USIDNO     USE FOR UNKNOWN AGENCY (ZEROS)              
         LA    R0,9                                                             
         LA    RF,MEDBITAB                                                      
ADDAGY50 CLC   0(1,RF),SVMEDIA                                                  
         BE    ADDAGY54                                                         
         LA    RF,2(,RF)                                                        
         BCT   R0,ADDAGY50                                                      
         DC    H'0'                                                             
ADDAGY54 OC    150(1,R1),1(RF)     SET ON MEDIA BIT                             
         EJECT                                                                  
*        ADDMED - ADD TO MEDIA TABLE - 1 FOR INVOICE, SPOTS, $                  
*                                                                               
         LA    R0,10                                                            
         L     R1,=A(EZMEDCTB)                                                  
ADDMED10 CLI   0(R1),0              EMPTY ENTRY                                 
         BE    ADDMED20                                                         
         SPACE                                                                  
         CLC   SVMEDIA(1),0(R1)                                                 
         BE    ADDMED24                                                         
         LA    R1,21(,R1)                                                       
         BCT   R0,ADDMED10                                                      
         DC    H'0'                                                             
         SPACE                                                                  
ADDMED20 MVC   0(1,R1),SVMEDIA                                                  
         SPACE                                                                  
ADDMED24 DS   0H                                                                
         CLI   EXCLSW,C'N'         IF EXCLSW NE N, NOT LOADED                   
         BNER  RE                   SKIP COUNTS                                 
         SPACE                                                                  
         ICM   RF,15,1(R1)                                                      
         LA    RF,1(,RF)                                                        
         STCM  RF,15,1(R1)                                                      
         ICM   RF,15,5(R1)                                                      
         A     RF,ISPTS                                                         
         STCM  RF,15,5(R1)                                                      
         SPACE                                                                  
         L     RF,IDOLN                                                         
         CVD   RF,DUB                                                           
         AP    9(6,R1),DUB                                                      
         SPACE                                                                  
         L     RF,IDOLG                                                         
         CVD   RF,DUB                                                           
         AP    15(6,R1),DUB                                                     
         SPACE                                                                  
         BR    RE                                                               
         SPACE                                                                  
MEDBITAB DC    X'C301D502D904E208E310E720D310C104C604'                          
*                C   N   R   S   T   X   L   A   F   POSSIBLE MEDIAS            
*                L GETS CONVERTED TO T ON OUTPUT, A & F TO R                    
         EJECT                                                                  
*        TRCRET- ROUTINE TO TRACE GETFLD RETURNS                                
*                                                                               
TRCRET   TM    RFCTL,RFCTLFER      FIELD ERROR                                  
         BNZ   TRCRETN                                                          
         CLI   TRACEFLD,C'Y'     TEST TRACING FIELDS                            
         BNER  RE                                                               
         CLI   EXCLSW,C'Y'       SKIP EXPRESSLY EXCLUDED BATCHES                
         BER   RE                                                               
*                                                                               
         DS    0H                                                               
TRCRETN  NTR1                                                                   
         MVC   P,SPACES                                                         
         TM    RFCTL,RFCTLFER       FIELD ERROR                                 
         BZ    TRCRETN1                                                         
         OC    RFERRMSG,RFERRMSG                                                
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   P+7(L'RFERRMSG),RFERRMSG                                         
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
TRCRETN1 MVC   P(6),=C'GETFLD'                                                  
         GOTO1 =V(HEXOUT),DMCB,RFCTL,P+7,1,=C'N'                                
         GOTO1 =V(HEXOUT),DMCB,RFCTL2,P+10,1,=C'N'                              
         EDIT  (B1,RFFLDNO),(3,P+13),FILL=0                                     
         EDIT  (B1,RFLEN),(3,P+17),FILL=0                                       
         MVC   P+21(100),RFDATA                                                 
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
*                                                                               
         B     EXIT                                                             
         SPACE                                                                  
* FOUND TYPE CODE WITH LENGTH OTHER THAN 2 *                                    
         SPACE                                                                  
TYPLENER MVC   P(26),=C'REC CODE ERR-LEN=XXX, REC='                             
         ZIC   RF,RFLEN                                                         
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+17(3),DUB                                                      
         MVC   P+26(30),RFDATA                                                  
         GOTO1 =V(PRINTER)                                                      
         DC    H'0'                                                             
         EJECT                                                                  
*        CONSTANTS FOR SOME RECORD TYPES                                        
*                                                                               
TYPETABL DS    0CL2                                                             
TRTOTYP  DC    CL2'12'                                                          
AGYRTYP  DC    CL2'21'                                                          
STARTYP  DC    CL2'22'                                                          
PAYRTYP  DC    CL2'23'                                                          
SCTRTYP  DC    CL2'24'                                                          
SCBRTYP  DC    CL2'25'                                                          
INVRTYP  DC    CL2'31'                                                          
         DC    CL2'32'                                                          
         DC    CL2'33'                                                          
INTRTYP  DC    CL2'34'                                                          
         DC    CL2'41'                                                          
         DC    CL2'42'                                                          
SPTRTYP  DC    CL2'51'                                                          
         DC    CL2'52'                                                          
SRCETYP  DC    CL2'99'             SOURCE - ONLY ON UNKNOWN AGENCY FILE         
TYPETLEN EQU   (*-TYPETABL)/2                                                   
         SPACE 2                                                                
UNKAGNCY DS    CL14'UNKNOWN AGENCY'                                             
         LTORG                                                                  
         SPACE                                                                  
         DROP  R9,RB,RC                                                         
         EJECT                                                                  
* INITIALIZE PROGRAM                                                            
         SPACE                                                                  
         DS    0H                                                               
INIT     NMOD1 0,**INIT**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         LA    RE,EZLDWKD          CLEAR WORK                                   
         LA    RF,EZLDWKL                                                       
         XCEF                                                                   
*                                                                               
         L     RE,=A(DUPSEQTB)     CLEAR DUPLICATE SEQ TABLE                    
         LHI   RF,DUPSEQTL                                                      
         XCEF                                                                   
*                                                                               
         L     RE,=A(SVINDXTB)     CLEAR SAVED BATCH ID TABLE                   
         L     RF,=A(SVINDXTL)     LENGTH OF TABLE                              
         XCEF                                                                   
*                                                                               
         MVI   SPACES,C' '                                                      
         MVC   SPACES+1(L'SPACES-1),SPACES                                      
*                                                                               
         L     RF,=A(WKRBUFC)                                                   
         ST    RF,WKRBUF                                                        
         L     RF,=A(WKRRECC)                                                   
         ST    RF,WKRREC                                                        
*                                                                               
         MVC   TIMEP,=X'0100'      DEFAULT TIME                                 
         MVC   WKRFIL,=CL8'WRKF  '                                              
         MVC   TITLE(38),=C'EASI - LOAD INPUT TAPE TO WORKER FILES'             
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
         XC    COUNTS,COUNTS                                                    
*                                                                               
         XC    TOTINVS,TOTINVS     CLEAR BOTH TOTAL INVOICES & DOLLARS          
         ZAP   TOTDOLS,=P'0'                                                    
         ZAP   TDOLN,=P'0'                                                      
         ZAP   TDOLG,=P'0'                                                      
         ZAP   HODOLN,=P'0'                                                     
         ZAP   HODOLG,=P'0'                                                     
         ZAP   HIDOLN,=P'0'                                                     
         ZAP   HIDOLG,=P'0'                                                     
         ZAP   CDOLN,=P'0'                                                      
         ZAP   CDOLG,=P'0'                                                      
         ZAP   LDOLN,=P'0'                                                      
         ZAP   LDOLG,=P'0'                                                      
         ZAP   IBYTS,=P'0'                                                      
         ZAP   OBYTS,=P'0'                                                      
*                                                                               
         ZAP   BBYTS,=P'0'                                                      
*                                                                               
         MVC   ID-8(8),=C'*WKINDX*'                                             
*                                                                               
         XC    INVFLDS,INVFLDS                                                  
         MVI   STMODE,C'+'         SET MODES AT INCLUDE                         
         MVI   IDMODE,C'+'                                                      
         MVI   RECFM,C'U'          DEFAULT TO UNDEFINED RECORD FORMAT           
*                                                                               
         SR    R0,R0               INITIALIZE ID TABLE BINSRCH PARS             
         L     R1,=A(IDTAB)                                                     
         SR    R2,R2                                                            
         LA    R3,8                                                             
         LA    R4,8                                                             
         LA    R5,IDTABMX                                                       
         STM   R0,R5,IDTPARS                                                    
*                                                                               
         SR    R0,R0               INITIALIZE STATION TAB BNSRCH PARS           
         L     R1,=A(STTAB)                                                     
         SR    R2,R2                                                            
         LA    R3,5                                                             
         LA    R4,5                                                             
         LA    R5,STTABMX                                                       
         STM   R0,R5,STTPARS                                                    
*                                                                               
         SPACE 3                                                                
*              READ PARAMETER CARDS                                             
         SPACE                                                                  
         MVC   P(13),=C'CONTROL CARDS'                                          
         GOTO1 =V(PRINTER)                                                      
         MVC   P(13),DASHES                                                     
         GOTO1 =V(PRINTER)                                                      
         SPACE 2                                                                
EZL10    DS    0H                                                               
         GOTO1 =V(CARDS),DMCB,CARD,=C'RE00'                                     
         CLC   =C'/*',CARD                                                      
         BE    EZL60                                                            
         MVC   P(80),CARD                                                       
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         CLC   =C'TRACE=',CARD                                                  
         BNE   EZL14                                                            
         MVC   TRACES,CARD+6     RECORDS,FIELDS,WORKER RECS                     
         B     EZL10                                                            
*                                                                               
EZL14    DS    0H                                                               
         CLC   =C'DUMP=',CARD                                                   
         BNE   EZL16                                                            
         MVC   ABNDOPT,CARD+5                                                   
         B     EZL10                                                            
*                                                                               
EZL16    DS    0H                                                               
         CLC   =C'DMGR=',CARD                                                   
         BNE   EZL18                                                            
         MVC   DMGOPT,CARD+5                                                    
         B     EZL10                                                            
*                                                                               
EZL18    DS    0H                                                               
         CLC   =C'DDSIO=',CARD                                                  
         BNE   EZL20                                                            
         ICM   RF,15,VDDSIO                                                     
         BZ    EZL10                                                            
         MVC   0(8,RF),CARD+6                                                   
         B     EZL10                                                            
*                                                                               
EZL20    DS    0H                                                               
         CLC   =C'TEST=',CARD                                                   
         BNE   EZL24                                                            
         MVC   TEST,CARD+5                                                      
         B     EZL10                                                            
*                                                                               
EZL24    DS    0H                                                               
         CLC   =C'DATE=',CARD                                                   
         BNE   EZL26                                                            
         MVC   TODAY,CARD+5                                                     
         B     EZL10                                                            
*                                                                               
EZL26    DS    0H                                                               
         CLC   =C'TIME=',CARD                                                   
         BNE   EZL30                                                            
         PACK  WORK(3),CARD+5(5)  PWOS TIME                                     
         MVC   TIMEP,WORK                                                       
         B     EZL10                                                            
*                                                                               
EZL30    DS    0H                                                               
         CLC   =C'RERUN=',CARD                                                  
         BNE   EZL34                                                            
         MVC   RERUN,CARD+6                                                     
         B     EZL10                                                            
*                                                                               
EZL34    DS    0H                                                               
         CLC   =C'STXIT',CARD                                                   
         BNE   EZL36                                                            
         L     RF,=A(EZLOAD)                                                    
         ST    RF,WORK                                                          
         L     RF,=A(EZLOADX)                                                   
         LA    RF,40(,RF)          SHOW LEVEL=, DATE=                           
         ST    RF,WORK+4                                                        
         OI    WORK+4,X'80'        EOL                                          
         GOTO1 =V(STXITER),DMCB,WORK                                            
         B     EZL10                                                            
*                                                                               
EZL36    DS    0H                                                               
         CLC   =C'STATION=',CARD                                                
         BNE   EZL44                                                            
         CLI   CARD+8,C'+'         MODE SETTERS                                 
         BE    EZL40                                                            
         CLI   CARD+8,C'-'                                                      
         BE    EZL40                                                            
*                                                                               
         MVC   WORK(5),CARD+8                                                   
         GOTO1 =V(BINSRCH),STTPARS,(1,WORK)                                     
         OC    1(3,R1),1(R1)       TEST ROOM                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         B     EZL10                                                            
*                                                                               
EZL40    DS    0H                  MODE SETTERS                                 
         CLI   CARD+9,C' '         MUST NOT BE FOLLOWED BY STATION              
         BNE   EZL56                                                            
         MVC   STMODE,CARD+8                                                    
         B     EZL10                                                            
*                                                                               
EZL44    DS    0H                                                               
         CLC   =C'USERID=',CARD                                                 
         BNE   EZL50                                                            
         CLI   CARD+7,C'+'         MODE SETTERS                                 
         BE    EZL46                                                            
         CLI   CARD+7,C'-'                                                      
         BE    EZL46                                                            
*                                                                               
         MVC   WORK(8),CARD+7                                                   
         GOTO1 =V(BINSRCH),IDTPARS,(1,WORK)                                     
         OC    1(3,R1),1(R1)       TEST ROOM                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         B     EZL10                                                            
*                                                                               
EZL46    DS    0H                  MODE SETTERS                                 
         CLI   CARD+8,C' '         MUST NOT BE FOLLOWED BY STATION              
         BNE   EZL56                                                            
         MVC   IDMODE,CARD+7                                                    
         B     EZL10                                                            
*                                                                               
EZL50    DS    0H                                                               
         CLC   =C'SOURCE=',CARD                                                 
         BNE   EZL54                                                            
         MVC   SOURCE,CARD+7                                                    
         B     EZL10                                                            
*                                                                               
EZL54    DS    0H                                                               
         CLC   =C'RECFM=',CARD                                                  
         BNE   EZL56                                                            
         MVC   RECFM,CARD+6                                                     
         CLI   RECFM,C'F'                                                       
         BE    EZL10                                                            
         CLI   RECFM,C'U'                                                       
         BE    EZL10                                                            
         CLI   RECFM,C'V'                                                       
         BE    EZL10                                                            
         MVC   P(15),=C'MUST BE F, U, V'                                        
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
*                                                                               
EZL56    DS    0H                                                               
         MVC   P(8),=C'BAD CARD'                                                
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE 3                                                                
EZL60    DS    0H                                                               
         CLI   TODAY,0             TEST DATE GIVEN                              
         BNE   EZL64                                                            
         GOTO1 =V(DATCON),DMCB,(5,0),(0,TODAY)                                  
*                                                                               
EZL64    DS    0H                                                               
         GOTO1 =V(DATCON),DMCB,(0,TODAY),(2,TODAYC)                             
         SPACE                                                                  
         OC    SOURCE,SOURCE       WAS THERE A SOURCE CARD                      
         BZ    SRCERR                                                           
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,=C'DMOPEN',=C'CONTROL',A(FILIST),WKRBUF         
         SPACE                                                                  
         L     R2,=A(EZINPUTF)     FIXED BLOCKED DCF                            
         CLI   RECFM,C'F'                                                       
         BE    EZL80                                                            
         L     R2,=A(EZINPUTU)     UNDEFINED DCF                                
         CLI   RECFM,C'U'                                                       
         BE    EZL80                                                            
         L     R2,=A(EZINPUTV)     VARIABLE DCF                                 
         CLI   RECFM,C'V'                                                       
         BE    EZL80                                                            
         DC    H'0'                                                             
*                                                                               
EZL80    DS    0H                                                               
         ST    R2,AEZINPT                                                       
         SPACE                                                                  
         OPEN  ((R2),(INPUT))                                                   
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL84                YES                                         
         SPACE                                                                  
         MVC   P(19),=C'EZINPUT OPEN FAILED'                                    
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
EZL84    DS   0H                                                                
         XC    SVSRCE,SVSRCE       SET SVSRCE ZERO (USED AS FLAG)               
         CLI   TEST,C'Y'           IS THIS A TEST RUN                           
         BE    EZL90                YES, HOLD/WORK FILES                        
         SPACE                                                                  
         MVC   SVSRCE,SOURCE                                                    
         SPACE                                                                  
         OPEN  (EZHOLDR,(INPUT))                                                
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL86                YES                                         
         SPACE                                                                  
         MVC   P(19),=C'EZHOLDR OPEN FAILED'                                    
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
EZL86    OPEN  (EZWORKW,(OUTPUT))                                               
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL90                YES                                         
         SPACE                                                                  
         MVC   P(19),=C'EZWORKW OPEN FAILED'                                    
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
EZL90    CLI   TEST,C'Y'           IS THIS A TEST RUN                           
         BE    EZL96                YES, NO BILLING                             
         SPACE                                                                  
         OPEN  (EZBILLF,(OUTPUT))                                               
         SPACE                                                                  
         LTR   RF,RF               GOOD OPEN                                    
         BZ    EZL96                YES                                         
         SPACE                                                                  
         MVC   P(18),=C'EZBILL OPEN FAILED'                                     
         GOTO1 =V(PRINTER)                                                      
         B     BADINIT                                                          
         SPACE                                                                  
SRCERR   MVC   P(19),=C'NO SOURCE PARM CARD'                                    
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
BADINIT  CR    RB,RD               SET BAD COND CODE FOR INIT                   
         SPACE                                                                  
EZL96    XIT1                                                                   
VDDSIO   DC    V(DDSIO)                                                         
         LTORG                                                                  
         DROP  RB,RC                                                            
         EJECT                                                                  
*        GETFLD- RETURN A SINGLE FIELD                                          
*                                                                               
*        REGS - R2 = FIELD LENGTH                                               
*               R3 = CURRENT BYTE POINTER                                       
*               R4 = START OF FIELD                                             
*               R5 = WORK REG FOR TRAILING BLANKS                               
*               R6 = OUTPUT FIELD POINTER                                       
*                                                                               
         DS    0H                                                               
GETFLD   NMOD1 0,**GETF**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
         XC    RFDATA,RFDATA                                                    
         MVI   RFLEN,0                                                          
         XC    WLEN,WLEN                                                        
         XC    WDATA,WDATA                                                      
         SPACE                                                                  
         TM    RFCTL2,RFCTL2RD     TEST NEED READ NEXT REC                      
         BO    *+14                                                             
         SPACE                                                                  
         OC    RFCURPOS,RFCURPOS   TEST FIRST TIME                              
         BNZ   GETF10               NO                                          
*                                                                               
*  GET INPUT BLOCK OR RECORD FROM TAPE *                                        
*                                                                               
GETF00   DS    0H                                                               
         BAS   RE,GBL              YES- GET INPUT FILE BLOCK                    
*                                                                               
         L     R3,RFCURPOS         START WITH NEW BLOCK                         
*                                                                               
GETF10   DS    0H                                                               
         TM    RFCTL2,RFCTL2ER        TEST NEED TO SEND EOR                     
         BZ    GETF12                                                           
         NI    RFCTL2,X'FF'-RFCTL2ER  SET OFF END OF RECORD                     
         B     GETF36                  SET UP FOR EOR                           
*                                                                               
GETF12   DS    0H                                                               
         TM    RFCTL2,RFCTL2EF     TEST NEED TO SEND END OF FILE                
         BZ    GETF14                                                           
         NI    RFCTL2,X'FF'-RFCTL2EF  SET OFF EOF                               
         SPACE                                                                  
         OI    RFCTL,RFCTLEOF      SET END OF FILE                              
         B     GETFX               RETURN                                       
*                                                                               
GETF14   DS    0H                                                               
         TM    RFCTL,RFCTLEOF      END OF FILE SET                              
         BNZ   GETFX               RETURN                                       
*                                                                               
         TM    RFCTL,RFCTLEOR      AFTER EOR                                    
         BZ    GETF16                                                           
         MVI   RFFLDNO,0           RESET FIELD NUMBER                           
*                                                                               
GETF16   DS    0H                                                               
         L     R3,RFCURPOS                                                      
         ST    R3,RFFLDST          SAVE START OF FIELD                          
         SR    R2,R2               BYTE COUNTER                                 
         LA    R6,WDATA                                                         
         LR    R4,R6                                                            
         EJECT                                                                  
GETF20   DS    0H                                                               
         C     R3,EOR              TEST AT END OF PHYS BLOCK                    
         BL    GETF30               NO                                          
         SPACE                                                                  
*                                                                               
         OI    RFCTL2,RFCTL2RD     SET NEED TO READ NEXT REC                    
*                                                                               
         LTR   R2,R2               TEST HAVE FIELD TO HANDLE                    
         BZ    GETF24               NO, CK END OF RECORD                        
*                                                                               
         OI    RFCTL2,RFCTL2ER     SET DO EOR LATER                             
*                                                                               
         OI    RFCTL,X'10'         SET END OF FIELD                             
         B     GETF70              RETURN FIELD                                 
*                                                                               
GETF24   DS    0H                                                               
         TM    RFCTL,RFCTLEOR      TEST HAVE SENT EOR                           
         BZ    GETF36                                                           
         SPACE                                                                  
         TM    RFCTL2,RFCTL2EF     TEST NEED TO SEND END OF FILE                
         BZ    GETF26                                                           
         NI    RFCTL2,X'FF'-RFCTL2EF   SET OFF EOF                              
         OI    RFCTL,RFCTLEOF      SET END OF FILE                              
         B     GETFX               RETURN                                       
*                                                                               
GETF26   DS    0H                                                               
         TM    RFCTL,RFCTLEOF      END OF FILE SET                              
         BNZ   GETFX               RETURN                                       
         B     GETF00                                                           
*                                                                               
GETF30   CLC   RDELIM,0(R3)        TEST HAVE RECORD DELIM                       
         BNE   GETF40                                                           
*                                                                               
         LA    R3,L'RDELIM(,R3)    BUMP PAST RECORD DELIMITER                   
         ST    R3,RFCURPOS                                                      
*                                                                               
         CLI   RECFM,C'F'          FIXED BLOCKED RECS                           
         BNE   GETF32                                                           
         MVC   RFCURPOS,EOR        FORCE END OF RECORD                          
*                                                                               
GETF32   LTR   R2,R2               TEST HAVE FIELD TO HANDLE                    
         BZ    GETF34               NO                                          
*                                                                               
         OI    RFCTL2,RFCTL2ER     SET TO DO EOR LATER                          
         B     GETF70              RETURN FIELD                                 
*                                                                               
GETF34   DS    0H                  NO FIELD TO HANDLE                           
         CLI   RFFLDNO,0           HAVE THERE BEEN ANY FLDS                     
         BE    GETF20              NO- IGNORE                                   
*                                                                               
GETF36   DS    0H                                                               
         OI    RFCTL,RFCTLEOR      SEND EOR                                     
         L     RF,WRCURPOS                                                      
         MVC   0(L'RDELIM,RF),RDELIM                                            
         LA    RF,L'RDELIM(,RF)                                                 
         ST    RF,WRCURPOS                                                      
         B     GETFX                                                            
*                                                                               
GETF40   DS    0H                                                               
         CLC   FDELIM,0(R3)        TEST HAVE FIELD DELIM                        
         BE    GETF60                                                           
*                                  NO DELIMITER, CONTINUE                       
         LTR   R2,R2               IF HAVE NO DATA YET                          
         BNZ   GETF50                                                           
         SPACE                                                                  
* DO NOT STRIP BLANKS FROM DAY OF WEEK FIELD OF SCHEDULE LINE *                 
         SPACE                                                                  
         CLI   RFFLDNO,2           TEST FIELD 3 (BUT STILL SET AS 2)            
         BNE   GETF44                                                           
         CLC   RECTYP,SCHDTYP      TEST SCHEDULE LINE RECORD                    
         BE    GETF50               LEAVE BLANKS THERE                          
         SPACE                                                                  
GETF44   CLI   0(R3),C' '          IGNORE LEADING BLANKS                        
         BNH   GETF54                                                           
*                                                                               
GETF50   DS    0H                                                               
         MVC   0(1,R6),0(R3)                                                    
         SPACE                                                                  
         CLI   0(R3),C' '          DON'T FORCE                                  
         BNH   GETF52                                                           
         OI    0(R6),X'40'         FORCE ALL DATA TO UPPER CASE                 
         SPACE                                                                  
GETF52   LA    R2,1(,R2)           BUMP FIELD LENGTH                            
         LA    R6,1(,R6)           BUMP OUTPUT POINTER                          
         AP    OBYTS,=P'1'         ADD TO OUTPUT BYTES                          
GETF54   DS    0H                                                               
         LA    R3,1(,R3)           NEXT POS                                     
         AP    IBYTS,=P'1'         ADD TO INPUT BYTES                           
         B     GETF20                                                           
SCHDTYP  DC    CL2'41'                                                          
*                                                                               
GETF60   DS    0H                                                               
         LA    R3,L'FDELIM(,R3)    BUMP PAST FIELD DELIM                        
         ST    R3,RFCURPOS         SET NEW POS                                  
*                                                                               
GETF70   DS    0H                                                               
         LTR   R2,R2                                                            
         BNP   GETF80                                                           
         SPACE                                                                  
* DO NOT STRIP BLANKS FROM DAY OF WEEK FIELD OF SCHEDULE LINE *                 
         SPACE                                                                  
         CLI   RFFLDNO,2           TEST FIELD 3 (BUT STILL SET AS 2)            
         BNE   GETF72                                                           
         CLC   RECTYP,SCHDTYP      TEST SCHEDULE LINE RECORD                    
         BE    GETF76               LEAVE BLANKS THERE                          
         SPACE                                                                  
*                                  STRIP TRAILING BLANKS                        
GETF72   DS    0H                                                               
         LA    R5,0(R2,R4)                                                      
         BCTR  R5,0                R5 AT LAST BYTE                              
*                                                                               
GETF74   DS    0H                                                               
         CLI   0(R5),C' '                                                       
         BH    GETF76                                                           
         BCTR  R2,0                DECR LENGTH                                  
         BCT   R5,GETF74           PREVIOUS BYTE                                
*                                                                               
GETF76   DS    0H                                                               
         CH    R2,=H'255'                                                       
         BNH   GETF80                                                           
         OI    RFCTL,RFCTLFER      SET FIELD ERROR                              
         MVC   RFERRMSG,=CL20'ERR FLD LEN = XXXX'                               
         CVD   R2,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  RFERRMSG+14(4),DUB                                               
         L     R1,TMAXERRS                                                      
         LA    R1,1(,R1)                                                        
         ST    R1,TMAXERRS                                                      
         LA    R2,255                                                           
*                                                                               
GETF80   DS    0H                                                               
         NI    RFCTL,X'3F'         CLEAR END CONTROLS                           
         ZIC   RF,RFFLDNO          BUMP FIELD NUMBER                            
         LA    RF,1(RF)                                                         
         STC   RF,RFFLDNO                                                       
         STC   R2,RFLEN            SET FIELD LENGTH                             
*                                                                               
         LTR   R2,R2                                                            
         BNP   GETF84                                                           
         LR    RF,R2                                                            
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RFDATA(0),0(R4)                                                  
*                                                                               
GETF84   DS    0H                                                               
         LTR   R2,R2                                                            
         BP    *+6                                                              
         SR    R2,R2                                                            
         LA    R6,WDATA(R2)                                                     
         MVC   0(L'FDELIM,R6),FDELIM                                            
         LA    R2,L'FDELIM(,R2)      ADD LENGTH                                 
         STH   R2,WLEN               SET WORK FIELD LENGTH                      
*                                                                               
* NOW BUILD RECORD ITSELF                                                       
*                                                                               
         LH    RE,WLEN                                                          
         BCTR  RE,0                                                             
         L     RF,WRCURPOS                                                      
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RF),WDATA                                                    
         LA    RE,1(RE,RF)                                                      
         ST    RE,WRCURPOS                                                      
*                                                                               
GETFX    DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
* GET BLOCK FROM TAPE *                                                         
*                                                                               
         DS    0H                                                               
GBL      NTR1                                                                   
         SPACE                                                                  
         NI    RFCTL2,X'FF'-RFCTL2RD  SET OFF NEED READ NEXT REC                
         SPACE                                                                  
         L     R2,AEZINPT                                                       
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BZ    *+8                  NO                                          
         L     R2,=A(EZHOLDR)                                                   
         SPACE                                                                  
         L     R6,=A(EZINREC)                                                   
         XC    0(256,R6),0(R6)                                                  
*                                                                               
         GET   (R2),(R6)                                                        
         SPACE                                                                  
         OI    RFCTL,RFCTLREC      SET RECORD READ                              
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       MUST BE WORKING ON HOLD FILE                 
         BZ    GBL04                NO                                          
         SPACE                                                                  
         MVI   HOLDSW,C'H'         H=HOLD FILE FOR BATCH TOTALS                 
         SPACE                                                                  
         CLC   =X'F9F95E',4(R6)    DO NOT COUNT SOURCE/DATE RECS                
         BE    GBL06                                                            
         CLC   =X'F1F25E',4(R6)    DO NOT COUNT FILE TOTALS RECS                
         BE    GBL06                                                            
         L     RF,HDRDCT                                                        
         LA    RF,1(,RF)                                                        
         ST    RF,HDRDCT                                                        
         B     GBL06                                                            
         SPACE                                                                  
GBL04    CLC   =X'F1F25E',4(R6)    DO NOT COUNT FILE TOTALS RECS                
         BE    GBL06                                                            
         L     RF,EZRDCT                                                        
         LA    RF,1(,RF)                                                        
         ST    RF,EZRDCT                                                        
*                                                                               
* CHECK IF FIXED (BLOCKED) UNDEFINED OR VARIABLE BLOCK FORMAT *                 
*                                                                               
GBL06    LR    RF,R6               SET STARTING POS                             
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       WORKING ON HOLD FILE                         
         BZ    GBL10                TREAT AS VAR BLK (IT IS, TOO)               
         LA    RF,4(,RF)           SKIP PAST LENGTH                             
         ST    RF,RFCURPOS                                                      
         B     GBL16                                                            
         SPACE                                                                  
GBL10    CLI   RECFM,C'V'          IF VARIABLE FMT                              
         BNE   *+8                                                              
         LA    RF,4(,RF)           SKIP PAST LENGTH                             
         ST    RF,RFCURPOS                                                      
*                                                                               
         LH    RE,DCBLRECL-IHADCB(,R2)  REC LEN-FIXED/UNDEFINED FMT             
         CLI   RECFM,C'U'                                                       
         BE    GBL20                                                            
         LH    RE,82(,R2)          LENGTH OF RECORD IF FIXED BLOCKED            
         SPACE                                                                  
         CLI   RECFM,C'F'                                                       
         BE    GBL20                                                            
         CLI   RECFM,C'V'                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
GBL16    LH    RE,0(,R6)           LENGTH IF VARIABLE FMT                       
         SH    RE,=H'4'                                                         
         SPACE                                                                  
GBL20    DS    0H                                                               
         AR    RF,RE                                                            
         ST    RF,EOR              SET EOR                                      
         BAS   RE,TRCREAD          TRACE WORKER FILE RECORD                     
*                                                                               
* FIX SET END OF RECORD AND END OF FILE                                         
*                                                                               
         B     GETFX                                                            
         EJECT                                                                  
* END OF FILE ROUTINE FOR LOAD TAPE *                                           
         SPACE                                                                  
GETEOFH  DS    0H                  END OF HOLD FILE                             
         SPACE                                                                  
*                                  CLEAR STD TOP COMMENTS                       
         L     RE,=A(SAVSCT)                                                    
         LA    RF,SAVSCTLN         GET LENGTH                                   
         XCEF                                                                   
*                                  CLEAR STD BOTTOM COMMENTS                    
         SPACE                                                                  
         L     RE,=A(SAVSCB)                                                    
         LA    RF,SAVSCBLN         GET LENGTH                                   
         XCEF                                                                   
         XC    STAFLDS,STAFLDS     CLEAR STATION FIELDS                         
         XC    STAFLDSA,STAFLDSA                                                
         XC    AGYFLDS,AGYFLDS     CLEAR AGENCY FIELDS                          
         L     RE,=A(SAVPAY)                                                    
         LA    RF,SAVPAYLN                                                      
         XCEF                                                                   
         L     RE,=A(SAVAGY)                                                    
         LA    RF,SAVAGYLN                                                      
         XCEF                                                                   
         SPACE                                                                  
GETEOF   DS    0H                  END OF FILE                                  
         SPACE                                                                  
         TM    RFCTL,RFCTLREC      WAS A RECORD READ                            
         BZ    GETEOF20             NO                                          
         SPACE                                                                  
         TM    RFCTL,RFCTLEOR       TEST HAVE SENT EOR                          
         BNZ   GETEOF30                                                         
         SPACE                                                                  
         TM    RFCTL2,RFCTL2ER      IS SEND EOR NEXT SET                        
         BO    GETEOF10                                                         
*                                                                               
* TEST HERE FOR FOUND DELIMITER                                                 
*                                                                               
*                                                                               
* FIX SET END OF RECORD AND END OF FILE                                         
*                                                                               
         OI    RFCTL,RFCTLFER       SET FIELD ERROR                             
         MVC   RFERRMSG,=CL20'ERR NO REC DELIMITER'                             
         TM    RFCTL,RFCTLEFL       END OF FIELD SET                            
         BZ    *+10                                                             
         MVC   RFERRMSG,=CL20'ERR NO FLD/REC DELIM'                             
         L     R1,TMAXERRS                                                      
         LA    R1,1(,R1)                                                        
         ST    R1,TMAXERRS                                                      
*                                                                               
         OI    RFCTL,RFCTLEOR       SET EOR NOW                                 
         OI    RFCTL2,RFCTL2EF      AND DO EOFILE AFTER                         
         B     GETFX                                                            
*                                                                               
GETEOF10 OI    RFCTL,RFCTLEOR         SET EOR NOW                               
         NI    RFCTL2,X'FF'-RFCTL2ER  SET OFF EOR LATER                         
         OI    RFCTL2,RFCTL2EF        AND DO EOFILE AFTER                       
         B     GETFX                                                            
         SPACE                                                                  
GETEOF20 DS    0H                                                               
         OI    RFCTL2,RFCTL2RD        SET ON NEED READ NEXT REC                 
         SPACE                                                                  
GETEOF30 DS    0H                                                               
         OI    RFCTL,RFCTLEOF      SET EOFILE                                   
         B     GETFX                                                            
         EJECT                                                                  
*        TRCREAD- ROUTINE TO TRACE INPUT FILE READS                             
*                                                                               
TRCREAD  CLI   TRACEREC,C'Y'       TEST TRACING FIELDS                          
         BNER  RE                                                               
*                                                                               
         DS    0H                                                               
TRCREADN NTR1                                                                   
         MVC   P,SPACES                                                         
         GOTO1 =V(PRINTER)                                                      
         L     R6,=A(EZINREC)                                                   
         SPACE                                                                  
         OC    SVSRCE,SVSRCE       READING HOLD FILE                            
         BNZ   TRD3                 YES                                         
         SPACE                                                                  
         L     R2,AEZINPT                                                       
         LH    R2,82(R2)           LENGTH IF UNDEFINED                          
         CLI   RECFM,C'U'                                                       
         BE    TRD5                                                             
TRD3     LH    R2,0(R6)            LENGTH IF VARIABLE FMT                       
*                                                                               
TRD5     DS    0H                                                               
         MVC   P(5),=C'INPUT'                                                   
         EDIT  (R2),(4,P+6),FILL=0                                              
         LA    R3,0(R6,R2)         EOR                                          
*                                                                               
TRD6     LR    R4,R3                                                            
         SR    R4,R6                                                            
         BNP   TRD8                                                             
         CH    R4,=H'100'                                                       
         BNH   *+8                                                              
         LA    R4,100                                                           
*                                                                               
         BCTR  R4,R0                                                            
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   P+11(0),0(R6)                                                    
         LA    R4,1(R4)                                                         
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
         LA    R6,0(R6,R4)                                                      
         B     TRD6                                                             
*                                                                               
TRD8     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P,SPACES                                                         
         XIT1                                                                   
         DROP  RB,RC                                                            
         EJECT                                                                  
*        ENDBTCH - END OF BATCH ROUTINE                                         
*                                                                               
         DS    0H                                                               
ENDBTCH  NMOD1 0,**ENDB**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
* ROLL INVOICE COUNTS AND DOLLARS FOR POSSIBLE TOT REC CHECK                    
         SPACE                                                                  
         L     RF,BDOLG            BATCH SPOT DOLLARS (GROSS)                   
         CVD   RF,DUB                                                           
         AP    CDOLG,DUB                                                        
         L     RF,BDOLN            BATCH SPOT DOLLARS (GROSS)                   
         CVD   RF,DUB                                                           
         AP    CDOLN,DUB                                                        
         L     RF,BINVS            AND INVOICE COUNT FOR TOTAL CK               
         A     RF,CINVS                                                         
         ST    RF,CINVS                                                         
         SPACE                                                                  
         OC    ID,ID                                                            
         BZ    ENDB24                                                           
         CLI   SVEXCLSW,C'N'       SKIP EXPRESSLY EXCLUDED BATCHES              
         BNE   ENDB10                                                           
*                                                                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P(17),=C'INVOICES IN BATCH'                                      
         SPACE                                                                  
         EDIT  (B4,BINVS),(5,P+24),ZERO=NOBLANK                                 
         GOTO1 =V(PRINTER)                                                      
         MVC   P(5),=C'SPOTS'                                                   
         SPACE                                                                  
         EDIT  (B4,BSPTS),(5,P+24),ZERO=NOBLANK                                 
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P(7),=C'DOLLARS'                                                 
         SPACE                                                                  
         EDIT  (B4,BDOLN),(14,P+16),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES         
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
ENDB10   DS   0H                                                                
         CLI   TEST,C'Y'           IF TEST RUN                                  
         BE    ENDB20               SKIP CLOSE AND COUNTS                       
         SPACE                                                                  
         CLI   BATHSW,C'Y'         WAS BATCH OPENED                             
         BE    ENDB14                                                           
         SPACE                                                                  
         CLI   SVEXCLSW,C'Y'       IF EXCLSW WAS Y                              
         BE    ENDB20               SKIP ALL, WAS BYPASSED ON INPUT             
         SPACE                                                                  
         CLI   SVEXCLSW,C'I'       IF EXCLSW WAS EXCLUDE USER ID                
         BE    ENDB20                                                           
         SPACE                                                                  
         CLI   SVEXCLSW,C'S'       IF EXCLSW WAS EXCLUDE STATION                
         BE    ENDB20                                                           
         SPACE                                                                  
         CLI   SVEXCLSW,C'*'       IF EXCLSW WAS * UNKNOWN                      
         BE    ENDB16               SKIP CLOSE AND LOADED COUNTS                
         CLI   SVEXCLSW,C'#'       IF EXCLSW WAS FULL WORKER FILE               
         BE    ENDB16                                                           
         SPACE                                                                  
         DC    H'0'                BIG PROBLEM                                  
*                                                                               
ENDB14   DS   0H                                                                
         CLI   SVEXCLSW,C'N'       EXCLSW MUST HAVE BEEN N                      
         BE    *+6                                                              
         DC    H'0'                                                             
         L     RF,LBTCHS           BUMP LOADED BATCH TOTAL                      
         LA    RF,1(RF)                                                         
         ST    RF,LBTCHS                                                        
*                                                                               
         L     RF,BINVS            ROLL UP LOADED INV COUNT                     
         A     RF,LINVS                                                         
         ST    RF,LINVS                                                         
         L     RF,BSPTS            AND LOADED SPOT COUNT                        
         A     RF,LSPTS                                                         
         ST    RF,LSPTS                                                         
         L     RF,BDOLN            AND LOADED SPOT DOLLARS                      
         CVD   RF,DUB                                                           
         AP    LDOLN,DUB                                                        
         L     RF,BDOLG            AND LOADED SPOT DOLLARS                      
         CVD   RF,DUB                                                           
         AP    LDOLG,DUB                                                        
*                                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'CLOSE',WKRFIL,0,WKRREC,WKRBUF                
         SPACE                                                                  
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE                                                                  
         MVC   SVID,ID                                                          
         SPACE                                                                  
         L     RE,=A(SVINDXTB)     ADD TO SAVE BATCH ID TABLE                   
         LA    RF,SVINDXTE-1                                                    
SVIND10  OC    0(13,RE),0(RE)                                                   
         BZ    SVIND20                                                          
         LA    RE,13(,RE)                                                       
         BCT   RF,SVIND10                                                       
         DC    H'0'                                                             
SVIND20  MVC   0(12,RE),ID                                                      
         SPACE                                                                  
         MVC   12(1,RE),WKRFIL+4                                                
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,=C'INDEX',WKRFIL,ID,WKRREC,WKRBUF               
         SPACE                                                                  
         CLC   SVID(12),ID         SEE IF BATCH IS STILL OUT THERE              
         BE    ENDB20                                                           
         LA    R0,5                                                             
ENDB15   DS   0H                                                                
         MVC   P+5(22),=C'** BATCH IS MISSING **'                               
         GOTO1 =V(PRINTER)                                                      
         BCT   R0,ENDB15                                                        
         MVI   BADBATSW,C'*'       SET BAD MISSING BATCH                        
         B     ENDB20                                                           
*                                                                               
ENDB16   DS   0H                   ADD TO HELD TOTALS                           
         L     RF,HOBAT                                                         
         LA    RF,1(RF)                                                         
         ST    RF,HOBAT                                                         
         L     RF,BINVS                                                         
         A     RF,HOINVS                                                        
         ST    RF,HOINVS                                                        
         L     RF,BSPTS                                                         
         A     RF,HOSPTS                                                        
         ST    RF,HOSPTS                                                        
         L     RF,BDOLN                                                         
         CVD   RF,DUB                                                           
         AP    HODOLN,DUB                                                       
         L     RF,BDOLG                                                         
         CVD   RF,DUB                                                           
         AP    HODOLG,DUB                                                       
         SPACE                                                                  
ENDB20   DS   0H                                                                
         CLI   HOLDSW,C'H'         H=HOLD FILE FOR BATCH TOTALS                 
         BNE   ENDB22               NO                                          
         SPACE                                                                  
         MVI   HOLDSW,0            RESET                                        
         L     RF,BINVS            ROLL UP TO HOLD INPUT TOTALS                 
         A     RF,HIINVS                                                        
         ST    RF,HIINVS                                                        
         L     RF,BSPTS                                                         
         A     RF,HISPTS                                                        
         ST    RF,HISPTS                                                        
         L     RF,BDOLN                                                         
         CVD   RF,DUB                                                           
         AP    HIDOLN,DUB                                                       
         L     RF,BDOLG                                                         
         CVD   RF,DUB                                                           
         AP    HIDOLG,DUB                                                       
         SPACE                                                                  
         L     RF,HIBAT            BUMP HOLD INPUT BATCH COUNT                  
         LA    RF,1(RF)                                                         
         ST    RF,HIBAT                                                         
         B     ENDB23                                                           
         SPACE                                                                  
ENDB22   L     RF,BINVS            ROLL UP INVOICE COUNT                        
         A     RF,TINVS                                                         
         ST    RF,TINVS                                                         
         L     RF,BSPTS            ROLL UP SPOT COUNT                           
         A     RF,TSPTS                                                         
         ST    RF,TSPTS                                                         
         L     RF,BDOLN            ROLL UP SPOT DOLLARS                         
         CVD   RF,DUB                                                           
         AP    TDOLN,DUB                                                        
         L     RF,BDOLG            ROLL UP SPOT DOLLARS                         
         CVD   RF,DUB                                                           
         AP    TDOLG,DUB                                                        
*                                                                               
ENDB23   DS    0H                                                               
         L     RF,TBTCHS           BUMP TOTAL BATCH COUNT                       
         LA    RF,1(RF)                                                         
         ST    RF,TBTCHS                                                        
         SPACE                                                                  
         XC    BTOTS,BTOTS                                                      
         ZAP   BBYTS,=P'0'                                                      
*                                                                               
ENDB24   MVC   OLDSTA,STAFLDS                                                   
         MVC   OLDSTAD,STAFLDSA                                                 
         MVC   OLDAGY,AGYFLDS                                                   
         SPACE 2                                                                
* SEE IF THERE WAS A TOTAL RECORD                                               
         SPACE                                                                  
         OC    TOTINVS,TOTINVS     ANY TRANS TOTALS                             
         BNZ   ENDB200              NO                                          
         CP    TOTDOLS,=P'0'       ANY TRANS TOT REC                            
         BE    ENDB400              NO                                          
         SPACE                                                                  
ENDB200  LA    R2,TOTFILES                                                      
         LA    R0,L'TOTFILES                                                    
ENDB204  CLI   0(R2),0                                                          
         BE    ENDB206                                                          
         LA    R2,1(,R2)                                                        
         BCT   R0,ENDB204                                                       
         DC    H'0'                MAKE TOTFILES LARGER AREA (NOW 512)          
ENDB206  OI    0(R2),X'80'                                                      
*                                                                               
         OC    TOTINVS,TOTINVS     ANY TRANS TOTALS                             
         BZ    ENDB210              NO                                          
         CLC   CINVS,TOTINVS       WE FIND ALL THE INVOICES                     
         BNE   ENDB300              YES                                         
*                                                                               
ENDB210  CP    TOTDOLS,=P'0'       ANY TRANS TOT REC                            
         BE    ENDB360              NO                                          
*                                                                               
         CP    CDOLG,TOTDOLS       WE FIND ALL THE DOLLARS                      
         BE    ENDB360              YES                                         
*                                                                               
ENDB300  DS    0H                                                               
         OI    0(R2),X'08'          SET BAD FLAG                                
         MVI   P+1,C'*'                                                         
         MVC   P+2(99),P+1                                                      
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         L     R2,CINVS                                                         
         LA    R3,P+1                                                           
         BAS   RE,EDIT0B                                                        
         SPACE                                                                  
         MVC   P+8(13),=C'INVOICES READ'                                        
         SPACE                                                                  
         LA    R2,CDOLG                                                         
         LA    R3,P+40                                                          
         BAS   RE,EDIT2AB                                                       
         SPACE                                                                  
         MVC   P+55(12),=C'DOLLARS READ'                                        
         GOTO1 =V(PRINTER)                                                      
         L     R2,TOTINVS                                                       
         LA    R3,P+1                                                           
         BAS   RE,EDIT0B                                                        
         SPACE                                                                  
         MVC   P+8(20),=C'STATED INVOICES SENT'                                 
         SPACE                                                                  
         LA    R2,TOTDOLS                                                       
         LA    R3,P+40                                                          
         BAS   RE,EDIT2AB                                                       
         SPACE                                                                  
         MVC   P+55(19),=C'STATED DOLLARS SENT'                                 
         GOTO1 =V(PRINTER)                                                      
         MVI   P+1,C'*'                                                         
         MVC   P+2(99),P+1                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
ENDB360  XC    CINVS,CINVS                                                      
         ZAP   CDOLN,=P'0'                                                      
         ZAP   CDOLG,=P'0'                                                      
         XC    TOTINVS,TOTINVS     CLEAR BOTH TOTAL INVOICES & DOLLARS          
         ZAP   TOTDOLS,=P'0'                                                    
*                                                                               
ENDB400  DS    0H                                                               
         XIT1                                                                   
         SPACE                                                                  
         DS    0H                                                               
EDIT0B   NTR1                                                                   
         EDIT  ((R2)),(5,(R3)),ZERO=NOBLANK                                     
EDITXB   XIT1                                                                   
         SPACE                                                                  
         DS    0H                                                               
EDIT2AB  NTR1                                                                   
         EDIT  (P8,0(R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES         
         B     EDITXB                                                           
         DROP  RB,RC                                                            
         LTORG                                                                  
         EJECT                                                                  
*        CKADV - READ GENDIR/FIL FOR ADVNAME RECORD   *                         
*                THIS MAY FORCE INVOICE TO ANOTHER ID *                         
         SPACE                                                                  
CKADV    NMOD1 0,**CKADV*                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
         L     R1,RFRECST          START OF RECORD = FROM ADDRESS               
         SPACE                                                                  
         CLI   RECFM,C'U'          REC TYPE = U                                 
         BNE   CKADV14                                                          
CKADV10  DS   0H                                                                
         CLI   0(R1),0                                                          
         BH    CKADV14                                                          
         LA    R1,0(R1)                                                         
         B     CKADV10                                                          
         SPACE                                                                  
CKADV14  DS   0H                                                                
         B     CKADV16                                                          
         MVC   P+1(5),=C'CKADV'                                                 
         MVC   P+12(08),=C'STAFLDS='                                            
         MVC   P+20(8),STAFLDS                                                  
         MVC   P+30(09),=C'SVSTAFLD='                                           
         MVC   P+39(8),SVSTAFLD                                                 
         MVC   P+49(05),=C'USID='                                               
         MVC   P+54(8),USID                                                     
         MVC   P+61(09),=C'SVEQVSTA='                                           
         MVC   P+70(4),SVEQVSTA                                                 
         MVC   P+74(1),SVEQVMED                                                 
         GOTO1 =V(PRINTER)                                                      
CKADV16  DS   0H                                                                
         CLC   =C'31',0(R1)        THIS REALLY AN INVOICE REC                   
         BNE   CKADVX                                                           
         SPACE                                                                  
         XC    HALF,HALF                                                        
         XC    DUB,DUB                                                          
         SPACE                                                                  
         LA    R0,3                FIELDS BEFORE ADV NAME                       
         SPACE                                                                  
CKADV20  CLI   0(R1),X'5E'         THIS A FIELD DELIMITER                       
         BE    CKADV24                                                          
         CLI   0(R1),X'15'         THIS A RECORD DELIMITER                      
         BE    CKADVX               GET OUT                                     
         LA    R1,1(,R1)                                                        
         B     CKADV20                                                          
         SPACE                                                                  
CKADV24  LA    R1,1(,R1)                                                        
         BCT   R0,CKADV20                                                       
         SPACE                                                                  
* NOW PULL ADVNAME OUT OF RECORD                                                
         SPACE                                                                  
         MVC   NWADVNM,SPACES                                                   
         SPACE                                                                  
         LA    R0,25                                                            
         LA    RE,NWADVNM                                                       
CKADV26  DS   0H                                                                
         CLI   0(R1),X'5E'                                                      
         BE    CKADV30                                                          
         CLI   0(R1),X'15'         THIS A RECORD DELIMITER                      
         BE    CKADV30                                                          
         MVC   0(1,RE),0(R1)                                                    
         LA    R1,1(,R1)                                                        
         LA    RE,1(,RE)                                                        
         BCT   R0,CKADV26                                                       
         SPACE                                                                  
CKADV30  DS   0H                                                                
         MVC   SVADVNM,NWADVNM                                                  
         OC    NWADVNM,SPACES                                                   
         SPACE                                                                  
         LA    R0,9                FIELDS BEFORE MOS                            
         L     R1,RFRECST          START OF RECORD = FROM ADDRESS               
         SPACE                                                                  
         CLI   RECFM,C'U'          REC TYPE = U                                 
         BNE   CKADV36                                                          
CKADV34  DS   0H                                                                
         CLI   0(R1),0                                                          
         BH    CKADV36                                                          
         LA    R1,0(R1)                                                         
         B     CKADV34                                                          
         SPACE                                                                  
CKADV36  DS   0H                                                                
         MVC   WORK(4),SPACES                                                   
         SPACE                                                                  
CKADV40  CLI   0(R1),X'5E'         THIS A FIELD DELIMITER                       
         BE    CKADV42                                                          
         CLI   0(R1),X'15'         THIS A RECORD DELIMITER                      
         BE    CKADV48              NOT GOING TO FIND IT                        
         LA    R1,1(,R1)                                                        
         B     CKADV40                                                          
         SPACE                                                                  
CKADV42  LA    R1,1(,R1)                                                        
         BCT   R0,CKADV40                                                       
         SPACE                                                                  
* NOW PULL MOS OUT OF RECORD                                                    
         SPACE                                                                  
         LA    R0,4                                                             
         LA    RE,WORK                                                          
CKADV44  MVC   0(1,RE),0(R1)                                                    
         LA    R1,1(,R1)                                                        
         LA    RE,1(,RE)                                                        
         CLI   0(R1),X'5E'                                                      
         BE    CKADV46                                                          
         CLI   0(R1),X'15'         THIS A RECORD DELIMITER                      
         BE    CKADV46                                                          
         BCT   R0,CKADV44                                                       
         SPACE                                                                  
CKADV46  DS   0H                                                                
         MVC   INVMOS,WORK                                                      
         SPACE                                                                  
CKADV48  DS   0H                                                                
         CLI   DMGOPT,C'N'         FOR TESTING                                  
         BE    CKADVX               EXIT                                        
         SPACE                                                                  
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING EZDNMD,R4                                                        
         MVC   EZDKTYP,=C'ZD'                                                   
         MVC   EZDKAGY,AGENCY                                                   
         MVC   EZDKNAM,NWADVNM                                                  
         MVC   KEYSAVE,KEY                                                      
         GOTO1 =V(DATAMGR),DMCB,=C'DMRDHI',=C'GENDIR',KEY,KEY,DMWORK            
         CLC   KEY(32),KEYSAVE                                                  
         BE    CKADV50                                                          
         SPACE                                                                  
         OC    KEY(32),SPACES                                                   
         OC    KEYSAVE(32),SPACES                                               
         CLC   KEY(32),KEYSAVE                                                  
         BE    CKADV50                                                          
         SPACE                                                                  
         OC    SVADVIDN,SVADVIDN   IF NO PREV CHANGE, NONE NOW                  
         BZ    CKADVX                                                           
         XC    SVADVID,SVADVID                                                  
         XC    SVADVIDN,SVADVIDN                                                
         B     CKADVX                                                           
*                                                                               
CKADV50  DS    0H                                                               
         L     R4,=A(GENREC)                                                    
         GOTO1 =V(DATAMGR),DMCB,=C'GETREC',=C'GENFIL',KEY+EZDDDA-EZDKEYX        
               ,(R4),DMWORK                                                     
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LA    R5,EZDELS                                                        
         MVI   SVSTALEV,0                                                       
         SPACE                                                                  
CKADV60  CLI   0(R5),0             EOR                                          
         BE    CKADV70                                                          
*                                                                               
         CLI   0(R5),X'02'         AGY ID ELEM                                  
         BNE   CKADV64                                                          
*                                                                               
         USING EZDIDEL,R5                                                       
         LA    R6,EZDSTA                                                        
         GOTO1 =A(CHKSTA),DMCB,(RC)                                             
         SPACE                                                                  
         CLC   STALEV,SVSTALEV     TEST LEVEL OF STATION INFO                   
         BNH   CKADV64              IF NOT HIGH, IGNORE                         
         SPACE                                                                  
         MVC   SVSTALEV,STALEV                                                  
         SPACE                                                                  
         MVC   HALF,EZDORIG                                                     
         MVC   DUB,EZDUID                                                       
         MVC   SVIDSTA,EZDSTA      SAVE STATION,ETC OF BEST ELEM                
         SPACE                                                                  
CKADV64  ZIC   R0,1(R5)                                                         
         LTR   R0,R0                                                            
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     CKADV60                                                          
*                                                                               
CKADV70  DS   0H                                                                
         OC    HALF,HALF           IF NOTHING FOUND                             
         BZ    CKADVX               GET OUT                                     
         B     CKADVX               TEMP                                        
         SPACE                                                                  
         MVC   USIDNO,HALF                                                      
         MVC   USID,DUB                                                         
         SPACE                                                                  
CKADVX   DS  0H                                                                 
         DROP  R4,R5                                                            
         EJECT                                                                  
*        CKEQV - READ GENDIR/FIL FOR STATION EQUIVALENCE RECORD *               
*                THIS MAY FORCE INVOICE TO ANOTHER ID           *               
         SPACE                                                                  
* ALREADY GOT ADVERTISER NAME IN CKADV ROUTINE *                                
         SPACE                                                                  
         CLI   DMGOPT,C'N'         FOR TESTING                                  
         BE    CKEQVX               EXIT                                        
         SPACE                                                                  
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING EZSTAD,R4                                                        
         MVC   EZSKTYP,=C'ZS'                                                   
         MVC   EZSKAGY,AGENCY                                                   
         SPACE                                                                  
         OC    SVSTAFLD,SVSTAFLD   IS THIS AN EQUIVALENT STATION                
         BZ    CKEQV10                                                          
         SPACE                                                                  
         MVC   STAFLDS,SVSTAFLD    WORK WITH ORIG STATION                       
         SPACE                                                                  
CKEQV10  DS    0H                                                               
         MVC   EZSKSTA,STATION                                                  
         SPACE                                                                  
         MVI   EZSKSTA+4,C'T'                                                   
         CLI   MEDIA,C'T'            IF TV                                      
         BE    CKEQV20                                                          
         CLI   MEDIA,C'L'            IF LOW POWER TV                            
         BE    CKEQV20                                                          
         CLI   MEDIA,C' '            BLANK IS TV                                
         BE    CKEQV20                                                          
         CLI   MEDIA,0               NULL IS TV                                 
         BE    CKEQV20                                                          
         SPACE                                                                  
         MVI   EZSKSTA+4,C'N'                                                   
         CLI   MEDIA,C'C'            IF CABLE                                   
         BE    CKEQV20                                                          
         CLI   MEDIA,C'S'            OR SYND                                    
         BE    CKEQV20                                                          
         CLI   MEDIA,C'N'            OR NET                                     
         BE    CKEQV20                                                          
         SPACE                                                                  
         MVI   EZSKSTA+4,C'X'                                                   
         CLI   MEDIA,C'X'            NET RADIO                                  
         BE    CKEQV20                                                          
         SPACE                                                                  
         MVC   EZSKSTA+4(1),BAND                                                
         SPACE                                                                  
CKEQV20  DS    0H                                                               
         OC    KEY(32),SPACES                                                   
         MVC   KEYSAVE,KEY                                                      
         GOTO1 =V(DATAMGR),DMCB,=C'DMRDHI',=C'GENDIR',KEY,KEY,DMWORK            
         B     CKEQV30                                                          
         MVC   P+3(3),=C'KEYSAVE'                                               
         MVC   P+11(32),KEY                                                     
         GOTO1 =V(PRINTER)                                                      
         MVC   P+3(7),=C'KEYSAVE'                                               
         MVC   P+11(32),KEYSAVE                                                 
         GOTO1 =V(PRINTER)                                                      
CKEQV30  DS    0H                                                               
         CLC   KEY(32),KEYSAVE                                                  
         BNE   CKEQV70                                                          
         BNE   CKEQV80                                                          
         SPACE                                                                  
CKEQV50  DS    0H                                                               
         L     R4,=A(GENREC)                                                    
         GOTO1 =V(DATAMGR),DMCB,=C'GETREC',=C'GENFIL',EZSDDA-EZSKEY+KEYX        
               ,(R4),DMWORK                                                     
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LA    R5,EZSELS                                                        
         CLI   0(R5),X'02'         STATION ELEM                                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING EZSIDEL,R5                                                       
         MVC   SVEQVSTA,EZSCALL    SAVE EQUIVALENT STATION                      
         MVC   SVEQVMED,EZSMED     SAVE EQUIVALENT STATION                      
         SPACE                                                                  
         MVI   EQVSTASW,C'N'                                                    
         SPACE                                                                  
CKEQV60  CLI   0(R5),0             EOR                                          
         BE    CKEQV70                                                          
*                                                                               
         CLI   0(R5),X'22'         AGY ID ELEM                                  
         BNE   CKEQV64                                                          
*                                                                               
         USING EZAUDEL,R5                                                       
         OC    EZAUADV,SPACES                                                   
         SPACE                                                                  
         CLC   NWADVNM,EZAUADV    THIS SAME ADVERTISER NAME?                    
         BNE   CKEQV64              NOPE                                        
         SPACE                                                                  
         MVC   HALF,EZAUORIG                                                    
         MVC   DUB,EZAUUID                                                      
         SPACE                                                                  
         MVI   EQVSTASW,C'Y'                                                    
         B     CKEQV66                                                          
         SPACE                                                                  
*                                                                               
CKEQV64  DS    0H                                                               
         CLI   0(R5),X'32'         AGY ID/STA ELEM                              
         BNE   CKEQV66                                                          
*                                                                               
         USING EZAUSEL,R5                                                       
         OC    EZAUSADV,SPACES                                                  
         SPACE                                                                  
         CLC   NWADVNM,EZAUSADV    THIS SAME ADVERTISER NAME?                   
         BNE   CKEQV66              NOPE                                        
         SPACE                                                                  
         MVC   HALF,EZAUSORG                                                    
         MVC   DUB,EZAUSUID                                                     
         MVC   SVEQVSTA,EZSSCALL   SAVE EQUIVALENT STATION                      
         MVC   SVEQVMED,EZSSMED     AND MEDIA BAND                              
         SPACE                                                                  
         MVI   EQVSTASW,C'Y'                                                    
         SPACE                                                                  
CKEQV66  DS    0H                                                               
         ZIC   R0,1(R5)                                                         
         LTR   R0,R0                                                            
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     CKEQV60                                                          
*                                                                               
CKEQV70  DS   0H                                                                
         B     CKEQV74                                                          
         MVC   P+1(7),=C'CKEQV70'                                               
         MVC   P+8(1),EQVSTASW                                                  
         MVC   P+12(08),=C'STAFLDS='                                            
         MVC   P+20(8),STAFLDS                                                  
         MVC   P+30(09),=C'SVSTAFLD='                                           
         MVC   P+39(8),SVSTAFLD                                                 
         MVC   P+49(05),=C'USID='                                               
         MVC   P+54(8),USID                                                     
         MVC   P+61(09),=C'SVEQVSTA='                                           
         MVC   P+70(4),SVEQVSTA                                                 
         MVC   P+74(1),SVEQVMED                                                 
         GOTO1 =V(PRINTER)                                                      
CKEQV74  DS   0H                                                                
         OC    HALF,HALF           IF NOTHING FOUND                             
         BZ    CKEQV80              SEE IF SAVED STATION                        
         SPACE                                                                  
         MVC   USIDNO,HALF                                                      
         MVC   USID,DUB                                                         
         SPACE                                                                  
         CLI   EQVSTASW,C'Y'        USE EQUIVALENT STATION                      
         BNE   CKEQV80                                                          
         SPACE                                                                  
         OC    SVSTAFLD,SVSTAFLD   WAS STATION ALREADY SAVED                    
         BNZ   CKEQV76                                                          
         SPACE                                                                  
         MVC   SVSTAFLD,STAFLDS                                                 
         SPACE                                                                  
CKEQV76  DS   0H                                                                
         MVC   STATION,SVEQVSTA    USE EQUIVALENT STATION                       
         MVC   MEDIA(1),SVEQVMED                                                
         MVC   BAND(1),SVEQVMED                                                 
         B     CKEQVX                                                           
         SPACE                                                                  
CKEQV80  DS   0H                                                                
         B     CKEQV84                                                          
         MVC   P+1(7),=C'CKEQV80'                                               
         MVC   P+8(1),EQVSTASW                                                  
         MVC   P+12(08),=C'STAFLDS='                                            
         MVC   P+20(8),STAFLDS                                                  
         MVC   P+30(09),=C'SVSTAFLD='                                           
         MVC   P+39(8),SVSTAFLD                                                 
         MVC   P+49(05),=C'USID='                                               
         MVC   P+54(8),USID                                                     
         MVC   P+61(09),=C'SVEQVSTA='                                           
         MVC   P+70(4),SVEQVSTA                                                 
         MVC   P+74(1),SVEQVMED                                                 
         GOTO1 =V(PRINTER)                                                      
CKEQV84  DS   0H                                                                
         OC    SVSTAFLD,SVSTAFLD   WAS STATION ALREADY SAVED                    
         BZ    CKEQVX               NO, NO RESTORE NEEDED                       
         SPACE                                                                  
         MVC   STAFLDS,SVSTAFLD    RESTORE STATION AS SAVED                     
         XC    SVSTAFLD,SVSTAFLD                                                
         SPACE                                                                  
CKEQVX   DS  0H                                                                 
         XIT1                                                                   
         DROP  R4,R5,RB,RC                                                      
         EJECT                                                                  
*              READ GENDIR/FIL FOR USER ID FOR AGENCY/OFFICE                    
         SPACE 2                                                                
GETUID   NMOD1 0,**GETU**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         CLC   SOURCE,=C'WIM '     WIM SOURCE IS ALL WIBIS                      
         BNE   GU010                                                            
         MVC   USIDNO,=H'4001'                                                  
         MVC   USID,=CL8'WIBIS'                                                 
         MVC   AGENCY,=C'WI'                                                    
         B     GU034                                                            
         SPACE                                                                  
GU010    DS    0H                                                               
         CLC   SOURCE,=C'BDS '     BDS, MEDIA C, N OR S, FORCE TO SJR           
         BNE   GU020                                                            
         CLI   MEDIA,C'C'                                                       
         BE    GU030                                                            
         CLI   MEDIA,C'N'                                                       
         BE    GU030                                                            
         CLI   MEDIA,C'S'                                                       
         BE    GU030                                                            
         SPACE                                                                  
GU020    DS    0H                                                               
         CLI   DMGOPT,C'N'         FOR TESTING                                  
         BNE   GU040                                                            
         SPACE                                                                  
GU030    DS    0H                                                               
         MVC   USIDNO,=X'0011'       SJR                                        
         MVC   USID,=CL8'SJR'                                                   
         MVC   AGENCY,=C'SJ'                                                    
*                                                                               
GU034    DS    0H                                                               
         CLI   EXCLSW,C'#'         IS THIS WORKER FILE FULL                     
         BE    GETUIDX                                                          
*                                                                               
         MVI   EXCLSW,C'N'                                                      
         B     GETUIDX                                                          
*                                                                               
GU040    DS    0H                                                               
         CLI   EXCLSW,C'#'         TEST WORKER FILE FULL                        
         BE    GETUIDX                                                          
*                                                                               
         XC    USIDNO,USIDNO                                                    
         MVC   USID,=CL8'*UNKNOWN'                                              
*                                                                               
         MVI   STAMED,C'T'         MEDIA                                        
         CLI   MEDIA,C'T'                                                       
         BE    GU050                                                            
         CLI   MEDIA,C'L'          LOCAL CABLE IS MEDIA T                       
         BE    GU050                                                            
         CLI   MEDIA,0             ZERO IS TV ALSO                              
         BE    GU050                                                            
         CLI   MEDIA,C' '          BLANK IS TV ALSO                             
         BE    GU050                                                            
         MVI   STAMED,C'N'         MEDIA                                        
         CLI   MEDIA,C'N'          NETWORK                                      
         BE    GU050                                                            
         MVI   STAMED,C'C'         MEDIA                                        
         CLI   MEDIA,C'C'          NETWORK CABLE                                
         BE    GU050                                                            
         MVI   STAMED,C'S'         MEDIA                                        
         CLI   MEDIA,C'S'          NETWORK SYNDICATION                          
         BE    GU050                                                            
         MVI   STAMED,C'X'         MEDIA                                        
         CLI   MEDIA,C'X'          NETWORK RADIO                                
         BE    GU050                                                            
         MVC   STAMED,BAND         FOR RADIO USE BAND AS MEDIA                  
         SPACE                                                                  
GU050    XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING EZANMD,R4                                                        
         MVC   EZAKTYP,=C'ZA'                                                   
         MVC   EZAKNAM,AGYNAME                                                  
         MVC   KEYSAVE,KEY                                                      
         GOTO1 =V(DATAMGR),DMCB,=C'DMRDHI',=C'GENDIR',KEY,KEY,DMWORK            
         CLC   KEY(32),KEYSAVE                                                  
         BE    GU060                                                            
         OC    KEY(32),SPACES                                                   
         OC    KEYSAVE(32),SPACES                                               
         CLC   KEY(32),KEYSAVE                                                  
         BNE   GU300                                                            
*                                                                               
GU060    DS    0H                                                               
         GOTO1 =V(DATAMGR),DMCB,=C'GETREC',=C'GENFIL',EZADDA,          X        
               A(GENREC),DMWORK                                                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R4,=A(GENREC)                                                    
         LA    R5,EZAELS           FIRST ELEMENT                                
         MVI   SVSTALEV,0          SET LEVEL OF STATION INFO                    
*                                                                               
GU080    DS    0H                                                               
         CLI   0(R5),0             EOR                                          
         BE    GU200                                                            
         CLI   0(R5),X'02'         AGY ID ELEM                                  
         BE    GU120                                                            
         CLI   0(R5),X'05'         OFFICE ID ELEM                               
         BE    GU140                                                            
*                                                                               
GU090    DS    0H                                                               
         ZIC   R0,1(R5)                                                         
         LTR   R0,R0                                                            
         BNZ   *+6                                                              
         DC    H'0'                                                             
         AR    R5,R0                                                            
         B     GU080                                                            
*                                                                               
         USING EZAIDEL,R5                                                       
GU120    LA    R6,EZASTA                                                        
         GOTO1 =A(CHKSTA),DMCB,(RC)                                             
         SPACE                                                                  
         CLC   STALEV,SVSTALEV     TEST LEVEL OF STATION INFO                   
         BNH   GU090               IF NOT HIGH, IGNORE                          
         SPACE                                                                  
         MVC   SVSTALEV,STALEV                                                  
         SPACE                                                                  
         MVC   USIDNO,EZAORIG      ELSE SAVE ORIGIN                             
         MVC   USID,EZAUID                                                      
         MVC   SVIDSTA,EZASTA      SAVE STATION,ETC OF BEST ELEM                
         B     GU090                                                            
*                                                                               
         USING EZOIDEL,R5                                                       
GU140    DS    0H                                                               
*                                  TEST AGY ADDRESS FOR OFFICE NAME             
         ZIC   R7,1(R5)                                                         
         SH    R7,=Y(EZONAM-EZOIDEL)    R7 HAS NAME LENGTH                      
         GOTO1 =V(TSCAN),DMCB,AGYLIN1,120,((R7),EZONAM),               X        
               ((R7),EZONAM),0                                                  
*                                                                               
         CLI   DMCB+16,0           TEST NAME FOUND                              
         BE    GU090               NO- NEXT ELEM                                
         SPACE                                                                  
         LA    R6,EZOSTA                                                        
         GOTO1 =A(CHKSTA),DMCB,(RC)                                             
         SPACE                                                                  
         CLC   STALEV,SVSTALEV     TEST LEVEL OF STATION INFO                   
         BNH   GU090               IF NOT HIGH, IGNORE                          
         SPACE                                                                  
         MVC   SVSTALEV,STALEV                                                  
         SPACE                                                                  
         MVC   USIDNO,EZOORIG      ELSE SAVE ORIGIN                             
         MVC   USID,EZOUID                                                      
         MVC   SVIDSTA,EZOSTA      SAVE STATION,ETC OF BEST ELEM                
         B     GU090                                                            
         DROP  R5                                                               
*                                                                               
*                                  NOW CHECK FOR INCLUSION/EXCLUSION            
*                                                                               
GU200    DS    0H                                                               
         OC    USIDNO,USIDNO       TEST ID FOUND                                
         BZ    GU300                NO                                          
*                                                                               
         CLI   EXCLSW,C'#'         TEST WORKER FILE FULL                        
         BE    GETUIDX                                                          
*                                                                               
         CLI   EXCLSW,C'S'         TEST STATION EXCLUDED                        
         BE    GETUIDX                                                          
*                                                                               
         MVI   EXCLSW,C'N'                                                      
*                                                                               
         OC    IDTPARS+8(4),IDTPARS+8  TEST HAVE ANY ID LIST                    
         BZ    GU400                    NO, OK                                  
*                                                                               
         MVC   WORK(8),USID        SEE IF THIS ONE IN LIST                      
         GOTO1 =V(BINSRCH),IDTPARS,WORK                                         
         CLI   0(R1),0                                                          
         BNE   GU220                                                            
*                                  ID IS IN LIST                                
         CLI   IDMODE,C'+'       TEST TO INCLUDE ONLY THOSE IN LIST             
         BE    GU400                                                            
         B     GU240                                                            
*                                                                               
GU220    DS    0H                  ID NOT IN LIST                               
         CLI   IDMODE,C'+'         TEST TO INCLUDE ONLY THOSE IN LIST           
         BNE   GU400                                                            
*                                                                               
GU240    MVI   EXCLSW,C'I'         EXCLUDE USER ID                              
         B     GETUIDX                                                          
*                                                                               
GU300    DS    0H                                                               
         MVI   EXCLSW,C'*'         SET TO EXCLUDE BECAUSE NOT FOUND             
         B     GETUIDX                                                          
*                                                                               
GU400    DS    0H                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CTIKEY,R4                                                        
         MVI   CTIKTYP,C'I'                                                     
         MVC   CTIKID+8(2),USIDNO                                               
         L     R4,=A(GENREC)                                                    
         GOTO1 =V(DATAMGR),DMCB,=C'DMREAD',=C'CTFILE',KEY,(R4),DMWORK           
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         LA    R6,CTIDATA                                                       
GU500    DS    0H                                                               
         CLI   0(R6),0             EOR                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLI   0(R6),X'06'         AGY ID ELEM                                  
         BE    GU540                                                            
*                                                                               
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     GU500                                                            
         USING CTAGYD,R6                                                        
GU540    MVC   AGENCY,CTAGYID                                                   
         SPACE                                                                  
GETUIDX  DS    0H                                                               
         XIT1                                                                   
         DROP  R4,R6,RB,RC                                                      
         EJECT                                                                  
*        CHKSTA- CHECK STATION IN IDELEM                                        
*        (R6 POINTS TO STATION-MEDIA)                                           
*                                                                               
         DS    0H                                                               
CHKSTA   NMOD1 0,**CKST**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SR    R2,R2               START AT LEVEL 0                             
         SPACE                                                                  
         CLI   0(R5),02            THIS AN AGENCY ELEMENT                       
         BE    CKS06                                                            
         CLI   0(R5),05            THIS AN OFFICE ELEMENT                       
         BE    CKS04                                                            
         DC    H'0'                                                             
CKS04    DS   0H                                                                
         LA    R2,10(,R2)          OFFICE IS MORE SPECIFIC THAN AGENCY          
         SPACE                                                                  
CKS06    DS   0H                                                                
         CLC   0(4,R6),=C'ALL '    STATION MUST BE ALL                          
         BNE   CKS10                                                            
         LA    R2,1(,R2)                                                        
*                                  MEDIA A IS LOWEST SPECIFICITY                
*                                  BUT IS STORED AS BLANK                       
         B     CKS20                                                            
         SPACE                                                                  
CKS10    CLC   0(4,R6),STATION     OR = TO THIS STATION                         
         BNE   CKSX                                                             
         LA    R2,10(,R2)        IF FOR STATION START AT HIGHER LEVEL           
         SPACE                                                                  
CKS20    DS    0H                                                               
         CLI   4(R6),C' '          MEDIA BLANK IS LOWEST SPECIFICITY            
         BE    CKSX                                                             
         CLI   4(R6),C'A'          MEDIA ALL ALSO                               
         BE    CKSX                                                             
         LA    R2,1(R2)                                                         
         CLI   4(R6),C'R'          ALL RADIO IS NEXT                            
         BNE   CKS40                                                            
         CLI   STAMED,C'A'           AM                                         
         BE    CKSX                                                             
         CLI   STAMED,C'F'           FM                                         
         BE    CKSX                                                             
         B     CKS50                                                            
         SPACE                                                                  
CKS40    CLI   4(R6),C'N'          ALL NETWORK IS NEXT                          
         BNE   CKS50                                                            
         CLI   STAMED,C'N'           NETWORK                                    
         BE    CKSX                                                             
         CLI   STAMED,C'C'           CABLE                                      
         BE    CKSX                                                             
         CLI   STAMED,C'S'           SYNDICATION                                
         BE    CKSX                                                             
         SPACE                                                                  
CKS50    DS    0H                                                               
         LA    R2,1(R2)            THEN ACTUAL MEDIA/BAND                       
         CLC   4(1,R6),STAMED                                                   
         BE    CKSX                                                             
*                                                                               
         SR    R2,R2               ELSE FAILS ON MEDIA                          
*                                                                               
CKSX     DS    0H                                                               
         STC   R2,STALEV                                                        
         XIT1                                                                   
         LTORG                                                                  
         DROP  RB,RC                                                            
         EJECT                                                                  
*        NEWIND - BUILD NEW WORKER INDEX AND PRINT HEADLINES                    
         SPACE 2                                                                
         DS    0H                                                               
NEWIND   NMOD1 0,**NEWI**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         MVI   SVRECSW,X'FF'       SET NEED TO PUT ALL SAVES                    
         XC    ID,ID                                                            
         LA    R4,ID                                                            
         USING EZWKRIXD,R4                                                      
*                                                                               
         MVI   BATHSW,C'N'         SET TO NO BATCH OPEN                         
         SPACE                                                                  
         MVC   EZWISTN,STATION     CALL LETTERS                                 
         MVI   EZWIDAY,X'99'       DAY = 99                                     
         MVI   EZWIMED,C'T'        MEDIA                                        
         CLI   MEDIA,C'T'                                                       
         BE    NI10                                                             
         CLI   MEDIA,C'L'          LOCAL CABLE IS MEDIA T                       
         BE    NI10                                                             
         CLI   MEDIA,0             ZERO IS TV ALSO                              
         BE    NI10                                                             
         CLI   MEDIA,C' '          BLANK IS TV ALSO                             
         BE    NI10                                                             
         MVI   EZWIMED,C'N'        MEDIA                                        
         CLI   MEDIA,C'N'          NETWORK                                      
         BE    NI10                                                             
         MVI   EZWIMED,C'C'        MEDIA                                        
         CLI   MEDIA,C'C'          NETWORK CABLE                                
         BE    NI10                                                             
         MVI   EZWIMED,C'S'        MEDIA                                        
         CLI   MEDIA,C'S'          NETWORK SYNDICATION                          
         BE    NI10                                                             
         MVI   EZWIMED,C'X'        MEDIA                                        
         CLI   MEDIA,C'X'          NETWORK RADIO                                
         BE    NI10                                                             
         MVC   EZWIMED,BAND        FOR RADIO USE BAND AS MEDIA                  
*                                                                               
NI10     DS    0H                      TEST FOR STATION INCL/EXCL               
         MVC   BILSTA(4),EZWISTN                                                
         MVC   BILSTA+4(1),EZWIMED                                              
         SPACE                                                                  
         CLI   EXCLSW,C'*'         THIS UNKNOWN AGENCY                          
         BE    NI24                                                             
         SPACE                                                                  
         MVI   EXCLSW,C'N'                                                      
*                                                                               
         OC    IDTPARS+8(4),IDTPARS+8   TEST HAVE ANY ID LIST                   
         BZ    NI16                      NO, OK                                 
         MVC   WORK(8),USID             SEE IF THIS ONE IN LIST                 
*                                                                               
         GOTO1 =V(BINSRCH),IDTPARS,WORK                                         
         CLI   0(R1),0                                                          
         BNE   NI12                                                             
*                                  ID IS IN LIST                                
         CLI   IDMODE,C'+'       TEST TO INCLUDE ONLY THOSE IN LIST             
         BE    NI16                                                             
*                                  ID IS IN LIST                                
         B     NI14                                                             
*                                                                               
NI12     DS    0H                  ID NOT IN LIST                               
         CLI   IDMODE,C'+'         TEST TO INCLUDE ONLY THOSE IN LIST           
         BNE   NI16                                                             
*                                                                               
NI14     MVI   EXCLSW,C'I'         EXCLUDED USER ID                             
         B     NIX                                                              
         SPACE                                                                  
NI16     OC    STTPARS+8(4),STTPARS+8  TEST HAVE ANY STATION LIST               
         BZ    NI24                NO, OK                                       
         MVC   WORK(4),EZWISTN     SEE IF THIS ONE IN LIST                      
         OI    WORK+3,X'40'                                                     
         MVC   WORK+4(1),EZWIMED                                                
         GOTO1 =V(BINSRCH),STTPARS,WORK                                         
         CLI   0(R1),0                                                          
         BNE   NI20                                                             
*                                  STATION IS IN LIST                           
         CLI   STMODE,C'+'       TEST TO INCLUDE ONLY THOSE IN LIST             
         BE    NI24                                                             
         B     NI22                                                             
*                                                                               
NI20     DS    0H                  STATION NOT IN LIST                          
         CLI   STMODE,C'+'         TEST TO INCLUDE ONLY THOSE IN LIST           
         BNE   NI24                                                             
NI22     MVI   EXCLSW,C'S'         EXCLUDE STATION                              
         B     NIX                                                              
*                                                                               
NI24     DS    0H                                                               
         SPACE                                                                  
         MVC   LINE,=PL2'200'      FORCE NEW PAGE                               
         MVC   P(6),=C'SOURCE'                                                  
         MVC   P+10(4),SOURCE                                                   
         MVC   P+20(L'STACSYS),STACSYS  DISPLAY STATION COMPUTER SYSTEM         
         SPACE                                                                  
         OC    HOLDDATE,HOLDDATE   IS THIS AN OLD BATCH                         
         BZ    NI30                 NO                                          
         MVC   P+40(9),=C'EZLOAD OF'                                            
         GOTO1 =V(DATCON),DMCB,(0,HOLDDATE),(5,P+50)                            
NI30     DS    0H                                                               
         CLI   TEST,C'Y'                                                        
         BNE   NI34                                                             
         MVC   P+47(10),=C'(TEST RUN)'                                          
NI34     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         CLI   EXCLSW,C'*'         EXCLUDE SWITCH = UNKNOWN AGY                 
         BE    NI50                DON'T OPEN                                   
         SPACE                                                                  
         CLI   EXCLSW,C'I'         EXCLUDE SWITCH = EXCLUDE USER ID             
         BE    NI50                DON'T OPEN                                   
         SPACE                                                                  
         CLI   EXCLSW,C'S'         EXCLUDE SWITCH = EXCLUDE STATION             
         BE    NI50                DON'T OPEN                                   
         SPACE                                                                  
         MVC   ID(2),USIDNO                                                     
         MVC   SVID,ID                                                          
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,(0,=C'GFILE'),=C'WRKFIL',ID,WKRREC,    C        
               WKRBUF                                                           
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE                                                                  
         USING UKRECD,R4                                                        
         MVC   WKRFIL,UKUSRINF                                                  
         DROP  R4                                                               
         SPACE                                                                  
         CLI   EXCLSW,C'N'         EXCLUDE SWITCH                               
         BNE   NI49                DON'T OPEN                                   
         SPACE                                                                  
         MVC   ID,SVID                                                          
         SPACE                                                                  
         CLI   TEST,C'Y'                                                        
         BE    NI49                                                             
         SPACE                                                                  
         L     R5,WKRREC                                                        
         XC    0(WLSOFEND-WLHDRD,R5),0(R5)                                      
         USING WLHDRD,R5                                                        
         SPACE                                                                  
         MVC   WLINDEX,ID                                                       
         SPACE                                                                  
         MVC   WLAGELD,TODAYC                                                   
         MVC   WLDATEL,TODAYC                                                   
*        MVC   WLAGEDD,=X'FFFF'                                                 
         XC    WLUDATA,WLUDATA                                                  
         LA    R0,4                                                             
         LA    R1,INVMOS                                                        
NI35     CLI   0(R1),C'0'          SEE IF 4 DIGITS                              
         BL    NI35C                                                            
         CLI   0(R1),C'9'                                                       
         BH    NI35C                                                            
         LA    R1,1(,R1)                                                        
         BCT   R0,NI35                                                          
         PACK  DUB,INVMOS                                                       
         ICM   R0,7,DUB+5                                                       
         SRL   R0,4                                                             
         STCM  R0,3,WLUDATA                                                     
         SPACE                                                                  
NI35C    DS    0H                                                               
         MVC   WLAGELT,=X'FFFF'                                                 
         MVC   WLRETNL,=X'FFFF'                                                 
         MVC   WLRETND,=X'FFFF'                                                 
*                                                                               
         LA    R5,WLDESC           COMMENT AREA                                 
         USING EZWKRCMD,R5                                                      
*                                  NO COMMENT DATA AT THIS POINT                
         XC    EZWCMNT,EZWCMNT                                                  
         MVC   EZWCSRCE,SOURCE                                                  
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,=C'OPEN',WKRFIL,0,WKRREC,WKRBUF                 
         SPACE                                                                  
         CLI   DMCB+8,0            ANY ERROR                                    
         BE    NI40                 NO                                          
         SPACE                                                                  
         MVI   EXCLSW,C'#'         SET TO EXCLUDE WORKER FILE FULL              
         SPACE                                                                  
         TM    8(R1),X'80'         WORKER FILE FULL                             
         BZ    NI36                                                             
         SPACE                                                                  
         MVC   P+45(38),=C'* WORKER FILE FULL, BATCH NOT LOADED *'              
         SPACE                                                                  
         L     RF,TFULBAT                                                       
         LA    RF,1(,RF)                                                        
         ST    RF,TFULBAT                                                       
         B     NI49                                                             
         SPACE                                                                  
NI36     TM    8(R1),X'41'         FORMAT ERROR                                 
         BNO   NI38                                                             
         SPACE                                                                  
         DC    H'0'                BAD, BAD ERROR                               
         SPACE                                                                  
NI38     TM    8(R1),X'40'         DISK ERROR                                   
         BO    *+6                                                              
         DC    H'0'                DO NOT KNOW WHAT IS UP, DIE                  
         SPACE                                                                  
         MVC   P+50(37),=C'* WORKER FILE ERR, BATCH NOT LOADED *'               
         SPACE                                                                  
         B     NI49                                                             
         SPACE                                                                  
NI40     DS   0H                                                                
         MVI   BATHSW,C'Y'         SET TO BATCH OPEN                            
         SPACE                                                                  
         L     R1,WKRBUF                                                        
         SPACE                                                                  
         LA    R5,W_DESC-W_RECD(,R1)                                            
         USING EZWKRCMD,R5                                                      
*                                  FIX BLANKED OUT AREA                         
         XC    EZWCMNT,EZWCMNT                                                  
         MVC   EZWCSRCE,SOURCE                                                  
         DROP  R5                                                               
         SPACE                                                                  
         MVC   ID,0(R1)                                                         
         SR    R0,R0                                                            
         ICM   R0,3,ID+W_FILENO-W_INDEX                                         
         BNZ   *+6                                                              
         DC    H'0'                                                             
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         MVC   P+20(8),=C'WKR SEQ='                                             
         UNPK  P+28(5),DUB                                                      
         SPACE                                                                  
         L     RE,=A(DUPSEQTB)     CLEAR DUPLICATE SEQ CK TBL                   
         LA    RF,DUPSEQTE                                                      
NI44     OC    0(4,RE),0(RE)                                                    
         BZ    NI48                                                             
         CLC   ID(2),0(RE)                                                      
         BNE   NI46                                                             
         CLM   R0,3,2(RE)                                                       
         BNE   NI46                                                             
         DC    H'0'                NEVER, EVER SHOULD HAVE DUPLICATE            
NI46     LA    RE,4(,RE)                                                        
         BCT   RF,NI44                                                          
         DC    H'0'                                                             
NI48     MVC   0(2,RE),ID                                                       
         STCM  R0,3,2(RE)                                                       
         SPACE                                                                  
* ADD TO WORKER FILE TABLE COUNT *                                              
         SPACE                                                                  
NI49     LA    R0,8                                                             
         LA    R1,WKRTAB                                                        
         CLC   0(1,R1),WKRFIL+4    THIS THE FILE                                
         BE    *+14                 YES, ADD 1 TO COUNT                         
         LA    R1,4(,R1)                                                        
         BCT   R0,*-14             TRY 8 TIMES                                  
         DC    H'0'                                                             
         AP    1(3,R1),=P'1'                                                    
         SPACE                                                                  
         MVC   P+38(5),=C'WKRF='                                                
         MVC   P+43(1),WKRFIL+4                                                 
         SPACE                                                                  
NI50     DS    0H                                                               
         MVC   P(7),=C'STATION'                                                 
         MVC   P+10(4),STATION                                                  
         MVI   P+14,C'-'                                                        
         USING EZWKRIXD,R4                                                      
         MVC   P+15(2),BAND        SHOW -AM/-FM/-TV/-N/-C/-S                    
         SPACE                                                                  
         CLC   BAND,SPACES         IS THERE ANYTHING IN BAND                    
         BH    *+10                                                             
         MVC   P+15(2),MEDIA       THEN USE MEDIA                               
         SPACE                                                                  
         CLI   EQVSTASW,C'Y'       THIS EQUIVALENT STATION                      
         BNE   NI54                 NOPE                                        
         SPACE                                                                  
         MVC   P+60(19),=C'EQUIVALENT  SENT AS'                                 
         MVC   P+80(5),SVSTAFLD                                                 
         SPACE                                                                  
NI54     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         MVC   P(7),=C'USER ID'                                                 
         MVC   P+10(8),USID                                                     
         MVI   P+19,C'('                                                        
         MVI   P+24,C')'                                                        
         EDIT  (B2,USIDNO),(4,P+20),FILL=0                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P(7),=C'AGENCY '                                                 
         MVC   P+10(25),AGYNAME                                                 
         OC    P+10(25),SPACES                                                  
         SPACE                                                                  
         MVC   SVAGYFL,AGYFLDS     SAVE FOR ADDING TO AGENCY NAME TABLE         
         MVC   SVMEDIA,MEDIA                                                    
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
*                                                                               
         LA    R4,AGYLIN1          AGENCY ADDRESS LINES                         
         LA    R5,4                                                             
*                                                                               
NI60     DS    0H                                                               
         CLI   0(R4),C' '                                                       
         BNH   NI64                                                             
         MVC   P+10(30),0(R4)                                                   
         OC    P+10(30),SPACES                                                  
         GOTO1 =V(PRINTER)                                                      
NI64     DS    0H                                                               
         LA    R4,30(R4)                                                        
         BCT   R5,NI60                                                          
*                                                                               
         CLI   EXCLSW,C'N'                                                      
         BE    NI70                                                             
         GOTO1 =V(PRINTER)                                                      
         MVC   P(36),=C'** BATCH NOT ADDED TO WORKER FILE **'                   
         GOTO1 =V(PRINTER)                                                      
*                                                                               
NI70     DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         L     R4,=A(COLHDS1)                                                   
         MVC   P,0(R4)             COLUMN HEADINGS                              
         GOTO1 =V(PRINTER)                                                      
         MVC   P,132(R4)                                                        
         GOTO1 =V(PRINTER)                                                      
*                                                                               
NIX      DS    0H                                                               
         XIT1                                                                   
         LTORG                                                                  
         DROP  R4                                                               
         SPACE                                                                  
* COUNTS OF BATCHES TO WHICH WORKER FILE *                                      
         SPACE                                                                  
WKRTAB   DC    C'1',PL3'0'                                                      
         DC    C'2',PL3'0'                                                      
         DC    C'3',PL3'0'                                                      
         DC    C'4',PL3'0'                                                      
         DC    C'5',PL3'0'                                                      
         DC    C'6',PL3'0'                                                      
         DC    C'7',PL3'0'                                                      
         DC    C'8',PL3'0'                                                      
         EJECT                                                                  
*        RUNTOT - PRINT ALL RUN TOTALS *                                        
         SPACE 2                                                                
         DS    0H                                                               
RUNTOT   NMOD1 0,**RUNT**                                                       
         L     RC,0(,R1)                                                        
         USING EZLDWKD,RC                                                       
         SPACE                                                                  
         MVC   P+2(10),=C'RUN TOTALS'                                           
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(10),DASHES                                                   
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+15(9),=C'**INPUT**'                                            
         GOTO1 =V(PRINTER)                                                      
         MVC   P+10(19),DASHES                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(7),=C'EZINPUT'                                               
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(14),=C'TOTAL INVOICES'                                       
         L     R2,TINVS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         MVC   P+35(12),=C'CLIENT CODES'                                        
         L     R2,TCLTCDS                                                       
         LA    R3,P+47                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         MVC   P+60(13),=C'PRODUCT CODES'                                       
         L     R2,TPRDCDS                                                       
         LA    R3,P+74                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         MVC   P+90(14),=C'ESTIMATE CODES'                                      
         L     R2,TESTCDS                                                       
         LA    R3,P+104                                                         
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+8(5),=C'SPOTS'                                                 
         L     R2,TSPTS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+8(7),=C'DOLLARS'                                               
         LA    R2,TDOLN                                                         
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         LA    R2,TDOLG                                                         
         LA    R3,P+30                                                          
         BAS   RE,EDIT2A                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'BATCHES'                                               
         L     R2,TBTCHS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'RECORDS'                                               
         L     R2,EZRDCT           EZINPUT FILE RECORD COUNT                    
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         LA    R2,IBYTS            INPUT BYTES                                  
         LA    R3,P+40                                                          
         BAS   RE,EDIT8                                                         
         MVC   P+54(14),=C'RECEIVED BYTES'                                      
         LA    R2,OBYTS            OUTPUT BYTES                                 
         LA    R3,P+70                                                          
         BAS   RE,EDIT8                                                         
         MVC   P+84(12),=C'WORKER BYTES'                                        
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         CLI   BADBATSW,0          ANY BAD (MISSING) BATCHES                    
         BE    RUNT10               NO                                          
         MVI   P+5,C'*'                                                         
         MVC   P+6(44),P+5                                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P+5(44),=C'* BATCHES LOADED ARE MISSING FROM THE FILE *'         
         GOTO1 =V(PRINTER)                                                      
         MVI   P+5,C'*'                                                         
         MVC   P+6(44),P+5                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
RUNT10   DS    0H                                                               
         LA    R2,8                                                             
         L     R3,=A(WKRTAB)                                                    
         LA    R4,P+3                                                           
RUNT20   MVC   0(6,R4),=C'WRKFN='                                               
         MVC   4(1,R4),0(R3)                                                    
         EDIT  (P3,1(R3)),(6,6(R4)),COMMAS=YES,ALIGN=LEFT,ZERO=NOBLANK          
         LA    R3,4(,R3)                                                        
         LA    R4,13(,R4)                                                       
         BCT   R2,RUNT20                                                        
         GOTO1 =V(PRINTER)                                                      
RUNT60   GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(10),=C'HOLD INPUT'                                           
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(14),=C'TOTAL INVOICES'                                       
         L     R2,HIINVS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         MVC   P+8(5),=C'SPOTS'                                                 
         L     R2,HISPTS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'DOLLARS'                                               
         LA    R2,HIDOLN                                                        
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         LA    R2,HIDOLG                                                        
         LA    R3,P+30                                                          
         BAS   RE,EDIT2A                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'BATCHES'                                               
         L     R2,HIBAT                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+8(7),=C'RECORDS'                                               
         L     R2,HDRDCT           INPUT HOLD FILE RECORD COUNT                 
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         OC    TDELINV,TDELINV     WERE THERE ANY DEL PREV INVOICES             
         BZ    EZR140               NO                                          
         SPACE                                                                  
         MVC   P(13),=C'TOTAL DEL INV'                                          
         L     R2,TDELINV                                                       
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
EZR140   GOTO1 =V(PRINTER)                                                      
         CLI   TEST,C'Y'           IF TEST RUN                                  
         BE    EZR150               SKIP OUTPUT COUNTS                          
         SPACE                                                                  
* PRINT OUTPUT TOTALS HERE (NONE FOR TEST RUN) *                                
         SPACE                                                                  
         MVC   P+15(10),=C'**OUTPUT**'                                          
         GOTO1 =V(PRINTER)                                                      
         MVC   P+10(20),DASHES                                                  
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(15),=C'LOADED INVOICES'                                      
         L     R2,LINVS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+9(5),=C'SPOTS'                                                 
         L     R2,LSPTS                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         MVC   P+9(7),=C'DOLLARS'                                               
         LA    R2,LDOLN                                                         
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         SPACE                                                                  
         LA    R2,LDOLG                                                         
         LA    R3,P+32                                                          
         BAS   RE,EDIT2A                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+9(7),=C'BATCHES'                                               
         L     R2,LBTCHS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+2(11),=C'HOLD OUTPUT'                                          
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(13),=C'HELD INVOICES'                                        
         L     R2,HOINVS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(5),=C'SPOTS'                                                 
         L     R2,HOSPTS                                                        
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(7),=C'DOLLARS'                                               
         LA    R2,HODOLN                                                        
         LA    R3,P+16                                                          
         BAS   RE,EDIT2A                                                        
         LA    R2,HODOLG                                                        
         LA    R3,P+32                                                          
         BAS   RE,EDIT2A                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(7),=C'BATCHES'                                               
         L     R2,TUNKINV                                                       
         A     R2,TFULINV                                                       
         C     R2,HOINVS                                                        
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R2,HOBAT                                                         
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+7(7),=C'RECORDS'                                               
         L     R2,WORKCT           OUTPUT HOLD FILE RECORD COUNT                
         LA    R3,P+24                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         L     R2,=A(SVINDXTB)     SAVED BATCH ID'S TABLE                       
         LA    R3,SVINDXTE                                                      
EZR144   DS   0H                                                                
         OC    0(13,R2),0(R2)                                                   
         BZ    EZR150                                                           
         SPACE                                                                  
         XC    ID,ID                                                            
         MVC   ID(12),0(R2)                                                     
         MVC   SVID,ID                                                          
         MVC   WKRFIL+4(1),12(R2)                                               
         SPACE                                                                  
         L     R3,WKRBUF                                                        
         GOTO1 =V(DATAMGR),DMCB,=C'INDEX',WKRFIL,ID,WKRREC,(R3)                 
         SPACE                                                                  
         TM    DMCB+8,X'80'        TEST EOF ON FIRST READ                       
         BNZ   EZR146               YES, PROBLEM                                
         SPACE                                                                  
         CLC   SVID(12),ID         SEE IF BATCH IS STILL OUT THERE              
         BNE   EZR146                                                           
         SPACE                                                                  
         GOTO1 =V(DATAMGR),DMCB,=C'READ',WKRFIL,ID,WKRREC,(R3)                  
         SPACE                                                                  
         TM    DMCB+8,X'80'        TEST EOF ON FIRST READ                       
         BNZ   EZR146               YES, PROBLEM                                
         SPACE                                                                  
         USING W_RECD,R3                                                        
         CLC   W_INDEX(12),ID      IS FILE OKAY                                 
         BE    EZR148                                                           
         SPACE                                                                  
         MVC   P+72(20),=C'INDEX OKAY, FILE BAD'                                
         SPACE                                                                  
EZR146   DS   0H                                                                
         MVC   P+5(19),=C'BATCH MISSING - ID='                                  
         EDIT  (B2,SVID),(6,P+24),COMMAS=YES                                    
         MVC   P+35(4),=C'STA='                                                 
         MVC   P+39(4),SVID+2                                                   
         MVI   P+43,C'-'                                                        
         MVC   P+44(1),SVID+7                                                   
         MVC   P+50(4),=C'SEQ='                                                 
         EDIT  (B2,SVID+8),(6,P+54),COMMAS=YES                                  
         MVC   P+65(4),=C'WRKF'                                                 
         MVC   P+69(1),12(R2) '                                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR148   DS   0H                                                                
         LA    R2,13(,R2)                                                       
         BCT   R3,EZR144                                                        
         SPACE                                                                  
EZR150   DS   0H                                                                
         GOTO1 =V(PRINTER)                                                      
         MVC   P+2(13),=C'INVOICE MONTH'                                        
         MVC   P+24(5),=C'COUNT'                                                
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         L     R2,=A(MOSTABLE)                                                  
         LA    R3,MOSTABLN                                                      
         LR    RE,R2                                                            
         LR    RF,R3                                                            
         SR    R4,R4                                                            
         SPACE                                                                  
         OC    0(4,RE),0(RE)                                                    
         BZ    *+18                                                             
         LA    RE,6(,RE)                                                        
         LA    R4,1(,R4)                                                        
         BCT   RF,*-18                                                          
         DC    H'0'                                                             
         GOTO1 =V(QSORT),DMCB,(R2),(R4),6,4,0                                   
         SPACE                                                                  
PTMOS10  DS    0H                                                               
         OC    0(4,R2),0(R2)                                                    
         BZ    PTMOS20                                                          
         MVC   P+11(4),0(R2)                                                    
         EDIT  (B2,4(R2)),(6,P+23),COMMAS=YES                                   
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R2,6(,R2)                                                        
         BCT   R3,PTMOS10                                                       
         DC    H'0'                                                             
PTMOS20  DS    0H                                                               
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
* PRINT STATION AND AGENCY TOTALS                                               
         SPACE                                                                  
         LA    R0,EZSTALEN                                                      
         L     R4,=A(EZSTATAB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         OC    0(5,R1),0(R1)                                                    
         BZ    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,21(,R1)                                                       
         BCT   R0,*-18                                                          
         LR    R6,R5                                                            
         GOTO1 =V(QSORT),DMCB,(R4),(R5),21,5,0                                  
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(7),=C'STATION'                                               
         MVC   P+12(8),=C'INVOICES'                                             
         MVC   P+23(5),=C'SPOTS'                                                
         MVC   P+42(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR160   OC    0(5,R4),0(R4)       END OF ENTRIES                               
         BZ    EZR161                                                           
         MVC   P+4(4),0(R4)                                                     
         LA    R1,P+8                                                           
         CLI   3(R4),0                                                          
         BH    *+6                                                              
         BCTR  R1,0                                                             
         MVI   0(R1),C'-'                                                       
         MVC   1(1,R1),4(R4)                                                    
         CLI   1(R1),C' '                                                       
         BH    *+8                                                              
         MVI   1(R1),C'T'                                                       
         SPACE                                                                  
         ICM   R2,15,5(R4)                                                      
         LA    R3,P+15                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+15),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,9(R4)                                                      
         LA    R3,P+23                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+23),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,13(R4)                                                     
         LA    R3,P+32                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+32),2,COMMAS=YES                                      
         SPACE                                                                  
         ICM   R2,15,17(R4)                                                     
         LA    R3,P+48                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+48),2,COMMAS=YES                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,21(,R4)                                                       
         BCT   R5,EZR160                                                        
         SPACE                                                                  
EZR161   MVC   P+16(8),=C'STATIONS'                                             
         LR    R2,R6                                                            
         LA    R3,P+10                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R5),(13,P+2),COMMAS=YES                                         
         GOTO1 =V(PRINTER)                                                      
EZR162   DS    0H                                                               
         LA    R0,100                                                           
         L     R4,=A(EZAGYCTB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         OC    0(8,R1),0(R1)                                                    
         BZ    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,24(,R1)                                                       
         BCT   R0,*-18                                                          
         GOTO1 =V(QSORT),DMCB,(R4),(R5),24,8,0                                  
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(6),AGY                                                       
         MVC   P+12(8),=C'INVOICES'                                             
         MVC   P+23(5),=C'SPOTS'                                                
         MVC   P+42(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR164   OC    0(8,R4),0(R4)       END OF ENTRIES                               
         BZ    EZR165                                                           
         MVC   P+4(8),0(R4)                                                     
         ICM   R2,15,8(R4)                                                      
         LA    R3,P+15                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+15),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,12(R4)                                                     
         LA    R3,P+23                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+23),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,16(R4)                                                     
         LA    R3,P+32                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+32),2,COMMAS=YES                                      
         SPACE                                                                  
         ICM   R2,15,20(R4)                                                     
         LA    R3,P+48                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+48),2,COMMAS=YES                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,24(,R4)                                                       
         BCT   R5,EZR164                                                        
         SPACE                                                                  
EZR165   LA    R0,100                                                           
         L     R4,=A(EZAGYNTB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         SR    R6,R6               UNKNOWN AGENCY COUNTER                       
         OC    0(150,R1),0(R1)                                                  
         BZ    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,170(,R1)                                                      
         BCT   R0,*-18                                                          
         GOTO1 =V(QSORT),DMCB,(R4),(R5),170,150,0                               
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(6),AGY                                                       
         MVC   P+11(4),=C'NAME'                                                 
         MVC   P+40(8),=C'INVOICES'                                             
         MVC   P+51(5),=C'SPOTS'                                                
         MVC   P+66(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166   OC    0(30,R4),0(R4)      END OF ENTRIES                               
         BZ    EZR168                                                           
         MVC   P+4(30),0(R4)                                                    
         ICM   R2,15,152(R4)                                                    
         LA    R3,P+43                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+43),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,156(R4)                                                    
         LA    R3,P+51                                                          
         BAS   RE,EDIT0R                                                        
*        EDIT  (R4),(5,P+51),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,160(R4)                                                    
         LA    R3,P+60                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+60),2,COMMAS=YES                                      
         SPACE                                                                  
         ICM   R2,15,164(R4)                                                    
         LA    R3,P+76                                                          
         BAS   RE,EDIT2R                                                        
*        EDIT  (R4),(13,P+76),2,COMMAS=YES                                      
         SPACE                                                                  
         OC    168(2,R4),168(R4)     WAS THIS A UNKNOWN AGENCY                  
         BNZ   *+14                                                             
         MVC   P+36(7),=C'UNKNOWN'                                              
         LA    R6,1(,R6)             ADD TO UNKNOWN AGENCY COUNT                
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         MVC   P+4(30),30(R4)                                                   
         LA    R0,6                                                             
         LA    R1,P+36                                                          
         L     RE,=A(MEDBITAB)                                                  
EZR166A  ZIC   RF,1(RE)                                                         
         EX    RF,EZRTM            EXEC TM INST                                 
         BZ    EZR166B                                                          
         MVC   0(1,R1),0(RE)                                                    
         LA    R1,2(,R1)                                                        
EZR166B  LA    RE,2(,RE)                                                        
         BCT   R0,EZR166A                                                       
         B     *+8                                                              
EZRTM    TM    150(R4),0                                                        
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         CLC   60(30,R4),SPACES                                                 
         BE    EZR166E                                                          
         MVC   P+4(30),60(R4)                                                   
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166E  CLC   90(30,R4),SPACES                                                 
         BE    EZR166G                                                          
         MVC   P+4(30),90(R4)                                                   
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166G  CLC   120(30,R4),SPACES                                                
         BE    EZR166I                                                          
         MVC   P+4(30),120(R4)                                                  
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR166I  GOTO1 =V(PRINTER)                                                      
         LA    R4,170(,R4)                                                      
         BCT   R5,EZR166                                                        
         SPACE                                                                  
EZR168   LA    R0,10                                                            
         L     R4,=A(EZMEDCTB)                                                  
         SPACE                                                                  
         LR    R1,R4                                                            
         SR    R5,R5                                                            
         CLI   0(R1),0                                                          
         BE    *+16                                                             
         LA    R5,1(,R5)                                                        
         LA    R1,21(,R1)                                                       
         BCT   R0,*-16                                                          
         GOTO1 =V(QSORT),DMCB,(R4),(R5),21,1,0                                  
         SPACE                                                                  
         GOTO1 =V(PRINTER)                                                      
         MVC   P+4(5),=C'MEDIA'                                                 
         MVC   P+10(8),=C'INVOICES'                                             
         MVC   P+22(5),=C'SPOTS'                                                
         MVC   P+38(19),=C'NET - DOLLARS - GRS'                                 
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR169   CLI   0(R4),0             END OF ENTRIES                               
         BE    EZR170                                                           
         MVC   P+6(1),0(R4)                                                     
         ICM   R2,15,1(R4)                                                      
         LA    R3,P+11                                                          
         BAS   RE,EDIT7                                                         
*        EDIT  (R4),(7,P+11),COMMAS=YES                                         
         SPACE                                                                  
         ICM   R2,15,5(R4)                                                      
         LA    R3,P+20                                                          
         BAS   RE,EDIT7                                                         
*        EDIT  (R4),(7,P+20),COMMAS=YES                                         
         SPACE                                                                  
         LA    R2,OBYTS                                                         
         ZAP   OBYTS,9(6,R4)                                                    
         LA    R3,P+32                                                          
         BAS   RE,EDIT2A                                                        
*        EDIT  (P6,9(R3)),(13,P+32),2,COMMAS=YES                                
         SPACE                                                                  
         ZAP   OBYTS,15(6,R4)                                                   
         LA    R3,P+48                                                          
         BAS   RE,EDIT2A                                                        
*        EDIT  (P6,15(R3)),(13,P+48),2,COMMAS=YES                               
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,21(,R4)                                                       
         BCT   R5,EZR169                                                        
         SPACE                                                                  
EZR170   SR    R4,R4                                                            
         SR    R5,R5                                                            
         OC    TUNKINV,TUNKINV     ANY BAD INVOICES TOTAL                       
         BZ    EZR174                                                           
         GOTO1 =V(PRINTER)                                                      
         L     R2,TUNKINV                                                       
         LA    R3,P+3                                                           
         BAS   RE,EDIT0R                                                        
         MVC   P+9(8),=C'INVOICES'                                              
         LR    R2,R6                                                            
         LA    R3,P+20                                                          
         BAS   RE,EDIT0R                                                        
         MVC   P+26(16),=C'UNKNOWN AGENCIES'                                    
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R4,UNKAGYMS                                                      
         SPACE                                                                  
EZR174   OC    TMAXERRS,TMAXERRS   ANY BAD ERRORS                               
         BZ    EZR180                                                           
         SPACE                                                                  
EZR176   MVC   P(11),=C'DATA ERRORS'                                            
         L     R2,TMAXERRS                                                      
         LA    R3,P+30                                                          
         BAS   RE,EDIT0R                                                        
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
         LA    R5,BADATMS                                                       
         SPACE                                                                  
EZR180   LTR   R4,R4                                                            
         BNZ   EZR182                                                           
         LTR   R5,R5                                                            
         BZ    EZR190                                                           
EZR182   MVI   P+40,C'*'                                                        
         MVC   P+41(30),P+40                                                    
         GOTO1 =V(PRINTER)                                                      
         MVI   P+40,C'*'                                                        
         MVI   P+70,C'*'                                                        
         GOTO1 =V(PRINTER)                                                      
         LTR   R4,R4                                                            
         BZ    EZR184                                                           
         MVC   P+40(31),0(R4)                                                   
         GOTO1 =V(PRINTER)                                                      
EZR184   LTR   R5,R5                                                            
         BZ    EZR186                                                           
         MVC   P+40(31),0(R5)                                                   
         GOTO1 =V(PRINTER)                                                      
EZR186   MVI   P+40,C'*'                                                        
         MVI   P+70,C'*'                                                        
         GOTO1 =V(PRINTER)                                                      
         MVI   P+40,C'*'                                                        
         MVC   P+41(30),P+40                                                    
         GOTO1 =V(PRINTER)                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR190   LA    R4,TOTFILES                                                      
         LA    R5,L'TOTFILES                                                    
         SPACE                                                                  
EZR194   CLI   0(R4),0                                                          
         BE    EZR200                                                           
         TM    0(R4),X'08'         WAS THIS A BAD FILE                          
         BZ    EZR196               NOPE                                        
         LR    R1,R4                                                            
         LA    R0,TOTFILES-1                                                    
         SR    R1,R0                                                            
         CVD   R1,DUB                                                           
         MVC   P+8(23),=C'FILE 000 HAD BAD TOTALS'                              
         OI    DUB+7,X'0F'                                                      
         UNPK  P+13(3),DUB                                                      
         GOTO1 =V(PRINTER)                                                      
         SPACE                                                                  
EZR196   LA    R4,1(,R4)                                                        
         BCT   R5,EZR194                                                        
EZR200   XIT1                                                                   
         DS    0H                                                               
EDIT0R   NTR1                                                                   
         EDIT  ((R2)),(5,(R3)),ZERO=NOBLANK                                     
         B     EZR200                                                           
         SPACE                                                                  
         DS    0H                                                               
EDIT7    NTR1                                                                   
         EDIT  (R2),(7,(R3)),COMMAS=YES                                         
         B     EZR200                                                           
         SPACE                                                                  
         DS    0H                                                               
EDIT2R   NTR1                                                                   
         EDIT  ((R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES             
         B     EZR200                                                           
         DS    0H                                                               
EDIT2A   NTR1                                                                   
         EDIT  (P8,0(R2)),(14,(R3)),2,COMMAS=YES,ZERO=NOBLANK,MINUS=YES         
         B     EZR200                                                           
         DS    0H                                                               
EDIT8    NTR1                                                                   
         EDIT  (P8,0(R2)),(13,0(R3)),ZERO=NOBLANK,COMMAS=YES                    
         B     EZR200                                                           
*                                                                               
         LTORG                                                                  
AGY      DC    C'AGENCY '                                                       
UNKAGYMS DC    CL31'* UNKNOWN AGENCY - NOT LOADED *'                            
BADATMS  DC    CL31'* BAD DATA ERROR - NOT LOADED *'                            
*                                                                               
OPENPQ   NTR1  BASE=*,LABEL=*                                                   
         L     R1,=V(REMOTEC)                                                   
         USING REMOTED,R1                                                       
         MVC   REMOTAOP,=V(PQOPEN)                                              
         MVC   REMOTABF,=V(PQBUFF)                                              
         MVC   REMOTADM,=V(DATAMGR)                                             
         MVC   REMOTDST,=AL2(17)        SJR ID RECORD                           
         MVC   REMOTKEY(11),SPACES                                              
         MVC   REMOTSYS(10),=C'EZLOAD REP'                                      
         MVI   REMOTCPY,C'1'                                                    
         MVC   REMOTJID,=C'EZL'                                                 
         XIT1                                                                   
         DROP  R1                                                               
         LTORG                                                                  
         EJECT                                                                  
         DROP  RB,RC                                                            
* DCB DSECT WITH ADRESSABLE LABELS *                                            
         SPACE 2                                                                
*        PRINT GEN                                                              
         DCBD  DSORG=PS,DEVD=DA,TA                                              
         PRINT NOGEN                                                            
         SPACE                                                                  
*              DSECT FOR PROGRAM                                                
         SPACE 2                                                                
EZLDWKD  DSECT                                                                  
DUB      DS    D                                                                
DOUBLE   DS    D                                                                
FULL     DS    F                                                                
DMCB     DS    6F                                                               
HALF     DS    H                                                                
BYTE     DS    X                                                                
         DS    0F                                                               
IDTPARS  DS    6F                                                               
STTPARS  DS    6F                                                               
ERRLINE  DS    XL132                                                            
         DS    XL124                                                            
WORK     DS    XL64                                                             
CARD     DS    CL80                                                             
SVID     DS    CL42                                                             
         DS    CL8                                                              
ID       DS    CL42                                                             
WKRFIL   DS    CL8                                                              
TODAY    DS    CL6                                                              
TODAYC   DS    XL2                                                              
TIMEP    DS    XL2                                                              
HOLDDATE DS    CL6                                                              
         SPACE                                                                  
WKRBUF   DS    A                                                                
WKRREC   DS    A                                                                
EOR      DS    A                                                                
AEZINPT  DS    A                                                                
TRACES   DS    0CL5                                                             
TRACEREC DS    CL1                                                              
TRACEFLD DS    CL1                                                              
TRACEWKR DS    CL1                                                              
TRACEHLD DS    CL1                 HOLD FILE                                    
TRACEWRK DS    CL1                 WORK FILE FOR UNKNOWNS/WORKER FULL           
TEST     DS    CL1                                                              
ABNDOPT  DS    CL1                                                              
DMGOPT   DS    CL1                                                              
RERUN    DS    CL1                                                              
SVRECSW  DS    XL1                                                              
SVRECSTA EQU   X'80'                                                            
SVRECPAY EQU   X'40'                                                            
SVRECAGY EQU   X'20'                                                            
SVRECSRC EQU   X'10'                                                            
SVRECSCT EQU   X'08'                                                            
SVRECSCB EQU   X'04'                                                            
         SPACE                                                                  
STDCMTSW DS    XL1                                                              
STDCMTOP EQU   X'80'                                                            
STDCMBOT EQU   X'40'                                                            
         SPACE                                                                  
NEWBATSW DS    CL1                 READING HOLD FILE,                           
*                                  READ DIFFERENT DATE OR SOURCE                
*                                  NEED TO FORCE END OF BATCH                   
SAVSW    DS    CL1                                                              
         SPACE                                                                  
NWADVNM  DS    CL25                                                             
         SPACE                                                                  
SVADVNM  DS    CL25                                                             
SVADVID  DS    CL8                                                              
SVADVIDN DS    XL2                                                              
AGENCY   DS    CL2                                                              
USIDNO   DS    XL2                                                              
USID     DS    CL8                                                              
SVUSID   DS    CL8                 FROM LAST INVOICE (COMPARE FOR BRK)          
SVINVMOS DS    CL4                 FROM LAST INVOICE                            
         SPACE                                                                  
HDUSID   DS    CL8                 HOLD USID WHEN DOING ENDINV                  
STMODE   DS    CL1                                                              
IDMODE   DS    CL1                                                              
SVEXCLSW DS    CL1                 SAVED BEFORE GETUID/CKADV                    
         SPACE                                                                  
EXCLSW   DS    CL1                 SET TO N IF GOOD BATCH/OKAY TO LOAD          
*                                  SET TO * FOR UNKNOWN AGENCY                  
*                                         # FOR FULL WORKER FILE                
*                                  SET TO Y IF EXPRESSLY EXCLUDED               
*                                         S IF STATION EXCLUDED                 
*                                         A IF AGENCY ID EXCLUDED               
BATHSW   DS    CL1                 SET TO Y BATCH OPENED                        
*                                         N IF BATCH BYPASSED                   
*                          USED TO BYPASS CLOSE, OR FORCE CLOSE                 
*                          EVEN IF NEXT BATCH BYPASSED                          
*                          EVEN IF NEXT BATCH BYPASSED                          
BADBATSW DS    CL1                 SET TO '*' IF ANY BATCH MISSING              
         SPACE                                                                  
* STALEV IS USED TO SAVE SPECIFICITY LEVEL OF AGY/ADV RECS                      
         SPACE                                                                  
STALEV   DS    X                                                                
SVSTALEV DS    X                                                                
* AGENCY NAME                     1 = ALL-A                                     
*                                 2 = ALL-R/T/N                                 
*                                10 = STATION SPECIFIC                          
* OFFICE NAME 10 MORE THAN AGENCY                                               
* ADV    NAME STARTS WITH A BASE OF 30                                          
*                                                                               
SOURCE   DS    CL4                                                              
SVSRCE   DS    CL4                 SOURCE SAVED HERE WHEN READING HOLD          
HOLDSW   DS    CL1                 H=HOLD FILE, 0=EZINPUT                       
RECFM    DS    CL1                                                              
SVIDSTA  DS    CL5                                                              
DASHES   DS    CL60                                                             
         DS    0D                                                               
KEY      DS    XL64                                                             
KEYSAVE  DS    XL64                                                             
DMWORK   DS    12D                                                              
*                                                                               
         DS    0F                                                               
COUNTS   DS    0XL(ENDCTS)                                                      
*                                                                               
* COUNTS FOR 1 INVOICE (CURRENT)                                                
*                                                                               
ITOTS    DS    0XL12                                                            
ISPTS    DS    F                   INVOICE SPOTS                                
IDOLN    DS    F                           DOLLARS (NET)                        
IDOLG    DS    F                           DOLLARS (GROSS)                      
         SPACE                                                                  
*                                                                               
* COUNTS FOR 1 BATCH (CURRENT)                                                  
*                                                                               
BTOTS    DS    0XL20                                                            
BSPTS    DS    F                   BATCH SPOTS                                  
BDOLN    DS    F                         DOLLARS (NET)                          
BDOLG    DS    F                         DOLLARS (GROSS)                        
BINVS    DS    F                         INVOICES                               
BRECS    DS    F                         RECORDS IN THIS BATCH                  
BBYTS    DS    PL8                       BYTES OUTPUT                           
         SPACE                                                                  
*                                                                               
* COUNTS TOTAL RUN                                                              
*                                                                               
TSPTS    DS    F                   TOTAL FOR NEW DATA SET                       
TDOLN    DS    PL8                                                              
TDOLG    DS    PL8                                                              
TINVS    DS    F                                                                
EZRDCT   DS    F                   RECORDS READ FROM EZINPUT FILE               
         SPACE                                                                  
*                                                                               
* COUNTS FOR INPUT HOLD FILE *                                                  
*                                                                               
HIBAT    DS    F                   TOTAL ON HOLD FILE (UNKNOWS OR FULL)         
HISPTS   DS    F                                                                
HIDOLN   DS    PL8                                                              
HIDOLG   DS    PL8                                                              
HIINVS   DS    F                                                                
HDRDCT   DS    F                   RECORDS READ FROM HOLD FILE                  
         SPACE                                                                  
*                                                                               
* COUNTS FOR OUTPUT HOLD FILE *                                                 
*                                                                               
HOBAT    DS    F                   TOTAL ON HOLD FILE (UNKNOWS OR FULL)         
HOSPTS   DS    F                                                                
HODOLN   DS    PL8                                                              
HODOLG   DS    PL8                                                              
HOINVS   DS    F                                                                
*                                                                               
* COUNT OF RECORDS ON THE WORK FILE - UNKNOWN OR FULL EASIWK *                  
* THIS WILL BE THE COUNT OF RECORDS ON NEW HOLD FILE         *                  
*                                                                               
WORKCT   DS    F                   COUNT OF RECORDS ON WORK FILE                
WORKCT9  DS    F                   COUNT OF 99 RECORDS ON WORK FILE             
         SPACE                                                                  
TBTCHS   DS    F                   TOTAL BATCHES                                
TUNKINV  DS    F                   TOTAL BAD INVOICES (UNKNOWN AGENCY)          
TFULINV  DS    F                   TOTAL WORKER FILE FULL INVOICES              
TFULBAT  DS    F                   TOTAL WORKER FILE FULL BATCHES               
*                                                                               
TDELINV  DS    F                   TOTAL DELETE PREVIOUS INVOICE RECS           
TMAXERRS DS    F                   TOTAL BAD ERRORS FOUND ON TAPE               
TCLTCDS  DS    F                                                                
TPRDCDS  DS    F                                                                
TESTCDS  DS    F                                                                
*                                                                               
* LOADED BATCH TOTALS                                                           
*                                                                               
LBTCHS   DS    F                   LOADED BATCHES                               
LINVS    DS    F                          INVOICES                              
LSPTS    DS    F                          SPOTS                                 
ENDCTS   EQU   *-ISPTS                                                          
LDOLN    DS    PL8                                                              
LDOLG    DS    PL8                                                              
*                                                                               
* LOADED BATCH TOTALS                                                           
*                                                                               
IBYTS    DS    PL8                 INPUT BYTES REC                              
OBYTS    DS    PL8                 OUTPUT BYTES REC                             
*                                                                               
RDELIM   DS    CL1                 RECORD DELIMITER                             
FDELIM   DS    CL1                 FIELD DELIMITER                              
HOLDSIGN DS    CL1                                                              
*                                                                               
* RECORD FIELD DATA AREA - EACH FIELD BUILT HERE TO PRINT IF NEEDED *           
*                                                                               
RFVALS   DS    0D                                                               
RFDATA   DS    XL256                                                            
RFLEN    DS    XL1                                                              
RFCTL    DS    X                   EXTERNAL SWITCHES                            
RFCTLEOF EQU   X'80' - END OF FILE                                              
RFCTLEOR EQU   X'40' - END OF RECORD                                            
RFCTLFER EQU   X'20' - FIELD ERROR                                              
RFCTLEFL EQU   X'10' - END OF FIELD                                             
RFCTLREC EQU   X'08' - RECORD WAS READ FROM FILE                                
         SPACE                                                                  
RFCTL2   DS    X                   INTERNAL SWITCHES                            
RFCTL2RD EQU   X'04' - NEED TO READ NEXT TAPE BLOCK/RECORD                      
RFCTL2EF EQU   X'02' - END OF FILE                                              
RFCTL2ER EQU   X'01' - END OF RECORD                                            
RFFLDNO  DS    X                                                                
RFCURPOS DS    F                                                                
RFFLDST  DS    F                                                                
RFRECST  DS    F                                                                
RFERRMSG DS    CL20                                                             
RFVALSL  EQU   *-RFVALS                                                         
*                                                                               
RECLEN   DS    F                                                                
RECTYP   DS    CL2                                                              
*                                                                               
* WORKER RECORD POINTERS *                                                      
*                                                                               
WFVALS   DS    0D                                                               
WRECST   DS    F                   WORKER RECORD START                          
WRCURPOS DS    F                   WORKER RECORD NEXT FIELD PTR                 
WFVALSL  EQU   *-WFVALS                                                         
*                                  INVOICE FIELDS                               
INVFLDS  DS    0CL115                                                           
INVNO    DS    CL10                                                             
INVMOS   DS    CL4                                                              
INVDEL   DS    CL1                                                              
ADVNAM   DS    CL25                                                             
ADVCD    DS    CL8                                                              
PRDNAM   DS    CL25                                                             
PRDCD    DS    CL8                                                              
ESTNO    DS    CL10                                                             
STANET   DS    CL4                                                              
OLDINVNO DS    CL20                                                             
*                                  SAVED DATA FIELDS                            
STAFLDS  DS    0CL8                                                             
STATION  DS    CL4                                                              
MEDIA    DS    CL2                                                              
BAND     DS    CL2                                                              
         SPACE                                                                  
* SAVED BECAUSE EQUIVALENT STATION RECORD WITH ADVERTISER FOUND *               
         SPACE                                                                  
SVSTAFLD DS    CL8                                                              
SVEQVSTA DS    CL4                                                              
SVEQVMED DS    CL1                                                              
*                                                                               
EQVSTASW DS    CL1                 SET TO Y IF USING EQUIV STA/ADVERT           
*                                                                               
*                                  SAVED DATA FIELDS                            
STAMED   DS    CL1                                                              
         DS    CL1                 SPARE                                        
STAFLDSA DS    0CL150                                                           
STANAME  DS    CL30                                                             
STALIN1  DS    CL30                                                             
STALIN2  DS    CL30                                                             
STALIN3  DS    CL30                                                             
STALIN4  DS    CL30                                                             
STACSYS  DS    CL15                STATION COMPUTER SYSTEM (SOURCE?)            
*                                                                               
*                                                                               
BILSTA   DS    CL5                                                              
*                                                                               
AGYFLDS  DS    0CL150                                                           
AGYNAME  DS    CL30                                                             
AGYLIN1  DS    CL30                                                             
AGYLIN2  DS    CL30                                                             
AGYLIN3  DS    CL30                                                             
AGYLIN4  DS    CL30                                                             
*                                                                               
SVAGYFL  DS    0CL150                                                           
SVAGYNM  DS    CL30                                                             
         DS    CL120                                                            
SVMEDIA  DS    CL1                                                              
*                                                                               
* 1 BYTE EACH FILE - 80 SET ON FOR EACH FILE, 08 IF TOTALS UNEQUAL              
*                                                                               
         DS    0F                                                               
TOTFILES DS    CL512                                                            
*                                                                               
* TOTALS FROM INPUT DATA SET 12 TOTALS RECORD                                   
*                                                                               
TOTINVS  DS    F                                                                
TOTDOLS  DS    PL8                                                              
*                                                                               
*                  TOTALS FROM START OF RUN OR SINCE LAST TOTAL RECORD          
*                                                                               
CFLDS    DS    0F                                                               
CINVS    DS    F                                                                
CDOLN    DS    PL8                                                              
CDOLG    DS    PL8                                                              
*                                                                               
OLDSTA   DS    CL8                                                              
OLDSTAD  DS    CL150                                                            
OLDAGY   DS    CL150                                                            
         SPACE                                                                  
* WORK AREA TO ALLOW FIELDS TO SPAN RECORDS *                                   
* EACH FIELD IS BUILT HERE                  *                                   
         SPACE                                                                  
WLEN     DS    H                                                                
WDATA    DS    CL256                                                            
EZBILL   DS    CL512               BUFFER FOR SLOPPY INPUT                      
*                                                                               
EZLDWKL  EQU   *-EZLDWKD                                                        
         SPACE 3                                                                
         EJECT                                                                  
*                                                                               
         PRINT OFF                                                              
       ++INCLUDE DMWRKFD                                                        
       ++INCLUDE DMWRKFK                                                        
       ++INCLUDE DMWRKFL                                                        
       ++INCLUDE CTGENFILE                                                      
         PRINT ON                                                               
*                                                                               
       ++INCLUDE SPGENEZ                                                        
*                                                                               
         EJECT                                                                  
       ++INCLUDE DDDPRINT                                                       
         ORG   P                                                                
ILADV    DS    CL25                                                             
         DS    CL1                                                              
ILADVCD  DS    CL8                                                              
         DS    CL1                                                              
ILPRD    DS    CL25                                                             
         DS    CL2                                                              
ILPRDCD  DS    CL8                                                              
         DS    CL2                                                              
ILEST    DS    CL10                                                             
         DS    CL1                                                              
ILINV    DS    CL10                                                             
         DS    CL2                                                              
ILMOS    DS    CL4                                                              
         DS    CL3                                                              
ILSPTS   DS    CL5                                                              
ILDOLS   DS    CL12                                                             
         DS    CL3                                                              
ILNET    DS    CL4                                                              
         EJECT                                                                  
EZLOAD   CSECT                                                                  
         DS    0D                                                               
FILIST   DC    CL8'NGENDIR'                                                     
         DC    CL8'NGENFIL'                                                     
         DC    CL8'NCTFILE'                                                     
         DC    CL10'X'                                                          
*                                                                               
COLHDS1  DC    CL132'ADVERTISER NAME           CODE     PRODUCT NAME   C        
                           CODE      EST        INVOICE    MONTH   SPOTC        
               S       NET'                                                     
COLHDS2  DC    CL132'---------------           ----     ------------   C        
                           -------   ---        -------    -----   ----C        
               -    ---------'                                                  
         SPACE 3                                                                
         DS    0D                                                               
EZINPUTF DCB   DDNAME=EZINPUT,DSORG=PS,RECFM=FB,MACRF=GM,EODAD=GETEOF           
         DS    0D                                                               
EZINPUTU DCB   DDNAME=EZINPUT,DSORG=PS,RECFM=U,MACRF=GM,EODAD=GETEOF            
         DS    0D                                                               
EZINPUTV DCB   DDNAME=EZINPUT,DSORG=PS,RECFM=VB,MACRF=GM,EODAD=GETEOF           
         DS    0D                                                               
EZBILLF  DCB   DDNAME=EZBILL,                                          C        
               DSORG=PS,                                               C        
               LRECL=512,                                              C        
               RECFM=FB,                                               C        
               MACRF=PM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZHOLDR  DCB   DDNAME=EZHOLD,                                          C        
               DSORG=PS,                                               C        
               EODAD=GETEOFH,                                          C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=GM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZHOLDW  DCB   DDNAME=EZHOLD,                                          C        
               DSORG=PS,                                               C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=PM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZWORKW  DCB   DDNAME=EZWORK,                                          C        
               DSORG=PS,                                               C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=PM                                                         
         SPACE                                                                  
         DS    0D                                                               
EZWORKR  DCB   DDNAME=EZWORK,                                          C        
               DSORG=PS,                                               C        
               EODAD=EOFWORK,                                          C        
               LRECL=512,                                              C        
               RECFM=VB,                                               C        
               MACRF=GM                                                         
         SPACE                                                                  
UTL      DS    0D                                                               
         DC    F'0'                                                             
         DC    X'0A'               CONTROL SYSTEM                               
*                                                                               
         DS    0D                                                               
         DC    CL8'*WKRBUF*'                                                    
WKRBUFC  DS    14336X                                                           
*                                                                               
         DC    CL8'*WKRREC*'                                                    
WKRRECC  DS    4096X                                                            
*                                                                               
         DC    CL8'*RECWRK*'                                                    
RECWRK   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVSTA*'                                                    
SAVSTA   DS    1024X                                                            
SAVSTALN EQU   *-SAVSTA                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVPAY*'                                                    
SAVPAY   DS    1024X                                                            
SAVPAYLN EQU   *-SAVPAY                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVAGY*'                                                    
SAVAGY   DS    1024X                                                            
SAVAGYLN EQU   *-SAVAGY                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVSCT*'       STANDARD COMMENT TOP                         
SAVSCT   DS    5XL140                                                           
SAVSCTLN EQU   *-SAVSCT                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*SAVSCB*'       STANDARD COMMENT BOTTOM                      
SAVSCB   DS    5XL140                                                           
SAVSCBLN EQU   *-SAVSCB                                                         
*                                                                               
         DS    0D                                                               
         DC    CL8'*GENREC*'                                                    
GENREC   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*HLDREC*'                                                    
HLDREC   DS    1024X                                                            
*                                                                               
         DS    0D                                                               
         DC    CL8'*STTAB**'                                                    
STTAB    DS    50CL5                                                            
STTABMX  EQU   50                                                               
*                                                                               
         DS    0D                                                               
         DC    CL8'*IDTAB**'                                                    
IDTAB    DS    50CL8                                                            
IDTABMX  EQU   50                                                               
*                                                                               
         DS    0D                                                               
         DC    CL8'**EZIN**'                                                    
         DC    F'0'                                                             
EZINREC  DS    CL33000                                                          
         DC    64X'00'             MAY USE TO MARK EOR                          
         DC    CL8'**EOR***'                                                    
         SPACE                                                                  
         DS    0D                                                               
         DC    CL8'*STATAB*'                                                    
         DC    F'0'                                                             
EZSTATAB DC 900XL21'00'        STATION TABLE                                    
EZSTALEN EQU   900                                                              
         DC    CL8'*ENDSTA*'  5-STA, 4 #INV, 4 #SPTS, 4 NET DOLS, 4 GRS         
         SPACE                                                                  
         DS    0D                                                               
         DC    CL8'*AGYCTB*'                                                    
         DC    F'0'                                                             
EZAGYCTB DC 100XL24'00'        AGENCY TABLE                                     
         DC    CL8'*ENDAGY*'    8-USID, 4 #INV, 4 #SPTS, 4 NET, 4 GRS           
         DS    0D                                                               
         DC    CL8'*AGYNTB*'                                                    
         DC    F'0'                                                             
EZAGYNTB DC 100XL170'00'           AGENCY NAME TABLE                            
         DC    CL8'*ENDAGY*' 150-NAME & ADDRESS                                 
*                              1 FOR MEDIA BITS                                 
*                              1 SPARE                                          
*                              16 - 4 EACH FOR # INV, SPTS, NET, GROSS          
*                              2-USID (UNKNOWN INDICATOR)                       
         DS    0D                                                               
         DC    CL8'*MEDCTB*'                                                    
         DC    F'0'                                                             
*                                                                               
* MONTH OF SERVICE TABLE                                                        
*                                                                               
MOSTABLE DC  20XL6'00'                                                          
MOSTABLN EQU 20                                                                 
* MEDIA TABLE                                                                   
         SPACE                                                                  
EZMEDCTB DC  10XL21'00000000000000000000000000000F00000000000F'                 
         DC    CL8'*ENDMED*'   1-MEDIA 4 # INV, 4 #SPTS, 6 NET, 6 GRS           
*                               BINARY  BINARY   PACKED                         
*                                                                               
* RECORD BUILT HERE (TO ALLOW SPANNED FIELDS/RECORDS FROM BLOCK TO              
*                    BLOCK)                                                     
*                                                                               
         DS    0D                                                               
         DC    CL8'**EZOT**'                                                    
EZOTREC  DS    CL1024                                                           
EZOTRECL EQU   1024                                                             
*                                                                               
         DS    0D                                                               
         DC    CL8'*DUPSEQ*'                                                    
DUPSEQTB DS    CL16000                                                          
DUPSEQTL EQU   16000                                                            
DUPSEQTE EQU   16000/4                                                          
         DC    CL8'*ENDSEQ*' EACH ENTRY IS 2 BYTE BIN ID #                      
*                            AND 2 BYTE BIN SEQ #                               
         DS    0D                                                               
         DC    CL8'*SVINDX*'                                                    
SVINDXTB DS    CL64000                                                          
SVINDXTL EQU   64000                                                            
SVINDXTE EQU   64000/16                                                         
         DC    CL8'*ENDNDX*' STD NEW WORKER FILE INDEXES OF ADDED FILES         
*                                                                               
         DS    0D                                                               
         DC    CL8'*REGSAV*'                                                    
REGSAVE  DS    XL30000                                                          
*                                                                               
EZLOADX  DS    0D                                                               
         SPACE 3                                                                
EZBILLD  DSECT                                                                  
EZBAGY   DS    CL8                                                              
EZBSRC   DS    CL4                                                              
EZBMEDIA DS    CL1                                                              
EZBCALL  DS    CL5                                                              
EZBNET   DS    CL4                                                              
EZBMOS   DS    CL4                                                              
EZBTODAY DS    CL6                                                              
EZBADVNM DS    CL25                                                             
EZBPRDNM DS    CL25                                                             
EZBINVNO DS    CL10                                                             
EZBNSPTS DS    CL5                                                              
EZBGDOL  DS    CL11                                                             
EZBNDOL  DS    CL11                                                             
EZBAGYNM DS    CL30                                                             
EZBAGYAD DS    CL120                                                            
EZBSTADR DS    CL150                                                            
*                                                                               
* DDREMOTED                                                                     
*        PRINT OFF                                                              
       ++INCLUDE DDREMOTED                                                      
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'115EZLOADA   08/24/00'                                      
         END                                                                    

*          DATA SET MEATTSRCH  AT LEVEL 003 AS OF 07/07/11                      
*CATALP SRCHDATT                                                                
*                                                                               
*&&      SET   NOP=N               COMMENTED OUT CODE                           
*                                                                               
         TITLE 'ATTRIBUTION SUBSYSTEM SEARCH DIRECTORY AND SUBROUTINES'         
         SPACE 1                                                                
*WHO  LVL DATE    CHANGE                                                        
*DDRA 003 06JUL11 CHANGE MMS TO NMR                            PR001780         
*DCHA 002 22JAN07 NEW MODULE                                                    
         EJECT                                                                  
         PRINT NOGEN                                                            
SRCHATT  CSECT                                                                  
         EJECT                                                                  
         NOP   SRCHDATT-SRCHATT(,0)   +2 IS HWORD DISP OF DIRECTORY             
*                                                                               
RNTRY    NMOD1 SRCHWRKL,**SATT**,RR=RE                                          
*                                                                               
         SH    RB,=YL2(RNTRY-SRCHATT) RESET RB TO BEGINNING OF CSECT            
         DROP  RB                                                               
         USING SRCHATT,RB                                                       
         LA    R7,2048(RB)            SET SECOND BASE REGISTER                  
         LA    R7,2048(R7)                                                      
         USING SRCHATT+4096,R7                                                  
*                                                                               
         USING SRCHWORK,RC         RC=TEMP WORK AREA                            
         ST    RE,RELO                SAVE RELO FACTOR                          
         ST    R1,APARMS              SAVE A(PARMS)                             
         L     RA,0(R1)            RA=ADDRESS OF CONTROL BLOCK                  
         USING SEARCHD,RA                                                       
*                                                                               
         MVI   SBRETURN,0          CLEAR ERROR FLAG                             
         CLI   0(R1),SDSSYPPQ                                                   
         BE    RPASSIVE            PASSIVE POINTER SUBROUTINE                   
         NC    SBASYS,SBASYS                                                    
         BZ    ENIT                SEARCH BLOCK NOT INITIALIZED                 
         CLI   0(R1),SDSSYKSQ                                                   
         BE    RSYSKSET            SYSTEM KEY SET ROUTINE                       
         CLI   0(R1),SDSSERXQ                                                   
         BH    GUDEXIT             GO STRAIGHT OUT IF UNKNOWN SRTN              
         CLI   0(R1),SDSSEKSQ                                                   
         BNE   INIT02                                                           
*                                                                               
         ST    R1,FULL                                                          
         L     RF,SBCOMFAC         SWITCH TO MEDZ IF NEEDED                     
         L     RF,CGETFACT-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,(X'80',USRSENUM),F#SESYS                               
         CLI   USRSENUM,MEDZSEQ                                                 
         BE    INIT01                                                           
         L     RF,SBCOMFAC                                                      
         L     RF,CSWITCH-COMFACSD(RF)                                          
         GOTO1 (RF),DMCB,('MEDZSEQ',X'FFFFFFFF'),0                              
         CLI   4(R1),NULLQ                                                      
         BNE   ENOP                                                             
*                                                                               
INIT01   L     R1,FULL                                                          
*                                                                               
INIT02   L     R9,SBASRCH          R9=SEARCH ENTRY                              
         USING SDSRCHD,R9          (NOT AVAILABLE AT SYSTEM EXIT)               
*                                                                               
         XR    RF,RF                                                            
         IC    RF,0(R1)            GET NUMBER OF REQUIRED SUBROUTINE            
         BCTR  RF,0                LESS 1                                       
         SLL   RF,2                TIMES 4                                      
         AH    RF,SDSRRTNS-SDSRCHD(R9) PLUS ROUTINE BRANCH TAB OFFSET           
         B     0(RF,RB)            GO TO IT WITH ORIGINAL R1.                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ASSORTED EXITS                                                      *         
***********************************************************************         
EFLT     MVI   SBRETURN,SBRFLTQ    ITEM FILTERED OUT                            
         B     BADEXIT                                                          
ESEC     MVI   SBRETURN,SBRSECQ    ITEM FAILED SECURITY CHECK                   
         B     BADEXIT                                                          
*                                                                               
EMIF     MVI   SBRETURN,SBEMIFQ    MISSING INPUT FIELD                          
         B     BADEXIT                                                          
EIIF     MVI   SBRETURN,SBEIIFQ    INVALID INPUT FIELD                          
         B     BADEXIT                                                          
EIKW     MVI   SBRETURN,SBEIKWQ    INVALID KEYWORD                              
         B     ETXTSET                                                          
EDKW     MVI   SBRETURN,SBEDKWQ    DUPLICATE KEYWORD                            
         B     ETXTSET                                                          
EIFV     MVI   SBRETURN,SBEIFVQ    INVALID VALUE FOR FILTER                     
         B     ETXTSET                                                          
EFTS     MVI   SBRETURN,SBEFTSQ    FIELD TOO SHORT                              
         B     ETXTSET                                                          
EFTL     MVI   SBRETURN,SBEFTLQ    FIELD TOO LONG                               
         B     ETXTSET                                                          
ETMN     MVI   SBRETURN,SBETMNQ    TOO MANY ITEMS INPUT                         
         B     BADEXIT                                                          
EHLP     MVI   SBRETURN,SBEHLPQ    HELP DISPLAYED                               
         B     BADEXIT                                                          
*                                                                               
EIIO     MVI   SBRETURN,SBEIIOQ    INVALID IO                                   
         B     BADEXIT                                                          
ENIT     MVI   SBRETURN,SBENITQ    NOT INITIALIZED                              
         B     BADEXIT                                                          
ENOP     MVI   SBRETURN,SBENOPQ    SYSTEM NOT OPERATIONAL                       
         B     BADEXIT                                                          
*                                                                               
ETXTSET  CLI   GTLTXT-GTBLOCK+SBTXTBLK,0                                        
         BE    BADEXIT                                                          
         LA    RE,SBOPTTXT                                                      
         STCM  RE,B'0111',GTATXT-GTBLOCK+SBTXTBLK                               
         B     BADEXIT                                                          
         SPACE 1                                                                
BADEXIT  LTR   RB,RB               CC NONZERO    = BAD EXIT                     
         B     EXIT                                                             
GUDEXIT  CR    RB,RB               CC ZERO/EQUAL = GOOD EXIT                    
EXIT     XIT1                                                                   
*                                                                               
PACHAREA DC    32S(*)                                                           
         EJECT                                                                  
***********************************************************************         
* START OF SEARCH DIRECTORY (DSECT SDSRCHD)                           *         
***********************************************************************         
         ENTRY SRCHDATT                                                         
SRCHDATT DC    F'0'                INITIALLY END OF TABLE                       
         SPACE 2                                                                
***********************************************************************         
* ADVERTISER SEARCH ENTRY                                             *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHADV  DC    Y(SRCHADVX-SRCHADV) LENGTH OF ENTRY                              
         DC    CL8'ADVERTSR'       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RADVRTNS-SRCHATT) DISP OF ADVERTISER ROUTINES                  
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHADVX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* IRISH ADVERTISER SEARCH ENTRY                                       *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHIAD  DC    Y(SRCHIADX-SRCHIAD)  LENGTH OF ENTRY                             
         DC    CL8'IADVRTSR'       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RIADRTNS-SRCHATT) DISP OF ADVERTISER ROUTINES                  
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHIADX DC   F'0'                END SEARCH ENTRIES                            
         SPACE 2                                                                
***********************************************************************         
* ADVERTISER HOLDING COMPANY SEARCH ENTRY                             *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHAHL  DC    Y(SRCHAHLX-SRCHAHL) LENGTH OF ENTRY                              
         DC    CL8'ADVHOLD '       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RAHLRTNS-SRCHATT) DISP OF ROUTINES                             
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHAHLX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* IRISH ADVERTISER HOLDING COMPANY SEARCH ENTRY                       *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHIAH  DC    Y(SRCHIAHX-SRCHIAH) LENGTH OF ENTRY                              
         DC    CL8'IADVHOLD'       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RIAHRTNS-SRCHATT) DISP OF ROUTINES                             
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHIAHX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* AGENCY SEARCH ENTRY                                                 *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHAGY  DC    Y(SRCHAGYX-SRCHAGY) LENGTH OF ENTRY                              
         DC    CL8'AGENCY  '       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RAGYRTNS-SRCHATT) DISP OF ROUTINES                             
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHAGYX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* AGENCY SEARCH ENTRY                                                 *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHIAG  DC    Y(SRCHIAGX-SRCHIAG) LENGTH OF ENTRY                              
         DC    CL8'IAGENCY  '      SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RIAGRTNS-SRCHATT) DISP OF ROUTINES                             
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHIAGX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* BRAND SEARCH ENTRY                                                  *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHBRD  DC    Y(SRCHBRDX-SRCHBRD) LENGTH OF ENTRY                              
         DC    CL8'BRAND   '       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RBRDRTNS-SRCHATT) DISP OF BRAND ROUTINES                       
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHBRDX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* IRISH BRAND SEARCH ENTRY                                            *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHIBR  DC    Y(SRCHIBRX-SRCHIBR) LENGTH OF ENTRY                              
         DC    CL8'IBRAND  '       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RIBRRTNS-SRCHATT) DISP OF BRAND ROUTINES                       
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHIBRX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* NMR CATEGORY SEARCH ENTRY                                           *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHNMR  DC    Y(SRCHNMRX-SRCHNMR) LENGTH OF ENTRY                              
         DC    CL8'NMRCAT  '       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RMMSRTNS-SRCHATT) DISP OF ROUTINES                             
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHNMRX DC    F'0'                END SEARCH ENTRIES                           
         SPACE 2                                                                
***********************************************************************         
* FILM SEARCH ENTRY                                                   *         
***********************************************************************         
         SPACE 1                                                                
         ORG   *-4                 BACK OVER PREVIOUS END                       
SRCHFLM  DC    Y(SRCHFLMX-SRCHFLM) LENGTH OF ENTRY                              
         DC    CL8'FILM    '       SEARCH CODE                                  
         DC    CL6'ATTRIB'         REQUIRED SYSTEM                              
         DC    Y(RFLMRTNS-SRCHATT) DISP OF ROUTINES                             
         DC    Y(SR$IND-SR$KEY)    DISP OF TYPE 1/2 MODIFIER IN KEY             
         DC    AL1(SR$NMSQQ)       VALUE OF TYPE 1 MODIFIER                     
         DC    AL1(SR$SQNMQ)       VALUE OF TYPE 2 MODIFIER                     
         DC    Y(SR$NAME1-SR$KEY)  DISP OF WORD/SEQNO PAIR IN KEY               
         DC    Y(L'SR$NAME1)       LENGTH OF WORD.                              
         DC    Y(L'SR$SEQ1)        LENGTH OF SEQNO                              
         DC    AL1((SDSRITYQ)+0+0) INDICATORS                                   
*                                  SEARCH TYPE IS PART OR EXACT MATCH           
*                                  DUPLICATE WORDS ARE DROPPED                  
*                                  WORD SEQUENCE IS NOT RELEVANT                
         DC    AL1(SDSRISFQ)       SYSTEM IS REQUIRED                           
         DC    AL1(0)              SEARCH ID NUMBER                             
         DC    XL1'0'              SPARE                                        
         SPACE 1                                                                
SRCHFLMX DC    F'0'                END SEARCH ENTRIES                           
         EJECT                                                                  
***********************************************************************         
* ATTRIBUTION APPLICATION SUBROUTINES                                 *         
***********************************************************************         
         SPACE 1                                                                
***********************************************************************         
* ATTRIBUTION SEARCH PASSIVE POINTER BUILDING ROUTINES                *         
***********************************************************************         
         SPACE 1                                                                
RPASSIVE L     R2,4(R1)            RECORD ADDRESS/POINTER ADDRESS               
         USING ATTRECD,R2                                                       
         CLI   SBMODE,0            TEST PASSIVES HANDLED BY DUMP/LOAD           
         BNE   RPASR                                                            
         DC    H'0'                MELDCPTR HANDLES THIS                        
         SPACE 1                                                                
RPASR    CLI   SBMODE,1                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
         LM    R3,R4,8(R1)         PASSIVE KEY AND NAME AREA ADDRESSES          
         LR    R5,R1               SAVE PARMS ADDRESS                           
         MVI   12(R5),0            PRESET NAME LENGTH                           
         USING SR$D,R3                                                          
         XC    SR$KEY(SR$DLQ),SR$KEY       CLEAR ENTRY                          
         MVI   SR$RECT,SR$RECQ     SET GENERAL NAME SEARCH PASSIVE TYPE         
         MVC   SR$DST,ATTFST       PARENT STATUS (FOR NOW)                      
         OI    SR$DSTAT,ATTPASSQ   FLAG AS PASSIVE                              
         LA    R0,100              LIMIT ELEMENT SCAN INCASE ODD RECS           
         LA    RE,ATTFRSTQ(R2)     RE=A(FIRST ELEMENT)                          
         SR    RF,RF                                                            
         CLI   ATTRECT,ADVRECQ     TEST FOR ADVERTISER RECORD                   
         BE    RPASADV                                                          
         CLI   ATTRECT,IADRECQ     TEST FOR IRISH ADVERTISER RECORD             
         BE    RPASIAD                                                          
         CLI   ATTRECT,AHLRECQ     TEST FOR ADVERTISER HOLDING CO REC           
         BE    RPASAHL                                                          
         CLI   ATTRECT,IAHRECQ     TEST FOR IRISH ADVERTISER HLD CO REC         
         BE    RPASIAH                                                          
         CLI   ATTRECT,AGYRECQ     TEST FOR AGENCY RECORD                       
         BE    RPASAGY                                                          
         CLI   ATTRECT,IAGRECQ     TEST FOR IRISH AGENCY RECORD                 
         BE    RPASIAG                                                          
         CLI   ATTRECT,BRDRECQ     TEST FOR BRAND RECORD                        
         BE    RPASBRD                                                          
         CLI   ATTRECT,IBRRECQ     TEST FOR IRISH BRAND RECORD                  
         BE    RPASIBR                                                          
         CLI   ATTRECT,MMSRECQ     TEST FOR MMS CATEGORY RECORD                 
         BE    RPASMMS                                                          
*&&NOP                                                                          
         CLI   ATTRECT,FLMRECQ     TEST FOR FILM RECORD                         
         BE    RPASFLM                                                          
*&&                                                                             
*                                                                               
*                                                                               
* RECORD TYPE DOES NOT SUPPORT SEARCH                                           
*                                                                               
         B     RPASNO                                                           
         EJECT                                                                  
* CREATE ADVERTISER PASSIVES                                                    
*                                                                               
RPASADV  MVI   SR$IND,ADVRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHADV                                                       
         B     RPASAAH             COMMON ADV/AHL/AGY RTN                       
         SPACE 2                                                                
* CREATE IRISH ADVERTISER PASSIVES                                              
*                                                                               
RPASIAD  MVI   SR$IND,IADRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHIAD                                                       
         B     RPASAAH             COMMON ADV/AHL/AGY RTN                       
         SPACE 2                                                                
* CREATE ADVERTISER HOLDING COMPANY PASSIVES                                    
*                                                                               
RPASAHL  MVI   SR$IND,AHLRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHAHL                                                       
         B     RPASAAH             COMMON ADV/AHL/AGY RTN                       
         SPACE 2                                                                
* CREATE IRISH ADVERTISER HOLDING COMPANY PASSIVES                              
*                                                                               
RPASIAH  MVI   SR$IND,IAHRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHIAH                                                       
         B     RPASAAH             COMMON ADV/AHL/AGY RTN                       
         SPACE 2                                                                
* CREATE AGENCY PASSIVES                                                        
*                                                                               
RPASAGY  MVI   SR$IND,AGYRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHAGY                                                       
         B     RPASAAH             COMMON ADV/AHL/AGY RTN                       
         SPACE 2                                                                
* CREATE IRISH AGENCY PASSIVES                                                  
*                                                                               
RPASIAG  MVI   SR$IND,IAGRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHIAG                                                       
         B     RPASAAH             COMMON ADV/AHL/AGY RTN                       
         SPACE 2                                                                
* CREATE BRAND PASSIVES                                                         
*                                                                               
RPASBRD  CLI   0(RE),0             SCAN FOR MMS CAT ELEMENT                     
         BE    RPBRD30                                                          
         CLI   0(RE),BRDMELQ                                                    
         BE    RPBRD20                                                          
         IC    RF,1(RE)                                                         
         AR    RE,RF                                                            
         BCT   R0,RPASBRD                                                       
         B     RPBRD30                                                          
RPBRD20  MVC   SR$DMMS,BRDMCAT-BRDMD(RE)    MMS CAT FROM PASSIVE ELEM           
*                                                                               
RPBRD30  MVI   SR$IND,BRDRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHBRD                                                       
         B     RPASBLD             GET NAME ELEMENT                             
         SPACE 2                                                                
* CREATE IRISH BRAND PASSIVES                                                   
*                                                                               
RPASIBR  MVI   SR$IND,IBRRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHIBR                                                       
         B     RPASBLD             GET NAME ELEMENT                             
         SPACE 2                                                                
* CREATE MMS CATEGORY PASSIVES                                                  
*                                                                               
RPASMMS  MVI   SR$IND,MMSRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHNMR                                                       
         B     RPASBLD             GET NAME ELEMENT                             
         SPACE 2                                                                
* CREATE FILM PASSIVES                                                          
*                                                                               
RPASFLM  MVI   SR$IND,FLMRECQ      SET SUB RECORD TYPE                          
         LA    R1,SRCHFLM                                                       
         B     RPASBLD             GET NAME ELEMENT (TITLE)                     
         SPACE 2                                                                
* USE ADV/AHL/AGY CODE AS SEQUENCE NUMBER                                       
*                                                                               
RPASAAH  CLC   ATTAAHNO,=AL3(UNATTRQ)                                           
         BNL   RPASNO                                                           
         MVI   SBSEQNCE,0          USE CODE AS SEQUENCE NUMBER                  
         MVC   SBSEQNCE+1(3),ATTAAHNO                                           
         OI    SBSTYLI,SBPSOVSQ    OVERRIDE SEQUENCE NUMBER                     
         B     RPASBLD                                                          
         DROP R3                                                                
         EJECT                                                                  
***********************************************************************         
* GET GENERAL NAME ELEMENT AND SET UP NAME AREA FOR PASSIVE BUILDING  *         
***********************************************************************         
         SPACE 1                                                                
RPASBLD  ST    R1,SBASRCH          R1=A(SEARCH DIRECTORY ENTRY)                 
         LA    RE,ATTFRSTQ(R2)     RE=A(FIRST ELEMENT)                          
         LA    R0,100                                                           
         SR    RF,RF                                                            
*                                                                               
RPABLD10 IC    RF,1(RE)                                                         
         CLI   0(RE),0                                                          
         BE    RPASNO                                                           
         CLI   0(RE),ATTNELQ                                                    
         BE    RPABLD20                                                         
         AR    RE,RF                                                            
         BCT   R0,RPABLD10                                                      
         B     RPASNO                                                           
*                                                                               
         USING ATTND,RE                                                         
RPABLD20 SH    RF,=Y(ATTNLNQ+1)                                                 
         BM    RPASNO                                                           
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),ATTNAME                                                  
         LA    RF,1(RF)                                                         
         STC   RF,12(R5)           SET L'TEXT                                   
         B     RPASYES             GO TO GENERAL PASSIVE CODE                   
         DROP  RE                                                               
         EJECT                                                                  
***********************************************************************         
* SET EXIT FROM PASSIVE NAME AREA BUILDING ROUTINE                    *         
***********************************************************************         
         SPACE 1                                                                
RPASNO   CLI   *,255               SET CC LOW (-VE) IF NOT SEARCHABLE           
         B     EXIT                                                             
         SPACE 2                                                                
RPASYES  CLC   ATTKEY(ATTRTLQ),SBASAVE       TEST SAME RECTYPE AS PREV          
         BE    RPASY4                                                           
         SPACE 1                                                                
RPASY2   CLI   *,0                 EXIT CC HIGH (RESET SEQUENCE NUM)            
         B     *+6                                                              
*                                                                               
RPASY4   CR    RB,RB               EXIT CC= (SAME SEQUENCE AS LAST REC)         
         MVC   SBASAVE(L'ATTKEY),ATTKEY  SAVE THIS KEY                          
         B     EXIT                                                             
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* SYSTEM KEY SET SUBROUTINE, FOR ALL ATTRIBUTION SEARCHES             *         
***********************************************************************         
         SPACE 1                                                                
RSYSKSET L     R2,4(R1)            ADDRESS OF KEY                               
         USING SR$D,R2                                                          
         XC    SR$KEY,SR$KEY                                                    
         MVI   SR$RECT,SR$RECQ     SET GENERAL NAME SEARCH PASSIVE TYPE         
*                                                                               
RSYSOTH  CLC   SBOTHER,SPACES      ENSURE NULL IF 'EMPTY'                       
         BNE   *+10                                                             
         XC    SBOTHER,SBOTHER                                                  
         MVC   DSCOMMON(DSCOMML),SBOTHER     SAVE ANY PASSED INFO               
         B     GUDEXIT                                                          
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* ADVERTISER SEARCH SUBROUTINES                                       *         
***********************************************************************         
         SPACE 1                                                                
RADVRTNS B     RADVKSET                                                         
         B     RADVSECH          SECURITY CHECK                                 
         B     RADVFILT          FILTER                                         
         B     RADVEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* ADVERTISER SEARCH KEY SET SUBROUTINE                                *         
***********************************************************************         
         SPACE 1                                                                
RADVKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),ADVRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* ADVERTISER SEARCH SECURITY CHECK SUBROUTINE                         *         
***********************************************************************         
         SPACE 1                                                                
RADVSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* ADVERTISER SEARCH FILTER SUBROUTINE                                 *         
***********************************************************************         
         SPACE 1                                                                
RADVFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RADVFD              DIRECTORY FILTER                             
         BL    RADVFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RADVFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RADVFD   OC    DSADVFLT,DSADVFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RADVFI   XC    DSADVFLT,DSADVFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSADVLNQ    SET LENGTH ADVERTISER FILTER AREA.           
         L     R3,ADVAFILT         ADDRESS ADVERTISER FILTER TABLE              
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* ADVERTISER EXTRACT SUBROUTINE                                       *         
***********************************************************************         
         SPACE 1                                                                
RADVEXTR CLI   SBMODE,1                                                         
         BE    RADVEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RADVEXH  LA    R2,SBEXHEAD                                                      
         L     RE,ADVAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SADVEXHL,R2),0(RE)                                             
         LA    RE,SADVEXTT-SADVEXH(R2)                                          
         MVC   0(L'SADVEXT1,RE),SADVEXT1-SADVEXH(R2)                            
         MVC   L'SADVEXT1+1(L'RECS,RE),RECS                                     
RADVEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RADVEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING ADVD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RE,RE                                                            
         ICM   RE,7,ADVNO                                                       
         CVD   RE,DUB                                                           
         UNPK  LSTADV(MAXCDELQ),DUB                                             
         OI    LSTADV+MAXCDELQ-1,ZEROQ                                          
*                                                                               
RADVEX1  LA    R1,LSTADVN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTADVN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
RADVEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* IRISH ADVERTISER SEARCH SUBROUTINES                                 *         
***********************************************************************         
         SPACE 1                                                                
RIADRTNS B     RIADKSET                                                         
         B     RIADSECH          SECURITY CHECK                                 
         B     RIADFILT          FILTER                                         
         B     RIADEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* IRISH ADVERTISER SEARCH KEY SET SUBROUTINE                          *         
***********************************************************************         
         SPACE 1                                                                
RIADKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),IADRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH ADVERTISER SEARCH SECURITY CHECK SUBROUTINE                   *         
***********************************************************************         
         SPACE 1                                                                
RIADSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* IRISH ADVERTISER SEARCH FILTER SUBROUTINE                           *         
***********************************************************************         
         SPACE 1                                                                
RIADFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RIADFD              DIRECTORY FILTER                             
         BL    RIADFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RIADFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RIADFD   OC    DSADVFLT,DSADVFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RIADFI   XC    DSADVFLT,DSADVFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSADVLNQ    SET LENGTH ADVERTISER FILTER AREA.           
         L     R3,ADVAFILT         ADDRESS ADVERTISER FILTER TABLE              
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH ADVERTISER EXTRACT SUBROUTINE                                 *         
***********************************************************************         
         SPACE 1                                                                
RIADEXTR CLI   SBMODE,1                                                         
         BE    RIADEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RIADEXH  LA    R2,SBEXHEAD                                                      
         L     RE,ADVAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SADVEXHL,R2),0(RE)                                             
         LA    RE,SADVEXTT-SADVEXH(R2)                                          
         MVC   0(L'IRISH,RE),IRISH                                              
         LA    RE,L'IRISH+1(RE)                                                 
         MVC   0(L'SADVEXT1,RE),SADVEXT1-SADVEXH(R2)                            
         MVC   L'SADVEXT1+1(L'RECS,RE),RECS                                     
RIADEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RIADEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING ADVD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RE,RE                                                            
         ICM   RE,7,ADVNO                                                       
         CVD   RE,DUB                                                           
         UNPK  LSTADV(MAXCDELQ),DUB                                             
         OI    LSTADV+MAXCDELQ-1,ZEROQ                                          
*                                                                               
RIADEX1  LA    R1,LSTADVN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTADVN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
RIADEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* ADVERTISER HOLDING COMPANY SEARCH SUBROUTINES                       *         
***********************************************************************         
         SPACE 1                                                                
RAHLRTNS B     RAHLKSET                                                         
         B     RAHLSECH          SECURITY CHECK                                 
         B     RAHLFILT          FILTER                                         
         B     RAHLEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* ADVERTISER HOLDING COMPANY SEARCH KEY SET SUBROUTINE                *         
***********************************************************************         
         SPACE 1                                                                
RAHLKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),AHLRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* ADVERTISER HOLDING COMPANY SEARCH SECURITY CHECK SUBROUTINE         *         
***********************************************************************         
         SPACE 1                                                                
RAHLSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* ADVERTISER HOLDING COMPANY SEARCH FILTER SUBROUTINE                 *         
***********************************************************************         
         SPACE 1                                                                
RAHLFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RAHLFD              DIRECTORY FILTER                             
         BL    RAHLFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RAHLFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RAHLFD   OC    DSAHLFLT,DSAHLFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RAHLFI   XC    DSAHLFLT,DSAHLFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSAHLLNQ    SET LENGTH HOLDING CO FILTER AREA.           
         L     R3,ADVAFILT         ADDRESS HOLDING CO FILTER TABLE              
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* ADVERTISER HOLDING COMPANY EXTRACT SUBROUTINE                       *         
***********************************************************************         
         SPACE 1                                                                
RAHLEXTR CLI   SBMODE,1                                                         
         BE    RAHLEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RAHLEXH  LA    R2,SBEXHEAD                                                      
         L     RE,AHLAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SAHLEXHL,R2),0(RE)                                             
         LA    RE,SAHLEXTT-SAHLEXH(R2)                                          
         MVC   0(L'SAHLEXT1,RE),SAHLEXT1-SAHLEXH(R2)                            
         MVC   L'SAHLEXT1+1(L'RECS,RE),RECS                                     
RAHLEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RAHLEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING AHLD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RE,RE                                                            
         ICM   RE,7,AHLNO                                                       
         CVD   RE,DUB                                                           
         UNPK  LSTAHL(MAXCDELQ),DUB                                             
         OI    LSTAHL+MAXCDELQ-1,ZEROQ                                          
*                                                                               
RAHLEX1  LA    R1,LSTAHLN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTAHLN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
*                                                                               
RAHLEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* IRISH ADVERTISER HOLDING COMPANY SEARCH SUBROUTINES                 *         
***********************************************************************         
         SPACE 1                                                                
RIAHRTNS B     RIAHKSET                                                         
         B     RIAHSECH          SECURITY CHECK                                 
         B     RIAHFILT          FILTER                                         
         B     RIAHEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* IRISH ADVERTISER HOLDING COMPANY SEARCH KEY SET SUBROUTINE          *         
***********************************************************************         
         SPACE 1                                                                
RIAHKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),IAHRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH ADVERTISER HOLDING COMPANY SEARCH SECURITY CHECK SUBROUTINE   *         
***********************************************************************         
         SPACE 1                                                                
RIAHSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* IRISH ADVERTISER HOLDING COMPANY SEARCH FILTER SUBROUTINE           *         
***********************************************************************         
         SPACE 1                                                                
RIAHFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RIAHFD              DIRECTORY FILTER                             
         BL    RIAHFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RIAHFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RIAHFD   OC    DSAHLFLT,DSAHLFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RIAHFI   XC    DSAHLFLT,DSAHLFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSAHLLNQ    SET LENGTH HOLDING CO FILTER AREA.           
         L     R3,ADVAFILT         ADDRESS HOLDING CO FILTER TABLE              
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH ADVERTISER HOLDING COMPANY EXTRACT SUBROUTINE                 *         
***********************************************************************         
         SPACE 1                                                                
RIAHEXTR CLI   SBMODE,1                                                         
         BE    RIAHEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RIAHEXH  LA    R2,SBEXHEAD                                                      
         L     RE,AHLAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SAHLEXHL,R2),0(RE)                                             
         LA    RE,SAHLEXTT-SAHLEXH(R2)                                          
         MVC   0(L'IRISH,RE),IRISH                                              
         LA    RE,L'IRISH+1(RE)                                                 
         MVC   0(L'SAHLEXT1,RE),SAHLEXT1-SAHLEXH(R2)                            
         MVC   L'SAHLEXT1+1(L'RECS,RE),RECS                                     
RIAHEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RIAHEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING AHLD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RE,RE                                                            
         ICM   RE,7,AHLNO                                                       
         CVD   RE,DUB                                                           
         UNPK  LSTAHL(MAXCDELQ),DUB                                             
         OI    LSTAHL+MAXCDELQ-1,ZEROQ                                          
*                                                                               
RIAHEX1  LA    R1,LSTAHLN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTAHLN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
*                                                                               
RIAHEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* AGENCY SEARCH SUBROUTINES                                           *         
***********************************************************************         
         SPACE 1                                                                
RAGYRTNS B     RAGYKSET                                                         
         B     RAGYSECH          SECURITY CHECK                                 
         B     RAGYFILT          FILTER                                         
         B     RAGYEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* AGENCY SEARCH KEY SET SUBROUTINE                                    *         
***********************************************************************         
         SPACE 1                                                                
RAGYKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),AGYRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* AGENCY SEARCH SECURITY CHECK SUBROUTINE                             *         
***********************************************************************         
         SPACE 1                                                                
RAGYSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* AGENCY SEARCH FILTER SUBROUTINE                                     *         
***********************************************************************         
         SPACE 1                                                                
RAGYFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RAGYFD              DIRECTORY FILTER                             
         BL    RAGYFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RAGYFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RAGYFD   OC    DSAGYFLT,DSAGYFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RAGYFI   XC    DSAGYFLT,DSAGYFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSAGYLNQ    SET LENGTH AGENCY FILTER AREA.               
         L     R3,AGYAFILT         ADDRESS AGENCY FILTER TABLE                  
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* AGENCY EXTRACT SUBROUTINE                                           *         
***********************************************************************         
         SPACE 1                                                                
RAGYEXTR CLI   SBMODE,1                                                         
         BE    RAGYEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RAGYEXH  LA    R2,SBEXHEAD                                                      
         L     RE,AGYAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SAGYEXHL,R2),0(RE)                                             
         LA    RE,SAGYEXTT-SAGYEXH(R2)                                          
         MVC   0(L'SAGYEXT1,RE),SAGYEXT1-SAGYEXH(R2)                            
         MVC   L'SAGYEXT1+1(L'RECS,RE),RECS                                     
RAGYEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RAGYEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING AGYD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RE,RE                                                            
         ICM   RE,7,AGYNO                                                       
         CVD   RE,DUB                                                           
         UNPK  LSTAGY(MAXCDELQ),DUB                                             
         OI    LSTAGY+MAXCDELQ-1,ZEROQ                                          
*                                                                               
RAGYEX1  LA    R1,LSTAGYN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTAGYN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
*                                                                               
RAGYEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* IRISH AGENCY SEARCH SUBROUTINES                                     *         
***********************************************************************         
         SPACE 1                                                                
RIAGRTNS B     RIAGKSET                                                         
         B     RIAGSECH          SECURITY CHECK                                 
         B     RIAGFILT          FILTER                                         
         B     RIAGEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* IRISH AGENCY SEARCH KEY SET SUBROUTINE                              *         
***********************************************************************         
         SPACE 1                                                                
RIAGKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),IAGRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH AGENCY SEARCH SECURITY CHECK SUBROUTINE                       *         
***********************************************************************         
         SPACE 1                                                                
RIAGSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* IRISH AGENCY SEARCH FILTER SUBROUTINE                               *         
***********************************************************************         
         SPACE 1                                                                
RIAGFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RIAGFD              DIRECTORY FILTER                             
         BL    RIAGFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RIAGFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RIAGFD   OC    DSAGYFLT,DSAGYFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RIAGFI   XC    DSAGYFLT,DSAGYFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSAGYLNQ    SET LENGTH AGENCY FILTER AREA.               
         L     R3,AGYAFILT         ADDRESS AGENCY FILTER TABLE                  
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH AGENCY EXTRACT SUBROUTINE                                     *         
***********************************************************************         
         SPACE 1                                                                
RIAGEXTR CLI   SBMODE,1                                                         
         BE    RIAGEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RIAGEXH  LA    R2,SBEXHEAD                                                      
         L     RE,AGYAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SAGYEXHL,R2),0(RE)                                             
         LA    RE,SAGYEXTT-SAGYEXH(R2)                                          
         MVC   0(L'IRISH,RE),IRISH                                              
         LA    RE,L'IRISH+1(RE)                                                 
         MVC   0(L'SAGYEXT1,RE),SAGYEXT1-SAGYEXH(R2)                            
         MVC   L'SAGYEXT1+1(L'RECS,RE),RECS                                     
RIAGEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RIAGEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING AGYD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RE,RE                                                            
         ICM   RE,7,AGYNO                                                       
         CVD   RE,DUB                                                           
         UNPK  LSTAGY(MAXCDELQ),DUB                                             
         OI    LSTAGY+MAXCDELQ-1,ZEROQ                                          
*                                                                               
RIAGEX1  LA    R1,LSTAGYN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTAGYN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
*                                                                               
RIAGEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* BRAND SEARCH SUBROUTINES                                            *         
***********************************************************************         
         SPACE 1                                                                
RBRDRTNS B     RBRDKSET                                                         
         B     RBRDSECH          SECURITY CHECK                                 
         B     RBRDFILT          FILTER                                         
         B     RBRDEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* BRAND SEARCH KEY SET SUBROUTINE                                     *         
***********************************************************************         
         SPACE 1                                                                
RBRDKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),BRDRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* BRAND SEARCH SECURITY CHECK SUBROUTINE                              *         
***********************************************************************         
         SPACE 1                                                                
RBRDSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* BRAND SEARCH FILTER SUBROUTINE                                      *         
***********************************************************************         
         SPACE 1                                                                
RBRDFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RBRDFD              DIRECTORY FILTER                             
         BL    RBRDFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RBRDFF   B     GUDEXIT                                                          
         SPACE 1                                                                
         USING SR$D,R2                                                          
RBRDFD   OC    DSBRDFLT,DSBRDFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT                                                          
         CLC   DSBRDMM1,SR$DMMS1                                                
         BNE   EFLT                                                             
         CLI   DSBRDMM2,0                                                       
         BE    GUDEXIT                                                          
         CLC   DSBRDMM2,SR$DMMS2                                                
         BNE   EFLT                                                             
         CLI   DSBRDMM3,0                                                       
         BE    GUDEXIT                                                          
         CLC   DSBRDMM3,SR$DMMS3                                                
         BNE   EFLT                                                             
         B     GUDEXIT                                                          
         SPACE 1                                                                
RBRDFI   XC    DSBRDFLT,DSBRDFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSBRDLNQ    SET LENGTH BRAND FILTER AREA.                
         L     R3,BRDAFILT         ADDRESS BRAND FILTER TABLE                   
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         OC    DSBRDFLT,DSBRDFLT   TEST IF USER HAS OVERRIDEN FILTER            
         BNZ   *+10                                                             
         MVC   DSBRDFLT,DSBRDDEF   SET DEFAULT FILTERS FROM CALLER              
*                                                                               
         OC    DSBRDFLT,DSBRDFLT   TEST IF ANY FILTER ACTIVE                    
         BZ    GUDEXIT                                                          
         OI    SBSTYLO,SBSTDFLQ    ENABLE DIRECTORY FILTERING                   
         B     GUDEXIT                                                          
         SPACE 2                                                                
* MMS CATEGORY FILTER PROCESSING                                                
*                                                                               
RBRDMMS  EQU   *                                                                
         DC    CL24'999999'                                                     
         NTR1  ,                                                                
         USING SCANBLKD,R4                                                      
         CLI   SC2NDLEN,2          MUST BE AT LEAST LVL1                        
         BL    EIFV                                                             
         CLI   SC2NDLEN,6                                                       
         BH    EIFV                                                             
         TM    SC2NDLEN,1          MUST BE EVEN                                 
         BNZ   EIFV                                                             
         SR    R1,R1                                                            
         IC    R1,SC2NDLEN         MUST BE NUMERIC                              
         BCTR  R1,0                                                             
         LA    RE,SC2NDFLD                                                      
         EX    R1,MVCZEROS                                                      
         EX    R1,MVZ0RE                                                        
         EX    R1,CLCZEROS                                                      
         BNE   EIFV                                                             
*                                                                               
         PACK  DUB,SC2NDFLD(2)                                                  
         CVB   R1,DUB                                                           
         STC   R1,DSBRDMM1                                                      
         CLI   SC2NDLEN,2                                                       
         BNH   RBRDM10                                                          
*                                                                               
         PACK  DUB,SC2NDFLD+2(2)                                                
         CVB   R1,DUB                                                           
         STC   R1,DSBRDMM2                                                      
         CLI   SC2NDLEN,4                                                       
         BNH   RBRDM10                                                          
*                                                                               
         PACK  DUB,SC2NDFLD+4(2)                                                
         CVB   R1,DUB                                                           
         STC   R1,DSBRDMM3                                                      
         SPACE 1                                                                
RBRDM10  XC    KEY,KEY             VALIDATE MMS CATEGORY INPUT                  
         LA    R1,KEY                                                           
         USING MMSD,R1                                                          
         MVI   MMSRECT,MMSRECQ                                                  
         MVC   MMSCAT,DSBRDMMS                                                  
         DROP  R1                                                               
         L     RF,SBCOMFAC                                                      
         L     RF,CDATAMGR-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,DMREAD,MEDDIR,KEY,KEY,0                                
         CLI   8(R1),0                                                          
         BNE   EIFV                                                             
         B     GUDEXIT                                                          
         DROP  R4                                                               
         SPACE 1                                                                
MVCZEROS MVC   WORK(0),ZEROS                                                    
MVZ0RE   MVZ   WORK(0),0(RE)                                                    
CLCZEROS CLC   WORK(0),ZEROS                                                    
PACKDUB  PACK  DUB,0(0,RE)                                                      
         EJECT                                                                  
***********************************************************************         
* BRAND EXTRACT SUBROUTINE                                            *         
***********************************************************************         
         SPACE 1                                                                
RBRDEXTR CLI   SBMODE,1                                                         
         BE    RBRDEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RBRDEXH  LA    R2,SBEXHEAD                                                      
         L     RE,BRDAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SBRDEXHL,R2),0(RE)                                             
         LA    RE,SBRDEXTT-SBRDEXH(R2)                                          
         MVC   0(L'SBRDEXT1,RE),SBRDEXT1-SBRDEXH(R2)                            
         MVC   L'SBRDEXT1(L'RECS,RE),RECS                                       
         LA    RE,L'SBRDEXT1+L'RECS+1(RE)                                       
         LA    RF,DSBRDFLT                                                      
         OC    DSBRDFLT,DSBRDFLT   TEST IF CATEGORY FILTER PRESENT              
         BNZ   RBRDEXH1                                                         
         LA    RF,DSBRDDEF         CALLERS FILTER DEFAULTS                      
         OC    DSBRDDEF,DSBRDDEF                                                
         BZ    RBRDEXHX                                                         
*                                                                               
RBRDEXH1 MVC   0(16,RE),=C'Within NMR Group'                                    
         SR    R1,R1                                                            
         IC    R1,0(RF)                                                         
         CVD   R1,DUB                                                           
         UNPK  17(2,RE),DUB                                                     
         OI    18(RE),C'0'                                                      
         ICM   R1,1,1(RF)                                                       
         BZ    RBRDEXHX                                                         
         CVD   R1,DUB                                                           
         UNPK  19(2,RE),DUB                                                     
         OI    20(RE),C'0'                                                      
         ICM   R1,1,2(RF)                                                       
         BZ    RBRDEXHX                                                         
         CVD   R1,DUB                                                           
         UNPK  21(2,RE),DUB                                                     
         OI    22(RE),C'0'                                                      
*                                                                               
RBRDEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RBRDEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING BRDD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RF,RF                                                            
         ICM   RF,7,BRDNO                                                       
         CVD   RF,DUB                                                           
         UNPK  LSTBRD,DUB                                                       
         OI    LSTBRD+L'LSTBRD-1,C'0'                                           
*                                                                               
         LA    R1,LSTBRDN          GET BRAND NAME                               
         LA    R0,L'LSTBRDN                                                     
         BAS   RE,GETNAME                                                       
         SPACE 1                                                                
         CLI   DSBRDMM3,0          TEST IF MMS FILTER ACTIVE LOWEST LVL         
         BNE   RBRDEXX                                                          
         LA    RE,BRDFIRST(R3)     GET MMS ELEMENT                              
         SR    RF,RF                                                            
RBRDEX10 IC    RF,1(RE)                                                         
         CLI   0(RE),0                                                          
         BE    RBRDEXX                                                          
         CLI   0(RE),BRDMELQ                                                    
         BE    RBRDEX20                                                         
         AR    RE,RF                                                            
         B     RBRDEX10                                                         
*                                                                               
RBRDEX20 SR    R1,R1                                                            
         IC    R1,BRDML1-BRDMD(RE)                                              
         CVD   R1,DUB                                                           
         UNPK  LSTBMMS1,DUB                                                     
         OI    LSTBMMS1+L'LSTBMMS1-1,C'0'                                       
*                                                                               
         IC    R1,BRDML2-BRDMD(RE)                                              
         CVD   R1,DUB                                                           
         UNPK  LSTBMMS2,DUB                                                     
         OI    LSTBMMS2+L'LSTBMMS2-1,C'0'                                       
*                                                                               
         IC    R1,BRDML3-BRDMD(RE)                                              
         CVD   R1,DUB                                                           
         UNPK  LSTBMMS3,DUB                                                     
         OI    LSTBMMS3+L'LSTBMMS3-1,C'0'                                       
         SPACE 1                                                                
RBRDEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
         B     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* IRISH BRAND SEARCH SUBROUTINES                                      *         
***********************************************************************         
         SPACE 1                                                                
RIBRRTNS B     RIBRKSET                                                         
         B     RIBRSECH          SECURITY CHECK                                 
         B     RIBRFILT          FILTER                                         
         B     RIBREXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* IRISH BRAND SEARCH KEY SET SUBROUTINE                               *         
***********************************************************************         
         SPACE 1                                                                
RIBRKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),IBRRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH BRAND SEARCH SECURITY CHECK SUBROUTINE                        *         
***********************************************************************         
         SPACE 1                                                                
RIBRSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* IRISH BRAND SEARCH FILTER SUBROUTINE                                *         
***********************************************************************         
         SPACE 1                                                                
RIBRFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RIBRFD              DIRECTORY FILTER                             
         BL    RIBRFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RIBRFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RIBRFD   OC    DSIBRFLT,DSIBRFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RIBRFI   XC    DSIBRFLT,DSIBRFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSIBRLNQ    SET LENGTH BRAND FILTER AREA.                
         L     R3,IBRAFILT         ADDRESS BRAND FILTER TABLE                   
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* IRISH BRAND EXTRACT SUBROUTINE                                      *         
***********************************************************************         
         SPACE 1                                                                
RIBREXTR CLI   SBMODE,1                                                         
         BE    RIBREXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RIBREXH  LA    R2,SBEXHEAD                                                      
         L     RE,IBRAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SIBREXHL,R2),0(RE)                                             
         LA    RE,SIBREXTT-SIBREXH(R2)                                          
         MVC   0(L'SIBREXT1,RE),SIBREXT1-SIBREXH(R2)                            
         MVC   L'SIBREXT1(L'RECS,RE),RECS                                       
         LA    RE,L'SIBREXT1+L'RECS+1(RE)                                       
         LA    RF,DSIBRFLT                                                      
*                                                                               
RIBREXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RIBREXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING BRDD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    RF,RF                                                            
         ICM   RF,7,BRDNO                                                       
         CVD   RF,DUB                                                           
         UNPK  LSTBRD,DUB                                                       
         OI    LSTBRD+L'LSTBRD-1,C'0'                                           
*                                                                               
         LA    R1,LSTIBRDN         GET BRAND NAME                               
         LA    R0,L'LSTIBRDN                                                    
         BAS   RE,GETNAME                                                       
         SPACE 1                                                                
RIBREXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
         B     EXIT                                                             
***********************************************************************         
* MMS CATEGORY SEARCH SUBROUTINES                                     *         
***********************************************************************         
         SPACE 1                                                                
RMMSRTNS B     RMMSKSET                                                         
         B     RMMSSECH          SECURITY CHECK                                 
         B     RMMSFILT          FILTER                                         
         B     RMMSEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* MMS CATEGORY SEARCH KEY SET SUBROUTINE                              *         
***********************************************************************         
         SPACE 1                                                                
RMMSKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),MMSRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* MMS CATEGORY SEARCH SECURITY CHECK SUBROUTINE                       *         
***********************************************************************         
         SPACE 1                                                                
RMMSSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* MMS CATEGORY SEARCH FILTER SUBROUTINE                               *         
***********************************************************************         
         SPACE 1                                                                
RMMSFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RMMSFD              DIRECTORY FILTER                             
         BL    RMMSFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RMMSFF   CLI   ATTRECT-ATTRECD(R2),MMSRECQ                                      
         BNE   EIFV                POINTER MAY HAVE BEEN TO BRAND               
         B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RMMSFD   OC    DSMMSFLT,DSMMSFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RMMSFI   XC    DSMMSFLT,DSMMSFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSMMSLNQ    SET LENGTH CATEGORY FILTER AREA.             
         L     R3,MMSAFILT         ADDRESS CATEGORY FILTER TABLE                
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* MMS CATEGORY EXTRACT SUBROUTINE                                     *         
***********************************************************************         
         SPACE 1                                                                
RMMSEXTR CLI   SBMODE,1                                                         
         BE    RMMSEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RMMSEXH  LA    R2,SBEXHEAD                                                      
         L     RE,MMSAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SMMSEXHL,R2),0(RE)                                             
         LA    RE,SMMSEXTT-SMMSEXH(R2)                                          
         MVC   0(L'SMMSEXT1,RE),SMMSEXT1-SMMSEXH(R2)                            
         MVC   L'SMMSEXT1+1(L'RECS,RE),RECS                                     
RMMSEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RMMSEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING MMSD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         SR    R1,R1                                                            
         IC    R1,MMSL1                                                         
         CVD   R1,DUB                                                           
         UNPK  LSTMMS1,DUB                                                      
         OI    LSTMMS1+L'LSTMMS1-1,C'0'                                         
         ICM   R1,1,MMSL2                                                       
         BZ    RMMSEX10                                                         
         CVD   R1,DUB                                                           
         UNPK  LSTMMS2,DUB                                                      
         OI    LSTMMS2+L'LSTMMS2-1,C'0'                                         
         ICM   R1,1,MMSL3                                                       
         BZ    RMMSEX10                                                         
         CVD   R1,DUB                                                           
         UNPK  LSTMMS3,DUB                                                      
         OI    LSTMMS3+L'LSTMMS3-1,C'0'                                         
         SPACE 1                                                                
RMMSEX10 LA    R1,LSTMMSN          GET FULL NAME ELEMENT                        
         LA    R0,L'LSTMMSN                                                     
         BAS   RE,GETNAME                                                       
RMMSEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* FILM SEARCH SUBROUTINES                                             *         
***********************************************************************         
         SPACE 1                                                                
RFLMRTNS B     RFLMKSET                                                         
         B     RFLMSECH          SECURITY CHECK                                 
         B     RFLMFILT          FILTER                                         
         B     RFLMEXTR          RECORD EXTRACT                                 
         SPACE 1                                                                
***********************************************************************         
* FILM SEARCH KEY SET SUBROUTINE                                      *         
***********************************************************************         
         SPACE 1                                                                
RFLMKSET L     R2,4(R1)            ADDRESS OF KEY                               
         OI    SR$IND-SR$D(R2),FLMRECQ                                          
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* FILM SEARCH SECURITY CHECK SUBROUTINE                               *         
***********************************************************************         
         SPACE 1                                                                
RFLMSECH EQU   GUDEXIT             NOT DEFINED                                  
         SPACE 1                                                                
***********************************************************************         
* FILM SEARCH FILTER SUBROUTINE                                       *         
***********************************************************************         
         SPACE 1                                                                
RFLMFILT L     R2,4(R1)            RECORD ADDRESS/KEY FIELD ADDRESS             
         CLI   SBMODE,1                                                         
         BE    RFLMFD              DIRECTORY FILTER                             
         BL    RFLMFI              INITIALIZE FILTERS                           
         CLI   SBMODE,2                                                         
         BH    GUDEXIT             UNKNOWN MODE                                 
*                                                                               
RFLMFF   B     GUDEXIT             FILTERING AT DIRECTORY ONLY                  
         SPACE 1                                                                
         USING SR$D,R2                                                          
RFLMFD   OC    DSFLMFLT,DSFLMFLT   TEST IF FILTER ACTIVE                        
         BZ    GUDEXIT             NO FILTERS DEFINED (YET)                     
         B     GUDEXIT                                                          
         SPACE 1                                                                
RFLMFI   XC    DSFLMFLT,DSFLMFLT   INITIALIZE  FILTERS                          
         MVI   SBLFILT,DSFLMLNQ    SET LENGTH FILM FILTER AREA.                 
         L     R3,FLMAFILT         ADDRESS FILM FILTER TABLE                    
         A     R3,RELO                                                          
         BAS   RE,R$FILTER         STANDARD FILTER PROCESSOR                    
         BNE   EXIT                                                             
         B     GUDEXIT                                                          
         EJECT                                                                  
***********************************************************************         
* FILM EXTRACT SUBROUTINE                                             *         
***********************************************************************         
         SPACE 1                                                                
RFLMEXTR CLI   SBMODE,1                                                         
         BE    RFLMEXD             EXTRACT DETAIL LINE                          
         BH    GUDEXIT             UNKNOWN MODE                                 
         SPACE 1                                                                
RFLMEXH  LA    R2,SBEXHEAD                                                      
         L     RE,FLMAEXHD                                                      
         A     RE,RELO                                                          
         MVC   0(SFLMEXHL,R2),0(RE)                                             
         LA    RE,SFLMEXTT-SFLMEXH(R2)                                          
         MVC   0(L'SFLMEXT1,RE),SFLMEXT1-SFLMEXH(R2)                            
         MVC   L'SFLMEXT1+1(L'RECS,RE),RECS                                     
RFLMEXHX B     GUDEXIT                                                          
         SPACE 1                                                                
RFLMEXD  LM    R2,R3,4(R1)         OUTPUT AREA/RECORD AREA                      
         USING LSTD,R2                                                          
         USING FLMD,R3                                                          
         MVI   LSTLIN,C' '                                                      
         MVC   LSTLIN+1(L'LSTLIN-1),LSTLIN                                      
         MVC   LSTFLM(L'FLMCODE),FLMCODE                                        
*                                                                               
RFLMEX1  LA    R1,LSTFLMN          GET NAME ELEMENT (COMMERCIAL TITLE)          
         LA    R0,L'LSTFLMN                                                     
         BAS   RE,GETNAME                                                       
*                                                                               
*                                                                               
RFLMEXX  B     GUDEXIT                                                          
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* COMMON SUBROUTINES                                                  *         
***********************************************************************         
         SPACE 1                                                                
***********************************************************************         
* GET NAME ELEMENT FOR LIST.                                          *         
* PASS R0=L'MAX OUTPUT,R1=A(OUTPUT),R3=A(RECORD)                      *         
***********************************************************************         
         SPACE 1                                                                
GETNAME  ST    RE,SAVERE                                                        
         LA    RE,ATTFRSTQ(R3)     GET FULL NAME ELEMENT                        
         SR    RF,RF                                                            
GETN10   IC    RF,1(RE)                                                         
         CLI   0(RE),0                                                          
         BE    GETNX                                                            
         CLI   0(RE),ATTNELQ                                                    
         BE    GETN20                                                           
         AR    RE,RF                                                            
         B     GETN10                                                           
         SPACE 1                                                                
         USING ATTND,RE                                                         
GETN20   SH    RF,=Y(ATTNLNQ+1)                                                 
         BM    GETNX                                                            
         CR    RF,R0               R0=MAX LENGTH ALLOWED                        
         BNH   *+6                                                              
         LR    RF,R0                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),ATTNAME                                                  
         DROP  RE                                                               
         SPACE 1                                                                
GETNX    L     RE,SAVERE                                                        
         BR    RE                                                               
         SPACE 1                                                                
***********************************************************************         
*        ACQUIRE WORKING STORAGE                                      *         
*        R1=LENGTH OF STORAGE TO AQUIRE                               *         
*        R0=ADDRESS OF STORAGE AQUIRED ON EXIT                        *         
***********************************************************************         
R$GETWRK LA    R1,7(R1)            ROUND TO NEXT DWRD                           
         SRL   R1,3                                                             
         SLL   R1,3                                                             
         L     RF,4(RD)            GET PREVIOUS SAVE AREA                       
         LR    R0,RD               ADDRESS OF STORAGE AQUIRED                   
         AR    RD,R1               EXTEND STORAGE                               
         ST    RD,8(RF)            SET NEW FORWARD POINTER                      
         ST    RF,4(RD)            SAVE BACKWARD POINTER IN NEW SVAREA          
         BR    RE                                                               
         SPACE 1                                                                
***********************************************************************         
*        FREE ALL "GETWRK'D" STORAGE                                  *         
***********************************************************************         
R$PUTWRK L     RF,4(RD)            GET PREVIOUS SAVE AREA                       
         LA    RD,72(RF)           RESET RD TO END OF IT                        
         CR    RD,RC               IS THIS OUR NMODDED W/S                      
         BNE   *+8                                                              
         LA    RD,(((SRCHWRKL+7)/8)*8)(RD) ALLOW FOR IT IF IT IS                
         ST    RD,8(RF)            RESET FORWARD POINTER                        
         ST    RF,4(RD)            RESET BACKWARD POINTER                       
         BR    RE                                                               
         SPACE 1                                                                
         EJECT                                                                  
***********************************************************************         
*        FILTER COMMON VALIDATION                                     *         
*        R2=A(TWA FIELD INPUT)                                        *         
*        R3=A(TABLE OF FILTER KEYWORDS AND ROUTINE ADDRESSES)         *         
***********************************************************************         
         SPACE 1                                                                
R$FILTER NTR1                                                                   
         MVI   GTINDX-GTBLOCK+SBTXTBLK,0                                        
         MVI   SBERRFLD,2          INDICATE KEY FIELD                           
         MVI   SBNNAMES,0          INDICATE NO NAMES FOUND YET                  
*                                                                               
         CLI   5(R2),0                                                          
         BE    EMIF                MUST BE SOMETHING INPUT                      
*                                                                               
         CLI   8(R2),C'?'                                                       
         BE    R$FILHLP                                                         
         CLC   8(4,R2),=C'HELP'                                                 
         BE    R$FILHLP                                                         
*                                  GRAB STORAGE FOR SCANNER BLOCK               
         LA    R1,(SCBLKLQ+20)*(SBMNAMEQ+2)                                     
         BAS   RE,R$GETWRK                                                      
         LR    R4,R0               BLOCK ADDRESS                                
         USING SCANBLKD,R4                                                      
*                                                                               
         L     RF,SBCOMFAC                                                      
         L     RF,CSCANNER-COMFACSD(RF)                                         
         LA    R0,SBMNAMEQ+1                                                    
         GOTO1 (RF),DMCB,(30,(R2)),((R0),SCANBLKD)                              
         ZIC   R0,4(R1)                                                         
         CLI   4(R1),1                                                          
         BL    EIIF                SCANNER ERROR                                
         BE    R$FIL10                                                          
         CLI   4(R1),SBMNAMEQ                                                   
         BH    ETMN                TOO MANY ITEMS                               
*                                                                               
R$FIL10  IC    R1,GTINDX-GTBLOCK+SBTXTBLK CHECK NEXT ITEM FROM SCANNER          
         LA    R1,1(R1)                                                         
         STC   R1,GTINDX-GTBLOCK+SBTXTBLK                                       
*                                                                               
         NC    SC1STLEN(L'SC1STLEN+L'SC2NDLEN),SC1STLEN                         
         BZ    R$FIL20             IGNORE NULL ENTRIES                          
         CLI   SC2NDLEN,0          IF NO RIGHT HALF,                            
         BNE   R$FIL12             ASSUME ITS NAME FIELD                        
         MVC   SBOPTTXT(4),=C'NAME'                                             
         MVI   GTLTXT-GTBLOCK+SBTXTBLK,4                                        
         B     R$FILNM+24                                                       
*                                                                               
R$FIL12  MVC   SBOPTTXT(10),SC1STFLD                                            
         MVC   GTLTXT-GTBLOCK+SBTXTBLK,SC1STLEN                                 
*                                                                               
         CLI   SC1STLEN,FLT$NLQ    KEYWORD MUST BE 8 CHARS MAX                  
         BH    EIKW                                                             
         ZIC   R1,SC1STLEN         GET LENGTH OF KEYWORD                        
         SH    R1,=H'1'                                                         
         BM    EIKW                ERROR IF RIGHT SIDE WITHOUT LEFT             
*                                                                               
         LR    RE,R3               ADDRESS KWD TABLE                            
         USING FLT$D,RE                                                         
R$FIL15  CLI   0(RE),0                                                          
         BE    EIKW                NOT IN TABLE                                 
         MVC   WORK(FLT$NLQ),FLT$NAME        CONVERT TO UPPER CASE              
         OC    WORK(FLT$NLQ),SPACES                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   SC1STFLD(0),WORK                                                 
         BE    *+12                                                             
         LA    RE,FLT$ENTQ(RE)                                                  
         B     R$FIL15                                                          
*                                                                               
         XR    RF,RF                                                            
         ICM   RF,3,FLT$RTN        GET OFFSET OF ROUTINE                        
         BZ    R$FILNM+24          IF NULL OFFSET, FIELD IS A NAME              
         DROP  RE                                                               
*                                                                               
*                                                                               
R$FIL18  BAS   RE,24(RB,RF)        GO TO IT                                     
         BNZ   EXIT                STRAIGHT OUT IF ANY ERROR                    
*                                                                               
R$FIL20  LA    R4,SCBLKLQ+20(R4)           NEXT FILTER ENTRY                    
         MVI   GTLTXT-GTBLOCK+SBTXTBLK,0                                        
         BCT   R0,R$FIL10          LOOP TILL ALL DONE                           
*                                                                               
R$FIL30  MVI   GTINDX-GTBLOCK+SBTXTBLK,0 ALL DONE                               
         MVI   SBERRFLD,0                                                       
         B     GUDEXIT                                                          
         SPACE 1                                                                
*        HANDLE A NAME FIELD IN FORM NAME=XXXXX OR JUST XXXXX                   
*                                                                               
R$FILNM  DC    CL24'upto 10x30 chrs'                                            
         LA    RF,SC2NDFLD         ADDRESS NAME OPERAND                         
         ICM   RF,8,SC2NDLEN       AND LENGTH                                   
         CLI   SC2NDLEN,0                                                       
         BNE   R$FILNM1            SKIP IF KEYWORD USED                         
         LA    RF,SC1STFLD         ELSE ADDRESS NAME                            
         ICM   RF,8,SC1STLEN       AND LENGTH                                   
*                                                                               
R$FILNM1 CLM   RF,8,=AL1(30)        IS NAME TOO LONG                            
         BH    EFTL                                                             
*                                                                               
R$FILNM2 GOTO1 ,DMCB,(RA),(RF)                                                  
         MVI   DMCB,SBPARSKQ       KEY STYLE CALL                               
         GOTO1 SBPARSER            PARSE NAME                                   
         BZ    R$FIL20                     AL1(0),AL3(SEARCH BLOCK)             
         B     ETXTSET             PARSER FOUND AN ERROR                        
         SPACE 1                                                                
         DROP  R4                                                               
*        FILTER HELP ROUTINE                                                    
*                                                                               
R$FILHLP ZIC   R4,0(R2)            LENGTH OF O/P FIELD                          
         SH    R4,=Y(8)                                                         
         TM    1(R4),X'02'                                                      
         BZ    *+8                                                              
         SH    R4,=Y(8)                                                         
         OI    6(R2),X'C0'         CURSOR + TRANSMIT                            
*                                                                               
         LA    R2,8(R2)            START OF O/P FIELD                           
         MVI   WORK,0              INDICATE FIRST                               
         USING FLT$D,R3                                                         
*                                                                               
R$FILH10 CLI   FLT$ENT,0       END OF FILTER TABLE                              
         BE    EHLP                                                             
         XR    R1,R1                                                            
R$FILH14 LA    RE,WORK                                                          
         CLI   WORK,0              FIRST TIME, NO COMMA                         
         BE    *+12                                                             
         MVI   WORK,C','                                                        
         LA    RE,WORK+1                                                        
         MVC   0(8,RE),FLT$NAME    MOVE FILTER KEYWORD                          
         LA    RE,7(RE)                                                         
         CLI   0(RE),C' '                                                       
         BNE   *+8                                                              
         BCT   RE,*-8                                                           
         MVI   1(RE),C'='                                                       
         XR    RF,RF                                                            
         ICM   RF,3,FLT$RTN        GET OFFSET OF HELP                           
         BZ    *+10                                                             
         AR    RF,RB                                                            
         B     *+8                                                              
         LA    RF,R$FILNM          IF NULL, FIELD IS A NAME                     
         MVC   2(24,RE),0(RF)      MOVE HELP AFTER FILTER KWORD                 
         LA    RE,25(RE)           GET TOTAL LENGTH OF TEXT                     
         CLI   0(RE),C' '                                                       
         BNE   *+8                                                              
         BCT   RE,*-8                                                           
         LA    RF,WORK-1                                                        
         SR    RE,RF                                                            
         CR    RE,R4               COMPARE WITH SPACE LEFT                      
         BNH   R$FILH15            NO ROOM FOR THIS ENTRY                       
         LTR   RE,R4               USE WHATS LEFT IF NOT ENOUGH                 
         BZ    EHLP                NO SPACE LEFT                                
R$FILH15 SR    R4,RE                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8              MOVE IT IN                                   
         B     *+10                                                             
         MVC   0(0,R2),WORK                                                     
         LA    R2,1(R2,RE)                                                      
*                                                                               
R$FILH20 LA    R3,FLT$ENTQ(R3)     NEXT ENTRY                                   
         B     R$FILH10                                                         
         DROP  R3                                                               
         EJECT                                                                  
***********************************************************************         
*        DIRECT STORAGE (ADDRESSED BY BASE/DISPLACEMENT)              *         
***********************************************************************         
         SPACE 1                                                                
MEDDIR   DC    CL8'MEDDIR'                                                      
MEDFIL   DC    CL8'MEDFIL'                                                      
DMREAD   DC    CL8'DMREAD'                                                      
DMRDHI   DC    CL8'DMRDHI'                                                      
GETREC   DC    CL8'GETREC'                                                      
         SPACE 2                                                                
ADVAEXHD DC    A(SADVEXH)          ADVERTISER EXTRACT HEADER                    
ADVAFILT DC    A(ADVFILT)          ADVERTISER FILTER TABLE                      
         SPACE 2                                                                
AHLAEXHD DC    A(SAHLEXH)          ADVERTISER HOLDING CO EXTRACT HEADER         
AHLAFILT DC    A(AHLFILT)          ADVERTISER HOLDING CO FILTER TABLE           
         SPACE 2                                                                
AGYAEXHD DC    A(SAGYEXH)          AGENCY EXTRACT HEADER                        
AGYAFILT DC    A(AGYFILT)          AGENCY FILTER TABLE                          
         SPACE 2                                                                
BRDAEXHD DC    A(SBRDEXH)          BRAND EXTRACT HEADER                         
BRDAFILT DC    A(BRDFILT)          BRAND FILTER TABLE                           
         SPACE 2                                                                
IBRAEXHD DC    A(SIBREXH)          IRISH BRAND EXTRACT HEADER                   
IBRAFILT DC    A(IBRFILT)          IRISH BRAND FILTER TABLE                     
         SPACE 2                                                                
MMSAEXHD DC    A(SMMSEXH)          MMS CATEGORY EXTRACT HEADER                  
MMSAFILT DC    A(MMSFILT)          MMS CATEGORY FILTER TABLE                    
         SPACE 2                                                                
FLMAEXHD DC    A(SFLMEXH)          FILM EXTRACT HEADER                          
FLMAFILT DC    A(FLMFILT)          FILM FILTER TABLE                            
         SPACE 2                                                                
ZEROS    DS    0CL10                                                            
         DC    10C'0'                                                           
SPACES   DS    0CL20                                                            
         DC    20C' '                                                           
RECS     DC    CL7'Records'                                                     
IRISH    DC    CL5'Irish'                                                       
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        INDIRECT STORAGE (ADDRESSED BY ACONS)                        *         
***********************************************************************         
         SPACE 1                                                                
***********************************************************************         
* ADVERTISER EXTRACT HEADER                                           *         
***********************************************************************         
         SPACE 1                                                                
SADVEXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SADVEXH1-SADVEXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SADVEXH2-SADVEXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SADVEXTT)     LENGTH OF TITLE                              
SADVEXTT DC    CL40' '                                                          
SADVEXH1 DS    0C                  ADVERTISER CODE (KEY) ENTRY                  
         DC    AL1(SADVEXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SADVEXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SADVEXT1)                                                  
SADVEXT1 DC    CL10'Advertiser'                                                 
SADVEXH2 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SADVEXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTADVN-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'LSTADVN+5)    ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(4),C'Name'      1ST HEAD LINE                                
SADVEXHX DS    AL1(0)              TERMINATOR                                   
SADVEXHL EQU   *-SADVEXH                                                        
         SPACE 1                                                                
***********************************************************************         
* ADVERTISER HOLDING COMPANY EXTRACT HEADER                           *         
***********************************************************************         
         SPACE 1                                                                
SAHLEXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SAHLEXH1-SAHLEXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SAHLEXH2-SAHLEXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SAHLEXTT)     LENGTH OF TITLE                              
SAHLEXTT DC    CL40' '                                                          
SAHLEXH1 DS    0C                  ADV HOLDING CO CODE (KEY) ENTRY              
         DC    AL1(SAHLEXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SAHLEXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SAHLEXT1)                                                  
SAHLEXT1 DC    CL7'Hld Co.'                                                     
SAHLEXH2 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SAHLEXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTAHLN-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'LSTAHLN+5)    ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(4),C'Name'      1ST HEAD LINE                                
SAHLEXHX DS    AL1(0)              TERMINATOR                                   
SAHLEXHL EQU   *-SAHLEXH                                                        
         SPACE 1                                                                
***********************************************************************         
* AGENCY EXTRACT HEADER                                               *         
***********************************************************************         
         SPACE 1                                                                
SAGYEXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SAGYEXH1-SAGYEXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SAGYEXH2-SAGYEXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SAGYEXTT)     LENGTH OF TITLE                              
SAGYEXTT DC    CL40' '                                                          
SAGYEXH1 DS    0C                  AGENCY CODE (KEY) ENTRY                      
         DC    AL1(SAGYEXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SAGYEXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SAGYEXT1)                                                  
SAGYEXT1 DC    CL6'Agency'                                                      
SAGYEXH2 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SAGYEXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTAGYN-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'LSTAGYN+5)    ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(4),C'Name'      1ST HEAD LINE                                
SAGYEXHX DS    AL1(0)              TERMINATOR                                   
SAGYEXHL EQU   *-SAGYEXH                                                        
         SPACE 1                                                                
***********************************************************************         
* BRAND EXTRACT HEADER                                                *         
***********************************************************************         
         SPACE 1                                                                
SBRDEXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SBRDEXH1-SBRDEXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SBRDEXH2-SBRDEXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SBRDEXTT)     LENGTH OF TITLE                              
SBRDEXTT DC    CL40' '                                                          
SBRDEXH1 DS    0C                  BRAND NUMBER (KEY) ENTRY                     
         DC    AL1(SBRDEXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SBRDEXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SBRDEXT1)                                                  
SBRDEXT1 DC    CL6'Brand'                                                       
SBRDEXH2 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SBRDEXH3-*)     ENTRY LENGTH                                 
         DC    AL1(LSTBRDN-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'LSTBRDN)      ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(4),C'Name'      1ST HEAD LINE                                
SBRDEXH3 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SBRDEXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTBMMS-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'SBRDEXT3)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SBRDEXT3)                                                  
SBRDEXT3 DC    CL6'NMR'                                                         
SBRDEXHX DS    AL1(0)              TERMINATOR                                   
SBRDEXHL EQU   *-SBRDEXH                                                        
         SPACE 1                                                                
***********************************************************************         
* IRISH BRAND EXTRACT HEADER                                          *         
***********************************************************************         
         SPACE 1                                                                
SIBREXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SIBREXH1-SIBREXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SIBREXH2-SIBREXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SIBREXTT)     LENGTH OF TITLE                              
SIBREXTT DC    CL40' '                                                          
SIBREXH1 DS    0C                  BRAND NUMBER (KEY) ENTRY                     
         DC    AL1(SIBREXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SIBREXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SIBREXT1)                                                  
SIBREXT1 DC    CL12'Irish Brand'                                                
SIBREXH2 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SIBREXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTIBRDN-LSTD)  ITEM DISPLACEMENT                            
         DC    AL1(L'LSTIBRDN)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(4),C'Name'      1ST HEAD LINE                                
SIBREXHX DS    AL1(0)              TERMINATOR                                   
SIBREXHL EQU   *-SIBREXH                                                        
         SPACE 1                                                                
***********************************************************************         
* MMS CATEGORY EXTRACT HEADER                                         *         
***********************************************************************         
         SPACE 1                                                                
SMMSEXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SMMSEXH1-SMMSEXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SMMSEXH2-SMMSEXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SMMSEXTT)     LENGTH OF TITLE                              
SMMSEXTT DC    CL40' '                                                          
SMMSEXH1 DS    0C                  CATEGORY (KEY) ENTRY                         
         DC    AL1(SMMSEXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SMMSEXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SMMSEXT1)                                                  
SMMSEXT1 DC    CL12'NMR Category'                                               
SMMSEXH2 DS    0C                  FULL NAME ENTRY                              
         DC    AL1(SMMSEXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTMMSN-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'LSTMMSN)      ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(4),C'Name'      1ST HEAD LINE                                
SMMSEXHX DS    AL1(0)              TERMINATOR                                   
SMMSEXHL EQU   *-SMMSEXH                                                        
         EJECT                                                                  
***********************************************************************         
* FILM EXTRACT HEADER                                                 *         
***********************************************************************         
         SPACE 1                                                                
SFLMEXH  DS    0C                                                               
         DC    AL1(1)              MAXIMUM HEAD LINES USED                      
         DC    AL1(SFLMEXH1-SFLMEXH) DISPLACEMENT TO KEY ENTRY                  
         DC    AL1(SFLMEXH2-SFLMEXH) DISPLACEMENT TO NAME ENTRY                 
         DC    AL1(L'SFLMEXTT)     LENGTH OF TITLE                              
SFLMEXTT DC    CL40' '                                                          
SFLMEXH1 DS    0C                  FILM CODE (KEY) ENTRY                        
         DC    AL1(SFLMEXH2-*)     ENTRY LENGTH                                 
         DC    AL1(0)              ITEM DISPLACEMENT                            
         DC    AL1(L'SFLMEXT1)     ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(L'SFLMEXT1)                                                  
SFLMEXT1 DC    CL15'Film Code'                                                  
SFLMEXH2 DS    0C                  COMMERCIAL TITLE ENTRY                       
         DC    AL1(SFLMEXHX-*)     ENTRY LENGTH                                 
         DC    AL1(LSTFLMN-LSTD)   ITEM DISPLACEMENT                            
         DC    AL1(L'LSTFLMN)      ITEM WIDTH                                   
         DC    AL1(1)              NUMBER OF HEAD LINES                         
         DC    AL1(5),C'Title'     1ST HEAD LINE                                
SFLMEXHX DS    AL1(0)              TERMINATOR                                   
SFLMEXHL EQU   *-SFLMEXH                                                        
         EJECT                                                                  
***********************************************************************         
* FILTER KEYWORD TABLE - SEE LOCAL DSECT FLT$D                        *         
***********************************************************************         
         SPACE 1                                                                
ADVFILT  DS    0CL10                                                            
ADVNAMEF DC    CL8'Name    ',AL2(0)                                             
         DC    X'00'                                                            
         SPACE 1                                                                
AHLFILT  DS    0CL10                                                            
AHLNAMEF DC    CL8'Name    ',AL2(0)                                             
         DC    X'00'                                                            
         SPACE 1                                                                
AGYFILT  DS    0CL10                                                            
AGYNAMEF DC    CL8'Name    ',AL2(0)                                             
         DC    X'00'                                                            
         SPACE 1                                                                
BRDFILT  DS    0CL10                                                            
BRDNAMEF DC    CL8'Name    ',AL2(0)                                             
BRDMMSF  DC    CL8'NMR Code',AL2(RBRDMMS-SRCHATT)                               
         DC    X'00'                                                            
         SPACE 1                                                                
IBRFILT  DS    0CL10                                                            
IBRNAMEF DC    CL8'Name    ',AL2(0)                                             
         DC    X'00'                                                            
         SPACE 1                                                                
MMSFILT  DS    0CL10                                                            
MMSNAMEF DC    CL8'Name    ',AL2(0)                                             
         DC    X'00'                                                            
FLMFILT  DS    0CL10                                                            
FLMNAMEF DC    CL8'Name    ',AL2(0)                                             
         DC    X'00'                                                            
         EJECT                                                                  
***********************************************************************         
* DSECT TO COVER WORKING STORAGE                                      *         
***********************************************************************         
         SPACE 1                                                                
SRCHWORK DSECT                                                                  
DUB      DS    D                                                                
FULL     DS    F                                                                
HALF     DS    H                                                                
BYTE     DS    C                                                                
FLAG     DS    C                                                                
DMCB     DS    6F                                                               
WORK     DS    CL64                                                             
WORK2    DS    CL64                                                             
RELO     DS    A                                                                
APARMS   DS    A                   ADDRESS CALLERS PARAMETER LIST.              
SAVERE   DS    A                                                                
KEY      DS    CL48                                                             
USRSENUM DS    XL1                 NATIVE SYSTEM                                
*                                                                               
SRCHWRKL EQU   *-SRCHWORK                                                       
*                                                                               
SRCHWRKU DS    0C                  SRTN WORK SPACE IS TACKED ON HERE            
         EJECT                                                                  
***********************************************************************         
* LOCAL DSECTS                                                        *         
***********************************************************************         
         SPACE 1                                                                
LSTD     DSECT                                                                  
LSTLIN   DS    0CL70                                                            
LSTADV   DS    CL(L'SADVEXT1)                                                   
LSTADVN  DS    CL(IADNMLQ)                                                      
         ORG   LSTLIN                                                           
         SPACE 1                                                                
LSTAHL   DS    CL(L'SAHLEXT1)                                                   
LSTAHLN  DS    CL(IAHNMLQ)                                                      
         SPACE 1                                                                
         ORG   LSTLIN                                                           
LSTAGY   DS    CL(L'SAGYEXT1)                                                   
LSTAGYN  DS    CL(IAGNMLQ)                                                      
         SPACE 1                                                                
         ORG   LSTLIN              REDEFINITION FOR BRANDS                      
LSTBRD   DS    CL(L'SBRDEXT1)                                                   
LSTBRDN  DS    CL(BRDNMLQ)                                                      
LSTBMMS  DS    0CL(L'SBRDEXT3)                                                  
LSTBMMS1 DS    CL2                                                              
LSTBMMS2 DS    CL2                                                              
LSTBMMS3 DS    CL2                                                              
         SPACE 1                                                                
         ORG   LSTLIN              REDEFINITION FOR IRISH BRANDS                
LSTIBRD  DS    CL(L'SIBREXT1)                                                   
LSTIBRDN DS    CL(IBRNMLQ)                                                      
         SPACE 1                                                                
         ORG   LSTLIN                                                           
LSTMMS   DS    CL(L'SMMSEXT1)                                                   
         ORG   LSTMMS                                                           
LSTMMS1  DS    CL2                                                              
LSTMMS2  DS    CL2                                                              
LSTMMS3  DS    CL2                                                              
         ORG   LSTMMS+L'LSTMMS                                                  
LSTMMSN  DS    CL(MMSNMLQ)                                                      
         SPACE 1                                                                
         ORG   LSTLIN                                                           
LSTFLM   DS    CL(L'SFLMEXT1)                                                   
LSTFLMN  DS    CL(FLMNMLQ)                                                      
         ORG   LSTLIN+L'LSTLIN                                                  
         SPACE 2                                                                
FLT$D    DSECT                     DSECT TO COVER FILTER TABLE                  
FLT$ENT  DS    0XL10                                                            
FLT$NAME DS    CL8                                                              
FLT$NLQ  EQU   *-FLT$NAME                                                       
FLT$RTN  DS    AL2                                                              
FLT$ENTQ EQU   *-FLT$D                                                          
         SPACE 2                                                                
         EJECT                                                                  
***********************************************************************         
* NON LOCAL DSECTS                                                    *         
***********************************************************************         
         SPACE 1                                                                
       ++INCLUDE GESRCHBLKD                                                     
         SPACE 1                                                                
*        REDEFINE SAVED STORAGE ON END OF SEARCH CONTROL BLOCK                  
*        FILTERS AND SAVE AREA REDEFINED FOR EACH APPLICATION, THEN             
*        COMMON SAVE STORAGE ON END .                                           
*                                                                               
DSFILT   DS    0C                  SAVED STORAGE                                
*                                                                               
* ATTRIBUTION FILTER SAVE AREA                                                  
*                                                                               
         ORG   DSFILT                                                           
DSADVFLT DS    0CL(L'ADVNO)        ADVERTISER FILTER - NOT USED                 
DSADVLNQ EQU   *-DSADVFLT          FILTER LENGTH                                
         ORG   DSFILT                                                           
DSAHLFLT DS    0CL(L'AHLNO)        ADVERTISER HOLDING CO FILT - N/U             
DSAHLLNQ EQU   *-DSAHLFLT          FILTER LENGTH                                
         ORG   DSFILT                                                           
DSAGYFLT DS    0CL(L'AGYNO)        AGENCY FILTER - NOT USED                     
DSAGYLNQ EQU   *-DSAGYFLT          FILTER LENGTH                                
         SPACE 1                                                                
         ORG   DSFILT                                                           
DSBRDFLT DS    0XL(DSBRDLNQ)       BRAND SEARCH FILTERS                         
DSBRDMMS DS    0XL(L'MMSCAT)       MMS CATEGORY FILTER                          
DSBRDMM1 DS    XL(L'MMSL1)         1ST LEVEL                                    
DSBRDMM2 DS    XL(L'MMSL2)         2ND LEVEL                                    
DSBRDMM3 DS    XL(L'MMSL3)         3RD LEVEL                                    
DSBRDLNQ EQU   *-DSBRDMMS          BRAND FILTERS LENGTH                         
         SPACE 1                                                                
         ORG   DSFILT                                                           
DSIBRFLT DS    0XL(L'BRDNO)        IRISH BRAND FILTER - NOT USED                
DSIBRLNQ EQU   *-DSIBRFLT          FILTER LENGTH                                
         SPACE 1                                                                
         ORG   DSFILT                                                           
DSMMSFLT DS    0CL(L'MMSCAT)       MMS FILTER - NOT USED                        
DSMMSLNQ EQU   *-DSMMSFLT          FILTER LENGTH                                
         ORG   DSFILT                                                           
DSFLMFLT DS    0CL(L'FLMCODE)      FILM FILTER - NOT USED                       
DSFLMLNQ EQU   *-DSFLMFLT          FILTER LENGTH                                
         EJECT                                                                  
*                                                                               
* APPLICATION COMMON SAVE STORAGE AT END OF SAVE AREA                           
* THIS STORAGE IS USED BY ATTRIBUTION TO SAVE FILTER OVERRIDES                  
* PASSED TO SEARCH ROUTINES IN SBOTHER (24 BYTES) BY MEATT00                    
*                                                                               
         ORG   SBASAVE+L'SBASAVE-L'SBOTHER                                      
DSCOMMON DS    0C                                                               
*                                                                               
DSBRDDEF DS    0XL(L'MMSCAT)       BRAND FILTER DEFAULTS FROM CALLER            
DSMMSCAT DS    0XL(L'MMSCAT)       MMS CATEGORY                                 
DSMMSL1  DS    XL(L'MMSL1)                                                      
DSMMSL2  DS    XL(L'MMSL2)                                                      
DSMMSL3  DS    XL(L'MMSL3)                                                      
DSCOMML  EQU   *-DSCOMMON                                                       
         EJECT                                                                  
* GESRCHDIRD                                                                    
         PRINT OFF                                                              
       ++INCLUDE GESRCHDIRD                                                     
         PRINT ON                                                               
* MeATTFILD                                                                     
         PRINT OFF                                                              
       ++INCLUDE MEATTFILD                                                      
         PRINT ON                                                               
* MEATTEQUS                                                                     
         PRINT OFF                                                              
       ++INCLUDE MEATTEQUS                                                      
         PRINT ON                                                               
* MEATTGEND                                                                     
         PRINT OFF                                                              
       ++INCLUDE MEATTGEND                                                      
         PRINT ON                                                               
*FATWA                                                                          
*FAFACTS                                                                        
*DDCOMFACS                                                                      
*FAGETTXTD                                                                      
*DDSCANBLKD                                                                     
         PRINT OFF                                                              
       ++INCLUDE FATWA                                                          
       ++INCLUDE FAFACTS                                                        
       ++INCLUDE DDCOMFACS                                                      
       ++INCLUDE FAGETTXTD                                                      
       ++INCLUDE DDSCANBLKD                                                     
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'003MEATTSRCH 07/07/11'                                      
         END                                                                    

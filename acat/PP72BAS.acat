*          DATA SET PP72BAS    AT LEVEL 012 AS OF 07/01/08                      
*CATALP PP72BAS                                                                 
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'PP7102 - INSERTION ORDERS BASE'                                 
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* SMYE 06/26/08 AT PRBUY SKIP BUYS WITH JOB CODES BEGINNING WITH !              
*                (EXCLAMATION) - THESE ARE "GROUP" CODES HANDLED IN EIO         
*                                                                               
* SMYE 06/20/05 NO-OP (SEE *SMY*) SAVE PROFILE FOR SHOW AD ID BELOW             
*                                                                               
* SMYE 02/01/05 SAVE PROFILE FOR SHOW AD ID (NOT "ADCODE") IN SHWADID           
*                                                                               
* SMYE 03/08/04 GET CUREDIT ADDRESS FOR CUSTOM COLUMNS IN PP72FMT PGM           
*                                                                               
* KWAN 05/15/02 INCLUDE ADDITIONAL CHARGES IN GETINS IF PROFILE IS ON           
*                                                                               
* KWAN 04/22/02 SAVE FROFILE FOR SHOW ADDITIONAL CHARGE IN SHWACHGR             
*                                                                               
* KWAN 03/28/01 MODIFY GETINS CALL TO EXCLUDE CHARGE AMOUNTS                    
*                                                                               
* KWAN 03/12/01 SAVE PROFILE FOR PRODUCTION HOUSE (PHOUSOPT)                    
*                                                                               
* BPLA 10/00    3 NEW OPTIONS ON P72B PROFILE                                   
*               TAXOPT (+1) %,$, B (BOTH)                                       
*               DSPOPT (+2) DOUBLE SPACE INS. DETAILS                           
*               ONEEOPT (+3) EST IN HEADS (1 EST REQ)                           
*                                                                               
* BPLA 06/00    FIRST OPTION ON P72B PROFILE                                    
*               AIMPSOPT  (DISPLAY ACTUAL IMPS)                                 
*                                                                               
* BPLA 06/00    SOURCE NOW LIVE (WAS PP72BASB)                                  
*               CATALP AND ++INCLUDE PP72WORK RESTORED                          
*                                                                               
* BPLA 10/99    NEW P72A PROFILE OPTION (+14) (RATEOPT)                         
*               TO CONTROL RATE CHANGES ON I/O'S                                
*               CHECKED IN PP72REV  (BLDREV)                                    
*                                                                               
* BPLA 09/15/99 CHANGES FOR NEW PPGETADR (PPGETADRK)                            
*               ++INCLUDE PPGETADRDK                                            
*               CATALP CHANGED TO PP72BASK                                      
*               MOVING DATA FROM OUTPUT OF PPGETADR(K)                          
*               INTO REP FIELDS CHANGED                                         
*                                                                               
* BPLA 07/14/99 CHANGES FOR NEW P72A PROFILE OPTION (TOTOPT)                    
*               TO CONTROL THE PRINTING OF ORDER $ TOTALS                       
*                                                                               
* BPLA 06/07/99 NEW P72A PROFILE OPTION (TLFXOPT2)                              
*               TO CONTROL DISPLAY OF TELEPHONE AND FAX                         
*               FROM 2ND ADDRESS                                                
*                                                                               
* SMYE 03/30/99 CHECK FOR PGADFAX GREATER THAN SPACES                           
*               AS WELL AS LENGTH OF PGADELEM BEFORE MOVING                     
*               PGADLIN3 AND PGADFAX INTO REP AREAS (AT RREP20...)              
*                                                                               
* BPLA 02/99    NEW P72A PROFILE OPTION PVCTOPT THAT                            
*               WILL SUPPRESS THE NEW DISPLAY OF PAGE VIEW AND                  
*               CLICK THRU DATA                                                 
*                                                                               
* BPLA 01/99    TREAT OUTDOOR LIKE THE OTHER MEDIA                              
*               WHEN SEARCHING FOR TRAFFIC ADDRESS                              
*               (USED TO USE CONTRACT ADD/REPS)                                 
*               SEE LINES MARKED "*OUT*"                                        
*                                                                               
* BPLA 11/98    ANOTHER NEW OPTION ON P72A PROFILE+10 - SHOW WEB SITE           
*                                                                               
* BPLA 10/98    NEW OPTIONS ON THE P72A PROFILE                                 
*               +8 - SHOW DAY OF WEEK                                           
*               +9 - SHOW CLOSING DATE (SPACE)                                  
*                                                                               
* SMYE 06/08/98 USE DATCON FOR CTODAY (TODAY'S DATE) (AT FIRST1...)             
*                                                                               
* BPLA 05/98    NEW P72A PROFILE OPTION TO ADJUST MAXLINES                      
*               NEEDED FOR SPECIAL AGENCY FORMS                                 
*                                                                               
* SMYE 10/97    SKIP BUYS FLAGGED WITH X'08' IN PBDSTAT (AT PRBUY)              
*                                                                               
* SMYE 04/97    USE CALL TO PPGETADR TO GET ADDRESSES (AT GETTRAF)              
*                                                                               
* BPLA 03/96    CHECK LENGTH OF PUBAOVEL BEFORE MOVING                          
*               PUBAOLN3 AND PUBAOFAX INTO REP AREAS                            
*                                                                               
* BPLA 09/12/95 AT RUNLAST IF APINSOR IS EMPTY DON'T DIE                        
*               JUST EXIT - THIS HAPPENS IF NO REQUEST READS A BUY              
*                                                                               
* BPLA 01/24/95 ALLOW P73'S (I/O PROOF RUNS)                                    
*               EVEN IF PAGYPROF+22 = N (NO I/O'S)                              
*                                                                               
* BPLA 11/11/93 NEW PROFILE OPTION ON P72A (ONSOPT)                             
*               TO PRINT ON-SALE DATE                                           
*                                                                               
* BPLA 06/09/93 MKZOPT (P72A+4) NEW PROFILE OPTION                              
*               TO PRINT "MARKET" BEFORE ZONE FOR OUTDOOR PUBS                  
*                                                                               
* BPLA 10/05/92 CHANGES FOR NEW ADDROPT VALUES                                  
*               "1" - SHIPPING ADDRESS ALONE                                    
*               "2" - SHIPPING ADDR + PUB ADDR                                  
*                                                                               
* BPLA 02/04/92 READ P72A PROFILE AND SET OPTIONS                               
*                                                                               
* BPLA 08/28/91 SECOND CLIENT STANDARD I/O COMMENT                              
*                                                                               
* BPLA 02/28/91 ADD REVOPT (SUPPRESSING REASONS FOR REVISION)                   
*                                                                               
* BPLA 10/23/90 FIX CLIENT STANDARD I/O COMMENT BUG                             
*                                                                               
* ROSA 12/13/89 ADD NEW OPTION TO PRINT MATERIALS CLOSING DATE                  
*                                                                               
* SWON 01/23/90 ADD FAX # TO PRINT NEXT TO PHONE #                              
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PP7102   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,PP7102,RR=R9                                                   
*                                                                               
         ST    R9,RELO                                                          
         B     *+8                                                              
RELO     DC    F'0'                                                             
*                                                                               
         LA    R7,1(RB)                                                         
         LA    R7,4095(R7)                                                      
         USING PP7102+4096,R7      NOTE R7 USED AS SECOND BASE REG              
*                                                                               
         L     RA,0(R1)                                                         
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         LA    R9,1(RC)                                                         
         LA    R9,4095(R9)                                                      
         USING PPFILED,RC,R9                                                    
         L     R8,=A(IOWORKC)                                                   
         A     R8,RELO                                                          
         USING IOWORKD,R8                                                       
*                                                                               
         CLI   MODE,PROCBUY                                                     
         BE    PRBUY                                                            
         CLI   MODE,FBUYPRO                                                     
         BNE   PP1                                                              
         CLC   QPROG,=C'73'                                                     
         BE    PROOF                                                            
         CLC   QPROG,=C'75'                                                     
         BE    PROOF                                                            
*                                                                               
PP1      DS    0H                                                               
         CLI   MODE,DISKERR                                                     
         BE    PDMERR                                                           
         CLI   MODE,LBUYREQ                                                     
         BE    SORTIOS                                                          
*                                                                               
PP4      CLI   MODE,FBUYCLI                                                     
         BE    FIRST                                                            
         CLI   MODE,RUNLAST                                                     
         BE    LAST                                                             
         CLI   MODE,RUNFRST                                                     
         BNE   PP5                                                              
         MVI   LANG,0              INITIALIZE LANGUAGE                          
         MVI   SVLANG,0                                                         
         B     EXIT                                                             
*                                                                               
PP5      CLI   MODE,FBUYREQ                                                     
         BNE   EXIT                                                             
         CLC   QPROG,=C'73'                                                     
         BE    PP6                                                              
         CLC   QPROG,=C'75'                                                     
         BE    PP6                                                              
         B     EXIT                                                             
*                                                                               
* NEEDED HERE SINCE REQUEST FOR AN AD CODE BEGINNING WITH "ALL"                 
* CAUSED PPFILCON TO DO A REG/DST SORT                                          
*                                                                               
PP6      MVI   FCRDBUY,C'N'                                                     
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*                                                                               
PRBUY    DS    0H                                                               
         OC    KEY+21(3),KEY+21    BYPASS PASSIVE PTRS                          
         BNZ   EXIT                                                             
*                                                                               
         CLI   PBDJOB,C'!'         GROUP JOB CODE ? (HANDLED IN EIO)            
         BE    EXIT                YES, IGNORE                                  
*                                                                               
         CLI   PBDBFD,C'T'         TEST BUYS?                                   
         BE    EXIT                YES, IGNORE                                  
*                                                                               
         TM    PBDSTAT,X'08'       HELD - NOT ON I/O OR CONTRACT BUYS?          
         BO    EXIT                YES, IGNORE                                  
*                                                                               
         TM    PBDSTAT,X'20'       NO TRAFFIC?                                  
         BO    EXIT                YES, IGNORE                                  
*                                                                               
         CLI   PBDELEM+1,90        OLD BUY RECORDS?                             
         BL    EXIT                YES, IGNORE                                  
*                                                                               
PRB1     DS    0H                                                               
         OC    PBDJOB,PBDJOB                                                    
         BE    EXIT                                                             
         CLC   QJOB,SPACES                                                      
         BE    PRB1B                                                            
         CLC   QJOB,PBDJOB                                                      
         BNE   EXIT                NOT RIGHT JOB                                
*                                                                               
PRB1B    DS    0H                                                               
         CLI   QBUYLIN,C' '        TEST 1 BUY ONLY                              
         BH    PRB2                YES                                          
         B     PRB4                                                             
*                                                                               
PRB2     DS    0H                                                               
         CLI   QBUYLIN+1,C' '                                                   
         BNE   PRB2B                                                            
         MVC   QBUYLIN+1(1),QBUYLIN                                             
         MVI   QBUYLIN,C'0'        ALLOW FOR OLD 1 BYTE FORMAT                  
PRB2B    DS    0H                                                               
         PACK  DUB,QBUYLIN                                                      
         CVB   R0,DUB                                                           
         STC   R0,BYTE                                                          
         CLC   PBUYKLIN,BYTE                                                    
         BNE   EXIT                                                             
*                                                                               
PRB4     DS    0H                                                               
         BAS   RE,SETLAST                                                       
         CLI   LASTIOEL,X'FF'      MEANS IGNORE THIS BUY                        
         BE    EXIT                                                             
*                                                                               
         L     RE,ANXTINS          STORE IN INSTAB FOR SORTING                  
         XC    0(L'INSTREC,RE),0(RE)                                            
         USING INSTABD,RE                                                       
         MVC   INSTPUB,PBUYKPUB                                                 
         MVC   INSTAD,PBDJOB                                                    
         MVC   INSTDAT,PBUYKDAT                                                 
         MVC   INSTDISK,KEY+27     SHOULD STILL HAVE BUY'S DISK ADDR            
         CLI   ZEOPT,C'Y'          SEE IF DOING MULTIPLE ZONES/EDTS             
         BNE   PRB4F                                                            
         MVC   INSTPUB+4(2),=X'0000'                                            
         MVC   INSTEDT,PBUYKPUB+4  SET ZONE/EDITION IN SORT                     
*                                                                               
PRB4F    LA    RE,L'INSTREC(RE)                                                 
         ST    RE,ANXTINS                                                       
         MVC   0(6,RE),=6X'FF'     SET END OF TABLE                             
         L     RE,INSCNT                                                        
         LA    RE,1(RE)                                                         
         ST    RE,INSCNT                                                        
         C     RE,INSMAX                                                        
         BL    *+6                                                              
         DC    H'0'                TOO MANY INSERETIONS                         
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
SORTIOS  DS    0H                                                               
         OC    INSCNT,INSCNT                                                    
         BZ    SRTIOX              NO INSERTIONS                                
         L     R4,AINSTAB                                                       
         L     R5,INSCNT                                                        
         GOTO1 XSORT,DMCB,(R4),(R5),21,17,0                                     
*                                                                               
SRTIO2   CLI   0(R4),X'FF'         END OF LIST                                  
         BE    SRTIOX                                                           
         LA    R0,PBUYREC                                                       
         ST    R0,AREC                                                          
         MVC   KEY+27(4),17(R4)                                                 
         GOTO1 GETPRT1                                                          
         XC    FULL,FULL                                                        
         CLI   SHWACHGR,C'Y'        SHOW ADDITIONAL CHARGES?                    
         BE    *+8                                                              
         MVI   FULL,C'X'            TO EXCLUDE ADDITIONAL CHARGES               
         GOTO1 GETINS,DMCB,PBUYKEY,GROSS,(FCOAPRD,PBUYKPRD),FULL                
         XC    WORK(25),WORK                                                    
         MVC   WORK+1(6),PBUYKPUB                                               
         BAS   RE,GPUB             MUST READ PUB                                
         BAS   RE,GETTRAF          AND GET TRAFFIC ADDR                         
*                                                                               
* TO PINSOR AFTER SORT READ PBUYREC AND PUB                                     
*                                                                               
         CLI   ZEOPT,C'Y'          IF MULTI ZONE/EDIT                           
         BNE   SRTIO5                                                           
         MVC   SVZONNM,PUBZNAME    SAVE ZONE NAME                               
         MVC   SVZON(2),PBUYKPUB+4 AND ZONE/EDIT                                
         BAS   RE,GBASPUB          GET BASE PUB                                 
         BAS   RE,GETTRAF          USE BASE PUB TRAF ADDR OR REP                
*                                                                               
SRTIO5   DS    0H                                                               
         GOTO1 APINSOR                                                          
         LA    R4,L'INSTREC(R4)                                                 
         B     SRTIO2                                                           
*                                                                               
SRTIOX   CLC   QPUB+8(3),=C'ZZZ'   ALL ZONES AND EDITIONS                       
         BNE   EXIT                                                             
         MVI   PBUYKEY,X'FF'       FORCE END OF INS ORDER                       
         MVC   SCPSCOM1,CPSCOM1    SO LAST INSERTION ORDER                      
         MVC   SCPSCOM2,CPSCOM2    WILL DO RIGHT COMMENTS                       
         MVC   SVLANG,LANG                                                      
         GOTO1 APINSOR                                                          
         B     EXIT                                                             
*                                                                               
DONE     MVI   MODE,LBUYREQ        TELL PPG TO QUIT                             
         B     EXIT                                                             
         EJECT                                                                  
*                                  FIND LAST IO ELEM                            
SETLAST NTR1                                                                    
*                                                                               
         MVI   FULL,1              SET FOR DATE COMPARISON                      
         XC    LASTIOEL,LASTIOEL                                                
*                                                                               
SETL1    LA    R2,PBUYREC+33                                                    
SETL2    DS    0H                                                               
         MVI   ELCODE,X'70'                                                     
*                                                                               
         BAS   RE,NEXTEL                                                        
         BNE   SETL4                                                            
         USING PIOELEM,R2                                                       
         CLC   PIODATE,FULL        TEST LATEST                                  
         BL    SETL2                                                            
         CLC   PIODATE,BIGNDAT     TEST VS CONTROL DATE                         
         BNL   SETL2                                                            
*                                  TEST RIGHT MULTI Z/E STATUS                  
         MVI   BYTE,C'N'                                                        
         TM    PIOSTAT,X'80'       TEST FROM MULTI IO ELEM                      
         BZ    *+8                                                              
         MVI   BYTE,C'Y'                                                        
         CLC   ZEOPT,BYTE                                                       
         BNE   SETL2                                                            
*                                                                               
SETL3    ST    R2,LASTIOEL         SAVE LATEST                                  
         B     SETL2                                                            
*                                                                               
SETL4    DS    0H                                                               
         TM    PBUYCNTL,X'80'                                                   
         BZ    SETL5                                                            
         OC    LASTIOEL,LASTIOEL                                                
         BZ    SETL10                                                           
         CLI   QOPT3,C'A'          CHK FOR TURNAROUND                           
         BE    SETL4A              CONSIDER SAME AS 'NEEDED'                    
         CLI   QOPT2,C'Y'          IF 'NEEDED ONLY' REQ                         
         BNE   SETL4B                                                           
SETL4A   L     R2,LASTIOEL                                                      
         CLI   PIOTYP,C'D'                                                      
         BE    SETL10                                                           
SETL4B   DS    0H                                                               
         MVI   CHANGSW,C'D'                                                     
         B     XIT                                                              
SETL5    DS    0H                                                               
         MVI   CHANGSW,0                                                        
         OC    LASTIOEL,LASTIOEL                                                
         BZ    XIT                                                              
         L     R2,LASTIOEL                                                      
         CLI   QOPT2,C'Y'          IF 'NEEDED ONLY' REQ                         
         BE    SETL5B              TEST IF REAL CHANGE                          
*                                  PREVENT DUPLICATE ON SAME DAY                
         CLC   PIODATE,BTODAY                                                   
         BNE   SETL5D                                                           
         CLI   PIOTURN,0                                                        
         BNE   SETL10                                                           
*                                                                               
SETL5B   DS    0H                                                               
         XC    TSLDATE(44),TSLDATE                                              
         GOTO1 ABLDREV,DMCB,(R2)                                                
         OC    TSLDATE(44),TSLDATE                                              
         BZ    SETL10              NO REAL CHANGE                               
*                                                                               
SETL5D   DS    0H                                                               
         MVI   CHANGSW,C'C'                                                     
         B     XIT                                                              
SETL10   DS    0H                                                               
         MVI   LASTIOEL,X'FF'      SET TO IGNORE THIS BUY                       
         B     XIT                                                              
XIT      EQU   EXIT                                                             
         DROP  R2                                                               
*                                                                               
NEXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELX                                                          
         CLC   ELCODE,0(R2)                                                     
         BER   RE                                                               
         B     NEXTEL+2                                                         
NEXTELX  LTR   R2,R2                                                            
         BR    RE                                                               
         EJECT                                                                  
*                                  PROOF RUN                                    
PROOF    DS    0H                                                               
         MVI   RCWRITE,C'N'        NO WRITE                                     
         MVI   FCRDBUY,C'N'        SET NOT TO READ BUYS                         
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         GOTO1 PUBVAL,DMCB,QPUB,BPUB                                            
         LA    RE,1(R8)                                                         
         LA    RE,4095(RE)                                                      
         USING IOWORKD+4096,RE                                                  
         MVI   PINSREC+16,X'FF'                                                 
         DROP  RE                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'15'                                                      
         CLC   =C'ALL   ',QJOB                                                  
         BE    *+10                                                             
         MVC   KEY+10(6),QJOB                                                   
         GOTO1 HIGH                                                             
         B     PROOF4A                                                          
*                                                                               
PROOF4   DS    0H                                                               
         MVC   KEYSAVE,KEY                                                      
         MVC   WORK(10),RCSVAGY                                                 
         MVI   WORK+3,X'15'                                                     
         CLC   KEY(10),WORK                                                     
         BNE   PROOF90                                                          
         GOTO1 SEQ                                                              
*                                                                               
PROOF4A  DS    0H                                                               
         BAS   RE,TSTERR                                                        
         CLC   KEY(16),KEYSAVE                                                  
         BNE   PROOF5                                                           
         TM   KEY+25,X'80'                                                      
         BNZ   PROOF4                                                           
         B     PROOF6                                                           
*                                                                               
PROOF5   DS    0H                                                               
         LA    RE,1(R8)                                                         
         LA    RE,4095(RE)                                                      
         USING IOWORKD+4096,RE                                                  
         CLI   PINSREC+16,X'FF'                                                 
         BE    PROOF5A                                                          
         OC    BPUB,BPUB                                                        
         BNZ   PROOF5A                                                          
*                                  NO 'ALL PUBS' INS REC                        
         XC    PBUYKPUB,PBUYKPUB                                                
         XC    PUBKPUB,PUBKPUB                                                  
         MVC   PINSREC(25),PJOBREC                                              
         MVC   PINSREC+33(INSWARNL),INSWARN                                     
         B     PROOF9                                                           
         DROP  RE                                                               
*                                                                               
PROOF5A  DS    0H                                                               
         MVC   WORK(10),RCSVAGY                                                 
         MVI   WORK+3,X'15'                                                     
         CLC   KEY(10),WORK                                                     
         BNE   PROOF90             END                                          
PROOF6   OC    KEY+16(6),KEY+16    TEST JOB OR INS REC                          
         BNZ   PROOF8                                                           
*                                  JOB RECORD                                   
         CLC   =C'ALL   ',QJOB                                                  
         BE    PROOF6A                                                          
         CLC   KEY+10(6),QJOB                                                   
         BNE   PROOF90                                                          
*                                                                               
PROOF6A  DS    0H                                                               
         LA    RE,1(R8)                                                         
         LA    RE,4095(RE)                                                      
         USING IOWORKD+4096,RE                                                  
         MVI   PINSREC+16,0                                                     
         DROP  RE                                                               
         LA    R0,PJOBREC                                                       
         ST    R0,AREC                                                          
         BAS   RE,GETPRT1                                                       
         BAS   RE,TSTERR                                                        
         LA    RE,PBUYREC                                                       
         LA    RF,3000                                                          
         XCEF                                                                   
*                                                                               
         MVC   PBUYKEY(10),RCSVAGY                                              
         MVI   PBUYKEY+3,X'20'                                                  
         MVC   PBUYKDAT,BTODAY                                                  
*                                       SET BUY RECORD                          
         MVC   PBDELEM(2),=X'2069'                                              
         MVC   PBDSPACE,PJOBSPC                                                 
         MVC   PBDUNITS,PJOBTUNS                                                
         MVC   PBDUIND,PJOBUIND                                                 
         ZAP   PBDCOS,=P'0'                                                     
         ZAP   PBDCD,=P'0'                                                      
         ZAP   PBDACP,=P'0'                                                     
         MVC   PBDCL,PJOBPRM                                                    
         ZAP   PBDPRCOS,=P'0'                                                   
         MVC   PBDJOB,PJOBKJOB                                                  
         ZAP   PBDCLMS,PJOBCOLS                                                 
         B     PROOF4                                                           
*                                  INS REC                                      
PROOF8   DS    0H                                                               
         CLC   KEY+10(6),PBDJOB                                                 
         BNE   PROOF4                                                           
*                                  DONT READ INS REC NOW                        
         MVC   PBUYKPUB(6),KEY+16                                               
         CLI   KEY+16,X'FF'        TEST DEFAULT REC                             
         BNE   *+10                                                             
         MVC   PBUYKPUB(6),=X'999999990000'                                     
PROOF9   DS    0H                                                               
         CLC   =C'ALL   ',QJOB                                                  
         BNE   PROOF10                                                          
         OC    PJOBEND,PJOBEND                                                  
         BZ    *+14                                                             
         CLC   PJOBEND,BSTART                                                   
         BL    PROOF20                                                          
         CLC   PJOBSTA,BEND                                                     
         BH    PROOF20                                                          
*                                                                               
PROOF10  DS    0H                                                               
         CLC   QPROG,=C'75'                                                     
         BE    PROOF12                                                          
*                                  FOR PROOF RUN                                
         OC    BPUB,BPUB                                                        
         BZ    PROOF9B                                                          
         CLC   BPUB,KEY+16         TEST VS REQ PUB                              
         BNE   PROOF4                                                           
         B     PROOF9E                                                          
*                                                                               
PROOF9B  DS    0H                                                               
         CLC   QPUB(3),=C'ALL'                                                  
         BE    PROOF9E                                                          
         CLI   KEY+16,X'FF'        IF NO REQ PUB THEN ONLY                      
         BE    PROOF9E                                                          
         OC    PBUYKPUB,PBUYKPUB   AND NO DEFAULT WARNING                       
         BNE   PROOF4              DO DEFAULT INS REC                           
*                                                                               
PROOF9E  DS    0H                                                               
         MVC   PPGKEY(64),KEY      SAVE TO RESTORE SEQ                          
         XC    PUBREC(256),PUBREC                                               
         MVC   PUBNAME(8),=C'PUB NAME'                                          
         CLC   PBUYKPUB(6),=X'999999990000'                                     
         BE    PROOF10B                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(1),QMEDIA                                                    
         MVC   KEY+1(6),PBUYKPUB                                                
         MVC   KEY+7(2),QAGENCY                                                 
         MVI   KEY+9,X'81'                                                      
         MVC   KEYSAVE,KEY                                                      
         GOTO1 DATAMGR,DMCB,DMRDHI,PUBDIR,KEY,KEY                               
*                                                                               
         CLC   KEY(25),KEYSAVE                                                  
         BNE   PROOF10A                                                         
         GOTO1 (RF),(R1),GETREC,PUBFILE,KEY+27,PUBREC,DMWORK                    
         XC    PUBLINE1(250),PUBLINE1   CLEAR ADDRESS (MAY BE WRONG)            
         B     PROOF10B                                                         
*                                                                               
PROOF10A DS    0H                                                               
         MVC   PUBNAME(19),=C'**PUB NOT ON FILE**'                              
*                                                                               
PROOF10B DS    0H                                                               
         MVC   PUBCITY(4),=C'CITY'                                              
         MVC   PUBSTATE,=C'ST'                                                  
         MVC   PUBLINE1(15),=C'MAILING ADDRESS'                                 
         MVC   PUBLINE2(13),=C'CITY, ST  ZIP'                                   
         MVC   PUBNAMEL(2),=X'10A0'                                             
*                                                                               
         GOTO1 APINSOR                                                          
*                                                                               
         BAS   RE,TSTERR                                                        
         MVC   KEY(64),PPGKEY      RESTORE SEW                                  
         GOTO1 HIGH                                                             
         MVC   KEYSAVE,PPGKEY+32                                                
         OC    BPUB,BPUB           DONE IF ONLY ONE PUB                         
         BNZ   PROOF90                                                          
         B     PROOF20                                                          
*                                  JOB RECORD LIST                              
PROOF12  DS    0H                                                               
         LA    RE,1(R8)                                                         
         LA    RE,4095(RE)                                                      
         USING IOWORKD+4096,RE                                                  
         MVC   PINSREC(25),KEY                                                  
         DROP  RE                                                               
         GOTO1 =V(JOBLST),RR=RELO                                               
*                                                                               
PROOF20  DS    0H                                                               
         OC    PBUYKPUB,PBUYKPUB                                                
         BNZ   PROOF4                                                           
         B     PROOF5A                                                          
*                                                                               
PROOF90  DS    0H                                                               
         CLC   QPROG,=C'73'                                                     
         BNE   EXIT                                                             
         MVI   PBUYKEY,X'FF'                                                    
         GOTO1 APINSOR                                                          
*                                                                               
         B     EXIT                                                             
*                                                                               
INSWARN  DS    0C                                                               
         DC    X'6607'                                                          
         DC    C'+2***'                                                         
         DC    X'66'                                                            
         DC    AL1(L'INSW1+2)                                                   
INSW1    DC    C'*** WARNING - NO ''ALL PUBS'' INSTRUCTION RECORD PRESEX        
               NT ***'                                                          
         DC    X'6605'                                                          
         DC    C'***'                                                           
         DC    X'0000'                                                          
INSWARNL EQU   *-INSWARN                                                        
         EJECT                                                                  
*                                  FIRST TIME ROUTINES                          
FIRST    DS    0H                                                               
         CLC   QPROG,=C'73'        SEE IF I/O PROOF RUN                         
         BE    FIRST1              PROCESS                                      
*                                                                               
         CLI   PAGYPROF+22,C'N'    NO IO'S                                      
         BE    DONE                                                             
*                                                                               
FIRST1   DS    0H                                                               
         MVC   RCPROG,QPROG        SET FOR PPNNN REPORT NUMBER                  
         OC    IOWORKL,IOWORKL     TEST FIRST TIME                              
         BNZ   FIRST4                                                           
*                                  CLEAR IOWORD                                 
         LA    RE,IOWORKD                                                       
         L     RF,=A(IOWORKX-IOWORKD)                                           
         LR    R1,RF                                                            
         XCEF                                                                   
         ST    R1,IOWORKL                                                       
         ZAP   DUB,RCSPECNO                                                     
         CLC   QPROG,=C'71'        TEST TURNAROUND                              
         BNE   *+10                                                             
         AP    DUB,=P'5000'        START AT 5000 +                              
*                                                                               
         CVB   R0,DUB                                                           
         STH   R0,REFNO                                                         
         OI    DMINBTS,X'08'       SET TO PASS DELETES                          
         OI    DMOUTBTS,X'FD'                                                   
*                                                                               
         MVC   ETODAY+0(2),RCDATE+6     YR                                      
         MVC   ETODAY+2(2),RCDATE+0     MO                                      
         MVC   ETODAY+4(2),RCDATE+3     DA                                      
*                                                                               
         GOTO1 DATCON,DMCB,(0,ETODAY),(3,BTODAY)                                
*                                                                               
         GOTO1 DATCON,DMCB,(0,ETODAY),(5,CTODAY)                                
*                                                                               
         LA    R0,(ACONX-ACONS)/4  RELOCATE ADDCONS                             
         LA    R1,ACONS                                                         
         LA    R2,APINSOR                                                       
*                                                                               
FIRST2   DS    0H                                                               
         L     R3,0(R1)                                                         
         A     R3,RELO                                                          
         ST    R3,0(R2)                                                         
         LA    R1,4(R1)                                                         
         LA    R2,4(R2)                                                         
         BCT   R0,FIRST2                                                        
*                                                                               
         MVC   APUBEDIT,PUBEDIT                                                 
*                                                                               
         L     RF,PPWORK2C           GET AND SAVE DICTATE                       
         USING A$PPWORK2D,RF                                                    
         MVC   ADICTATE,A$DICTATE                                               
         MVC   VCUREDIT,A$CUREDIT                                               
         DROP  RF                                                               
*                                                                               
         L     RF,=A(RECPOOLX-RECPOOL)                                          
         ST    RF,LRECPOOL                                                      
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
         MVI   STARS,C'*'                                                       
         MVC   STARS+1(L'STARS-1),STARS                                         
*                                                                               
*                                                                               
FIRST4   DS    0H                                                               
*                                                                               
*                                  INITIALIZE TABLE OF INSERTIONS               
*                                  TO BE SORTED AT LBUYREC                      
*                                  AND THEN PASSED TO APINSOR                   
*                                                                               
         L     RE,AINSTAB                                                       
         L     RF,=A(INSTABX-INSTAB)                                            
         XCEF                                                                   
         MVC   ANXTINS,AINSTAB     SET TO FIRST ENTRY                           
         XC    INSCNT,INSCNT       NEEDED TO COUNT INSERTIONS                   
         MVC   INSMAX,=F'3000'                                                  
*                                                                               
         CLI   QMEDIA,C'O'                                                      
         BNE   *+12                                                             
         MVI   FCGTTREP,C'N'       FOR OUTDOOR USE                              
         MVI   FCGTCREP,C'Y'       CON REP NOT TRAF REP                         
*                                                                               
         MVC   BIGNDAT,=3X'FF'                                                  
         CLI   QIGNDAT,C' '                                                     
         BNH   FIRST6                                                           
         GOTO1 DATCON,DMCB,(0,QIGNDAT),(3,BIGNDAT)                              
*                                                                               
FIRST6   DS    0H                                                               
         XC    BSTART,BSTART                                                    
         MVC   BEND,=3X'FF'                                                     
         CLI   QSTART,C' '                                                      
         BE    FIRST7                                                           
         GOTO1 DATCON,DMCB,(0,QSTART),(3,BSTART)                                
*                                                                               
FIRST7   DS    0H                                                               
         CLI   QEND,C' '                                                        
         BE    FIRST8                                                           
         GOTO1 DATCON,DMCB,(0,QEND),(3,BEND)                                    
*                                                                               
FIRST8   DS    0H                                                               
         MVC   WORK(1),QMEDIA                                                   
         MVC   WORK+1(3),QCLIENT                                                
         CLC   WORK(4),LMEDCLI                                                  
         BE    FIRST8C                                                          
         MVC   LMEDCLI,WORK                                                     
         MVI   PBUYKEY,X'FF'       MUST FININSH LAST IO                         
         MVC   SCPSCOM1,CPSCOM1    WITH OLD OPTIONS                             
         MVC   SCPSCOM2,CPSCOM2                                                 
         MVC   SVLANG,LANG         SO IT WILL BE IN THE RIGHT LANGUAGE          
         GOTO1 APINSOR                                                          
         XC    LASTSTAT,LASTSTAT                                                
         MVI   BUYSW,0                                                          
         B     FIRST8D                                                          
*                                                                               
FIRST8C  CLC   QPUB+8(3),=C'ZZZ'   TEST IF THIS IS ALL ZONE/EDTIION             
         BNE   FIRST8D                                                          
         MVI   PBUYKEY,X'FF'       MUST FININSH LAST IO                         
         MVC   SCPSCOM1,CPSCOM1    WITH OLD OPTIONS                             
         MVC   SCPSCOM2,CPSCOM2                                                 
         MVC   SVLANG,LANG         SO IT WILL BE IN THE RIGHT LANGUAGE          
         GOTO1 APINSOR                                                          
         XC    LASTSTAT,LASTSTAT                                                
         MVI   BUYSW,0                                                          
*                                                                               
FIRST8D  DS    0H                  SET REPORT OPTIONS                           
         MVI   RPTOPTS,C'N'                                                     
         MVC   RPTOPTS+1(L'RPTOPTS-1),RPTOPTS                                   
*                                                                               
         OC    PROGPROF,PROGPROF                                                
         BZ    FR10                                                             
*                                  SET FOR PROGPORF                             
         LA    RF,PROGPROF                                                      
         MVC   MULTOPT,0(RF)                                                    
         MVC   NAMOPT(3),1(RF)                                                  
         MVC   ESTOPT(3),4(RF)                                                  
         MVC   OLDOPT,7(RF)                                                     
         MVC   MATOPT,8(RF)                                                     
         MVC   ADOPT,9(RF)         Y= SHOW AD NUMBER                            
         MVC   ADDROPT,10(RF)      Y= SHOW REP AND PUB ADDRS                    
         MVC   COPYOPT,11(RF)      Y= SUPPRESS COPY NUMBER                      
         MVC   MATEOPT,12(RF)      Y= PRINT MATERIALS CLOSING DATE              
         MVC   TLFXOPT,13(RF)      T,F,OR B=TEL,FAX, OR BOTH                    
         MVC   REVOPT,14(RF)       Y= SUPPRESS REASONS FOR REVISION             
         B     FR12                                                             
*                                                                               
FR10     DS    0H                                                               
         CLI   PAGYPROF+29,C'1'                                                 
         BNH   *+8                                                              
         MVI   MULTOPT,C'Y'        MULTI INS - PROF=2                           
         BNL   *+8                                                              
         MVI   OLDOPT,C'Y'         OLD HEADS - PROF=0                           
*                                                                               
         TM    PAGYPROF+20,X'02'   7,6,3,2, - NO NAME                           
         BZ    *+8                                                              
         MVI   NAMOPT,C'Y'                                                      
         TM    PAGYPROF+20,X'04'   7,6,5,4 - XX'S                               
         BZ    *+8                                                              
         MVI   XXOPT,C'Y'                                                       
         TM    PAGYPROF+20,X'01'   7,5,3,1 = * OUT MEMBER MSG                   
         BZ    *+8                                                              
         MVI   MEMBOPT,C'Y'                                                     
*                                                                               
         TM    PCLTPROF+16,X'04'   7,6,5,4, = COST                              
         BZ    *+8                                                              
         MVI   COSTOPT,C'Y'                                                     
         TM    PCLTPROF+16,X'01'   7,5,3,1 = VEN NO.                            
         BZ    *+8                                                              
         MVI   VNOOPT,C'Y'                                                      
         TM    PCLTPROF+16,X'02'   7,6,3,2 = EST NO.                            
         BZ    *+8                                                              
         MVI   ESTOPT,C'Y'                                                      
*                                                                               
FR12     DS    0H                                                               
*                                  GET P72A PROFILE                             
         XC    WORK,WORK                                                        
         MVC   WORK(4),=C'P72A'                                                 
         NI    WORK,X'BF'          MAKE SYSTEM LOWER CASE                       
         MVC   WORK+4(2),PCLTKAGY                                               
         MVC   WORK+6(1),PCLTKMED                                               
         MVC   WORK+7(3),PCLTKCLT                                               
         CLI   PCLTOFF,C' '                                                     
         BNH   *+14                                                             
         MVI   WORK+10,C'*'                                                     
         MVC   WORK+11(1),PCLTOFF                                               
         GOTO1 GETPROF,DMCB,WORK,P72APROF,DATAMGR                               
*                                                                               
         MVI   MAXLADJ,0                                                        
*                                                                               
         OC    P72APROF,P72APROF                                                
         BZ    FR13                                                             
*                                                                               
         MVC   ACOPT,P72APROF+0                                                 
         MVC   CDOPT,P72APROF+1                                                 
         MVC   CONOPT,P72APROF+2                                                
         MVC   MKZOPT,P72APROF+4                                                
         MVC   ONSOPT,P72APROF+5                                                
         MVC   FROPT,P72APROF+6                                                 
         MVC   MAXLADJ,P72APROF+7   MAXLINES ADJUSTMENT                         
         MVC   DOWOPT,P72APROF+8    DAY OF WEEK OPTION                          
         MVC   CLOOPT,P72APROF+9    CLOSING DATE OPTION                         
         MVC   WEBOPT,P72APROF+10   WEB SITE OPTION                             
         MVC   PVCTOPT,P72APROF+11  OPTION TO SUPPRESS PV AND CT                
         MVC   TLFXOPT2,P72APROF+12 OPTION TO PRINT TEL AND FAX                 
*                                                                               
         MVC   TOTOPT,P72APROF+13  TOTAL $ OPTION                               
*                                                                               
         CLI   TOTOPT,C' '                                                      
         BH    *+8                                                              
         MVI   TOTOPT,C'N'         MUST SET DEFAULT FOR THIS OPTION             
*                                                                               
         MVC   RATEOPT,P72APROF+14                                              
*                                                                               
         MVC   MULTIAD,P72APROF+15 MULTI-AD I/O OPTION                          
*                                                                               
         CLI   MULTIAD,C' '                                                     
         BH    *+8                                                              
         MVI   MULTIAD,C'N'        MUST SET DEFAULT FOR THIS OPTION             
*                                                                               
FR13     DS    0H                                                               
*                                  GET P72A PROFILE                             
         XC    WORK,WORK                                                        
         MVC   WORK(4),=C'P72B'                                                 
         NI    WORK,X'BF'          MAKE SYSTEM LOWER CASE                       
         MVC   WORK+4(2),PCLTKAGY                                               
         MVC   WORK+6(1),PCLTKMED                                               
         MVC   WORK+7(3),PCLTKCLT                                               
         CLI   PCLTOFF,C' '                                                     
         BNH   *+14                                                             
         MVI   WORK+10,C'*'                                                     
         MVC   WORK+11(1),PCLTOFF                                               
         GOTO1 GETPROF,DMCB,WORK,P72BPROF,DATAMGR                               
*                                  SET REPORT OPTIONS                           
         OC    P72BPROF,P72BPROF                                                
         BZ    FR15                                                             
         MVC   AIMPSOPT,P72BPROF+0                                              
         CLI   AIMPSOPT,C' '                                                    
         BH    *+8                                                              
         MVI   AIMPSOPT,C'N'       SET DEFAULT FOR THIS OPTION                  
*                                                                               
         MVC   TAXOPT,P72BPROF+1                                                
         CLI   TAXOPT,C' '                                                      
         BH    *+8                                                              
         MVI   TAXOPT,C'N'         SET DEFAULT FOR THIS OPTION                  
*                                                                               
         MVC   DSPOPT,P72BPROF+2                                                
         CLI   DSPOPT,C' '                                                      
         BH    *+8                                                              
         MVI   DSPOPT,C'N'         SET DEFAULT FOR THIS OPTION                  
*                                                                               
         MVC   ONEEOPT,P72BPROF+3                                               
         CLI   ONEEOPT,C' '                                                     
         BH    *+8                                                              
         MVI   ONEEOPT,C'N'        SET DEFAULT FOR THIS OPTION                  
*                                                                               
         MVC   PHOUSOPT,P72BPROF+5 SHOW PRODUCTION HOUSE                        
         CLI   PHOUSOPT,C' '                                                    
         BH    *+8                                                              
         MVI   PHOUSOPT,C'N'       MUST SET DEFAULT (N) IF NOT PRESENT          
*                                                                               
         MVC   SHWACHGR,P72BPROF+6 SHOW ADDITIONAL CHARGES                      
         CLI   SHWACHGR,C' '                                                    
         BH    *+8                                                              
         MVI   SHWACHGR,C'N'       MUST SET DEFAULT (N) IF NOT PRESENT          
*                                                                               
*SMY*    MVC   SHWADID,P72BPROF+7  SHOW AD ID IN PLACE OF ADCODE                
*SMY*    CLI   SHWADID,C' '                                                     
*SMY*    BH    *+8                                                              
*SMY*    MVI   SHWADID,C'N'        MUST SET DEFAULT (N) IF NOT PRESENT          
*                                                                               
FR15     DS    0H                                                               
         XC    WORK,WORK                                                        
         MVC   P,SPACES                                                         
*                                                                               
         MVI   MAXLINES,75       MUST RESET EACH TIME                           
*                                ELSE ADJUSTMENT WILL KEEP REDUCING             
         ZIC   R0,MAXLINES                                                      
         ZIC   R1,MAXLADJ                                                       
         SR    R0,R1                                                            
         STC   R0,MAXLINES                                                      
*                                                                               
         MVI   ZEOPT,C'N'                                                       
         CLC   QPUB+8(3),=C'ZZZ'   TEST ALL ZONES/EDITS                         
         BNE   FR14                                                             
         CLI   MULTOPT,C'Y'  ONLY SET ZEOPT+MATOPT IF MULTOPT IS 'Y'            
         BNE   FR14                                                             
         MVI   ZEOPT,C'Y'          SET MULTI Z/E SW                             
         MVI   MATOPT,C'Y'         SET MATOPT TO READ ACROSS Z/E                
*                                                                               
FR14     DS    0H                                                               
*                                  FIND AND SAVE CLIENT I/O COMMENT             
         XC    SCLICOM,SCLICOM                                                  
         XC    SCLICOM2,SCLICOM2                                                
         LA    R2,PCLTELEM                                                      
         MVI   ELCODE,X'11'                                                     
         BAS   RE,NEXTEL                                                        
         BNE   FR16                                                             
         MVC   SCLICOM,2(R2)                                                    
         BAS   RE,NEXTEL           LOOK FOR THE SECOND I/O COMMENT              
         BNE   FR16                                                             
         MVC   SCLICOM2,2(R2)                                                   
*                                                                               
FR16     DS    0H                                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                  LOOK AT DATAMGR ERROR                        
PDMERR   DS    0H                                                               
         DC    H'0'                                                             
         SPACE 3                                                                
*                                  LAST TIME                                    
LAST     DS    0H                                                               
         OC    APINSOR,APINSOR     SEE IF ADDRESS HAS BEEN SET                  
         BNZ   LAST5               NO - JUST EXIT                               
         MVC   P+1(23),=C'** NO DATA GENERATED **'                              
         GOTO1 REPORT                                                           
         B     EXIT                                                             
*                                  NO BUYS HAVE BEEN READ                       
*                                                                               
LAST5    DS    0H                                                               
         MVI   PBUYKEY,X'FF'                                                    
         MVC   SCPSCOM1,CPSCOM1                                                 
         MVC   SCPSCOM2,CPSCOM2                                                 
         MVC   SVLANG,LANG   SO IT WILL BE IN THE CORRECT LANGUAGE              
         GOTO1 APINSOR                                                          
*                                                                               
         CLC   RCPROG,=C'72'                                                    
         BH    EXIT                                                             
*                                                                               
         GOTO1 AWFMOD,DMCB,0                                                    
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
GETTRAF  DS    0H                  ROUTINE TO FIND TRAFFIC ADDRESS              
         NTR1                                                                   
*                                  TRY FOR ADDRESS FIRST                        
         CLI   FROPT,C'Y'          SEE IF DOING I/O'S IN PUB LANG               
         BE    *+8                                                              
         MVI   PUBLANG,0           NO - THE DEFAULT TO ENGLISH                  
*                                  THIS IS SAFE SINCE PROGRAM                   
*                                  NEVER WRITES THE PUB BACK                    
*                                                                               
         MVC   SVLANG,LANG         SAVE LANGUAGE FOR LAST PRINTING              
         MVC   LANG,PUBLANG                                                     
*                                                                               
         MVC   SCPSCOM1,CPSCOM1    SAVE LAST FOR PRINTING                       
         MVC   SCPSCOM2,CPSCOM2    SAVE LAST FOR PRINTING                       
*                                                                               
         XC    CPSCOM1,CPSCOM1     CLEAR PUB/CLT STANDARD COMMENTS              
         XC    CPSCOM2,CPSCOM2     CLEAR PUB/CLT STANDARD COMMENTS              
         XC    WORK(20),WORK                                                    
*****    MVI   WORK,X'09'                                                       
         MVI   ADRTYP,C'T'                                                      
*OUT*    CLI   QMEDIA,C'O'         FOR OUTDOOR USE CONTRACT                     
*OUT*    BNE   *+8                                                              
*****    MVI   WORK,X'0A'                                                       
*OUT*    MVI   ADRTYP,C'C'                                                      
*                                                                               
         CLI   ADDROPT,C'1'                                                     
         BE    RREP0                                                            
         CLI   ADDROPT,C'2'                                                     
         BNE   RREP0C                                                           
*                                                                               
*****RREP0    MVI   WORK,X'0B'                                                  
RREP0    MVI   ADRTYP,C'S'                                                      
*                                                                               
RREP0C   DS    0H                  TRY FOR AOV ADDRESS                          
*                                    FILL IN 7 BYTES OF CLTDATA                 
         MVC   CLTAGY,PUBKEY+7       AGY                                        
         MVC   CLTMED,PUBKEY         MED                                        
         MVC   CLTCODE,PCLTKCLT      CLIENT CODE                                
         MVC   CLTOFF,PCLTOFF        CLIENT OFFICE                              
*                                                                               
         GOTO1 =V(PPGETADR),DMCB,(ADRTYP,CLTDATA),PUBREC,DATAMGR,      X        
               RR=RELO                                                          
*                                                                               
         CLI   0(R1),X'FF'         ERROR IN CALL ?                              
         BNE   *+6                 NO                                           
         DC    H'0'                                                             
*                                                                               
         CLI   0(R1),0             ADDRESS RECORD FOUND ?                       
         BE    RREP6               NO - LOOK FOR REP                            
*                                                                               
*                                  ADDRESS REC FOUND                            
         MVC   WORK(4),0(R1)       "RESULT"/ADDRESS LEVEL (2-4)                 
         L     R2,4(R1)            A(ADDRESS INFO FROM CALL)                    
         ST    R2,FULL             SAVE A(ADDRESS)                              
*                                                                               
         CLI   WORK,X'0B'          SEE IF I WAS LOOKING FOR SHIPPING            
         BE    RREP20              AND FOUND IT                                 
**                                 MUST STILL READ FOR REP TO GET               
**                                 STANDARD COMMENTS (CPSCOM1+2)                
**NO-OP  CLI   WORK+1,X'FF'        IF HAVE CLIENT ADDR NO NEED                  
**NO-OP  BL    RREP20              TO LOOK FOR REP                              
*                                                                               
*                                  NOW TRY FOR A REP                            
RREP6    DS    0H                                                               
         LA    R2,PUBREC+33                                                     
         XC    DUB,DUB                                                          
         SR    R0,R0                                                            
RREP7    DS    0H                                                               
         CLI   0(R2),0                                                          
         BE    RREP11                                                           
         CLI   0(R2),X'14'                                                      
         BE    RREP9                                                            
RREP8    DS    0H                                                               
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         B     RREP7                                                            
RREP9    DS    0H                                                               
         USING PUBREPEL,R2                                                      
         CLC   PUBRPOFF,=3X'FF'                                                 
         BE    RREP10                                                           
         CLC   PUBRPOFF,PCLTKCLT                                                
         BE    RREP10                                                           
         CLI   PUBRPOFF,X'FF'                                                   
         BNE   RREP8                                                            
         CLC   PUBRPOFF+1(1),PCLTOFF                                            
         BNE   RREP8                                                            
RREP10   DS    0H                                                               
         CLI   PUBREPEL+1,X'2D'       SEE IF BIG ELEM                           
         BL    RREP10A2                                                         
         TM    PUBCSCC1,X'80'                                                   
         BZ    RREP10A1                                                         
         MVC   CPSCOM1,PUBCSC1        SAVE PUB/CLT STANDARD COMMENTS            
RREP10A1 TM    PUBCSCC2,X'80'                                                   
         BZ    RREP10A2                                                         
         MVC   CPSCOM2,PUBCSC2                                                  
*                                                                               
RREP10A2 CLI   WORK+1,0                WILL BE 0 IF NO PAY ADDR FND             
         BE    RREP10A3                                                         
         CLI   WORK+1,X'FF'            SEE IF I FOUND CLIENT ADDRESS            
         BL    RREP20                  DON'T LOOK FOR REP                       
RREP10A3 OC    PUBPAREP(12),PUBPAREP                                            
         BZ    RREP8               NO OVERIDES THIS ELEM                        
         LA    RF,PUBPAREP                                                      
         CLI   FCGTREP,C'Y'                                                     
         BE    RREP10B                                                          
         LA    RF,PUBTRREP                                                      
         CLI   FCGTTREP,C'Y'                                                    
         BE    RREP10B                                                          
         LA    RF,PUBCNREP                                                      
RREP10B  DS    0H                                                               
         MVC   DUB(4),0(RF)                                                     
         MVC   DUB+4(3),PUBRPOFF                                                
RREP11   DS    0H                                                               
         OC    WORK+1(3),WORK+1                                                 
         BZ    RREP12                                                           
         CLC   WORK+1(3),DUB+4     TEST 'LEVEL'                                 
         BNH   RREP20              ADDR MORE SPECIFIC                           
*                                  IF EQUAL - USE ADDR                          
RREP12   DS    0H                                                               
         OC    DUB(4),DUB                                                       
         BZ    RREP20              NO REP                                       
*                                                                               
         LR    R0,RE                                                            
         MVC   WORK,KEY                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(2),PUBKEY+7     AGENCY                                       
         MVC   KEY+2(1),PUBKEY     MEDIA                                        
         MVI   KEY+3,X'11'                                                      
         MVC   KEY+4(4),DUB        REP CODE                                     
         CLC   KEY(10),PREPKEY     DONT READ IF ALREADY THERE                   
         BE    RREP18                                                           
         XC    PREPKEY(159),PREPKEY                                             
         GOTO1 HIGH                                                             
         CLC   KEYSAVE(10),KEY                                                  
         BNE   RREP18                                                           
         GOTO1 GETREP                                                           
         B     RREP19                                                           
*                                                                               
RREP18   DS    0H                                                               
         B     RREPX               JUST EXIT SINCE I'M AT LBUYREQ               
RREP19   B     RREPX               JUST EXIT SINCE I'M AT LBUYREQ               
         SPACE 3                                                                
RREP20   DS    0H                                                               
         XC    PREPREC(197),PREPREC                                             
         CLI   WORK+1,0                                                         
         BE    RREPX               NO ADDR ELEM                                 
         L     R2,FULL                                                          
         USING PGETADRD,R2                                                      
*                                                                               
         MVC   PREPELEM(2),PGADELEM                                             
         MVC   PREPNAME,PGADNAME                                                
         MVC   PREPLIN1,PGADLIN1                                                
         MVC   PREPLIN2,PGADLIN2                                                
         MVC   PREPATTN,PGADATTN                                                
         MVC   PREPTEL,PGADTEL                                                  
*******  MVC   PREPNAME(122),PGADNAME                                           
*                                                                               
         XC    PREPFAX,PREPFAX     CLEAR                                        
         XC    PREPLIN3,PREPLIN3                                                
*                                                                               
*        ALL ELEMENTS SHOULD BE THE SAME LENGTH NOW                             
*                                                                               
*******  CLI   PGADELEM+1,165      SEE IF SHORT ELEM                            
*******  BL    RREP20D             NO FAX OR LIN3 OR EMAIL                      
*                                                                               
         MVC   PREPLIN3(26),PGADLIN3                                            
*                                                                               
         OC    PGADFAX,SPACES                                                   
         CLC   PGADFAX,SPACES      ANY FAX                                      
         BNH   RREP20D             NO - MUST HAVE EMAIL ONLY                    
         MVC   PREPFAX(12),PGADFAX                                              
*                                                                               
RREP20D  MVC   PREPKEY(3),RCSVAGY                                               
*                                                                               
         DROP  R2                                                               
*                                                                               
RREPX    DS    0H                                                               
         CLC   QPUB+8(3),=C'ZZZ'      SEE IF MULTI ZONE/EDT REQ                 
         BNE   EXIT                                                             
         MVC   SCPSCOM1,CPSCOM1                                                 
         MVC   SCPSCOM2,CPSCOM2     SO I'LL USE BASE PUB'S COMMENTS             
         B     EXIT                                                             
         EJECT                                                                  
         SPACE 2                                                                
*        GBASPUB- GET BASE PUB   (DONT NEED LTLREC)                             
         SPACE 2                                                                
GBASPUB  DS    0H                                                               
         XC    WORK(25),WORK                                                    
         MVC   WORK+1(4),PBUYKPUB                                               
GPUB     MVC   WORK+7(2),QAGENCY       ENTER HERE TO GET PUB                    
         MVC   WORK(1),QMEDIA                                                   
         MVI   WORK+9,X'81'                                                     
*                                                                               
         CLC   WORK(25),PUBKEY     TEST HAVE BASE PUB                           
         BER   RE                                                               
*                                                                               
         NTR1                                                                   
         MVC   KEY(25),WORK                                                     
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMRDHI),PUBDIR,KEY,KEY                     
         B     GBASP5                                                           
GBASP3   GOTO1 DATAMGR,DMCB,(DMINBTS,DMRSEQ),PUBDIR,KEY,KEY                     
GBASP5   BAS   RE,TSTERR                                                        
         CLC   KEY(5),WORK                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
         CLC   KEY+7(3),WORK+7    MUST BE RIGHT AGY/RECORD TYPE                 
         BNE   GBASP3                                                           
*                                                                               
         GOTO1 (RF),(R1),(DMINBTS,GETREC),PUBFILE,KEY+27,PUBREC,DMWORK          
         BAS   RE,TSTERR                                                        
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
HIPRT    LA    R0,DMRDHI                                                        
         MVC   KEYSAVE,KEY                                                      
         B     DIRPRT                                                           
*                                                                               
SEQPRT   LA    R0,DMRSEQ                                                        
         B     DIRPRT                                                           
*                                                                               
DIRPRT   NTR1                                                                   
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R0)),PRTDIR,KEY,KEY                       
         B     DMCHK                                                            
*                                                                               
GETPRT1  LA    R0,GETREC                                                        
         B     FILPRT                                                           
*                                                                               
FILPRT   NTR1                                                                   
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R0)),PRTFILE,KEY+27,AREC,DMWORK           
         B     DMCHK                                                            
*                                                                               
DMCHK    DS    0H                                                               
         XIT1                                                                   
*                                                                               
TSTERR   DS    0H                                                               
         OC    ERR(2),ERR                                                       
         BNZ   TSTERR2                                                          
         MVC   BYTE,DMOUTBTS                                                    
         NC    BYTE,DMCB+8                                                      
         BZR   RE                                                               
         MVC   ERR+1,DMCB+8                                                     
TSTERR2  DS    0H                                                               
         LR    R0,RE                                                            
         DC    H'0'                                                             
         EJECT                                                                  
*                                                                               
P72APROF DS    CL16                                                             
P72BPROF DS    CL16                                                             
         DS    CL10                                                             
         LTORG                                                                  
*                                                                               
INSMAX   DC    F'0'                                                             
INSCNT   DC    F'0'                                                             
*                                                                               
ADRTYP   DS    CL1                 TYPE OF ADDR REC-PAY,TRAFFIC,ETC.            
CLTDATA  DS    0CL7                PASS KEY INFO TO PPGETADR MODULE             
CLTAGY   DS    CL2                                                              
CLTMED   DS    CL1                                                              
CLTCODE  DS    CL3                                                              
CLTOFF   DS    CL1                                                              
*                                                                               
ACONS    DS    0F                                                               
         DC    V(PINSOR)                                                        
         DC    V(IOPRNT)                                                        
         DC    V(BLDREV)                                                        
         DC    V(FMTBUY)                                                        
         DC    V(STDCOM)                                                        
         DC    V(COMLIN)                                                        
         DC    V(WFMOD)                                                         
         DC    V(MATCOM)                                                        
         DC    A(0)                                                             
         DC    A(0)                                                             
         DC    A(RECPOOL)                                                       
         DC    A(COMTAB)                                                        
         DC    V(CHOPPER)                                                       
         DC    V(SQUASHER)                                                      
         DC    A(BUFFALOC)                                                      
         DC    A(INSTAB)                                                        
         DC    A(INSTAB)         REALLY ANXTINS                                 
ACONX    EQU   *                                                                
*                                                                               
INSTABD  DSECT           USED TO COVER ENTRIES IN INSTAB                        
INSTREC  DS    0CL21                                                            
INSTKEY  DS    0CL17                                                            
INSTPUB  DS    CL6                                                              
INSTAD   DS    CL6                                                              
INSTDAT  DS    CL3        INSERTION DATE                                        
INSTEDT  DS    CL2                                                              
INSTDISK DS    CL4                                                              
*                                                                               
       ++INCLUDE PP72WORK                                                       
*                                                                               
PGETADRD DSECT                                                                  
       ++INCLUDE PPGETADRD                                                      
*                                                                               
         PRINT OFF                                                              
*      PPREPWORK2 ONLY NEEDED FOR ADDRESS OF DICTATE                            
*      IT IS FOUND AND SAVED AT FBUYCLI (FRIST)                                 
*                                                                               
*PREFIX=A$                                                                      
       ++INCLUDE PPREPWORK2        HAVE SYMBOLS DEFINED IN PP72WORK             
*PREFIX=                                                                        
*                                                                               
       ++INCLUDE PPMODEQU                                                       
*                                                                               
         PRINT ON                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
IOWORKC  CSECT                                                                  
         DC    F'0'                                                             
         ORG   *+IOWORKX-IOWORKD                                                
IOWORKCX DC    X'0'                                                             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
INSTAB   CSECT                                                                  
         DS    63000C         ROOM FOR 3000 INSERTIONS                          
INSTABX  DC    X'0'                                                             
*                                                                               
RECPOOL  CSECT                                                                  
         DC    F'0'                                                             
         DS    4092C                                                            
*                                                                               
*                                                                               
RECPOOLX EQU   *                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
COMTAB   CSECT                                                                  
         DS    17501C        ROOM FOR 250 - 70 CHAR COMMENT LINES               
*                            PLUS 1 CHAR                                        
*                                                                               
         BUFF  LINES=400,FLAVOR=DATA,COMMENT=12,KEYLIST=(30,A)                  
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'012PP72BAS   07/01/08'                                      
         END                                                                    

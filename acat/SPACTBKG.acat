*          DATA SET SPACTBKG   AT LEVEL 093 AS OF 11/04/20                      
*PROCESS USING(WARN(15))                                                        
*CATALP ACTBKG                                                                  
         TITLE 'GET ACTUAL BOOK MENU'                                           
***************UPDATE LOG********************************************           
*   SEP25/06  AKAT - ZERO CELL DATA SUPPORT (NUMERIC BOOKTYPES)     *           
*                                                                   *           
*   MAY31/06  AKAT - ADD BYTE 8 (FISCAL BASE DAY NUMBER) TO THE     *           
*             OPTIMIZATION BLOCK. AFFIDS SHOULD NOT CARE ABOUT      *           
*             THE OUT OF WEEK ROTATOR WHILE ACHIEVED SHOULD.        *           
*                                                                   *           
*   MAR26/06  AKAT - MAKE SURE BYTES 6,7 AND 8 OF THE 00 PROFILE    *           
*             GET CLEARED BEFORE MOBILE                             *           
*                                                                   *           
*   JAN15/98  OLYMPIC EXCLUSION OPTION FOR JULY                     *           
*                                                                   *           
*   OCT15/96  OLYMPIC EXCLUSION OPTION FOR JULY                     *           
*                                                                   *           
*   SEP04/96  SPECIAL OLYMPIC OPTION FOR JULY                       *           
*                                                                   *           
*   JAN08/93  HANDLE BOOK TYPE ELEMENT                              *           
*                                                                   *           
*                                                                   *           
*   DEC11/92  HANDLE NSI ATLANTA MISSING SURVEY                     *           
*                                                                   *           
*                                                                   *           
*   NOV28/88  HANDLE NON-BROADCAST DATES AS DEFINED IN SPOT PROF+2  *           
*                                                                   *           
*   MAY24/88  SPECIAL OLYMPIC OPTION FOR APR GOING TO FEB           *           
*                                                                   *           
*   MAY06/88  SPECIAL OLYMPIC OPTION FOR JAN/FEB                    *           
*                                                                   *           
*   OCT15/87  ADDED BBM 1987/88 SWEEP DATES                         *           
*                                                                   *           
*   SEP28/87  ADDED CSI 1987/88 SWEEP DATES                         *           
*                                                                   *           
*   SEP25/87  ADDED TABLE 40 TO CANADIAN CPPRS(BBM)                 *           
*                                                                   *           
*   SEP10/87  UPDATED ACT TABLES FOR 88                             *           
*             ADDED TABLE 39 FOR CPPRS                              *           
*                                                                   *           
*   JUN15/87  ADDED SPILL CAPABILTIES                               *           
*********************************************************************           
         SPACE 4                                                                
*        P1    0    SPECIAL LOOKUP OPTION                                       
*              1-3  A(ABKBLOCK)                                                 
*                                                                               
         EJECT                                                                  
ACTBKG   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,ABKG,R8,R7,RR=R5                                               
         ST    R5,RELO                                                          
         L     RA,0(R1)                                                         
         USING ABKBLOCK,RA                                                      
*                                                                               
         MVC   VADDAY,ABKADDAY     V(ADDAY)                                     
         MVC   VDATCON,ABKDATCN    V(DATCON)                                    
         MVC   VDEMAND,ABKDEMND    V(DEMAND)                                    
*********************************************************************           
* NOTE: THE ACTTABD DSECT IS PRESUMED TO COVER *ALL* FLAVORS OF                 
*       ACTTAB ENTRIES (ACTTABLE, ACTTABW, ACTTABWC). THEREFORE,                
*       THE LENGTH OF EACH ENTRY ACROSS ALL TABLES MUST BE THE SAME,            
*       OR ELSE WE HAVE SOME WORK TO DO HERE!                                   
*********************************************************************           
         L     RF,ABKCMFAC         GET ADDRESS OF ACT TABLES                    
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,ACTTABLE  GET A(ACTTABLE TABLE)                        
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         MVC   ACTTABLE_LEN,6(R1)  L'TABLE ENTRY RETURNED IN P2                 
         ST    RF,VACTTAB          ADDRESS OF ACTTABLE                          
*                                                                               
         L     RF,ABKCMFAC         GET ADDRESS OF ACT TABLES                    
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,ACTTABW   GET A(ACTTABLE TABLE)                        
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         CLC   ACTTABLE_LEN,6(R1)  L'TABLE ENTRY RETURNED IN P2                 
         BE    *+6                                                              
         DC    H'0'                ENTRY LENGTHS MUST BE CONSISTENT!            
         ST    RF,VACTTABW         ADDRESS OF ACTTABLE                          
*                                                                               
         L     RF,ABKCMFAC         GET ADDRESS OF ACT TABLES                    
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,ACTTABWC  GET A(ACTTABLE TABLE)                        
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         CLC   ACTTABLE_LEN,6(R1)  L'TABLE ENTRY RETURNED IN P2                 
         BE    *+6                                                              
         DC    H'0'                ENTRY LENGTHS MUST BE CONSISTENT!            
         ST    RF,VACTTBWC         ADDRESS OF ACTTABLE                          
*                                                                               
         L     RF,ABKCMFAC         GET ADDRESS OF SEPT 5WK TABLE                
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,SEPT_5WK  GET A(ACTTABLE TABLE)                        
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         MVC   SEP_5WK_LEN,6(R1)   L'TABLE ENTRY RETURNED IN P2                 
         ST    RF,VSEP_5WK         ADDRESS OF ACTTABLE                          
**********************************************************************          
         CLI   ABKCTRY,C'C'        CHECK FOR CANADIAN                           
         BE    *+20                                                             
         CLC   ABKFMS,=C'TTA'      FORCE US ARB TO NSI                          
         BNE   *+10                                                             
         MVC   ABKFMS,=C'TTN'                                                   
*                                                                               
         MVC   MYFMS,ABKFILE       SET FILE/MEDIA/SOURCE                        
*                                                                               
         L     RF,ABKCMFAC         VALIDATE BOOKTYPE                            
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,SPBOOKTB  GET A(BOOKTYPE TABLE)                        
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
*                                                                               
ABK01    DS    0H                                                               
         USING SPBKTYPD,RF                                                      
         CLI   0(RF),X'FF'         EOT?                                         
         BNE   *+12                                                             
         MVI   ABKBTYP,0           YES. INVALID BOOKTYPE: FORCE TO ALL          
         B     ABK02                                                            
*                                                                               
         MVC   BKTYPIND,SPBTYIND   SAVE BOOKTYPE INDICATOR IN TABLE             
         MVC   OVEFFBK,SPOVEFFB    SAVE OVERNIGHT EFFECTIVE BOOK                
         CLC   ABKBTYP,SPBKTYPN    IS BOOKTYPE IN TABLE?                        
         BE    ABK02                                                            
         AR    RF,R0               NO: TRY NEXT                                 
         B     ABK01                                                            
         DROP  RF                                                               
*                                                                               
ABK02    MVC   BOOKTYPE,ABKBTYP    SET BTYPE FOR DEMO LOOKUPS                   
*                                                                               
         MVC   CURRFMS,ABKFILE                                                  
         MVC   CURRMKT,ABKMKT                                                   
         MVC   CURRALFM,ABKALFM                                                 
         MVC   CURRCALL,ABKSTAT    SAVE CURRENT CALL LETTERS                    
         MVC   CURRCLT,ABKCLT                                                   
         MVC   CURRBOOK,ABKBOOK                                                 
         MVC   CURRBTYP,ABKBTYP                                                 
         MVC   CURROOWR,ABKS0PRF+8 OUT OF WEEK ROTATOR                          
*                                                                               
         LA    R9,ABKBDAT                                                       
         GOTO1 VDATCON,DMCB,(2,2(R9)),CURRDATE                                  
         MVC   CURRDATE+6(6),CURRDATE                                           
         GOTO1 VDATCON,DMCB,(2,0(R9)),CURRDATE                                  
*                                                                               
         CLC   CURRAREA(CURRARLQ),SVAREA     SAME BASIC KEYS                    
         BE    BLDSWP              YES-PROCESS FROM MY TABLE                    
         MVC   SVAREA,CURRAREA     NO -BUILD MY TABLE                           
         CLC   ABKBOOK(3),=C'ACT'                                               
         BNE   GETMON                                                           
         L     RF,VACTTAB                                                       
*                                                                               
         CLI   ABKCTRY,C'C'        CHECK FOR CANADIAN                           
         BE    ACTNOWK                                                          
         CLI   ABKMED,C'T'         ONLY FOR USTV                                
         BNE   ACTNOWK                                                          
         CLI   ABKSRC,C'F'         CHECK FUSION                                 
         BE    ACTNOWK                                                          
         CLC   =C'0210',ABKSTART   CHECK FOR START OF WEEKLY DATA               
         BH    ACTNOWK                                                          
         CLI   ABKBTYP,C'P'        LPM GETS FORCED TO SWEEP CLASS 9             
         BE    *+12                                                             
         CLI   ABKMCLAS,C'9'       SWEEP CLASS 9 IS FOR PPM MARKETS             
         BNE   ACTNOWK                                                          
*                                                                               
* WE GET INCOMPLETE MONTHLY BOOKS FOR SOME MONTHS, SO WE NEED A                 
* NEW SET OF TABLES.                                                            
*                                                                               
         L     RF,VACTTABW                                                      
         MVI   ABKS0PRF+3,1                                                     
         CLI   ABKD0PRF+9,0        NOW- ALLOW USER TO DEFINE WHICH ONE          
         BE    *+10                                                             
         MVC   ABKS0PRF+3(1),ABKD0PRF+9                                         
*                                                                               
* AT THIS POINT, RF POINTS TO EITHER ACTTAB OR ACTTABW                          
*                                                                               
ACTNOWK  DS    0C                                                               
         CLI   ABKS0PRF+3,C'0'     KILL BAD PROFILES                            
         BL    *+8                                                              
         NI    ABKS0PRF+3,X'0F'    BY MAKING THEM BINARY                        
         CLI   ABKCTRY,C'C'        NO FORCE FOR CANADA                          
         BE    GTMENU                                                           
         CLI   ABKMED,C'R'         FORCE RADIO...                               
         BE    *+12                                                             
         CLI   ABKSRC,C'F'         ...AND FUSION...                             
         BNE   GTMENU                                                           
         MVC   SVACTTAB,ABKS0PRF+3                                              
         MVI   ABKS0PRF+3,3        TO ACTUAL BOOK 3                             
*                                                                               
*                                                                               
         USING ACTTABD,RF                                                       
GTMENU   CLC   ACTPROF,ABKS0PRF+3  LOOK FOR THE CORRECT TABLE                   
         BE    GTMENU2                                                          
         CLI   0(RF),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                INVALID PROFILE                              
GTMENU1  AH    RF,ACTTABLE_LEN                                                  
         B     GTMENU                                                           
*                                                                               
GTMENU2  CLI   ACTCLASS,X'FF'      DEFAULT SWEEP CLASS                          
         BE    *+14                                                             
         CLC   ABKMCLAS,ACTCLASS   MARKET CLASS OK                              
         BNE   GTMENU1              NO - GET NEXT ENTRY                         
*                                                                               
         MVC   SVMENU,ACTENTRY     SAVE MENU                                    
         MVC   SVMENU2,ACTENTRY                                                 
         DROP  RF                                                               
*                                                                               
         XC    SVLPMDTE,SVLPMDTE                                                
         XC    MKTTYPE,MKTTYPE                                                  
         CLI   ABKCTRY,C'C'        CHECK FOR CANADIAN                           
         BE    GETMON              YES: NO LPM                                  
         CLI   ABKMED,C'T'         IF USTV                                      
         BNE   GETMON              NO: NO LPM                                   
*                                                                               
         MVI   CABACTIV,C'N'       INITIALIZE SWITCH                            
         CLI   ABKSRC,C'F'         FUSION DOESN'T LOOK AT LPM DATE              
         BE    FUSLPM                                                           
         CLI   ABKSRC,C'N'         NOR DOES NSI WIRED                           
         BNE   ANYLPM                                                           
         CLI   ABKBTYP,C'W'                                                     
         BE    FUSLPM                                                           
*                                                                               
ANYLPM   ICM   R6,15,ABKAMKTR      MARKET RECORD GIVEN?                         
         USING MKTRECD,R6                                                       
         BZ    GETMON              NO: NO LPM                                   
         B     HVMTSTP                                                          
*                                                                               
* SET THE LPM DATE FROM THE FUSION END DATE FOR CABLE                           
*                                                                               
FUSLPM   DS    0C                                                               
         L     RF,ABKCMFAC                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,FUSNENDP  GET A(FUSION END DATE TABLE)                 
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
         LR    R1,RF                                                            
*                                                                               
         MVI   CABACTIV,C'Y'       REMEMBER IT'S CABLE                          
FUSLPM2  CLI   0(R1),X'FF'         CHECK IF MARKET IN TABLE                     
***      BE    GETMON                                                           
         BNE   FUSLPM4                                                          
                                                                                
         CLI   ABKSRC,C'F'         FOR FUSION LOOKUPS IF NOT LPM MKT            
         BNE   GETMON              BRANCH OFF TO CHECK IF MKT IS                
         B     FUSLPM6             SET METER MKT                                
                                                                                
FUSLPM4  CLC   ABKALFM,0(R1)                                                    
         BE    *+10                                                             
         AR    R1,R0                                                            
         B     FUSLPM2                                                          
*                                                                               
         MVC   SVLPMDTE(2),5(R1)   IT'S THERE SET UP THE DATES                  
         MVI   SVLPMDTE+2,1                                                     
         GOTO1 VDATCON,DMCB,(3,SVLPMDTE),DUB                                    
         CLC   CURRDATE+6(4),DUB   REQ ENDS BEFORE THIS                         
*****    BL    GETMON                                                           
*****    B     HVMTSTP2                                                         
         BNL   HVMTSTP2                                                         
         CLI   ABKSRC,C'F'         FUSION MKTS PRE-LPM LIVE DATE                
         BNE   GETMON              MEANS IT SET METER MKT. SMM HAVE 12          
         MVI   MKTTYPE,MKTSETM     BOOKS- GET LPM ACTTAB.  2008 AND             
         B     HVMTSTP2            LATER WILL USE LPM ACTTAB                    
* AT THIS POINT MKT IS NOT LPM MKT                                              
* CHECK MKT AGAINST SET METERED MKT TABLE                                       
* IF SET METER MKT THEN USE THE LPM ACT TABLES FOR 2008 AND LATER               
* FOR DIARY MKTS -ALSO SET LPM ACT TABLES  INTO SVMENU AND LPMMENU              
* SVMENU2 STILL HAS ORGINAL DIARY TABLE                                         
FUSLPM6  DS    0C                                                               
         GOTO1 =A(CHKFUSMK)                                                     
         CLI   MKTTYPE,MKTSETM                                                  
         BE    HVMTSTP2                                                         
         MVI   MKTTYPE,MKTDIARY     NOT LPM, NOT SMM MUST BE DIARY              
         B     HVMTSTP2             GET LPM ACT TABLE ANYWAYS                   
                                                                                
*                                                                               
HVMTSTP  OC    MKTLPMDT,MKTLPMDT   ANY LPM START DATE ON MARKET RECORD?         
         BZ    GETMON              NO                                           
         MVI   IGNRMLPM,C'N'                                                    
*&&DO                                                                           
         CLI   ABKBTYP,BOOKTYPE_HS HISPANIC LIVE+SAME DAY                       
         BE    *+8                 NO: USE THE LPM START DATE                   
         CLI   ABKBTYP,C'H'        HISPANIC?                                    
         BNE   HVMTSTP1            NO: USE THE LPM START DATE                   
* HISPANIC BOOKTYPE IS SWEPT FOR OVERNIGHTS                                     
* FOR OVERNIGHTS TREAT AS LPM - WEEKLY WILL TREAT AS NON LPM                    
         CLI   ABKD0PRF+11,C'M'    DO WE WANT TO USE OVERNIGHT                  
         BE    HVMTSTP1             OR                                          
         CLI   ABKD0PRF+11,C'Y'    DO WE WANT TO USE OVERNIGHT                  
         BE    HVMTSTP1             OR                                          
*                                                                               
         CLC   MKTALF,=C'SAC'      YES: IF SACREMENTO                           
         BE    *+10                                                             
         CLC   MKTALF,=C'DEN'      YES: IF DENVER                               
         BE    *+10                                                             
         CLC   MKTALF,=C'PHX'      YES: IF PHOENIX...                           
         BE    *+10                                                             
         CLC   MKTALF,=C'HOU'      YES: IF HOUSTON...                           
         BE    *+10                                                             
         CLC   MKTALF,=C'SF '      YES: IF SAN FRANCISCO...                     
         BE    *+14                                                             
         CLC   MKTALF,=C'DF '      ...OR DALLAS...                              
         BNE   HVMTSTP1                                                         
         MVI   IGNRMLPM,C'Y'       IGNORE LPM START DATE IN MARKET REC          
         B     GETMON                                                           
*&&                                                                             
HVMTSTP1 DS    0H                                                               
         GOTO1 VDATCON,DMCB,(2,MKTLPMDT),DUB                                    
         GOTO1 VDATCON,DMCB,(2,MKTLPMDT),(3,SVLPMDTE)                           
         CLC   CURRDATE+6(4),DUB                                                
         BL    GETMON                                                           
         DROP  R6                                                               
************************************                                            
* SET UP LPM ACT TABLE ENTRY                                                    
HVMTSTP2 L     RF,VACTTABW                                                      
         MVI   THISAT,1            SET OF TABLES                                
         CLI   ABKD0PRF+9,0        NOW- ALLOW USER TO DEFINE WHICH ONE          
         BE    *+10                                                             
         MVC   THISAT,ABKD0PRF+9                                                
*                                                                               
         CLI   THISAT,C'0'         KILL BAD PROFILES                            
         BL    *+8                                                              
         NI    THISAT,X'0F'         BY MAKING THEM BINARY                       
*                                                                               
         USING ACTTABD,RF                                                       
GTHISAT  CLC   ACTPROF,THISAT      LOOK FOR THE CORRECT TABLE                   
         BE    GTHISAT4                                                         
         CLI   0(RF),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                INVALID PROFILE                              
GTHISAT1 AH    RF,ACTTABLE_LEN                                                  
         B     GTHISAT                                                          
*                                                                               
GTHISAT4 CLI   ACTCLASS,X'FF'      DEFAULT SWEEP CLASS                          
         BE    *+14                                                             
         CLC   THISAT,ACTCLASS     MARKET CLASS OK                              
         BNE   GTHISAT1             NO - GET NEXT ENTRY                         
*                                                                               
         MVC   LPMMENU,ACTENTRY    SAVE MENU(LPM)                               
         MVC   SVMENU,LPMMENU      LPM ACT TABLE IN LPMMEMU                     
         DROP  RF                                                               
*                                                                               
************************************                                            
         EJECT                                                                  
* GET DATE LIST FROM INPUT DATES                                                
GETMON   LA    RE,ABKS0PRF                                                      
*               TAKE CARE OF BRDMON BUG                                         
*                BRDMON GETS SCREWED UP IF WE START ON LAST DAY                 
*                OF BROADCAST MONTH                                             
         MVC   BRDDATE,CURRDATE                                                 
         LHI   R9,-14              CAPTURE FIRST MONTH ALWAYS                   
         GOTO1 VADDAY,DMCB,BRDDATE,BRDDATE,(R9)                                 
         CLI   8(RE),7                                                          
         BNE   GETMON1                                                          
         LHI   R9,-1                                                            
         GOTO1 VADDAY,DMCB,BRDDATE,BRDDATE,(R9)                                 
*              EXTEND THE END PAST LAST SUNDAY                                  
GETMON1  GOTO1 VADDAY,DMCB,BRDDATE+6,BRDDATE+6,14                               
*                                                                               
         L     RE,=V(SYSPROFS)     LOAD SYSPROFS                                
         LTR   RE,RE               SYSPROFS SET?                                
         BNZ   *+8                 YES                                          
         LA    RE,ABKS0PRF                                                      
*                                                                               
         MVC   J88PTR(1),2(RE)                                                  
         MVC   J88PTR+1(3),6(RE)                                                
         MVI   2(RE),0             FORCE BROADCAST MONTHS                       
         MVI   6(RE),0             AND NORMAL STARTS                            
         MVI   7(RE),0             (MOBILE LOOKS AT THESE)                      
         MVI   8(RE),0                                                          
         GOTO1 ABKMOBIL,DMCB,(14,BRDDATE),(1,MONLST),ABKMOBP,ABKS0PRF           
*                                                                               
         L     RE,=V(SYSPROFS)     RESTORE SYSPROFS                             
         LTR   RE,RE                                                            
         BNZ   *+8                                                              
         LA    RE,ABKS0PRF                                                      
         MVC   2(1,RE),J88PTR                                                   
         MVC   6(3,RE),J88PTR+1                                                 
         XC    J88PTR,J88PTR                                                    
         XC    M88PTR,M88PTR                                                    
         XC    OLYMKT,OLYMKT                                                    
*                                                                               
* GET BOOKS WHICH FALL IN PERIOD                                                
         CLC   ABKBOOK(3),=C'ACT'                                               
         BE    GTABK                                                            
*                                                                               
         MVC   DUB(4),ABKBOOK                                                   
         MVC   DUB+4(2),=C'01'     DUMMY DAY                                    
         GOTO1 VDATCON,DMCB,DUB,(3,THREE)                                       
         MVC   BBOOK,THREE         YM BINARY                                    
*                                                                               
         LA    RE,BKLST                                                         
         LHI   RF,L'BKLST                                                       
         XCEF                                                                   
*                                                                               
         LA    RE,MONLST           SET ALL MONTHS TO CURRENT BOOK               
         LA    RF,BKLST                                                         
         USING ABKOLD,RF                                                        
GETMON2  CLI   0(RE),0             END OF LIST-CREATE OUTPUT                    
         BE    GETMON5                                                          
*                                                                               
         MVC   ABKOSTEN,0(RE)      START/END DATES                              
         MVC   ABKOBK,BBOOK        BOOK                                         
         LA    RE,4(RE)                                                         
         AHI   RF,ABKOLDLQ                                                      
         B     GETMON2                                                          
*                                                                               
GETMON5  DS    0H                                                               
         LA    RF,ABKOLIST                                                      
         LA    RE,BKLST                                                         
         LHI   R1,L'BKLST                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
         DROP  RF                                                               
*                                                                               
*********MVC   STA,CURRCALL                                                     
EXITX    DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
* GET BOOKS FOR ACTUAL MONTHS                                                   
GTABK    CLI   ABKCTRY,C'C'        CHECK FOR CANADIAN                           
         BNE   GTABK0                                                           
         LA    RE,BKLST                                                         
         LHI   RF,L'BKLST                                                       
         XCEF                                                                   
*                                                                               
         MVI   MOFMMBBM,C'N'                                                    
         BAS   RE,TORMTH           MONTHLY FOR TORONTO                          
         CLI   MOFMMBBM,C'Y'       TREAT BBM MOF METER LIKE US METER            
         BE    *+18                                                             
         OC    BKLST(4),BKLST      ANYTHING IN TABLE?                           
         BNZ   BLDSWP              YES                                          
         B     GTABK0                                                           
*                                                                               
         MVC   SVLPMDTE,=X'68090F' SEP15/04                                     
         L     RF,VACTTBWC                                                      
         USING ACTTABD,RF                                                       
         MVC   SVMENU2,SVMENU                                                   
         MVC   LPMMENU,ACTENTRY    SAVE MENU(LPM)                               
         MVC   SVMENU,LPMMENU                                                   
         DROP  RF                                                               
*                                                                               
GTABK0   LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
         USING ABKOLD,R6                                                        
         LA    RE,BKLST                                                         
         LHI   RF,L'BKLST                                                       
         XCEF                                                                   
         MVI   SEPTSW,C'N'         DEFAULT-DID NOT ENTER ROUTINE                
*                                                                               
GTABK12  CLI   0(R4),X'FF'         END OF LIST - CREATE OUTPUT                  
         BE    BLDSWP                                                           
         CLI   WKSW,1                                                           
         BE    DOWKS                                                            
         MVI   WKCNT,0                                                          
         GOTO1 VDATCON,DMCB,(2,2(R4)),(3,BOOK)                                  
                                                                                
*                                                                               
         CLI   BOOK+1,9            IF SEPTEMBER BROADCAST PERIOD                
         BNE   GTABK16             SEE IF WE NEED TO SWITCH ACT TAB             
         CLI   SEPTSW,C'Y'         IF WE ALREADY WENT INTO ROUTINE              
         BE    GTABK16             THEN WE DONT NEED TO DO IT AGAIN             
         GOTO1 =A(CHKSEPT)                                                      
*                                                                               
* FOR ARBITRON RADIO CHECK IF PPM MARKET                                        
*                                                                               
GTABK16  CLI   ABKMED,C'R'                                                      
         BNE   GTBKRADX                                                         
         XC    DMCB(24),DMCB                                                    
         MVC   DMCB+4(L'BOOK),BOOK                                              
         MVC   SVMENU,SVMENU2           ALWAYS RESET  FOR RADIO                 
*                                       SVMENU2 DEFAULT NON PPM ACTTAB          
         MVC   DMCB+8(L'ABKALFM),ABKALFM                                        
         GOTO1 =A(CHKPPM),DMCB,SVMENU                                           
         MVC   SVPPMLBK,12(R1)          LIVE BOOK BOOK-NULL IF NON-PPM          
         MVC   SVPPMSTP,16(R1)          START PPM PRELIM                        
         MVC   SVPPMENP,20(R1)         END PPM PRELIM                           
* IF NOT PPM MARKET CHECK ALSO TO SEE IF ITS CDM MARKETS                        
         XC    SVCDMLBK,SVCDMLBK                                                
         XC    CDMMENU,CDMMENU                                                  
         OC    SVPPMLBK,SVPPMLBK                                                
         BNZ   GTBKRADX                                                         
         CLI   ABKBTYP,0                CDM ONLY FOR NON-ETHNIC                 
         BNE   GTBKRADX                                                         
         GOTO1 =A(CHKCDM),DMCB,SVMENU                                           
         MVC   SVCDMLBK,12(R1)          LIVE BOOK BOOK-NULL IF NON-CDM          
GTBKRADX DS    0C                                                               
*                                                                               
* CHECK FOR NHSI                                                                
* PRE NOV11 STILL CHECK MARKETS TO IGNORE LPM DATE                              
* ELSE USE NEW LPM ACTTAB                                                       
*                                                                               
         CLI   SVLPMDTE,0          ONLY DO THIS FOR LPM MARKETS                 
         BE    GTABK16D                                                         
         CLI   ABKSRC,C'N'                                                      
         BNE   GTABK16D                                                         
         CLI   ABKBTYP,BOOKTYPE_HS HISPANIC LIVE+SAME DAY                       
         BE    *+8                                                              
         CLI   ABKBTYP,C'H'                                                     
         BNE   GTABK16D                                                         
         CLC   BOOK,=X'6F0B'      PRE NOV11 KEEP USING OLD DIARY ACT            
         BNL   GTABK16J           NOV11 AND LATER USE LPM                       
         MVC   SVMENU,SVMENU2     DIARY ACT TABLE                               
         MVI   SVMENUTY,ACTDEF     SET AS DEFAULT AS PER OLD ACTTAB 3           
         MVI   SVMENU,ACTDEF                                                    
*                                                                               
GTABK16D DS    0C                                                               
* CHECK FOR DIARY MKT FOR FUSION NDM POSTING                                    
* FOR FUSION DIARY MKTS SVMENU, SVMENU2  HAS THE DIARY ACTTABLE ENTRY           
* LPMMENU HAS THE POSSIBLE LPM ACT TABLE ENTRY                                  
                                                                                
         CLI   ABKSRC,C'F'         CHECK FUSION                                 
         BNE   GTABK18                                                          
         CLI   MKTTYPE,MKTSETM                                                  
         BNE   GTABK16H            SMM 2007 OR PRIOR USE DIARY ACTTAB           
         CLI   BOOK,X'6C'          SO WE WONT CHANGE 2007 POSTS                 
         BNL   GTABK16J            2008 START USING LPM ACTTAB                  
         MVC   SVMENU,SVMENU2      2007 AND PRIOR USE OLD ACT DIARY ACT         
         MVI   SVMENUTY,ACTDEF     SET AS DEFAULT AS PER OLD ACTTAB 3           
         MVI   SVMENU,ACTDEF                                                    
         B     GTABK18                                                          
*                                                                               
GTABK16H CLI   MKTTYPE,MKTDIARY                                                 
         BNE   GTABK18                                                          
GTABK16I MVC   SVMENU,SVMENU2      ALWAYS START WITH DIARY ACTTABLE             
         MVI   SVMENUTY,ACTFORCE   SET AS FORCE TABLE BECAUSE WE ARE            
         MVI   SVMENU,ACTFORCE     LOADING 2007 NDM BUT NOT EVERYONE            
*                                  WILL WANT IT UNLESS 00A PROF IS SET          
* DIARY MKT                                                                     
         CLI   BOOK,X'6B'          NDM EFFECTIVE 2007 AND LATER                 
         BL    GTABK18             PRE 2007 ALWAYS DIARY                        
         BE    GTABK17             2007 CHECK FOR NDM START FROM PROF           
GTABK16J MVC   SVMENU,LPMMENU      PAST 2007 NDB ALWAYS LPM ACTTAB              
         MVI   SVMENUTY,ACTFORCE   SET AS FORCE- IF BOOK NOT FOUND..BE          
         MVI   SVMENU,ACTFORCE                                                  
         B     GTABK18                                                          
GTABK17  CLI   ABK0APRF+3,0        ONLY APPLIES FOR 2007                        
         BE    GTABK18             PROFILE NOT SET- USE DIARY ACTTAB            
         ZIC   RE,ABK0APRF+3       RE=NDM 2007 START MONTH                      
         LA    RF,SVMENU2                                                       
         USING ACTENTRY,RF                                                      
* CREATE CORRECT SVMENU TO CONTAIN ACT TABLE ENTRY                              
* FROM COMBINATION OF DIARY/LPM ACT TABLE DEPENDED ON NDM START MONTH           
         MVC   SVMENU,LPMMENU                                                   
         MVI   SVMENUTY,ACTFORCE   SET AS FORCE- IF BOOK NOT FOUND..BE          
         MVI   SVMENU,ACTFORCE                                                  
         CHI   RE,1                EFFECTIVE 01/07 USE FULL LPM ACTTAB          
         BE    GTABK18                                                          
         SHI   RE,1                NUMBER OF MONTHS FROM DIARY TO USE           
         SHI   RE,1                SUBRACT 1 FOR EX INSTRUCTION                 
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   SVMENU+(ACTBOOKS-ACTENTRY)(0),ACTBOOKS                           
         DROP  RF                                                               
GTABK18  DS    0C                                                               
                                                                                
* GET LOOKUP MONTH FROM TABLE                                                   
         ZIC   RE,BOOK+1           GET DEFAULT BOOK FROM TABLE                  
         BCTR  RE,0                DECREMENT MONTH INDEX                        
*                                                                               
GTABK18K LA    RF,SVMENU                                                        
         CLI   SVLPMDTE,0          SWITCH BETWEEN TABLES IF LPM ACTIVE          
         BE    GTABK19                                                          
         CLI   ABKSRC,C'F'         FUSION 2008 AND LATER HAVE 12                
         BNE   *+12                BOOKS, NEVER USE DIARY ACTTAB                
         CLI   BOOK,X'6B'          FOR 2008 AND  LATER                          
         BH    GTABK19                                                          
         CLC   BOOK,SVLPMDTE                                                    
         BNL   *+8                                                              
         LA    RF,SVMENU2          USE OLD DIARY TABLE PRE-LPM                  
*                                                                               
         USING ACTENTRY,RF                                                      
GTABK19  MVC   SVMENUTY,ACTTYPE    SAVE MENU TYPE                               
         LA    RF,ACTBOOKS(RE)                                                  
         DROP  RF                                                               
*                                                                               
GTABK20  DS    0H                                                               
         MVC   SPOLYOPT,ABKD0PRF+8 FOR WESTERN                                  
*&&DO                                                                           
* DEIS: THIS CODE ONLY APPLIES TO MARKETS KC/BUF/OKC, AND ONLY FOR              
*       THE FEB/02 OLYMPICS. IT WAS REMOVED IN FEB/06.                          
         LA    RE,FEB02SL          FOR FEB/02 OLYMPIC EXCLUSION                 
FO2SCK   CLC   CURRCALL(4),0(RE)     THESE STATIONS DO NOT HAVE AN              
         BE    FO2SCK2               EXCLUSION BOOK                             
         LA    RE,4(RE)                                                         
         CLI   0(RE),X'FF'                                                      
         BNE   FO2SCK                                                           
         B     *+8                                                              
FO2SCK2  MVI   SPOLYOPT,C'W'       FORCE LOOKUP OF JAN/02 OR NOV/01             
*&&                                                                             
*                                                                               
*                                                                               
* SAVE POINTERS TO SPECIAL MONTH SLOTS                                          
         CLI   ABKOPT1,C'1'        CPPRS OLYMPIC OPTION                         
         BE    *+8                                                              
         CLI   ABKOPT1,C'2'        COKE/MCCANN OLYMPIC OPTION                   
         BE    *+8                                                              
         CLI   SPOLYOPT,C'W'       WESTERN OPTION ALSO                          
         BE    *+8                                                              
         CLI   ABKOPT1,C'F'        CHECK IF OPTION ACTIVE                       
         BNE   GTABKNO                                                          
*                                                                               
         CLC   BOOK,=AL2(JAN_10)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(JAN_06)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(JAN_02)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(JAN_98)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(JAN_92)                                                
         BNE   *+8                                                              
         ST    R6,J88PTR                                                        
*                                                                               
         CLC   BOOK,=AL2(MAR_10)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(MAR_06)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(MAR_02)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(MAR_98)                                                
         BE    *+10                                                             
         CLC   BOOK,=AL2(MAR_92)                                                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
*                                                                               
         CLC   BOOK,=AL2(JAN_94)                                                
         BNE   *+8                                                              
         ST    R6,J88PTR                                                        
         CLC   BOOK,=AL2(MAR_94)                                                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         OC    M88PTR,M88PTR                                                    
         BNZ   GTABKP8                                                          
*                                                                               
         CLC   BOOK,=AL2(APR_92)   BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK,=AL2(APR_94)   BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK,=AL2(APR_98)   BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK,=AL2(APR_02)   BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK,=AL2(APR_06)   BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK,=AL2(APR_10)   BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
*                                                                               
GTABKP8  DS    0H                                                               
         CLI   BOOK,YR_2010        KILL OPTION FOR MAR/APR                      
         BNE   GTABKNO                                                          
         CLI   BOOK,YR_2006        KILL OPTION FOR MAR/APR                      
         BNE   GTABKNO                                                          
         CLI   BOOK,YR_2002        KILL OPTION FOR MAR/APR                      
         BNE   GTABKNO                                                          
         CLI   BOOK,YR_1998        KILL OPTION FOR MAR/APR                      
         BNE   GTABKNO                                                          
         CLI   SPOLYOPT,C'W'                                                    
         BNE   GTABKNO                                                          
         XC    M88PTR,M88PTR                                                    
GTABKNO  DS    0H                                                               
         MVC   PRLMBK,BOOK         MOVE DEFAULT BOOK TO PRELIM                  
*                                                                               
* AFTER MAY/02 BOSTON HAS MONTHLY BOOKS ARE MONTHLY                             
* SO FORCE ALL TABLES TO BE DEFAULT                                             
         CLC   BOOK,=AL2(MAY_02)                                                
         BL    CHKBOSX                                                          
         CLC   BOOK,=AL2(SEP_02)   NO BOS SW8 ACT BEFORE SEP/02                 
         BL    *+12                                                             
         CLI   ABKMCLAS,C'9'       SWEEP CLASS 9 IS FOR PPM MARKETS             
         BE    CHKBOSX                                                          
         CLI   ABKBTYP,C'T'        SOME BOSTON STATIONS ARE ALSO IN             
         BE    CHKBOSX              MANCHESTER,NH UNDER "T" BOOKTYPE            
*                                                                               
         LA    R5,BOSLST           LIST OF BOSTON STATIONS                      
CHKBOS   CLI   0(R5),X'FF'                                                      
         BE    CHKBOSX                                                          
         CLC   0(4,R5),CURRCALL                                                 
         BE    GTABK26             LEAVE PRLMBK=BOOK                            
         LA    R5,4(R5)                                                         
         B     CHKBOS                                                           
CHKBOSX  DS    0C                                                               
*                                                                               
         MVC   PRLMBK+1(1),0(RF)   SET PRLMBK TO TABLE RETRY BOOK               
         CLI   0(RF),X'FF'                                                      
         BE    DOWKS                                                            
         CLI   SVMENUTY,ACTFORCE   FORCE MENU                                   
         BNE   *+10                                                             
         MVC   BOOK+1(1),0(RF)     SET BOOK PRIOR TO LOOKUP                     
*                                                                               
         CLI   SVMENUTY,ACTSPCL    SPECIAL MENU                                 
         BNE   GTABK1B             FOR BBM                                      
         ZIC   R5,BOOK+1                                                        
         BCTR  R5,0                                                             
         LA    R5,DEFAULT(R5)                                                   
         MVC   BOOK+1(1),0(R5)                                                  
*                                                                               
GTABK1B  TM    0(RF),X'80'         FORCE MONTH                                  
         BZ    *+10                                                             
         MVC   BOOK+1(1),0(RF)     SET BOOK PRIOR TO LOOKUP                     
         NI    BOOK+1,X'7F'                                                     
         NI    PRLMBK+1,X'7F'                                                   
*                                                                               
GTABK26  LA    R5,MYDBLK           VALIDATE STATION/BOOK                        
         USING DBLOCK,R5                                                        
         XC    0(256,R5),0(R5)                                                  
         MVI   DBSELMED,C'T'                                                    
         CLI   ABKMED,C'R'                                                      
         BNE   *+8                                                              
         MVI   DBSELMED,C'R'                                                    
         CLI   ABKBTYP,C'W'        IF IT'S WIRED                                
         BE    *+12                                                             
         CLI   ABKSRC,C'F'         OR FUSION                                    
         BNE   GTABKCN                                                          
         OC    ABKSPMKT,ABKSPMKT   SET THE ALPHA MARKET IF THERE                
         BNZ   GTABKCN                                                          
         OC    ABKALFM,ABKALFM                                                  
         BZ    GTABKCN                                                          
         MVC   DBSELALF,ABKALFM    SET THE SPILL                                
*********MVC   ABKAGY,=C'SJ'      <---FOR TESTING FORCE THE AGENCY              
*                                                                               
GTABKCN  CLI   ABKCTRY,C'C'        CHECK FOR CANADIAN                           
         BNE   GTABKUS                                                          
         MVI   DBSELMED,C'C'       SET TO USE CANADIAN FILE                     
         MVI   DBFRANCO,C'Y'                                                    
         LA    RE,ABK1WPRF                                                      
         MVC   DBFRANCO,3(RE)      SET FRANCO OPTION                            
*********MVC   DBUSEBBM,9(RE)      SET USE BBM FLAG                             
         OC    ABKALFM,ABKALFM                                                  
         BZ    GTABKUS                                                          
         MVC   DBSELALF,ABKALFM    SET THE SPILL                                
*                                                                               
GTABKUS  MVC   DBFILE,=C'TP '                                                   
         MVC   DBSELBK,BOOK                                                     
         MVC   DBBTYPE,BOOKTYPE                                                 
         CLI   ABKSRC,C'N'                                                      
         BNE   GTABK27                                                          
         CLI   DBBTYPE,C'W'                                                     
         BNE   GTABK27                                                          
         MVI   DBBTYPE,C'C'                                                     
GTABK27  DS    0H                                                               
***                                                                             
***                                                                             
         BAS   R9,ADJBOOK          ADJUST FOR OUT OF YEAR                       
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL                                                
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELSRC,ABKSRC                                                  
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
*                                                                               
         CLI   DBSELMED,C'T'       ARB USTV MOSTLY DEAD                         
         BNE   ARBOK               AFTER NOV/93                                 
         CLI   DBSELSRC,C'A'                                                    
         BNE   ARBOK                                                            
         CLI   DBSELBK,YR_1994                                                  
         BL    ARBOK                                                            
         MVI   DBSELSRC,C'N'       OVERRIDE TO NSI                              
*                                                                               
* OVERRIDE NSI OCT/92 TO NOV/92                                                 
ARBOK    CLI   DBSELSRC,C'N'       NSI                                          
         BNE   SRCOK                                                            
         CLC   DBSELBK,=AL2(OCT_92) AND OCT/92                                  
         BNE   SRCOK                                                            
         LA    RE,ATLSTA           SCAN FOR ATLANTA STATIONS                    
ATL9210  CLI   0(RE),X'FF'                                                      
         BE    SRCOK                                                            
         CLC   DBSELSTA(4),0(RE)                                                
         BE    *+12                                                             
         LA    RE,4(RE)                                                         
         B     ATL9210                                                          
*                                                                               
         MVC   DBSELBK,=AL2(NOV_92) FOUND ONE - OVERRIDE TO NOV/92              
         MVC   BOOK,DBSELBK                                                     
         MVC   PRLMBK,BOOK                                                      
*                                                                               
SRCOK    CLI   ABKMED,C'R'                                                      
         BNE   SRCOK2                                                           
         MVI   DBSELMED,C'R'                                                    
         MVC   DBSELDAT,BOOK                                                    
*                                                                               
         OC    SVPPMLBK,SVPPMLBK   PPM AND PRIOR NO NEED TO ADJUST LIKE         
         BNZ   SRCOK1              WE DID BEFORE                                
         OC    SVCDMLBK,SVCDMLBK   CDM AND LATER NO NEED TO ADJUST LIKE         
         BNZ   SRCOK1              WE DID BEFORE                                
         CLI   DBSELDAT+1,1        ADJUST JAN                                   
         BE    *+8                                                              
         CLI   DBSELDAT+1,4        ADJUST APRIL                                 
         BE    *+8                                                              
         CLI   DBSELDAT+1,10       ADJUST OCTOBER                               
         BNE   SRCOK1                                                           
         ZIC   RE,DBSELDAT+1                                                    
         LA    RE,1(RE)                                                         
         STC   RE,DBSELDAT+1                                                    
*                                                                               
SRCOK1   DS    0H                                                               
*                                                                               
         MVC   DBSELBK,=X'FFF1'    LATEST BOOK                                  
         MVI   DBSELDAY,X'7F'      MON-FRI IS BASE                              
         OC    ABKSPMKT,ABKSPMKT                                                
         BNZ   SPOK                                                             
         OC    ABKALFM,ABKALFM                                                  
         BZ    SRCOK2                                                           
         MVC   DBSELALF,ABKALFM                                                 
*                                                                               
SPOK     L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         MVC   DBSELBK,=X'FFF5'    GO BACK 5 BOOKS                              
         MVI   RADBOOK,0                                                        
*                                                                               
*  DONT LOOK FOR PRELIMINARY PPM BOOKTYPES WHEN SEARCHING FOR LATEST            
*  BOOK LOADED - WE WANT TO SEE IF  LATEST BOOK IS PPM LIVE OR LATER            
         CLI   DBBTYPE,C'P'                PPM BOOKTYPE SEARCH FOR              
         BNE   *+8                         LATEST LIVE BOOKS LOADED             
         MVI   DBBTYPE,0                   IGNORE PPM BOOKTYPE                  
         CLI   DBBTYPE,C'E'                PPM BOOKTYPE SEARCH FOR              
         BNE   *+8                         LATEST LIVE BOOKS LOADED             
         MVI   DBBTYPE,C'B'                IGNORE PPM BOOKTYPE                  
         CLI   DBBTYPE,C'I'                PPM BOOKTYPE SEARCH FOR              
         BNE   *+8                         LATEST LIVE BOOKS LOADED             
         MVI   DBBTYPE,C'H'                IGNORE PPM BOOKTYPE                  
****************************************************                            
* REMINDER ALSO ADD ETHNIC PPM BOOKTYPE CODE HERE  *                            
****************************************************                            
         MVI   PPMBKFLG,LOAD_NO            LIVE PPM BOOK NOT LOADED             
*                                                                               
         OC    SVCDMLBK,SVCDMLBK   FOR ARB CDM LOOKUP SET LATEST BK             
         BZ    *+20                LIMIT TO CDM LIVE BK OR LATER                
         CLC   DBSELDAT,SVCDMLBK                                                
         BNL   *+10                                                             
         MVC   DBSELDAT,SVCDMLBK                                                
*                                                                               
         OC    SVPPMLBK,SVPPMLBK   FOR ARB PPM LOOKUP SET LATEST BK             
         BZ    *+20                LIMIT TO PPM LIVE BK OR LATER                
         CLC   DBSELDAT,SVPPMLBK                                                
         BNL   *+10                                                             
         MVC   DBSELDAT,SVPPMLBK                                                
         GOTO1 VDEMAND,DMCB,MYDBLK,RLHOOK                                       
*                                                                               
         LA    RE,RADFILT_NEG      LOOKUP ALPHA MKT IN SPECIAL OVR TBL          
         USING RADFILT_NEGD,RE                                                  
RADFNEG1 CLC   =X'FFFF',0(RE)      DID WE HIT E-O-T?                            
         BE    RADFNEGX            YES, LEAVE IT ALONE                          
         CLC   DBSELALF,RADFILT_NEG_ALF   MATCH ON ALPHA MKT?                   
         BE    RADFNEG4                   YES                                   
RADFNEG2 AHI   RE,L'RADFILT_NEG    NEXT ENTRY IN RADFILE_NEG                    
         B     RADFNEG1                                                         
*                                                                               
* FOUND ENTRY FOR ALPHA MARKET IN RADFILT_NEG TABLE                             
RADFNEG4 CLC   BOOK(1),RADFILT_NEG_EYR  LOOKUP YEAR/MONTH AFTER THE             
         BL    RADFNEGX                    EFFECTIVE YEAR/MONTH OF THE          
         CLC   BOOK+1(1),RADFILT_NEG_EMN   SWEEP CLASS CHANGE?                  
         BL    RADFNEGX                 NO, DONE WITH ALPHA MKT                 
         MVC   RADBOOK,RADFILT_NEG_MON                                          
         B     RADFNEG2            SEE IF ALPHA MKT APPEARS IN FUTURE           
         DROP  RE                                                               
*                                                                               
RADFNEGX DS    0X                                                               
*                                                                               
         MVC   DBSELDAT,BOOK                                                    
         MVC   DBSELBK,=X'FFF1'    LATEST BOOK                                  
         XC    DBACTBK,DBACTBK                                                  
*                                                                               
         OC    SVPPMLBK,SVPPMLBK   PPM AND PRIOR NO NEED TO ADJUST LIKE         
         BNZ   SRCOK2              WE DID BEFORE                                
         OC    SVCDMLBK,SVCDMLBK   CDM AND PRIOR NO NEED TO ADJUST LIKE         
         BNZ   SRCOK2              WE DID BEFORE                                
         CLI   DBSELDAT+1,1        ADJUST JAN                                   
         BE    *+8                                                              
         CLI   DBSELDAT+1,4        ADJUST APRIL                                 
         BE    *+8                                                              
         CLI   DBSELDAT+1,10       ADJUST OCTOBER                               
         BNE   SRCOK2                                                           
         ZIC   RE,DBSELDAT+1                                                    
         LA    RE,1(RE)                                                         
         STC   RE,DBSELDAT+1                                                    
*                                                                               
SRCOK2   DS    0H                                                               
*                                                                               
* THERE WILL BE NO NSI FEB09 BOOK - MAR09 WILL BE THE MAJOR SWEEP               
* EXCEPT FOR LPM MARKETS                                                        
*                                                                               
*                                                                               
         CLI   ABKSRC,C'F'         CHECK FUSION                                 
         BE    FEB09X                                                           
         CLI   DBSELMED,C'T'                                                    
         BNE   FEB09X                                                           
         OC    SVLPMDTE,SVLPMDTE                                                
         BZ    FEB09A                                                           
         CLC   BOOK,SVLPMDTE                                                    
         BNL   FEB09X                                                           
FEB09A   CLC   DBSELBK,=AL2(FEB_09)                                             
         BNE   *+22                                                             
         MVC   DBSELBK,=AL2(MAR_09)                                             
         MVC   BOOK,DBSELBK                                                     
         MVC   PRLMBK,BOOK                                                      
*                                                                               
*                                                                               
FEB09X   L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
* JAN_17 FORWARD NCC NO LONGER HAS STANDARD BOOKS                               
* SPONSOR REPORTS DO NOT SENT THE BOOKTYPE TO ACTBKG ROUTINE SO                 
* LETS JUST LOOK FOR BOOKTYPE_LS                                                
         CLI   DBSELSRC,C'F'                                                    
         BNE   *+18                                                             
         CLC   DBSELBK,=AL2(JAN_17)                                             
         BL    *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_LS                                              
*                                                                               
         CLI   DBSELMED,C'C'                                                    
         BNE   SRCOK3                                                           
         MVI   DBBEST,C'M'                                                      
         LA    RE,ABK1WPRF                                                      
         MVC   DBFRANCO,3(RE)      SET FRANCO OPTION                            
*********MVC   DBUSEBBM,9(RE)      SET USE BBM FLAG                             
         CLI   ABKCTRY,C'C'        CANADA?                                      
         BE    *+6                                                              
         DC    H'0'                NO: HOW DID WE GET HERE?                     
*                                                                               
*                                                                               
SRCOK3   GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         CLI   DBERROR,NOTFOUND    FOUND STATION FOR BOOK                       
         BNE   GTABK50                                                          
*                                                                               
         CLI   DBSELMED,C'T'                                                    
         BNE   CHKLPMX                                                          
         CLI   DBBTYPE,0                                                        
         BNE   CANSPLX                                                          
*                                                                               
         L     RE,ABKAMKTR         GET ADDRESS OF MARKET RECORD                 
         USING MKTRECD,RE                                                       
         OC    MKTLPMDT,MKTLPMDT                                                
         BZ    CHKLPMX                                                          
         CLI   IGNRMLPM,C'Y'       IGNORE LPM START DATE IN MARKET REC?         
         BE    CHKLPMX             YES                                          
         GOTO1 VDATCON,DMCB,(2,MKTLPMDT),(3,THREE)                              
         DROP  RE                                                               
*                                                                               
         CLC   DBSELBK,THREE                                                    
         BL    CHKLPMX                                                          
         MVI   DBBTYPE,C'P'                                                     
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         CLI   DBERROR,NOTFOUND                                                 
         BNE   GTABK50                                                          
CHKLPMX  DS    0C                                                               
*                                                                               
         CLI   DBSELMED,C'C'                                                    
         BNE   CANSPLX                                                          
         XC    DBSELMK,DBSELMK                                                  
         CLI   ABKCTRY,C'C'        CANADA?                                      
         BE    *+6                                                              
         DC    H'0'                NO: HOW DID WE GET HERE?                     
*                                                                               
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         CLI   DBERROR,NOTFOUND                                                 
         BNE   GTABK50                                                          
*                                                                               
CANSPLX  DS    0C                                                               
         CLC   BOOK,PRLMBK                                                      
         BNE   GTABK42                                                          
         MVC   ABKOSTEN,0(R4)      SET FOR NO LOOKUP                            
         XC    ABKOBK,ABKOBK                                                    
* ALLOW DIGITAL TRANSITION JUN09 BOOK TO PASS THROUGH EVEN THOUGH               
* THE BOOK IS NOT PRODUCED - SPGETDEMF/SPGETDEME WILL SWITCH TO                 
* OVERNIGHTS (ONLY FOR LPM MARKETS)                                             
         OC    SVLPMDTE,SVLPMDTE                                                
         BZ    GTABK80                                                          
         CLC   BOOK,SVLPMDTE                                                    
         BL    GTABK80                                                          
         CLC   DBSELBK,=AL2(JUN_09)                                             
         BNE   GTABK80                                                          
         MVC   BOOK,DBSELBK                                                     
         B     GTABK50                                                          
*                                                                               
GTABK42  MVC   BOOK,PRLMBK         SET DEFAULT BOOK                             
         B     GTABK26             TRY AGAIN                                    
*                                                                               
GTABK50  L     RE,DBAREC           SAVE THE MARKET NUMBER                       
         LA    RE,DRFRSTEL-DRKEY(,RE)                                           
         MVC   OLYMKT,MARNO-MARELEM(RE)                                         
         MVC   ABKOSTEN,0(R4)      SET DATE TABLE                               
         MVC   DBSELBK,BOOK                                                     
         CLI   ABKMED,C'R'                                                      
         BNE   *+10                                                             
         MVC   DBSELBK,DBACTBK                                                  
         BAS   R9,ADJBOOK          ADJUST THE BOOK                              
         MVC   ABKOBK,DBSELBK                                                   
*                                                                               
GTABK54  CLI   DBSELMED,C'R'       CUT AT LATEST AVAILABLE BOOK                 
         BNE   GTABK80              IF RADIO ACTUAL                             
*                                                                               
* ALL POSTING DATES PRIOR TO PPM PRELIM SHOULD NOT BE AFFECTED SINCE            
* WE ARE CHECKING AGAINST THE LATEST BOOK ON FILE WITH A BOOK LIMIT             
* (DBSELDAT) SET TO THE BOOK COORESPONDING TO THE END DATE OF MONLST            
*                                                                               
* ACTTAB 76 FEATURE 20.3                                                        
         OC    CDMMENU,CDMMENU      IF USING CDM ACTTAB                         
         BNZ   GTABK55              USE BOOK FROM ACTTAB                        
*                                                                               
         OC    SVCDMLBK,SVCDMLBK    IF ACT TABLE 76 NOT ON PROFILE              
         BNZ   GTABK56              CDM MARKETS POST TO EXACT BOOK              
*                                                                               
* CHECK TO SEE IF ARB PPM MARKET                                                
         OC    SVPPMLBK,SVPPMLBK    SVPPMLBK IS ONLY SET IF THE BOOK WE         
         BZ    GTABK60              ARE LOOKING UP FROM MONLST IS               
*                                   AT PPM START PRELIMINARY BOOK               
*                                   OR LATER.                                   
         CLC   BOOK,SVPPMSTP        WE ARE LOOKING UP MONLST ENTRY              
         BL    GTABK60              PRELIM PPM START OR LATER                   
*                                                                               
* BOOK IS  PRELIMINARY PPM BOOK                                                 
         CLI   PPMBKFLG,LOAD_YES    IS LIVE PPM BOOK LOADED YET?                
         BNE   RADGAB3              NOT LOADED-BOOK NOT ALLOWED TO POST         
*                                                                               
* LIVE PPM BOOK IS LOADED. IF LOOKING UP PRELIM BOOKS ASSUME ITS LOADED         
* SINCE LIVE IS LOADED.  I DONT WANT TO LOOKUP THE  PRELIMINARY BKTYPES         
* TO SEE IF PRELIM IS LOADED.                                                   
* IF LOOKING UP LIVE BOOKS OR LATER MAKE SURE THE BOOK MATCHES EXACTLY          
         CLC   BOOK,SVPPMLBK                                                    
         BNL   GTABK56                                                          
GTABK55  MVC   ABKOBK,BOOK                                                      
         B     GTABK80              PRELIM BOOK -ASSUME IS LOADED               
*                                                                               
*                                                                               
GTABK56  CLC   BOOK,ABKOBK          IS THE EXACT POST LIVE PPM BOOK             
         BNE   RADGAB3              LOADED?                                     
         B     GTABK80              EXACT MATCH                                 
*                                                                               
GTABK60  DS    0C                                                               
*                                                                               
*                                                                               
*                                                                               
         LA    R9,RADFILT                                                       
RADGAB1  CLI   0(R9),X'FF'         FIND CORRECT MODEL                           
         BE    RADGAB3                                                          
         CLC   0(1,R9),RADBOOK     KEYED BY BOOKS SWEPT FOR STATION             
         BE    *+12                                                             
         LA    R9,L'RADFILT(R9)                                                 
         B     RADGAB1                                                          
*                                                                               
         GOTO1 VDATCON,DMCB,(2,2(R4)),(3,BOOK)                                  
         ZIC   RE,BOOK+1           SET INDEX                                    
         AR    RE,R9                                                            
*                                                                               
         CLI   BOOK+1,MON_APR      ALLOW PREV YEAR PRIOR TO APRIL               
         BL    *+14                                                             
         CLC   ABKOBK(1),BOOK                                                   
         BNE   RADGAB3                                                          
*                                                                               
         CLC   ABKOBK+1(1),0(RE)   IT'S OK                                      
         BE    GTABK80                                                          
*                                                                               
**** FOR YRK AND SVP WE NEED TO FORCE THE BOOK FROM THE RADFILT TABLE           
**** WE ARE PRETENDING THE CDM DATA IS NOT THERE FOR 2019 AND WE                
**** ARE ONLY USING THE 2 BOOKS MAY AND NOV                                     
**** FOR ANY BOOK AFTER CDM ENDED                                               
         CLC   =C'SVP',ABKALFM                                                  
         BE    *+10                                                             
         CLC   =C'YRK',ABKALFM                                                  
         BNE   RADGAB3                                                          
         MVC   FORCEBK,ABKOBK                                                   
         MVC   FORCEBK+1(1),0(RE)                                               
* IF THE FORCEBK (ACTBOOK WE WANT TO SET TO) IS > LATEST BOOK LOADED            
* THEN CLEAR OUT ACTBK, DATA NOT LOADED YET                                     
         CLC   FORCEBK,ABKOBK                                                   
         BH    RADGAB3                                                          
         MVC   ABKOBK,FORCEBK                                                   
         B     GTABK80                                                          
*                                                                               
RADGAB3  XC    ABKOBK,ABKOBK       CUT IT IF RETRIEVED BOOK NE DESIRED          
*                                                                               
GTABK80  AHI   R6,ABKOLDLQ         SET NEXT LIST SLOT                           
         CLI   WKSW,1                                                           
         BE    DOWKS                                                            
         LA    R4,4(R4)            SET NEXT DATE                                
         B     GTABK12                                                          
         DROP  R6                                                               
         EJECT                                                                  
* GET WEEKLY BOOKS                                                              
DOWKS    SR    R3,R3               FIRST TIME                                   
         CLI   WKSW,0                                                           
         BNE   DOWKS2                                                           
*                                                                               
         MVI   WKSW,1                                                           
         MVI   WKCNT,0                                                          
         ST    R4,SVR4                                                          
*                                                                               
         LA    R9,SVMENU                                                        
         CLI   ABKSRC,C'F'         FUSION NEVER GO BACK TO DIARY ACTTAB         
         BE    *+8                 FOR PRE LPM- FUSION HAS 12 MONTHS            
         CLI   SVLPMDTE,0          SWITCH BETWEEN TABLES IF LPM ACTIVE          
         BE    *+18                                                             
         CLC   BOOK,SVLPMDTE                                                    
         BNL   *+8                                                              
         LA    R9,SVMENU2                                                       
*                                                                               
         USING ACTENTRY,R9                                                      
         LA    R9,ACTSPEC                                                       
         USING ACTSPEC,R9                                                       
DOWKS1   CLC   ACTMONTH,BOOK+1     GET MONTHLY WEEKS                            
         BE    *+12                                                             
         AHI   R9,L'ACTSPEC                                                     
         B     DOWKS1                                                           
         MVC   WEEKS,ACTWEEKS      SAVE WEEKLY BOOKS                            
         DROP  R9                                                               
*                                                                               
         GOTO1 VDATCON,DMCB,(2,(R4)),WKSTART                                    
         GOTO1 VDATCON,DMCB,(2,2(R4)),WKEND                                     
*                                                                               
DOWKS2   CLC   WKSTART,WKEND                                                    
         BH    DOWKS3                                                           
         GOTO1 VDATCON,DMCB,WKEND,(3,THREE)                                     
         GOTO1 VDATCON,DMCB,WKSTART,(2,FULL)                                    
         GOTO1 VADDAY,DMCB,WKSTART,WORK,6                                       
         GOTO1 VDATCON,DMCB,WORK,(2,FULL+2)                                     
         LA    R3,7(R3)                                                         
         GOTO1 VADDAY,DMCB,WKSTART,WORK,(R3)                                    
         SR    R3,R3                                                            
         MVC   WKSTART,WORK                                                     
         ZIC   RE,WKCNT                                                         
         MVC   BOOK,THREE                                                       
         MVC   PRLMBK,BOOK                                                      
         LA    RF,WEEKS(RE)                                                     
         LA    RE,1(RE)                                                         
*                                                                               
         CHI   RE,5                DEAL WITH SPLIT WEEKS                        
         BL    *+8                                                              
         LHI   RE,4                                                             
*                                                                               
         LA    R4,FULL                                                          
         STC   RE,WKCNT                                                         
         B     GTABK20                                                          
*                                                                               
DOWKS3   MVI   WKSW,0                                                           
         MVI   WKCNT,0                                                          
         L     R4,SVR4                                                          
         LA    R4,4(R4)                                                         
         B     GTABK12                                                          
         EJECT                                                                  
ADJBOOK  CLI   DBSELBK+1,13        CURRENT YEAR                                 
         BLR   R9                                                               
         CLI   DBSELBK+1,24        PREV YEAR                                    
         BH    ADJBOOK2                                                         
*                                                                               
         ZIC   RF,DBSELBK          INCREMENT THE YEAR                           
         AHI   RF,1                                                             
         STC   RF,DBSELBK                                                       
         ZIC   RF,DBSELBK+1        ADJUST THE MONTH                             
         SHI   RF,12                                                            
         STC   RF,DBSELBK+1                                                     
         BR    R9                                                               
*                                                                               
ADJBOOK2 ZIC   RF,DBSELBK          DECREMENT THE YEAR                           
         BCTR  RF,0                                                             
         STC   RF,DBSELBK                                                       
         ZIC   RF,DBSELBK+1        ADJUST THE MONTH                             
         SHI   RF,24                                                            
         STC   RF,DBSELBK+1                                                     
         BR    R9                                                               
         EJECT                                                                  
TORMTH   NTR1                                                                   
*                                                                               
         LA    R5,MYDBLK                                                        
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELSTA,ABKSTAT                                                 
         OC    ABKALFM,ABKALFM     NO ALPHA GIVEN                               
         BZ    TORALFX             LOOK FOR NUMERIC                             
         CLC   ABKALFM(2),=C'TO'                                                
         BE    TORALFX                                                          
         CLC   ABKALFM(2),=C'VA'                                                
         BNE   TORMTHX                                                          
*                                                                               
TORALFX  CLC   DBSELMK,=H'9109'    VANCOUVER                                    
         BE    *+10                                                             
         CLC   DBSELMK,=H'5199'    TORONTO                                      
         BE    *+14                                                             
         OC    DBSELMK,DBSELMK                                                  
         BNZ   TORMTHX                                                          
* IF TOR/VAN IT IS METERED -NO NEED TO CHECK STATION LIST - BPOO 02/08          
         CLC   ABKALFM(2),=C'TO'                                                
         BE    TORMTH2                                                          
         CLC   ABKALFM(2),=C'VA'                                                
         BE    TORMTH2                                                          
*                                                                               
         CLC   DBSELSTA(4),=C'JXVA'                                             
         BNE   *+10                                                             
         MVC   DBSELSTA(4),=C'SPNP'                                             
         LA    RE,BBMTORL                                                       
         CLC   DBSELSTA+1(3),=C'TOR'  GLOBAL ETC.                               
         BE    TORMTH2                                                          
         CLC   DBSELSTA+1(3),=C'XTO'  SPECIALTY                                 
         BE    TORMTH2                                                          
         LA    RE,BBMVANL                                                       
         CLC   DBSELSTA+1(3),=C'VAN'  GLOBAL ETC.                               
         BE    TORMTH2                                                          
         CLC   DBSELSTA+1(3),=C'XVA'  SPECIALTY                                 
         BE    TORMTH2                                                          
         CLC   ABKALFM,=C'TOR'                                                  
         BE    *+10                                                             
         CLC   DBSELMK,=H'5199'    IF TORONTO SPILL ALLOW THESE                 
         BNE   TORMTHH                                                          
         CLC   DBSELSTA(4),=C'CKCO'   BECAUSE THEY ALSO HAVE A BBM HOME         
         BE    TORMTH2                IN A DIFFERENT MARKET                     
         CLC   DBSELSTA(4),=C'CKVR'                                             
         BE    TORMTH2                                                          
TORMTHH  LA    RE,BBMTORL                                                       
TORMTH1  CLI   0(RE),X'FF'         END OF ALL LISTS                             
         BE    TORMTHX             NO CSI MARKET                                
         CLC   CURRCALL(4),0(RE)                                                
         BE    TORMTH2                                                          
         LA    RE,4(RE)                                                         
         B     TORMTH1                                                          
*                                                                               
*&&DO                                                                           
* DEIS SAYS THIS CODE CANNOT WORK: RF ISN'T SET PRIOR TO A BRANCH TO            
* LABEL TORMTH2A!                                                               
TORMTH2  LA    RF,BBMVANL-4                                                     
TORMTH2A MVI   MMBOOK,YR_1997      TORONTO START                                
         CR    RE,RF                                                            
         BL    *+8                                                              
         MVI   MMBOOK,YR_1998      VANCOUVER START                              
*&&                                                                             
TORMTH2  DS    0H                                                               
         LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
         USING ABKOLD,R6                                                        
*                                                                               
TORMTH3  GOTO1 VDATCON,DMCB,(2,2(R4)),(3,BOOK)                                  
         CLI   BOOK,YR_1998        OUTSIDE PERIOD IGNORE                        
         BL    TORMTHX                                                          
         MVC   ABKOSTEN,0(R4)                                                   
         MVC   ABKOBK,BOOK                                                      
         AHI   R6,ABKOLDLQ                                                      
         LA    R4,4(R4)                                                         
         CLI   0(R4),X'FF'                                                      
         BNE   TORMTH3                                                          
         DROP  R6                                                               
*                                                                               
TORMTHX  DS    0C                                                               
         OC    ABKALFM,ABKALFM                                                  
         BZ    CLGMTH                                                           
         CLC   ABKALFM,=C'MOF'                                                  
         BE    MOFMTH                                                           
         CLC   ABKALFM,=C'NWK'                                                  
         BE    MOFMTH                                                           
         CLC   ABKALFM,=C'CAL'                                                  
         BE    CLGMTH                                                           
         CLI   ABKALFM+2,X'41'                                                  
         BH    TORMTHXF                                                         
         CLC   ABKALFM(2),=C'CA'                                                
         BE    CLGMTH                                                           
         CLC   ABKALFM(2),=C'MF'                                                
         BE    MOFMTH                                                           
         B     TORMTHXF                                                         
*                                                                               
CLGMTH   CLC   DBSELMK,=H'8069'                                                 
         BE    *+14                                                             
         OC    DBSELMK,DBSELMK                                                  
         BNZ   MOFMTH                                                           
*&&DO                                                                           
         CLI   ABKSRC,C'N'         DO NSI STUFF ONLY FOR NSI                    
         BNE   TORMTHXF                                                         
*                                                                               
* IF ALPHA=CAL IS METERED -NO NEED TO CHECK STATION LIST - BPOO 02/08           
         CLC   ABKALFM,=C'CAL'                                                  
         BE    CLGMTH2                                                          
*&&                                                                             
         CLC   ABKALFM,=C'CAL'                                                  
         BE    CLGMTH2                                                          
*                                                                               
         LA    RE,BBMCLGL                                                       
CLGMTH1  CLI   0(RE),X'FF'         END OF ALL LISTS                             
         BE    MOFMTH              NO CSI MARKET                                
         CLC   CURRCALL(4),0(RE)                                                
         BE    CLGMTH2                                                          
         LA    RE,4(RE)                                                         
         B     CLGMTH1                                                          
*                                                                               
CLGMTH2  DS    0C                                                               
         LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
         USING ABKOLD,R6                                                        
CLGMTH3  GOTO1 VDATCON,DMCB,(2,2(R4)),(3,BOOK)                                  
         CLC   BOOK,=AL2(SEP_01)   OUTSIDE PERIOD IGNORE                        
         BL    MOFMTH                                                           
         MVC   ABKOSTEN,0(R4)                                                   
         MVC   ABKOBK,BOOK                                                      
         AHI   R6,ABKOLDLQ                                                      
         LA    R4,4(R4)                                                         
         CLI   0(R4),X'FF'                                                      
         BNE   CLGMTH3                                                          
         DROP  R6                                                               
*                                                                               
MOFMTH   DS    0C                                                               
         CLC   DBSELMK,=H'4480'                                                 
         BE    *+10                                                             
         CLC   DBSELMK,=H'4481'                                                 
         BE    *+14                                                             
         OC    DBSELMK,DBSELMK                                                  
         BNZ   TORMTHXF                                                         
* ALPHA=MOF IS METERED, DONT HAVE TO CHECK STATION LIST -BPOO 2/08              
         CLC   ABKALFM,=C'MOF'                                                  
         BE    MOFMTH2                                                          
         CLC   ABKALFM,=C'NWK'  CANADIAN NATIONAL IOS MONTHLY                   
         BE    MOFMTH2                                                          
*                                                                               
         LA    RE,BBMMOFL                                                       
MOFMTH1  CLI   0(RE),X'FF'         END OF ALL LISTS                             
         BE    MOFMTHHB            NO CSI MARKET                                
         CLC   CURRCALL(4),0(RE)                                                
         BE    MOFMTH2                                                          
         LA    RE,4(RE)                                                         
         B     MOFMTH1                                                          
*                                                                               
MOFMTHHB DS    0H                                                               
         CLI   ABKSRC,C'A'                                                      
         BNE   TORMTHXF                                                         
*                                                                               
MOFMTH2  DS    0C                                                               
         MVI   MOFMMBBM,C'Y'       GET SETUP LIKE US                            
*                                                                               
TORMTHXF XIT1                                                                   
         DROP  R5                                                               
         EJECT                                                                  
BBMTORL  DC    C'CBLT'                                                          
         DC    C'CFTO'                                                          
         DC    C'CITY'                                                          
         DC    C'CITN'             CITN=CITY                                    
         DC    C'NITY'                                                          
         DC    C'CFMT'                                                          
         DC    C'CFMN'             ALSO CFMT                                    
         DC    C'OMN1'             ALSO CFMT CSI CHANGE JAN27/03                
         DC    C'OMN2'             ALSO CJMT CSI CHANGE JAN27/03                
         DC    C'OMNI'             ALSO CFMT CSI CHANGE JAN27/03                
         DC    C'NFMT'                                                          
*********DC    C'CKCO'                                                          
*********DC    C'CKVR'                                                          
         DC    C'WXTO'             WXTO AND CP24 ARE REALLY THE SAME            
         DC    C'CPNW'             CPNW=CP24                                    
         DC    C'CP24'                                                          
         DC    C'CTS '                                                          
         DC    C'GTOR'                                                          
         DC    C'GLBL'                                                          
         DC    C'ONTV'                                                          
         DC    C'OMNT'                                                          
         DC    C'CHCH'                                                          
         DC    C'CIII'                                                          
         DC    C'CHTV'                                                          
         DC    C'SPNP'             JXTO                                         
         DC    C'TSN '                                                          
         DC    C'WGRZ'                                                          
         DC    C'WIVB'                                                          
         DC    C'WKBW'                                                          
         DC    C'WNED'                                                          
         DC    C'WUTV'                                                          
         DC    C'NUTV'                                                          
         DC    C'TBLT'             CBLT                                         
         DC    C'TFTO'             CFTO                                         
         DC    C'TKVR'             CKVR                                         
         DC    C'WZTO'             WUTV                                         
         DC    C'TOON'                                                          
         DC    C'WTBS'                                                          
         DC    C'YTV '                                                          
         DC    C'MUCH'                                                          
**       DC    C'SUN '                                                          
         DC    C'CKXT'            ADDED BY BPOO 04/07                           
*********DC    X'FF'                                                            
BBMVANL  DC    C'CBUT'                                                          
         DC    C'CHAN'                                                          
         DC    C'CHEK'                                                          
         DC    C'CIVT'                                                          
         DC    C'CTVV'             WAS CIVT CSI CHANGE JAN27/03                 
         DC    C'CIVI'                                                          
         DC    C'CKNO'             WAS TAKEN OUT- ADDED BACK BPOO 04/07         
         DC    C'CKVU'                                                          
         DC    C'KCPQ'                                                          
         DC    C'KCTS'                                                          
         DC    C'KING'                                                          
         DC    C'KIRO'                                                          
         DC    C'KOMO'                                                          
         DC    C'KSTW'                                                          
         DC    C'KVOS'                                                          
         DC    C'NOW '                                                          
         DC    C'CHNU'             NOW ALIAS                                    
         DC    C'CHNM'                                                          
         DC    C'SPNP'             JXVA                                         
         DC    C'TOON'                                                          
         DC    C'TLC '                                                          
         DC    C'WTBS'                                                          
         DC    C'YTV '                                                          
         DC    X'FF'                                                            
*                                                                               
         DS    0F                                                               
*          DATA SET DEGETTP    AT LEVEL 150 AS OF 10/09/02                      
BBMMOFL  DC    C'ARTV'             MONTREAL FRENCH                              
         DC    C'CBFT'                                                          
         DC    C'CD  '                                                          
         DC    C'CFJP'                                                          
         DC    C'CFTM'                                                          
         DC    C'CIVM'                                                          
         DC    C'EVAS'                                                          
         DC    C'HSTA'                                                          
         DC    C'LCN '                                                          
         DC    C'MM  '                                                          
         DC    C'MMAX'                                                          
         DC    C'MP  '                                                          
         DC    C'RDI '                                                          
         DC    C'RDS '                                                          
         DC    C'SERI'                                                          
         DC    C'TOON'                                                          
         DC    C'TV5 '                                                          
         DC    C'VIE '                                                          
         DC    C'VOX '                                                          
         DC    C'Z   '                                                          
* AND DDS CALL LETTERS                                                          
         DC    C'LCD '                                                          
         DC    C'HISF'                                                          
         DC    C'METM'                                                          
         DC    C'MUSI'                                                          
         DS    C'PLUS'                                                          
         DC    C'TVC '                                                          
         DC    C'CANZ'                                                          
         DC    C'TELE'                                                          
         DC    X'FF'                                                            
* AND BBM CALL LETTERS                                                          
BBMMOFLB DC    C'CBMT'                                                          
         DC    C'CFCF'                                                          
*********DC    C'CHLT' OUT 3/9/05                                               
         DC    X'FF'                                                            
BBMCLGL  DC    C'ACCS'                                                          
         DC    C'CBRT'                                                          
         DC    C'CFCN'                                                          
         DC    C'CTVC'             WAS CFCN CSI CHANGE JAN27/03                 
         DC    C'CKAL'                                                          
         DC    C'GLBL'                                                          
         DC    C'CIII'                                                          
         DC    C'KAYU'                                                          
         DC    C'KHQ '                                                          
         DC    C'KREM'                                                          
         DC    C'KSPS'                                                          
         DC    C'KXLY'                                                          
         DC    C'SPNW'                                                          
         DC    C'TLC '                                                          
         DC    C'WTBS'                                                          
         DC    C'YTV '                                                          
* AND DDS CALL LETTERS                                                          
         DC    C'CICT'                                                          
         DC    C'ACCE'                                                          
         DC    X'FF'                                                            
         DS    0F                                                               
         EJECT                                                                  
         DS    0F                                                               
BOSLST   DS    0C                                                               
         DC    C'ATT3'                                                          
         DC    C'CN88'                                                          
         DC    C'NECN'                                                          
         DC    C'NESN'                                                          
         DC    C'WBPX'                                                          
         DC    C'WBZ '                                                          
         DC    C'WCVB'                                                          
         DC    C'WENH'                                                          
         DC    C'WFXT'                                                          
         DC    C'WGBH'                                                          
         DC    C'WGBX'                                                          
         DC    C'WHDH'                                                          
         DC    C'WLVI'                                                          
         DC    C'WMUR'                                                          
         DC    C'WNDS'                                                          
         DC    C'WSBK'                                                          
         DC    X'FF'                                                            
         EJECT                                                                  
* GENERAL LOGIC IS TO SPLIT THE DATES AT THE SWEEP BOOK BOUNDARIES              
* WILL ALLOW LARGE DATE SPANS IF NO INTERVENING BOOKS.                          
BLDSWP   DS    0H                                                               
         BAS   R9,OLYOPT           CHECK OLYMPICS                               
         BAS   R9,OLYAPR                                                        
*                                                                               
         LA    R5,BKLST                                                         
         USING ABKOLD,R5                                                        
BLDSWP1  CLI   ABKOST+ABKOLDLQ,0   ANOTHER SET OF DATES AVAILABLE               
         BE    BLDOUT                                                           
*********CLI   ABKOBK+ABKOLDLQ,0   AND ANOTHER BOOK AVAILABLE                   
*********BE    BLDOUT                                                           
         CLI   ABKOBK,0            NO BOOK TRY NEXT                             
         BE    BLDSWP4                                                          
         CLI   ABKOBK+ABKOLDLQ,0   AND ANOTHER BOOK AVAIL.                      
         BE    BLDOUT                                                           
         CLC   ABKOBK,ABKOBK+ABKOLDLQ  SAME BOOK                                
         BNE   *+12                                                             
         AHI   R5,ABKOLDLQ                                                      
         B     BLDSWP1                                                          
*                                                                               
         CLI   ABKCTRY,C'C'        FOR CANADA ONLY...                           
         BE    BLDSWP4             ...DON'T SEARCH SWEEPTAB                     
*                                                                               
* FIND END DATE OF PREVIOUS SWEEP BOOK                                          
         L     RF,ABKCMFAC                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,SWEEPTBL  GET A(SWEEP TABLE)                           
         ICM   R6,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R2,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
*                                                                               
         USING SWPTABLD,R6                                                      
BLDSWP2  CLI   0(R6),0                                                          
         BE    BLDSWP4                                                          
* FUSION LPM SAME AS NSI WIRED                                                  
         CLI   ABKSRC,C'F'         CHECK FUSION                                 
         BNE   BLDSWP2E                                                         
         OC    SVLPMDTE,SVLPMDTE                                                
         BZ    *+12                                                             
         MVI   MYFMS+2,C'N'                                                     
         B     BLDSWP2E            LPM MKTS ALWAYS USE NSI SWEEPDATES           
                                                                                
* NEW FUSION CODE - SINCE WE HAVE 12 BOOKS DIARY EFFECTIVE 2008                 
* AND SET METERED MKTS ALSO HAVE 12 BOOKS WE SHOULD USE NSI SWEEP DATES         
* FOR FUSION SMM AND DIARY AFTER 2008                                           
         CLI   ABKOBK,X'6C'                                                     
         BL    BLDSWP4                                                          
         MVI   MYFMS+2,C'N'                                                     
*                                                                               
*                                                                               
BLDSWP2E CLC   MYFMS,SWPTFMS                                                    
         BE    *+10                                                             
BLDSWP3  AR    R6,R2                                                            
         B     BLDSWP2                                                          
*                                                                               
         CLC   ABKOBK,SWPTBOOK     COMPARE BOOKS                                
         BNE   BLDSWP3                                                          
         LA    RF,SWPTABLD(R2)     A(NEXT TABLE ENTRY)                          
         CLI   0(RF),0             CHECK FOR TABLE END                          
         BE    BLDSWP4                                                          
*                                                                               
* TERMINATE AT START OF NEXT SWEEP                                              
         LA    RF,SWPTST(R2)       SET START OF NEXT SWEEP                      
         GOTO1 VDATCON,DMCB,(10,(RF)),WORK                                      
         GOTO1 VADDAY,DMCB,WORK,WORK+6,-1                                       
         GOTO1 VDATCON,DMCB,WORK+6,(2,FULL)                                     
         GOTO1 VDATCON,DMCB,WORK,(2,FULL+2)                                     
         LA    RF,SWPTABLD(R2)     A(NEXT TABLE ENTRY)                          
         CLC   SWPTFMS,0(RF)       MAKE SURE IT'S THE SAME SOURCE               
         BE    *+10                                                             
         MVC   FULL(2),=X'FFFF'    IF NOT FORCE A HIGH COMPARE                  
*                                                                               
         ZIC   RE,ABKOBK+1+ABKOLDLQ  MAKE SURE ADJ SWEEPS (THE MONTH)           
         ZIC   RF,ABKOBK+1         ARE AVAILABLE                                
         CR    RE,RF               TAKE CARE OF CROSSING YEARS                  
         BNL   *+8                                                              
         AHI   RE,12               ADD 12 FOR NEXT YEAR                         
         SR    RE,RF                                                            
         CHI   RE,1                ONLY SPLIT THE ADJACENT SWPS                 
         BNH   *+10                                                             
         MVC   FULL(2),=X'FFFF'    OTHERWISE DON'T SPLIT                        
*                                                                               
* DETERMINE END DATE OF THIS SWEEP                                              
*                                  SET END OF THIS SWEEP                        
         GOTO1 VDATCON,DMCB,(10,SWPTST),WORK                                    
         GOTO1 VDATCON,DMCB,WORK,(2,WORK+6)                                     
         CLC   ABKOEN,WORK+6       DATE ENDS BEFORE BOOK STARTS                 
         BL    BLDSWP4                                                          
*                                                                               
         GOTO1 VADDAY,DMCB,WORK,WORK+6,27                                       
         CLI   SWPTWKS,3                                                        
         BNE   BLDSWP3A                                                         
         GOTO1 VADDAY,DMCB,WORK,WORK+6,20                                       
         DROP  R6                                                               
*                                                                               
BLDSWP3A MVC   WORK(6),WORK+6                                                   
         GOTO1 VADDAY,DMCB,WORK,WORK+6,1                                        
         GOTO1 VDATCON,DMCB,WORK,(2,WORK+12)                                    
         CLC   FULL(2),ABKOEN      DO DATES SPAN INTO NEXT SWEEP                
         BL    BLDSWP3B             YES - THEN STOP IT AT NEXT SWEEP            
*                                                                               
         CLC   ABKOEN,WORK+12      IF DATES WIDER THAN BOOK                     
         BH    BLDSWP4             LEAVE ALONE                                  
         MVC   ABKOEN,WORK+12                                                   
         GOTO1 VDATCON,DMCB,WORK+6,(2,ABKOLD+ABKOLDLQ)                          
         B     BLDSWP4                                                          
*                                                                               
BLDSWP3B CLC   ABKOST,FULL         IF THIS SLOT STARTS AFTER SWEEP END          
         BH    BLDSWP4              LEAVE IT ALONE                              
         MVC   ABKOEN,FULL         TRUNCATE AT NEXT SWEEP                       
         MVC   ABKOST+ABKOLDLQ,FULL+2                                           
BLDSWP4  AHI   R5,ABKOLDLQ                                                      
         B     BLDSWP1                                                          
         DROP  R5                                                               
*                                                                               
BLDOUT   MVC   CURRDTES,ABKBDAT                                                 
         MVC   BKLST(2),ABKBDAT    RESET THE START DATE                         
*                                                                               
         LA    R3,BKLST                                                         
BK       USING ABKOLD,R3                                                        
         LA    RF,ABKOLIST                                                      
         USING ABKOLD,RF                                                        
BLDOUT2  XC    ABKOLD(ABKOLDLQ),ABKOLD SET ENTRY TO ZERO                        
         CLI   0(R3),0                                                          
         BE    BLDLPMW                                                          
         CLC   CURRDTES+2(2),BK.ABKOST END LT. START                            
         BL    BLDLPMW                                                          
         CLC   CURRDTES(2),BK.ABKOEN   START GT. END                            
         BH    BLDOUT3                                                          
*                                                                               
         MVC   ABKOLD(ABKOLDLQ),BK.ABKOLD                                       
         CLC   ABKBOOK(3),=C'ACT'                                               
         BNE   BLDOUT2F                                                         
*                                                                               
         CLI   BOOKTYPE,0                                                       
         BNE   SUMOX                                                            
         CLI   ABKMED,C'T'         NOT OLY IF NOT USTV                          
         BNE   SUMOX                                                            
         CLC   =AL2(JUL_96),ABKOBK DEAL WITH SUMMER 1996 OPT                    
         BNE   SUMOX                                                            
*Y2K                                                                            
*                                  IF TOTALLY IN SWEEP LEAVE ALONE              
         CLC   ABKOEN,=X'C107'     AUG07/96                                     
         BH    *+14                                                             
         CLC   ABKOST,=X'C0EA'     JUL10/96                                     
         BNL   SUMOX                                                            
*                                                                               
*                                  OLYMPIC EXCLUSION                            
         CLI   ABKRRTYP,C'I'       FOR AFFIDS                                   
         BNE   SUMO1B                                                           
         CLI   ABKD0PRF+7,C'J'     IF "USE OLYMPIC EXCLUSION" ON                
         BE    *+12                                                             
         CLI   ABKD0PRF+7,C'Y'     IF "USE OLYMPIC EXCLUSION" ON                
         BNE   SUMO1B                                                           
*                                                                               
         MVC   BOOK,ABKOBK                                                      
         BAS   RE,HASOLYEX         IF STATION HAS OLYMP EXCL TAPE               
         BE    SUMOX                                                            
*                                                                               
SUMO1B   DS    0H                                                               
         CLI   ABKD0PRF+6,C'M'     SEND IT TO MAY/96                            
         BNE   *+14                                                             
         MVC   ABKOBK,=AL2(MAY_96)                                              
         B     SUM01OK                                                          
*                                                                               
         CLI   ABKD0PRF+6,C'J'     SEND IT TO JUL/95                            
         BNE   SUMOX                                                            
         MVC   ABKOBK,=AL2(JUL_95)                                              
*                                                                               
*Y2K                                                                            
SUM01OK  CLC   ABKOST,=X'C0EA'     JUL10/96                                     
         BH    SUM02                                                            
         CLC   ABKOEN,=X'C0EA'     JUL10/96                                     
         BNH   SUM02                                                            
*                                                                               
         MVC   ABKOLD+ABKOLDLQ(ABKOLDLQ),ABKOLD                                 
         MVC   ABKOEN,=X'C0EA'     JUL10/96                                     
         AHI   RF,ABKOLDLQ                                                      
         MVC   ABKOST,=X'C0EB'     JUL11/96                                     
         MVC   ABKOBK,=AL2(JUL_96)                                              
         B     SUMOX                                                            
*                                                                               
SUM02    CLC   ABKOEN,=X'C107'     AUG07/96                                     
         BNH   SUMOX                                                            
         CLC   ABKOST,=X'C107'     AUG07/96                                     
         BH    SUMOX                                                            
*                                                                               
         MVC   ABKOLD+ABKOLDLQ(ABKOLDLQ),ABKOLD                                 
         MVC   ABKOEN,=X'C107'     AUG07/96                                     
         MVC   ABKOBK,=AL2(JUL_96)                                              
         AHI   RF,ABKOLDLQ                                                      
         MVC   ABKOST,=X'C108'     AUG08/96                                     
*                                                                               
SUMOX    CLI   ABKBOOK+3,C' '      CAN HAVE A BINARY YEAR                       
         BE    BLDOUT2F                                                         
         OC    ABKOBK,ABKOBK                                                    
         BZ    BLDOUT2F                                                         
         MVC   ABKOBK(1),ABKBOOK+3                                              
*                                                                               
BLDOUT2F AHI   RF,ABKOLDLQ                                                      
*                                                                               
BLDOUT3  AHI   R3,ABKOLDLQ                                                      
         B     BLDOUT2                                                          
         DROP  RF                                                               
         DROP  BK                                                               
         EJECT                                                                  
*******************************************************************             
* EVERY THING IS DONE FOR MONTHLY: NOW BUILD THE LPM WEEKS.       *             
* WE WILL BUILD WEEKLY DATES FROM THE LIST ALREADY BUILT          *             
* FOR MONTHS OR SWEEP PERIODS.                                    *             
*******************************************************************             
BLDLPMW  DS    0C                                                               
         CLI   CABACTIV,C'Y'       NO WEEKS FOR CABLE (FUSION/NSI)              
         BE    EXITX                                                            
         ICM   RE,15,ABKAMKTR      AND A MARKET RECORD GIVEN                    
         USING MKTRECD,RE                                                       
         BZ    EXITX                                                            
*                                                                               
* <------------FOR TESTING                                                      
*********CLC   MKTKMKT,=C'1271'                                                 
*********BNE   *+12                                                             
*********MVI   ABKD0PRF+10,C'Y'                                                 
*********MVI   ABKD0PRF+11,C'Y'                                                 
* <------------END FOR TESTING                                                  
         CLI   ABKD0PRF+15,C'W'    WTP OPTION ?                                 
         BE    *+8                  OR                                          
         CLI   ABKD0PRF+11,C'Y'    DO WE WANT TO USE OVERNIGHT                  
         BE    *+8                  OR                                          
         CLI   ABKD0PRF+11,C'M'    DO WE WANT TO USE OVERNIGHT                  
         BE    *+8                  OR                                          
         CLI   ABKD0PRF+10,C'Y'    DO WE WANT TO USE LPM WEEKLY                 
         BNE   EXITX                NO - JUST EXIT                              
         OC    MKTLPMDT,MKTLPMDT   AND A LPM DATE                               
         BZ    EXITX                                                            
         CLI   IGNRMLPM,C'Y'       IGNORE LPM START DATE IN MARKET REC?         
         BE    EXITX               YES                                          
         DROP  RE                                                               
* ETHNIC BOOKTYPES ALLOWED FOR OVN AND WTP                                      
         CLI   ABKD0PRF+11,C'M'    OVN OPTION ?                                 
         BE    *+8                  OR                                          
         CLI   ABKD0PRF+11,C'Y'    OVN OPTION ?                                 
         BE    *+8                  OR                                          
         CLI   ABKD0PRF+15,C'W'    WTP OPTION ?                                 
         BE    *+8                  OR                                          
         CLI   ABKD0PRF+10,C'Y'    LPMWK OPTION                                 
         BNE   BLDLPMW1            ALLOW WEEKLY POSTING FOR BOOKTYPES           
         CLI   BOOKTYPE,0          STANDARD                                     
         BE    BLDLPMW1                                                         
*&&DO                                                                           
         CLI   BOOKTYPE,C'G'       GENERAL BOOKTYPE                             
         BE    BLDLPMW1            AND                                          
         CLI   BOOKTYPE,C'P'       BOOKTYPE P                                   
         BE    BLDLPMW1            AND                                          
         CLI   BOOKTYPE,0          STANDARD                                     
         BE    BLDLPMW1            AND                                          
*&&                                                                             
         TM    BKTYPIND,SPBKWKLY   IS BOOKTYPE AVAILABLE FOR WEEKLY?            
         BNZ   BLDLPMW1                                                         
* OVERNIGHT BOOKTYPES ALLOWED                                                   
         CLI   ABKD0PRF+11,C'M'    OVN OPTION ?                                 
         BE    *+8                                                              
         CLI   ABKD0PRF+11,C'Y'    OVN OPTION ?                                 
         BNE   EXITX               OR                                           
*&&DO                                                                           
         CLI   BOOKTYPE,C'H'                                                    
         BE    BLDLPMW1                                                         
         CLI   BOOKTYPE,C'L'                                                    
         BE    BLDLPMW1                                                         
         CLI   BOOKTYPE,C'J'                                                    
         BNE   EXITX                                                            
*&&                                                                             
         TM    BKTYPIND,SPBKOVN    BOOKTYPE AVAILABLE FOR OVERNIGHT?            
         BZ    EXITX                                                            
         B     BLDLPMW1                                                         
*                                                                               
BLDLPMW1 LA    R5,MYDBLK           VALIDATE STATION/BOOK                        
         USING DBLOCK,R5                                                        
         XC    0(250,R5),0(R5)                                                  
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         CLI   ABKD0PRF+11,C'M'    DO WE WANT TO USE OVERNIGHTS                 
         BE    *+8                  NO - DON'T LOOK FOR IT                      
         CLI   ABKD0PRF+11,C'Y'    DO WE WANT TO USE OVERNIGHTS                 
         BNE   LPMFILE              NO - DON'T LOOK FOR IT                      
         MVC   DBFILE,=C'TP '                                                   
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELMED,C'O'                                                    
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL                                                
         CLI   DBSELSTA+4,X'40'                                                 
         BH    *+8                                                              
         MVI   DBSELSTA+4,C'T'                                                  
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
*********MVC   DBSELAGY,=C'SJ'     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
*********MVC   DBSELBK,=X'690D'                                                 
*********MVC   DBSELSRC,ABKSRC                                                  
*********MVC   DBSELDAT,=X'7001'                                                
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
*                                                                               
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
*                                                                               
         MVC   OVRLAST,DBACTBK                                                  
         CLI   DBERROR,NOTFOUND    FOUND STATION FOR BOOK                       
         BNE   LPMFILE                                                          
         MVC   OVRLAST,=X'640D'                                                 
* SAVE THE OVERNIGHT BOOK HERE IF IT'S FOUND                                    
         DROP  R5                                                               
*                                                                               
LPMFILE  LA    R5,MYDBLK           VALIDATE STATION/BOOK                        
         USING DBLOCK,R5                                                        
         XC    0(250,R5),0(R5)                                                  
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         MVC   DBFILE,=C'TP '                                                   
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELMED,C'W'                                                    
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL                                                
         CLI   DBSELSTA+4,X'40'                                                 
         BH    *+8                                                              
         MVI   DBSELSTA+4,C'T'                                                  
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
*********MVC   DBSELSRC,ABKSRC                                                  
         MVC   DBSELDAT,=X'8001'                                                
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         MVC   WEEKLAST,DBACTBK    SET LAST WEEKLY BOOK                         
         MVC   SVDBERR,DBERROR     SAVE DBERROR                                 
*                                                                               
         CLI   DBERROR,X'11'       WEEKLY NOT AUTHORIZED                        
         BNE   *+14                                                             
         MVC   WEEKLAST,=X'6001'                                                
         B     LPMFILE2                                                         
*                                                                               
*READ FOR THE FILE ONE MORE TIME FOR THE LAST BOOK +1 (1 WEEK FURTHER)          
*TO SEE IF WE FOUND ANYTHING ELSE.  WE FOUND A RECORD THEN THERE MUST           
*SOME EQUILVENCE GOING ON.                                                      
         XC    0(250,R5),0(R5)                                                  
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         MVC   DBFILE,=C'TP '                                                   
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELMED,C'W'                                                    
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL                                                
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELDAT,=X'8001'                                                
         ZIC   RE,WEEKLAST+1       NEXT WEEK                                    
         LA    RE,1(RE)                                                         
         MVC   DBSELBK,WEEKLAST                                                 
         STC   RE,DBSELBK+1                                                     
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         CLI   DBERROR,0                                                        
         BNE   LPMFILE1                                                         
*                                                                               
* GET LATEST BOOK FOR EQUIVALENCE STATION  FOR WEEKLY                           
*                                                                               
         MVC   SVACTSTA,DBACTSTA                                                
         XC    0(250,R5),0(R5)                                                  
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         MVC   DBFILE,=C'TP '                                                   
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELMED,C'W'                                                    
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,SVACTSTA                                                
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELDAT,=X'8001'                                                
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         CLI   DBERROR,0                                                        
         BNE   LPMFILOV                                                         
         MVC   WEEKLST2,DBACTBK                                                 
         CLC   WEEKLST2,WEEKLAST                                                
         BNH   *+10                                                             
         MVC   WEEKLAST,WEEKLST2                                                
*****************************************************************               
* GET LATEST BOOK FOR EQUIVALENCE STATION  FOR OVERNIGHTS                       
LPMFILOV XC    0(250,R5),0(R5)                                                  
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         MVC   DBFILE,=C'TP '                                                   
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELMED,C'O'                                                    
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,SVACTSTA                                                
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELDAT,=X'8001'                                                
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
         CLI   DBERROR,0                                                        
         BNE   LPMFILE1                                                         
         MVC   WEEKLST2,DBACTBK                                                 
         CLC   DBACTBK,OVRLAST                                                  
         BNH   *+10                                                             
         MVC   OVRLAST,DBACTBK                                                  
*****************************************************************               
LPMFILE1 CLI   ABKD0PRF+11,C'Y'    DO WE WANT TO USE OVERNIGHTS                 
         BE    *+8                  YES - WE ARE OK                             
         CLI   ABKD0PRF+11,C'M'    DO WE WANT TO USE OVERNIGHTS                 
         BE    *+10                 YES - WE ARE OK                             
         MVC   OVRLAST,WEEKLAST    SET TO STOP AT WEEKLY LAST                   
         MVC   DBERROR,SVDBERR      RESTORE DBERROR                             
*                                                                               
* WE ONLY WANT TO USE WEEKS THAT HAVE ALL SEVEN DAYS AVAILABLE IF THE           
* USER IS ALSO DOING OVERNIGHTS. THE WEEKLY DATA WEEK FROM NSI IS               
* SAT-FRI WHILE THE BROADCAST WEEK IS MON-SUN SO WE KILL THE LAST               
* WEEKLY BOOK SINCE WE DO HAVE OVERNITE DATA.                                   
         CLI   ABKD0PRF+11,C'M'    DO WE WANT TO USE OVERNIGHTS                 
         BE    *+8                   NO - USE THE LAST PARTIAL WEEK             
         CLI   ABKD0PRF+11,C'Y'    DO WE WANT TO USE OVERNIGHTS                 
         BNE   LPMFILE2              NO - USE THE LAST PARTIAL WEEK             
         ZIC   RF,WEEKLAST+1         YES - USE THE LAST FULL WEEK               
         BCTR  RF,0                                                             
         STC   RF,WEEKLAST+1                                                    
         CLI   WEEKLAST+1,0        0 HERE SAYS LAST WEEK OF PREV YEAR           
         BNE   LPMFILE2                                                         
*                                                                               
         ZIC   RF,WEEKLAST SO DECREMENT THE YEAR                                
         BCTR  RF,0                                                             
         STC   RF,WEEKLAST                                                      
         MVI   WEEKLAST+1,52       AND FORCE TO LAST WEEK                       
* SAVE THE LAST FULL WEEK                                                       
         MVC   WEEKLAST,DBACTBK    SET LAST WEEKLY BOOK                         
*<----   CLI   ABKD0PRF+11,C'Y'     DO WE WANT TO USE OVERNIGHTS                
*<----   BE    *+10                 YES - WE ARE OK                             
*<----   MVC   OVRLAST,WEEKLAST     SET TO STOP AT WEEKLY LAST                  
*                                                                               
LPMFILE2 CLI   DBERROR,NOTFOUND    FOUND STATION FOR BOOK                       
         BE    EXITX                                                            
         DROP  R5                                                               
*                                                                               
         LA    RE,BKLST            CLEAR INTERMEDIATE AREA                      
         LHI   RF,L'BKLST                                                       
         XCEF                                                                   
*                                                                               
         LA    R4,BKLST            AND SET UP POINTERS                          
         USING ABKOLD,R4                                                        
         LA    R9,ABKOLIST                                                      
LPM      USING ABKOLD,R9                                                        
*                                                                               
BLDLPMW2 DS    0H                  REFORMAT DATES FOR CURRENT SLOT              
         GOTO1 VDATCON,DMCB,(2,LPM.ABKOST),WORK                                 
         GOTO1 VDATCON,DMCB,(2,LPM.ABKOEN),WORK+6                               
*                                  CREATE WEEKLY DATES FROM START               
         XC    MONLST,MONLST                                                    
         LA    R3,MONLST           POINT TO NEXT AVAILABLE SLOT                 
         XC    DMCB(24),DMCB                                                    
         GOTO1 ABKMOBIL,DMCB,(6,WORK),(5,0(R3)),ABKMOBP                         
*                                                                               
*        BUILD A NEW LIST OF WEEKLY DATES                                       
BLDLPMW4 CLI   0(R3),X'FF'                                                      
         BE    BLDLPMW6                                                         
         MVC   ABKOLD(ABKOLDLQ),LPM.ABKOLD                                      
         MVC   ABKOSTEN,0(R3)                                                   
         LA    R3,4(R3)                                                         
         AHI   R4,ABKOLDLQ                                                      
*********MVI   0(R4),X'FF'                                                      
         B     BLDLPMW4                                                         
*                                                                               
BLDLPMW6 DS    0C                                                               
         AHI   R9,ABKOLDLQ                                                      
         CLI   0(R9),0                                                          
         BNE   BLDLPMW2                                                         
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
*              WEEKLY DATES ARE NOW BUILT - ASSIGN THE BOOKS                    
***********************************************************************         
* FIRST CHECK THAT THERE ARE NO OVERLAPS                                        
* WILL POTENTIALLY OCCUR WHEN SWITCHING FROM MONTHLY TO WEEKLY AND              
* SWEEP PERIOD EXTENDS INTO FIRST WEEK                                          
*                                                                               
         LA    R3,BKLST                                                         
         USING ABKOLD,R3                                                        
WKDTCHK  CLI   ABKOLD+ABKOLDLQ,0   NEXT IS EOL                                  
         BE    WKDTCHKX            DONE WITH THIS PHASE                         
         CLC   ABKOEN,ABKOLD+ABKOLDLQ  END LESS THAN NEXT START                 
         BL    WKDTCHK2            IT'S OK                                      
         BH    WKDTCHK1                                                         
*                                                                               
*     SET END DATE TO START OF NEXT-1                                           
         GOTO1 VDATCON,DMCB,(2,ABKOLD+ABKOLDLQ),WORK                            
         LHI   R9,-1                                                            
         GOTO1 VADDAY,DMCB,WORK,WORK,(R9)                                       
         GOTO1 VDATCON,DMCB,WORK,(2,ABKOEN)                                     
         B     WKDTCHK2                                                         
*                                                                               
*     SET NEXT START DATE TO END+1                                              
WKDTCHK1 GOTO1 VDATCON,DMCB,(2,ABKOEN),WORK                                     
         LHI   R9,1                                                             
         GOTO1 VADDAY,DMCB,WORK,WORK,(R9)                                       
         GOTO1 VDATCON,DMCB,WORK,(2,ABKOLD+ABKOLDLQ)                            
WKDTCHK2 AHI   R3,ABKOLDLQ                                                      
         B     WKDTCHK                                                          
*                                                                               
WKDTCHKX LA    R3,BKLST            RESET START FOR NEXT PHASE                   
BLDWKBK  XC    DMCB(6*4),DMCB                                                   
         GOTO1 VDATCON,DMCB,(2,ABKOST),WORK                                     
         GOTO1 VDATCON,DMCB,(2,ABKOST),(3,THREE)                                
         MVI   BYTE,0              SET START DAY TO SAT(DEFAULT)                
         GOTO1 ABKNSIWK,DMCB,WORK,(BYTE,ABKGTDAY),VADDAY,VDATCON                
*                                                                               
         CLC   THREE(2),SVLPMDTE   BEFORE WEEKLY DON'T SET                      
         BL    BLDWKBK2                                                         
         MVC   ABKOBKW+1(1),0(R1)  WEEK                                         
         MVC   ABKOBKW(1),4(R1)    YEAR                                         
         CLC   WEEKLAST,ABKOBKW    IN RANGE - SET FOR WEEKLY                    
         BNL   BLDWKBK2                                                         
         CLC   OVRLAST,ABKOBKW     HAVE OVERNIGHT - SET FLAG                    
         BL    BLDWKO1                                                          
*                                                                               
* FOR OVERNIGHT CALC WEEK BASED ON MONDAY                                       
         GOTO1 VDATCON,DMCB,(2,ABKOST),WORK                                     
*********GOTO1 VDATCON,DMCB,(2,ABKOST),(3,THREE) DEIS SAYS THIS DOESN'T         
*                                                 ...DO ANYTHING!               
         MVI   BYTE,1              SET START DAY TO MONDAY                      
         GOTO1 ABKNSIWK,DMCB,WORK,(BYTE,ABKGTDAY),VADDAY,VDATCON                
         MVC   HALF(1),4(R1)       SAVE IT IN 'HALF'                            
         MVC   HALF+1(1),0(R1)                                                  
         CLC   OVRLAST,HALF        AND MAKE SURE WE STILL HAVE IT               
         BL    BLDWKO1                                                          
* IF THERE IS AN EFFECTIVE OVERNIGHT BOOK DEFINED IN TABLE                      
* THEN ANY BOOKS BEFORE EFFECTIVE BOOK IS NOT AVAILABLE                         
         OC    OVEFFBK,OVEFFBK                                                  
         BZ    *+14                                                             
         CLC   OVEFFBK,HALF                                                     
         BH    BLDWKO1                                                          
*                                                                               
         MVC   ABKOBKW+1(1),0(R1)  WEEK                                         
         MVC   ABKOBKW(1),4(R1)    YEAR                                         
         OI    ABKOBT,X'80'                                                     
         B     BLDWKBK2                                                         
BLDWKO1  XC    ABKOBKW,ABKOBKW     OTHERWISE CLEAR THE WEEK                     
*                                                                               
BLDWKBK2 DS    0C                                                               
*  NEW CODE TO FIX SPONSOR SUMMARY WHERE WE SHOW WHETHER                        
*  WE POSTED WEEKLY/OVERNITE/BUYER.  IF WE ASK ONLY FOR OVERNIGHTS              
*  WE ALWAYS WILL POST OFF OVERNITE - SHOW TURN ON OVERNIGHT X'80'              
*  INDICATOR IN ACT TABLE ENTRIES.                                              
         CLI   ABKD0PRF+15,C'W'    WTP OPTION ?                                 
         BE    BLDWKBK3                                                         
         CLI   ABKD0PRF+10,C'Y'    LPM WEEKLY                                   
         BE    BLDWKBK3                                                         
         CLI   ABKD0PRF+11,C'M'    OVERNIGHT FOR LPM                            
         BE    *+8                                                              
         CLI   ABKD0PRF+11,C'Y'    OVERNIGHT                                    
         BNE   *+8                                                              
         OI    ABKOBT,X'80'                                                     
* IF THERE IS AN EFFECTIVE OVERNIGHT BOOK DEFINED IN TABLE                      
* THEN ANY BOOKS BEFORE EFFECTIVE BOOK IS NOT AVAILABLE                         
         OC    OVEFFBK,OVEFFBK                                                  
         BZ    BLDWKBK3                                                         
         CLC   OVEFFBK,ABKOBKW                                                  
         BNH   BLDWKBK3                                                         
         XC    ABKOBKW,ABKOBKW                                                  
         NI    ABKOBT,X'FF'-X'80'                                               
*                                                                               
BLDWKBK3 AHI   R3,ABKOLDLQ                                                      
         CLI   0(R3),0                                                          
         BNE   BLDWKBK                                                          
         DROP  R3                                                               
***********************************************************************         
*              MOVE THIS TO THE OUTPUT AREA                                     
         LA    RF,ABKOLIST                                                      
         LA    RE,BKLST                                                         
         LHI   R1,L'BKLST                                                       
*                                                                               
         MOVE  ((RF),(R1)),(RE)                                                 
         LA    RF,ABKOLIST                                                      
* DEIS SAYS THIS NEXT INSTRUCTION IS SUSPECT. THERE IS SOME CONFUSION           
* REGARDING THE LENGTH OF THIS DATA STRUCTURE, AND THIS INSTRUCTION IS          
* CLEARLY MEANT TO CLEAR OUT THE LAST ENTRY IN THE TABLE. THE QUESTION          
* IS: HOW LONG IS THE TABLE?                                                    
         XC    594(ABKOLDLQ,RF),594(RF)                                         
*                                                                               
*****************************                                                   
***NEED TO FIND THE WEEKLY BOOKS AND TRANSFER TO OUTPUT LIST                    
***************************                                                     
         B     EXITX                                                            
***********************                                                         
         EJECT                                                                  
OLYOPT   L     RE,J88PTR           JAN USING FEB ALWAYS TO NOV/91               
         LTR   RE,RE                                                            
         BZ    OLYOPT2                                                          
*                                                                               
         CLC   4(2,RE),=AL2(FEB_10) ONLY IF FEB/10                              
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(NOV_09) USE NOV/09                                  
         CLC   4(2,RE),=AL2(FEB_06) ONLY IF FEB/06                              
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(NOV_05) USE NOV/05                                  
         CLC   4(2,RE),=AL2(FEB_02) ONLY IF FEB/02                              
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(NOV_01) USE NOV/01                                  
         CLC   4(2,RE),=AL2(FEB_98) ONLY IF FEB/98                              
         BNE   OLYOPT2                                                          
         MVC   4(2,RE),=AL2(NOV_97) USE NOV/97                                  
         CLC   4(2,RE),=AL2(FEB_94) ONLY IF FEB/94                              
         BNE   OLYOPT2                                                          
         MVC   4(2,RE),=AL2(NOV_93) USE NOV/93                                  
         CLC   4(2,RE),=AL2(FEB_92) ONLY IF FEB/92                              
         BNE   OLYOPT2                                                          
         MVC   4(2,RE),=AL2(NOV_91) USE NOV/91                                  
         CLI   ABKOPT1,C'1'                                                     
         BNE   OLYOPT2                                                          
*---->   MVC   4(2,RE),=AL2(FEB_92)                                             
         MVC   4(2,RE),=AL2(FEB_94)                                             
*                                                                               
OLYOPT2  L     RE,M88PTR                                                        
         LTR   RE,RE                                                            
         BZR   R9                  NO MARCH JUST EXIT                           
*                                                                               
         CLC   4(2,RE),=AL2(FEB_92) TRYING TO DO FEB/92                         
         BNE   OLYOPT24                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BE    *+8                                                              
         CLI   SVMENUTY,ACTFORCE   WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/92 OR NOV/91                      
         MVC   4(2,RE),=AL2(NOV_91) YES - USE NOV/91                            
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=AL2(FEB_92)                                             
         BR    R9                                                               
*                                                                               
OLYOPT24 CLC   4(2,RE),=AL2(FEB_94) TRYING TO DO FEB/94                         
         BNE   OLYOPT28                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BE    *+8                                                              
         CLI   SVMENUTY,ACTFORCE   WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/94 OR NOV/93                      
         MVC   4(2,RE),=AL2(NOV_93) YES - USE NOV/93                            
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=AL2(FEB_94)                                             
         BR    R9                                                               
*                                                                               
OLYOPT28 CLC   4(2,RE),=AL2(FEB_98) TRYING TO DO FEB/98                         
         BNE   OLYOPT29                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
*********BE    *+8                  TAKEN OUT 7/28/98 PER LISA                  
         BNE   OLYOPT3              PUT IN 7/28/98 PER LISA                     
         CLI   SVMENUTY,ACTFORCE     WAS IT A FORCE                             
         BNE   OLYOPT3             SELECT JAN/98 OR NOV/97                      
         MVC   4(2,RE),=AL2(NOV_97) YES - USE NOV/97                            
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=AL2(FEB_98)                                             
         BR    R9                                                               
*                                                                               
OLYOPT29 CLC   4(2,RE),=AL2(FEB_02) TRYING TO DO FEB/02                         
         BNE   OLYOPT2A                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BNE   OLYOPT3                                                          
         CLI   SVMENUTY,ACTFORCE   WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/98 OR NOV/97                      
         MVC   4(2,RE),=AL2(NOV_01) YES - USE NOV/01                            
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=AL2(FEB_02)                                             
         BR    R9                                                               
*                                                                               
OLYOPT2A CLC   4(2,RE),=AL2(FEB_06) TRYING TO DO FEB/06                         
         BNE   OLYOPT2B                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BNE   OLYOPT3                                                          
         CLI   SVMENUTY,ACTFORCE   WAS IT A FORCE                               
         BNE   OLYOPT3                                                          
         MVC   4(2,RE),=AL2(NOV_05) YES - USE NOV/05                            
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=AL2(FEB_06)                                             
         BR    R9                                                               
*                                                                               
OLYOPT2B CLC   4(2,RE),=AL2(FEB_10) TRYING TO DO FEB/10                         
         BNER  R9                                                               
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BNE   OLYOPT3                                                          
         CLI   SVMENUTY,ACTFORCE   WAS IT A FORCE                               
         BNE   OLYOPT3                                                          
         MVC   4(2,RE),=AL2(NOV_09) YES - USE NOV/09                            
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=AL2(FEB_10)                                             
         BR    R9                                                               
*                                                                               
OLYOPT3  LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         CLI   4(RE),YR_1994       1994 OPTION                                  
         BE    OLYOPT34                                                         
         CLI   4(RE),YR_2002       2002 OPTION                                  
         BE    OLYOPT39                                                         
         CLI   4(RE),YR_2006       2006 OPTION                                  
         BE    OLYOPT3A                                                         
         CLI   4(RE),YR_2010       2010 OPTION                                  
         BE    OLYOPT3B                                                         
         CLI   4(RE),YR_1998       1998 OPTION                                  
         BE    OLYOPT38                                                         
         CLI   MYFMS+2,C'A'                                                     
         BNE   *+8                                                              
         LA    RF,ARBJAN92                                                      
         MVC   4(2,RE),=AL2(NOV_91) PRESET TO NOV/91                            
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(FEB_92) PRESET TO FEB/92                            
         B     OLYOPT4                                                          
*                                                                               
OLYOPT34 LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=AL2(NOV_93) PRESET TO NOV/93                            
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(FEB_94) PRESET TO FEB/94                            
         B     OLYOPT4                                                          
*                                                                               
OLYOPT38 LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=AL2(NOV_97) PRESET TO NOV/97                            
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(FEB_98) PRESET TO FEB/98                            
         B     OLYOPT4                                                          
*                                                                               
OLYOPT39 LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=AL2(NOV_01) PRESET TO NOV/01                            
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(FEB_02) PRESET TO FEB/02                            
         B     OLYOPT4                                                          
*                                                                               
OLYOPT3A LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=AL2(NOV_05) PRESET TO NOV/05                            
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(FEB_06) PRESET TO FEB/06                            
         B     OLYOPT4                                                          
*                                                                               
OLYOPT3B LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=AL2(NOV_09) PRESET TO NOV/09                            
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=AL2(FEB_10) PRESET TO FEB/10                            
         B     OLYOPT4                                                          
*                                                                               
OLYOPT4  CLC   0(2,RF),=X'FFFF'                                                 
         BER   R9                                                               
         CLC   OLYMKT,0(RF)                                                     
         BE    OLYOPT6                                                          
         LA    RF,2(RF)                                                         
         B     OLYOPT4                                                          
*                                                                               
*LYOPT6  MVC   4(2,RE),=AL2(JAN_92)  HAVE A JAN BOOK - USE IT                   
*LYOPT6  MVC   4(2,RE),=AL2(JAN_94)  HAVE A JAN BOOK - USE IT                   
*LYOPT6  MVC   4(2,RE),=AL2(JAN_98)  HAVE A JAN BOOK - USE IT                   
*LYOPT6  MVC   4(2,RE),=AL2(JAN_02)  HAVE A JAN BOOK - USE IT                   
*OYOPT6  MVC   4(2,RE),=AL2(JAN_06)  HAVE A JAN BOOK - USE IT                   
OLYOPT6  MVC   4(2,RE),=AL2(JAN_10)  HAVE A JAN BOOK - USE IT                   
         BR    R9                                                               
*                                                                               
OLYAPR   L     RE,M88PTR           SOME TABLES SEND APR TO FEB                  
         LTR   RE,RE                                                            
         BZR   R9                                                               
OLYAPR2  CLI   0(RE),0             END OF LIST                                  
         BER   R9                                                               
*                                                                               
         CLC   =AL2(FEB_10),4(RE)  FEB/10 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   =AL2(FEB_06),4(RE)  FEB/06 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   =AL2(FEB_02),4(RE)  FEB/02 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   =AL2(FEB_98),4(RE)  FEB/98 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   =AL2(FEB_94),4(RE)  FEB/94 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   =AL2(FEB_92),4(RE)  FEB/92 BOOK NEEDS AN OVERRIDE                
         BNE   *+14                                                             
         L     RF,M88PTR           USE THE MARCH BOOK FOR THIS                  
         MVC   4(2,RE),4(RF)                                                    
         AHI   RE,ABKOLDLQ                                                      
         B     OLYAPR2                                                          
         EJECT                                                                  
***********************************************************************         
*=============== CHECK IF STATION HAS OLYMPIC EXCLUSION ==============*         
*                                                                               
* AT ENTRY,                                                                     
*   CURRCALL = STATION CALL LETTERS                                             
*   BOOK     = BOOK TO LOOK UP FOR STATION                                      
* AT EXIT,                                                                      
*   CCEQUAL  ==> STATION HAS OLYM EXLC TAPE                                     
*   CCNEQUAL ==> ALL OTHER CONDITIONS                                           
*                                                                               
HASOLYEX NTR1                                                                   
         LA    R5,MYDBLK                                                        
         USING DBLOCK,R5                                                        
         XC    DBLOCK,DBLOCK                                                    
*                                                                               
         MVC   DBSELBK,BOOK        SET BOOK                                     
*                                                                               
         CLI   ABKMED,C'T'                                                      
         BNE   HASOXX                                                           
         MVC   DBSELMED,ABKMED     SET MEDIA                                    
*                                                                               
         MVI   DBSELSRC,C'N'       ASSUME NIELSEN                               
         CLI   ABKSRC,C'N'         SET TO NIELSEN?                              
         BE    *+16                 YES                                         
         CLI   DBSELBK,YR_1994      NO, SET TO ARBITRON                         
         BNL   *+8                  UNLESS BOOK >= 1994                         
         MVI   DBSELSRC,C'A'                                                    
*                                                                               
         MVC   DBFILE,=C'TP '      SET FILE                                     
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL   SET STATION                                  
         MVC   DBSELAGY,ABKAGY     SET AGENCY                                   
         MVC   DBSELCLI,ABKCLT     SET CLIENT                                   
         MVI   DBBTYPE,C'O'        LOOK FOR OLYMP EXCL TAPE                     
         OI    DBVOPT,X'40'        INDICATE SPOT POSTING                        
         MVI   DBFUNCT,DBVLSTBK    VALIDATE STTN/BOOK                           
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC           SET ADDRESS OF I/O AREA                      
         GOTO1 VDEMAND,DMCB,MYDBLK,0                                            
*                                                                               
HASOXX   DS    0H                                                               
         CLI   DBERROR,0           X'00' ==> STATION HAS OLYM EXCL TAPE         
         XIT1                                                                   
         DROP  R5                                                               
***********************************************************************         
         EJECT                                                                  
RLHOOK   NTR1                      FLAG ACTIVE RADIO BOOKS                      
         USING DBLOCK,R5                                                        
*                                                                               
         CLC   DBACTKMK,=H'269'    MCALLEN DROPPED BOOKS                        
         BNE   *+12                                                             
         MVI   RADBOOK,RDBK_MAY+RDBK_NOV                                        
         B     RLHOOKX                                                          
*                                                                               
         OC    SVPPMLBK,SVPPMLBK          IS THIS A PPM MARKET?                 
         BZ    RLHOOK50                                                         
         CLC   DBACTBK,SVPPMLBK                                                 
         BL    *+8                                                              
         MVI   PPMBKFLG,LOAD_YES           LIVE PPM BOOK LOADED                 
*                                                                               
*                                                                               
RLHOOK50 CLI   DBACTBK+1,MON_FEB                                                
         BNE   *+8                                                              
         OI    RADBOOK,RDBK_FEB                                                 
*                                                                               
         CLI   DBACTBK+1,MON_MAY                                                
         BNE   *+8                                                              
         OI    RADBOOK,RDBK_MAY                                                 
*                                                                               
         CLI   DBACTBK+1,MON_JUL                                                
         BNE   *+8                                                              
         OI    RADBOOK,RDBK_JUL                                                 
*                                                                               
         CLI   DBACTBK+1,MON_NOV                                                
         BNE   *+8                                                              
         OI    RADBOOK,RDBK_NOV                                                 
*                                                                               
RLHOOKX  XIT1                                                                   
         DROP  R5                                                               
         SPACE 2                                                                
RDBK_FEB EQU   X'80'                                                            
RDBK_MAY EQU   X'40'                                                            
RDBK_JUL EQU   X'20'                                                            
RDBK_NOV EQU   X'10'                                                            
*                                                                               
RDBK_MAY4JUL   EQU   X'04'       USE MAY FOR JUL                                
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
* TABLE OF NSI ATLANTA STATIONS FOR OCT/92 MISSING BOOK                         
ATLSTA   DC    C'WAGA'                                                          
         DC    C'WATL'                                                          
         DC    C'WGNX'                                                          
         DC    C'WGTV'                                                          
         DC    C'WPBA'                                                          
         DC    C'WSB '                                                          
         DC    C'WTBS'                                                          
         DC    C'WVEU'                                                          
         DC    C'WXIA'                                                          
         DC    X'FF'                                                            
         SPACE 3                                                                
* THESE TABLES ARE USED FOR RADIO ACTUAL BOOKS                                  
* LIMITS MUST BE SET FOR BOOKS EVEN THOUGH LATEST IS USED TO                    
* DETERMINE WHICH BOOKS APPLY.                                                  
* IDEA IS TO PASS BACK LATEST BOOK AVAILABLE AT THE TIME OF THE                 
* POST                                                                          
*                                                                               
* THE INTENT OF THIS TABLE IS TO FIGURE OUT HOW A MARKET IS SWEPT               
* AND DEPENDED ON THE WAY THE NUMBER OF TIMES A MARKET IS SWEPT                 
* WE WILL USE CERTAIN BOOKS FOR LOOKUPS                                         
*                                                                               
RADFILT  DC    0CL13                                                            
         DC    AL1(RDBK_JUL)                                                    
         DC    AL1(07,07,07,07,07,07,07,07,07,07,07,07)                         
         DC    AL1(RDBK_MAY)                                                    
         DC    AL1(05,05,05,05,05,05,05,05,05,05,05,05)                         
         DC    AL1(RDBK_MAY+RDBK_NOV)                                           
         DC    AL1(11,11,11,05,05,05,05,05,05,11,11,11)                         
         DC    AL1(RDBK_MAY+RDBK_JUL+RDBK_NOV)                                  
         DC    AL1(11,11,11,05,05,05,07,07,07,11,11,11)                         
         DC    AL1(RDBK_FEB+RDBK_MAY+RDBK_JUL+RDBK_NOV)                         
         DC    AL1(02,02,02,05,05,05,07,07,07,11,11,11)                         
         DC    AL1(RDBK_FEB+RDBK_MAY+RDBK_MAY4JUL+RDBK_NOV)                     
         DC    AL1(02,02,02,05,05,05,05,05,05,11,11,11)                         
****THE FOLLOWING ENTRIES COVER NEW STATIONS WITH INCOMPLETE DATA               
         DC    AL1(RDBK_NOV)                                                    
         DC    AL1(11,11,11,00,00,00,00,00,00,11,11,11)                         
         DC    AL1(RDBK_JUL+RDBK_NOV)                                           
         DC    AL1(11,11,11,00,00,00,07,07,07,11,11,11)                         
         DC    AL1(RDBK_MAY+RDBK_JUL)                                           
         DC    AL1(00,00,00,05,05,05,07,07,07,00,00,00)                         
         DC    AL1(RDBK_FEB)                                                    
         DC    AL1(02,02,02,02,02,02,02,02,02,02,02,02)                         
         DC    AL1(RDBK_FEB+RDBK_JUL+RDBK_NOV)                                  
         DC    AL1(02,02,02,00,00,00,07,07,07,11,11,11)                         
         DC    AL1(RDBK_FEB+RDBK_NOV)                                           
         DC    AL1(02,02,02,00,00,00,00,00,00,11,11,11)                         
         DC    AL1(RDBK_FEB+RDBK_MAY+RDBK_NOV)                                  
         DC    AL1(02,02,02,05,05,05,00,00,00,11,11,11)                         
         DC    X'FF'                                                            
         EJECT                                                                  
***********************************************************************         
* TABLE TO OVERRIDE THE RADFILT TABLE ABOVE                                     
* WHEN A MARKET CHANGES THE WAY IT IS SWEPT.                                    
* FOR EXAMPLE LANSING CHANGED FROM 4 TIMES A YEAR SWEEP TO ONLY                 
* BEING SWEPT 2 TIMES A YEAR IN 2012.  SO POSTS IN 2012 WILL BE                 
* STILL REFLECT  4 TIMES A YEAR SWEEP BECAUSE OUR CODE READS THE 5              
* LATEST BOOKS LOADED ON A FILE TO DETERMINE WHAT MONTHS ARE SWEPT              
* FOR A MARKET - THIS IS STORE INTO RADBOOK.  THE FOLLOWING                     
* EQUATES ARE OR CHARACTERED INTO RADBOOK WHEN FOUND IN RLHOOK:                 
* RDBK_FEB EQU   X'80'                                                          
* RDBK_MAY EQU   X'40'                                                          
* RDBK_JUL EQU   X'20'                                                          
* RDBK_NOV EQU   X'10'                                                          
* RDBK_MAY4JUL   EQU   X'04'                                                    
*                                                                               
* THIS TABLE WILL LIST THE MARKET, EFFECTIVE YEAR/MONTH WHEN SWEEP              
* CLASSIFICATION CHANGES, THE MONTHS SWEEP EFFECTIVE YR SPECIFIED               
*                                                                               
* IF WE HAVE MORE THAN ONE CLASSIFICATION CHANGE FOR AN ALPHA MARKET            
* IT IS IMPORTANT TO ADD TO THE END-OF-LIST.                                    
*                                                                               
* OUR EXAMPLE OF GAINSVILLE BEGINS IN THE MIDDLE OF 2012 WHERE WE               
* ALREADY HAVE THE FEB AND MAY BOOKS.  THEY WILL HAVE A NOV BOOK BUT            
* NOT A JUL BOOK.  AFTER THAT (2013), IT WILL BE LIKE LANSING WHERE             
* IT'LL JUST BE  MAY AND NOV BOOKS.  THIS IS WHY WE HAVE 2 ENTRIES              
***********************************************************************         
RADFILT_NEG  DS 0XL6                                                            
         DC    C'LNS',AL1(YR_2011),AL1(01)  EFFECTIVE                           
         DC    AL1(RDBK_MAY+RDBK_NOV)                                           
         DC    C'GAN',AL1(YR_2012),AL1(07)  GAN CHG IN MID 2012                 
         DC    AL1(RDBK_FEB+RDBK_MAY+RDBK_MAY4JUL+RDBK_NOV)                     
         DC    C'GAN',AL1(YR_2013),AL1(01)  GAN SWEEPS LIKE LNS IN 2013         
         DC    AL1(RDBK_MAY+RDBK_NOV)                                           
*                                                                               
*  YRK AND SVP BACK 2020 ONLY GETS MAY AND NOV BOOK                             
         DC    C'YRK',AL1(YR_2020),AL1(01)                                      
         DC    AL1(RDBK_MAY+RDBK_NOV)                                           
         DC    C'SVP',AL1(YR_2020),AL1(01)                                      
         DC    AL1(RDBK_MAY+RDBK_NOV)                                           
*                                                                               
         DC    X'FFFF'                                                          
*                                                                               
* THESE TABLES ARE USED FOR THE 1988 SPECIAL OLYMPIC OPTION                     
NSIJAN88 DC    AL2(168,112,106,202,115,110,105,216,403,128,217)                 
         DC    AL2(213,101,104,108,407,209,111)                                 
         DC    X'FFFF'                                                          
NSIMAR88 DC    AL2(106,202,403,101,104)                                         
         DC    X'FFFF'                                                          
ARBJAN88 DC    AL2(197,21,3,51,93,35,109,57,201,83,157,13,127,111)              
         DC    AL2(107,9,11,29,65,105,75,19)                                    
         DC    X'FFFF'                                                          
ARBMAR88 DC    AL2(3,51,13,9,11)                                                
         DC    X'FFFF'                                                          
*                                                                               
* THESE TABLES ARE USED FOR THE 1992 SPECIAL OLYMPIC OPTION                     
NSIJAN92 DC    AL2(168,112,106,202,115,105,216,403,128,217)                     
         DC    AL2(213,101,104,108,407,209,111)                                 
         DC    X'FFFF'                                                          
NSIMAR92 DC    AL2(202,403,101,104)                                             
         DC    X'FFFF'                                                          
ARBJAN92 DC    AL2(197,21,3,51,93,35,109,57,201,83,157,13,127,111)              
         DC    AL2(9,11,65,19)                                                  
         DC    X'FFFF'                                                          
ARBMAR92 DC    AL2(3,51,13,9,11)                                                
         DC    X'FFFF'                                                          
*                                                                               
DEFAULT  DC    AL1(MON_JAN)        JAN                                          
         DC    AL1(MON_MAR)        MAR                                          
         DC    AL1(MON_MAR)        MAR                                          
         DC    AL1(MON_MAR)        MAR                                          
         DC    AL1(MON_MAR)        MAR                                          
         DC    AL1(MON_JUL)        JUL                                          
         DC    AL1(MON_JUL)        JUL                                          
         DC    AL1(MON_JUL)        JUL                                          
         DC    AL1(MON_NOV)        NOV                                          
         DC    AL1(MON_NOV)        NOV                                          
         DC    AL1(MON_NOV)        NOV                                          
         DC    AL1(MON_NOV)        NOV                                          
*                                                                               
*&&DO                                                                           
FEB02SL  DC    CL4'WGRZ'           BUFFALO                                      
         DC    CL4'WIVB'                                                        
         DC    CL4'WKBW'                                                        
         DC    CL4'WNGS'                                                        
         DC    CL4'WNLO'                                                        
         DC    CL4'WNYO'                                                        
         DC    CL4'WPXJ'                                                        
         DC    CL4'WUTV'                                                        
         DC    CL4'KCTV'           KANSAS CITY                                  
         DC    CL4'KCWE'                                                        
         DC    CL4'KMBC'                                                        
         DC    CL4'KMCI'                                                        
         DC    CL4'KPXE'                                                        
         DC    CL4'KSHB'                                                        
         DC    CL4'KSMO'                                                        
         DC    CL4'WDAF'                                                        
         DC    CL4'KAUT'           OKLAHOMA CITY                                
         DC    CL4'KFOR'                                                        
         DC    CL4'KOCB'                                                        
         DC    CL4'KOCO'                                                        
         DC    CL4'KOKH'                                                        
         DC    CL4'KOPX'                                                        
         DC    CL4'KSBI'                                                        
         DC    CL4'KTBO'                                                        
         DC    CL4'KWTV'                                                        
         DC    CL4'ZN53'                                                        
         DC    X'FF'                                                            
*&&                                                                             
         EJECT                                                                  
DUB      DS    D                                                                
RELO     DS    F                                                                
DMCB     DS    6F                                                               
DMCB2    DS    6F                                                               
FULL     DS    F                                                                
*                                                                               
VADDAY   DS    A                                                                
VDATCON  DS    A                                                                
VDEMAND  DS    A                                                                
*                                                                               
VACTTAB  DS    A                                                                
VACTTABW DS    A                                                                
VACTTBWC DS    A                                                                
VSEP_5WK DS    A                                                                
ACTTABLE_LEN DS H                  ACTTABLE TABLE ENTRY LENGTH                  
SEP_5WK_LEN  DS H                  SEP_5WK TABLE ENTRY LENGTH                   
*                                                                               
J88PTR   DS    F                                                                
M88PTR   DS    F                                                                
HALF     DS    H                                                                
BYTE     DS    X                                                                
THREE    DS    XL3                                                              
WORK     DS    CL17                                                             
*                                                                               
RADBOOK  DS    X                                                                
THISAT   DS    X                   LPM SWEEP CLASS                              
OLYMKT   DS    XL2                                                              
BRDDATE  DS    CL12                                                             
*                                                                               
CURRAREA DS    0C                                                               
CURRMKT  DS    XL2                                                              
CURRCALL DS    CL5                                                              
CURRCLT  DS    CL3                                                              
CURRBOOK DS    CL5                                                              
CURRDATE DS    CL12                                                             
CURRFMS  DS    CL3                                                              
CURRALFM DS    CL3                                                              
CURRBTYP DS    C                                                                
CURROOWR DS    X                                                                
CURRARLQ EQU   *-CURRAREA                                                       
*                                                                               
SVAREA   DS    CL(CURRARLQ)       SAVE REGULAR TABLE                            
*                                                                               
SVMENU   DS    XL(ACTENTRL)                                                     
SVMENU2  DS    XL(ACTENTRL)                                                     
LPMMENU  DS    XL(ACTENTRL)                                                     
CDMMENU  DS    XL(ACTENTRL)                                                     
*                                                                               
SVDBERR  DS    XL(L'DBERROR)                                                    
SVPPMLBK DS    XL2                 LIVE PPM BOOK                                
SVPPMSTP DS    XL2                 START PPM PRELIMINARY BOOK                   
SVPPMENP DS    XL2                 END PPM PRLIMINARY BOOK                      
SVCDMLBK DS    XL2                 LIVE CDM BOOK                                
FORCEBK  DS    XL2                                                              
PPMBKFLG DS    X                                                                
LOAD_YES EQU   X'80'                                                            
LOAD_NO  EQU   X'40'                                                            
SVLPMDTE DS    XL3                                                              
WEEKLAST DS    XL2                                                              
OVRLAST  DS    XL2                                                              
WEEKLST2 DS    XL2                                                              
SVACTSTA DS    CL(L'DBSELSTA)                                                   
SVMENUTY DS    X                   SAVE MENU TYPE                               
SVACTTAB DS    X                   SAVE MENU TYPE                               
BOOKTYPE DS    C                   BOOK TYPE                                    
BKTYPIND DS    X                   BOOKTYPE INDICATOR                           
OVEFFBK  DS    XL(L'DBSELBK)                                                    
CURRDTES DS    XL4                                                              
BOOK     DS    XL2                                                              
         ORG   BOOK                                                             
BBOOK    DS    XL2                                                              
FBOOK    DS    XL2                                                              
PRLMBK   DS    XL2                                                              
MYFMS    DS    CL3                                                              
WKSTART  DS    CL6                                                              
WKEND    DS    CL6                                                              
WEEKS    DS    XL5                                                              
WKCNT    DS    X                                                                
WKSW     DS    X                                                                
SEPTSW   DS    X                   Y/N SWITCHED SEPT ACT TABLE FLAG             
SVR4     DS    F                                                                
SPOLYOPT DS    C                                                                
MOFMMBBM DS    C                                                                
CABACTIV DS    C                                                                
IGNRMLPM DC    C'N'                IGNORE LPM START DATE IN MARKET REC          
MKTTYPE  DS    C                                                                
MKTSETM  EQU   X'80'                                                            
MKTDIARY EQU   X'40'                                                            
MYDBLK   DS    XL256                                                            
         DS    XL10                                                             
MONLST   DS    XL100                                                            
* DEIS SAYS THIS LENGTH IS SUSPECT, BECAUSE ABKOLIST IS 621 !!!                 
BKLST    DS    XL603                                                            
DEMREC   DS    CL1100                                                           
         EJECT                                                                  
         DROP  RB                                                               
*                                                                               
***********************************************************                     
*  CHECK TO SEE IF WE NEED TO SWITCH ACT TABLES FOR 4 WEEK*                     
* AND 5 WEEK SEPT BASED ON BUY PERIODS BROADCAST WEEKS    *                     
* IF LPM MARKET THEN EXIT- NO NEED TO DO IT FOR LPM       *                     
* ON EXIT- SVMENU WILL BE SET WITH NEW ACT TABLE ENTRY    *                     
***********************************************************                     
CHKSEPT  NTR1 BASE=*,LABEL=*                                                    
         MVI   SEPTSW,C'Y'       SET WE HAVE WENT IN HERE ONCE                  
         XC    DMCB(24),DMCB                                                    
                                                                                
CHKSEP02 GOTO1 VDATCON,DMCB,(2,0(R4)),(0,STYYMMDD)                              
         GOTO1 VDATCON,DMCB,(2,2(R4)),(0,EDYYMMDD)                              
         XC    DMCB(24),DMCB                                                    
         L     RF,ABKCMFAC         VALIDATE BOOKTYPE                            
         ICM   RF,15,CPERVERT-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,STYYMMDD,EDYYMMDD                                      
         ZICM  R0,8(R1),(3)        NUMBER OF DAYS IN PERIOD                     
         CHI   R0,28                                                            
         BH    CHKS5WK                                                          
         B     CHKS4WK                                                          
* IF THIS CURRENT SEPTEMBER BROADCAST PERIOD HAS 4 WEEKS ONLY                   
* CHECK TO SEE IF ACTTAB IS USING 5 WEEK SEPT CLASS                             
* WE WILL NEED TO SWTICH TO 4 WEEK SEPT CLASS                                   
CHKS4WK  DS    0C                                                               
         L     RE,VSEP_5WK                                                      
         B     CHKS4W20                                                         
*                                                                               
* IF THIS CURRENT SEPTEMBER BROADCAST PERIOD HAS 5 WEEKS ONLY                   
* CHECK TO SEE IF ACTTAB IS USING 4 WEEK SEPT CLASS                             
* WE WILL NEED TO SWTICH TO 5 WEEK SEPT CLASS                                   
CHKS5WK  DS    0C                                                               
* CARAT DOESNT WANT THE SWITCH FROM 4 TO 5 WEEKS                                
* DISABLE THIS TYPE OF SWITCH FOR NOW                                           
         B     CHKSEPTX                                                         
*                                                                               
CHKS4W20 CLI   0(RE),0                 EOT?                                     
         BE    CHKSEPTX                                                         
         CLC   ABKS0PRF+3(1),0(RE)     ARE WE USING A 5 WK ACTTAB?              
         BE    CHKS4W60                                                         
         AH    RE,SEP_5WK_LEN                                                   
         B     CHKS4W20                                                         
CHKS4W60 L     RF,VACTTAB              WE ARE USING 5 WK ACCTAB                 
         USING ACTTABD,RF                                                       
*                                      WE HAVE TO SWITCH TO THE 4WK             
CHKS4W70 CLC   ACTPROF,1(RE)           LOOK FOR CORRECT TABLE                   
         BE    CHKS4W80                                                         
         CLI   0(RF),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
CHKS4W76 AH    RF,ACTTABLE_LEN                                                  
         B     CHKS4W70                                                         
                                                                                
CHKS4W80 CLI   ACTCLASS,X'FF'      DEFAULT SWEEP CLASS                          
         BE    *+14                                                             
         CLC   ABKMCLAS,ACTCLASS   MARKET CLASS OK                              
         BNE   CHKS4W76            NO - GET NEXT ENTRY                          
*                                                                               
         OC    SVLPMDTE,SVLPMDTE   IF NO LPM DATE AT ALL- NON LPM               
         BNZ   CHKSEP90            SET MOVE SVMENU AND SVMENU2                  
         MVC   SVMENU,ACTENTRY     SAVE MENU                                    
         MVC   SVMENU2,ACTENTRY                                                 
         B     CHKSEPTX                                                         
* HAVE LPM START DATE THEN ONLY SET SVMENU2                                     
* DONT OVERRIDE SVMENU BECAUSE THAT HAS SVENU HAS LPM ACTTABLE                  
CHKSEP90 DS    0C                                                               
         MVC   SVMENU2,ACTENTRY                                                 
         DROP  RF                                                               
*                                                                               
*                                                                               
CHKSEPTX XC    DMCB(24),DMCB                                                    
         XIT1                                                                   
         LTORG                                                                  
*                                                                               
STYYMMDD DS    CL6                                                              
EDYYMMDD DS    CL6                                                              
TMPDUB   DS    D                                                                
*                                                                               
         DROP  RB                                                               
*                                                                               
***********************************************************                     
* ROUTINE CHECKS IF FUSION LOOKUP MKT IS A SETMETERED MKT                       
***********************************************************                     
CHKFUSMK NTR1 BASE=*,LABEL=*                                                    
* GET SET METER MKT TABLE FROM DEDEMTABS                                        
         XC    MKTTYPE,MKTTYPE                                                  
         L     RF,ABKCMFAC         GET ADDRESS OF ACT TABLES                    
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,SETMETER                                               
         ICM   RE,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
*                                                                               
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
         LR    RF,RE               SAVE A(FIRST ENTRY)                          
         USING SETMETRD,RE                                                      
CHKFMK26 CLI   0(RE),X'FF'              IN TABLE                                
         BE    CHKFUSMX                 IF NOT IN TABLE EXIT                    
         CLC   SETMKALF,ABKALFM                                                 
         BE    CHKFMK28                                                         
         AR    RE,R0                                                            
         B     CHKFMK26                                                         
*                                                                               
CHKFMK28 MVI   MKTTYPE,MKTSETM      FOUND MKT IN SET METER TAB                  
CHKFUSMX XIT1                                                                   
         LTORG                                                                  
                                                                                
**********************************************************                      
*CHECK ARBITRON PPM                                      *                      
* INPUT- 0(R1) =A(SVMENU)                                *                      
*        4(R1) = BOOK                                    *                      
*        8(R1) =ABKALFM  ALPHA MKT                       *                      
* OUTPUT- 12(R1)= LIVE PPM BOOK FOR MKT- NULL IF NOT PPM *                      
*         16(R1)= PRELIMINARY PPM START BOOK             *                      
*         20(R1)= PRELIMINARY PPM END BOOK               *                      
*         SVMENU- WILL CONTAIN CREATED PPM ACT TABLE     *                      
*                  ENTRY                                 *                      
**********************************************************                      
CHKPPM   NTR1  BASE=*,LABEL=*                                                   
         LR    R2,R1               SAVE A(PARAMETER LIST)                       
         L     RF,ABKCMFAC                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB2,PPMTAB    GET A(PPM TABLE)                            
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
*                                                                               
         USING PPMTABD,RF                                                       
CHKPPM20 CLC   =X'FFFF',0(RF)          EOT NOT PPM                              
         BE    CHKPPMNO                                                         
         CLC   PPMAMKT,8(R2)                                                    
         BE    CHKPPM50                                                         
         AR    RF,R0                                                            
         B     CHKPPM20                                                         
*                                                                               
* FOUND MARKET IN PPM TABLE - IS CURRENT BOOK TO PRELIMINARY START BOOK         
* IF BOOK IS BEFORE PRELIMINARY START BOOK THEN EXIT                            
CHKPPM50 CLC   PPMSTRTP,4(R2)          BEFORE PPM START PRELIMINARY BK          
         BH    CHKPPMNO                EXIT                                     
* ASSUME THE PPM LIVE BOOK IS LOADED SO PRELIMARY START AND END BOOKS           
* ARE ALLOWED TO BE POSTED                                                      
*                                                                               
         MVC   12(L'PPMLIVBK,R2),PPMLIVBK                                       
         MVC   16(L'PPMSTRTP,R2),PPMSTRTP                                       
         MVC   20(L'PPMENDP,R2),PPMENDP                                         
*                                                                               
         DROP  RF                                                               
*                                                                               
*                                                                               
CHKPPMNO XC    12(4,R1),12(R1)         SET NUMLLRETURN LPMDATE                  
         XC    16(4,R1),16(R1)         SET NUMLLRETURN LPMDATE                  
         XC    20(4,R1),20(R1)         SET NUMLLRETURN LPMDATE                  
*                                                                               
CHKPPMX  XIT1                                                                   
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
**********************************************************                      
*CHECK ARBITRON CDM                                      *                      
* INPUT- 0(R1) =A(SVMENU)                                *                      
*        4(R1) = BOOK                                    *                      
*        8(R1) =ABKALFM  ALPHA MKT                       *                      
* OUTPUT- 12(R1)= LIVE PPM BOOK FOR MKT- NULL IF NOT PPM *                      
*         SVMENU- WILL CONTAIN CREATED PPM ACT TABLE     *                      
*                  ENTRY                                 *                      
**********************************************************                      
CHKCDM   NTR1  BASE=*,LABEL=*                                                   
         LR    R2,R1               SAVE A(PARAMETER LIST)                       
         L     RF,ABKCMFAC                                                      
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB2,CDMTAB    GET A(PPM TABLE)                            
         ICM   RF,15,0(R1)         A(TABLE) RETURNED IN P1                      
         BNZ   *+6                                                              
         DC    H'0'                BAD TABLEID PASSED                           
         L     R0,4(R1)            L'TABLE ENTRY RETURNED IN P2                 
*                                                                               
         USING CDMTABD,RF                                                       
CHKCDM20 CLC   =X'FFFF',0(RF)          EOT NOT PPM                              
         BE    CHKCDMX                                                          
         CLC   CDMAMKT,8(R2)                                                    
         BE    CHKCDM50                                                         
         AR    RF,R0                                                            
         B     CHKCDM20                                                         
*                                                                               
* FOUND MARKET IN PPM TABLE - IS CURRENT BOOK TO PRELIMINARY START BOOK         
* IF BOOK IS BEFORE PRELIMINARY START BOOK THEN EXIT                            
CHKCDM50 CLC   CDMLIVBK,4(R2)          BEFORE CDM LIVE BOOK                     
         BH    CHKCDMX                 EXIT                                     
         OC    CDMENDBK,CDMENDBK   NO END BOOK FOR CDM MARKET- MKT              
         BZ    *+14                IS STILL CDM                                 
         CLC   CDMENDBK,4(R2)      IF BOOK IS AFTER END OF CDM BOOK             
         BL    CHKCDMX             EXIT AS MARKET NO LONGER CDM FOR BK          
* ASSUME THE PPM LIVE BOOK IS LOADED SO PRELIMARY START AND END BOOKS           
* ARE ALLOWED TO BE POSTED                                                      
*                                                                               
         MVC   12(L'CDMLIVBK,R2),CDMLIVBK                                       
*                                                                               
*                                                                               
* ACTTAB 76 FEATURE TO GO 20.3                                                  
*  SET UP CDM ACT TABLE                                                         
************************************                                            
* SET UP LPM ACT TABLE ENTRY                                                    
         L     RF,VACTTAB                                                       
         MVI   THISAT,1            SET OF TABLES                                
*                                                                               
         CLI   SVACTTAB,76         ONLY ACTTAB 76 IS AVAILABLE OPTION           
         BNE   CHKCDMX                                                          
         MVI   THISAT,76           ONLY ONE ACT TABLE FOR NOW                   
*                                                                               
         USING ACTTABD,RF                                                       
CHKCDM60 CLC   ACTPROF,THISAT      LOOK FOR THE CORRECT TABLE                   
         BE    CHKCDM64                                                         
         CLI   0(RF),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                INVALID PROFILE                              
CHKCDM61 AH    RF,ACTTABLE_LEN                                                  
         B     CHKCDM60                                                         
*                                                                               
CHKCDM64 CLI   ACTCLASS,X'FF'      DEFAULT SWEEP CLASS                          
         BE    *+14                                                             
         CLC   THISAT,ACTCLASS     MARKET CLASS OK                              
         BNE   CHKCDM61             NO - GET NEXT ENTRY                         
*                                                                               
         MVC   CDMMENU,ACTENTRY    SAVE MENU(LPM)                               
         MVC   SVMENU,CDMMENU                                                   
*                                                                               
         DROP  RF                                                               
*                                                                               
************************************                                            
*                                                                               
*                                                                               
CHKCDMX  XIT1                                                                   
         LTORG                                                                  
         DROP  RB                                                               
*                                                                               
*                                                                               
         EJECT                                                                  
       ++INCLUDE SPABKBLOCK                                                     
         EJECT                                                                  
RADFILT_NEGD DSECT                                                              
RADFILT_NEG_ALF DS   CL3           ALPHA MARKET                                 
RADFILT_NEG_EYR DS   XL1           EFFECTIVE YEAR                               
RADFILT_NEG_EMN DS   XL1                 AND MONTH OF CHANGE                    
RADFILT_NEG_MON DS   CL1           MONTHS TO ADD/SUBTRACT FROM RADBOOK          
         EJECT                                                                  
* SPGENMKT                                                                      
* DEDBLOCK                                                                      
* DEDEMEQUS                                                                     
* DEDEMFILE                                                                     
* DDCOMFACS                                                                     
* DEDEMTABD                                                                     
* DDMONYREQU                                                                    
         PRINT OFF                                                              
         EJECT                                                                  
MKTRECD  DSECT                                                                  
       ++INCLUDE SPGENMKT                                                       
         DSECT                                                                  
       ++INCLUDE DEDBLOCK                                                       
         EJECT                                                                  
       ++INCLUDE DEDEMEQUS                                                      
         EJECT                                                                  
       ++INCLUDE DEDEMFILE                                                      
         EJECT                                                                  
       ++INCLUDE DDCOMFACS                                                      
         EJECT                                                                  
       ++INCLUDE DEDEMTABD                                                      
         EJECT                                                                  
       ++INCLUDE DDMONYREQU                                                     
         PRINT ON                                                               
         SPACE 3                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'093SPACTBKG  11/04/20'                                      
         END                                                                    

*          DATA SET SPACTBKCAN AT LEVEL 001 AS OF 03/24/03                      
*CATALP ACTBKG                                                                  
         TITLE 'GET ACTUAL BOOK MENU'                                           
***************UPDATE LOG********************************************           
*                                                                   *           
*   JAN15/98  OLYMPIC EXCLUSION OPTION FOR JULY                     *           
*                                                                   *           
*   OCT15/96  OLYMPIC EXCLUSION OPTION FOR JULY                     *           
*                                                                   *           
*   SEP04/96  SPECIAL OLYMPIC OPTION FOR JULY                       *           
*                                                                   *           
*   JAN08/93  HANDLE BOOK TYPE ELEMENT                              *           
*                                                                   *           
*                                                                   *           
*   DEC11/92  HANDLE NSI ATLANTA MISSING SURVEY                     *           
*                                                                   *           
*                                                                   *           
*   NOV28/88  HANDLE NON-BROADCAST DATES AS DEFINED IN SPOT PROF+2  *           
*                                                                   *           
*   MAY24/88  SPECIAL OLYMPIC OPTION FOR APR GOING TO FEB           *           
*                                                                   *           
*   MAY06/88  SPECIAL OLYMPIC OPTION FOR JAN/FEB                    *           
*                                                                   *           
*   OCT15/87  ADDED BBM 1987/88 SWEEP DATES                         *           
*                                                                   *           
*   SEP28/87  ADDED CSI 1987/88 SWEEP DATES                         *           
*                                                                   *           
*   SEP25/87  ADDED TABLE 40 TO CANADIAN CPPRS(BBM)                 *           
*                                                                   *           
*   SEP10/87  UPDATED ACT TABLES FOR 88                             *           
*             ADDED TABLE 39 FOR CPPRS                              *           
*                                                                   *           
*   JUN15/87  ADDED SPILL CAPABILTIES                               *           
*********************************************************************           
         SPACE 4                                                                
*        P1    0    SPECIAL LOOKUP OPTION                                       
*              1-3  A(ABKBLOCK)                                                 
*                                                                               
         EJECT                                                                  
ACTBKG   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,ABKG,RR=R5                                                     
         LA    R2,2048(RB)                                                      
         LA    R2,2048(R2)                                                      
         USING ACTBKG+4096,R2                                                   
         ST    R5,RELO                                                          
         L     RA,0(R1)                                                         
         USING ABKBLOCK,RA                                                      
         MVC   SVPARAM(20),0(R1)                                                
         MVC   MYFMS,ABKFILE       SET FILE/MEDIA/SOURCE                        
*                                                                               
         MVC   BOOKTYPE,ABKBTYP    SET BTYPE FOR DEMO LOOKUPS                   
FBTYELX  DS    0C                                                               
*                                                                               
         MVC   CURRFMS,ABKFILE                                                  
         MVC   CURRMKT,ABKMKT                                                   
         MVC   CURRCALL,ABKSTAT    SAVE CURRENT CALL LETTERS                    
         MVC   CURRCLT,ABKCLT                                                   
         MVC   CURRBOOK,ABKBOOK                                                 
         LA    R9,ABKBDAT                                                       
         GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R9)),(0,CURRDATE)                      
         MVC   CURRDATE+6(6),CURRDATE                                           
         GOTO1 ABKDATCN,ABKDMCB,(X'02',0(R9)),(0,CURRDATE)                      
         CLC   CURRDATE(6),ABKSTART                                             
         BL    *+10                                                             
         MVC   CURRDATE(6),ABKSTART                                             
         CLC   CURRDATE+6(6),ABKEND                                             
         BH    *+10                                                             
         MVC   CURRDATE+6(6),ABKEND                                             
         CLC   CURRAREA,SVAREA     SAME BASIC KEYS                              
         BE    BLDSWP               YES-PROCESS FROM MY TABLE                   
         MVC   SVAREA,CURRAREA      NO -BUILD MY TABLE                          
         CLC   ABKBOOK(3),=C'ACT'                                               
         BNE   GETMON                                                           
         LA    RF,ACTTAB                                                        
*                                                                               
         CLC   =C'0209',ABKSTART   CHECK FOR START OF WEEKLY DATA               
         BH    ACTNOWK                                                          
         CLI   ABKMCLAS,C'8'       SWEEP CLASS 8 IS FOR PPM MARKETS             
         BNE   *+16                                                             
         L     RF,=A(ACTTABW)      WE GET INCOMPLETE MONTHLY BOOKS              
         A     RF,RELO             FOR SOME MONTHS SO NEED A NEW                
         MVI   ABKS0PRF+3,1        SET OF TABLES                                
*                                                                               
ACTNOWK  DS    0C                                                               
         CLI   ABKS0PRF+3,240                                                   
         BL    *+8                                                              
         NI    ABKS0PRF+3,X'0F'                                                 
         CLI   ABKMED,C'R'                                                      
         BNE   GTMENU                                                           
         MVI   ABKS0PRF+3,3                                                     
GTMENU   CLC   0(1,RF),ABKS0PRF+3                                               
         BE    GTMENU2                                                          
         CLI   0(RF),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                INVALID PROFILE                              
GTMENU1  A     RF,LACTTAB                                                       
         B     GTMENU                                                           
GTMENU2  CLI   1(RF),X'FF'         DEFAULT SWEEP CLASS                          
         BE    HVMENU                                                           
         CLC   ABKMCLAS,1(RF)      MARKET CLASS OK                              
         BNE   GTMENU1              NO - GET NEXT ENTRY                         
         SPACE 2                                                                
HVMENU   MVC   SVMENU,2(RF)        SAVE MENU                                    
         EJECT                                                                  
* GET DATE LIST FROM INPUT DATES                                                
GETMON   LA    RE,ABKS0PRF                                                      
*               TAKE CARE OF BRDMON BUG                                         
*                BRDMON GETS SCREWED UP IF WE START ON LAST DAY                 
*                OF BROADCAST MONTH                                             
         MVC   BRDDATE(12),CURRDATE                                             
         L     R9,=F'-14'          CAPTURE FIRST MONTH ALWAYS                   
         GOTO1 ABKADDAY,ABKDMCB,BRDDATE,BRDDATE,(R9)                            
         CLI   8(RE),7                                                          
         BNE   GETMON1                                                          
         L     R9,=F'-1'                                                        
         GOTO1 ABKADDAY,ABKDMCB,BRDDATE,BRDDATE,(R9)                            
*              EXTEND THE END PAST LAST SUNDAY                                  
GETMON1  GOTO1 ABKADDAY,ABKDMCB,BRDDATE+6,BRDDATE+6,14                          
         LA    RE,ABKS0PRF                                                      
*                                                                               
         MVC   J88PTR(1),2(RE)                                                  
         MVC   J88PTR+1(3),6(RE)                                                
         MVI   2(RE),0             FORCE BROADCAST MONTHS                       
         MVI   6(RE),0             AND NORMAL STARTS                            
         MVI   7(RE),0             (MOBILE LOOKS AT THESE)                      
         MVI   8(RE),0                                                          
         GOTO1 ABKMOBIL,ABKDMCB,(13,BRDDATE),(1,MONLST),ABKMOBP                 
         L     RE,=V(SYSPROFS)     RESTORE SYSPROFS                             
         LTR   RE,RE                                                            
         BNZ   *+8                                                              
         LA    RE,ABKS0PRF                                                      
         MVC   2(1,RE),J88PTR                                                   
         MVC   6(3,RE),J88PTR+1                                                 
         XC    J88PTR(8),J88PTR                                                 
         XC    OLYMKT,OLYMKT                                                    
* GET BOOKS WHICH FALL IN PERIOD                                                
         CLC   ABKBOOK(3),=C'ACT'                                               
         BE    GTABK                                                            
*        PACK  MYDUB,ABKBOOK(2)    YEAR                                         
*        CVB   RF,MYDUB                                                         
*        STC   RF,BBOOK                                                         
*        PACK  MYDUB,ABKBOOK+2(2)  MONTH                                        
*        CVB   RF,MYDUB                                                         
*        STC   RF,BBOOK+1                                                       
                                                                                
         MVC   MYDUB(4),ABKBOOK                                                 
         MVC   MYDUB+4(2),=C'01'    DUMMY DAY                                   
         GOTO1 ABKDATCN,ABKDMCB,MYDUB,(3,MYFULL)                                
         MVC   BBOOK(2),MYFULL      YM BINARY                                   
                                                                                
         LA    RE,MONLST           SET ALL MONTHS TO CURRENT BOOK               
         LA    RF,BKLST                                                         
         XC    BKLST,BKLST                                                      
GETMON2  CLI   0(RE),0             END OF LIST-CREATE OUTPUT                    
         BE    EXIT                                                             
         MVC   0(4,RF),0(RE)                                                    
         MVC   4(2,RF),BBOOK                                                    
         LA    RE,4(RE)                                                         
         LA    RF,6(RF)                                                         
         B     GETMON2                                                          
         EJECT                                                                  
* GET BOOKS FOR ACTUAL MONTHS                                                   
GTABK    CLI   ABKCTRY,C'C'       CHECK FOR CANADIAN                            
         BNE   GTABK0                                                           
         XC    BKLST,BKLST                                                      
         BAS   RE,TORMTH           MONTHLY FOR TORONTO                          
         OC    BKLST,BKLST                                                      
         BNZ   BLDSWP                                                           
*                                                                               
GTABK0   LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
         XC    BKLST,BKLST                                                      
         MVI   HOLDBOOK,0                                                       
GTABK1   CLI   0(R4),X'FF'         END OF LIST - CREATE OUTPUT                  
         BE    BLDSWP                                                           
         CLI   WKSW,1                                                           
         BE    DOWKS                                                            
         MVI   WKCNT,0                                                          
         GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R4)),(X'03',BOOK)                      
* GET LOOKUP MONTH FROM TABLE                                                   
         ZIC   RE,BOOK+1           GET DEFAULT BOOK FROM TABLE                  
         LA    RF,SVMENU(RE)                                                    
GTABK1A  DS    0H'0'                                                            
         MVC   SPOLYOPT,ABKD0PRF+8 FOR WESTERN OR KC/BUF/OKC                    
         LA    RE,FEB02SL           FOR FEB/02 OLYMPIC EXCLUSION                
FO2SCK   CLC   CURRCALL(4),0(RE)     THESE STATIONS DO NOT HAVE AN              
         JE    FO2SCK2               EXCLUSION BOOK                             
         LA    RE,4(RE)                                                         
         CLI   0(RE),X'FF'                                                      
         JNE   FO2SCK                                                           
         J     *+8                                                              
FO2SCK2  MVI   SPOLYOPT,C'W'       FORCE LOOKUP OF JAN/02 OR NOV/01             
*                                                                               
*                                                                               
* SAVE POINTERS TO SPECIAL MONTH SLOTS                                          
         CLI   ABKOPT1,C'1'        CPPRS OLYMPIC OPTION                         
         BE    *+8                                                              
         CLI   ABKOPT1,C'2'        COKE/MCCANN OLYMPIC OPTION                   
         BE    *+8                                                              
         CLI   SPOLYOPT,C'W'       WESTERN OPTION ALSO                          
         BE    *+8                                                              
         CLI   ABKOPT1,C'F'        CHECK IF OPTION ACTIVE                       
         BNE   GTABKNO                                                          
         CLC   BOOK(2),=X'6601'                                                 
         BE    *+10                                                             
         CLC   BOOK(2),=X'6201'                                                 
         BE    *+10                                                             
         CLC   BOOK(2),=X'5C01'                                                 
         BNE   *+8                                                              
         ST    R6,J88PTR                                                        
         CLC   BOOK(2),=X'6603'                                                 
         BE    *+10                                                             
         CLC   BOOK(2),=X'6203'                                                 
         BE    *+10                                                             
         CLC   BOOK(2),=X'5C03'                                                 
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK(2),=X'5E01'                                                 
         BNE   *+8                                                              
         ST    R6,J88PTR                                                        
         CLC   BOOK(2),=X'5E03'                                                 
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         OC    M88PTR,M88PTR                                                    
         BNZ   GTABKP8                                                          
         CLC   BOOK(2),=X'5C04'    BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK(2),=X'5E04'    BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK(2),=X'6204'    BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
         CLC   BOOK(2),=X'6604'    BECAUSE APR CAN GO TO FEB TOO                
         BNE   *+8                                                              
         ST    R6,M88PTR                                                        
GTABKP8  CLI   BOOK,X'66'          KILL OPTION FOR MAR/APR                      
         BNE   GTABKNO                                                          
         CLI   BOOK,X'62'          KILL OPTION FOR MAR/APR                      
         BNE   GTABKNO                                                          
         CLI   SPOLYOPT,C'W'                                                    
         BNE   GTABKNO                                                          
         XC    M88PTR,M88PTR                                                    
GTABKNO  DS    0H'0'                                                            
         MVC   PRLMBK,BOOK         MOVE DEFAULT BOOK TO PRELIM                  
*                                                                               
* AFTER MAY/02 BOSTON HAS MONTHLY BOOKS ARE MONTHLY                             
* SO FORCE ALL TABLES TO BE DEFAULT                                             
         CLC   BOOK,=X'6605'                                                    
         BL    CHKBOSX                                                          
         CLC   BOOK,=X'6609'       NO BOS SW8 ACT BEFORE SEP/02                 
         BL    *+12                                                             
         CLI   ABKMCLAS,C'8'       SWEEP CLASS 8 IS FOR PPM MARKETS             
         BE    CHKBOSX                                                          
         LA    R5,BOSLST           LIST OF BOSTON STATIONS                      
CHKBOS   CLI   0(R5),X'FF'                                                      
         BE    CHKBOSX                                                          
         CLC   0(4,R5),CURRCALL                                                 
         BE    GTABK2              LEAVE PRLMBK=BOOK                            
         LA    R5,4(R5)                                                         
         B     CHKBOS                                                           
CHKBOSX  DS    0C                                                               
*                                                                               
         MVC   PRLMBK+1(1),0(RF)   SET PRLMBK TO TABLE RETRY BOOK               
         CLI   0(RF),X'FF'                                                      
         BE    DOWKS                                                            
         CLI   SVMENU,2            FORCE MENU                                   
         BNE   *+10                                                             
         MVC   BOOK+1(1),0(RF)     SET BOOK PRIOR TO LOOKUP                     
*                                                                               
         CLI   SVMENU,3            SPECIAL MENU                                 
         BNE   GTABK1B             FOR BBM                                      
         ZIC   R5,BOOK+1                                                        
         BCTR  R5,0                                                             
         LA    R5,DEFAULT(R5)                                                   
         MVC   BOOK+1(1),0(R5)                                                  
*                                                                               
GTABK1B  TM    0(RF),X'80'         FORCE MONTH                                  
         BZ    *+10                                                             
         MVC   BOOK+1(1),0(RF)     SET BOOK PRIOR TO LOOKUP                     
         NI    BOOK+1,X'7F'                                                     
         NI    PRLMBK+1,X'7F'                                                   
*                                                                               
GTABK2   LA    R5,MYDBLK           VALIDATE STATION/BOOK                        
         USING DBLOCK,R5                                                        
         XC    0(256,R5),0(R5)                                                  
         MVI   DBSELMED,C'T'                                                    
         CLI   ABKMED,C'R'                                                      
         BNE   *+8                                                              
         MVI   DBSELMED,C'R'                                                    
         CLI   ABKCTRY,C'C'        CHECK FOR CANADIAN                           
         BNE   GTABKUS                                                          
         MVI   DBSELMED,C'C'       SET TO USE CANADIAN FILE                     
         MVI   DBFRANCO,C'Y'                                                    
         LA    RE,ABK1WPRF                                                      
         MVC   DBFRANCO,3(RE)      SET FRANCO OPTION                            
         OC    ABKSPMKT,ABKSPMKT                                                
         BNZ   GTABKUS                                                          
         OC    ABKALFM(3),ABKALFM                                               
         BZ    GTABKUS                                                          
         MVC   DBSELALF,ABKALFM   SET THE SPILL                                 
GTABKUS  MVC   DBFILE,=C'TP '                                                   
         MVC   DBSELBK,BOOK                                                     
         MVC   DBBTYPE,BOOKTYPE                                                 
         BAS   R9,ADJBOOK          ADJUST FOR OUT OF YEAR                       
         MVI   DBFUNCT,DBGETDEM    SET TO VALIDATE STA/BOOK                     
         MVI   DBSELSRC,C'N'       SET RTG SERVICE                              
         MVI   DBSELDAY,X'40'                                                   
         MVC   DBSELTIM,=X'07080726'                                            
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL                                                
         MVC   DBSELAGY,ABKAGY     SET THE AGENCY                               
         MVC   DBSELCLI,ABKCLT     SET THE CLIENT                               
         MVC   DBSELUMK,ABKMKT                                                  
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELSRC,ABKSRC                                                  
*                                                                               
         CLI   DBSELMED,C'T'       ARB USTV MOSTLY DEAD                         
         BNE   ARBOK               AFTER NOV/93                                 
         CLI   DBSELSRC,C'A'                                                    
         BNE   ARBOK                                                            
         CLI   DBSELBK,X'5E'                                                    
         BL    ARBOK                                                            
         MVI   DBSELSRC,C'N'       OVERRIDE TO NSI                              
*                                                                               
* OVERRIDE NSI OCT/92 TO NOV/92                                                 
ARBOK    CLI   DBSELSRC,C'N'       NSI                                          
         BNE   SRCOK                                                            
         CLC   DBSELBK,=X'5C0A'    AND OCT/92                                   
         BNE   SRCOK                                                            
         LA    RE,ATLSTA           SCAN FOR ATLANTA STATIONS                    
ATL9210  CLI   0(RE),X'FF'                                                      
         BE    SRCOK                                                            
         CLC   DBSELSTA(4),0(RE)                                                
         BE    *+12                                                             
         LA    RE,4(RE)                                                         
         B     ATL9210                                                          
         MVC   DBSELBK,=X'5C0B'    FOUND ONE - OVERRIDE TO NOV/92               
         MVC   BOOK,DBSELBK                                                     
         MVC   PRLMBK,BOOK                                                      
*                                                                               
SRCOK    CLI   ABKMED,C'R'                                                      
         BNE   SRCOK2                                                           
         MVI   DBSELMED,C'R'                                                    
         MVC   DBSELDAT,BOOK                                                    
         MVC   DBSELBK,=X'FFF1'    LATEST BOOK                                  
         MVI   DBSELDAY,X'7F'      MON-FRI IS BASE                              
         OC    ABKSPMKT,ABKSPMKT                                                
         BNZ   SPOK                                                             
         OC    ABKALFM(3),ABKALFM                                               
         BZ    SRCOK2                                                           
         MVC   DBSELALF,ABKALFM                                                 
SPOK     L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         MVC   DBSELBK,=X'FFF5'                                                 
         MVI   RADBOOK,0                                                        
         GOTO1 ABKDEMND,ABKDMCB,MYDBLK,RLHOOK                                   
         MVC   DBSELDAT,BOOK                                                    
         MVC   DBSELBK,=X'FFF1'    LATEST BOOK                                  
         XC    DBACTBK,DBACTBK                                                  
         CLI   DBSELDAT+1,1        ADJUST JAN                                   
         BE    *+8                                                              
         CLI   DBSELDAT+1,4        ADJUST APRIL                                 
         BE    *+8                                                              
         CLI   DBSELDAT+1,10       ADJUST OCTOBER                               
         BNE   SRCOK2                                                           
         ZIC   RE,DBSELDAT+1                                                    
         LA    RE,1(RE)                                                         
         STC   RE,DBSELDAT+1                                                    
SRCOK2   DS    0H'0'                                                            
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                                                        
         GOTO1 ABKDEMND,ABKDMCB,MYDBLK,0                                        
         CLI   DBERROR,NOTFOUND    FOUND STATION FOR BOOK                       
         BNE   GTABK4                                                           
         CLC   BOOK,PRLMBK                                                      
         BNE   GTABK3                                                           
GTABK2A  MVC   0(4,R6),0(R4)       SET FOR NO LOOKUP                            
         MVC   4(2,R6),=X'0000'                                                 
         B     GTABK4A                                                          
GTABK3   MVC   BOOK,PRLMBK         SET DEFAULT BOOK                             
         B     GTABK2               TRY AGAIN                                   
         SPACE 2                                                                
GTABK4   L     RE,DBAREC           SAVE THE MARKET NUMBER                       
         USING DRKEY,RE                                                         
         LA    RE,DRFRSTEL                                                      
         DROP  RE                                                               
         USING MARELEM,RE                                                       
         MVC   OLYMKT,MARNO                                                     
         DROP  RE                                                               
         MVC   0(4,R6),0(R4)       SET DATE TABLE                               
         MVC   DBSELBK,BOOK                                                     
         CLI   ABKMED,C'R'                                                      
         BNE   *+10                                                             
         MVC   DBSELBK,DBACTBK                                                  
         BAS   R9,ADJBOOK          ADJUST THE BOOK                              
         MVC   4(2,R6),DBSELBK                                                  
                                                                                
         CLI   DBSELMED,C'R'       CUT AT LATEST AVAILABLE BOOK                 
         BNE   GTABK4A              IF RADIO ACTUAL                             
         LA    R9,RADFILT                                                       
RADGAB1  CLI   0(R9),X'FF'         FIND CORRECT MODEL                           
         BE    RADGAB3                                                          
         CLC   0(1,R9),RADBOOK     KEYED BY BOOKS SWEPT FOR STATION             
         BE    RADGAB2                                                          
         LA    R9,13(R9)                                                        
         B     RADGAB1                                                          
                                                                                
RADGAB2  GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R4)),(X'03',BOOK)                      
         ZIC   RE,BOOK+1           SET INDEX                                    
         AR    RE,R9                                                            
                                                                                
         CLI   BOOK+1,4            ALLOW PREV YEAR PRIOR TO APRIL               
         BL    *+14                                                             
         CLC   4(1,R6),BOOK                                                     
         BNE   RADGAB3                                                          
                                                                                
         CLC   5(1,R6),0(RE)       IT'S OK                                      
         BE    GTABK4A                                                          
RADGAB3  XC    4(2,R6),4(R6)       CUT IT IF RETRIEVED BOOK NE DESIRED          
                                                                                
GTABK4A  LA    R6,6(R6)            SET NEXT LIST SLOT                           
         CLI   WKSW,1                                                           
         BE    DOWKS                                                            
         LA    R4,4(R4)            SET NEXT DATE                                
         B     GTABK1                                                           
         EJECT                                                                  
* GET WEEKLY BOOKS                                                              
DOWKS    SR    R8,R8               FIRST TIME                                   
         CLI   WKSW,0                                                           
         BNE   DOWKS2                                                           
         MVI   WKSW,1                                                           
         MVI   WKCNT,0                                                          
         ST    R4,SVR4                                                          
         LA    R9,SVMENU+13                                                     
DOWKS1   CLC   0(1,R9),BOOK+1      GET MONTHLY WEEKS                            
         BE    *+12                                                             
         LA    R9,6(R9)                                                         
         B     DOWKS1                                                           
         MVC   WEEKS,1(R9)         SAVE WEEKLY BOOKS                            
         GOTO1 ABKDATCN,ABKDMCB,(X'02',(R4)),(X'00',WKSTART)                    
         GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R4)),(X'00',WKEND)                     
         SPACE 2                                                                
DOWKS2   CLC   WKSTART,WKEND                                                    
         BH    DOWKS3                                                           
         GOTO1 ABKDATCN,ABKDMCB,(X'00',WKEND),(X'03',SV4DTE3)                   
         GOTO1 ABKDATCN,ABKDMCB,(X'00',WKSTART),(X'02',SV4DTE)                  
         GOTO1 ABKADDAY,ABKDMCB,WKSTART,ABKWORK,6                               
         GOTO1 ABKDATCN,ABKDMCB,(X'00',ABKWORK),(X'02',SV4DTE+2)                
         LA    R8,7(R8)                                                         
         GOTO1 ABKADDAY,ABKDMCB,WKSTART,ABKWORK,(R8)                            
         SR    R8,R8                                                            
         MVC   WKSTART,ABKWORK                                                  
         ZIC   RE,WKCNT                                                         
         MVC   BOOK,SV4DTE3                                                     
         MVC   PRLMBK,BOOK                                                      
         LA    RF,WEEKS(RE)                                                     
         LA    RE,1(RE)                                                         
*                                                                               
         CH    RE,=H'5'            DEAL WITH SPLIT WEEKS                        
         BL    *+8                                                              
         LH    RE,=H'4'                                                         
*                                                                               
         LA    R4,SV4DTE                                                        
         STC   RE,WKCNT                                                         
         B     GTABK1A                                                          
         SPACE 2                                                                
DOWKS3   MVI   WKSW,0                                                           
         MVI   WKCNT,0                                                          
         L     R4,SVR4                                                          
         LA    R4,4(R4)                                                         
         B     GTABK1                                                           
         EJECT                                                                  
ADJBOOK  CLI   DBSELBK+1,13        CURRENT YEAR                                 
         BLR   R9                                                               
         CLI   DBSELBK+1,24        PREV YEAR                                    
         BH    ADJBOOK2                                                         
         ZIC   RF,DBSELBK          INCREMENT THE YEAR                           
         LA    RF,1(RF)                                                         
         STC   RF,DBSELBK                                                       
         ZIC   RF,DBSELBK+1        ADJUST THE MONTH                             
         SH    RF,=H'12'                                                        
         STC   RF,DBSELBK+1                                                     
         BR    R9                                                               
         SPACE 2                                                                
ADJBOOK2 ZIC   RF,DBSELBK          DECREMENT THE YEAR                           
         BCTR  RF,0                                                             
         STC   RF,DBSELBK                                                       
         ZIC   RF,DBSELBK+1        ADJUST THE MONTH                             
         SH    RF,=H'24'                                                        
         STC   RF,DBSELBK+1                                                     
         BR    R9                                                               
         SPACE 1                                                                
TORMTH   NTR1                                                                   
         CLI   ABK1WPRF+8,C'M'        MONTHLY ACTIVATED                         
         BNE   TORMTHX                                                          
         LA    R5,MYDBLK                                                        
         MVC   DBSELMK,ABKSPMKT                                                 
         MVC   DBSELSTA,ABKSTAT                                                 
         OC    ABKALFM,ABKALFM                                                  
         JZ    TORALFX                                                          
         CLC   ABKALFM(2),=C'TO'                                                
         JE    *+10                                                             
         CLC   ABKALFM(2),=C'VA'                                                
         JE    *+8                                                              
         J     TORMTHX                                                          
*                                                                               
TORALFX  CLC   DBSELMK,=H'9109'                                                 
         BE    *+10                                                             
         CLC   DBSELMK,=H'5199'                                                 
         BE    *+14                                                             
         OC    DBSELMK,DBSELMK                                                  
         BNZ   TORMTHX                                                          
         CLC   DBSELSTA(4),=C'JXVA'                                             
         BNE   *+10                                                             
         MVC   DBSELSTA(4),=C'SPNP'                                             
         LA    RE,BBMTORL                                                       
         CLC   DBSELSTA+1(3),=C'TOR'  GLOBAL ETC.                               
         BE    TORMTH2A                                                         
         CLC   DBSELSTA+1(3),=C'XTO'  SPECIALTY                                 
         BE    TORMTH2A                                                         
         LA    RE,BBMVANL                                                       
         CLC   DBSELSTA+1(3),=C'VAN'  GLOBAL ETC.                               
         BE    TORMTH2A                                                         
         CLC   DBSELSTA+1(3),=C'XVA'  SPECIALTY                                 
         BE    TORMTH2A                                                         
         CLC   DBSELMK,=H'5199'    IF TORONTO SPILL ALLOW THESE                 
         BNE   TORMTHH                                                          
         CLC   DBSELSTA(4),=C'CKCO'   BECAUSE THEY ALSO HAVE A BBM HOME         
         BE    TORMTH2                IN A DIFFERENT MARKET                     
         CLC   DBSELSTA(4),=C'CKVR'                                             
         BE    TORMTH2                                                          
TORMTHH  LA    RE,BBMTORL                                                       
TORMTH1  CLI   0(RE),X'FF'         END OF ALL LISTS                             
         BE    TORMTHX             NO CSI MARKET                                
         CLC   CURRCALL(4),0(RE)                                                
         BE    TORMTH2                                                          
         LA    RE,4(RE)                                                         
         B     TORMTH1                                                          
*                                                                               
TORMTH2  LA    RF,BBMVANL-4                                                     
TORMTH2A MVI   MMBOOK,97           TORONTO START                                
         CR    RE,RF                                                            
         BL    *+8                                                              
         MVI   MMBOOK,98           VANCOUVER START                              
         LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
TORMTH3  GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R4)),(X'03',BOOK)                      
         CLC   BOOK(1),MMBOOK      OUTSIDE PERIOD IGNORE                        
         BL    TORMTHX                                                          
         MVC   0(4,R6),0(R4)                                                    
         MVC   4(2,R6),BOOK                                                     
         LA    R6,6(R6)                                                         
         LA    R4,4(R4)                                                         
         CLI   0(R4),X'FF'                                                      
         BNE   TORMTH3                                                          
*                                                                               
TORMTHX  DS    0C                                                               
*        CLC   ABKAGY,=C'O0'                                                    
*        BE    *+10                                                             
*        CLC   ABKAGY,=C'HD'                                                    
*        BE    *+10                                                             
*        CLC   ABKAGY,=C'FG'                                                    
*        BNE   TORMTHXF                                                         
         CLC   ABKAGY,=C'OU'        THESE DON'T GET CSI                         
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'MI'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'DN'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'GI'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'PY'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'S4'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'FG'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'DA'                                                    
         BE    TORMTHXF                                                         
         CLC   ABKAGY,=C'YR'                                                    
         BE    TORMTHXF                                                         
         OC    ABKALFM,ABKALFM                                                  
         JZ    CLGMTH                                                           
         CLC   ABKALFM(2),=C'CA'                                                
         JE    CLGMTH                                                           
         CLC   ABKALFM(2),=C'MF'                                                
         JE    MOFMTH                                                           
         J     TORMTHXF                                                         
*                                                                               
CLGMTH   CLC   DBSELMK,=H'8069'                                                 
         BE    *+14                                                             
         OC    DBSELMK,DBSELMK                                                  
         BNZ   CLGMTHX                                                          
CLGMTHH  LA    RE,BBMCLGL                                                       
CLGMTH1  CLI   0(RE),X'FF'         END OF ALL LISTS                             
         BE    CLGMTHX             NO CSI MARKET                                
         CLC   CURRCALL(4),0(RE)                                                
         BE    CLGMTH2                                                          
         LA    RE,4(RE)                                                         
         B     CLGMTH1                                                          
*                                                                               
CLGMTH2  DS    0C                                                               
CLGMTH2A LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
CLGMTH3  GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R4)),(X'03',BOOK)                      
         CLC   BOOK(2),=X'6509'    OUTSIDE PERIOD IGNORE                        
         BL    CLGMTHX                                                          
         MVC   0(4,R6),0(R4)                                                    
         MVC   4(2,R6),BOOK                                                     
         LA    R6,6(R6)                                                         
         LA    R4,4(R4)                                                         
         CLI   0(R4),X'FF'                                                      
         BNE   CLGMTH3                                                          
CLGMTHX  DS    0C                                                               
*                                                                               
MOFMTH   CLC   DBSELMK,=H'4480'                                                 
         BE    *+10                                                             
         CLC   DBSELMK,=H'4481'                                                 
         BE    *+14                                                             
         OC    DBSELMK,DBSELMK                                                  
         BNZ   MOFMTHX                                                          
MOFMTHH  LA    RE,BBMMOFL                                                       
MOFMTH1  CLI   0(RE),X'FF'         END OF ALL LISTS                             
         BE    MOFMTHX             NO CSI MARKET                                
         CLC   CURRCALL(4),0(RE)                                                
         BE    MOFMTH2                                                          
         LA    RE,4(RE)                                                         
         B     MOFMTH1                                                          
*                                                                               
MOFMTH2  DS    0C                                                               
MOFMTH2A LA    R4,MONLST                                                        
         LA    R6,BKLST                                                         
MOFMTH3  GOTO1 ABKDATCN,ABKDMCB,(X'02',2(R4)),(X'03',BOOK)                      
         CLC   BOOK(2),=X'650A'    OUTSIDE PERIOD IGNORE                        
         BL    MOFMTHX                                                          
         MVC   0(4,R6),0(R4)                                                    
         MVC   4(2,R6),BOOK                                                     
         LA    R6,6(R6)                                                         
         LA    R4,4(R4)                                                         
         CLI   0(R4),X'FF'                                                      
         BNE   MOFMTH3                                                          
MOFMTHX  DS    0C                                                               
TORMTHXF XIT1                                                                   
         DROP  R5                                                               
*                                                                               
MMBOOK   DC    X'00'                                                            
BBMTORL  DC    C'CBLT'                                                          
         DC    C'CFTO'                                                          
         DC    C'CITY'                                                          
         DC    C'CITN'              CITN=CITY                                   
         DC    C'NITY'                                                          
         DC    C'CFMT'                                                          
         DC    C'CFMN' ALSO CFMT                                                
         DC    C'OMN1' ALSO CFMT CSI CHANGE JAN27/03                            
         DC    C'NFMT'                                                          
*        DC    C'CKCO'                                                          
*        DC    C'CKVR'                                                          
         DC    C'WXTO'              WXTO AND CP24 ARE REALLY THE SAME           
         DC    C'CPNW'              CPNW=CP24                                   
         DC    C'CP24'                                                          
         DC    C'CTS '                                                          
         DC    C'GTOR'                                                          
         DC    C'GLBL'                                                          
         DC    C'ONTV'                                                          
         DC    C'OMNT'                                                          
         DC    C'CHCH'                                                          
         DC    C'CIII'                                                          
         DC    C'CHTV'                                                          
         DC    C'SPNP' JXTO                                                     
         DC    C'TSN '                                                          
         DC    C'WGRZ'                                                          
         DC    C'WIVB'                                                          
         DC    C'WKBW'                                                          
         DC    C'WNED'                                                          
         DC    C'WUTV'                                                          
         DC    C'NUTV'                                                          
         DC    C'TBLT' CBLT                                                     
         DC    C'TFTO' CFTO                                                     
         DC    C'TKVR' CKVR                                                     
         DC    C'WZTO' WUTV                                                     
         DC    C'TOON'                                                          
         DC    C'WTBS'                                                          
         DC    C'YTV '                                                          
*        DC    X'FF'                                                            
BBMVANL  DC    C'CBUT'                                                          
         DC    C'CHAN'                                                          
         DC    C'CHEK'                                                          
         DC    C'CIVT'                                                          
         DC    C'CTVV' WAS CIVT CSI CHANGE JAN27/03                             
         DC    C'CIVI'                                                          
*        DC    C'CKNO'                                                          
         DC    C'CKVU'                                                          
         DC    C'KCPQ'                                                          
         DC    C'KCTS'                                                          
         DC    C'KING'                                                          
         DC    C'KIRO'                                                          
         DC    C'KOMO'                                                          
         DC    C'KSTW'                                                          
         DC    C'KVOS'                                                          
         DC    C'SPNP'             JXVA                                         
         DC    C'TOON'                                                          
         DC    C'TLC '                                                          
         DC    C'WTBS'                                                          
         DC    C'YTV '                                                          
         DC    X'FF'                                                            
         DS    0F                                                               
*          DATA SET DEGETTP    AT LEVEL 150 AS OF 10/09/02                      
BBMMOFL  DC    C'ARTV'             MONTREAL FRENCH                              
         DC    C'CBFT'                                                          
         DC    C'CD  '                                                          
         DC    C'CFJP'                                                          
         DC    C'CFTM'                                                          
         DC    C'CIVM'                                                          
         DC    C'EVAS'                                                          
         DC    C'HSTA'                                                          
         DC    C'LCN '                                                          
         DC    C'MM  '                                                          
         DC    C'MMAX'                                                          
         DC    C'MP  '                                                          
         DC    C'RDI '                                                          
         DC    C'RDS '                                                          
         DC    C'SERI'                                                          
         DC    C'TOON'                                                          
         DC    C'TV5 '                                                          
         DC    C'VIE '                                                          
         DC    C'VOX '                                                          
         DC    C'Z   '                                                          
* AND DDS CALL LETTERS                                                          
         DC    C'LCD '                                                          
         DC    C'HISF'                                                          
         DC    C'METM'                                                          
         DC    C'MUSI'                                                          
         DS    C'PLUS'                                                          
         DC    C'TVC '                                                          
         DC    C'CANZ'                                                          
         DC    C'TELE'                                                          
         DC    X'FF'                                                            
BBMCLGL  DC    C'ACCS'                                                          
         DC    C'CBRT'                                                          
         DC    C'CFCN'                                                          
         DC    C'CTVC' WAS CFCN CSI CHANGE JAN27/03                             
         DC    C'CKAL'                                                          
         DC    C'GLBL'                                                          
         DC    C'CIII'                                                          
         DC    C'KAYU'                                                          
         DC    C'KHQ '                                                          
         DC    C'KREM'                                                          
         DC    C'KSPS'                                                          
         DC    C'KXLY'                                                          
         DC    C'SPNW'                                                          
         DC    C'TLC '                                                          
         DC    C'WTBS'                                                          
         DC    C'YTV '                                                          
* AND DDS CALL LETTERS                                                          
         DC    C'CICT'                                                          
         DC    C'ACCE'                                                          
         DC    X'FF'                                                            
         DS    0F                                                               
         EJECT                                                                  
BOSLST   DS    0C                                                               
         DC     C'ATT3'                                                         
         DC     C'NECN'                                                         
         DC     C'WBPX'                                                         
         DC     C'WBZ '                                                         
         DC     C'WCVB'                                                         
         DC     C'WENH'                                                         
         DC     C'WFXT'                                                         
         DC     C'WGBH'                                                         
         DC     C'WGBX'                                                         
         DC     C'WHDH'                                                         
         DC     C'WLVI'                                                         
         DC     C'WMUR'                                                         
         DC     C'WNDS'                                                         
         DC     C'WSBK'                                                         
         DC    X'FF'                                                            
         EJECT                                                                  
BLDSWP   DS    0H                                                               
         BAS   R9,OLYOPT           CHECK OLYMPICS                               
         BAS   R9,OLYAPR                                                        
         LA    R5,BKLST                                                         
BLDSWP1  CLI   6(R5),0                                                          
         BE    BLDOUT                                                           
         CLI   4(R5),0             NO BOOK TRY NEXT                             
         BE    BLDSWP4                                                          
         CLC   4(2,R5),10(R5)      SAME BOOK                                    
         BNE   *+12                                                             
         LA    R5,6(R5)                                                         
         B     BLDSWP1                                                          
*                                                                               
* FIND END DATE OF PREVIOUS SWEEP BOOK                                          
         L     R6,=A(SWEEPTAB)                                                  
         A     R6,RELO                                                          
BLDSWP2  CLI   0(R6),0                                                          
         BE    BLDSWP4                                                          
         CLC   MYFMS,0(R6)                                                      
         BE    *+12                                                             
BLDSWP3  LA    R6,L'SWEEPTAB(R6)                                                
         B     BLDSWP2                                                          
*                                                                               
         CLC   4(2,R5),3(R6)       COMPARE BOOKS                                
         BNE   BLDSWP3                                                          
         MVC   ABKWORK(6),6(R6)    SET END DATE                                 
         GOTO1 ABKDATCN,ABKDMCB,(X'00',ABKWORK),(2,ABKWORK+6)                   
         CLC   2(2,R5),ABKWORK+6   DATE ENDS BEFORE BOOK STARTS                 
         BL    BLDSWP4                                                          
         GOTO1 ABKADDAY,ABKDMCB,ABKWORK,ABKWORK+6,27                            
         MVC   ABKWORK(6),ABKWORK+6                                             
         GOTO1 ABKADDAY,ABKDMCB,ABKWORK,ABKWORK+6,1                             
         GOTO1 ABKDATCN,ABKDMCB,(X'00',ABKWORK),(2,ABKWORK+12)                  
         CLC   2(2,R5),ABKWORK+12  IF DATES WIDER THAN BOOK                     
         BH    BLDSWP4             LEAVE ALONE                                  
         MVC   2(2,R5),ABKWORK+12                                               
         GOTO1 ABKDATCN,ABKDMCB,(X'00',ABKWORK+6),(2,6(R5))                     
BLDSWP4  LA    R5,6(R5)                                                         
         B     BLDSWP1                                                          
*                                                                               
BLDOUT   MVC   CURRDTES,ABKBDAT                                                 
         MVC   BKLST(2),ABKBDAT    RESET THE START DATE                         
         LA    RE,BKLST                                                         
         LA    RF,ABKOLIST                                                      
BLDOUT2  XC    0(6,RF),0(RF)       SET ENTRY TO ZERO                            
         CLI   0(RE),0                                                          
         BE    EXITX                                                            
         CLC   CURRDTES+2(2),0(RE) END LT. START                                
         BL    EXITX                                                            
         CLC   CURRDTES(2),2(RE)   START GT. END                                
         BH    BLDOUT3                                                          
         MVC   0(6,RF),0(RE)                                                    
         CLC   ABKBOOK(3),=C'ACT'                                               
         BNE   BLDOUT2F                                                         
BLDOUT2A DS    0C                                                               
*                                                                               
         CLI   BOOKTYPE,0                                                       
         BNE   SUMOX                                                            
         CLI   ABKMED,C'T'         NOT OLY IF NOT USTV                          
         BNE   SUMOX                                                            
         CLC   4(2,RF),=X'6007'    DEAL WITH SUMMER 1996 OPT                    
         BNE   SUMOX                                                            
         CLC   2(2,RF),=X'C107'    IF TOTALLY IN SWEEP LEAVE ALONE              
         BH    SUMO1                                                            
         CLC   0(2,RF),=X'C0EA'                                                 
         BNL   SUMOX                                                            
*                                                                               
SUMO1    DS    0H                  OLYMPIC EXCLUSION                            
         CLI   ABKRRTYP,C'I'        FOR AFFIDS                                  
         BNE   SUMO1B                                                           
         CLI   ABKD0PRF+7,C'J'      IF "USE OLYMPIC EXCLUSION" ON               
         BE    SUMO1_02                                                         
         CLI   ABKD0PRF+7,C'Y'      IF "USE OLYMPIC EXCLUSION" ON               
         BNE   SUMO1B                                                           
SUMO1_02 EQU   *                                                                
         MVC   BOOK,4(RF)                                                       
         STM   RE,RF,SVEF                                                       
         BAS   RE,HASOLYEX          IF STATION HAS OLYMP EXCL TAPE              
         LM    RE,RF,SVEF                                                       
         BNE   SUMO1B                                                           
         B     SUMOX                                                            
*                                                                               
SUMO1B   DS    0H                                                               
         CLI   ABKD0PRF+6,C'M'     SEND IT TO MAY/96                            
         BNE   *+14                                                             
         MVC   4(2,RF),=X'6005'                                                 
         B     SUM01OK                                                          
*                                                                               
         CLI   ABKD0PRF+6,C'J'     SEND IT TO JUL/95                            
         BNE   SUMOX                                                            
         MVC   4(2,RF),=X'5F07'                                                 
*                                                                               
SUM01OK  CLC   0(2,RF),=X'C0EA'                                                 
         BH    SUM02                                                            
         CLC   2(2,RF),=X'C0EA'                                                 
         BNH   SUM02                                                            
         MVC   6(6,RF),0(RF)                                                    
         MVC   2(2,RF),=X'C0EA'                                                 
         LA    RF,6(RF)                                                         
         MVC   0(2,RF),=X'C0EB'                                                 
         MVC   4(2,RF),=X'6007'                                                 
         B     SUMOX                                                            
*                                                                               
SUM02    CLC   2(2,RF),=X'C107'                                                 
         BNH   SUMOX                                                            
         CLC   0(2,RF),=X'C107'                                                 
         BH    SUMOX                                                            
         MVC   6(6,RF),0(RF)                                                    
         MVC   2(2,RF),=X'C107'                                                 
         MVC   4(2,RF),=X'6007'                                                 
         LA    RF,6(RF)                                                         
         MVC   0(2,RF),=X'C108'                                                 
*                                                                               
SUMOX    CLI   ABKBOOK+3,C' '      CAN HAVE A BINARY YEAR                       
         BE    BLDOUT2F                                                         
         OC    4(2,RF),4(RF)                                                    
         BZ    BLDOUT2F                                                         
         MVC   4(1,RF),ABKBOOK+3                                                
BLDOUT2F LA    RF,6(RF)                                                         
BLDOUT3  LA    RE,6(RE)                                                         
         B     BLDOUT2                                                          
         EJECT                                                                  
OLYOPT   L     RE,J88PTR           JAN USING FEB ALWAYS TO NOV/91               
         LTR   RE,RE                                                            
         BZ    OLYOPT2                                                          
         CLC   4(2,RE),=X'6602'    ONLY IF FEB/02                               
         BNE   *+10                                                             
         MVC   4(2,RE),=X'650B'    USE NOV/01                                   
         CLC   4(2,RE),=X'6202'    ONLY IF FEB/98                               
         BNE   OLYOPT2                                                          
         MVC   4(2,RE),=X'610B'    USE NOV/97                                   
         CLC   4(2,RE),=X'5E02'    ONLY IF FEB/94                               
         BNE   OLYOPT2                                                          
         MVC   4(2,RE),=X'5D0B'    USE NOV/93                                   
         CLC   4(2,RE),=X'5C02'    ONLY IF FEB/92                               
         BNE   OLYOPT2                                                          
         MVC   4(2,RE),=X'5B0B'    USE NOV/91                                   
         CLI   ABKOPT1,C'1'                                                     
         BNE   OLYOPT2                                                          
*---->   MVC   4(2,RE),=X'5C02'                                                 
         MVC   4(2,RE),=X'5E02'                                                 
*                                                                               
OLYOPT2  L     RE,M88PTR                                                        
         LTR   RE,RE                                                            
         BZR   R9                  NO MARCH JUST EXIT                           
         CLC   4(2,RE),=X'5C02'    TRYING TO DO FEB/92                          
         BNE   OLYOPT24                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BE    *+8                                                              
         CLI   SVMENU,2            WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/92 OR NOV/91                      
         MVC   4(2,RE),=X'5B0B'    YES - USE NOV/91                             
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=X'5C02'                                                 
         BR    R9                                                               
*                                                                               
OLYOPT24 CLC   4(2,RE),=X'5E02'    TRYING TO DO FEB/94                          
         BNE   OLYOPT28                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BE    *+8                                                              
         CLI   SVMENU,2            WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/94 OR NOV/93                      
         MVC   4(2,RE),=X'5D0B'    YES - USE NOV/93                             
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=X'5E02'                                                 
         BR    R9                                                               
*                                                                               
OLYOPT28 CLC   4(2,RE),=X'6202'    TRYING TO DO FEB/98                          
         BNE   OLYOPT29                                                         
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
*        BE    *+8                  TAKEN OUT 7/28/98 PER LISA                  
         BNE   OLYOPT3              PUT IN 7/28/98 PER LISA                     
         CLI   SVMENU,2            WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/98 OR NOV/97                      
         MVC   4(2,RE),=X'610B'    YES - USE NOV/97                             
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=X'6202'                                                 
         BR    R9                                                               
*                                                                               
OLYOPT29 CLC   4(2,RE),=X'6602'    TRYING TO DO FEB/02                          
         BNER  R9                                                               
         CLI   ABKOPT1,C'2'        COKE/MCCANN - USE NOV NOT JAN                
         BNE   OLYOPT3                                                          
         CLI   SVMENU,2            WAS IT A FORCE                               
         BNE   OLYOPT3             SELECT JAN/98 OR NOV/97                      
         MVC   4(2,RE),=X'650B'    YES - USE NOV/01                             
         CLI   ABKOPT1,C'1'        CPPRS OLY SPECIAL                            
         BNER  R9                                                               
         MVC   4(2,RE),=X'6602'                                                 
         BR    R9                                                               
*                                                                               
OLYOPT3  LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         CLI   4(RE),X'5E'         1994 OPTION                                  
         BE    OLYOPT34                                                         
         CLI   4(RE),X'66'         2002 OPTION                                  
         BE    OLYOPT39                                                         
         CLI   4(RE),X'62'         1998 OPTION                                  
         BE    OLYOPT38                                                         
         CLI   MYFMS+2,C'A'                                                     
         BNE   *+8                                                              
         LA    RF,ARBJAN92                                                      
         MVC   4(2,RE),=X'5B0B'    PRESET TO NOV/91                             
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=X'5C02'    PRESET TO FEB/92                             
         B     OLYOPT4                                                          
*                                                                               
OLYOPT34 LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=X'5D0B'    PRESET TO NOV/93                             
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=X'5E02'    PRESET TO FEB/94                             
         B     OLYOPT4                                                          
*                                                                               
OLYOPT38 LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=X'610B'    PRESET TO NOV/97                             
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=X'6202'    PRESET TO FEB/94                             
         B     OLYOPT4                                                          
*                                                                               
OLYOPT39 LA    RF,NSIJAN92         POINT TO JAN MARKET LIST                     
         MVC   4(2,RE),=X'650B'    PRESET TO NOV/01                             
         CLI   ABKOPT1,C'1'        CPPRS                                        
         BNE   *+10                                                             
         MVC   4(2,RE),=X'6602'    PRESET TO FEB/02                             
         B     OLYOPT4                                                          
*                                                                               
OLYOPT4  CLC   0(2,RF),=X'FFFF'                                                 
         BER   R9                                                               
         CLC   OLYMKT,0(RF)                                                     
         BE    OLYOPT6                                                          
         LA    RF,2(RF)                                                         
         B     OLYOPT4                                                          
*LYOPT6  MVC   4(2,RE),=X'5C01'    HAVE A JAN BOOK - USE IT                     
*LYOPT6  MVC   4(2,RE),=X'5E01'    HAVE A JAN BOOK - USE IT                     
*LYOPT6  MVC   4(2,RE),=X'6201'    HAVE A JAN BOOK - USE IT                     
OLYOPT6  MVC   4(2,RE),=X'6601'    HAVE A JAN BOOK - USE IT                     
         BR    R9                                                               
*                                                                               
OLYAPR   L     RE,M88PTR           SOME TABLES SEND APR TO FEB                  
         LTR   RE,RE                                                            
         BZR   R9                                                               
OLYAPR2  CLI   0(RE),0             END OF LIST                                  
         BER   R9                                                               
         CLC   4(2,RE),=X'6602'    FEB/02 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   4(2,RE),=X'6202'    FEB/98 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   4(2,RE),=X'5E02'    FEB/94 BOOK NEEDS AN OVERRIDE                
         BE    *+10                                                             
         CLC   4(2,RE),=X'5C02'    FEB/92 BOOK NEEDS AN OVERRIDE                
         BNE   *+14                                                             
         L     RF,M88PTR           USE THE MARCH BOOK FOR THIS                  
         MVC   4(2,RE),4(RF)                                                    
         LA    RE,6(RE)                                                         
         B     OLYAPR2                                                          
         EJECT                                                                  
***********************************************************************         
*=============== CHECK IF STATION HAS OLYMPIC EXCLUSION ==============*         
                                                                                
* AT ENTRY,                                                                     
*   CURRCALL = STATION CALL LETTERS                                             
*   BOOK     = BOOK TO LOOK UP FOR STATION                                      
* AT EXIT,                                                                      
*   CCEQUAL  ==> STATION HAS OLYM EXLC TAPE                                     
*   CCNEQUAL ==> ALL OTHER CONDITIONS                                           
                                                                                
HASOLYEX NTR1                                                                   
         LA    R5,MYDBLK                                                        
         USING DBLOCK,R5                                                        
         XC    DBLOCK,DBLOCK                                                    
                                                                                
*                                                                               
         MVC   DBSELBK,BOOK             SET BOOK                                
                                                                                
         CLI   ABKMED,C'T'                                                      
         BNE   HASOXX                                                           
         MVC   DBSELMED,ABKMED          SET MEDIA                               
                                                                                
         MVI   DBSELSRC,C'N'            ASSUME NIELSEN                          
         CLI   ABKSRC,C'N'               SET TO NIELSEN?                        
         BE    HASOX029                   YES                                   
         CLI   DBSELBK,X'5E'              NO, SET TO ARBITRON                   
         BNL   HASOX029                    UNLESS BOOK >= 1994                  
         MVI   DBSELSRC,C'A'                                                    
HASOX029 EQU   *                                                                
                                                                                
         MVC   DBFILE,=C'TP '           SET FILE                                
         MVC   DBCOMFCS,ABKCMFAC                                                
         MVC   DBSELSTA,CURRCALL        SET STATION                             
         MVC   DBSELAGY,ABKAGY          SET AGENCY                              
         MVC   DBSELCLI,ABKCLT          SET CLIENT                              
         MVI   DBBTYPE,C'O'             LOOK FOR OLYMP EXCL TAPE                
         MVI   DBFUNCT,DBVLSTBK         VALIDATE STTN/BOOK                      
         L     RE,=A(DEMREC)                                                    
         A     RE,RELO                                                          
         ST    RE,DBAREC                SET ADDRESS OF I/O AREA                 
         GOTO1 ABKDEMND,ABKDMCB,MYDBLK,0                                        
         B     HASOXX                                                           
                                                                                
*                                                                               
HASOXX   DS    0H                                                               
         CLI   DBERROR,0           X'00' ==> STATION HAS OLYM EXCL TAPE         
         XIT1                                                                   
         DROP  R5                                                               
***********************************************************************         
         EJECT                                                                  
EXIT     MVC   ABKOLIST(180),BKLST                                              
*        MVC   STA,CURRCALL                                                     
EXITX    XMOD1 1                                                                
         SPACE 1                                                                
CLEARIT  XC    SVAREA,SVAREA      CLEAR SAVED VALUES AT REQ. FIRST              
         B     EXITX                                                            
RLHOOK   NTR1                      FLAG ACTIVE RADIO BOOKS                      
         USING DBLOCK,R5                                                        
*                                                                               
         CLC   DBACTKMK,=H'269'    MCALLEN DROPPED BOOKS                        
         BNE   *+12                                                             
         MVI   RADBOOK,X'50'                                                    
         B     RLHOOKX                                                          
*                                                                               
         CLI   DBACTBK+1,2                                                      
         BNE   *+8                                                              
         OI    RADBOOK,B'10000000'                                              
         CLI   DBACTBK+1,5                                                      
         BNE   *+8                                                              
         OI    RADBOOK,B'01000000'                                              
         CLI   DBACTBK+1,7                                                      
         BNE   *+8                                                              
         OI    RADBOOK,B'00100000'                                              
         CLI   DBACTBK+1,11                                                     
         BNE   *+8                                                              
         OI    RADBOOK,B'00010000'                                              
RLHOOKX  XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
* TABLE OF NSI ATLANTA STATIONS FOR OCT/92 MISSING BOOK                         
ATLSTA   DC    C'WAGA'                                                          
         DC    C'WATL'                                                          
         DC    C'WGNX'                                                          
         DC    C'WGTV'                                                          
         DC    C'WPBA'                                                          
         DC    C'WSB '                                                          
         DC    C'WTBS'                                                          
         DC    C'WVEU'                                                          
         DC    C'WXIA'                                                          
         DC    X'FF'                                                            
*                                                                               
* THESE TABLES ARE USED FOR RADIO ACTUAL BOOKS                                  
* LIMITS MUST BE SET FOR BOOKS EVEN THOUGH LATEST IS USED TO                    
* DETERMINE WHICH BOOKS APPLY.                                                  
RADFILT  DC    X'40',AL1(05,05,05,05,05,05,05,05,05,05,05,05)                   
         DC    X'50',AL1(11,11,11,05,05,05,05,05,05,11,11,11)                   
         DC    X'70',AL1(11,11,11,05,05,05,07,07,07,11,11,11)                   
         DC    X'F0',AL1(02,02,02,05,05,05,07,07,07,11,11,11)                   
****THE FOLLOWING ENTRIES COVER NEW STATIONS WITH INCOMPLETE DATA               
         DC    X'10',AL1(11,11,11,00,00,00,00,00,00,11,11,11)                   
         DC    X'30',AL1(11,11,11,00,00,00,07,07,07,11,11,11)                   
         DC    X'60',AL1(00,00,00,05,05,05,07,07,07,00,00,00)                   
         DC    X'B0',AL1(02,02,02,00,00,00,07,07,07,11,11,11)                   
         DC    X'90',AL1(02,02,02,00,00,00,00,00,00,11,11,11)                   
         DC    X'D0',AL1(02,02,02,05,05,05,00,00,00,11,11,11)                   
         DC    X'FF'                                                            
*                                                                               
* THESE TABLES ARE USED FOR THE 1988 SPECIAL OLYMPIC OPTION                     
NSIJAN88 DC    AL2(168,112,106,202,115,110,105,216,403,128,217)                 
         DC    AL2(213,101,104,108,407,209,111)                                 
         DC    X'FFFF'                                                          
NSIMAR88 DC    AL2(106,202,403,101,104)                                         
         DC    X'FFFF'                                                          
ARBJAN88 DC    AL2(197,21,3,51,93,35,109,57,201,83,157,13,127,111)              
         DC    AL2(107,9,11,29,65,105,75,19)                                    
         DC    X'FFFF'                                                          
ARBMAR88 DC    AL2(3,51,13,9,11)                                                
         DC    X'FFFF'                                                          
*                                                                               
* THESE TABLES ARE USED FOR THE 1992 SPECIAL OLYMPIC OPTION                     
NSIJAN92 DC    AL2(168,112,106,202,115,105,216,403,128,217)                     
         DC    AL2(213,101,104,108,407,209,111)                                 
         DC    X'FFFF'                                                          
NSIMAR92 DC    AL2(202,403,101,104)                                             
         DC    X'FFFF'                                                          
ARBJAN92 DC    AL2(197,21,3,51,93,35,109,57,201,83,157,13,127,111)              
         DC    AL2(9,11,65,19)                                                  
         DC    X'FFFF'                                                          
ARBMAR92 DC    AL2(3,51,13,9,11)                                                
         DC    X'FFFF'                                                          
*                                                                               
DEFAULT  DC    AL1(1,3,3,3,3,7,7,7,11,11,11,11)                                 
*                                                                               
FEB02SL  DC    CL4'WGRZ'           BUFFALO                                      
         DC    CL4'WIVB'                                                        
         DC    CL4'WKBW'                                                        
         DC    CL4'WNGS'                                                        
         DC    CL4'WNLO'                                                        
         DC    CL4'WNYO'                                                        
         DC    CL4'WPXJ'                                                        
         DC    CL4'WUTV'                                                        
         DC    CL4'KCTV'           KANSAS CITY                                  
         DC    CL4'KCWE'                                                        
         DC    CL4'KMBC'                                                        
         DC    CL4'KMCI'                                                        
         DC    CL4'KPXE'                                                        
         DC    CL4'KSHB'                                                        
         DC    CL4'KSMO'                                                        
         DC    CL4'WDAF'                                                        
         DC    CL4'KAUT'           OAKLAHOMA CITY                               
         DC    CL4'KFOR'                                                        
         DC    CL4'KOCB'                                                        
         DC    CL4'KOCO'                                                        
         DC    CL4'KOKH'                                                        
         DC    CL4'KOPX'                                                        
         DC    CL4'KSBI'                                                        
         DC    CL4'KTBO'                                                        
         DC    CL4'KWTV'                                                        
         DC    CL4'ZN53'                                                        
         DC    X'FF'                                                            
         EJECT                                                                  
RADBOOK  DS    C                                                                
RELO     DC    F'0'                                                             
J88PTR   DS    F                                                                
M88PTR   DS    F                                                                
SVD0PROF DS    CL16                                                             
OLYMKT   DS    CL2                                                              
BRDDATE  DS    CL12                                                             
CURRAREA DS    0CL30                                                            
CURRMKT  DS    CL2                                                              
CURRCALL DS    CL5                                                              
CURRCLT  DS    CL3                                                              
CURRBOOK DS    CL5                                                              
CURRDATE DS    CL12                                                             
CURRFMS  DS    CL3                                                              
SVAREA   DS    CL30                                                             
SVPARAM  DS    5F                                                               
SPILCAP  EQU   SVPARAM+12                                                       
SPILMKT  EQU   SVPARAM+16                                                       
SVMENU   DS    CL39                                                             
MYMCLASS DS    C                   SAVE SWEEP CLASS                             
BOOKTYPE DS    C                   BOOK TYPE                                    
HOLDBOOK DS    C                                                                
LACTTAB  DC    F'39'               LENGTH OF ACTUAL TABLE                       
MYKEY    DS    CL30                                                             
CURRDTES DS    CL4                                                              
BOOK     DS    CL2                                                              
         ORG   BOOK                                                             
BBOOK    DS    CL2                                                              
FBOOK    DS    CL2                                                              
PRLMBK   DS    CL2                                                              
MYDUB    DS    D                                                                
MYFULL   DS    F                                                                
MYFMS    DS    CL3                                                              
WKSTART  DS    CL6                                                              
WKEND    DS    CL6                                                              
SV4DTE3  DS    CL3                                                              
SV4DTE   DS    CL4                                                              
WEEKS    DS    CL5                                                              
WKCNT    DS    C                                                                
WKSW     DS    C                                                                
SVR4     DS    F                                                                
SVEF     DS    CL8                                                              
SPOLYOPT DS    C                                                                
MYDBLK   DS    XL256                                                            
         DS    XL10                                                             
MONLST   DS    CL100                                                            
BKLST    DS    CL200                                                            
********EXTERNAL DATA*********************************                          
ABKDMCB  DS    6F                                                               
ABKDUB   DS   D                                                                 
ABKWORK  DS    CL17                                                             
*******************************************************                         
         EJECT                                                                  
       ++INCLUDE SPSWPTABS                                                      
DEMREC   DS    CL1100                                                           
*                                                                               
* STATION CALL LETTER CHANGE LIST-ENTRIES MUST BE IN ALPHA STATION              
*  ORDER. LIST ENTRY=11 BYTES. BYTE 0=(N)NSI,(A)ARB,OR (B)BOTH                  
*                              BYTE 1-2=EFFECTIVE BOOK (YEAR-MONTH)             
*                              BYTE 3-10=FIRST 4(OLD) LAST 4(NEW)               
*                                                                               
         EJECT                                                                  
       ++INCLUDE SPABKBLOCK                                                     
       ++INCLUDE SPSWPTABSD                                                     
       ++INCLUDE DEDBLOCK                                                       
       ++INCLUDE DEDEMEQUS                                                      
         PRINT OFF                                                              
*        INCLUDE SPREPWORKD                                                     
       ++INCLUDE SPREPMODES                                                     
       ++INCLUDE DEDEMFILE                                                      
       ++INCLUDE SPGENMKT                                                       
       ++INCLUDE SPGENSTA                                                       
       ++INCLUDE SPGENCLT                                                       
       ++INCLUDE SPGENAGY                                                       
       ++INCLUDE SPGENBUY                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'001SPACTBKCAN03/24/03'                                      
         END                                                                    

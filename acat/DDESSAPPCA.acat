*          DATA SET DDESSAPPCA AT LEVEL 150 AS OF 10/16/97                      
*CATALP ESSAPPCA                                                                
         TITLE 'ESSAPPC  - HOSTESS APPC/MVS FACILTIES'                          
**********************************************************************          
* ESSAPPC - HOSTESS APPC/MVS INTERFACE FACILTIES                     *          
* PARAMETERS:                                                        *          
*                                                                    *          
* ENTRY:                                                             *          
* AL4 =A(ESSATC CONTROL BLOCK)                                       *          
* AL4 =A(ESSAPPC CSECT)                                              *          
**********************************************************************          
         SPACE 1                                                                
         PRINT NOGEN                                                            
ESSAPPC  CSECT                                                                  
         NMOD1 WORKX-WORKD,**APPC**,CLEAR=YES,RA,R9                             
         USING WORKD,RC                                                         
         ST    R1,APARM                                                         
         B     INIT                                                             
         SPACE 1                                                                
**********************************************************************          
* INITIALISE                                                         *          
**********************************************************************          
         SPACE 1                                                                
INIT     EQU   *                                                                
         MVC   PARM,0(R1)                                                       
         LM    R7,R8,0(R1)                                                      
         USING ESSAPPCD,R8                                                      
         BZ    ERROR01                                                          
         USING ESSATCD,R7                                                       
         ICM   R6,15,EATFACS                                                    
         USING ESSFACSD,R6                                                      
         ICM   R5,15,ACPRINT                                                    
         USING DPRINT,R5                                                        
         MVC   ESSP,SPACES                                                      
         B     PROCESS                                                          
*                                                                               
EXIT     L     R1,APARM            EXIT WITH UPDATED PARAMETER LIST             
         MVC   0(L'PARM,R1),PARM                                                
         XMOD1 1                                                                
         EJECT                                                                  
**********************************************************************          
* MAIN PROCESS ROUTINE                                               *          
**********************************************************************          
         SPACE 1                                                                
PROCESS  EQU   *                                                                
*                                                                               
         OC    APPCACTN,APPCACTN                                                
         BZ    PROCINIT                                                         
         CLC   APPCACTN,=CL8'ATBALC2 '                                          
         BE    PROCALC2                                                         
         CLC   APPCACTN,=CL8'ATBAMR1 '                                          
         BE    PROCAMR1                                                         
         CLC   APPCACTN,=CL8'ATBCFM  '                                          
         BE    PROCCFM                                                          
         CLC   APPCACTN,=CL8'ATBCFMD '                                          
         BE    PROCCFMD                                                         
         CLC   APPCACTN,=CL8'ATBDEAL '                                          
         BE    PROCDEAL                                                         
         CLC   APPCACTN,=CL8'ATBGTA2 '                                          
         BE    PROCGTA2                                                         
         CLC   APPCACTN,=CL8'ATBPOR2 '                                          
         BE    PROCPOR2                                                         
         CLC   APPCACTN,=CL8'ATBPTR  '                                          
         BE    PROCPTR                                                          
         CLC   APPCACTN,=CL8'ATBRAL2 '                                          
         BE    PROCRAL2                                                         
         CLC   APPCACTN,=CL8'ATBRCVI '                                          
         BE    PROCRCVI                                                         
         CLC   APPCACTN,=CL8'ATBRCVW '                                          
         BE    PROCRCVW                                                         
         CLC   APPCACTN,=CL8'ATBRFA2 '                                          
         BE    PROCRFA2                                                         
         CLC   APPCACTN,=CL8'ATBRJC2 '                                          
         BE    PROCRJC2                                                         
         CLC   APPCACTN,=CL8'ATBRTS  '                                          
         BE    PROCRTS                                                          
         CLC   APPCACTN,=CL8'ATBSEND '                                          
         BE    PROCSEND                                                         
         CLC   APPCACTN,=CL8'ATBSERR '                                          
         BE    PROCSERR                                                         
         CLC   APPCACTN,=CL8'ATBURA2 '                                          
         BE    PROCURA2                                                         
         CLC   APPCACTN,=CL8'ATBEES3 '                                          
         BE    PROCEES3                                                         
         DC    H'0'                UNKNOWN ACTION CODE                          
**********************************************************************          
* INITIALISATION                                                     *          
**********************************************************************          
         SPACE 1                                                                
PROCINIT EQU   *                                                                
*                                                                               
         BLDL  0,ENTRYPTS            BUILD LIST OF APPC/MVS ENTRY PTS           
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                  BAD RETURN FROM BLDL MACRO                 
*                                                                               
         BAS   RE,INITALC2                                                      
         BAS   RE,INITAMR1                                                      
         BAS   RE,INITCFM                                                       
         BAS   RE,INITCFMD                                                      
         BAS   RE,INITDEAL                                                      
         BAS   RE,INITGTA2                                                      
         BAS   RE,INITPOR2                                                      
         BAS   RE,INITPTR                                                       
         BAS   RE,INITRAL2                                                      
         BAS   RE,INITRCVI                                                      
         BAS   RE,INITRCVW                                                      
         BAS   RE,INITRFA2                                                      
         BAS   RE,INITRJC2                                                      
         BAS   RE,INITRTS                                                       
         BAS   RE,INITSEND                                                      
         BAS   RE,INITSERR                                                      
         BAS   RE,INITURA2                                                      
         BAS   RE,INITEES3                                                      
*                                                                               
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBRFA2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCRFA2 EQU   *                                                                
         LA    RE,ATB_STRUCTURE                                                 
         L     R0,=A(ATBRFA2_STRUCTURE)                                         
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SYM_DEST_NAME                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TPNAMELN                                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TP_NAME                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,LOCAL_LU_NAME                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PARTNER_LU_NAME                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,USER_ID                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PROFILE                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ALLOCATE_QUEUE_TOKEN                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REASON_CODE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBRJC2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCRJC2 EQU   *                                                                
         LA    RE,ATB_STRUCTURE                                                 
         L     R0,=A(ATBRJC2_STRUCTURE)                                         
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,DEALLOCATE_SENSE_CODE                                         
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REASON_CODE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBURA2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCURA2 EQU   *                                                                
         L     R0,=A(ATBURA2_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ALLOCATE_QUEUE_TOKEN                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REASON_CODE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBRAL2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCRAL2 EQU   *                                                                
         L     R0,=A(ATBRAL2_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ALLOCATE_QUEUE_TOKEN                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RECEIVE_ALLOCATE_TYPE                                         
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TIME_OUT_VALUE                                                
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_TYPE                                             
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PARTNER_LU_NAME                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,MODE_NAME                                                     
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SYNC_LEVEL                                                    
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,USER_ID                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PROFILE                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REASON_CODE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBALC2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCALC2 EQU   *                                                                
         L     R0,=A(ATBALC2_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_TYPE                                             
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SYM_DEST_NAME                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PARTNER_LU_NAME                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,MODE_NAME                                                     
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TPNAMELN                                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TP_NAME                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RETURN_CONTROL                                                
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SYNC_LEVEL                                                    
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SECURITY_TYPE                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,USER_ID                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PASSWORD                                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PROFILE                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,USER_TOKEN                                                    
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TPID                                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,LOCAL_LU_NAME                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBPTR ACTION CALL                                         *          
**********************************************************************          
         SPACE 1                                                                
PROCPTR  EQU   *                                                                
         L     R0,=A(ATBPTR_STRUCTURE)                                          
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PREP_TO_RECEIVE_TYPE                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,LOCKS                                                         
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBAMR1 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCAMR1 EQU   *                                                                
         L     R0,=A(ATBAMR1_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,FUNCTION                                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ASYNCHRONOUS_NUMBER                                           
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBRCVI ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCRCVI EQU   *                                                                
         L     R0,=A(ATBRCVI_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,FILL                                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RECEIVE_LENGTH                                                
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RECEIVE_ACCESS_TOKEN                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         ICM   RF,15,AAPPCBUF                                                   
*        LA    RF,APPC_BUFFER_LENGTH                                            
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,STATUS_RECEIVED                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,DATA_RECEIVED                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REQUEST_TO_SEND_RECEIVED                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBRCVW ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCRCVW EQU   *                                                                
         L     R0,=A(ATBRCVW_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,FILL                                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RECEIVE_LENGTH                                                
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RECEIVE_ACCESS_TOKEN                                          
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         ICM   RF,15,AAPPCBUF                                                   
*        LA    RF,APPC_BUFFER_LENGTH                                            
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,STATUS_RECEIVED                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,DATA_RECEIVED                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REQUEST_TO_SEND_RECEIVED                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBRTS ACTION CALL                                         *          
**********************************************************************          
         SPACE 1                                                                
PROCRTS  EQU   *                                                                
         L     R0,=A(ATBRTS_STRUCTURE)                                          
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBDEAL ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCDEAL EQU   *                                                                
         L     R0,=A(ATBDEAL_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,DEALLOCATE_TYPE                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBSEND ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCSEND EQU   *                                                                
         L     R0,=A(ATBSEND_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SEND_TYPE                                                     
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SEND_LENGTH                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SEND_ACCESS_TOKEN                                             
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         ICM   RF,15,AAPPCBUF                                                   
*        LA    RF,APPC_BUFFER_LENGTH                                            
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REQUEST_TO_SEND_RECEIVED                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBSERR ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCSERR EQU   *                                                                
         L     R0,=A(ATBSERR_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REQUEST_TO_SEND_RECEIVED                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ERROR_DIRECTION                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBGTA2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCGTA2 EQU   *                                                                
         L     R0,=A(ATBGTA2_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PARTNER_LU_NAME                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,MODE_NAME                                                     
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SYNC_LEVEL                                                    
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_CORRELATOR                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,LUW_ID                                                        
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TPNAMELN                                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,TP_NAME                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,LOCAL_LU_NAME                                                 
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_TYPE                                             
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,USER_ID                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,PROFILE                                                       
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,USER_TOKEN                                                    
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,CONVERSATION_STATE                                            
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBPOR2 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCPOR2 EQU   *                                                                
         L     R0,=A(ATBPOR2_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,POST_ON_RECEIPT_ECB                                           
         ST    RF,0(RE)                                                         
         ICM   RF,15,0(RF)                                                      
         XC    0(4,RF),0(RF)                                                    
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBCFM ACTION CALL                                         *          
**********************************************************************          
         SPACE 1                                                                
PROCCFM  EQU   *                                                                
         L     R0,=A(ATBCFM_STRUCTURE)                                          
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REQUEST_TO_SEND_RECEIVED                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBCFMD ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCCFMD EQU   *                                                                
         L     R0,=A(ATBCFMD_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,NOTIFY_TYPE                                                   
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RTN_CODE                                                      
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* PROCESS ATBEES3 ACTION CALL                                        *          
**********************************************************************          
         SPACE 1                                                                
PROCEES3 EQU   *                                                                
         L     R0,=A(ATBEES3_STRUCTURE)                                         
         LA    RE,ATB_STRUCTURE                                                 
         LA    R1,L'ATB_STRUCTURE                                               
         LR    RF,R1                                                            
         MVCL  RE,R0                                                            
         LA    RE,ATB_STRUCTURE                                                 
         LA    RE,20(RE)                                                        
         LA    RF,CONVERSATION_ID                                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SERVICE_NAME                                                  
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,SERVICE_REASON_CODE                                           
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,MESSAGE_TEXT_LENGTH                                           
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,MESSAGE_TEXT                                                  
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ERROR_LOG_PRODUCT_SET_ID_LENGTH                               
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ERROR_LOG_PRODUCT_SET_ID                                      
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ERROR_LOG_INFORMATION_LENGTH                                  
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,ERROR_LOG_INFORMATION                                         
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,REASON_CODE_ERROR_EXTRACT                                     
         ST    RF,0(RE)                                                         
         LA    RE,4(RE)                                                         
         LA    RF,RETURN_CODE_ERROR_EXTRACT                                     
         ST    RF,0(RE)                                                         
         MVI   0(RE),X'80'                                                      
         GOTO1 CALLAPPC,ATB_STRUCTURE                                           
         B     RETURN                                                           
         EJECT                                                                  
**********************************************************************          
* RETURN TO CALLER                                                   *          
**********************************************************************          
         SPACE 1                                                                
RETURN   EQU   *                                                                
         B     EXIT                EXIT TO CALLER                               
ERROR01  EQU   *                                                                
         DC    H'0'                                                             
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBRFA2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITRFA2 NTR1                                                                   
         LOAD  DE=ATBRFA2                                                       
         L     RE,=A(ATBRFA2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'REG_FOR_ALLOCATE'                                 
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBRJC2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITRJC2 NTR1                                                                   
         LOAD  DE=ATBRJC2                                                       
         L     RE,=A(ATBRJC2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'REJECT_CONV.    '                                 
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBURA2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITURA2 NTR1                                                                   
         LOAD  DE=ATBURA2                                                       
         L     RE,=A(ATBURA2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'UNREG_FOR_ALLOC'                                  
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBRAL2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITRAL2 NTR1                                                                   
         LOAD  DE=ATBRAL2                                                       
         L     RE,=A(ATBRAL2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'RECEIVE_ALLOCATE'                                 
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBALC2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITALC2 NTR1                                                                   
         LOAD  DE=ATBALC2                                                       
         L     RE,=A(ATBALC2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'ALLOCATE'                                         
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBPTR PARAMETER LIST                                   *          
**********************************************************************          
         SPACE 1                                                                
INITPTR  NTR1                                                                   
         LOAD  DE=ATBPTR                                                        
         L     RE,=A(ATBPTR_STRUCTURE)                                          
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'PREP_TO_RECEIVE'                                  
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBAMR1 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITAMR1 NTR1                                                                   
         LOAD  DE=ATBAMR1                                                       
         L     RE,=A(ATBAMR1_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'ASYNCH_MANAGER'                                   
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBRCVI PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITRCVI NTR1                                                                   
         LOAD  DE=ATBRCVI                                                       
         L     RE,=A(ATBRCVI_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'RECEIVE_IMMED.'                                   
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBRCVW PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITRCVW NTR1                                                                   
         LOAD  DE=ATBRCVW                                                       
         L     RE,=A(ATBRCVW_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'RECEIVE_AND_WAIT'                                 
         XIT1                                                                   
**********************************************************************          
* INITIALISE ATBRTS PARAMETER LIST                                   *          
**********************************************************************          
         SPACE 1                                                                
INITRTS  NTR1                                                                   
         LOAD  DE=ATBRTS                                                        
         L     RE,=A(ATBRTS_STRUCTURE)                                          
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'REQUEST TO SEND'                                  
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBDEAL PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITDEAL NTR1                                                                   
         LOAD  DE=ATBDEAL                                                       
         L     RE,=A(ATBDEAL_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'DEALLOCATE'                                       
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBSEND PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITSEND NTR1                                                                   
         LOAD  DE=ATBSEND                                                       
         L     RE,=A(ATBSEND_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'SEND_DATA'                                        
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBSERR PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITSERR NTR1                                                                   
         LOAD  DE=ATBSERR                                                       
         L     RE,=A(ATBSERR_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'SEND_ERROR'                                       
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBGTA2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITGTA2 NTR1                                                                   
         LOAD  DE=ATBGTA2                                                       
         L     RE,=A(ATBGTA2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'GET_ATTRIBUTES'                                   
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBPOR2 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITPOR2 NTR1                                                                   
         LOAD  DE=ATBPOR2                                                       
         L     RE,=A(ATBPOR2_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'POST_ON_RECEIPT'                                  
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBCFMD PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITCFMD NTR1                                                                   
         LOAD  DE=ATBCFMD                                                       
         L     RE,=A(ATBCFMD_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'CONFIRMED'                                        
         XIT1                                                                   
         SPACE 1                                                                
**********************************************************************          
* INITIALISE ATBCFM PARAMETER LIST                                   *          
**********************************************************************          
         SPACE 1                                                                
INITCFM  NTR1                                                                   
         LOAD  DE=ATBCFM                                                        
         L     RE,=A(ATBCFM_STRUCTURE)                                          
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'CONFIRM'                                          
         XIT1                                                                   
         EJECT                                                                  
**********************************************************************          
* INITIALISE ATBEES3 PARAMETER LIST                                  *          
**********************************************************************          
         SPACE 1                                                                
INITEES3 NTR1                                                                   
         LOAD  DE=ATBEES3                                                       
         L     RE,=A(ATBEES3_STRUCTURE)                                         
         ST    R0,0(RE)                                                         
         LA    RE,4(RE)                                                         
         MVC   0(16,RE),=CL16'ERROR_EXTRACT'                                    
         XIT1                                                                   
         SPACE 1                                                                
*                                                                               
YES      SR    RC,RC                                                            
NO       LTR   RC,RC                                                            
         XIT1                                                                   
         EJECT                                                                  
CALLAPPC NTR1                                                                   
         LR    R2,R1                                                            
*                                                                               
* UPON ENTRY,  R2 POINTS TO PARAMETER STRUCTURE                                 
*              ASYNC = Y/N (ASYNCHRONOUS OR SYNCHRONOUS CALL)                   
* UPON RETURN, RTN_CODE CONTAINS THE APPC/MVS RETURN CODE                       
*                                                                               
         CLI   APPCTRAC,0           TEST APPC MESSAGE TRACE INHIBIT             
         BNE   CALL020                                                          
         MVI   ESSP,C'*'           '*' MEANS IT'S AN APPC/MVS CALL              
         MVC   ESSP+1(16),4(R2)                                                 
         MVC   ESSP+18(6),=CL6'BEFORE'                                          
         MVC   ESSP+30(40),=CL40'CONVERSATION_ID = '                            
         GOTO1 AHEXOUT,DMCB,CONVERSATION_ID,ESSP+48,8,=C'TOG'                   
         GOTO1 AESSLOG,DMCB,ESSATCD,ESSP                                        
*                                                                               
CALL010  TM    EATTRAC,GESSTAPC                                                 
         BZ    CALL020                                                          
         BAS   RE,APPCLOG                                                       
*                                                                               
CALL020  EQU   *                                                                
*                                                                               
         LA    RE,*+10                                                          
         O     RE,=X'80000000'                                                  
         BSM   0,RE                SWITCH TO 31-BIT MODE                        
*                                                                               
         L     RF,0(R2)            RF = A(APPC/MVS ROUTINE)                     
         LA    R3,20(R2)           R3 = A(PARAMETER LIST)                       
*                                                                               
         CLI   APPCDUMP,C'B'       TEST FOR DUMP BEFORE APPC CALL               
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CALL  (15),MF=(E,(R3))                                                 
*                                                                               
         LA    RE,*+6                                                           
         BSM   0,RE                SWITCH BACK TO 24-BIT MODE                   
*                                                                               
         CLI   APPCDUMP,C'A'       TEST FOR DUMP AFTER APPC CALL                
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
CALL200  EQU   *                                                                
         CLI   APPCTRAC,0          TEST APPC MESSAGE TRACE INHIBITED            
         BNE   CALL220                                                          
         MVI   ESSP,C'*'           '*' MEANS IT'S AN APPC/MVS CALL              
         MVC   ESSP+1(16),4(R2)                                                 
         MVC   ESSP+18(5),=CL5'AFTER'                                           
         MVC   ESSP+30(14),=CL14'RETURN CODE ='                                 
         EDIT  RTN_CODE,(5,ESSP+44),ALIGN=LEFT,ZERO=NOBLANK                     
         GOTO1 AESSLOG,DMCB,ESSATCD,ESSP                                        
*                                                                               
CALL210  TM    EATTRAC,GESSTAPC                                                 
         BZ    CALL220                                                          
         BAS   RE,APPCLOG                                                       
*                                                                               
CALL220  EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
APPCLOG  NTR1                                                                   
*                                                                               
         L     R4,AMAJORNM         MAJOR RESCOURCE NAME                         
         ENQ   ((4),ELOGNAME,E,8)           ENQUEUE THE ESS LOG PRINTER         
         MVC   P,SPACES                                                         
*                                                                               
ALOG010  MVC   P(8),EATNAME                                                     
*                                                                               
ALOG020  TIME  DEC                                                              
         ST    R0,DUB                                                           
         UNPK  WORK(7),DUB(4)                                                   
         STC   R0,WORK+7                                                        
         OI    WORK+7,X'F0'                                                     
         SRL   R0,4                                                             
         STC   R0,WORK+6                                                        
         OI    WORK+6,X'F0'                                                     
         MVC   P+10(2),WORK                                                     
         MVI   P+12,C':'                                                        
         MVC   P+13(2),WORK+2                                                   
         MVI   P+15,C':'                                                        
         MVC   P+16(2),WORK+4                                                   
         MVI   P+18,C':'                                                        
         MVC   P+19(2),WORK+6                                                   
         MVI   P+23,C'('                                                        
         MVI   P+26,C')'                                                        
         EDIT  (B2,EATTASKN),(2,P+24),ZERO=NOBLANK,FILL=0                       
*                                                                               
         MVC   P+28(40),=CL40'APPC BUFFER LENGTH:'                              
         GOTO1 AHEXOUT,DMCB,APPC_BUFFER_LENGTH,P+48,2,=C'TOG'                   
         GOTO1 APRINTER                                                         
*                                                                               
         OC    APPC_BUFFER_LENGTH,APPC_BUFFER_LENGTH                            
         BZ    ALOGDEQ                                                          
*                                                                               
ALOG030  EQU   *                                                                
         TM    EATTRAC,GESSTAPX                                                 
         BNZ   ALOG100                                                          
         MVC   P(40),=CL40'APPC BUFFER HEX DATA DUMP'                           
         LA    RF,256                                                           
         CLM   RF,3,APPC_BUFFER_LENGTH                                          
         BL    ALOG110                                                          
         ICM   RF,3,APPC_BUFFER_LENGTH                                          
         B     ALOG110                                                          
*                                                                               
ALOG100  EQU   *                                                                
         MVC   P(40),=CL40'APPC BUFFER HEX DATA DUMP - EXTENDED'                
         ICM   RF,3,APPC_BUFFER_LENGTH                                          
         B     ALOG110                                                          
*                                                                               
ALOG110  EQU   *                                                                
         STCM  RF,3,DUMPLEN                                                     
         GOTO1 APRINTER                                                         
         L     RE,=A(PRNTBUFF)                                                  
         SR    RF,RF                                                            
         ICM   RF,3,=AL2(L'PRNTBUFF)                                            
         LA    R0,*                                                             
         L     R1,=F'0'                                                         
         MVCL  RE,R0                                                            
         L     RE,=A(PRNTBUFF)                                                  
         SR    RF,RF                                                            
         ICM   RF,3,DUMPLEN                                                     
         LA    RF,8(RF)            L'DATA + OVERHEAD FOR PRNTBL                 
         LA    R0,APPC_BUFFER                                                   
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
         L     RE,=A(PRNTBUFF)                                                  
         ICM   RF,3,DUMPLEN                                                     
         LA    RF,8(RF)                                                         
         AR    RE,RF                                                            
         BCTR  RE,0                                                             
         BCTR  RE,0                                                             
         MVC   0(2,RE),=X'0D25'    TERMINATE RECORD WITH CRLF                   
*                                                                               
         L     R4,=A(PRNTBUFF)                                                  
         GOTO1 APRNTBL,DMCB,0,(R4),C'DUMP',(RF),=C'1D'                          
         GOTO1 APRINTER                                                         
*                                                                               
ALOGDEQ  L     R4,AMAJORNM         MAJOR RESCOURCE NAME                         
         DEQ   ((4),ELOGNAME,8)    DEQUEUE THE ESS LOG PRINTER                  
*                                                                               
ALOGX    EQU   *                                                                
         XIT1                                                                   
         SPACE 1                                                                
***********************************************************************         
* APPC/MVS PSEUDONYM DEFINITIONS                                     *          
***********************************************************************         
         SPACE 1                                                                
         ATBSERV                                                                
         SPACE 1                                                                
ATBCTS_WAIT    EQU   ATB_FW2                                                    
*                                                                               
FIRST    DC    C' '                                                             
ELOGNAME DC    CL8'ESSIOLOG'                                                    
*                                                                               
ENTRYPTS DS    0F                                                               
         DC    Y((ENTRYLSQ-ENTRYSTQ)/60)   NUMBER OF TABLE ENTRIES              
         DC    H'60'                       MUST REMAIN AS 60                    
ENTRYSTQ EQU   *                                                                
*                                                                               
ATBALC2  DC    CL8'ATBALC2 '                                                    
         DC    XL52'00'                                                         
ATBAMR1  DC    CL8'ATBAMR1 '                                                    
         DC    XL52'00'                                                         
ATBCFM   DC    CL8'ATBCFM  '                                                    
         DC    XL52'00'                                                         
ATBCFMD  DC    CL8'ATBCFMD '                                                    
         DC    XL52'00'                                                         
ATBDEAL  DC    CL8'ATBDEAL '                                                    
         DC    XL52'00'                                                         
ATBGTA2  DC    CL8'ATBGTA2 '                                                    
         DC    XL52'00'                                                         
ATBPOR2  DC    CL8'ATBPOR2 '                                                    
         DC    XL52'00'                                                         
ATBPTR   DC    CL8'ATBPTR  '                                                    
         DC    XL52'00'                                                         
ATBRAL2  DC    CL8'ATBRAL2 '                                                    
         DC    XL52'00'                                                         
ATBRCVI  DC    CL8'ATBRCVI '                                                    
         DC    XL52'00'                                                         
ATBRCVW  DC    CL8'ATBRCVW '                                                    
         DC    XL52'00'                                                         
ATBRFA2  DC    CL8'ATBRFA2 '                                                    
         DC    XL52'00'                                                         
ATBRJC2  DC    CL8'ATBRJC2 '                                                    
         DC    XL52'00'                                                         
ATBRTS   DC    CL8'ATBRTS  '                                                    
         DC    XL52'00'                                                         
ATBSEND  DC    CL8'ATBSEND '                                                    
         DC    XL52'00'                                                         
ATBSERR  DC    CL8'ATBSERR '                                                    
         DC    XL52'00'                                                         
ATBURA2  DC    CL8'ATBURA2 '                                                    
         DC    XL52'00'                                                         
ATBEES3  DC    CL8'ATBEES3 '                                                    
         DC    XL52'00'                                                         
ENTRYLSQ EQU   *                                                                
*                                                                               
         EJECT                                                                  
APPCECB  DC    F'0'                                                             
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* PARAMETER LISTS FOR APPC/MVS CALLS                                            
*                                                                               
ATBRFA2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    11AL4                                      
*                                                                               
ATBAMR1_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    3AL4                                       
*                                                                               
ATBRJC2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    5AL4                                       
*                                                                               
ATBURA2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    4AL4                                       
*                                                                               
ATBRAL2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    13AL4                                      
*                                                                               
ATBALC2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    18AL4                                      
*                                                                               
ATBPTR_STRUCTURE               DS    A                                          
                               DS    CL16                                       
                               DS    5AL4                                       
*                                                                               
ATBRCVI_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    9AL4                                       
*                                                                               
ATBRCVW_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    10AL4                                      
*                                                                               
ATBRTS_STRUCTURE               DS    A                                          
                               DS    CL16                                       
                               DS    3AL4                                       
*                                                                               
ATBDEAL_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    4AL4                                       
*                                                                               
ATBSEND_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    8AL4                                       
*                                                                               
ATBSERR_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    5AL4                                       
*                                                                               
ATBGTA2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    15AL4                                      
*                                                                               
ATBPOR2_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    3AL4                                       
*                                                                               
ATBCFMD_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    3AL4                                       
*                                                                               
ATBCFM_STRUCTURE               DS    A                                          
                               DS    CL16                                       
                               DS    4AL4                                       
*                                                                               
ATBEES3_STRUCTURE              DS    A                                          
                               DS    CL16                                       
                               DS    11AL4                                      
         EJECT                                                                  
         DS    0D                                                               
WORKD    DSECT                                                                  
*                                                                               
DMCB     DS    6F                                                               
RELO     DS    A                                                                
DUB      DS    D                                                                
APARM    DS    A                   A(PARAMETER LIST)                            
*                                                                               
PARM     DS    0XL4                PARAMETER LIST                               
ESSAPPCC DS    AL4                 A(ESSAPPC CSECT)                             
*                                                                               
BYTE     DS    XL1                                                              
DUMPLEN  DS    XL2                                                              
WORK     DS    CL256                                                            
ESSP     DS    CL132                                                            
*                                                                               
WORKX    EQU   *                                                                
         EJECT                                                                  
*                                                                               
       ++INCLUDE DDESSAPPCD                                                     
         SPACE 2                                                                
       ++INCLUDE DDESSD                                                         
         SPACE 2                                                                
       ++INCLUDE DDDPRINT                                                       
         SPACE 2                                                                
       ++INCLUDE GEGENESS                                                       
         SPACE 2                                                                
*                                                                               
         CSECT                                                                  
         DS    0D                                                               
PRNTBUFF DS    CL(5000)            APPC PRINT BUFFER                            
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'150DDESSAPPCA10/16/97'                                      
         END                                                                    

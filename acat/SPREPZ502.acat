*          DATA SET SPREPZ502  AT LEVEL 228 AS OF 01/23/20                      
*CATALP SPZ502                                                                  
         TITLE 'SPREPZ502 - EASI - INVOICE CONVERSION'                          
         PRINT NOGEN                                                            
*                                                                               
***********************************************************************         
*                                                                               
*                                                                               
*        QOPT1      Y= TEST-NO FILE MARKING (DOESNT SET RCWRITE)                
*                   X= TEST-NO AND PRODUCE DATA ERROR REPORT 9                  
*        QOPT2      TRACE A=ALL,E=ERRORS,M=E+MODES,F=M+FIELDS                   
*                         R=M+ADDED RECORDS                                     
*        QOPT3      Y=LIST PREVIOUS CONVERSIONS                                 
*        QOPT4      Y=OK TO REPLACE INVOICES ON FILE                            
*        QOPT5      Y=CREATE I2 REQUEST FILE,P=PRINT IT TOO                     
*                   F=FORCE CREATION OF I2,I5 AND Z9 REQUESTS                   
*                   G=SAME AS 'F', EXCEPT THAT I5 REQUESTS                      
*                     ARE GENERATED ONLY IF Z5 PROFILE IS SET                   
*        QOPT6      Y OR N POST AFFIDS - PASSED ON TO I2 REQUEST,               
*                     DOES NOTHING IN THIS PROGRAM                              
*                                                                               
*        QSTAUTO(6) =  RE-RUN DATE                                              
*                                                                               
*        QCOMPARE   =  C'Y' = DO NOT IGNORE EXPIRED BATCHES                     
*                      USED TO BE - REP INVOICE CONVERSION RUN                  
*                      REMOVED JUN09/2011 QCOMPARE CAN BE RE-USED               
*                                                                               
*                                                                               
***********************************************************************         
*                                                                     *         
*   REGISTER USAGE                                                    *         
*   R0 - OS & WORK                                                    *         
*   R1 - OS & WORK                                                    *         
*   R2 - WORK                                                         *         
*   R3 - WORK                                                         *         
*   R4 - WORK                                                         *         
*   R5 - EZBLOCK BASE                                                 *         
*   R6 - WORK                                                         *         
*   R7 - 2ND BASE                                                     *         
*   R8 - GLOBALD BASE                                                 *         
*   R9 - SPWORKD BASE                                                 *         
*   RA - SPWORKD 2ND BASE                                             *         
*   RB - 1ST BASE                                                     *         
*   RC - SPZ5WRKD                                                     *         
*   RD - STD REG SAVE CHAIN                                           *         
*   RE - OS & WORK                                                    *         
*   RF - OS & WORK                                                    *         
*                                                                     *         
***********************************************************************         
*                                                                     *         
*  LEV 34    DEC14/89 CHANGE CONVERTED TO CONVERTABLE FOR TEST RUN    *         
*  LEV 35    DEC18/89 FIX TOTALLY CONVERTED TEST TO X'40'             *         
*                     CHANGE QPROG+53 RERUN TO QPROG+52               *         
*  LEV 36    JAN11/90 FIX COMPARE FOR 3 CHAR STATION                  *         
*  LEV 37    JAN16/90 ADD DEMOS TO I2 REQUEST                         *         
*  LEV 38    FEB12/90 ONLY DO DEMO BOOK ACT                           *         
*  LEV 39-40 APR20/90 SET FULLY CONVERTED BATCHES TO STATUS KEEP,     *         
*                     SAVE SOURCE (WKRCMNT), BYPASS DELETED INVOICES  *         
*  LEV 41    JUN14/90 USE DEMO BOOK FROM REQ FOR I2 REQUESTS          *         
*  LEV 42    JUL25/90 USE QUESTOR FROM THIS REQUEST FOR I2            *         
*  LEV 43    OCT11/90 REFORMAT REPORTS 1-9 TO BE THE SAME             *         
*                     SORT ON MARKET AND SHOW SOURCE                  *         
*  LEV 44    NOV01/90 ONLY PROCESS PREV CONVERTED INV ON INVL         *         
*  LEV 45    NOV02/90 ADD DELETED INVOICES REPORT (10)                *         
*                     FIX MARKET GROUP REPORT                         *         
*  LEV 46-47 JAN16/91 CHANGE PRTABL TO 8000 FROM 5000, JUNK TEMPS     *         
*  LEV 48    JAN22/91 FIX MY SPELLING ERROR CONVERTABLE TO CONVERTIBLE*         
*  LEV 49    JAN22/91 CHANGE EZBYMGRP TO SOURCE FOR MGRP SCHEME       *         
*  LEV 50    FEB15/91 ADD RADIO                                       *         
*  LEV 51    FEB28/91 FIX READING CONVERTED IN ERROR                  *         
*  LEV 52    APR12/91 FIX MGRP BUG                                    *         
*  LEV 53    APR16/91 FIX I2 REPORT BUG                               *         
*  LEV 54    JUN12/91 I2 REQ, ONLY GIVE EST IF NO PIGGY,              *         
*                      PASS EST IN WIEST                              *         
*  LEV 55    SEP17/91 ADD Z5 PROF # 3 SHOW DEMO IN I2                 *         
*  LEV 56    NOV19/91 ADD STATION EQUIVALENCE                         *         
*  LEV 57    JAN07/92 FIX EZIHBEST - GETTING AGENCY EST WHEN OVERRIDE *         
*  LEV 58    JAN16/92 FIX EZI2RQST FILE OPEN CHECKING                 *         
*  LEV 59    JAN29/92 FIX BAD MARKET                                  *         
*  LEV 60    FEB11/92 READ CORRECT ADV MPL SYSTEM                     *         
*  LEV 61    FEB19/92 FORCE MEDIA C/S TO N FOR BSTA, FIX READ MKT NAME*         
*  LEV 62-63 FEB26/92 FORCE I2 REQUESTS FROM -C TO -N                 *         
*  LEV 64    APR10/92 FIX CALC GROSS  WIGRS ROUTINE                   *         
*  LEV 65    JUL02/92 PASS ON NEW OPTION 6 TO I2 - POST AFFIDS        *         
*  LEV 66    JUL07/92 XC HEADHOOK, WAS CAUSING PRG CK IN DRIVER       *         
*  LEV 67    JUL17/92 ADD MPLQ FILE FOR REP                           *         
*  LEV 68    AUG07/92 CHANGE CHECKING COMMENT STATUS TO CK KEEP STATUS*         
*  LEV 69    OCT13/92 SET TO RUN UPDATIVE SOON (BUT NO I2 REQUESTS)   *         
*  LEV 70    OCT26/92 CHANGE I2 REQUEST PER GRANT TO ALL OR P2 IN +34 *         
*  LEV 71    NOV18/92 CHANGE CMTAB - COMML TABLE FROM 8000 TO 16000   *         
*  LEV 72    DEC14/92 CHANGE PRTAB - PROD TABLE FROM 8000 TO 16000    *         
*  LEV 73    JAN31/93 ADD MPL6                                        *         
*  LEV 74    FEB18/93 CHANGE QBOOK REQUEST LEN FROM 4 TO 6 KIIL RERUN *         
*  LEV 75    FEB26/93 PUT Z IN QREQ+31 TO PRINT (Z5) ON I2 REPORT     *         
*  LEV 76    MAR29/93 MOVE RERUN FROM QHUT1 TO QSTAUTO, POL/YES REQ   *         
*  LEV 77    APR15/93 ADD CABLE HEAD - EZIHNET                        *         
*  LEV 78    APR30/93 CHANGE TO EASIWK, ADD EZSRCE                    *         
*  LEV 79    MAY11/93 ADD COL 33 = Y FOR RESPONSE I2 REPORTS          *         
*  LEV 80    OCT14/93 ADD THIRD STEP DCB FOR Z9 PRINT OUTS AND        *         
*                         USE FIRSTSW TO INDICATE ANY CONVERTED INV   *         
*                         STOP ALL BUT CONVERTED ON RERUN             *         
*                         FIX SHOW COMML CODE ON ERROR                *         
*  LEV 81    NOV22/93 CLOSE TRFUPD FILE IF NEEDED, ADD CMML SEQ TBL   *         
*  LEV 82    DEC09/93 CHANGE PRTAB - PROD TABLE FROM 16000 TO 23100   *         
*                     CHANGE CMTABL FROM 16000 TO 24600               *         
*  LEV 83    DEC13/93 SHOW COMBINED INVOICE ON Z5 REPORT              *         
*  LEV 84    FEB17/94 PULL OUT CLOSE TRFUPD FILE                      *         
*  LEV 85    APR12/94 FIX UNKNOWN STATION MSG                         *         
*  LEV 86    MAY06/94 ADD MPL5                                        *         
*  LEV 87    AUG16/94 ADD NWK                                         *         
*  LEV 88    JAN27/95 MORE NWK, AND INIT BYTE BEFORE MEDIA SEL        *         
*                      AND EZPROF 9 FOR OLD/NEW INVOICE SELECTION     *         
*  LEV 90    JUL22/96 ADD MORE CATCHUP STUFF                          *         
*                     I5/CC REPORTS BYPASS 1ST CHAR STA OF GARBAGE    *         
*                     COKE BLK DATESAUTO REQUEST REPB MPLV            *         
*  LEV 91    AUG01/96 DISABLE OLD INV CONVERT, ONLY NEW               *         
*                     CHANGE FROM C VER TO BLK, BYPASS EZIHNET EXC LC *         
*                     BYPASS IDIOT %$#@! STUFF FROM COKE              *         
*  LEV 92    AUG02/96 ADD COKE I5 REQUEST DATA                        *         
*  LEV 93    OCT08/96 ADD ADV7                                        *         
*  LEV 94    JAN15/97 FIX ACN                                         *         
*  LEV 95    JAN28/97 FIX ACN AGAIN - LOOK FOR EQUAL MARKET           *         
*  LEV 96    FEB06/97 FIX ACN AGAIN - USE ACN # TO FIND MARKET #      *         
*  LEV 97    MAR30/97 PUT ACN IN I2 REPORT FOR COKE                   *         
*  LEV 98    APR28/97 DO NOT CLEAR ACN # FROM QBOOK1 FOR COKE         *         
*  LEV 99    JUN19/97 PUT OUT BETTER ERR MSG FOR STATION NOT ON FILE  *         
*  LEV 100   SEP11/97 ALLOW LOW POWER TV                              *         
*  LEV 101   DEC01/97 CHG COKE CC REQ TO CD                           *         
*  LEV 102   FEB02/98 ADD MARKET TO FILTERS, FIX FOR LOW POWER TV     *         
*  LEV 103   MAR05/98 DO NOT PUT LOCAL CABLE NET IN BMKTSTA, SAVE IT  *         
*  LEV 104   MAR24/98 SORT I2 REQUESTS FOR JWNY                       *         
*  LEV 105   APR01/98 FIX SORTED I2 REQUESTS                          *         
*  LEV 106   APR02/98 BYPASS CABLE NET UNLESS NUMERIC STATIONS        *         
*  LEV 107   APR22/98 FILTER BY SOURCE (QSTAUTO)                      *         
*                     MOVE RERUN DATE FROM QSTAUTO TO QEST+2          *         
*  LEV 108   JUN11/98 SPECIAL SDI FILTERING FOR JWT                   *         
*  LEV 109   JUL29/98 I2 REQUEST - ALLOW BOTH PTR PRD AND ESTIMATE    *         
*  LEV 110   SEP14/98 USE BATCH DATE IN INDEX                         *         
*  LEV 111   OCT21/98 PUT / FOLLOWING CABLE STATIONS FOR I2 REQUESTS  *         
*  LEV 112   DEC24/98 RUN REPORT IN STATION SEQ, RD Z5 PROF FOR Z6    *         
*  LEV 113   MAR29/99 ADD WILA (WI) TO AUTO I2 REPORT                 *         
*                     ADD MDSCP(BC) TO AUTO I5 REPORT                 *         
*  LEV 114   APR05/99 ADD NEW REQUEST FOR MID-FLT-CLEAR ONLY          *         
*                     WHICH IS AN 'M' IN COL 56 - QRERATE             *         
*  LEV 115   APR14/99 ADD IPRQFIL DCB IF I2 DOES NOT CREATE IT        *         
*  LEV 116   AUG09/99 GET STATION TYPE & IF N REQ I2 AS CALENDAR      *         
*  LEV 117   AUG10/99 SAVE STYPE FROM STATION MASTER IN EZSTYPE       *         
*  LEV 118   AUG18/99 SET UP FDMJW(FR) SAME AS JW                     *         
*  LEV 119   DEC08/99 TAKE OUT ALL OR YES FOR I2 REQ+34 PRD2          *         
*  LEV 120   FEB25/00 ELIMINATE DUPLICATE I2 REQUESTS                 *         
*  LEV 121   APR21/00 SORT I2 REQUESTS IN FILE ORDER FOR TH           *         
*  LEV 122   MAY01/00 READ STA EQUIV RECS FROM GENDIR/FIL             *         
*  LEV 123   JUN08/00 MAKE EQVSTATB LARGER FROM 600 TO 2000           *         
*  LEV 124   OCT20/00 NEW Z5 PROFILE 5 TO BYPASS DELETED INV REPORT   *         
*  LEV 125   NOV08/00 FIX AGENCY TH I2 REQUEST BUG                    *         
*                     ADD H7&SJ TO JW/FR/TH FOR I2 NET REQUESTS       *         
*  LEV 126   DEC11/00 ADD SOON CAPABILITY                             *         
*  LEV 128   APR24/01 ADD H7 TO JWT                                   *         
*  LEV 129   MAY11/0A FIX DUP I2 REQUESTS                             *         
*  LEV 129   JUN13/01 SAVE EQVSTAW TO EZEQVSTA                        *         
*  LEV 130   JUN20/01 CK FOR MORE ERROR CODES FROM STAPACK            *         
*  LEV 132   JUL11/01 SETUP Z6 RUN FOR MSNYA TO SORT BY MARKET        *         
*  LEV 133   JUL18/01 OPT ALL- OTHER THAN CABLE, ALL/ ONY LOCAL CABLE *         
*  LEV 135   FEB06/02 REP INVOICES                                    *         
*  LEV 136   OCT23/02 CK FLAG ON DSTA RECS FOR REP                    *         
*  LEV 137   NOV04/02 CHKDUP SUBROUTINE ADDED TO CATCH DUPLICATE      *         
*                     INVOICES WHEN REPORT RUNS SOON                  *         
*  LEV 139   MAR19/03 CALENDAR MONTHS FORCED IN I2 REQUESTS IF        *         
*                     REQUESTING BY SUBMEDIA OPTION IS ON IN I2Z      *         
*  LEV 140            ESTIMATE OVERRIDE VALUE DISPLAYED               *         
*                     SETHDG SUBROUTINE MADE BASE=*,LABEL=*           *         
*                     SUPPORT FOR VALUE 'E' OF EZ PROFILE'S FIELD 1   *         
*  LEV 141            CODE ADDED TO ALLOW REQUESTING BY CLIENT        *         
*                     PROBLEM WITH GETTING 2 ND PRODUCT FROM          *         
*                     COMMERCIAL - FIXED                              *         
*  LEV 142            SUPPORT FOR SOURCE=ALL, AND SECOND REQUEST      *         
*                     CARD TO PASS SOURCE TO Z9 REPORT                *         
*  LEV 143   AUG05/03 GETMGR MOVED ALL THE WAY DOWN                   *         
*                     WORDING FOR MISSING PRD ERROR MSG CHAGNED       *         
*                     ANOTHER PROBLEM WITH MISSING COMMERCIALS FIXED  *         
***********************************************************************         
*                                                                               
SPZ502   CSECT                                                                  
         NMOD1 0,*SPZ502*,R7                                                    
*                                                                               
         L     R9,0(R1)                                                         
         LA    RA,2048(R9)                                                      
         LA    RA,2048(RA)                                                      
         USING SPWORKD,R9,RA                                                    
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
         L     R5,=A(EZBLOCKC)                                                  
         USING EZBLOCKD,R5                                                      
*                                                                               
         CLI   MODE,RUNFRST                                                     
         BE    FAKEIT              PUT OUT DUMMY Z9 REQUEST FILE                
*                                                                               
         CLI   MODE,RUNLAST        CLOSE I2 REQUEST AT RUNLAST                  
         BE    CLOSEIT                                                          
*                                                                               
         CLI   MODE,REQFRST                                                     
         BE    PROC                                                             
*                                                                               
         CLI   MODE,REQLAST                                                     
         BE    RQL                                                              
*                                                                               
         GOTO1 AENDREQ                                                          
*                                                                               
*                                                                               
* IF RUNNING SOON, NO SECOND STEP OR AUTO REQUESTS *                            
*                                                                               
FAKEIT   DS    0H                                                               
         MVI   Z9FLAG,C'Y'                                                      
         XC    SRCETAB,SRCETAB                                                  
         MVI   SRCETABX,X'FF'                                                   
*                                                                               
         MVC   SVREQST,SPACES                                                   
*                                                                               
         L     RE,ADCONLST                                                      
         USING SPADCONS,RE                                                      
         MVC   AMQRPT,VMQRPT                                                    
         DROP  RE                                                               
*                                                                               
         MVI   WRTFLAG,C'N'                                                     
         BRAS  RE,GETMEM                                                        
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   EXIT                                                             
         BRAS  RE,INIT             WRITE OUT DUMMY Z9 REQUEST FILE              
         B     EXIT                                                             
*                                                                               
*                                                                               
*                                                                               
* IF RUNNING SOON, NO SECOND STEP OR AUTO REQUESTS *                            
*                                                                               
CLOSEIT  DS    0H                                                               
         CLI   MQFLAG,C'Y'                                                      
         BNE   CLOSE1A                                                          
*                                                                               
         GOTO1 AMQRPT,DMCB,(0,=C'CLOSE'),0,0,0                                  
         CLI   DMCB+8,0                                                         
         BE    CLOSE1A                                                          
*                                                                               
         XC    X,X                                                              
         MVC   X(18),=CL18'AUTONOTE*TZIHDDNY:'                                  
         MVC   X+18+1(15),=CL15'MQ CLOSE FAILED'                                
         ICM   R1,15,DMCB+12                                                    
         MVC   X+35(28),0(R1)                                                   
         GOTO1 DATAMGR,DMCB,=C'OPMSG',(45,X)                                    
*                                                                               
CLOSE1A  DS    0H                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)   SOON?                   
         BZ    CLOSEIT2            NO - GENERATE AUTO REQUESTS                  
*                                                                               
         CLI   EZZ9REQ,C'Y'        DO THEY WANT AUTO Z9 INV FAC REPORT?         
         BE    CLOSEIT2                                                         
         CLI   EZZ9REQ,C'S'        DO THEY WANT AUTO Z9 INV FAC REPORT?         
         BNE   CLOSEIT5                                                         
*                                                                               
CLOSEIT2 DS    0H                                                               
         BRAS  RE,CLOSE                                                         
*                                                                               
CLOSEIT5 DS    0H                                                               
* 01/14/2016 - WE'RE NO LONGER SENDING IM FEEDBACK VIA DATASETS+EDICT           
*&&DO                                                                           
         CLI   WRTFLAG,C'Y'        HAS DATASET BEEN OPEN?                       
         BNE   EQXIT                                                            
*                                                                               
         BRAS  RE,WRTEDCT                                                       
*&&                                                                             
*                                                                               
EQXIT    CR    RB,RB                                                            
         J     EXIT                                                             
NEQXIT   LTR   RB,RB                                                            
EXIT     XIT1                                                                   
*                                                                               
EXITX    DS    0H                                                               
         L     RF,UTL                                                           
         MVC   4(1,RF),SAVSYS      RESTORE SYSTEM NUM                           
         J     EXIT                                                             
*                                                                               
* REQUEST FIRST                                                                 
*                                                                               
PROC     DS    0H                                                               
         MVI   EDCTFLAG,C'N'                                                    
* 01/14/2016 - WE'RE NO LONGER SENDING IM FEEDBACK VIA DATASETS+EDICT           
*&&DO                                                                           
         CLC   =C'!@BILL#$',QUESTOR                                             
         BNE   *+8                                                              
         MVI   EDCTFLAG,C'Y'                                                    
*&&                                                                             
*                                                                               
         CLI   QOPT5,C' '          I2 OPTION, BLANK=N                           
         BH    *+8                                                              
         MVI   QOPT5,C'N'                                                       
*                                                                               
* QOPT5=O ALLOWED ONLY FOR Z7 REPORTS                                           
         CLI   QOPT5,C'O'                                                       
         BNE   PR0                                                              
         CLC   QCODE,=C'Z7'                                                     
         BE    *+12                                                             
         MVI   QOPT5,C'N'                                                       
         B     PR0                                                              
*                                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)   SOON?                   
         BNZ   PR0                 YES                                          
         MVI   QOPT5,C'Y'          OVERNIGHT CHANGE O TO Y                      
*                                   SET EZBLOCK VALUES                          
PR0      DS    0H                                                               
         XC    EZCLTFTR,EZCLTFTR                                                
         CLC   QCLT,SPACES                                                      
         BNH   PR00                                                             
         CLC   QCLT,=C'ALL'                                                     
         BE    PR00                                                             
         GOTO1 CLPACK,DMCB,QCLT,EZCLTFTR                                        
*                                                                               
PR00     DS    0H                                                               
         XC    SVBATSEQ,SVBATSEQ                                                
         B     PR00A                                                            
*                                                                               
         CLI   QAFFIL,C' '         PROCESSING DELETED FOF INV MGR?              
         BNH   PR00A               NO - SKIP ALL INVMGR CODE                    
         XC    SVBATSEQ,SVBATSEQ                                                
         CLC   Q2USER(6),SPACES                                                 
         BNH   PR00A                                                            
*                                                                               
         LHI   R0,6                                                             
         LA    R1,Q2USER                                                        
*                                                                               
         BRAS  RE,ISNUM                                                         
         BNE   PR00A                                                            
         BCT   R0,*-8                                                           
*                                                                               
         PACK  DUB,Q2USER(6)                                                    
         CVB   R1,DUB                                                           
         STCM  R1,3,SVBATSEQ                                                    
*                                                                               
PR00A    DS    0H                                                               
         BRAS  RE,TSARSET                                                       
*                                                                               
         L     RF,UTL                                                           
         MVC   SAVSYS,4(RF)                                                     
         L     R8,=A(GLAREA)                                                    
         USING GLOBALD,R8                                                       
         XC    HEADHOOK,HEADHOOK                                                
*                                                                               
         CLI   QRERATE,C'M'        THIS MCT(MID-FLT-CLEAR) REQ                  
         BNE   PR06                                                             
*                                                                               
         OC    QSTART(12),QSTART   ANY REQUEST DATE                             
         BZ    PR04                 NO                                          
         CLC   QSTART(12),SPACES   ANY REQUEST DATE                             
         BNE   PR06                 NO                                          
*                                                                               
PR04     MVC   QSTART,TODAY        FORCE BLK REQ DATE TO TODAY                  
         MVC   QEND,TODAY                                                       
*                                                                               
PR06     DS    0H                                                               
         CLC   QSTART(5),=C'TODAY'                                              
         BNE   *+10                                                             
         MVC   QSTART,TODAY                                                     
*                                                                               
         CLC   QEND(5),=C'TODAY'                                                
         BNE   *+10                                                             
         MVC   QEND,TODAY                                                       
*                                                                               
         TM    FIRSTSW,FIRSTSWI    TEST FIRST TIME                              
         BO    PR10                                                             
         OI    FIRSTSW,FIRSTSWI    SET DRIVER INITIALIZED                       
         XC    ADPGFILE,ADPGFILE                                                
         XC    ADRIVER,ADRIVER                                                  
         MVC   DPGFILE,=CL8'SPZ505  '                                           
         MVC   DRIVER,=CL8'T00A3A'                                              
         MVI   XFF,X'FF'                                                        
         MVC   XFF+1(L'XFF-1),XFF                                               
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
*                                                                               
PR10     DS    0H                                                               
         LA    RE,EZBLOCKD                                                      
         LHI   RF,EZBLOCKL                                                      
         XCEFL                                                                  
*                                                                               
         L     RF,VMASTC                                                        
         CLI   MCOVSYS-MASTD(RF),X'02' SPOT                                     
         BNE   *+12                                                             
         MVI   EZSPTNET,C'S'                                                    
         B     *+22                                                             
*                                                                               
         CLI   MCOVSYS-MASTD(RF),X'03' NET                                      
         BNE   *+12                                                             
         MVI   EZSPTNET,C'N'                                                    
         B     *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   EZMCTREQ,QRERATE    FORWARD MID-FLT-CLEAR ONLY                   
*                                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BZ    *+8                                                              
         MVI   EZSOON,C'S'         SET FLAG TO SOON FOR EZMOD                   
*                                                                               
         L     RE,=A(WRKRBUFF)                                                  
         ST    RE,EZWKRBUF                                                      
         LHI   RF,WRKRBEND-WRKRBUFF                                             
         XCEF                                                                   
*                                                                               
         L     RE,=A(WRKRREC)                                                   
         ST    RE,EZWKRREC                                                      
         LHI   RF,WRKRRECE-WRKRREC                                              
         XCEF                                                                   
*                                                                               
         LA    RF,EZMPROC                                                       
         ST    RF,EZHOOK                                                        
         L     RF,ADBUY                                                         
         ST    RF,EZAREC                                                        
         L     RF,=V(EZRECTAB)     RECORD/FIELD TABLE                           
         ST    RF,EZARECTB                                                      
         L     RE,=A(PRTABC)       PRODUCT TABLE                                
         ST    RE,EZPRTAB                                                       
         LHI   RF,PRTABE-PRTABC                                                 
         XCEF                                                                   
         L     RE,=A(CMTABC)       COMML TABLE                                  
         ST    RE,EZCMTAB                                                       
         LHI   RF,CMTABE-CMTABC                                                 
         XCEF                                                                   
         MVC   EZPRTABL,=Y(PRTABL) PROD TABLE LENGTH                            
         MVC   EZCMTABL,=Y(CMTABL) CMML TABLE LENGTH                            
*                                                                               
         L     RE,=A(CSTABC)       COMML SEQUENCE TABLE                         
         ST    RE,EZTRFTBL                                                      
         LA    RF,CSTABL/5                                                      
         CHI   RF,255                                                           
         BNH   *+6                                                              
         DC    H'0'                                                             
         STC   RF,EZTRFTBL                                                      
         LHI   RF,CSTABE-CSTABC                                                 
         XCEF                                                                   
*                                                                               
         MVC   EZCOMFCS,ACOMFACS                                                
*                                                                               
         MVC   EZPRINT,PRINT                                                    
         MVC   EZUTL,UTL                                                        
         MVC   EZMAST,VMASTC                                                    
*                                                                               
         MVC   EZFCTRFU,FCUPTRF                                                 
         MVC   EZRCTRFU,RCUTLTRF                                                
         MVC   EZSPOTSE,SPOTSE                                                  
*                                                                               
         MVC   EZWRITE,RCWRITE                                                  
         MVC   EZAGY,AGY                                                        
         MVC   EZBAGYMD,BAGYMD                                                  
*                                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(4),=C'S0Z5'                                                 
         MVC   WORK+4(2),AGENCY                                                 
         MVC   WORK+6(1),QMED                                                   
         GOTO1 GETPROF,DMCB,WORK,PROGPROF,DATAMGR                               
         CLI   QAFFIL,C' '         ARE WE WRITING DELETES?                      
         BNH   *+8                                                              
         OI    EZLOOKSW,EZLNOADV+EZLNOPRD+EZLNOCML                              
         MVC   EZPROF2,PROGPROF    Z5 PROFILE                                   
*                                                                               
* READ Z5A PROFILE                                                              
*                                                                               
         MVI   MGR2FLAG,C'N'                                                    
         MVC   WORK(4),=C'SZ5A'                                                 
         NI    WORK,X'FF'-X'40'    LOWERCASE 'S'                                
         LA    R2,EZBLOCKD                                                      
         AHI   R2,EZ5APROF-EZBLOCKD                                             
         GOTO1 GETPROF,DMCB,WORK,0(R2),DATAMGR                                  
*                                                                               
         CLI   EZ5A2MG1-EZ5APROF(R2),C'%'                                       
         BE    PR12D                                                            
         CLI   EZ5A2MG2-EZ5APROF(R2),C'%'                                       
         BE    PR12D                                                            
         CLI   EZ5A2MG1-EZ5APROF(R2),X'00'                                      
         BE    PR12D                                                            
         CLI   EZ5A2MG2-EZ5APROF(R2),X'00'                                      
         BE    PR12D                                                            
*                                                                               
         LARL  RF,SPMGRTAB                                                      
         LHI   RE,(SPMGRTBX-SPMGRTAB)/L'SPMGRTAB                                
         CLC   EZ5A2MG1-EZ5APROF(2,R2),0(RF)                                    
         BE    PR12E                                                            
         AHI   RF,L'SPMGRTAB                                                    
         BCT   RE,*-14                                                          
*                                                                               
         MVC   P+10(30),=CL30'ERROR: INVALID MARKET GROUP XX'                   
         MVC   P+38(2),EZ5A2MG1-EZ5APROF(R2)                                    
         GOTO1 REPORT                                                           
         MVC   P+10(30),=CL30'SKIPPING REQUEST'                                 
         MVC   P+27(L'QAREA),QAREA                                              
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         GOTO1 AENDREQ                                                          
*                                                                               
PR12E    DS    0H                                                               
         MVI   MGR2FLAG,C'Y'                                                    
         MVC   PROGPROF+EZBYMGRP-EZPROF2(1),2(RF)                               
         MVC   EZPROF2+EZBYMGRP-EZPROF2(1),2(RF)                                
*                                                                               
PR12D    DS    0H                                                               
         CLI   QOPT5,C'N'          QOPT5 ENTERED - DO NOT CHECK PROFILE         
         BNE   PR12H                                                            
         CLC   QCODE,=C'Z7'                                                     
         BNE   PR12H                                                            
*                                                                               
         LAY   R2,EZ5APROF                                                      
*                                                                               
         CLI   EZ5AAI2-EZ5APROF(R2),C'Y' ALWAYS GENERATING AUTO I2S?            
         BNE   PR12F               NO                                           
         MVI   QOPT5,C'Y'                                                       
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF) RUNNING SOON?             
         BZ    PR12H                                                            
         MVI   QOPT5,C'O'                                                       
         B     PR12H                                                            
*                                                                               
PR12F    DS    0H                                                               
         CLI   EZ5AAI2-EZ5APROF(R2),C'S'                                        
         BNE   PR12G                                                            
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BZ    PR12G                                                            
         MVI   QOPT5,C'O'                                                       
         B     PR12H                                                            
*                                                                               
PR12G    DS    0H                                                               
         CLI   EZ5AAI2-EZ5APROF(R2),C'O'                                        
         BNE   PR12H                                                            
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   PR12H                                                            
         MVI   QOPT5,C'Y'                                                       
*                                                                               
PR12H    DS    0H                                                               
*                                                                               
         CLI   QOPT5,C'O'          OVERNIGHT I2S FROM SOON Z5S?                 
         BE    PR12K               NO SORTING                                   
*                                                                               
         CLI   QOPT5,C'G'          FORCING AUTO REQUESTS?                       
         BE    PR12J                                                            
         CLI   QOPT5,C'F'          FORCING AUTO REQUESTS?                       
         BE    PR12J                                                            
*                                                                               
* IF RUNNING SOON, NO SECOND STEP OR AUTO REQUESTS *                            
*                                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   PR12K                                                            
*                                                                               
         CLI   QOPT5,C'N'          TEST OPTION TO DO I2'S                       
         BE    PR12K               NO - DON'T BOTHER WITH BUFFERIN              
*                                                                               
PR12J    DS    0H                                                               
         OPEN  (INFILE1,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
PR12K    DS    0H                                                               
         MVI   ACTVSW,C'N'                                                      
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         LA    RE,GLOBALD          INIT DRIVER STORAGE TO ZEROS                 
         L     RF,=F'60000'                                                     
         XCEF                                                                   
         MVC   GLSIZE,=F'60000'    GLOBAL SIZE                                  
         MVC   GLOBALD(8),=C'*GLOBAL*'                                          
         MVI   GLTRACE,C'N'                                                     
*                                                                               
         L     R6,VMASTC                                                        
         USING MASTD,R6                                                         
*                                                                               
         OC    ADPGFILE,ADPGFILE                                                
         BNZ   PR13                                                             
*                                                                               
         MVC   MCDUB,=CL8'SPZ505'                                               
         GOTO1 MCVLOADM,DMCB,0                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   ADPGFILE,DMCB+4                                                  
*                                                                               
PR13     DS    0H                                                               
         MVC   GLAPROG,ADPGFILE                                                 
*                                                                               
         OC    ADRIVER,ADRIVER                                                  
         BNZ   PR13A                                                            
*                                                                               
         MVC   MCDUB,=CL8'T00A3A'                                               
         GOTO1 MCVLOADM,DMCB,0                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   ADRIVER,DMCB+4                                                   
*                                                                               
PR13A    DS    0H                                                               
         OC    ATRPACK,ATRPACK                                                  
         BNZ   PR13B                                                            
*                                                                               
         MVC   MCDUB,=CL8'T00AFE'                                               
         GOTO1 MCVLOADM,DMCB,0                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   ATRPACK,DMCB+4                                                   
*                                                                               
PR13B    DS    0H                                                               
         OC    EZWRKIO,EZWRKIO                                                  
         BNZ   PR14                                                             
*                                                                               
         MVC   MCDUB,=CL8'T00A2C'                                               
         GOTO1 MCVLOADM,DMCB,0                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   EZWRKIO,DMCB+4                                                   
*                                                                               
*                                                                               
         DROP  R6                                                               
*                                                                               
PR14     LA    RE,SPWORKD                                                       
         ST    RE,GLAWORKD         SPOT WORK ADDR                               
         LA    RE,DRHOOK                                                        
         ST    RE,GLAHOOK          OUR DRIVER HOOK                              
         MVI   GLTWORKD,GLTSPOT    SPOT WORK                                    
         MVI   GLDETHED,C'Y'       I GET HEADS AT DETAIL TIME                   
         LA    RE,PROGPROF                                                      
         ST    RE,GLAPPROF                                                      
*                                                                               
*                                                                               
         MVI   GLOPT1,C'Y'         ACTIVATE REPORTS FOR INIT                    
         MVC   GLOPT2(11),GLOPT1                                                
         MVI   GLMODE,GLINIT       INITIALIZE DRIVER                            
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT1,C'N'         DE-ACTIVATE                                  
         MVC   GLOPT2(11),GLOPT1                                                
*                                                                               
*                                  SET OPTIONS                                  
*                                  -----------                                  
*                                                                               
         MVC   EZTEST,QOPT1        TEST OPTION                                  
         CLI   QOPT1,C'X'          TEST OPTION WITH DATA ERROR REPORT 9         
         BNE   *+8                                                              
         MVI   EZTEST,C'Y'         ALSO MEANS TEST OPTION                       
*                                                                               
         MVI   EZTRACE,0           TRACE OPTION                                 
         CLI   QOPT2,C'N'                                                       
         BE    PR20                                                             
         CLI   QOPT2,C' '                                                       
         BE    PR20                                                             
         CLI   QOPT2,C'A'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'FF'       TRACE EVERYTHING                             
         CLI   QOPT2,C'E'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'20'       TRACE ERRORS                                 
         CLI   QOPT2,C'M'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'60'       TRACE MODES AND ERRORS                       
         CLI   QOPT2,C'F'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'E0'       TRACE FIELDS AND ERRORS AND MODES            
         CLI   QOPT2,C'R'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'70'       TRACE MODES, ERRORS, AND ADDED RECS          
*                                                                               
PR20     DS    0H                                                               
         MVC   PREVOPT,QOPT3       Y=LIST PREVIOUS CONVERTS                     
         MVC   EZRPLOPT,QOPT4      Y=OK TO REPLACE INVOICES                     
*                                                                               
         MVC   SVSRCE,SPACES                                                    
         MVI   SVSRCEX,C' '                                                     
         CLI   QSTAUTO,C' '                                                     
         BNH   PR22                                                             
*                                                                               
         TM    QSTAUTO,X'80'       IF NOT X'80', EXCLUSION                      
         BO    *+12                                                             
         OI    QSTAUTO,X'80'                                                    
         MVI   SVSRCEX,C'-'        SET TO EXCLUDE SOURCE                        
*                                                                               
         MVC   SVSRCE,QSTAUTO                                                   
*                                                                               
PR22     DS    0H                                                               
*                                                                               
         BRAS  RE,SAVSRC                                                        
*                                                                               
         XC    RERUN,RERUN         RE-RUN AS OF DATE                            
         XC    EZRERUN,EZRERUN                                                  
         CLI   QEST+2,C' '                                                      
         BNH   PR24                                                             
*                                                                               
         CLC   QEST+2(3),=C'ALL'                                                
         BNE   *+14                                                             
         MVC   RERUN(3),=C'ALL'                                                 
         B     PR23                                                             
*                                                                               
         OC    QEST+2(6),=6C'0'                                                 
         GOTO1 DATCON,DMCB,QEST+2,(1,RERUN)                                     
*                                                                               
PR23     DS    0H                                                               
         MVC   EZRERUN,RERUN       RE-RUN DATE TO BE PASSED TO EZMOD            
*                                                                               
*                               READ WORKER FILE INDEXES                        
*                               -------------------------                       
*                               **NOTE- DRIVER INPUT DONE IN EZMPROC            
*                                                                               
PR24     DS    0H                                                               
         XC    EZWKRIND,EZWKRIND                                                
         CLI   QSTA+4,C'/'         LOCAL CABLE                                  
         BNE   *+8                                                              
         MVI   QSTA+4,C' '         MEDIA                                        
         B     PR32                                                             
*                                                                               
PR32     DS    0H                                                               
         LAY   R6,EZWRKIOB                                                      
         USING WRKIOB,R6                                                        
*                                                                               
         MVC   WRKEZUID,RCORIGID                                                
         MVC   WRKIACOM,EZCOMFCS                                                
         MVC   WRKIAREC,EZWKRREC                                                
         MVC   WRKIABUF,EZWKRBUF                                                
         MVI   WRKIFTYP,WRKIFTEZ                                                
*                                                                               
         MVI   WRKIACTN,WRKIANDX                                                
*                                                                               
         CLI   QCOMPARE,C'Y'       INCLUDE EXPIRED BATCHES?                     
         BE    *+8                                                              
         OI    WRKINDS,WRKINOXQ                                                 
*                                                                               
         GOTO1 EZWRKIO,WRKIOB                                                   
*                                                                               
         CLI   WRKIERRS,WRKIEEOF                                                
         BE    PR60                                                             
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  R6                  WRKIOB,R6                                    
*                                                                               
         BRAS  RE,FAKEIND                                                       
*                                                                               
         LA    R4,EZWKRIND                                                      
         USING UKRECD,R4                                                        
         CLI   UKDAY,X'99'         TEST AN EASI FILE                            
         BNE   PR32                                                             
*                                                                               
* IF RUNNING FOR IM, FILTER ON BATCH SEQ NUMBER HERE                            
*                                                                               
         CLI   QAFFIL,C' '         PROCESSING DELETED FOF INV MGR?              
         BNH   PR33                NO - SKIP ALL INVMGR CODE                    
         OC    SVBATSEQ,SVBATSEQ   HAVE VALID BATCH SEQ NUMBER?                 
         BZ    PR33                NO - SKIP ALL INVMGR CODE                    
         CLC   SVBATSEQ,UKFILENO   SAME BATCH SEQ?                              
         BNE   PR32                NO - GET NEXT INDEX                          
*                                                                               
PR33     DS    0H                                                               
         TM    UKSTAT,X'08'        SKIP FILES ON KEEP                           
         BZ    PR34                                                             
*                                                                               
         CLI   QAFFIL,C' '         UNLESS DOING DELETED FOR INVMGR              
         BH    PR34                                                             
*                                                                               
         OC    RERUN,RERUN         UNLESS DOING A RERUN                         
         BNZ   PR34                                                             
         CLI   PREVOPT,C'Y'        UNLESS SHOWING PREVIOUS CONVERTS             
         BNE   PR32                                                             
*                                                                               
PR34     DS    0H                                                               
         OC    QSTART(12),QSTART   ANY REQUEST DATE                             
         BZ    PR35                 NO                                          
         CLC   QSTART(12),SPACES   ANY REQUEST DATE                             
         BE    PR35                 NO                                          
*                                                                               
         GOTO1 DATCON,DMCB,(2,UKAGELD),(0,WORK)                                 
         CLC   WORK(6),QSTART                                                   
         BL    PR32                 BYPASS                                      
         CLC   WORK(6),QEND                                                     
         BH    PR32                 BYPASS                                      
*                                                                               
PR35     DS    0H                                                               
         USING EZWKRIXD,R4                                                      
*                                                                               
         CLI   EZWISTN,C'A'        MUST BE AT LEAST ALPHA LETTER                
         BL    PR32                 BYPASS THIS MESS WITHOUT A WORD!            
*                                                                               
         CLC   EZWIUID,RCORIGID    TEST RIGHT ID                                
         BNE   PR32                                                             
*                                                                               
         BRAS  RE,EQVSTA           GO SEE IF EQUIVALENT STATION                 
*                                                                               
         MVC   EZEQVSTA,EQVSTAW    PUT IN EZBLOCK FOR EQADDSNV                  
         B     PR35B                                                            
*                                                                               
* BECAUSE OF THE BRANCH STATEMENT ABOVE, THIS CODE SHOULD NEVER                 
* BE EXECUTED                                                                   
         DC    H'0'                                                             
*&&DO                                                                           
         CLI   EZWISTN,C'0'        THIS LOCAL CABLE                             
         BNL   PR32                 BYPASS                                      
*                                                                               
         MVC   EQVSTAW,EZWISTN                                                  
         CLI   EQVSTAW+3,C'.'                                                   
         BNE   *+8                                                              
         MVI   EQVSTAW+3,C' '                                                   
*                                                                               
         OC    EQVSTAW(4),SPACES                                                
         MVC   EQVSTAW+4(1),EZWIMED                                             
*                                                                               
         CLI   EZWIMED,C'C'        FORCE CABLE                                  
         BE    *+12                                                             
         CLI   EZWIMED,C'S'        AND SYNDICATION                              
         BNE   *+8                                                              
         MVI   EQVSTAW+4,C'N'      TO NETWORK                                   
*&&                                                                             
*                                                                               
PR35B    DS    0H                                                               
         CLI   QSTA,C' '           TEST STATION                                 
         BE    PR36                                                             
*                                                                               
         CLC   =C'ALL ',QSTA                                                    
         BE    PR36                                                             
*                                                                               
         CLC   =C'ALL',QSTA        COULD THIS BE INCLUDE/EXCLUDE CABLE          
         BNE   PR35E                NO                                          
*                                                                               
         CLI   QSTA+3,C'-'         EXCLUDE CABLE                                
         BNE   PR35C                                                            
         CLI   EQVSTAW,C'0'        THIS CABLE                                   
         BNL   PR32                 YES, BYPASS                                 
         B     PR36                                                             
*                                                                               
PR35C    DS    0H                                                               
         CLI   QSTA+3,C'/'         INCLUDE ONLY CABLE                           
         BNE   PR35E                                                            
         CLI   EQVSTAW,C'0'        THIS CABLE                                   
         BL    PR32                  NO, BYPASS                                 
         B     PR36                                                             
*                                                                               
PR35E    DS    0H                                                               
         CLC   EQVSTAW(4),QSTA                                                  
         BNE   PR32                                                             
         CLI   QSTA+4,C' '         MEDIA                                        
         BE    PR36                                                             
*                                                                               
         LA    R1,EQVSTAW+4                                                     
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         CLC   EZMTPMED-EZMEDTBD(1,RF),QSTA+4                                   
*                                                                               
*        CLC   EQVSTAW+4(1),QSTA+4                                              
         BNE   PR32                                                             
*                                                                               
PR36     DS    0H                                                               
         LA    R1,EQVMEDW                                                       
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         CLC   QMED,EZMTMED-EZMEDTBD(RF)                                        
         BNE   PR32                                                             
*                                                                               
         LLC   R0,EQVSTAW+4        SAVE STATION BAND                            
*                                                                               
         CLI   EZMTMED-EZMEDTBD(RF),C'N' FORCE ALL NETWORK MEDIAS TO N          
         BNE   *+8                                                              
         MVI   EQVSTAW+4,C'N'      FORCE ALL NETWORK TO MEDIA N                 
*                                                                               
         BRAS  RE,GETMKT           SEE IF STATION IS ON FILE                    
         BNE   PR32                                                             
*                                                                               
         L     RF,ADSTAT                                                        
         USING ST$STAREC,RF                                                     
         MVC   SVNETINV,ST$STNETINV   STATION'S COUNTRY                         
         DROP  RF                                                               
*                                                                               
         LA    R1,EZBYMGRP                                                      
         BRAS  RE,GETMGR                                                        
*                                                                               
         OC    QMKT,QMKT           IS THIS A MARKET REQUEST                     
         BZ    PR39                 NO                                          
         CLC   QMKT,SPACES                                                      
         BE    PR39                                                             
         CLC   =C'ALL',QMKT        ALL MARKETS                                  
         BE    PR39                                                             
         CLC   QMKT,SVSMKT         THIS RIGHT MARKET                            
         BNE   PR32                 BYPASS                                      
*                                                                               
PR39     DS   0H                                                                
         XC    WORK,WORK                                                        
         MVC   WORK(4),EQVSTAW                                                  
         LA    R1,EQVSTAW+4                                                     
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   WORK+4(1),EZMTPMED-EZMEDTBD(RF)                                  
*                                                                               
         GOTO1 MSPACK,DMCB,=C'0000',WORK,BMKTSTA                                
*                                                                               
         STC   R0,EQVSTAW+4        RESTORE MEDIA                                
*                                                                               
PR39A    DS   0H                                                                
         LAY   R6,EZWRKIOB                                                      
         USING WRKIOB,R6                                                        
*                                                                               
         MVI   WRKIACTN,WRKIAGET                                                
         GOTO1 EZWRKIO,WRKIOB                                                   
         CLI   WRKIERRS,WRKIEEOF                                                
         BE    PR32                                                             
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   SVWKDESC,WRKEZDSC                                                
         MVC   EZSRCE,WRKEZDSC+EZWCSRCE-EZWKRCMD                                
*                                                                               
         DROP  R6                                                               
*                                                                               
PR40     DS   0H                                                                
         CLI   SVSRCE,C' '         FILTERING ON SOURCE                          
         BNH   PR48                 NO                                          
         CLC   =C'ALL',SVSRCE                                                   
         BE    PR48                                                             
*                                                                               
* IF JWT, AND SOURCE FILTER IS SDI, ACCEPT ALL SDI'S                            
*                                                                               
         CLC   =AL2(AGYALPH_FR),AGENCY                                          
         BE    PR42                                                             
         CLC   =AL2(AGYALPH_H7),AGENCY                                          
         BE    PR42                                                             
         CLC   =AL2(AGYALPH_JW),AGENCY                                          
         BNE   PR44                                                             
*                                                                               
PR42     DS   0H                                                                
         CLI   SVSRCE+3,C' '                                                    
         BH    PR44                                                             
*                                                                               
         CLC   =C'SDI',SVSRCE                                                   
         BNE   PR44                                                             
*                                                                               
         CLC   =C'SDI',EZSRCE                                                   
         BE    PR46                                                             
         B     PR45                                                             
*                                                                               
* IF THIS BATCH IS EQ TO SOURCE, CK EXCLUDE                                     
*                                                                               
PR44     DS    0H                                                               
         CLC   SVSRCE,EZSRCE       THIS SOURCE                                  
         BE    PR46                                                             
*                                                                               
* THIS BATCH IS NE TO SOURCE, CK EXCLUDE                                        
*                                                                               
PR45     DS    0H                                                               
         CLI   SVSRCEX,C'-'        EXCLUDE THIS SOURCE                          
         BNE   PR32                 NO BYPASS THIS                              
         B     PR48                                                             
*                                                                               
* THIS BATCH IS EQ TO SOURCE, CK EXCLUDE                                        
*                                                                               
PR46     DS   0H                                                                
         CLI   SVSRCEX,C'-'        EXCLUDE THIS SOURCE                          
         BE    PR32                 BYPASS                                      
*                                                                               
PR48     DS    0H                                                               
         MVI   UNCONVSW,C'N'       CLEAR UNCONVERTED SW                         
         MVI   CONVSW,C'N'         AND CONVERTED THIS TIME SW                   
         MVI   EZWRKIOF,C'Y'                                                    
*                                                                               
         OI    EZLOOKSW,EZVALACT   INDICATE EVALUATING ACTUALS                  
*                                                                               
         GOTO1 =V(EZMOD),DMCB,EZBLOCKD,BSTA                                     
*                                                                               
         CLI   CONVSW,C'Y'         TEST ANY CONVERTED THIS TIME                 
         BNE   PR50                NO- NEXT INDEX                               
         CLI   EZTEST,C'Y'         TEST SUPPRESSING FILE MARKING                
         BE    PR50                 YES- SKIP                                   
         CLI   EZWRITE,C'Y'        WRITE TO FILE                                
         BNE   PR50                 NO- SKIP                                    
*                                                                               
         LA    R3,SVWKDESC                                                      
         USING EZWKRCMD,R3                                                      
         OI    EZWCSTAT,X'80'                                                   
         GOTO1 DATCON,DMCB,(0,TODAY),(1,EZWCPDAT)  PWOS                         
         CLI   UNCONVSW,C'Y'       TEST ANY REMAIN UNCONVERTED                  
         BE    *+8                                                              
         OI    EZWCSTAT,X'40'      SET FILE COMPLETELY CONVERTED                
         DROP  R3                                                               
*                                                                               
         LAY   R6,EZWRKIOB                                                      
         USING WRKIOB,R6                                                        
         MVC   WRKEZDSC,SVWKDESC                                                
*                                                                               
         MVI   WRKIACTN,WRKIADSC                                                
         GOTO1 EZWRKIO,WRKIOB                                                   
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  R6                                                               
*                                                                               
         CLI   UNCONVSW,C'Y'       TEST ANY REMAIN UNCONVERTED                  
         BE    PR50                                                             
*                                                                               
         LAY   R6,EZWRKIOB                                                      
         USING WRKIOB,R6                                                        
         MVI   WRKIACTN,WRKIAKEE                                                
         GOTO1 EZWRKIO,WRKIOB                                                   
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  R6                                                               
*                                                                               
PR50     DS    0H                                                               
         B     PR32                NEXT INDEX                                   
         DROP  R4                                                               
*                                                                               
*                                  DRIVER OUTPUT PHASE                          
*                                  -------------------                          
* DONE READING WORKER FILES HERE                                                
* IF RUNNING SOON, NO AUTO REQUESTS                                             
* IF JWT, PUT OUT SORTED I2 REQUESTS *                                          
*                                                                               
* SEE IF SOON RUN - NO SECOND STEPS FOR SOON                                    
*                                                                               
PR60     DS    0H                                                               
         CLI   QOPT5,C'N'                                                       
         BE    CLOSEIT20                                                        
*                                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   CLOSEIT20                                                        
*                                                                               
         CLOSE INFILE1                                                          
         LARL  R1,INFILE1                                                       
         FREEPOOL (R1)                                                          
*                                                                               
         BRAS  RE,INITICE          SET UP ICETOOL CALL                          
*                                                                               
         LAY   R1,ICEPAR1          COUNT OPERATOR VIA PARAMETER LIST            
         LINK  EP=ICETOOL          CALL ICETOOL                                 
         LTR   RF,RF               SUCCESSFUL ICETOOL CALL?                     
         BZ    *+6                                                              
         DC    H'0'                NO                                           
*                                                                               
CLOSEIT20 DS   0H                                                               
         MVC   SVSMKT,=C'?????'                                                 
         XC    SVBMKT,SVBMKT                                                    
         MVC   SVMGRP,=C'?????'                                                 
         MVI   FORCEHED,C'Y'                                                    
         MVI   GLMODE,GLOUTPUT                                                  
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
*                                                                               
         B     EXITX                                                            
*                                                                               
RQL      DS    0H                                                               
         B     EXIT                                                             
*                                                                               
*                                                                               
*        EZMOD PROCESSING ROUTINE                                               
*                                                                               
EZMPROC  NTR1                                                                   
         CLI   QAFFIL,C' '         PROCESSING DELETED FOF INV MGR?              
         BNH   EZMP05              NO - SKIP ALL INVMGR CODE                    
*                                                                               
         CLI   EZMODE,EZINVP       PROCESSING INVOICE?                          
         BNE   EZMP90                                                           
         MVC   WORK(10),EZIHINV                                                 
         OC    WORK(10),SPACES                                                  
         CLC   WORK(10),QUESTOR                                                 
         BNE   EZMP02                                                           
         CLI   EZWRITE,C'Y'        WRITE TO FILE                                
         BNE   EZMP02              NO- SKIP                                     
         CLI   EZTEST,C'Y'                                                      
         BE    EZMP02                                                           
         BRAS  RE,WRTIMGR                                                       
*                                                                               
EZMP02   DS    0H                                                               
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP90                                                           
*                                                                               
EZMP05   DS    0H                                                               
         CLI   EZMODE,EZERRP       PROCESS ERROR                                
         BE    EZMP30                                                           
         CLI   EZMODE,EZCMLADD     ADDING A COMMERICAL                          
         BE    EZMP60                                                           
         CLI   EZMODE,EZSPTP       SPOT DETAIL                                  
         BE    EZMP16                                                           
         CLI   EZMODE,EZINVL                                                    
         BNE   EZMP10                                                           
*                                                                               
         TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP80               PRINT AS REPORT 10                          
*                                                                               
         TM    EZIHCVST,EZIHCVQ    TEST ALREADY CONVERTED                       
         BZ    EZMP10               NO- TRY TO CONVERT                          
         TM    EZIHCVST,EZIHRCVQ   TEST RECONVERT                               
         BO    EZMP10               YES, TRY TO CONVERT                         
         OC    RERUN,RERUN         YES- DO WE HAVE RERUN DATE                   
         BZ    EZMP26               NO- PUT ON PREVIOUS LIST                    
         CLC   RERUN(3),=C'ALL'                                                 
         BE    EZMP21                                                           
         CLC   EZIHCVDT,RERUN      YES- TEST = CONVERTED DATE                   
         BNE   EZMP26              NO- PUT ON PREVIOUS LIST                     
         B     EZMP21                                                           
*                                                                               
*                                                                               
EZMP10   CLI   EZMODE,EZINVP       PROC INV                                     
         BNE   EZMP16                                                           
*                                                                               
         OC    EZCLTFTR,EZCLTFTR   FILTERING ON CLIENT?                         
         BZ    EZMP11                                                           
         CLC   EZIHLADB,EZCLTFTR   CLIENT SAME AS FILTER?                       
         BE    EZMP11                                                           
         MVI   UNCONVSW,C'Y'       SET HAVE UN-CONVERTED                        
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP90                                                           
*                                                                               
EZMP11   DS    0H                                                               
         TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BZ    *+12                                                             
         MVI   EZMODE,EZINVL                                                    
         B     EZMP80                                                           
*                                                                               
         TM    EZIHCVST,EZIHCVQ    TEST ALREADY CONVERTED                       
         BZ    EZMP20               NO- TRY TO CONVERT                          
         TM    EZIHCVST,EZIHRCVQ   TEST RECONVERT                               
         BO    EZMP20               YES, TRY TO CONVERT                         
         OC    RERUN,RERUN         YES- DO WE HAVE RERUN DATE                   
         BZ    EZMP26              NO- PUT ON PREVIOUS LIST                     
         CLC   RERUN(3),=C'ALL'                                                 
         BE    EZMP21                                                           
         CLC   EZIHCVDT,RERUN      YES- TEST = CONVERTED DATE                   
         BNE   EZMP26               NO- PUT ON PREVIOUS LIST                    
         B     EZMP21              ELSE RE-CONVERT                              
*                                                                               
EZMP16   TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP90               BYPASS                                      
*                                                                               
         TM    EZIHCVST,EZIHCVQ    TEST ALREADY CONVERTED                       
         BZ    EZMP20               NO- PROCESS SPOT                            
         TM    EZIHCVST,EZIHRCVQ   TEST RECONVERT                               
         BO    EZMP20               YES, PROCESS SPOT                           
*                                                                               
         OC    RERUN,RERUN         UNLESS DOING A RERUN                         
         BZ    EZMP90               NO- EXIT                                    
*                                                                               
         CLC   RERUN(3),=C'ALL'                                                 
         BE    EZMP21                                                           
         CLC   EZIHCVDT,RERUN      YES- TEST = CONVERTED DATE                   
         BNE   EZMP90               NO- EXIT                                    
         B     EZMP21                                                           
*                                                                               
*                                  ELSE PROCESS SPOT                            
*                                                                               
EZMP20   DS    0H                                                               
         OC    RERUN,RERUN         DO WE HAVE RERUN DATE                        
         BNZ   EZMP90               YES, UNCONVERTED/RECONV BYPASSED            
*                                                                               
*                                                                               
*                                  NEED TO RECREATE PACKED STATION              
*                                                                               
EZMP21   XC    WORK,WORK                                                        
         MVC   WORK(4),EQVSTAW                                                  
         LA    R1,EQVSTAW+4                                                     
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   WORK+4(1),EZMTPMED-EZMEDTBD(RF)                                  
*                                                                               
         CLI   EZSPTNET,C'S'       NO LOCAL CABLE UNLESS SPOT                   
         BNE   EZMP22                                                           
         CLI   EQVSTAW,C'0'        AND MUST BE NUMERIC                          
         BL    EZMP22                                                           
*                                                                               
         OC    EZIHNET,EZIHNET                                                  
         BZ    EZMP22                                                           
         MVI   WORK+4,C'/'                                                      
         MVC   WORK+5(3),EZIHNET                                                
*                                                                               
EZMP22   DS    0H                                                               
         XC    WORK+32(32),WORK+32                                              
         LA    R1,WORK+32                                                       
         USING STAPACKD,R1                                                      
         MVI   STAPACT,C'P'                                                     
         MVC   STAPAGY,AGENCY                                                   
         MVC   STAPCTRY,COUNTRY                                                 
         MVC   STAPMED,QMED                                                     
         MVC   STAPACOM,ACOMFACS                                                
         MVC   STAPQMKT,=C'0000'   MARKET                                       
         MVC   STAPQSTA(8),WORK    STATION                                      
*                                                                               
         GOTO1 VSTAPACK,(R1)                                                    
*                                                                               
         MVC   BMKTSTA,STAPMKST                                                 
*                                                                               
* IF NET GIVEN, DON'T PUT IN KEY, BUT SAVE FOR SPOT DETAIL LINES *              
* IF NONE GIVEN, MAY APPEAR LATER IN SPOT DETAIL                 *              
*                                                                               
         OC    EZIHNET,EZIHNET     THIS A LOCAL CABLE                           
         BZ    EZMP22C              NO                                          
*                                                                               
         CLI   WORK,C'0'           THIS CABLE HEAD                              
         BL    EZMP22C              NO                                          
*                                                                               
         MVC   EZSPNETH,BMKTSTA+4  SAVE BINARY NETWORK                          
         NI    EZSPNETH,X'7F'                                                   
         NI    BMKTSTA+4,X'80'                                                  
*                                                                               
EZMP22C  DS    0H                                                               
         CLI   STAPERR,0                                                        
         BE    EZMP22L                                                          
         CLI   STAPERR,04          UNKNOWN NETWORK                              
         BE    EZMP22E              YES                                         
         CLI   STAPERR,07          NETWORK NOT ACTIVE ON THIS HEADEND           
         BE    EZMP22E              YES                                         
         CLI   STAPERR,08          CABLE HEADEND NOT FOUND                      
         BE    EZMP22E              YES                                         
         DC    H'0'                                                             
*                                                                               
EZMP22E  DS    0H                                                               
         MVI   EZERRCD,EZERRSTA    SET BAD STATION CALL LETTERS                 
         L     R1,=A(UNKNNET)                                                   
         MVC   EZERRMSG,0(R1)                                                   
         CLI   STAPERR,04          UNKNOWN NETWORK                              
         BE    EZMP24                                                           
         L     R1,=A(NETINACT)                                                  
         MVC   EZERRMSG,0(R1)                                                   
         CLI   STAPERR,07          NETWORK NOT ACTIVE ON THIS HEADEND           
         BE    EZMP24                                                           
         L     R1,=A(CABSTANF)                                                  
         MVC   EZERRMSG,0(R1)                                                   
         B     EZMP24                                                           
         DROP  R1                                                               
*                                                                               
EZMP22L  DS    0H                                                               
         L     RF,=V(EZADDINV)                                                  
*                                                                               
         CLI   EZSPTNET,C'S'       FORCE TO NEW INVOICE FOR SPOT                
         BE    EZMP22N                                                          
*                                                                               
         CLI   EZNIOPT,C'Y'        EZ PROF 9 - USE NEW INVOICING                
         BNE   *+8                                                              
*                                                                               
EZMP22N  DS    0H                                                               
         CLI   EZMODE,EZINVP                                                    
         BNE   EZMP22N1                                                         
*                                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)    SOON?                  
         BZ    EZMP22N1               NO - DO NOT CHECK FOR DUPLICATES          
*                                                                               
         BRAS  RE,CHKDUP                                                        
         BE    EZMP22N1                                                         
*                                                                               
         MVI   DUPFLAG,C'Y'                                                     
         MVI   EZMODE,EZINVL                                                    
         MVI   EZERRCD,EZERRDUP                                                 
         L     R1,=A(DUPINV)                                                    
         MVC   EZERRMSG,0(R1)                                                   
*                                                                               
EZMP22N1 DS    0H                                                               
         CLI   DUPFLAG,C'Y'                                                     
         BE    EZMP22P                                                          
*                                                                               
         MVI   RECONFLG,C'N'                                                    
         TM    EZIHCVST,EZIHRCVQ                                                
         BZ    *+8                                                              
         MVI   RECONFLG,C'Y'                                                    
*                                                                               
         OC    RERUN,RERUN                                                      
         BZ    *+8                                                              
         MVI   RECONFLG,C'Y'                                                    
*                                                                               
         L     RF,=V(EZADDSNV)                                                  
         GOTO1 (RF),DMCB,EZBLOCKD,SPWORKD                                       
*                                                                               
EZMP22P  DS    0H                                                               
         CLI   EZMODE,EZINVL                                                    
         BNE   EZMP22Q                                                          
         CLI   DUPFLAG,C'Y'                                                     
         BNE   EZMP22Q                                                          
         MVI   DUPFLAG,C'N'                                                     
*                                                                               
EZMP22Q  DS    0H                                                               
         CLI   EZMODE,EZINVL       IGNORE UNLESS LAST FOR INVOICE               
         BNE   EZMP90                                                           
         CLI   EZERRCD,0           IF EZADDINV RETURN ERROR                     
         BNE   EZMP24              INVOICE WAS NOT CONVERTED                    
*                                                                               
         TM    EZIHCVST,X'01'      DID IT COME FROM IM?                         
         BZ    EZMP22R             NO - DO NOT SEND                             
         CLI   QOPT5,C'I'                                                       
         BE    *+12                                                             
         CLI   EZTEST,C'Y'                                                      
         BE    EZMP22R                                                          
         BRAS  RE,WRTIMGR                                                       
*                                  REPORT 1 - CONVERTED INVOICE                 
EZMP22R  DS    0H                                                               
         MVI   GLOPT1,C'Y'                                                      
         MVI   RPTNO,1                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   CONVSW,C'Y'         SET HAVE DONE A CONVERSION                   
*                                                                               
         OI    FIRSTSW,FIRSTSWC    SET ON CONVERTED INVOICES SW                 
*                                                                               
         CLI   QOPT5,C'G'                                                       
         BE    EZMP22T                                                          
         CLI   QOPT5,C'F'                                                       
         BE    EZMP22T                                                          
*                                                                               
         CLI   QOPT1,C'X'          X= TEST-NO FILE MARKING                      
         BE    EZMP23               NO I2 REQUESTS                              
         CLI   QOPT1,C'Y'          Y= TEST-NO FILE MARKING                      
         BE    EZMP23               NO I2 REQUESTS                              
*                                                                               
EZMP22T  DS    0H                                                               
         LA    R1,EZBYMGRP                                                      
         BRAS  RE,GETMGR                                                        
*                                                                               
         BRAS  RE,GENI2RQ          GENERATE I2 REQUEST                          
*                                                                               
EZMP23   MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT1,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 2 - UNCONVERTED                       
EZMP24   DS    0H                                                               
         CLI   EZERRCD,EZERRCON    IF EZADDINV REP RUN NO CON #                 
         BE    EZMP90               YES, JUST BYPASS                            
*                                                                               
         MVI   UNCONVSW,C'Y'       SET HAVE UN-CONVERTED                        
         MVI   GLOPT2,C'Y'                                                      
         MVI   RPTNO,2                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT2,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 3 - PREVIOUSLY CONVERTED              
EZMP26   DS    0H                                                               
         CLI   EZMODE,EZINVL       DON'T PROC UNTIL INV LAST                    
         BNE   EZMP90                                                           
*                                                                               
         CLI   PREVOPT,C'Y'        TEST DOING PREVIOUS REPORT                   
         BNE   EZMP28              NO- SKIP                                     
         MVI   GLOPT3,C'Y'                                                      
         MVI   RPTNO,3                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT3,C'N'         DE-ACTIVATE                                  
*                                                                               
EZMP28   DS    0H                                                               
         MVI   EZMODE,EZINVL       SET TO SKIP PROC OF INVOICE                  
         B     EZMP90                                                           
*                                  HANDLE ALL ERRORS                            
*                                  -----------------                            
EZMP30   DS    0H                                                               
         TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP90               BYPASS                                      
*                                                                               
         TM    EZIHCVST,EZIHCVQ    TEST ALREADY CONVERTED                       
         BZ    EZMP32               NO- TRY TO CONVERT                          
         TM    EZIHCVST,EZIHRCVQ   TEST RECONVERT                               
         BO    EZMP32               YES, TRY TO CONVERT                         
         OC    RERUN,RERUN         YES- DO WE HAVE RERUN DATE                   
         BZ    EZMP26               NO- PUT ON PREVIOUS LIST                    
         CLC   RERUN(3),=C'ALL'                                                 
         BE    EZMP32                                                           
         CLC   EZIHCVDT,RERUN      YES- TEST = CONVERTED DATE                   
         BNE   EZMP26              NO- PUT ON PREVIOUS LIST                     
*                                                                               
EZMP32   DS    0H                                                               
         CLI   EZERRCD,EZERINVN    TEST INVALID INVOICE NAME                    
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERADVN    TEST ADVERTISER NAME MISSING                 
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRCLT    TEST INVALID CLIENT CODE                     
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRDAR    REP NOT SET UP IN DAR PROF                   
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERDREP    DISCREPANT REP CODES?                        
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRACT    BAD ACTUALS DATA?                            
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRDEM    DISCREPANT DEMOS?                            
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRENO    ESTIMATE NOT FOUND FOR PRD<-CML?             
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRCAC    TRYING TO ADD COMMERCIALS SOON?              
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERRBLB    INVALID BILLBOARD INDICATOR?                 
         BNE   *+12                NO                                           
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST AS UNCONVERTED                          
*                                                                               
         CLI   EZERRCD,EZERFILM    TEST INVALID COMMERCIAL                      
         BE    EZMP50              YES- SPECIAL LIST                            
         CLI   EZERRCD,EZERRCPR    TEST FILM/PROD ERROR                         
         BE    EZMP50              YES- SPECIAL LIST                            
         CLI   EZERRCD,EZERRRNF    TEST RECORD NOT FOUND                        
         BE    EZMP34                                                           
         CLI   EZERRCD,EZERRSTA    TEST BAD STATION CALL LETTERS                
         BE    EZMP34                                                           
         CLI   EZERRCD,EZERMCLT    TEST MISSING CLIENT CODE                     
         BE    EZMP36                                                           
         CLI   EZERRCD,EZERREP     REP ID MISSING                               
         BE    EZMP39                                                           
         CLI   EZERRCD,EZERMPRD    TEST MISSING PRODUCT CODE                    
         BE    EZMP44                                                           
         CLI   EZERRCD,EZERRENF    TEST ESTIMATE NOT ON FILE                    
         BE    EZMP45A                                                          
         CLI   EZERRCD,EZERRSCD    OR SPOTPAK CODE ERROR                        
         BNE   EZMP70              ELSE- MUST BE DATA ERROR                     
*                                                                               
EZMP34   DS    0H                                                               
         CLI   EZRNFRPT,C'Y'       TEST A REPEATED REC NOT FOUND                
         BE    EZMP90              YES- SKIP                                    
         ICM   R2,15,EZERRFAD      A(FIELD IN ERROR)                            
         LA    R0,EZIHADVN         TEST ADVERTISER FIELD                        
         CR    R2,R0                                                            
         BE    EZMP36                                                           
         LA    R0,EZIHAAID                                                      
         CR    R2,R0                                                            
         BNE   EZMP38                                                           
*                                                                               
EZMP36   DS    0H                  MISSING CLIENT                               
         MVI   GLOPT4,C'Y'                                                      
         MVI   RPTNO,4                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT4,C'N'         DE-ACTIVATE                                  
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              LIST UNCONVERTED                             
*                                                                               
EZMP38   DS    0H                                                               
         LA    R0,EZIHSREP         TEST REP FIELD                               
         CR    R2,R0                                                            
         BNE   EZMP40                                                           
*                                                                               
EZMP39   DS    0H                  REPORT 12 - MISSING REP IDS                  
         MVI   GLOPT12,C'Y'                                                     
         MVI   RPTNO,12                                                         
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT12,C'N'         DE-ACTIVATE                                 
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              UNCONVERTED                                  
*                                                                               
EZMP40   DS    0H                                                               
         LA    R0,EZIHPRDN         TEST PRODUCT FIELD                           
         CR    R2,R0                                                            
         BE    EZMP44                                                           
         LA    R0,EZIHAPID                                                      
         CR    R2,R0                                                            
         BNE   EZMP45                                                           
*                                                                               
EZMP44   DS    0H                  REPORT 5 - MISSING PRODUCTS                  
         MVI   GLOPT5,C'Y'                                                      
         MVI   RPTNO,5                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT5,C'N'         DE-ACTIVATE                                  
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              UNCONVERTED                                  
*                                                                               
EZMP45   DS    0H                                                               
         LA    R0,EZIHEST          TEST ESTIMATE FIELD                          
         CR    R2,R0                                                            
         BNE   EZMP46                                                           
*                                                                               
EZMP45A  DS    0H                  REPORT 11 - MISSING ESTIMATES                
         MVI   GLOPT11,C'Y'                                                     
         MVI   RPTNO,11                                                         
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT11,C'N'         DE-ACTIVATE                                 
         MVI   EZMODE,EZINVL       SET TO SKIP TO NEXT INV                      
         B     EZMP24              UNCONVERTED                                  
*                                                                               
EZMP46   DS    0H                                                               
         LA    R0,EZSPCOPY         TEST COMMERCIAL FIELD                        
         CR    R2,R0                                                            
         BNE   EZMP74                                                           
*                                  REPORT 6 - MISSING FILMS                     
         MVI   GLOPT6,C'Y'                                                      
         MVI   RPTNO,6                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT6,C'N'         DE-ACTIVATE                                  
*                                                                               
         CLI   EZPROPT,C'Y'        GETTING PRODUCTS FROM COMMERCIALS?           
         BE    *+12                                                             
         CLI   EZPROPT,C'P'                                                     
         BNE   EZMP48                                                           
*                                                                               
         TM    EZIHCVST,EZIHCOVR   CLIENT/PRODUCT OVERRIDE?                     
         BO    EZMP48       YES - SKIP ERROR, OVERRIDE TAKES PRECEDENCE         
         MVI   EZERRCD,EZERRCML    COMMERCIAL NOT FOUND                         
         L     R1,=A(NOCML)        ERROR MESSAGE                                
         MVI   EZMODE,EZINVL                                                    
         MVC   EZERRMSG,0(R1)                                                   
         B     EZMP24              BRANCH TO HANDLE ERROR                       
*                                                                               
EZMP48   DS    0H                                                               
         B     EZMP90                                                           
*                                  REPORT 7 - FILM/PROD ERRORS                  
EZMP50   DS    0H                                                               
         MVI   GLOPT7,C'Y'                                                      
         MVI   RPTNO,7                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT7,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 8 - ADDED FILMS                       
EZMP60   DS    0H                                                               
         MVI   GLOPT8,C'Y'                                                      
         MVI   RPTNO,8                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT8,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 9 - DATA ERRORS                       
EZMP70   CLI   QOPT1,C'X'          PRODUCE DATA ERROR REPORT                    
         BNE   EZMP90               NO                                          
*                                                                               
EZMP74   DS    0H                                                               
         MVI   GLOPT9,C'Y'                                                      
         MVI   RPTNO,9                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT9,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                                                               
*                                  REPORT 10 - DELETED INVOICES                 
EZMP80   DS    0H                                                               
         CLI   EZ5NODEL,C'Y'       BYPASS THIS REPORT                           
         BE    EZMP90               YES                                         
*                                                                               
         MVI   GLOPT10,C'Y'                                                     
         MVI   RPTNO,10                                                         
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT10,C'N'        DE-ACTIVATE                                  
*                                                                               
EZMP90   DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*        DRIVER HOOK ROUTINE                                                    
*                                                                               
DRHOOK   NTR1  BASE=*,LABEL=*                                                   
         CLI   GLHOOK,GLROUT       TEST TO EXECUTE USER ROUTINE                 
         BNE   DH005                                                            
         CLI   GLMODE,GLINPUT      YES - INPUT PHASE                            
         BE    DH100                                                            
         CLI   GLMODE,GLOUTPUT           OUTPUT PHASE                           
         BE    DH200                                                            
         DC    H'0'                                                             
*                                                                               
DH005    CLI   GLHOOK,GLRESOLV     TEST TO RESOLVE LABELS                       
         BE    DH010                                                            
         CLI   GLHOOK,GLRESLIT     TEST TO RESOLVE LITERAL                      
         BE    DH300                                                            
         CLI   GLHOOK,GLHEAD       HEADLINES                                    
         BE    DH400                                                            
         CLI   GLHOOK,GLPUTSRT     RECORD INPUT TEST                            
         BE    DH470                                                            
         B     DHX                                                              
*                                                                               
*                                                                               
*        RESOLVE ROUTINE LABELS                                                 
*                                                                               
DH010    DS    0H                                                               
         L     R1,=A(ROUTLIST)                                                  
         LA    R2,GLLABEL                                                       
*                                                                               
DH020    CLI   0(R1),X'FF'                                                      
         BE    DHX                                                              
         CLC   0(8,R1),0(R2)                                                    
         BE    DH030                                                            
         LA    R1,12(R1)                                                        
         B     DH020                                                            
*                                                                               
DH030    MVC   GLAROUT,8(R1)                                                    
         B     DHX                                                              
*                                                                               
*        EXECUTE INPUT PHASE ROUTINES                                           
*                                                                               
DH100    L     RF,GLAROUT                                                       
         L     R3,GLAIFLD                                                       
         BASR  RE,RF                                                            
         DC    H'0'                                                             
*                                                                               
*        EXECUTE OUTPUT PHASE ROUTINES                                          
*                                                                               
DH200    DS    0H                                                               
         L     RF,GLAROUT                                                       
         L     R2,GLAIFLD                                                       
         L     R3,GLAOFLD                                                       
         LTR   R3,R3               IF OUTPUT FIELD NOT GIVEN                    
         BNZ   *+8                                                              
         LA    R3,WORK             USE WORK                                     
         BASR  RE,RF                                                            
         DC    H'0'                                                             
*                                                                               
*                                                                               
*       INPUT ROUTINES                                                          
*                                                                               
WBMGR    DS    0H                  MARKET GROUP                                 
         CLI   EZBYMGRP,0          RUNNING BY MARKET GROUP                      
         BE    DHX                  NO                                          
         CLI   EZBYMGRP,C'*'       RUNNING BY MARKET GROUP                      
         BE    DHX                  NO                                          
         CLI   EZBYMGRP,C'#'       RUNNING BY STATION                           
         BE    DHX                  YES                                         
         BRAS  RE,GETMKT                                                        
*                                                                               
         LA    R1,EZBYMGRP                                                      
         BRAS  RE,GETMGR                                                        
*                                                                               
* WHEN RUNNING BY 2-CHAR MARKET GROUPS, CHANGE FIRST '?' TO NULL                
* SO THIS MARKET GROUP ALWAYS COMES FIRST IN THE SORT                           
* LIKE IT DOES WITH 1-CHAR MARKET GROUPS ('?' PRECEDES C'A' IN SORT)            
*                                                                               
         CLC   SVMGRP,=C'?????'                                                 
         BNE   WBMGR10                                                          
         CLI   MGR2FLAG,C'Y'                                                    
         BNE   *+8                                                              
         MVI   SVMGRP,X'00'                                                     
*                                                                               
WBMGR10  MVC   0(5,R3),SVMGRP                                                   
         B     DHX                                                              
*                                                                               
*                                                                               
WBMKT    DS    0H                  MARKET                                       
         XC    0(2,R3),0(R3)                                                    
         CLI   EZBYMGRP,C'#'       RUNNING IN STATION ORDER ONLY                
         BE    DHX                                                              
*                                                                               
         BRAS  RE,GETMKT           FIND EQUIVALENT STATION, VALIDATE            
*                                                                               
         MVC   0(2,R3),SVBMKT                                                   
         B     DHX                                                              
*                                                                               
*                                                                               
WBSTA    DS    0H                  BATCH STATION                                
         BRAS  RE,GETMKT           FIND EQUIVALENT STATION                      
         MVC   0(7,R3),EZBTSTN                                                  
         CLI   EZSPTNET,C'S'       NO LOCAL CABLE UNLESS SPOT                   
         BNE   DHX                                                              
         CLI   EQVSTAW,C'0'        AND MUST BE NUMERIC                          
         BL    DHX                                                              
*                                                                               
         OC    EZIHNET,EZIHNET     CABLE HEAD NETWORK                           
         BZ    DHX                  NO                                          
         MVI   4(R3),C'/'                                                       
         MVC   5(3,R3),EZIHNET                                                  
         B     DHX                                                              
*                                                                               
*                                                                               
WBDATE   DS    0H                  BATCH DATE                                   
         MVC   0(17,R3),SPACES                                                  
         GOTO1 DATCON,DMCB,(3,EZBTBRDT),(5,0(R3))                               
         CLI   EZSEQDIS,C'Y'                                                    
         BNE   DHX                                                              
         SR    R2,R2                                                            
         ICM   R2,15,EZWKRIND+UKFILENO-UKKEY                                    
         MVC   9(2,R3),=C'S#'                                                   
         EDIT  (R2),(6,11(R3)),ALIGN=LEFT                                       
         B     DHX                                                              
*                                                                               
*                                                                               
*                                                                               
WICLTN   DS    0H                  INVOICE CLIENT NAME                          
         MVC   0(25,R3),EZIHADVN                                                
         CLI   EZIHADVN,C' '                                                    
         BH    *+10                                                             
         MVC   0(25,R3),=CL25'* CLT NAME MISSING *'                             
*                                                                               
         LA    RF,25(R3)                                                        
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVI   2(RF),C'('                                                       
         MVC   3(3,RF),EZIHLADC                                                 
         CLC   3(3,RF),SPACES      IF NO CODE                                   
         BH    *+10                                                             
         MVC   3(3,RF),=C'***'     SET TO ***                                   
         LA    RE,6(RF)                                                         
         CLI   5(RF),C' '                                                       
         BH    *+6                                                              
         BCTR  RE,R0                                                            
         MVI   0(RE),C')'                                                       
*                                                                               
         OC    0(35,R3),SPACES                                                  
         B     DHX                                                              
*                                                                               
*                                                                               
*                                                                               
WIPRDN   DS    0H                  PRODUCT NAME                                 
         CLI   GLRECNO,5           IF MISSING PRD REPORT                        
         BNE   WIPRDN4                                                          
*                                                                               
         MVC   0(25,R3),EZERRDTA   USE ERROR FIELD                              
         B     DHX                                                              
*                                                                               
WIPRDN4  DS    0H                                                               
         MVC   0(25,R3),EZIHPRDN   ELSE USE INVOICE PRD                         
         CLI   EZIHPRDN,C' '                                                    
         BH    WIPRDN6                                                          
         MVC   0(7,R3),=C'**ALL**'                                              
         CLI   GLRECNO,8           'ALL' FOR ADDED FILM LIST                    
         BE    DHX                                                              
         MVC   0(25,R3),=CL25'* PRD NAME MISSING *'                             
*                                                                               
* SHOW PROD, PROD2, EST AS (XXX,YYY,EST)                                        
*                                                                               
WIPRDN6  DS    0H                                                               
         LA    RF,25(R3)           FLOAT CODE AS (XXX)                          
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
*                                                                               
         MVI   2(RF),C'('                                                       
         MVC   3(3,RF),EZIHLPRC                                                 
         CLC   3(3,RF),SPACES      IF NO CODE                                   
         BH    *+10                                                             
         MVC   3(3,RF),=C'***'     SET TO ***                                   
         LA    RE,6(RF)                                                         
         CLI   5(RF),C' '                                                       
         BH    *+6                                                              
         BCTR  RE,R0                                                            
*                                                                               
         CLC   EZIHLP2C,SPACES                                                  
         BNH   WIPRDN8                                                          
         LR    RF,RE                                                            
         MVI   0(RE),C','                                                       
         MVC   1(3,RE),EZIHLP2C                                                 
         LA    RE,4(,RE)                                                        
         CLI   3(RF),C' '                                                       
         BH    *+6                                                              
         BCTR  RE,R0                                                            
*                                                                               
WIPRDN8  DS    0H                                                               
         CLI   EZIHLEST,0                                                       
         BE    WIPRDN9                                                          
         LR    RF,RE                                                            
         MVI   0(RE),C','                                                       
         ZIC   R0,EZIHLEST                                                      
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  1(3,RE),DUB                                                      
         LA    RE,4(,RE)                                                        
*                                                                               
WIPRDN9  DS    0H                                                               
         MVI   0(RE),C')'                                                       
*                                                                               
         OC    0(35,R3),SPACES                                                  
         B     DHX                                                              
*                                                                               
*                                                                               
*                                                                               
WIREP    DS    0H                  REP ID                                       
         MVC   0(3,R3),EZERRDTA    USE ERROR FIELD                              
         B     DHX                                                              
*                                                                               
WINVNO   DS    0H                  INVOICE NUMBER                               
         MVC   0(10,R3),EZIHINV                                                 
         CLC   EZIHINV,SPACES                                                   
         BNE   DHX                                                              
         MVC   0(3,R3),=C'***'     NO INV = ***                                 
         B     DHX                                                              
*                                                                               
*                                                                               
WMOS     DS    0H                  INVOICE MONTH OF SERVICE                     
         MVC   0(2,R3),EZIHBMOS                                                 
         MVI   2(R3),0                                                          
         B     DHX                                                              
*                                                                               
*                                                                               
WIEST    DS    0H                  INVOICE ESTIMATE NUMBER                      
         EDIT  EZIHBEST,(3,0(R3))                                               
         CLI   EZIHBEST,0          WAS CONVERTED EST ZERO                       
         BNE   DHX                  NO                                          
*                                                                               
         MVC   0(3,R3),EZIHEST                                                  
         OC    0(3,R3),SPACES                                                   
         B     DHX                                                              
*                                                                               
*                                                                               
WIGRS    DS    0H                  INVOICE GROSS TOTAL                          
         LA    RF,EZBLOCKD                                                      
         AHI   RF,EZIHPSPC-EZBLOCKD                                             
         MVC   0(8,R3),0(RF)                                                    
         B     DHX                                                              
*                                                                               
*                                                                               
WSRC     DS    0H                  SOURCE                                       
         MVC   0(4,R3),SVWKDESC+EZWCSRCE-EZWKRCMD                               
         B     DHX                                                              
*                                                                               
*                                                                               
WCMNT    DS    0H                  COMMENT ON CONVERTED INVOICE                 
         MVC   0(80,R3),SPACES                                                  
*                                                                               
         LR    RF,R3                                                            
*                                                                               
         TM    EZIHCVST,EZIHCOVR   CLIENT/PROD OVERRIDE                         
         BZ    WCMNT22                                                          
*                                                                               
         CLC   EZIHAAID,SPACES     STATION SUPPLIED ADV CODE?                   
         BNH   WCMNT10              NO                                          
*                                                                               
         MVC   0(12,RF),=C'INVOICE-CLT('                                        
         MVC   12(3,RF),EZIHAAID                                                
         LA    RF,15(,RF)                                                       
         CLI   EZIHAAID+2,C' '                                                  
         BH    *+6                                                              
         BCTR  RF,0                                                             
         MVI   0(RF),C')'                                                       
         LA    RF,2(,RF)           LEAVE SPACE AFTER ')'                        
*                                                                               
         CLC   EZIHAPID,SPACES     STATION SUPPLIED PRODUCT CODE?               
         BNH   WCMNT10              NO                                          
*                                                                               
         MVC   0(4,RF),=C'PRD('                                                 
         MVC   4(L'EZIHAPID,RF),EZIHAPID                                        
         OC    4(L'EZIHAPID,RF),SPACES                                          
         LA    RF,4+L'EZIHAPID-1(,RF)                                           
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVI   1(RF),C')'                                                       
         LA    RF,3(,RF)           LEAVE SPACE AFTER ')'                        
*                                                                               
WCMNT10  MVC   0(13,RF),=C'OVERRIDE CLT('                                       
         MVC   13(3,RF),EZIHLADC                                                
         LA    RF,16(,RF)                                                       
         CLI   EZIHLADC+2,C' '                                                  
         BH    *+6                                                              
         BCTR  RF,0                                                             
         MVI   0(RF),C')'                                                       
         LA    RF,1(RF)                                                         
*                                                                               
         CLI   EZIHCVPR,0          1-BYTE OVERRIDE?                             
         BNE   WCMNT15             YES                                          
*                                                                               
         CLI   EZSPTNET,C'N'       NET?                                         
         BNE   WCMNT20             NO = NO OVERRIDE                             
         CLC   EZIHSPRD,SPACES     CHECK 3-CHAR OVERRIDE                        
         BNH   WCMNT20                                                          
*                                                                               
WCMNT15  DS    0H                  PRODUCT OVERRIDE PRESENT                     
         MVC   0(5,RF),=C'-PRD('                                                
         MVC   5(3,RF),EZIHLPRC                                                 
         LA    RF,8(,RF)                                                        
         CLI   EZIHLPRC+2,C' '                                                  
         BH    *+6                                                              
         BCTR  RF,0                                                             
*                                                                               
         CLI   EZIHCVP2,0          1-BYTE OVERRIDE                              
         BNE   WCMNT16             YES                                          
*                                                                               
         CLI   EZSPTNET,C'N'       NET?                                         
         BNE   *+14                NO = NO OVERRIDE                             
         CLC   EZIHSPR2,SPACES     CHECK 3-CHAR OVERRIDE                        
         BH    WCMNT16                                                          
*                                                                               
         MVI   0(RF),C')'          NO 2ND OVERRIDE HERE                         
         LA    RF,1(RF)                                                         
         B     WCMNT20                                                          
*                                                                               
WCMNT16  DS    0H                  2ND PRD OVERRIDE PRESENT HERE                
         MVI   0(RF),C'/'                                                       
         MVC   1(3,RF),EZIHLP2C                                                 
         LA    RF,4(,RF)                                                        
         CLI   EZIHLP2C+2,C' '                                                  
         BH    *+6                                                              
         BCTR  RF,0                                                             
         MVI   0(RF),C')'                                                       
         LA    RF,1(RF)                                                         
*                                                                               
WCMNT20  DS    0H                                                               
         CLI   EZIHCVES,0                                                       
         BE    WCMNT22                                                          
*                                                                               
         MVC   0(5,RF),=C'-EST('                                                
         LA    RF,5(,RF)                                                        
         EDIT  EZIHCVES,(3,0(RF)),ALIGN=LEFT                                    
         LA    RF,2(,RF)                                                        
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
*                                                                               
         MVI   1(RF),C')'                                                       
         LA    RF,2(RF)                                                         
*                                                                               
WCMNT22  DS    0H                                                               
         TMY   EZIHSFL2,EZIHF2NOPKGQ  NO-PACKAGE '#' OVERRIDE?                  
         BO    *+12                                                             
         CLI   EZIHCVNP,X'00'                                                   
         BE    WCMNT25                                                          
*                                                                               
         CR    RF,R3               THE VERY START OF THE COMMENT?               
         BNH   *+12                YES, DON'T DISPLAY '-'                       
         MVI   0(RF),C'-'                                                       
         LA    RF,1(RF)                                                         
*                                                                               
         MVC   0(4,RF),=C'PKG('                                                 
         LA    RF,4(,RF)                                                        
*                                                                               
         TMY   EZIHSFL2,EZIHF2NOPKGQ  NO-PACKAGE '#' OVERRIDE?                  
         BZ    *+18                                                             
         MVC   0(2,RF),=C'#)'                                                   
         LA    RF,2(RF)                                                         
         B     WCMNT25                                                          
*                                                                               
         EDIT  EZIHCVNP,(3,0(RF)),ALIGN=LEFT                                    
         LA    RF,2(,RF)                                                        
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
*                                                                               
         MVI   1(RF),C')'                                                       
         LA    RF,2(RF)                                                         
*                                                                               
WCMNT25  DS    0H                                                               
         LA    RE,EZIHSREP         REP OVERRIDE                                 
         CLI   EZIHSREP,C' '                                                    
         BH    WCMNT25A                                                         
*                                                                               
         CLI   EZTRDREP,C'Y'       DOING TRADE REPS?                            
         BNE   WCMNT27                                                          
         CLI   EZIHLREP,C' '       LOOKED UP REP - ANYTHING?                    
         BNH   WCMNT27                                                          
         LA    RE,EZIHLREP                                                      
*                                                                               
WCMNT25A DS    0H                                                               
         CR    RF,R3               THE VERY START OF THE COMMENT?               
         BNH   *+12                YES, DON'T DISPLAY '-'                       
         MVI   0(RF),C'-'                                                       
         LA    RF,1(RF)                                                         
*                                                                               
         MVC   0(4,RF),=C'REP('                                                 
         MVC   4(3,RF),0(RE)       REP ALWAYS 3 CHARACTERS                      
         MVI   7(RF),C')'                                                       
         LA    RF,9(RF)                                                         
*                                                                               
WCMNT27  DS    0H                                                               
         TM    EZIHCVST,EZIHRCVQ   RECONVERT REQUEST                            
         BZ    WCMNT30                                                          
         MVC   2(9,RF),=C'RECONVERT'                                            
*                                                                               
WCMNT30  LA    RF,11(,RF)                                                       
         OC    EZIHCINV,EZIHCINV   WAS THIS A COMBINED INVOICE                  
         BZ    DHX                                                              
         MVC   1(9,RF),=C'COMBINED='                                            
         MVC   10(10,RF),EZIHCINV                                               
         B     DHX                                                              
*                                                                               
*                                                                               
*                                                                               
WNCREAS  DS    0H                  REASON FOR NO CONVERSION                     
         MVC   0(40,R3),EZERRMSG                                                
         B     DHX                                                              
*                                                                               
*                                                                               
WCDATE   DS    0H                  DATE OF PREVIOUS CONVERSION                  
         MVC   0(3,R3),EZIHCVDT                                                 
         B     DHX                                                              
*                                                                               
*                                                                               
WIFILM   DS    0H                  FILM CODE                                    
         MVC   0(25,R3),EZSPCOPY   SHOW FILM OCDE(S) AS RECEIVED                
         OC    0(25,R3),SPACES     (EZERRDTA USED EVEN FOR EZCMLADD)            
         B     DHX                                                              
*                                                                               
WIFILM2  DS    0H                  ADDED FILM CODE                              
         MVC   0(8,R3),EZSPACML    SHOW ACTUAL ADDED FILM CODE                  
         TM    EZSPLKST,EZSPADID                                                
         BZ    WIFILM2A                                                         
         GOTO1 ATRPACK,DMCB,(C'U',EZSPACML),0(R3)                               
WIFILM2A OC    0(25,R3),SPACES     (EZERRDTA USED EVEN FOR EZCMLADD)            
         B     DHX                                                              
*                                                                               
*                                                                               
WERRCD   DS    0H                  ERROR CODE                                   
         MVC   0(1,R3),EZERRCD                                                  
         B     DHX                                                              
*                                                                               
*                                                                               
WERRREC  DS    0H                  ERROR RECORD                                 
         MVC   0(20,R3),EZERRREC                                                
         B     DHX                                                              
*                                                                               
*                                                                               
WERRFLD  DS    0H                  ERROR FIELD                                  
         MVC   0(20,R3),EZERRFLD                                                
         B     DHX                                                              
*                                                                               
*                                                                               
WERRMSG  DS    0H                  ERROR MESSAGE                                
         MVC   0(40,R3),EZERRMSG                                                
         B     DHX                                                              
*                                                                               
*                                                                               
WERRDTA  DS    0H                  ERROR DATA                                   
         MVC   0(30,R3),EZERRDTA                                                
         OC    0(30,R3),SPACES                                                  
         B     DHX                                                              
*                                                                               
*                                                                               
*        OUTPUT ROUTINES                                                        
*                                                                               
*                                                                               
*                                                                               
RBSTA    DS    0H                                                               
         MVC   0(8,R3),0(R2)                                                    
         CLC   SVBSTA,0(R2)        SAME STATION                                 
         BE    DHX                                                              
         MVC   SVBSTA,0(R2)        SAVE STATION                                 
         B     DHX                                                              
*                                                                               
         CLI   GLRECNO,1           CONVERTED                                    
         BE    RBSTA10                                                          
         CLI   GLRECNO,2           UNCONVERTIBLE                                
         BE    RBSTA10                                                          
         CLI   GLRECNO,3           PREVIOUSLY CONVERTED                         
         BNE   DHX                                                              
RBSTA10  DS    0H                                                               
         L     RF,GLAFMID                                                       
         BASR  RE,RF                                                            
         OI    GLINDS2,GLMIDHED                                                 
         B     DHX                                                              
*                                                                               
RBMGR    DS    0H                                                               
         MVC   SVMGRP,0(R2)        SAVE MKT GRP SCHEME                          
*                                                                               
* SORT IS DONE, CHANGE THE NULL BACK TO C'?' FOR DISPLAY PURPOSES               
*                                                                               
         CLC   SVMGRP,=X'006F6F6F6F'  X'00'C'????'                              
         BNE   RBMGR10                                                          
         CLI   MGR2FLAG,C'Y'                                                    
         BNE   *+8                                                              
         MVI   SVMGRP,C'?'                                                      
*                                                                               
RBMGR10  MVC   0(5,R3),SVMGRP                                                   
*                                                                               
         CLI   EZPRTMGR,C'Y'                                                    
         BNE   *+8                                                              
         BRAS  RE,GETBRK                                                        
*                                                                               
         B     DHX                                                              
*                                                                               
RBMKT    DS    0H                                                               
         SR    R0,R0                                                            
         ICM   R0,3,0(R2)                                                       
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(4,R3),DUB                                                      
         MVC   SVSMKT,0(R3)        SAVE MARKET                                  
         MVC   SVBMKT,0(R2)                                                     
         B     DHX                                                              
*                                                                               
RBDATE   DS    0H                                                               
         GOTO1 DATCON,DMCB,(1,0(R2)),(8,SVBDATE)                                
         MVC   0(8,R3),SVBDATE                                                  
         B     DHX                                                              
*                                                                               
*        RESOLVE LITERALS                                                       
*                                                                               
DH300    DS    0H                                                               
         DC    H'0'                                                             
*                                                                               
*        HEADLINE ROUTINE                                                       
*                                                                               
DH400    DS    0H                                                               
*                                                                               
         BRAS  RE,FORMHEAD                                                      
*                                                                               
DH460    DS    0H                                                               
         B     DHX                                                              
*                                                                               
*        INPUT TEST - PASS TO SORT OR NOT                                       
*                                                                               
DH470    DS    0H                                                               
         CLC   GLRECNO,RPTNO       IF NOT RIGHT RECORD                          
         BE    DHX                                                              
         MVI   GLHOOK,GLDONT       DON'T PUT TO SORT                            
*                                  NOTE- SCHEME INVOLVING GLOPTS                
*                                  NEVER WORKED BECAUSE IN DPG                  
*                                  RECORD CONDITION DONT APPLY                  
*                                  TO FIELDS                                    
DHX      J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
UNKNNET  DC    CL40'UNKNOWN NET FOR CABLE STATION'                              
NETINACT DC    CL40'NET NOT ACTIVE FOR CABLE STATION'                           
CABSTANF DC    CL40'CABLE STATION NOT FOUND'                                    
DUPINV   DC    CL40'INVOICE ALREADY ON FILE'                                    
NOCML    DC    CL40'COMMERCIAL RECORD MISSING'                                  
*                                                                               
*                                                                               
*                                                                               
ROUTLIST DS    0F                                                               
         DC    C'WBMGR   ',A(WBMGR)                                             
         DC    C'WBMKT   ',A(WBMKT)                                             
         DC    C'WBSTA   ',A(WBSTA)                                             
         DC    C'WBDATE  ',A(WBDATE)                                            
         DC    C'WICLTN  ',A(WICLTN)                                            
         DC    C'WIPRDN  ',A(WIPRDN)                                            
         DC    C'WIREP   ',A(WIREP)                                             
         DC    C'WINVNO  ',A(WINVNO)                                            
         DC    C'WMOS    ',A(WMOS)                                              
         DC    C'WIEST   ',A(WIEST)                                             
         DC    C'WIGRS   ',A(WIGRS)                                             
         DC    C'WSRC    ',A(WSRC)                                              
         DC    C'WCMNT   ',A(WCMNT)                                             
         DC    C'WNCREAS ',A(WNCREAS)                                           
         DC    C'WCDATE  ',A(WCDATE)                                            
         DC    C'WIFILM  ',A(WIFILM)                                            
         DC    C'WIFILM2 ',A(WIFILM2)                                           
         DC    C'WERRCD  ',A(WERRCD)                                            
         DC    C'WERRREC ',A(WERRREC)                                           
         DC    C'WERRFLD ',A(WERRFLD)                                           
         DC    C'WERRMSG ',A(WERRMSG)                                           
         DC    C'WERRDTA ',A(WERRDTA)                                           
         DC    C'RBSTA   ',A(RBSTA)                                             
         DC    C'RBMGR   ',A(RBMGR)                                             
         DC    C'RBMKT   ',A(RBMKT)                                             
         DC    C'RBDATE  ',A(RBDATE)                                            
         DC    X'FF'                                                            
*                                                                               
         DROP  RB,RC                                                            
*                                                                               
*                                                                               
*                                                                               
* 01/14/2016 - NO REFERENCES TO CKSTA ANYWHERE.  COMMENTING OUT                 
*&&DO                                                                           
* CHECK CALL LETTERS TO BE REASONABLE *                                         
*                                                                               
CKSTA    NMOD1 0,**CKSTA*                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
         LA    R0,4                ALL 4 LETTERS                                
         LA    R1,EQVSTAW                                                       
         CLI   EQVSTAW,C'0'        THIS A CABLE STATOIN?                        
         BNL   CKSTA30              YES                                         
*                                                                               
* SEE IF THIS IS ALPHA                                                          
*                                                                               
         LA    R0,3                FIRST 3 LETTERS                              
CKSTA10  CLI   0(R1),C'A'                                                       
         BL    CKSTAERR                                                         
         CLI   0(R1),C'Z'                                                       
         BH    CKSTAERR                                                         
         LA    R1,1(,R1)                                                        
         BCT   R0,CKSTA10                                                       
*                                                                               
         CLI   0(R1),C' '          THIS A 3 LETTER STATION                      
         BE    CKSTA50                                                          
*                                                                               
         CLI   0(R1),C'A'                                                       
         BL    CKSTAERR                                                         
         CLI   0(R1),C'Z'                                                       
         BH    CKSTAERR                                                         
         B     CKSTA50                                                          
*                                                                               
CKSTA30  DS    0H                                                               
         CLI   0(R1),C'0'                                                       
         BL    CKSTAERR                                                         
         CLI   0(R1),C'9'                                                       
         BH    CKSTAERR                                                         
         LA    R1,1(,R1)                                                        
         BCT   R0,CKSTA30                                                       
*                                                                               
CKSTA50  DS    0H                                                               
         CLI   EQVSTAW+4,C'T'      ONLY TV OKAY FOR NOW                         
         BE    CKSTAEQ                                                          
*                                                                               
CKSTAERR DS    0H                                                               
         LTR   RB,RB               SET CC NE                                    
         B     CKSTAX                                                           
*                                                                               
CKSTAEQ  DS    0H                                                               
         CR    R0,R0               SET CC EQ                                    
CKSTAX   DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,RC                                                            
*&&                                                                             
*                                                                               
*                                                                               
*        GET MARKET FROM EZBTSTN                                                
*                                                                               
GETMKT   NMOD1 0,**GMKT**                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
* FIX EZMOD STATION TO EQUIVALENT                                               
*                                                                               
         GOTO1 =V(PRTSTA),DMCB,EQVSTAW,EZBTSTN                                  
*                                                                               
GETMKT00 LA    R0,STTABL/STTABENT                                               
         L     R1,=A(STTABC)                                                    
*                                                                               
GETMKT10 OC    0(STTABENT,R1),0(R1)  EMPTY ENTRY                                
         BZ    GETMKT30               YES                                       
*                                                                               
         CLC   EZEQVSTA(4),0(R1)   THIS THIS STATION                            
         BNE   GETMKT14             NO                                          
         CLC   EZEQVSTA+4(1),4(R1) CK MEDIA                                     
         BE    GETMKT20                                                         
*                                                                               
GETMKT14 LA    R1,STTABENT(,R1)                                                 
         BCT   R0,GETMKT10                                                      
*                                                                               
         LA    R1,STTABL                                                        
         L     R0,=A(STTABC)                                                    
         SR    RF,RF                                                            
         MVCL  R0,RE               * NOTE - RE NOT REALLY CHANGED               
         B     GETMKT30                                                         
*                                                                               
GETMKT20 SR    R0,R0                                                            
         ICM   R0,3,5(R1)                                                       
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  SVSMKT,DUB                                                       
         MVC   SVBMKT,5(R1)                                                     
         MVC   EZSTYPE,7(R1)                                                    
         CR    RE,RE               SET COND CODE EQ                             
         B     GETMKTX                                                          
*                                                                               
GETMKT30 MVI   KEY,C'0'                                                         
         MVC   KEY+1(16),KEY                                                    
         MVI   KEY,C'S'                                                         
*                                                                               
         LA    R1,EZEQVSTA+4                                                    
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   KEY+1(1),EZMTMED-EZMEDTBD(RF)                                    
         MVC   KEY+2(4),EZEQVSTA                                                
         MVC   KEY+6(1),EZMTPMED-EZMEDTBD(RF)                                   
*                                                                               
         OI    KEY+5,X'40'         FORCE BLANK IF BINARY ZERO                   
*                                                                               
         CLI   KEY+5,X'4B'         SEE IF PERIOD                                
         BNE   *+8                                                              
         MVI   KEY+5,X'40'         FORCE BLANK IF PERIOD                        
*                                                                               
         MVC   KEY+7(2),AGENCY                                                  
         MVC   KEY+9(3),EZIHLADC                                                
*                                                                               
         GOTO1 DATAMGR,DMCB,DMREAD,STATION,KEY,ADSTAT                           
*                                                                               
         CLI   8(R1),0             ANY ERROR                                    
         BE    GETMKTTP             NO                                          
*                                                                               
         MVC   SVSMKT,=C'?????'                                                 
         XC    SVBMKT,SVBMKT                                                    
         MVC   SVMGRP,=C'?????'                                                 
         MVI   EZSTYPE,C'?'                                                     
*                                                                               
         OI    EZIHLKST,EZIHSTAC                                                
         MVI   EZERRCD,EZERRSTA                                                 
*                                                                               
         CLC   SVBDSTA,EZBTSTN     SAME AS LAST BAD STATION                     
         BE    GETMKT40                                                         
         MVC   P+1(3),=C'ERR'                                                   
         MVC   P+10(4),=C'MKT='                                                 
         MVC   P+14(4),SVSMKT                                                   
         MVC   P+20(6),EZBTSTN                                                  
         MVC   P+30(19),=C'STATION NOT ON FILE'                                 
         GOTO1 REPORT                                                           
         MVC   SVBDSTA,EZBTSTN                                                  
GETMKT40 LTR   RB,RB                                                            
         B     GETMKTX                                                          
*                                                                               
GETMKTTP DS    0H                                                               
         L     RF,ADSTAT                                                        
         MVC   SVSMKT,18(RF)       SAVE MARKET                                  
         MVC   EZSTYPE,96(RF)      SAVE STYPE                                   
*                                                                               
GETMKT50 LA    R0,STTABL/STTABENT                                               
         L     R1,=A(STTABC)                                                    
GETMKT54 OC    0(STTABENT,R1),0(R1)  EMPTY ENTRY                                
         BZ    GETMKT60               YES                                       
         LA    R1,STTABENT(,R1)                                                 
         BCT   R0,GETMKT54                                                      
         DC    H'0'                                                             
*                                                                               
GETMKT60 MVC   0(4,R1),EZBTSTN                                                  
         MVC   4(1,R1),EZBTSTN+5                                                
         PACK  DUB,SVSMKT                                                       
         CVB   R0,DUB                                                           
         STCM  R0,3,5(R1)                                                       
         STCM  R0,3,SVBMKT                                                      
         MVC   7(1,R1),EZSTYPE                                                  
*                                                                               
         CR    RB,RB               SET CON CODE EQ                              
*                                                                               
GETMKTX  DS    0H                                                               
         J     EXIT                                                             
*                                                                               
CONSEMPL DC    X'05'                                                            
         LTORG                                                                  
         DROP  RB,R7,RC                                                         
*                                                                               
*                                                                               
*                                                                               
*        OPEN ALL OUTPUT REQUEST FILES                                          
*                                                                               
INIT     NMOD1 0,**INIT**                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
* STORE VALUE OF RQSORTLQ                                                       
* IN INFILE1'S DCB LRECL                                                        
         LHI   R0,RQSORTLQ                                                      
         LAY   RF,INFILE1                                                       
         USING IHADCB,RF                                                        
         STH   R0,DCBLRECL         LRECL                                        
         DROP  RF                                                               
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(19,TODAYJ)                                    
*                                                                               
         L     R2,=A(EZZ9RQF)                                                   
         OPEN  ((R2),(OUTPUT))                                                  
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   P(2),=C'/*'         KEEP DDMASTER HAPPY                          
         MVC   P+2(78),SPACES                                                   
         PUT   (R2),P                                                           
*                                                                               
         MVC   P(L'REQUEST),SPACES                                              
*                                                                               
         CLOSE ((R2),)                                                          
         FREEPOOL (R2)                                                          
*                                                                               
         OPEN  (EZI5RQF,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         OPEN  (EZCCRQF,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R2,=A(IPRQFIL)                                                   
         OPEN  ((R2),(OUTPUT))                                                  
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   P(2),=C'/*'         KEEP DDMASTER HAPPY                          
         MVC   P+2(78),SPACES                                                   
         PUT   (R2),P                                                           
         MVC   P(L'REQUEST),SPACES                                              
         CLOSE ((R2),)                                                          
         FREEPOOL (R2)                                                          
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,RC                                                            
*                                                                               
*                                                                               
*                                                                               
*        GET MARKET NAME                                                        
*                                                                               
GETMKN   NMOD1 0,*GETMKN*                                                       
*                                                                               
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         LA    R1,=CL22'  UNKNOWN'                                              
         OC    SVBMKT,SVBMKT       IS THIS AN UNKNOWN MARKET                    
         BZ    GETMKN20                                                         
         LA    R0,MKTABL/24                                                     
         L     R1,=A(MKTABC)                                                    
*                                                                               
GETMKN10 OC    0(2,R1),0(R1)       EMPTY ENTRY                                  
         BZ    GETMKN30                                                         
         CLC   SVBMKT,0(R1)        THIS THIS MARKET                             
         BE    GETMKN20                                                         
         LA    R1,MKTABENT(,R1)                                                 
         BCT   R0,GETMKN10                                                      
         LA    R1,MKTABL                                                        
         L     RF,=A(MKTABC)                                                    
         LR    R0,RF                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
         B     GETMKN30                                                         
GETMKN20 MVC   SVSMKTNM,2(R1)                                                   
         B     GETMKNX                                                          
*                                                                               
GETMKN30 DS    0H                                                               
         XC    KEY,KEY                                                          
         MVI   KEY,C'M'                                                         
*                                                                               
         LA    R1,SVBSTA                                                        
         BRAS  RE,ISNUM                                                         
         BNE   *+12                                                             
         MVI   KEY+1,C'T'                                                       
         B     GETMKN35                                                         
*                                                                               
         LA    R1,SVBSTA+5                                                      
         CLI   SVBSTA+3,C'-'                                                    
         BNE   *+8                                                              
         LA    R1,SVBSTA+4                                                      
*                                                                               
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   KEY+1(1),EZMTMED-EZMEDTBD(RF)                                    
*                                                                               
GETMKN35 DS    0H                                                               
         MVC   KEY+2(4),SVSMKT                                                  
         MVC   KEY+6(2),AGENCY                                                  
         MVI   KEY+8,C'0'                                                       
         MVC   KEY+9(6),KEY+8                                                   
*                                                                               
         GOTO1 DATAMGR,DMCB,DMREAD,STATION,KEY,ADSTAT                           
*                                                                               
         XC    SVSMKTNM,SVSMKTNM                                                
         MVC   SVSMKTNM(7),=C'UNKNOWN'                                          
         CLI   8(R1),0             ANY ERROR                                    
         BNE   GETMKNX              YES                                         
         L     RF,ADSTAT                                                        
         MVC   SVSMKTNM,MKTNAME-MKTRECD(RF)                                     
         LA    R0,MKTABL/MKTABENT                                               
         L     R1,=A(MKTABC)                                                    
GETMKN40 OC    0(2,R1),0(R1)       EMPTY ENTRY                                  
         BZ    GETMKN50                                                         
         LA    R1,MKTABENT(,R1)                                                 
         BCT   R0,GETMKN40                                                      
         DC    H'0'                                                             
GETMKN50 MVC   0(2,R1),SVBMKT                                                   
         MVC   2(20,R1),SVSMKTNM                                                
GETMKNX  DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,RC                                                            
*                                                                               
*                                                                               
*                                                                               
*        READ STATION EQUIVALENCE RECS FROM MPL FILE CONVERT STATION *          
*                                                                               
EQVSTA   NMOD1 0,*EQVSTA*                                                       
*                                                                               
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         L     RF,=A(EQVSTATB)                                                  
         CLI   0(RF),0             WAS TABLE BUILT YET?                         
         BNE   EQVSTA60             YES                                         
*                                                                               
         L     RF,UTL                                                           
         MVI   4(RF),10                                                         
*                                                                               
EQVSTA00 XC    MPLKEY(40),MPLKEY                                                
         LHI   R2,EQVSTATL/10                                                   
         L     R3,=A(EQVSTATB)                                                  
         LA    R1,MPLKEY                                                        
         USING EZSKEY,R1                                                        
         MVC   EZSKTYP,=C'ZS'                                                   
         MVC   EZSKAGY,AGENCY                                                   
         DROP  R1                                                               
*                                                                               
         MVC   MPLKEYSV(40),MPLKEY                                              
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMRDHI),=C'GENDIR',MPLKEY,MPLKEY           
         B     EQVSTA14                                                         
*                                                                               
EQVSTA10 GOTO1 DATAMGR,DMCB,(DMINBTS,DMRSEQ),=C'GENDIR',MPLKEY,MPLKEY           
*                                                                               
EQVSTA14 CLC   MPLKEY(4),MPLKEYSV                                               
         BNE   EQVSTA20                                                         
         L     R6,ADBUY                                                         
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),=C'GENFIL',MPLKEY+36,     X        
               (R6),DMWORK                                                      
*                                                                               
         LA    R6,42(,R6)                                                       
         LR    R5,R6                                                            
         ZIC   R0,1(R6)                                                         
         AR    R5,R0                                                            
         CLI   0(R5),X'22'         THIS HAVE ADVNAME ELEM                       
         BE    EQVSTA10             YES, BYPASS                                 
*                                                                               
         CLI   0(R6),02                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING EZSIDEL,R6                                                       
         MVC   0(5,R3),MPLKEY+EZSKSTA-EZSKEY                                    
         MVC   5(5,R3),EZSCALL                                                  
         LA    R3,10(,R3)                                                       
         BCT   R2,EQVSTA10                                                      
         DC    H'0'                MAKE TABLE LARGER                            
EQVSTA20 MVI   0(R3),255                                                        
         L     RF,UTL              RESTORE SE NUM                               
         MVC   4(1,RF),SAVSYS                                                   
*                                                                               
* NOW LOOK UP STATION IN TABLE, IF FIND, PUT REPLACEMENT IN RSTA                
*                                                                               
         USING EZWKRIXD,R4                                                      
EQVSTA60 MVC   EQVSTAW(4),EZWISTN                                               
*                                                                               
         CLI   EQVSTAW+3,C'.'                                                   
         BNE   *+8                                                              
         MVI   EQVSTAW+3,C' '                                                   
*                                                                               
         OC    EQVSTAW(4),SPACES                                                
         MVC   EQVSTAW+4(1),EZWIMED                                             
*                                                                               
         CLI   EZWIMED,C'C'        FORCE CABLE                                  
         BNE   *+8                                                              
         MVI   EQVSTAW+4,C'N'      TO NETWORK                                   
*                                                                               
EQVSTA66 LHI   RE,EQVSTATL/10                                                   
         L     RF,=A(EQVSTATB)                                                  
*                                                                               
EQVSTA70 CLI   0(RF),255           END OF TABLE                                 
         BE    EQVSTAX                                                          
         CLC   EQVSTAW,0(RF)                                                    
         BE    EQVSTA80                                                         
         LA    RF,10(,RF)                                                       
         BCT   RE,EQVSTA70                                                      
         DC    H'0'                                                             
EQVSTA80 MVC   EQVSTAW,5(RF)                                                    
*                                                                               
EQVSTAX  J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,RC,R4                                                         
*                                                                               
*                                                                               
*                                                                               
* CLOSE OUT FILES                                                               
*                                                                               
CLOSE    NMOD1 0,**CLSE**                                                       
*                                                                               
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   CLOSE10                                                          
*                                                                               
* OVERNIGHT PROCESSING                                                          
*                                                                               
         MVC   P(2),=C'/*'         KEEP DDMASTER HAPPY                          
         MVC   P+2(78),SPACES                                                   
*                                                                               
         OPEN  (EZI2RQF,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LM    R2,R4,=A(EZI2RQF,EZI5RQF,EZCCRQF)                                
         PUT   (R2),P                                                           
         PUT   (R3),P                                                           
         PUT   (R4),P                                                           
*                                                                               
         MVC   P(L'REQUEST),SPACES                                              
*                                                                               
         CLOSE ((R2),)             EZI5RQF                                      
         FREEPOOL (R2)                                                          
*                                                                               
         CLOSE ((R3),)             EZI5RQF                                      
         FREEPOOL (R3)                                                          
*                                                                               
         CLOSE ((R4),)             EZCCRQF                                      
         FREEPOOL (R4)                                                          
*                                                                               
* NOW SEE IF WE NEED TO RUN Z9 INVOICE FACSIMILE REPORT *                       
*                                                                               
         CLI   EZZ9REQ,C'Y'        THEY WANT AUTO Z9 INV FAC REPORT             
         BE    CLOSE00                                                          
         CLI   EZZ9REQ,C'O'        THEY WANT AUTO Z9 INV FAC REPORT             
         BE    CLOSE00              NO                                          
*                                                                               
         CLI   EZZ9REQ,C'F'     FORCING Z9S, EVEN IF NOTHING CONVERTED?         
         BNE   CLOSEX              NO - EXIT                                    
         B     *+12             YES - DON'T CHECK IF ANYTHING CONVERTED         
*                                                                               
CLOSE00  TM    FIRSTSW,FIRSTSWC    WERE ANY INVOICES CONVERTED                  
         BZ    CLOSEX               NO                                          
*                                                                               
         L     R2,=A(EZZ9RQF)                                                   
         OPEN  ((R2),(OUTPUT))                                                  
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LA    R3,SRCETAB                                                       
*                                                                               
CLOSE01  DS    0H                                                               
         CLI   0(R3),X'FF'         TABLE END?                                   
         BE    CLOSE07             DONE                                         
         CLI   0(R3),X'00'         BLANK SLOT?                                  
         BE    CLOSE07             DONE                                         
*                                                                               
         MVC   P,SPACES                                                         
         MVC   P(2),=C'Z9'                                                      
         MVC   P+2(2),EZAGY                                                     
         MVC   P+5(6),TODAY        USE AS REQUEST NUMBER                        
*                                                                               
         CLC   0(4,R3),SPACES      ANY SOURCES?                                 
         BNH   CLOSE03             NO - PROCEED TO GENERAL Z9 REQUEST           
* GOT A SOURCE HERE                                                             
         CLC   =AL2(AGYALPH_TH),AGENCY THIS DFZNYA, ZENYA, BSZNYA               
         BNE   *+14                                                             
         CLC   =C'SDI',0(R3)                                                    
         BE    CLOSE03                                                          
*                                                                               
         CLI   4(R3),C'-'          YES, BUT ARE WE EXCLUDING IT?                
         BNE   CLOSE05             NO - GENERATE Z9 REQ BY SOURCE               
*                                                                               
CLOSE03  DS    0H                  Z9 REQUEST WITH NO SOURCE FILTER             
         L     RF,=A(TAREQ)                                                     
         MVC   P+12(L'TAREQ),0(RF)                                              
         L     R1,=A(CONSEMPL)                                                  
         MVC   P+12+L'TAREQ-2(1),0(R1)       SAVE SENUM FOR MPL FILE            
         B     CLOSE06                                                          
*                                                                               
CLOSE05  DS    0H                                                               
         L     RF,=A(TAREQ1)                                                    
         MVC   53(4,RF),SVSRCE                                                  
         MVC   P+12(TAREQ1LQ),0(RF)                                             
         L     R1,=A(CONSEMPL)                                                  
         MVC   P+12+TAREQ1LQ-2(1),0(R1)       SAVE SENUM FOR MPL FILE           
*                                                                               
CLOSE06  DS    0H                                                               
         PUT   (R2),P                                                           
*                                                                               
         LA    R3,5(R3)            NEXT SOURCETAB ENTRY                         
         B     CLOSE01                                                          
*                                                                               
CLOSE07  DS    0H                                                               
         MVC   P(2),=C'/*'         KEEP DDMASTER HAPPY                          
         MVC   P+2(78),SPACES                                                   
         PUT   (R2),P                                                           
         MVC   P(L'REQUEST),SPACES                                              
         CLOSE ((R2),)                                                          
         FREEPOOL (R2)                                                          
         B     CLOSEX                                                           
*                                                                               
* NOW SEE IF WE NEED TO RUN Z9 INVOICE FACSIMILE REPORT FROM SOON REQ *         
*                                                                               
CLOSE10  DS    0H                                                               
         CLI   EZZ9REQ,C'Y'        THEY WANT AUTO Z9 INV FAC REPORT             
         BE    *+12                                                             
         CLI   EZZ9REQ,C'S'        THEY WANT AUTO Z9 INV FAC REPORT             
         BNE   CLOSEX               NO                                          
*                                                                               
         TM    FIRSTSW,FIRSTSWC    WERE ANY INVOICES CONVERTED                  
         BZ    CLOSEX               NO                                          
*                                                                               
         XC    REQHDR,REQHDR                                                    
         MVC   REQUEST(L'REQUEST),SPACES      CLEAR                             
         MVC   REQUEST2(L'REQUEST2),SPACES                                      
*                                                                               
         CLC   SVSRCE,SPACES                                                    
         BNH   *+12                                                             
         CLI   SVSRCEX,C'-'                                                     
         BNE   CLOSE15                                                          
*                                                                               
         L     RF,=A(TAREQ)                                                     
         MVC   REQUEST+12(L'TAREQ),0(RF)                                        
         L     R1,=A(CONSEMPL)                                                  
         MVC   REQUEST+12+L'TAREQ-2(1),0(R1) SAVE SENUM FOR MPL FILE            
         MVC   REQUEST+QPROG-QAREA(2),=C'Z9'                                    
         MVC   REQUEST+QAGY-QAREA(2),EZAGY                                      
         B     CLOSE17                                                          
*                                                                               
CLOSE15  L     RF,=A(TAREQ1)                                                    
         MVC   53(4,RF),SVSRCE                                                  
         MVC   REQUEST+12(TAREQ1LQ),0(RF)                                       
         L     R1,=A(CONSEMPL)                                                  
         MVC   REQUEST+12+TAREQ1LQ-2(1),0(R1) SAVE SENUM FOR MPL FILE           
         MVC   REQUEST+QPROG-QAREA(2),=C'Z9'                                    
         MVC   REQUEST+QAGY-QAREA(2),EZAGY                                      
*                                                                               
CLOSE17  DS    0H                                                               
         GOTO1 DATAMGR,DMCB,=C'DMADD',=C'REQUEST',WORK,REQHDR                   
         CLI   DMCB+8,0                                                         
         BE    CLOSEX                                                           
         DC    H'0'                                                             
*                                                                               
CLOSEX   DS    0H                                                               
         J     EXIT                                                             
         LTORG                                                                  
         DROP  RB,RC                                                            
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*        GENERATE I2 REQUESTS                                                   
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
GENI2RQ  DS    0H                                                               
         BASR  RF,0                                                             
         USING *,RF                                                             
         USING SPZ5WRKD,RC                                                      
*                                                                               
         CLI   QOPT5,C'G'                                                       
         BE    GI2                                                              
         CLI   QOPT5,C'F'                                                       
         BE    GI2                                                              
         CLI   QOPT5,C'O'                                                       
         BE    GI2                                                              
*                                                                               
         CLC   AGENCY,=AL2(AGYALPH_WI) WILA                                     
         BNE   *+12                                                             
         CLI   EZMCTINV,C'Y'       AND AN MCT INVOICE?                          
         BE    GENI2TST                                                         
*                                                                               
         CLI   EZI5REQ,C'Y'        AUTO I5S?                                    
         BE    GENI2TST            YES - PROCEED                                
         CLI   EZI5REQ,C'T'        AUTO I5S?                                    
         BE    GENI2TST            YES - PROCEED                                
*                                                                               
         CLI   QOPT5,C'N'          TEST OPTION TO DO I2'S                       
         BER   RE                                                               
*                                                                               
* IF RUNNING SOON, NO SECOND STEP OR AUTO REQUESTS *                            
GENI2TST DS    0H                                                               
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZR  RE                                                               
*                                                                               
         DROP  RC                                                               
GI2      NMOD1 0,**+GI2**                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         XC    REQSORT(RQSORTLQ),REQSORT                                        
         MVC   REQUEST(L'REQUEST),SPACES                                        
         MVC   REQUEST2(L'REQUEST2),SPACES                                      
*                                                                               
         MVC   REQUEST+QPROG-QAREA(2),=C'I2'                                    
         MVC   REQUEST+QAGY-QAREA(2),EZAGY                                      
         MVC   REQUEST+QMED-QAREA(1),QMED                                       
         MVC   REQUEST+QCLT-QAREA(3),EZIHLADC                                   
         MVC   REQUEST+QPRD-QAREA(3),EZIHLPRC                                   
*                                                                               
         CLC   AGENCY,=AL2(AGYALPH_WI) WILA                                     
         BNE   *+16                                                             
         CLI   EZMCTINV,C'Y'       AND AN MCT INVOICE?                          
         BNE   *+8                                                              
         MVI   REQUEST+32,C'M'     SET FOR MCT REQUEST                          
*                                                                               
         CLC   EZIHLP2C,SPACES     IS THERE A SECOND PRODUCT                    
         BNH   *+10                 NO                                          
         MVC   REQUEST+34(3),EZIHLP2C                                           
*                                                                               
         CLI   EZPOLYES,C'Y'                                                    
         BNE   *+16                                                             
         MVC   REQUEST+QPRD-QAREA(3),=C'POL'                                    
         MVC   REQUEST+QENDAUTO-QAREA(3),=C'YES'                                
*                                                                               
         MVC   REQUEST+QSTA-QAREA(4),EQVSTAW                                    
* THIS GETMED CALL WILL CONVERT 1->C, C->N                                      
         LA    R1,EQVSTAW+4        BAND                                         
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   REQUEST+QSTA+4-QAREA(1),EZMTPMED-EZMEDTBD(RF)                    
*                                                                               
         CLI   EQVSTAW,C'0'        THIS CABLE STATION                           
         BL    *+8                                                              
         MVI   REQUEST+QSTA+4-QAREA,C'/'                                        
*                                                                               
         MVC   REQUEST+QEST-QAREA(3),=C'NO '                                    
*                                                                               
         CLI   EZSPTNET,C'N'       ONLY FOR NETPAK                              
         BNE   *+10                                                             
         MVC   REQUEST+QAREA+56-QAREA(1),EZSTYPE                                
*                                                                               
         CLI   EZESTOPT,C'E'       SET EST NUMBER ONLY IF                       
         BE    *+12                                                             
         CLI   EZESTOPT,C'Y'       SET EST NUMBER ONLY IF                       
         BNE   GENR10               PRESENT AND OPTION IS ON                    
*                                                                               
         XR    RF,RF                                                            
         ICM   RF,1,EZIHBEST                                                    
         BZ    GENR10                                                           
         EDIT  (RF),(3,REQUEST+QEST-QAREA),FILL=0                               
*                                                                               
GENR10   DS    0H                                                               
         ZIC   RF,EZIHBMOS                                                      
         EDIT  (RF),(2,REQUEST+QSTART-QAREA),FILL=0                             
         ZIC   RF,EZIHBMOS+1                                                    
         EDIT  (RF),(2,REQUEST+QSTART-QAREA+2),FILL=0                           
*                                                                               
         MVC   REQUEST+QUESTOR-QAREA(L'QUESTOR),QUESTOR                         
*                                                                               
         MVC   REQUEST+QOPT5-QAREA(1),QOPT5+1                                   
*                                                                               
         CLI   EZI2PRNT,C'D'                                                    
         BNE   *+10                                                             
         MVC   REQUEST+QOPT4-QAREA(1),EZI2PRNT                                  
*                                                                               
         CLI   EZI2DEMO,C'Y'       SUPRESS DEMOS FOR I2                         
         BE    *+10                 YES                                         
         MVC   REQUEST+QBOOK1-QAREA(4),=CL4'ACT '                               
*                                                                               
         CLC   QBOOK1,SPACES       WAS AN OVERRIDE BOOK REQUESTED               
         BE    *+10                                                             
         MVC   REQUEST+QBOOK1-QAREA(6),QBOOK1                                   
*                                                                               
         CLC   EZSRCE,=C'BDS '     IF BDS, REQUEST RESPONSE COUNTS              
         BNE   *+8                                                              
         MVI   REQUEST+32,C'Y'                                                  
*                                                                               
         MVI   REQUEST+31,C'Z'     I2 PRINTS OUT "(Z5)" TO RT OF PAGE #         
*                                                                               
         TM    EZIHFLG,EZIHINTQ    IS THIS INT-ONLY INVOICE?                    
         BZ    GENR22A             NO                                           
*                                                                               
         CLC   =C'ABC ',EZEQVSTA                                                
         BE    GENR22                                                           
         CLC   =C'NBC ',EZEQVSTA                                                
         BE    GENR22                                                           
         CLC   =C'CBS ',EZEQVSTA                                                
         BNE   GENR22A                                                          
*                                                                               
* YES, GENERATE INT-ONLY I2 REQUEST                                             
*                                                                               
GENR22   DS   0H                                                                
         MVI   REQUEST+QCONTREQ-QAREA,C'*'                                      
         MVI   REQUEST2+Q2USER+2-QAREA2,C'O'                                    
*                                                                               
* CHECK WHETHER TO GENERATE B'CAST OR REGULAR REQUEST                           
*                                                                               
GENR22A  DS   0H                                                                
         CLI   EZSPTNET,C'N'       ONLY FOR NETPAK                              
         BNE   GENR24                                                           
*                                                                               
         MVC   REQUEST+QAREA+56-QAREA(1),EZSTYPE                                
*                                                                               
         CLI   EZSPTNET,C'N'       IF NOT NETPAK                                
         BNE   GENR24               FORCE BROADCAST                             
*                                                                               
         CLC   =AL2(AGYALPH_H7),EZAGY                                           
         BE    *+14                                                             
         CLC   =AL2(AGYALPH_FR),EZAGY                                           
         BNE   *+14                                                             
         CLC   =C'EABC',EZEQVSTA                                                
         BE    GENR23                                                           
*                                                                               
         CLC   =C'CW',EZBTSTN      CW* STATIONS ARE CALENDAR                    
         BE    GENR23                                                           
         CLC   =C'MY',EZBTSTN      MY* STATIONS ARE CALENDAR                    
         BE    GENR23                                                           
*                                                                               
* BELOW 8 NETWORKS CONVERT AS CALENDAR, ALL OTHERS AS BROADCAST                 
*                                                                               
         LA    R0,NETABLN                                                       
         LA    R1,NETABLE                                                       
         CLC   EZEQVSTA(4),0(R1)   EQUIV. STATION, NOT BATCH!!!                 
         BE    GENR23                                                           
         LA    R1,4(,R1)                                                        
         BCT   R0,*-14                                                          
         B     GENR24               GET BROADCAST MONTH                         
*                                                                               
* CALENDAR MONTH FOR THESE NETWORKS:                                            
*                                                                               
NETABLE  DC    C'ABC CBS FOX NBC UPN WBN WBK FOXBMNT '                          
         DC    C'ABC.CBS.FOX.NBC.UPN.WBN.WBK.FOXBMNT.'                          
NETABLN  EQU   (*-NETABLE)/4                                                    
*                                                                               
*                                                                               
GENR23   DS   0H                    FORCE CALENDAR MONTH                        
         MVI   REQUEST+QCONTREQ-QAREA,C'*'                                      
         MVI   REQUEST+L'REQUEST+Q2USER+1-QAREA2,C'C' FORCE CALENDAR            
*                                                                               
GENR24   DS   0H                                                                
         L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   *+8                                                              
         MVI   REQUEST+QCONTREQ-QAREA,C'*'                                      
*                                                                               
         MVC   REQMGR,SVMGRP                                                    
         MVC   REQMKT,SVSMKT                                                    
*                                                                               
         CLC   REQUEST+QMKT-QAREA(4),SPACES                                     
         BE    *+10                                                             
         MVC   REQMKT,REQUEST+QMKT-QAREA                                        
*                                                                               
         CLI   QOPT5,C'N'          GENERATING I2 REQUESTS?                      
         BE    GENR50              NO - PROCEED TO I5 REQUESTS                  
         CLI   QOPT5,C'O'          OVERNIGHT I2S FROM SOON Z5S?                 
         BNE   GENR24B             YES - ADD TO REQUEST FILE                    
*                                                                               
         XC    REQHDR,REQHDR                                                    
*                                                                               
         CLI   REQUEST+QCONTREQ-QAREA,C'*'                                      
         BNE   *+8                                                              
         OI    REQHDR+15,X'10'                                                  
         GOTO1 DATAMGR,DMCB,=C'DMADD',=C'REQUEST',WORK,REQHDR                   
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   REQUEST+QSTA+4-QAREA,C'/' RESTORE MEDIA T IF CABLE               
         BNE   GENRX                                                            
         MVI   REQUEST+QSTA+4-QAREA,C'T'                                        
         B     GENRX                                                            
*                                                                               
GENR24B  DS    0H                                                               
         LAY   R1,INFILE1                                                       
         PUT   (1),REQSORT                                                      
*                                                                               
GENR30   DS   0H                                                                
         CLI   QOPT5,C'P'          TEST TO PRINT ALSO                           
         BNE   GENR50                                                           
         MVC   P(L'REQUEST),REQUEST                                             
         GOTO1 REPORT                                                           
*                                                                               
GENR50   DS   0H                                                                
* SPEC-14009 TZIH 6/22/17                                                       
* I5 REPORTS GENERATED WITH MEDIA "T" IN QOPT+4 CAUSE                           
* SPONSOR TO NOT RECOGNIZE THEM AS CABLE STATION                                
*                                                                               
*        CLI   REQUEST+QSTA+4-QAREA,C'/' RESTORE MEDIA T IF CABLE               
*        BNE   *+8                                                              
*        MVI   REQUEST+QSTA+4-QAREA,C'T'                                        
*                                                                               
         CLI   EZSPTNET,C'N'       RUNNING FOR NET?                             
         BE    GENRX               YES - NO AUTO I5S                            
*                                                                               
         CLI   QOPT5,C'F'          FORCE AUTO REPORTS?                          
         BE    GENR60                                                           
         CLI   EZI5REQ,C'Y'        Y=GENERATE I5S                               
         BE    GENR60                                                           
         CLI   EZI5REQ,C'T'        T=ONLY IF ID/SRC ARE IN TABLE                
         BNE   GENRX                                                            
*                                                                               
         MVC   WORK(2),RCORIGID                                                 
         MVC   WORK+2(4),EZSRCE                                                 
         L     RE,=A(IDSRCTAB)                                                  
*                                                                               
GENR55   DS    0H                                                               
         CLI   0(RE),X'FF'         END OF TABLE?                                
         BE    GENRX               UID/SRCE NOT IN TABLE - NO I5                
         CLC   0(6,RE),WORK                                                     
         BE    GENR60              UID/SRCE IN TABLE - GENERATE I5              
         LA    RE,6(RE)                                                         
         B     GENR55                                                           
*                                                                               
GENR60   DS   0H                                                                
         MVI   REQUEST+QPROG-QAREA+1,C'5'                                       
         MVC   REQUEST2(L'REQUEST2),SPACES                                      
         MVI   REQUEST+QCONTREQ-QAREA,C' '   NO 2ND REQ BY DEFAULT              
*                                                                               
         MVI   REQUEST+31,C' '     I5 DOESN'T KNOW ABOUT IT                     
         MVI   REQUEST+32,C' '                                                  
         MVI   REQUEST+61,C'Y'     EXPLICITLY UPDATE THE FILE                   
*                                                                               
         CLI   EZI5REPE,C'Y'       AUTO I5 REPORT- REP=EST                      
         BNE   *+8                                                              
         MVI   REQUEST+QOPT4-QAREA,C'E'                                         
*                                                                               
         CLC   SVREQST,REQUEST     SAME REQUEST AS THE LAST ONE?                
         BE    GENRX               YES - DON'T PUT IT TO FILE                   
         MVC   SVREQST,REQUEST     NO - SAVE AND WRITE IT                       
*                                                                               
* SEE IF RFHDR= IS PRESENT, IF YES - EXTRACT PID AND PASS TO I5                 
*                                                                               
         ICM   RF,15,VMASTC        ADDR OF MASTC?                               
         BZ    GENR65              NO                                           
         OC    MCRHPSWD-MASTD(L'MCRHPSWD,RF),MCRHPSWD-MASTD(RF)                 
         BZ    GENR65                                                           
*                                                                               
         MVI   REQUEST+QCONTREQ-QAREA,C'*'                                      
         MVI   REQUEST2+Q2PIDFLG-QAREA2,C'Y'                                    
         MVC   REQUEST2+Q2PID-QAREA2(L'Q2PID),MCRHPSWD-MASTD(RF)                
*                                                                               
GENR65   L     R1,=A(EZI5RQF)                                                   
         PUT   (1),REQUEST                                                      
*                                                                               
* SEE IF SECOND REQUEST                                                         
*                                                                               
         CLI   REQUEST+QCONTREQ-QAREA,C'*'                                      
         BNE   GENR70                                                           
         L     R1,=A(EZI5RQF)                                                   
         PUT   (1),REQUEST2                                                     
*                                                                               
GENR70   DS   0H                                                                
         CLI   QOPT5,C'P'          TEST TO PRINT ALSO                           
         BNE   GENRX                                                            
         MVC   P(L'REQUEST),REQUEST                                             
         GOTO1 REPORT                                                           
*                                                                               
GENRX    J     EXIT                                                             
         LTORG                                                                  
*                                                                               
TAREQ    DC    C'0203CON 0303REP 0506OV,T/A 0903ALL 1306TODAYC 1401 *'          
TAREQ1   DC    C'0203CON 0303REP 0506OV,T/A 0903ALL 1318TODAYC,SOURCE='         
         DC    C'     1401 *'                                                   
TAREQ1LQ EQU   *-TAREQ1                                                         
*                                                                               
*                                                                               
*                                                                               
REQHDR   DS    CL26                                                             
*                                                                               
REQSORT  DS    0C                                                               
REQUEST  DS    CL80                                                             
REQUEST2 DS    CL80                                                             
REQMGR   DS    CL5                                                              
REQMKT   DS    CL4                                                              
RQSORTLQ EQU   *-REQSORT                                                        
*                                                                               
         DROP  RB,RC                                                            
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
* GETMEM - ISSUE GETMAIN CALL                                                   
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
GETMEM   NTR1  BASE=*,LABEL=*                                                   
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         L     R0,=AL4(TSARBLQ)       BUFFER LENGTH FOR DUP KEY CHECK           
*                                                                               
         ICM   RF,15,=AL4(NUMREQS*RQSORTLQ)                                     
         AR    R0,RF                                                            
*                                                                               
         GETMAIN RU,LV=(0),LOC=(ANY,ANY)                                        
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         ST    R1,TSARB             ADDR OF DUP CHECK BUFFER                    
         L     R0,=AL4(TSARBLQ)       BUFFER LENGTH FOR DUP KEY CHECK           
         AR    R1,R0                                                            
         ST    R1,ABUFFER           ADDR OF SECOND BUFFER                       
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
* TSARSET - INITIALIZE TSAR                                                     
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
TSARSET  NTR1  BASE=*,LABEL=*                                                   
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
         MVI   DUPFLAG,C'N'                                                     
*                                                                               
* GETMAIN CALL HAD BEEN MOVED TO "GETMEM" SUBROUTINE                            
*                                                                               
         L     R2,=A(TSARAREA)                                                  
         XC    0(L'TSARAREA,R2),0(R2)                                           
         USING TSARD,R2                                                         
*                                                                               
         MVC   TSACOM,ACOMFACS                                                  
         MVI   TSOFFACT,TSAINI                                                  
         MVC   TSABUF,TSARB                                                     
         L     R0,=AL4(TSARBLQ)       BUFFER LENGTH FOR DUP KEY CHECK           
         ST    R0,TSAREC                                                        
         LA    R0,MYKEYLQ                                                       
         STC   R0,TSKEYL                                                        
         LA    R0,MYRECLQ                                                       
         STH   R0,TSRECL                                                        
*                                                                               
         L     RE,ADCONLST                                                      
         USING SPADCONS,RE                                                      
         MVC   ATSROFF,TSAROFF                                                  
         DROP  RE                                                               
*                                                                               
         GOTO1 ATSROFF,(R2)                                                     
         CLI   TSERRS,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         J     EXIT                                                             
         DROP  R2                                                               
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
* CHKDUP - CHECK FOR DUPLICATE INVOICES                                         
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
CHKDUP   NTR1  BASE=*,LABEL=*                                                   
*        LA    R2,TSARAREA                                                      
         L     R2,=A(TSARAREA)                                                  
         USING TSARD,R2                                                         
*                                                                               
* BUILD MASTER INVOICE KEY IN MYKEY AREA                                        
*                                                                               
         XC    MYREC(MYRECLQ),MYREC                                             
         MVC   MYKEYAM,BAGYMD       AGENCY/MEDIA                                
         MVC   MYKEYCLT,EZIHLADB    CLIENT                                      
         MVC   MYKEYSTA,BSTA                                                    
         MVC   WORK(2),EZIHBMOS    BINARY MONTH OF SERVICE                      
         MVI   WORK+2,1            FIRST DAY OF MONTH OF SERVICE                
         GOTO1 DATCON,DMCB,(3,WORK),(2,MYKEYMOS)  COMPRES'D MOS                 
         XC    MYKEYMOS,=X'FFFF'      COMPLEMENTED                              
         MVC   MYKEYINV,EZIHINV     INVOICE NUMBER                              
*                                                                               
         MVI   TSOFFACT,TSAADD      SET TSAROFF ADD                             
         LA    R1,MYREC                                                         
         ST    R1,TSAREC                                                        
         GOTO1 ATSROFF,(R2)                                                     
         CLI   TSERRS,TSEDUP        RECORD ALREADY ADDED?                       
         JE    NEQXIT                                                           
         CLI   TSERRS,0                                                         
         JE    EQXIT                                                            
         DC    H'0'                 DIE IF ANY OTHER ERRORS                     
*                                                                               
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
* THIS REPORT FILLS H3, H4, MAY OR MAY NOT FILL H5-H7                           
* ADDRESS OF NEXT AVAILABLE HEADLINE (H5-H8) RETURNED IN FULL                   
SETHDG   NTR1  BASE=*,LABEL=*                                                   
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         LA    R2,HEAD4                                                         
         ST    R2,FULL                                                          
*                                                                               
         CLI   EZBYMGRP,0          RUNNING BY MARKET GROUP                      
         BE    SETHDG20             NO                                          
         CLI   EZBYMGRP,C'*'       RUNNING BY MARKET GROUP                      
         BE    SETHDG20             NO                                          
         CLI   EZBYMGRP,C'#'       RUNNING BY STATION                           
         BE    SETHDG20             YES                                         
*                                                                               
         MVC   HEAD3+50(12),=C'MARKET GROUP'                                    
*                                                                               
         LARL  RF,SPMGRTAB                                                      
         LHI   RE,(SPMGRTBX-SPMGRTAB)/L'SPMGRTAB                                
         LA    R1,HEAD3+63                                                      
*                                                                               
         CLC   2(1,RF),SVMGRP                                                   
         BE    SETHDG05                                                         
         AHI   RF,L'SPMGRTAB                                                    
         BCT   RE,*-14                                                          
* MARKET GROUP NOT IN SPMGRTAB                                                  
         MVC   0(5,R1),=C'?????'                                                
         B     SETHDG20                                                         
*                                                                               
SETHDG05 DS    0H                                                               
         MVC   0(2,R1),0(RF)                                                    
         LA    R1,1(R1)                                                         
         CLI   0(R1),C' '                                                       
         BNH   *+8                                                              
         LA    R1,1(R1)                                                         
         MVC   0(4,R1),SVMGRP+1                                                 
         OC    0(4,R1),SPACES                                                   
*                                                                               
         CLI   EZPRTMGR,C'Y'                                                    
         BNE   SETHDG20                                                         
*                                                                               
* PRINT BREAK NAMES                                                             
         LHI   R0,3                                                             
         LA    R1,SVBREAKS                                                      
*                                                                               
SETHDG10 CLC   0(L'MKGNAM1,R1),SPACES                                           
         BNH   *+14                                                             
         MVC   50(L'MKGNAM1,R2),0(R1)                                           
         LA    R2,L'HEAD1(R2)                                                   
         LA    R1,L'MKGNAM1(R1)                                                 
         BCT   R0,SETHDG10                                                      
*                                                                               
         ST    R2,FULL                                                          
*                                                                               
SETHDG20 DS   0H                                                                
         CLI   EZBYMGRP,C'#'       RUNNING BY STATION ONLY                      
         BE    SETHDGX                                                          
*                                                                               
SETHDG30 DS   0H                                                                
         MVC   50(6,R2),=C'MARKET'                                              
*                                                                               
         CLI   COUNTRY,C'C'                                                     
         BNE   SETHDG40                                                         
         OC    SVBMKT,SVBMKT       IS THIS AN UNKNOWN MARKET                    
         BNZ   SETHDG40                                                         
         MVC   57(4,R2),=C'0000'                                                
         MVC   62(20,R2),=CL20'CANADA'                                          
         B     SETHDG50                                                         
*                                                                               
SETHDG40 DS    0H                                                               
         MVC   57(4,R2),SVSMKT                                                  
         BRAS  RE,GETMKN           GET MARKET NAME                              
         MVC   62(20,R2),SVSMKTNM                                               
*                                                                               
SETHDG50 DS    0H                                                               
         LA    R2,L'HEAD1(R2)                                                   
         ST    R2,FULL                                                          
*                                                                               
SETHDGX  J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
         GETEL (R6),DATADISP,ELCODE                                             
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
* GET MARKET GROUP                                                              
* R1 EXPECTED TO ADDRESS EZBYMGRP                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
GETMGR   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LR    R2,R1                                                            
*                                                                               
         CLC   SVBMKT,SVMGRMKT                                                  
         BE    GETMGRX                                                          
*                                                                               
         MVC   SVMGRP,=C'?????'                                                 
*                                                                               
         OC    SVBMKT,SVBMKT       IF NO MARKET, NO GROUP                       
         BZ    GETMGRX                                                          
*                                                                               
         XC    KEY,KEY                                                          
         LA    R1,KEY                                                           
         USING MKARECD,R1                                                       
         MVC   MKAKTYP,=X'0D03'                                                 
         MVC   MKAKAGMD,BAGYMD                                                  
         MVC   MKAKMKT,SVBMKT                                                   
         DROP  R1                                                               
         GOTO1 HIGH                                                             
*                                                                               
GETMGR10 CLC   KEY(L'MKAKEY),KEYSAVE                                            
         BNE   GETMGRX                                                          
*                                                                               
         MVC   AREC,ADBUY                                                       
         GOTO1 GET                                                              
*                                                                               
         L     R6,ADBUY                                                         
         MVC   SVGETEL+4(2),DATADISP                                            
         MVC   SVGETEL+6(1),ELCODE                                              
         MVI   ELCODE,X'05'                                                     
         MVC   DATADISP,=AL2(24)                                                
         BRAS  RE,GETEL                                                         
*                                                                               
GETMGR15 BNE   GETMGRX                                                          
         CLC   =X'05',0(R6)                                                     
         BNE   GETMGRX                                                          
*                                                                               
         CLC   0(1,R2),5(R6)                                                    
         BE    GETMGR20                                                         
         BRAS  RE,NEXTEL                                                        
         B     GETMGR15                                                         
*                                                                               
GETMGR20 XC    SVMGRP,SVMGRP                                                    
         MVC   SVMGRP(1),5(R6)                                                  
         UNPK  DUB,6(3,R6)                                                      
         LHI   R3,4                NUMERICAL PART LENGTH                        
*                                                                               
* NOW GET BREAK LENGTHS FROM MARKET GROUP DEFINITION RECORD                     
*                                                                               
         XC    KEY,KEY                                                          
         LA    R1,KEY                                                           
         USING MKGRECD,R1                                                       
         MVC   MKGKTYP,=X'0D02'                                                 
         MVC   MKGKAGMD,BAGYMD                                                  
         MVC   MKGKMID,SVMGRP                                                   
*                                                                               
         GOTO1 HIGH                                                             
         CLC   KEY(L'MKGKEY),KEYSAVE                                            
         BNE   GETMGR50                                                         
*                                                                               
         MVC   AREC,ADBUY                                                       
         GOTO1 GET                                                              
*                                                                               
         L     R6,ADBUY                                                         
         MVI   ELCODE,X'01'                                                     
         BRAS  RE,GETEL                                                         
         BNE   GETMGR50                                                         
*                                                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         LHI   R0,3                                                             
         LA    R1,MKGBK1LN-MKGEL01(R6) BREAK LENGHTS                            
*                                                                               
         IC    RE,0(R1)                                                         
         AR    RF,RE                                                            
         LA    R1,MKGBK2LN-MKGBK1LN(R1)                                         
         BCT   R0,*-10                                                          
*                                                                               
         CHI   RF,0                                                             
         BNH   *+6                                                              
         LR    R3,RF                                                            
*                                                                               
GETMGR50 DS    0H                                                               
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         B     *+10                                                             
         MVC   SVMGRP+1(0),DUB+3                                                
*                                                                               
         CLI   MGR2FLAG,C'Y'                                                    
         BE    *+10                                                             
         OC    SVMGRP,SPACES                                                    
*                                                                               
GETMGRX  DS    0H                                                               
         MVC   DATADISP,SVGETEL+4                                               
         MVC   ELCODE,SVGETEL+6                                                 
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
* GET MARKET GROUP BREAK NAMES                                                  
* SVMGRP EXPECTED TO BE FILLED IN                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *           
GETBRK   NTR1  BASE=*,LABEL=*                                                   
         XC    SVBREAKS,SVBREAKS                                                
         CLC   SVMGRP,=C'?????'                                                 
         JE    GETMKGX                                                          
         OC    SVMGRP,SVMGRP                                                    
         JZ    GETMKGX                                                          
*                                                                               
         MVC   WORK(5),SVMGRP                                                   
         LHI   R0,4                                                             
         LA    R1,WORK+1                                                        
*                                                                               
         CLI   0(R1),C' '                                                       
         BH    *+8                                                              
         MVI   0(R1),C'0'                                                       
         LA    R1,1(R1)                                                         
         BCT   R0,*-16                                                          
*                                                                               
         PACK  WORK+5(3),WORK+1(4)                                              
         ICM   R0,7,WORK+5                                                      
         SRL   R0,4                                                             
         STCM  R0,3,WORK+1                                                      
*                                                                               
         XC    KEY,KEY                                                          
         LA    R1,KEY                                                           
         USING MKGRECD,R1                                                       
         MVC   MKGKTYP,=X'0D02'                                                 
         MVC   MKGKAGMD,BAGYMD                                                  
         MVC   MKGKMID(3),WORK                                                  
         DROP  R1                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'MKGKEY),KEYSAVE                                            
         BNE   GETMKGX                                                          
*                                                                               
         MVC   AREC,ADBUY                                                       
         GOTO1 GET                                                              
*                                                                               
         L     R6,ADBUY                                                         
         MVC   SVGETEL+4(2),DATADISP                                            
         MVC   SVGETEL+6(1),ELCODE                                              
         MVI   ELCODE,X'10'                                                     
         MVC   DATADISP,=AL2(24)                                                
         BRAS  RE,GETEL                                                         
         BNE   GETMKGX                                                          
         CLI   0(R6),X'10'                                                      
         BNE   GETMKGX                                                          
*                                                                               
         MVC   SVBREAKS,MKGNAM1-MKGEL10(R6)                                     
*                                                                               
GETMKGX  DS    0H                                                               
         MVC   DATADISP,SVGETEL+4                                               
         MVC   ELCODE,SVGETEL+6                                                 
         J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
WRTIMGR  NTR1  BASE=*,LABEL=*                                                   
         CLI   WRTFLAG,C'E'        ANY DATASET ERRORS?                          
         BE    WRTX                YES - GET OUT                                
*                                                                               
         CLI   WRTFLAG,C'Y'        IS PQ OPEN?                                  
         BE    WRT10               YES - WRITE TO IT                            
*                                                                               
* OPEN AN MQ ENTRY AS WELL                                                      
*                                                                               
WRT09    DS    0H                                                               
         MVI   WRTFLAG,C'Y'        INDICATE DATASET ALLOCATED                   
         MVI   MQFLAG,C'Y'                                                      
         GOTO1 AMQRPT,DMCB,(0,=C'OPEN'),(0,=C'IMSTATUS********'),0,0            
         CLI   DMCB+8,0                                                         
         BE    WRT10                                                            
*                                                                               
         MVI   MQFLAG,C'N'                                                      
         MVI   WRTFLAG,C'E'                                                     
         MVC   X(18),=CL18'AUTONOTE*TZIHDDNY:'                                  
         MVC   X+18+1(14),=CL14'MQ OPEN FAILED'                                 
         GOTO1 DATAMGR,DMCB,=C'OPMSG',(45,X)                                    
         B     WRTX                                                             
*                                                                               
WRT10    DS    0H                                                               
         XC    X,X                                                              
         LA    R2,X+4                                                           
         USING WMGRD,2                                                          
*                                                                               
* LINE BREAK                                                                    
         MVC   WMGRSEP,=C'<DDSSEPERATOR>'                                       
*                                                                               
* ACTION                                                                        
         MVI   WMGRACT,C'C'        CONVERT                                      
*                                                                               
         CLI   RECONFLG,C'Y'                                                    
         BNE   *+8                                                              
         MVI   WMGRACT,C'V'                                                     
*                                                                               
         MVC   WMGRRVER,EZRPLVER                                                
*                                                                               
* INVOICE NUMBER                                                                
         MVC   WMGRINV,EZIHINV                                                  
* INVOICE DATE                                                                  
         GOTO1 DATCON,DMCB,(0,EZIHIDAT),(5,WMGRDATE)                            
* STATION (ORIGINAL)                                                            
         MVC   WMGRSTA,EZSNSTA     FROM THE 22 RECORD                           
* BAND (ORIRINAL)                                                               
         MVC   WMGRBND,EZSNBND     FROM THE 22 RECORD                           
* MEDIA (ORIGINAL)                                                              
         MVC   WMGRMED,EZSNMED     FROM THE 22 RECORD                           
* USER ID                                                                       
         LA    R1,EZWKRIND                                                      
         XC    KEY,KEY                                                          
         MVI   KEY,C'I'                                                         
         MVC   KEY+CTIKNUM-CTIKEY(2),(EZWIUID-EZWIKEY)(R1)                      
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',KEY,ADBUY                     
         L     R6,ADBUY                                                         
         CLC   0(L'CTIKEY,R6),KEY                                               
         BNE   WRT30                                                            
*                                                                               
         MVC   SVGETEL+4(2),DATADISP                                            
         MVC   SVGETEL+6(1),ELCODE                                              
         MVI   ELCODE,X'02'                                                     
         MVC   DATADISP,=AL2(28)                                                
         BRAS  RE,GETEL                                                         
         BNE   WRT30                                                            
         CLC   =X'02',0(R6)                                                     
         BNE   WRT30                                                            
*                                                                               
         ZIC   R1,1(R6)                                                         
         SHI   R1,3                                                             
         CHI   R1,0                                                             
         BH    *+6                                                              
         DC    H'0'                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   WMGRUID(0),2(R6)            USER ID                              
         OC    WMGRUID,SPACES                                                   
*                                                                               
WRT30    DS    0H                                                               
* AGENCY ALPHA                                                                  
         MVC   WMGRAGY,AGENCY                                                   
*                                                                               
* NEW STATION                                                                   
         MVC   WMGRNSTA,EZEQVSTA                                                
         LA    R1,EZEQVSTA+4                                                    
         ICM   R1,8,=AL1(EZMTBNDQ)                                              
         GOTO1 =V(GETMED)                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
*        MVC   WMGRNSTA+4(1),EZMTPMED-EZMEDTBD(RF)                              
*                                                                               
* NEW MEDIA                                                                     
         MVC   WMGRNMED,EZMTMED-EZMEDTBD(RF)                                    
*                                                                               
* NEW BAND                                                                      
*        MVC   WMGRNBND,EZEQVSTA+4                                              
         MVC   WMGRNBND,EZMTPMED-EZMEDTBD(RF)                                   
*                                                                               
         CLI   WMGRACT,C'C'                                                     
         BE    *+12                                                             
         CLI   WMGRACT,C'V'                                                     
         BNE   WRT50               SKIP CLT,PRD,EST                             
*                                                                               
* CLIENT                                                                        
         MVC   WMGRCLT,EZIHLADC                                                 
*                                                                               
* PRODUCT1                                                                      
         OC    EZIHLPRC,EZIHLPRC                                                
         BZ    *+10                                                             
         MVC   WMGRPRD1,EZIHLPRC                                                
*                                                                               
* PRODUCT2                                                                      
         OC    EZIHLP2C,EZIHLP2C                                                
         BZ    *+10                                                             
         MVC   WMGRPRD2,EZIHLP2C                                                
*                                                                               
* ESTIMATE                                                                      
         OC    EZIHBEST,EZIHBEST                                                
         BZ    WRT40                                                            
         EDIT  EZIHBEST,WMGREST                                                 
*                                                                               
WRT40    DS    0H                                                               
* PAYING REP                                                                    
         MVC   WMGRPREP,EZIHLREP                                                
*                                                                               
* PACKAGE CODE                                                                  
         OC    EZIHCVNP,EZIHCVNP                                                
         BZ    WRT50                                                            
         EDIT  EZIHCVNP,WMGRPKG                                                 
*                                                                               
WRT50    DS    0H                                                               
* INVOICE VERSION NUMBER                                                        
         OC    EZIHSVER,EZIHSVER                                                
         BZ    WRT55                                                            
         EDIT  EZIHSVER,WMGRVER                                                 
*                                                                               
WRT55    DS    0H                                                               
         MVC   WMGRMOS,EZIHMON                                                  
*                                                                               
         LA    R4,UKAGELD-UKRECD+EZWKRIND                                       
         GOTO1 DATCON,DMCB,(2,0(R4)),(X'20',WMGRBDAT)                           
*                                                                               
         MVI   WMGRACT+L'WMGRACT,X'4F'                                          
         MVI   WMGRINV+L'WMGRINV,X'4F'                                          
         MVI   WMGRDATE+L'WMGRDATE,X'4F'                                        
         MVI   WMGRSTA+L'WMGRSTA,X'4F'                                          
         MVI   WMGRMED+L'WMGRMED,X'4F'                                          
         MVI   WMGRBND+L'WMGRBND,X'4F'                                          
         MVI   WMGRUID+L'WMGRUID,X'4F'                                          
         MVI   WMGRAGY+L'WMGRAGY,X'4F'                                          
         MVI   WMGRNSTA+L'WMGRNSTA,X'4F'                                        
         MVI   WMGRNMED+L'WMGRNMED,X'4F'                                        
         MVI   WMGRNBND+L'WMGRNBND,X'4F'                                        
         MVI   WMGRCLT+L'WMGRCLT,X'4F'                                          
         MVI   WMGRPRD1+L'WMGRPRD1,X'4F'                                        
         MVI   WMGRPRD2+L'WMGRPRD2,X'4F'                                        
         MVI   WMGREST+L'WMGREST,X'4F'                                          
         MVI   WMGRPREP+L'WMGRPREP,X'4F'                                        
         MVI   WMGRPKG+L'WMGRPKG,X'4F'                                          
         MVI   WMGRVER+L'WMGRVER,X'4F'                                          
         MVI   WMGRMOS+L'WMGRMOS,X'4F'                                          
         MVI   WMGRNINV+L'WMGRNINV,X'4F'                                        
         MVI   WMGRRVER+L'WMGRRVER,X'4F'                                        
         MVI   WMGRBDAT+L'WMGRBDAT,X'4F'                                        
*                                                                               
         MVC   DATADISP,SVGETEL+4                                               
         MVC   ELCODE,SVGETEL+6                                                 
*                                                                               
*&&DO                                                                           
         LHI   R0,WMGRDLQ                                                       
         AHI   R0,4                                                             
         STCM  R0,3,X                                                           
         L     R0,=A(EZINVMGR)                                                  
*&&                                                                             
*                                                                               
         OC    WMGRD(WMGRDLQ),SPACES                                            
*                                                                               
WRT60    DS    0H                                                               
         GOTO1 AMQRPT,DMCB,(0,=C'PUT'),X+4,WMGRDLQ,0                            
         CLI   DMCB+8,0                                                         
         BE    WRTX                DONE - GET OUT                               
*                                                                               
         TM    DMCB+8,X'40'        BUFFER FULL?                                 
         BZ    WRT80               NO, SOME OTHER ERROR - SEND AUTONOTE         
*                                                                               
* TRY CLOSING AND OPENING THE MQ ENTRY                                          
*                                                                               
         GOTO1 AMQRPT,DMCB,(0,=C'CLOSE'),0,0,0                                  
         CLI   DMCB+8,0                                                         
         BNE   WRT80                                                            
*                                                                               
         GOTO1 AMQRPT,DMCB,(0,=C'OPEN'),(0,=C'IMSTATUS********'),0,0            
         CLI   DMCB+8,0                                                         
         BE    WRT60                                                            
*                                                                               
WRT80    DS    0H                                                               
         MVI   WRTFLAG,C'E'                                                     
         MVC   X(18),=CL18'AUTONOTE*TZIHDDNY:'                                  
         MVC   X+18+1(25),=CL25'MQ BUFFER OVERFLOW'                             
         GOTO1 DATAMGR,DMCB,=C'OPMSG',(45,X)                                    
*                                                                               
WRTX     DS    0H                                                               
         J     EXIT                                                             
         DROP  R2,R6                                                            
         LTORG                                                                  
*                                                                               
SVRD     DS    F                                                                
SVIMJOB  DC    CL8'        '                                                    
*                                                                               
*                                                                               
*                                                                               
TOSORT   NTR1  BASE=*,LABEL=*                                                   
         LA    R1,SRTAGYS                                                       
*                                                                               
TOSORT10 CLI   0(R1),X'FF'                                                      
         JE    NEQXIT                                                           
         CLC   AGENCY,0(R1)                                                     
         JE    EQXIT                                                            
         LA    R1,2(R1)                                                         
         B     TOSORT10                                                         
*                                                                               
SRTAGYS  DC    AL2(AGYALPH_FR)                                                  
         DC    AL2(AGYALPH_H7)                                                  
         DC    AL2(AGYALPH_JW)                                                  
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
                                                                                
*                                                                               
*                                                                               
FORMHEAD NTR1  BASE=*,LABEL=*                                                   
         LA    RF,HEAD4                                                         
         ST    RF,FULL                                                          
*                                                                               
         MVC   HEAD1+40(55),SPACES  CLEAR TITLE                                 
         MVC   HEAD1+50(7),=C'EASI - '                                          
*                                                                               
         CLI   GLRECNO,1           CONVERTED INVOICES                           
         BNE   FH404                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         CLI   QOPT1,C'X'                                                       
         BE    FH402                                                            
         CLI   QOPT1,C'Y'                                                       
         BE    FH402                                                            
         MVC   HEAD1+57(9),=C'CONVERTED'                                        
         MVC   HEAD1+67(14),=C'INVOICE REPORT'                                  
         MVC   HEAD2+50(31),DASHES                                              
         B     FH440                                                            
*                                                                               
FH402    MVC   HEAD1+57(11),=C'CONVERTIBLE'                                     
         B     FH406                                                            
*                                                                               
FH404    DS    0H                                                               
         CLI   GLRECNO,2           UNCONVERTED INVOICES                         
         BNE   FH408                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+57(11),=C'UNCONVERTED'                                     
*                                                                               
FH406    MVC   HEAD1+69(14),=C'INVOICE REPORT'                                  
         MVC   HEAD2+50(33),DASHES                                              
         B     FH440                                                            
*                                                                               
FH408    DS    0H                                                               
         CLI   GLRECNO,3           PREVIOUSLY CONVERTED                         
         BNE   FH412                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+57(29),=C'PREVIOUSLY CONVERTED INVOICES'                   
         MVC   HEAD2+50(36),DASHES                                              
         B     FH440                                                            
*                                                                               
FH412    DS    0H                                                               
         CLI   GLRECNO,4           MISSING CLIENT REPORT                        
         BNE   FH416                                                            
*                                                                               
         MVC   HEAD1+57(19),=C'MISSING CLIENT LIST'                             
         MVC   HEAD2+50(26),DASHES                                              
         B     FH440                                                            
*                                                                               
FH416    DS    0H                                                               
         CLI   GLRECNO,5           MISSING PRODUCT REPORT                       
         BNE   FH420                                                            
*                                                                               
         MVC   HEAD1+57(20),=C'MISSING PRODUCT LIST'                            
         MVC   HEAD2+50(27),DASHES                                              
         B     FH440                                                            
*                                                                               
FH420    DS    0H                                                               
         CLI   GLRECNO,6           MISSING FILM REPORT                          
         BNE   FH424                                                            
*                                                                               
         MVC   HEAD1+45(07),=C'EASI - '                                         
         MVC   HEAD1+52(23),=C'MISSING COMMERCIAL LIST'                         
         MVC   HEAD2+45(30),DASHES                                              
         B     FH440                                                            
*                                                                               
FH424    DS    0H                                                               
         CLI   GLRECNO,7           FILM/PRODUCT ERROR REPORT                    
         BNE   FH428                                                            
*                                                                               
         MVC   HEAD1+45(07),=C'EASI - '                                         
         MVC   HEAD1+52(29),=CL29'INVALID COMMERCIAL LIST'                      
         MVC   HEAD2+45(36),DASHES                                              
         B     FH440                                                            
*                                                                               
FH428    DS    0H                                                               
         CLI   GLRECNO,8           ADDED FILM LIST                              
         BNE   FH432                                                            
*                                                                               
         MVC   HEAD1+45(07),=C'EASI - '                                         
         MVC   HEAD1+52(25),=C'LIST OF ADDED COMMERCIALS'                       
         MVC   HEAD2+45(32),DASHES                                              
         B     FH440                                                            
*                                                                               
FH432    DS    0H                                                               
         CLI   GLRECNO,9           DATA ERROR REPORT                            
         BNE   FH434                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+57(17),=C'DATA ERROR REPORT'                               
         MVC   HEAD2+50(24),DASHES                                              
FH434    DS    0H                                                               
         CLI   GLRECNO,10          DELETED INVOICES REPORT                      
         BNE   FH435                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+47(07),=C'EASI - '                                         
         MVC   HEAD1+54(23),=C'DELETED INVOICES REPORT'                         
         MVC   HEAD2+47(30),DASHES                                              
*                                                                               
FH435    DS    0H                                                               
         CLI   GLRECNO,11          MISSING ESTIMATES REPORT                     
         BNE   FH436                                                            
*                                                                               
         MVC   HEAD1+47(07),=C'EASI - '                                         
         MVC   HEAD1+54(24),=C'MISSING ESTIMATES REPORT'                        
         MVC   HEAD2+47(30),DASHES                                              
*                                                                               
FH436    DS    0H                                                               
         CLI   GLRECNO,12          MISSING REP IDS REPORT                       
         BNE   FH440                                                            
*                                                                               
         MVC   HEAD1+47(07),=C'EASI - '                                         
         MVC   HEAD1+54(22),=C'MISSING REP IDS REPORT'                          
         MVC   HEAD2+47(30),DASHES                                              
*                                                                               
FH440    DS    0H                                                               
         L     R1,FULL                                                          
*                                                                               
         CLI   EZTEST,C'Y'                                                      
         BNE   *+10                                                             
         MVC   80(3,R1),=C'(T)'                                                 
         CLI   EZWRITE,C'N'                                                     
         BNE   *+10                                                             
         MVC   85(3,R1),=C'(W)'                                                 
*                                                                               
         LA    R1,L'HEAD1(R1)                                                   
*                                                                               
         CLI   EZTEST,C'Y'                                                      
         BE    *+12                                                             
         CLI   EZWRITE,C'N'                                                     
         BNE   *+10                                                             
         MVC   50(29,R1),=CL29'** REPORT ONLY - NO UPDATE **'                   
*                                                                               
         J     EQXIT                                                            
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
* 01/14/2016 - WE'RE NO LONGER SENDING IM FEEDBACK VIA DATASETS+EDICT           
*&&DO                                                                           
WRTEDCT  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   EDCTFLAG,C'Y'                                                    
         JNE   EQXIT                                                            
*                                                                               
         BRAS  RE,CLSPQ                                                         
*                                                                               
         L     RF,VMASTC                                                        
         XC    MCREMPQK-MASTD(7,RF),MCREMPQK-MASTD(RF)                          
         MVC   SVREMPQK,MCREMPQK-MASTD(RF)                                      
         MVC   SVVLRMKY,MCVLRMKY-MASTD(RF)                                      
         XC    MCVLRMKY-MASTD(4,RF),MCVLRMKY-MASTD(RF)                          
*                                                                               
         BRAS  RE,OPNPQ                                                         
*                                                                               
         MVI   LINE,0              SUPPRESS PAGING                              
         MVI   FORCEHED,C'N'                                                    
         MVI   FORCEMID,C'N'                                                    
         MVI   FORCEFUT,C'N'                                                    
*                                                                               
         XC    P,P                                                              
         MVC   P+4(5),=C'*HDR*'                                                 
         MVC   P+9(6),=C'EDICT='                                                
         MVI   P+35,C'P'                                                        
         MVI   P+37,C'D'                                                        
         MVC   P+15(8),=CL8'IMCPE'                                              
         GOTO1 REPORT                                                           
*                                                                               
         XC    P,P                                                              
         MVC   P(5),=C'++DDS'                                                   
         MVC   P+6(3),=C'SPT'                                                   
         MVC   P+9(2),AGENCY                                                    
         MVC   P+11(3),=C'TRN'                                                  
         GOTO1 REPORT                                                           
*                                                                               
         XC    P,P                                                              
         MVC   P(5),=C'++DDS'                                                   
         MVC   P+11(3),=C'DSN'                                                  
         MVC   P+15(DSNNMLQ),SVIMDSN                                            
         GOTO1 REPORT                                                           
*                                                                               
         XC    P,P                                                              
         MVC   P(4),=C'TEXT'                                                    
         GOTO1 REPORT                                                           
*                                                                               
         BRAS  RE,CLSPQ                                                         
*                                                                               
         L     RF,VMASTC                                                        
         MVC   MCREMPQK-MASTD(7,RF),SVREMPQK                                    
         MVC   MCVLRMKY-MASTD(4,RF),SVVLRMKY                                    
*                                                                               
         J     EQXIT                                                            
         LTORG                                                                  
*&&                                                                             
*                                                                               
*                                                                               
* OPNPQ IS ONLY BEING CALLED FROM WRTEDCT, WHICH IS NOW DEACTIVATED             
*&&DO                                                                           
*=====================================================================          
* OPEN PRINT QUEUE                                                              
*=====================================================================          
OPNPQ    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     RE,VMASTC                                                        
         USING MASTD,RE                                                         
*                                                                               
         L     R7,MCVREMOT                                                      
         USING REMOTED,R7                                                       
*                                                                               
         NI    REMOTSTA,X'FF'-X'02'      REPORT VISIBLE                         
*                                                                               
         MVC   REMOTAOP,MCVPQOPN                                                
         MVC   REMOTABF,MCVPQBUF                                                
         MVC   REMOTADM,DATAMGR                                                 
         DROP  RE                                                               
*                                                                               
         MVC   REMOTDST,=AL2(0017)                                              
*                                                                               
         MVC   REMOTKEY(11),SPACES                                              
         MVC   REMOTSYS(3),=C'ZIM'                                              
         MVC   REMOTSYS+3(2),QAGY                                               
         MVI   REMOTCPY,C'1'                                                    
         MVI   REMOTCLS,C'G'                                                    
         MVC   REMOTJID,=C'ZIM'                                                 
         J     EXIT                                                             
         DROP  R7                                                               
         LTORG                                                                  
*&&                                                                             
*                                                                               
*                                                                               
* CLSPQ IS ONLY CALLED FROM WRTEDCT, WHICH IS NOW DEACTIVATED                   
*&&DO                                                                           
*=====================================================================          
* CLOSE PRINT QUEUE                                                             
*=====================================================================          
                                                                                
CLSPQ    NTR1  BASE=*,LABEL=*                                                   
         GOTO1 PRINT,DMCB,=C'CLOSE'                                             
         J     EXIT                                                             
         LTORG                                                                  
*&&                                                                             
*                                                                               
*                                                                               
*                                                                               
*=====================================================================          
* INPUT, OUTPUT FILE DEFINITIONS                                                
*=====================================================================          
*                                                                               
         DS    0D                                                               
CTL1CNTL DCB   DDNAME=CTL1CNTL,                                        X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=80,                                               X        
               MACRF=PM                                                         
*                                                                               
         DS    0D                                                               
INFILE1  DCB   DDNAME=INFILE1,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=000,                                              X        
               MACRF=(GM,PM)                                                    
*                                                                               
         DS    0D                                                               
EZI2RQF  DCB   DDNAME=EZI2RQF,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=80,                                               X        
               MACRF=PM                                                         
*                                                                               
         DS    0D                                                               
EZI5RQF  DCB   DDNAME=EZI5RQF,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=80,                                               X        
               BLKSIZE=2000,                                           X        
               MACRF=PM                                                         
*                                                                               
         DS    0D                                                               
EZZ9RQF  DCB   DDNAME=EZZ9RQF,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=80,                                               X        
               BLKSIZE=2000,                                           X        
               MACRF=PM                                                         
*                                                                               
         DS    0D                                                               
EZCCRQF  DCB   DDNAME=EZCCRQF,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=80,                                               X        
               BLKSIZE=2000,                                           X        
               MACRF=PM                                                         
*                                                                               
IPRQFIL  DCB   DDNAME=IPRQFIL,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=80,                                               X        
               BLKSIZE=2000,                                           X        
               MACRF=PM                                                         
*                                                                               
*                                                                               
*                                                                               
* 01/14/2016 WE'RE NO LONGER SENDING IM FEEDBACK VIA MF DATASETS                
*&&DO                                                                           
EZINVMGR DCB   DDNAME=EZINVMGR,                                        X        
               DSORG=PS,                                               X        
               LRECL=512,                                              X        
               BLKSIZE=5120,                                           X        
               RECFM=VB,                                               X        
               MACRF=PM                                                         
*&&                                                                             
*                                                                               
*                                                                               
*                                                                               
SAVSRC   NTR1  BASE=*,LABEL=*                                                   
         CLI   Z9FLAG,C'Y'         PROBLEMS?                                    
         BNE   SVSRCX              YES - DON'T SAVE ANY MORE SOURCES            
*                                                                               
         LA    R1,SRCETAB                                                       
SVSRC10  CLI   0(R1),X'FF'         END OF TABLE?                                
         BE    SVSRC100            OVERFLOW - NEED TO INCREASE TABLE            
         CLI   0(R1),X'00'         EMPTY SPOT?                                  
         BE    SVSRC40             YES - SAVE THE SOURCE                        
*                                                                               
         CLC   SVSRCE,0(R1)        SOURCE SAME AS IN THE TABLE?                 
         BNE   SVSRC20             NO - NEXT TABLE ENTRY                        
         CLC   SVSRCEX,4(R1)       SAME SOURCE, IS THE EXCL BYTE SAME?          
         BE    SVSRCX              YES - EXIT                                   
*                                                                               
SVSRC20  DS    0H                                                               
         LA    R1,5(R1)                                                         
         B     SVSRC10                                                          
*                                                                               
SVSRC40  DS    0H                                                               
         MVC   0(5,R1),SVSRCE      SAVE SOURCE+EXCL BYTE                        
         B     SVSRCX                                                           
*                                                                               
SVSRC100 DS    0H                                                               
         MVC   X(18),=CL18'AUTONOTE*TZIHDDNY:'                                  
         MVC   X+18+1(20),=CL20'SOURCE TABLE FULL'                              
         GOTO1 DATAMGR,DMCB,=C'OPMSG',(45,X)                                    
         MVI   Z9FLAG,C'N'                                                      
*                                                                               
SVSRCX   J     EXIT                                                             
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
ISALPHA  CLI   0(R1),C'A'                                                       
         JL    ISNEQX                                                           
         CLI   0(R1),C'Z'                                                       
         JH    ISNEQX                                                           
         J     ISEQX                                                            
*                                                                               
ISNUM    CLI   0(R1),C'0'                                                       
         JL    ISNEQX                                                           
         CLI   0(R1),C'9'                                                       
         JH    ISNEQX                                                           
*                                                                               
ISEQX    CR    RB,RB                                                            
         BR    RE                                                               
ISNEQX   LTR   RB,RB                                                            
         BR    RE                                                               
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
* FAKEIND - ROUTINE TO FILL IN INDEX FIELDS                                     
* THIS IS TO BE USED WITH DDWRKIO CALLS                                         
* ROUTINE WILL POPULATE THE FOLLOWING FIELDS                                    
* WITH DATA TAKEN FROM DDWRKIOD:                                                
* EZWIMED                                                                       
* EZWISTN                                                                       
* EZWKRIND(2) - USER ID                                                         
* W_AGELD                                                                       
* W_STAT                                                                        
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
FAKEIND  NTR1  BASE=*,LABEL=*                                                   
         USING EZBLOCKD,R5                                                      
         LAY   R1,WRKEZKEY                                                      
         USING WRKEZKEY,R1                                                      
*                                                                               
         LA    R2,EZWKRIND                                                      
*                                                                               
         USING EZWKRIXD,R2                                                      
         MVC   EZWIUID,WRKEZUID                                                 
         MVC   EZWISTN,WRKEZSCL    STA CALL LETTERS                             
         MVC   EZWIDAY,WRKEZDAY                                                 
         MVC   EZWIMED,WRKEZMED    MEDIA                                        
         DROP  R2                                                               
*                                                                               
         USING W_RECD,R2                                                        
         MVC   W_AGELD,WRKEZBDT    BATCH DATE                                   
         MVC   W_STAT,WRKEZSTA     FILE STATUS                                  
         MVC   W_FILENO(L'WRKEZSQN),WRKEZSQN                                    
         DROP  R2,R1                                                            
*                                                                               
         J     EQXIT                                                            
         LTORG                                                                  
*                                                                               
*                                                                               
* INITICE                                                                       
* BUILD CTL1CNTL DATASET FOR ICETOOL                                            
INITICE  NTR1  BASE=*,LABEL=*                                                   
         OPEN  (CTL1CNTL,(OUTPUT))                                              
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LAY   R2,USING1           DEFAULT: SORT BY MGR,MKT,STA,CLT,PRD         
*                                                                               
         L     RF,VMASTC                                                        
         CLC   =C'CARLA',MCUSERID-MASTD(RF)   AGYALPH_UB                        
         BNE   *+14                                                             
         LAY   R2,USING3           SPECIAL SORT ORDER FOR CARLA(UB)             
         B     II20                                                             
*                                                                               
         CLC   =AL2(AGYALPH_TH),EZAGY                                           
         BNE   *+14                                                             
         LAY   R2,USING2           NO SORTING FOR TH                            
         B     II20                                                             
*                                                                               
         BRAS  RE,TOSORT                                                        
         BE    II20                ALWAYS SORT FOR HARD-CODED AGENCIES          
*                                                                               
         CLI   EZSORTI2,C'N'       ARE WE *NOT* SORTING?                        
         BNE   *+14                                                             
         LAY   R2,USING2           NO SORTING FOR TH                            
         B     II20                                                             
*                                                                               
II20     DS    0H                                                               
         L     R3,=A(CTL1CNTL)                                                  
*                                                                               
II30     CLI   0(R2),X'FF'                                                      
         BE    II30A                                                            
         PUT   (R3),0(R2)                                                       
         LA    R2,80(R2)                                                        
         B     II30                                                             
*                                                                               
II30A    CLOSE CTL1CNTL                                                         
         L     R3,=A(CTL1CNTL)                                                  
         FREEPOOL (R3)                                                          
         J     EQXIT                                                            
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         DS    0H                  ALIGN ON HALFWORD-ZERO FOR LARL              
       ++INCLUDE SPMGRTAB                                                       
*                                                                               
*                                                                               
*                                                                               
         DS    0D                                                               
         DC    CL8'*WKRBUF*'                                                    
WRKRBUFF DS    14336X                                                           
WRKRBEND EQU   *                                                                
         DS    0D                                                               
         DC    CL8'*WKRREC*'                                                    
WRKRREC  DS    4096X                                                            
WRKRRECE EQU   *                                                                
         DS    0D                                                               
         DC    CL8'*EZBLKF*'                                                    
EZBLOCKC DS    0X                                                               
         ORG   *+EZBLOCKL                                                       
         DS    0D                                                               
         DC    CL8'*PRTAB**'                                                    
PRTABC   DS    0X                                                               
PRTABL   EQU   32760               ENTRY LEN = 280, 117 ENTRIES                 
         ORG   *+PRTABL                                                         
PRTABE   EQU   *                                                                
         DS    0D                                                               
         DC    CL8'*CMTAB**'       COMMERCIAL TABLE                             
CMTABC   DS    0X                                                               
CMTABL   EQU   24600                                                            
         ORG   *+CMTABL                                                         
CMTABE   EQU   *                   COMML SEQ TABLE                              
         DS    0D                                                               
         DC    CL8'*CSTAB**'                                                    
CSTABC   DS    0X                                                               
CSTABL   EQU   600                 ENTRY = 2 BCLT, 3 COMML SEQ #                
         ORG   *+CSTABL                                                         
CSTABE   EQU   *                                                                
         DC    CL8'*STMKT**'                                                    
STTABC   DS    0X                                                               
STTABL   EQU   800                 ENTRY = 8, 5 STATION, 2 MKT, 1 STYPE         
STTABENT EQU   8                                                                
         ORG   *+STTABL                                                         
STTABE   EQU   *                                                                
         DC    CL8'*MKTNM**'                                                    
MKTABC   DS    0X                                                               
MKTABL   EQU   720                 ENTRY = 22, 2 MKT, 20 MARKET NAME            
MKTABENT EQU   22                                                               
         ORG   *+MKTABL                                                         
MKTABE   EQU   *                                                                
         DS    0D                                                               
         DC    CL8'EQVSTATB'                                                    
EQVSTATB DS    14000X                                                           
EQVSTATL EQU   *-EQVSTATB          ENTRY = 10, 5 EACH STATION                   
*                                                                               
*                                             5 RENAMED STATION                 
         DS    0D                                                               
         DC    CL8'DRGLOBAL'                                                    
GLAREA   DS    66000X              DRIVER GLOBAL AREA                           
*                                                                               
*                                                                               
IDSRCTAB DS    0X                                                               
         DC    X'319B',C'COZE'     12699,ZEREP                                  
         DC    X'319B',C'ICZE'     12699,ZEREP                                  
         DC    X'319B',C'ICWU'     12699,ZEREP                                  
         DC    X'0011',C'COZE'     11,SJR                                       
         DC    X'FF'                                                            
*                                                                               
         DS    0D                                                               
TSARAREA DS    XL(TSARDL2)                                                      
*                                                                               
*                                                                               
*                                                                               
*                                                                               
ICEPAR1  DC    A(0)                ICETOOL PARAMETER LIST                       
ICEPARST DC    A(CNTSA0L)          A(ICETOOL PARAMETER)                         
         DC    A(0)                                                             
         DC    A(CNTSA1L)          A(ICETOOL PARAMETER)                         
         DC    A(0)                                                             
         DC    A(CNTSA2L)          A(ICETOOL PARAMETER)                         
         DC    A(0)                                                             
         DC    X'FFFFFFFF'         EOL                                          
*                                                                               
* STATEMENT 0, COMMON FOR ALL: ADDING SEQ NUMBER, REMOVING DUPLICATES           
*                                                                               
CNTSA0L  DC    AL2(CNTSA0E-CNTSA0S)    L'STATEMENT                              
CNTSA0S  DC    C'SELECT FROM(INFILE1) TO(TEMP1)'                                
         DC    C' ON(1,160,BI) FIRST USING(CTL0)'                               
         DC    CL(80-(*-CNTSA0S))' '   BLANK PAD TO 80-BYTES                    
CNTSA0E  EQU   *                                                                
*                                                                               
* STATEMENT 1: AGENCY- AND PROFILE-SPECIFIC SORTING                             
* SORTER OPTIONS ARE BUILT DYNAMICALLY, DEPENDING ON AGENCY/PROFILE             
*                                                                               
CNTSA1L  DC    AL2(CNTSA1E-CNTSA1S)    L'STATEMENT                              
CNTSA1S  DC    C'SORT FROM(TEMP1) TO(TEMP2) USING(CTL1)'                        
         DC    CL(80-(*-CNTSA1S))' '   BLANK PAD TO 80-BYTES                    
CNTSA1E  EQU   *                                                                
*                                                                               
* STATEMENT 2, COMMON FOR ALL: RESIZE                                           
*                                                                               
CNTSA2L  DC    AL2(CNTSA2E-CNTSA2S)    L'STATEMENT                              
CNTSA2S  DC    C'RESIZE FROM(TEMP2) TO(EZI2RQF) TOLEN(80)'                      
         DC    CL(80-(*-CNTSA2S))' '   BLANK PAD TO 80-BYTES                    
CNTSA2E  EQU   *                                                                
*                                                                               
*                                                                               
*                                                                               
* AGENCY/PROFILE-SPECIFIC DFSORT CONTROL STATEMENTS                             
*                                                                               
USING1   DS    0C                  DEFAULT                                      
         DC    CL80' SORT FIELDS=(MGR,A,MKT,A,STA,A,CLT,A,PRD,A,EST,A,'         
         DC    CL80'              MOS,A,SEQ,A)'                                 
         DC    CL80' OUTFIL OUTREC=(REQCARDS)'                                  
         DC    X'FF'               EOT                                          
*                                                                               
USING2   DS    0C                  NO SORTING                                   
         DC    CL80' SORT FIELDS=(SEQ,A)'                                       
         DC    CL80' OUTFIL OUTREC=(REQCARDS)'                                  
         DC    X'FF'               EOT                                          
*                                                                               
USING3   DS    0C                  SPECIAL SORT FOR CARAT                       
         DC    CL80' SORT FIELDS=(CLT,A,PRD,A,EST,A,MOS,A,STA,A,MKT,A,'         
         DC    CL80'              SEQ,A)'                                       
         DC    CL80' OUTFIL OUTREC=(REQCARDS)'                                  
         DC    X'FF'               EOT                                          
*                                                                               
*                                                                               
**********************************************************************          
**********************************************************************          
*************** DSECTS ***********************************************          
**********************************************************************          
**********************************************************************          
*                                                                               
SPZ5WRKD DSECT                                                                  
FIRSTSW  DS    X               0 = FIRST TIME, 01 = DRIVER INITIALIAZED         
FIRSTSWC EQU   X'08'               AT LEAST 1 INVOICE CONVERTED                 
FIRSTSWI EQU   X'01'               DRIVER IS INITIALIZED                        
*                              8 = AT LEAST 1 INVOICE CONVERTED                 
SAVSYS   DS    X                                                                
RERUN    DS    XL3                 RERUN DATE                                   
TODAYJ   DS    XL3                 TODAYS JULIAN DATE PWOS CYYDDD               
*                                                                               
TRCOPT   DS    C                                                                
PREVOPT  DS    C                                                                
UNCONVSW DS    C                                                                
CONVSW   DS    C                                                                
ACTVSW   DS    CL1                                                              
EZCLTFTR DS    XL2                 CLIENT FILTER                                
*                                                                               
ADPGFILE DS    A                                                                
ADRIVER  DS    A                                                                
ATRPACK  DS    A                                                                
*                                                                               
DPGFILE  DS    CL8                                                              
DRIVER   DS    CL8                                                              
SPDRIVER DS    CL8                                                              
XFF      DS    XL20                                                             
DASHES   DS    CL70                                                             
X        DS    XL256                                                            
*                                                                               
SVKEY    DS    CL32                                                             
ELCODE   DS    XL1                                                              
REPUTL   DS    XL1                                                              
         DS    CL2                 SPARE                                        
         DS    0D                                                               
SVWKDESC DS    XL(L'WRKEZDSC)                                                   
*                                                                               
ATSAROFF DS    A                                                                
TSARBUFL DS    A                  BUFFER LENGTH FOR 200 RECORDS                 
TSARBUFF DS    A                   ADDRESS OF GETMAIN BUFFER                    
TSRKEYF  DS    H                                                                
TSARBYTE DS    F                   CT OF TSAR BYTE SENT                         
TSARLAST DS    H                   LAST TSAR RECORD NUMBER                      
PRTCT    DS    H                   CT OF PRINT LINES SAVED                      
*                                                                               
SVMGRMKT DS    XL2                                                              
SVMGRP   DS    CL5                                                              
SVBREAKS DS    XL(3*24)                                                         
SVSMKT   DS    CL4                                                              
SVBMKT   DS    XL2                                                              
SVSMKTNM DS    CL20                                                             
SVBSTA   DS    CL7                                                              
SVBDSTA  DS    CL7                 SAVED BAD (DOES NOT EXIST) STATION           
SVBDATE  DS    CL8                                                              
*                                                                               
SVSRCE   DS    CL4                 SOURCE FILTER                                
SVSRCEX  DS    CL1                 IF MINUS, SOURCE EXCLUSION                   
RECONFLG DS    C                                                                
*                                                                               
*VBTIM   DS    CL4                                                              
*                                                                               
RPTNO    DS    XL1                                                              
MPLKEY   DS    CL40                                                             
MPLKEYSV DS    CL40                                                             
EQVSTAW  DS   0CL5                                                              
         DS    CL4                                                              
EQVMEDW  DS    CL1                                                              
         DS    CL3                                                              
*                                                                               
SVBATSEQ DS    XL4                                                              
*                                                                               
* TSAR BLOCK AND NUMBER OF ENTRIES EQUATE                                       
*                                                                               
         DS    0D                                                               
TSARBLK  DS    CL(TSARDL2)                                                      
*                                                                               
NUMREQS  EQU   4000                NUMBER OF REQUESTS IN TSAR BUFFER            
*                                                                               
*                                                                               
*                                                                               
ABUFFER  DS    A                                                                
DUPFLAG  DS    C                                                                
PROFI2Z  DS    XL16                                                             
PROFI2ZI DS    XL40                                                             
SVGETEL  DS    F                R6+                                             
         DS    XL3              + DATADISP+ELCODE (2ND PART OF SVGETEL)         
*                                                                               
*ABUFFRIN DS    A                                                               
*                                                                               
WRTFLAG  DS    C                                                                
EDCTFLAG DS    C                                                                
MQFLAG   DS    C                                                                
MGR2FLAG DS    C                                                                
*                                                                               
* FLAG TO PREVENT MULTIPLE SOURCE TABLE OVERFLOW ERRORS                         
Z9FLAG   DS    C                                                                
*                                                                               
SVIMDSN  DS    0X                                                               
         ORG   SVIMDSN+DSNNMLQ                                                  
*                                                                               
SVREMPQK DS    XL7                                                              
SVVLRMKY DS    V                                                                
SVIMTIME DS    F                                                                
*                                                                               
SVREQST  DS    CL80                                                             
AMQRPT   DS    A                                                                
*                                                                               
SRCETAB  DS    50CL5               4-CHAR SOURCE, 1 CHAR EXCLUSION FLAG         
SRCETABX DS    X                                                                
*                                                                               
TSARB    DS    A                                                                
TSARBLEN DS    A                                                                
TSARBLQ  EQU   MYRECLQ*3000        THREE THOUSAND RECORDS SO FAR                
ATSROFF  DS    A                                                                
*                                                                               
MYREC    DS    0X                                                               
*                                                                               
MYKEY    DS    0X                                                               
MYKEYAM  DS    XL1                 AGENCY/MEDIA                                 
MYKEYCLT DS    XL2                 CLIENT                                       
MYKEYSTA DS    XL3                 STATION                                      
MYKEYMOS DS    XL2                 2-BYTE COMPRESSED X'FF' COMPLEMENT           
MYKEYINV DS    CL10                INVOICE NUMBER                               
MYKEYMIN DS    XL6                 MINIO ELEMENT KEY                            
MYKEYLQ  EQU   *-MYKEY                                                          
*                                                                               
MYDATA   DS    X                                                                
MYRECLQ  EQU   *-MYREC                                                          
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*        PRINT OFF                                                              
       ++INCLUDE DRGLOBAL                                                       
*                                                                               
GLOPT1   EQU   GLOPTS+00                                                        
GLOPT2   EQU   GLOPTS+01                                                        
GLOPT3   EQU   GLOPTS+02                                                        
GLOPT4   EQU   GLOPTS+03                                                        
GLOPT5   EQU   GLOPTS+04                                                        
GLOPT6   EQU   GLOPTS+05                                                        
GLOPT7   EQU   GLOPTS+06                                                        
GLOPT8   EQU   GLOPTS+07                                                        
GLOPT9   EQU   GLOPTS+08                                                        
GLOPT10  EQU   GLOPTS+09                                                        
GLOPT11  EQU   GLOPTS+10                                                        
GLOPT12  EQU   GLOPTS+11                                                        
*                                                                               
       ++INCLUDE SPREPWORKD                                                     
       ++INCLUDE SPREPMODES                                                     
       ++INCLUDE DDCOMFACS                                                      
       ++INCLUDE DDREMOTED                                                      
MASTD    DSECT                                                                  
       ++INCLUDE DDMASTC                                                        
       ++INCLUDE FASELIST                                                       
*                                                                               
       ++INCLUDE EZBLOCK                                                        
*                                                                               
EZBLOCKD DSECT                                                                  
         ORG   EZWRKIOB                                                         
       ++INCLUDE DDWRKIOD                                                       
         ORG                                                                    
*                                                                               
       ++INCLUDE SPGENEZ                                                        
CLTHDRD  DSECT                                                                  
       ++INCLUDE SPGENCLT                                                       
MKTRECD  DSECT                                                                  
       ++INCLUDE SPGENMKT                                                       
       ++INCLUDE SPGENMKA                                                       
       ++INCLUDE SPGENMKG                                                       
       ++INCLUDE SPGENSTEQ                                                      
       ++INCLUDE CTGENSTAD                                                      
       ++INCLUDE DDTSARD                                                        
         PRINT ON                                                               
*                                                                               
       ++INCLUDE DMWRKFD                                                        
       ++INCLUDE DMWRKFK                                                        
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE DDBUFFD                                                        
       ++INCLUDE SPWMGRD                                                        
       ++INCLUDE SPEZDSCTS                                                      
       ++INCLUDE DDAGYALPH                                                      
*                                                                               
         DCBD  DSORG=PS,DEVD=DA                                                 
*                                                                               
SPWORKD  DSECT                                                                  
         ORG   Q2USER                                                           
Q2PIDFLG DS    C                   FOLLOWING TWO BYTES ARE BINARY PID           
Q2PID    DS    XL2                 PID TO PUT IN ACTIVITY ELEMENT               
         ORG                                                                    
*                                                                               
DSNNAMED DSECT                                                                  
DSNROOT  DS    CL3                 C'EZI'                                       
         DS    C                   DOT                                          
DSNDATE  DS    CL5                                                              
         DS    C                   DOT                                          
DSNTIME  DS    CL5                                                              
         DS    C                   DOT                                          
DSNJOB   DS    CL8                 C'JOB'                                       
DSNNMLQ  EQU   *-DSNNAMED                                                       
*                                                                               
*PREFIX=ST$                                                                     
STARECD  DSECT                                                                  
       ++INCLUDE SPGENSTA                                                       
*PREFIX=                                                                        
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'228SPREPZ502 01/23/20'                                      
         END                                                                    

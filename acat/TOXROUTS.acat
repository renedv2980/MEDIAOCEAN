*          DATA SET TOXROUTS   AT LEVEL 043 AS OF 02/16/18                      
*CATALP OXROUTS                                                                 
         TITLE 'EXTRACT ROUTINES FOR TOXTRACT'                                  
         PRINT NOGEN                                                            
TOXROUTS CSECT                                                                  
         ENTRY TOXAGYC             5000 - AGENCY CODE RECORD                    
         ENTRY TOXCLIC             5001 - CLIENT RECORD                         
         ENTRY TOXPRDC             5002 - PRODUCT RECORD                        
         ENTRY TOXASSC             5003 - ASSET RECORD                          
         ENTRY TOXVERC             5004 - VERSION RECORD                        
         ENTRY TOXALIC             5005 - ALIAS RECORD                          
         ENTRY TOXW4RC             5006 - W-4 RECORD                            
         ENTRY TOXPERC             5007 - PERFORMER RECORD                      
         ENTRY TOXINVC             5010 - INVOICE RECORD                        
         ENTRY TOXCGRC             5021 - CLIENT GROUP                          
         ENTRY TOXAGRC             5024 - AGENCY GROUP                          
         ENTRY TOXAREC             5028 - AREA                                  
         ENTRY TOXPUSC             5029 - PRINT USE                             
         ENTRY TOXGUAC             5030 - GUARANTEE                             
         ENTRY TOXGUCC             5033 - GUARANTEE CONTRACT                    
         ENTRY TOXGCCC             5035 - GUARANTEE COMMENT                     
         ENTRY TOXGCYC             5036 - GUARANTEE CONT YEAR TRACKING          
         ENTRY TOXVCLC             5037 - VERSION COMMENTS                      
         ENTRY TOXAGTC             5038 - AGENCY                                
         ENTRY TOXGTKC             5039 - GUARANTEE TRACKING                    
         ENTRY TOXOFFC             5041 - OFFICE                                
         ENTRY TOXSTFF             5045 - STAFF                                 
         ENTRY TOXCHKC             5057 - CHECK                                 
         ENTRY TOXPGRC             5065 - PRODUCT GROUP                         
         ENTRY TOXPTYC             5066 - PRODUCT TYPE                          
         ENTRY TOXMKTC             5053 - MARKETS                               
         ENTRY TOXUSEC             5049 - USAGE HISTORY                         
         ENTRY TOXTIMC             5069 - TIMESHEET DAY                         
         ENTRY TOXCTLC             5070 - CONTROL                               
         ENTRY TOXEMPC             5071 - EMPLOYER                              
         ENTRY TOXLIEC             5072 - LIEN                                  
         ENTRY TOXDCC              5073 - DUE COMPANY                           
         ENTRY TOX74C              5074 - INTERNET NEWMEDIA                     
         ENTRY TOX76C              5076 - COMMERCIAL POOL                       
         ENTRY TOX77C              5077 - BILL TO                               
         ENTRY TOX79C              5079 - PUBLISHED MUSIC                       
         ENTRY TOX81C              5081 - EPISODE                               
         ENTRY TOX83C              5083 - ECAST                                 
         ENTRY TOX84C              5084 - FIXED CYCLE TRACKING                  
         ENTRY TOX85C              5085 - USAGE HISTORY                         
         ENTRY TOX86C              5086 - HISTORY COMMENT                       
*                                                                               
EXIT     XMOD1                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXAGYC - EXTRACT AGENCY RECORDS - 5001                             *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(AGENCY RECORD)                                                *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXAGYC  NMOD1 WORKX-WORKD,*TOXAGY*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXAGYLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLAYD,R3            R3=A(AGENCY RECORD)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXAGBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXAGNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXAGYCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXAGYLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXAGNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX00LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX00LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXAGBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXAGYR          BUILD AGENCY RECORD                          
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXAGYR -  - EXTRACT AGENCY RECORDS - 5000                          *         
***********************************************************************         
                                                                                
TOXAGYR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK00CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX00LEN)                                          
         MVC   TOXRETYP,TOXAGYQ                                                 
*                                                                               
         MVI   TX00AGY-1,MXTRTQ                                                 
         MVI   TX00NAME-1,MXTRTQ                                                
         MVI   TX0013WK-1,MXTRTQ                                                
         MVI   TX00AGRP-1,MXTRTQ                                                
         MVI   TX00OFC-1,MXTRTQ                                                 
         MVI   TX00LOCK-1,MXTRTQ                                                
         MVI   TX00ADR1-1,MXTRTQ                                                
         MVI   TX00ADR2-1,MXTRTQ                                                
         MVI   TX00ADR3-1,MXTRTQ                                                
         MVI   TX00ADR4-1,MXTRTQ                                                
         MVI   TX00PHON-1,MXTRTQ                                                
         MVI   TX00ATTN-1,MXTRTQ                                                
         MVI   TX00EMAL-1,MXTRTQ                                                
         MVI   TX00GHFN-1,MXTRTQ                                                
         MVI   TX00G2HF-1,MXTRTQ                                                
         MVI   TX00HFMW-1,MXTRTQ                                                
         MVI   TX00HFNA-1,MXTRTQ                                                
         MVI   TX00SAC-1,MXTRTQ                                                 
         MVI   TX00PEHF-1,MXTRTQ                                                
         MVI   TX00PREM-1,MXTRTQ                                                
         MVI   TX00SA-1,MXTRTQ                                                  
         MVI   TX00STUD-1,MXTRTQ                                                
         MVI   TX00BTYP-1,MXTRTQ                                                
         MVI   TX00FUTA-1,MXTRTQ                                                
         MVI   TX00SUTA-1,MXTRTQ                                                
         MVI   TX00FICA-1,MXTRTQ                                                
         MVI   TX00OFIC-1,MXTRTQ                                                
         MVI   TX00WCCR-1,MXTRTQ                                                
         MVI   TX00HANC-1,MXTRTQ                                                
         MVI   TX00HANI-1,MXTRTQ                                                
         MVI   TX00HNCN-1,MXTRTQ                                                
         MVI   TX00AGRT-1,MXTRTQ                                                
         MVI   TX00SRUL-1,MXTRTQ                                                
         MVI   TX00SRAT-1,MXTRTQ                                                
         MVI   TX00SCAP-1,MXTRTQ                                                
         MVI   TX00EMPR-1,MXTRTQ                                                
         MVI   TX00STFC-1,MXTRTQ                                                
         MVI   TX00T10I-1,MXTRTQ                                                
         MVI   TX00POWO-1,MXTRTQ                                                
         MVI   TX00POWV-1,MXTRTQ                                                
         MVI   TX00CLPO-1,MXTRTQ                                                
         MVI   TX00ESJR-1,MXTRTQ                                                
         MVI   TX00BSUT-1,MXTRTQ                                                
         MVI   TX00VALJ-1,MXTRTQ                                                
         MVI   TX00EJVF-1,MXTRTQ                                                
         MVI   TX00BILC-1,MXTRTQ                                                
         MVI   TX00DJOB-1,MXTRTQ                                                
         MVI   TX00VEJ-1,MXTRTQ                                                 
         MVI   TX00GUHA-1,MXTRTQ                                                
         MVI   TX00GULM-1,MXTRTQ                                                
         MVI   TX00ASNM-1,MXTRTQ                                                
         MVI   TX00ATPS-1,MXTRTQ                                                
         MVI   TX00X,MXTRTQ                                                     
         MVI   TX00X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX00AGY,TLAYAGY     AGENCY                                       
         MVI   TX0013WK,C'N'       CALCULATE 13 WKS AS 3 MONTHS?                
         MVI   TX00LOCK,C'N'                                                    
*                                                                               
         LH    RF,=Y(TX00LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXAGYCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLAYELEM         R5=A(FIRST ELEMENT)                          
TOXAG10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXAGYXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXAG30                                                          
         CLI   0(R5),TAAYELQ       NAME ELEMENT X'2A'                           
         JE    TOXAG40                                                          
         CLI   0(R5),TAADELQ       NAME ELEMENT X'22'                           
         JE    TOXAG50                                                          
         CLI   0(R5),TAFNELQ       NAME ELEMENT X'26'                           
         JE    TOXAG60                                                          
         CLI   0(R5),TANUELQ                                                    
         JE    TOXAG70                                                          
         CLI   0(R5),TACMELQ                                                    
         JE    TOXAG80                                                          
         CLI   0(R5),TABRELQ       BILLING RULES                                
         JE    TOXAG90                                                          
         CLI   0(R5),TAGHELQ       GUARANTEE ELEM                               
         JE    TOXAG100                                                         
         CLI   0(R5),TASNELQ       SHORT NAME                                   
         JE    TOXAG110                                                         
*                                                                               
TOXAG20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXAG10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXAG30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXAG20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX00NAME(0),TANANAME                                             
         J     TOXAG20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAAYD,R5                                                         
TOXAG40  TM    TAAYSTAT,TAAYS13W   CALCULATE 13 WKS AS 3 MONTHS?                
         JO    *+8                                                              
         MVI   TX0013WK,C'Y'                                                    
*                                                                               
         MVC   TX00AGRP,TAAYAGG    AGENCY GROUP                                 
         MVC   TX00OFC,TAAYTPOF    OFFICE                                       
*                                                                               
         MVI   TX00LOCK,C'N'                                                    
         TM    TAAYSTA3,TAAYSLCK   LOCKED?                                      
         JZ    *+8                                                              
         MVI   TX00LOCK,C'Y'                                                    
*                                                                               
         MVC   TX00PHON,TAAYTEL    PHONE NUMBER                                 
*                                                                               
         MVI   TX00GHFN,C'Y'                                                    
         TM    TAAYHLDS,TAAYHSNO   DON'T GENERATE HOLDING FEE NOTICES?          
         JZ    TOXAG42                                                          
         MVI   TX00GHFN,C'N'                                                    
         MVI   TX00G2HF,C'N'                                                    
         MVC   TX00HFMW,SPACES                                                  
         MVC   TX00SAC,SPACES                                                   
         J     TOXAG44                                                          
*                                                                               
TOXAG42  MVI   TX00G2HF,C'Y'                                                    
         TM    TAAYHLDS,TAAYHS2D   DON'T GEN 2ND HOLDING FEE NOTICES?           
         JZ    *+8                                                              
         MVI   TX00G2HF,C'N'                                                    
*                                                                               
         MVI   TX00HFMW,C'W'                                                    
         TM    TAAYHLD,X'80'       MONTHLY?                                     
         JZ    *+8                                                              
         MVI   TX00HFMW,C'M'                                                    
*                                                                               
         MVI   TX00SAC,C'N'                                                     
         TM    TAAYHLDS,TAAYHSCO   SHOW AGY COMMISION?                          
         JZ    *+8                                                              
         MVI   TX00SAC,C'Y'                                                     
*                                                                               
TOXAG44  TM    TAAYHLDS,TAAYHSNC   PAPER/ELECTRONIC NO CHANGES?                 
         JZ    *+10                                                             
         MVC   TX00PEHF,=C'NC'                                                  
         TM    TAAYHLDS,TAAYHSPE   PAPER/ELECTRONIC NOTICES?                    
         JZ    *+10                                                             
         MVC   TX00PEHF,=C'PE'                                                  
         TM    TAAYHLDS,TAAYHSEL   ELECTRONIC ONLY?                             
         JZ    *+10                                                             
         MVC   TX00PEHF,=C'EL'                                                  
         TM    TAAYHLDS,TAAYHSPO   PAPER ONLY?                                  
         JZ    *+10                                                             
         MVC   TX00PEHF,=C'PO'                                                  
*                                                                               
         MVI   TX00PREM,C'N'                                                    
         TM    TAAYMISC,TAAYPREM   PREMIUM SERVICE?                             
         JZ    *+8                                                              
         MVI   TX00PREM,C'Y'                                                    
*                                                                               
         MVC   BYTE,TAAYHLD        DISPLAY NUMBER OF WEEKS NOTICE               
         NI    BYTE,X'7F'                                                       
         ZIC   RF,BYTE                                                          
         EDIT  (RF),TX00HFNA,ALIGN=RIGHT                                        
*                                                                               
         MVC   TX00STFC,TAAYTPC                STAFF CODE                       
*                                                                               
         MVI   TX00T10I,C'N'                                                    
         TM    TAAYSTA6,TAAYST10   ON TYPE 10 INTERFACE?                        
         JZ    *+8                                                              
         MVI   TX00T10I,C'Y'                                                    
*                                                                               
         MVI   TX00POWO,C'N'                                                    
         TM    TAAYSTAT,TAAYSAPO   PO REQUIRED WITHOUT VALIDATION?              
         JZ    *+8                                                              
         MVI   TX00POWO,C'Y'                                                    
*                                                                               
         MVI   TX00POWV,C'N'                                                    
         TM    TAAYSTA4,TAAYPOV    PO REQUIRED WITH VALIDATION?                 
         JZ    *+8                                                              
         MVI   TX00POWV,C'Y'                                                    
*                                                                               
         MVI   TX00CLPO,C'N'                                                    
         TM    TAAYSTA4,TAAYSCPO   CLOSE PRINT PURCHASE ORDERS?                 
         JZ    *+8                                                              
         MVI   TX00CLPO,C'Y'                                                    
*                                                                               
         MVI   TX00ESJR,C'N'                                                    
         TM    TAAYSTAT,TAAYSEST   ESTIMATE/JOB REQUIRED?                       
         JZ    *+8                                                              
         MVI   TX00ESJR,C'Y'                                                    
*                                                                               
         MVI   TX00VEJ,C'N'        VALIDATE ESTIMATE/JOB FOR BBDO?              
         TM    TAAYSTA7,TAAYSBBD                                                
         JZ    *+8                                                              
         MVI   TX00VEJ,C'Y'                                                     
*                                                                               
         MVI   TX00ATPS,C'N'       AGENCY HAS TP SIGNATORY?                     
         TM    TAAYSTA6,TAAYSTPS                                                
         JZ    *+8                                                              
         MVI   TX00ATPS,C'Y'                                                    
*                                                                               
         EDIT  TAAYBUNT,TX00BSUT,ALIGN=LEFT    BUSINESS UNIT                    
*                                                                               
         EDIT  TAAYNBIL,TX00BILC,ALIGN=LEFT    BILLING COPIES                   
*                                                                               
         CLC   TX00SRAT,SPACES     IS THERE A SIG FEE RATE?                     
         JZ    TOXAG20                                                          
         EDIT  TAAYSGNS,TX00SRUL,ZERO=NOBLANK  SIGNATORY RULE                   
         J     TOXAG20                                                          
*                                                                               
         USING TAADD,R5                                                         
TOXAG50  LA    RF,TAADADD                                                       
         MVC   TX00ADR1,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,1          N'LINES                                      
         JE    TOXAG20                                                          
         MVC   TX00ADR2,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,2                                                       
         JE    TOXAG20                                                          
         MVC   TX00ADR3,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,3                                                       
         JE    TOXAG20                                                          
         MVC   TX00ADR4,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         J     TOXAG20                                                          
*                                                                               
         USING TAFND,R5                                                         
TOXAG60  CLI   TAFNTYPE,TAFNTATT   ATTENTION NAME?                              
         JNE   TOXAG62                                                          
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00ATTN(0),TAFNNAME                                             
         J     TOXAG20                                                          
*                                                                               
TOXAG62  CLI   TAFNTYPE,TAFNTSTU   STUDIO CODE?                                 
         JNE   TOXAG20                                                          
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00STUD(0),TAFNNAME                                             
         J     TOXAG20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXAG70  CLI   TANUTYPE,TANUTSIG   SIGNATORY?                                   
         JNE   TOXAG73                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00SA(0),TANUMBER                                               
         J     TOXAG20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXAG73  CLI   TANUTYPE,TANUTSGN   SIGNATORY FEE RATE                           
         JNE   TOXAG75                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00SRAT(0),TANUMBER                                             
         J     TOXAG20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXAG75  CLI   TANUTYPE,TANUTSCP   SIGNATORY FEE CAP                            
         JNE   TOXAG77                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00SCAP(0),TANUMBER                                             
         J     TOXAG20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXAG77  CLI   TANUTYPE,TANUTJOB   ESTIMATE/JOB VALIDATION                      
         JNE   TOXAG78                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00EJVF(0),TANUMBER                                             
         J     TOXAG20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXAG78  CLI   TANUTYPE,TANUTDJB   AGENCY DEFAULT JOB                           
         JNE   TOXAG20                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00DJOB(0),TANUMBER                                             
         J     TOXAG20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXAG80  CLI   TACMTYPE,TACMTYPI   EMAIL?                                       
         JNE   TOXAG20                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX00EMAL(0),TACMCOMM                                             
         J     TOXAG20                                                          
*                                                                               
         USING TABRD,R5                                                         
TOXAG90  TM    TABRSTAT,TABRSACP   SKIP ADDITIONAL BILLING RATES                
         BNZ   TOXAG20                                                          
                                                                                
         CLI   TABRTYPE,X'C0'      IS BILLING TYPE ALPHABETIC?                  
         BNH   *+14                                                             
         MVC   TX00BTYP,TABRTYPE                                                
         B     TOXAG95                                                          
         EDIT  TABRTYPE,TX00BTYP,ALIGN=LEFT   BILLING TYPE                      
                                                                                
TOXAG95  CLI   TABRTYPE,TABRTY99   IF TYPE 99, NO RATES                         
         BE    TOXAG97                                                          
         TM    TABRSTAT,TABRSSRC   OR IF STANDARD RATE CARD,                    
         BO    TOXAG97             NO RATES                                     
                                                                                
         OC    TABRRATE,TABRRATE   DO WE HAVE RATES?                            
         BZ    TOXAG97                                                          
                                                                                
         EDIT  TABRFUTA,TX00FUTA,2,ALIGN=LEFT,ZERO=NOBLANK  FUTA                
         EDIT  TABRSUTA,TX00SUTA,2,ALIGN=LEFT,ZERO=NOBLANK  SUTA                
         EDIT  TABRFICA,TX00FICA,2,ALIGN=LEFT,ZERO=NOBLANK  FICA                
         EDIT  TABROVER,TX00OFIC,2,ALIGN=LEFT,ZERO=NOBLANK  OVER FICA           
         EDIT  TABRWCRP,TX00WCCR,2,ALIGN=LEFT,ZERO=NOBLANK  WC CORP             
         EDIT  TABRCORP,TX00HANC,2,ALIGN=LEFT,ZERO=NOBLANK  CORP HAND           
         EDIT  TABRHAND,TX00HANI,2,ALIGN=LEFT,ZERO=NOBLANK  IND HAND            
         EDIT  TABRCAN,TX00HNCN,2,ALIGN=LEFT,ZERO=NOBLANK   CAN HAND            
                                                                                
TOXAG97  EDIT  TABRHRLS,TX00AGRT,2,ALIGN=LEFT,ZERO=BLANK   APP GRT RULE         
                                                                                
         MVC   TX00EMPR,TABROEOR   OVERRIDE EMPLOYER                            
*                                                                               
         MVI   TX00VALJ,C'N'                                                    
         TM    TABRSTAT,TABRSINT   VALIDATE ESTIMATE/JOB?                       
         JZ    *+8                                                              
         MVI   TX00VALJ,C'Y'                                                    
                                                                                
TOXAG99  J     TOXAG20                                                          
*                                                                               
         USING TAGHEL,R5                                                        
TOXAG100 OC    TAGHHDL,TAGHHDL                                                  
         BZ    TOXAG102                                                         
         EDIT  (2,TAGHHDL),(4,TX00GUHA),ALIGN=LEFT                              
*                                                                               
TOXAG102 OC    TAGHLIM,TAGHLIM                                                  
         BZ    TOXAG104                                                         
         EDIT  (3,TAGHLIM),(6,TX00GULM),ALIGN=LEFT                              
*                                                                               
TOXAG104 J     TOXAG20                                                          
*                                                                               
         USING TASND,R5                                                         
TOXAG110 MVC   TX00ASNM,TASNAME    SHORT NAME                                   
         J     TOXAG20                                                          
         DROP  R5                                                               
*                                                                               
TOXAGYXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCLIC - EXTRACT CLIENT RECORDS - 5001                             *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(CLIENT RECORD)                                                *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
                                                                                
TOXCLIC  NMOD1 WORKX-WORKD,*TOXCLI*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXCLILT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCLD,R3            R3=A(CLIENT RECORD)                          
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         SR    R0,R0               INITIALIZE TOXRECD TO SPACES                 
         SR    R1,R1                                                            
         ICM   R1,8,SPACES                                                      
         LR    RE,R2                                                            
         AHI   RE,TOXREHDL                                                      
         LA    RF,TX01LEN                                                       
         SHI   RF,TOXREHDL                                                      
         MVCL  RE,R0                                                            
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX01LEN)                                          
         MVC   TOXRETYP,TOXCLIQ                                                 
*                                                                               
         MVI   TX01AGY-1,MXTRTQ                                                 
         MVI   TX01CLI-1,MXTRTQ                                                 
         MVI   TX01NAME-1,MXTRTQ                                                
         MVI   TX01CGRP-1,MXTRTQ                                                
         MVI   TX01LOCK-1,MXTRTQ                                                
         MVI   TX01ADR1-1,MXTRTQ                                                
         MVI   TX01ADR2-1,MXTRTQ                                                
         MVI   TX01ADR3-1,MXTRTQ                                                
         MVI   TX01ADR4-1,MXTRTQ                                                
         MVI   TX01ATTN-1,MXTRTQ                                                
         MVI   TX01EMAL-1,MXTRTQ                                                
         MVI   TX01PEHF-1,MXTRTQ                                                
         MVI   TX01SA-1,MXTRTQ                                                  
         MVI   TX01BTYP-1,MXTRTQ                                                
         MVI   TX01FUTA-1,MXTRTQ                                                
         MVI   TX01SUTA-1,MXTRTQ                                                
         MVI   TX01FICA-1,MXTRTQ                                                
         MVI   TX01OFIC-1,MXTRTQ                                                
         MVI   TX01WCCR-1,MXTRTQ                                                
         MVI   TX01HANC-1,MXTRTQ                                                
         MVI   TX01HANI-1,MXTRTQ                                                
         MVI   TX01HNCN-1,MXTRTQ                                                
         MVI   TX01AGRT-1,MXTRTQ                                                
         MVI   TX01X,MXTRTQ                                                     
         MVI   TX01LOCK,C'N'                                                    
*                                                                               
         MVC   TX01AGY,TLCLAGY     AGENCY                                       
         MVC   TX01CLI,TLCLCLI     CLIENT                                       
*                                                                               
         LA    R5,TLCLELEM         R5=A(FIRST ELEMENT)                          
TOXCL10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXCLIXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXCL30                                                          
         CLI   0(R5),TACIELQ       CLIENT INFORMATION ELEMENT X'2C'             
         JE    TOXCL40                                                          
         CLI   0(R5),TAADELQ       CLIENT INFORMATION ELEMENT X'2C'             
         JE    TOXCL50                                                          
         CLI   0(R5),TARAELQ                                                    
         JE    TOXCL60                                                          
         CLI   0(R5),TACMELQ                                                    
         JE    TOXCL80                                                          
         CLI   0(R5),TANUELQ                                                    
         JE    TOXCL90                                                          
         CLI   0(R5),TAFNELQ                                                    
         JE    TOXCL100                                                         
         CLI   0(R5),TABRELQ       BILLING RULES                                
         JE    TOXCL110                                                         
*                                                                               
TOXCL20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXCL10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXCL30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,3                                                             
         JM    TOXCLIXX                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX01NAME(0),TANANAME                                             
         J     TOXCL20                                                          
*                                                                               
         USING TACID,R5                                                         
TOXCL40  MVC   TX01CGRP,TACICLG    CLIENT GROUP                                 
*                                                                               
         MVI   TX01LOCK,C'N'                                                    
         TM    TACISTAT,TACISLCK   LOCKED?                                      
         JZ    *+8                                                              
         MVI   TX01LOCK,C'Y'                                                    
                                                                                
         TM    TACISTAT,TACIHSNC   PAPER/ELECTRONIC NO CHANGES?                 
         JZ    *+10                                                             
         MVC   TX01PEHF,=C'NC'                                                  
         TM    TACISTAT,TACIHSPE   PAPER/ELECTRONIC NOTICES?                    
         JZ    *+10                                                             
         MVC   TX01PEHF,=C'PE'                                                  
         TM    TACISTAT,TACIHSEL   ELECTRONIC ONLY?                             
         JZ    *+10                                                             
         MVC   TX01PEHF,=C'EL'                                                  
         TM    TACISTAT,TACIHSPO   PAPER ONLY?                                  
         JZ    *+10                                                             
         MVC   TX01PEHF,=C'PO'                                                  
         J     TOXCL20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAADD,R5                                                         
TOXCL50  LA    RF,TAADADD                                                       
         MVC   TX01ADR1,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,1          N'LINES                                      
         JE    TOXCL20                                                          
         MVC   TX01ADR2,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,2                                                       
         JE    TOXCL20                                                          
         MVC   TX01ADR3,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,3                                                       
         JE    TOXCL20                                                          
         MVC   TX01ADR4,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         J     TOXCL20                                                          
*                                                                               
         USING TARAD,R5                                                         
TOXCL60  MVC   TX01SA,TARAASIG     SIGNATORY AGENCY                             
         J     TOXCL20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXCL80  CLI   TACMTYPE,TACMTYPI   EMAIL?                                       
         JNE   TOXCL20                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX01EMAL(0),TACMCOMM                                             
         J     TOXCL20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXCL90  CLI   TANUTYPE,TANUTSIG   SIGNATORY?                                   
         JNE   TOXCL20                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX01SA(0),TANUMBER                                               
         J     TOXCL20                                                          
*                                                                               
         USING TAFND,R5                                                         
TOXCL100 CLI   TAFNTYPE,TAFNTATT   ATTENTION NAME?                              
         JNE   TOXCL20                                                          
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX01ATTN(0),TAFNNAME                                             
         J     TOXCL20                                                          
*                                                                               
         USING TABRD,R5                                                         
TOXCL110 TM    TABRSTAT,TABRSACP   SKIP ADDITIONAL BILLING RATES                
         BNZ   TOXCL20                                                          
                                                                                
         CLI   TABRTYPE,X'C0'      IS BILLING TYPE ALPHABETIC?                  
         BNH   *+14                                                             
         MVC   TX01BTYP,TABRTYPE                                                
         B     TOXCL120                                                         
         EDIT  TABRTYPE,TX01BTYP,ALIGN=LEFT   BILLING TYPE                      
                                                                                
TOXCL120 CLI   TABRTYPE,TABRTY99   IF TYPE 99, NO RATES                         
         BE    TOXCL123                                                         
         TM    TABRSTAT,TABRSSRC   OR IF STANDARD RATE CARD,                    
         BO    TOXCL123            NO RATES                                     
                                                                                
         OC    TABRRATE,TABRRATE   DO WE HAVE RATES?                            
         BZ    TOXCL123                                                         
                                                                                
         EDIT  TABRFUTA,TX01FUTA,2,ALIGN=LEFT,ZERO=NOBLANK  FUTA                
         EDIT  TABRSUTA,TX01SUTA,2,ALIGN=LEFT,ZERO=NOBLANK  SUTA                
         EDIT  TABRFICA,TX01FICA,2,ALIGN=LEFT,ZERO=NOBLANK  FICA                
         EDIT  TABROVER,TX01OFIC,2,ALIGN=LEFT,ZERO=NOBLANK  OVER FICA           
         EDIT  TABRWCRP,TX01WCCR,2,ALIGN=LEFT,ZERO=NOBLANK  WC CORP             
         EDIT  TABRCORP,TX01HANC,2,ALIGN=LEFT,ZERO=NOBLANK  CORP HAND           
         EDIT  TABRHAND,TX01HANI,2,ALIGN=LEFT,ZERO=NOBLANK  IND HAND            
         EDIT  TABRCAN,TX01HNCN,2,ALIGN=LEFT,ZERO=NOBLANK   CAN HAND            
                                                                                
TOXCL123 CLI   TABRHRLS,X'FF'                                                   
         BNE   TOXCL125                                                         
         MVI   TX01AGRT,C'N'                                                    
         B     TOXCL130                                                         
TOXCL125 EDIT  TABRHRLS,TX01AGRT,2,ALIGN=LEFT,ZERO=BLANK   APP GRT RULE         
                                                                                
TOXCL130 MVC   TX01EMPR,TABROEOR   OVERRIDE EMPLOYER                            
                                                                                
         J     TOXCL20                                                          
         DROP  R5                                                               
*                                                                               
TOXCLIXX J     EXIT                                                             
         DROP  R2,R3,R4                                                         
*                                                                               
TOXCLILT DC    A(LITERAL)                                                       
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXPRDC - EXTRACT PRODUCT RECORDS - 5002                            *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRODUCT RECORD)                                               *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
                                                                                
TOXPRDC  NMOD1 WORKX-WORKD,*TOXPRD*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXPRDLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLPRD,R3            R3=A(PRODUCT RECORD)                         
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         SR    R0,R0               INITIALIZE TOXRECD TO SPACES                 
         SR    R1,R1                                                            
         ICM   R1,8,SPACES                                                      
         LR    RE,R2                                                            
         AHI   RE,TOXREHDL                                                      
         LA    RF,TX02LEN                                                       
         SHI   RF,TOXREHDL                                                      
         MVCL  RE,R0                                                            
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX02LEN)                                          
         MVC   TOXRETYP,TOXPRDQ                                                 
*                                                                               
         MVI   TX02AGY-1,MXTRTQ                                                 
         MVI   TX02CLI-1,MXTRTQ                                                 
         MVI   TX02PRD-1,MXTRTQ                                                 
         MVI   TX02NAME-1,MXTRTQ                                                
         MVI   TX02LOCK-1,MXTRTQ                                                
         MVI   TX02SN-1,MXTRTQ                                                  
         MVI   TX02BRND-1,MXTRTQ                                                
         MVI   TX02ADR1-1,MXTRTQ                                                
         MVI   TX02ADR2-1,MXTRTQ                                                
         MVI   TX02ADR3-1,MXTRTQ                                                
         MVI   TX02ADR4-1,MXTRTQ                                                
         MVI   TX02ATTN-1,MXTRTQ                                                
         MVI   TX02EMAL-1,MXTRTQ                                                
         MVI   TX02MC-1,MXTRTQ                                                  
         MVI   TX02PGPK-1,MXTRTQ                                                
         MVI   TX02CC-1,MXTRTQ                                                  
         MVI   TX02PTPK-1,MXTRTQ                                                
         MVI   TX02ACR-1,MXTRTQ                                                 
         MVI   TX02CSF-1,MXTRTQ                                                 
         MVI   TX02NCSF-1,MXTRTQ                                                
         MVI   TX02X,MXTRTQ                                                     
         MVI   TX02X+1,MXTRTQ                                                   
*                                                                               
         MVI   TX02LOCK,C'N'                                                    
         MVC   TX02AGY,TLPRAGY     AGENCY                                       
         MVC   TX02CLI,TLPRCLI     CLIENT                                       
         MVC   TX02PRD,TLPRPRD     PRODUCT                                      
         MVI   TX02BRND,C'N'                                                    
         TM    TLPRSTAT,TLPRSBRD                                                
         JZ    *+8                                                              
         MVI   TX02BRND,C'Y'                                                    
*                                                                               
         LA    R5,TLPRELEM         R5=A(FIRST ELEMENT)                          
TOXPR10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPRDXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXPR30                                                          
         CLI   0(R5),TAPIELQ       PRODUCT INFO ELEMENT X'2D'                   
         JE    TOXPR40                                                          
         CLI   0(R5),TAFNELQ                                                    
         JE    TOXPR50                                                          
         CLI   0(R5),TACMELQ                                                    
         JE    TOXPR60                                                          
         CLI   0(R5),TAADELQ                                                    
         JE    TOXPR70                                                          
         CLI   0(R5),TASNELQ                                                    
         JE    TOXPR80                                                          
         CLI   0(R5),TANUELQ                                                    
         JE    TOXPR90                                                          
         CLI   0(R5),TANUELQ                                                    
         JE    TOXPR100                                                         
*                                                                               
TOXPR20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPR10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXPR30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,3                                                             
         JM    TOXPRDXX                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX02NAME(0),TANANAME                                             
         J     TOXPR20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAPID,R5                                                         
TOXPR40  MVI   TX02LOCK,C'N'                                                    
         TM    TAPISTAT,TAPISLCK   LOCKED?                                      
         JZ    *+8                                                              
         MVI   TX02LOCK,C'Y'                                                    
*                                                                               
         MVI   TX02CSF,C'N'                                                     
         TM    TAPISTAT,TAPIJPCY   CSF?                                         
         JZ    *+8                                                              
         MVI   TX02CSF,C'Y'                                                     
*                                                                               
         MVI   TX02NCSF,C'N'                                                    
         TM    TAPISTAT,TAPIJPCN   NO CSF?                                      
         JZ    *+8                                                              
         MVI   TX02NCSF,C'Y'                                                    
*                                                                               
         MVC   TX02PGPK(6),TX02AGY                                              
         MVC   TX02PGPK+6(6),TX02CLI                                            
         MVC   TX02PGPK+12(6),TAPIPRG PRODUCT GROUP                             
*                                                                               
         CLI   TAPILEN,TAPILNQ2                                                 
         JL    TOXPR20                                                          
         MVC   TX02PTPK(6),TX02AGY                                              
         MVC   TX02PTPK+6(6),TAPIPTYP PRODUCT TYPE                              
*                                                                               
         J     TOXPR20                                                          
*                                                                               
         USING TAFND,R5                                                         
TOXPR50  CLI   TAFNTYPE,TAFNTATT   ATTENTION NAME?                              
         JNE   TOXPR20                                                          
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX02ATTN(0),TAFNNAME                                             
         J     TOXPR20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXPR60  CLI   TACMTYPE,TACMTYPI   EMAIL?                                       
         JNE   TOXPR20                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX02EMAL(0),TACMCOMM                                             
         J     TOXPR20                                                          
*                                                                               
         USING TAADD,R5                                                         
TOXPR70  LA    RF,TAADADD                                                       
         MVC   TX02ADR1,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,1          N'LINES                                      
         JE    TOXPR20                                                          
         MVC   TX02ADR2,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,2                                                       
         JE    TOXPR20                                                          
         MVC   TX02ADR3,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,3                                                       
         JE    TOXPR20                                                          
         MVC   TX02ADR4,0(RF)                                                   
         AHI   RF,L'TAADADD                                                     
         J     TOXPR20                                                          
*                                                                               
         USING TASND,R5                                                         
TOXPR80  MVC   TX02SN,TASNAME      SHORT NAME                                   
         J     TOXPR20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXPR90  CLI   TANUTYPE,TANUTMAT   MATERIAL CODE?                               
         JE    TOXPR92                                                          
         CLI   TANUTYPE,TANUTCTR   COST CENTER?                                 
         JE    TOXPR94                                                          
         J     TOXPR20                                                          
*                                                                               
TOXPR92  ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX02MC(0),TANUMBER                                               
         J     TOXPR20                                                          
                                                                                
TOXPR94  ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX02CC(0),TANUMBER                                               
         J     TOXPR20                                                          
*                                                                               
         USING TARAD,R5                                                         
TOXPR100 EDIT  TARAAACO,TX02ACR,2,ALIGN=RIGHT,ZERO=BLANK                        
         J     TOXPR20                                                          
*                                                                               
TOXPRDXX DS    0H                                                               
         J     EXIT                                                             
         DROP  R2,R3,R4                                                         
*                                                                               
TOXPRDLT DC    A(LITERAL)                                                       
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXASSC - EXTRACT ASSET RECORDS - 5003                              *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ASSET RECORD)                                                 *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXASSC  NMOD1 WORKX-WORKD,*TOXASS*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXASSLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCOD,R3            R3=A(ASSET RECORD)                           
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXASBLD            BUILD ASSET AND SUBSET RECS                  
         JH    TOXASNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXASSCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXASSLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXASNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX04LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX04LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXASBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXASSR          BUILD ASSET RECORD                           
         BAS   RE,TOXASSVR         BUILD ASSET 1ST VERSION RECORD               
         BAS   RE,TOXASSTV         BUILD ASSET TRACK VERSION 1 RECORD           
         BAS   RE,TOXTRKR          BUILD TRACK RECORD                           
         BAS   RE,TOXPCPR          BUILD PRINT COMMERCIAL PRODUCT               
         BAS   RE,TOXPVERR         BUILD PREVIOUS VERSION ID                    
         BAS   RE,TOXNMA           BUILD NEW MEDIA AASET RECORD                 
         BAS   RE,TOXVPM           BUILD NEW VERSION PUBLISHED MUSIC            
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXASSR -  - EXTRACT ASSET RECORDS 5003                             *         
***********************************************************************         
                                                                                
TOXASSR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK03CNT,=P'1'                                                    
         DROP  RE                                                               
         USING WORKD,RC                                                         
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX03LEN)                                          
         MVC   TOXRETYP,TOXASSQ                                                 
*                                                                               
         MVI   TX03ASS-1,MXTRTQ                                                 
         MVI   TX03AGY-1,MXTRTQ                                                 
         MVI   TX03CLI-1,MXTRTQ                                                 
         MVI   TX03PRD-1,MXTRTQ                                                 
         MVI   TX03FFCD-1,MXTRTQ                                                
         MVI   TX03EXPD-1,MXTRTQ                                                
         MVI   TX03MED-1,MXTRTQ                                                 
         MVI   TX03REL-1,MXTRTQ                                                 
         MVI   TX03AUSE-1,MXTRTQ                                                
         MVI   TX03RUSE-1,MXTRTQ                                                
         MVI   TX03SFAD-1,MXTRTQ                                                
         MVI   TX03GHF-1,MXTRTQ                                                 
         MVI   TX03LOCK-1,MXTRTQ                                                
         MVI   TX03CRAT-1,MXTRTQ                                                
         MVI   TX03ACT-1,MXTRTQ                                                 
         MVI   TX03SDAT-1,MXTRTQ                                                
         MVI   TX03SSTU-1,MXTRTQ                                                
         MVI   TX03SCIT-1,MXTRTQ                                                
         MVI   TX03PRDN-1,MXTRTQ                                                
         MVI   TX03VDTE-1,MXTRTQ                                                
         MVI   TX03VTIM-1,MXTRTQ                                                
         MVI   TX03LFID-1,MXTRTQ                                                
         MVI   TX03LFLN-1,MXTRTQ                                                
         MVI   TX03AEXP-1,MXTRTQ                                                
         MVI   TX03CPPK-1,MXTRTQ                                                
         MVI   TX03SPCY-1,MXTRTQ                                                
         MVI   TX03BLTO-1,MXTRTQ                                                
         MVI   TX03CNTY-1,MXTRTQ                                                
         MVI   TX03PPID-1,MXTRTQ                                                
         MVI   TX03PNAM-1,MXTRTQ                                                
         MVI   TX03SFAG-1,MXTRTQ                                                
         MVI   TX03SFNM-1,MXTRTQ                                                
         MVI   TX03FILT-1,MXTRTQ                                                
         MVI   TX03WDOC-1,MXTRTQ                                                
         MVI   TX03SRES-1,MXTRTQ                                                
         MVI   TX03X,MXTRTQ                                                     
         MVI   TX03X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX03ASS,L'TLCOCOM,0   ASSET PR KEY          
*--------->>                                                                    
         CLC   =X'00075BE8',TLCOCOM                                             
         JNE   *+8                                                              
         J     *+4                                                              
         CLC   =X'00070D6A',TLCOCOM                                             
         JNE   *+8                                                              
         J     *+4                                                              
*--------->>                                                                    
         MVC   TX03AGY,TLCOAGY     AGENCY                                       
         MVC   TX03CLI,TLCOCLI     CLIENT                                       
         MVC   TX03PRD,TLCOPRD     PRODUCT                                      
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXASSCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXASS10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXASSXX                                                         
         CLI   0(R5),TACOELQ       CAST DETAIL ELEMENT (X'74')                  
         JE    TOXASS30                                                         
         CLI   0(R5),TACSELQ       COMMERCIAL STUDIO ELEMENT (X'73')            
         JE    TOXASS60                                                         
         CLI   0(R5),TAFNELQ       TAFN PRODUCT NAME  X'26'                     
         JE    TOXASS70                                                         
         CLI   0(R5),TALFELQ       LIFT DETAILS ELEMENT (X'71')                 
         JE    TOXASS75                                                         
         CLI   0(R5),TANUELQ       FREEFORM NUMBER ELEM (X'25')                 
         JE    TOXASS80                                                         
         CLI   0(R5),TAFLELQ       FILTERS ELEMENT (X'30')                      
         JE    TOXASS90                                                         
*                                                                               
TOXASS20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXASS10                                                         
*                                                                               
         USING TACOD,R5                                                         
TOXASS30 GOTO1 DATCON,DMCB,(X'01',TACOFCYC),(10,TX03FFCD) FIRST FIX CYC         
         OC    TACOEXP,TACOEXP                                                  
         JZ    TOXASS32                                                         
         GOTO1 DATCON,DMCB,(X'01',TACOEXP),(10,TX03EXPD)  EXPIRATION            
TOXASS32 MVC   TX03MED,TACOMED     MEDIA                                        
         MVI   TX03REL,C'N'                                                     
         TM    TACOSTAT,TACOSTRL                                                
         JZ    *+8                                                              
         MVI   TX03REL,C'Y'        RELEASED?                                    
*                                                                               
         MVI   TX03LOCK,C'N'                                                    
         TM    TACOSTAT,TACOSTLO   LOCKED?                                      
         JZ    *+8                                                              
         MVI   TX03LOCK,C'Y'                                                    
*                                                                               
         MVI   TX03CRAT,C'N'                                                    
         TM    TACOSTAT,TACOSCRT   CANDIAN RATES?                               
         JZ    *+8                                                              
         MVI   TX03CRAT,C'Y'                                                    
*                                                                               
         ZIC   R1,TACOCTYP         ACTRA TYPE                                   
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TX03ACT,DUB                                                      
*                                                                               
         OC    TACOSAIR,TACOSAIR                                                
         JZ    TOXASS34                                                         
         GOTO1 DATCON,DMCB,(X'01',TACOSAIR),(10,TX03SFAD)  EXPIRATION           
*                                                                               
TOXASS34 OC    TACOVDTE,TACOVDTE                                                
         JZ    TOXASS36                                                         
         GOTO1 DATCON,DMCB,(X'01',TACOVDTE),(10,TX03VDTE)  VER DATE             
*                                                                               
         OC    TACOVTIM,TACOVTIM                                                
         JZ    TOXASS36                                                         
         GOTOR TIMECON,DMCB,TACOVTIM,TACOVDTE,(8,TX03VTIM) VER TIME             
*                                                                               
TOXASS36 MVC   TX03AUSE,=C'000'                                                 
         MVC   TX03RUSE,=C'000'                                                 
         MVI   TX03GHF,C'N'                                                     
*                                                                               
         CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXASS38                                                         
*                                                                               
         TM    TACOSTA3,TACOSNHF   GENERATE HOLDING FEES?                       
         JO    *+8                                                              
         MVI   TX03GHF,C'Y'                                                     
*                                                                               
         ZIC   R1,TACOAUSE         ALLOWABLE USES                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX03AUSE,DUB                                                     
*                                                                               
         ZIC   R1,TACORUSE         REMAINING USES                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX03RUSE,DUB                                                     
*                                                                               
TOXASS38 MVC   TX03ADST,TACOADST   ADDENDUM STATE                               
*                                                                               
         CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXASS40                                                         
         OC    TACOAEXP,TACOAEXP                                                
         JZ    TOXASS40                                                         
         GOTO1 DATCON,DMCB,(1,TACOAEXP),(10,TX03AEXP)                           
*                                                                               
TOXASS40 CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXASS42                                                         
         OC    TACOCGRP,TACOCGRP                                                
         JZ    TOXASS42                                                         
         MVC   TX03CPPK,TACOCGRP                                                
*                                                                               
TOXASS42 MVC   TX03SPCY,TACOSPCY                                                
         CLI   TX03SPCY,C' '                                                    
         JH    *+8                                                              
         MVI   TX03SPCY,C'N'                                                    
*                                                                               
         OC    TACOATT,TACOATT                                                  
         JZ    TOXASS44                                                         
         LA    RE,TX03BLTO                                                      
         MVC   0(L'TLCOAGY,RE),TLCOAGY                                          
         LA    RE,L'TLCOAGY(RE)                                                 
         MVC   0(L'TACOATT,RE),TACOATT                                          
*                                                                               
TOXASS44 MVC   TX03CNTY,TACOCONT                                                
*                                                                               
         MVI   TX03WDOC,C'N'                                                    
         TM    TACOSTAT,TACOSWDT   WORK DATE ON CHECKS?                         
         JZ    *+8                                                              
         MVI   TX03WDOC,C'Y'                                                    
                                                                                
         MVI   TX03SRES,C'N'                                                    
         TM    TACOSTAT,TACOSRES   SOAP RESIDUALS?                              
         JZ    *+8                                                              
         MVI   TX03SRES,C'Y'                                                    
         J     TOXASS20                                                         
*                                                                               
         USING TACSD,R5                                                         
TOXASS60 CLI   TACSTYPE,TACSTYPS   SHOOT?                                       
         JNE   TOXASS20                                                         
         OC    TACSDATE,TACSDATE                                                
         JZ    TOXASS62                                                         
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX03SDAT) SHOOT DATE            
TOXASS62 MVC   TX03SSTU,TACSSTUD   SHOOT STUDIO                                 
         MVC   TX03SCIT,TACSCITY   SHOOT CITY                                   
         J     TOXASS20                                                         
         DROP  R5                                                               
*                                                                               
         USING TAFND,R5                                                         
TOXASS70 CLI   TAFNTYPE,TAFNTPRD   PRODUCT NAME?                                
         JE    TOXASS71                                                         
         CLI   TAFNTYPE,TAFNTPHO                                                
         JE    TOXASS72                                                         
         CLI   TAFNTYPE,TAFNTSVC                                                
         JE    TOXASS73                                                         
         J     TOXASS20                                                         
*                                                                               
TOXASS71 OC    TLCOPRD,TLCOPRD                                                  
         BNZ   TOXASS20                                                         
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         CHI   R1,L'TX03PRDN                                                    
         BNH   *+12                                                             
         LA    R1,L'TX03PRDN                                                    
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX03PRDN(0),TAFNNAME PRODUCT NAME                                
         J     TOXASS20                                                         
*                                                                               
*                                                                               
TOXASS72 LLC   RE,1(R5)                                                         
         AHI   RE,-(TAFNLNQ+1)                                                  
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX03PNAM(0),TAFNNAME   PHOTOGRAPHER NAME                         
         J     TOXASS20                                                         
*                                                                               
TOXASS73 LLC   RE,1(R5)                                                         
         AHI   RE,-(TAFNLNQ+1)                                                  
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX03SFNM(0),TAFNNAME   SERVICES FOR AGY                          
         J     TOXASS20                                                         
*                                                                               
         USING TALFD,R5                                                         
TOXASS75 MVC   TX03LFID,TALFLID                                                 
         LLC   R0,TALFSEC          LIFT LEN IN SEC                              
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TX03LFLN,DUB                                                     
         J     TOXASS20                                                         
         DROP  R5                                                               
*                                                                               
         USING TANUEL,R5                                                        
TOXASS80 CLI   TANUTYPE,TANUTPHO                                                
         JE    TOXASS81                                                         
         CLI   TANUTYPE,TANUTSVC                                                
         JE    TOXASS82                                                         
         J     TOXASS20                                                         
*                                                                               
TOXASS81 GOTOR SSN2PID,DMCB,TANUMBER,DUB                                        
         MVC   TX03PPID,DUB         PHOTOGRAPHER SSN                            
         J     TOXASS20                                                         
*                                                                               
TOXASS82 LLC   RE,1(R5)                                                         
         AHI   RE,-(TANULNQ+1)                                                  
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX03SFAG(0),TANUMBER                                             
         J     TOXASS20                                                         
*                                                                               
         USING TAFLD,R5                                                         
TOXASS90 MVC   TX03FILT,SPACES                                                  
         MVC   TX03FILT(4),TAFLFLT1                                             
         J     TOXASS20                                                         
*                                                                               
TOXASSXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXASSVR - - EXTRACT VERSION RECORDS 5004                           *         
***********************************************************************         
                                                                                
TOXASSVR NTR1                                                                   
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX04LEN)                                          
         MVC   TOXRETYP,TOXVERQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX04ASS-1,MXTRTQ                                                 
         MVI   TX04VERN-1,MXTRTQ                                                
         MVI   TX04VERI-1,MXTRTQ                                                
         MVI   TX04TIT-1,MXTRTQ                                                 
         MVI   TX04TYPE-1,MXTRTQ                                                
         MVI   TX04FAD-1,MXTRTQ                                                 
         MVI   TX04LN-1,MXTRTQ                                                  
         MVI   TX04FD-1,MXTRTQ                                                  
         MVI   TX04FSTU-1,MXTRTQ                                                
         MVI   TX04FC-1,MXTRTQ                                                  
         MVI   TX04FSTA-1,MXTRTQ                                                
         MVI   TX04RD-1,MXTRTQ                                                  
         MVI   TX04RSTU-1,MXTRTQ                                                
         MVI   TX04RC-1,MXTRTQ                                                  
         MVI   TX04RSTA-1,MXTRTQ                                                
         MVI   TX04MD-1,MXTRTQ                                                  
         MVI   TX04MSTU-1,MXTRTQ                                                
         MVI   TX04MC-1,MXTRTQ                                                  
         MVI   TX04MSTA-1,MXTRTQ                                                
         MVI   TX04CMNT-1,MXTRTQ                                                
         MVI   TX04DUBD-1,MXTRTQ                                                
         MVI   TX04TITL-1,MXTRTQ                                                
         MVI   TX04X,MXTRTQ                                                     
         MVI   TX04X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX04ASS,L'TLCOCOM,0   ASSET PR KEY          
         MVI   BYTE,X'01'                                                       
         ZIC   R1,BYTE             VERSION NUMBER                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX04VERN,DUB                                                     
*                                                                               
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXASV10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXASVXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT (X'20')                         
         JE    TOXASV30                                                         
         CLI   0(R5),TACSELQ       COMMERCIAL STUDIO ELEMENT (X'73')            
         JE    TOXASV40                                                         
         CLI   0(R5),TACOELQ       CAST DETAIL ELEMENT (X'74')                  
         JE    TOXASV50                                                         
         CLI   0(R5),TACMELQ       COMMENT ELEMENT (X'8D')                      
         JE    TOXASV60                                                         
         CLI   0(R5),TAFNELQ       MUSIC TITLE FREE FORM (X'26')                
         JE    TOXASV70                                                         
*                                                                               
TOXASV20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXASV10                                                         
*                                                                               
         USING TANAD,R5                                                         
TOXASV30 ZIC   R1,TANALEN                                                       
         SHI   R1,3                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX04TIT(0),TANANAME TITLE                                        
         J     TOXASV20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACSD,R5                                                         
TOXASV40 CLI   TACSTYPE,TACSTYPM   MUSIC?                                       
         JE    TOXASV42                                                         
         CLI   TACSTYPE,TACSTYPR   RECORD?                                      
         JE    TOXASV44                                                         
         CLI   TACSTYPE,TACSTYPF   FILM?                                        
         JNE   TOXASV20                                                         
*                                                                               
         MVC   TX04FSTU,TACSSTUD   STUDIO                                       
         MVC   TX04FC,TACSCITY     CITY                                         
         CLI   TACSLEN,TACSLNQ                                                  
         JL    *+10                                                             
         MVC   TX04FSTA,TACSSTAT   STATE                                        
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX04FD)   DATE                  
         J     TOXASV20                                                         
*                                                                               
TOXASV42 MVC   TX04MSTU,TACSSTUD   STUDIO                                       
         MVC   TX04MC,TACSCITY     CITY                                         
         CLI   TACSLEN,TACSLNQ                                                  
         JL    *+10                                                             
         MVC   TX04MSTA,TACSSTAT   STATE                                        
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX04MD)   DATE                  
         J     TOXASV20                                                         
*                                                                               
TOXASV44 MVC   TX04RSTU,TACSSTUD   STUDIO                                       
         MVC   TX04RC,TACSCITY     CITY                                         
         CLI   TACSLEN,TACSLNQ                                                  
         JL    *+10                                                             
         MVC   TX04RSTA,TACSSTAT   STATE                                        
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX04RD)   DATE                  
         J     TOXASV20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACOD,R5                                                         
TOXASV50 MVC   TX04VERI,TACOCID    VERSION ID                                   
         MVC   TX04TYPE,TACOTYPE   TYPE                                         
         GOTO1 DATCON,DMCB,(X'01',TACODUB),(10,TX04DUBD)  DUB DATE              
         GOTO1 DATCON,DMCB,(X'01',TACOAIR),(10,TX04FAD)   AIR DATE              
         ZIC   R1,TACOSEC          LENGTH                                       
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX04LN,DUB                                                       
*                                                                               
         CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXASV52                                                         
         OC    TACOEDYR,TACOEDYR                                                
         JZ    TOXASV52                                                         
         XC    FULL,FULL                                                        
         MVC   FULL(1),TACOEDYR                                                 
         XI    FULL,X'FF'                                                       
         MVC   FULL+1(2),=X'0101'                                               
         GOTO1 DATCON,DMCB,(1,FULL),(20,DUB)  GET YYYY                          
         MVC   TX04EDYR,DUB                                                     
*                                                                               
TOXASV52 CLI   TACOLEN,TACOLNQ2                                                 
         JL    *+10                                                             
         MVC   TX04EDT,TACOEDT                                                  
*                                                                               
         CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXASV54                                                         
         OC    TACOACT,TACOACT                                                  
         JZ    TOXASV54                                                         
         GOTO1 DATCON,DMCB,(1,TACOACT),(10,TX04ACT)                             
*                                                                               
TOXASV54 CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXASV56                                                         
         OC    TACOINAC,TACOINAC                                                
         JZ    TOXASV56                                                         
         GOTO1 DATCON,DMCB,(1,TACOINAC),(10,TX04INAC)                           
*                                                                               
TOXASV56 J     TOXASV20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACMD,R5                                                         
TOXASV60 CLI   TACMTYPE,TACMTYPG    GENERAL COMMENT?                            
         BNE   TOXASV20                                                         
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX04CMNT(0),TACMCOMM                                             
         J     TOXASV20                                                         
         DROP  R5                                                               
*                                                                               
         USING TAFND,R5                                                         
TOXASV70 CLI   TAFNTYPE,TAFNTMUS   MUSIC?                                       
         JNE   TOXASV20                                                         
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX04TITL(0),TAFNNAME TITLE                                       
         J     TOXASV20                                                         
*                                                                               
TOXASVXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXASSTV -   TRACK VERSION 5013                                     *         
***********************************************************************         
                                                                                
TOXASSTV NTR1                                                                   
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXATV10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXATVX                                                          
         CLI   0(R5),TATRELQ       MUSIC CONTRACT/TRACK ELEMENT (X'45')         
         JE    TOXATV30                                                         
*                                                                               
TOXATV20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXATV10                                                         
*                                                                               
         USING TATRD,R5                                                         
         USING PKCNTS,RE                                                        
TOXATV30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK13CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX13LEN)                                          
         MVC   TOXRETYP,TOXTVERQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX13TASS-1,MXTRTQ                                                
         MVI   TX13TRK-1,MXTRTQ                                                 
         MVI   TX13VASS-1,MXTRTQ                                                
         MVI   TX13VERN-1,MXTRTQ                                                
         MVI   TX13X,MXTRTQ                                                     
         MVI   TX13X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TATRCOM,TX13TASS,L'TATRCOM,0                        
         MVC   TX13TRK,TATRTRK     TRACK                                        
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX13VASS,L'TLCOCOM,0  ASSET PR KEY          
         MVC   TX13VERN,=C'001'    VERSION NUMBER                               
         J     TOXATV20                                                         
         DROP  R5                                                               
*                                                                               
TOXATVX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXTRKR -  - TRACK 5011                                             *         
***********************************************************************         
                                                                                
TOXTRKR  NTR1                                                                   
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXTRK10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTRKRX                                                         
         CLI   0(R5),TAMCELQ       APPLIED CREDIT HISTORY (X'68')               
         JE    TOXTRK30                                                         
*                                                                               
TOXTRK20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTRK10                                                         
*                                                                               
         USING TAMCD,R5                                                         
TOXTRK30 OC    TAMCCON,TAMCCON                                                  
         JNZ   TOXTRK20                                                         
         CLI   TAMCTRK,0                                                        
         JZ    TOXTRK20                                                         
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK11CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX11LEN)                                          
         MVC   TOXRETYP,TOXTRKQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX11ASS-1,MXTRTQ                                                 
         MVI   TX11TRK-1,MXTRTQ                                                 
         MVI   TX11TIT-1,MXTRTQ                                                 
         MVI   TX11LN-1,MXTRTQ                                                  
         MVI   TX11X,MXTRTQ                                                     
         MVI   TX11X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX11ASS,L'TLCOCOM,0   ASSET PR KEY          
         MVC   TX11TRK,TAMCTRK     TRACK                                        
*                                                                               
         OC    TAMCLLEN,TAMCLLEN                                                
         JZ    TOXTRK32                                                         
         SR    R1,R1                                                            
         ICM   R1,3,TAMCLLEN       LENGTH                                       
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX11LN,DUB                                                       
*                                                                               
TOXTRK32 CLI   TAMCLEN,TAMCLNQ                                                  
         JNH   TOXTRK20                                                         
         ZIC   R1,TAMCLEN                                                       
         SHI   R1,TAMCLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX11TIT(0),TAMCTRKT TITLE                                        
         J     TOXTRK20                                                         
         DROP  R5                                                               
*                                                                               
TOXTRKRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
TOXNMA   NTR1                                                                   
                                                                                
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXNMA10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXNMAX                                                          
         CLI   0(R5),TAMDELQ       MEDIA ELEMENT (X'D9')                        
         JE    TOXNMA30                                                         
*                                                                               
TOXNMA20 LLC   RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXNMA10                                                         
*                                                                               
         USING TAMDD,R5                                                         
         USING PKCNTS,RE                                                        
TOXNMA30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK75CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX75LEN)                                          
         MVC   TOXRETYP,TOX5075Q                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX75ASPK-1,MXTRTQ                                                
         MVI   TX75IAPK-1,MXTRTQ                                                
         MVI   TX75X,MXTRTQ                                                     
         MVI   TX75X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX75ASPK,L'TLCOCOM,0                        
*                                                                               
         MVC   TX75IAPK,TAMDTYPE                                                
         OI    TX75IAPK,X'F0'      MAKE IT EBCDIC                               
         MVC   TX75IAPK+1(4),TAMDCODE                                           
         J     TOXNMA20                                                         
*                                                                               
         DROP  R5                                                               
*                                                                               
TOXNMAX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*======================================================================         
* BUILD NEW VERSION PUBLISHED MUSIC RECORD (5080)                               
*======================================================================         
                                                                                
TOXVPM   NTR1                                                                   
*                                                                               
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXVPM10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXVPMX                                                          
         CLI   0(R5),TACPELQ                                                    
         JE    TOXVPM30                                                         
*                                                                               
TOXVPM20 LLC   RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXVPM10                                                         
*                                                                               
         USING TACPD,R5                                                         
         USING PKCNTS,RE                                                        
TOXVPM30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK80CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX80LEN)                                          
         MVC   TOXRETYP,TOX5080Q                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX80APK-1,MXTRTQ                                                 
         MVI   TX80VER-1,MXTRTQ                                                 
         MVI   TX80MUCD-1,MXTRTQ                                                
         MVI   TX80X,MXTRTQ                                                     
         MVI   TX80X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX80APK,L'TLCOCOM,0                         
*                                                                               
         MVC   TX80VER,=C'001'                                                  
         MVC   TX80MUCD,TACPMUS                                                 
         J     TOXVPM20                                                         
*                                                                               
         DROP  R5                                                               
*                                                                               
TOXVPMX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXPCPR -  - PRINT COMMERCIAL PRODUCT 5026                          *         
***********************************************************************         
                                                                                
TOXPCPR  NTR1                                                                   
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXPCP10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPCPRX                                                         
         CLI   0(R5),TAPRELQ       PRODUCT ELEMENT (X'38')                      
         JE    TOXPCP30                                                         
*                                                                               
TOXPCP20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPCP10                                                         
*                                                                               
         USING TAPRD,R5                                                         
         USING PKCNTS,RE                                                        
TOXPCP30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK26CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX26LEN)                                          
         MVC   TOXRETYP,TOXPCPQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX26ASS-1,MXTRTQ                                                 
         MVI   TX26CODE-1,MXTRTQ                                                
         MVI   TX26X,MXTRTQ                                                     
         MVI   TX26X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX26ASS,L'TLCOCOM,0   ASSET PR KEY          
         MVC   TX26CODE,TAPRPRD    PRODUCT                                      
         J     TOXPCP20                                                         
         DROP  R5                                                               
*                                                                               
TOXPCPRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXPVERR - - PREVIOUS VERSION ID 5047                               *         
***********************************************************************         
                                                                                
TOXPVERR NTR1  BASE=*,LABEL=*                                                   
         XC    TMPCOUNT,TMPCOUNT                                                
*                                                                               
         LA    R5,TLCOELEM         R5=A(FIRST ELEMENT)                          
TOXPV10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPVX                                                           
         CLI   0(R5),TAOCELQ       PREVIOUS VERSION ID (X'24')                  
         JE    TOXPV30                                                          
*                                                                               
TOXPV20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPV10                                                          
*                                                                               
         USING TAOCD,R5                                                         
TOXPV30  CLI   TAOCSTAT,0                                                       
         JNE   TOXPV20                                                          
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK47CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX47LEN)                                          
         MVC   TOXRETYP,TOXPVERQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX47VASS-1,MXTRTQ                                                
         MVI   TX47VERN-1,MXTRTQ                                                
         MVI   TX47SEQ-1,MXTRTQ                                                 
         MVI   TX47LAD-1,MXTRTQ                                                 
         MVI   TX47AGY-1,MXTRTQ                                                 
         MVI   TX47VERI-1,MXTRTQ                                                
         MVI   TX47X,MXTRTQ                                                     
         MVI   TX47X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCOCOM,TX47VASS,L'TLCOCOM,0  ASSET PR KEY          
         MVC   TX47VERN,=C'001'    VERSION NUMBER                               
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX47SEQ,DUB                                                      
         MVC   TX47AGY,TAOCAGY     AGENCY                                       
*                                                                               
         MVC   THREE,TAOCDTE                                                    
         XC    THREE,=X'FFFFFF'                                                 
         GOTO1 DATCON,DMCB,(X'01',THREE),(10,TX47LAD)   ACTIVITY DATE           
         MVC   TX47VERI,TAOCCID    VERSION ID                                   
         J     TOXPV20                                                          
         DROP  R5                                                               
*                                                                               
TOXPVX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
THREE    DS    XL3                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXVERC - EXTRACT VERSION RECORDS - 5004                            *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(VERSION RECORD)                                               *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXVERC  NMOD1 WORKX-WORKD,*TOXVER*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXVERLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLVRD,R3            R3=A(VERSION RECORD)                         
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXVEBLD            BUILD VERSION AND SUBSET RECS                
         JH    TOXVENXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXVERCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXVERLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXVENXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX04LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX04LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXVEBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXVERR          BUILD VERSION RECORD                         
         BAS   RE,TOXTVERR         BUILD TRACK VERSION RECORD                   
         BAS   RE,TOXTVPM          BUILD PUBLISHED MUSIC VERSION REC            
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXVERR -  - EXTRACT VERSION RECORDS 5004                           *         
***********************************************************************         
                                                                                
TOXVERR  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK04CNT,=P'1'                                                    
         DROP  RE                                                               
         USING WORKD,RC                                                         
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX04LEN)                                          
         MVC   TOXRETYP,TOXVERQ                                                 
*                                                                               
         MVI   TX04ASS-1,MXTRTQ                                                 
         MVI   TX04VERN-1,MXTRTQ                                                
         MVI   TX04VERI-1,MXTRTQ                                                
         MVI   TX04TIT-1,MXTRTQ                                                 
         MVI   TX04TYPE-1,MXTRTQ                                                
         MVI   TX04FAD-1,MXTRTQ                                                 
         MVI   TX04LN-1,MXTRTQ                                                  
         MVI   TX04FD-1,MXTRTQ                                                  
         MVI   TX04FSTU-1,MXTRTQ                                                
         MVI   TX04FC-1,MXTRTQ                                                  
         MVI   TX04FSTA-1,MXTRTQ                                                
         MVI   TX04RD-1,MXTRTQ                                                  
         MVI   TX04RSTU-1,MXTRTQ                                                
         MVI   TX04RC-1,MXTRTQ                                                  
         MVI   TX04RSTA-1,MXTRTQ                                                
         MVI   TX04MD-1,MXTRTQ                                                  
         MVI   TX04MSTU-1,MXTRTQ                                                
         MVI   TX04MC-1,MXTRTQ                                                  
         MVI   TX04MSTA-1,MXTRTQ                                                
         MVI   TX04DUBD-1,MXTRTQ                                                
         MVI   TX04TITL-1,MXTRTQ                                                
         MVI   TX04EDYR-1,MXTRTQ                                                
         MVI   TX04EDT-1,MXTRTQ                                                 
         MVI   TX04ACT-1,MXTRTQ                                                 
         MVI   TX04INAC-1,MXTRTQ                                                
         MVI   TX04X,MXTRTQ                                                     
         MVI   TX04X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLVRCOM,TX04ASS,L'TLVRCOM,0   ASSET PR KEY          
         ZIC   R1,TLVRVER          VERSION NUMBER                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX04VERN,DUB                                                     
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
***NOP   L     R2,TOXVERCC         GIVES ADDRESSABILITY ERRORS, SO              
         LARL  RE,TOXVERCC         POINT TO A(WHERE TO BUILD RECS)              
         L     R2,0(RE)                                                         
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLVRELEM         R5=A(FIRST ELEMENT)                          
TOXVER10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXVERXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT (X'20')                         
         JE    TOXVER30                                                         
         CLI   0(R5),TACSELQ       COMMERCIAL STUDIO ELEMENT (X'73')            
         JE    TOXVER40                                                         
         CLI   0(R5),TACOELQ       CAST DETAIL ELEMENT (X'74')                  
         JE    TOXVER50                                                         
         CLI   0(R5),TACMELQ       COMMENT ELEMENT (X'8D')                      
         JE    TOXVER60                                                         
         CLI   0(R5),TAFNELQ       MUSIC TITLE FREE FORM (X'26')                
         JE    TOXVER70                                                         
*                                                                               
TOXVER20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXVER10                                                         
*                                                                               
         USING TANAD,R5                                                         
TOXVER30 ZIC   R1,TANALEN                                                       
         SHI   R1,3                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX04TIT(0),TANANAME TITLE                                        
         J     TOXVER20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACSD,R5                                                         
TOXVER40 CLI   TACSTYPE,TACSTYPM   MUSIC?                                       
         JE    TOXVER42                                                         
         CLI   TACSTYPE,TACSTYPR   RECORD?                                      
         JE    TOXVER44                                                         
         CLI   TACSTYPE,TACSTYPF   FILM?                                        
         JNE   TOXVER20                                                         
*                                                                               
         MVC   TX04FSTU,TACSSTUD   STUDIO                                       
         MVC   TX04FC,TACSCITY     CITY                                         
         MVC   TX04FSTA,TACSSTAT   STATE                                        
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX04FD)   DATE                  
         J     TOXVER20                                                         
*                                                                               
TOXVER42 MVC   TX04MSTU,TACSSTUD   STUDIO                                       
         MVC   TX04MC,TACSCITY     CITY                                         
         MVC   TX04MSTA,TACSSTAT   STATE                                        
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX04MD)   DATE                  
         J     TOXVER20                                                         
*                                                                               
TOXVER44 MVC   TX04RSTU,TACSSTUD   STUDIO                                       
         MVC   TX04RC,TACSCITY     CITY                                         
         MVC   TX04RSTA,TACSSTAT   STATE                                        
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX04RD)   DATE                  
         J     TOXVER20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACOD,R5                                                         
TOXVER50 MVC   TX04VERI,TACOCID    VERSION ID                                   
         MVC   TX04TYPE,TACOTYPE   TYPE                                         
         GOTO1 DATCON,DMCB,(X'01',TACODUB),(10,TX04DUBD)  DUB DATE              
         GOTO1 DATCON,DMCB,(X'01',TACOAIR),(10,TX04FAD)   AIR DATE              
         ZIC   R1,TACOSEC          LENGTH                                       
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TX04LN,DUB                                                       
*                                                                               
         CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXVER52                                                         
         OC    TACOEDYR,TACOEDYR                                                
         JZ    TOXVER52                                                         
         XC    FULL,FULL                                                        
         MVC   FULL(1),TACOEDYR                                                 
         XI    FULL,X'FF'                                                       
         MVC   FULL+1(2),=X'0101'                                               
         GOTO1 DATCON,DMCB,(1,FULL),(20,DUB)  GET YYYY                          
         MVC   TX04EDYR,DUB                                                     
*                                                                               
TOXVER52 CLI   TACOLEN,TACOLNQ2                                                 
         JL    *+10                                                             
         MVC   TX04EDT,TACOEDT                                                  
*                                                                               
         CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXVER54                                                         
         OC    TACOACT,TACOACT                                                  
         JZ    TOXVER54                                                         
         GOTO1 DATCON,DMCB,(1,TACOACT),(10,TX04ACT)                             
*                                                                               
TOXVER54 CLI   TACOLEN,TACOLNQ2                                                 
         JL    TOXVER56                                                         
         OC    TACOINAC,TACOINAC                                                
         JZ    TOXVER56                                                         
         GOTO1 DATCON,DMCB,(1,TACOINAC),(10,TX04INAC)                           
                                                                                
TOXVER56 J     TOXVER20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACMD,R5                                                         
TOXVER60 CLI   TACMTYPE,TACMTYPG    GENERAL COMMENT?                            
         BNE   TOXVER20                                                         
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX04CMNT(0),TACMCOMM                                             
         J     TOXVER20                                                         
         DROP  R5                                                               
*                                                                               
         USING TAFND,R5                                                         
TOXVER70 CLI   TAFNTYPE,TAFNTMUS   MUSIC?                                       
         JNE   TOXVER20                                                         
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX04TITL(0),TAFNNAME TITLE                                       
         J     TOXVER20                                                         
*                                                                               
TOXVERXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXTVERR - - TRACK VERSION 5013                                     *         
***********************************************************************         
                                                                                
TOXTVERR NTR1  BASE=*,LABEL=*                                                   
         LA    R5,TLVRELEM         R5=A(FIRST ELEMENT)                          
TOXTV10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTVX                                                           
         CLI   0(R5),TATRELQ       MUSIC CONTRACT/TRACK ELEMENT (X'45')         
         JE    TOXTV30                                                          
*                                                                               
TOXTV20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTV10                                                          
*                                                                               
         USING TATRD,R5                                                         
         USING PKCNTS,RE                                                        
TOXTV30  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK13CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX13LEN)                                          
         MVC   TOXRETYP,TOXTVERQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX13TASS-1,MXTRTQ                                                
         MVI   TX13TRK-1,MXTRTQ                                                 
         MVI   TX13VASS-1,MXTRTQ                                                
         MVI   TX13VERN-1,MXTRTQ                                                
         MVI   TX13X,MXTRTQ                                                     
         MVI   TX13X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TATRCOM,TX13TASS,L'TATRCOM,0                        
         MVC   TX13TRK,TATRTRK     TRACK                                        
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLVRCOM,TX13VASS,L'TLVRCOM,0  ASSET PR KEY          
         ZIC   R1,TLVRVER          VERSION NUMBER                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX13VERN,DUB                                                     
         J     TOXTV20                                                          
         DROP  R5                                                               
*                                                                               
TOXTVX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXTVPM  - - PUBLISHED MUSIC VERSION (5080)                         *         
***********************************************************************         
                                                                                
TOXTVPM NTR1   BASE=*,LABEL=*                                                   
*                                                                               
         LA    R5,TLVRELEM         R5=A(FIRST ELEMENT)                          
*                                                                               
TOXTVP10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTVPX                                                          
         CLI   0(R5),TACPELQ       MUSIC CONTRACT/TRACK ELEMENT (X'45')         
         JE    TOXTVP30                                                         
*                                                                               
TOXTVP20 LLC   RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTVP10                                                         
*                                                                               
         USING TACPD,R5                                                         
         USING PKCNTS,RE                                                        
TOXTVP30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK80CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX04LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX80LEN)                                          
         MVC   TOXRETYP,TOX5080Q                                                
*                                                                               
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX80APK-1,MXTRTQ                                                 
         MVI   TX80VER-1,MXTRTQ                                                 
         MVI   TX80MUCD-1,MXTRTQ                                                
         MVI   TX80X,MXTRTQ                                                     
         MVI   TX80X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLVRCOM,TX80APK,L'TLVRCOM,0  ASSET PR KEY           
         LLC   R1,TLVRVER          VERSION NUMBER                               
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TX80VER,DUB                                                      
*                                                                               
         MVC   TX80MUCD,TACPMUS                                                 
         J     TOXTVP20                                                         
         DROP  R5                                                               
*                                                                               
TOXTVPX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXALIC - EXTRACT ALIAS RECORDS - 5005                              *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(ALIAS RECORD)                                                 *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
                                                                                
TOXALIC  NMOD1 WORKX-WORKD,*TOXALI*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXALILT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         MVC   APKCNTS,16(R1)                                                   
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLAKD,R3            R3=A(ALIAS RECORD)                           
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK05CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         SR    R0,R0               INITIALIZE TOXRECD TO SPACES                 
         SR    R1,R1                                                            
         ICM   R1,8,SPACES                                                      
         LR    RE,R2                                                            
         AHI   RE,TOXREHDL                                                      
         LA    RF,TX05LEN                                                       
         SHI   RF,TOXREHDL                                                      
         MVCL  RE,R0                                                            
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX05LEN)                                          
         MVC   TOXRETYP,TOXALIQ                                                 
*                                                                               
         MVI   TX05AGY-1,MXTRTQ                                                 
         MVI   TX05CLI-1,MXTRTQ                                                 
         MVI   TX05PRD-1,MXTRTQ                                                 
         MVI   TX05MED-1,MXTRTQ                                                 
         MVI   TX05ADID-1,MXTRTQ                                                
         MVI   TX05ASS-1,MXTRTQ                                                 
         MVI   TX05VERN-1,MXTRTQ                                                
         MVI   TX05X,MXTRTQ                                                     
         MVI   TX05X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX05AGY,TLAKAGY     AGENCY                                       
         MVC   TX05CLI,TLAKNCLI    SPOT/NET CLIENT                              
         MVC   TX05PRD,TLAKNPRD    SPOT/NET PRODUCT                             
         MVC   TX05MED,TLAKMED     MEDIA                                        
         MVC   TX05ADID,TLAKADID   TRAFFIC COMMERCIAL ID                        
         GOTO1 VHEXOUT,DMCB,TLAKCOM,TX05ASS,L'TLAKCOM,0   ASSET PR KEY          
*                                                                               
         MVC   TX05VERN,=C'001'    VERSION NUMBER                               
         OC    TLAKVER,TLAKVER                                                  
         JZ    TOXALIXX                                                         
         ZIC   R1,TLAKVER          VERSION NUMBER                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX05VERN,DUB                                                     
*                                                                               
TOXALIXX J     EXIT                                                             
         DROP  R2,R3,R4                                                         
*                                                                               
TOXALILT DC    A(LITERAL)                                                       
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXW4RC - EXTRACT W-R RECORDS - 5006                                *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(W4 RECORD)                                                    *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXW4RC  NMOD1 WORKX-WORKD,*TOXW4R*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXW4RLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLW4D,R3            R3=A(W4 RECORD)                              
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         CLI   8(R1),1                                                          
         JL    TOXW4KIL            BUILD K RECORD                               
         JE    TOXW4BLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXW4NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXW4RCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXW4RLT DC    A(LITERAL)                                                       
         EJECT                                                                  
***********************************************************************         
* BUILD 'K' RECORD AND EXIT                                           *         
***********************************************************************         
TOXW4KIL DS    0H                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXW4NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX06LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX06LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXW4BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXW4RR          BUILD W-4 RECORD                             
         BAS   RE,TOXW4AC          BUILD W-4 ASSOCATED CORPORATION              
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXW4RR - EXTRACT W-4 RECORDS - 5006                                *         
***********************************************************************         
                                                                                
TOXW4RR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK06CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX06LEN)                                          
         MVC   TOXRETYP,TOXW4Q                                                  
*                                                                               
         MVI   TX06PID-1,MXTRTQ                                                 
         MVI   TX06TYPE-1,MXTRTQ                                                
         MVI   TX06FNAM-1,MXTRTQ                                                
         MVI   TX06LNAM-1,MXTRTQ                                                
         MVI   TX06CNME-1,MXTRTQ                                                
         MVI   TX06AKAF-1,MXTRTQ                                                
         MVI   TX06AKAL-1,MXTRTQ                                                
         MVI   TX06PHON-1,MXTRTQ                                                
         MVI   TX06MN-1,MXTRTQ                                                  
         MVI   TX06AL1-1,MXTRTQ                                                 
         MVI   TX06AL2-1,MXTRTQ                                                 
         MVI   TX06AL3-1,MXTRTQ                                                 
         MVI   TX06CITY-1,MXTRTQ                                                
         MVI   TX06STAT-1,MXTRTQ                                                
         MVI   TX06ZIP-1,MXTRTQ                                                 
         MVI   TX06SUFF-1,MXTRTQ                                                
         MVI   TX06SEX-1,MXTRTQ                                                 
         MVI   TX06ETH-1,MXTRTQ                                                 
         MVI   TX06FILT-1,MXTRTQ                                                
         MVI   TX06ID-1,MXTRTQ                                                  
         MVI   TX06AFM-1,MXTRTQ                                                 
         MVI   TX06AMN-1,MXTRTQ                                                 
         MVI   TX06YTD-1,MXTRTQ                                                 
         MVI   TX06SCF-1,MXTRTQ                                                 
         MVI   TX06ILFW-1,MXTRTQ                                                
         MVI   TX06LCK-1,MXTRTQ                                                 
         MVI   TX06FW-1,MXTRTQ                                                  
         MVI   TX06DCW-1,MXTRTQ                                                 
         MVI   TX06PEN-1,MXTRTQ                                                 
         MVI   TX06DD-1,MXTRTQ                                                  
         MVI   TX06WTC-1,MXTRTQ                                                 
         MVI   TX06SLF-1,MXTRTQ                                                 
         MVI   TX06FTMS-1,MXTRTQ                                                
         MVI   TX06FTE-1,MXTRTQ                                                 
         MVI   TX06FTFP-1,MXTRTQ                                                
         MVI   TX06STA-1,MXTRTQ                                                 
         MVI   TX06STMS-1,MXTRTQ                                                
         MVI   TX06STE-1,MXTRTQ                                                 
         MVI   TX06STFP-1,MXTRTQ                                                
         MVI   TX06CTA-1,MXTRTQ                                                 
         MVI   TX06CTMS-1,MXTRTQ                                                
         MVI   TX06CTE-1,MXTRTQ                                                 
         MVI   TX06CTFP-1,MXTRTQ                                                
         MVI   TX06EARN-1,MXTRTQ                                                
         MVI   TX06RS-1,MXTRTQ                                                  
         MVI   TX06DOB-1,MXTRTQ                                                 
         MVI   TX06DP-1,MXTRTQ                                                  
         MVI   TX06TP-1,MXTRTQ                                                  
         MVI   TX06MFP-1,MXTRTQ                                                 
         MVI   TX06PCP-1,MXTRTQ                                                 
         MVI   TX06GST-1,MXTRTQ                                                 
         MVI   TX06CMNT-1,MXTRTQ                                                
         MVI   TX06PN-1,MXTRTQ                                                  
         MVI   TX06PAL1-1,MXTRTQ                                                
         MVI   TX06PAL2-1,MXTRTQ                                                
         MVI   TX06PAL3-1,MXTRTQ                                                
         MVI   TX06PED-1,MXTRTQ                                                 
         MVI   TX06CNTR-1,MXTRTQ                                                
         MVI   TX06EA-1,MXTRTQ                                                  
         MVI   TX06TF-1,MXTRTQ                                                  
         MVI   TX06PCTY-1,MXTRTQ                                                
         MVI   TX06PS-1,MXTRTQ                                                  
         MVI   TX06PZ-1,MXTRTQ                                                  
         MVI   TX06PC-1,MXTRTQ                                                  
         MVI   TX06PAD-1,MXTRTQ                                                 
         MVI   TX06ENHA-1,MXTRTQ                                                
         MVI   TX06NHAE-1,MXTRTQ                                                
         MVI   TX06NHAD-1,MXTRTQ                                                
         MVI   TX06EFT-1,MXTRTQ                                                 
         MVI   TX06X,MXTRTQ                                                     
         MVI   TX06X+1,MXTRTQ                                                   
*                                                                               
         CLC   TLW4SSN,=C'737372288'                                            
         BNE   *+6                                                              
         LTR   RE,RE                                                            
*                                                                               
         GOTOR SSN2PID,DMCB,TLW4SSN,DUB                                         
         MVC   TX06PID,DUB         SOCIAL SECURITY NUMBER                       
*                                                                               
         LH    RF,=Y(TX06LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXW4RCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVI   TX06YTD,C'N'                                                     
         MVI   TX06SCF,C'N'                                                     
         MVI   TX06ILFW,C'N'                                                    
         MVI   TX06LCK,C'N'                                                     
         MVI   TX06FW,C'N'                                                      
         MVI   TX06DCW,C'N'                                                     
         MVI   TX06PEN,C'N'                                                     
         MVI   TX06DD,C'N'                                                      
         MVI   TX06WTC,C'N'                                                     
         MVI   TX06SLF,C'N'                                                     
         MVC   TX06FTE,=C'000'                                                  
         MVC   TX06FTFP,=C' 0.00'                                               
         MVC   TX06STE,=C'000'                                                  
         MVC   TX06STFP,=C' 0.00'                                               
         MVC   TX06CTE,=C'000'                                                  
         MVC   TX06CTFP,=C' 0.00'                                               
         MVC   TX06EARN,=C'       0.00'                                         
         MVC   TX06DP,=C' 0.00'                                                 
         MVC   TX06MFP,=C' 0.00'                                                
         MVC   TX06PCP,=C' 0.00'                                                
         MVI   TX06TF,C'N'                                                      
         MVI   TX06NHAE,C'N'                                                    
         MVI   TX06EFT,C'N'                                                     
         MVI   TX06ENHA,C'N'                                                    
*                                                                               
         LA    R5,TLW4ELEM         R5=A(FIRST ELEMENT)                          
TOXW410  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXW4RXX                                                         
         CLI   0(R5),TAW4ELQ       W4 DETAILS ELEMENT X'78'                     
         JE    TOXW430                                                          
         CLI   0(R5),TAAKELQ       AKA NAME ELEMENT X'79'                       
         JE    TOXW440                                                          
         CLI   0(R5),TANUELQ       FREE FORM NUMBER ELEMENT X'25'               
         JE    TOXW450                                                          
         CLI   0(R5),TAA2ELQ                                                    
         JE    TOXW460                                                          
         CLI   0(R5),TAFLELQ                                                    
         JE    TOXW470                                                          
         CLI   0(R5),TAWHELQ                                                    
         JE    TOXW480                                                          
         CLI   0(R5),TAPEELQ                                                    
         JE    TOXW490                                                          
         CLI   0(R5),TACMELQ                                                    
         JE    TOXW4100                                                         
         CLI   0(R5),TAOWELQ                                                    
         JE    TOXW4110                                                         
         CLI   0(R5),TAWXELQ                                                    
         JE    TOXW4120                                                         
*                                                                               
TOXW420  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXW410                                                          
*                                                                               
         USING TAW4D,R5                                                         
TOXW430  MVC   TX06TYPE,TAW4TYPE   TYPE                                         
         MVC   TX06SEX,TAW4SEX      SEX CODE                                    
         MVC   TX06ETH,TAW4RACE    ETHNICITY                                    
         MVC   TX06AFM,TAW4LOCL    AFM LOCAL                                    
         MVC   TX06RS,TAW4RECP     RECIPROCAL STATE                             
*                                                                               
         OC    TAW4INDT,TAW4INDT   AND INDEMNIFICATION DATE                     
         JZ    TOXW432                                                          
         GOTO1 DATCON,DMCB,(1,TAW4INDT),(8,TX06ID)                              
*                                                                               
TOXW432  TM    TAW4STAT,TAW4STNY   "PRINT YTD ON CHECKS?"                       
         JO    *+8                                                              
         MVI   TX06YTD,C'Y'                                                     
*                                                                               
         TM    TAW4STAT,TAW4SCKF   "SORT CHECKS FIRST?"                         
         JZ    *+8                                                              
         MVI   TX06SCF,C'Y'                                                     
*                                                                               
         TM    TAW4STA2,TAW4SIRS   "IRS LOCK ON FEDERAL WITHHOLDING?"           
         JZ    *+8                                                              
         MVI   TX06ILFW,C'Y'                                                    
*                                                                               
         TM    TAW4STA2,TAW4SLCK   "W4 LOCKED?" STATUS                          
         JZ    *+8                                                              
         MVI   TX06LCK,C'Y'                                                     
*                                                                               
         TM    TAW4STA2,TAW4SNFI   "FICA WITHHOLDING?"                          
         JO    *+8                                                              
         MVI   TX06FW,C'Y'                                                      
*                                                                               
         TM    TAW4STA2,TAW4SNDU   "DUE COMPANY WITHHOLDING?"                   
         JO    *+8                                                              
         MVI   TX06DCW,C'Y'                                                     
*                                                                               
         TM    TAW4STA2,TAW4SNPE   "PENSION?" STATUS                            
         JO    *+8                                                              
         MVI   TX06PEN,C'Y'                                                     
*                                                                               
         TM    TAW4STA2,TAW4SDD    "DIRECT DEPOSIT?" STATUS                     
         JZ    *+8                                                              
         MVI   TX06DD,C'Y'                                                      
*                                                                               
         TM    TAW4STA2,TAW4SWIR   "WIRE TRANSFER CHECKS?"                      
         JZ    *+8                                                              
         MVI   TX06WTC,C'Y'                                                     
*                                                                               
         TM    TAW4STA3,TAW4SSPL   "SPECIAL LETTER ON FILE?"                    
         JZ    *+8                                                              
         MVI   TX06SLF,C'Y'                                                     
*                                                                               
         TM    TAW4STA3,TAW4SEFT   "EFT?" STATUS                                
         JZ    *+8                                                              
         MVI   TX06EFT,C'Y'                                                     
*                                                                               
         CLI   TAW4TYPE,TAW4TYFO   IF W4 TYPE IS FOREIGNER                      
         JE    *+12                                                             
         CLI   TAW4TYPE,TAW4TYCA   OR CANADIAN                                  
         JNE   TOXW433                                                          
         TM    TAW4STA3,TAW4SNTX   STATUS                                       
         JO    *+8                                                              
         MVI   TX06TF,C'Y'                                                      
*                                                                               
TOXW433  CLI   TAW4TYPE,TAW4TYIN   IF W4 TYPE IS INDIVIDUAL                     
         JNE   TOXW434                                                          
         TM    TAW4STA3,TAW4SNHA   ACT?"                                        
         JZ    *+8                                                              
         MVI   TX06ENHA,C'Y'                                                    
         TM    TAW4STA3,TAW4SNHP   PENDING?"                                    
         JZ    *+8                                                              
         MVI   TX06NHAE,C'Y'                                                    
         OC    TAW4NHAD,TAW4NHAD   PASS BACK NEW HIRE DATE                      
         JZ    TOXW434                                                          
         GOTO1 DATCON,DMCB,(1,TAW4NHAD),(8,TX06NHAD)                            
*                                                                               
TOXW434  CLI   TAW4LEN,TAW4LN2Q    IF EXTENDED EMPLOYEE W4 DETAILS              
         JL    *+16                                                             
         MVC   TX06MN,TAW4MIDN     PASS BACK MIDDLE NAME                        
         MVC   TX06SUFF,TAW4SUFF   AND SUFFIX                                   
*                                                                               
         CLI   TAW4TYPE,TAW4TYCO   IS THIS AN CORPORATION?                      
         JNE   *+14                                                             
         MVC   TX06CNME,TAW4CRPN   CORPORATION NAME                             
         J     TOXW420                                                          
*                                                                               
         CLI   TAW4TYPE,TAW4TYTR   IS THIS A TRUST?                             
         JNE   TOXW438                                                          
         MVC   TX06CNME(L'TAW4NAM2),TAW4NAM2                                    
         MVC   TX06CNME+L'TAW4NAM2(L'TAW4NAM1),TAW4NAM1                         
         J     TOXW420                                                          
*                                                                               
TOXW438  MVC   TX06FNAM,TAW4NAM1   FIRST NAME                                   
         MVC   TX06LNAM,TAW4NAM2   LAST NAME                                    
         J     TOXW420                                                          
         DROP  R5                                                               
*                                                                               
         USING TAAKD,R5                                                         
TOXW440  MVC   TX06AKAF,TAAKNAM1   AKA FIRST NAME                               
         MVC   TX06AKAL,TAAKNAM2   AKA LAST NAME                                
         J     TOXW420                                                          
         DROP  R5                                                               
*                                                                               
         USING TANUD,R5                                                         
TOXW450  CLI   TANUTYPE,TANUTPHN   PHONE NUMBER                                 
         JNE   TOXW451                                                          
         ZIC   RE,TANULEN                                                       
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX06PHON(0),TANUMBER                                             
*                                                                               
TOXW451  CLI   TANUTYPE,TANUTMEM   ACTRA MEMBERSHIP NUMBER                      
         JNE   TOXW452                                                          
         ZIC   RE,TANULEN                                                       
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX06AMN(0),TANUMBER                                              
*                                                                               
TOXW452  CLI   TANUTYPE,TANUTGST   GST NUMBER                                   
         JNE   TOXW454                                                          
         ZIC   RE,TANULEN                                                       
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX06GST(0),TANUMBER                                              
*                                                                               
TOXW454  J     TOXW420                                                          
*                                                                               
         USING TAA2D,R5                                                         
TOXW460  MVC   TX06AL1,TAA2ADD1    ADDRESS LINE 1                               
         MVC   TX06AL2,TAA2ADD2    ADDRESS LINE 2                               
         MVC   TX06AL3,TAA2ADD3    ADDRESS LINE 3                               
         MVC   TX06CITY,TAA2CITY   CITY                                         
         MVC   TX06STAT,TAA2ST     STATE                                        
         MVC   TX06ZIP,TAA2ZIP     ZIP                                          
         CLI   TAA2LEN,TAA2LNQ                                                  
         JL    *+10                                                             
         MVC   TX06CNTR,TAA2CTRY   COUNTRY                                      
         J     TOXW420                                                          
*                                                                               
         USING TAFLD,R5                                                         
TOXW470  MVC   TX06FILT,TAFLFLT1  PASS BACK FILTERS                             
         J     TOXW420                                                          
         DROP  R5                                                               
*                                                                               
         USING TAWHD,R5                                                         
TOXW480  CLC   =C'FD',TAWHUNIT     IF FEDERAL TAX UNIT                          
         JNE   TOXW482                                                          
         MVC   TX06FTMS,TAWHSTAT   PASS BACK MARRIED/SINGLE STATUS              
         EDIT  TAWHFLAT,TX06FTFP,2,ZERO=NOBLANK                                 
         EDIT  TAWHEXS,TX06FTE,ALIGN=LEFT,ZERO=NOBLANK                          
         J     TOXW420                                                          
                                                                                
TOXW482  CLI   TAWHUNIT+2,C' '     IF STATE TAX UNIT                            
         JH    TOXW484                                                          
         MVC   TX06STA,TAWHUNIT    PASS BACK STATE CODE                         
         MVC   TX06STMS,TAWHSTAT   BACK MARRIED/SINGLE STATUS                   
         EDIT  TAWHFLAT,TX06STFP,2,ZERO=NOBLANK                                 
         EDIT  TAWHEXS,TX06STE,ALIGN=LEFT,ZERO=NOBLANK                          
         J     TOXW420                                                          
*                                  IF CITY TAX UNIT                             
TOXW484  MVC   TX06CTA,TAWHUNIT    PASS BACK CITY CODE                          
         MVC   TX06CTMS,TAWHSTAT   MARRIED/SINGLE STATUS                        
         EDIT  TAWHFLAT,TX06CTFP,2,ZERO=NOBLANK                                 
         EDIT  TAWHEXS,TX06CTE,ALIGN=LEFT,ZERO=NOBLANK                          
         J     TOXW420                                                          
*                                                                               
         USING TAPED,R5                                                         
TOXW490  MVC   TX06PN,TAPENAME     PASS BACK PAYEE NAME                         
         MVC   TX06PAL1,TAPEADD1    ADDRESS LINE 1                              
         MVC   TX06PAL2,TAPEADD2    ADDRESS LINE 2                              
         MVC   TX06PAL3,TAPEADD3    ADDRESS LINE 3                              
         GOTO1 DATCON,DMCB,(1,TAPEEXP),(8,TX06PED)                              
         CLI   TAPELEN,TAPELNQ                                                  
         JL    TOXW420                                                          
         MVC   TX06PCTY,TAPECITY    CITY                                        
         MVC   TX06PS,TAPEST        STATE                                       
         MVC   TX06PZ,TAPEZIP       ZIP                                         
         MVC   TX06PC,TAPECTRY      COUNTRY AND ACTIVE DATE                     
         GOTO1 DATCON,DMCB,(1,TAPEACT),(8,TX06PAD)                              
         J     TOXW420                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXW4100 CLI   TACMTYPE,TACMTYPG   TYPE GENERAL COMMENT                         
         JNE   TOXW4102                                                         
         ZIC   RE,TACMLEN                                                       
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX06CMNT(0),TACMCOMM    PASS IT BACK                             
         J     TOXW420                                                          
*                                                                               
TOXW4102 CLI   TACMTYPE,TACMTYPI   OR TYPE EMAIL ADDRESS                        
         JNE   TOXW420                                                          
         ZIC   RE,TACMLEN                                                       
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX06EA(0),TACMCOMM    PASS IT BACK                               
         J     TOXW420                                                          
*                                                                               
         USING TAOWD,R5                                                         
TOXW4110 CLI   TAOWTYPE,TAOWTMPF   OTHER TYPE MOTION PICTURE FUND               
         JNE   TOXW4112            PASS BACK MPR FUND PERCENTAGE                
         EDIT  TAOWFLAT,TX06MFP,2,ZERO=BLANK                                    
*                                                                               
TOXW4112 CLI   TAOWTYPE,TAOWTCHA   OTHER TYPE PERMANENT CHARITY                 
         JNE   TOXW420             PASS BACK PERMANENT CHARITY %                
         EDIT  TAOWFLAT,TX06PCP,2,ZERO=BLANK                                    
         J     TOXW420                                                          
*                                                                               
         USING TAWXD,R5                                                         
TOXW4120 EDIT  TAWXMERN,TX06EARN,2,FLOAT=-,ALIGN=RIGHT   EARNINGS               
         GOTO1 DATCON,DMCB,(1,TAWXDOB),(8,TX06DOB)       DOB                    
         EDIT  TAWXPCT,TX06DP,2,ZERO=BLANK               DEDUCT %               
         GOTOR SSN2PID,DMCB,TAWXTSSN,DUB                                        
         MVC   TX06TP,DUB          TRUSTEE PID                                  
         J     TOXW420                                                          
         DROP  R5                                                               
*                                                                               
TOXW4RXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXW4AC - EXTRACT W-4 ASSOCATED CORPORATION RECORDS - 5025          *         
***********************************************************************         
                                                                                
TOXW4AC  NTR1                                                                   
         LA    R5,TLW4ELEM         R5=A(FIRST ELEMENT)                          
TOXW4A10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXW4AXX                                                         
         CLI   0(R5),TATIELQ       W4 DETAILS ELEMENT X'76'                     
         JE    TOXW4A30                                                         
*                                                                               
TOXW4A20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXW4A10                                                         
*                                                                               
         USING TATID,R5                                                         
TOXW4A30 CLI   TATITYPE,TATITYCO   CORPORATION?                                 
         JNE   TOXW4A20                                                         
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK25CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX06LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX06LEN)                                          
         MVC   TOXRETYP,TOXW4ACQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TX25W4AC-1,MXTRTQ                                                
         MVI   TX25PID-1,MXTRTQ                                                 
         MVI   TX25CPID-1,MXTRTQ                                                
         MVI   TX25X,MXTRTQ                                                     
         MVI   TX25X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLW4SSN,DUB                                         
         MVC   TX25W4AC,DUB        SOCIAL SECURITY NUMBER                       
         MVC   TX25PID,DUB                                                      
*                                                                               
         ZIC   R1,TATICRPN         CORPORATION NUMBER                           
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  BYTE,DUB                                                         
         MVC   TX25W4AC+6(1),BYTE                                               
*                                                                               
         GOTOR SSN2PID,DMCB,TATIID,DUB                                          
         MVC   TX25CPID,DUB        SOCIAL SECURITY NUMBER                       
         J     TOXW4A20                                                         
         DROP  R5                                                               
*                                                                               
TOXW4AXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXPERC - EXTRACT PERFORMER RECORDS - 5007                          *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PERFORMER RECORD)                                             *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXPERC  NMOD1 WORKX-WORKD,*TOXPER*,R8,RR=RA                                    
         USING WORKD,RC                                                         
         L     RA,TOXPERLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCAD,R3            R3=A(PERFORMER RECORD)                       
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXPEBLD            BUILD PERFORMER AND SUBSET RECS              
         JH    TOXPENXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXPERCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXPERLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXPENXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX07LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX07LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXPEBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXPERR          BUILD PERFORMER RECORD                       
         BAS   RE,TOXFCR           BUILD FIXED CYCLE RECORD                     
         BAS   RE,TOXVPERR         BUILD VERSION-PERFORMER RECORD               
         BAS   RE,TOXTPERR         BUILD TRACK-PERFORMER RECORD                 
         BAS   RE,TOXTPAPR         BUILD TRACK PERFORMER-ASSET PERFORM          
         BAS   RE,TOXDEALR         BUILD DEAL RECORD                            
         BAS   RE,TOXOVSA          BUILD OVERSCALE AMOUNT                       
         BAS   RE,TOXOVP1          BUILD OVERSCALE 1 PERCENTAGE                 
         BAS   RE,TOXOVP2          BUILD OVERSCALE 2 PERCENTAGE                 
         BAS   RE,TOX82            BUILD PERFORMER-EPISODE RECORD               
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXPERR -  - EXTRACT PERFORMER RECORDS 5007                         *         
***********************************************************************         
                                                                                
TOXPERR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK07CNT,=P'1'                                                    
         DROP  RE                                                               
         USING WORKD,RC                                                         
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX07LEN)                                          
         MVC   TOXRETYP,TOXPERQ                                                 
*                                                                               
         MVI   TX07PER-1,MXTRTQ                                                 
         MVI   TX07ASS-1,MXTRTQ                                                 
         MVI   TX07PID-1,MXTRTQ                                                 
         MVI   TX07FFCD-1,MXTRTQ                                                
         MVI   TX07EXPD-1,MXTRTQ                                                
         MVI   TX07LSD-1,MXTRTQ                                                 
         MVI   TX07CAT-1,MXTRTQ                                                 
         MVI   TX07CAM-1,MXTRTQ                                                 
         MVI   TX07UNIT-1,MXTRTQ                                                
         MVI   TX07FSD-1,MXTRTQ                                                 
         MVI   TX07UN-1,MXTRTQ                                                  
         MVI   TX07LCL-1,MXTRTQ                                                 
         MVI   TX07CKEY-1,MXTRTQ                                                
         MVI   TX07SDAT-1,MXTRTQ                                                
         MVI   TX07EXPD-1,MXTRTQ                                                
         MVI   TX07GUAR-1,MXTRTQ                                                
         MVI   TX07AGNT-1,MXTRTQ                                                
         MVI   TX07CMNT-1,MXTRTQ                                                
         MVI   TX07AFP-1,MXTRTQ                                                 
         MVI   TX07EQPF-1,MXTRTQ                                                
         MVI   TX07PYEE-1,MXTRTQ                                                
         MVI   TX07EURO-1,MXTRTQ                                                
         MVI   TX07CTAN-1,MXTRTQ                                                
         MVI   TX07PRAT-1,MXTRTQ                                                
         MVI   TX07CCMT-1,MXTRTQ                                                
         MVI   TX07APCB-1,MXTRTQ                                                
         MVI   TX07APPX-1,MXTRTQ                                                
         MVI   TX07APRE-1,MXTRTQ                                                
         MVI   TX07NCNR-1,MXTRTQ                                                
         MVI   TX07FTRK-1,MXTRTQ                                                
         MVI   TX07FGRU-1,MXTRTQ                                                
         MVI   TX07INTR-1,MXTRTQ                                                
         MVI   TX07INDR-1,MXTRTQ                                                
*                                                                               
         MVI   TX07X,MXTRTQ                                                     
         MVI   TX07X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX07PER(L'DUB),DUB                                               
         MVC   TX07PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX07ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTOR SSN2PID,DMCB,TLCASSN,DUB                                         
         MVC   TX07PID,DUB         SOCIAL SECURITY NUMBER                       
         MVC   TX07CAT,TLCACAT     CATEGORY                                     
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXPERCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXPER10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPERXX                                                         
         CLI   0(R5),TACAELQ       CAST DETAIL ELEMENT (X'74)                   
         JE    TOXPER30                                                         
         CLI   0(R5),TACMELQ       COMMENT ELEMENT (X'8D')                      
         JE    TOXPER50                                                         
         CLI   0(R5),TACRELQ       APPLIED CREDIT HISTORY ELEMENT               
         JE    TOXPER70            (X'68')                                      
*                                                                               
TOXPER20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPER10                                                         
*                                                                               
         USING TACAD,R5                                                         
TOXPER30 GOTO1 DATCON,DMCB,(X'01',TACAFCYC),(10,TX07FFCD) FIRST FIX CYC         
         OC    TACAEXP,TACAEXP                                                  
         JZ    TOXPER32                                                         
         GOTO1 DATCON,DMCB,(X'01',TACAEXP),(10,TX07EXPD)  EXPIRATION            
TOXPER32 OC    TACALAST,TACALAST                                                
         JZ    TOXPER34                                                         
         GOTO1 DATCON,DMCB,(X'01',TACALAST),(10,TX07LSD)  LAST SERVICES         
TOXPER34 OC    TACACORP,TACACORP                                                
         JZ    TOXPER36                                                         
         MVC   TX07CKEY(L'TX07PID),TX07PID                                      
*                                                                               
         ZIC   R1,TACACORP         CORP NUMBER                                  
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  BYTE,DUB                                                         
         MVC   TX07CKEY+L'TX07PID(1),BYTE                                       
*                                                                               
TOXPER36 MVC   TX07CAM,TACAONOF    CAMERA                                       
         MVC   TX07UNIT,TACAUNIT   TAX UNIT                                     
         MVC   TX07UN,TACAUN       UNION                                        
         MVC   TX07LCL,TACALOCL    LOCAL                                        
         MVC   TX07CNYR,TACAYEAR                                                
         MVC   TX07DOUB,TACADBL                                                 
         MVI   TX07EQPF,C'N'                                                    
         TM    TACASTA3,TACASEQY                                                
         BZ    *+8                                                              
         MVI   TX07EQPF,C'Y'                                                    
         OC    TACAFRST,TACAFRST                                                
         JZ    TOXPER38                                                         
         GOTO1 DATCON,DMCB,(X'01',TACAFRST),(10,TX07FSD)  FIRST SERVICE         
TOXPER38 OC    TACASDTE,TACASDTE                                                
         JZ    TOXPER40                                                         
         GOTO1 DATCON,DMCB,(X'01',TACASDTE),(10,TX07SDAT) SHOOT DATE            
TOXPER40 MVC   TX07EXPB,TACAEBAS   EXPIRATION BASE                              
*                                                                               
         OC    TACAGUA,TACAGUA     GUARANTEE?                                   
         JZ    *+16                                                             
         MVC   TX07GUAR(6),TX07PID SOCIAL SECURITY NUMBER                       
         MVC   TX07GUAR+6(L'FULL),TACAGUA SSN+GUA                               
*                                                                               
         OC    TACARATE,TACARATE                                                
         JZ    TOXPER42                                                         
         EDIT  (2,TACARATE),(5,TX07AFP),2,ZERO=BLANK  AGENCY FEE %              
*                                                                               
TOXPER42 OC    TACANCDE,TACANCDE   AGENT?                                       
         JZ    TOXPER44                                                         
         GOTOR TAGT,DMCB,(X'40',TACANCDE),TX07AGNT                              
*                                                                               
TOXPER44 MVC   TX07PYEE,TACAPAYE   PAYEE                                        
*                                                                               
         MVI   TX07EURO,C'N'                                                    
         TM    TACASTA2,TACASEUR   PAY PERFORMER IN EUROS?                      
         JZ    *+8                                                              
         MVI   TX07EURO,C'Y'                                                    
                                                                                
         MVI   TX07CTAN,C'N'                                                    
         TM    TACASTAT,TACASTAG   CHECKS TO AGENT?                             
         JZ    *+8                                                              
         MVI   TX07CTAN,C'Y'                                                    
                                                                                
         MVI   TX07APCB,C'Y'                                                    
         TM    TACASTAT,TACASXAC   APPLY CBL WHEN BSS/HLD OVERSCL AMT?          
         JZ    *+8                                                              
         MVI   TX07APCB,C'N'                                                    
                                                                                
         MVI   TX07APPX,C'Y'                                                    
         TM    TACASTAT,TACASXAP   APPLY PAX WHEN BSS/HLD OVERSCL AMT?          
         JZ    *+8                                                              
         MVI   TX07APPX,C'N'                                                    
                                                                                
         MVI   TX07APRE,C'Y'                                                    
         TM    TACASTA3,TACASXFT   APPLY REUSE TO SESS FEE/HFEE FTRK?           
         JZ    *+8                                                              
         MVI   TX07APRE,C'N'                                                    
                                                                                
         MVI   TX07NCNR,C'N'                                                    
         TM    TACASTA2,TACASTDP   PROHIBIT CANADIAN RATES?                     
         JZ    *+8                                                              
         MVI   TX07NCNR,C'Y'                                                    
                                                                                
         MVI   TX07FTRK,C'Y'                                                    
         TM    TACASTAT,TACASTNF   DAILY FTRACK REPORT PRINTED?                 
         JZ    *+8                                                              
         MVI   TX07FTRK,C'N'                                                    
                                                                                
         MVI   TX07FGRU,C'Y'                                                    
         TM    TACASTA2,TACASFGR   PERFORMER RECEIVES FOREIGN USE?              
         JZ    *+8                                                              
         MVI   TX07FGRU,C'N'                                                    
                                                                                
         MVI   TX07INTR,C'Y'                                                    
         TM    TACASTA2,TACASINA   PERFORMER RECEIVES INTERACTIVE USE?          
         JZ    *+8                                                              
         MVI   TX07INTR,C'N'                                                    
                                                                                
         MVI   TX07INDR,C'Y'                                                    
         TM    TACASTA2,TACASINR   PERFORMER RECEIVES INDUSTRIAL USE?           
         JZ    *+8                                                              
         MVI   TX07INDR,C'N'                                                    
                                                                                
         J     TOXPER20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACMD,R5                                                         
TOXPER50 CLI   TACMTYPE,TACMTYPG    GENERAL COMMENT?                            
         BNE   TOXPER60                                                         
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX07CMNT(0),TACMCOMM   COMMENT                                   
         J     TOXPER20                                                         
                                                                                
TOXPER60 CLI   TACMTYPE,TACMTYPC    CHECK COMMENT?                              
         BNE   TOXPER20                                                         
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX07CCMT(0),TACMCOMM   COMMENT                                   
         J     TOXPER20                                                         
         DROP  R5                                                               
*                                                                               
         USING TACRD,R5                                                         
TOXPER70 OC    TACRUSE,TACRUSE      APPLIED CREDIT HISTORY ELEMENT              
         JNZ   TOXPER20                                                         
         EDIT  TACRSCAL,TX07PRAT,2,FLOAT=-,ALIGN=RIGHT                          
         J     TOXPER20                                                         
         DROP  R5                                                               
                                                                                
TOXPERXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXFCR -   - FIXED CYCLE 5008                                       *         
***********************************************************************         
                                                                                
TOXFCR   NTR1                                                                   
         XC    TMPCOUNT,TMPCOUNT                                                
*                                                                               
         USING TACRD,R5                                                         
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXFC10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXFC30                                                          
         CLI   0(R5),TACRELQ       APPLIED CREDIT HISTORY (X'68')               
         JE    TOXFC25                                                          
*                                                                               
TOXFC20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXFC10                                                          
*                                                                               
TOXFC25  OC    TACRUSE,TACRUSE                                                  
         JZ    TOXFC20                                                          
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
         J     TOXFC20                                                          
         DROP  R5                                                               
*                                                                               
TOXFC30  OC    TMPCOUNT,TMPCOUNT   ANY FIXED CYCLES?                            
         JZ    TOXFCX                                                           
*                                                                               
         USING TACRD,R5                                                         
         LA    R5,TLCAELEM                                                      
TOXFC40  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXFCX                                                           
         CLI   0(R5),TACRELQ       APPLIED CREDIT HISTORY (X'68')               
         JE    TOXFC50                                                          
*                                                                               
TOXFC45  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXFC40                                                          
*                                                                               
TOXFC50  OC    TACRUSE,TACRUSE                                                  
         JZ    TOXFC45                                                          
                                                                                
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK08CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX08LEN)                                          
         MVC   TOXRETYP,TOXFCQ                                                  
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX08PER-1,MXTRTQ                                                 
         MVI   TX08USE-1,MXTRTQ                                                 
         MVI   TX08CSD-1,MXTRTQ                                                 
         MVI   TX08CED-1,MXTRTQ                                                 
         MVI   TX08INV-1,MXTRTQ                                                 
         MVI   TX08SSEQ-1,MXTRTQ                                                
         MVI   TX08STYP-1,MXTRTQ                                                
         MVI   TX08SCAL-1,MXTRTQ                                                
         MVI   TX08APPL-1,MXTRTQ                                                
         MVI   TX08BALN-1,MXTRTQ                                                
         MVI   TX08X,MXTRTQ                                                     
         MVI   TX08X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX08PER(L'DUB),DUB                                               
         MVC   TX08PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         GOTO1 TINVCON,DMCB,TACRINV,TX08INV,DATCON       INVOICE                
         GOTO1 DATCON,DMCB,(X'01',TACRSTRT),(10,TX08CSD) CYCLE START            
         GOTO1 DATCON,DMCB,(X'01',TACREND),(10,TX08CED)  CYCLE END              
         MVC   TX08USE,TACRUSE     USE                                          
                                                                                
         EDIT  TACRSCAL,TX08SCAL,2,FLOAT=-,ALIGN=RIGHT  SCALE AMT               
         EDIT  TACRAPPL,TX08APPL,2,FLOAT=-,ALIGN=RIGHT  APPLIED AMT             
         EDIT  TACRBAL,TX08BALN,2,FLOAT=-,ALIGN=RIGHT   BALANCE AMT             
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX08SSEQ,DUB                                                     
*                                                                               
         L     RF,TMPCOUNT                                                      
         S     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         MVC   TX08STYP,=C'000'                                                 
         CLI   TACRTYPE,0                                                       
         JE    TOXFC52                                                          
         ZIC   R1,TACRTYPE         USE SUBTYPE                                  
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX08STYP,DUB                                                     
*                                                                               
TOXFC52  J     TOXFC45                                                          
         DROP  R5                                                               
*                                                                               
TOXFCX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXVPERR - - VERSION-PERFORMER 5009                                 *         
***********************************************************************         
                                                                                
TOXVPERR NTR1                                                                   
         MVI   BYTE2,0                                                          
*                                                                               
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXVP10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXVP32                                                          
         CLI   0(R5),TAFNELQ       FREE FORM NAME ELEMENT (X'26')               
         JE    TOXVP30                                                          
         CLI   0(R5),TATRELQ                                                    
         JNE   *+8                                                              
         MVI   BYTE2,1             FOUND A TATR                                 
*                                                                               
TOXVP20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXVP10                                                          
*                                                                               
         USING TAFND,R5                                                         
TOXVP30  CLI   TAFNTYPE,TAFNTVER                                                
         JE    TOXVP34                                                          
         J     TOXVP20                                                          
*                                                                               
TOXVP32  CLI   BYTE2,1             NO TAFNS, FOUND TATR?                        
         JE    TOXVPX                                                           
*                                                                               
         MVI   BYTE,1              NO TAFNS, NO TATR, DEFAULT TO 1              
         LA    RF,BYTE                                                          
         ST    RF,TMPADDR                                                       
         LA    R7,1                                                             
         J     TOXVP40                                                          
*                                                                               
TOXVP34  LA    RF,TAFNNAME                                                      
         ST    RF,TMPADDR                                                       
*                                                                               
         ZIC   R7,TAFNLEN                                                       
         SHI   R7,TAFNLNQ          # OF VERSIONS TO PROCESS                     
*                                                                               
         USING PKCNTS,RE                                                        
TOXVP40  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK09CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX09LEN)                                          
         MVC   TOXRETYP,TOXVPERQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX09ASS-1,MXTRTQ                                                 
         MVI   TX09VERN-1,MXTRTQ                                                
         MVI   TX09PER-1,MXTRTQ                                                 
         MVI   TX09X,MXTRTQ                                                     
         MVI   TX09X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX09ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX09PER(L'DUB),DUB                                               
         MVC   TX09PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         MVI   TX09VERN,C'*'                                                    
         L     RF,TMPADDR          LIST OF VERSIONS                             
         CLI   0(RF),X'FB'         ALL VERSIONS?                                
         JE    TOXVPX                                                           
*                                                                               
         ZIC   R1,0(RF)                                                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX09VERN,DUB                                                     
*                                                                               
         L     RF,TMPADDR                                                       
         AHI   RF,1                                                             
         ST    RF,TMPADDR                                                       
*                                                                               
         BCT   R7,TOXVP40                                                       
         DROP  R5                                                               
*                                                                               
TOXVPX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXTPERR - - TRACK-PERFORMER 5012                                   *         
***********************************************************************         
                                                                                
TOXTPERR NTR1                                                                   
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXTP10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTPX                                                           
         CLI   0(R5),TAFNELQ       FREE FORM NAME ELEMENT (X'26')               
         JE    TOXTP30                                                          
*                                                                               
TOXTP20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTP10                                                          
*                                                                               
         USING TAFND,R5                                                         
TOXTP30  CLI   TAFNTYPE,TAFNTTRK                                                
         JNE   TOXTP20                                                          
*                                                                               
         LA    RF,TAFNNAME                                                      
         ST    RF,TMPADDR                                                       
*                                                                               
         ZIC   R7,TAFNLEN                                                       
         SHI   R7,TAFNLNQ          # OF VERSIONS TO PROCESS                     
*                                                                               
         USING PKCNTS,RE                                                        
TOXTP40  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK12CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX12LEN)                                          
         MVC   TOXRETYP,TOXTPERQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX12ASS-1,MXTRTQ                                                 
         MVI   TX12TRK-1,MXTRTQ                                                 
         MVI   TX12PER-1,MXTRTQ                                                 
         MVI   TX12X,MXTRTQ                                                     
         MVI   TX12X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX12ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX12PER(L'DUB),DUB                                               
         MVC   TX12PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         L     RF,TMPADDR                                                       
         MVC   TX12TRK,0(RF)       TRACK                                        
         AHI   RF,1                                                             
         ST    RF,TMPADDR                                                       
*                                                                               
         BCT   R7,TOXTP40                                                       
         DROP  R5                                                               
*                                                                               
TOXTPX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXTPAPR - - TRACK PERFORMER-ASSET PERFORMER 5014                   *         
***********************************************************************         
                                                                                
TOXTPAPR NTR1                                                                   
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXTA10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTAX                                                           
         CLI   0(R5),TATRELQ       MUSIC CONTRACT/TRACK ELEMENT (X'45')         
         JE    TOXTA30                                                          
*                                                                               
TOXTA20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTA10                                                          
*                                                                               
         USING TATRD,R5                                                         
         USING PKCNTS,RE                                                        
TOXTA30  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK14CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX14LEN)                                          
         MVC   TOXRETYP,TOXTPAPQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX14TPER-1,MXTRTQ                                                
         MVI   TX14PER-1,MXTRTQ                                                 
         MVI   TX14X,MXTRTQ                                                     
         MVI   TX14X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX14PER(L'DUB),DUB                                               
         MVC   TX14PER+L'DUB(L'FULL),FULL  PRIMARY KEY=TLCACOM+TLCASEQ          
         GOTO1 VHEXOUT,DMCB,TATRCOM,DUB,L'TATRCOM,0                             
         GOTO1 VHEXOUT,DMCB,TATRCSQ,FULL,L'TATRCSQ,0                            
         MVC   TX14TPER(L'DUB),DUB                                              
         MVC   TX14TPER+L'DUB(L'FULL),FULL PRIMARY KEY=TATRCOM+TATRCSQ          
         J     TOXTA20                                                          
         DROP  R5                                                               
*                                                                               
TOXTAX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXDEALR - - DEAL 5027                                              *         
***********************************************************************         
                                                                                
TOXDEALR NTR1                                                                   
         MVC   TMPCOUNT,=F'1'                                                   
         XC    PRAREA,PRAREA                                                    
*                                                                               
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXDE10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXDEALX                                                         
         CLI   0(R5),TADLELQ       DEAL ELEMENT (X'77')                         
         JE    TOXDE30                                                          
*                                                                               
TOXDE20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXDE10                                                          
*                                                                               
         USING TADLD,R5                                                         
         USING PKCNTS,RE                                                        
TOXDE30  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK27CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX27LEN)                                          
         MVC   TOXRETYP,TOXDEALQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX27PER-1,MXTRTQ                                                 
         MVI   TX27SEQ-1,MXTRTQ                                                 
         MVI   TX27AREA-1,MXTRTQ                                                
         MVI   TX27USE-1,MXTRTQ                                                 
         MVI   TX27MON-1,MXTRTQ                                                 
         MVI   TX27AMT-1,MXTRTQ                                                 
         MVI   TX27PDTE-1,MXTRTQ                                                
         MVI   TX27EDTE-1,MXTRTQ                                                
         MVI   TX27ACP-1,MXTRTQ                                                 
         MVI   TX27X,MXTRTQ                                                     
         MVI   TX27X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX27ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX27PER(L'DUB),DUB                                               
         MVC   TX27PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX27SEQ,DUB                                                      
*                                                                               
         CLC   TMPCOUNT,=F'1'      FIRST TIME IN?                               
         JNE   *+16                                                             
         MVC   TX27AREA,TADLAREA   AREA                                         
         MVC   PRAREA,TADLAREA                                                  
*                                                                               
         CLC   PRAREA,TADLAREA     SAME AS PREVIOUS AREA?                       
         JE    *+16                                                             
         MVC   TX27AREA,TADLAREA   NO - RETURN NEW AREA                         
         MVC   PRAREA,TADLAREA                                                  
*                                                                               
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         MVC   TX27USE,TADLUSE     USE                                          
                                                                                
         CLI   TADLTERM,TADLTUNL   IF UNLIMITED                                 
         JNE   *+14                                                             
         MVC   TX27MON,=C'UN '     DISPLAY "UN"                                 
         J     TOXDE32                                                          
*                                                                               
         CLI   TADLTERM,TADLT1X    IF ONE TIME                                  
         JNE   *+14                                                             
         MVC   TX27MON,=C'1X '     DISPLAY "1X"                                 
         J     TOXDE32                                                          
*                                                                               
         ZIC   R1,TADLTERM         TERM                                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX27MON,DUB                                                      
*                                                                               
TOXDE32  OC    TADLAMT,TADLAMT                                                  
         JZ    TOXDE34                                                          
         EDIT  TADLAMT,TX27AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
TOXDE34  OC    TADLPUB,TADLPUB                                                  
         JZ    TOXDE36                                                          
         GOTO1 DATCON,DMCB,(X'01',TADLPUB),(10,TX27PDTE)  PUB DATE              
*                                                                               
TOXDE36  OC    TADLEXP,TADLEXP                                                  
         JZ    TOXDE38                                                          
         GOTO1 DATCON,DMCB,(X'01',TADLEXP),(10,TX27EDTE)  EXP DATE              
*                                                                               
TOXDE38  OC    TADLRATE,TADLRATE                                                
         JZ    TOXDE40                                                          
         EDIT  (2,TADLRATE),(5,TX27ACP),2,ZERO=BLANK  AGENCY COM %              
*                                                                               
TOXDE40  J     TOXDE20                                                          
         DROP  R5                                                               
*                                                                               
TOXDEALX J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXOVSA -  - OVERSCALE AMOUNT 5042                                            
***********************************************************************         
                                                                                
TOXOVSA  NTR1                                                                   
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXOVA10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXOVSAX                                                         
         CLI   0(R5),TAOAELQ       OVERSCALE ELEMENT (X'67')                    
         JE    TOXOVA26                                                         
*                                                                               
TOXOVA20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXOVA10                                                         
*                                                                               
         USING TAOAD,R5                                                         
TOXOVA26 ZIC   R0,TAOANUM                                                       
         STC   R0,BYTE                                                          
         LA    R5,TAOASBEL                                                      
         USING TAOASBEL,R5                                                      
*                                                                               
         USING PKCNTS,RE                                                        
TOXOVA30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK42CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
                                                                                
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX42LEN)                                          
         MVC   TOXRETYP,TOXOVSAQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX42PER-1,MXTRTQ                                                 
         MVI   TX42USEC-1,MXTRTQ                                                
         MVI   TX42OVAM-1,MXTRTQ                                                
         MVI   TX42ASS-1,MXTRTQ                                                 
         MVI   TX42X,MXTRTQ                                                     
         MVI   TX42X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX42ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX42PER(L'DUB),DUB                                               
         MVC   TX42PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         MVC   TX42USEC,TAOAUSE    USE CODE                                     
         CLC   TAOAUSE,SPACES                                                   
         BNE   *+10                                                             
         MVC   TX42USEC,=C'ALL'                                                 
*                                                                               
         EDIT  TAOAAMT,TX42OVAM,2,FLOAT=-,ALIGN=RIGHT  OVERSCALE AMOUNT         
         AHI   R5,L'TAOASBEL                                                    
         ZIC   R0,BYTE                                                          
         SHI   R0,1                                                             
         STC   R0,BYTE                                                          
         CHI   R0,0                                                             
         JH    TOXOVA30                                                         
         DROP  R5                                                               
*                                                                               
TOXOVSAX J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXOVP1 -  - OVERSCALE 1 PERCENTAGE  5043                                     
***********************************************************************         
                                                                                
TOXOVP1  NTR1                                                                   
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXOP110 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXOVP1X                                                         
         CLI   0(R5),TAOPELQ       OVERSCALE ELEMENT (X'67')                    
         JE    TOXOP126                                                         
*                                                                               
TOXOP120 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXOP110                                                         
*                                                                               
         USING TAOPD,R5                                                         
TOXOP126 ZIC   R0,TAOPNUM                                                       
         STC   R0,BYTE                                                          
         LA    R5,TAOPSBEL                                                      
         USING TAOPSBEL,R5                                                      
*                                                                               
         USING PKCNTS,RE                                                        
TOXOP130 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK43CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
                                                                                
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX43LEN)                                          
         MVC   TOXRETYP,TOXOVP1Q                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX43PER-1,MXTRTQ                                                 
         MVI   TX43USEC-1,MXTRTQ                                                
         MVI   TX43OVPC-1,MXTRTQ                                                
         MVI   TX43ASS-1,MXTRTQ                                                 
         MVI   TX43X,MXTRTQ                                                     
         MVI   TX43X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX43ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX43PER(L'DUB),DUB                                               
         MVC   TX43PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
         MVC   TX43USEC,TAOPUSE    USE CODE                                     
         CLC   TAOPUSE,SPACES                                                   
         BNE   *+10                                                             
         MVC   TX43USEC,=C'ALL'                                                 
*                                                                               
         EDIT  TAOPPCT,TX43OVPC,2,FLOAT=-,ALIGN=RIGHT  OVERSCALE AMT            
         AHI   R5,L'TAOPSBEL                                                    
         ZIC   R0,BYTE                                                          
         SHI   R0,1                                                             
         STC   R0,BYTE                                                          
         CHI   R0,0                                                             
         JH    TOXOP130                                                         
         DROP  R5                                                               
*                                                                               
TOXOVP1X J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXOVP2 -  - OVERSCALE 2 PERCENTAGE  5044                                     
***********************************************************************         
                                                                                
TOXOVP2  NTR1                                                                   
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXOP202 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXOP208                                                         
         CLI   0(R5),TACAELQ       TACA ELEMENT (X'74')                         
         JE    TOXOP204                                                         
         SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXOP202                                                         
         USING TACAD,R5                                                         
TOXOP204 DS    0C                                                               
         OC    TACAOV2,TACAOV2                                                  
         BZ    TOXOP208                                                         
*                                                                               
         XC    DUMTAO2,DUMTAO2                                                  
         MVI   DUMTAO2,TAO2ELQ                                                  
         MVI   DUMTAO2+1,TAO2LNQ+L'TAO2SBEL                                     
         MVC   DUMTAO2+(TAO2USE-TAO2D)(3),=C'ALL'                               
         MVC   DUMTAO2+(TAO2PCT-TAO2D)(4),TACAOV2                               
         LA    R5,DUMTAO2+(TAO2SBEL-TAO2D)                                      
         MVI   BYTE,1                                                           
         B     TOXOP230                                                         
                                                                                
TOXOP208 LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOXOP210 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXOVP2X                                                         
         CLI   0(R5),TAO2ELQ       OVERSCALE ELEMENT (X'66')                    
         JE    TOXOP226                                                         
                                                                                
TOXOP220 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXOP210                                                         
                                                                                
         USING TAO2D,R5                                                         
TOXOP226 ZIC   R0,TAO2NUM                                                       
         STC   R0,BYTE                                                          
         LA    R5,TAO2SBEL                                                      
         USING TAO2SBEL,R5                                                      
                                                                                
         USING PKCNTS,RE                                                        
TOXOP230 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK44CNT,=P'1'                                                    
         DROP  RE                                                               
                                                                                
         L     R2,ANEXT2                                                        
                                                                                
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
                                                                                
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX44LEN)                                          
         MVC   TOXRETYP,TOXOVP2Q                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX44PER-1,MXTRTQ                                                 
         MVI   TX44USEC-1,MXTRTQ                                                
         MVI   TX44OVPC-1,MXTRTQ                                                
         MVI   TX44ASS-1,MXTRTQ                                                 
         MVI   TX44X,MXTRTQ                                                     
         MVI   TX44X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX44ASS,L'TLCACOM,0   ASSET PR KEY          
         GOTO1 VHEXOUT,DMCB,TLCACOM,DUB,L'TLCACOM,0                             
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX44PER(L'DUB),DUB                                               
         MVC   TX44PER+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
*                                                                               
TOXOP250 DS    0C                                                               
*                                                                               
TOXOP260 MVC   TX44USEC,TAO2USE    USE CODE                                     
         CLC   TAO2USE,SPACES                                                   
         BNE   *+10                                                             
         MVC   TX44USEC,=C'ALL'                                                 
*                                                                               
         EDIT  TAO2PCT,TX44OVPC,2,FLOAT=-,ALIGN=RIGHT  OVERSCALE AMT            
         CLC   TAO2USE,SPACES                                                   
         BNE   *+10                                                             
         MVC   TX44USEC,=C'ALL'                                                 
         AHI   R5,L'TAO2SBEL                                                    
         ZIC   R0,BYTE                                                          
         SHI   R0,1                                                             
         STC   R0,BYTE                                                          
         CHI   R0,0                                                             
         JH    TOXOP230                                                         
         DROP  R5                                                               
*                                                                               
TOXOVP2X J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX82 - - EPISODE-PERFORMER 5082                                    *         
***********************************************************************         
                                                                                
TOX82    NTR1                                                                   
         USING TASOD,R5                                                         
         LA    R5,TLCAELEM         R5=A(FIRST ELEMENT)                          
TOX8210  CLI   0(R5),TASOELQ       GET ELEMENT FROM RECORD                      
         JE    TOX8220                                                          
         CLI   0(R5),0                                                          
         JE    TOX82X                                                           
         ZIC   RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOX8210                                                          
                                                                                
TOX8220  ZICM  R7,TASONUM,1        # OF EPISODES TO PROCESS                     
         JZ    TOX82X                                                           
         LA    R5,TASOEPI                                                       
         DROP  R5                                                               
                                                                                
         USING PKCNTS,RE                                                        
TOX8240  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK82CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX07LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX09LEN)                                          
         MVC   TOXRETYP,TOX5082Q                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX82EPI-1,MXTRTQ                                                 
         MVI   TX82PPK-1,MXTRTQ                                                 
         MVI   TX82X,MXTRTQ                                                     
         MVI   TX82X+1,MXTRTQ                                                   
*                                                                               
         LH    RE,0(R5)                                                         
         CVD   RE,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TX82EPI,DUB                                                      
         GOTO1 VHEXOUT,DMCB,TLCACOM,TX82APK,L'TLCACOM,0                         
         GOTO1 VHEXOUT,DMCB,TLCASEQ,FULL,L'TLCASEQ,0                            
         MVC   TX82PPK(L'TX82APK),TX82APK                                       
         MVC   TX82PPK+L'DUB(L'FULL),FULL PRIMARY KEY=TLCACOM+TLCASEQ           
                                                                                
         LA    R5,L'TASOSEPI(R5)                                                
         BCT   R7,TOX8240                                                       
*                                                                               
TOX82X   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
PRAREA   DS    CL(L'TADLAREA)      PREVIOUS AREA                                
DUMTAO2  DS    XL(TAO2LNQ+L'TAO2SBEL)                                           
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXINVC - EXTRACT INVOICE RRECORDS - 5010                           *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(INVOICE RECORD)                                               *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXINVC  NMOD1 WORKX-WORKD,*TOXINV*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXINVLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
*                                                                               
         L     RF,=A(VT00A88)      TASYSTAB                                     
         MVC   0(4,RF),20(R1)                                                   
*                                                                               
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLIND,R3            R3=A(INVOICE RECORD)                         
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXINBLD            BUILD INVOICE AND SUBSET RECS                
         JH    TOXINNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXINVCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXINVLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXINNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX10LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX10LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXINBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         L     RF,=A(VT00A88)                                                   
         L     RE,0(RF)                                                         
         ICM   R0,15,TGAMAJS-TGTABLES(RE)                                       
         AR    RE,R0                                                            
         L     RF,=A(TGAMAJS)                                                   
         STCM  RE,15,0(RF)                                                      
*                                                                               
         L     RF,=A(VT00A88)                                                   
         L     RE,0(RF)                                                         
         ICM   R0,15,TGAUSES-TGTABLES(RE)                                       
         AR    RE,R0                                                            
         L     RF,=A(TGAUSES)                                                   
         STCM  RE,15,0(RF)                                                      
*                                                                               
         L     RF,=A(VT00A88)                                                   
         L     RE,0(RF)                                                         
         ICM   R0,15,TGALOCS-TGTABLES(RE)                                       
         AR    RE,R0                                                            
         L     RF,=A(TGALOCS)                                                   
         STCM  RE,15,0(RF)                                                      
*                                                                               
         L     RF,=V(SQUASHER)                                                  
         L     RE,=A(SQUASHER)                                                  
         STCM  RF,15,0(RE)         A(SQUASHER)                                  
*                                                                               
         BAS   RE,TOXINVR          BUILD INVOICE RECORD                         
         BAS   RE,TOXPINVR         BUILD PRIMARY INVOICE-SUBSIDIARY             
         BRAS  RE,TOXNUD           BUILD NETWORK USE DETAILS                    
         BRAS  RE,TOXEJOB          BUILD ESTIMATE/JOB NUMBER                    
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXINVR -  - EXTRACT INVOICE RECORDS 5010                           *         
***********************************************************************         
                                                                                
TOXINVR  NTR1                                                                   
         XC    INVASS,INVASS       INVOICE ASSET PRIMARY KEY                    
         XC    APDEL,APDEL                                                      
         XC    AUHEL,AUHEL                                                      
         XC    ANDEL,ANDEL                                                      
         MVI   PAIDSTA2,0                                                       
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK10CNT,=P'1'                                                    
         DROP  RE                                                               
         USING WORKD,RC                                                         
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX10LEN)                                          
         MVC   TOXRETYP,TOXINVQ                                                 
*                                                                               
         BRAS  RE,TOXISEP          INVOICE SEPARATIONS                          
*                                                                               
         MVC   TX10AGY,TLINAGY     AGENCY                                       
*                                  PRINTED INVOICE NUMBER                       
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         GOTO1 TINVCON,DMCB,DUB,TX10INV,DATCON                                  
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXINVCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX10PINV(L'TLINAGY),TLINAGY                                      
         LA    R6,TX10PINV                                                      
         LA    RE,6                                                             
*                                                                               
TOXIN05  CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXIN05                                                       
*                                                                               
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  INVOICE PRIMARY KEY          
*                                                                               
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXIN10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXIN150                                                         
         CLI   0(R5),TAINELQ       INVOICE STATUS ELEMENT (X'40')               
         JE    TOXIN30                                                          
         CLI   0(R5),TACOELQ       COMMERCIAL DETAILS ELEMENT (X'72')           
         JE    TOXIN40                                                          
         CLI   0(R5),TAVRELQ       VERSIONS ELEMENT (X'7F')                     
         JE    TOXIN50                                                          
         CLI   0(R5),TAPDELQ       PAYMENT DETAILS ELEMENT (X'80')              
         JE    TOXIN60                                                          
         CLI   0(R5),TABDELQ       BILL DETAILS ELEMENT (X'84')                 
         JE    TOXIN70                                                          
         CLI   0(R5),TABDELQ2      BILL DETAILS ELEMENT (X'FB')                 
         JE    TOXIN70                                                          
         CLI   0(R5),TABDELQ3      BILL DETAILS ELEMENT (X'FE')                 
         JE    TOXIN70                                                          
         CLI   0(R5),TABDELQ4      BILL DETAILS ELEMENT (X'EE')                 
         JE    TOXIN70                                                          
         CLI   0(R5),TAACELQ       ACTIVITY ELEMENT                             
         JE    TOXIN80                                                          
         CLI   0(R5),TANUELQ                                                    
         JE    TOXIN90                                                          
         CLI   0(R5),TAFNELQ                                                    
         JE    TOXIN100                                                         
         CLI   0(R5),TADDELQ                                                    
         JE    TOXIN110                                                         
         CLI   0(R5),TACMELQ                                                    
         JE    TOXIN120                                                         
         CLI   0(R5),TALFELQ                                                    
         JE    TOXIN130                                                         
         CLI   0(R5),TACSELQ                                                    
         JE    TOXIN140                                                         
         CLI   0(R5),TACCELQ                                                    
         JE    TOXIN145                                                         
         CLI   0(R5),TAUHELQ                                                    
         JNE   *+8                                                              
         STCM  R5,15,AUHEL                                                      
         CLI   0(R5),TANDELQ                                                    
         JNE   *+12                                                             
         STCM  R5,15,ANDEL                                                      
         J     TOXIN147                                                         
*                                                                               
TOXIN20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXIN10                                                          
*                                                                               
         USING TAIND,R5                                                         
TOXIN30  GOTO1 DATCON,DMCB,(X'01',TAINPDTE),(10,TX10PAYD) PAY DATE              
         GOTO1 DATCON,DMCB,(X'01',TAINBDTE),(10,TX10BILD) BILL DATE             
         GOTO1 DATCON,DMCB,(X'01',TAINCDTE),(20,TX10CKDT) CHECK DATE            
         MVC   INVSTA2,TAINSTA2                                                 
         MVI   TX10URG,C'N'                                                     
         TM    TAINSTA2,TAINSURG   URGENT?                                      
         JZ    *+8                                                              
         MVI   TX10URG,C'Y'                                                     
*                                                                               
         MVI   TX10BHPP,C'N'                                                    
         TM    TAINSTAT,TAINSHLD   BEING HELD UNTIL PUR PAY REC?                
         JZ    *+8                                                              
         MVI   TX10BHPP,C'Y'                                                    
*                                                                               
         MVC   TX10ASC,TAINIST      ASSIGNMENT STAFF                            
         GOTO1 DATCON,DMCB,(X'01',TAINIDTE),(10,TX10AD)  DATE                   
         GOTOR TIMECON,DMCB,TAINITIM,TAINIDTE,(8,TX10AT) TIME                   
*                                                                               
         MVC   TX10PSC,TAINPST      PAYMENT STAFF                               
         GOTO1 DATCON,DMCB,(X'01',TAINPDTE),(10,TX10PAD)  DATE                  
         GOTOR TIMECON,DMCB,TAINPTIM,TAINPDTE,(8,TX10PAT) TIME                  
*                                                                               
         OC    TAINQID,TAINQID                                                  
         JZ    TOXIN31                                                          
         MVC   SVBUID,TAINQID      APPROVAL USER ID                             
         BRAS  RE,GETUSER                                                       
         MVC   TX10APID,SVUSERID                                                
*                                                                               
         MVC   TX10APSC,TAINQST     APPROVAL STAFF                              
         GOTO1 DATCON,DMCB,(X'01',TAINQDTE),(10,TX10APDT) DATE                  
         GOTOR TIMECON,DMCB,TAINQTIM,TAINQDTE,(8,TX10APTM) TIME                 
*                                                                               
TOXIN31  MVC   SVBUID,TAINIID      ASSIGMENT USER ID                            
         BRAS  RE,GETUSER                                                       
         MVC   TX10AUID,SVUSERID                                                
*                                                                               
         MVC   SVBUID,TAINPID      PAYMENT USER ID                              
         BRAS  RE,GETUSER                                                       
         MVC   TX10PUID,SVUSERID                                                
*                                                                               
         MVI   TX10CAN,C'N'                                                     
         TM    TAINSTAT,TAINSCAN   CANCELLED?                                   
         BZ    TOXIN35                                                          
         MVI   TX10CAN,C'Y'                                                     
         MVC   TX10CBIN(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         MVI   DUB+5,X'80'         CANCEL BYTE                                  
         LA    R6,TX10CBIN                                                      
         LA    RE,6                                                             
TOXIN32  CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXIN32                                                       
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  CANCEL INVOICE               
*                                                                               
TOXIN35  MVI   TX10CANO,C'N'                                                    
         TM    TAINSTAT,TAINSCIN   CANCELLOR?                                   
         BZ    *+8                                                              
         MVI   TX10CANO,C'Y'                                                    
*                                                                               
         ZIC   R1,TAINSEQ                                                       
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX10ISEQ,DUB                                                     
*                                                                               
         J     TOXIN20                                                          
         DROP  R5                                                               
*                                                                               
         USING TACOD,R5                                                         
TOXIN40  MVC   TX10VERI,TACOCID    VERSION ID                                   
         MVC   TX10VERN,=C'001'    VERSION NUMBER                               
         MVC   TX10MEDC,TACOMED    MEDIA CODE                                   
         MVC   TX10CMTY,TACOTYPE   COMMERCIAL TYPE                              
         GOTO1 DATCON,DMCB,(X'01',TACOFCYC),(10,TX10FFIX) FFCYCLE               
         GOTO1 DATCON,DMCB,(X'01',TACODUB),(10,TX10DBDT)  DUB DATE              
         GOTO1 DATCON,DMCB,(X'01',TACOAIR),(10,TX10FAIR)  AIR DATE              
         ZIC   R1,TACOSEC          COMMERCIAL LENGTH                            
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX10CMLN,DUB                                                     
         MVC   TX10CTID,TACOCONT   CONTRACT TYPE ID                             
         MVC   TX10ADST,TACOADST   ADDENDUM STATE                               
         MVC   TX10TRKI,TACOTID    TRACK ID                                     
         EDIT  TACOTLN,TX10TRKL,ALIGN=RIGHT,FILL=0,ZERO=BLANK TRK LEN           
         J     TOXIN20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAVRD,R5                                                         
TOXIN50  MVC   TX10VERI,TAVRCID    VERSION ID                                   
*                                                                               
         ZIC   R0,TAVRVERS       VERSION NUMBER                                 
         CVD   R0,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX10VERN,DUB                                                     
         J     TOXIN20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAPDD,R5                                                         
TOXIN60  STCM  R5,15,APDEL         A(TAPD ELEMENT)                              
         MVC   PAIDSTA2,TAPDSTA2                                                
         MVC   INVASS,TAPDCOM                                                   
         SR    R0,R0                                                            
         ICM   R0,1,TAPDTAGS                                                    
         BZ    TOXIN60A                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  TX10TAGS,DUB                                                     
*                                                                               
TOXIN60A MVI   TX10RET,C'N'                                                     
         TM    TAPDOPT3,TAPDORET                                                
         JZ    *+8                                                              
         MVI   TX10RET,C'Y'                                                     
*                                                                               
         MVI   TX10DUM,C'N'                                                     
         TM    TAPDOPT3,TAPDODUM                                                
         JZ    *+8                                                              
         MVI   TX10DUM,C'Y'                                                     
*                                                                               
         MVI   TX10LFT,C'N'                                                     
         TM    TAPDSTAT,TAPDSLFT                                                
         JZ    *+8                                                              
         MVI   TX10LFT,C'Y'                                                     
*                                                                               
         MVI   TX10CRED,C'N'                                                    
         TM    TAPDPST1,TAPDPCRD                                                
         JZ    *+8                                                              
         MVI   TX10CRED,C'Y'                                                    
*                                                                               
         CLC   =C'WSP',TAPDUSE                                                  
         JNE   TOXIN64                                                          
*                                                                               
         BAS   RE,GETUPEL                                                       
         JNE   TOXIN64                                                          
*                                                                               
         USING TAUPD,RF                                                         
         OC    TAUPIMAJ,TAUPIMAJ                                                
         JZ    TOXIN64                                                          
*                                                                               
         USING MAJTABD,R1                                                       
         L     RE,=A(TGAMAJS)      A(MAJORS TABLE)                              
         ICM   R1,15,0(RE)                                                      
*                                                                               
TOXIN61  CLI   0(R1),X'FF'                                                      
         JE    TOXIN64                                                          
         CLC   MAJEQU,TAUPIMAJ                                                  
         BE    *+12                                                             
         LA    R1,MAJNEXT                                                       
         B     TOXIN61                                                          
*                                                                *              
         MVC   TX10IMAJ,MAJCHAR    MAJORS CHARACTERS                            
         DROP  RF,R1                                                            
*                                                                               
TOXIN64  CLC   =C'WSP',TAPDUSE                                                  
         JE    TOXIN66                                                          
         CLC   =C'SWS',TAPDUSE                                                  
         JE    TOXIN66                                                          
         CLC   =C'ADW',TAPDUSE                                                  
         JE    TOXIN66                                                          
         CLC   =C'WSC',TAPDUSE                                                  
         JE    TOXIN66                                                          
         CLC   =C'CBL',TAPDUSE                                                  
         JE    TOXIN66                                                          
         CLC   =C'SCB',TAPDUSE                                                  
         JE    TOXIN66                                                          
         J     TOXIN68                                                          
*                                                                               
TOXIN66  BAS   RE,GETUPEL                                                       
         JNE   TOXIN68                                                          
*                                                                               
         USING TAUPEL,RF                                                        
         SR    R0,R0                                                            
         ICM   R0,3,TAUPIUNT                                                    
         BZ    TOXIN68                                                          
         EDIT  (R0),TX10IUNT,ZERO=NOBLANK,ALIGN=LEFT                            
         DROP  RF                                                               
*                                                                               
TOXIN68  BRAS  RE,INVTAPD                                                       
         J     TOXIN20                                                          
                                                                                
*==============================================================                 
* FIND TAUPEL AND EXIT WITH CC EQUAL IF FOUND, ELSE NEQ                         
*==============================================================                 
                                                                                
GETUPEL  LA    RF,TLINELEM         POINT TO FIRST EL                            
*                                                                               
GETUPEL2 LLC   R0,1(RF)                                                         
         AR    RF,R0                                                            
         CLI   0(RF),0                                                          
         JE    GETUPNEQ                                                         
         CLI   0(RF),TAUPELQ       X'88'                                        
         JNE   GETUPEL2                                                         
         BR    RE                                                               
*                                                                               
GETUPNEQ LTR   RE,RE                                                            
         BR    RE                                                               
*                                                                               
         USING TABDD,R5                                                         
TOXIN70  MVI   TX10CURR,C'U'                                                    
         CLI   TABDEL,TABDELQ3     EURO BILL?                                   
         JNE   *+8                                                              
         MVI   TX10CURR,C'E'                                                    
         CLI   TABDEL,TABDELQ4     CAN$ BILL?                                   
         JNE   *+8                                                              
         MVI   TX10CURR,C'C'                                                    
*                                                                               
         OC    TABDCCVT,TABDCCVT                                                
         JZ    TOXIN72                                                          
         OI    TABDCCVT+L'TABDCCVT-1,X'0F'                                      
         UNPK  TX10CNVR,TABDCCVT   CONVERSION RATE                              
*                                                                               
TOXIN72  EDIT  TABDTOT,TX10IT,2,FLOAT=-,ALIGN=RIGHT     INVOICE TOTAL           
         EDIT  TABDTAX,TX10PT,2,FLOAT=-,ALIGN=RIGHT     PAYROLL TAXES           
         EDIT  TABDHND,TX10HAND,2,FLOAT=-,ALIGN=RIGHT   HANDLING                
         EDIT  TABDHNDC,TX10CH,2,FLOAT=-,ALIGN=RIGHT    CORP HANDLING           
         EDIT  TABDFICR,TX10FC,2,FLOAT=-,ALIGN=RIGHT    FICA CREDIT             
         EDIT  TABDGST,TX10GST,2,FLOAT=-,ALIGN=RIGHT    GST                     
*                                                                               
         MVC   TX10ACOM,=C'        .00'                                         
         MVC   TX10SF,=C'        .00'                                           
         MVC   TX10PST,=C'        .00'                                          
         MVC   TX10CSF,=C'        .00'                                          
*                                                                               
         CLI   TABDLEN,TABDLN2Q                                                 
         JL    TOXIN20                                                          
         EDIT  TABDACOM,TX10ACOM,2,FLOAT=-,ALIGN=RIGHT  AGY COMISSION           
         EDIT  TABDSIGN,TX10SF,2,FLOAT=-,ALIGN=RIGHT    SIGNATORY FEE           
         EDIT  TABDPST,TX10PST,2,FLOAT=-,ALIGN=RIGHT    PST                     
         EDIT  TABDCSF,TX10CSF,2,FLOAT=-,ALIGN=RIGHT    CSF                     
         J     TOXIN20                                                          
*                                                                               
         USING TAACD,R5                                                         
TOXIN80  MVC   SVBUID,TAACID       USER ID                                      
         BRAS  RE,GETUSER                                                       
*                                                                               
         CLI   TAACSCR,X'44'       INVOICE/CANCEL                               
         JNE   TOXIN82                                                          
         CLI   TX10CAN,C'Y'        CANCELLED?                                   
         JNE   TOXIN20                                                          
         MVC   TX10CBUI,SVUSERID                                                
         MVC   TX10CBSC,TAACSTAF                                                
*                                                                               
TOXIN82  CLI   TAACSCR,X'27'       HISTORY                                      
         JNE   TOXIN84                                                          
         MVC   TX10LHCU,SVUSERID                                                
         MVC   TX10LHCS,TAACSTAF                                                
         GOTO1 DATCON,DMCB,(X'01',TAACCDTE),(10,TX10LHCD)  CHANGE DATE          
*                                                                               
TOXIN84  CLI   TAACSCR,X'D0'       ISPLIT                                       
         JNE   TOXIN86                                                          
         MVC   TX10LICU,SVUSERID                                                
         MVC   TX10LICS,TAACSTAF                                                
         GOTO1 DATCON,DMCB,(X'01',TAACCDTE),(10,TX10LICD)  CHANGE DATE          
         J     TOXIN20                                                          
*                                                                               
TOXIN86  CLI   TAACSCR,X'A0'       PUR RELEASE?                                 
         JNE   TOXIN20                                                          
         MVC   TX10PRSC,TAACSTAF   RELEASE STAFF                                
         GOTO1 DATCON,DMCB,(X'01',TAACCDTE),(10,TX10PRDT) DATE                  
         GOTOR TIMECON,DMCB,TAACCTIM,TAACCDTE,(8,TX10PRTM) TIME                 
*                                                                               
         MVC   SVBUID,TAACID       RELEAS USER ID                               
         BRAS  RE,GETUSER                                                       
         MVC   TX10PRUI,SVUSERID                                                
         J     TOXIN20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXIN90  CLI   TANUTYPE,TANUTAUT   AUTH/PO?                                     
         JNE   TOXIN92                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10AUTH(0),TANUMBER                                             
         J     TOXIN20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXIN92  CLI   TANUTYPE,TANUTSIG   AGY/CLI SIGNATORY?                           
         JNE   TOXIN95                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10ACSG(0),TANUMBER                                             
         J     TOXIN20                                                          
*                                                                               
TOXIN95  CLI   TANUTYPE,TANUTINV   INVOICE NUMBER BEING CREDITED                
         JNE   TOXIN97                                                          
         GOTO1 TINVCON,DMCB,TANUMBER,TX10INVC,DATCON                            
         J     TOXIN20                                                          
*                                                                               
TOXIN97  CLI   TANUTYPE,TANURT4I   RETRO FOR INVOICE NUMBER                     
         JNE   TOXIN20                                                          
         GOTO1 TINVCON,DMCB,TANUMBER,TX10RTIN,DATCON                            
         J     TOXIN20                                                          
         DROP  R5                                                               
                                                                                
         USING TAFND,R5                                                         
TOXIN100 CLI   TAFNTYPE,TAFNTASC                                                
         JNE   TOXIN103                                                         
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10OASC(0),TAFNNAME                                             
         J     TOXIN20                                                          
*                                                                               
TOXIN103 CLI   TAFNTYPE,TAFNTTTL   COMMERCIAL TITLE                             
         JNE   TOXIN105                                                         
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10CMTT(0),TAFNNAME                                             
         J     TOXIN20                                                          
*                                                                               
TOXIN105 CLI   TAFNTYPE,TAFNTPRD   PRODUCT NAME                                 
         JNE   TOXIN20                                                          
         ZIC   R1,TAFNLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10PRNM(0),TAFNNAME                                             
         J     TOXIN20                                                          
*                                                                               
         USING TADDD,R5                                                         
TOXIN110 GOTO1 DATCON,DMCB,(X'01',TADDDATE),(10,TX10DD)  DUE DATE               
         J     TOXIN20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXIN120 CLI   TACMTYPE,TACMTYPH   HISTORY COMMENT                              
         JNE   TOXIN125                                                         
         ZIC   R1,TACMLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10HCMT(0),TACMCOMM                                             
         J     TOXIN20                                                          
                                                                                
TOXIN125 CLI   TACMTYPE,TACMTYPG   INVOICE COMMENT                              
         JNE   TOXIN20                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX10ICMT(0),TACMCOMM                                             
         J     TOXIN20                                                          
         DROP  R5                                                               
*                                                                               
         USING TALFD,R5                                                         
TOXIN130 MVC   TX10LID,TALFLID     LIFT ID                                      
         ZIC   R1,TALFSEC          LIFT LENGTH                                  
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX10LLN,DUB                                                      
         J     TOXIN20                                                          
         DROP  R5                                                               
*                                                                               
TOXIN140 BRAS  RE,INVTACS          COMMERCIAL STUDIO DETAILS                    
         J     TOXIN20                                                          
                                                                                
TOXIN145 BRAS  RE,INVTCCS          COMMERCIAL CONTRACT DETAILS                  
         J     TOXIN20                                                          
                                                                                
TOXIN147 BRAS  RE,INVTNDS          NETWORK/CLASS A DETAILS                      
         J     TOXIN20                                                          
                                                                                
TOXIN150 OC    APDEL,APDEL         DOES IT HAVE A TAPD ELEMENT?                 
         JZ    TOXINVXX                                                         
*                                                                               
         GOTOR STUDETS,DMCB,0(R3)                                               
         L     RF,=A(MYBLOCK)                                                   
         MVC   TX10HLUD,0(RF)                                                   
*                                                                               
TOXINVXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
APDEL    DS    XL4                                                              
AUHEL    DS    XL4                                                              
ANDEL    DS    XL4                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXINVR -  - EXTRACT INVOICE RECORDS 5010                           *         
***********************************************************************         
         USING TLIND,R3                                                         
TOXPINVR NTR1                                                                   
         TM    INVSTA2,TAINSPRM    PRIMARY INVOICE?                             
         JZ    TOXPINVX                                                         
*                                                                               
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXPIN10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPINVX                                                         
         CLI   0(R5),TASIELQ       SUBSIDIARY INVOICE ELEMENT (X'95')           
         JE    TOXPIN30                                                         
*                                                                               
TOXPIN20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPIN10                                                         
*                                                                               
         USING PKCNTS,RE                                                        
TOXPIN30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK15CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX15LEN)                                          
         MVC   TOXRETYP,TOXPINVQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX15PINV-1,MXTRTQ                                                
         MVI   TX15SINV-1,MXTRTQ                                                
         MVI   TX15ASS-1,MXTRTQ                                                 
         MVI   TX15X,MXTRTQ                                                     
         MVI   TX15X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX15PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX15PINV                                                      
         LA    RE,6                                                             
TOXPIN40 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXPIN40                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         MVC   TX15SINV(L'TLINAGY),TLINAGY                                      
*                                                                               
         USING TASID,R5                                                         
         MVC   DUB(6),TASIINV                                                   
*                                                                               
         LA    R6,TX15SINV                                                      
         LA    RE,6                                                             
*                                                                               
TOXPIN50 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXPIN50                                                      
*                                                                               
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TASIINV,0  SUBSIDIARY INV PRIM          
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX15ASS,L'FULL,0   ASSET PR KEY              
         J     TOXPIN20                                                         
         DROP  R5                                                               
*                                                                               
TOXPINVX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCGRC - EXTRACT CLIENT GROUP RECORDS - 5021                       *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(CLIENT GROUP RECORD)                                          *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXCGRC  NMOD1 WORKX-WORKD,*TOXCGR*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXCGRLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCGD,R3            R3=A(CLIENT GROUP RECORD)                    
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXCGBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXCGNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXCGRCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXCGRLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXCGNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX21LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX21LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXCGBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXCGRR          BUILD CLIENT GROUP RECORD                    
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXCGRR -  - EXTRACT CLIENT GROUP RECORDS - 5021                    *         
***********************************************************************         
                                                                                
TOXCGRR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK21CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX21LEN)                                          
         MVC   TOXRETYP,TOXCGRPQ                                                
*                                                                               
         MVI   TX21CODE-1,MXTRTQ                                                
         MVI   TX21NAME-1,MXTRTQ                                                
         MVI   TX21X,MXTRTQ                                                     
         MVI   TX21X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX21CODE,TLCGCLG    CLIENT GRUP                                  
*                                                                               
         LH    RF,=Y(TX21LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXCGRCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLCGELEM         R5=A(FIRST ELEMENT)                          
TOXCG10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXCGRXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXCG30                                                          
*                                                                               
TOXCG20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXCG10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXCG30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXCG20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX21NAME(0),TANANAME                                             
         J     TOXCG20                                                          
         DROP  R5                                                               
*                                                                               
TOXCGRXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXAGRC - EXTRACT AGENCY GROUP RECORDS - 5024                       *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(CLIENT RECORD)                                                *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
                                                                                
TOXAGRC  NMOD1 WORKX-WORKD,*TOXAGR*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXAGRLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLAGD,R3            R3=A(AGENCY GROUP RECORD)                    
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         SR    R0,R0               INITIALIZE TOXRECD TO SPACES                 
         SR    R1,R1                                                            
         ICM   R1,8,SPACES                                                      
         LR    RE,R2                                                            
         AHI   RE,TOXREHDL                                                      
         LA    RF,TX24LEN                                                       
         SHI   RF,TOXREHDL                                                      
         MVCL  RE,R0                                                            
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX24LEN)                                          
         MVC   TOXRETYP,TOXAGRPQ                                                
*                                                                               
         MVI   TX24AGRP-1,MXTRTQ                                                
         MVI   TX24NAME-1,MXTRTQ                                                
         MVI   TX24X,MXTRTQ                                                     
         MVI   TX24X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX24AGRP,TLAGAGG    AGENCY GROUP                                 
*                                                                               
         LA    R5,TLAGELEM         R5=A(FIRST ELEMENT)                          
TOXAGR10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXAGRXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXAGR30                                                         
*                                                                               
TOXAGR20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXAGR10                                                         
*                                                                               
         USING TANAD,R5                                                         
TOXAGR30 SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,3                                                             
         JM    TOXAGRXX                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX24NAME(0),TANANAME                                             
         J     TOXAGR20                                                         
*                                                                               
TOXAGRXX J     EXIT                                                             
         DROP  R2,R3,R4                                                         
*                                                                               
TOXAGRLT DC    A(LITERAL)                                                       
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXAREC - EXTRACT AREA RECORD - 5028                                *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(AREA RECORD)                                                  *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
                                                                                
TOXAREC  NMOD1 WORKX-WORKD,*TOXARE*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXARELT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLARD,R3            R3=A(AREA RECORD)                            
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         SR    R0,R0               INITIALIZE TOXRECD TO SPACES                 
         SR    R1,R1                                                            
         ICM   R1,8,SPACES                                                      
         LR    RE,R2                                                            
         AHI   RE,TOXREHDL                                                      
         LA    RF,TX28LEN                                                       
         SHI   RF,TOXREHDL                                                      
         MVCL  RE,R0                                                            
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX28LEN)                                          
         MVC   TOXRETYP,TOXAREAQ                                                
*                                                                               
         MVI   TX28CODE-1,MXTRTQ                                                
         MVI   TX28NAME-1,MXTRTQ                                                
         MVI   TX28X,MXTRTQ                                                     
         MVI   TX28X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX28CODE,TLARAREA   CODE                                         
*                                                                               
         LA    R5,TLARELEM         R5=A(FIRST ELEMENT)                          
TOXAR10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXAREXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXAR30                                                          
*                                                                               
TOXAR20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXAR10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXAR30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,3                                                             
         JM    TOXAREXX                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX28NAME(0),TANANAME                                             
         J     TOXAR20                                                          
*                                                                               
TOXAREXX J     EXIT                                                             
         DROP  R2,R3,R4                                                         
*                                                                               
TOXARELT DC    A(LITERAL)                                                       
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXPUSC - EXTRACT PRINT USE RECORD - 5028                           *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRINT USE RECORD)                                             *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
***********************************************************************         
                                                                                
TOXPUSC  NMOD1 WORKX-WORKD,*TOXPUS*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXPUSLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLUSD,R3            R3=A(PRINT USE RECORD)                       
         USING SXDTABD,R4          R4=A(SXDXTABD)                               
*                                                                               
         SR    R0,R0               INITIALIZE TOXRECD TO SPACES                 
         SR    R1,R1                                                            
         ICM   R1,8,SPACES                                                      
         LR    RE,R2                                                            
         AHI   RE,TOXREHDL                                                      
         LA    RF,TX29LEN                                                       
         SHI   RF,TOXREHDL                                                      
         MVCL  RE,R0                                                            
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX29LEN)                                          
         MVC   TOXRETYP,TOXPUSEQ                                                
*                                                                               
         MVI   TX29USE-1,MXTRTQ                                                 
         MVI   TX29NAME-1,MXTRTQ                                                
         MVI   TX29X,MXTRTQ                                                     
         MVI   TX29X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX29USE,TLUSUSE     USE                                          
*                                                                               
         LA    R5,TLUSELEM         R5=A(FIRST ELEMENT)                          
TOXPU10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPUSXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXPU30                                                          
*                                                                               
TOXPU20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPU10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXPU30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,3                                                             
         JM    TOXPUSXX                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX29NAME(0),TANANAME                                             
         J     TOXPU20                                                          
*                                                                               
TOXPUSXX J     EXIT                                                             
         DROP  R2,R3,R4                                                         
*                                                                               
TOXPUSLT DC    A(LITERAL)                                                       
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGUAC - EXTRACT GUARANTEE RECORDS - 5030                          *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GUARANTEE RECORD)                                             *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXGUAC  NMOD1 WORKX-WORKD,*TOXGUA*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXGUALT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         MVC   VT00A88,20(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLGUD,R3            R3=A(GUARANTEE RECORD)                       
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXGUBLD            BUILD GUARANTEE AND SUBSET RECS              
         JH    TOXGUNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXGUACC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXGUALT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXGUNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX30LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX30LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXGUBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXGUAR          BUILD GUARANTEE RECORD                       
         BAS   RE,TOXGUACR         BUILD GUARANTEE AGENCY-CLIENT                
         BAS   RE,TOXGUPCR         BUILD GUARANTEE PERIOD-CYCLE                 
         BAS   RE,TOXGUEUR         BUILD GUARANTEE EXCLUDED USE                 
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXGUAR -  - EXTRACT GUARANTEE RECORDS 5030                         *         
***********************************************************************         
TOXGUAR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK30CNT,=P'1'                                                    
         DROP  RE                                                               
         USING WORKD,RC                                                         
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
***      MVC   TOXRELEN(2),=Y(TX32LEN)                                          
         MVC   TOXRELEN(2),=Y(TX30LEN)                                          
         MVC   TOXRETYP,TOXGUARQ                                                
*                                                                               
         MVI   TX30GUAR-1,MXTRTQ                                                
         MVI   TX30PID-1,MXTRTQ                                                 
         MVI   TX30CODE-1,MXTRTQ                                                
         MVI   TX30TYPE-1,MXTRTQ                                                
         MVI   TX30W4C-1,MXTRTQ                                                 
         MVI   TX30GCON-1,MXTRTQ                                                
         MVI   TX30OP-1,MXTRTQ                                                  
         MVI   TX30IFE-1,MXTRTQ                                                 
         MVI   TX30PPNH-1,MXTRTQ                                                
         MVI   TX30LOCK-1,MXTRTQ                                                
         MVI   TX30MSC-1,MXTRTQ                                                 
         MVI   TX30DBAL-1,MXTRTQ                                                
         MVI   TX30PCAP-1,MXTRTQ                                                
         MVI   TX30CIPK-1,MXTRTQ                                                
         MVI   TX30X,MXTRTQ                                                     
         MVI   TX30X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLGUSSN,DUB                                         
         MVC   TX30GUAR(6),DUB     SOCIAL SECURITY NUMBER                       
         MVC   TX30PID,DUB         PID                                          
*                                                                               
         MVC   FULL,TLGUGUA                                                     
         XC    FULL,=X'FFFFFFFF'                                                
         MVC   TX30GUAR+6(L'FULL),FULL  TLGUSSN+TLGUGUA(UNCOMPLEMENTED)         
         MVC   TX30CODE,FULL       CODE                                         
         MVC   TX30PCAP,SPACES                                                  
*                                                                               
         MVC   GUARKEY,TX30GUAR    SAVE GUARANTEE PRIMARY KEY                   
*                                                                               
***      LH    RF,=Y(TX32LEN)                                                   
         LH    RF,=Y(TX30LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXGUACC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLGUELEM         R5=A(FIRST ELEMENT)                          
TOXGUA10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGUAXX                                                         
         CLI   0(R5),TAGUELQ       GUARANTEE DETAILS ELEMENT (X'61')            
         JE    TOXGUA30                                                         
*                                                                               
TOXGUA20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGUA10                                                         
*                                                                               
         USING TAGUD,R5                                                         
TOXGUA30 MVI   TX30TYPE,C'P'       PER CYCLE GUARANTEE                          
         MVI   TX30DBAL,C'N'                                                    
         TM    TAGUSTAT,TAGUSDES   DESCENDING BALANCE                           
         JZ    *+8                                                              
         MVI   TX30DBAL,C'Y'                                                    
*                                                                               
*                                                                               
**       OC    TAGUCOM,TAGUCOM                                                  
**       JNZ   TOXGUA32                                                         
         OC    TAGUCOM,TAGUCOM                                                  
         JZ    TOXGUA31                                                         
         GOTO1 VHEXOUT,DMCB,TAGUCOM,TX30PCAP,L'TAGUCOM,0                        
         J     TOXGUA32                                                         
TOXGUA31 MVI   TX30TYPE,C'L'       LARGE SCALE GUARANTEE                        
*                                                                               
         MVI   TX30OP,C'N'                                                      
         TM    TAGUSTAT,TAGUSOVR   OVERAGE PAID?                                
         JZ    *+8                                                              
         MVI   TX30OP,C'Y'                                                      
         MVI   TX30IFE,C'N'                                                     
         TM    TAGUSTA2,TAGUSIGP   IGNORE FOR ESTIMATING?                       
         JZ    *+8                                                              
         MVI   TX30IFE,C'Y'                                                     
         MVI   TX30PPNH,C'N'                                                    
         TM    TAGUSTAT,TAGUSPNH   PAY P&H ON USE?                              
         JZ    *+8                                                              
         MVI   TX30PPNH,C'Y'                                                    
         MVI   TX30LOCK,C'N'                                                    
         TM    TAGUSTAT,TAGUSLCK   LOCKED?                                      
         JZ    *+8                                                              
         MVI   TX30LOCK,C'Y'                                                    
         MVI   TX30MSC,C'N'                                                     
         TM    TAGUSTA2,TAGUSMSC   MULTI-SERVICE CONTRACT?                      
         JZ    *+8                                                              
         MVI   TX30MSC,C'Y'                                                     
*                                                                               
TOXGUA32 OC    TAGUCRP,TAGUCRP     CORP?                                        
         JZ    TOXGUA34                                                         
         MVC   TX30W4C(6),TX30GUAR                                              
*                                                                               
         ZIC   R1,TAGUCRP          CORP NUMBER                                  
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  BYTE,DUB                                                         
         MVC   TX30W4C+6(1),BYTE                                                
*                                                                               
TOXGUA34 OC    TAGUGCNT,TAGUGCNT                                                
         JZ    TOXGUA36                                                         
         MVC   TX30GCON(6),TX30GUAR                                             
         MVC   FULL,TAGUGCNT                                                    
         XC    FULL,=X'FFFFFFFF'                                                
         L     R1,FULL             UNCOMPLEMENT GRT CONTRACT CODE               
         AHI   R1,1                                                             
         EDIT  (R1),DUB,0,ALIGN=RIGHT                                           
         OC    DUB,=C'00000000'                                                 
         MVC   TX30GCON+6(6),DUB+2                                              
         MVC   TX30GCON+6(2),=C'GC'                                             
*                                                                               
TOXGUA36 OC    TAGUIAY,TAGUIAY       CREATED BY INVOICE?                        
         JZ    TOXGUA38                                                         
         OC    TAGUINV,TAGUINV                                                  
         JZ    TOXGUA38                                                         
*                                                                               
         MVC   DUB(6),TAGUINV                                                   
         MVC   TX30CIPK(L'TAGUIAY),TAGUIAY                                      
         LA    R6,TX30CIPK                                                      
         LA    RE,6                                                             
*                                                                               
TOXGUA37 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXGUA37                                                      
*                                                                               
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TAGUINV,0  INVOICE PRIMARY KEY          
*                                                                               
TOXGUA38 J     TOXGUA20                                                         
         DROP  R5                                                               
*                                                                               
TOXGUAXX J     EXIT                                                             
         EJECT                                                                  
         LTORG                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGUACR-  - GUARANTEE AGENCY-CLIENT 5031                           *         
***********************************************************************         
                                                                                
TOXGUACR NTR1                                                                   
         LA    R5,TLGUELEM         R5=A(FIRST ELEMENT)                          
TOXGAC10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGACRX                                                         
         CLI   0(R5),TAGUELQ       GUARANTEE DETAILS ELEMENT (X'61')            
         JE    TOXGAC30                                                         
*                                                                               
TOXGAC20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGAC10                                                         
*                                                                               
         USING TAGUD,R5                                                         
TOXGAC30 OC    TAGUAGY,TAGUAGY                                                  
         JNZ   TOXGAC32                                                         
         OC    TAGUCLI,TAGUCLI                                                  
         JZ    TOXGAC20                                                         
*&&DO                                                                           
TOXGAC32 MVC   PRIAGY,TAGUAGY                                                   
         MVC   PRICLI,TAGUCLI                                                   
         MVI   PROSTAT,0                                                        
*                                                                               
TOXGAC40 BRAS  RE,CLRTBL           CLEAR TABLE                                  
         BRAS  RE,BLDACTBL         AND BUILD IT                                 
*                                                                               
         CLI   ACTBL,X'FF'                                                      
         JE    TOXGACRX                                                         
*                                                                               
         LA    R6,ACTBL                                                         
         USING ACTBLD,R6                                                        
*&&                                                                             
TOXGAC32 BRAS  RE,BLDTBL           CLEAR TABLE & BUILD IT                       
*                                  FULL HAS A(ACTBL)                            
         L     RE,FULL                                                          
         CLI   0(RE),X'FF'                                                      
         JE    TOXGACRX                                                         
*                                                                               
         L     R6,FULL                                                          
         USING ACTBLD,R6                                                        
*                                                                               
TOXGAC50 CLI   0(R6),X'FF'                                                      
         JE    TOXGACRX                                                         
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK31CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
***      LH    RF,=Y(TX32LEN)                                                   
         LH    RF,=Y(TX30LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
***      MVC   TOXRELEN(2),=Y(TX32LEN)                                          
         MVC   TOXRELEN(2),=Y(TX30LEN)                                          
         MVC   TOXRETYP,TOXGUACQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX31GUAR-1,MXTRTQ                                                
         MVI   TX31AGY-1,MXTRTQ                                                 
         MVI   TX31CLI-1,MXTRTQ                                                 
         MVI   TX31PAC-1,MXTRTQ                                                 
         MVI   TX31X,MXTRTQ                                                     
         MVI   TX31X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX31GUAR,GUARKEY    GUARANTEE PRIMARY KEY                        
         MVC   TX31AGY,ACAGY       AGENCY                                       
         MVC   TX31CLI,ACCLI       CLIENT                                       
         MVI   TX31PAC,C'N'                                                     
         CLI   ACSTAT,0                                                         
         JE    *+8                                                              
         MVI   TX31PAC,C'Y'                                                     
*                                                                               
         AHI   R6,ACLNQ                                                         
         J     TOXGAC50                                                         
         DROP  R5,R6                                                            
*                                                                               
TOXGACRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
GUARKEY  DS    CL(L'TX30GUAR)      GUARANTEE PRIMARY KEY                        
VT00A88  DS    A                   A(TASYSTAB)                                  
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGUPCR-  - GUARANTEE PERIOD-CYCLE 5032                            *         
***********************************************************************         
                                                                                
         USING TLGUD,R3            R3=A(GUARANTEE RECORD)                       
TOXGUPCR NTR1                                                                   
         MVC   TMPCOUNT,=F'1'                                                   
*                                                                               
         LA    R5,TLGUELEM         R5=A(FIRST ELEMENT)                          
TOXGPC10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGPCRX                                                         
         CLI   0(R5),TAGUELQ       GUARANTEE DETAILS ELEMENT (X'61')            
         JE    TOXGPC30                                                         
*                                                                               
TOXGPC20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGPC10                                                         
*                                                                               
         USING TAGUD,R5                                                         
TOXGPC30 OC    TAGUCOM,TAGUCOM                                                  
         JNZ   TOXGPC50                                                         
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK32CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
***      LH    RF,=Y(TX32LEN)                                                   
         LH    RF,=Y(TX30LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
***      MVC   TOXRELEN(2),=Y(TX32LEN)                                          
         MVC   TOXRELEN(2),=Y(TX30LEN)                                          
         MVC   TOXRETYP,TOXGUPCQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX32GUAR-1,MXTRTQ                                                
         MVI   TX32SEQ-1,MXTRTQ                                                 
         MVI   TX32SDTE-1,MXTRTQ                                                
         MVI   TX32EDTE-1,MXTRTQ                                                
         MVI   TX32AMT-1,MXTRTQ                                                 
         MVI   TX32BAL-1,MXTRTQ                                                 
         MVI   TX32X,MXTRTQ                                                     
         MVI   TX32X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX32GUAR,GUARKEY    GUARANTEE PRIMARY KEY                        
         MVC   TX32SEQ,=C'001'                                                  
         EDIT  TAGUAMT,TX32AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         EDIT  TAGUBAL,TX32BAL,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
         OC    TAGUSTRT,TAGUSTRT                                                
         JZ    TOXGPC32                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGUSTRT),(10,TX32SDTE) PERIOD START          
TOXGPC32 OC    TAGUEND,TAGUEND                                                  
         JZ    TOXGPC34                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGUEND),(10,TX32EDTE)  PERIOD END            
TOXGPC34 J     TOXGACRX                                                         
         DROP  R5                                                               
*                                                                               
TOXGPC50 LA    R5,TLGUELEM         R5=A(FIRST ELEMENT)                          
TOXGPC60 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGPCRX                                                         
         CLI   0(R5),TAGCELQ       GUARANTEE DETAILS ELEMENT (X'62')            
         JE    TOXGPC80                                                         
*                                                                               
TOXGPC70 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGPC60                                                         
*                                                                               
         USING TAGCD,R5                                                         
         USING PKCNTS,RE                                                        
TOXGPC80 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK32CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
***      LH    RF,=Y(TX32LEN)                                                   
         LH    RF,=Y(TX30LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
***      MVC   TOXRELEN(2),=Y(TX32LEN)                                          
         MVC   TOXRELEN(2),=Y(TX30LEN)                                          
         MVC   TOXRETYP,TOXGUPCQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX32GUAR-1,MXTRTQ                                                
         MVI   TX32SEQ-1,MXTRTQ                                                 
         MVI   TX32SDTE-1,MXTRTQ                                                
         MVI   TX32EDTE-1,MXTRTQ                                                
         MVI   TX32AMT-1,MXTRTQ                                                 
         MVI   TX32BAL-1,MXTRTQ                                                 
         MVI   TX32X,MXTRTQ                                                     
         MVI   TX32X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX32GUAR,GUARKEY    GUARANTEE PRIMARY KEY                        
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX32SEQ,DUB                                                      
*                                                                               
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         EDIT  TAGCAMT,TX32AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         EDIT  TAGCBAL,TX32BAL,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
         OC    TAGCSTRT,TAGCSTRT                                                
         JZ    TOXGPC82                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGCSTRT),(10,TX32SDTE) PERIOD START          
TOXGPC82 OC    TAGCEND,TAGCEND                                                  
         JZ    TOXGPC84                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGCEND),(10,TX32EDTE)  PERIOD END            
TOXGPC84 J     TOXGPC70                                                         
         DROP  R5                                                               
*                                                                               
TOXGPCRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGUEUR-  - GUARANTEE EXCLUDED USE 5040                            *         
***********************************************************************         
                                                                                
         USING TLGUD,R3            R3=A(GUARANTEE RECORD)                       
TOXGUEUR NTR1                                                                   
         MVC   TMPCOUNT,=F'1'                                                   
*                                                                               
         LA    R5,TLGUELEM         R5=A(FIRST ELEMENT)                          
TOXGEU10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGEURX                                                         
         CLI   0(R5),TAGXELQ       GUARANTEE EXCLUDED USES (X'67')              
         JE    TOXGEU30                                                         
*                                                                               
TOXGEU20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGEU10                                                         
*                                                                               
         USING TAGXD,R5                                                         
TOXGEU30 ZIC   R7,TAGXLEN                                                       
         SHI   R7,TAGXLNQ          # OF USES TO PROCESS                         
         LA    RF,TAGXUSE                                                       
         ST    RF,TMPADDR                                                       
*                                                                               
TOXGEU32 L     R5,VT00A88                                                       
         ICM   R0,15,TGAUSES-TGTABLES(R5)                                       
         AR    R5,R0                                                            
         USING USETABD,R5                                                       
*                                                                               
TOXGEU34 CLI   0(R5),X'FF'                                                      
         JE    TOXGEU40                                                         
*                                                                               
         L     RF,TMPADDR                                                       
         CLC   USEEQU,0(RF)                                                     
         JE    TOXGEU38                                                         
*                                                                               
         SR    R1,R1                                                            
         LH    R1,USELEN                                                        
         AR    R5,R1                                                            
         J     TOXGEU34                                                         
*                                                                               
         USING PKCNTS,RE                                                        
TOXGEU38 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK40CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
***      LH    RF,=Y(TX32LEN)                                                   
         LH    RF,=Y(TX30LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX40LEN)                                          
         MVC   TOXRETYP,TOXGUEUQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX40GUAR-1,MXTRTQ                                                
         MVI   TX40SEQ-1,MXTRTQ                                                 
         MVI   TX40UTC-1,MXTRTQ                                                 
         MVI   TX40X,MXTRTQ                                                     
         MVI   TX40X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX40GUAR,GUARKEY    GUARANTEE PRIMARY KEY                        
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX40SEQ,DUB                                                      
*                                                                               
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         MVC   TX40UTC,USECDE      USE CODE                                     
*                                                                               
TOXGEU40 L     RF,TMPADDR                                                       
         AHI   RF,1                                                             
         ST    RF,TMPADDR                                                       
*                                                                               
         BCT   R7,TOXGEU32                                                      
         DROP  R5                                                               
*                                                                               
TOXGEURX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGUCC - EXTRACT GUARANTEE CONTRACT RECORDS - 5033                 *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GUARANTEE CONTRACT RECORD)                                    *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXGUCC  NMOD1 WORKX-WORKD,*TOXGUC*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXGUCLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLGCD,R3            R3=A(GUARANTEE CONTRACT RECORD)              
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXGCBLD            BUILD GUARANTEE AND SUBSET RECS              
         JH    TOXGCNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXGUCCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXGUCLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXGCNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX34LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX34LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXGCBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXGUCR          BUILD GUARANTEE CONTRACT RECORD              
         BAS   RE,TOXGUCYR         BUILD GUARANTEE CONTRACT YEAR                
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXGUCR -  - EXTRACT GUARANTEE CONTRACT RECORDS 5033                *         
***********************************************************************         
                                                                                
TOXGUCR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK33CNT,=P'1'                                                    
         DROP  RE                                                               
         USING WORKD,RC                                                         
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX34LEN)                                          
         MVC   TOXRETYP,TOXGUCQ                                                 
*                                                                               
         MVI   TX33GUAR-1,MXTRTQ                                                
         MVI   TX33PID-1,MXTRTQ                                                 
         MVI   TX33GCON-1,MXTRTQ                                                
         MVI   TX33X,MXTRTQ                                                     
         MVI   TX33X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLGCSSN,DUB                                         
         MVC   TX33GUAR(6),DUB     SOCIAL SECURITY NUMBER                       
         MVC   TX33PID,DUB         PID                                          
         MVC   TX33GUAR+6(2),=C'GC'                                             
*                                                                               
         MVC   FULL,TLGCGCNT                                                    
         XC    FULL,=X'FFFFFFFF'                                                
         L     R1,FULL                                                          
         AHI   R1,1                                                             
         EDIT  (R1),DUB,0,ALIGN=RIGHT                                           
         OC    DUB,=C'00000000'                                                 
         MVC   TX33GUAR+8(4),DUB+4                                              
         MVC   TX33GCON,TX33GUAR+6 CODE                                         
*                                                                               
         MVC   GUARCKEY,TX33GUAR                                                
*                                                                               
         LH    RF,=Y(TX34LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXGUCCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
TOXGUCXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
GUARCKEY DS    CL(L'TX33GUAR)      GUARANTEE CONTRACT PRIMARY KEY               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGUCYR-  - GUARANTEE YEAR 5034                                    *         
***********************************************************************         
                                                                                
TOXGUCYR NTR1                                                                   
         MVC   TMPCOUNT,=F'1'                                                   
*                                                                               
         LA    R5,TLGCELEM         R5=A(FIRST ELEMENT)                          
TOXGCY10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGCYRX                                                         
         CLI   0(R5),TAGCELQ       GUARANTEE CYCLE ELEMENT (X'62')              
         JE    TOXGCY30                                                         
*                                                                               
TOXGCY20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGCY10                                                         
*                                                                               
         USING TAGCD,R5                                                         
         USING PKCNTS,RE                                                        
TOXGCY30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK34CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX34LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX34LEN)                                          
         MVC   TOXRETYP,TOXGUCYQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX34GCON-1,MXTRTQ                                                
         MVI   TX34SEQ-1,MXTRTQ                                                 
         MVI   TX34SDTE-1,MXTRTQ                                                
         MVI   TX34EDTE-1,MXTRTQ                                                
         MVI   TX34PNH-1,MXTRTQ                                                 
         MVI   TX34BAL-1,MXTRTQ                                                 
         MVI   TX34X,MXTRTQ                                                     
         MVI   TX34X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX34GCON,GUARCKEY   GUARANTEE CONTRACT PRIMARY KEY               
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX34SEQ,DUB                                                      
*                                                                               
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         EDIT  TAGCAMT,TX34PNH,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         EDIT  TAGCBAL,TX34BAL,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
         OC    TAGCSTRT,TAGCSTRT                                                
         JZ    TOXGCY32                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGCSTRT),(10,TX34SDTE) PERIOD START          
TOXGCY32 OC    TAGCEND,TAGCEND                                                  
         JZ    TOXGCY34                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGCEND),(10,TX34EDTE)  PERIOD END            
TOXGCY34 J     TOXGCY20                                                         
         DROP  R5                                                               
*                                                                               
TOXGCYRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGCCC - EXTRACT GUARANTEE COMMENT RECORDS - 50353                 *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GUARANTEE COMMENT RECORD)                                     *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXGCCC  NMOD1 WORKX-WORKD,*TOXGCC*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXGCCLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCMD,R3            R3=A(GUARANTEE CONTRACT RECORD)              
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXGMBLD            BUILD GUARANTEE AND SUBSET RECS              
         JH    TOXGMNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXGCCCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXGCCLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXGMNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX35LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX35LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXGMBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXGCCR          BUILD GUARANTEE COMMENT RECORD               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXGCCR -  - GUARANTEE COMMENT 5035                                 *         
***********************************************************************         
                                                                                
TOXGCCR  NTR1                                                                   
         MVC   TMPCOUNT,=F'1'                                                   
         STCM  R2,15,ANEXT2                                                     
         STCM  R2,15,ANEXT                                                      
*                                                                               
         LA    R5,TLCMELEM         R5=A(FIRST ELEMENT)                          
TOXGCC10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGCCRX                                                         
         CLI   0(R5),TAXCELQ       GUARANTEE CYCLE ELEMENT (X'62')              
         JE    TOXGCC30                                                         
*                                                                               
TOXGCC20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGCC10                                                         
*                                                                               
         USING TAXCD,R5                                                         
         USING PKCNTS,RE                                                        
TOXGCC30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK35CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX35LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX35LEN)                                          
         MVC   TOXRETYP,TOXGUCLQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX35GUAR-1,MXTRTQ                                                
         MVI   TX35SEQ-1,MXTRTQ                                                 
         MVI   TX35CMNT-1,MXTRTQ                                                
         MVI   TX35X,MXTRTQ                                                     
         MVI   TX35X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLCMSSN,DUB                                         
         MVC   TX35GUAR(6),DUB     SOCIAL SECURITY NUMBER                       
*                                                                               
         MVC   FULL,TLCMGUA                                                     
         XC    FULL,=X'FFFFFFFF'                                                
         MVC   TX35GUAR+6(L'FULL),FULL  TLCMSSN+TLCMGUA(UNCOMPLEMENTED)         
*                                                                               
         L     R1,TMPCOUNT         SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX35SEQ,DUB                                                      
*                                                                               
         L     RF,TMPCOUNT                                                      
         A     RF,=F'1'                                                         
         ST    RF,TMPCOUNT                                                      
*                                                                               
         ZIC   R1,TAXCLEN                                                       
         SHI   R1,TAXCLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX35CMNT(0),TAXCCMNT                                             
*                                                                               
         J     TOXGCC20                                                         
         DROP  R5                                                               
*                                                                               
TOXGCCRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGCYC - EXTRACT GUARANTEE CONTRACT YEAR TRACKING  - 5036          *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GUARANTEE CONTRACT YEAR TRACKING RECORD)                      *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXGCYC  NMOD1 WORKX-WORKD,*TOXGCY*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXGCYLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLOTD,R3            R3=A(AGENCY RECORD)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXGYBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXGYNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXGCYCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXGCYLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXGYNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX36LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX36LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXGYBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXGCYR          BUILD GUARANTEE CONTRACT YEAR TRACK          
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXGCYR -  - EXTRACT GUARANTEE CONTRACT YEAR TRACKING  - 5036       *         
***********************************************************************         
                                                                                
TOXGCYR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK36CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX36LEN)                                          
         MVC   TOXRETYP,TOXGCYTQ                                                
*                                                                               
         MVI   TX36GCON-1,MXTRTQ                                                
         MVI   TX36SDTE-1,MXTRTQ                                                
         MVI   TX36EDTE-1,MXTRTQ                                                
         MVI   TX36UNI-1,MXTRTQ                                                 
         MVI   TX36AMT-1,MXTRTQ                                                 
         MVI   TX36X,MXTRTQ                                                     
         MVI   TX36X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLOTSSN,DUB                                         
         MVC   TX36GCON(6),DUB     SOCIAL SECURITY NUMBER                       
*                                                                               
         MVC   FULL,TLOTGCNT                                                    
         XC    FULL,=X'FFFFFFFF'                                                
         L     R1,FULL             UNCOMPLEMENT GRT CONTRACT CODE               
         AHI   R1,1                                                             
         EDIT  (R1),DUB,0,ALIGN=RIGHT                                           
         OC    DUB,=C'00000000'                                                 
         MVC   TX36GCON+6(6),DUB+2                                              
         MVC   TX36GCON+6(2),=C'GC'                                             
*                                                                               
         LH    RF,=Y(TX36LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXGCYCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLOTELEM         R5=A(FIRST ELEMENT)                          
TOXGY10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGCYXX                                                         
         CLI   0(R5),TAGCELQ       GUARANTEE CYCLE ELEMENT X'62'                
         JE    TOXGY30                                                          
*                                                                               
TOXGY20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGY10                                                          
*                                                                               
         USING TAGCD,R5                                                         
TOXGY30  MVC   TX36UNI,TAGCUNI     UNION                                        
*                                                                               
         EDIT  TAGCAMT,TX36AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
         OC    TAGCSTRT,TAGCSTRT                                                
         JZ    TOXGY32                                                          
         GOTO1 DATCON,DMCB,(X'01',TAGCSTRT),(10,TX36SDTE) PERIOD START          
TOXGY32  OC    TAGCEND,TAGCEND                                                  
         JZ    TOXGY34                                                          
         GOTO1 DATCON,DMCB,(X'01',TAGCEND),(10,TX36EDTE)  PERIOD END            
TOXGY34  J     TOXGY20                                                          
*                                                                               
TOXGCYXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXAGTC - EXTRACT AGENT RECORDS - 5038                              *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(AGENT RECORD)                                                 *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXAGTC  NMOD1 WORKX-WORKD,*TOXAGT*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXAGTLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLAND,R3            R3=A(AGENT RECORD)                           
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXATBLD            BUILD AGENT AND SUBSET RECS                  
         JH    TOXATNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXAGTCC DC    A(BUFFER1)          AGENT SAVE AREA                              
TOXAGTLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXATNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX38LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX38LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXATBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXAGTR          BUILD AGENT RECORD                           
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXAGTR -  - EXTRACT AGENT RECORDS - 5038                           *         
***********************************************************************         
                                                                                
TOXAGTR  NTR1                                                                   
*                                                                               
         MVC   TEMPADD1,SPACES                                                  
         MVC   TEMPADD2,SPACES                                                  
         MVC   TEMPADD3,SPACES                                                  
         MVC   TEMPADD4,SPACES                                                  
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK38CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX38LEN)                                          
         MVC   TOXRETYP,TOXAGNTQ                                                
*                                                                               
         MVI   TX38AGNT-1,MXTRTQ                                                
         MVI   TX38NAME-1,MXTRTQ                                                
         MVI   TX38SNAM-1,MXTRTQ                                                
         MVI   TX38PID-1,MXTRTQ                                                 
         MVI   TX38ADR1-1,MXTRTQ                                                
         MVI   TX38ADR2-1,MXTRTQ                                                
         MVI   TX38ADR3-1,MXTRTQ                                                
         MVI   TX38ADR4-1,MXTRTQ                                                
         MVI   TX38EMAI-1,MXTRTQ                                                
         MVI   TX38PHON-1,MXTRTQ                                                
         MVI   TX38FAX-1,MXTRTQ                                                 
         MVI   TX38X,MXTRTQ                                                     
         MVI   TX38X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX38AGNT,TLANAGT    AGENT                                        
*                                                                               
         LH    RF,=Y(TX38LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXAGTCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLANELEM         R5=A(FIRST ELEMENT)                          
TOXAT10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXAGTXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXAT30                                                          
         CLI   0(R5),TASNELQ       NAME ELEMENT X'21'                           
         JE    TOXAT40                                                          
         CLI   0(R5),TAADELQ       ADDRESS ELEMENT X'22'                        
         JE    TOXAT50                                                          
         CLI   0(R5),TANUELQ       FREE FORM NAME ELEMENT X'25'                 
         JE    TOXAT60                                                          
         CLI   0(R5),TACMELQ       COMMENT ELEMENT X'8D'                        
         JE    TOXAT70                                                          
         CLI   0(R5),TAANELQ       AGENT ELEMENT X'64'                          
         JE    TOXAT80                                                          
*                                                                               
TOXAT20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXAT10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXAT30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXAT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX38NAME(0),TANANAME                                             
         J     TOXAT20                                                          
*                                                                               
         USING TASND,R5                                                         
TOXAT40  MVC   TX38SNAM,TASNAME    SHORT NAME                                   
         J     TOXAT20                                                          
*                                                                               
         USING TAADD,R5                                                         
TOXAT50  SR    RF,RF               NAME                                         
         IC    RF,TAADLEN                                                       
         SHI   RF,TAADLNQ                                                       
         SHI   RF,1                                                             
         JM    TOXAT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TEMPADD(0),TAADADD                                               
*                                                                               
         MVC   TX38ADR1,TEMPADD1                                                
         MVC   TX38ADR2,TEMPADD2                                                
         MVC   TX38ADR3,TEMPADD3                                                
         MVC   TX38ADR4,TEMPADD4                                                
         J     TOXAT20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXAT60  CLI   TANUTYPE,TANUTFAX   FAX?                                         
         JNE   TOXAT20                                                          
         SR    RF,RF               NAME                                         
         IC    RF,TANULEN                                                       
         SHI   RF,TANULNQ                                                       
         SHI   RF,1                                                             
         JM    TOXAT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX38FAX(0),TANUMBER                                              
         J     TOXAT20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXAT70  CLI   TACMTYPE,TACMTYPI   EMAIL?                                       
         JNE   TOXAT20                                                          
         SR    RF,RF               NAME                                         
         IC    RF,TACMLEN                                                       
         SHI   RF,TACMLNQ                                                       
         SHI   RF,1                                                             
         JM    TOXAT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX38EMAI(0),TACMCOMM                                             
         J     TOXAT20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAAND,R5                                                         
TOXAT80  MVC   TX38PHON,TAANTEL    TELEPHONE NUMBER                             
         GOTOR SSN2PID,DMCB,TAANSSN,DUB                                         
         MVC   TX38PID,DUB                                                      
         J     TOXAT20                                                          
         DROP  R5                                                               
*                                                                               
TOXAGTXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
TEMPADD  DS    0X                                                               
TEMPADD1 DS    CL(L'TX38ADR1)                                                   
TEMPADD2 DS    CL(L'TX38ADR1)                                                   
TEMPADD3 DS    CL(L'TX38ADR1)                                                   
TEMPADD4 DS    CL(L'TX38ADR1)                                                   
TEMPADDL EQU   *-TEMPADD                                                        
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXGTKC - EXTRACT GUARANTEE TRACKING RECORDS - 5039                 *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(GUARANTEE TRACKING RECORD)                                    *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXGTKC  NMOD1 WORKX-WORKD,*TOXGTK*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXGTKLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLGTD,R3            R3=A(GUARANTEE TRACKING RECORD)              
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXGTBLD            BUILD GUARANTEE TRACKING                     
         JH    TOXGTNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXGTKCC DC    A(BUFFER1)          GUARANTEE TRACKING SAVE AREA                 
TOXGTKLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXGTNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX39LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX39LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXGTBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXGTKR          BUILD GUARANTEE TRACKING RECORD              
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXGTKR -  - EXTRACT GUARANTEE TRACKING RECORDS - 5039              *         
***********************************************************************         
                                                                                
TOXGTKR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK39CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX39LEN)                                          
         MVC   TOXRETYP,TOXGUTRQ                                                
*                                                                               
         MVI   TX39GUAR-1,MXTRTQ                                                
         MVI   TX39SEQ-1,MXTRTQ                                                 
         MVI   TX39AGY-1,MXTRTQ                                                 
         MVI   TX39INV-1,MXTRTQ                                                 
         MVI   TX39VERS-1,MXTRTQ                                                
         MVI   TX39CAT-1,MXTRTQ                                                 
         MVI   TX39CAM-1,MXTRTQ                                                 
         MVI   TX39CSD-1,MXTRTQ                                                 
         MVI   TX39CED-1,MXTRTQ                                                 
         MVI   TX39USE-1,MXTRTQ                                                 
         MVI   TX39USES-1,MXTRTQ                                                
         MVI   TX39APP-1,MXTRTQ                                                 
         MVI   TX39PNH-1,MXTRTQ                                                 
         MVI   TX39BAL-1,MXTRTQ                                                 
         MVI   TX39X,MXTRTQ                                                     
         MVI   TX39X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLGTSSN,DUB                                         
         MVC   TX39GUAR(6),DUB     SOCIAL SECURITY NUMBER                       
*                                                                               
         MVC   FULL,TLGTGUA                                                     
*        XC    FULL,=X'FFFFFFFF'                                                
         MVC   TX39GUAR+6(L'FULL),FULL  TLGTSSN+TLGTGUA(UNCOMPLEMENTED)         
*                                                                               
         XC    FULL,FULL                                                        
         MVC   FULL+2(2),TLGTTRK   SEQUENCE NUMBER                              
         L     R1,FULL             ACTRA TYPE                                   
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX39SEQ,DUB                                                      
*                                                                               
         LH    RF,=Y(TX39LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXGTKCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLGTELEM         R5=A(FIRST ELEMENT)                          
TOXGT10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXGTKXX                                                         
         CLI   0(R5),TAGTELQ       TRACKING ELEMENT X'87'                       
         JE    TOXGT30                                                          
*                                                                               
TOXGT20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXGT10                                                          
*                                                                               
         USING TAGTD,R5                                                         
TOXGT30  MVC   TX39AGY,TAGTAGY     AGENCY                                       
         OC    TAGTINV,TAGTINV                                                  
         JZ    TOXGT32                                                          
         GOTO1 TINVCON,DMCB,TAGTINV,TX39INV,DATCON       INVOICE                
TOXGT32  MVC   TX39VERS,TAGTCID    VERSION ID                                   
         MVC   TX39CAT,TAGTCAT     CATEGORY                                     
         MVC   TX39CAM,TAGTCAM     CAMERA                                       
         MVC   TX39USE,TAGTUSE     USE CODE                                     
         GOTO1 DATCON,DMCB,(X'01',TAGTSTRT),(10,TX39CSD) CYCLE START            
         GOTO1 DATCON,DMCB,(X'01',TAGTEND),(10,TX39CED)  CYCLE END              
*                                                                               
         MVC   TX39USES,=C'000'                                                 
         CLI   TAGTTYPE,0                                                       
         JE    TOXGT34                                                          
         ZIC   R1,TAGTTYPE         USE SUBTYPE                                  
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX39USES,DUB                                                     
*                                                                               
TOXGT34  EDIT  TAGTPNH,TX39PNH,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         EDIT  TAGTBAL,TX39BAL,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         MVC   TX39CYR,TAGTYEAR                                                 
*                                                                               
         EDIT  TAGTCRD,TX39APP,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         OC    TAGTPAY,TAGTPAY                                                  
         BZ    TOXGT38                                                          
         OC    TAGTCRD,TAGTCRD                                                  
         BNZ   TOXGT38                                                          
         EDIT  TAGTPAY,TX39APP,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
TOXGT38  TM    TAGTOV,X'80'        PERCENT SCALE USED?                          
         BZ    TOXGT40                                                          
         EDIT  (4,TAGTOV),(11,TX39OV1),2   % SCALE RATE 1                       
         B     TOXGT42                                                          
*                                                                               
TOXGT40  EDIT  (4,TAGTOV),(11,TX39OVA),2   OVERSCALE AMOUNT                     
*                                                                               
TOXGT42  EDIT  (4,TAGTOV2),(11,TX39OV2),2  OVERSCALE RATE 2                     
         SPACE                                                                  
                                                                                
         J     TOXGT20                                                          
         DROP  R5                                                               
*                                                                               
TOXGTKXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXVCLC - EXTRACT VERSION COMMENT RECORDS - 50353                   *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(VERSION COMMENT RECORD)                                       *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXVCLC  NMOD1 WORKX-WORKD,*TOXVCL*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXVCLLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCMD,R3            R3=A(VERSION CONTRACT RECORD)                
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXVCBLD            BUILD VERSION AND SUBSET RECS                
         JH    TOXVCNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXVCLCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXVCLLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXVCNXT L     RE,ANEXT                                                         
         OC    0(4,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX37LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX37LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXVCBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXVCLR          BUILD VERSION COMMENT RECORD                 
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXVCLR -  - VERSION COMMENT 5037                                   *         
***********************************************************************         
                                                                                
TOXVCLR  NTR1                                                                   
         STCM  R2,15,ANEXT2                                                     
         STCM  R2,15,ANEXT                                                      
*                                                                               
         LA    R5,TLCMELEM         R5=A(FIRST ELEMENT)                          
TOXVCL10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXVCLRX                                                         
         CLI   0(R5),TAXCELQ       VERSION CYCLE ELEMENT (X'62')                
         JE    TOXVCL30                                                         
*                                                                               
TOXVCL20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXVCL10                                                         
*                                                                               
         USING TAXCD,R5                                                         
         USING PKCNTS,RE                                                        
TOXVCL30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK37CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX37LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX37LEN)                                          
         MVC   TOXRETYP,TOXVCLQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX37VASS-1,MXTRTQ                                                
         MVI   TX37VERN-1,MXTRTQ                                                
         MVI   TX37TPC-1,MXTRTQ                                                 
         MVI   TX37SEQ-1,MXTRTQ                                                 
         MVI   TX37CMNT-1,MXTRTQ                                                
         MVI   TX37X,MXTRTQ                                                     
         MVI   TX37X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLCMICOM,TX37VASS,L'TLCMICOM,0 ASSET PR KEY         
*                                                                               
         MVI   TX37TPC,C'C'                                                     
         TM    TLCMLEV,TLCMTPC     TPC?                                         
         JZ    *+8                                                              
         MVI   TX37TPC,C'T'                                                     
*                                                                               
         ZIC   R1,TLCMVER          VERSION NUMBER                               
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX37VERN,DUB                                                     
*                                                                               
TOXVCL32 ZIC   R1,TAXCSEQ          SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX37SEQ,DUB                                                      
*                                                                               
         ZIC   R1,TAXCLEN                                                       
         SHI   R1,TAXCLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX37CMNT(0),TAXCCMNT                                             
*                                                                               
         J     TOXVCL20                                                         
         DROP  R5                                                               
*                                                                               
TOXVCLRX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXOFFC - EXTRACT OFFICE RECORDS - 5001                             *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(OFFICE RECORD)                                                *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXOFFC  NMOD1 WORKX-WORKD,*TOXOFF*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXOFFLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLOFD,R3            R3=A(OFFICE RECORD)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXOFBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXOFNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXOFFCC DC    A(BUFFER1)          OFFICE SAVE AREA                             
TOXOFFLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXOFNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX41LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX41LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXOFBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXOFFR          BUILD OFFICE RECORD                          
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXOFFR -  - EXTRACT OFFICE RECORDS - 5041                          *         
***********************************************************************         
                                                                                
TOXOFFR  NTR1                                                                   
         MVC   TMPADD1,SPACES                                                   
         MVC   TMPADD2,SPACES                                                   
         MVC   TMPADD3,SPACES                                                   
         MVC   TMPADD4,SPACES                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK41CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX41LEN)                                          
         MVC   TOXRETYP,TOXOFFQ                                                 
*                                                                               
         MVI   TX41OFC-1,MXTRTQ                                                 
         MVI   TX41OFN-1,MXTRTQ                                                 
         MVI   TX41AD1-1,MXTRTQ                                                 
         MVI   TX41AD2-1,MXTRTQ                                                 
         MVI   TX41AD3-1,MXTRTQ                                                 
         MVI   TX41PHN-1,MXTRTQ                                                 
         MVI   TX41PQID-1,MXTRTQ                                                
         MVI   TX41AD4-1,MXTRTQ                                                 
         MVI   TX41X,MXTRTQ                                                     
         MVI   TX41X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX41OFC,TLOFOFF     OFFICE                                       
*                                                                               
         LH    RF,=Y(TX41LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXOFFCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLOFELEM         R5=A(FIRST ELEMENT)                          
TOXOF10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXOFFXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXOF30                                                          
         CLI   0(R5),TAADELQ       ADDRESS ELEMENT X'22'                        
         JE    TOXOF40                                                          
         CLI   0(R5),TAOFELQ       OFFICE DETAILS ELEMENT X'08'                 
         JE    TOXOF50                                                          
*                                                                               
TOXOF20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXOF10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXOF30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXOF20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX41OFN(0),TANANAME                                              
         J     TOXOF20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAADD,R5                                                         
TOXOF40  SR    RF,RF               NAME                                         
         IC    RF,TAADLEN                                                       
         SHI   RF,TAADLNQ                                                       
         SHI   RF,1                                                             
         JM    TOXAT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TMPADD(0),TAADADD                                                
*                                                                               
         MVC   TX41AD1,TMPADD1                                                  
         MVC   TX41AD2,TMPADD2                                                  
         MVC   TX41AD3,TMPADD3                                                  
         MVC   TX41AD4,TMPADD4                                                  
         J     TOXOF20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAOFD,R5                                                         
TOXOF50  MVC   TX41PHN,TAOFTEL     PHONE NUMBER                                 
         MVC   TX41PQID,TAOFIDCD   PRINT QUEUE ID                               
         J     TOXOF20                                                          
         DROP  R5                                                               
*                                                                               
TOXOFFXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
TMPADD   DS    0X                                                               
TMPADD1  DS    CL(L'TX41AD1)                                                    
TMPADD2  DS    CL(L'TX41AD1)                                                    
TMPADD3  DS    CL(L'TX41AD1)                                                    
TMPADD4  DS    CL(L'TX41AD1)                                                    
TMPADDL  EQU   *-TMPADD                                                         
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXSTFF - EXTRACT STAFF RECORDS - 5045                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(STAFF RECORD)                                                           
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXSTFF  NMOD1 WORKX-WORKD,*TOXSTF*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXSTFLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLSTD,R3            R3=A(STAFF RECORD)                           
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXSTBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXSTNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXSTFCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXSTFLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXSTNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX45LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX45LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXSTBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXSTAF          BUILD STAFF RECORD   - 5045                  
         BAS   RE,TOXSLIM          BUILD STAFF LIMITED AGY/CLI RECORD           
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXSTAF -  - EXTRACT STAFF RECORD  5045                                       
***********************************************************************         
                                                                                
TOXSTAF  NTR1                                                                   
*                                                                               
         CLI   TLSTSSEQ,0          DONT PUT OUT SEQUENCE >0                     
         JH    XIT                                                              
         MVC   SVBUID,TLSTUSER                                                  
         BRAS  RE,GETUSER                                                       
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK45CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX45LEN)                                          
         MVC   TOXRETYP,TOXSTAFQ                                                
*                                                                               
         MVI   TX45UID-1,MXTRTQ                                                 
         MVI   TX45STAF-1,MXTRTQ                                                
         MVI   TX45FNAM-1,MXTRTQ                                                
         MVI   TX45LNAM-1,MXTRTQ                                                
         MVI   TX45SNAM-1,MXTRTQ                                                
         MVI   TX45SPWD-1,MXTRTQ                                                
         MVI   TX45CAT-1,MXTRTQ                                                 
         MVI   TX45MAN-1,MXTRTQ                                                 
         MVI   TX45PNM-1,MXTRTQ                                                 
         MVI   TX45EML-1,MXTRTQ                                                 
         MVI   TX45USNM-1,MXTRTQ                                                
         MVI   TX45SA-1,MXTRTQ                                                  
         MVI   TX45X,MXTRTQ                                                     
         MVI   TX45X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX45UID,SVUSERID                                                 
         MVC   TX45USNM,SVUSRIDN                                                
         MVC   TX45SA,SVSECAGY                                                  
         MVC   TX45STAF,TLSTSTAF                                                
*                                                                               
         LA    R5,TLSTELEM         R5=A(FIRST ELEMENT)                          
         USING TASTD,R5                                                         
TOXST02  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXST09                                                          
         CLI   0(R5),TASTELQ       STAFF ELEMENT                                
         JE    TOXST06                                                          
         CLI   0(R5),TASNELQ       SHORT NAME                                   
         JE    TOXST08                                                          
         CLI   0(R5),TACMELQ       EMAIL ADDRESS                                
         JE    TOXST07                                                          
TOXST04  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXST02                                                          
*                                                                               
TOXST06  MVC   TX45FNAM,TASTFST                                                 
         MVC   TX45LNAM,TASTLST                                                 
         MVC   TX45SNAM,SPACES                                                  
         MVC   TX45SPWD,TASTPWD                                                 
         MVC   TX45CAT,TASTTYPE                                                 
         MVC   TX45MAN,TASTMGR                                                  
         MVC   TX45PNM,TASTTEL                                                  
         MVC   TX45EML,SPACES                                                   
         J     TOXST04                                                          
TOXST07  DS    0C                                                               
         USING TACMD,R5                                                         
         CLI   TACMTYPE,TACMTYPI    EMAIL COMMENT?                              
         BNE   TOXST04                                                          
         USING TACMD,R5                                                         
         ZIC   RE,1(R5)                                                         
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX45EML(0),TACMCOMM EMAIL ADDRESS                                
         J     TOXST04                                                          
         USING TASND,R5                                                         
TOXST08  MVC   TX45SNAM,TASNAME    SHORT NAME                                   
         J     TOXST04                                                          
*                                                                               
TOXST09  LH    RF,=Y(TX45LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXSTFCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLSTELEM         R5=A(FIRST ELEMENT)                          
TOXST10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXSTFXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXST30                                                          
*                                                                               
TOXST20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXST10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXST30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXST20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX21NAME(0),TANANAME                                             
         J     TOXST20                                                          
         DROP  R5                                                               
*                                                                               
TOXSTFXX J     EXIT                                                             
         EJECT                                                                  
*                                                                               
***********************************************************************         
* TOXSLIM  - STAFF LIMITED AGENCY/CLIENT                                        
***********************************************************************         
                                                                                
TOXSLIM  NTR1                                                                   
         MVC   SVSTAFFC,TLSTSTAF                                                
         LA    R5,TLSTELEM         R5=A(FIRST ELEMENT)                          
TOXSL10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXSLX                                                           
         CLI   0(R5),TAVAELQ                                                    
         JE    TOXSL24                                                          
*                                                                               
TOXSL20  SR    RF,RF               NEXT ELEMENT                                 
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXSL10                                                          
*                                                                               
TOXSL24  DS    0C                                                               
         USING TAVAD,R5                                                         
         USING PKCNTS,RE                                                        
         MVC   SVAGY,TAVAAGY                                                    
         LA    R3,TAVACLI          CLIENT LIST                                  
         ZIC   RE,1(R5)                                                         
         SHI   RE,TAVALNQ                                                       
         STCM  RE,15,CLILNQ           LENGTH OF CLIENT LIST                     
*                                                                               
TOXSL30  L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK46CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX45LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX45LEN)                                          
         MVC   TOXRETYP,TOXSLIMQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX46UID-1,MXTRTQ                                                 
         MVI   TX46STAF-1,MXTRTQ                                                
         MVI   TX46AGYC-1,MXTRTQ                                                
         MVI   TX46CLIC-1,MXTRTQ                                                
         MVI   TX46X,MXTRTQ                                                     
         MVI   TX46X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX46UID,SVUSERID                                                 
         MVC   TX46STAF,SVSTAFFC                                                
         MVC   TX46AGYC,SVAGY                                                   
         CLC   CLILNQ,=F'6'         ATLEAST 6 BYTES FOR 1 CLIENT                
         BL    TOXSL50              SOME RECORD LENGTHS ARE NOT 6               
         MVC   TX46CLIC,0(R3)                                                   
* ANY MORE CLIENTS?                                                             
         ZICM  RE,CLILNQ,(15)                                                   
         SHI   RE,L'TAVACLI                                                     
         STCM  RE,15,CLILNQ                                                     
         CLC   CLILNQ,=F'6'         ATLEAST 6 BYTES FOR 1 CLIENT                
         BL    TOXSL50                                                          
         AHI   R3,L'TAVACLI                                                     
         B     TOXSL30                                                          
                                                                                
* NO MORE CLIENTS - GET NEXT TAVA ELEMENT                                       
TOXSL50  J     TOXSL20                                                          
         DROP  R5                                                               
*                                                                               
TOXSLX   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
CLILNQ   DS    F                                                                
SVAGY    DS    CL(L'TAVAAGY)                                                    
SVSTAFFC DS    CL(L'TLSTSTAF)                                                   
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
*                                                                               
**********************************************************************          
       ++INCLUDE TASUDETS                                                       
*                                                                               
SQUASHER DS    A                                                                
MYBLOCK  DS    CL100                                                            
       ++INCLUDE TASYSWORKD                                                     
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
*                                                                               
         USING TLGUD,R3            R3=A(GUARANTEE RECORD)                       
         USING TAGUD,R5                                                         
BLDTBL   NTR1  BASE=*,LABEL=*                                                   
         MVC   PRIAGY,TAGUAGY                                                   
         MVC   PRICLI,TAGUCLI                                                   
         MVI   PROSTAT,0                                                        
*                                                                               
         LA    RF,ACTBL                                                         
         ST    RF,FULL                                                          
*                                                                               
         BRAS  RE,CLRTBL           CLEAR TABLE                                  
         BRAS  RE,BLDACTBL         AND BUILD IT                                 
         J     EXIT                                                             
                                                                                
CLRTBL   NTR1                                                                   
         LA    RE,ACTBL                                                         
         LA    R6,4                                                             
CTBL10   XC    0(250,RE),0(RE)                                                  
         LA    RE,250(RE)                                                       
         BCT   R6,CTBL10                                                        
         MVI   ACTBL,X'FF'                                                      
         J     EXIT                                                             
*                                                                               
BLDACTBL NTR1                                                                   
         LA    R5,TLGUELEM         R5=A(FIRST ELEMENT)                          
         LA    R3,ACTBL                                                         
BLDACT10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    BLDACT44                                                         
         CLI   0(R5),TAVAELQ       PRODUCT ELEMENT (X'FC')                      
         JE    BLDACT30                                                         
*                                                                               
BLDACT20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     BLDACT10                                                         
*                                                                               
         USING ACTBLD,R3                                                        
         USING TAVAD,R5                                                         
BLDACT30 XR    RE,RE                                                            
         ZIC   RF,TAVALEN          CALCULATE NUMBER OF CLIENTS                  
         SHI   RF,TAVALNQ          IN ELEMENT                                   
         LTR   RF,RF                                                            
         JNZ   BLDACT32                                                         
         LHI   RF,TAVALNQ                                                       
BLDACT32 D     RE,=A(L'TAVACLI)                                                 
                                                                                
         LR    R2,RF               R2=(NUMBER OF CLIENTS IN ELEMENT)            
         LA    R6,TAVACLI          RE=A(CURRENT CLIENT IN ELEMENT)              
                                                                                
BLDACT34 CLI   TAVALEN,TAVALNQ                                                  
         JE    BLDACT40                                                         
                                                                                
         TM    PROSTAT,PRIADDED                                                 
         JO    BLDACT38                                                         
         CLC   PRIAGY,TAVAAGY                                                   
         JH    BLDACT38                                                         
         JL    BLDACT36                                                         
         CLC   PRICLI,0(R6)                                                     
         JH    BLDACT38                                                         
BLDACT36 MVI   ACSTAT,1                                                         
         MVC   ACAGY-ACTBLD(L'ACAGY,R3),PRIAGY                                  
         MVC   ACCLI-ACTBLD(L'ACCLI,R3),PRICLI                                  
         LA    R3,ACLNQ(R3)                                                     
         OI    PROSTAT,PRIADDED                                                 
                                                                                
BLDACT38 MVC   ACCLI-ACTBLD(L'ACCLI,R3),0(R6)                                   
         J     BLDACT42                                                         
                                                                                
BLDACT40 TM    PROSTAT,PRIADDED                                                 
         JO    BLDACT42                                                         
         CLC   PRIAGY,TAVAAGY                                                   
         JH    BLDACT42                                                         
         MVI   ACSTAT,1                                                         
         MVC   ACAGY-ACTBLD(L'ACAGY,R3),PRIAGY                                  
         MVC   ACCLI-ACTBLD(L'ACCLI,R3),PRICLI                                  
         LA    R3,ACLNQ(R3)                                                     
         OI    PROSTAT,PRIADDED                                                 
                                                                                
BLDACT42 MVC   0(ACCLI-ACTBLD,R3),TAVASTAT                                      
         LA    R3,ACLNQ(R3)                                                     
         MVI   0(R3),X'FF'         ADD CURRENT CLIENT TO TABLE                  
                                                                                
         LA    R6,L'TAVACLI(R6)                                                 
         BCT   R2,BLDACT34         BUMP TO NEXT CLIENT IN ELEMENT               
         J     BLDACT20                                                         
                                                                                
BLDACT44 TM    PROSTAT,PRIADDED                                                 
         JO    XIT                                                              
         MVI   ACSTAT,1                                                         
         MVC   ACAGY-ACTBLD(L'ACAGY,R3),PRIAGY                                  
         MVC   ACCLI-ACTBLD(L'ACCLI,R3),PRICLI                                  
         MVI   ACLNQ(R3),X'FF'                                                  
         J     EXIT                                                             
         DROP  R3,R5                                                            
*                                                                               
PRIAGY   DS    XL(L'TAGUAGY)       PRIMARY AGENCY                               
PRICLI   DS    XL(L'TAGUCLI)       PRIMARY CLIENT                               
*                                                                               
PROSTAT  DS    X                   PROGRAM STATUS                               
ACCESSYS EQU   X'80'               ACCESS TO (AT LEAST 1) AGY/CLI               
PSPCBLCK EQU   X'40'               PER CYCLE PAYMENTS BILLED/CHECKS CUT         
PRIADDED EQU   X'20'               PRIMARY AGY/CLI ADDED TO TABLE               
DIFFERCY EQU   X'10'               DIFFERING CYCLE COMM'L FOUND                 
*                                                                               
ACTBL    DS    CL(ACLNQ*100)                                                    
ACTBLX   DS    X                                                                
                                                                                
         LTORG                                                                  
**********************************************************************          
* TRANSLATE AGENT CODE                                               *          
**********************************************************************          
TAGT     NTR1  BASE=*,LABEL=*                                                   
       ++INCLUDE TATRNSAGT                                                      
         J     EXIT                                                             
         LTORG                                                                  
***********************************************************************         
* TOXMKTP - MARKET RECORDS 5053                                                 
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(MARKET RECORD)                                                          
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXMKTC  NMOD1 WORKX-WORKD,*TOXMKT*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXMKTLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLMTD,R3            R3=A(PRODUCT GROUP)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXMTBLD                                                         
         JH    TOXMTNXT                                                         
*                                                                               
TOXMKTCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXMKTLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXMTNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX53LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX53LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXMTBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXMKTR          MARKET SYSTEM                                
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXTM - EXTRACT MARKET SYSTEM 5053                                            
***********************************************************************         
                                                                                
TOXMKTR  NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK53CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX53LEN)                                          
         MVC   TOXRETYP,TOXMKTQ                                                 
*                                                                               
         MVI   TX53PKEY-1,MXTRTQ                                                
         MVI   TX53TYPE-1,MXTRTQ                                                
         MVI   TX53NMC-1,MXTRTQ                                                 
         MVI   TX53AC-1,MXTRTQ                                                  
         MVI   TX53NAME-1,MXTRTQ                                                
         MVI   TX53WGHT-1,MXTRTQ                                                
         MVI   TX53SWGH-1,MXTRTQ                                                
         MVI   TX53SUBS-1,MXTRTQ                                                
         MVI   TX53X,MXTRTQ                                                     
         MVI   TX53X+1,MXTRTQ                                                   
*                                                                               
         LH    RF,=Y(TX53LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXMKTCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLMTINUM,TX53PKEY,L'TLMTINUM,0                      
         MVC   TX53TYPE,TLMTTYPE   TYPE                                         
         MVC   TX53NMC,TLMTCODE    NSI MARKET CODE                              
         OC    TX53NMC,SPACES                                                   
*                                                                               
         LA    R5,TLMTELEM         R5=A(FIRST ELEMENT)                          
TOXMT10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXMTXX                                                          
         CLI   0(R5),TANAELQ                                                    
         JE    TOXMT30                                                          
         CLI   0(R5),TASNELQ                                                    
         JE    TOXMT40                                                          
         CLI   0(R5),TAMSELQ                                                    
         JE    TOXMT50                                                          
*                                                                               
TOXMT20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXMT10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXMT30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXMT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX53NAME(0),TANANAME                                             
         J     TOXMT20                                                          
*                                                                               
         USING TASND,R5                                                         
TOXMT40  MVC   TX53AC,TASNAME      ALPHA CODE                                   
         J     TOXMT20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAMSD,R5                                                         
TOXMT50  CLI   TX53TYPE,C'S'                                                    
         BNE   TOXMT55                                                          
         EDIT  TAMSWGHT,TX53SUBS,ALIGN=LEFT,ZERO=NOBLANK                        
         J     TOXMT20                                                          
TOXMT55  LA    RF,TX53WGHT                                                      
         CLI   TAMSTYPE,TAMSTYSP                                                
         JNE   *+8                                                              
         LA    RF,TX53SWGH                                                      
         EDIT  TAMSWGHT,(11,0(RF)),ALIGN=LEFT,ZERO=NOBLANK                      
         J     TOXMT20                                                          
         DROP  R5                                                               
*                                                                               
TOXMTXX  J     EXIT                                                             
         EJECT                                                                  
*&&DO                                                                           
***********************************************************************         
* TOXRM - EXTRACT RADIO MARKET 5054                                             
***********************************************************************         
                                                                                
TOXRM    NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK54CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX54LEN)                                          
         MVC   TOXRETYP,TOXRMQ                                                  
*                                                                               
         MVI   TX54RMPK-1,MXTRTQ                                                
         MVI   TX54AMC-1,MXTRTQ                                                 
         MVI   TX54NAME-1,MXTRTQ                                                
         MVI   TX54X,MXTRTQ                                                     
         MVI   TX54X+1,MXTRTQ                                                   
*                                                                               
         LH    RF,=Y(TX53LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXMKTCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLMTINUM,TX54RMPK,L'TLMTINUM,0                      
         MVC   TX54AMC,TLMTCODE    ALPHA MARKET CODE                            
         OC    TX54AMC,SPACES                                                   
*                                                                               
         LA    R5,TLMTELEM         R5=A(FIRST ELEMENT)                          
TOXRM10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXRMXX                                                          
         CLI   0(R5),TANAELQ                                                    
         JE    TOXRM30                                                          
*                                                                               
TOXRM20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXRM10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXRM30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXRM20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX54NAME(0),TANANAME                                             
         J     TOXRM20                                                          
*                                                                               
TOXRMXX  J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXCN - EXTRACT RADIO MARKET 5055                                             
***********************************************************************         
                                                                                
TOXCN    NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK55CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX55LEN)                                          
         MVC   TOXRETYP,TOXCNQ                                                  
*                                                                               
         MVI   TX55CNPK-1,MXTRTQ                                                
         MVI   TX55CNC-1,MXTRTQ                                                 
         MVI   TX55NAME-1,MXTRTQ                                                
         MVI   TX55X,MXTRTQ                                                     
         MVI   TX55X+1,MXTRTQ                                                   
*                                                                               
         LH    RF,=Y(TX53LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXMKTCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLMTINUM,TX55CNPK,L'TLMTINUM,0                      
         MVC   TX55CNC,TLMTCODE    CABLE NETWORK CODE                           
         OC    TX55CNC,SPACES                                                   
*                                                                               
         LA    R5,TLMTELEM         R5=A(FIRST ELEMENT)                          
TOXCN10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXCNXX                                                          
         CLI   0(R5),TANAELQ                                                    
         JE    TOXCN30                                                          
*                                                                               
TOXCN20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXCN10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXCN30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXCN20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX55NAME(0),TANANAME                                             
         J     TOXCN20                                                          
*                                                                               
TOXCNXX  J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXLCS - EXTRACT LOCAL CABLE SYSTEM 5056                                      
***********************************************************************         
                                                                                
TOXLCS   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK56CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX56LEN)                                          
         MVC   TOXRETYP,TOXLCSQ                                                 
*                                                                               
         MVI   TX56LCSP-1,MXTRTQ                                                
         MVI   TX56LCSC-1,MXTRTQ                                                
         MVI   TX56NAME-1,MXTRTQ                                                
         MVI   TX56X,MXTRTQ                                                     
         MVI   TX56X+1,MXTRTQ                                                   
*                                                                               
         LH    RF,=Y(TX53LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXMKTCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLMTINUM,TX56LCSP,L'TLMTINUM,0                      
         MVC   TX56LCSC,TLMTCODE   LOCAL CABLE SYSTEM CODE                      
         OC    TX56LCSC,SPACES                                                  
*                                                                               
         LA    R5,TLMTELEM         R5=A(FIRST ELEMENT)                          
TOXLCS10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXLCSXX                                                         
         CLI   0(R5),TANAELQ                                                    
         JE    TOXLCS30                                                         
*                                                                               
TOXLCS20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXLCS10                                                         
*                                                                               
         USING TANAD,R5                                                         
TOXLCS30 SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXLCS20                                                         
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX56NAME(0),TANANAME                                             
         J     TOXLCS20                                                         
*                                                                               
TOXLCSXX J     EXIT                                                             
         EJECT                                                                  
*&&                                                                             
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXUSE  - USAGE HISTORY RECORDS 5049-5052                                     
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(USAGE HISTORY RECORD)                                                   
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXUSEC  NMOD1 WORKX-WORKD,*TOXUSE*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXUSELT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLUHD,R3            R3=A(PRODUCT GROUP)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXUHBLD                                                         
         JH    TOXUHNXT                                                         
*                                                                               
TOXUSECC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXUSELT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXUHNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX49LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX49LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXUHBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXUSER          SYSTEM USE DETAILS                           
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXUSE - MARKET USE DETAILS 5049                                              
***********************************************************************         
                                                                                
TOXUSER  NTR1                                                                   
         XC    TLUHINV,=X'FFFFFFFFFFFF'                                         
         L     R2,TOXUSECC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         ST    R2,ANEXT2           FOR NEXT TIME IN                             
*                                                                               
         LA    R5,TLUHELEM         R5=A(FIRST ELEMENT)                          
TOXUSE10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    YES                                                              
         CLI   0(R5),TAMTELQ                                                    
         JE    TOXUSE30                                                         
*                                                                               
TOXUSE20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXUSE10                                                         
*                                                                               
         USING TAMTD,R5                                                         
         USING PKCNTS,RE                                                        
TOXUSE30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK49CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX49LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX49LEN)                                          
         MVC   TOXRETYP,TOXUSEQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX49ASS-1,MXTRTQ                                                 
         MVI   TX49INV-1,MXTRTQ                                                 
         MVI   TX49CSD-1,MXTRTQ                                                 
         MVI   TX49CED-1,MXTRTQ                                                 
         MVI   TX49AC-1,MXTRTQ                                                  
         MVI   TX49PKEY-1,MXTRTQ                                                
         MVI   TX49X,MXTRTQ                                                     
         MVI   TX49X+1,MXTRTQ                                                   
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLUHCOM,TX49ASS,L'FULL,0   ASSET PR KEY             
         GOTO1 TINVCON,DMCB,TLUHINV,TX49INV,DATCON       INVOICE                
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCS),(10,TX49CSD)                        
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCE),(10,TX49CED)                        
         MVC   TX49AC,TAMTCODE                                                  
         OC    TX49AC,SPACES                                                    
         GOTO1 VHEXOUT,DMCB,TAMTINUM,TX49PKEY,L'TLMTINUM,0                      
*                                                                               
         J     TOXUSE20                                                         
         DROP  R5                                                               
*                                                                               
TOXUSERX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*&&DO                                                                           
***********************************************************************         
* TOXRUD - RADIO MARKET USE DETAILS 5050                                        
***********************************************************************         
                                                                                
TOXRMUD  NTR1                                                                   
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXRUD02 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXRMUDX                                                         
         CLI   0(R5),TACOELQ                                                    
         JE    TOXRUD04                                                         
         ZIC   RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXRUD02                                                         
*                                                                               
         USING TACOD,R5                                                         
TOXRUD04 CLI   TACOMED,TACOMEDR    RADIO MARKET?                                
         JNE   TOXRMUDX                                                         
*                                                                               
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXRUD10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    YES                                                              
         CLI   0(R5),TAMTELQ                                                    
         JE    TOXRUD30                                                         
*                                                                               
TOXRUD20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXRUD10                                                         
*                                                                               
         USING TAMTD,R5                                                         
         USING PKCNTS,RE                                                        
TOXRUD30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK50CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX50LEN)                                          
         MVC   TOXRETYP,TOXRMUDQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX50PINV-1,MXTRTQ                                                
         MVI   TX50CSD-1,MXTRTQ                                                 
         MVI   TX50CED-1,MXTRTQ                                                 
         MVI   TX50RMAC-1,MXTRTQ                                                
         MVI   TX50RMPK-1,MXTRTQ                                                
         MVI   TX50ASS-1,MXTRTQ                                                 
         MVI   TX50X,MXTRTQ                                                     
         MVI   TX50X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX50PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX50PINV                                                      
         LA    RE,6                                                             
TOXRUD40 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXRUD40                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX50ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCS),(10,TX50CSD)                        
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCE),(10,TX50CED)                        
         MVC   TX50RMAC,TAMTCODE                                                
         GOTO1 VHEXOUT,DMCB,TAMTINUM,TX50RMPK,L'TLMTINUM,0                      
*                                                                               
         J     TOXRUD20                                                         
         DROP  R5                                                               
*                                                                               
TOXRMUDX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXTMUD - TV MARKET USE DETAILS 5049                                          
***********************************************************************         
                                                                                
TOXTMUD  NTR1  BASE=*,LABEL=*                                                   
         CLC   TLUHUSE,=C'ADW'                                                  
         JE    TOXTUD06                                                         
         CLC   TLUHUSE,=C'SWS'                                                  
         JE    TOXTUD06                                                         
         CLC   TLUHUSE,=C'WSC'                                                  
         JE    TOXTUD06                                                         
         CLC   TLUHUSE,=C'WSP'                                                  
         JNE   NO                                                               
*                                                                               
TOXTUD06 LA    R5,TLUHELEM         R5=A(FIRST ELEMENT)                          
TOXTUD10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    YES                                                              
         CLI   0(R5),TAMTELQ                                                    
         JE    TOXTUD30                                                         
*                                                                               
TOXTUD20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTUD10                                                         
*                                                                               
         USING TAMTD,R5                                                         
         USING PKCNTS,RE                                                        
TOXTUD30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK49CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX49LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX49LEN)                                          
         MVC   TOXRETYP,TOXTMUDQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX49PINV-1,MXTRTQ                                                
         MVI   TX49CSD-1,MXTRTQ                                                 
         MVI   TX49CED-1,MXTRTQ                                                 
         MVI   TX49TMAC-1,MXTRTQ                                                
         MVI   TX49TMPK-1,MXTRTQ                                                
         MVI   TX49ASS-1,MXTRTQ                                                 
         MVI   TX49X,MXTRTQ                                                     
         MVI   TX49X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX49PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX49PINV                                                      
         LA    RE,6                                                             
TOXTUD40 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXTUD40                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX49ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCS),(10,TX49CSD)                        
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCE),(10,TX49CED)                        
         MVC   TX49TMAC,TAMTCODE                                                
         GOTO1 VHEXOUT,DMCB,TAMTINUM,TX49TMPK,L'TLMTINUM,0                      
*                                                                               
         J     TOXTUD20                                                         
         DROP  R5                                                               
*                                                                               
TOXTMUDX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXLCUD - LOCAL CABLE USE DETAILS 5052                                        
***********************************************************************         
                                                                                
TOXLCUD  NTR1  BASE=*,LABEL=*                                                   
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXLUD10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXLCUDX                                                         
         CLI   0(R5),TAMTELQ                                                    
         JE    TOXLUD30                                                         
*                                                                               
TOXLUD20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXLUD10                                                         
*                                                                               
         USING TAMTD,R5                                                         
TOXLUD30 LA    R6,TAMTCODE         EVERY NON-SPACE = NUMBER?                    
         LA    RE,L'TAMTCODE                                                    
*                                                                               
TOXLUD32 CLI   0(R6),C' '                                                       
         JE    TOXLUD34                                                         
         CLI   0(R6),0                                                          
         JE    TOXLUD34                                                         
         CLI   0(R6),C'0'                                                       
         JL    TOXLUD50                                                         
         CLI   0(R6),C'9'                                                       
         JH    TOXLUD50                                                         
TOXLUD34 AHI   R6,1                                                             
         BCT   RE,TOXLUD32                                                      
*                                                                               
         USING PKCNTS,RE                                                        
TOXLUD36 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK52CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX52LEN)                                          
         MVC   TOXRETYP,TOXLCUDQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX52PINV-1,MXTRTQ                                                
         MVI   TX52CSD-1,MXTRTQ                                                 
         MVI   TX52CED-1,MXTRTQ                                                 
         MVI   TX52LCSC-1,MXTRTQ                                                
         MVI   TX52LCSP-1,MXTRTQ                                                
         MVI   TX52ASS-1,MXTRTQ                                                 
         MVI   TX52X,MXTRTQ                                                     
         MVI   TX52X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX52PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX52PINV                                                      
         LA    RE,6                                                             
TOXLUD40 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXLUD40                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX52ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCS),(10,TX52CSD)                        
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCE),(10,TX52CED)                        
         MVC   TX52LCSC,TAMTCODE                                                
         GOTO1 VHEXOUT,DMCB,TAMTINUM,TX52LCSP,L'TLMTINUM,0                      
*                                                                               
         J     TOXLUD20                                                         
         DROP  R5                                                               
*                                                                               
         USING TAMTD,R5                                                         
         USING PKCNTS,RE                                                        
TOXLUD50 L     RE,APKCNTS          BUILD CABLE NETWORK                          
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK51CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX51LEN)                                          
         MVC   TOXRETYP,TOXCNUDQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX51PINV-1,MXTRTQ                                                
         MVI   TX51CSD-1,MXTRTQ                                                 
         MVI   TX51CED-1,MXTRTQ                                                 
         MVI   TX51CMAC-1,MXTRTQ                                                
         MVI   TX51CMPK-1,MXTRTQ                                                
         MVI   TX51ASS-1,MXTRTQ                                                 
         MVI   TX51X,MXTRTQ                                                     
         MVI   TX51X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX51PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX51PINV                                                      
         LA    RE,6                                                             
TOXLUD60 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXLUD60                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX51ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCS),(10,TX51CSD)                        
         GOTO1 DATCON,DMCB,(X'01',TAMTCYCE),(10,TX51CED)                        
         MVC   TX51CMAC,TAMTCODE                                                
         GOTO1 VHEXOUT,DMCB,TAMTINUM,TX51CMPK,L'TLMTINUM,0                      
*                                                                               
         J     TOXLUD20                                                         
         DROP  R5                                                               
*                                                                               
TOXLCUDX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*&&                                                                             
***********************************************************************         
* TOXCHK - EXTRACT CHECK RECORDS - 5057                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(STAFF RECORD)                                                           
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXCHKC  NMOD1 WORKX-WORKD,*TOXCHK*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXCHKLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCKD,R3            R3=A(STAFF RECORD)                           
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         L     RF,=A(VT00A88)      TASYSTAB                                     
         MVC   0(4,RF),20(R1)                                                   
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXCKBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXCKNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXCHKCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXCHKLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXCKNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX57LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX57LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXCKBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXCHECK         BUILD CHECK RECORD   - 5057                  
         BAS   RE,TOXCWITH         BUILD WITHHOLDINGS                           
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXCHECK - EXTRACT CHECK RECORD  5057                                         
***********************************************************************         
                                                                                
TOXCHECK NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK57CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX57LEN)                                          
         MVC   TOXRETYP,TOXCHKQ                                                 
*                                                                               
         BRAS  RE,TOXCSEP          CHECK SEPARATORS                             
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXCHKCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX57CHK(6),TLCKAGY                                               
*        GOTO1 TINVCON,DMCB,TLCKINV,TX57CHK+6,DATCON       INVOICE              
         GOTO1 VHEXOUT,DMCB,TLCKINV,TX57CHK+6,L'TLCKINV,0  INVOICE              
         GOTO1 VHEXOUT,DMCB,TLCKSORT,TX57CHK+18,L'TLCKSORT,0                    
*                                                                               
         GOTOR SSN2PID,DMCB,TLCKSSN,DUB                                         
         MVC   TX57CHK+30(6),DUB         PID                                    
         MVC   TX57PID,DUB         PID                                          
*                                                                               
         ZIC   R1,TLCKSEQ          SORT SEQUENCE NUMBER                         
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  CKSEQ,DUB                                                        
         MVC   TX57CHK+36(3),CKSEQ                                              
*                                                                               
         MVC   SV57CHK,TX57CHK     CHECK PRIMARY KEY                            
*                                                                               
         MVC   TX57PINV(L'TLCKAGY),TLCKAGY                                      
         MVC   DUB(6),TLCKINV                                                   
*        XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX57PINV                                                      
         LA    RE,6                                                             
TOXCK05  CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXCK05                                                       
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLCKINV,0  PRIMARY INV PRIM KEY         
*                                                                               
         MVC   TX57CATC,TLCKCAT    CATEGORY CODE                                
*                                                                               
         BRAS  RE,TOXCDEF          CHECK DEFAULTS                               
*                                                                               
         LA    R5,TLCKELEM         R5=A(FIRST ELEMENT)                          
TOXCK10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXCHKXX                                                         
         CLI   0(R5),TAPDELQ                                                    
         JE    TOXCK30                                                          
         CLI   0(R5),TACDELQ                                                    
         JE    TOXCK40                                                          
         CLI   0(R5),TAKPELQ                                                    
         JE    TOXCK50                                                          
         CLI   0(R5),TAKLELQ                                                    
         JE    TOXCK60                                                          
         CLI   0(R5),TACAELQ                                                    
         JE    TOXCK70                                                          
         CLI   0(R5),TACMELQ                                                    
         JE    TOXCK80                                                          
         CLI   0(R5),TAODELQ                                                    
         JE    TOXCK90                                                          
         CLI   0(R5),TANUELQ                                                    
         JE    TOXCK100                                                         
         CLI   0(R5),TABDELQ                                                    
         JE    TOXCK110                                                         
         CLI   0(R5),TATIELQ                                                    
         JE    TOXCK120                                                         
         CLI   0(R5),TASDELQ                                                    
         JE    TOXCK130                                                         
         CLI   0(R5),TABYELQ                                                    
         JE    TOXCK140                                                         
         CLI   0(R5),TADLELQ                                                    
         JE    TOXCK150                                                         
         CLI   0(R5),TACWELQ                                                    
         JE    TOXCK160                                                         
         CLI   0(R5),TARPELQ                                                    
         JE    TOXCK170                                                         
         CLI   0(R5),TAOIELQ                                                    
         JE    TOXCK180                                                         
*                                                                               
TOXCK20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXCK10                                                          
*                                                                               
         USING TAPDD,R5                                                         
TOXCK30  BRAS  RE,CHKTAPD          EXTRACT TAPD VALUES                          
         MVC   SVUSE,TAPDUSE       SAVE USE                                     
         MVC   SVCURR,TX57CURR     SAVE CURRENCY                                
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
TOXCK40  BRAS  RE,CHKTACD          EXTRACT TACD VALUES                          
         J     TOXCK20                                                          
*                                                                               
TOXCK50  MVI   TX57STOP,C'Y'       CHECK STOP                                   
         J     TOXCK20                                                          
*                                                                               
TOXCK60  MVI   TX57PULL,C'Y'       CHECK PULL                                   
         J     TOXCK20                                                          
*                                                                               
         USING TACAD,R5                                                         
TOXCK70  OC    TACANCDE,TACANCDE   AGENT?                                       
         JZ    TOXCK72                                                          
         GOTOR TAGT,DMCB,(X'40',TACANCDE),TX57AGNT                              
TOXCK72  OC    TACAOV2,TACAOV2     OVERSCALE 2ND PERCENTAGE?                    
         JZ    TOXCK74                                                          
         EDIT  TACAOV2,TX57OVP2,2,ALIGN=LEFT                                    
TOXCK74  MVC   TX57CAMR,TACAONOF   CAMERA ON/OFF                                
         MVC   TX57TAXU,TACAUNIT   TAX UNIT                                     
         MVC   TX57DBLS,TACADBL    DOUBLES                                      
         GOTO1 DATCON,DMCB,(X'01',TACAFRST),(10,TX57FSDT)  1ST SERV             
         MVC   TX57CNYR,TACAYEAR   CONTRACT YEAR                                
         MVC   TX57UNI,TACAUN      UNION                                        
*                                                                               
         TM    TACASTAT,TACASTLF   ON LIFT                                      
         JNO   *+8                                                              
         MVI   TX57LIFT,C'Y'                                                    
         TM    TACASTAT,TACASTLO   ONLY ON LIFT?                                
         JNO   *+8                                                              
         MVI   TX57LIFT,C'O'                                                    
*                                                                               
         OC    TACARATE,TACARATE   AGENT FEE?                                   
         JZ    TOXCK76                                                          
         EDIT  (2,TACARATE),(5,TX57AFEE),2,ZERO=BLANK  AGENCY FEE %             
*                                                                               
TOXCK76  OC    TACASDTE,TACASDTE   SHOOTING DATE?                               
         JZ    TOXCK78                                                          
         GOTO1 DATCON,DMCB,(X'01',TACASDTE),(10,TX57SDTE) SHOOT DATE            
*                                                                               
TOXCK78  MVC   TX57GRTC,TACAGUA    GUARANTEE CODE                               
*                                                                               
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
         USING TACMD,R5                                                         
TOXCK80  CLI   TACMTYPE,TACMTYPC    CHECK COMMENT?                              
         JNE   TOXCK20                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX57CMNT(0),TACMCOMM                                             
         J     TOXCK20                                                          
*                                                                               
         USING TAODD,R5                                                         
TOXCK90  CLI   TAODTYPE,TAODTYPW   WIRE?                                        
         JNE   TOXCK92                                                          
         EDIT  TAODAMT,TX57WIRE,2,FLOAT=-,ALIGN=RIGHT                           
TOXCK92  CLI   TAODTYPE,TAODTYPP   PERM CHARITY?                                
         JNE   TOXCK94                                                          
         EDIT  TAODAMT,TX57PCA,2,FLOAT=-,ALIGN=RIGHT                            
TOXCK94  CLI   TAODTYPE,TAODTYPM   MPTRF?                                       
         JNE   TOXCK96                                                          
         EDIT  TAODAMT,TX57MPA,2,FLOAT=-,ALIGN=RIGHT                            
TOXCK96  CLI   TAODTYPE,TAODTYPT   TRUSTEE?                                     
         JNE   TOXCK98                                                          
         EDIT  TAODAMT,TX57TDA,2,FLOAT=-,ALIGN=RIGHT                            
TOXCK98  CLI   TAODTYPE,TAODTYPD   DIRECT?                                      
         JNE   TOXCK20                                                          
         EDIT  TAODAMT,TX57DRCT,2,FLOAT=-,ALIGN=RIGHT                           
         J     TOXCK20                                                          
*                                                                               
         USING TANUD,R5                                                         
TOXCK100 CLI   TANUTYPE,TANUTRST   TRUSTEE PAYER PID?                           
         JNE   TOXCK102                                                         
         GOTOR SSN2PID,DMCB,TANUMBER,DUB                                        
         MVC   TX57TPP,DUB                                                      
         J     TOXCK20                                                          
*                                                                               
TOXCK102 CLI   TANUTYPE,TANUTMEM   MEMBERSHIP NUMBER?                           
         JNE   TOXCK104                                                         
         ZIC   R1,TANULEN                                                       
         SHI   R1,TANULNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX57MNUM(0),TANUMBER                                             
         OC    TX57MNUM,=C'         '                                           
         J     TOXCK20                                                          
*                                                                               
TOXCK104 CLI   TANUTYPE,TANUTPHR    PENSION AND HEALTH RATE                     
         JNE   TOXCK20                                                          
         SR    R0,R0                                                            
         ICM   R0,3,TANUOVAM        GET RATE                                    
         JZ    TOXCK20                                                          
         EDIT  (R0),TX57PHRT,2,FLOAT=-,ALIGN=RIGHT                              
         J     TOXCK20                                                          
*                                                                               
         USING TABDD,R5                                                         
TOXCK110 CLI   TABDLEN,TABDLN2Q    AGENCY COMMISSION                            
         JL    TOXCK20                                                          
         EDIT  TABDACOM,TX57ACA,2,FLOAT=-,ALIGN=RIGHT                           
         J     TOXCK20                                                          
*                                                                               
         USING TATID,R5                                                         
TOXCK120 CLI   TATITYPE,TATITYCO   CORPORATION PID?                             
         JNE   TOXCK20                                                          
         GOTOR SSN2PID,DMCB,TATIID,DUB                                          
         MVC   TX57CPID,DUB                                                     
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
TOXCK130 BRAS  RE,TOXCSESS         EXTRACT CHECK SESSION DATA                   
         J     TOXCK20                                                          
*                                                                               
         USING TABYD,R5                                                         
TOXCK140 CLI   TABYLVL,0                                                        
         JE    TOXCK20                                                          
         MVC   TX57TXLV,TABYLVL    TAX LEVEL                                    
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
         USING TADLD,R5                                                         
TOXCK150 OC    TADLPUB,TADLPUB                                                  
         JZ    TOXCK152                                                         
         GOTO1 DATCON,DMCB,(X'01',TADLPUB),(10,TX57PDTE)  PUB DATE              
*                                                                               
TOXCK152 OC    TADLEXP,TADLEXP                                                  
         JZ    TOXCK154                                                         
         GOTO1 DATCON,DMCB,(X'01',TADLEXP),(10,TX57EDTE)  EXP DATE              
TOXCK154 J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
         USING TACWD,R5                                                         
TOXCK160 CLC   TACWUNIT,=C'CN '    IF UNIT IS CANADA,                           
         JNE   TOXCK20                                                          
         EDIT  TACWGST,TX57GSTA,2,FLOAT=-,ALIGN=RIGHT     GST                   
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
         USING TARPD,R5                                                         
TOXCK170 EDIT  TARPBASE,TX57BASA,2,FLOAT=-,ALIGN=RIGHT  P&H BASE                
         EDIT  TARPINC,TX57PHBS,2,FLOAT=-,ALIGN=RIGHT   BASE FROM PREV          
         EDIT  TARPDIFF,TX57PHDF,2,FLOAT=-,ALIGN=RIGHT  DIFF FROM BASE          
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
         USING TAOID,R5                                                         
TOXCK180 DS    0H                                                               
         OC    TAOIAGY,TAOIAGY     AGENCY AND INVOICE CAN'T BE ZEROS            
         BZ    TOXCK20                                                          
         OC    TAOIINV,TAOIINV                                                  
         BZ    TOXCK20                                                          
                                                                                
         MVC   TX57OINV(L'TAOIAGY),TAOIAGY                                      
         MVC   DUB(6),TAOIINV                                                   
         LA    R6,TX57OINV                                                      
         LA    RE,6                                                             
TOXCK185 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXCK185                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TAOIINV,0  ORIGINAL INV KEY             
         J     TOXCK20                                                          
         DROP  R5                                                               
*                                                                               
TOXCHKXX J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* TOXCWITH - EXTRACT CHECK WITHOLDING RECORDS                                   
***********************************************************************         
                                                                                
TOXCWITH NTR1                                                                   
         LA    R5,TLCKELEM         R5=A(FIRST ELEMENT)                          
TOXCW10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXCWX                                                           
*                                                                               
         CLI   0(R5),TACWELQ       WITHHOLDING ELEMENT                          
         JE    TOXCW30                                                          
*                                                                               
         CLI   0(R5),TAATELQ       CANADIAN WITHHOLDING ELEMENT                 
         JNE   *+8                                                              
         BAS   RE,TOXCCTWR                                                      
*                                                                               
         CLI   0(R5),TALWELQ       LIEN WITHHOLDING ELEMENT                     
         JNE   *+8                                                              
         BRAS  RE,TOXCLWR                                                       
*                                                                               
         CLI   0(R5),TADWELQ       DUE COMPANY WITHHOLDING ELEMENT              
         JNE   *+8                                                              
         BAS   RE,TOXCDCWR                                                      
*                                                                               
         CLI   0(R5),TANUELQ       CAST SSN TO PRINT AGENT CHK                  
         JNE   *+8                                                              
         BRAS  RE,TOXCAGSR                                                      
*                                                                               
TOXCW20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXCW10                                                          
*                                                                               
         USING TACWD,R5                                                         
TOXCW30  CLC   =C'FD',TACWUNIT     FEDERAL?                                     
         JNE   *+12                                                             
         BRAS  RE,TOXCFTWR                                                      
         J     TOXCW20                                                          
         CLC   =C'CN',TACWUNIT     CANADIAN?                                    
         JNE   *+12                                                             
         BAS   RE,TOXCCTWR                                                      
         J     TOXCW20                                                          
         CLI   TACWUNIT+2,C' '     STATE?                                       
         JNE   *+8                                                              
         BAS   RE,TOXCSTWR                                                      
         CLI   TACWUNIT+2,C' '     CITY?                                        
         JE    *+8                                                              
         BAS   RE,TOXCYTWR                                                      
         J     TOXCW20                                                          
*                                                                               
TOXCWX   J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* TOXCCTWR - EXTRACT CHECK CANADIAN TAX WITHHOLDING RECORD                      
***********************************************************************         
         USING TACWD,R5                                                         
TOXCCTWR NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK61CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX61LEN)                                          
         MVC   TOXRETYP,TOXCCTWQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX61CHK-1,MXTRTQ                                                 
         MVI   TX61AMT-1,MXTRTQ                                                 
         MVI   TX61HSTD-1,MXTRTQ                                                
         MVI   TX61HSTP-1,MXTRTQ                                                
*        MVI   TX61ASS-1,MXTRTQ                                                 
         MVI   TX61X,MXTRTQ                                                     
         MVI   TX61X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX61CHK,SV57CHK     CHECK PRIMARY KEY                            
*        MVC   TX61ASS,SV57ASS     ASSET PRIMARY KEY                            
         EDIT  TACWTAX,TX61AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
         MVC   SVCWUNIT,TACWUNIT                                                
*                                                                               
         MVC   TX61HSTD,=C'        .00'                                         
         MVC   TX61HSTP,=C'        .00'                                         
*                                                                               
         LA    R5,TLCKELEM         R5=A(FIRST ELEMENT)                          
TCCTWR10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TCCTWRX                                                          
         CLI   0(R5),TACXELQ                                                    
         JE    TCCTWR20                                                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TCCTWR10                                                         
*                                                                               
         USING TACXD,R5                                                         
TCCTWR20 L     RF,TACXGST                                                       
         A     RF,TACXPST                                                       
         ST    RF,FULL                                                          
         CLC   SVCWUNIT,=C'CN '                                                 
         JE    *+12                                                             
         CLI   SVCURR,C'C'         CANADIAN DOLLARS?                            
         JE    TCCTWR22                                                         
         EDIT  FULL,TX61HSTD,2,FLOAT=-,ALIGN=RIGHT      HST DUE                 
         L     RF,FULL                                                          
         LNR   RF,RF                                                            
         ST    RF,FULL                                                          
         EDIT  FULL,TX61HSTP,2,FLOAT=-,ALIGN=RIGHT      HST PAID                
         J     TCCTWRX                                                          
TCCTWR22 EDIT  FULL,TX61HSTP,2,FLOAT=-,ALIGN=RIGHT      HST PAID                
         DROP  R5                                                               
*                                                                               
TCCTWRX  J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* TOXCSTWR - EXTRACT CHECK STATE TAX WITHHOLDING RECORD                         
***********************************************************************         
         USING TACWD,R5                                                         
TOXCSTWR NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK59CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX59LEN)                                          
         MVC   TOXRETYP,TOXCSTWQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX59CHK-1,MXTRTQ                                                 
         MVI   TX59WOR-1,MXTRTQ                                                 
         MVI   TX59UNIT-1,MXTRTQ                                                
         MVI   TX59MAR-1,MXTRTQ                                                 
         MVI   TX59NOE-1,MXTRTQ                                                 
         MVI   TX59TAX-1,MXTRTQ                                                 
         MVI   TX59UEA-1,MXTRTQ                                                 
         MVI   TX59DA-1,MXTRTQ                                                  
         MVI   TX59FLIA-1,MXTRTQ                                                
*        MVI   TX59ASS-1,MXTRTQ                                                 
         MVI   TX59X,MXTRTQ                                                     
         MVI   TX59X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX59CHK,SV57CHK     CHECK PRIMARY KEY                            
*        MVC   TX59ASS,SV57ASS     ASSET PRIMARY KEY                            
*                                                                               
         TM    TACWSTAT,TACWSRES   RESIDENT?                                    
         JZ    *+8                                                              
         MVI   TX59WOR,C'R'                                                     
*                                                                               
         TM    TACWSTAT,TACWSWRK   WORK?                                        
         JZ    *+8                                                              
         MVI   TX59WOR,C'W'                                                     
*                                                                               
         MVC   TX59UNIT,TACWUNIT   UNIT                                         
         MVC   TX59MAR,TACWMST     MARITAL STATUS                               
         MVC   TX59NOE,TACWEXS     EXEMPTIONS                                   
*                                                                               
         EDIT  TACWTAX,TX59TAX,2,FLOAT=-,ALIGN=RIGHT       TAX                  
         EDIT  TACWSUI,TX59UEA,2,FLOAT=-,ALIGN=RIGHT       UNEMP.               
         EDIT  TACWSDI,TX59DA,2,FLOAT=-,ALIGN=RIGHT        DISABLITY            
*                                                                               
         CLI   TACWLEN,TACWLN2Q                                                 
         JL    TCSTWRX                                                          
         EDIT  TACWSFLI,TX59FLIA,2,FLOAT=-,ALIGN=RIGHT     FAMILY               
*                                                                               
TCSTWRX  J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* TOXCYTWR - EXTRACT CHECK CITY TAX WITHHOLDING RECORD                          
***********************************************************************         
         USING TACWD,R5                                                         
TOXCYTWR NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK60CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX60LEN)                                          
         MVC   TOXRETYP,TOXCYTWQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX60CHK-1,MXTRTQ                                                 
         MVI   TX60WOR-1,MXTRTQ                                                 
         MVI   TX60UNIT-1,MXTRTQ                                                
         MVI   TX60MAR-1,MXTRTQ                                                 
         MVI   TX60NOE-1,MXTRTQ                                                 
         MVI   TX60TAX-1,MXTRTQ                                                 
*        MVI   TX60ASS-1,MXTRTQ                                                 
         MVI   TX60X,MXTRTQ                                                     
         MVI   TX60X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX60CHK,SV57CHK     CHECK PRIMARY KEY                            
*        MVC   TX60ASS,SV57ASS     ASSET PRIMARY KEY                            
*                                                                               
         TM    TACWSTAT,TACWSRES   RESIDENT?                                    
         JZ    *+8                                                              
         MVI   TX60WOR,C'R'                                                     
*                                                                               
         TM    TACWSTAT,TACWSWRK   WORK?                                        
         JZ    *+8                                                              
         MVI   TX60WOR,C'W'                                                     
*                                                                               
         MVC   TX60UNIT,TACWUNIT   UNIT                                         
         MVC   TX60MAR,TACWMST     MARITAL STATUS                               
         MVC   TX60NOE,TACWEXS     EMEPTIONS                                    
         EDIT  TACWTAX,TX60TAX,2,FLOAT=-,ALIGN=RIGHT       TAX                  
*                                                                               
TCYTWRX  J     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* TOXCDCWR - EXTRACT CHECK DUE COMPANY WITHHOLDING RECORD                       
***********************************************************************         
         USING TADWD,R5                                                         
TOXCDCWR NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK63CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX63LEN)                                          
         MVC   TOXRETYP,TOXCDCWQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX63CHK-1,MXTRTQ                                                 
         MVI   TX63REF-1,MXTRTQ                                                 
         MVI   TX63AMT-1,MXTRTQ                                                 
*        MVI   TX63ASS-1,MXTRTQ                                                 
         MVI   TX63X,MXTRTQ                                                     
         MVI   TX63X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX63CHK,SV57CHK     CHECK PRIMARY KEY                            
*        MVC   TX63ASS,SV57ASS     ASSET PRIMARY KEY                            
         EDIT  TADWREC,TX63AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
         MVC   TX63REF,TADWDUC     DUE COMPANY CODE                             
         CLI   TADWDUC,X'FA'       IS THIS A YEAR 2000 DATE?                    
         JL    TCDCWRX             NO                                           
         MVC   WORK(4),TADWDUC     YES, CONVERT TO DISPLAY                      
         MVC   WORK+4(2),=C'01'                                                 
         GOTO1 DATCON,DMCB,(0,WORK),(X'20',WORK)                                
         MVC   TX63REF(4),WORK                                                  
         MVC   TX63REF+4(2),TADWDUC+4                                           
*                                                                               
TCDCWRX  J     XIT                                                              
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
CKSEQ    DS    CL3                                                              
SV57CHK  DS    CL39                CHECK PRIMARY KEY                            
SV57ASS  DS    CL8                 ASSET PRIMARY KEY                            
SVCURR   DS    CL1                 CURRENCY                                     
SVCWUNIT DS    CL3                 UNIT                                         
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXPGRP - PRODUCT GROUP RECORDS - 5065                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRODUCT GROUP RECORD)                                                   
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXPGRC  NMOD1 WORKX-WORKD,*TOXPGR*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXPGRLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLPGD,R3            R3=A(PRODUCT GROUP)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXPGBLD                                                         
         JH    TOXPGNXT                                                         
*                                                                               
TOXPGRCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXPGRLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXPGNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX65LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX65LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXPGBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXPGR           BUILD PRODUCT GROUP RECORD                   
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXPGR - EXTRACT PRODUCT GROUP RECORD 5065                                    
***********************************************************************         
                                                                                
TOXPGR   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK65CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX65LEN)                                          
         MVC   TOXRETYP,TOXPGRQ                                                 
*                                                                               
         MVI   TX65PGPK-1,MXTRTQ                                                
         MVI   TX65AGY-1,MXTRTQ                                                 
         MVI   TX65CLI-1,MXTRTQ                                                 
         MVI   TX65PGC-1,MXTRTQ                                                 
         MVI   TX65NAME-1,MXTRTQ                                                
         MVI   TX65SNAM-1,MXTRTQ                                                
         MVI   TX65X,MXTRTQ                                                     
         MVI   TX65X+1,MXTRTQ                                                   
*                                                                               
         LH    RF,=Y(TX65LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXPGRCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX65PGPK,TLPGAGY    AGY + CLI + GROUP                            
         MVC   TX65AGY,TLPGAGY     AGENCY                                       
         MVC   TX65CLI,TLPGCLI     CLIENT                                       
         MVC   TX65PGC,TLPGPRG     PRODUCT GROUP                                
*                                                                               
         LA    R5,TLPGELEM         R5=A(FIRST ELEMENT)                          
TOXPG10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPGRXX                                                         
         CLI   0(R5),TANAELQ                                                    
         JE    TOXPG30                                                          
         CLI   0(R5),TASNELQ                                                    
         JE    TOXPG40                                                          
*                                                                               
TOXPG20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPG10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXPG30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXPG20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX65NAME(0),TANANAME                                             
         J     TOXPG20                                                          
*                                                                               
         USING TASND,R5                                                         
TOXPG40  MVC   TX65SNAM,TASNAME    SHORT NAME                                   
         J     TOXPG20                                                          
         DROP  R5                                                               
*                                                                               
TOXPGRXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
***********************************************************************         
* TOXTIMC - EXTRACT TIMESHEET RECORDS - 5069                          *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(TIMESHEET RECORD)                                             *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXTIMC  NMOD1 WORKX-WORKD,*TOXTIM*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXTIMET                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLTMD,R3            R3=A(TIMESHEET RECORD)                       
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXTMBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXTMNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXTIMEC DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOXTIMET DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXTMNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX69LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX69LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXTMBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXTIMR          BUILD TIMESHEET RECORD                       
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXTIMR -  - EXTRACT TIMESHEET RECORDS - 5069                       *         
***********************************************************************         
                                                                                
TOXTIMR  NTR1                                                                   
*                                                                               
         LH    RF,=Y(TX69LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXTIMEC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
         ST    R2,ANEXT2           FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LA    R5,TLTMELEM         R5=A(FIRST ELEMENT)                          
TOXTIM10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTIMXX                                                         
         CLI   0(R5),TATMELQ       TIMESHEET ELEMENT                            
         JE    TOXTIM30                                                         
*                                                                               
TOXTIM20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTIM10                                                         
*                                                                               
         USING TATMD,R5                                                         
         USING PKCNTS,RE                                                        
TOXTIM30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK69CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX69LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX69LEN)                                          
         MVC   TOXRETYP,TOXTIMEQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX69PTIM-1,MXTRTQ                                                
         MVI   TX69ASS-1,MXTRTQ                                                 
         MVI   TX69PINV-1,MXTRTQ                                                
         MVI   TX69PPER-1,MXTRTQ                                                
         MVI   TX69DATE-1,MXTRTQ                                                
         MVI   TX69SPOT-1,MXTRTQ                                                
         MVI   TX69TAGS-1,MXTRTQ                                                
         MVI   TX69WKST-1,MXTRTQ                                                
         MVI   TX69WKET-1,MXTRTQ                                                
         MVI   TX69NDBR-1,MXTRTQ                                                
         MVI   TX69M1ST-1,MXTRTQ                                                
         MVI   TX69M1ET-1,MXTRTQ                                                
         MVI   TX69M2ST-1,MXTRTQ                                                
         MVI   TX69M2ET-1,MXTRTQ                                                
         MVI   TX69M3ST-1,MXTRTQ                                                
         MVI   TX69M3ET-1,MXTRTQ                                                
         MVI   TX69PDWD-1,MXTRTQ                                                
         MVI   TX69PDST-1,MXTRTQ                                                
         MVI   TX69PDET-1,MXTRTQ                                                
         MVI   TX69NPRM-1,MXTRTQ                                                
         MVI   TX69MPN1-1,MXTRTQ                                                
         MVI   TX69MPN2-1,MXTRTQ                                                
         MVI   TX69MPN3-1,MXTRTQ                                                
         MVI   TX69SMKP-1,MXTRTQ                                                
         MVI   TX6916HR-1,MXTRTQ                                                
         MVI   TX69ADJA-1,MXTRTQ                                                
         MVI   TX69RHSD-1,MXTRTQ                                                
         MVI   TX69WXCL-1,MXTRTQ                                                
         MVI   TX69RPVL-1,MXTRTQ                                                
         MVI   TX69NCON-1,MXTRTQ                                                
         MVI   TX69TVLD-1,MXTRTQ                                                
         MVI   TX69TTDT-1,MXTRTQ                                                
         MVI   TX69TTAT-1,MXTRTQ                                                
         MVI   TX69TFDT-1,MXTRTQ                                                
         MVI   TX69TFAT-1,MXTRTQ                                                
         MVI   TX69TIDT-1,MXTRTQ                                                
         MVI   TX69TIAT-1,MXTRTQ                                                
         MVI   TX69NEWA-1,MXTRTQ                                                
         MVI   TX69EVWA-1,MXTRTQ                                                
         MVI   TX69OTRM-1,MXTRTQ                                                
         MVI   TX69CMNT-1,MXTRTQ                                                
         MVI   TX69X,MXTRTQ                                                     
         MVI   TX69X+1,MXTRTQ                                                   
*                                                                               
         XC    SVTMDATE,SVTMDATE                                                
*                                                                               
                                                                                
         LA    R6,TX69PTIM                        TIMESHEET PRIMARY KEY         
         GOTO1 VHEXOUT,DMCB,TLTMCOM,0(R6),L'TLTMCOM,0                           
         AHI   R6,8                                                             
         MVC   DUB(6),TLTMINV                                                   
         XC    DUB(6),=6X'FF'                                                   
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLTMINV,0                               
         AHI   R6,12                                                            
         GOTO1 VHEXOUT,DMCB,TLTMSORT,0(R6),L'TLTMSORT,0                         
         AHI   R6,12                                                            
         MVC   0(L'TLTMCAT,R6),TLTMCAT                                          
         AHI   R6,3                                                             
         GOTO1 VHEXOUT,DMCB,TATMDATE,0(R6),L'TATMDATE,0                         
*                                                                               
         CLC   TX69PTIM,=C'0007593E201407002300020800000001P  B40101'           
         BNE   *+6                                                              
         XR    R0,R0                                                            
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLTMCOM,TX69ASS,L'FULL,0    ASSET PR KEY            
*                                                                               
         MVC   DUB(6),TLTMINV                                                   
         XC    DUB(6),=6X'FF'                                                   
         GOTO1 TINVCON,DMCB,DUB,TX69PINV,DATCON         INVOICE NUMBER          
*                                                                               
         LA    R6,TX69PPER                       PERFORMER PRIMARY KEY          
         GOTO1 VHEXOUT,DMCB,TLTMCOM,0(R6),L'TLTMCOM,0                           
         AHI   R6,8                                                             
         GOTO1 VHEXOUT,DMCB,TLTMSORT+4,0(R6),2,0                                
*                                                                               
         GOTO1 DATCON,DMCB,(X'01',TATMDATE),(10,TX69DATE)   TIME DATE           
         MVC   SVTMDATE,TATMDATE               SAVE TIMESHEET DATE              
*                                                                               
         EDIT  TATMWTST,FULL,ALIGN=RIGHT,FILL=0   WORK START                    
         LA    R4,TX69WKST                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMWTNT,FULL,ALIGN=RIGHT,FILL=0   WORK END                      
         LA    R4,TX69WKET                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         MVI   TX69NDBR,C'N'                   NON DEDUCTBLE MEAL               
         TM    TATMSTA2,TATMS2NM                                                
         BZ    *+8                                                              
         MVI   TX69NDBR,C'Y'                                                    
*                                                                               
         EDIT  TATMM1ST,FULL,ALIGN=RIGHT,FILL=0   MEAL 1 START                  
         LA    R4,TX69M1ST                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMM1NT,FULL,ALIGN=RIGHT,FILL=0   MEAL 1 END                    
         LA    R4,TX69M1ET                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMM2ST,FULL,ALIGN=RIGHT,FILL=0   MEAL 2 START                  
         LA    R4,TX69M2ST                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMM2NT,FULL,ALIGN=RIGHT,FILL=0   MEAL 2 END                    
         LA    R4,TX69M2ET                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMM3ST,FULL,ALIGN=RIGHT,FILL=0   MEAL 3 START                  
         LA    R4,TX69M3ST                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMM3NT,FULL,ALIGN=RIGHT,FILL=0   MEAL 3 END                    
         LA    R4,TX69M3ET                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         GOTO1 DATCON,DMCB,(X'01',TATMPWDT),(10,TX69PDWD)   PDWD DATE           
*                                                                               
         EDIT  TATMPDST,FULL,ALIGN=RIGHT,FILL=0   PDWD START                    
         LA    R4,TX69PDST                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMPDNT,FULL,ALIGN=RIGHT,FILL=0  PDWD END                       
         LA    R4,TX69PDET                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         MVI   TX69NPRM,C'N'                   NIGHT PREMIUM?                   
         TM    TATMSTAT,TATMSNPY                                                
         BZ    *+8                                                              
         MVI   TX69NPRM,C'Y'                                                    
*                                                                               
         MVI   TX69MPN1,C'N'                   MEAL PENALTY 1?                  
         TM    TATMSTAT,TATMSMPY                                                
         BZ    *+8                                                              
         MVI   TX69MPN1,C'Y'                                                    
*                                                                               
         MVI   TX69MPN2,C'N'                   MEAL PENALTY 2?                  
         TM    TATMSTAT,TATMSM2Y                                                
         BZ    *+8                                                              
         MVI   TX69MPN2,C'Y'                                                    
*                                                                               
         MVI   TX69MPN3,C'N'                   MEAL PENALTY 3?                  
         TM    TATMSTA3,TATMSM3Y                                                
         BZ    *+8                                                              
         MVI   TX69MPN3,C'Y'                                                    
*                                                                               
         MVI   TX69SMKP,C'N'                   SMOKE PAY?                       
         TM    TATMSTA2,TATMS2SP                                                
         BZ    *+8                                                              
         MVI   TX69SMKP,C'Y'                                                    
*                                                                               
         MVI   TX6916HR,C'N'                   16HR RULE?                       
         TM    TATMSTAT,TATMS16Y                                                
         BZ    *+8                                                              
         MVI   TX6916HR,C'Y'                                                    
*                                                                               
         MVI   TX69RHSD,C'N'                   REHEARSAL DAY?                   
         TM    TATMSTA2,TATMS2RD                                                
         BZ    *+8                                                              
         MVI   TX69RHSD,C'Y'                                                    
*                                                                               
         MVI   TX69WXCL,C'N'                   WEATHER CANCELLATION?            
         TM    TATMSTA2,TATMS2WC                                                
         BZ    *+8                                                              
         MVI   TX69WXCL,C'Y'                                                    
*                                                                               
         MVI   TX69RPVL,C'N'                   REST PERIOD VIOLATION?           
         TM    TATMSTA3,TATMSRPY                                                
         BZ    *+8                                                              
         MVI   TX69RPVL,C'Y'                                                    
*                                                                               
         MVI   TX69NCON,C'N'                   NON-CONSECUTIVE DAY?             
         TM    TATMSTA2,TATMS2NC                                                
         BZ    *+8                                                              
         MVI   TX69NCON,C'Y'                                                    
*                                                                               
         MVI   TX69TVLD,C'N'                   TRAVEL TO DISTANT LOC            
         TM    TATMSTA2,TATMS2DL                                                
         BZ    *+8                                                              
         MVI   TX69TVLD,C'Y'                                                    
*                                                                               
         EDIT  TATMTTDP,FULL,ALIGN=RIGHT,FILL=0   TRAVEL TO DEPART              
         LA    R4,TX69TTDT                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMTTAR,FULL,ALIGN=RIGHT,FILL=0   TRAVEL TO ARRIVE              
         LA    R4,TX69TTAT                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMTFDP,FULL,ALIGN=RIGHT,FILL=0   TRAVEL FROM DEPART            
         LA    R4,TX69TFDT                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMTFAR,FULL,ALIGN=RIGHT,FILL=0   TRAVEL FROM ARRIVE            
         LA    R4,TX69TFAT                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMTIDP,FULL,ALIGN=RIGHT,FILL=0   INT. TRAVEL DEPART            
         LA    R4,TX69TIDT                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMTIAR,FULL,ALIGN=RIGHT,FILL=0   INT. TRAVEL ARRIVE            
         LA    R4,TX69TIAT                                                      
         MVC   0(2,R4),FULL                    HOURS                            
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2                  MINUTES                          
*                                                                               
         EDIT  TATMWANE,TX69NEWA               NON-EVENING WARDROBE             
         EDIT  TATMWAEV,TX69EVWA               EVENING WARDROBE                 
         EDIT  TATMOTHR,TX69OTRM,2,ALIGN=LEFT,ZERO=BLANK  OTHER REIMB.          
         DROP  R5                                                               
*                                                                               
         BAS   RE,TOXTIMR2                     EXTRACT OTHER ELEMENTS           
*                                                                               
         J     TOXTIM20                                                         
*                                                                               
TOXTIMXX J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXTIMR2  - EXTRACT OTHER ELEMENTS FOR A TIMESHEET DAY (5069)       *         
***********************************************************************         
TOXTIMR2 NTR1                                                                   
*                                                                               
         LA    R5,TLTMELEM         R5=A(FIRST ELEMENT)                          
TOXTM210 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXTM2XX                                                         
         CLI   0(R5),TATTELQ       TIMESHEET TOTAL ELEMENT                      
         JE    TOXTM230                                                         
         CLI   0(R5),TACMELQ       COMMENT ELEMENT                              
         JE    TOXTM240                                                         
*                                                                               
TOXTM220 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXTM210                                                         
*                                                                               
         USING TATTD,R5                                                         
TOXTM230 CLC   TATTDATE,SVTMDATE   GET MATCHING TIMESHEET DATE                  
         JNE   TOXTM220                                                         
         EDIT  TATTSPOT,TX69SPOT,ALIGN=LEFT    SPOTS                            
         EDIT  TATTTAG,TX69TAGS,ALIGN=LEFT     TAGS                             
         EDIT  TATTADJ,TX69ADJA,2,ALIGN=LEFT,ZERO=BLANK  ADJ. AMT               
         J     TOXTM220                                                         
         DROP  R5                                                               
*                                                                               
         USING TACMD,R5                                                         
TOXTM240 CLI   TACMTYPE,TACMTYPG   GENERAL COMMENT                              
         JNE   TOXTM220                                                         
         CLC   TACMCOMM(L'SVTMDATE),SVTMDATE  GET MATCHING TMSHT DATE           
         JNE   TOXTM220                                                         
         LA    R3,TACMCOMM+L'SVTMDATE  TIMESHEET COMMENT                        
         ZIC   R1,TACMLEN                                                       
         SHI   R1,7                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX69CMNT(0),0(R3)                                                
         J     TOXTM220                                                         
         DROP  R5                                                               
*                                                                               
TOXTM2XX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
SVTMDATE DS    CL3                          TIMESHEET DATE                      
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCTLC - EXTRACT CONTROL RECORDS - 5070                            *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(CONTROL RECORD)                                               *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXCTLC  NMOD1 WORKX-WORKD,*TOXCTL*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXCTLLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLCTD,R3            R3=A(CONTROL RECORD)                         
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXCTBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXCTNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXCTLCC DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOXCTLLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXCTNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX70LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX70LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXCTBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXCTLR          BUILD CONTROL RECORD                         
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXCTLR -  - EXTRACT CONTROL RECORDS - 5070                         *         
***********************************************************************         
                                                                                
TOXCTLR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK70CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX70LEN)                                          
         MVC   TOXRETYP,TOXCTLQ                                                 
*                                                                               
         MVI   TX70AGY-1,MXTRTQ                                                 
         MVI   TX70CLI-1,MXTRTQ                                                 
         MVI   TX70ACRL-1,MXTRTQ                                                
         MVI   TX70ACRT-1,MXTRTQ                                                
         MVI   TX70X,MXTRTQ                                                     
         MVI   TX70X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX70AGY,TLCTAGY     AGENCY                                       
         MVC   TX70CLI,TLCTCLI     CLIENT                                       
*                                                                               
         LH    RF,=Y(TX70LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXCTLCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLCTELEM         R5=A(FIRST ELEMENT)                          
TOXCT10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXCTLXX                                                         
         CLI   0(R5),TAEPELQ                                                    
         JE    TOXCT30                                                          
*                                                                               
TOXCT20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXCT10                                                          
*                                                                               
         USING TAEPD,R5                                                         
TOXCT30  MVI   TX70ACRL,C'N'                                                    
         CLI   TAEPCOMM,0                                                       
         BE    *+10                                                             
         MVC   TX70ACRL,TAEPCOMM   AGY COMMISSION RULE                          
         EDIT  TAEPRATE,TX70ACRT,2,ALIGN=RIGHT,ZERO=NOBLANK                     
         J     TOXCT20                                                          
         DROP  R5                                                               
*                                                                               
*                                                                               
TOXCTLXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXEMPC - EXTRACT EMPLOYER RECORDS - 5071                           *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(EMPLOYER RECORD)                                              *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXEMPC  NMOD1 WORKX-WORKD,*TOXEMP*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXEMPLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLEMD,R3            R3=A(EMPLOYER RECORD)                        
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXEMBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXEMNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXEMPCC DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOXEMPLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXEMNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX71LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX71LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXEMBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXEMPR          BUILD EMPLOYER RECORD                        
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXEMPR -  - EXTRACT EMPLOYER RECORDS - 5071                        *         
***********************************************************************         
                                                                                
TOXEMPR  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK71CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX71LEN)                                          
         MVC   TOXRETYP,TOXEMPQ                                                 
*                                                                               
         MVI   TX71EMP-1,MXTRTQ                                                 
         MVI   TX71EMPN-1,MXTRTQ                                                
         MVI   TX71IRSN-1,MXTRTQ                                                
         MVI   TX71GSTN-1,MXTRTQ                                                
         MVI   TX71DSTA-1,MXTRTQ                                                
         MVI   TX71ADD1-1,MXTRTQ                                                
         MVI   TX71ADD2-1,MXTRTQ                                                
         MVI   TX71X,MXTRTQ                                                     
         MVI   TX71X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX71EMP,TLEMEMP     EMPLOYER CODE                                
*                                                                               
         LH    RF,=Y(TX71LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXEMPCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLEMELEM         R5=A(FIRST ELEMENT)                          
TOXEM10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXEMLXX                                                         
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOXEM30                                                          
         CLI   0(R5),TAADELQ       ADDRESS                                      
         JE    TOXEM40                                                          
         CLI   0(R5),TANUELQ       NUMBER ELEMENT                               
         JE    TOXEM50                                                          
         CLI   0(R5),TAEDELQ       EMPLOYER DETAILS                             
         JE    TOXEM60                                                          
         CLI   0(R5),TATIELQ       TAX ID                                       
         JE    TOXEM70                                                          
*                                                                               
TOXEM20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXEM10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXEM30  SR    RF,RF               EMPLOYER NAME                                
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXEM20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX71EMPN(0),TANANAME                                             
         J     TOXEM20                                                          
         DROP  R5                                                               
                                                                                
         USING TAADD,R5                                                         
TOXEM40  LA    RF,TAADADD                                                       
         MVC   TX71ADD1,0(RF)      ADDRESS LINE 1                               
         AHI   RF,L'TAADADD                                                     
         CLI   TAADLNES,1          N'LINES                                      
         JE    TOXEM20                                                          
         MVC   TX71ADD2,0(RF)      ADDRESS LINE 2                               
         J     TOXEM20                                                          
         DROP  R5                                                               
                                                                                
         USING TANUD,R5                                                         
TOXEM50  CLI   TANUTYPE,TANUTGST   GST?                                         
         JNE   TOXEM20                                                          
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX71GSTN(0),TANUMBER                                             
         J     TOXEM20                                                          
         DROP  R5                                                               
                                                                                
         USING TAEDD,R5                                                         
TOXEM60  MVC   TX71DSTA,TAEDDST    DEFAULT STATE                                
         J     TOXEM20                                                          
         DROP  R5                                                               
                                                                                
         USING TATID,R5                                                         
TOXEM70  CLI   TATITYPE,TATITYUN   UNEMPLOYMENT?                                
         JNE   TOXEM20                                                          
         CLC   TATIUNIT,=CL3'FD '  FEDERAL?                                     
         JNE   TOXEM20                                                          
         MVC   TX71IRSN,TATIID                                                  
         J     TOXEM20                                                          
         DROP  R5                                                               
*                                                                               
TOXEMLXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXLIEC - EXTRACT LIEN RECORDS - 5072                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(LIEN RECORD)                                                  *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXLIEC  NMOD1 WORKX-WORKD,*TOXLIE*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXLIELT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLLND,R3            R3=A(LIEN RECORD)                            
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXLIBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXLINXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXLIECC DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOXLIELT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXLINXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX72LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX72LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXLIBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXLIER          BUILD EMPLOYER RECORD                        
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXLIER -  - EXTRACT LIEN RECORDS - 5072                                      
***********************************************************************         
                                                                                
TOXLIER  NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK72CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX72LEN)                                          
         MVC   TOXRETYP,TOXLIENQ                                                
*                                                                               
         MVI   TX72LPK-1,MXTRTQ                                                 
         MVI   TX72PID-1,MXTRTQ                                                 
         MVI   TX72REF-1,MXTRTQ                                                 
         MVI   TX72EMP-1,MXTRTQ                                                 
         MVI   TX72LT-1,MXTRTQ                                                  
         MVI   TX72EFT-1,MXTRTQ                                                 
         MVI   TX72PLTP-1,MXTRTQ                                                
         MVI   TX72EXP-1,MXTRTQ                                                 
         MVI   TX72CUR-1,MXTRTQ                                                 
         MVI   TX72TU-1,MXTRTQ                                                  
         MVI   TX72AD-1,MXTRTQ                                                  
         MVI   TX72EA-1,MXTRTQ                                                  
         MVI   TX72DA-1,MXTRTQ                                                  
         MVI   TX72DP-1,MXTRTQ                                                  
         MVI   TX72CA-1,MXTRTQ                                                  
         MVI   TX72BA-1,MXTRTQ                                                  
         MVI   TX72NL1-1,MXTRTQ                                                 
         MVI   TX72NL2-1,MXTRTQ                                                 
         MVI   TX72NL3-1,MXTRTQ                                                 
         MVI   TX72CAN-1,MXTRTQ                                                 
         MVI   TX72X,MXTRTQ                                                     
         MVI   TX72X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLLNSSN,DUB                                         
         MVC   TX72LPK(6),DUB       PID                                         
         MVC   TX72LPK+6(6),TLLNLIN LIEN CODE                                   
*                                                                               
         MVC   TX72PID,DUB         PID                                          
         MVC   TX72REF,TLLNLIN     REFERENCE #                                  
*                                                                               
         LH    RF,=Y(TX72LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXLIECC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLLNELEM         R5=A(FIRST ELEMENT)                          
TOXLI10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXLIEXX                                                         
         CLI   0(R5),TALNELQ       LIEN DETAILS ELEMENT                         
         JE    TOXLI30                                                          
         CLI   0(R5),TACMELQ       COMMENT ELEMENT                              
         JE    TOXLI40                                                          
*                                                                               
TOXLI20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXLI10                                                          
*                                                                               
         USING TALND,R5                                                         
TOXLI30  MVC   TX72LT,TALNTYPE     LIEN TYPE                                    
         MVC   TX72EMP,TALNEMP     EMPLOYER                                     
         MVI   TX72EFT,C'N'                                                     
*                                                                               
         MVI   TX72EFT,C'N'                                                     
         TM    TALNSTAT,TALNSEFT   EFT?                                         
         JZ    *+8                                                              
         MVI   TX72EFT,C'Y'                                                     
*                                                                               
         GOTOR SSN2PID,DMCB,TALNPAYE,DUB                                        
         MVC   TX72PLTP,DUB         PID                                         
*                                                                               
         OC    TALNEXP,TALNEXP                                                  
         JZ    TOXLI32                                                          
         GOTO1 DATCON,DMCB,(X'01',TALNEXP),(10,TX72EXP) EXP DATE                
*                                                                               
TOXLI32  MVI   TX72CUR,C'U'        CURRENCY                                     
         TM    TALNSTAT,TALNSCAN                                                
         JZ    *+8                                                              
         MVI   TX72CUR,C'C'                                                     
         TM    TALNSTAT,TALNSEUR                                                
         JZ    *+8                                                              
         MVI   TX72CUR,C'E'                                                     
*                                                                               
         MVC   TX72TU,TALNUNIT     TAX UNIT                                     
*                                                                               
         EDIT  TALNDUE,TX72AD,2,ALIGN=LEFT,ZERO=NOBLANK                         
         EDIT  TALNXMPT,TX72EA,2,ALIGN=LEFT,ZERO=NOBLANK                        
         EDIT  TALNAMT,TX72DA,2,ALIGN=LEFT,ZERO=NOBLANK                         
         EDIT  TALNPCT,TX72DP,2,ALIGN=LEFT,ZERO=NOBLANK                         
         EDIT  TALNCOL,TX72CA,2,ALIGN=LEFT,ZERO=NOBLANK                         
         ICM   RF,15,TALNDUE                                                    
         ICM   RE,15,TALNCOL                                                    
         SR    RF,RE                                                            
         EDIT  (RF),TX72BA,2,ALIGN=LEFT,ZERO=NOBLANK                            
         J     TOXLI20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXLI40  CLI   TACMTYPE,TACMTYPL   LIEN CASE/ACCOUNT 3?                         
         JNE   TOXLI45                                                          
         ZIC   R1,1(R5)                                                         
         SHI   R1,3                                                             
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TX72CAN(0),TACMCOMM                                              
         J     TOXLI20                                                          
*                                                                               
TOXLI45  MVC   LIENNL,SPACES       NARRATIVE LINES                              
         ZIC   R1,1(R5)                                                         
         SHI   R1,3                                                             
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   LIENNL(0),TACMCOMM                                               
         MVC   TX72NL1,LIENNL                                                   
         MVC   TX72NL2,LIENNL+L'TX72NL1                                         
         MVC   TX72NL3,LIENNL+L'TX72NL1+L'TX72NL2                               
         J     TOXLI20                                                          
*                                                                               
TOXLIEXX J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
LIENNL   DS    CL180                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXDCC  - EXTRACT DUE COMPANY RECORS - 5073                                   
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(DUE COMPANY RECORD)                                           *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXDCC   NMOD1 WORKX-WORKD,*TOXDC*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOXDCLT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLDUD,R3            R3=A(DUE COMPANY RECORD)                     
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXDCBLD            BUILD COMMERCIAL AND SUBSET RECS             
         JH    TOXDCNXT            OUTPUT NEXT RECORD                           
*                                                                               
TOXDCCC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOXDCLT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXDCNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX73LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX73LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXDCBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXDCR           BUILD EMPLOYER RECORD                        
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXDCR  -  - EXTRACT DUE COMPANY RECORDS - 5073                               
***********************************************************************         
                                                                                
TOXDCR   NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK73CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX73LEN)                                          
         MVC   TOXRETYP,TOXDCQ                                                  
*                                                                               
         MVI   TX73DCPK-1,MXTRTQ                                                
         MVI   TX73PID-1,MXTRTQ                                                 
         MVI   TX73REF-1,MXTRTQ                                                 
         MVI   TX73EMP-1,MXTRTQ                                                 
         MVI   TX73ET-1,MXTRTQ                                                  
         MVI   TX73AC-1,MXTRTQ                                                  
         MVI   TX73AF-1,MXTRTQ                                                  
         MVI   TX73U-1,MXTRTQ                                                   
         MVI   TX73IPK-1,MXTRTQ                                                 
         MVI   TX73CIPK-1,MXTRTQ                                                
         MVI   TX73CC-1,MXTRTQ                                                  
         MVI   TX73CF-1,MXTRTQ                                                  
         MVI   TX73AD-1,MXTRTQ                                                  
         MVI   TX73FLAG-1,MXTRTQ                                                
         MVI   TX73DP-1,MXTRTQ                                                  
         MVI   TX73CA-1,MXTRTQ                                                  
         MVI   TX73BA-1,MXTRTQ                                                  
         MVI   TX73RFA-1,MXTRTQ                                                 
         MVI   TX73RFC-1,MXTRTQ                                                 
         MVI   TX73CUR-1,MXTRTQ                                                 
         MVI   TX73LOCK-1,MXTRTQ                                                
         MVI   TX73NL1-1,MXTRTQ                                                 
         MVI   TX73NL2-1,MXTRTQ                                                 
         MVI   TX73NL3-1,MXTRTQ                                                 
         MVI   TX73X,MXTRTQ                                                     
         MVI   TX73X+1,MXTRTQ                                                   
*                                                                               
         GOTOR SSN2PID,DMCB,TLDUSSN,DUB                                         
         MVC   TX73DCPK(6),DUB      PID                                         
         MVC   TX73PID,DUB                                                      
*                                                                               
         MVC   TX73REF,TLDUDUC                                                  
         MVC   TX73DCPK+6(6),TLDUDUC                                            
*                                                                               
         CLI   TLDUDUC,X'FA'       IS THIS A YEAR 2000 DATE?                    
         BL    TOXDC05             NO                                           
         MVC   WORK(4),TLDUDUC     YES, CONVERT TO DISPLAY                      
         MVC   WORK+4(2),=C'01'                                                 
         GOTO1 DATCON,DMCB,(0,WORK),(X'20',WORK)                                
         MVC   TX73DCPK+6(4),WORK                                               
         MVC   TX73DCPK+10(2),TLDUDUC+4                                         
         MVC   TX73REF,TX73DCPK+6  REFERENCE #                                  
*                                                                               
TOXDC05  LH    RF,=Y(TX73LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXDCCC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         LA    R5,TLDUELEM         R5=A(FIRST ELEMENT)                          
TOXDC10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXDCXX                                                          
         CLI   0(R5),TADUELQ       DUE COMPANY ELEMENT                          
         JE    TOXDC30                                                          
         CLI   0(R5),TACMELQ       COMMENT ELEMENT                              
         JE    TOXDC40                                                          
*                                                                               
TOXDC20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXDC10                                                          
*                                                                               
         USING TADUD,R5                                                         
TOXDC30  MVC   TX73EMP,TADUEMP     EMPLOYER                                     
         MVC   TX73ET,TADUTYPE     ERROR TYPE                                   
         MVC   TX73AC,TADUAGY      AGENCY CODE                                  
         MVC   TX73AF,TADUAYFL     AGENCY FLIST                                 
         MVC   TX73U,TADUUNI       UNION                                        
         MVC   TX73CC,TADUFCLI     CLIENT                                       
         MVC   TX73CF,TADUCLFL     CLIENT FLIST                                 
*                                                                               
         MVI   TX73CUR,C'U'        CURRENCY                                     
         TM    TADUSTAT,TADUSCAN                                                
         JZ    *+8                                                              
         MVI   TX73CUR,C'C'                                                     
         TM    TADUSTAT,TADUSEUR                                                
         JZ    *+8                                                              
         MVI   TX73CUR,C'E'                                                     
*                                                                               
         MVI   TX73FLAG,C'T'       FLAG                                         
         TM    TADUSTAT,TADUSNTR   NON TAXABLE REIMBURSEMENTS?                  
         JZ    *+8                                                              
         MVI   TX73FLAG,C'N'                                                    
         TM    TADUSTA2,TADUSTXR   TAXABLE REIMBURSEMENTS?                      
         JZ    *+8                                                              
         MVI   TX73FLAG,C'R'                                                    
*                                                                               
         EDIT  TADUDUE,TX73AD,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                 
         EDIT  TADUPCT,TX73DP,2,ALIGN=LEFT,ZERO=NOBLANK                         
         EDIT  TADUCOL,TX73CA,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                 
         ICM   RF,15,TADUDUE                                                    
         ICM   RE,15,TADUCOL                                                    
         SR    RF,RE                                                            
         EDIT  (RF),TX73BA,2,ALIGN=LEFT,ZERO=NOBLANK,FLOAT=-                    
*                                                                               
         MVI   TX73RFA,C'N'                                                     
         TM    TADUSTAT,TADUSAGY   RECOVER FROM AGENCY?                         
         JZ    *+8                                                              
         MVI   TX73RFA,C'Y'                                                     
         MVI   TX73RFC,C'N'                                                     
         TM    TADUSTAT,TADUSCLI   RECOVER FROM CLIENT?                         
         JZ    *+8                                                              
         MVI   TX73RFC,C'Y'                                                     
         MVI   TX73LOCK,C'N'                                                    
         TM    TADUSTAT,TADUSLCK   LOCKED?                                      
         JZ    *+8                                                              
         MVI   TX73LOCK,C'Y'                                                    
*                                                                               
         OC    TADUINV,TADUINV                                                  
         JZ    TOXDC33                                                          
         MVC   TX73IPK(L'TADUAGY),TADUAGY                                       
         MVC   DUB(6),TADUINV                                                   
*        XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX73IPK                                                       
         LA    RE,6                                                             
TOXDC32  CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXDC32                                                       
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TADUINV,0  INV PRIM KEY                 
*                                                                               
TOXDC33  OC    TADUCINV,TADUCINV                                                
         JZ    TOXDC20                                                          
         MVC   TX73CIPK(L'TADUAGY),TADUAGY                                      
         MVC   DUB(6),TADUCINV                                                  
*        XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX73CIPK                                                      
         LA    RE,6                                                             
TOXDC34  CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXDC34                                                       
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TADUCINV,0  CREDIT INV PRIM KEY         
         J     TOXDC20                                                          
*                                                                               
         USING TACMD,R5                                                         
TOXDC40  MVC   DCNNL,SPACES        NARRATIVE LINES                              
         ZIC   R1,1(R5)                                                         
         SHI   R1,3                                                             
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   DCNNL(0),TACMCOMM                                                
         MVC   TX73NL1,DCNNL                                                    
         MVC   TX73NL2,DCNNL+L'TX73NL1                                          
         MVC   TX73NL3,DCNNL+L'TX73NL1+L'TX73NL2                                
         J     TOXLI20                                                          
*                                                                               
TOXDCXX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
DCNNL    DS    CL180                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOX74  - EXTRACT INTERNET/NEW MEDIA RECORDS (5074)                            
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(MEDIA RECORD)                                                 *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX74C   NMOD1 WORKX-WORKD,*TOX74*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX74LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLMDD,R3            R3=A(INTERNET NEW MEDIA RECORD)              
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX74BLD            BUILD RECS                                   
         JH    TOX74NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX74CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX74LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX74NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX74LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX74LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX74BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX74R           BUILD  RECORD                                
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX74R  -  - EXTRACT MEDIA RECORDS - 5074                                     
***********************************************************************         
                                                                                
TOX74R   NTR1                                                                   
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK74CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX74LEN)                                          
         MVC   TOXRETYP,TOX5074Q                                                
*                                                                               
         MVI   TX74INPK-1,MXTRTQ                                                
         MVI   TX74INMD-1,MXTRTQ                                                
         MVI   TX74INCD-1,MXTRTQ                                                
         MVI   TX74INNM-1,MXTRTQ                                                
         MVI   TX74X,MXTRTQ                                                     
         MVI   TX74X+1,MXTRTQ                                                   
                                                                                
* PRIMARY KEY GETS NUMERIC MEDIA TYPE                                           
                                                                                
         MVC   TX74INPK(1),TLMDTYPE    MOVE MEDIA                               
         OI    TX74INPK,X'F0'          AND MAKE IT EBCDIC                       
         MVC   TX74INPK+1(4),TLMDCODE  MOVE CODE                                
*                                                                               
         MVI   TX74INMD,C'N'                                                    
         CLI   TLMDTYPE,4                                                       
         JE    TOX74R2                                                          
         MVI   TX74INMD,C'I'                                                    
         CLI   TLMDTYPE,8                                                       
         JE    TOX74R2                                                          
         DC    H'0'                                                             
*                                                                               
TOX74R2  MVC   TX74INCD,TLMDCODE                                                
*                                                                               
         LA    R5,TLMDELEM                                                      
         CLI   0(R5),TANAELQ       NAME ELEMENT X'20'                           
         JE    TOX74R6                                                          
         CLI   0(R5),0                                                          
         JE    *+2                                                              
*                                                                               
TOX74R4  LLC   RF,1(R5)                                                         
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOX74R4                                                          
*                                                                               
         USING TANAD,R5                                                         
TOX74R6  LLC   RF,TANALEN          MEDIA NAME                                   
         AHI   RF,-TANALNQ                                                      
         AHI   RF,-1                                                            
         JM    TOXEM20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX74INNM(0),TANANAME                                             
         DROP  R5                                                               
*                                                                               
         LHI   RF,TX74LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX74CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
TOX74X   J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
TOX75C   DC    H'0'                CODE MOVED TO TOXASS PROCESSING              
         EJECT                                                                  
***********************************************************************         
* TOX76  - EXTRACT COMMERCIAL GROUP RECORDS (5076)                              
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(CMML POOL REC)                                                *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX76C   NMOD1 WORKX-WORKD,*TOX76*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX76LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLOGD,R3            R3=A(CMML POOL RECORD)                       
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX76BLD            BUILD RECS                                   
         JH    TOX76NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX76CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX76LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX76NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX76LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX76LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX76BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX76R           BUILD CMML GROUP REC                         
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX76R  -  - EXTRACT CMML GROUP RECORDS - 5076                                
***********************************************************************         
                                                                                
TOX76R   NTR1                                                                   
         USING TAMDD,R5                                                         
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK76CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX76LEN)                                          
         MVC   TOXRETYP,TOX5076Q                                                
*                                                                               
         MVI   TX76CPPK-1,MXTRTQ                                                
         MVI   TX76CPAG-1,MXTRTQ                                                
         MVI   TX76CPCL-1,MXTRTQ                                                
         MVI   TX76CPPR-1,MXTRTQ                                                
         MVI   TX76CPID-1,MXTRTQ                                                
         MVI   TX76CPNM-1,MXTRTQ                                                
         MVI   TX76CPSN-1,MXTRTQ                                                
         MVI   TX76X,MXTRTQ                                                     
         MVI   TX76X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX76LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX76CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX76CPAG,TLOGAGY                                                 
         MVC   TX76CPCL,TLOGCLI                                                 
         MVC   TX76CPPR,TLOGPRD                                                 
         MVC   TX76CPID,TLOGCOG                                                 
*                                                                               
         MVC   TX76CPPK+00(6),TX76CPAG   CONCATENATE THE FIELDS                 
         MVC   TX76CPPK+06(6),TX76CPCL                                          
         MVC   TX76CPPK+12(6),TX76CPPR                                          
         MVC   TX76CPPK+18(6),TX76CPID                                          
         OC    TX76CPPK,SPACES           AND SPACE FILL!                        
*                                                                               
         LA    R5,TLOGELEM                                                      
         J     TOX76R4                                                          
*                                                                               
TOX76R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX76R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         USING TANAD,R5                                                         
         CLI   0(R5),TANAELQ                                                    
         JNE   TOX76R6                                                          
         LLC   RE,1(R5)                                                         
         AHI   RE,-3                                                            
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX76CPNM(0),TANANAME                                             
         J     TOX76R2                                                          
*                                                                               
         USING TASND,R5                                                         
TOX76R6  CLI   0(R5),TASNELQ                                                    
         JNE   TOX76R2                                                          
         LLC   RE,1(R5)                                                         
         AHI   RE,-3                                                            
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX76CPSN(0),TASNAME                                              
         J     TOX76R2                                                          
         DROP  R5                                                               
*                                                                               
TOX76RX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOX77  - EXTRACT COMMERCIAL GROUP RECORDS (5077)                              
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(CMML POOL REC)                                                *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX77C   NMOD1 WORKX-WORKD,*TOX77*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX77LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLATD,R3            R3=A(ATTENTION RECORD)                       
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX77BLD            BUILD RECS                                   
         JH    TOX77NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX77CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX77LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX77NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX77LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX77LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX77BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX77R           BUILD CMML GROUP REC                         
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX77R  -  - EXTRACT CMML GROUP RECORDS - 5077                                
***********************************************************************         
                                                                                
TOX77R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK77CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX77LEN)                                          
         MVC   TOXRETYP,TOX5077Q                                                
*                                                                               
         MVI   TX77BTPK-1,MXTRTQ                                                
         MVI   TX77BTAG-1,MXTRTQ                                                
         MVI   TX77BTCD-1,MXTRTQ                                                
         MVI   TX77BTNM-1,MXTRTQ                                                
         MVI   TX77BTA1-1,MXTRTQ                                                
         MVI   TX77BTA2-1,MXTRTQ                                                
         MVI   TX77BTA3-1,MXTRTQ                                                
         MVI   TX77BTA4-1,MXTRTQ                                                
         MVI   TX77BTAT-1,MXTRTQ                                                
         MVI   TX77BTML-1,MXTRTQ                                                
         MVI   TX77X,MXTRTQ                                                     
         MVI   TX77X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX77LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX77CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX77BTPK+00(6),TLATAGY    CONACATENATE FOR PK                    
         MVC   TX77BTPK+06(2),TLATATT                                           
*                                                                               
         MVC   TX77BTAG,TLATAGY                                                 
         MVC   TX77BTCD,TLATATT                                                 
*                                                                               
         LA    R5,TLATELEM                                                      
         J     TOX77R4                                                          
*                                                                               
TOX77R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX77R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         USING TANAD,R5                                                         
         CLI   0(R5),TANAELQ                                                    
         JE    TOX77R10                                                         
         CLI   0(R5),TAADELQ                                                    
         JE    TOX77R20                                                         
         CLI   0(R5),TAFNELQ                                                    
         JE    TOX77R30                                                         
         CLI   0(R5),TACMELQ                                                    
         JE    TOX77R40                                                         
         J     TOX77R2                                                          
*                                                                               
         USING TANAD,R5                                                         
TOX77R10 LLC   RE,1(R5)                                                         
         AHI   RE,-(TANALNQ+1)                                                  
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TX77BTNM(0),TANANAME                                             
         J     TOX77R2                                                          
         DROP  R5                                                               
*                                                                               
         USING TAADEL,R5                                                        
TOX77R20 LLC   R0,2(R5)            GET NUMBER OF LINES                          
         LA    R1,TX77BTA1         POINT TO FIRST ADDRESS LINE                  
         LA    RF,TAADADD          MAX 4 ADDRESS LINES                          
*                                                                               
TOX77R22 MVC   0(30,R1),0(RF)                                                   
         LA    R1,TX77BTA2-TX77BTA1(R1)                                         
         LA    RF,30(RF)                                                        
         JCT   R0,TOX77R22                                                      
         DROP  R5                                                               
*                                                                               
         USING TAFND,R5                                                         
TOX77R30 CLI   TAFNTYPE,TAFNTATT   TEST ATTN NAME                               
         JNE   TOX77R2                                                          
         LLC   RE,1(R5)                                                         
         AHI   RE,-(TAFNLNQ+1)                                                  
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX77BTAT(0),TAFNNAME *EXECUTED*                                  
         J     TOX77R2                                                          
*                                                                               
         USING TACMD,R5                                                         
TOX77R40 CLI   TACMTYPE,TACMTYPI   TEST EMAIL ADDRESS                           
         JNE   TOX77R2                                                          
         LLC   RE,1(R5)                                                         
         AHI   RE,-2                                                            
* MAKE SURE LEN NOT MORE THAN MAX                                               
         CHI   RE,L'TX77BTML                                                    
         JNH   *+8                                                              
         LHI   RE,L'TX77BTML                                                    
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   TX77BTML(0),TACMCOMM *EXECUTED*                                  
         J     TOX77R2                                                          
*                                                                               
TOX77RX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOX79  - EXTRACT PUBLISED MUSIC (5079)                                        
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PUBLISHE MUSIC RECORD)                                        *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX79C   NMOD1 WORKX-WORKD,*TOX79*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX79LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLMUD,R3            R3=A(MUSIC RECORD)                           
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX79BLD            BUILD RECS                                   
         JH    TOX79NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX79CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX79LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX79NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX79LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX79LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX79BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX79R           BUILD CMML GROUP REC                         
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX79R  -  - EXTRACT PUBLISHED MUSIC RECORD 5079                              
***********************************************************************         
                                                                                
TOX79R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK79CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX79LEN)                                          
         MVC   TOXRETYP,TOX5079Q                                                
*                                                                               
         MVI   TX79PMCD-1,MXTRTQ                                                
         MVI   TX79PMAG-1,MXTRTQ                                                
         MVI   TX79PMPR-1,MXTRTQ                                                
         MVI   TX79PMOR-1,MXTRTQ                                                
         MVI   TX79ORCD-1,MXTRTQ                                                
         MVI   TX79CNM1-1,MXTRTQ                                                
         MVI   TX79CNM2-1,MXTRTQ                                                
         MVI   TX79PUB1-1,MXTRTQ                                                
         MVI   TX79LCR1-1,MXTRTQ                                                
         MVI   TX79PUB2-1,MXTRTQ                                                
         MVI   TX79LCR2-1,MXTRTQ                                                
         MVI   TX79PUB3-1,MXTRTQ                                                
         MVI   TX79LCR3-1,MXTRTQ                                                
         MVI   TX79CMP1-1,MXTRTQ                                                
         MVI   TX79CLC1-1,MXTRTQ                                                
         MVI   TX79CMP2-1,MXTRTQ                                                
         MVI   TX79CLC2-1,MXTRTQ                                                
         MVI   TX79CMP3-1,MXTRTQ                                                
         MVI   TX79CLC3-1,MXTRTQ                                                
         MVI   TX79CMP4-1,MXTRTQ                                                
         MVI   TX79CLC4-1,MXTRTQ                                                
         MVI   TX79AUT1-1,MXTRTQ                                                
         MVI   TX79ALC1-1,MXTRTQ                                                
         MVI   TX79AUT2-1,MXTRTQ                                                
         MVI   TX79ALC2-1,MXTRTQ                                                
         MVI   TX79CLNM-1,MXTRTQ                                                
         MVI   TX79PRNM-1,MXTRTQ                                                
         MVI   TX79COM1-1,MXTRTQ                                                
         MVI   TX79COM2-1,MXTRTQ                                                
         MVI   TX79X,MXTRTQ                                                     
         MVI   TX79X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX79LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX79CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX79PMCD,TLMUMUS                                                 
         LA    R5,TLMUELEM                                                      
         J     TOX79R4                                                          
*                                                                               
TOX79R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX79R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         USING TANAD,R5                                                         
         CLI   0(R5),TAPMELQ                                                    
         JE    TOX79R10                                                         
         CLI   0(R5),TANAELQ                                                    
         JE    TOX79R20                                                         
         CLI   0(R5),TAMUELQ                                                    
         JE    TOX79R30                                                         
         CLI   0(R5),TAFNELQ                                                    
         JE    TOX79R40                                                         
         CLI   0(R5),TACMELQ                                                    
         JE    TOX79R50                                                         
         J     TOX79R2                                                          
*                                                                               
         USING TAPMD,R5                                                         
TOX79R10 MVC   TX79PMAG,TAPMCAGY   CURRENT AGY                                  
         MVC   TX79PMPR,TAPMPAGY   PREVIOUS AGY                                 
         MVC   TX79PMOR,TAPMOAGY   ORIGINAL AGENCY                              
         MVC   TX79ORCD,TAPMOMUS   ORIGINAL MUSIC CODE                          
         J     TOX79R2                                                          
         DROP  R5                                                               
*                                                                               
         USING TANAD,R5                                                         
TOX79R20 MVC   TX79CNM1,SPACES                                                  
         MVC   TX79CNM2,SPACES                                                  
*                                                                               
         LLC   RE,TANALEN          ELEMENT LENGTH                               
         AHI   RE,-TANALNQ         GIVES LENGTH OF NAME                         
         LA    R1,TANANAME         FROM ADDR                                    
         LA    RF,TX79CNM1         FIRST TO ADDR                                
*                                                                               
         CHI   RE,L'TX79CNM1                                                    
         JNH   TOX79R22                                                         
         MVC   TX79CNM1,TANANAME   COMPOSITION NAME 1                           
         AHI   RE,-L'TX79CNM1      GIVES REMAINING LEN                          
         AHI   R1,L'TX79CNM1       NEXT FROM ADDR                               
         LA    RF,TX79CNM2         NEXT TO ADDR                                 
*                                                                               
TOX79R22 BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,RF),0(R1)        COMPOSITION NAME 2                          
         J     TOX79R2                                                          
                                                                                
         USING TAMUD,R5                                                         
TOX79R30 CLI   TAMUTYPE,TAMUTCOM   TEST TYPE=COMPOSER                           
         JNE   TOX79R32                                                         
*                                                                               
         LLC   RF,TAMUTNUM         GET SEQNUM W/IN TYPE                         
         BCTR  RF,0                                                             
         MHI   RF,TX79CMP2-TX79CMP1 X LEN OF OUTPUT FIELDS                      
         LA    RF,TX79CMP1(RF)      POINT TO OUTPUT FIELD                       
*                                                                               
         LLC   RE,TAMULEN          GET ELEM LEN                                 
         AHI   RE,-(TAMULNQ+1)     O/H + 1                                      
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,RF),TAMUNAME                                                 
*                                                                               
         LA    RE,TX79CLC1-TX79CMP1(RF)   POINT TO  LICENSER FLD                
         MVC   0(1,RE),TAMULIC            MOVE LICENSER NUMBER                  
         J     TOX79R2                                                          
                                                                                
TOX79R32 CLI   TAMUTYPE,TAMUTAUT   TEST TYPE=AUTHOR                             
         JNE   TOX79R34                                                         
*                                                                               
         LLC   RE,TAMUTNUM                                                      
         BCTR  RE,0                                                             
         MHI   RE,TX79AUT2-TX79AUT1  X LEN OF OUTPUT FIELDS                     
         LA    RF,TX79AUT1(RE)       POINT TO OUTPUT FIELD                      
*                                                                               
         LLC   RE,TAMULEN          GET ELEM LEN                                 
         AHI   RE,-(TAMULNQ+1)     O/H + 1                                      
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,RF),TAMUNAME                                                 
*                                                                               
         LA    RE,TX79ALC1-TX79AUT1(RF)   POINT TO  LICENSER FLD                
         MVC   0(1,RE),TAMULIC            MOVE LICENSER NUMBER                  
         J     TOX79R2                                                          
                                                                                
TOX79R34 CLI   TAMUTYPE,TAMUTPUB   TEST TYPE=PUBLISHER                          
         JNE   TOX79R2                                                          
*                                                                               
         LLC   RE,TAMUTNUM                                                      
         BCTR  RE,0                                                             
         MHI   RE,TX79PUB2-TX79PUB1  X LEN OF OUTPUT FIELDS                     
         LA    RF,TX79PUB1(RE)       POINT TO OUTPUT FIELD                      
*                                                                               
         LLC   RE,TAMULEN          GET ELEM LEN                                 
         AHI   RE,-(TAMULNQ+1)     O/H + 1                                      
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,RF),TAMUNAME                                                 
*                                                                               
         LA    RE,TX79LCR1-TX79PUB1(RF)   POINT TO  LICENSER FLD                
         MVC   0(1,RE),TAMULIC            MOVE LICENSER NUMBER                  
         J     TOX79R2                                                          
*                                                                               
         USING TAFND,R5                                                         
TOX79R40 CLI   TAFNTYPE,TAFNTCLI   TEST CLIENT NAME                             
         JNE   TOX79R42                                                         
*                                                                               
         LLC   RE,1(R5)                                                         
         AHI   RE,-4                                                            
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TX79CLNM(0),TAFNNAME                                             
         J     TOX79R2                                                          
*                                                                               
TOX79R42 CLI   TAFNTYPE,TAFNTPRD   TEST PRODUCT NAME                            
         JNE   TOX79R2                                                          
*                                                                               
         LLC   RE,1(R5)                                                         
         AHI   RE,-4                                                            
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TX79PRNM(0),TAFNNAME                                             
         J     TOX79R2                                                          
*                                                                               
         USING TACMD,R5                                                         
TOX79R50 CLI   TACMTYPE,TACMTYPG   TEST GENERAL COMMENT                         
         JNE   TOX79R2             NO                                           
*                                                                               
         MVC   TX79COM1,SPACES                                                  
         MVC   TX79COM2,SPACES                                                  
*                                                                               
         LLC   RE,TACMLEN          ELEMENT LENGTH                               
         AHI   RE,-TACMLNQ         GIVES LENGTH OF COMMENT                      
         LA    R1,TACMCOMM         MOVE FROM ADDR                               
         LA    RF,TX79COM1         MOVE TO ADDR                                 
*                                                                               
         CHI   RE,L'TX79COM1                                                    
         JNH   TOX79R52                                                         
         MVC   TX79COM1,0(R1)      MOVE COMMENT 1                               
         AHI   RE,-L'TX79COM1      GIVES REMAINING LEN                          
         AHI   R1,L'TX79COM1       NEXT MOVE FROM ADDR                          
         LA    RF,TX79COM2         NEXT MOVE IS TO COMMENT 2                    
*                                                                               
TOX79R52 BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         J     *+10                                                             
         MVC   0(0,RF),0(R1)        MOVE REMAINING COMMENT                      
         J     TOX79R2                                                          
*                                                                               
TOX79RX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOX81  - EXTRACT EPISODE (5081)                                               
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(EPISODE RECORD)                                               *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX81C   NMOD1 WORKX-WORKD,*TOX81*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX81LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLEPD,R3            R3=A(EPISODE RECORD)                         
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX81BLD            BUILD RECS                                   
         JH    TOX81NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX81CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX81LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX81NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX81LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX81LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX81BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX81R           BUILD EPISODE RECORD                         
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX81R  -  - EXTRACT EPISODE RECORD 5081                                      
***********************************************************************         
                                                                                
TOX81R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK81CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX81LEN)                                          
         MVC   TOXRETYP,TOX5081Q                                                
*                                                                               
         MVI   TX81PK-1,MXTRTQ                                                  
         MVI   TX81AGY-1,MXTRTQ                                                 
         MVI   TX81EPI-1,MXTRTQ                                                 
         MVI   TX81WRK-1,MXTRTQ                                                 
         MVI   TX81AIR-1,MXTRTQ                                                 
         MVI   TX81X,MXTRTQ                                                     
         MVI   TX81X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX81LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX81CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX81AGY,TLEPAGY                                                  
         MVC   TX81EPI,TLEPEPI                                                  
         XC    TX81EPI,=5X'FF'                                                  
                                                                                
         MVC   TX81PK(L'TX81AGY),TX81AGY                                        
         LA    RE,TX81PK                                                        
         LA    RF,L'TX81AGY                                                     
TOX81R1  CLI   0(RE),C' '                                                       
         JE    *+12                                                             
         LA    RE,1(RE)                                                         
         JCT   RF,TOX81R1                                                       
         MVC   0(L'TX81EPI,RE),TX81EPI                                          
                                                                                
         LA    R5,TLEPELEM                                                      
         J     TOX81R4                                                          
*                                                                               
TOX81R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX81R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         CLI   0(R5),TAEIELQ                                                    
         JE    TOX81R10                                                         
         J     TOX81R2                                                          
*                                                                               
         USING TAEID,R5                                                         
TOX81R10 GOTO1 DATCON,DMCB,(1,TAEIWDT),(10,TX81WRK)                             
         GOTO1 DATCON,DMCB,(1,TAEIADT),(10,TX81AIR)                             
         J     TOX81R2                                                          
         DROP  R5                                                               
*                                                                               
TOX81RX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOX83  - EXTRACT ECAST (5083)                                                 
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(EPISODE RECORD)                                               *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX83C   NMOD1 WORKX-WORKD,*TOX83*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX83LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLECD,R3            R3=A(EPISODE RECORD)                         
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX83BLD            BUILD RECS                                   
         JH    TOX83NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX83CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX83LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX83NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX83LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX83LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX83BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX83R           BUILD ECAST RECORD                           
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX83R  -  - EXTRACT EPISODE RECORD 5083                                      
***********************************************************************         
                                                                                
TOX83R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK83CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX83LEN)                                          
         MVC   TOXRETYP,TOX5083Q                                                
*                                                                               
         MVI   TX83PK-1,MXTRTQ                                                  
         MVI   TX83APK-1,MXTRTQ                                                 
         MVI   TX83EPI-1,MXTRTQ                                                 
         MVI   TX83PID-1,MXTRTQ                                                 
         MVI   TX83CAT-1,MXTRTQ                                                 
         MVI   TX83INV-1,MXTRTQ                                                 
         MVI   TX83CAM-1,MXTRTQ                                                 
         MVI   TX83UNT-1,MXTRTQ                                                 
         MVI   TX83UNI-1,MXTRTQ                                                 
         MVI   TX83LOC-1,MXTRTQ                                                 
         MVI   TX83YEAR-1,MXTRTQ                                                
         MVI   TX83CPK-1,MXTRTQ                                                 
         MVI   TX83AGT-1,MXTRTQ                                                 
         MVI   TX83ROL-1,MXTRTQ                                                 
         MVI   TX83WPCT-1,MXTRTQ                                                
         MVI   TX83PRAT-1,MXTRTQ                                                
         MVI   TX83CAMT-1,MXTRTQ                                                
         MVI   TX83CBAL-1,MXTRTQ                                                
         MVI   TX83CMT-1,MXTRTQ                                                 
         MVI   TX83X,MXTRTQ                                                     
         MVI   TX83X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX83LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX83CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLECCOM,TX83PKA,L'TLECCOM,0                         
         MVC   TX83PKE,TLECEPI                                                  
         XC    TX83PKE,=5X'FF'                                                  
         GOTOR SSN2PID,DMCB,TLECSSN,DUB                                         
         MVC   TX83PKP,DUB                                                      
         MVC   TX83PKC,TLECCAT                                                  
         OC    TLECINV,TLECINV                                                  
         JZ    TOX83R1                                                          
         GOTO1 TINVCON,DMCB,TLECINV,TX83PKI,DATCON                              
                                                                                
TOX83R1  MVC   TX83APK,TX83PKA     ASSET PRIMARY KEY                            
         MVC   TX83EPI,TX83PKE     EPISODE ID                                   
         MVC   TX83PID,TX83PKP     PID                                          
         MVC   TX83CAT,TX83PKC     CATEGORY                                     
         MVC   TX83INV,TX83PKI     INVOICE                                      
                                                                                
         LA    R5,TLECELEM                                                      
         J     TOX83R4                                                          
*                                                                               
TOX83R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX83R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         CLI   0(R5),TACAELQ                                                    
         JE    TOX83R10                                                         
         CLI   0(R5),TACRELQ                                                    
         JE    TOX83R20                                                         
         CLI   0(R5),TACMELQ                                                    
         JE    TOX83R30                                                         
         CLI   0(R5),TASOELQ                                                    
         JE    TOX83R40                                                         
         J     TOX83R2                                                          
                                                                                
         USING TACAD,R5                                                         
TOX83R10 MVC   TX83CAM,TACAONOF    CAMERA                                       
         MVC   TX83UNT,TACAUNIT    TAX UNIT                                     
         MVC   TX83UNI,TACAUN      UNION                                        
         MVC   TX83LOC,TACALOCL    LOCAL                                        
         MVC   TX83YEAR,TACAYEAR   CONTRACT YEAR                                
         OC    TACACORP,TACACORP   CORPORATION                                  
         JZ    TOX83R11                                                         
         MVC   TX83CPK(L'TX83PID),TX83PID                                       
         MVC   TX83CPK+L'TX83PID(L'TACACORP),TACACORP                           
TOX83R11 OC    TACANCDE,TACANCDE   AGENT                                        
         JZ    TOX83R12                                                         
         GOTOR TAGT,DMCB,(X'40',TACANCDE),TX83AGT                               
TOX83R12 OC    TACAWPCT,TACAWPCT                                                
         JZ    TOX83R2                                                          
         EDIT  TACAWPCT,(6,TX83WPCT),3,ALIGN=RIGHT                              
         J     TOX83R2                                                          
         DROP  R5                                                               
                                                                                
         USING TACRD,R5                                                         
TOX83R20 OC    TACRSCAL,TACRSCAL    PERFORMANCE RATE                            
         JZ    TOX83R21                                                         
         EDIT  TACRSCAL,TX83PRAT,2,ALIGN=LEFT                                   
TOX83R21 OC    TACRAPPL,TACRAPPL    CREDIT AMOUNT                               
         JZ    TOX83R22                                                         
         EDIT  TACRAPPL,TX83CAMT,2,ALIGN=LEFT                                   
TOX83R22 OC    TACRBAL,TACRBAL      CREDIT BALANCE                              
         JZ    TOX83R2                                                          
         EDIT  TACRBAL,TX83CBAL,2,ALIGN=LEFT                                    
         J     TOX83R2                                                          
         DROP  R5                                                               
                                                                                
         USING TACMD,R5                                                         
TOX83R30 CLI   TACMTYPE,TACMTYPG    COMMENT                                     
         BNE   TOX83R2                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX83CMT(0),TACMCOMM                                              
         J     TOX83R2                                                          
         DROP  R5                                                               
                                                                                
         USING TASOD,R5                                                         
         USING WROLTABD,RE                                                      
TOX83R40 CLI   TASOSTAT,0                                                       
         JE    TOX83R2                                                          
         LA    RE,WROLTAB                                                       
TOX83R41 CLC   WROLEQU,TASOSTAT                                                 
         JE    TOX83R42                                                         
         LA    RE,WROLTABL(RE)                                                  
         CLI   0(R3),X'FF'                                                      
         JNE   TOX83R41                                                         
         J     TOX83R2                                                          
TOX83R42 MVC   TX83ROL,WROLCHAR    WRITER ROLE                                  
         J     TOX83R2                                                          
         DROP  R5,RE                                                            
                                                                                
TOX83RX  J     EXIT                                                             
         EJECT                                                                  
**********************************************************************          
* CONSTANTS AND LITERALS                                             *          
**********************************************************************          
                                                                                
WROLTAB  DS    0CL3                                                             
         DC    AL1(TASOSH+TASOSS+TASOSB),CL2'A '                                
         DC    AL1(TASOSH+TASOSS),CL2'HS'                                       
         DC    AL1(TASOSH+TASOSB),CL2'HB'                                       
         DC    AL1(TASOSS+TASOSB),CL2'SB'                                       
         DC    AL1(TASOSH),CL2'H '                                              
         DC    AL1(TASOSS),CL2'S '                                              
         DC    AL1(TASOSB),CL2'B '                                              
         DC    X'FF'                                                            
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOX84  - EXTRACT FIXED CYCLE TRACKING (5084)                                  
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(FIXED CYCLE TRACKING RECORD)                                  *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX84C   NMOD1 WORKX-WORKD,*TOX84*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX84LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLFTD,R3            R3=A(FIXED CYCLE TRACKING RECORD)            
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX84BLD            BUILD RECS                                   
         JH    TOX84NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX84CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX84LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX84NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX84LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX84LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX84BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX84R           BUILD FIXED CYCLE TRACKING RECORD            
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX84R  -  FIXED CYCLE TRACKING RECORD 5084                                   
***********************************************************************         
                                                                                
TOX84R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK84CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX84LEN)                                          
         MVC   TOXRETYP,TOX5084Q                                                
*                                                                               
         MVI   TX84PEFK-1,MXTRTQ                                                
         MVI   TX84INVN-1,MXTRTQ                                                
         MVI   TX84CYCS-1,MXTRTQ                                                
         MVI   TX84CYCE-1,MXTRTQ                                                
         MVI   TX84CAT-1,MXTRTQ                                                 
         MVI   TX84CAM-1,MXTRTQ                                                 
         MVI   TX84OVP1-1,MXTRTQ                                                
         MVI   TX84OVP2-1,MXTRTQ                                                
         MVI   TX84APPL-1,MXTRTQ                                                
         MVI   TX84PNHA-1,MXTRTQ                                                
         MVI   TX84BALN-1,MXTRTQ                                                
         MVI   TX84USET-1,MXTRTQ                                                
         MVI   TX84X,MXTRTQ                                                     
         MVI   TX84X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX84LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX84CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLFTCOM,DUB,L'TLFTCOM,0                             
         GOTO1 VHEXOUT,DMCB,TLFTCAST,FULL,L'TLFTCAST,0                          
         MVC   TX84PEFK(L'DUB),DUB                                              
         MVC   TX84PEFK+L'DUB(L'FULL),FULL PRIMARY KEY=TLFTCOM+TLFTCAST         
*                                                                               
         LA    R5,TLFTELEM                                                      
         J     TOX84R4                                                          
*                                                                               
TOX84R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX84R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         CLI   0(R5),TAGTELQ                                                    
         JE    TOX84R10                                                         
         J     TOX84R2                                                          
                                                                                
         USING TAGTD,R5                                                         
TOX84R10 OC    TAGTINV,TAGTINV                                                  
         BZ    TOX84R20                                                         
         GOTO1 TINVCON,DMCB,TAGTINV,TX84INVN,DATCON    INVOICE                  
*                                                                               
TOX84R20 CLC   TAGTSTRT,=X'000000'                                              
         BE    TOX84R30                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGTSTRT),(10,TX84CYCS)  CYCLE START          
TOX84R30 CLC   TAGTEND,=X'000000'                                               
         BE    TOX84R40                                                         
         GOTO1 DATCON,DMCB,(X'01',TAGTEND),(10,TX84CYCE)   CYCLE END            
*                                                                               
TOX84R40 MVC   TX84CAT,TAGTCAT     CATEGORY                                     
         MVC   TX84CAM,TAGTCAM     CAMERA                                       
         EDIT  TAGTOV,TX84OVP1,2,ALIGN=RIGHT  OVERSCALE PERCENTAGE 1            
         EDIT  TAGTOV2,TX84OVP2,2,ALIGN=RIGHT OVERSCALE PERCENTAGE 2            
*                                                                               
         EDIT  TAGTCRD,TX84APPL,2,FLOAT=-,ALIGN=RIGHT      APPLIED              
         OC    TAGTPAY,TAGTPAY                                                  
         BZ    TOX84R50                                                         
         OC    TAGTCRD,TAGTCRD                                                  
         BNZ   TOX84R50                                                         
         EDIT  TAGTPAY,TX84APPL,2,FLOAT=-,ALIGN=RIGHT      APPLIED              
*                                                                               
TOX84R50 EDIT  TAGTPNH,TX84PNHA,2,FLOAT=-,ALIGN=RIGHT      P&H                  
         EDIT  TAGTBAL,TX84BALN,2,FLOAT=-,ALIGN=RIGHT      BALANCE              
*                                                                               
         MVC   TX84USET,TAGTUSE                                                 
         J     TOX84R2                                                          
         DROP  R5                                                               
                                                                                
         EJECT                                                                  
***********************************************************************         
* TOX85  - EXTRACT USAGE HISTORY (5085)                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(USAGE HISTORY RECORD)                                         *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX85C   NMOD1 WORKX-WORKD,*TOX85*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX85LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLUHD,R3            R3=A(USAGE HISTORY RECORD)                   
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX85BLD            BUILD RECS                                   
         JH    TOX85NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX85CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX85LT  DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX85NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX85LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX85LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX85BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX85R           BUILD USAGE HISTORY RECORD                   
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX85R  -  USAGE HISTORY RECORD 5085                                          
***********************************************************************         
                                                                                
TOX85R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK85CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX85LEN)                                          
         MVC   TOXRETYP,TOX5085Q                                                
*                                                                               
         MVI   TX85PEFK-1,MXTRTQ                                                
         MVI   TX85USEC-1,MXTRTQ                                                
         MVI   TX85INVN-1,MXTRTQ                                                
         MVI   TX85APK-1,MXTRTQ                                                 
         MVI   TX85CYCS-1,MXTRTQ                                                
         MVI   TX85CYCE-1,MXTRTQ                                                
         MVI   TX85SUBC-1,MXTRTQ                                                
         MVI   TX85NCBL-1,MXTRTQ                                                
         MVI   TX85SUBS-1,MXTRTQ                                                
         MVI   TX85ISUB-1,MXTRTQ                                                
         MVI   TX85X,MXTRTQ                                                     
         MVI   TX85X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX85LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX85CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLUHCOM,DUB,L'TLUHCOM,0    INT COMM ID              
         GOTO1 VHEXOUT,DMCB,TLUHCSEQ,FULL,L'TLUHCSEQ,0 CAST SEQ                 
         MVC   TX85PEFK(L'DUB),DUB                                              
         MVC   TX85PEFK+L'DUB(L'FULL),FULL PRIMARY KEY=TLUHCOM+TLUHCSEQ         
*                                                                               
         MVC   SVUSE,TLUHUSE                                                    
         MVC   TX85USEC,TLUHUSE      USE                                        
*                                                                               
         MVC   DUB(6),TLUHINV                                                   
         XC    DUB(6),=6X'FF'                                                   
         GOTO1 TINVCON,DMCB,DUB,TX85INVN,DATCON         INVOICE NUMBER          
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLUHCOM,TX85APK,L'TLUHCOM,0   ASSET PR KEY          
*                                                                               
         LA    R5,TLUHELEM                                                      
         J     TOX85R4                                                          
*                                                                               
TOX85R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX85R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         CLI   0(R5),TAUHELQ                                                    
         JE    TOX85R10                                                         
         J     TOX85R2                                                          
                                                                                
         USING TAUHD,R5                                                         
TOX85R10 GOTO1 DATCON,DMCB,(X'01',TAUHSTRT),(10,TX85CYCS)  CYCLE START          
         GOTO1 DATCON,DMCB,(X'01',TAUHEND),(10,TX85CYCE)   CYCLE END            
*                                                                               
         CLC   SVUSE,=C'CBL'                                                    
         BE    TOX85R20                                                         
         CLC   SVUSE,=C'SCB'                                                    
         BNE   TOX85R30                                                         
TOX85R20 EDIT  TAUHCSUB,TX85SUBC,ZERO=NOBLANK,ALIGN=RIGHT  SUB COUNT            
         B     TOX85R2                                                          
*                                                                               
TOX85R30 CLC   SVUSE,=C'LCB'                                                    
         BNE   TOX85R2                                                          
         EDIT  TAUHCSYS,TX85NCBL,ZERO=NOBLANK,ALIGN=RIGHT  CBL SYS              
         EDIT  TAUHSUBS,TX85SUBS,ZERO=NOBLANK,ALIGN=RIGHT  SUBSCRIBERS          
         EDIT  TAUHISUB,TX85ISUB,ALIGN=RIGHT               INIT SUBS            
         J     TOX85R2                                                          
         DROP  R5                                                               
                                                                                
         EJECT                                                                  
***********************************************************************         
* TOX86  - EXTRACT HISTORY COMMENT (5086)                             *         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(HISTORY COMMENT RECORD)                                       *         
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOX86C   NMOD1 WORKX-WORKD,*TOX86*,RR=RA                                        
         USING WORKD,RC                                                         
         L     RA,TOX86LT                                                       
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLHCD,R3            R3=A(HISTORY COMMENT RECORD)                 
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOX86BLD            BUILD RECS                                   
         JH    TOX86NXT            OUTPUT NEXT RECORD                           
*                                                                               
TOX86CC  DC    A(BUFFER1)          CONTROL SAVE AREA                            
TOX86LT  DC    A(LITERAL)                                                       
         EJECT                                                                  
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOX86NXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LHI   RF,TX86LEN                                                       
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         L     RE,ANEXT            UPDATE POINTER                               
         AHI   RE,TX86LEN                                                       
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOX86BLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOX86R           BUILD USAGE HISTORY RECORD                   
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOX86R  -  HISTORY COMMENT RECORD 5086                                        
***********************************************************************         
                                                                                
TOX86R   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK86CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX86LEN)                                          
         MVC   TOXRETYP,TOX5086Q                                                
*                                                                               
         MVI   TX86APK-1,MXTRTQ                                                 
         MVI   TX86INVN-1,MXTRTQ                                                
         MVI   TX86SEQ-1,MXTRTQ                                                 
         MVI   TX86CMNT-1,MXTRTQ                                                
         MVI   TX86X,MXTRTQ                                                     
         MVI   TX86X+1,MXTRTQ                                                   
*                                                                               
         LHI   RF,TX86LEN                                                       
         STH   RF,RECLEN                                                        
         L     R2,TOX86CC          WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         GOTO1 VHEXOUT,DMCB,TLHCCOM,DUB,L'TLHCCOM,0    INT COMM ID              
         MVC   TX86APK(L'DUB),DUB                                               
                                                                                
         MVC   DUB(6),TLHCINV                                                   
         CLC   DUB(6),=6X'FF'      NOT VALID INVOICE NUMBERS                    
         BE    TOX86R1             SKIP                                         
         CLC   DUB(6),=6X'00'                                                   
         BE    TOX86R1                                                          
*                                                                               
         XC    DUB(6),=6X'FF'                                                   
         GOTO1 TINVCON,DMCB,DUB,TX86INVN,DATCON         INVOICE NUMBER          
                                                                                
TOX86R1  ZIC   R1,TLHCSEQ                                                       
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX86SEQ,DUB                                                      
*                                                                               
         LA    R5,TLHCELEM                                                      
         J     TOX86R4                                                          
*                                                                               
TOX86R2  LLC   R0,1(R5)                                                         
         AR    R5,R0                                                            
*                                                                               
TOX86R4  CLI   0(R5),0                                                          
         JE    EXIT                                                             
*                                                                               
         CLI   0(R5),TACMELQ                                                    
         JE    TOX86R10                                                         
         J     TOX86R2                                                          
                                                                                
         USING TACMD,R5                                                         
TOX86R10 CLI   TACMTYPE,TACMTYPH                                                
         BNE   TOX86R2                                                          
         ZIC   R1,TACMLEN                                                       
         SHI   R1,TACMLNQ                                                       
         SHI   R1,1                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX86CMNT(0),TACMCOMM                                             
         J     TOX86R2                                                          
         DROP  R5                                                               
                                                                                
         EJECT                                                                  
***********************************************************************         
* TOXPTYR - PRODUCT TYPE RECORDS - 5066                                         
*                                                                     *         
* AL4 A(EXTRACT RECORD)                                               *         
* AL4 A(PRODUCT TYPE RECORD)                                                    
* AL4 0=TALFILE-TO-EXTRACT                                            *         
* AL4 A(SXDTABD)                                                      *         
* AL4 A(PKCNTS) - RECORD ACCUMULATORS                                 *         
***********************************************************************         
                                                                                
TOXPTYC  NMOD1 WORKX-WORKD,*TOXPTY*,RR=RA                                       
         USING WORKD,RC                                                         
         L     RA,TOXPTYLT                                                      
         USING LITERAL,RA                                                       
         ST    R1,APARM                                                         
         MVC   PARM,0(R1)          EXTRACT PARAMETER LIST                       
         MVC   APKCNTS,16(R1)                                                   
         LM    R2,R3,0(R1)                                                      
         L     R4,12(R1)                                                        
         USING TOXRECD,R2          R2=A(EXTRACT RECORD)                         
         USING TLPTD,R3            R3=A(PRODUCT GROUP)                          
         USING SXDTABD,R4          R4=A(SXDXTAB)                                
*                                                                               
         CLI   8(R1),1                                                          
         JE    TOXPTBLD                                                         
         JH    TOXPTNXT                                                         
*                                                                               
TOXPTYCC DC    A(BUFFER1)          AGENCY SAVE AREA                             
TOXPTYLT DC    A(LITERAL)                                                       
       EJECT                                                                    
***********************************************************************         
* GET NEXT RECORD AND PASS IT BACK                                    *         
***********************************************************************         
                                                                                
TOXPTNXT L     RE,ANEXT                                                         
         OC    0(8,RE),0(RE)                                                    
         JNZ   *+12                                                             
         MVI   8(R1),X'FF'         NO MORE RECORDS                              
         J     EXIT                                                             
*                                                                               
         L     RE,ANEXT            MOVE IN NEXT RECORD                          
         LA    R0,TOXRECD                                                       
         LH    RF,=Y(TX66LEN)                                                   
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LH    RF,=Y(TX66LEN)      UPDATE POINTER                               
         L     RE,ANEXT                                                         
         AR    RE,RF                                                            
         ST    RE,ANEXT                                                         
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* BUILD SERIES OF RECORDS FOR THIS RECORD                             *         
***********************************************************************         
                                                                                
TOXPTBLD MVC   SVACT,TOXREACT      SAVE ACTION                                  
         MVC   SVDAT,TOXREDAT      SAVE DATE                                    
         MVC   SVTIM,TOXRETIM      SAVE TIME                                    
*                                                                               
         BAS   RE,TOXPTY           BUILD PRODUCT GROUP RECORD                   
*                                                                               
         J     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* TOXPTY - EXTRACT PRODUCT TYPE RECORD 5066                                     
***********************************************************************         
                                                                                
TOXPTY   NTR1                                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK66CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX66LEN)                                          
         MVC   TOXRETYP,TOXPTYQ                                                 
*                                                                               
         MVI   TX66PTPK-1,MXTRTQ                                                
         MVI   TX66AGY-1,MXTRTQ                                                 
         MVI   TX66PTC-1,MXTRTQ                                                 
         MVI   TX66DESC-1,MXTRTQ                                                
         MVI   TX66OD-1,MXTRTQ                                                  
         MVI   TX66X,MXTRTQ                                                     
         MVI   TX66X+1,MXTRTQ                                                   
*                                                                               
         LH    RF,=Y(TX66LEN)                                                   
         STH   RF,RECLEN                                                        
         L     R2,TOXPTYCC         WHERE RECORDS TO BE BUILT                    
         XC    0(8,R2),0(R2)                                                    
         ST    R2,ANEXT            FOR NEXT TIME IN                             
*                                                                               
         L     RE,TXREC            BLANK RECORD HERE                            
         LR    R0,R2                                                            
         LH    RF,RECLEN                                                        
         LR    R1,RF                                                            
         MVCL  R0,RE               COPY IN A BLANK RECORD                       
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           FOR NEXT ROUTINE                             
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         MVC   TX66PTPK,TLPTAGY    AGY + TYPE                                   
         MVC   TX66AGY,TLPTAGY     AGENCY                                       
         MVC   TX66PTC,TLPTPRT     TYPE                                         
*                                                                               
         LA    R5,TLPTELEM         R5=A(FIRST ELEMENT)                          
TOXPT10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXPTYXX                                                         
         CLI   0(R5),TANAELQ                                                    
         JE    TOXPT30                                                          
         CLI   0(R5),TAPTELQ                                                    
         JE    TOXPT40                                                          
*                                                                               
TOXPT20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXPT10                                                          
*                                                                               
         USING TANAD,R5                                                         
TOXPT30  SR    RF,RF               NAME                                         
         IC    RF,TANALEN                                                       
         SHI   RF,TANALNQ                                                       
         SHI   RF,1                                                             
         JM    TOXPT20                                                          
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   TX66DESC(0),TANANAME                                             
         J     TOXPT20                                                          
*                                                                               
         USING TAPTD,R5                                                         
TOXPT40  GOTO1 DATCON,DMCB,(X'01',TAPTODTE),(10,TX66OD)   DATE                  
         J     TOXPT20                                                          
         DROP  R5                                                               
*                                                                               
TOXPTYXX J     EXIT                                                             
         EJECT                                                                  
*                                                                               
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
TOXISEP  NTR1  BASE=*,LABEL=*                                                   
         MVI   TX10PINV-1,MXTRTQ                                                
         MVI   TX10AGY-1,MXTRTQ                                                 
         MVI   TX10INV-1,MXTRTQ                                                 
         MVI   TX10ASS-1,MXTRTQ                                                 
         MVI   TX10VERN-1,MXTRTQ                                                
         MVI   TX10VERI-1,MXTRTQ                                                
         MVI   TX10PAYD-1,MXTRTQ                                                
         MVI   TX10BILD-1,MXTRTQ                                                
         MVI   TX10USE-1,MXTRTQ                                                 
         MVI   TX10CSD-1,MXTRTQ                                                 
         MVI   TX10CED-1,MXTRTQ                                                 
         MVI   TX10CURR-1,MXTRTQ                                                
         MVI   TX10GA-1,MXTRTQ                                                  
         MVI   TX10AC-1,MXTRTQ                                                  
         MVI   TX10GC-1,MXTRTQ                                                  
         MVI   TX10IP-1,MXTRTQ                                                  
         MVI   TX10CP-1,MXTRTQ                                                  
         MVI   TX10RE-1,MXTRTQ                                                  
         MVI   TX10SPNH-1,MXTRTQ                                                
         MVI   TX10CNVR-1,MXTRTQ                                                
         MVI   TX10ACOM-1,MXTRTQ                                                
         MVI   TX10SF-1,MXTRTQ                                                  
         MVI   TX10PNH-1,MXTRTQ                                                 
         MVI   TX10HNW-1,MXTRTQ                                                 
         MVI   TX10INR-1,MXTRTQ                                                 
         MVI   TX10PT-1,MXTRTQ                                                  
         MVI   TX10HAND-1,MXTRTQ                                                
         MVI   TX10CH-1,MXTRTQ                                                  
         MVI   TX10MD-1,MXTRTQ                                                  
         MVI   TX10DUES-1,MXTRTQ                                                
         MVI   TX10FC-1,MXTRTQ                                                  
         MVI   TX10GST-1,MXTRTQ                                                 
         MVI   TX10PST-1,MXTRTQ                                                 
         MVI   TX10CSF-1,MXTRTQ                                                 
         MVI   TX10IT-1,MXTRTQ                                                  
         MVI   TX10STYP-1,MXTRTQ                                                
         MVI   TX10CLI-1,MXTRTQ                                                 
         MVI   TX10PDC-1,MXTRTQ                                                 
         MVI   TX10AUID-1,MXTRTQ                                                
         MVI   TX10ASC-1,MXTRTQ                                                 
         MVI   TX10AD-1,MXTRTQ                                                  
         MVI   TX10AT-1,MXTRTQ                                                  
         MVI   TX10PUID-1,MXTRTQ                                                
         MVI   TX10PSC-1,MXTRTQ                                                 
         MVI   TX10PAD-1,MXTRTQ                                                 
         MVI   TX10PAT-1,MXTRTQ                                                 
         MVI   TX10HLUD-1,MXTRTQ                                                
         MVI   TX10CAN-1,MXTRTQ                                                 
         MVI   TX10CBIN-1,MXTRTQ                                                
         MVI   TX10CANO-1,MXTRTQ                                                
         MVI   TX10CBUI-1,MXTRTQ                                                
         MVI   TX10CBSC-1,MXTRTQ                                                
         MVI   TX10LHCD-1,MXTRTQ                                                
         MVI   TX10LHCU-1,MXTRTQ                                                
         MVI   TX10LHCS-1,MXTRTQ                                                
         MVI   TX10AUTH-1,MXTRTQ                                                
         MVI   TX10OASC-1,MXTRTQ                                                
         MVI   TX10LICD-1,MXTRTQ                                                
         MVI   TX10LICU-1,MXTRTQ                                                
         MVI   TX10LICS-1,MXTRTQ                                                
         MVI   TX10DD-1,MXTRTQ                                                  
         MVI   TX10URG-1,MXTRTQ                                                 
         MVI   TX10APID-1,MXTRTQ                                                
         MVI   TX10APSC-1,MXTRTQ                                                
         MVI   TX10APDT-1,MXTRTQ                                                
         MVI   TX10APTM-1,MXTRTQ                                                
         MVI   TX10BHPP-1,MXTRTQ                                                
         MVI   TX10PRUI-1,MXTRTQ                                                
         MVI   TX10PRSC-1,MXTRTQ                                                
         MVI   TX10PRDT-1,MXTRTQ                                                
         MVI   TX10PRTM-1,MXTRTQ                                                
         MVI   TX10MAJS-1,MXTRTQ                                                
         MVI   TX10UNIT-1,MXTRTQ                                                
         MVI   TX10INTF-1,MXTRTQ                                                
         MVI   TX10SUN-1,MXTRTQ                                                 
         MVI   TX10NUSE-1,MXTRTQ                                                
         MVI   TX10RET-1,MXTRTQ                                                 
         MVI   TX10IMAJ-1,MXTRTQ                                                
         MVI   TX10IUNT-1,MXTRTQ                                                
         MVI   TX10TAGS-1,MXTRTQ                                                
         MVI   TX10DUM-1,MXTRTQ                                                 
         MVI   TX10HCMT-1,MXTRTQ                                                
         MVI   TX10ICMT-1,MXTRTQ                                                
         MVI   TX10LFT-1,MXTRTQ                                                 
         MVI   TX10CRED-1,MXTRTQ                                                
         MVI   TX10LID-1,MXTRTQ                                                 
         MVI   TX10LLN-1,MXTRTQ                                                 
         MVI   TX10CKDT-1,MXTRTQ                                                
         MVI   TX10INVC-1,MXTRTQ                                                
         MVI   TX10MEDC-1,MXTRTQ                                                
         MVI   TX10CMTY-1,MXTRTQ                                                
         MVI   TX10CMTT-1,MXTRTQ                                                
         MVI   TX10CMLN-1,MXTRTQ                                                
         MVI   TX10PRNM-1,MXTRTQ                                                
         MVI   TX10CTID-1,MXTRTQ                                                
         MVI   TX10ADST-1,MXTRTQ                                                
         MVI   TX10FFIX-1,MXTRTQ                                                
         MVI   TX10FAIR-1,MXTRTQ                                                
         MVI   TX10WCAN-1,MXTRTQ                                                
         MVI   TX10EMCD-1,MXTRTQ                                                
         MVI   TX10FMDT-1,MXTRTQ                                                
         MVI   TX10FMST-1,MXTRTQ                                                
         MVI   TX10FMCT-1,MXTRTQ                                                
         MVI   TX10RCDT-1,MXTRTQ                                                
         MVI   TX10RCST-1,MXTRTQ                                                
         MVI   TX10RCCT-1,MXTRTQ                                                
         MVI   TX10MSDT-1,MXTRTQ                                                
         MVI   TX10MSST-1,MXTRTQ                                                
         MVI   TX10MSCT-1,MXTRTQ                                                
         MVI   TX10DBDT-1,MXTRTQ                                                
         MVI   TX10AFM1-1,MXTRTQ                                                
         MVI   TX10AFM2-1,MXTRTQ                                                
         MVI   TX10TRKI-1,MXTRTQ                                                
         MVI   TX10TRKL-1,MXTRTQ                                                
         MVI   TX10ACSG-1,MXTRTQ                                                
         MVI   TX10RTIN-1,MXTRTQ                                                
         MVI   TX10SLUN-1,MXTRTQ                                                
         MVI   TX10ELUS-1,MXTRTQ                                                
         MVI   TX10ISEQ-1,MXTRTQ                                                
         MVI   TX10X,MXTRTQ                                                     
         MVI   TX10X+1,MXTRTQ                                                   
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* INVTAPD - EXTRACT INVOICE PAYMENT DETAILS                                     
***********************************************************************         
         USING TAPDD,R5                                                         
INVTAPD  NTR1  BASE=*,LABEL=*                                                   
         GOTO1 VHEXOUT,DMCB,TAPDCOM,TX10ASS,L'TAPDCOM,0   ASSET PR KEY          
         MVC   TX10USE,TAPDUSE     USE                                          
         MVC   TX10CLI,TAPDCLI     CLIENT                                       
         MVC   TX10PDC,TAPDPRD     PRODUCT                                      
         GOTO1 DATCON,DMCB,(X'01',TAPDCYCS),(10,TX10CSD)  CYCLE START           
         GOTO1 DATCON,DMCB,(X'01',TAPDCYCE),(10,TX10CED)  CYCLE END             
*                                                                               
         EDIT  TAPDGRS,TX10GA,2,FLOAT=-,ALIGN=RIGHT     GROSS AMOUNT            
         EDIT  TAPDAPPL,TX10AC,2,FLOAT=-,ALIGN=RIGHT    APPLIED CREDITS         
         EDIT  TAPDGUAR,TX10GC,2,FLOAT=-,ALIGN=RIGHT    GUAR CREDITS            
         EDIT  TAPDPAYI,TX10IP,2,FLOAT=-,ALIGN=RIGHT    INDIV PAYMENT           
         EDIT  TAPDPAYC,TX10CP,2,FLOAT=-,ALIGN=RIGHT    CORP PAYMENT            
         EDIT  TAPDREXP,TX10RE,2,FLOAT=-,ALIGN=RIGHT    REIMBURSED EXP          
         EDIT  TAPDSPNH,TX10SPNH,2,FLOAT=-,ALIGN=RIGHT  SUBJ P&H                
         EDIT  TAPDPNH,TX10PNH,2,FLOAT=-,ALIGN=RIGHT    P&H                     
         EDIT  TAPDHNW,TX10HNW,2,FLOAT=-,ALIGN=RIGHT    HEALTH&WELFARE          
         EDIT  TAPDINR,TX10INR,2,FLOAT=-,ALIGN=RIGHT    INS & RETIRE            
         EDIT  TAPDMDED,TX10MD,2,FLOAT=-,ALIGN=RIGHT    MISC DEDUCT             
         EDIT  TAPDDUES,TX10DUES,2,FLOAT=-,ALIGN=RIGHT  DUES                    
*                                                                               
         OC    TAPDSTUS,TAPDSTUS                                                
         JZ    ITAPD02                                                          
         EDIT  TAPDSTUS,TX10SUN,FLOAT=-,ALIGN=RIGHT   STARTING USE #            
*                                                                               
ITAPD02  OC    TAPDUSES,TAPDUSES                                                
         JZ    ITAPD04                                                          
         EDIT  TAPDUSES,TX10NUSE,FLOAT=-,ALIGN=RIGHT  NUMBER OF USES            
*                                                                               
ITAPD04  MVI   TX10INTF,C'Y'       INTERFACE                                    
         TM    TAPDOPT4,TAPDONOI                                                
         JZ    *+8                                                              
         MVI   TX10INTF,C'N'                                                    
*                                                                               
         MVC   TX10STYP,=C'000'                                                 
         CLI   TAPDTYPE,0                                                       
         JE    ITAPD06                                                          
         ZIC   R1,TAPDTYPE         USE TYPE                                     
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX10STYP,DUB                                                     
*                                                                               
ITAPD06  OC    TAPDMAJ,TAPDMAJ                                                  
         JZ    ITAPD10                                                          
*                                                                               
         USING MAJTABD,R1                                                       
         L     RF,=A(TGAMAJS)      A(MAJORS TABLE)                              
*                                                                               
         CLC   TAPDUSE,=C'FGR'     IF FGR USE (ASSUME NEW MAJORS TYPE)          
         BNE   *+8                                                              
         L     RF,=A(TGALOCS)      A(LOCATIONS TABLE)                           
         ICM   R1,15,0(RF)                                                      
*                                                                               
ITAPD08  CLI   0(R1),X'FF'                                                      
         JE    EXIT                                                             
         CLC   MAJEQU,TAPDMAJ                                                   
         BE    *+12                                                             
         LA    R1,MAJNEXT                                                       
         B     ITAPD08                                                          
*                                                                *              
         MVC   TX10MAJS,MAJCHAR    MAJORS CHARACTER CODE                        
*                                                                               
ITAPD10  EDIT  TAPDUNIT,TX10UNIT,ALIGN=LEFT,ZERO=BLANK           *              
*                                                                               
         MVC   TX10EMCD,TAPDEMP    EMPLOYER CODE                                
*                                                                               
         MVI   TX10WCAN,C'N'                                                    
         TM    TAPDOPT1,TAPDOCAN   WITHHOLD CANADIAN TAXES?                     
         JZ    *+8                                                              
         MVI   TX10WCAN,C'Y'                                                    
*                                                                               
         J     EXIT                                                             
         DROP  R1,R5                                                            
*                                                                               
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* INVTACS - EXTRACT INVOICE COMMERCIAL STUDIO DETAILS                           
***********************************************************************         
*                                                                               
         USING TACSD,R5                                                         
INVTACS  NTR1  BASE=*,LABEL=*                                                   
         CLI   TACSTYPE,TACSTYPM   MUSIC?                                       
         JE    ITACS10                                                          
         CLI   TACSTYPE,TACSTYPR   RECORD?                                      
         JE    ITACS20                                                          
         CLI   TACSTYPE,TACSTYPF   FILM?                                        
         JNE   XIT                                                              
*                                                                               
         MVC   TX10FMST,TACSSTUD   STUDIO                                       
         MVC   TX10FMCT,TACSCITY   CITY                                         
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX10FMDT) DATE                  
         J     XIT                                                              
*                                                                               
ITACS10  MVC   TX10MSST,TACSSTUD   STUDIO                                       
         MVC   TX10MSCT,TACSCITY   CITY                                         
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX10MSDT) DATE                  
         J     XIT                                                              
*                                                                               
ITACS20  MVC   TX10RCST,TACSSTUD   STUDIO                                       
         MVC   TX10RCCT,TACSCITY   CITY                                         
         GOTO1 DATCON,DMCB,(X'01',TACSDATE),(10,TX10RCDT) DATE                  
         J     XIT                                                              
         DROP  R5                                                               
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* INVTCCS - EXTRACT INVOICE COMMERCIAL CONTRACT DETAILS                         
***********************************************************************         
*                                                                               
         USING TACCD,R5                                                         
INVTCCS  NTR1  BASE=*,LABEL=*                                                   
         MVC   TX10AFM1,TACCCON    AFM CONTRACT ID                              
         XC    TX10AFM2,TX10AFM2                                                
         CLI   TACCNCON,1                                                       
         JE    XIT                                                              
         MVC   TX10AFM2,TACCCON+12                                              
         J     XIT                                                              
         DROP  R5                                                               
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
* INVTNDS - EXTRACT NETWORK/CLASS A DETAILS                                     
***********************************************************************         
         USING TANDD,R5                                                         
INVTNDS  NTR1  BASE=*,LABEL=*                                                   
         OC    TANDUSEL,TANDUSEL   IF PAID LIFT USES                            
         JZ    XIT                                                              
         LH    R1,TANDSTUL         LIFT START USE NUMBER                        
         EDIT  (R1),TX10SLUN,FILL=0                                             
         AH    R1,TANDUSEL                                                      
         BCTR  R1,0                LIFT END USE NUMBER                          
         EDIT  (R1),TX10ELUS,FILL=0                                             
         J     XIT                                                              
         DROP  R5                                                               
*                                                                               
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
         USING TLCKD,R3            R3=A(CHECK RECORD)                           
         USING TAPDD,R5                                                         
CHKTAPD  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
*TOXCK30  GOTO1 VHEXOUT,DMCB,TAPDCOM,TX57ASS,L'TAPDCOM,0   ASSET PR KEY         
*         MVC   SV57ASS,TX57ASS                                                 
*                                                                               
         MVC   TX57W4T,TAPDW4TY    W4 TYPE                                      
         MVC   TX57EMP,TAPDEMP     EMPLOYER                                     
*                                                                               
         TM    TAPDSTAT,TAPDSCAN   CANADIAN DOLLAR PAYMENT?                     
         JZ    *+8                                                              
         MVI   TX57CURR,C'C'                                                    
         TM    TAPDPST2,TAPDPEUR   EURO-BASED PAYMENT?                          
         JZ    *+8                                                              
         MVI   TX57CURR,C'E'                                                    
*                                                                               
         EDIT  TAPDGRS,TX57GRS,2,FLOAT=-,ALIGN=RIGHT     GROSS                  
         EDIT  TAPDMDED,TX57MDA,2,FLOAT=-,ALIGN=RIGHT    MISC. DED              
         EDIT  TAPDREXP,TX57REA,2,FLOAT=-,ALIGN=RIGHT    REIM. EXP              
         EDIT  TAPDDUES,TX57DA,2,FLOAT=-,ALIGN=RIGHT     DUES                   
         EDIT  TAPDAPPL,TX57ACRA,2,FLOAT=-,ALIGN=RIGHT   APP CREDITS            
         EDIT  TAPDGUAR,TX57AGA,2,FLOAT=-,ALIGN=RIGHT    APP GUARANTEE          
         EDIT  TAPDPNH,TX57PNH,2,FLOAT=-,ALIGN=RIGHT     PNH AMOUNT             
         EDIT  TAPDSPNH,TX57SPNH,2,FLOAT=-,ALIGN=RIGHT   SPNH AMOUNT            
*                                                                               
         OC    TAPDSTUS,TAPDSTUS                                                
         JZ    CTAPD02                                                          
         EDIT  TAPDSTUS,TX57SUN,FLOAT=-,ALIGN=RIGHT   STARTING USE #            
*                                                                               
CTAPD02  OC    TAPDUSES,TAPDUSES                                                
         JZ    CTAPD04                                                          
         EDIT  TAPDUSES,TX57NUSE,FLOAT=-,ALIGN=RIGHT  NUMBER OF USES            
*                                                                               
CTAPD04  TM    TAPDADJS,TAPDADVD   VOIDER?                                      
         JZ    *+8                                                              
         MVI   TX57VDER,C'Y'                                                    
         TM    TAPDADJS,TAPDADRI   REISSUE?                                     
         JZ    *+8                                                              
         MVI   TX57RISS,C'Y'                                                    
         TM    TAPDADJS,TAPDADIS   ISSUE?                                       
         JZ    *+8                                                              
         MVI   TX57ISS,C'Y'                                                     
         TM    TAPDADJS,TAPDADTR   TAX REFUND?                                  
         JZ    *+8                                                              
         MVI   TX57TREF,C'Y'                                                    
         TM    TAPDADJS,TAPDADTT   TAX TRANSFER?                                
         JZ    *+8                                                              
         MVI   TX57TT,C'Y'                                                      
         TM    TAPDADJS,TAPDADST   SSN TRANSFER?                                
         JZ    *+8                                                              
         MVI   TX57ST,C'Y'                                                      
                                                                                
         OC    TAPDOV1,TAPDOV1                                                  
         JZ    CTAPD10                                                          
         EDIT  TAPDOV1,TX57OVP1,2,ALIGN=LEFT OVERSCALE 1ST PERCENTAGE           
                                                                                
CTAPD10  CLI   TAPDACDE,0                                                       
         JE    *+10                                                             
         MVC   TX57APPC,TAPDACDE   APPLIED CODE                                 
                                                                                
         CLI   TAPDICDE,0                                                       
         JE    *+10                                                             
         MVC   TX57INCC,TAPDICDE   INCLUDE CODE                                 
                                                                                
         MVI   TX57MANO,C'N'                                                    
         TM    TAPDSTAT,TAPDSMAN   MANUAL OVERRIDE?                             
         JZ    *+8                                                              
         MVI   TX57MANO,C'Y'                                                    
*                                                                               
         BAS   RE,CHKMAJ              MAJORS                                    
*                                                                               
         EDIT  TAPDUNIT,TX57UNIT,ALIGN=LEFT,ZERO=BLANK                          
*                                                                               
         GOTO1 VHEXOUT,DMCB,TAPDCOM,TX57PERF,L'TAPDCOM,0  PERF PRI KEY          
         GOTO1 VHEXOUT,DMCB,TLCKSORT+4,TX57PERF+8,2,0                           
*                                                                               
         MVI   TX57PCGR,C'N'                                                    
         TM    TAPDSTA2,TAPDSPRI   IS PER CYCLE GRT PAYMENT?                    
         JZ    *+8                                                              
         MVI   TX57PCGR,C'Y'                                                    
*                                                                               
         EDIT  TAPDPAYI,TX57INDP,2,FLOAT=-,ALIGN=RIGHT  INDIV PAYMENT           
         EDIT  TAPDPAYC,TX57CRPP,2,FLOAT=-,ALIGN=RIGHT  CORP PAYMENT            
                                                                                
         MVC   TX57USSC,=C'000'                                                 
         CLI   TAPDTYPE,0                                                       
         JE    XIT                                                              
         ZIC   R1,TAPDTYPE         USE TYPE                                     
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  TX57USSC,DUB                                                     
*                                                                               
         J     XIT                                                              
*                                                                               
CHKMAJ   NTR1                                                                   
         OC    TAPDMAJ,TAPDMAJ                                                  
         JZ    XIT                                                              
*                                                                               
         L     RF,=A(VT00A88)                                                   
         L     RE,0(RF)                                                         
         ICM   R0,15,TGAMAJS-TGTABLES(RE)                                       
         AR    RE,R0                                                            
         L     RF,=A(TGAMAJS)                                                   
         STCM  RE,15,0(RF)                                                      
*                                                                               
         USING MAJTABD,R1                                                       
         L     RF,=A(TGAMAJS)      A(MAJORS TABLE)                              
*                                                                               
         CLI   TAPDUSE,UFGR        IF FGR USE (ASSUME NEW MAJORS TYPE)          
         BNE   *+8                                                              
         L     RF,=A(TGALOCS)      A(LOCATIONS TABLE)                           
         ICM   R1,15,0(RF)                                                      
*                                                                               
CHKMAJ10 CLI   0(R1),X'FF'                                                      
         JE    EXIT                                                             
         CLC   MAJEQU,TAPDMAJ                                                   
         BE    *+12                                                             
         LA    R1,MAJNEXT                                                       
         B     CHKMAJ10                                                         
*                                                                               
         MVC   TX57MAJS,MAJCHAR    MAJORS CHARACTER CODE                        
         J     XIT                                                              
         DROP  R1,R3,R5                                                         
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* CHKTACD - EXTRACT TACD DETAILS                                     *          
**********************************************************************          
         USING TACDD,R5                                                         
CHKTACD  NTR1  BASE=*,LABEL=*                                                   
         MVC   TX57NUM,TACDCHK     CHECK NUMBER                                 
         MVC   TX57FREQ,TACDFREQ   FREQUENCY                                    
         MVC   TX57BA,TACDBNK      BANK ACCOUNT                                 
         EDIT  TACDNTAX,TX57NTA,2,FLOAT=-,ALIGN=RIGHT    NON-TAXABLE            
         EDIT  TACDNET,TX57NET,2,FLOAT=-,ALIGN=RIGHT     NET                    
*                                                                               
         OC    TACDDTE,TACDDTE                                                  
         JZ    CTACD10                                                          
         GOTO1 DATCON,DMCB,(X'01',TACDDTE),(10,TX57CHKD) CHECK DATE             
CTACD10  OC    TACDRUN,TACDRUN                                                  
         JZ    CTACD20                                                          
         GOTO1 DATCON,DMCB,(X'01',TACDRUN),(10,TX57RD)   RUN DATE               
CTACD20  OC    TACDCSH,TACDCSH                                                  
         JZ    CTACD30                                                          
         GOTO1 DATCON,DMCB,(X'01',TACDCSH),(10,TX57CSHD) CASHED DATE            
*                                                                               
CTACD30  TM    TACDSTAT,TACDSVOI   VOIDED?                                      
         JZ    *+8                                                              
         MVI   TX57VOID,C'Y'                                                    
         TM    TACDSTAT,TACDSSTA   STALE?                                       
         JZ    *+8                                                              
         MVI   TX57STAL,C'Y'                                                    
         TM    TACDSTA2,TACDSELN   EFT LIEN?                                    
         JZ    *+8                                                              
         MVI   TX57EFT,C'Y'                                                     
*                                                                               
         TM    TACDSTAT,TACDSLIN   GENERATED BY LIEN?                           
         JZ    *+8                                                              
         MVI   TX57LIEN,C'Y'                                                    
         TM    TACDSTAT,TACDSTRS   GENERATED BY TRUSTEE?                        
         JZ    *+8                                                              
         MVI   TX57TRST,C'Y'                                                    
         TM    TACDSTA2,TACDSMSC   MULTI SERVICE CONTRACT?                      
         JZ    *+8                                                              
         MVI   TX57MLTS,C'Y'                                                    
         J     XIT                                                              
         DROP  R5                                                               
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
TOXCSEP  NTR1  BASE=*,LABEL=*                                                   
         MVI   TX57CHK-1,MXTRTQ                                                 
         MVI   TX57NUM-1,MXTRTQ                                                 
         MVI   TX57PID-1,MXTRTQ                                                 
         MVI   TX57W4T-1,MXTRTQ                                                 
         MVI   TX57FREQ-1,MXTRTQ                                                
         MVI   TX57EMP-1,MXTRTQ                                                 
         MVI   TX57BA-1,MXTRTQ                                                  
         MVI   TX57CHKD-1,MXTRTQ                                                
         MVI   TX57RD-1,MXTRTQ                                                  
         MVI   TX57CSHD-1,MXTRTQ                                                
         MVI   TX57CURR-1,MXTRTQ                                                
         MVI   TX57CPID-1,MXTRTQ                                                
         MVI   TX57AGNT-1,MXTRTQ                                                
         MVI   TX57CMNT-1,MXTRTQ                                                
         MVI   TX57STOP-1,MXTRTQ                                                
         MVI   TX57PULL-1,MXTRTQ                                                
         MVI   TX57PINV-1,MXTRTQ                                                
         MVI   TX57GRS-1,MXTRTQ                                                 
         MVI   TX57NTA-1,MXTRTQ                                                 
         MVI   TX57MDA-1,MXTRTQ                                                 
         MVI   TX57REA-1,MXTRTQ                                                 
         MVI   TX57NET-1,MXTRTQ                                                 
         MVI   TX57WIRE-1,MXTRTQ                                                
         MVI   TX57DRCT-1,MXTRTQ                                                
         MVI   TX57ACA-1,MXTRTQ                                                 
         MVI   TX57DA-1,MXTRTQ                                                  
         MVI   TX57MNUM-1,MXTRTQ                                                
         MVI   TX57PCA-1,MXTRTQ                                                 
         MVI   TX57MPA-1,MXTRTQ                                                 
         MVI   TX57TDA-1,MXTRTQ                                                 
         MVI   TX57TPP-1,MXTRTQ                                                 
         MVI   TX57VOID-1,MXTRTQ                                                
         MVI   TX57STAL-1,MXTRTQ                                                
         MVI   TX57EFT-1,MXTRTQ                                                 
         MVI   TX57VDER-1,MXTRTQ                                                
         MVI   TX57RISS-1,MXTRTQ                                                
         MVI   TX57ISS-1,MXTRTQ                                                 
         MVI   TX57TREF-1,MXTRTQ                                                
         MVI   TX57TT-1,MXTRTQ                                                  
         MVI   TX57ST-1,MXTRTQ                                                  
         MVI   TX57ACRA-1,MXTRTQ                                                
         MVI   TX57AGA-1,MXTRTQ                                                 
*        MVI   TX57ASS-1,MXTRTQ                                                 
         MVI   TX57SFEE-1,MXTRTQ                                                
         MVI   TX57HRAT-1,MXTRTQ                                                
         MVI   TX57SPTS-1,MXTRTQ                                                
         MVI   TX57DAYS-1,MXTRTQ                                                
         MVI   TX57OTHR-1,MXTRTQ                                                
         MVI   TX57DTHR-1,MXTRTQ                                                
         MVI   TX57TRVL-1,MXTRTQ                                                
         MVI   TX57PDWD-1,MXTRTQ                                                
         MVI   TX57TAGS-1,MXTRTQ                                                
         MVI   TX57WORK-1,MXTRTQ                                                
         MVI   TX57INDR-1,MXTRTQ                                                
         MVI   TX57PRGS-1,MXTRTQ                                                
         MVI   TX57RETK-1,MXTRTQ                                                
         MVI   TX57OVP1-1,MXTRTQ                                                
         MVI   TX57OVP2-1,MXTRTQ                                                
         MVI   TX57CATC-1,MXTRTQ                                                
         MVI   TX57CAMR-1,MXTRTQ                                                
         MVI   TX57TAXU-1,MXTRTQ                                                
         MVI   TX57LIFT-1,MXTRTQ                                                
         MVI   TX57DBLS-1,MXTRTQ                                                
         MVI   TX57FSDT-1,MXTRTQ                                                
         MVI   TX57CNYR-1,MXTRTQ                                                
         MVI   TX57APPC-1,MXTRTQ                                                
         MVI   TX57INCC-1,MXTRTQ                                                
         MVI   TX57MANO-1,MXTRTQ                                                
         MVI   TX57TXLV-1,MXTRTQ                                                
         MVI   TX57MAJS-1,MXTRTQ                                                
         MVI   TX57UNIT-1,MXTRTQ                                                
         MVI   TX57SUN-1,MXTRTQ                                                 
         MVI   TX57NUSE-1,MXTRTQ                                                
         MVI   TX57SDTE-1,MXTRTQ                                                
         MVI   TX57PDTE-1,MXTRTQ                                                
         MVI   TX57EDTE-1,MXTRTQ                                                
         MVI   TX57AFEE-1,MXTRTQ                                                
         MVI   TX57PHRT-1,MXTRTQ                                                
         MVI   TX57PERF-1,MXTRTQ                                                
         MVI   TX57SPNH-1,MXTRTQ                                                
         MVI   TX57UNI-1,MXTRTQ                                                 
         MVI   TX57PCGR-1,MXTRTQ                                                
         MVI   TX57GRTC-1,MXTRTQ                                                
         MVI   TX57INDP-1,MXTRTQ                                                
         MVI   TX57CRPP-1,MXTRTQ                                                
         MVI   TX57GSTA-1,MXTRTQ                                                
         MVI   TX57USSC-1,MXTRTQ                                                
         MVI   TX57BASA-1,MXTRTQ                                                
         MVI   TX57PHBS-1,MXTRTQ                                                
         MVI   TX57PHDF-1,MXTRTQ                                                
         MVI   TX57LIEN-1,MXTRTQ                                                
         MVI   TX57TRST-1,MXTRTQ                                                
         MVI   TX57MLTS-1,MXTRTQ                                                
         MVI   TX57OINV-1,MXTRTQ                                                
         MVI   TX57X,MXTRTQ                                                     
         MVI   TX57X+1,MXTRTQ                                                   
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCDEF - EXTRACT CHECK DEFAULTS                                              
***********************************************************************         
TOXCDEF  NTR1  BASE=*,LABEL=*                                                   
         MVI   TX57CURR,C'U'       DEFAULT TO US$                               
         MVI   TX57STOP,C'N'                                                    
         MVI   TX57PULL,C'N'                                                    
         MVI   TX57VOID,C'N'                                                    
         MVI   TX57STAL,C'N'                                                    
         MVI   TX57EFT,C'N'                                                     
         MVI   TX57LIEN,C'N'                                                    
         MVI   TX57TRST,C'N'                                                    
         MVI   TX57MLTS,C'N'                                                    
         MVI   TX57VDER,C'N'                                                    
         MVI   TX57RISS,C'N'                                                    
         MVI   TX57ISS,C'N'                                                     
         MVI   TX57TREF,C'N'                                                    
         MVI   TX57TT,C'N'                                                      
         MVI   TX57ST,C'N'                                                      
         MVC   TX57WIRE,=C'        .00'                                         
         MVC   TX57DRCT,=C'        .00'                                         
         MVC   TX57ACA,=C'        .00'                                          
         MVC   TX57DA,=C'        .00'                                           
         MVC   TX57PCA,=C'        .00'                                          
         MVC   TX57MPA,=C'        .00'                                          
         MVC   TX57TDA,=C'        .00'                                          
         MVC   TX57ACRA,=C'        .00'                                         
         MVC   TX57AGA,=C'        .00'                                          
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCLWR - EXTRACT CHECK LIEN WITHHOLDING RECORD                               
***********************************************************************         
         USING TLCKD,R3                                                         
         USING TALWD,R5                                                         
TOXCLWR  NTR1  BASE=*,LABEL=*                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK62CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX62LEN)                                          
         MVC   TOXRETYP,TOXCLWQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX62CHK-1,MXTRTQ                                                 
         MVI   TX62REF-1,MXTRTQ                                                 
         MVI   TX62AMT-1,MXTRTQ                                                 
         MVI   TX62LPP-1,MXTRTQ                                                 
*        MVI   TX62ASS-1,MXTRTQ                                                 
         MVI   TX62X,MXTRTQ                                                     
         MVI   TX62X+1,MXTRTQ                                                   
*                                                                               
         L     RF,=A(SV57CHK)                                                   
         MVC   TX62CHK,0(RF)       CHECK PRIMARY KEY                            
         L     RF,=A(SV57ASS)                                                   
*        MVC   TX62ASS,0(RF)       ASSET PRIMARY KEY                            
*                                                                               
         MVC   TX62REF,TALWLIN     LIEN CODE                                    
         EDIT  TALWREC,TX62AMT,2,FLOAT=-,ALIGN=RIGHT      AMOUNT                
*                                                                               
         LA    R5,TLCKELEM         R5=A(FIRST ELEMENT)                          
TCLWR10  CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TCLWRX                                                           
         CLI   0(R5),TANUELQ                                                    
         JE    TCLWR30                                                          
*                                                                               
TCLWR20  SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TCLWR10                                                          
*                                                                               
         USING TANUD,R5                                                         
TCLWR30  CLI   TANUTYPE,TANUTLIN   LIEN PAYER PID                               
         JNE   TCLWR20                                                          
         GOTOR SSN2PID,DMCB,TANUMBER,DUB                                        
         MVC   TX62LPP,DUB                                                      
*                                                                               
TCLWRX   J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCAGSR - EXTRACT CHECK AGENT CHECK SOURCE                                   
***********************************************************************         
         USING TANUD,R5                                                         
TOXCAGSR NTR1  BASE=*,LABEL=*                                                   
         CLI   TANUTYPE,TANUTCST                                                
         JNE   XIT                                                              
*                                                                               
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK64CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX64LEN)                                          
         MVC   TOXRETYP,TOXCACSQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX64CHK-1,MXTRTQ                                                 
         MVI   TX64PID-1,MXTRTQ                                                 
*        MVI   TX64ASS-1,MXTRTQ                                                 
         MVI   TX64X,MXTRTQ                                                     
         MVI   TX64X+1,MXTRTQ                                                   
*                                                                               
         L     RF,=A(SV57CHK)                                                   
         MVC   TX64CHK,0(RF)       CHECK PRIMARY KEY                            
         L     RF,=A(SV57ASS)                                                   
*        MVC   TX64ASS,0(RF)       ASSET PRIMARY KEY                            
*                                                                               
         GOTOR SSN2PID,DMCB,TANUMBER,TX64PID                                    
*                                                                               
TCACSRX  J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXCFTWR - EXTRACT CHECK FEDERAL TAX WITHHOLDING RECORD                       
***********************************************************************         
         USING TACWD,R5                                                         
TOXCFTWR NTR1  BASE=*,LABEL=*                                                   
         USING PKCNTS,RE                                                        
         L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK58CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX57LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX58LEN)                                          
         MVC   TOXRETYP,TOXCFTWQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX58CHK-1,MXTRTQ                                                 
         MVI   TX58RES-1,MXTRTQ                                                 
         MVI   TX58MAR-1,MXTRTQ                                                 
         MVI   TX58NOE-1,MXTRTQ                                                 
         MVI   TX58WORK-1,MXTRTQ                                                
         MVI   TX58TAX-1,MXTRTQ                                                 
         MVI   TX58FICA-1,MXTRTQ                                                
*        MVI   TX58ASS-1,MXTRTQ                                                 
         MVI   TX58X,MXTRTQ                                                     
         MVI   TX58X+1,MXTRTQ                                                   
*                                                                               
         L     RF,=A(SV57CHK)                                                   
         MVC   TX58CHK,0(RF)       CHECK PRIMARY KEY                            
         L     RF,=A(SV57ASS)                                                   
*        MVC   TX58ASS,0(RF)       ASSET PRIMARY KEY                            
*                                                                               
         MVI   TX58RES,C'N'                                                     
         TM    TACWSTAT,TACWSRES   RESIDENT?                                    
         JZ    *+8                                                              
         MVI   TX58RES,C'Y'                                                     
*                                                                               
         MVI   TX58WORK,C'N'                                                    
         TM    TACWSTAT,TACWSWRK   WORK?                                        
         JZ    *+8                                                              
         MVI   TX58WORK,C'Y'                                                    
*                                                                               
         MVC   TX58MAR,TACWMST     MARITAL STATUS                               
         MVC   TX58NOE,TACWEXS     EXEMPTIONS                                   
*                                                                               
         EDIT  TACWTAX,TX58TAX,2,FLOAT=-,ALIGN=RIGHT       TAX                  
         EDIT  TACWFICA,TX58FICA,2,FLOAT=-,ALIGN=RIGHT     FICA                 
*                                                                               
TCFTWRX  J     XIT                                                              
         EJECT                                                                  
         LTORG                                                                  
***********************************************************************         
* TOXCSESS - EXTRACT CHECK SESSION DATA                                         
***********************************************************************         
         USING TASDD,R5                                                         
TOXCSESS NTR1  BASE=*,LABEL=*                                                   
         EDIT  TASDFEE,TX57SFEE,2  SESSION FEE                                  
         EDIT  TASDHR,TX57HRAT,2   HOURLY RATE                                  
         CLC   SVUSE,=C'BSM'                                                    
         BE    TOXCSS10                                                         
         CLC   SVUSE,=C'IMS'                                                    
         BE    TOXCSS10                                                         
         CLC   SVUSE,=C'IDS'                                                    
         BE    TOXCSS10                                                         
         CLC   SVUSE,=C'BSR'                                                    
         BE    TOXCSS20                                                         
         CLC   SVUSE,=C'ADO'                                                    
         BE    TOXCSS20                                                         
         CLC   SVUSE,=C'ARR'                                                    
         BE    TOXCSS20                                                         
         CLC   SVUSE,=C'RRR'                                                    
         BE    TOXCSS20                                                         
         CLC   SVUSE,=C'RTK'                                                    
         BE    TOXCSS30                                                         
         CLC   SVUSE,=C'DIO'                                                    
         BE    TOXCSS40                                                         
         CLC   SVUSE,=C'IVR'                                                    
         BE    TOXCSS50                                                         
                                                                                
*                                  TELEVISION SESSION  (BSS+)                   
         EDIT  TASDSP,TX57SPTS     SPOTS                                        
         EDIT  TASDDAY,TX57DAYS    DAYS                                         
         EDIT  TASDOT,TX57OTHR     OVERTIME HOURS                               
         EDIT  TASDDT,TX57DTHR     DOUBLETIME HOURS                             
*                                                                               
         OC    TASDTRV,TASDTRV                                                  
         BZ    TOXCSS05                                                         
         EDIT  TASDTRV,FULL,ALIGN=RIGHT,FILL=0   TRAVEL TIME                    
         LA    R4,TX57TRVL                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSS05 OC    TASDPDW,TASDPDW                                                  
         BZ    TOXCSS08                                                         
         EDIT  TASDPDW,FULL,ALIGN=RIGHT,FILL=0   PRIOR DAY WARDROBE             
         LA    R4,TX57PDWD                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSS08 EDIT  TASDTAG,TX57TAGS    TAGS                                         
         J     TOXCSSX                                                          
                                                                                
*                                  MUSIC SESSION (BSM,IMS,IDS)                  
TOXCSS10 EDIT  TASDMSP,TX57SPTS    SPOTS                                        
*                                                                               
         OC    TASDMHM,TASDMHM                                                  
         BZ    TOXCSSX                                                          
         EDIT  TASDMHM,FULL,ALIGN=RIGHT,FILL=0   WORK TIME                      
         LA    R4,TX57WORK                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
         B     TOXCSSX                                                          
                                                                                
*                                  RADIO SESSION (BSR,ADO,ARR,RRR)              
TOXCSS20 EDIT  TASDRSP,TX57SPTS    SPOTS                                        
         EDIT  TASDRTG,TX57TAGS    TAGS                                         
*                                                                               
         OC    TASDRHM,TASDRHM                                                  
         BZ    TOXCSSX                                                          
         EDIT  TASDRHM,FULL,ALIGN=RIGHT,FILL=0   WORK TIME                      
         LA    R4,TX57WORK                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
         B     TOXCSSX                                                          
                                                                                
*                                  INDUSTRIAL RETAKE SESSION (URTK)             
*                                                                               
TOXCSS30 EDIT  TASDIOT,TX57OTHR    OVERTIME HOURS                               
         EDIT  TASDIDT,TX57DTHR    DOUBLETIME HOURS                             
*                                                                               
         OC    TASDITR,TASDITR                                                  
         BZ    TOXCSS33                                                         
         EDIT  TASDITR,FULL,ALIGN=RIGHT,FILL=0   TRAVEL TIME                    
         LA    R4,TX57TRVL                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSS33 OC    TASDIHM,TASDIHM                                                  
         BZ    TOXCSS35                                                         
         EDIT  TASDIHM,FULL,ALIGN=RIGHT,FILL=0   WORK TIME                      
         LA    R4,TX57WORK                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSS35 MVI   TX57INDR,C'1'       INDUSTRIAL RETAKE STATUS                     
         TM    TASDIST,TASDIENQ    ENTIRE SCRIPT?                               
         BO    TOXCSSX                                                          
         MVI   TX57INDR,C'2'                                                    
         TM    TASDIST,TASDIPTQ    PARTIAL SCRIPT?                              
         BO    TOXCSSX                                                          
         MVI   TX57INDR,C'3'                                                    
         TM    TASDIST,TASDI60Q    OVER 60 DAYS?                                
         BO    TOXCSSX                                                          
         MVI   TX57INDR,0                                                       
         B     TOXCSSX                                                          
                                                                                
*                                  INDUSTRIAL RADIO SESSION (UDIO)              
TOXCSS40 OC    TASDIRH,TASDIRH                                                  
         BZ    TOXCSS45                                                         
         EDIT  TASDIRH,FULL,ALIGN=RIGHT,FILL=0   WORK TIME                      
         LA    R4,TX57WORK                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSS45 EDIT  TASDIRP,TX57PRGS    PROGRAMS                                     
*                                                                               
         OC    TASDIRR,TASDIRR                                                  
         BZ    TOXCSSX                                                          
         EDIT  TASDIRR,FULL,ALIGN=RIGHT,FILL=0   RETAKE TIME                    
         LA    R4,TX57RETK                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
         B     TOXCSSX                                                          
                                                                                
*                                  INTERACTIVE VOICE RECORDING (UIVR)           
TOXCSS50 OC    TASDIVT,TASDIVT                                                  
         BZ    TOXCSS55                                                         
         EDIT  TASDIVT,FULL,ALIGN=RIGHT,FILL=0   TRAVEL TIME                    
         LA    R4,TX57TRVL                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSS55 OC    TASDIVH,TASDIVH                                                  
         BZ    TOXCSSX                                                          
         EDIT  TASDIVH,FULL,ALIGN=RIGHT,FILL=0   WORK TIME                      
         LA    R4,TX57WORK                                                      
         MVC   0(2,R4),FULL        HOURS                                        
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),FULL+2      MINUTES                                      
*                                                                               
TOXCSSX  J     XIT                                                              
         DROP  R5                                                               
         LTORG                                                                  
         EJECT                                                                  
**********************************************************************          
* COMMON ROUTINES                                                    *          
**********************************************************************          
*                                                                               
*                                                                               
*                                                                               
TIMECON  NTR1  BASE=*,LABEL=*                                                   
         LM    R2,R4,0(R1)         R2=A(TIME), R3=A(DATE), R4=A(OUTPUT)         
         ZIC   R5,8(R1)            R5 = L'OUTPUT AREA                           
*                                                                               
         MVO   DUB,0(3,R2)         MAKE TIME PACKED                             
         OI    DUB+7,X'0F'                                                      
         CLC   =X'951218',0(R3)    IF DATE IS BEFORE 12/18/95                   
         JNH   *+14                                                             
         AP    DUB,=P'80000'       ADD 8 HOURS TO DDS TIME                      
         J     TIMECON2                                                         
         THMS  DDSTIME=YES         ELSE, ADD TIME DIFF. RETURNED IN R0          
         ST    R0,FULL                                                          
         AP    DUB,FULL(4)                                                      
*                                                                               
TIMECON2 CP    DUB+4(4),=P'240000'                                              
         JL    *+10                ADJUST TO 24 HOURS IF NECESSARY              
         SP    DUB+4(4),=P'240000'                                              
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(7),DUB+4(4)                                                 
*                                                                               
         CHI   R5,4                IF LENGTH EQUAL TO 4                         
         JNE   TIMECON5                                                         
         MVC   0(2,R4),WORK+1      DISPLAY HOURS                                
         MVC   2(2,R4),WORK+3      DISPLAY HHMM                                 
         J     TIMECONX                                                         
*                                                                               
TIMECON5 MVC   0(2,R4),WORK+1      DISPLAY HOURS                                
         CHI   R5,2                IF L'OUTPUT NOT TWO                          
         JE    TIMECONX                                                         
         MVI   2(R4),C':'                                                       
         MVC   3(2,R4),WORK+3      DISPLAY MINUTES TOO                          
         CHI   R5,5                IF L'OUTPUT NOT FIVE                         
         JE    TIMECONX                                                         
         MVI   5(R4),C':'                                                       
         MVC   6(2,R4),WORK+5      DISPLAY SECONDS TOO                          
TIMECONX XIT1                                                                   
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
GETUSER  NTR1  BASE=*,LABEL=*                                                   
*                                  P2=A(NAME FIELD)-SEE X'40' BIT ABOVE         
         L     R2,0(R1)                                                         
         XC    SVUSERID,SVUSERID                                                
         XC    CTKEY,CTKEY                                                      
         LA    R3,CTKEY                                                         
         USING CTIKEY,R3                                                        
         MVI   CTIKTYP,C'I'        BUILD KEY FOR ID RECORD                      
         MVC   CTIKNUM,SVBUID                                                   
                                                                                
         GOTO1 DATAMGR,DMCB,DMREAD,CTFILE,CTKEY,IOAREA                          
         BNE   GETUX                                                            
*                                                                               
         XC    SVUSERID,SVUSERID                                                
         XC    SVUSRIDN,SVUSRIDN                                                
         XC    SVUSRAID,SVUSRAID                                                
         XC    SVSECAGY,SVSECAGY                                                
*                                                                               
         LA    R3,IOAREA                                                        
         LA    R3,CTIDATA                                                       
GETU10   CLI   0(R3),0                                                          
         JE    GETU60                                                           
         CLI   0(R3),CTDSCELQ                                                   
         JE    GETU30                                                           
         CLI   0(R3),CTDSTELQ                                                   
         BE    GETU40                                                           
         CLI   0(R3),CTAGYELQ                                                   
         BE    GETU50                                                           
*                                                                               
GETU20   ZIC   R0,1(R3)                                                         
         AR    R3,R0                                                            
         J     GETU10                                                           
         USING CTDSCD,R3                                                        
*                                                                               
         USING CTDSCD,R3                                                        
GETU30   MVC   SVUSERID(L'CTDSC),CTDSC                                          
         J     GETU20                                                           
*                                                                               
         USING CTDSTD,R3                                                        
GETU40   MVC   SVUSRIDN,CTDSTNAM                                                
         J     GETU20                                                           
*                                                                               
         USING CTAGYD,R3                                                        
GETU50   MVC   SVUSRAID,CTAGYID                                                 
         J     GETU20                                                           
*                                                                               
GETU60   XC    CTKEY,CTKEY                                                      
         LA    R3,CTKEY                                                         
         USING CT5REC,R3                                                        
         MVI   CT5KTYP,C'5'                                                     
         MVC   CT5KALPH,SVUSRAID                                                
                                                                                
         GOTO1 DATAMGR,DMCB,DMREAD,CTFILE,CTKEY,IOAREA                          
         BNE   GETUX                                                            
*                                                                               
         LA    R3,IOAREA                                                        
         LA    R3,CT5DATA                                                       
GETU70   CLI   0(R3),0                                                          
         JE    GETUX                                                            
         CLI   0(R3),CTSEAELQ                                                   
         JE    GETU90                                                           
*                                                                               
GETU80   ZIC   R0,1(R3)                                                         
         AR    R3,R0                                                            
         J     GETU70                                                           
*                                                                               
         USING CTSEAD,R3                                                        
GETU90   MVC   SVSECAGY,CTSEAAID                                                
         J     GETU80                                                           
*                                                                               
GETUX    XIT1                                                                   
         LTORG                                                                  
CTKEY    DS    CL(L'CTIKEY)                                                     
         EJECT                                                                  
*                                                                               
       ++INCLUDE TASS2PID                                                       
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXNUD - NETWORK USE DETAILS 5048                                   *         
***********************************************************************         
         USING TLIND,R3                                                         
TOXNUD   NTR1  BASE=*,LABEL=*                                                   
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXNUD10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXNUDX                                                          
         CLI   0(R5),TANPELQ                                                    
         JE    TOXNUD30                                                         
*                                                                               
TOXNUD20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXNUD10                                                         
*                                                                               
         USING TANPD,R5                                                         
         USING PKCNTS,RE                                                        
TOXNUD30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK48CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX48LEN)                                          
         MVC   TOXRETYP,TOXNUDQ                                                 
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX48PINV-1,MXTRTQ                                                
         MVI   TX48UD-1,MXTRTQ                                                  
         MVI   TX48PN-1,MXTRTQ                                                  
         MVI   TX48LIFT-1,MXTRTQ                                                
         MVI   TX48NET-1,MXTRTQ                                                 
         MVI   TX48ASS-1,MXTRTQ                                                 
         MVI   TX48X,MXTRTQ                                                     
         MVI   TX48X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX48PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX48PINV                                                      
         LA    RE,6                                                             
TOXNUD40 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXNUD40                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX48ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         MVC   TX48UD,=C'TBA'                                                   
         CLC   TANPDATE,=C'TBA'                                                 
         JE    TOXNUD50                                                         
         GOTO1 DATCON,DMCB,(X'01',TANPDATE),(10,TX48UD) USE DATE                
*                                                                               
TOXNUD50 MVC   TX48PN,TANPPNME     PROGRAM NAME                                 
         OC    TX48PN,SPACES                                                    
*                                                                               
         MVI   TX48LIFT,C'N'                                                    
         OC    TANPLFT,TANPLFT     LIFT                                         
         JZ    *+8                                                              
         MVI   TX48LIFT,C'Y'                                                    
         MVC   TX48NET,TANPNWK     NETWORK                                      
*                                                                               
         J     TOXNUD20                                                         
         DROP  R5                                                               
*                                                                               
TOXNUDX  J     XIT                                                              
         EJECT                                                                  
**********************************************************************          
* LITERALS                                                           *          
**********************************************************************          
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TOXEJOB - ESTIMATE/JOB NUMBER 5068                                  *         
***********************************************************************         
         USING TLIND,R3                                                         
TOXEJOB  NTR1  BASE=*,LABEL=*                                                   
         TM    INVSTA2,TAINSPRM    PRIMARY INVOICES ONLY                        
         JZ    TOXEJO60                                                         
*                                                                               
         LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXEJO10 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXEJOBX                                                         
         CLI   0(R5),TASIELQ                                                    
         JE    TOXEJO30                                                         
*                                                                               
TOXEJO20 SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXEJO10                                                         
*                                                                               
         USING TASID,R5                                                         
         USING PKCNTS,RE                                                        
TOXEJO30 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK68CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX68LEN)                                          
         MVC   TOXRETYP,TOXEJOBQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX68PINV-1,MXTRTQ                                                
         MVI   TX68EJOB-1,MXTRTQ                                                
         MVI   TX68PCT-1,MXTRTQ                                                 
         MVI   TX68SINV-1,MXTRTQ                                                
         MVI   TX68X,MXTRTQ                                                     
         MVI   TX68X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX68PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX68PINV                                                      
         LA    RE,6                                                             
TOXEJO40 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXEJO40                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX68ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         ZIC   RE,TASILEN           ELEMENT LENGTH                              
         SH    RE,=Y(TASILNQ+1)                                                 
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TX68EJOB(0),TASIEST    DISPLAY ESTIMATE NUMBER                   
*                                                                               
         BAS   RE,DRPCT                                                         
                                                                                
         MVC   TX68SINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TASIINV                                                   
         LA    R6,TX68SINV                                                      
         LA    RE,6                                                             
TOXEJO50 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXEJO50                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TASIINV,0  SUBSID. INV PRIM KEY         
         J     TOXEJO20                                                         
*                                                                               
         USING TANUD,R5                                                         
TOXEJO60 LA    R5,TLINELEM         R5=A(FIRST ELEMENT)                          
TOXEJO62 CLI   0(R5),0             GET ELEMENT FROM RECORD                      
         JE    TOXEJOBX                                                         
         CLI   0(R5),TANUELQ                                                    
         JNE   *+12                                                             
         CLI   TANUTYPE,TANUTEST   ESTIMATE?                                    
         JE    TOXEJO70                                                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R5)                                                         
         AR    R5,RF                                                            
         J     TOXEJO62                                                         
*                                                                               
         USING TANUD,R5                                                         
         USING PKCNTS,RE                                                        
TOXEJO70 L     RE,APKCNTS                                                       
         LTR   RE,RE               DO WE HAVE ANYTHING TO ADD?                  
         BZ    *+10                                                             
         AP    PK68CNT,=P'1'                                                    
         DROP  RE                                                               
*                                                                               
         L     R2,ANEXT2                                                        
*                                                                               
         LH    RF,=Y(TX10LEN)                                                   
         STH   RF,RECLEN                                                        
         LR    R0,R2               R0=A(OUTPUT RECORD)                          
         LH    R1,RECLEN                                                        
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         ICM   RF,8,SPACES                                                      
         MVCL  R0,RE               SET RECORD TO ALL SPACES                     
*                                                                               
         LH    RF,RECLEN                                                        
         AR    RF,R2                                                            
         ST    RF,ANEXT2           SET NEXT SLOT FOR NEXT ROUTINE               
         XC    0(8,RF),0(RF)       CLEAR START OF NEXT DATA SPACE               
*                                                                               
         XC    TOXRELEN,TOXRELEN   RECORD LENGTH/TYPE/ENDOFREC                  
         MVC   TOXRELEN(2),=Y(TX68LEN)                                          
         MVC   TOXRETYP,TOXEJOBQ                                                
         MVC   TOXREACT,SVACT      ACTION                                       
         MVC   TOXREDAT,SVDAT      DATE                                         
         MVC   TOXRETIM,SVTIM      TIME                                         
*                                                                               
         MVI   TOXREACT-1,MXTRTQ                                                
         MVI   TOXREDAT-1,MXTRTQ                                                
         MVI   TOXRETIM-1,MXTRTQ                                                
*                                                                               
         MVI   TX68PINV-1,MXTRTQ                                                
         MVI   TX68EJOB-1,MXTRTQ                                                
         MVI   TX68PCT-1,MXTRTQ                                                 
         MVI   TX68SINV-1,MXTRTQ                                                
         MVI   TX68X,MXTRTQ                                                     
         MVI   TX68X+1,MXTRTQ                                                   
*                                                                               
         MVC   TX68PINV(L'TLINAGY),TLINAGY                                      
         MVC   DUB(6),TLININV                                                   
         XC    DUB(6),=6X'FF'                                                   
         LA    R6,TX68PINV                                                      
         LA    RE,6                                                             
TOXEJO72 CLI   0(R6),C' '                                                       
         JE    *+12                                                             
         AHI   R6,1                                                             
         BCT   RE,TOXEJO72                                                      
         GOTO1 VHEXOUT,DMCB,DUB,0(R6),L'TLININV,0  PRIMARY INV PRIM KEY         
*                                                                               
         GOTO1 VHEXOUT,DMCB,INVASS,TX68ASS,L'FULL,0   ASSET PR KEY              
*                                                                               
         ZIC   R1,TANULEN                                                       
         SHI   R1,4                                                             
         EX    R1,*+8                                                           
         J     *+10                                                             
         MVC   TX68EJOB(0),TANUMBER   DISPLAY ESTIMATE NUMBER                   
*                                                                               
         MVC   TX68PCT(6),=C'100.00'                                            
*                                                                               
TOXEJOBX J     XIT                                                              
         EJECT                                                                  
*                                                                               
         USING TASID,R5                                                         
DRPCT    NTR1                                                                   
         LA    R2,TX68PCT                                                       
         EDIT  TASIPCT3,(8,0(R2)),4,ALIGN=LEFT                                  
         AR    R2,R0               + LENGTH OF EDIT                             
         SH    R2,=H'4'            PT R2 TO DECIMAL PLACES                      
         LA    R1,3                CHECK DECIMALS FOR ZERO                      
DRPCT5   EX    R1,CKZERO                                                        
         BE    DRPCT8                                                           
         LA    R2,1(R2)                                                         
         BCT   R1,DRPCT5                                                        
         B     DRPCTX              NO ZEROES IN DECIMAL                         
*                                                                               
DRPCT8   CH    R1,=H'3'            IF ALL DECIMAL PLACES ARE ZERO               
         BNE   DRPCT9                                                           
         LA    R1,1(R1)            CLEAR DECIMAL POINT TOO                      
         BCTR  R2,0                                                             
DRPCT9   EX    R1,MVCSPC           SET TO SPACES                                
DRPCTX   J     XIT                                                              
         DROP  R5                                                               
*                                                                               
CKZERO   CLC   0(0,R2),=C'0000'    CHECK IF ZEROES                              
MVCSPC   MVC   0(0,R2),SPACES      SET ZEROES TO SPACES                         
         LTORG                                                                  
*                                                                               
YES      SR    RC,RC               RETURN CC EQUAL                              
NO       LTR   RC,RC               RETURN CC NOT EQUAL                          
XIT      XIT1  ,                                                                
         EJECT                                                                  
**********************************************************************          
* COMMON UTILITIES                                                   *          
**********************************************************************          
                                                                                
LITERAL  DS    0D                                                               
ANEXT    DC    F'0'                                                             
ANEXT2   DC    F'0'                                                             
*                                                                               
SVACT    DS    CL1                 SAVED ACTION FROM PREVIOUS REC               
SVDAT    DS    CL8                 SAVED DATE   FROM PREVIOUS REC               
SVTIM    DS    CL6                 SAVED TIME   FROM PREVIOUS REC               
SVBUID   DS    XL2                                                              
SVUSERID DS    XL(L'CTDSC)                                                      
SVUSRIDN DS    XL(L'CTDSTNAM)                                                   
SVUSRAID DS    CL(L'CTAGYID)                                                    
SVSECAGY DS    CL(L'CTSEAAID)                                                   
*                                                                               
DMREAD   DC    C'DMREAD '                                                       
CTFILE   DC    C'CTFILE '                                                       
*                                                                               
DATCON   DC    V(DATCON)                                                        
TINVCON  DC    V(TINVCON)                                                       
DATAMGR  DC    V(DATAMGR)                                                       
VHEXOUT  DC    V(HEXOUT)                                                        
VCRYPT   DC    V(CRYPT)                                                         
*                                                                               
SPACES   DC    CL200' '                                                         
HEXFFS   DC    80X'FF'                                                          
ZEROS    DC    10C'0'                                                           
         EJECT                                                                  
**********************************************************************          
* INCLUDES AND BUFFERS                                               *          
**********************************************************************          
                                                                                
*MXTRT                                                                          
       ++INCLUDE MXTRT                                                          
         EJECT                                                                  
*TOXRECID                                                                       
       ++INCLUDE TOXRECID                                                       
         EJECT                                                                  
       ++INCLUDE FALANGTAB                                                      
         EJECT                                                                  
*                                                                               
         DC    CL8'BUFFER01'                                                    
BUFFER1  DC    20000XL8'00'        HOLDS RECORDS FOR WRITING TO FILE            
BUFFER1L EQU   *-BUFFER1                                                        
         DC    8X'FF'                                                           
*                                                                               
         DC    CL8'BUFFER02'                                                    
BUFFER2  DC    20000XL8'00'        HOLDS RECORDS FOR WRITING TO FILE            
BUFFER2L EQU   *-BUFFER2                                                        
         DC    8X'FF'                                                           
*                                                                               
WORKD    DSECT                                                                  
PARM     DS    0XL24               PARAMETER LIST                               
TXREC    DS    A                   A(EXTRACT RECORD)                            
TFREC    DS    A                   A(ACCFILE RECORD)                            
         DS    A                                                                
         DS    A                                                                
         DS    A                                                                
AENCKEY  DS    A                   ONLY FOR TOXSTFC                             
         ORG   AENCKEY                                                          
         DS    A                   FOR ALL ELSE (TOXCSTC)                       
*                                                                               
DUB      DS    D                                                                
DUB2     DS    D                                                                
FULL     DS    F                                                                
WORK     DS    XL20                                                             
APARM    DS    A                   A(PARAMETER LIST)                            
DMWORK   DS    12D                                                              
RELO     DS    A                                                                
APKCNTS  DS    A                   RECORD ACCUMULATORS                          
AHIDBUF  DS    A                                                                
ABUFFRIN DS    A                                                                
ACOMFACS DS    A                                                                
DMCB     DS    6F                                                               
HALF     DS    H                                                                
RECLEN   DS    H                                                                
LASTLEN  DS    H                                                                
LASTLEN1 DS    H                                                                
BYTE     DS    XL1                                                              
BYTE2    DS    XL1                                                              
ACCADDR  DS    XL4                                                              
IOKEY    DS    CL64                                                             
INVSTA2  DS    XL1                 INVOICE STATUS FLAG 2                        
PAIDSTA2 DS    XL1                 PAID STATUS 2                                
TMPADDR  DS    A                                                                
*                                                                               
         DS    F                                                                
INVASS   DS    XL4                 INVOICE ASSET PRIMARY KEY                    
*                                                                               
BUFFRET  DS    XL1                                                              
HIDICOM  DS    CL8                 INTERNAL COMMERCIAL NUMBER                   
HIDFCDTE DS    CL8                 1ST CYCLE DATE OF LAST HOLDING FEE           
*                                                                               
TMPCOUNT DS    F                                                                
*                                                                               
SVUSE    DS    CL3                 SAVE TAPDUSE (USE TYPE)                      
*                                                                               
IOAREA   DS    2048X                                                            
*                                                                               
WORKX    EQU   *                                                                
         EJECT                                                                  
ACTBLD   DSECT                                                                  
ACSTAT   DS    X                                                                
ACAGY    DS    CL6                                                              
ACCLI    DS    CL6                                                              
ACLNQ    EQU   *-ACTBLD                                                         
ACTBLNQ  EQU   (ACLNQ*100)+1                                                    
*                                                                               
PKCNTS   DSECT                                                                  
PK00CNT  DS    PL8                 05000 REC COUNT (AGENCY)                     
PK01CNT  DS    PL8                 05001 REC COUNT (CLIENT)                     
PK02CNT  DS    PL8                 05002 REC COUNT (PRODUCT)                    
PK03CNT  DS    PL8                 05003 REC COUNT (ASSET)                      
PK04CNT  DS    PL8                 05004 REC COUNT (VERSION)                    
PK05CNT  DS    PL8                 05005 REC COUNT (ALIAS)                      
PK06CNT  DS    PL8                 05006 REC COUNT (W-4)                        
PK07CNT  DS    PL8                 05007 REC COUNT (PERFORMER)                  
PK08CNT  DS    PL8                 05008 REC COUNT (FIXED CYCLE)                
PK09CNT  DS    PL8                 05009 REC COUNT (VERSION-PERFORMER)          
PK10CNT  DS    PL8                 05010 REC COUNT (INVOICE)                    
PK11CNT  DS    PL8                 05011 REC COUNT (TRACK)                      
PK12CNT  DS    PL8                 05012 REC COUNT (TRACK-PERFORMER)            
PK13CNT  DS    PL8                 05013 REC COUNT (TRACK-VERSION)              
PK14CNT  DS    PL8                 05014 REC COUNT (TRACK ASSET PERF)           
PK15CNT  DS    PL8                 05015 REC COUNT (PRIMARY INVOICE)            
PK16CNT  DS    PL8                 05016 REC COUNT (MEDIA)                      
PK17CNT  DS    PL8                 05017 REC COUNT (ASSET TYPE)                 
PK18CNT  DS    PL8                 05018 REC COUNT (W4 TYPE)                    
PK19CNT  DS    PL8                 05019 REC COUNT (PERFORMER CAT)              
PK20CNT  DS    PL8                 05020 REC COUNT (USE TYPE)                   
PK21CNT  DS    PL8                 05021 REC COUNT (CLIENT GROUP)               
PK22CNT  DS    PL8                 05022 REC COUNT (USE SUBTYPE)                
PK23CNT  DS    PL8                 05023 REC COUNT (ACTRA TYPE)                 
PK24CNT  DS    PL8                 05024 REC COUNT (AGENCY GROUP)               
PK25CNT  DS    PL8                 05025 REC COUNT (W4 ASSOCIATED CORP)         
PK26CNT  DS    PL8                 05026 REC COUNT (PRINT COMMERCIAL)           
PK27CNT  DS    PL8                 05027 REC COUNT (DEAL)                       
PK28CNT  DS    PL8                 05028 REC COUNT (AREA)                       
PK29CNT  DS    PL8                 05029 REC COUNT (PRINT USE)                  
PK30CNT  DS    PL8                 05030 REC COUNT (GUARANTEE)                  
PK31CNT  DS    PL8                 05031 REC COUNT (GUARANTEE AGY-CLI)          
PK32CNT  DS    PL8                 05032 REC COUNT (GUARANTEE PERIOD)           
PK33CNT  DS    PL8                 05033 REC COUNT (GUARANTEE CONTRACT)         
PK34CNT  DS    PL8                 05034 REC COUNT (GUARANTEE CON YEAR)         
PK35CNT  DS    PL8                 05035 REC COUNT (GUARANTEE COMMENT)          
PK36CNT  DS    PL8                 05035 REC COUNT (GUARANTEE YR TRACK)         
PK37CNT  DS    PL8                 05037 REC COUNT (VERSION CMNT LINE)          
PK38CNT  DS    PL8                 05038 REC COUNT (AGENT)                      
PK39CNT  DS    PL8                 05039 REC COUNT (GUARANTEE TRACKING)         
PK40CNT  DS    PL8                 05040 REC COUNT (GURANNTEE EXL USE)          
PK41CNT  DS    PL8                 05041 REC COUNT (OFFICE)                     
PK42CNT  DS    PL8                 05042 REC COUNT (OVERSCALE AMOUNT)           
PK43CNT  DS    PL8                 05043 REC COUNT (OVERSCALE % 1)              
PK44CNT  DS    PL8                 05044 REC COUNT (OVERSCALE % 2)              
PK45CNT  DS    PL8                 05045 REC COUNT (STAFF RECORD)               
PK46CNT  DS    PL8                 05046 REC COUNT (LIMITED AGY/CLIENT)         
PK47CNT  DS    PL8                 05047 REC COUNT (PREVIOUS VERSIONID)         
PK48CNT  DS    PL8                 05048 REC COUNT (NETWORK USE DET)            
PK49CNT  DS    PL8                 05049 REC COUNT (TV MARKET USE DET)          
PK50CNT  DS    PL8                 05050 REC COUNT (RADIO MKT USE DET)          
PK51CNT  DS    PL8                 05051 REC COUNT (CABLE NTWK USE DET)         
PK52CNT  DS    PL8                 05052 REC COUNT (LCL CBLSYS USE DET)         
PK53CNT  DS    PL8                 05053 REC COUNT (TELEVISION MARKET)          
PK54CNT  DS    PL8                 05054 REC COUNT (RADIO MARKET)               
PK55CNT  DS    PL8                 05055 REC COUNT (CABLE NETWORK)              
PK56CNT  DS    PL8                 05056 REC COUNT (LOCAL CABLE SYSTEM)         
PK57CNT  DS    PL8                 05057 REC COUNT (CHECK)                      
PK58CNT  DS    PL8                 05058 REC COUNT (CHECK - FEDERAL)            
PK59CNT  DS    PL8                 05059 REC COUNT (CHECK - STATE)              
PK60CNT  DS    PL8                 05060 REC COUNT (CHECK - CITY)               
PK61CNT  DS    PL8                 05061 REC COUNT (CHECK - CANADIAN)           
PK62CNT  DS    PL8                 05062 REC COUNT (CHECK - LIEN)               
PK63CNT  DS    PL8                 05063 REC COUNT (CHECK - DUE COMP)           
PK64CNT  DS    PL8                 05064 REC COUNT (CHECK - AGENT)              
PK65CNT  DS    PL8                 05065 REC COUNT (PRODUCT GROUP)              
PK66CNT  DS    PL8                 05066 REC COUNT (PRODUCT TYPE)               
PK67CNT  DS    PL8                 05067 REC COUNT (NETWORK)                    
PK68CNT  DS    PL8                 05068 REC COUNT (EST/JOB NUMBER)             
PK69CNT  DS    PL8                 05069 REC COUNT (TIMESHEET)                  
PK70CNT  DS    PL8                 05070 REC COUNT (CONTROL)                    
PK71CNT  DS    PL8                 05071 REC COUNT (EMPLOYER)                   
PK72CNT  DS    PL8                 05072 REC COUNT (LIEN)                       
PK73CNT  DS    PL8                 05073 REC COUNT (DUE COMPANY)                
PK74CNT  DS    PL8                 05074 REC COUNT (MEDIA                       
PK75CNT  DS    PL8                 05075 REC COUNT (INTERNET/NEWMED)            
PK76CNT  DS    PL8                 05076 REC COUNT (COMMERCIAL POOL)            
PK77CNT  DS    PL8                 05077 REC COUNT (BILL TO)                    
PK78CNT  DS    PL8                 05078 REC COUNT (CONTRACT TYPE)              
PK79CNT  DS    PL8                 05079 REC COUNT (PUBLISHED MUSIC)            
PK80CNT  DS    PL8                 05080 REC COUNT (VERSION PUB MUSIC)          
PK81CNT  DS    PL8                 05081 REC COUNT (EPISODE)                    
PK82CNT  DS    PL8                 05082 REC COUNT (EPISODE-PERFORMER)          
PK83CNT  DS    PL8                 05083 REC COUNT (ECAST)                      
PK84CNT  DS    PL8                 05084 REC COUNT (FIXED CYCLE TRK)            
PK85CNT  DS    PL8                 05085 REC COUNT (USAGE HISTORY)              
PK86CNT  DS    PL8                 05086 REC COUNT (HISTORY COMMENT)            
* DXDSECTS                                                                      
       ++INCLUDE DXDSECTS                                                       
         EJECT                                                                  
* TOXRECD                                                                       
       ++INCLUDE TOXRECD                                                        
         EJECT                                                                  
* TAGENFILE                                                                     
       ++INCLUDE TAGENFILE                                                      
* TASYSDSECT                                                                    
       ++INCLUDE TASYSDSECT                                                     
* CTGENFILE                                                                     
       ++INCLUDE CTGENFILE                                                      
* DDBUFFD                                                                       
       ++INCLUDE DDBUFFD                                                        
*TASYSUSES                                                                      
       ++INCLUDE TASYSUSES                                                      
*TASYSEQUS                                                                      
       ++INCLUDE TASYSEQUS                                                      
*WRITER ROLE TABLE DSECT                                                        
WROLTABD DSECT                                                                  
WROLEQU  DS    XL1                 EQUATE FOR THIS WRITER ROLE                  
WROLCHAR DS    CL2                 CHAR WRITER ROLE                             
WROLTABL EQU   (*-WROLTABD)                                                     
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'043TOXROUTS  02/16/18'                                      
         END                                                                    

*          DATA SET PPRTLOOKS  AT LEVEL 069 AS OF 05/01/02                      
*CATALP PPRTLOOK                                                                
         TITLE 'CHANGE LOG '                                                    
*                                                                               
* BPLA 12/13/93 CHANGE FOR # BUYS (NO ASC CHECKING)                             
*               IF NEWSPAPER PBDSPACE(2) = X'7B00' (# ZERO)                     
*               OR = C'# ' TREAT AS NON-SPACE BUY                               
* BPLA 6/11/93  FIX PROBLEM WITH CD EFFECTIVE DATE                              
*               PUBCD WAS BEING ALTERED AND NOT RESET                           
*                                                                               
* BPLA 2/22/93  FIX BUG WITH PREM LOOK-UP FOR BW + LINE                         
*                                                                               
* BPLA 1/6/93   ONLY CHANGE LOOK-UP DATE IF I CHANGE SOMETHING                  
*               THAT HAS A PBDRLIND VALUE                                       
*               X'80' = RATE                                                    
*               X'40' = CD OR AC                                                
*               X'10' = LINES                                                   
*               X'20' = PREMIUM                                                 
*                                                                               
*               NOTE - X'08' MEANS RATE IS FROZEN                               
*                                                                               
*               ALSO IF DATE IS THE SAME OR BITS IN PBDRLIND                    
*               INSTEAD OF CLOBBERING THEM                                      
*                                                                               
* BPLA 10/27/92 ONLY SET PBDRLIND TO X'40' IF CD OR AC IS REALLY                
*               LOOKED-UP                                                       
* BPLA 9/24/91  ALLOW LOOK-UP OF PUB DISCOUNT LEVEL RATES                       
*               FOR NON-NEWSPAPERS                                              
*                                                                               
* BPLA 6/16/89  PREVENT LOOK-UP OF 'C' RATE FOR NOT 'C' RATE BUY   L09          
*                                                                  L09          
*                                                                  L08          
* BPLA 7/27/88 'S' RATE SET PABACP TO P'1' NOT P'0'                L08          
*                                                                               
*                                                                               
* BPLA 6/13/88 FIXED BUG FOR NEWSPAPERS TO CHECK 8 CHARS           L07          
*              INSTEAD OF 6 WHEN COMPARING SPACES                  L07          
*                                                                               
* BPLA 6/6/88 ADD CHECK FOR WSJ - CONTRACT RATE CODES MUST BE      L06          
*             SAME TYPE - ELSE PBDCTYP AND PBDCOSIN WILL BE        L06          
*             MESSED UP                                            L06          
*                                                                  L05          
* BPLA 6/2/88 ADD C TYPE RATE AND PAGYNAT LOGIC                    L05          
*                                                                  L05          
*                                                                  L04          
* ROSA 5/25/88 ADD S TYPE RATE                                     L04          
*                                                                  L03          
*  BPLA 4/27/88 ADD NET RATES                                      L03          
*                                                                  L03          
*  ROSA 5/18/88 MODIFY CONTRACT RECORD LOOKUP WHEN ADDING CONTRACT L02          
*               HIGHER OR LOWER LEVEL RATE ELEMENTS ON-LINE        L02          
*                                                                  L02          
*  ROSA 5/11/88 MODIFY TO LOOKUP NEXT HIGHER OR LOWER RATE IN      L01          
*               CONTRACT.  PARM 3 BYTE 0 =L  (LOWER)  ELCODE X'21' L01          
*                                         H  (HIGHER)        X'22' L01          
*                                                                  L01          
         TITLE 'RATELOOK'                                                       
         SPACE 3                                                                
****                                                                            
*      **RATELOOK PARAMETER LIST**                                              
*                                                                               
* I. BUY RECORD LOOKUP                                                          
*                                                                               
*                                                                               
*        PARAM 1    BYTE 0    PAGYNAT (AGENCY NATIONALITY)         L05          
*                             X'00' = USA                          L05          
*                             C'C' = CANADA                        L05          
*                   BYTE 0    ERROR CODE ON RETURN                              
*                   BYTE 1-3  A(PBUYREC)                                        
*                                                                               
*        PARAM 2    BYTE 0    IF NON ZERO DON'T LOOK-UP AGENCY COM L05          
*                             FROM SECOND BYTE OF BY PROFILE       L05          
*                                                                               
*                   BYTE 1-3  A(PUBREC)                                         
*                                                                               
*        PARAM 3    BYTE 0    'R' MEANS REQUIRE RATE FROM CONTRACT              
*                             'L' LOOKUP LOWER RATE FROM CONTRACT  L01          
*                             'H' LOOKUP HIGHER                    L01          
*                   BYTE 1-3  A(PCONREC)  OR OMITTED                            
*                                                                               
*        PARAM 4    BYTE 0    'C' MEANS 'C' RATE BUY - IF NOT ON   L09          
*                             IGNORE 'C' RATE CONTRACT RATE ELEMS  L09          
*                   BYTE 1-3  A(BILL PROFILE)                                   
*                                                                               
*        PARAM 5    BYTE 0    NOT USED                                          
*                   BYTE 1-3  V(ADDAY)                                          
*                                                                               
*        PARAM 6    BYTE 0    NOT USED                                          
*                   BYTE 1-3  V(DATCON)                                         
****                                                                            
*        THE FOLLOWING DATA IS LOOKED UP FOR BUY RECORDS                        
*        (UNLESS ALREADY PRESENT)                                               
****                                                                            
*        1. CASH DISCOUNT AND AGY COMM                                          
*           *NOTE CD MAY BE FOUND IN PCATELEM IN PCONREC                        
*            OR FROM PUBLICATION RECORD                                         
*                                                                               
*        2. RATE - FROM CONTRACT  OR FROM PUBREC                                
*                                                                               
*        3. PREMIUM CHARGE                                                      
*                                                                               
*        4. PAYABLE DATE                                                        
*                                                                               
*        5. BILLABLE DATE                                                       
*        6. EQUIVALENT LINES (FOR NEWSPAPER SPACE)                              
*                                                                               
*           PBDRLIND IS SET FOR LOOKUPS DONE                                    
*                                                                               
*           X'80' = RATE                                                        
*           X'40' = CD OR AC                                                    
*           X'10' = LINES                                                       
*           X'20' = PREMIUM                                                     
*                                                                               
****                                                                            
****                                                                            
*                                                                               
* II. CONTRACT RECORD LOOKUP                                                    
*                                                                               
*                                                                               
*        PARAM 1    BYTE 0    ERROR CODE ON RETURN                              
*                   BYTE 1-3  NOT USED                                          
*                                                                               
*        PARAM 2    BYTE 0    ELEMENT TYPE TO BE PROCCESSED     L02             
*                             X'20' CURRENT LEVEL               L02             
*                             X'21' LOWER  LEVEL                L02             
*                             X'22' HIGHER  LEVEL               L02             
*                   BYTE 1-3  A(PUBREC)                                         
*                                                                               
*        PARAM 3    BYTE 0    X'00' = RETURN EQUAL OR LOWER LEVEL               
*                             X'01' = RETURN NEXT HIGHER LEVEL                  
*                   BYTE 1-3  A(PCONREC)                                        
*        PARAM 4    BYTE 0    MAX NUMBER OF ELEMENTS                            
*                   BYTE 1-3  A(OUTPUT AREA)                                    
****                                                                            
*                                                                               
*        THE FOLLOWING DATA IS LOOKED UP FOR CONTRACT RECORDS                   
*                                                                               
*        1. ONE RBELEM IS BUILT IN THE OUTPUT AREA FOR                          
*           EACH RATE EFFECTIVE WITHIN THE LIFE OF THE CONTRACT.                
*           THE LEVEL USED FOR LOOKUP IS TAKEN FROM THE FIRST                   
*           RBELEM FOUND IN THE CONTRACT RECORD.                                
*                                                                               
*                                                                               
         EJECT                                                                  
RATELOOK CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 30,**RATE**                    WAS 27                            
         SPACE 2                                                                
         USING WORKD,RC                                                         
         USING PBUYREC,R8                                                       
         USING PUBREC,R9                                                        
         USING PCONREC,RA                                                       
         XC    WORK(WORKL),WORK                                                 
         LA    R7,RATELOOK+4095                                                 
         LA    R7,1(R7)                                                         
         USING RATELOOK+4096,R7                                                 
         LM    R8,RA,0(R1)         R8 = A(BUYREC)                               
*                                  R9 = A(PUBREC)                               
*                                  RA = A(CONREC)                               
*                                                                               
         LA    R2,PUBREC+33                                                     
         ST    R1,SAVR1                                                         
         MVC   PARAMS(24),0(R1)                                                 
         SPACE 2                                                                
*                                                                               
         LTR   R8,R8                                                            
         BZ    CON                 NO BUY REC                                   
*                                                                               
*                                  SET TODAYS DATE                              
         MVI   LOOKIND,0           IS SET FOR DATA I LOOK UP                    
*                                  THIS TIME                                    
         GOTO1 DATCON,DMCB,(5,0),DUB                                            
         GOTO1 (RF),(R1),DUB,(3,TODAY)                                          
         EJECT                                                                  
*                                  CASH DISCOUNT LOOKUP                         
CDC      DS    0H                  FIRST LOOK AT PCONREC                        
*                                  FOR PCATELEM                                 
         MVI   CDACLK,0                                                         
*                                                                               
         CLI   PCONREC,0                                                        
         BE    CD                  NO CONTRACT                                  
         LA    R2,PCONREC+33                                                    
         MVI   ELCOD,X'50'                                                      
CDC2     BAS   RE,NXTEL                                                         
         BE    CDC4                                                             
         CLI   0(R2),0                                                          
         BNE   CDC2                                                             
         B     CD                  NO PCATELEM                                  
         USING PCATELED,R2                                                      
*                                                                               
CDC4     OC    PCATPCT,PCATPCT                                                  
         BZ    CD                 MEANS CD NOT SPECIFIED                        
         CP    PBDCD,=P'0'                                                      
         BNE   CD                 MUST STILL DO AC                              
         OI    CDACLK,X'01'      CD LOOKED-UP                                   
*                                                                               
         ZAP   PBDCD,=P'1'                                                      
         CLC   PCATPCT,=X'FFFF'    MEANS 0.0 CD                                 
         BE    CD                                                               
         LH    R0,PCATPCT                                                       
         CVD   R0,DUB                                                           
         ZAP   PBDCD,DUB                                                        
*                                                                               
         DROP  R2                                                               
         SPACE 2                                                                
CD       EQU   *                                                                
         LA    R2,PUBREC+33                                                     
         MVI   ELCOD,X'20'         PROD ELEM                                    
CD2      EQU   *                                                                
         BAS   RE,NXTEL                                                         
         BE    CD4                                                              
         CLI   0(R2),0                                                          
         BNE   CD2                                                              
         LA    R2,DUMGENEL                                                      
         USING PUBGENEL,R2                                                      
*                                  IF NO PROD ELEM                              
*                                  USE DEFAULT AC/CD                            
         ZAP   PUBAC,=P'15000'                                                  
         CLI   PARAMS,C'C'       SEE IF CANADIAN AGENCY             L05         
         BE    CD3                 YES - USE 15 PCT FOR ALL MEDIA   L05         
         CLI   PBUYKMED,C'O'                                                    
         BNE   *+10                                                             
         ZAP   PUBAC,=P'16667'                                                  
CD3      ZAP   PUBCD,=P'0'                                          L05         
         XC    PUBCDDAT,PUBCDDAT                                                
CD4      EQU   *                                                                
         ZAP   SAVPCD,PUBCD         SAVE PUB'S REAL CD                          
         CLC   PBUYKDAT,PUBCDDAT   TEST INS DATE VS CD EFF DATE                 
         BNL   CD6                                                              
*                                  CD NOT EFFECTIVE                             
         CP    PUBCD,=P'0'         CHANGE 0                                     
         BNE   CD5                                                              
         ZAP   PUBCD,=P'20'        TO 2.0 PCT                                   
         B     CD6                                                              
CD5      DS    0H                                                               
         ZAP   PUBCD,=P'0'         AND ANYTHING ELSE TO 0                       
CD6      DS    0H                                                               
         CP    PBDCD,=P'0'                                                      
         BNE   CD7                                                              
*                                                                               
         OI    CDACLK,X'01'         CD LOOKED-UP                                
*                                                                               
         ZAP   PBDCD,PUBCD                                                      
         BNZ   *+10                                                             
         ZAP   PBDCD,=P'1'                                                      
*                                  AGY COMM                                     
CD7      DS    0H                                                               
         ZAP   PUBCD,SAVPCD        RESTORE PUB'S REAL CD                        
*                                                                               
         CP    PBDACP,=P'0'        TEST ALREADY HAVE                            
         BNE   CD10                                                             
*                                                                               
         OI    CDACLK,X'02'        AC LOOKED-UP                                 
*                                                                               
         CLI   PARAM2,0            TEST AC OVERRIDE                             
         BE    CD9                 NO                                           
         LA    R3,ACTAB                                                         
         LA    R0,ACTABL                                                        
CD8      DS    0H                                                               
         CLC   PARAM2(1),0(R3)                                                  
         BE    CD8B                                                             
         LA    R3,4(R3)                                                         
         BCT   R0,CD8                                                           
         B     CD9                                                              
*                                                                               
CD8B     DS    0H                                                               
         ZAP   PBDACP,1(3,R3)      SET AC FROM TABLE                            
         B     CD9B                                                             
*                                                                               
CD9      DS    0H                                                               
         ZAP   PBDACP,PUBAC                                                     
CD9B     DS    0H                                                               
         BNZ   *+10                                                             
         ZAP   PBDACP,=P'1'        SET 0 TO .001 CONVENTION                     
CD10     DS    0H                                                               
         TM    CDACLK,X'03'                                                     
         BZ    TAX                                                              
*                                                                               
         OI    LOOKIND,X'40'       SET IND  CD OR AC LOOKED-UP                  
         B     TAX                                                              
*                                                                               
         SPACE 2                                                                
ACTAB    DS    0C                                                               
         DC    C'1',PL3'0'                                                      
         DC    C'2',PL3'7500'                                                   
         DC    C'3',PL3'8333'                                                   
ACTABL   EQU   (*-ACTAB)/4                                                      
******                                                                          
         DROP  R2                                                               
*                                  TAX LOOKUP                                   
*                                  NOTE - IF INS WAS BILLED OR PAID             
*                                  TAX WILL NOT BE LOOK-UPED                    
*                                                                               
         SPACE 2                                                                
TAX      EQU   *                                                                
         CLI   PBDELEM+1,105       SEE IF OLD ELEM                              
         BL    RATE                YES - NO TAX                                 
*                                                                               
         OC    PBDTAX,PBDTAX       SEE IF TAX ALREADY INPUT                     
         BNZ   RATE                                                             
         LA    R2,PBDELEM                                                       
         MVI   ELCOD,X'25'         SEE IF PAID                                  
TAX1     BAS   RE,NEXTEL                                                        
         BNE   TAX2                                                             
         OC    2(3,R2),2(R2)       CHK FOR PAID DATE                            
         BNZ   RATE                NO TAX LOOK-UP ON PAID INS                   
         B     TAX1                                                             
*                                                                               
TAX2     LA    R2,PBDELEM                                                       
         MVI   ELCOD,X'26'         SEE IF BILLED                                
TAX2B    BAS   RE,NEXTEL                                                        
         BNE   TAX3                                                             
         OC    5(3,R2),5(R2)       CHK FOR BILLED DATE                          
         BNZ   RATE                NO TAX LOOK-UP ON BILLED INS.                
         B     TAX2B                                                            
*                                                                               
TAX3     LA    R2,PUBREC+33                                                     
         MVI   ELCOD,X'22'         TAX ELEM                                     
TAX3B    EQU   *                                                                
         BAS   RE,NEXTEL                                                        
         BNE   RATE                                                             
*                                                                               
         USING PTAXELD,R2                                                       
TAX4     EQU   *                                                                
         LA    R5,PUBTAX1                                                       
         LA    R6,3                FOR BCT                                      
TAX5     OC    0(6,R5),0(R5)                                                    
         BZ    TAX6                                                             
*                                                                               
         CLC   PBUYKDAT,3(R5)      TEST INS DATE VS TAX EFF DATE                
         BL    TAX6                                                             
         MVC   PBDTAX,0(R5)                                                     
         OC    PBDTAX,PBDTAX                                                    
         BNZ   *+10                                                             
         MVC   PBDTAX(3),=X'000001'    TAX LOOK-UP OF ZERO                      
*                                                                               
TAX6     LA    R5,6(R5)                                                         
         BCT   R6,TAX5                                                          
         DROP  R2                                                               
         B     RATE                                                             
         EJECT                                                                  
*                                  RATE LOOKUP                                  
RATE     EQU   *                                                                
*                                                                               
         MVI   WSJIND,0                                                         
         LA    R2,PBUYREC+33      SEE IF WSJ BUY                                
         MVI   ELCOD,X'35'                                                      
RAT0     BAS   RE,NXTEL                                                         
         BNE   RAT0B                                                            
*                                                                               
         MVI   WSJIND,1            SET FOR WSJ BUY                              
         ST    R2,AWSJEL           SAVE ADDR OF WSJ ELEM                        
         USING PWSJELD,R2                                                       
         MVC   COMUNITS,PWSJUNTS       SAVE COMMON NATIONAL UNITS               
         MVC   NRCODE,PWSJNRTE         NATIONAL RATE CODE                       
         MVC   EUNITS,PBDUNITS                                                  
         SP    PBDUNITS,COMUNITS        SET PBDUNITS TO EXCESS                  
         ZAP   PBDCOS,=P'0'             FORCE RATE LOOK-UP                      
         B     RAT1                                                             
         DROP  R2                                                               
*                                                                               
RAT0B    CLI   0(R2),0              SEE IF AT END OF RECORD                     
         BNE   RAT0                                                             
*                                                                               
RAT1     LA    R2,PUBREC+33                                                     
         ZAP   SAVLEV,=P'0'                                                     
         MVI   SAVSPC,0                                                         
         MVI   SAVRIND,0                                                        
         CLI   PBUYKMED,C'O'                                                    
         BE    RAT70                                                            
         CLI   PBUYKMED,C'N'                                                    
         BNE   RT50                NON-NEWS                                     
*                                                                               
*                             NEWSPAPER                                         
         CLI   PBDUIND,X'89'       LOWER CASE I - WILL HAVE SPACE               
         BE    RAT2                                                             
*                                                                               
         CLC   PBDSPACE(2),=C'* '  TEST HAVE SPACE                              
         BNH   RAT2                NO                                           
*                                                                               
         CLC   PBDSPACE(2),=C'# '   CHECK FOR #,SPACE - TREAT AS                
         BE    RAT2                 NON-SPACE BUY                               
         CLC   PBDSPACE(2),=X'7B00' CHECK FOR #,ZERO  - TREAT AS                
         BE    RAT2                 NON-SPACE BUY                               
*                                                                               
*     IF I HAVE SPACE AND PBDUIND=L,AND PBDCLMS=0 THEN MUST BE SAU              
*     SO TREAT AS MAGAZINE BUY                                                  
*     IF PBDCLMS IS NOT 0 THEN MUST BE NNXNNNL BUY                              
*     SO I MUST TRY TO LOOK UP LINE RATE                                        
*                                                                               
         CLI   PBDUIND,C'L'                                                     
         BNE   RT50               TREAT AS MAGAZINES - SPACE                    
         CP    PBDCLMS,=P'0'                                                    
         BE    RT50               MUST BE SAU - TREAT AS MAGS                   
*                                                                               
*                                                                               
RAT2     CP    PBDCOS,=P'0'                                                     
         BNE   PREM                NO RATE LOOKUP NEEDED                        
RAT3     MVC   DUB(17),=17C' '                                                  
         CLI   PCONREC,0                                                        
         BE    RT2                 NO CONTRACT                                  
         MVI   RATPASS,0                                           L09          
RAT3C    LA    R2,PCONREC+33                                                    
         BAS   RF,DOELCODE         DETERMINE ELEMENT CODE          L01          
         XC    SAVR2,SAVR2                                                      
         CLC   ELCOD,0(R2)                                         L01          
******** CLI** 0(R2),X'20' **************************************  L01          
         BE    RAT6                                                             
RAT4     EQU   *                                                                
         BAS   RE,NXTEL                                                         
         BL    *-4                                                              
         BH    RAT8                                                             
RAT6     EQU   *                                                                
         USING PRBELEM,R2                                                       
RAT6A    CLI   PARAM4,C'C'                                        L09           
         BE    RAT6B                                              L09           
         TM    PRBIND,X'04'        SEE IF 'C' RATE                L09           
         BNZ   RAT4                SKIP IF PARAM4 NOT 'C'         L09           
         B     RAT6C                                              L09           
*                                                                 L09           
RAT6B    CLI   RATPASS,0                                          L09           
         BNE   RAT6C                                              L09           
         TM    PRBIND,X'04'        SEE IF 'C' RATE ELEM           L09           
         BZ    RAT4                ONLY LOOK FOR 'C' RATES ON     L09           
*                                  RATPASS 0                      L09           
*                                                                 L09           
RAT6C    TM    PRBIND,X'40'        TEST TOTAL RATE                              
         BNZ   RAT4                YES - SKIP (ONLY LINE RATES HERE)            
         CLI   PBDELEM+1,105       SEE IF OLD ELEM                              
         BL    RAT6D               NO RATE CODES                                
         CLI   PBDRCODE,0          SEE IF RATE CODE SPECIFIED                   
         BE    RAT6D               NO                                           
         CLC   PRBDESC(2),=C'R='                                                
         BNE   RAT4                                                             
         CLC   PRBDESC+2(3),PBDRCODE       RATE CODES MUST MATCH                
         BNE   RAT4                                                             
         B     RAT7                                                             
*                                                                               
RAT6D    CLC   PRBDESC(2),=C'R='                                                
         BE    RAT4             ONLY USE RCODE RATE FOR RCODE BUYS              
*                                                                               
RAT7     CLC   PBUYKDAT,PRBDATE                                                 
         BL    RAT8                                                             
         ST    R2,SAVR2                                                         
         B     RAT4                                                             
RAT8     EQU   *                                                                
         CLI   PARAM4,C'C'        SEE IF DOING 'C' RATE          L09            
         BNE   RAT8D                                             L09            
         OC    SAVR2,SAVR2         SEE IF I FOUND 'C' RATE       L09            
         BNZ   RAT8D                                             L09            
         CLI   RATPASS,1           SEE IF I HAVE LOOKED FOR      L09            
         BE    RAT8D               NON- 'C' RATE ELEMS           L09            
         MVI   RATPASS,1           GO LOOK AGAIN                 L09            
         B     RAT3C          THIS TIME ACCEPT NON C RATE ELEMS  L09            
*                                                                               
RAT8D    L     R2,SAVR2                                                         
         LTR   R2,R2                                                            
         BP    *+12                                                             
RATINV   MVI   ERR,RATERR                                                       
         B     ERROR                                                            
         ZAP   SAVLEV,PRBLEVEL     SAVE LEVEL                                   
         MVC   SAVLIND,PRBLIND     AND LEV IND                                  
         TM    PRBIND,X'80'        TEST OVERRIDE                                
         BZ    RT2                 USE PUBREC                                   
RAT10    EQU   *                                                                
         ZAP   PBDCOS,PRBRATE      RATE                                         
**NEW 4/27/88                                                                   
         TM    PRBIND,X'10'        NET RATE FROM CONTRACT          L03          
         BZ    *+8                                                 L03          
         MVI   PBDCTYP,C'N'        SET NET RATE INPUT              L03          
**NEW 4/27/88                                                                   
         TM    PRBIND,X'02'        SEE IF S TYPE RATE               L04         
         BZ    NOTSTYP                                              L04         
         MVI   PBDCOSIN,C'S'       COST INDICATOR                   L04         
         ZAP   PBDACP,=P'1'  SET AC LOOK-UP OF ZERO                 L08         
*                            WILL BE RESET TO P'0'                  L08         
*                                                                   L04         
         B     RTX                                                              
*                                                                               
NOTSTYP  DS    0H                                                   L04         
         TM    PRBIND,X'04'        SEE IF C TYPE RATE               L05         
         BZ    NOTCTYP                                              L05         
         MVI   PBDCOSIN,C'C'       COST INDICATOR                   L05         
*                                  GETINS WILL SET GROSS TO AGYCOM  L05         
*                                  AND CD TO ZERO                   L05         
NOTCTYP  B     RTX                                                  L05         
*                                                                               
         DROP  R2                                                               
         SPACE 3                                                                
RT2      EQU   *                                                                
         CLI   PARAM3,C'R'         SEE IF CONTRACT RATE REQUIRED                
         BE    RTERR                                                            
         LA    R2,PUBREC+33                                                     
         MVI   ELCOD,X'50'         RATE ELEM                                    
         CLI   0(R2),X'50'                                                      
         BE    RT6                                                              
RT4      BAS   RE,NXTEL                                                         
         BL    *-4                                                              
         BE    RT6                                                              
         CLI   0(R2),X'51'                                                      
         BE    RT4                                                              
         CP    PBDCOS,=P'0'        FOR OUTDOOR MAY ALREADY HAVE RATE            
         BNE   RAT57A2                IF SO NO ERROR                            
RTERR    MVI   ERR,RATERR          CANT FIND RATE ELEM                          
         B     ERROR                                                            
*                                  HAVE RATE ELEM                               
RT6      EQU   *                                                                
         USING PUBRATEL,R2                                                      
         CLC   PBUYKDAT,PUBRSTRT   CHECK DATES                                  
         BL    RT4                                                              
         CLI   PBDELEM+1,105       SEE IF NEW ELEM                              
         BL    RT6C                NO - THEN NO RATE CODES                      
*                                                                               
         CLI   PBDRCODE,0          SEE IF RATE CODE SPECIFIED                   
         BE    RT6C                IN PBUYREC                                   
         CLC   PUBRSPCE(2),=C'R='                                               
         BNE   RT4                                                              
         CLC   PBDRCODE,PUBRSPCE+2                                              
         BNE   RT4                RATE CODES MUST MATCH                         
         CLI   PBDCOSTY,C'T'                                                    
         BE    RT6B                                                             
         CLI   PUBRTYP,0          CAN'T BE TOTAL RATE                           
         BE    RT4                YES - OK                                      
         B     RT7                                                              
*                                                                               
RT6B     CLI   PUBRTYP,0          MUST BE TOTAL RATE                            
         BNE   RT4                                                              
         B     RT7                FOUND RATE CODE                               
*                                                                               
RT6C     CLC   PUBRSPCE(2),=C'R='                                               
         BE    RT4                SKIP                                          
         LA    RF,3                                                             
         CLI   PUBRSPCE,X'FF'                                                   
         BE    *+14                                                             
         LA    RF,16                                                            
         OC    PUBRSPCE,=17C' '                                                 
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   DUB(0),PUBRSPCE     TEST SAME SPACE DESC                         
         BNE   RT4                                                              
         CLI   PUBRSPCE,X'FF'                                                   
         BNE   RT7                                                              
         CP    PBDREG,=P'0'                                                     
         BNE   *+10                                                             
         ZAP   PBDREG,PUBRSPCE+4(3)     NO. REGULAR                             
         CP    PBDILLUM,=P'0'                                                   
         BNE   *+10                                                             
         ZAP   PBDILLUM,PUBRSPCE+7(3)    NO. ILLUM                              
RT7      DS    0H                                                               
         CP    PBDCOS,=P'0'                                                     
         BNE   RAT57A2                                                          
         TM    PUBRTYP,X'20'       TEST INCH RATE                               
         BZ    *+8                                                              
         MVI   SAVLIND,C'I'                                                     
         ZAP   PBDCOS,PUBRATE                                                   
         CP    SAVLEV,=P'0'        CHECK LEVEL GIVEN                            
         BE    RTX                                                              
         MVC   METH,PUBDRTYP       SAVE METHOD                                  
         DROP  R2                                                               
         USING PUBDSCEL,R2                                                      
         MVI   ELCOD,X'51'         RATE TABLE ELEM                              
RT8      BAS   RE,NXTEL                                                         
         BNE   RTX                                                              
         CP    SAVLEV,PUBDSCLV                                                  
         BL    RT8                                                              
*                                  HAVE RIGHT DISC TABLE ELEM                   
         TM    METH,X'80'          METH = LINE RATE                             
         BZ    RT10                                                             
         ZAP   PBDCOS,PUBDSCRT                                                  
         B     RTX                                                              
*                                  METH = PCT DISC                              
RT10     EQU   *                                                                
         ZAP   DUBDUB,PBDCOS                                                    
         MP    DUBDUB,PUBDSCRT                                                  
         AP    DUBDUB,=P'5000000'                                               
         MVO   DUBDUB,DUBDUB(12)                                                
         SP    PBDCOS,DUBDUB                                                    
RTX      EQU   *                                                                
         CLI   PBUYKMED,C'N'                                                    
         BNE   RTX5                                                             
         MVC   ELCOD,PBDUIND       SAVE ORIGINAL PBDUIND                        
         OI    PBDUIND,X'40'       SET LOWER CASE I TO UPPER                    
         CLC   PBDUIND,SAVLIND                                                  
         BE    RTX4                                                             
         CLI   SAVLIND,C'I'                                                     
         BNE   RTX2                                                             
         ZAP   DUB,PBDCOS                                                       
         AP    DUB,=P'7'                                                        
         DP    DUB,=P'14'                                                       
         ZAP   PBDCOS,DUB(6)                                                    
RTX2     DS    0H                                                               
         CLI   PBDUIND,C'I'                                                     
         BNE   RTX4                                                             
         ZAP   DUB,PBDCOS                                                       
         MP    DUB,=P'14'                                                       
         ZAP   PBDCOS,DUB                                                       
RTX4     DS    0H                                                               
         MVC   PBDUIND,ELCOD       RESTORE PBDUIND                              
         MVI   PBDCOSTY,C'U'       TYPE = UNITS                                 
RTX5     DS    0H                                                               
         OI    LOOKIND,X'80'       SET IND                                      
         CLC   PBDSPACE(2),=C'* '       TEST SPACE BUY                          
         BNH   PREM                     NO                                      
*                                                                               
         CLC   PBDSPACE(2),=C'# '   CHECK FOR #,SPACE - TREAT AS                
         BE    PREM                 NON-SPACE BUY                               
         CLC   PBDSPACE(2),=X'7B00' CHECK FOR #,ZERO  - TREAT AS                
         BE    PREM                 NON-SPACE BUY                               
*                                                                               
         CLI   PBDUIND,X'89'       LOWER CASE I                                 
         BE    PREM                NO CLE LOOKUP                                
         CLI   PBDUIND,C'L'                                                     
         BNE   RAT57A                                                           
         CP    PBDCLMS,=P'0'                                                    
         BE    RAT57A              MUST BE SAU - DO CLE LOOK-UP                 
         B     PREM                MUST BE NNXNNNL BUY                          
*                                  NO CLE LOOK-UP                               
*                                                                               
         DROP  R2                                                               
         SPACE 2                                                                
*                                  NON-NEWS LOOK-UP                             
RT50     EQU   *                                                                
         CP    PBDCOS,=P'0'                                                     
         BNE   RAT57A2                NO RATE LOOKUP NEEDED                     
         MVC   DUB(17),PBDSPACE                                                 
         OC    DUB(17),=17C' '                                                  
RAT51    DS    0H                                                               
         CLI   PCONREC,0                                                        
         BE    RT59                                                             
         MVI   RATPASS,0                                           L09          
RAT51C   LA    R2,PCONREC+33                                                    
         XC    SAVR2,SAVR2                                                      
         XC    SAVDAT,SAVDAT                                                    
         BAS   RF,DOELCODE         DETERMINE ELEMENT CODE          L01          
         CLC   ELCOD,0(R2)                                         L01          
         BE    RT54                                                             
RT52     EQU   *                                                                
         BAS   RE,NXTEL                                                         
         BL    *-4                                                              
         BH    RT56                                                             
RT54     EQU   *                                                                
         USING PRBELEM,R2                                                       
         CLI   PARAM4,C'C'                                        L09           
         BE    RT54A0                                             L09           
         TM    PRBIND,X'04'        SEE IF 'C' RATE                L09           
         BNZ   RT52                SKIP IF PARAM4 NOT 'C'         L09           
         B     RT54A5                                             L09           
*                                                                               
RT54A0   CLI   RATPASS,0                                          L09           
         BNE   RT54A5                                             L09           
         TM    PRBIND,X'04'                                       L09           
         BZ    RT52       FIRST PASS - ONLY LOOK FOR C RATE ELEM  L09           
*                                                                 L09           
RT54A5   CLI   PBUYKMED,C'N'                                                    
         BE    RT54A                                                            
         CLI   PRBOPEN,C'A'        CHK FOR PRODUCT RATE                         
         BL    RT54A                                                            
         CLC   PRBOPEN(3),PBUYKPRD                                              
         BNE   RT52                                                             
RT54A    CLI   PRBDESC,C'*'        IF SPECIAL RATE                              
         BNE   RT54B                                                            
         TM    PRBIND,X'20'        AND LINE RATE                                
         BZ    RT52                                                             
         B     RT55                USE AS LINE RATE                             
RT54B    DS    0H                                                               
         LA    RF,3                                                             
         CLI   PRBDESC,X'FF'                                                    
         BE    RT54D                                                            
         LA    RF,16                                                            
         CLI   PBUYKMED,C'N'         FOR NEWS                                   
         BNE   *+8                                                              
         LA    RF,7                COMPARE ONLY 8 CHARS            L07          
*                                  WAS LA   RF,5                   L07          
         OC    PRBDESC,=17C' '                                                  
RT54D    DS    0H                                                               
         EX    RF,*+12                                                          
         BNE   RT52                                                             
         B     *+10                                                             
         CLC   DUB(0),PRBDESC                                                   
RT55     DS    0H                                                               
         CLC   PRBDESC(1),SAVSPC   DONT USE LINE RATE                           
         BL    RT52                IF HAVE SPACE RATE                           
         CLC   PBUYKDAT,PRBDATE                                                 
         BL    RT52                                                             
         CLC   SAVDAT,PRBDATE                                                   
         BH    RT52                                                             
         MVC   SAVSPC(1),PRBDESC                                                
         MVC   SAVRIND,PRBIND                                                   
         MVC   SAVDAT,PRBDATE                                                   
         ST    R2,SAVR2                                                         
         B     RT52                                                             
RT56     EQU   *                                                                
         CLI   PARAM4,C'C'             SEE IF C RATE               L09          
         BNE   RT56D                                               L09          
         OC    SAVR2,SAVR2             RATE FOUND                  L09          
         BNZ   RT56D                                               L09          
         CLI   RATPASS,1       SEE IF I'VE DONE SECOND PASS        L09          
         BE    RT56D                                               L09          
         MVI   RATPASS,1        DO SECOND PASS                     L09          
         B     RAT51C           ACCEPTING NON C RATE ELEMS        L09           
*                                                                               
RT56D    L     R2,SAVR2                                                         
         LTR   R2,R2                                                            
         BZ    RT59                                                             
         CLI   PRBDESC,X'FF'                                                    
         BNE   RAT57                                                            
         CP    PBDREG,=P'0'                                                     
         BNE   *+10                                                             
         ZAP   PBDREG,PRBDESC+4(3)      NO. REGULAR                             
         CP    PBDILLUM,=P'0'                                                   
         BNE   *+10                                                             
         ZAP   PBDILLUM,PRBDESC+7(3)    NO. ILLUM                               
*                                                                               
RAT57    DS    0H                                                               
         CP    PBDCOS,=P'0'                                                     
         BNE   RAT570                                                           
         ZAP   PBDCOS,PRBRATE                                                   
**NEW 4/27/88                                                                   
         TM    PRBIND,X'10'        SEE IF NET RATE                  L03         
         BZ    *+8                                                  L03         
         MVI   PBDCTYP,C'N'        SET NET RATE INPUT               L03         
**NEW 4/27/88                                                                   
         TM    PRBIND,X'02'        SEE IF S TYPE RATE               L04         
         BZ    NOTSTYPE                                             L04         
         ZAP   PBDACP,=P'1'        AC LOOK-UP OF ZERO               L08         
*                                  WILL BE RESET TO P'0'            L08         
         MVI   PBDCOSIN,C'S'       COST INDICATOR                   L04         
         B     NOTCTYPE                                                         
NOTSTYPE DS    0H                                                   L04         
         TM    PRBIND,X'04'        SEE IF C TYPE RATE               L05         
         BZ    NOTCTYPE                                             L05         
         MVI   PBDCOSIN,C'C'       COST INDICATOR                   L05         
*                                  GETINS WILL SET GROSS TO AGYCOM  L05         
*                                  AND CD TO ZERO                   L05         
NOTCTYPE DS    0H                                                   L05         
*                                                                   L05         
         OI    LOOKIND,X'80'                                                    
*                                                                               
RAT570   CLI   PBUYKMED,C'N'                                                    
         BNE   RAT58                                                            
RAT57A   DS    0H                                                               
         MVI   PBDCOSTY,C'T'                                                    
*                                                                               
*                                  LINEAGE LOOKUP                               
RAT57A2  DS    0H                                                               
         CLI   PBUYKMED,C'N'                                                    
         BNE   PREM                                                             
         CP    PBDUNITS,=P'0'                                                   
         BNE   RAT57J                                                           
         MVC   DUB(17),PBDSPACE                                                 
         OC    DUB(17),=17C' '                                                  
*                                                                               
         LA    R2,PUBREC+33                                                     
         MVI   ELCOD,X'40'                                                      
RAT57B   DS    0H                                                               
         BAS   RE,NXTEL                                                         
         BL    *-4                                                              
         BE    RAT57D                                                           
         CLI   0(R2),0                                                          
         BE    RAT57G                                                           
         B     RAT57B                                                           
*                                                                               
RAT57D   DS    0H                                                               
         USING PUBCLELM,R2                                                      
         OC    PUBCLSPC,=17C' '                                                 
         CLC   PUBCLSPC,DUB                                                     
         BNE   RAT57B                                                           
         MVC   DUB(2),PUBCLLNS                                                  
         LH    R0,DUB                                                           
         CVD   R0,DUB                                                           
         ZAP   PBDUNITS,DUB                                                     
         OI    LOOKIND,X'10'            SET LOOKED UP LINES                     
*                                                                               
         B     RAT57J                                                           
*                                                                               
RAT57G   DS    0H                  NO EQUV LINES (IGNORE)                       
*                                                                               
RAT57J   DS    0H                                                               
         TM    SAVRIND,X'20'                                                    
         BZ    RAT58                                                            
*                                  HAVE UNIT RATE                               
         ZAP   DUB,PBDCOS                                                       
         MP    DUB,PBDUNITS                                                     
         AP    DUB,=P'500'                                                      
         MVO   DUB,DUB(6)                                                       
         ZAP   PBDCOS,DUB                                                       
*                                                                               
*                                                                               
RAT58    DS    0H                                                               
         B     PREM                                                             
RT59     EQU   *                                                                
         B     RT2                                                              
RT59B    DS    0H                                                               
         MVI   ERR,RATERR                                                       
         B     ERROR                                                            
         DROP  R2                                                               
         SPACE 3                                                                
*                                  OUTDOOR                                      
RAT70    DS    0H                                                               
         MVC   DUB(17),=17C' '                                                  
         CP    PBDSHOW,=P'0'                                                    
         BE    RAT72                                                            
         MVC   DUB(4),PBDSPACE                                                  
         B     RAT51                                                            
*                                  SHOW = 0, USE 1ST COMMENT                    
RAT72    DS    0H                                                               
         CP    PBDCOS,=P'0'                                                     
         BNE   PREM                                                             
         LA    R2,PBUYREC+33                                                    
         MVI   ELCOD,X'66'                                                      
RAT72B   DS    0H                                                               
         BAS   RE,NXTEL                                                         
         BE    RAT73                                                            
         CLI   0(R2),0                                                          
         BE    RT59B                                                            
         B     RAT72B                                                           
RAT73    DS    0H                                                               
         SR    RF,RF                                                            
         IC    RF,1(R2)                                                         
         CLI   1(R2),19                                                         
         BNH   *+8                                                              
         LA    RF,19               17 CHAR MAX                                  
         SH    RF,=H'3'                                                         
         EX    RF,*+8                                                           
         B     RAT51                                                            
         MVC   DUB(0),2(R2)                                                     
*                                                                               
         EJECT                                                                  
*                                  PREMIUM LOOKUP                               
         SPACE 2                                                                
PREM     CLI   WSJIND,1                                                         
         BNE   PR2                                                              
         MVI   WSJIND,2            SECOND PASS                                  
         MVC   ERATE,PBDCOS        SAVE RATE FOR EDITION RATE CODE              
         MVC   ERCODE,PBDRCODE     SAVE EDTION RATE CODE                        
*                                                                               
         MVC   ECTYP,PBDCTYP    SAVE NET RATE INDICATOR          L06            
         MVC   ECOSIN,PBDCOSIN  SAVE 'S' OR 'C' RATE INDICATORS  L06            
         MVI   PBDCTYP,0                                         L06            
         MVI   PBDCOSIN,C' '                                     L06            
*                                                                               
         MVC   PBDRCODE,NRCODE     TRY AND FIND NATIONAL RATE                   
         MVC   PBDUNITS,COMUNITS   SET TO COMMON NAT UNITS                      
         ZAP   PBDCOS,=P'0'        TO FORCE LOOK-UP IN RT2                      
         B     RAT3                                                             
*                                                                               
PR2      DS    0H                                                               
         CLI   WSJIND,2                                                         
         BNE   PR3                                                              
*                                                                               
         CLC   PBDCTYP,ECTYP    RATE CODES MUST BE SAME TYPE     L06            
         BNE   WSJERR                                            L06            
         CLC   PBDCOSIN,ECOSIN                                   L06            
         BNE   WSJERR                                            L06            
         B     PR2B                                              L06            
WSJERR   MVI   ERR,RATERR            SEND RATE NOT FOUND ERROR   L06            
         B     ERROR                                             L06            
*                                                                               
PR2B     MVC   PBDRCODE,ERCODE       RESTORE RATE CODE                          
         MVC   PBDUNITS,EUNITS       AND TOTAL UNITS                            
         L     R2,AWSJEL           SET EDITION UNIT COST IN PWSJELEM            
         USING PWSJELD,R2                                                       
         ZAP   PWSJECOS,ERATE                                                   
         ZAP   PWSJNCOS,PBDCOS       NATION UNIT RATE                           
*                                                                               
         DROP  R2                                                               
*                                                                               
*                           NOW CALCULATE TOTAL COST OF BUY BY                  
*                           MULTIPLYING EXCESS LINES X ERATE                    
*                           AND ADDING TO COMMON LINES X NAT RATE               
*                                                                               
         ZAP   P11,COMUNITS                                                     
         ZAP   DUB2,PBDCOS     NOW HAS NATIONAL RATE                            
         BAS   RE,GETCOST                                                       
         ZAP   PBDCOS,DUB                                                       
         ZAP   P11,EUNITS                                                       
         SP    P11,COMUNITS    TO GET EXCESS UNITS                              
         CP    P11,=P'0'                                                        
         BE    PR2D                                                             
         ZAP   DUB2,ERATE      NOW HAS EXCESS RATE                              
         BAS   RE,GETCOST                                                       
         AP    PBDCOS,DUB                                                       
PR2D     MVI   PBDCOSTY,C'T'   MUST SET TO TOTAL COST                           
PR3      CLI   PBDCL,0                                                          
         BE    DATLK                                                            
         CP    PBDPRCOS,=P'0'                                                   
         BNE   DATLK                                                            
         LA    R2,PUBREC+33                                                     
*                                  TRANSLATE 1 BYTE CODE TO 3 BYTE CODE         
         LA    R3,PTAB                                                          
         LH    R4,0(R3)                                                         
         LA    R5,PTABX-1                                                       
         LA    R3,6(R3)                                                         
         CLC   PBDCL,0(R3)                                                      
         BE    PR4                                                              
         BXLE  R3,R4,*-10                                                       
         MVI   ERR,PRMERR          CANT FIND PREM CODE                          
         B     ERROR                                                            
PR4      EQU   *                                                                
         MVI   ELCOD,X'60'         PREM ELEM                                    
         CLI   0(R2),X'60'                                                      
         BE    PR8                                                              
PR6      BAS   RE,NXTEL                                                         
         BL    *-4                                                              
         BE    PR8                                                              
         CLI   0(R2),X'61'                                                      
         BE    PR6                                                              
PR6A     EQU   *                                                                
         MVI   ERR,PRMERR2         CANT FIND PREM                               
         B     ERROR                                                            
*                                  HAVE PREM ELEM                               
PR8      EQU   *                                                                
         USING PUBPRMEL,R2                                                      
         CLC   PUBPCOD,1(R3)       CHECK PREM TYPE                              
         BNE   PR6                                                              
         CLC   PBUYKDAT,PUBPSTRT   CHECK DATES                                  
         BL    PR6                                                              
         MVC   METH,PUBPTYPC       SAVE METHOD                                  
         CLI   METH,0                                                           
         BE    PR6A                                                             
         ZAP   WMIN,PUBPMINC       SAVE MINIMUM CHARGE                          
         ZAP   DUB,PBDUNITS                                                     
         MVC   ELCOD,PBDUIND       SAVE PBDUIND                                 
         OI    PBDUIND,X'40'       INSURE UPPER CASE                            
         CLI   PBDUIND,C'I'        ADJUST FOR INCHES VS LINES                   
         BNE   *+10                                                             
         MP    DUB,=P'14'                                                       
         MVC   PBDUIND,ELCOD       RESTORE PBDUIND                              
         TM    METH,X'08'                                                       
         BZ    PR8B                                                             
         AP    DUB,=P'7'                                                        
         DP    DUB,=P'14'                                                       
         ZAP   DUB,DUB(6)                                                       
PR8B     DS    0H                                                               
         ZAP   WUNITS,DUB                                                       
         CLI   PBDUIND,X'89'       CHK FOR LOWER CASE I                         
         BNE   PR9                                                              
         AP    DUB,=P'50'       ROUND TO NEAREST INCH                           
         DP    DUB,=P'100'                                                      
         ZAP   WUNITS,DUB(6)                                                    
*                                                                               
PR9      DS    0H                                                               
         DROP  R2                                                               
         USING PUBPTBEL,R2                                                      
         MVI   ELCOD,X'61'         PREM TABLE ELEM                              
PR10     BAS   RE,NXTEL                                                         
         BNE   PR6A                CANT FIND                                    
         CP    WUNITS,PUBPTBLN                                                  
         BH    PR10                                                             
*                                  HAVE RIGHT TABLE ELEM                        
         ZAP   DUB3,PUBPTBCH                                                    
         TM    METH,X'80'          FLAT                                         
         BZ    PR12                                                             
         MVI   PBDPRCOS,X'0C'                                                   
         AP    DUB3,=P'500'                                                     
         MVO   PBDPRCOS,DUB3(6)                                                 
         ZAP   PBDCOS,=P'0'                                                     
         B     PR20                                                             
PR12     TM    METH,X'40'          BW + FLAT                                    
         BZ    PR14                                                             
         MVI   PBDPRCOS,X'0C'                                                   
         AP    DUB3,=P'500'                                                     
         MVO   PBDPRCOS,DUB3(6)                                                 
         B     PR20                                                             
PR14     TM    METH,X'20'          BW + PCT                                     
         BZ    PR16                                                             
         ZAP   DUBDUB,PBDCOS                                                    
         CLI   PBDCOSTY,C'U'                                                    
         BNE   PR14A                                                            
         MP    DUBDUB,WUNITS     GROSS UP COST                                  
         AP    DUBDUB,=P'500'                                                   
         MVO   DUBDUB,DUBDUB(14)                                                
PR14A    MP    DUBDUB,PUBPTBCH                                                  
         AP    DUBDUB,=P'50000'                                                 
         MVO   PBDPRCOS,DUBDUB(13)                                              
         B     PR20                                                             
*                                                                               
PR16     ZAP   DUBDUB,DUB3       LINE RATE                                      
         MP    DUBDUB,WUNITS     BW + LINE                                      
         AP    DUBDUB,=P'500'    ROUNDING                                       
         MVO   PBDPRCOS,DUBDUB(14)                                              
*                                                                               
PR20     CP    WMIN,=P'0'          IF MINCHARGE = 0                             
         BE    PRX                 DONT TEST                                    
         CP    WMIN,PBDPRCOS       USE LARGER                                   
         BNH   PRX                                                              
         ZAP   PBDPRCOS,WMIN                                                    
PRX      EQU   *                                                                
         OI    LOOKIND,X'20'       SET IND                                      
         DROP  R2                                                               
         EJECT                                                                  
*                                  PAYABLE & BILLABLE DATES                     
         SPACE 2                                                                
DATLK    EQU   *                                                                
         L     RF,ADDAY            V(ADDAY)                                     
DA2      EQU   *                                                                
*                                  FIND PUBGENEL                                
         LA    R2,PUBREC+33                                                     
         SR    R0,R0                                                            
DA4      IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),X'20'                                                      
         BE    DA6                                                              
         CLI   0(R2),0                                                          
         BNE   DA4                                                              
         LA    R2,DUMGENEL                                                      
         USING PUBGENEL,R2                                                      
         ZAP   PUBCDDAS,=P'0'                                                   
         ZAP   PUBCLMO,=P'0'                                                    
         ZAP   PUBCLDA,=P'0'                                                    
***MAT***                                                                       
         ZAP   PUBMCLMO,=P'0'                    MAT CLOSING MONTH              
         ZAP   PUBMCLDA,=P'0'                    MAT CLOSING DAY                
***MAT***                                                                       
         ZAP   PUBOSMO,=P'0'                                                    
         ZAP   PUBOSDA,=P'0'                                                    
         ZAP   PUBPAYMO,=P'0'                                                   
         ZAP   PUBPAYDA,=P'0'                                                   
DA6      EQU   *                                                                
         ST    R2,SAVR2                                                         
         OC    PBDPDATE,PBDPDATE                                                
         BNZ    DA20                                                            
         CLI   PBUYKMED,C'N'                                                    
         BNE   DA6B                                                             
*                                  FOR NEWSPAPER USE 1ST OF NEXT MONTH          
         LH    R1,PBUYKDAT                                                      
         LA    R1,1(R1)                                                         
         CLI   PBUYKDAT+1,12                                                    
         BNE   *+8                                                              
         LA    R1,244(R1)                                                       
         STH   R1,DUB                                                           
         MVC   PBDPDATE(2),DUB                                                  
         MVI   PBDPDATE+2,1                                                     
         B     DA16                                                             
*                                  MAGAZINES                                    
DA6B     EQU   *                                                                
         LA    R3,PBUYKDAT                                                      
         LA    R4,PUBPAYMO                                                      
         LA    R5,PBDPDATE                                                      
         BAS   RE,DATCOMP                                                       
         SPACE 2                                                                
DA16     EQU   *                                                                
*                                  ADD DAYS TO PAY DATE                         
         ZAP   DUB4,PUBCDDAS                                                    
         BNZ   DA17                                                             
         CLI   PBUYKMED,C'N'                                                    
         BNE   DA20                                                             
         ZAP   DUB4,=P'10'                                                      
DA17     EQU   *                                                                
         LA    R5,PBDPDATE                                                      
         BAS   RE,CVEBC                                                         
         CVB   R0,DUB4                                                          
         CLC   DUB+4(2),=C'01'                                                  
         BNE   *+6                                                              
         BCTR  R0,R0               IF ADDING TO 1ST, USE DAYS -1                
         GOTO1 (RF),DMCB,DUB,DUB3,(R0)                                          
         SPACE 1                                                                
         CLC   DUB+2(2),DUB3+2     CHECK MONTH CHANGE                           
         BE    DA18                NO                                           
         PACK  DUB,DUB+4(2)                                                     
         AP    DUB,DUB4                                                         
         CP    DUB,=P'30'                                                       
         BL    DA18                                                             
         CP    DUB,=P'32'                                                       
         BH    DA18                                                             
*                                  ADJUST TO EOM                                
         SR    R1,R1                                                            
         IC    R1,PBDPDATE+1                                                    
         LA    R1,MOTAB-1(R1)                                                   
         MVC   PBDPDATE+2(1),0(R1)                                              
         B     DA20                                                             
DA18     EQU   *                                                                
         MVC   DUB,DUB3                                                         
         BAS   RE,CVBIN            BACK TO BINARY                               
         B     DA20                                                             
         SPACE 3                                                                
DA20     EQU   *                   OS DATE                                      
         CLI   PBUYKMED,C'N'                                                    
         BE    DA20H                                                            
         OC    PBDSDATE,PBDSDATE                                                
         BNZ   DA20D                                                            
         CP    PUBOSMO,=P'0'                                                    
         BNE   DA20B                                                            
         CP    PUBOSDA,=P'0'                                                    
         BE    DA20D               NO LOOKUP                                    
DA20B    EQU   *                                                                
         LA    R3,PBUYKDAT                                                      
         LA    R4,PUBOSMO                                                       
         LA    R5,PBDSDATE                                                      
         BAS   RE,DATCOMP                                                       
*                                  CLOSING DATE                                 
DA20D    DS    0H                                                               
         OC    PBDCDATE,PBDCDATE                                                
         BNZ   DA20H                                                            
         CP    PUBCLMO,=P'0'                                                    
         BNE   DA20E                                                            
         CP    PUBCLDA,=P'0'                                                    
         BE    DA20H                                                            
*                                                                               
DA20E    DS    0H                                                               
         LA    R3,PBUYKDAT                                                      
         LA    R4,PUBCLMO                                                       
         LA    R5,PBDCDATE                                                      
         BAS   RE,DATCOMP                                                       
         SPACE 2                                                                
***MAT***                                                                       
*                             MAT CLOSING DATE BOTH NEWS AND MAGS               
DA20H    DS    0H                                                               
         OC    PBDMDATE,PBDMDATE                                                
         BNZ   DA20I                                                            
         CP    PUBMCLMO,=P'0'                                                   
         BNE   DA20H5                                                           
         CP    PUBMCLDA,=P'0'                                                   
         BE    DA20I               NO LOOK-UP                                   
*                                                                               
DA20H5   DS    0H                                                               
         LA    R3,PBUYKDAT                                                      
         LA    R4,PUBMCLMO                                                      
         LA    R5,PBDMDATE                                                      
         BAS   RE,DATCOMP                                                       
         DROP  R2                                                               
***MAT***                                                                       
         SPACE 2                                                                
*                                  BILLABLE DATE                                
DA20I    EQU   *                                                                
         OC    PBDBDATE,PBDBDATE   TEST BILLABLE DATE                           
         BNZ   DAEXT               ALREADY HAVE                                 
         L     R4,PARAM4           A(BIL PROF)                                  
         LA    R2,PBUYKDAT         INSERT DATE                                  
         CLI   0(R4),C'0'                                                       
         BE    DA20K                                                            
         LA    R2,PBDPDATE         PAY DATE                                     
         CLI   0(R4),C'1'                                                       
         BE    DA20K                                                            
         LA    R2,PBDSDATE         OS DATE                                      
         CLI   0(R4),C'2'                                                       
         BE    DA20K                                                            
         LA    R2,PBDCDATE                                                      
         CLI   0(R4),C'3'                                                       
         BE    DA20K                                                            
DA20J    EQU   *                                                                
         MVI   ERR,DATERR                                                       
         B     ERROR                                                            
DA20K    EQU   *                                                                
         OC    PBDBDATE,0(R2)                                                   
         BZ    DA20J                                                            
         CLI   1(R4),C'0'          NO MONTHS                                    
         BE    DA30                                                             
         MVC   DUB(1),1(R4)                                                     
         NI    DUB,X'0F'                                                        
         SR    R5,R5                                                            
         IC    R5,DUB              NUMBER OF MONTHS UP OR BACK                  
         CLI   1(R4),C'0'                                                       
         BL    DA23                                                             
*                                  BILL PROF +1 NUMERIC                         
*                                  BACK UP N MONTHS                             
DA21     EQU   *                                                                
         SR    R2,R2                                                            
         IC    R2,PBDBDATE+1                                                    
         BCT   R2,DA22                                                          
         SR    R3,R3                                                            
         IC    R3,PBDBDATE                                                      
         BCTR  R3,R0               DECR YR                                      
         STC   R3,PBDBDATE                                                      
         LA    R2,12               DECEMBER                                     
DA22     EQU   *                                                                
         STC   R2,PBDBDATE+1                                                    
         BCT   R5,DA21                                                          
         B     DA30                                                             
*                                  BILL PROF +1 ALPHA                           
*                                  ADD 'N' MONTHS                               
DA23     EQU   *                                                                
         CLI   1(R4),C'J'          OR SUBTRACT N DAYS IF J+                     
         BNL   DA27                                                             
*                                                                               
         CLI   PBDBDATE+1,12                                                    
         BE    DA24                                                             
         IC    R2,PBDBDATE+1                                                    
         LA    R2,1(R2)            BUMP MONTH                                   
         STC   R2,PBDBDATE+1                                                    
         B     DA25                                                             
DA24     MVI   PBDBDATE+1,1                                                     
         IC    R2,PBDBDATE                                                      
         LA    R2,1(R2)            BUMP YEAR                                    
         STC   R2,PBDBDATE                                                      
DA25     BCT   R5,DA23                                                          
         B     DA30                                                             
*                                                                               
DA27     DS    0H                  SUBTRACT N DAYS                              
         SR    R2,R2                                                            
         IC    R2,BDCLIST-1(R5)    GET DAYS FROM LIST                           
         LCR   R2,R2                                                            
         LA    R5,PBDBDATE                                                      
         BAS   RE,CVEBC            CONVERT DATE TO EBCDIC                       
         GOTO1 (RF),DMCB,DUB,DUB,(R2)     ADDAY                                 
         BAS   RE,CVBIN            DATE BACK TO BINARY                          
         B     DA30                                                             
*                                                                               
BDCLIST  DC    AL1(5,7,10,11,14,15,20,25,30)  J-R                               
         SPACE 1                                                                
*                                  CHECK ADJUSTMENT FOR 'WEEKLIES'              
DA30     DS    0H                                                               
         CLI   2(R4),C'0'                                                       
         BNE   DA40                NO ADJUSTMENT                                
         L     R2,SAVR2                                                         
         USING PUBGENEL,R2                                                      
         CLI   PBUYKMED,C'N'                                                    
         BE    DA40                NOT FOR NEWSPAPERS                           
*                                  TEST PUB FREQ                                
         CLC   PUBMFREQ,=C'W '                                                  
         BE    DA31                                                             
         CLC   PUBMFREQ,=C'BW'                                                  
         BE    DA31                                                             
         CLC   PUBMFREQ,=C'SM'                                                  
         BE    DA31                                                             
         CLC   PUBMFREQ,=C'SW'                                                  
         BE    DA31                                                             
         B     DA40                                                             
DA31     EQU   *                                                                
         CLI   PBDBDATE+1,12                                                    
         BE    DA32                                                             
         IC    R1,PBDBDATE+1       BUMP BILL MONTH BY 1                         
         LA    R1,1(R1)                                                         
         STC   R1,PBDBDATE+1                                                    
         B     DA40                                                             
DA32     EQU   *                                                                
         MVI   PBDBDATE+1,1                                                     
         IC    R1,PBDBDATE         BUMP YR BY 1                                 
         LA    R1,1(R1)                                                         
         STC   R1,PBDBDATE                                                      
*                                  CHECK VS HIGH DAY IN MONTH                   
DA40     DS    0H                                                               
         SR    R1,R1                                                            
         IC    R1,PBDBDATE+1       MONTH                                        
         LA    R1,MOTAB-1(R1)                                                   
         CLC   PBDBDATE+2(1),0(R1)                                              
         BNH   *+10                                                             
         MVC   PBDBDATE+2(1),0(R1)                                              
         SPACE 1                                                                
DAEXT    EQU   *                                                                
*                                                                               
         CLI   LOOKIND,0          SEE IF I LOOKED-UP ANY DATA                   
         BE    EXIT               THAT IS RECORDED IN PBDRLIND                  
*                          IF NOT LEAVE PBDRLDT AND PRDRLIND ALONE              
*                                                                               
         CLC   PBDRLDT,TODAY       SEE IF SAME AS TODAY                         
         BNE   DAEXT5                                                           
         OC    PBDRLIND,LOOKIND    OR BITS                                      
         B     EXIT                                                             
*                                                                               
DAEXT5   MVC   PBDRLDT,TODAY       SET NEW DATE                                 
         NI    PBDRLIND,X'0F'      SET OFF 80,40,20,10                          
         OC    PBDRLIND,LOOKIND                                                 
         B     EXIT                                                             
         SPACE 3                                                                
DOELCODE MVI   ELCOD,X'20'         DEFAULT TO NORMAL RATE          L01          
*                                                                  L01          
         CLI   PARAM3,C'L'         WERE LOWER RATES REQUESTED      L01          
         BNE   *+8                                                 L01          
         MVI   ELCOD,X'21'         LOOK FOR LOWER ELEMENTS         L01          
*                                                                  L01          
         CLI   PARAM3,C'H'         WERE HIGHER RATES REQUESTED     L01          
         BNE   *+8                                                 L01          
         MVI   ELCOD,X'22'         LOOK FOR HIGHR ELEMENTS         L01          
         BR    RF                                                               
         EJECT                                                                  
*                                                                  L01          
*          FROM GETINS     AT LEVEL 040 AS OF 07/09/84                          
*                     P11 HAS UNITS, DUB2 HAS RATE                              
*                     COST RETURNED IN DUB                                      
*                                                                               
GETCOST  NTR1                                                                   
         MP    P11,DUB2                                                         
         DP    P11,=P'1000'                                                     
         CP    P11+8(3),=P'0'      SEE IF NEGATIVE                              
         BL    GT3                                                              
         CP    P11+8(3),=P'500'    ROUNDING                                     
         BL    *+10                                                             
         AP    P11(8),=P'1'                                                     
         B     GT4                                                              
*                                                                               
GT3      CP    P11+8(3),=P'-500'                                                
         BH    GT4                                                              
         SP    P11(8),=P'1'                                                     
*                                                                               
GT4      DS    0H                                                               
         ZAP   DUB,P11(8)                                                       
         CLI   PBDUIND,X'89'       LOWER CASE I                                 
         BNE   GTX                                                              
*                                  MEANS UNITS TO 2 DECIMALS                    
*                                  MUST DIVIDE COST BY 100 TO GET CENTS         
         DP    DUB,=P'100'                                                      
         CP    DUB+6(2),=P'0'      SEE IF NEGATIVE                              
         BL    GT6                                                              
         CP    DUB+6(2),=P'50'                                                  
         BL    GT7                                                              
         AP    DUB(6),=P'1'                                                     
         B     GT7                                                              
*                                                                               
GT6      CP    DUB+6(2),=P'-50'                                                 
         BH    GT7                                                              
         SP    DUB(6),=P'1'                                                     
GT7      ZAP   DUB,DUB(6)                                                       
GTX      EQU   *                                                                
         XIT1                                                                   
         EJECT                                                                  
*                                  COMPUTE DATE BASED ON INPUT                  
*                                  DATE AND ALGORITHM                           
*                                  R3 = A(INPUT DATE)                           
*                                  R4 = A(ALGORITHM)                            
*                                  R5 = A(OUTPUT)                               
DATCOMP  NTR1                                                                   
         SPACE 1                                                                
         MVC   0(3,R5),0(R3)                                                    
         CP    0(2,R4),=P'0'       ALG0 MO                                      
         BNE   DC10                                                             
*                                  ALGO MO = 0                                  
         TM    2(R4),X'F0'         IS IT 'PLUS'NUMBER                           
         BZ    DC1                                                              
         NI    2(R4),X'0F'                                                      
         ZAP   DUB,2(2,R4)                                                      
         B     DC4                                                              
         SPACE                                                                  
DC1      ZAP   DUB,2(2,R4)         ALGO DAY                                     
         BM    DC4                 IF NEG SUBTRACT DAYS                         
         BZ    DC6                 IF 0 USE FOM                                 
*                                  IF POS                                       
         SPACE                                                                  
         CVB   R0,DUB              NO/JUST MOVE IT                              
         STC   R0,2(R5)                                                         
DC2      EQU   *                                                                
         SR    R1,R1                                                            
         IC    R1,1(R5)                                                         
         LA    R1,MOTAB-1(R1)                                                   
         CLC   2(1,R5),0(R1)       CHECK VS HI DAY IN MONTH                     
         BNH   *+10                                                             
         MVC   2(1,R5),0(R1)                                                    
         B     DCEXT                                                            
DC4      EQU   *                                                                
         CVB   R0,DUB                                                           
         BAS   RE,CVEBC            CV TO EBCDIC FOR ADDAY                       
         GOTO1 (RF),DMCB,DUB,DUB,(R0)                                           
         SPACE 1                                                                
         BAS   RE,CVBIN            BACK TO BINARY                               
         B     DCEXT                                                            
DC6      EQU   *                                                                
         MVI   2(R5),1             USE FOM                                      
         B     DCEXT                                                            
*                                  MONTH NOT ZERO                               
DC10     EQU   *                                                                
         SR    R6,R6                                                            
         IC    R6,1(R3)            MO                                           
         ZAP   DUB,0(2,R4)         ALGO MO                                      
         CVB   R0,DUB                                                           
         SR    R1,R1                                                            
         IC    R1,0(R3)            YR                                           
         AR    R6,R0                                                            
         BP    DC12                                                             
         BCTR  R1,R0               DECR YR                                      
         AH    R6,=H'12'                                                        
         BNP   *-6                                                              
         B     DC14                                                             
DC12     EQU   *                                                                
         CH    R6,=H'12'                                                        
         BNH   DC14                                                             
         LA    R1,1(R1)                                                         
         SH    R6,=H'12'                                                        
         B     DC12                                                             
DC14     EQU   *                                                                
         STC   R1,0(R5)                                                         
         STC   R6,1(R5)                                                         
         ZAP   DUB,2(2,R4)                                                      
         BNP   DC16                                                             
         CVB   R0,DUB                                                           
         STC   R0,2(R5)                                                         
         B     DC2                                                              
DC16     EQU   *                                                                
         MVI   2(R5),31            USE EOM                                      
         B     DC2                                                              
DCEXT    EQU   *                                                                
         XIT1                                                                   
         SPACE 3                                                                
CVEBC    EQU   *                                                                
         SR    R1,R1                                                            
         IC    R1,0(R5)                                                         
         CVD   R1,DUB2                                                          
         OI    DUB2+7,X'0F'                                                     
         UNPK  DUB(2),DUB2                                                      
         IC    R1,1(R5)                                                         
         CVD   R1,DUB2                                                          
         OI    DUB2+7,X'0F'                                                     
         UNPK  DUB+2(2),DUB2                                                    
         IC    R1,2(R5)                                                         
         CVD   R1,DUB2                                                          
         OI    DUB2+7,X'0F'                                                     
         UNPK  DUB+4(2),DUB2                                                    
         BR    RE                                                               
         SPACE 3                                                                
CVBIN    EQU   *                                                                
         PACK  DUB2,DUB(2)                                                      
         CVB   R1,DUB2                                                          
         STC   R1,0(R5)                                                         
         PACK  DUB2,DUB+2(2)                                                    
         CVB   R1,DUB2                                                          
         STC   R1,1(R5)                                                         
         PACK  DUB2,DUB+4(2)                                                    
         CVB   R1,DUB2                                                          
         STC   R1,2(R5)                                                         
         BR    RE                                                               
         EJECT                                                                  
*                                  CONTRACT INFO LOOKUP                         
CON      EQU   *                                                                
*                                                                   L02         
         MVC   ELCODE,PARAM2      MOVE ELEMENT CODE                 L02         
         OI    ELCODE,X'20'       DEFAULT IF PARAM2 = 0             L02         
*                           POSSIBLE COMBOS 20= CURRENT LEVEL       L02         
*                              21=LOWER     22=HIGHER               L02         
*                                                                   L02         
*  IF PARM3 HAS A VALUE DON'T CHANGE.  IF ZERO MODIFY BASED ON ELCODE 2         
*                                                                   L02         
         CLI   PARAM3,0                                             L02         
         BNE   NONO                                                 L02         
         CLI   ELCODE,X'22'   HIGHER                                L02         
         BNE   *+8                                                  L02         
         MVI   PARAM3,1       LOOKUP HIGER LEVEL RATES IN PUB       L02         
NONO     DS    0H                                                   L02         
         L     R3,PARAM4           A(OUTPUT)                                    
         ST    R3,NXTRBEL          WHERE TO PUT FIRST/NEXT ELEM                 
         MVI   0(R3),0                                                          
         MVI   NXTRBEL,0                                                        
*                                  SET MAX ELEMS                                
         ZIC   R1,PARAM4                                                        
         MVI   LSTRBEL,X'FF'                                                    
         LTR   R1,R1                                                            
         BZ    CR1                                                              
         LA    R0,RBLGTH                                                        
         MR    R0,R0                                                            
         A     R1,NXTRBEL                                                       
         ST    R1,LSTRBEL          SET MAX ELEMS ALLOWED                        
CR1      DS    0H                                                               
*                                                                               
         LA    R2,PCONREC+33                                                    
         CLC   ELCODE,0(R2)               SAME ELEMENT            L02           
         BE    CR4                                                              
CR2      DS    0H                                                               
*        MVI   ELCOD,X'20'                                        L02           
         MVC   ELCOD,ELCODE                                       L02           
         BAS   RE,NXTEL                                                         
         BE    CR4                                                              
         CLI   0(R2),0             EOR                                          
         BE    CR31                                                             
         B     CR2                                                              
CR4      DS    0H                                                               
         USING PRBELEM,R2                                                       
         OC    PRBRATE,PRBRATE                                                  
         BNZ   *+10                                                             
         ZAP   PRBRATE,=P'0'                                                    
         CP    PRBRATE,=P'0'       TEST HAVE RATE                               
         BE    CR4B                                                             
         L     R3,NXTRBEL                                                       
         CLC   NXTRBEL,LSTRBEL     TEST AREA FULL                               
         BL    *+12                                                             
         MVI   ERR,SIZERR                                                       
         B     ERROR                                                            
         MVC   0(RBLGTH,R3),0(R2)                                               
         LA    R3,RBLGTH(R3)                                                    
         ST    R3,NXTRBEL                                                       
         MVI   0(R3),0                                                          
         B     CR2                                                              
CR4B     DS    0H                                                               
         ZAP   SAVLEV,PRBLEVEL                                                  
         MVC   SAVRIND,PRBIND                                                   
         MVC   SAVSPC,PRBDESC                                                   
         MVC   SAVPCT,PRBPCT                                                    
         MVC   SAVLIND,PRBLIND                                                  
         BAS   RE,CRLOOK                                                        
         CLI   ERR,0                                                            
         BE    CR2                 NEXT RB ELEM                                 
         MVI   PRBIND,X'FF'        SET ELEM IN ERROR                            
         B     ERROR                                                            
         DROP  R2                                                               
         SPACE 3                                                                
*                                                                               
CRLOOK   NTR1                                                                   
         MVI   ERR,RATERR                                                       
         LA    R2,PUBREC+33                                                     
CR5      EQU   *                                                                
         CLI   0(R2),X'50'                                                      
         BE    CR8                                                              
CR6      DS    0H                                                               
         MVI   ELCOD,X'50'                                                      
         BAS   RE,NXTEL                                                         
         BL    *-4                                                              
         BE    CR8                                                              
         CLI   0(R2),X'51'                                                      
         BE    CR6                                                              
         B     CR30                NO MORE RATE ELEMS                           
CR8      EQU   *                                                                
         ST    R2,SAVELEM                                                       
         USING PUBRATEL,R2                                                      
         MVC   DUB(17),PUBRSPCE                                                 
         OC    DUB(17),=17C' '                                                  
         CLC   DUB(17),SAVSPC                                                   
         BNE   CR6                                                              
         CLC   PCONEND(3),PUBRSTRT                                              
         BL    CR6                                                              
         CLC   NXTRBEL,LSTRBEL     TEST AREA FULL                               
         BL    *+12                                                             
         MVI   ERR,SIZERR                                                       
         B     CRLOOKX                                                          
         L     R3,NXTRBEL                                                       
         USING PRBELEM,R3                                                       
*        MVI   PRBELEM,X'20'                                     L02            
         MVC   PRBELEM,ELCODE                                    L02            
         MVI   PRBELEM+1,RBLGTH                                                 
         MVC   PRBDATE,PUBRSTRT                                                 
         MVC   PRBLIND,SAVLIND                                                  
         MVC   PRBIND,SAVRIND                                                   
         MVC   PRBDESC,SAVSPC                                                   
         MVC   METH,PUBDRTYP                                                    
         ZAP   PRBOPEN,PUBRATE                                                  
         ZAP   PRBPCT,SAVPCT                                                    
         ZAP   PRBLEVEL,SAVLEV                                                  
         OI    PRBIND,X'40'        SET TOTAL RATE                               
         OI    PRBIND,X'80'        SET RATE FIXED                               
         CLC   SAVSPC(2),=C'R='     SEE IF RATE CODE                            
         BE    CR8C                 YES SET AS LINE/INCH RATE                   
*                                                                               
         CLI   PUBREC,C'N'          SEE IF NON-NEWSPAPERS                       
         BNE   CR8E                 WE NOW HAVE MAG RATES/DISCOUNTS             
*                                                                               
         CLC   SAVSPC(2),=C'* '       IF SPACE THEN NO LEVELS                   
         BH    CR9                                                              
CR8C     OI    PRBIND,X'20'        SET LINE RATE                                
         NI    PRBIND,X'BF'                                                     
CR8E     CP    SAVLEV,=P'0'                                                     
         BNZ   CR10                                                             
CR9      DS    0H                                                               
         ZAP   PRBRATE,PUBRATE                                                  
         ZAP   PRBPCT,SAVPCT                                                    
         BE    CR9B                                                             
         ZAP   DUBDUB,PUBRATE                                                   
CR9A     DS    0H                                                               
         MP    DUBDUB,PRBPCT                                                    
         AP    DUBDUB,=P'500'                                                   
         MVN   DUBDUB+13(1),DUBDUB+15                                           
         ZAP   PRBRATE,PRBOPEN                                                  
         SP    PRBRATE,DUBDUB(14)                                               
CR9B     DS    0H                                                               
         B     CR22                NEXT RATE ELEM                               
*                                                                               
*                                  LINE RATE LOOKUP                             
*                                                                               
*                                  FIND DISCOUNT ELEM                           
CR10     EQU   *                                                                
         XC    SAVR2,SAVR2                                                      
         MVI   ELCOD,X'51'                                                      
CR12     DS    0H                                                               
         BAS   RE,NXTEL                                                         
         BNE   CR18                                                             
         USING PUBDSCEL,R2                                                      
         CP    SAVLEV,PUBDSCLV                                                  
         BL    CR16                                                             
         CLI   PARAM3,1            CHECK LOOKING FOR HIGHER                     
         BE    CR18                                                             
CR14     EQU   *                                                                
         ZAP   PRBRATE,PUBDSCRT                                                 
         ZAP   PRBLEVEL,PUBDSCLV                                                
         ZAP   PRBPCT,=P'0'                                                     
         TM    METH,X'40'          PCT DISC. - NOT LINE RATE                    
         BZ    CR22                                                             
         ZAP   DUBDUB,PUBDSCRT                                                  
         AP    DUBDUB,=P'500'                                                   
         MVO   DUBDUB,DUBDUB(14)                                                
         ZAP   PRBPCT,DUBDUB+13(3)                                              
         ZAP   DUBDUB,PRBOPEN                                                   
         MP    DUBDUB,PUBDSCRT                                                  
         AP    DUBDUB,=P'5000000'                                               
         MVO   DUBDUB,DUBDUB(12)                                                
         ZAP   PRBRATE,PRBOPEN                                                  
         SP    PRBRATE,DUBDUB                                                   
         B     CR22                                                             
CR16     EQU   *                                                                
         ST    R2,SAVR2            SAVE A(ELEM)                                 
         B     CR12                GET NEXT                                     
CR18     EQU   *                                                                
         CLI   PARAM3,1            CHECK LOOKING FOR HIGHER                     
         BNE   CR20                                                             
         L     R2,SAVR2            RESTORE HIGHER LEVEL                         
         LTR   R2,R2               IF THERE                                     
         BNZ   CR14                                                             
CR20     EQU   *                                                                
*                                  IF NO DISCOUNT FOUND AND PCT                 
*                                  GEVEN THEN LEAVE INPUT LVL AS IS             
*                                  APPY PCT DISCOUNT TO OPEN RATE               
         CP    PRBPCT,=P'0'                                                     
         BE    CR21                                                             
         ZAP   DUBDUB,PRBOPEN                                                   
         B     CR9A                                                             
CR21     DS    0H                                                               
         ZAP   PRBRATE,PRBOPEN                                                  
         ZAP   PRBLEVEL,=P'0'                                                   
         OC    SAVR2,SAVR2                                                      
         BNZ   *+8                                                              
         OI    PRBIND,X'01'        FLAT IND                                     
CR22     EQU   *                                                                
         MVI   ERR,0                                                            
         MVC   DUB(3),PRBDATE                                                   
         LA    R3,RBLGTH(R3)       BUMP TO NEXT SLOT                            
         ST    R3,NXTRBEL                                                       
         MVI   0(R3),0                                                          
         CLC   DUB(3),PCONSTRT    DATE I JUST ADDED VS. START OF CONT           
         BNH   CR30                NH - DONT GET ANY MORE                       
         L     R2,SAVELEM                                                       
         B     CR6                                                              
CR30     DS    0H                                                               
CRLOOKX  DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
CR31     DS    0H                                                               
         L     R3,PARAM4                                                        
         SR    R4,R4                                                            
         CLI   0(R3),0                                                          
         BE    *+16                                                             
         LA    R4,1(R4)                                                         
         LA    R3,RBLGTH(R3)                                                    
         B     *-16                                                             
*                                                                               
         L     R1,SAVR1                                                         
         STC   R4,12(R1)           RETURN NO OF ELEMS                           
CR40     EQU   *                                                                
CRX      EQU   *                                                                
         B     EXIT                                                             
         DROP  R2                                                               
         DROP  R3                                                               
         SPACE 3                                                                
ERROR    EQU   *                                                                
EXIT     EQU   *                                                                
         L     R1,SAVR1                                                         
         MVC   0(1,R1),ERR         SET ERROR                                    
         XMOD1 1                                                                
         EJECT                                                                  
*                   BUMP TO NEXT ELEM AND TEST AGAINST ELCOD                    
*                   IF UNEQUAL RETURN                                           
NXTEL    EQU   *                                                                
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    *+12                                                             
         CLC   0(1,R2),ELCOD       SET CC                                       
         BR    RE                                                               
         LTR   R2,R2               SET CC                                       
         BR    RE                                                               
         SPACE 3                                                                
*                   BUMP TO NEXT ELEM AND TEST AGAINST ELCOD                    
*                   IF UNEQUAL KEEP SEARCHING                                   
NEXTEL   EQU   *                                                                
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLC   ELCOD,0(R2)                                                      
         BCR   8,RE                                                             
         CLI   0(R2),0                                                          
         BNE   NEXTEL                                                           
         LTR   R2,R2               SET CC                                       
         BR    RE                                                               
ELCODE   DS    CL1                                                              
*                   PREM CODE TRANSLATE TABLE,1 BYTE IN,3 OUT                   
         CNOP  2,4                                                              
PTAB     EQU   *                                                                
         DC    H'4'                                                             
         DC    A(PTABX-1)                                                       
         DC    C'11C '                                                          
         DC    C'22C '                                                          
         DC    C'33C '                                                          
         DC    C'44C '                                                          
PTABX    EQU   *                                                                
         SPACE 3                                                                
         LTORG                                                                  
         SPACE 3                                                                
MOTAB    DC    AL1(31,28,31,30,31,30,31,31,30,31,30,31)                         
*                   DSECT TO COVER WORK AREA                                    
         SPACE 2                                                                
WORKD    DSECT                                                                  
WORK     DS    0C                                                               
         DS    0F                                                               
PARAMS   DS    0CL24                                                            
PARAM1   DS    F                                                                
PARAM2   DS    F                                                                
PARAM3   DS    F                                                                
PARAM4   DS    F                                                                
PARAM5   DS    F                                                                
PARAM6   DS    F                                                                
ADDAY    EQU   PARAM5                                                           
DATCON   EQU   PARAM6                                                           
DUBDUB   DS    0CL16                                                            
DUB      DS    D                                                                
DUB2     DS    D                                                                
DUB3     DS    D                                                                
DUB4     DS    D                                                                
SAVR1    DS    F                                                                
SAVR2    DS    F                                                                
SAVLEV   DS    PL5                                                              
SAVPCD   DS    PL2                                                              
SAVRIND  DS    X                                                                
SAVLIND  DS    X                                                                
DMCB     DS    6F                                                               
WLEV     DS    CL5                                                              
TODAY    DS    CL3                                                              
WUNITS   DS    PL5                                                              
ELCOD    DS    CL1                                                              
RATPASS  DS    CL1                                           L09                
ERR      DS    CL1                                                              
METH     DS    CL1                                                              
WMIN     DS    CL5                                                              
SAVDAT   DS    CL3                                                              
WSJIND   DS    CL1        SET TO X'01' FOR WSJ BUYS THEN X'02' FOR              
*                         PASS 2                                                
COMUNITS DS    PL3        WSJ COMMON NAT UNITS FROM WSJ ELEM                    
NRCODE   DS    CL3        NAT RATE CODE FROM WSJ ELEM                           
EUNITS   DS    PL3        TOTAL UNITS WSJ BUYS                                  
ERCODE   DS    CL3        EDITION RATE CODE FOR EXCESS UNITS                    
ERATE    DS    PL5        EDITION RATE FOR EXCESS UNITS                         
ECTYP    DS    CL1        EDITION RATE PBDCTYP - NET RATE IND      L06          
ECOSIN   DS    CL1        EDITION RATE PBDCOSIN - 'S' OR 'C' RATE  L06          
*                                                                               
AWSJEL   DS    A          SAVED ADDR OF WSJ ELEM                                
P11      DS    PL11                                                             
DUMGENEL DS    XL50                                                             
         ORG   DUMGENEL                                                         
SAVSPC   DS    CL17                                                             
SAVPCT   DS    PL3                                                              
NXTRBEL  DS    F                                                                
LSTRBEL  DS    F                                                                
SAVELEM  DS    A                                                                
         ORG                                                                    
CDACLK   DS    CL1     SET TO X'01' IF CD, X'02' ID AC IS LOOKED UP             
LOOKIND  DS    CL1                                                              
*                                                                               
WORKL    EQU   *-WORK                                                           
         SPACE 3                                                                
*                   ERROR NUMBER EQUATES                                        
RATERR   EQU   130                 CANNOT FIND RATES                            
LEVERR   EQU   131                 CANNOT FIND DISCOUNT LEVEL                   
CDERR    EQU   132                 CANNOT FIND CASH DISCOUNT                    
PRMERR   EQU   133                 CANT FIND RPEM                               
PRMERR2  EQU   133                 CANT FIND PREM RATES                         
DATERR   EQU   134                                                              
OUTERR   EQU   218                                                              
SIZERR   EQU   208                                                              
         SPACE 2                                                                
RBLGTH   EQU   42                                                               
         EJECT                                                                  
*                   PUBREC DSECT                                                
PUBRECD  DSECT                                                                  
       ++INCLUDE PUBREC                                                         
*                                                                               
*                                                                               
       ++INCLUDE PUBGENEL                                                       
*                                                                               
       ++INCLUDE PUBRATEL                                                       
*                                                                               
       ++INCLUDE PUBDSCEL                                                       
*                                                                               
       ++INCLUDE PUBPRMEL                                                       
*                                                                               
       ++INCLUDE PUBPTBEL                                                       
*                                                                               
         SPACE 2                                                                
*                                                                               
       ++INCLUDE PPGENCLE                                                       
         EJECT                                                                  
*                                                                               
PWSJELD  DSECT                                                                  
       ++INCLUDE PWSJELEM                                                       
PTAXELD  DSECT                                                                  
       ++INCLUDE PUBTAXEL                                                       
PCATELED DSECT                                                                  
       ++INCLUDE PCATELEM                                                       
*                                                                               
*                   BUY REC DSECT                                               
PBUYRECD DSECT                                                                  
       ++INCLUDE PBUYREC                                                        
*                                                                               
       ++INCLUDE PBDELEM                                                        
         EJECT                                                                  
*                  CONTRACT RECORD DSECT                                        
PCONRECD DSECT                                                                  
       ++INCLUDE PCONREC                                                        
         SPACE 3                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'069PPRTLOOKS 05/01/02'                                      
         END                                                                    

*          DATA SET SPREPZR02  AT LEVEL 018 AS OF 10/20/15                      
*CATALP SPZR02                                                                  
         TITLE 'SPREPZR02 - EASI - INVOICE CONVERSION'                          
         PRINT NOGEN                                                            
*                                                                               
***********************************************************************         
*                                                                               
*                                                                               
*        QOPT1      Y= TEST-NO FILE MARKING (DOESNT SET RCWRITE)                
*                   X= TEST-NO AND PRODUCE DATA ERROR REPORT 9                  
*        QOPT2      TRACE A=ALL,E=ERRORS,M=E+MODES,F=M+FIELDS                   
*                         R=M+ADDED RECORDS                                     
*        QOPT3      Y=LIST PREVIOUS CONVERSIONS                                 
*        QOPT4      Y=OK TO REPLACE INVOICES ON FILE                            
*        QOPT5      S=STRIP 1ST 2 CHARS OF ORDER #, IF THEY'RE ALPHA            
*        QOPT6(QGRP)Y - DO NOT IGNORE SJ INVOICES                               
*                                                                               
*        QSTAUTO(6) =  RE-RUN DATE                                              
*                                                                               
*        QCOMPARE   =  REP INVOICE CONVERSION RUN                               
*        QPRGTYPE   =  LOCAL INVOICE CONVERSION RUN                             
*                                                                               
***********************************************************************         
*                                                                     *         
*   REGISTER USAGE                                                    *         
*   R0 - OS & WORK                                                    *         
*   R1 - OS & WORK                                                    *         
*   R2 - WORK                                                         *         
*   R3 - WORK                                                         *         
*   R4 - WORK                                                         *         
*   R5 - EZBLOCK BASE                                                 *         
*   R6 - WORK                                                         *         
*   R7 - 2ND BASE                                                     *         
*   R8 - GLOBALD BASE                                                 *         
*   R9 - SPWORKD BASE                                                 *         
*   RA - SPWORKD 2ND BASE                                             *         
*   RB - 1ST BASE                                                     *         
*   RC - SPZ5WRKD                                                     *         
*   RD - STD REG SAVE CHAIN                                           *         
*   RE - OS & WORK                                                    *         
*   RF - OS & WORK                                                    *         
*                                                                     *         
***********************************************************************         
*                                                                     *         
*  LEV 34    DEC14/89 CHANGE CONVERTED TO CONVERTABLE FOR TEST RUN    *         
*  LEV 35    DEC18/89 FIX TOTALLY CONVERTED TEST TO X'40'             *         
*                     CHANGE QPROG+53 RERUN TO QPROG+52               *         
*  LEV 36    JAN11/90 FIX COMPARE FOR 3 CHAR STATION                  *         
*  LEV 37    JAN16/90 ADD DEMOS TO I2 REQUEST                         *         
*  LEV 38    FEB12/90 ONLY DO DEMO BOOK ACT                           *         
*  LEV 39-40 APR20/90 SET FULLY CONVERTED BATCHES TO STATUS KEEP,     *         
*                     SAVE SOURCE (WKRCMNT), BYPASS DELETED INVOICES  *         
*  LEV 41    JUN14/90 USE DEMO BOOK FROM REQ FOR IF REQUESTS          *         
*  LEV 42    JUL25/90 USE QUESTOR FROM THIS REQUEST FOR I2            *         
*  LEV 43    OCT11/90 REFORMAT REPORTS 1-9 TO BE THE SAME             *         
*                     SORT ON MARKET AND SHOW SOURCE                  *         
*  LEV 44    NOV01/90 ONLY PROCESS PREV CONVERTED INV ON INVL         *         
*  LEV 45    NOV02/90 ADD DELETED INVOICES REPORT (10)                *         
*                     FIX MARKET GROUP REPORT                         *         
*  LEV 46-47 JAN16/91 CHANGE PRTABL TO 8000 FROM 5000, JUNK TEMPS     *         
*  LEV 48    JAN22/91 FIX MY SPELLING ERROR CONVERTABLE TO CONVERTIBLE*         
*  LEV 49    JAN22/91 CHANGE EZBYMGRP TO SOURCE FOR MGRP SCHEME       *         
*  LEV 50    FEB15/91 ADD RADIO                                       *         
*  LEV 51    FEB28/91 FIX READING CONVERTED IN ERROR                  *         
*  LEV 52    APR12/91 FIX MGRP BUG                                    *         
*  LEV 53    APR16/91 FIX I2 REPORT BUG                               *         
*  LEV 54    JUN12/91 I2 REQ, ONLY GIVE EST IF NO PIGGY,              *         
*                      PASS EST IN WIEST                              *         
*  LEV 55    SEP17/91 ADD Z5 PROF # 3 SHOW DEMO IN I2                 *         
*  LEV 56    NOV19/91 ADD STATION EQUIVALENCE                         *         
*  LEV 57    JAN07/92 FIX EZIHBEST - GETTING AGENCY EST WHEN OVERRIDE *         
*  LEV 58    JAN16/92 FIX EZI2RQST FILE OPEN CHECKING                 *         
*  LEV 59    JAN29/92 FIX BAD MARKET                                  *         
*  LEV 60    FEB11/92 READ CORRECT ADV MPL SYSTEM                     *         
*  LEV 61    FEB19/92 FORCE MEDIA C/S TO N FOR BSTA, FIX READ MKT NAME*         
*  LEV 62-63 FEB26/92 FORCE I2 REQUESTS FROM -C TO -N                 *         
*  LEV 64    APR10/92 FIX CALC GROSS  WIGRS ROUTINE                   *         
*  LEV 65    JUL02/92 PASS ON NEW OPTION 6 TO I2 - POST AFFIDS        *         
*  LEV 66    JUL07/92 XC HEADHOOK, WAS CAUSING PRG CK IN DRIVER       *         
*  LEV 67    JUL17/92 ADD MPLQ FILE FOR REP                           *         
*  LEV 68    AUG07/92 CHANGE CHECKING COMMENT STATUS TO CK KEEP STATUS*         
*  LEV 69    OCT13/92 SET TO RUN UPDATIVE SOON (BUT NO I2 REQUESTS)   *         
*  LEV 70    OCT26/92 CHANGE I2 REQUEST PER GRANT TO ALL OR P2 IN +34 *         
*  LEV 71    NOV18/92 CHANGE CMTAB - COMML TABLE FROM 8000 TO 16000   *         
*  LEV 72    DEC14/92 CHANGE PRTAB - PROD TABLE FROM 8000 TO 16000    *         
*  LEV 73    JAN31/93 ADD MPL6                                        *         
*  LEV 74    FEB18/93 CHANGE QBOOK REQUEST LEN FROM 4 TO 6 KIIL RERUN *         
*  LEV 75    FEB26/93 PUT Z IN QREQ+31 TO PRINT (Z5) ON I2 REPORT     *         
*  LEV 76    MAR29/93 MOVE RERUN FROM QHUT1 TO QSTAUTO, POL/YES REQ   *         
*  LEV 77    APR15/93 ADD CABLE HEAD - EZIHNET                        *         
*  LEV 78    APR30/93 CHANGE TO EASIWK, ADD EZSRCE                    *         
*  LEV 79    MAY11/93 ADD COL 33 = Y FOR RESPONSE I2 REPORTS          *         
*  LEV 80    OCT14/93 ADD THIRD STEP DCB FOR Z9 PRINT OUTS AND        *         
*                         USE FIRSTSW TO INDICATE ANY CONVERTED INV   *         
*                         STOP ALL BUT CONVERTED ON RERUN             *         
*                         FIX SHOW COMML CODE ON ERROR                *         
*  LEV 81    NOV22/93 CLOSE TRFUPD FILE IF NEEDED, ADD CMML SEQ TBL   *         
*  LEV 82    DEC09/93 CHANGE PRTAB - PROD TABLE FROM 16000 TO 23100   *         
*                     CHANGE CMTABL FROM 16000 TO 24600               *         
*  LEV 83    DEC13/93 SHOW COMBINED INVOICE ON Z5 REPORT              *         
*  LEV 84    FEB17/94 PULL OUT CLOSE TRFUPD FILE                      *         
*  LEV 85    APR12/94 FIX UNKNOWN STATION MSG                         *         
*  LEV 86    MAY06/94 ADD MPL5                                        *         
*  LEV 87    AUG16/94 ADD NWK                                         *         
*  LEV 88    JAN27/95 MORE NWK, AND INIT BYTE BEFORE MEDIA SEL        *         
*                      AND EZPROF 9 FOR OLD/NEW INVOICE SELECTION     *         
*  LEV 90    JUL22/96 ADD MORE CATCHUP STUFF                          *         
*                     I5/CC REPORTS BYPASS 1ST CHAR STA OF GARBAGE    *         
*                     COKE BLK DATESAUTO REQUEST REPB MPLV            *         
*  LEV 91    AUG01/96 DISABLE OLD INV CONVERT, ONLY NEW               *         
*                     CHANGE FROM C VER TO BLK, BYPASS EZIHNET EXC LC *         
*                     BYPASS IDIOT %$#@! STUFF FROM COKE              *         
*  LEV 92    AUG02/96 ADD COKE I5 REQUEST DATA                        *         
*  LEV 93    OCT08/96 ADD ADV7                                        *         
*  LEV 94    JAN15/97 FIX ACN                                         *         
*  LEV 95    JAN28/97 FIX ACN AGAIN - LOOK FOR EQUAL MARKET           *         
*  LEV 96    FEB06/97 FIX ACN AGAIN - USE ACN # TO FIND MARKET #      *         
*  LEV 97    MAR30/97 PUT ACN IN I2 REPORT FOR COKE                   *         
*  LEV 98    APR28/97 DO NOT CLEAR ACN # FROM QBOOK1 FOR COKE         *         
*  LEV 99    JUN19/97 PUT OUT BETTER ERR MSG FOR STATION NOT ON FILE  *         
*  LEV 100   SEP11/97 ALLOW LOW POWER TV                              *         
*  LEV 101   DEC01/97 CHG COKE CC REQ TO CD                           *         
*  LEV 102   FEB02/98 ADD MARKET TO FILTERS, FIX FOR LOW POWER TV     *         
*  LEV 103   MAR05/98 DO NOT PUT LOCAL CABLE NET IN BMKTSTA, SAVE IT  *         
*  LEV 104   MAR24/98 SORT I2 REQUESTS FOR JWNY                       *         
*  LEV 105   APR01/98 FIX SORTED I2 REQUESTS                          *         
*  LEV 106   APR02/98 BYPASS CABLE NET UNLESS NUMERIC STATIONS        *         
*  LEV 107   APR22/98 FILTER BY SOURCE (QSTAUTO)                      *         
*                     MOVE RERUN DATE FROM QSTAUTO TO QEST+2          *         
*  LEV 108   JUN11/98 SPECIAL SDI FILTERING FOR JWT                   *         
*  LEV 109   JUL29/98 I2 REQUEST - ALLOW BOTH PTR PRD AND ESTIMATE    *         
*  LEV 110   SEP14/98 USE BATCH DATE IN INDEX                         *         
*  LEV 111   OCT21/98 PUT / FOLLOWING CABLE STATIONS FOR I2 REQUESTS  *         
*  LEV 112   DEC24/98 RUN REPORT IN STATION SEQ, RD Z5 PROF FOR Z6    *         
*  LEV 113   MAR29/99 ADD WILA (WI) TO AUTO I2 REPORT                 *         
*                     ADD MDSCP(BC) TO AUTO I5 REPORT                 *         
*  LEV 114   APR05/99 ADD NEW REQUEST FOR MID-FLT-CLEAR ONLY          *         
*                     WHICH IS AN 'M' IN COL 56 - QRERATE             *         
*  LEV 115   APR14/99 ADD IPRQFIL DCB IF I2 DOES NOT CREATE IT        *         
*  LEV 116   AUG09/99 GET STATION TYPE & IF N REQ I2 AS CALENDAR      *         
*  LEV 117   AUG10/99 SAVE STYPE FROM STATION MASTER IN EZSTYPE       *         
*  LEV 118   AUG18/99 SET UP FDMJW(FR) SAME AS JW                     *         
*  LEV 119   DEC08/99 TAKE OUT ALL OR YES FOR I2 REQ+34 PRD2          *         
*  LEV 120   FEB25/00 ELIMINATE DUPLICATE I2 REQUESTS                 *         
*  LEV 121   APR21/00 SORT I2 REQUESTS IN FILE ORDER FOR TH           *         
*  LEV 122   MAY01/00 READ STA EQUIV RECS FROM GENDIR/FIL             *         
*  LEV 123   JUN08/00 MAKE EQVSTATB LARGER FROM 600 TO 2000           *         
*  LEV 124   OCT20/00 NEW Z5 PROFILE 5 TO BYPASS DELETED INV REPORT   *         
*  LEV 125   NOV08/00 FIX AGENCY TH I2 REQUEST BUG                    *         
*                     ADD H7&SJ TO JW/FR/TH FOR I2 NET REQUESTS       *         
*  LEV 126   DEC11/00 ADD SOON CAPABILITY                             *         
*  LEV 128   APR24/01 ADD H7 TO JWT                                   *         
*  LEV 129   MAY11/0A FIX DUP I2 REQUESTS                             *         
*  LEV 129   JUN13/01 SAVE EQVSTAW TO EZEQVSTA                        *         
*  LEV 130   JUN20/01 CK FOR MORE ERROR CODES FROM STAPACK            *         
*  LEV 132   JUL11/01 SETUP Z6 RUN FOR MSNYA TO SORT BY MARKET        *         
*  LEV 133   JUL18/01 OPT ALL- OTHER THAN CABLE, ALL/ ONY LOCAL CABLE *         
*  LEV 135   FEB06/02 REP INVOICES                                    *         
*  LEV 136   OCT23/02 CK FLAG ON DSTA RECS FOR REP                    *         
*  LEV 140   JAN21/03 PUT IN CODE FOR TRAFFIC ORDER #                 *         
*                                                                     *         
*                                                                               
*  NOV22/04 - REP Z5 RENAMED TO ZR.  LEVEL STAMPS ALL RESET TO 1                
***********************************************************************         
SPZR02   CSECT                                                                  
         NMOD1 0,*SPZR02*,R7                                                    
*                                                                               
         L     R9,0(R1)                                                         
         LA    RA,2048(R9)                                                      
         LA    RA,2048(RA)                                                      
         USING SPWORKD,R9,RA                                                    
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
         L     R5,=A(EZBLOCKC)                                                  
         USING EZBLOCKD,R5                                                      
*                                                                               
         CLI   MODE,RUNFRST                                                     
         BE    FAKEIT              PUT OUT DUMMY Z9 REQUEST FILE                
         CLI   MODE,RUNLAST        CLOSE I2 REQUEST AT RUNLAST                  
         BE    CLOSEIT                                                          
         CLI   MODE,REQFRST                                                     
         BE    PROC                                                             
         GOTO1 AENDREQ                                                          
*                                                                               
* IF RUNNING SOON, NO SECOND STEP OR AUTO REQUESTS *                            
*                                                                               
FAKEIT   L     RF,VMASTC                                                        
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BNZ   EXIT                                                             
*                                                                               
         BRAS  RE,INIT             WRITE OUT DUMMY Z9 REQUEST FILE              
*                                  AND I2, I5, CD, & IPRQFIL                    
         B     EXIT                                                             
*                                                                               
* IF RUNNING SOON, NO SECOND STEP OR AUTO REQUESTS *                            
*                                                                               
CLOSEIT  DS    0H                                                               
*                                                                               
EQXIT    CR    RB,RB                                                            
         J     EXIT                                                             
NEQXIT   LTR   RB,RB                                                            
EXIT     XIT1                                                                   
*                                                                               
EXITX    DS    0H                                                               
         L     RF,UTL                                                           
         MVC   4(1,RF),SAVSYS      RESTORE SYSTEM NUM                           
         XIT1                                                                   
*                                                                               
* REQUEST FIRST                                                                 
*                                                                               
PROC     DS    0H                                                               
         XCEFL EZBLOCKD,'EZBLOCKL'                                              
*                                                                               
         MVI   EZWRKIOF,C'Y'                                                    
         LAY   R1,EZWRKIOB                                                      
         USING WRKIOD,R1                                                        
         MVC   WRKEZUID,RCORIGID                                                
         MVC   WRKIACOM,ACOMFACS                                                
         MVC   WRKIABUF,=A(WRKRBUFF)                                            
         MVC   WRKIAREC,=A(WRKRREC)                                             
         MVI   WRKIFTYP,WRKIFTEZ                                                
         DROP  R1                                                               
*                                                                               
         OC    EZWRKIO,EZWRKIO                                                  
         BNZ   PR02                                                             
*                                                                               
         L     R6,VMASTC                                                        
         USING MASTD,R6                                                         
*                                                                               
         MVC   MCDUB,=CL8'T00A2C'                                               
         GOTO1 MCVLOADM,DMCB,0                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   EZWRKIO,DMCB+4                                                   
         DROP  R6                                                               
*                                                                               
PR02     DS    0H                                                               
         CLI   QPRGTYPE,C'L'                                                    
         BNE   PR03                                                             
*                                                                               
         L     RF,=A(BUFFRIN)                                                   
         ST    RF,ABUFFRIN         SAVE A(BUFFERIN)                             
         LA    R0,BUFFAINI         INIT BUFFERIN                                
         GOTO1 =V(BUFFERIN),DMCB,((R0),ABUFFRIN),(0,0),ACOMFACS                 
         CLI   4(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
PR03     DS    0H                                                               
         L     RF,UTL                                                           
         MVC   SAVSYS,4(RF)                                                     
         L     R8,=A(GLAREA)                                                    
         USING GLOBALD,R8                                                       
         XC    HEADHOOK,HEADHOOK                                                
*                                                                               
         OC    QSTART(12),QSTART   ANY REQUEST DATE                             
         BZ    PR04                 NO                                          
         CLC   QSTART(12),SPACES   ANY REQUEST DATE                             
         BNE   PR06                 NO                                          
*                                                                               
PR04     MVC   QSTART,TODAY        FORCE BLK REQ DATE TO TODAY                  
         MVC   QEND,TODAY                                                       
*                                                                               
PR06     TM    FIRSTSW,FIRSTSWI    TEST FIRST TIME                              
         BO    PR10                                                             
         OI    FIRSTSW,FIRSTSWI    SET DRIVER INITIALIZED                       
         XC    ADRIVER,ADRIVER                                                  
         MVC   DPGFILE,=CL8'SPZR05  '                                           
         MVC   DRIVER,=CL8'T00A3A'                                              
         MVI   XFF,X'FF'                                                        
         MVC   XFF+1(L'XFF-1),XFF                                               
         MVI   DASHES,C'-'                                                      
         MVC   DASHES+1(L'DASHES-1),DASHES                                      
*                                                                               
PR10     DS    0H                                                               
*                                                                               
         CLI   QOPT5,C' '          I2 OPTION, BLANK=N                           
         BNE   *+8                                                              
         MVI   QOPT5,C'N'                                                       
*                                                                               
         LA    R1,EZBLOCKD                                                      
         AHI   R1,EZBLKX-EZBLOCKD                                               
         USING EZBLKX,R1                                                        
         MVC   EZORDSTR,QOPT5                                                   
         DROP  R1                                                               
*                                   SET EZBLOCK VALUES                          
         L     RF,VMASTC                                                        
         CLI   MCOVSYS-MASTD(RF),X'02' SPOT                                     
         BNE   *+12                                                             
         MVI   EZSPTNET,C'S'                                                    
         B     *+22                                                             
*                                                                               
         CLI   MCOVSYS-MASTD(RF),X'03' NET                                      
         BNE   *+12                                                             
         MVI   EZSPTNET,C'N'                                                    
         B     *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   EZMCTREQ,QRERATE    FORWARD MID-FLT-CLEAR ONLY                   
*                                                                               
         OC    MCREMPQK-MASTD(,RF),MCREMPQK-MASTD(RF)                           
         BZ    *+8                                                              
         MVI   EZSOON,C'S'         SET FLAG TO SOON FOR EZMOD                   
*                                                                               
         L     RE,=A(WRKRBUFF)                                                  
         ST    RE,EZWKRBUF                                                      
         LHI   RF,WRKRBEND-WRKRBUFF                                             
         XCEF                                                                   
*                                                                               
         L     RE,=A(WRKRREC)                                                   
         ST    RE,EZWKRREC                                                      
         LHI   RF,WRKRRECE-WRKRREC                                              
         XCEF                                                                   
*                                                                               
         XC    EZWKRIND,EZWKRIND                                                
*                                                                               
         MVC   EZWKRIND(2),RCORIGID                                             
*                                                                               
* NO LOOKUP OF ADV, PRD, OR COMMLS FOR REP                                      
*                                                                               
         OI    EZLOOKSW,EZLNOADV+EZLNOPRD+EZLNOCML                              
*                                                                               
         ZAP   REPCT,=P'0'                                                      
*                                                                               
         L     RF,UTL                                                           
         MVI   4(RF),X'0A'         SET UTL SE TO CTFILE                         
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMOPEN'),=C'CONTROL',                C        
               =C'NCTFILE X',ADBUY,0                                            
         XC    WORK,WORK                                                        
         MVI   WORK,C'5'           FIND CONTROL FILE ACCESS RECORD              
         MVC   WORK+23(L'AGENCY),AGENCY      INSERT POWER CODE                  
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',WORK,ADBUY                    
         CLI   8(R1),0             FOUND?                                       
         BE    *+6                 YES                                          
         DC    H'0'                SHOULD HAVE BEEN THERE....                   
         L     R1,ADBUY                                                         
         CLC   WORK(25),0(R1)      CHECK THE KEY                                
         BE    *+6                 SAME - OKAY                                  
         DC    H'0'                                                             
         LA    R1,28(R1)           FIND SYS AUTHORIZATION ELEMENT               
INIT0010 EQU   *                                                                
         CLI   0(R1),X'21'         AUTH ELEMENT?                                
         BNE   INIT0020             NO    E                                     
         CLI   2(R1),X'08'         IS IT 'REP' SYSTEM?                          
         BE    INIT0030             YES                                         
INIT0020 EQU   *                                                                
         ZIC   R0,1(R1)            BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         CLI   0(R1),0             END OF RECORD?                               
         BNE   INIT0010            NO                                           
         DC    H'0'                NO X'21' - DUMP IT OUT                       
         DS    0D                                                               
REPLIST  DC    CL8' REPDIR'                                                     
         DC    CL8' REPFIL'                                                     
         DC    CL8'X '                                                          
INIT0030 EQU   *                                                                
         MVC   REPUTL,3(R1)        SAVE REP UTL                                 
         L     RF,UTL                                                           
         MVC   4(1,RF),REPUTL                                                   
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'DMOPEN',=C'REP ',REPLIST,ADBUY                   
*                                                                               
         MVC   EZREPSE,REPUTL                                                   
*                                                                               
         CLI   QPRGTYPE,C'L'       LOCAL?                                       
         BNE   *+8                                                              
         BRAS  RE,BLDLTAB                                                       
*                                                                               
         L     RF,UTL                                                           
         MVC   4(1,RF),SPOTSE                                                   
*                                                                               
         BRAS  RE,GETDARE                                                       
*                                                                               
PR12     DS    0H                                                               
*        GOTO1 DATAMGR,DMCB,(0,=C'GFILE'),=C'WRKFIL',EZWKRIND,EZWKRREC,C        
               EZWKRBUF                                                         
*        LA    R1,EZWKRIND                                                      
*        USING UKRECD,R1                                                        
*        MVC   EZWKRFIL,UKUSRINF                                                
*        DROP  R1                                                               
*                                                                               
*                                                                               
* FAKE INDEX CALL TO GET THE FILE NAME                                          
*                                                                               
         LAY   R4,EZWRKIOB                                                      
         USING WRKIOD,R4                                                        
         XC    WRKEZKEY,WRKEZKEY                                                
         MVC   WRKEZUID,EZWKRIND                                                
         MVI   WRKIACTN,WRKIANDX                                                
         GOTO1 EZWRKIO,WRKIOB                                                   
         CLI   WRKIERRS,WRKIEEOF                                                
         BE    *+14                                                             
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   WRKIFILE+4,C'1'     FORCE TO 1 (READ ALL FILES)                  
         MVC   EZWKRFIL,WRKIFILE                                                
         DROP  R4                                                               
*                                                                               
         NI    EZLOOKSW,X'FF'-EZLOC                                             
         CLI   QPRGTYPE,C'L'       LOCAL?                                       
         BNE   PR13                                                             
*                                                                               
         L     RE,=A(LOCTAB)       LOCAL STATION TABLE                          
         LA    R1,EZBLOCKD                                                      
         AHI   R1,EZBLKX-EZBLOCKD                                               
         USING EZBLKX,R1                                                        
         STCM  RE,15,EZLSTATB                                                   
         DROP  R1                                                               
         OI    EZLOOKSW,EZLOC                                                   
*                                                                               
PR13     DS    0H                                                               
         LA    RF,EZMPROC                                                       
         ST    RF,EZHOOK                                                        
         L     RF,ADBUY                                                         
         ST    RF,EZAREC                                                        
         L     RF,=V(EZRECTAB)     RECORD/FIELD TABLE                           
         ST    RF,EZARECTB                                                      
         L     RE,=A(PRTABC)       PRODUCT TABLE                                
         ST    RE,EZPRTAB                                                       
         LHI   RF,PRTABE-PRTABC                                                 
*                                                                               
         L     RE,=A(CMTABC)       COMML TABLE                                  
         ST    RE,EZCMTAB                                                       
         LHI   RF,CMTABE-CMTABC                                                 
*                                                                               
         MVC   EZPRTABL,=Y(PRTABL) PROD TABLE LENGTH                            
         MVC   EZCMTABL,=Y(CMTABL) CMML TABLE LENGTH                            
*                                                                               
         L     RE,=A(CSTABC)       COMML SEQUENCE TABLE                         
         ST    RE,EZTRFTBL                                                      
         LA    RF,CSTABL/5                                                      
         CHI   RF,255                                                           
         BNH   *+6                                                              
         DC    H'0'                                                             
         STC   RF,EZTRFTBL                                                      
         LHI   RF,CSTABE-CSTABC                                                 
         XCEF                                                                   
*                                                                               
         MVC   EZCOMFCS,ACOMFACS                                                
         MVC   EZPRINT,PRINT                                                    
         MVC   EZUTL,UTL                                                        
*        MVC   EZSTAPK,VSTAPACK                                                 
         MVC   EZMAST,VMASTC                                                    
*                                                                               
         MVC   EZFCTRFU,FCUPTRF                                                 
         MVC   EZRCTRFU,RCUTLTRF                                                
         MVC   EZSPOTSE,SPOTSE                                                  
*                                                                               
         MVC   EZWRITE,RCWRITE                                                  
         MVC   EZAGY,AGY                                                        
         MVC   EZBAGYMD,BAGYMD                                                  
*                                                                               
         CLC   QPROG,=C'Z6'        THIS THE Z6 ACTIVITY REPORT                  
         BNE   PR16                                                             
         XC    WORK,WORK                                                        
         MVC   WORK(4),=C'S0Z5'                                                 
         MVC   WORK+4(2),AGENCY                                                 
         MVC   WORK+6(1),QMED                                                   
         GOTO1 GETPROF,DMCB,WORK,PROGPROF,DATAMGR                               
*                                                                               
PR16     DS    0H                                                               
         MVC   EZPROF2,PROGPROF    Z5 PROFILE                                   
*                                                                               
         MVI   ACTVSW,C'N'                                                      
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         LA    RE,GLOBALD          INIT DRIVER STORAGE TO ZEROS                 
         L     RF,=F'44000'                                                     
         XCEF                                                                   
         MVC   GLSIZE,=F'44000'    GLOBAL SIZE                                  
         MVC   GLOBALD(8),=C'*GLOBAL*'                                          
*                                                                               
         MVI   GLTRACE,C'N'                                                     
*                                                                               
*        GOTO1 LOADER,DMCB,DPGFILE,0    LOAD DPG PROGRAM                        
         L     R1,VMASTC                                                        
         L     RF,MCVLOADM-MASTD(,R1)                                           
         MVC   MCDUB-MASTD(L'MCDUB,R1),SPACES                                   
         MVC   MCDUB-MASTD(6,R1),=C'SPZR05'                                     
         GOTO1 (RF),DMCB,0            LOAD DPG PROGRAM                          
         ICM   R6,15,DMCB+4                                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         ST    R6,GLAPROG                                                       
*                                                                               
         OC    ADRIVER,ADRIVER                                                  
         BNZ   PR14                                                             
         GOTO1 LOADER,DMCB,DRIVER       LOAD DRIVER                             
         ICM   R6,15,DMCB+4                                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
         ST    R6,ADRIVER                                                       
*                                                                               
PR14     LA    RE,SPWORKD                                                       
         ST    RE,GLAWORKD         SPOT WORK ADDR                               
         LA    RE,DRHOOK                                                        
         ST    RE,GLAHOOK          OUR DRIVER HOOK                              
         MVI   GLTWORKD,GLTSPOT    SPOT WORK                                    
         MVI   GLDETHED,C'Y'       I GET HEADS AT DETAIL TIME                   
         LA    RE,PROGPROF                                                      
         ST    RE,GLAPPROF                                                      
*                                                                               
*                                                                               
         MVI   GLOPT1,C'Y'         ACTIVATE REPORTS FOR INIT                    
         MVC   GLOPT2(9),GLOPT1                                                 
         MVI   GLMODE,GLINIT       INITIALIZE DRIVER                            
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT1,C'N'         DE-ACTIVATE                                  
         MVC   GLOPT2(9),GLOPT1                                                 
*                                                                               
*                                  SET OPTIONS                                  
*                                  -----------                                  
*                                                                               
         MVC   EZTEST,QOPT1        TEST OPTION                                  
         CLI   QOPT1,C'X'          TEST OPTION WITH DATA ERROR REPORT 9         
         BNE   *+8                                                              
         MVI   EZTEST,C'Y'         ALSO MEANS TEST OPTION                       
*                                                                               
         MVI   EZTRACE,0           TRACE OPTION                                 
         CLI   QOPT2,C'N'                                                       
         BE    PR20                                                             
         CLI   QOPT2,C' '                                                       
         BE    PR20                                                             
         CLI   QOPT2,C'A'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'FF'       TRACE EVERYTHING                             
         CLI   QOPT2,C'E'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'20'       TRACE ERRORS                                 
         CLI   QOPT2,C'M'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'60'       TRACE MODES AND ERRORS                       
         CLI   QOPT2,C'F'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'E0'       TRACE FIELDS AND ERRORS AND MODES            
         CLI   QOPT2,C'R'                                                       
         BNE   *+8                                                              
         MVI   EZTRACE,X'70'       TRACE MODES, ERRORS, AND ADDED RECS          
*                                                                               
PR20     DS    0H                                                               
         MVC   PREVOPT,QOPT3       Y=LIST PREVIOUS CONVERTS                     
         MVC   EZRPLOPT,QOPT4      Y=OK TO REPLACE INVOICES                     
*                                                                               
         MVI   EZRPLOPT,C'Y'       Y=OK TO REPLACE INVOICES FOR REP             
*                                                                               
         XC    RERUN,RERUN         RE-RUN AS OF DATE                            
         CLI   QEST+2,C' '                                                      
         BNH   PR24                                                             
*                                                                               
         CLC   QEST+2(3),=C'ALL'                                                
         BNE   *+14                                                             
         MVC   RERUN(3),=C'ALL'                                                 
         B     PR23                                                             
*                                                                               
         OC    QEST+2(6),=6C'0'                                                 
         GOTO1 DATCON,DMCB,QEST+2,(1,RERUN)                                     
*                                                                               
PR23     DS    0H                                                               
         MVC   EZRERUN,RERUN       RE-RUN DATE TO BE PASSED TO EZMOD            
*                                                                               
*                               READ WORKER FILE INDEXES                        
*                               -------------------------                       
*                               **NOTE- DRIVER INPUT DONE IN EZMPROC            
*                                                                               
PR24     DS    0H                                                               
         XC    EZWKRIND,EZWKRIND                                                
         CLI   QSTA+4,C'/'         LOCAL CABLE                                  
         BNE   *+8                                                              
         MVI   QSTA+4,C' '         MEDIA                                        
*                                                                               
         USING WRKIOD,R4                                                        
         LAY   R4,EZWRKIOB                                                      
         XC    WRKEZKEY,WRKEZKEY                                                
         DROP  R4                                                               
*                                                                               
PR32     DS    0H                                                               
*        GOTO1 DATAMGR,DMCB,=C'INDEX',EZWKRFIL,EZWKRIND,EZWKRREC,      C        
               EZWKRBUF                                                         
*        TM    DMCB+8,X'80'        TEST EOF                                     
*        BNZ   PR60                                                             
*                                                                               
         USING WRKIOD,R4                                                        
         LAY   R4,EZWRKIOB                                                      
         MVI   WRKIACTN,WRKIANDX                                                
         MVI   WRKINDS,WRKIWFNQ+WRKINOXQ                                        
         XC    WRKEZUID,WRKEZUID                                                
         GOTO1 EZWRKIO,WRKIOB                                                   
         CLI   WRKIERRS,WRKIEEOF                                                
         BE    PR60                                                             
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  R4                                                               
*                                                                               
         BRAS  RE,FAKEIND                                                       
*                                                                               
         LA    R4,EZWKRIND                                                      
         USING UKRECD,R4                                                        
         CLI   UKDAY,X'99'         TEST AN EASI FILE                            
         BNE   PR32                                                             
*                                                                               
         CLI   QGRP,C'Y'           ACCEPTING SJ INVOICES?                       
         BE    PR33                                                             
*                                                                               
         CLC   =X'0011',0(R4)      SJR?                                         
         BE    PR32                YES, SKIP                                    
         CLC   =X'0AB7',0(R4)      SJB?                                         
         BE    PR32                YES, SKIP                                    
         CLC   =X'069D',0(R4)      SJX?                                         
         BE    PR32                YES, SKIP                                    
*                                                                               
PR33     DS    0H                                                               
         XC    INVMOS,INVMOS                                                    
*                                                                               
         OC    QSTART(12),QSTART   ANY REQUEST DATE                             
         BZ    PR35                 NO                                          
         CLC   QSTART(12),SPACES   ANY REQUEST DATE                             
         BE    PR35                 NO                                          
         GOTO1 DATCON,DMCB,(2,UKAGELD),(0,WORK)                                 
         CLC   WORK(6),QSTART                                                   
         BL    PR32                 BYPASS                                      
         CLC   WORK(6),QEND                                                     
         BH    PR32                 BYPASS                                      
*                                                                               
PR35     DS    0H                                                               
         USING EZWKRIXD,R4                                                      
*                                                                               
         CLI   EZWISTN,C'A'        MUST BE AT LEAST ALPHA LETTER                
         BL    PR32                 BYPASS THIS MESS WITHOUT A WORD!            
*                                                                               
         CLI   EZWISTN,C'0'        THIS LOCAL CABLE                             
         BNL   PR32                 BYPASS                                      
*                                                                               
         MVC   EQVSTAW,EZWISTN                                                  
         CLI   EQVSTAW+3,C'.'                                                   
         BNE   *+8                                                              
         MVI   EQVSTAW+3,C' '                                                   
*                                                                               
         OC    EQVSTAW(4),SPACES                                                
         MVC   EQVSTAW+4(1),EZWIMED                                             
*                                                                               
         CLI   EZWIMED,C'C'        FORCE CABLE                                  
         BE    *+12                                                             
         CLI   EZWIMED,C'S'        AND SYNDICATION                              
         BNE   *+8                                                              
         MVI   EQVSTAW+4,C'N'      TO NETWORK                                   
*                                                                               
PR35B    DS    0H                                                               
         CLI   QSTA,C' '           TEST REQUESTING BY STATION                   
         BE    PR36                NO - PROCESS ALL STATIONS                    
*                                                                               
         CLC   =C'ALL ',QSTA                                                    
         BE    PR36                                                             
*                                                                               
         CLC   =C'ALL',QSTA        COULD THIS BE INCLUDE/EXCLUDE CABLE          
         BNE   PR35E                NO                                          
*                                                                               
         CLI   QSTA+3,C'-'         EXCLUDE CABLE                                
         BNE   PR35C                                                            
         CLI   EQVSTAW,C'0'        THIS CABLE                                   
         BNL   PR32                 YES, BYPASS                                 
         B     PR36                                                             
*                                                                               
PR35C    DS    0H                                                               
         CLI   QSTA+3,C'/'         INCLUDE ONLY CABLE                           
         BNE   PR35E                                                            
         CLI   EQVSTAW,C'0'        THIS CABLE                                   
         BL    PR32                  NO, BYPASS                                 
         B     PR36                                                             
*                                                                               
PR35E    DS    0H                                                               
         CLC   EQVSTAW(4),QSTA     SAME STATION AS REQUESTED?                   
         BNE   PR32                NO - NEXT INDEX                              
         CLI   QSTA+4,C' '         MEDIA                                        
         BE    PR36                                                             
         CLC   EQVSTAW+4(1),QSTA+4 SAME MEDIA AS REQUESTED?                     
         BNE   PR32                                                             
*                                                                               
PR36     DS    0H                                                               
         MVI   BYTE,0                                                           
         LA    R0,EQVMEDW                                                       
         LA    R1,BYTE                                                          
         BRAS  RE,SETMED                                                        
*                                                                               
         CLC   BYTE,QMED           SAME MEDIA AS REQUESTED?                     
         BNE   PR32                                                             
*                                                                               
         ZIC   R0,EQVSTAW+4                                                     
*                                                                               
         CLI   BYTE,C'N'                                                        
         BNE   *+8                                                              
         MVI   EQVSTAW+4,C'N'      FORCE ALL NETWORK TO MEDIA N                 
*                                                                               
         BRAS  RE,CKSTA            SEE IF CALL LETTERS REASONABLE               
         BNE   PR32                 NOT OKAY                                    
*                                                                               
         GOTO1 MSPACK,DMCB,=C'0000',EQVSTAW,BMKTSTA                             
         MVC   SVREPSTA,EQVSTAW                                                 
*                                                                               
         STC   R0,EQVSTAW+4        RESTORE MEDIA                                
*                                                                               
         CLI   QPRGTYPE,C'L'                                                    
         BNE   PR38                                                             
*                                                                               
         LA    R1,EQVSTAW                                                       
         BRAS  RE,CKLTAB                                                        
         BNE   PR32                                                             
         BRAS  RE,CKLREP                                                        
         BNE   PR32                                                             
         B     PR39                                                             
*                                                                               
PR38     DS    0H                                                               
         BRAS  RE,CKREP            SEE IF REP HAS THIS STATION                  
         BNE   PR32                 NO, GET NEXT                                
*                                                                               
PR39     DS    0H                                                               
*        GOTO1 DATAMGR,DMCB,=C'READ',EZWKRFIL,EZWKRIND,EZWKRREC,       X        
               EZWKRBUF                                                         
*        TM    DMCB+8,X'80'        IF EOF ON FIRST READ                         
*        BNZ   PR32                SKIP- GET NEXT INDEX                         
*                                                                               
         USING WRKIOD,R4                                                        
         LAY   R4,EZWRKIOB                                                      
         MVI   WRKIACTN,WRKIAGET                                                
         GOTO1 EZWRKIO,WRKIOB                                                   
         CLI   WRKIERRS,WRKIEEOF                                                
         BE    PR32                                                             
         CLI   WRKIERRS,0                                                       
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   SVWKDESC,WRKEZDSC                                                
*                                                                               
         DROP  R4                                                               
*                                                                               
*        L     R3,EZWKRBUF         SAVE 96 BYTE DESCRIPTOR REC                  
*        MVC   SVWFREC0,0(R3)                                                   
*                                                                               
         LA    R3,EZWKRIND                                                      
         USING W_RECD,R3                                                        
*                                                                               
         OC    QSTART(12),QSTART   ANY REQUEST DATE                             
         BZ    PR40                 NO                                          
         CLC   QSTART(12),SPACES   ANY REQUEST DATE                             
         BE    PR40                 NO                                          
*                                                                               
         GOTO1 DATCON,DMCB,(2,W_AGELD),(0,WORK)                                 
*                                                                               
         CLC   WORK(6),QSTART                                                   
         BL    PR32                 BYPASS                                      
         CLC   WORK(6),QEND                                                     
         BH    PR32                 BYPASS                                      
*                                                                               
PR40     DS   0H                                                                
         MVI   UNCONVSW,C'N'       CLEAR UNCONVERTED SW                         
         MVI   CONVSW,C'N'         AND CONVERTED THIS TIME SW                   
*                                                                               
         L     RE,EZWKRBUF                                                      
         LA    RF,W_DESC-W_RECD(,RE)                                            
         MVC   EZSRCE,EZWCSRCE-EZWKRCMD(RF)                                     
*                                                                               
         GOTO1 =V(EZMOD),DMCB,EZBLOCKD,BSTA                                     
*                                                                               
         B     PR32                NEXT INDEX                                   
         DROP  R3                                                               
*                                                                               
*                                  DRIVER OUTPUT PHASE                          
*                                  -------------------                          
* IF RUNNING SOON, NO AUTO REQUESTS                                             
* IF JWT, PUT OUT SORTED I2 REQUESTS *                                          
*                                                                               
PR60     DS    0H                                                               
         CLI   EZWKRFIL+4,C'F'     END OF FILE LAST FILE                        
         BE    PR62                                                             
*                                                                               
         CLI   EZWKRFIL+4,C'9'                                                  
         BNE   PR61                                                             
*                                                                               
         MVI   EZWKRFIL+4,C'A'                                                  
         B     PR61A                                                            
*                                                                               
PR61     DS    0H                                                               
         ZIC   RF,EZWKRFIL+4                                                    
         LA    RF,1(,RF)                                                        
         STC   RF,EZWKRFIL+4                                                    
*                                                                               
PR61A    DS    0H                                                               
         LAY   R1,EZWRKIOB                                                      
         USING WRKIOD,R1                                                        
         MVC   WRKIFILE,EZWKRFIL                                                
         XC    WRKEZKEY,WRKEZKEY                                                
         DROP  R1                                                               
         XC    EZWKRIND,EZWKRIND                                                
         B     PR32                                                             
*                                                                               
* SEE IF SOON RUN - NO SECOND STEPS FOR SOON                                    
*                                                                               
PR62     DS    0H                                                               
         MVC   SVSMKT,=C'?????'                                                 
         XC    SVBMKT,SVBMKT                                                    
         MVC   SVMGRP,=C'?????'                                                 
         MVI   FORCEHED,C'Y'                                                    
         MVI   GLMODE,GLOUTPUT                                                  
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
*                                                                               
         B     EXITX                                                            
*                                                                               
*        EZMOD PROCESSING ROUTINE                                               
*                                                                               
EZMPROC  NTR1                                                                   
*                                                                               
*                                                                               
         CLI   EZMODE,EZERRP       PROCESS ERROR                                
         BE    EZMP30                                                           
         CLI   EZMODE,EZCMLADD     ADDING A COMMERICAL                          
         BE    EZMP60                                                           
         CLI   EZMODE,EZSPTP       SPOT DETAIL                                  
         BE    EZMP16                                                           
         CLI   EZMODE,EZINVL                                                    
         BNE   EZMP10                                                           
*                                                                               
         TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP90               PRINT AS REPORT 10                          
*                                                                               
         TM    EZIHCVST,EZIHREPI   TEST ALREADY CONVERTED                       
         BZ    EZMP10               TRY IT                                      
         OC    RERUN,RERUN         DO WE HAVE RERUN DATE                        
         BZ    EZMP90               NO, BYPASS                                  
*                                                                               
         CLC   =C'ALL',RERUN                                                    
         BE    EZMP10                                                           
         LA    R4,EZWKRIND                                                      
         USING UKRECD,R4                                                        
         GOTO1 DATCON,DMCB,(2,UKAGELD),(1,WORK)                                 
         CLC   WORK(3),RERUN       TEST = BATCH (LOADED) DATE                   
         BNE   EZMP90               BYPASS                                      
         DROP  R4                                                               
*                                                                               
EZMP10   CLI   EZMODE,EZINVP       PROC INV                                     
         BNE   EZMP16                                                           
*                                                                               
*&&DO                                                                           
* 10/05/2015 - CKLREP IS CALLED AFTER WORKIO INDEX CALL                         
* NO NEED TO REPEAT THE CALL HERE                                               
         CLI   QPRGTYPE,C'L'                                                    
         BNE   EZMP12                                                           
*                                                                               
         LA    R1,UKUDATA-UKRECD+EZWKRIND                                       
*                                                                               
         OC    0(1,R1),0(R1)         MOS ZERO IN BATCH?                         
         BNZ   EZMP12                NO, PROCEED AS USUAL                       
*                                                                               
         MVC   INVMOS,EZIHBMOS     SAVE INVOICE MOS                             
         BRAS  RE,CKLREP                                                        
         BE    EZMP12                                                           
         MVI   EZMODE,EZINVL       NO - SKIP IT                                 
         B     EZMP90                                                           
*&&                                                                             
*                                                                               
EZMP12   DS    0H                                                               
         TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP90               BYPASS                                      
*                                                                               
         B     EZMP21              REP ZR, ALWAYS BRANCH                        
*                                                                               
EZMP16   TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP90               BYPASS                                      
*                                                                               
*                                  NEED TO RECREATE PACKED STATION              
*                                                                               
EZMP21   DS    0H                                                               
         TM    EZLOOKSW,EZLOC      ARE WE RUNNING LOCAL?                        
         BZ    EZMP21A             NO - SKIP INV CHECK                          
* RUNNING LOCAL HERE                                                            
         CLC   =C'LOC',EZIHREPC    IS INVOICE LOCAL?                            
         BE    EZMP21P             YES - PROCEED                                
         MVI   EZMODE,EZINVL       NO - SKIP IT                                 
         B     EZMP90                                                           
*                                                                               
EZMP21A  DS    0H                  RUNNING NATIONAL HERE                        
         CLC   =C'LOC',EZIHREPC    IS INVOICE LOCAL?                            
         BNE   EZMP21P             NO - PROCEED                                 
         MVI   EZMODE,EZINVL       YES - SKIP IT                                
         B     EZMP90                                                           
*                                                                               
EZMP21P  DS    0H                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(L'EQVSTAW),EQVSTAW                                          
*                                                                               
         CLI   EZSPTNET,C'S'       NO LOCAL CABLE UNLESS SPOT                   
         BNE   EZMP22                                                           
         CLI   EQVSTAW,C'0'        AND MUST BE NUMERIC                          
         BL    EZMP22                                                           
*                                                                               
         OC    EZIHNET,EZIHNET                                                  
         BZ    EZMP22                                                           
         MVI   WORK+4,C'/'                                                      
         MVC   WORK+5(3),EZIHNET                                                
*                                                                               
EZMP22   DS    0H                                                               
         XC    WORK+32(32),WORK+32                                              
         LA    R1,WORK+32                                                       
         USING STAPACKD,R1                                                      
         MVI   STAPACT,C'P'                                                     
         MVC   STAPAGY,AGENCY                                                   
         MVC   STAPCTRY,COUNTRY                                                 
         MVC   STAPMED,QMED                                                     
         MVC   STAPACOM,ACOMFACS                                                
         MVC   STAPQMKT,=C'0000'   MARKET                                       
         MVC   STAPQSTA(8),WORK    STATION                                      
*                                                                               
         GOTO1 VSTAPACK,(R1)                                                    
*                                                                               
         MVC   BMKTSTA,STAPMKST                                                 
*                                                                               
* IF NET GIVEN, DON'T PUT IN KEY, BUT SAVE FOR SPOT DETAIL LINES *              
* IF NONE GIVEN, MAY APPEAR LATER IN SPOT DETAIL                 *              
*                                                                               
         OC    EZIHNET,EZIHNET     THIS A LOCAL CABLE                           
         BZ    EZMP22C              NO                                          
*                                                                               
         CLI   WORK,C'0'           THIS CABLE HEAD                              
         BL    EZMP22C              NO                                          
*                                                                               
         MVC   EZSPNETH,BMKTSTA+4  SAVE BINARY NETWORK                          
         NI    EZSPNETH,X'7F'                                                   
         NI    BMKTSTA+4,X'80'                                                  
*                                                                               
EZMP22C  DS    0H                                                               
         CLI   STAPERR,0                                                        
         BE    EZMP22L                                                          
         CLI   STAPERR,04          UNKNOWN NETWORK                              
         BE    EZMP22E              YES                                         
         CLI   STAPERR,07          NETWORK NOT ACTIVE ON THIS HEADEND           
         BE    EZMP22E              YES                                         
         CLI   STAPERR,08          CABLE HEADEND NOT FOUND                      
         BE    EZMP22E              YES                                         
         DC    H'0'                                                             
*                                                                               
EZMP22E  DS    0H                                                               
         MVI   EZERRCD,EZERRSTA    SET BAD STATION CALL LETTERS                 
         L     R1,=A(UNKNNET)                                                   
         MVC   EZERRMSG,0(R1)                                                   
         CLI   STAPERR,04          UNKNOWN NETWORK                              
         BE    EZMP24                                                           
         L     R1,=A(NETINACT)                                                  
         MVC   EZERRMSG,0(R1)                                                   
         CLI   STAPERR,07          NETWORK NOT ACTIVE ON THIS HEADEND           
         BE    EZMP24                                                           
         L     R1,=A(CABSTANF)                                                  
         MVC   EZERRMSG,0(R1)                                                   
         B     EZMP24                                                           
         DROP  R1                                                               
*                                                                               
EZMP22L  DS    0H                                                               
         L     RF,=V(EZADDSNV)                                                  
         GOTO1 (RF),DMCB,EZBLOCKD,SPWORKD                                       
*                                                                               
         CLI   EZMODE,EZINVL       IGNORE UNLESS LAST FOR INVOICE               
         BNE   EZMP90                                                           
         CLI   EZERRCD,0           IF EZADDINV RETURN ERROR                     
         BNE   EZMP24              INVOICE WAS NOT CONVERTED                    
*                                                                               
*                                  REPORT 1 - CONVERTED INVOICE                 
         MVI   GLOPT1,C'Y'                                                      
         MVI   RPTNO,1                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   CONVSW,C'Y'         SET HAVE DONE A CONVERSION                   
*                                                                               
         OI    FIRSTSW,FIRSTSWC    SET ON CONVERTED INVOICES SW                 
*                                                                               
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT1,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 2 - UNCONVERTED                       
EZMP24   DS    0H                                                               
         CLI   EZERRCD,EZERRCON    IF EZADDINV REP RUN NO CON #                 
         BE    EZMP90               YES, JUST BYPASS                            
*                                                                               
         MVI   UNCONVSW,C'Y'       SET HAVE UN-CONVERTED                        
         MVI   GLOPT2,C'Y'                                                      
         MVI   RPTNO,2                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT2,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 3 - PREVIOUSLY CONVERTED              
EZMP26   DS    0H                                                               
         CLI   EZMODE,EZINVL       DON'T PROC UNTIL INV LAST                    
         BNE   EZMP90                                                           
*                                                                               
         CLI   PREVOPT,C'Y'        TEST DOING PREVIOUS REPORT                   
         BNE   EZMP28              NO- SKIP                                     
         MVI   GLOPT3,C'Y'                                                      
         MVI   RPTNO,3                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT3,C'N'         DE-ACTIVATE                                  
*                                                                               
EZMP28   DS    0H                                                               
         MVI   EZMODE,EZINVL       SET TO SKIP PROC OF INVOICE                  
         B     EZMP90                                                           
*                                  HANDLE ALL ERRORS                            
*                                  -----------------                            
EZMP30   DS    0H                                                               
         TM    EZIHCVST,EZIHCDEL   TEST DELETED INVOICE                         
         BO    EZMP90               BYPASS                                      
*                                                                               
         CLI   EZERRCD,EZERRCPR    TEST FILM/PROD ERROR                         
         BE    EZMP50              YES- SPECIAL LIST                            
         CLI   EZERRCD,EZERRRNF    TEST RECORD NOT FOUND                        
         BE    EZMP34                                                           
         CLI   EZERRCD,EZERRSTA    TEST BAD STATION CALL LETTERS                
         BE    EZMP34                                                           
         CLI   EZERRCD,EZERRSCD    OR SPOTPAK CODE ERROR                        
         BNE   EZMP70              ELSE- MUST BE DATA ERROR                     
*                                                                               
EZMP34   DS    0H                                                               
         CLI   EZRNFRPT,C'Y'       TEST A REPEATED REC NOT FOUND                
         BE    EZMP90              YES- SKIP                                    
         ICM   R2,15,EZERRFAD      A(FIELD IN ERROR)                            
         LA    R0,EZIHADVN         TEST ADVERTISER FIELD                        
         CR    R2,R0                                                            
         BE    EZMP36                                                           
         LA    R0,EZIHAAID                                                      
         CR    R2,R0                                                            
         BNE   EZMP40                                                           
*                                                                               
EZMP36   DS    0H                  REPORT 4 - MISSING CLIENTS                   
         MVI   GLOPT4,C'Y'                                                      
         MVI   RPTNO,4                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT4,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                                                               
EZMP40   DS    0H                                                               
         LA    R0,EZIHPRDN         TEST PRODUCT FIELD                           
         CR    R2,R0                                                            
         BE    EZMP44                                                           
         LA    R0,EZIHAPID                                                      
         CR    R2,R0                                                            
         BE    EZMP44                                                           
         BNE   EZMP46                                                           
*                                                                               
EZMP44   DS    0H                  REPORT 5 - MISSING PRODUCTS                  
         MVI   GLOPT5,C'Y'                                                      
         MVI   RPTNO,5                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT5,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                                                               
EZMP46   DS    0H                                                               
         LA    R0,EZSPCOPY         TEST COMMERCIAL FIELD                        
         CR    R2,R0                                                            
         BNE   EZMP74                                                           
*                                  REPORT 6 - MISSING FILMS                     
         MVI   GLOPT6,C'Y'                                                      
         MVI   RPTNO,6                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT6,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 7 - FILM/PROD ERRORS                  
EZMP50   DS    0H                                                               
         MVI   GLOPT7,C'Y'                                                      
         MVI   RPTNO,7                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT7,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 8 - ADDED FILMS                       
EZMP60   DS    0H                                                               
         MVI   GLOPT8,C'Y'                                                      
         MVI   RPTNO,8                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT8,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                  REPORT 9 - DATA ERRORS                       
EZMP70   CLI   QOPT1,C'X'          PRODUCE DATA ERROR REPORT                    
         BNE   EZMP90               NO                                          
*                                                                               
EZMP74   DS    0H                                                               
         MVI   GLOPT9,C'Y'                                                      
         MVI   RPTNO,9                                                          
         MVI   ACTVSW,C'Y'         SET HAVE ACTIVITY                            
         MVI   GLMODE,GLINPUT                                                   
         GOTO1 ADRIVER,DMCB,GLOBALD                                             
         MVI   GLOPT9,C'N'         DE-ACTIVATE                                  
         B     EZMP90                                                           
*                                                                               
*                                  REPORT 10 - DELETED INVOICES                 
EZMP90   DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
*        DRIVER HOOK ROUTINE                                                    
*                                                                               
DRHOOK   NTR1                                                                   
         CLI   GLHOOK,GLROUT       TEST TO EXECUTE USER ROUTINE                 
         BNE   DH005                                                            
         CLI   GLMODE,GLINPUT      YES - INPUT PHASE                            
         BE    DH100                                                            
         CLI   GLMODE,GLOUTPUT           OUTPUT PHASE                           
         BE    DH200                                                            
         DC    H'0'                                                             
*                                                                               
DH005    CLI   GLHOOK,GLRESOLV     TEST TO RESOLVE LABELS                       
         BE    DH010                                                            
         CLI   GLHOOK,GLRESLIT     TEST TO RESOLVE LITERAL                      
         BE    DH300                                                            
         CLI   GLHOOK,GLHEAD       HEADLINES                                    
         BE    DH400                                                            
         CLI   GLHOOK,GLPUTSRT     RECORD INPUT TEST                            
         BE    DH450                                                            
         B     EXIT                                                             
*                                                                               
*                                                                               
*        RESOLVE ROUTINE LABELS                                                 
*                                                                               
DH010    LA    R1,ROUTLIST                                                      
         LA    R2,GLLABEL                                                       
*                                                                               
DH020    CLI   0(R1),X'FF'                                                      
         BE    EXIT                                                             
         CLC   0(8,R1),0(R2)                                                    
         BE    DH030                                                            
         LA    R1,12(R1)                                                        
         B     DH020                                                            
*                                                                               
DH030    MVC   GLAROUT,8(R1)                                                    
         B     EXIT                                                             
*                                                                               
ROUTLIST DS    0F                                                               
         DC    C'WBMGR   ',A(WBMGR)                                             
         DC    C'WBMKT   ',A(WBMKT)                                             
         DC    C'WBSTA   ',A(WBSTA)                                             
         DC    C'WBDATE  ',A(WBDATE)                                            
*        DC    C'WBTIME  ',A(WBTIME)                                            
         DC    C'WICLTN  ',A(WICLTN)                                            
         DC    C'WIPRDN  ',A(WIPRDN)                                            
         DC    C'WINVNO  ',A(WINVNO)                                            
         DC    C'WMOS    ',A(WMOS)                                              
         DC    C'WIEST   ',A(WIEST)                                             
         DC    C'WIGRS   ',A(WIGRS)                                             
         DC    C'WSRC    ',A(WSRC)                                              
         DC    C'WCMNT   ',A(WCMNT)                                             
         DC    C'WNCREAS ',A(WNCREAS)                                           
         DC    C'WCDATE  ',A(WCDATE)                                            
         DC    C'WIFILM  ',A(WIFILM)                                            
         DC    C'WERRCD  ',A(WERRCD)                                            
         DC    C'WERRREC ',A(WERRREC)                                           
         DC    C'WERRFLD ',A(WERRFLD)                                           
         DC    C'WERRMSG ',A(WERRMSG)                                           
         DC    C'WERRDTA ',A(WERRDTA)                                           
         DC    C'RBSTA   ',A(RBSTA)                                             
         DC    C'RBMGR   ',A(RBMGR)                                             
         DC    C'RBMKT   ',A(RBMKT)                                             
         DC    C'RBDATE  ',A(RBDATE)                                            
*        DC    C'RBTIME  ',A(RBTIME)                                            
         DC    X'FF'                                                            
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*        EXECUTE INPUT PHASE ROUTINES                                           
*                                                                               
DH100    L     RF,GLAROUT                                                       
         L     R3,GLAIFLD                                                       
         BASR  RE,RF                                                            
         DC    H'0'                                                             
*                                                                               
*                                                                               
*        EXECUTE OUTPUT PHASE ROUTINES                                          
*                                                                               
DH200    DS    0H                                                               
         L     RF,GLAROUT                                                       
         L     R2,GLAIFLD                                                       
         L     R3,GLAOFLD                                                       
         LTR   R3,R3               IF OUTPUT FIELD NOT GIVEN                    
         BNZ   *+8                                                              
         LA    R3,WORK             USE WORK                                     
         BASR  RE,RF                                                            
         DC    H'0'                                                             
*                                                                               
*       INPUT ROUTINES                                                          
*                                                                               
WBMGR    DS    0H                  MARKET GROUP                                 
*                                                                               
* RUN Z6 FOR MSNYA BY MARKET                                                    
*                                                                               
         CLC   =C'H7',AGENCY       IF MINDSHARE                                 
         BNE   WBMGR10                                                          
*                                                                               
         CLC   QPROG,=C'Z6'        THIS THE Z6 ACTIVITY REPORT                  
         BE    EXIT                 NO                                          
*                                                                               
WBMGR10  DS    0H                  MARKET GROUP                                 
         B     EXIT                                                             
*                                                                               
WBMKT    DS    0H                  MARKET                                       
         XC    0(2,R3),0(R3)                                                    
         B     EXIT                                                             
*                                                                               
WBSTA    DS    0H                  BATCH STATION                                
         MVC   0(5,R3),SVREPSTA                                                 
*                                                                               
         OC    EZEQVSTA,EZEQVSTA    ARE THERE NEW CALL LETTERS                  
         BNZ   WBSTA16                                                          
*                                                                               
         B     WBSTA20                                                          
*                                                                               
WBSTA16  DS    0H                  BATCH STATION                                
         MVC   0(5,R3),EZEQVSTA                                                 
         B     WBSTA20              YES                                         
*                                                                               
WBSTA20  DS    0H                  BATCH STATION                                
         CLI   EZSPTNET,C'S'       NO LOCAL CABLE UNLESS SPOT                   
         BNE   EXIT                                                             
         CLI   EQVSTAW,C'0'        AND MUST BE NUMERIC                          
         BL    EXIT                                                             
*                                                                               
         OC    EZIHNET,EZIHNET     CABLE HEAD NETWORK                           
         BZ    EXIT                 NO                                          
         MVI   4(R3),C'/'                                                       
         MVC   5(3,R3),EZIHNET                                                  
         B     EXIT                                                             
*                                                                               
WBDATE   DS    0H                  BATCH DATE                                   
         GOTO1 DATCON,DMCB,(3,EZBTBRDT),(1,0(R3))   PWOS                        
         B     EXIT                                                             
*                                                                               
*BTIME   DS    0H                  BATCH TIME                                   
*        MVC   0(2,R3),EZBTBRTM                                                 
*        B     EXIT                                                             
*                                                                               
WICLTN   DS    0H                  INVOICE CLIENT NAME                          
         MVC   0(25,R3),EZIHADVN                                                
         CLI   EZIHADVN,C' '                                                    
         BH    *+14                                                             
         MVC   0(9,R3),=C'*MISSING*'                                            
         B     EXIT                                                             
*                                                                               
         LA    RF,25(R3)           FLOAT CODE AS (XXX)                          
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVI   2(RF),C'('                                                       
         MVC   3(3,RF),EZIHLADC                                                 
         CLC   3(3,RF),SPACES      IF NO CODE                                   
         BH    *+10                                                             
         MVC   3(3,RF),=C'***'     SET TO ***                                   
         LA    RE,6(RF)                                                         
         CLI   5(RF),C' '                                                       
         BH    *+6                                                              
         BCTR  RE,R0                                                            
         MVI   0(RE),C')'                                                       
*                                                                               
         OC    0(35,R3),SPACES                                                  
         B     EXIT                                                             
*                                                                               
WIPRDN   DS    0H                  PRODUCT NAME                                 
         CLI   GLRECNO,5           IF MISSING PRD REPORT                        
         BNE   WIPRDN4                                                          
*                                                                               
         MVC   0(25,R3),EZERRDTA   USE ERROR FIELD                              
         B     EXIT                                                             
*                                                                               
WIPRDN4  DS    0H                                                               
         MVC   0(25,R3),EZIHPRDN   ELSE USE INVOICE PRD                         
         CLI   EZIHPRDN,C' '                                                    
         BH    WIPRDN6                                                          
         MVC   0(7,R3),=C'**ALL**'                                              
         CLI   GLRECNO,8           'ALL' FOR ADDED FILM LIST                    
         BE    EXIT                                                             
         MVC   0(9,R3),=C'*MISSING*'                                            
         B     EXIT                                                             
*                                                                               
* SHOW PROD, PROD2, EST AS (XXX,YYY,EST)                                        
*                                                                               
WIPRDN6  DS    0H                                                               
         LA    RF,25(R3)           FLOAT CODE AS (XXX)                          
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         MVI   2(RF),C'('                                                       
         MVC   3(3,RF),EZIHLPRC                                                 
         CLC   3(3,RF),SPACES      IF NO CODE                                   
         BH    *+10                                                             
         MVC   3(3,RF),=C'***'     SET TO ***                                   
         LA    RE,6(RF)                                                         
         CLI   5(RF),C' '                                                       
         BH    *+6                                                              
         BCTR  RE,R0                                                            
*                                                                               
         CLC   EZIHLP2C,SPACES                                                  
         BNH   WIPRDN8                                                          
         LR    RF,RE                                                            
         MVI   0(RE),C','                                                       
         MVC   1(3,RE),EZIHLP2C                                                 
         LA    RE,4(,RE)                                                        
         CLI   3(RF),C' '                                                       
         BH    *+6                                                              
         BCTR  RE,R0                                                            
*                                                                               
WIPRDN8  DS    0H                                                               
         CLI   EZIHLEST,0                                                       
         BE    WIPRDN9                                                          
         LR    RF,RE                                                            
         MVI   0(RE),C','                                                       
         ZIC   R0,EZIHLEST                                                      
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  1(3,RE),DUB                                                      
         LA    RE,4(,RE)                                                        
*                                                                               
WIPRDN9  DS    0H                                                               
         MVI   0(RE),C')'                                                       
*                                                                               
         OC    0(35,R3),SPACES                                                  
         B     EXIT                                                             
*                                                                               
WINVNO   DS    0H                  INVOICE NUMBER                               
         MVC   0(10,R3),EZIHINV                                                 
         CLC   EZIHINV,SPACES                                                   
         BNE   EXIT                                                             
         MVC   0(3,R3),=C'***'     NO INV = ***                                 
         B     EXIT                                                             
*                                                                               
WMOS     DS    0H                  INVOICE MONTH OF SERVICE                     
         MVC   0(2,R3),EZIHBMOS                                                 
         MVI   2(R3),0                                                          
         B     EXIT                                                             
*                                                                               
WIEST    DS    0H                  INVOICE ESTIMATE NUMBER                      
         MVC   0(1,R3),EZIHBEST                                                 
         CLI   EZIHBEST,0          WAS CONVERTED EST ZERO                       
         BNE   EXIT                 NO                                          
         CLI   EZMODE,EZERRP       PROCESS ERROR                                
         BNE   EXIT                                                             
         TM    EZIHCVST,EZIHCOVR   CLIENT OVERRIDE PRESENT                      
         BO    EXIT                 YES, DON'T FIND EST                         
*                                                                               
* SEE IF ANY EST IN 10 CHAR EST FIELD                                           
*                                                                               
         LA    RE,EZIHEST                                                       
         LA    RF,3                                                             
         LA    R1,WORK                                                          
         MVC   WORK(3),=C'000'                                                  
WIEST10  CLI   0(RE),C'0'                                                       
         BL    WIEST14                                                          
         CLI   0(RE),C'9'                                                       
         BH    WIEST14                                                          
         MVC   0(1,R1),0(RE)                                                    
         LA    R1,1(,R1)                                                        
         LA    RE,1(,RE)                                                        
         BCT   RF,WIEST10                                                       
WIEST14  CLC   WORK(3),=C'000'                                                  
         BE    EXIT                                                             
         PACK  DUB,WORK(3)                                                      
         CVB   R0,DUB                                                           
         STC   R0,0(R3)                                                         
         B     EXIT                                                             
*                                                                               
WIGRS    DS    0H                  INVOICE GROSS TOTAL                          
         L     RF,EZIHTSPC         SPOT TOTALS                                  
         ST    RF,0(R3)                                                         
         B     EXIT                                                             
*                                                                               
WSRC     DS    0H                  SOURCE                                       
         MVC   0(4,R3),SVWKDESC+EZWCSRCE-EZWKRCMD                               
*        LA    RE,SVWFREC0                                                      
*        LA    RF,W_DESC-W_RECD(RE)                                             
*        MVC   0(4,R3),EZWCSRCE-EZWKRCMD(RF)                                    
         B     EXIT                                                             
*                                                                               
WCMNT    DS    0H                  COMMENT ON CONVERTED INVOICE                 
         MVC   0(80,R3),SPACES                                                  
*                                                                               
         LA    RF,11(,RF)                                                       
         MVC   0(9,R3),=C'CONTRACT='                                            
*                                                                               
         LA    R1,EZBLOCKD                                                      
         AHI   R1,EZBLKX-EZBLOCKD                                               
         USING EZBLKX,R1                                                        
         MVC   SVINVTYP,EZIHRTYP                                                
         DROP  R1                                                               
*                                                                               
         CLI   SVINVTYP,X'00'                                                   
         BE    WCMNT45                                                          
*                                                                               
         CLI   SVINVTYP,C'R'                                                    
         BNE   *+14                                                             
         MVC   9(8,R3),EZIHRORD                                                 
         B     EXIT                                                             
*                                                                               
         CLI   SVINVTYP,C'S'                                                    
         BNE   *+14                                                             
         MVC   9(10,R3),EZIHSORD                                                
         B     EXIT                                                             
*                                                                               
WCMNT45  DS   0H                                                                
         MVC   9(10,R3),EZIHRORD                                                
         OC    EZIHRORD,EZIHRORD   WAS THERE A REP CONTRACT #                   
         BNZ   WCMNT50              YES                                         
         MVC   9(10,R3),EZIHSORD   USE STATION                                  
*                                                                               
WCMNT50  DS   0H                                                                
         OC    EZREPCON,EZREPCON   WAS THERE A DEVELOPED CONTRACT?              
         BZ    WCMNT60                                                          
         MVC   DUB+3(4),EZREPCON                                                
         MVI   DUB+7,X'0F'                                                      
         SP    DUB+3(5),=PL5'999999999'                                         
         UNPK  9(8,R3),DUB+3(5)                                                 
         MVC   16(3,R3),SPACES                                                  
*                                                                               
WCMNT60  DS   0H                                                                
         OC    EZIHTRAF,EZIHTRAF   WAS THERE A TRAFFIC ORDER #                  
         BZ    EXIT                 NO                                          
*                                                                               
         CLC   EZIHTRAF,SPACES     WAS THERE A TRAFFIC ORDER #                  
         BE    EXIT                 NO                                          
*                                                                               
         MVC   20(3,R3),=C'TO='                                                 
         MVC   23(10,R3),EZIHTRAF  PRIINT TRAFFIC ORDER #                       
*        MVC   22(10,R3),EZIHRORD  PRIINT TRAFFIC ORDER #                       
*                                                                               
*        MVC   WORK(4),EZREPCON                                                 
*        MVI   WORK+4,X'0F'                                                     
*                                                                               
*        ZAP   DUB,=P'999999999'                                                
*        SP    DUB,WORK(5)                                                      
*        UNPK  WORK+5(9),DUB+3(5)                                               
*        MVC   9(8,R3),WORK+5                                                   
*        MVC   18(2,R3),SPACES                                                  
*                                                                               
         LA    RF,12(,RF)                                                       
         B     EXIT                                                             
*                                                                               
WNCREAS  DS    0H                  REASON FOR NO CONVERSION                     
         MVC   0(40,R3),EZERRMSG                                                
         B     EXIT                                                             
*                                                                               
WCDATE   DS    0H                  DATE OF PREVIOUS CONVERSION                  
         MVC   0(3,R3),EZIHCVDT                                                 
         B     EXIT                                                             
*                                                                               
WIFILM   DS    0H                  FILM CODE                                    
         MVC   0(25,R3),EZSPCOPY   SHOW FILM OCDE(S) AS RECEIVED                
         OC    0(25,R3),SPACES     (EZERRDTA USED EVEN FOR EZCMLADD)            
         B     EXIT                                                             
*                                                                               
WERRCD   DS    0H                  ERROR CODE                                   
         MVC   0(1,R3),EZERRCD                                                  
         B     EXIT                                                             
*                                                                               
WERRREC  DS    0H                  ERROR RECORD                                 
         MVC   0(20,R3),EZERRREC                                                
         B     EXIT                                                             
*                                                                               
WERRFLD  DS    0H                  ERROR FIELD                                  
         MVC   0(20,R3),EZERRFLD                                                
         B     EXIT                                                             
*                                                                               
WERRMSG  DS    0H                  ERROR MESSAGE                                
         MVC   0(40,R3),EZERRMSG                                                
         B     EXIT                                                             
*                                                                               
WERRDTA  DS    0H                  ERROR DATA                                   
         MVC   0(30,R3),EZERRDTA                                                
         OC    0(30,R3),SPACES                                                  
         B     EXIT                                                             
*                                                                               
*        OUTPUT ROUTINES                                                        
*                                                                               
RBSTA    DS    0H                                                               
         MVC   0(8,R3),0(R2)                                                    
         CLC   SVBSTA,0(R2)        SAME STATION                                 
         BE    EXIT                                                             
         MVC   SVBSTA,0(R2)        SAVE STATION                                 
         B     EXIT                                                             
*                                                                               
         CLI   GLRECNO,1           CONVERTED                                    
         BE    RBSTA10                                                          
         CLI   GLRECNO,2           UNCONVERTIBLE                                
         BE    RBSTA10                                                          
         CLI   GLRECNO,3           PREVIOUSLY CONVERTED                         
         BNE   EXIT                                                             
RBSTA10  DS    0H                                                               
*        GOTO1 GLAFMID                                                          
         L     RF,GLAFMID                                                       
         BASR  RE,RF                                                            
         OI    GLINDS2,GLMIDHED                                                 
         B     EXIT                                                             
*                                                                               
RBMGR    DS    0H                                                               
         MVC   SVMGRP,0(R2)        SAVE MKT GRP SCHEME                          
         MVC   0(5,R3),SVMGRP                                                   
         B     EXIT                                                             
*                                                                               
RBMKT    DS    0H                                                               
         SR    R0,R0                                                            
         ICM   R0,3,0(R2)                                                       
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(4,R3),DUB                                                      
         MVC   SVSMKT,0(R3)        SAVE MARKET                                  
         MVC   SVBMKT,0(R2)                                                     
         B     EXIT                                                             
*                                                                               
RBDATE   DS    0H                                                               
         GOTO1 DATCON,DMCB,(1,0(R2)),(8,SVBDATE)                                
         MVC   0(8,R3),SVBDATE                                                  
         B     EXIT                                                             
*                                                                               
*BTIME   DS    0H                                                               
*        ZIC   R0,0(R2)               HOURS                                     
*        EDIT  (R0),(2,SVBTIM),FILL=0                                           
*        ZIC   R0,1(R2)               MINUTES                                   
*        EDIT  (R0),(2,SVBTIM+2),FILL=0                                         
*        MVC   0(4,R3),SVBTIM                                                   
*        B     EXIT                                                             
*                                                                               
*        RESOLVE LITERALS                                                       
*                                                                               
DH300    DS    0H                                                               
         DC    H'0'                                                             
*                                                                               
*        HEADLINE ROUTINE                                                       
*                                                                               
DH400    DS    0H                                                               
         MVC   HEAD1+40(55),SPACES  CLEAR TITLE                                 
*                                                                               
         CLI   EZTEST,C'Y'                                                      
         BE    *+12                                                             
         CLI   EZWRITE,C'N'                                                     
         BNE   *+10                                                             
         MVC   HEAD6+50(29),=CL29'** REPORT ONLY - NO UPDATE **'                
*                                                                               
         CLI   EZTEST,C'Y'                                                      
         BNE   *+10                                                             
         MVC   HEAD5+80(3),=C'(T)'                                              
         CLI   EZWRITE,C'N'                                                     
         BNE   *+10                                                             
         MVC   HEAD5+85(3),=C'(W)'                                              
*                                                                               
         MVC   HEAD1+50(7),=C'EASI - '                                          
*                                                                               
         CLI   GLRECNO,1           CONVERTED INVOICES                           
         BNE   DH404                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         CLI   QOPT1,C'X'                                                       
         BE    DH402                                                            
         CLI   QOPT1,C'Y'                                                       
         BE    DH402                                                            
         MVC   HEAD1+57(9),=C'CONVERTED'                                        
         MVC   HEAD1+67(14),=C'INVOICE REPORT'                                  
         MVC   HEAD2+50(31),DASHES                                              
         B     DH440                                                            
DH402    MVC   HEAD1+57(11),=C'CONVERTIBLE'                                     
         B     DH406                                                            
*                                                                               
DH404    DS    0H                                                               
         CLI   GLRECNO,2           UNCONVERTED INVOICES                         
         BNE   DH408                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+57(11),=C'UNCONVERTED'                                     
DH406    MVC   HEAD1+69(14),=C'INVOICE REPORT'                                  
         MVC   HEAD2+50(33),DASHES                                              
         B     DH440                                                            
*                                                                               
DH408    DS    0H                                                               
         CLI   GLRECNO,3           PREVIOUSLY CONVERTED                         
         BNE   DH412                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+57(29),=C'PREVIOUSLY CONVERTED INVOICES'                   
         MVC   HEAD2+50(36),DASHES                                              
         B     DH440                                                            
*                                                                               
DH412    DS    0H                                                               
         CLI   GLRECNO,4           MISSING CLIENT REPORT                        
         BNE   DH416                                                            
*                                                                               
         MVC   HEAD1+57(19),=C'MISSING CLIENT LIST'                             
         MVC   HEAD2+50(26),DASHES                                              
         B     DH440                                                            
*                                                                               
DH416    DS    0H                                                               
         CLI   GLRECNO,5           MISSING PRODUCT REPORT                       
         BNE   DH420                                                            
*                                                                               
         MVC   HEAD1+57(20),=C'MISSING PRODUCT LIST'                            
         MVC   HEAD2+50(27),DASHES                                              
         B     DH440                                                            
*                                                                               
DH420    DS    0H                                                               
         CLI   GLRECNO,6           MISSING FILM REPORT                          
         BNE   DH424                                                            
*                                                                               
         MVC   HEAD1+45(07),=C'EASI - '                                         
         MVC   HEAD1+52(23),=C'MISSING COMMERCIAL LIST'                         
         MVC   HEAD2+45(30),DASHES                                              
         B     DH440                                                            
*                                                                               
DH424    DS    0H                                                               
         CLI   GLRECNO,7           FILM/PRODUCT ERROR REPORT                    
         BNE   DH428                                                            
*                                                                               
         MVC   HEAD1+45(07),=C'EASI - '                                         
         MVC   HEAD1+52(29),=C'COMMERCIAL/PRODUCT ERROR LIST'                   
         MVC   HEAD2+45(36),DASHES                                              
         B     DH440                                                            
*                                                                               
DH428    DS    0H                                                               
         CLI   GLRECNO,8           ADDED FILM LIST                              
         BNE   DH432                                                            
*                                                                               
         MVC   HEAD1+45(07),=C'EASI - '                                         
         MVC   HEAD1+52(25),=C'LIST OF ADDED COMMERCIALS'                       
         MVC   HEAD2+45(32),DASHES                                              
         B     DH440                                                            
*                                                                               
DH432    DS    0H                                                               
         CLI   GLRECNO,9           DATA ERROR REPORT                            
         BNE   DH434                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+57(17),=C'DATA ERROR REPORT'                               
         MVC   HEAD2+50(24),DASHES                                              
DH434    DS    0H                                                               
         CLI   GLRECNO,10          DELETED INVOICES REPORT                      
         BNE   DH440                                                            
*                                                                               
         BRAS  RE,SETHDG                                                        
         MVC   HEAD1+47(07),=C'EASI - '                                         
         MVC   HEAD1+54(23),=C'DELETED INVOICES REPORT'                         
         MVC   HEAD2+47(30),DASHES                                              
*                                                                               
DH440    DS    0H                                                               
         GOTO1 DATCON,DMCB,(0,QSTART),(5,HEAD3+57)                              
*                                                                               
         MVI   HEAD3+65,C'-'                                                    
*                                                                               
         GOTO1 (RF),(R1),(0,QEND),(5,HEAD3+66)                                  
*                                                                               
DH460    DS    0H                                                               
         B     EXIT                                                             
*                                                                               
         GETEL (R6),DATADISP,ELCODE                                             
*                                                                               
*        INPUT TEST - PASS TO SORT OR NOT                                       
*                                                                               
DH450    DS    0H                                                               
         CLC   GLRECNO,RPTNO       IF NOT RIGHT RECORD                          
         BE    EXIT                                                             
         MVI   GLHOOK,GLDONT       DON'T PUT TO SORT                            
*                                  NOTE- SCHEME INVOLVING GLOPTS                
*                                  NEVER WORKED BECAUSE IN DPG                  
*                                  RECORD CONDITION DONT APPLY                  
*                                  TO FIELDS                                    
         B     EXIT                                                             
*                                                                               
*                                                                               
DIV      DIV   (R0),(RF)       RETURNS VIA RE                                   
         LTORG                                                                  
UNKNNET  DS    CL40'UNKNOWN NET FOR CABLE STATION'                              
NETINACT DC    CL40'NET NOT ACTIVE FOR CABLE STATION'                           
CABSTANF DC    CL40'CABLE STATION NOT FOUND'                                    
         DROP  RB,RC                                                            
*                                                                               
* CHECK CALL LETTERS TO BE REASONABLE *                                         
*                                                                               
CKSTA    NMOD1 0,**CKSTA*                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
         LA    R0,4                ALL 4 LETTERS                                
         LA    R1,EQVSTAW                                                       
         CLI   EQVSTAW,C'0'        THIS A CABLE STATOIN?                        
         BNL   CKSTA30              YES                                         
*                                                                               
* SEE IF THIS IS ALPHA                                                          
*                                                                               
         LA    R0,3                FIRST 3 LETTERS                              
CKSTA10  CLI   0(R1),C'A'                                                       
         BL    CKSTAERR                                                         
         CLI   0(R1),C'Z'                                                       
         BH    CKSTAERR                                                         
         LA    R1,1(,R1)                                                        
         BCT   R0,CKSTA10                                                       
*                                                                               
         CLI   0(R1),C' '          THIS A 3 LETTER STATION                      
         BE    CKSTA50                                                          
*                                                                               
         CLI   0(R1),C'A'                                                       
         BL    CKSTAERR                                                         
         CLI   0(R1),C'Z'                                                       
         BH    CKSTAERR                                                         
         B     CKSTA50                                                          
*                                                                               
CKSTA30  DS    0H                                                               
         CLI   0(R1),C'0'                                                       
         BL    CKSTAERR                                                         
         CLI   0(R1),C'9'                                                       
         BH    CKSTAERR                                                         
         LA    R1,1(,R1)                                                        
         BCT   R0,CKSTA30                                                       
*                                                                               
CKSTA50  DS    0H                                                               
         CLI   EQVSTAW+4,C'T'      ONLY TV OKAY FOR NOW                         
         BE    CKSTAEQ                                                          
*                                                                               
CKSTAERR DS    0H                                                               
         LTR   RB,RB               SET CC NE                                    
         B     CKSTAX                                                           
*                                                                               
CKSTAEQ  DS    0H                                                               
         CR    R0,R0               SET CC EQ                                    
CKSTAX   DS    0H                                                               
         XIT1                                                                   
         DROP  RB,RC                                                            
*                                                                               
* READ  DSTATION REC FROM CONTROL FILE TO SEE IF REP HAS STATION*               
*                                                                               
CKREP    NMOD1 0,**CKREP*                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         XC    EZEQVSTA,EZEQVSTA                                                
*                                                                               
         CLI   SVREPSTA+4,C'T'     ONLY TV FOR NOW                              
         BNE   CKREPNE                                                          
*                                                                               
* SEE IF IN TABLE ALREADY                                                       
*                                                                               
         LHI   R0,REPSTATL                                                      
         L     R3,=A(REPSTATB)                                                  
         SR    R4,R4                                                            
         USING RSTATBD,R3                                                       
*                                                                               
CKREP010 DS    0H                                                               
         OC    RSTAENT,RSTAENT     EMPTY ENTRY                                  
         BZ    CKREP030       STATION NOT IN TABLE, LOOK UP DSTA RECORD         
*                                                                               
         CLC   SVREPSTA,RSTACALL   THIS SAME STATION                            
         BE    CKREP020                                                         
*                                                                               
         LA    R3,RSTANXT                                                       
         BCTR  R4,0                                                             
         BCT   R0,CKREP010                                                      
         DC    H'0'                                                             
*                                                                               
* CHECK FOR PREV REP DATE                                                       
*                                                                               
CKREP020 DS   0H                                                                
         OC    RSTADTR,RSTADTR     ANY DATE                                     
         BZ    CKREP024             CK TO CURRENT REP                           
*                                                                               
         OC    RSTAREPP,RSTAREPP   ANY PREVIOUS REP                             
         BZ    CKREP024             CK TO CURRENT REP                           
*                                                                               
* COMPARE TO USER DATA (YR/MO) OF MOS                                           
* 10/06/2015 - UKUDATA NO LONGER USED                                           
* CHANGING CODE TO USE WORKIO'S MOS INSTEAD                                     
*&&DO                                                                           
         MVC   WORK(2),UKUDATA-UKRECD+EZWKRIND                                  
         TM    WORK,X'F0'                                                       
         BZ    CKREP023                                                         
*                                                                               
         MVC   BYTE,WORK                                                        
         BRAS  RE,NEW2OLD                                                       
         MVC   WORK(2),HALF                                                     
*                                                                               
CKREP023 DS    0H                                                               
         NI    WORK,X'0F'          TURN OFF HIGH ORDER 4 BITS                   
         OI    WORK,X'A0'          YEARS ABOVE 2000                             
         CLC   RSTADTR,WORK                                                     
*&&                                                                             
         LAY   R1,EZWRKIOB                                                      
         CLC   RSTADTR,WRKEZMOS-WRKIOD(R1)                                      
*                                                                               
         BL    CKREP024            CK TO CURRENT REP                            
         BH    CKREP026            CK TO PRIOR REP                              
*                                                                               
* PUT TO BOTH REPS IF THIS MOS                                                  
*                                                                               
         CLC   AGENCY,RSTAREP      THIS FOR THIS REP                            
         BE    CKREPEQ                                                          
         CLC   AGENCY,RSTAREPP     THIS FOR PRIOR REP                           
         BE    CKREPEQ                                                          
         B     CKREPNE                                                          
*                                                                               
CKREP024 DS   0H                                                                
         CLC   AGENCY,RSTAREP      THIS FOR THIS REP                            
         BNE   CKREPNE                                                          
         B     CKREP028                                                         
*                                                                               
CKREP026 DS   0H                                                                
         CLC   AGENCY,RSTAREPP     THIS FOR PRIOR REP                           
         BNE   CKREPNE                                                          
*                                                                               
* NOW SEE IF STATION RENAME                                                     
*                                                                               
CKREP028 DS   0H                                                                
         OC    RSTADTS,RSTADTS     ANY DATE                                     
         BZ    CKREPEQ              NO, BYPASS                                  
*                                                                               
* 10/06/2015 UKUDATA NO LONGER USED                                             
* CHANGING CODE TO LOOK AT WORKIO'S WRKEZMOS                                    
*&&DO                                                                           
         MVC   WORK(2),UKUDATA-UKRECD+EZWKRIND                                  
         TM    WORK,X'F0'                                                       
         BZ    CKREP029                                                         
*                                                                               
         MVC   BYTE,WORK                                                        
         BRAS  RE,NEW2OLD                                                       
         MVC   WORK(2),HALF                                                     
*                                                                               
CKREP029 DS    0H                                                               
         NI    WORK,X'0F'          TURN OFF HIGH ORDER 4 BITS                   
         OI    WORK,X'A0'          YEAR 2000 AND ABOVE                          
         CLC   RSTADTS,WORK                                                     
*&&                                                                             
*                                                                               
         LAY   R1,EZWRKIOB                                                      
         CLC   RSTADTS,WRKEZMOS-WRKIOD(R1)                                      
         BH    CKREPEQ                                                          
*                                                                               
         MVC   EZEQVSTA,RSTANEW    MAY BE NULLS OR STATION RENAME               
         B     CKREPEQ                                                          
*                                                                               
* NOW LOOK UP DSTA RECORD                                                       
*                                                                               
CKREP030 DS    0H                                                               
         L     RF,UTL                                                           
         MVI   4(RF),X'0A'         SET TO CTFILE                                
*                                                                               
         XC    MPLKEY,MPLKEY                                                    
         MVI   MPLKEY+1,X'5A'      MOVE IN RECORD TYPE                          
         MVI   MPLKEY+18,C'T'                                                   
         MVC   MPLKEY+19(5),SVREPSTA                                            
*                                                                               
         MVC   RSTACALL,SVREPSTA   PUT CALL LETTERS IN THE TABLE                
*                                                                               
         MVC   MPLKEYSV(40),MPLKEY                                              
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMRDHI),=C'GENDIR',MPLKEY,MPLKEY           
         CLC   MPLKEY(24),MPLKEYSV                                              
         BE    CKREP034                                                         
*                                                                               
* PUT IN TABLE WITH NULL REP TO SAVE FURTHER I/O                                
*                                                                               
CKREP032 DS    0H                                                               
         XC    RSTAREP,RSTAREP                                                  
         B     CKREPNE                                                          
*                                                                               
CKREP034 DS    0H                                                               
         L     R6,ADBUY                                                         
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),=C'GENFIL',MPLKEY+36,     X        
               (R6),DMWORK                                                      
         CLC   MPLKEY(24),0(R6)                                                 
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LA    R6,42(,R6)                                                       
         CLI   0(R6),X'10'                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
* PUT POWER CODE IN TABLE HERE                                                  
*                                                                               
         USING STAREPD,R6                                                       
         USING RSTATBD,R3                                                       
*                                                                               
* CHECK IF THIS IS AN EI STATION                                                
*                                                                               
         TM    STAREPFG,STAREPFG_EI THIS STA OKAY TO CONVERT?                   
         BZ    CKREP032   BZ         NO, NOT ALLOWED                            
*                                                                               
         CLC   STAREPCR,SVREPCOD                                                
         BNE   *+10                                                             
         MVC   RSTAREP,AGENCY      PUT CURRENT REP IN TABLE                     
*                                                                               
         OC    STAREPED,STAREPED   IS THERE A PREV REP DATE                     
         BZ    CKREP036                                                         
*                                                                               
         GOTO1 DATCON,DMCB,(6,STAREPED),(X'21',FULL)                            
*                                                                               
         MVC   RSTADTR,FULL        PUT REP EFF DATE IN TABLE                    
*                                                                               
         CLC   STAREPPR,SVREPCOD                                                
         BNE   *+10                                                             
         MVC   RSTAREPP,AGENCY     PUT PREV REP IN THE TABLE                    
*                                                                               
CKREP036 DS    0H                                                               
         CLC   AGENCY,RSTAREP      SEE IF THIS REP                              
         BNE   CKREPNE                                                          
*                                                                               
         MVI   ELCODE,X'20'                                                     
         BRAS  RE,NEXTEL           SEE IF STATION RENAME                        
         BNE   CKREP020                                                         
*                                                                               
         DROP  R6                                                               
         USING STASTAD,R6                                                       
*                                                                               
         MVC   RSTANEW,STASTA      NEW STA CALL LETTERS                         
*                                                                               
         MVC   EZEQVSTA,STASTA                                                  
         GOTO1 DATCON,DMCB,(6,STASTADT),(X'21',FULL)                            
*                                                                               
         MVC   RSTADTS,FULL        DATE OF TRANSFER TO NEW STA                  
*                                                                               
         B     CKREP020                                                         
*                                                                               
CKREPEQ  DS   0H                                                                
         L     RF,UTL                                                           
         MVC   4(1,RF),SPOTSE      SET TO SPOT FILE                             
         CR    R0,R0               SET CC EQ                                    
         B     CKREPX                                                           
*                                                                               
CKREPNE  DS   0H                                                                
         L     RF,UTL                                                           
         MVC   4(1,RF),SPOTSE      SET TO SPOT FILE                             
         LTR   RB,RB                                                            
*                                                                               
CKREPX   DS    0H                                                               
         XIT1                                                                   
         DROP  R3,R6,RB,RC                                                      
*                                                                               
*        SET STATION/BATCH DATA                                                 
*                                                                               
SETHDG   NMOD1 0,**+SET**                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
SETHDGX  XIT1                                                                   
         DROP  RB,RC                                                            
         LTORG                                                                  
*                                                                               
* INITIALIZE TSAROFF                                                            
*                                                                               
INITSROF NMOD1 0,INITSROF                                                       
*                                                                               
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         XC    TSARBYTE,TSARBYTE                                                
*                                                                               
         L     R0,=F'200000'        ROOM FOR 1,000 REQUESTS                     
         ST    R0,TSARBUFL                                                      
         GETMAIN RC,LV=(0),LOC=(ANY,ANY)                                        
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
         ST    R1,TSARBUFF                                                      
*                                                                               
         LA    RE,TSARBLK                                                       
         LR    R2,RE                                                            
         LA    RF,TSARDL2                                                       
         XCEF                                                                   
         USING TSARD,R2                                                         
*                                                                               
         MVC   TSACOM,ACOMFACS                                                  
         MVI   TSKEYL,2                                                         
         MVI   TSRECL+1,199                                                     
*        OI    TSRECI,TSRVAR                                                    
         MVC   TSABUF,TSARBUFF                                                  
         MVC   TSAREC,TSARBUFL                                                  
*                                                                               
* GET ADDR OF TSAROFF                                                           
*                                                                               
         L     RE,ADCONLST                                                      
         USING SPADCONS,RE                                                      
         MVC   ATSAROFF,TSAROFF                                                 
         DROP  RE                                                               
*                                                                               
         MVI   TSOFFACT,TSAINI      SET 1ST TSAROFF FOR INIT                    
         GOTO1 ATSAROFF,(R2)                                                    
         CLI   TSERRS,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         XIT1                                                                   
         DROP  RB,RC                                                            
*                                                                               
*        OPEN ALL OUTPUT REQUEST FILES                                          
*                                                                               
INIT     NMOD1 0,**INIT**                                                       
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         L     RE,=A(LOCTAB)                                                    
         ICM   RF,15,=AL4(LOCTABLQ)                                             
         XCEFL                                                                  
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(19,TODAYJ)                                    
*                                                                               
         XIT1                                                                   
         DROP  RB,RC                                                            
*                                                                               
*                                                                               
*        READ STATION EQUIVALENCE RECS FROM MPL FILE CONVERT STATION *          
*                                                                               
EQVSTA   NMOD1 0,*EQVSTA*                                                       
*                                                                               
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         L     RF,=A(EQVSTATB)                                                  
         CLI   0(RF),0             WAS TABLE BUILT YET?                         
         BNE   EQVSTA60             YES                                         
*                                                                               
         L     RF,UTL                                                           
         MVI   4(RF),10                                                         
*                                                                               
EQVSTA00 XC    MPLKEY(40),MPLKEY                                                
         LA    R2,EQVSTATL/10                                                   
         L     R3,=A(EQVSTATB)                                                  
         LA    R1,MPLKEY                                                        
         USING EZSKEY,R1                                                        
         MVC   EZSKTYP,=C'ZS'                                                   
         MVC   EZSKAGY,AGENCY                                                   
         DROP  R1                                                               
*                                                                               
         MVC   MPLKEYSV(40),MPLKEY                                              
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMRDHI),=C'GENDIR',MPLKEY,MPLKEY           
         B     EQVSTA14                                                         
*                                                                               
EQVSTA10 GOTO1 DATAMGR,DMCB,(DMINBTS,DMRSEQ),=C'GENDIR',MPLKEY,MPLKEY           
*                                                                               
EQVSTA14 CLC   MPLKEY(4),MPLKEYSV                                               
         BNE   EQVSTA20                                                         
         L     R6,ADBUY                                                         
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),=C'GENFIL',MPLKEY+36,     X        
               (R6),DMWORK                                                      
*                                                                               
         LA    R6,42(,R6)                                                       
         LR    R5,R6                                                            
         ZIC   R0,1(R6)                                                         
         AR    R5,R0                                                            
         CLI   0(R5),X'22'         THIS HAVE ADVNAME ELEM                       
         BE    EQVSTA10             YES, BYPASS                                 
*                                                                               
         CLI   0(R6),02                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING EZSIDEL,R6                                                       
         MVC   0(5,R3),MPLKEY+EZSKSTA-EZSKEY                                    
         MVC   5(5,R3),EZSCALL                                                  
         LA    R3,10(,R3)                                                       
         BCT   R2,EQVSTA10                                                      
         DC    H'0'                MAKE TABLE LARGER                            
EQVSTA20 MVI   0(R3),255                                                        
         L     RF,UTL              RESTORE SE NUM                               
         MVC   4(1,RF),SAVSYS                                                   
*                                                                               
* NOW LOOK UP STATION IN TABLE, IF FIND, PUT REPLACEMENT IN RSTA                
*                                                                               
         USING EZWKRIXD,R4                                                      
EQVSTA60 MVC   EQVSTAW(4),EZWISTN                                               
*                                                                               
         CLI   EQVSTAW+3,C'.'                                                   
         BNE   *+8                                                              
         MVI   EQVSTAW+3,C' '                                                   
*                                                                               
         OC    EQVSTAW(4),SPACES                                                
         MVC   EQVSTAW+4(1),EZWIMED                                             
*                                                                               
         CLI   EZWIMED,C'C'        FORCE CABLE                                  
         BE    EQVSTA64                                                         
         CLI   EZWIMED,C'S'        AND SYNDICATION                              
         BNE   EQVSTA66                                                         
*                                                                               
EQVSTA64 MVI   EQVSTAW+4,C'N'      TO NETWORK                                   
*                                                                               
EQVSTA66 LA    RE,EQVSTATL/10                                                   
         L     RF,=A(EQVSTATB)                                                  
*                                                                               
EQVSTA70 CLI   0(RF),255           END OF TABLE                                 
         BE    EQVSTAX                                                          
         CLC   EQVSTAW,0(RF)                                                    
         BE    EQVSTA80                                                         
         LA    RF,10(,RF)                                                       
         BCT   RE,EQVSTA70                                                      
         DC    H'0'                                                             
EQVSTA80 MVC   EQVSTAW,5(RF)                                                    
*                                                                               
EQVSTAX  XIT1                                                                   
*                                                                               
         DROP  RB,RC,R4                                                         
*                                                                               
*                                                                               
BUFFRIN  BUFFD TYPE=D,                                                 X        
               KEYLEN=12,                                              X        
               COMLEN=1,                                               X        
               FILE=BUFFWK                                                      
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
* R1 EXPECTED TO ADDRESS STATION CALL LETTERS                                   
* EQUAL CONDITION CODE SET IF CALL LETTERS FOUND IN THE TABLE                   
* UNEQUAL OTHERWISE                                                             
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
CKLTAB   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         ICM   R0,15,=AL4(LOCTENTQ)               MAX NUMBER OF ENTRIES         
         L     R2,=A(LOCTAB)                                                    
         USING LOCTBD,R2                                                        
*                                                                               
CKLT10   DS    0H                                                               
         OC    LOCTPOW,LOCTPOW                                                  
         BZ    CKLTABNQ                                                         
         CLC   LOCTSIGN,0(R1)                                                   
         BE    CKLTABQ                                                          
         LA    R2,LOCTBDLQ(R2)                                                  
         BCT   R0,CKLT10                                                        
*                                                                               
CKLTABNQ J     NEQXIT                                                           
*                                                                               
CKLTABQ  J     EQXIT                                                            
         LTORG                                                                  
         DROP  R2                                                               
*                                                                               
*                                                                               
BLDLTAB  NTR1  BASE=*,LABEL=*                                                   
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
         ICM   R4,15,=AL4(LOCTENTQ)                                             
         L     R2,=A(LOCTAB)                                                    
         USING LOCTBD,R2                                                        
*                                                                               
         XC    KEY,KEY                                                          
         MVI   KEY+RREPKTYP-RREPKEY,X'01'                                       
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'REPDIR',KEY,KEY                       
         B     BLDT20                                                           
*                                                                               
BLDT10   GOTO1 DATAMGR,DMCB,=C'DMRSEQ',=C'REPDIR',KEY,KEY                       
*                                                                               
BLDT20   DS    0H                                                               
         CLI   KEY,X'01'                                                        
         BNE   BLDT100                                                          
*                                                                               
         GOTO1 DATAMGR,DMCB,=C'GETREC',=C'REPFIL',KEY+28,ADBUY,DMWORK           
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R6,ADBUY                                                         
         MVI   ELCODE,X'01'                                                     
         MVC   DATADISP,=AL2(34)                                                
         BRAS  RE,GETEL                                                         
         BNE   BLDT10                                                           
         TM    (RREPFLGS-RREPELEM)(R6),X'80'      LOCAL?                        
         BZ    BLDT10              NO - SKIP IT                                 
*                                                                               
         MVC   LOCTPOW,KEY+RREPKREP-RREPREC                                     
         LA    R2,LOCTBDLQ(R2)                                                  
         BCT   R4,BLDT10                                                        
         DC    H'0'                TABLE TOO SMALL                              
*                                                                               
BLDT100  DS    0H                  ALL POWER CODES READ IN                      
         L     R2,=A(LOCTAB)                                                    
*                                                                               
         L     RF,UTL                                                           
         MVI   4(RF),X'0A'         SET UTL SE TO CTFILE                         
         GOTO1 DATAMGR,DMCB,(0,=C'DMOPEN'),=C'CONTROL',                C        
               =C'NCTFILE X',ADBUY,0                                            
*                                                                               
BLDT120  DS    0H                  ALL POWER CODES READ IN                      
         OC    LOCTPOW,LOCTPOW                                                  
         BZ    BLDTX                                                            
*                                                                               
         XC    KEY,KEY                                                          
         MVI   KEY,X'9B'                                                        
         MVI   KEY+1,X'01'                                                      
         MVC   KEY+2(L'LOCTPOW),LOCTPOW      INSERT POWER CODE                  
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',KEY,ADBUY                     
         CLI   8(R1),0             FOUND?                                       
         BE    *+6                 YES                                          
         DC    H'0'                SHOULD HAVE BEEN THERE....                   
*                                                                               
         L     R6,ADBUY                                                         
         CLC   KEY(4),0(R6)       CHECK THE KEY                                 
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVI   ELCODE,X'02'                                                     
         MVC   DATADISP,=AL2(28)                                                
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   LOCTSIGN,2(R6)      SAVE STA SIGNON IN TABLE                     
*                                                                               
         XC    KEY,KEY                                                          
         LA    R3,KEY                                                           
         USING CTIREC,R3                                                        
         MVI   CTIKEY,C'I'         READ USER ID RECORDS                         
         MVC   CTIKID(4),LOCTSIGN  PUT IN STATION                               
*        MVI   CTIKID+4,C'L'       INDICATE LOCAL STATION                       
         OC    CTIKID,SPACES       FILL WITH SPACES                             
         DROP  R3                                                               
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',KEY,ADBUY                     
         CLI   8(R1),0             FOUND?                                       
         BE    *+6                 YES                                          
         DC    H'0'                SHOULD HAVE BEEN THERE....                   
*                                                                               
         L     R6,ADBUY                                                         
         CLC   KEY(25),0(R6)      CHECK THE KEY                                 
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVI   ELCODE,X'02'                                                     
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   LOCTID,2(R6)                                                     
*                                                                               
         LA    R2,LOCTBDLQ(R2)                                                  
         B     BLDT120                                                          
*                                                                               
BLDTX    J     EXIT                                                             
         LTORG                                                                  
*                                                                               
* READ  DSTATION REC FROM CONTROL FILE TO SEE IF REP HAS STATION*               
*                                                                               
CKLREP   NTR1  BASE=*,LABEL=*                                                   
         LA    RC,SPACEND                                                       
         USING SPZ5WRKD,RC                                                      
*                                                                               
*&&DO                                                                           
* FIND START OF MOS, AND CONVERT BATCH DATE TO BINARY, INVERTED FORMAT          
*                                                                               
         LA    R1,UKUDATA-UKRECD+EZWKRIND                                       
         OC    0(1,R1),0(R1)         MOS ZERO IN BATCH?                         
         BNZ   CKLR05                NO, PROCEED AS USUAL                       
*                                                                               
         OC    INVMOS,INVMOS         HAVE WE SAVED MOS FROM '31'?               
         JZ    EQXIT                 NO - EXIT                                  
         MVI   INVMOS+2,X'01'        X'YYMM01' BINARY                           
         GOTO1 DATCON,DMCB,(3,INVMOS),(0,WORK)  C'YYMMDD' FORMAT                
         B     CKLR07                                                           
*                                                                               
CKLR05   DS    0H                                                               
         MVC   BATDATE,UKUDATA-UKRECD+EZWKRIND                                  
         TM    BATDATE,X'F0'                                                    
         BZ    CKLR06                                                           
*                                                                               
         MVC   BYTE,BATDATE                                                     
         BRAS  RE,NEW2OLD                                                       
         MVC   BATDATE,HALF                                                     
*&&                                                                             
*                                                                               
CKLR06   DS    0H                                                               
         LAY   R1,EZWRKIOB                                                      
         MVC   BATDATE(2),WRKEZMOS-WRKIOD(R1)                                   
         MVI   BATDATE+2,X'01'     FIRST OF THE MONTH                           
         GOTO1 DATCON,DMCB,(1,BATDATE),(0,WORK) C'YYMMDD' FORMAT                
*                                                                               
CKLR07   DS    0H                                                               
         GOTO1 GETBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY                      
         GOTO1 DATCON,DMCB,(0,WORK+12),(3,BATDATE) YMD BINARY FORMAT            
         SR    R0,R0                                                            
         ICM   R0,7,BATDATE                                                     
         LNR   R0,R0                                                            
         STCM  R0,7,BATDATE        BINARY,INVERTED, SAME AS DSTA                
*                                                                               
* SEE IF STA/DATE/REP HAD BEEN SAVED ALREADY                                    
*                                                                               
BR       USING BUFFRECD,BUFFREC                                                 
         XC    BUFFREC(BUFFRLQ),BUFFREC                                         
         XC    BUFFRSAV(BUFFRLQ),BUFFRSAV                                       
*                                                                               
* BUILD KEY FOR BUFFERIN                                                        
         MVC   BR.BRSTA,EQVSTAW                                                 
         MVC   BR.BRDATE,BATDATE                                                
         MVC   BUFFRSAV(BUFFRLQ),BUFFREC                                        
         LA    R0,BUFFARDH                                                      
*                                                                               
         GOTO1 =V(BUFFERIN),DMCB,((R0),ABUFFRIN),(0,BUFFREC),ACOMFACS           
         TM    4(R1),X'80'         EOF?                                         
         BO    CKLR100             YES - STATION/DATE NOT THERE                 
         CLI   4(R1),X'00'                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
CKLR10   DS    0H                  SOME STA/DATE/REP FOUND                      
         CLC   BUFFREC(BRDATE-BUFFRECD),BUFFRSAV  SAME STATION?                 
         BNE   CKLR100             NO - READ DSTA RECORDS                       
*                                                                               
         CLC   BR.BRDATE,=X'FFFFFF' - NO REP?                                   
         BE    CKLRNEQX            WHAT A SHAME                                 
*                                                                               
         CLC   AGENCY,BR.BRREP     SAME REP AS REQUESTED?                       
         BE    CKLREQX                                                          
         B     CKLRNEQX                                                         
*                                                                               
* STA/DATE/REP NOT IN TABLE.  READ DSTA RECORDS                                 
*                                                                               
CKLR100  DS    0H                                                               
         L     RF,UTL                                                           
         MVC   CKLSVUTL,4(RF)                                                   
         MVI   4(RF),X'0A'         SET TO CTFILE                                
*                                                                               
         XC    MPLKEY,MPLKEY                                                    
         LA    R3,MPLKEY                                                        
         USING STAKEYD,R3                                                       
         MVI   STAKTYP,STAKTYPQ    DSTA RECORD TYPE                             
         MVC   STAKMEDA,EQVSTAW+4                                               
         MVC   STAKSTIN,EQVSTAW                                                 
         MVC   STAKEFDA,BATDATE                                                 
         MVC   KEYSAVE,MPLKEY                                                   
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMRDHI),=C'GENDIR',MPLKEY,MPLKEY           
         CLC   MPLKEY(STAKEFDA-STAKEYD),KEYSAVE                                 
         BE    CKLR200                                                          
*                                                                               
* NO DSTA WITH EFFECTIVE DATE FOUND                                             
* PUT STATION WITH X'FF' DATE INTO THE TABLE                                    
         XC    BUFFREC(BUFFRLQ),BUFFREC                                         
         MVC   BR.BRSTA,EQVSTAW                                                 
         MVC   BR.BRDATE,=X'FFFFFF'                                             
         B     CKLR500                                                          
*                                                                               
CKLR200  DS    0H                  GOT A DSTA RECORD HERE                       
         L     R6,ADBUY                                                         
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),=C'GENFIL',MPLKEY+36,     X        
               (R6),DMWORK                                                      
         CLC   MPLKEY(24),0(R6)                                                 
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         LA    R6,42(,R6)                                                       
         CLI   0(R6),X'10'                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING STAREPD,R6                                                       
         XC    BUFFREC(BUFFRLQ),BUFFREC                                         
         MVC   BR.BRSTA,STAKSTIN                                                
         MVC   BR.BRDATE,STAKEFDA                                               
*                                                                               
* READ ID RECORD TO FIND 2-CHAR REP POWER CODE                                  
*                                                                               
         XC    MPLKEY,MPLKEY                                                    
         LA    R2,MPLKEY                                                        
         USING CTIKEY,R2                                                        
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKID(L'STAREPCR),STAREPCR                                      
         DROP  R6,R3                                                            
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',MPLKEY,ADBUY                  
         L     R6,ADBUY                                                         
         CLC   MPLKEY(CTIKID-CTIKEY+L'STAREPCR),0(R6)                           
         BNE   CKLR500                                                          
*                                                                               
         MVI   ELCODE,X'06'                                                     
         MVC   DATADISP,=AL2(28)                                                
         BRAS  RE,GETEL                                                         
         BNE   CKLR500                                                          
*                                                                               
         CLC   AGENCY,2(R6)                                                     
         BE    *+14                                                             
         MVC   BR.BRDATE,=X'FFFFFF'                                             
         B     CKLR500                                                          
*                                                                               
         MVC   BR.BRREP,2(R6)                                                   
         B     CKLR500                                                          
*                                                                               
         DROP  R2                                                               
*                                                                               
CKLR500  DS    0H                  ADD UID,DATE,REP TO TABLE                    
         LA    R0,BUFFAPUT                                                      
         GOTO1 =V(BUFFERIN),DMCB,((R0),ABUFFRIN),(0,BUFFREC),ACOMFACS           
         CLI   4(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLC   BUFFREC+4(L'BATDATE),=X'FFFFFF'                                  
         BE    CKLRNEQX                                                         
*                                                                               
CKLREQX  DS    0H                                                               
         L     RF,UTL                                                           
         MVC   4(1,RF),CKLSVUTL                                                 
         J     EQXIT                                                            
*                                                                               
CKLRNEQX DS    0H                                                               
         L     RF,UTL                                                           
         MVC   4(1,RF),CKLSVUTL                                                 
         J     NEQXIT                                                           
         LTORG                                                                  
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *               
* R0 TO ADDRESS STATION MEDIA BYTE (BAND REALLY)                                
* R1 TO ADDRESS OUTPUT BYTE, WHERE T,N,R,X WILL BE PLACED                       
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *               
SETMED   NTR1  BASE=*,LABEL=*                                                   
         LR    R2,R0               A(INPUT)                                     
         LA    R3,SETMTAB                                                       
*                                                                               
SETM10   CLI   0(R3),X'FF'                                                      
         BE    SETMNEQX                                                         
         CLC   0(1,R3),0(R2)                                                    
         BE    *+12                                                             
         LA    R3,SETMTBLQ(R3)                                                  
         B     SETM10                                                           
*                                                                               
         MVC   0(1,R1),1(R3)                                                    
*                                                                               
SETMEQX  J     EQXIT                                                            
SETMNEQX J     NEQXIT                                                           
         LTORG                                                                  
*                                                                               
SETMTAB  DC    C'T',C'T'                                                        
SETMTBLQ EQU   *-SETMTAB                                                        
         DC    C'A',C'R'                                                        
         DC    C'F',C'R'                                                        
         DC    C'N',C'N'                                                        
         DC    C'C',C'N'                                                        
         DC    C'X',C'X'                                                        
         DC    C'L',C'T'                                                        
         DC    C'S',C'N'                                                        
         DC    X'FF'                                                            
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                 
* BYTE EXPECTED TO HAVE THE NEW MOS (X'BA' = OCT 2011)                          
* ON EXIT HALF WILL HAVE THE OLD FORMAT MOS (X'1110')                           
* DUB IS USED FOR CONVERSION                                                    
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *                 
NEW2OLD  NTR1  BASE=*,LABEL=*                                                   
         ZIC   RF,BYTE                                                          
         NILL  GRF,X'000F'          ZERO OUT YEAR (RF, GRAND INSTR)             
         CVD   RF,DUB                                                           
         SR    RF,RF                                                            
         ICM   RF,3,DUB+6                                                       
         SRL   RF,4                                                             
         STC   RF,HALF+1                                                        
*                                                                               
         ZIC   RF,BYTE                                                          
         SRL   RF,4                GET RID OF THE MONTH                         
         CVD   RF,DUB                                                           
         SR    RF,RF                                                            
         ICM   RF,3,DUB+6                                                       
         SRL   RF,4                                                             
         STC   RF,HALF                                                          
*                                                                               
         J     EQXIT                                                            
         LTORG                                                                  
*                                                                               
*                                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
* FAKEIND - ROUTINE TO FILL IN INDEX FIELDS                                     
* THIS IS TO BE USED WITH DDWRKIO CALLS                                         
* ROUTINE WILL POPULATE THE FOLLOWING FIELDS                                    
* WITH DATA TAKEN FROM DDWRKIOD:                                                
* EZWIMED                                                                       
* EZWISTN                                                                       
* EZWKRIND(2) - USER ID                                                         
* W_AGELD                                                                       
* W_STAT                                                                        
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             
FAKEIND  NTR1  BASE=*,LABEL=*                                                   
         USING EZBLOCKD,R5                                                      
         LAY   R1,EZWRKIOB                                                      
         USING WRKIOD,R1                                                        
*                                                                               
         LA    R2,EZWKRIND                                                      
*                                                                               
         USING EZWKRIXD,R2                                                      
         MVC   EZWIUID,WRKEZUID                                                 
         MVC   EZWISTN,WRKEZSCL    STA CALL LETTERS                             
         MVC   EZWIDAY,WRKEZDAY                                                 
         MVC   EZWIMED,WRKEZMED    MEDIA                                        
         DROP  R2                                                               
*                                                                               
         USING W_RECD,R2                                                        
         MVC   W_AGELD,WRKEZBDT    BATCH DATE                                   
         MVC   W_STAT,WRKEZSTA     FILE STATUS                                  
         MVC   W_FILENO(L'WRKEZSQN),WRKEZSQN                                    
         DROP  R2,R1                                                            
*                                                                               
         J     EQXIT                                                            
         LTORG                                                                  
*&&DO                                                                           
* R1 EXPECTED TO ADDRESS THE REP CODE                                           
CKDTAB   NTR1  BASE=*,LABEL=*                                                   
         LAY   R2,REPIDS                                                        
*                                                                               
CKDTAB10 CLI   0(R2),X'FF'                                                      
         JE    NEQXIT              REP NOT IN THE TABLE                         
         CLC   0(3,R1),0(R2)                                                    
         JE    *+12                REP FOUND IN THE TABLE                       
         AHI   R2,L'REPIDS                                                      
         J     CKDTAB10                                                         
*                                                                               
         L     R3,VMASTC                                                        
         LLC   RF,14(R2)           LENGTH OF PREFIX                             
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         J     *+10                                                             
         CLC   15(0,R2),MCUSERID-MCBLOCK(R3)                                    
         JE    EQXIT                                                            
         J     NEQXIT                                                           
*                                                                               
         LTORG                                                                  
*&&                                                                             
*      ++INCLUDE DDDARETAB                                                      
*                                                                               
GETDARE  NTR1  BASE=*,LABEL=*,WORK=(R2,GDWORKL)                                 
         USING GDWORKD,R2                                                       
         XC    SVREPCOD,SVREPCOD                                                
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMOPEN'),=C'CONTROL',                C        
               =C'NGENDIR NGENFIL X',GDWORK,0                                   
*                                                                               
         LR    RE,R2                                                            
         LHI   RF,GDWORKL                                                       
         XCEF                                                                   
*                                                                               
         L     RF,ACOMFACS                                                      
         L     RF,CCALLOV-COMFACSD(RF)                                          
         XC    DMCB(12),DMCB                                                    
         MVC   DMCB+4,=X'D9000A3E'    DDGETDARE                                 
         GOTO1 (RF),DMCB                                                        
         CLI   DMCB+4,X'FF'        COULDN'T GET ADDRESS?                        
         JE    *+2                 YES, DIE HORRIBLY                            
         L     RF,DMCB             RF = A(DDGETDARE)                            
*                                                                               
         L     R3,VMASTC                                                        
         LA    R3,MCUSERID-MCBLOCK(R3)                                          
         GOTO1 (RF),DMCB,(C'U',0),(R3),(R2),A(L'GDWORK),DATAMGR                 
         JNE   NEQXIT                                                           
*                                                                               
         MVC   SVREPCOD,DAPTCODE-DAREPTD(R2)                                    
*                                                                               
         J     EQXIT                                                            
         DROP  R2                                                               
         LTORG                                                                  
*                                                                               
GDWORKD  DSECT                                                                  
GDWORK   DS    XL2000                                                           
GDWORKL  EQU   *-GDWORKD                                                        
SPZR02   CSECT                                                                  
*                                                                               
*                                                                               
         DS    0D                                                               
         DC    CL8'*WKRBUF*'                                                    
WRKRBUFF DS    14336X                                                           
WRKRBEND EQU   *                                                                
         DS    0D                                                               
         DC    CL8'*WKRREC*'                                                    
WRKRREC  DS    4096X                                                            
WRKRRECE EQU   *                                                                
         DS    0D                                                               
         DC    CL8'*EZBLKF*'                                                    
EZBLOCKC DS    0X                                                               
         ORG   *+EZBLOCKL                                                       
         DS    0D                                                               
         DC    CL8'*PRTAB**'                                                    
PRTABC   DS    0X                                                               
PRTABL   EQU   23100               ENTRY LEN = 77, 300 ENTRIES                  
         ORG   *+PRTABL                                                         
PRTABE   EQU   *                                                                
         DS    0D                                                               
         DC    CL8'*CMTAB**'       COMMERCIAL TABLE                             
CMTABC   DS    0X                                                               
CMTABL   EQU   24600                                                            
         ORG   *+CMTABL                                                         
CMTABE   EQU   *                   COMML SEQ TABLE                              
         DS    0D                                                               
         DC    CL8'*CSTAB**'                                                    
CSTABC   DS    0X                                                               
CSTABL   EQU   300                 ENTRY = 2 BCLT, 3 COMML SEQ #                
         ORG   *+CSTABL                                                         
CSTABE   EQU   *                                                                
         DC    CL8'*STMKT**'                                                    
STTABC   DS    0X                                                               
STTABL   EQU   800                 ENTRY = 8, 5 STATION, 2 MKT, 1 STYPE         
STTABENT EQU   8                                                                
         ORG   *+STTABL                                                         
STTABE   EQU   *                                                                
         DC    CL8'*MKTNM**'                                                    
MKTABC   DS    0X                                                               
MKTABL   EQU   720                 ENTRY = 22, 2 MKT, 20 MARKET NAME            
MKTABENT EQU   22                                                               
         ORG   *+MKTABL                                                         
MKTABE   EQU   *                                                                
*                                                                               
         DS    0D                                                               
         DC    CL8'EQVSTATB'                                                    
EQVSTATB DS    2000X               EQUIVALENT STATION TABLE                     
EQVSTATL EQU   *-EQVSTATB          ENTRY = 10, 5 EACH STATION                   
*                                                                               
         DC    CL8'REPSTATB'                                                    
REPSTATB DS    48000X              REP STATION TABLE                            
REPSTATL EQU   (*-REPSTATB)/12     ENTRY =12, 5 STATION, 2 POWER CODE           
*                                             5 RENAMED STATION                 
         DS    0D                                                               
         DC    CL8'DRGLOBAL'                                                    
GLAREA   DS    44000X              DRIVER GLOBAL AREA                           
*                                                                               
*                                                                               
         DC    CL8'*LOCTAB*'                                                    
LOCTAB   DS    0X                  LOCAL STATION TABLE                          
         ORG   *+(LOCTBDLQ*LOCTENTQ)                                            
LOCTABLQ EQU   *-LOCTAB                                                         
         DC    X'0000'             END OF TABLE                                 
*                                                                               
*                                                                               
*                                                                               
*                                                                               
RSTATBD  DSECT                                                                  
RSTAENT  DS   0CL(RSTANXT-RSTACALL)                                             
RSTACALL DS    CL5                 CURRENT CALL LETTERS                         
RSTANEW  DS    CL5                 RENAME CALL LETTERS                          
RSTAREP  DS    CL2                 CURRENT REP                                  
RSTADTR  DS    XL2                 DATE OF TRANSFER TO NEW REP                  
RSTAREPP DS    CL2                 PREVIOUS REP                                 
RSTADTS  DS    XL2                 DATE OF TRANSFER TO NEW STATION              
RSTANXT  EQU   *                                                                
*                                                                               
         DS    0D                                                               
SPZ5WRKD DSECT                                                                  
FIRSTSW  DS    X               0 = FIRST TIME, 01 = DRIVER INITIALIAZED         
FIRSTSWC EQU   X'08'               AT LEAST 1 INVOICE CONVERTED                 
FIRSTSWI EQU   X'01'               DRIVER IS INITIALIZED                        
*                              8 = AT LEAST 1 INVOICE CONVERTED                 
SAVSYS   DS    X                                                                
RERUN    DS    XL3                 RERUN DATE                                   
TODAYJ   DS    XL3                 TODAYS JULIAN DATE PWOS CYYDDD               
*                                                                               
TRCOPT   DS    C                                                                
PREVOPT  DS    C                                                                
UNCONVSW DS    C                                                                
CONVSW   DS    C                                                                
ACTVSW   DS    CL1                                                              
SVINVTYP DS    C                                                                
         DS    C                   SPARE                                        
*                                                                               
SVREPCOD DS    CL3                                                              
*                                                                               
ADRIVER  DS    A                                                                
*                                                                               
DPGFILE  DS    CL8                                                              
DRIVER   DS    CL8                                                              
SPDRIVER DS    CL8                                                              
XFF      DS    XL20                                                             
DASHES   DS    CL70                                                             
X        DS    XL256                                                            
*                                                                               
SVKEY    DS    CL32                                                             
SVCIADDR DS    XL2                                                              
ELCODE   DS    XL1                                                              
REPUTL   DS    XL1                                                              
         DS    CL2                 SPARE                                        
         DS    0D                                                               
*SVWFREC0 DS    XL96                                                            
SVWKDESC DS    XL(L'WRKEZDSC)                                                   
*                                                                               
ATSAROFF DS    A                                                                
TSARBUFL DS    A                  BUFFER LENGTH FOR 200 RECORDS                 
TSARBUFF DS    A                   ADDRESS OF GETMAIN BUFFER                    
TSRKEYF  DS    H                                                                
TSARBYTE DS    F                   CT OF TSAR BYTE SENT                         
TSARLAST DS    H                   LAST TSAR RECORD NUMBER                      
PRTCT    DS    H                   CT OF PRINT LINES SAVED                      
*                                                                               
SVMGRMKT DS    XL2                                                              
SVMGRP   DS    CL5                                                              
SVSMKT   DS    CL4                                                              
SVBMKT   DS    XL2                                                              
SVSMKTNM DS    CL20                                                             
SVBSTA   DS    CL7                                                              
SVBDSTA  DS    CL7                 SAVED BAD (DOES NOT EXIST) STATION           
SVBDATE  DS    CL8                                                              
*                                                                               
SVSRCE   DS    CL4                 SOURCE FILTER                                
SVSRCEX  DS    CL1                 IF MINUS, SOURCE EXCLUSION                   
*                                                                               
*VBTIM   DS    CL4                                                              
*                                                                               
RPTNO    DS    XL1                                                              
MPLKEY   DS    CL40                                                             
MPLKEYSV DS    CL40                                                             
EQVSTAW  DS   0CL5                                                              
         DS    CL4                                                              
EQVMEDW  DS    CL1                                                              
         DS    CL3                                                              
*                                                                               
SVREPSTA DS    CL5                                                              
REPCT    DS    PL4                                                              
*                                                                               
         DS    0D                                                               
TSARBLK  DS    CL(TSARDL2)                                                      
*                                                                               
ABUFFRIN DS    A                                                                
BUFFREC  DS    0X                                                               
         ORG   *+BUFFRLQ                                                        
BUFFRSAV DS    0X                                                               
         ORG   *+BUFFRLQ                                                        
BATDATE  DS    CL3                                                              
CKLSVUTL DS    X                                                                
INVMOS   DS    XL3                 MOS FROM '31' RECORD                         
*                                                                               
*                                                                               
BUFFRECD DSECT                                                                  
BRSTA    DS    CL4                                                              
BRDATE   DS    XL3                 BINARY, INVERTED                             
BRREP    DS    CL2                                                              
BRDATA   DS    X                                                                
BUFFRLQ  EQU   *-BUFFRECD                                                       
*                                                                               
*                                                                               
*                                                                               
*                                                                               
       ++INCLUDE DRGLOBAL                                                       
*                                                                               
GLOPT1   EQU   GLOPTS+00                                                        
GLOPT2   EQU   GLOPTS+01                                                        
GLOPT3   EQU   GLOPTS+02                                                        
GLOPT4   EQU   GLOPTS+03                                                        
GLOPT5   EQU   GLOPTS+04                                                        
GLOPT6   EQU   GLOPTS+05                                                        
GLOPT7   EQU   GLOPTS+06                                                        
GLOPT8   EQU   GLOPTS+07                                                        
GLOPT9   EQU   GLOPTS+08                                                        
GLOPT10  EQU   GLOPTS+09                                                        
*                                                                               
       ++INCLUDE SPREPWORKD                                                     
       ++INCLUDE SPREPMODES                                                     
       ++INCLUDE DDCOMFACS                                                      
MASTD    DSECT                                                                  
       ++INCLUDE DDMASTC                                                        
       ++INCLUDE FASELIST                                                       
*                                                                               
       ++INCLUDE EZBLOCK                                                        
*                                                                               
WRKIOD   DSECT                                                                  
       ++INCLUDE DDWRKIOD                                                       
*                                                                               
       ++INCLUDE SPGENEZ                                                        
CLTHDRD  DSECT                                                                  
       ++INCLUDE SPGENCLT                                                       
*TARECD  DSECT                                                                  
*      **INCLUDE SPGENSTA                                                       
MKTRECD  DSECT                                                                  
       ++INCLUDE SPGENMKT                                                       
       ++INCLUDE SPGENSTEQ                                                      
       ++INCLUDE CTGENSTAD                                                      
       ++INCLUDE DDTSARD                                                        
       ++INCLUDE DMWRKFD                                                        
       ++INCLUDE DMWRKFK                                                        
       ++INCLUDE REGENREPA                                                      
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE DDBUFFD                                                        
       ++INCLUDE DDGETDARED                                                     
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'018SPREPZR02 10/20/15'                                      
         END                                                                    

*          DATA SET SPREPNV02B AT LEVEL 098 AS OF 05/03/10                      
*CATALP SPNV02B                                                                 
        TITLE  'SPREPNV02B - INVOICE CONTROL REPORT - OUTPUT PHASE'             
*                                                                               
*        INPUT PARAMETERS: 0(R1) = A(SPOT WORKING STORAGE)                      
*                          4(R1) = A(SPNVWORK)                                  
***********************************************************************         
*        AKAT - 4/22/10 - SUPPORT NEW BUY-ID LIST                               
*        AKAT - DON'T PRINT EXTRA LINE WHEN FAXING & FIX PAGE 0 REF             
*        EJOR - DISPLAY 2 CHAR OFFICE CORRECTLY                                 
*        EJOR - FIX BXCOL TO BE 132 (NOT 110)                                   
*        EJOR - FIX EST=NO BUG                                                  
*             - NOP OLD INVOICE CODE                                            
*        EJOR - FIX CABLE TESTS FIX FOR CANADA  5/10/2004                       
*        EJOR - FIX CABLE TESTS           2/23/2004                             
*        SEAN - QOPT5 ACCEPTS Y, B, T     1/27/2000                             
*               Y = TOTAL SPOTS, GROSS COST AND NET COST                        
*               B = TOTAL AND TRACE                                             
*               T = TRACE NO TOTAL                                              
*               N = DEFAULT!  NO TOTAL, NO TRACE, CAN BE BLANK                  
***********************************************************************         
         SPACE 1                                                                
SPNV02B  CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,SPNV02B,RC,R7                                                  
         LA    RC,2048(RB)                                                      
         LA    RC,2048(RC)                                                      
         LA    R7,2048(RC)                                                      
         LA    R7,2048(R7)                                                      
*                                                                               
         L     RA,0(R1)                                                         
         LA    R9,2048(RA)                                                      
         LA    R9,2048(R9)                                                      
         USING SPWORKD,RA,R9                                                    
*                                                                               
         L     R8,4(R1)                                                         
         USING NVWORKD,R8                                                       
*                                                                               
         LA    R1,HEADHK                                                        
         ST    R1,HEADHOOK                                                      
         STM   R7,RC,HHR7                                                       
         MVI   MAXLINES,58                                                      
         MVI   RCSUBPRG,0                                                       
         MVI   RCWHATPR,1                                                       
         MVI   LUMPPOL,C'N'                                                     
         CLC   QPRD,=C'POL'        TEST POL REQUEST                             
         BNE   *+16                                                             
         CLI   QRECORD+29,C'N'     AND POL BREAKOUT DENIED                      
         BNE   *+8                                                              
         MVI   LUMPPOL,C'Y'        YES-LUMP ALL PRODUCTS TO POL                 
*                                                                               
         MVI   FAXSW,0                                                          
         CLI   QOPT2,C'F'          OPTION FOR REPORT AND FAXES                  
         BNE   *+12                                                             
         MVI   QOPT2,C'B'                                                       
         B     *+16                                                             
         CLI   QOPT2,C'S'          OPTION FOR FAXES ONLY                        
         BNE   SORTOUT                                                          
         MVI   QOPT2,C'L'                                                       
         OI    FAXSW,FAXON                                                      
         B     SORTOUT                                                          
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
SORTOUT  DS    0H                                                               
*                                                                               
         XC    ALETBUF,ALETBUF                                                  
         LH    R3,NVCMPRLN         KEY COMPARE LEN -1                           
         LH    R4,NVDSPACT         DISPLACEMENT TO ACTIVITY DATE                
         LA    R5,NVREC(R4)        ACTIVITY DATE ADDR IN REC                    
         GOTO1 NVSORTER,DMCB,=C'GET',0                                          
         ICM   R2,15,4(R1)                                                      
         BZ    EOJ                                                              
         MVI   LASTREC,C'N'                                                     
         MVC   NVREC(NVRECLEN),0(R2)                                            
         MVC   ACTDATE,0(R5)                                                    
*                                                                               
         OPEN  (NVWORK,OUTPUT)                                                  
*                                                                               
NV010    GOTO1 NVSORTER,DMCB,=C'GET',0   GET NEXT SORTED RECORD                 
         ICM   R2,15,4(R1)                                                      
         BNZ   *+12                                                             
         MVI   LASTREC,C'Y'                                                     
         B     NV030                                                            
         EX    R3,COMPKEY              TEST KEYS EQUAL                          
         BNE   NV030                                                            
*                                                                               
         LA    R1,0(R4,R2)         KEYS EQUAL                                   
         MVC   ACTDATE,0(R1)       SAVE LATEST ACTIVITY DATE                    
         LA    RE,NVREC                                                         
         LA    RF,NVKEYLEN         DSPL TO FIRST COL                            
         LA    R0,NVCOLMAX         NUMBER OF COLS                               
*                                                                               
NV020    L     R1,0(RE,RF)         KEYS EQUAL - ADD RECORDS                     
         A     R1,0(R2,RF)                                                      
         ST    R1,0(RE,RF)                                                      
         LA    RF,4(RF)                                                         
         BCT   R0,NV020                                                         
         B     NV010                                                            
*                                                                               
NV030    MVC   0(3,R5),ACTDATE                                                  
         LA    R0,NVREC                                                         
         PUT   NVWORK,(0)                                                       
*                                                                               
         CLI   LASTREC,C'Y'                                                     
         BE    NV040                                                            
         MVC   NVREC(NVRECLEN),0(R2) SAVE NEW RECORD                            
         MVC   ACTDATE,0(R5)                                                    
         B     NV010                                                            
*                                                                               
*                                                                               
COMPKEY  CLC   NVREC(0),0(R2)      EXECUTED                                     
         EJECT                                                                  
NV040    DS    0H                                                               
*                                                                               
*        END OF DATA - PROCESS WORK FILE AND PRINT THE REPORT                   
*                                                                               
         MVC   NVREC(NVRECLEN),XFF                                              
         PUT   NVWORK,NVREC        WRITE EOF REC                                
         CLOSE NVWORK                                                           
         OPEN  (NVWORK,INPUT)                                                   
         LA    R0,NV100                                                         
         STCM  R0,7,NVWORK+33      SET EOF ADDRESS                              
*                                                                               
         BAS   RE,SETHEAD          SET THE HEADLINES FOR THE REPORT             
         MVI   FORCEHED,C'P'                                                    
         MVC   PAGE,=H'1'                                                       
*                                                                               
* IF YOU NEED TO INCREASE THIS, THE REQUEST IS PROBABLY TOO BIG!                
* (WHEN INCREASED TO ALLOW 30-40,000, WE GOT 7 1/2 BOXES OF PAPER!)             
         GOTO1 COVAIL,DMCB,C'GET',720000,1440000   10-20,000 RECORDS            
         ICM   RE,15,4(R1)                                                      
         BNZ   *+6                                                              
         DC    H'0'                                                             
         ST    RE,ALETBUF          SET A(LETTER BUFFER)                         
         ST    RE,ALETREC          SET A(CURRENT LETTER RECORD)                 
         L     RF,8(R1)                                                         
         ST    RF,LLETBUF          SAVE L'LETTER BUFFER                         
         LA    RF,0(RE,RF)                                                      
         ST    RF,ALETBUFX         SET A(END OF LETTER BUFFER)                  
*                                                                               
         XC    PGRPSV,PGRPSV                                                    
         XC    MGRPSV,MGRPSV                                                    
*                                                                               
         LH    R1,NVCMPRLN         SET PRIMARY CONTROL ROW NUMBER               
         LA    R1,1(R1)                                                         
         SR    R0,R0                                                            
         D     R0,=F'4'                                                         
         STC   R1,CBNUM                                                         
         LH    R1,NVCMPRLN         SET PRIMARY CONTROL BREAK LEN                
         SH    R1,=H'4'                                                         
         STH   R1,CBEXLN                                                        
         LA    R1,1(R1)                                                         
         LA    RF,RCDTA                                                         
*                                                                               
NV045    CLI   0(RF),X'FF'         FIND THE ROW AFTER PRIMARY CB                
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLM   R1,1,0(RF)                                                       
         BE    NV047                                                            
         LA    RF,8(RF)                                                         
         B     NV045                                                            
*                                                                               
NV047    MVC   DSPCLEAR,4(RF)      SAVE PRINT LINE DISP                         
*                                                                               
NV048    GET   NVWORK,REC                                                       
         LA    RE,REC                                                           
         AH    RE,NVDSPCLR         POINT TO CLEARED FIELD                       
         OC    2(2,RE),2(RE)       TEST ANY UNCLEARED                           
         BZ    NV048               NO - IGNORE RECORD                           
         CLI   QOPT3,C'Y'          TEST TO IGNORE ALL MATCHED RECORDS           
         BNE   NV049                                                            
         LA    RE,REC              YES -                                        
         AH    RE,NVDSPMAT         POINT TO MATCHED FIELD                       
         OC    2(2,RE),2(RE)       TEST ANY UNMATCHED                           
         BZ    NV048               NO - IGNORE RECORD                           
*                                                                               
NV049    CLC   REC(NVRECLEN),XFF   TEST FOR EOF ALREADY                         
         BE    NV100               YES - FINISHED                               
         MVI   CBLEVEL,1                                                        
         BAS   RE,CBFIRST          GIVE ALL LEVEL FIRSTS                        
         LH    R3,CBEXLN           GET CONTROL BREAK LENGTH                     
         MVI   USRSW1,C'Y'                                                      
         MVI   SKIPSW,C'N'                                                      
*                                                                               
NV050    GET   NVWORK,NEWREC                                                    
         LA    RE,NEWREC                                                        
         AH    RE,NVDSPCLR         POINT TO CLEARED FIELD                       
         OC    2(2,RE),2(RE)       TEST ANY UNCLEARED                           
         BZ    NV050               NO - IGNORE RECORD                           
         CLI   QOPT3,C'Y'          TEST TO IGNORE ALL MATCHED RECORDS           
         BNE   NV052                                                            
         LA    RE,NEWREC           YES -                                        
         AH    RE,NVDSPMAT         POINT TO MATCHED FIELD                       
         OC    2(2,RE),2(RE)       TEST ANY UNMATCHED                           
         BZ    NV050               NO - IGNORE RECORD                           
*                                                                               
NV052    BAS   RE,FMT              FORMAT COLUMN DATA FROM REC                  
         CLI   QOPT2,C'L'          TEST FOR LETTERS ONLY                        
         BE    NV055               YES - SKIP PRINTING                          
*                                                                               
         CLI   QOPT3,C'X'          NO INV ONLY?                                 
         BNE   NV052A                                                           
         CLI   INVSW,C'N'          NO INV?                                      
         BE    NV052A                                                           
         MVC   RETOTSPT,SVTOTSPT   RESTORE TOTAL BEFORE THIS INVOICE            
         MVC   RETOTGRO,SVTOTGRO                                                
         MVC   RETOTNET,SVTOTNET                                                
         B     NV055                                                            
*                                                                               
NV052A   CLI   NOPRINT,C'Y'                                                     
         BE    NV055                                                            
         CLI   SKIPSW,C'Y'         TEST TO SKIP A LINE                          
         BNE   NV053                                                            
         L     R4,APSAVE                                                        
         MVC   0(L'PSAVE,R4),P                                                  
         MVC   P,SPACES                                                         
         GOTO1 REPORT              YES - BLANK LINE                             
         CLI   SKIPSW,C'N'         TEST IF HEADHOOK ALREADY LET P THRU          
         BE    NV054               YES - NO NEED TO GOTO REPORT AGAIN           
         MVI   ALLOWLIN,3          ALLOW 3 LINES ON THIS PAGE                   
         MVC   P,0(R4)                                                          
         MVI   SKIPSW,C'N'                                                      
*                                                                               
NV053    GOTO1 REPORT              AND PRINT                                    
*                                                                               
NV054    MVI   USRSW1,C'N'                                                      
*                                                                               
NV055    EX    R3,CLCREC           TEST FOR CONTROL BREAK                       
         BE    NV060                                                            
         MVC   CBLEVEL,CBNUM       SET CONTROL BREAK LEVEL                      
         B     NV070                                                            
*                                                                               
NV060    MVC   REC,NEWREC          MOVE RECORD                                  
         B     NV050               AND CONTINUE                                 
*                                                                               
CLCREC   CLC   REC(0),NEWREC       * EXECUTED                                   
         EJECT                                                                  
NV070    DS    0H                                                               
*                                                                               
*        PROCESS A CONTROL BREAK                                                
*                                                                               
         ZIC   R5,CBLEVEL          GET HIGH ROW NUMBER                          
         BCTR  R5,0                DECREMENT                                    
         STC   R5,CBLEVEL          SET ROW NUMBER THIS CONTROL BREAK            
*                                                                               
         CLC   NEWREC(NVRECLEN),XFF   TEST EOF REC                              
         BE    NV100                                                            
         CLI   CBLEVEL,1           TEST DONE                                    
         BL    NV100                                                            
         CLC   CBLEVEL,CBPROW1     IS CB AT FIRST PRINT LINE ROW?               
         BNE   *+12                                                             
         MVI   USRSW1,C'Y'         YES - INDICATE                               
         B     NV073                                                            
         CLC   CBLEVEL,CBSKIP      IS CB AT SECOND PRINT LINE ROW ?             
         BNE   NV073                                                            
         MVI   SKIPSW,C'Y'         YES - WE SHALL SKIP A LINE                   
*                                                                               
NV073    LR    RE,R5               GET ROW NUMBER                               
         BCTR  RE,0                                                             
         SLL   RE,2                X 4                                          
         LA    R1,RCDTA            GET ROW SPEC ADDRESS                         
*                                                                               
NV075    CLI   0(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLM   RE,1,0(R1)                                                       
         BE    NV077                                                            
         LA    R1,8(R1)                                                         
         B     NV075                                                            
*                                                                               
NV077    L     RF,0(R1)                                                         
         TM    SPECIND-SPECDATA(RF),PL   TEST FOR PRINTLINE                     
         BO    NV080                                                            
         LR    RF,R5                     NO - ROW IS A HEADLINE                 
         BCTR  RF,0                                                             
         MH    RF,=H'132'                                                       
         LA    RF,HEAD2(RF)        FIRST HEADLINE ROW IS H2                     
         MVC   0(40,RF),SPACES     BLANK THE HEADLINE DATA                      
         MVI   FORCEHED,C'P'       FORCE NEW PAGE                               
*                                                                               
NV080    LTR   RE,RE               TEST FOR FIRST ROW CONTROL BREAK             
         BZ    NV090               YES - NO MORE CONTROL BREAKS POSS            
         BCTR  RE,0                                                             
         EX    RE,CLCREC           TEST FURTHER CONTROL BREAK                   
         BNE   NV070               YES                                          
*                                                                               
NV090    MVC   REC,NEWREC          MOVE TO PROCESS                              
         BAS   RE,CBFIRST          INITIALIZE FOR NEW RECORD                    
         B     NV050               AND GO PROCESS                               
*                                                                               
NV100    DS    0H                                                               
         CLOSE (NVWORK)                                                         
         CLI   QOPT2,C'R'          TEST FOR REPORT ONLY                         
         BE    EOJ                 YES - EOJ                                    
         CLI   QOPT2,C' '          DEFAULT IS REPORT ONLY                       
         BE    EOJ                                                              
         EJECT                                                                  
*                                                                               
*        WRITE LETTERS TO STATIONS WITH 'NO INVOICE'                            
*                                                                               
         L     R4,ALETBUF                                                       
         C     R4,ALETREC          TEST FOR ANY NO INV RECS                     
         BE    EOJ                                                              
         OPEN  (NVLET,INPUT)       READ STANDARD LETTER FILE                    
         L     R6,ALETTER          AND WRITE LETTER LINES TO STORAGE            
         LA    R5,MAXLLINE                                                      
*                                                                               
NV101    DS    0H                                                               
         GET   NVLET,(R6)                                                       
         LA    R6,80(R6)                                                        
         BCT   R5,NV101                                                         
         DC    H'0'                                                             
*                                                                               
NV102    XC    0(80,R6),0(R6)                                                   
         CLOSE (NVLET)                                                          
         XC    HEADHOOK,HEADHOOK   DISABLE HEADHOOK                             
         L     R1,ABOX                                                          
         MVI   BOXOFF-BOXD(R1),C'Y'  TURN DARN BOXES OFF                        
         TM    FAXSW,FAXON         IF FAXING,                                   
         BZ    *+8                                                              
         OI    FAXSW,FAXFIRST      SET FIRST TIME SWITCH                        
         MVI   RCSUBPRG,1                                                       
         LA    R0,14               CLEAR THE HEADLINES                          
         LA    R1,HEAD1                                                         
*                                                                               
NV103    MVC   0(132,R1),SPACES                                                 
         LA    R1,132(R1)                                                       
         BCT   R0,NV103                                                         
         MVC   P,SPACES                                                         
*                                                                               
         L     R6,ADBUY            LOOK UP ID ON CONTROL FILE                   
         USING CTIREC,R6                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,C'I'                                                     
         MVC   CTIKID+8(2),RCORIGID                                             
         GOTO1 DATAMGR,DMCB,=C'DMREAD',=C'CTFILE',(R6),(R6),0                   
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         LA    R6,28(R6)           FIND DESTINATION ELEMENT                     
         SR    R0,R0                                                            
*                                                                               
NV104    CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLI   0(R6),X'30'                                                      
         BE    *+14                                                             
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     NV104                                                            
         USING CTDSTD,R6                                                        
         MVC   H1+38(L'CTDSTNAM),CTDSTNAM    SET AGY NAME AND ADDRESS           
         MVC   H2+38(L'CTDSTADD),CTDSTADD    IN HEADLINES                       
         CLI   CTDSTLEN,100                                                     
         BNH   NV105                                                            
         MVC   H3+38(L'CTDSTAD2),CTDSTAD2                                       
         DROP  R6                                                               
*                                                                               
NV105    XC    CLTSAVE,CLTSAVE                                                  
         XC    CLTOVER,CLTOVER                                                  
         XC    STASAVEP,STASAVEP                                                
         XC    FAXNUM,FAXNUM                                                    
         MVI   AMLET,0                                                          
*                                                                               
         XC    KEY,KEY             TRY READING COMMENT RECORD FOR A/M           
         MVC   KEY(2),=X'0D0C'                                                  
         MVC   KEY+2(1),BAGYMD                                                  
         MVI   KEY+3,C'N'                                                       
         GOTO1 HIGH                                                             
         CLC   KEY(6),KEYSAVE      COMPARE FOR CLIENT=0                         
         BNE   NV106                                                            
         MVI   AMLET,COM           COMMENT RECORD FOUND FOR A/M                 
         L     R6,ACOMAM                                                        
         ST    R6,AREC                                                          
         GOTO1 GET                 GET IT                                       
         B     NV110                                                            
*                                                                               
NV106    XC    KEY,KEY             READ NV LETTER RECORD                        
         MVC   KEY(2),=X'0D43'                                                  
         MVC   KEY+2(2),AGY                                                     
         MVC   KEY+4(2),RCORIGID                                                
         MVC   KEY+6(1),QMED       TRY WITH MEDIA                               
*                                                                               
NV107    GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE     TEST RECORD FOUND                            
         BE    NV108                                                            
         MVC   KEY,KEYSAVE         NO -                                         
         CLI   KEY+6,0                                                          
         BE    NV110                                                            
         MVI   KEY+6,0             TRY WITH MEDIA=0                             
         B     NV107                                                            
*                                                                               
NV108    MVI   AMLET,NVL           NVL REC FOUND FOR AGY OR AGY/MED             
         L     R6,ADBUY                                                         
         ST    R6,AREC                                                          
         GOTO1 GET                                                              
         GOTO1 EXLETVAR,DMCB,AMADDR,AMSIGNAT,AMDEPART                           
*                                                                               
NV110    C     R4,ALETREC          TEST FOR ANY NO INV RECS                     
         BE    NV230                                                            
         CLI   QRECORD+66,C'Y'     TEST OPTION TO INCLUDE ZERO AMOUNTS          
         BE    NV110A                                                           
         LH    R6,NVDSPGRS         NO-TEST FOR GROSS DOLLARS ZERO               
         LA    R6,0(R4,R6)                                                      
         OC    0(4,R6),0(R6)                                                    
         BZ    NV220               YES - IGNORE THIS RECORD                     
*                                                                               
NV110A   MVI   FORCEHED,C'P'                                                    
         LH    RE,NVDSPCLT                                                      
         LA    RE,0(R4,RE)                                                      
         CLC   CLTSAVE,0(RE)       TEST NEW CLIENT                              
         BE    NV140                                                            
         MVC   CLTSAVE,0(RE)       YES -                                        
*                                                                               
         XC    KEY,KEY             GET CLIENT RECORD                            
         MVC   KEY+1(1),BAGYMD                                                  
         MVC   KEY+2(2),CLTSAVE                                                 
         GOTO1 HIGH                                                             
         CLC   KEY(4),KEYSAVE                                                   
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 GETCLT                                                           
         L     RE,ADCLT                                                         
         MVC   CLTOVER,CMCLTCOD-CLTHDRD(RE)                                     
         MVC   CLTOFFC,COFFICE-CLTHDRD(RE)                                      
         MVC   BYTE,CPROF+6-CLTHDRD(RE)                                         
         GOTO1 CLUNPK,DMCB,(BYTE,CLTSAVE),CLT                                   
*                                                                               
         TM    FAXSW,FAXON         TEST FAXING                                  
         BZ    NV110C                                                           
         CLC   QCLT,=C'ALL'        AND NOT A SINGLE CLIENT REQUEST              
         BE    *+12                                                             
         CLI   QCLT,C'*'                                                        
         BNE   NV110B                                                           
         MVC   WORK(4),=C'S0NV'    YES-GET PROFILE                              
         MVC   WORK+4(2),AGENCY                                                 
         MVC   WORK+6(1),QMED                                                   
         MVC   WORK+7(3),CLT                                                    
         MVI   WORK+10,C'*'                                                     
         MVC   WORK+11(1),CLTOFFC                                               
         GOTO1 GETPROF,DMCB,WORK,PROGPROF,DATAMGR                               
*                                                                               
NV110B   NI    FAXSW,255-FAXCLTOK                                               
         CLI   PROGPROF+3,C'Y'     TEST FAXING OK FOR THIS CLT                  
         BNE   NV110C                                                           
         OI    FAXSW,FAXCLTOK      YES                                          
*                                                                               
NV110C   MVI   COMSW,0                                                          
         MVI   CLTLET,0                                                         
         XC    KEY,KEY             TRY READING COMMENT RECORD                   
         MVC   KEY(2),=X'0D0C'                                                  
         MVC   KEY+2(1),BAGYMD                                                  
         MVI   KEY+3,C'N'                                                       
         MVC   KEY+4(2),CLTSAVE    TRY WITH CLIENT                              
*                                                                               
NV111    GOTO1 HIGH                                                             
         CLC   KEY(6),KEYSAVE      TEST RECORD FOUND                            
         BE    NV112                                                            
         MVC   KEY,KEYSAVE         NO -                                         
         CLI   KEY+4,C'*'                                                       
         BE    NV113                                                            
         MVI   KEY+4,C'*'          TRY WITH CLIENT OFFICE                       
         L     RE,ADCLT                                                         
         MVC   KEY+5(1),COFFICE-CLTHDRD(RE)                                     
         B     NV111                                                            
*                                                                               
NV112    L     R6,ACOMCLT                                                       
         ST    R6,AREC                                                          
         GOTO1 GET                                                              
         MVI   CLTLET,COM          COMMENT RECORD FOUND FOR CLIENT              
         MVI   COMSW,C'Y'                                                       
         B     NV140                                                            
*                                                                               
NV113    XC    KEY,KEY             TRY READING NVL CLIENT RECORD                
         MVC   KEY(2),=X'0D43'                                                  
         MVC   KEY+2(2),AGY                                                     
         MVC   KEY+4(2),RCORIGID                                                
         MVC   KEY+6(1),QMED                                                    
         MVC   KEY+7(2),CLTSAVE                                                 
*                                                                               
NV115    GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE     TEST NVL CLIENT RECORD FOUND                 
         BE    NV120               YES                                          
         MVC   KEY,KEYSAVE                                                      
         CLI   KEY+7,C'*'                                                       
         BE    NV116                                                            
         MVI   KEY+7,C'*'          TRY CLIENT OFFICE                            
         L     RE,ADCLT                                                         
         MVC   KEY+8(1),COFFICE-CLTHDRD(RE)                                     
         B     NV115                                                            
*                                                                               
NV116    CLI   AMLET,0             NO - TEST AGY/MED RECORD FOUND               
         BE    NV118                    NO - ESCAPE WITH ERROR MSG              
         CLI   AMLET,COM                YES - IS IT A/M COMMENT REC             
         BNE   *+8                                                              
         MVI   COMSW,C'Y'                     YES                               
         B     NV140                                                            
*                                                                               
NV118    MVC   P(44),=C'*** NVL RECORD NOT DEFINED FOR SIGNON ID ***'           
         GOTO1 REPORT                                                           
         B     EOJ                                                              
*                                                                               
NV120    L     R6,ADBUY            GET CLIENT NVL RECORD                        
         ST    R6,AREC                                                          
         GOTO1 GET                                                              
         GOTO1 EXLETVAR,DMCB,CLADDR,CLSIGNAT,CLDEPART  EXTRACT VALUES           
         MVI   CLTLET,NVL          NVL RECORD FOUND FOR CLIENT                  
*                                                                               
NV140    TM    FAXSW,FAXON         TEST FAXING LETTERS                          
         BZ    NV142                                                            
         LH    R6,NVDSPSTA                                                      
         LA    R6,0(R4,R6)                                                      
         NI    FAXSW,255-FAXNEWST                                               
         CLC   STASAVEP,0(R6)      YES-TEST NEW STATION                         
         BE    NV142                                                            
         MVC   STASAVEP,0(R6)      YES -                                        
*        BAS   RE,GETFAX           GET FAX NUMBER                               
         GOTO1 =A(GETFAX)                                                       
         OI    FAXSW,FAXNEWST                                                   
*                                                                               
NV142    MVI   RCWHATPR,1                                                       
         TM    FAXSW,FAXOK         TEST OK FOR FAXING                           
         BNO   NV150                                                            
         MVI   RCWHATPR,2          YES-START FAXING NOW                         
         TM    FAXSW,FAXFIRST      IF FIRST TIME, PRINT HEADERS                 
         BO    NV144                                                            
         TM    FAXSW,FAXNEWST      TEST NEW STATION                             
         BZ    NV150                                                            
         BAS   RE,FAXEND           YES-CLOSE PREVIOUS FAX                       
*                                                                               
NV144    BAS   RE,FAXHDR           HEADER LINES FOR EDICT                       
         NI    FAXSW,255-FAXFIRST                                               
*                                                                               
NV150    L     R1,ALETTER          POINT TO FIRST LETTER LINE                   
         ST    R1,ALETLINE                                                      
         LA    R0,6                                                             
         TM    FAXSW,FAXOK                                                      
         BNO   NV170                                                            
         CLI   RCWHATPR,1                                                       
         BNE   NV170                                                            
         LA    R0,4                                                             
*                                                                               
NV170    GOTO1 REPORT              (SOME BLANK LINES AT TOP)                    
         BCT   R0,NV170                                                         
         TM    FAXSW,FAXOK                                                      
         BNO   NV175                                                            
         CLI   RCWHATPR,1                                                       
         BNE   NV175                                                            
         MVC   P(45),=C'*** DO NOT SEND THIS LETTER - THIS LETTER WAS'          
         MVC   P+46(8),=C'FAXED TO'                                             
         OC    FAXNUM,FAXNUM                                                    
         BZ    NV172                                                            
         MVC   P+55(12),FAXNUM                                                  
         MVC   P+68(3),=C'***'                                                  
         B     NV174                                                            
*                                                                               
NV172    MVC   P+55(8),STASAVE                                                  
         MVC   P+64(3),=C'***'                                                  
*                                                                               
NV174    DS    0H                                                               
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
NV175    L     R1,ALETLINE         GET A LETTER LINE                            
         OC    0(80,R1),0(R1)                                                   
         BZ    NV210               END OF LETTER                                
         CLI   QOPT1,C'B'          WANT BOTH NET AND GROSS?                     
         BE    NV179               YES                                          
         CLI   QOPT1,C'G'          WANT ONLY GROSS?                             
         BE    NV176               YES                                          
         CLC   =C'GROSS',8(R1)     PROCESS GROSS?                               
         BE    NV205               YES, WE DONT WANT GROSS, ONLY NET            
         B     NV179                                                            
*                                                                               
NV176    CLC   =C'NET',8(R1)       PROCESS NET?                                 
         BE    NV205               YES, WE DONT WANT NET, ONLY GROSS            
*                                                                               
NV179    MVC   P(80),0(R1)         MOVE LINE TO PRINT LINE                      
         LA    R1,80(R1)                                                        
         ST    R1,ALETLINE         POINT TO NEXT LINE                           
         L     RF,ATABLE                                                        
         TRT   P(80),0(RF)         SCAN FOR VARIABLE IN LINE                    
         BZ    NV200               NO - PRINT THE LINE                          
         LR    R5,R1               YES - FIND VARIABLE GET ROUTINE              
         LA    R2,VARTAB                                                        
*                                                                               
NV180    CLI   0(R2),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   0(4,R2),1(R1)                                                    
         BE    NV190                                                            
         LA    R2,8(R2)                                                         
         B     NV180                                                            
*                                                                               
NV190    MVC   0(5,R5),SPACES                                                   
         L     RF,4(R2)                                                         
         BR    RF                  INSERT VARIABLE VALUE IN LINE                
*                                                                               
NV200    CLC   0(4,R2),=C'STRT'    TEST FOR START OF LETTER TEXT                
         BNE   *+12                                                             
         CLI   COMSW,C'Y'          AND THERE IS A COMMENT RECORD                
         BE    NV210               YES - LETTER IS DONE                         
         GOTO1 REPORT                                                           
         CLI   PROGPROF+6,C'Y'     PRINT BUY CONTRACT ID?                       
         BNE   NV175               NO                                           
         CLC   =C'GROSS',8(R1)     JUST PROCESSED SPOTS?                        
         BNE   NV175               NO                                           
         BAS   RE,PRNTBYID         YES - PRINT THE BUY ID                       
         B     NV175               DONE PRINTING THE BUY-ID                     
*                                                                               
NV205    LA    R1,80(R1)                                                        
         ST    R1,ALETLINE         POINT TO NEXT LINE                           
         B     NV175                                                            
*                                                                               
NV210    CLI   RCWHATPR,2          TEST LETTER HAS JUST BEEN FAXED              
         BNE   NV220                                                            
         MVI   RCWHATPR,1          YES-NOW PRINT A COPY                         
         MVI   FORCEHED,C'P'                                                    
         B     NV150                                                            
*                                                                               
NV220    LA    R4,NVRECLEN(R4)     NEXT NO INVOICE RECORD                       
         B     NV110                                                            
*                                                                               
NV230    TM    FAXSW,FAXON         CLOSE FOR LAST FAX                           
         BZ    EOJ                                                              
         TM    FAXSW,FAXFIRST                                                   
         BO    EOJ                                                              
         BAS   RE,FAXEND                                                        
*                                                                               
*                                                                               
EOJ      CLI   QOPT5,C'T'          JUST TRACE, NO TOTAL PLEASE                  
         BE    EOJ05                                                            
         CLI   QOPT5,C'N'          NO TRACE, NO TOTAL                           
         BE    EOJ05                                                            
         CLI   QOPT5,C' '          DEFAULT, NO TRACE, NO TOTAL                  
         BE    EOJ05                                                            
         GOTO1 =A(PRNTOT)                                                       
EOJ05    XC    RETOTSPT,RETOTSPT   CLEAR THE TOTALS                             
         XC    RETOTGRO,RETOTGRO                                                
         XC    RETOTNET,RETOTNET                                                
         ICM   R2,15,ALETBUF                                                    
         BZ    EXIT                                                             
         L     R3,LLETBUF                                                       
         GOTO1 COVAIL,DMCB,C'FREE',(R2),(R3)                                    
         B     EXIT                                                             
         SPACE 2                                                                
         DS    0F                                                               
VARTAB   DC    C'DATE',A(DATE)                                                  
         DC    C'STA1',A(STA1)                                                  
         DC    C'STA2',A(STA2)                                                  
         DC    C'STA3',A(STA3)                                                  
         DC    C'STAT',A(STAT)                                                  
         DC    C'CLNT',A(CLNT)                                                  
         DC    C'PROD',A(PROD)                                                  
         DC    C'ESTM',A(ESTM)                                                  
         DC    C'MNTH',A(MNTH)                                                  
         DC    C'SPTS',A(SPTS)                                                  
         DC    C'GRSS',A(GRSS)                                                  
         DC    C'NET ',A(NETT)                                                  
         DC    C'ADDR',A(ADDR)                                                  
         DC    C'SIGT',A(SIGT)                                                  
         DC    C'DEPT',A(DEPT)                                                  
         DC    C'DAYS',A(DAYS)                                                  
         DC    C'STRT',A(STRT)                                                  
         DC    X'FF'                                                            
         EJECT                                                                  
*                                                                               
PRNTBYID NTR1                                                                   
*                                                                               
         L     R3,ADREP                                                         
         USING TSARBID,R3                                                       
         MVI   TBIDTYP,TBIDTYPQ    RECORD TYPE X'01'                            
         MVC   TBIDCLT,CLTSAVE     CLIENT CODE                                  
         MVI   TBIDPRD,X'FF'       DEFAULT TO POL PRD                           
         CLI   SVPRD1,0            HAVE A NON-POL PRD?                          
         BE    *+10                NO                                           
         MVC   TBIDPRD,SVPRD1      YES - LOOK UP NON-POL PRD                    
         MVC   TBIDPIG,SVPRD2      PIGGY PRODUCT                                
         LH    R6,NVDSPPER         YEAR/MONTH DISPLACEMENT                      
         AR    R6,R4               POINT TO YEAR/MONTH                          
         MVC   TBIDDAT,0(R6)       YEAR/MONTH                                   
         MVI   TBIDEST,0           ESTIMATE=0                                   
         XR    R6,R6               CLEAR R6                                     
         ICM   R6,3,NVDSPEST       HAVE ESTIMATE DISPLACEMENT?                  
         BZ    PBYID05             NO                                           
         AR    R6,R4               POINT TO ESTIMATE                            
         XR    R0,R0               CLEAR R0                                     
         ICM   R0,1,0(R6)          HAVE ESTIMATE?                               
         BZ    PBYID05             NO                                           
         STC   R0,TBIDEST          ESTIMATE                                     
PBYID05  LH    R6,NVDSPSTA         STATION DISPLACEMENT                         
         AR    R6,R4               POINT TO STATION                             
         MVC   TBIDSTA,0(R6)       STATION                                      
         BAS   RE,TSARHIGH         HAVE BUY ID?                                 
         BNE   EXIT                NO                                           
*                                                                               
         MVC   P+8(8),=C'CONTRACT' MOVE CONTRACT AS HEADLINE                    
         LA    R1,TBIDBID          A(FIRST BUY ID) IN TSAR RECORD               
         XR    R5,R5               CLEAR SO WE USE ICM NOT LLC IN LOOP          
*                                                                               
         LA    R2,116              115 CHARS OF BUYID LAST ',' REMOVED          
         MVI   BYTE,0              INDICATE FIRST LINE                          
         B     *+8                 LENGTH OF FIRST LINE IS UP TO 115            
*                                                                               
PBYID10  IC    R2,BYTE             MAX LENGTH OF PRINT LINE                     
         LA    R4,P+17             START PRINTING BUY ID'S HERE                 
*                                                                               
PBYID20  ICM   R5,1,0(R1)          RECORD LENGTH                                
         BZ    PBYID30             IF ZERO THEN IT'S THE END OF RECORD          
         CR    R2,R5               HAVE ROOM LEFT TO PRINT THIS BUYID?          
         BL    PBYID30             NO - PRINT & RESET PRINT LINE                
         SR    R2,R5               TOTAL CHARS LEFT ON PRINT LINE               
         BCTR  R5,0                -1 FOR EX                                    
         EX    R5,*+8              ** EXECUTED **                               
         B     *+10                BRANCH OVER MVC FOR IDF                      
         MVC   0(0,R4),1(R1)       MOVE THE BUY ID TO THE PRINT LINE            
         AR    R4,R5               POINT TO 1 CHAR AFTER BUY ID                 
         MVI   0(R4),C','          MOVE A COMMA IN                              
         LA    R4,1(R4)            NEXT BUY ID ON PRINT LINE GOES HERE          
         LA    R1,1(R5,R1)         NEXT BUY ID OR EOR                           
         B     PBYID20             LOOP BACK AND PROCESS NEXT BUY-ID            
*                                                                               
PBYID30  BCTR  R4,0                MOVE BACK TO LAST COMMA                      
         MVI   0(R4),C' '          OVERWRITE WITH A SPACE                       
         GOTO1 REPORT              PRINT THIS LINE OF BUY ID'S                  
         LTR   R5,R5               END OF RECORD?                               
         BZ    PBYID40             YES                                          
         CLI   BYTE,0              JUST PRINTED FIRST LINE?                     
         BNE   PBYID10             NO - ALREADY HAVE MAX WIDTH IN BYTE          
         LA    R4,116              MAX 115 CHARS OF BY-ID PER LINE              
         SR    R4,R2               115 - BLANKS LEFTOVER FROM 1ST LINE          
         STC   R4,BYTE             NEW MAX PRINT LINE WIDTH FOR BY-ID           
         B     PBYID10             LOOP BACK & PRINT NEXT LINE OF BY-ID         
*                                                                               
PBYID40  GOTO1 REPORT              PRINT BLANK ROW                              
         B     EXIT                AND EXIT                                     
         DROP  R3                                                               
*                                                                               
TSARHIGH NTR1                                                                   
*                                                                               
         USING TSARBID,R3                                                       
         LA    R2,TSAREA           TSAR AREA                                    
         USING TSARD,R2                                                         
         MVC   WORK(TSARKEYL),TBIDTYP                                           
         ST    R3,TSAREC           A(RECORD)                                    
         MVI   TSOFFACT,TSARDH     TSARHIGH                                     
         L     RF,ADCONLST         GET A(TSAROFF)                               
         L     RF,TSAROFF-SPADCONS(RF)                                          
         GOTO1 (RF),(R2)                                                        
         TM    TSERRS,TSEEOF       DID WE HIT EOF?                              
         BZ    *+10                NO                                           
         LTR   RE,RE               YES - EXIT WITH CC NEQ                       
         B     EXIT                                                             
         CLC   TBIDKEY,WORK        COMPARE KEYS                                 
         B     EXIT                AND EXIT WITH CC SET                         
         DROP  R2,R3                                                            
*                                                                               
* PRINT HEADER LINES FOR EDICT TO START FAXING TO A STATION                     
*                                                                               
FAXHDR   NTR1  ,                                                                
         MVI   RCWHATPR,2                                                       
         LA    R1,P                                                             
         MVC   4(5,R1),=C'*HDR*'                                                
         OC    FAXNUM,FAXNUM                                                    
         BZ    FAXHDR2                                                          
         MVC   9(3,R1),=C'FAX'     FAX NUMBER                                   
         MVC   14(12,R1),FAXNUM                                                 
         MVC   38(12,R1),FAXNUM                                                 
         B     FAXHDR4                                                          
*                                                                               
FAXHDR2  MVC   9(4,R1),STASAVE     STATION CALL LETTERS FOR EASYLINK            
         MVC   13(1,R1),STASAVE+5                                               
         CLI   12(R1),C' '                                                      
         BH    *+8                                                              
         MVI   12(R1),C'9'                                                      
         CLI   STASAVE,C'0'                                                     
         BL    *+14                                                             
         MVI   9(R1),C'T'                                                       
         MVC   10(4,R1),STASAVE                                                 
         MVC   38(8,R1),STASAVE                                                 
*                                                                               
FAXHDR4  MVI   35(R1),C'P'         MAKE EASYLINK RECOGNIZE PAGE SKIPS           
         MVC   54(1,R1),QMED       BILLING INFO                                 
         MVI   FORCEHED,C'P'                                                    
         MVC   SVH1,H1                                                          
         MVC   SVH2,H2                                                          
         MVC   SVH3,H3                                                          
         MVC   H1,SPACES           SUPPRESS HEADLINES                           
         MVC   H2,SPACES                                                        
         MVC   H3,SPACES                                                        
         GOTO1 REPORT                                                           
         MVC   P(14),=C'++DDS SPVNVTRN'                                         
         LA    R1,P+15                                                          
         USING SPEDICTD,R1                                                      
         MVI   SPNVTYPE,SPNVDATQ                                                
         MVC   SPNVMED,QMED                                                     
         MVC   SPNVSTA,STASAVE                                                  
         MVC   SPNVCLT,QCLT                                                     
         DROP  R1                                                               
         GOTO1 REPORT                                                           
******** GOTO1 REPORT                                                           
         MVI   FORCEHED,C'P'                                                    
         MVC   H1,SVH1                                                          
         MVC   H2,SVH2                                                          
         MVC   H3,SVH3                                                          
*                                                                               
FAXHDRX  B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* PRINT END OF FAX MESSAGE                                                      
*                                                                               
FAXEND   LR    R0,RE                                                            
         MVI   RCWHATPR,2                                                       
         MVC   P(L'FAXNDMSG),FAXNDMSG                                           
         MVI   LINE,1                                                           
         MVC   SVH1,H1             SUPPRESS HEADLINES                           
         MVC   SVH2,H2                                                          
         MVC   SVH3,H3                                                          
         MVC   H1,SPACES                                                        
         MVC   H2,SPACES                                                        
         MVC   H3,SPACES                                                        
         GOTO1 REPORT                                                           
         MVC   H1,SVH1                                                          
         MVC   H2,SVH2                                                          
         MVC   H3,SVH3                                                          
         LR    RE,R0                                                            
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
* EXTRACT LETTER VARIABLE VALUES FROM NVL RECORD                                
* INPUT  : R6 = A(NVL RECORD)                                                   
*          P1 = A(ADDRESS FIELD)                                                
*          P2 = A(SIGNATURE FIELD)                                              
*          P3 = A(DEPARTMENT FIELD)                                             
*                                                                               
EXLETVAR NTR1                                                                   
         L     R2,0(R1)            R2 = A(ADDRESS FLD)                          
         L     R3,4(R1)            R3 = A(SIGNATURE FLD)                        
         L     R4,8(R1)            R4 = A(DEPARTMENT FLD)                       
         MVC   0(65,R2),SPACES                                                  
         MVC   0(65,R3),SPACES                                                  
         MVC   0(65,R4),SPACES                                                  
*                                                                               
         MVI   ELCODE,1            GET ADDRESS                                  
         MVC   DATADSP,=H'24'                                                   
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING NVLEL01,R6                                                       
         ZIC   R1,1(R6)                                                         
         SH    R1,=H'3'                                                         
         BNM   *+6                                                              
         DC    H'0'                                                             
         LR    RE,R2                                                            
         LA    RF,NVLADDR                                                       
         EX    R1,NVMVC                                                         
*                                                                               
         MVI   ELCODE,2            GET SIGNATURE                                
         BAS   RE,NEXTEL                                                        
         USING NVLEL02,R6                                                       
         IC    R1,1(R6)                                                         
         SH    R1,=H'3'                                                         
         BNM   *+6                                                              
         DC    H'0'                                                             
         LR    RE,R3                                                            
         LA    RF,NVLSIGT                                                       
         EX    R1,NVMVC                                                         
*                                                                               
         MVI   ELCODE,3            GET DEPARTMENT                               
         BAS   RE,NEXTEL                                                        
         USING NVLEL03,R6                                                       
         IC    R1,1(R6)                                                         
         SH    R1,=H'3'                                                         
         BNM   *+6                                                              
         DC    H'0'                                                             
         LR    RE,R4                                                            
         LA    RF,NVLDEPT                                                       
         EX    R1,NVMVC                                                         
         B     EXIT                                                             
*                                                                               
NVMVC    MVC   0(0,RE),0(RF)       ** EXECUTED                                  
         EJECT                                                                  
*                                                                               
*        LETTER VARIABLE GET ROUTINES                                           
*        R4 = A(RECORD)                                                         
*        R5 = A(POSITION IN LETTER LINE)                                        
*                                                                               
         SPACE                                                                  
DATE     LA    RE,TODAY            DATE = TODAY                                 
         CLC   QLETDATE(6),SPACES  UNLESS LETTER DATE OVERRIDE                  
         BNH   *+8                                                              
         LA    RE,QLETDATE                                                      
         ST    RE,DMCB                                                          
         GOTO1 DATCON,DMCB,,(5,0(R5))                                           
         B     NV200                                                            
         SPACE                                                                  
STA1     XC    KEY,KEY             READ STATION ADDRESS RECORD                  
         MVI   KEY,C'A'                                                         
         MVC   KEY+1(1),QMED                                                    
         LH    R6,NVDSPSTA                                                      
         LA    R6,0(R6,R4)                                                      
         BAS   RE,STAUNPK                                                       
         MVC   STASAVE,WORK                                                     
         MVC   KEY+2(4),STASAVE                                                 
         MVC   KEY+6(1),STASAVE+5                                               
         CLI   STASAVE,C'0'        TEST CABLE                                   
         BL    *+8                                                              
         MVI   KEY+6,C'T'          YES-MEDIA IS T                               
         MVC   KEY+7(2),QAGY                                                    
         GOTO1 HIGHSTAD                                                         
         L     R6,ADSTATAD                                                      
         CLC   KEY(9),0(R6)                                                     
         BE    *+18                                                             
         MVI   STADSW,C'N'                                                      
         MVC   0(20,R5),ASTERS                                                  
         B     NV200                                                            
         MVI   STADSW,C'Y'                                                      
         USING ADDRRECD,R6                                                      
         MVC   0(L'ANAME,R5),ANAME                                              
         B     NV200                                                            
         SPACE                                                                  
STA2     CLI   STADSW,C'Y'         TEST FOR STATION ADDRESS REC FOUND           
         BNE   NV200                                                            
         USING ADDRRECD,R6         (ASSUMES STA1 CAME BEFORE)                   
         MVC   0(L'A1LINE,R5),A1LINE                                            
         GOTO1 SQUASHER,DMCB,(R5),40                                            
         B     NV200                                                            
         SPACE                                                                  
STA3     CLI   STADSW,C'Y'         TEST FOR STATION ADDRESS REC FOUND           
         BNE   NV200                                                            
         USING ADDRRECD,R6                                                      
         MVC   0(L'A2LINE,R5),A2LINE                                            
         MVC   L'A2LINE+1(L'A3LINE,R5),A3LINE                                   
         MVC   L'A2LINE+L'A3LINE+2(L'ABIGZIP,R5),ABIGZIP                        
         GOTO1 SQUASHER,DMCB,(R5),40                                            
         B     NV200                                                            
         SPACE                                                                  
STAT     MVC   0(8,R5),STASAVE     ASSUMES STA1 CAME BEFORE                     
         CLI   STASAVE,C'0'        TEST CABLE                                   
         BNL   NV200               YES                                          
         MVI   6(R5),C'V'          NO-                                          
         CLI   5(R5),C'T'                                                       
         BE    NV200                                                            
         MVI   6(R5),C'M'                                                       
         B     NV200                                                            
         SPACE                                                                  
CLNT     MVC   0(L'CLT,R5),CLT                                                  
         MVC   L'CLT+1(L'CLTNM,R5),CLTNM                                        
         B     NV200                                                            
         SPACE                                                                  
PROD     LH    R6,NVDSPPRD                                                      
         LA    R6,0(R6,R4)                                                      
         BAS   RE,EXTPROD                                                       
         OC    WORK,WORK                                                        
         BZ    NV200                                                            
         XC    KEY,KEY                                                          
         MVC   KEY+1(1),BAGYMD                                                  
         MVC   KEY+2(2),CLTSAVE                                                 
         OC    CLTOVER,CLTOVER                                                  
         BZ    *+10                                                             
         MVC   KEY+2(2),CLTOVER                                                 
         LA    R0,2                                                             
         LR    R2,R5                                                            
         LA    R3,WORK                                                          
*                                                                               
PROD2    MVC   KEY+4(3),0(R3)                                                   
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   AREC,ADPRD                                                       
         GOTO1 GET                                                              
         L     R6,AREC                                                          
         USING PRDHDRD,R6                                                       
         MVC   0(3,R2),0(R3)                                                    
         MVC   4(L'PNAME,R2),PNAME                                              
         CLI   WORK+3,C'-'         TEST FOR PIGGYBACK                           
         BNE   NV200                                                            
         BCT   R0,PROD4                                                         
         LA    R2,L'PNAME+L'PNAME+11                                            
         GOTO1 SQUASHER,DMCB,(R5),(R2)                                          
         B     NV200                                                            
*                                                                               
PROD4    MVI   L'PNAME+5(R2),C'/'                                               
         LA    R2,L'PNAME+7(R2)                                                 
         LA    R3,WORK+4                                                        
         B     PROD2                                                            
         SPACE                                                                  
ESTM     SR    R6,R6                                                            
         ICM   R6,3,NVDSPEST       TEST ESTIMATE IN RECORD                      
         BZ    NV175               NO - SKIP ESTIMATE                           
         LA    R6,0(R6,R4)                                                      
         SR    R0,R0                                                            
         ICM   R0,1,0(R6)                                                       
         BZ    NV200                                                            
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R5),DUB                                                      
         B     NV200                                                            
         SPACE                                                                  
MNTH     LH    R6,NVDSPPER                                                      
         LA    R6,0(R6,R4)                                                      
         MVC   DUB(2),0(R6)                                                     
         MVI   DUB+2,1                                                          
         GOTO1 DATCON,DMCB,(3,DUB),(6,0(R5))                                    
         B     NV200                                                            
         SPACE                                                                  
SPTS     LH    R6,NVDSPSPT                                                      
         LA    R6,0(R6,R4)                                                      
         L     R6,0(R6)                                                         
         EDIT  (R6),(5,(R5)),ALIGN=LEFT                                         
         B     NV200                                                            
         SPACE                                                                  
GRSS     LH    R6,NVDSPGRS                                                      
         LA    R6,0(R6,R4)                                                      
         L     R6,0(R6)                                                         
         EDIT  (R6),(11,(R5)),2,ALIGN=LEFT,FLOAT=$,MINUS=YES                    
         B     NV200                                                            
         SPACE                                                                  
NETT     LH    R6,NVDSPNET                                                      
         LA    R6,0(R6,R4)                                                      
         L     R6,0(R6)                                                         
         EDIT  (R6),(11,(R5)),2,ALIGN=LEFT,FLOAT=$,MINUS=YES                    
         B     NV200                                                            
         SPACE                                                                  
ADDR     LA    RE,AMADDR                                                        
         CLI   CLTLET,NVL                                                       
         BNE   *+8                                                              
         LA    RE,CLADDR                                                        
         MVC   0(65,R5),0(RE)                                                   
         B     NV200                                                            
         SPACE                                                                  
SIGT     LA    RE,AMSIGNAT                                                      
         CLI   CLTLET,NVL                                                       
         BNE   *+8                                                              
         LA    RE,CLSIGNAT                                                      
         MVC   0(65,R5),0(RE)                                                   
         LA    R1,64(R5)           PLACE COMMA AFTER SIGNATURE                  
         SR    RE,RE                                                            
         BCTR  RE,0                                                             
         LR    RF,R5                                                            
         BCTR  RF,0                                                             
         CLI   0(R1),C' '                                                       
         BH    *+12                                                             
         BXH   R1,RE,*-8                                                        
         B     NV175           NO SIGNATURE - DON'T PRINT BLANK LINE            
         MVI   1(R1),C','                                                       
         B     NV200                                                            
         SPACE                                                                  
DEPT     LA    RE,AMDEPART                                                      
         CLI   CLTLET,NVL                                                       
         BNE   *+8                                                              
         LA    RE,CLDEPART                                                      
         MVC   0(65,R5),0(RE)                                                   
         B     NV200                                                            
         SPACE                                                                  
DAYS     LA    R6,10               DEFAULT NUMBER OF DAYS                       
         CLI   PROGPROF,0          TEST FOR PROFILE OVERRIDE                    
         BE    *+8                                                              
         IC    R6,PROGPROF                                                      
         EDIT  (R6),(5,(R5))       EDIT DAYS TO LETTER                          
         LA    R6,P+80                                                          
         SR    R6,R5               REMOVE GAP                                   
         GOTO1 SQUASHER,DMCB,(R5),(R6)                                          
         B     NV200                                                            
         SPACE 1                                                                
STRT     CLI   COMSW,C'Y'          START OF LETTER TEXT                         
         BE    *+14                TEST FOR COMMENT RECORD                      
         MVC   0(5,R5),SPACES      NO - CONTINUE WITH TEXT DATA SET             
         B     STRTX                                                            
         MVC   P,SPACES                                                         
         L     R6,ACOMCLT                                                       
         CLI   CLTLET,COM          CLIENT LEVEL COMMENT RECORD                  
         BE    STRT1                                                            
         L     R6,ACOMAM                                                        
         CLI   AMLET,COM           A/M LEVEL COMMENT RECORD                     
         BE    *+6                                                              
         DC    H'0'                                                             
         USING COMHDRD,R6                                                       
STRT1    SR    R0,R0                                                            
         LA    R6,COMEL            FIND THE COMMENT ELEMENTS                    
STRT2    CLI   0(R6),0                                                          
         BE    STRTX                                                            
         CLI   0(R6),5                                                          
         BE    *+12                                                             
         CLI   0(R6),15                                                         
         BNE   STRT8                                                            
         CLC   1(2,R6),=X'0300'    FOUND - TEST USELESS ELEMENT                 
         BE    STRT8                                                            
         LA    R1,2(R6)            NO                                           
         LA    RE,3                                                             
         CLI   2(R6),C'+'          TEST SKIP A LINE(S)                          
         BNE   STRT6                                                            
         CLI   1(R6),3                                                          
         BNH   STRT6                                                            
         CLI   3(R6),C'1'                                                       
         BL    STRT6                                                            
         CLI   3(R6),C'9'                                                       
         BH    STRT6                                                            
         ZIC   R0,3(R6)            SKIP                                         
         SH    R0,=H'240'                                                       
STRT4    GOTO1 REPORT                                                           
         BCT   R0,STRT4                                                         
         LA    R1,4(R6)                                                         
         LA    RE,5                                                             
STRT6    ZIC   RF,1(R6)            MOVE COMMENT LINE TO PRINT LINE              
         SR    RF,RE                                                            
         BM    STRT8                                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   P+8(0),0(R1)                                                     
         GOTO1 REPORT              PRINT THE LINE                               
STRT8    IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     STRT2                                                            
STRTX    B     NV200                                                            
         EJECT                                                                  
SETHEAD  NTR1                                                                   
*                                                                               
*        ROUTINE TO SET THE HEADLINES                                           
*                                                                               
         MVI   CLEARHED,C'N'       SUPPRESS HEADLINE CLEARING                   
         LA    R0,14                                                            
         LA    R1,HEAD1                                                         
*                                                                               
SH005    MVC   0(132,R1),SPACES    CLEAR THE HEADLINES                          
         LA    R1,132(R1)                                                       
         BCT   R0,SH005                                                         
*                                                                               
         SR    RE,RE               CLEAR MAX ROW TITLE LENGTH                   
         SR    RF,RF               CLEAR MAX ROW CODE LENGTH                    
         LA    R1,NVSPECS                                                       
         USING SPECD,R2                                                         
*                                                                               
SH010    CLI   0(R1),X'FF'         TEST FOR END OF SPECS                        
         BE    SH030                                                            
         OC    0(4,R1),0(R1)       TEST FOR HOLE                                
         BZ    SH020                                                            
         L     R2,0(R1)                                                         
         TM    SPECIND,PL          TEST HEADLINE SPEC                           
         BO    SH020                                                            
         CLM   RE,1,SPECTLEN                                                    
         BNL   *+8                                                              
         IC    RE,SPECTLEN                                                      
         CLM   RF,1,SPECCLEN                                                    
         BNL   SH020                                                            
         IC    RF,SPECCLEN                                                      
*                                                                               
SH020    LA    R1,4(R1)                                                         
         B     SH010                                                            
*                                                                               
SH030    STC   RE,MAXTTL           SET MAX ROW TITLE LENGTH                     
         STC   RF,MAXCOD           SET MAX ROW CODE LENGTH                      
*                                                                               
         MVC   QEND+4(2),=C'01'                                                 
         CLC   QSTART(4),SPACES    TEST FOR REQ START DATE                      
         BNE   SH038                                                            
         GOTO1 DATCON,DMCB,(0,QEND),(3,FULL)   NO                               
         LA    R4,NVDATES                                                       
*                                                                               
SH035    CLC   4(2,R4),FULL        FIND BROADCAST MONTH END FOR                 
         BE    SH037                REQUEST MONTH                               
         LA    R4,6(R4)                                                         
         B     SH035                                                            
*                                                                               
SH037    LA    R5,HEAD3+48                                                      
         MVC   0(4,R5),=C'THRU'                                                 
         GOTO1 DATCON,DMCB,(2,2(R4)),(5,5(R5))                                  
         B     SH039                                                            
*                                                                               
SH038    CLI   NVPARTMN,C'Y'       TEST FOR PARTIAL MONTH                       
         BE    SH038A                                                           
         MVC   HEAD3+39(2),SPACES  NO                                           
         LA    R5,HEAD3+41                                                      
         MVC   0(11,R5),=C'PERIOD FROM'                                         
         MVC   QSTART+4(2),=C'01'                                               
         GOTO1 DATCON,DMCB,(0,QSTART),(6,12(R5))                                
         MVC   19(2,R5),=C'TO'                                                  
         GOTO1 DATCON,DMCB,(0,QEND),(6,22(R5))                                  
         B     SH039                                                            
*                                                                               
SH038A   MVC   HEAD3+37(2),SPACES  PARTIAL MONTH                                
         LA    R5,HEAD3+39                                                      
         MVC   0(11,R5),=C'PERIOD FROM'                                         
         GOTO1 DATCON,DMCB,(2,BQSTARTP),(5,12(R5))                              
         MVC   21(2,R5),=C'TO'                                                  
         GOTO1 DATCON,DMCB,(2,BQENDP),(5,24(R5))                                
         B     SH039                                                            
         EJECT                                                                  
*                                                                               
*        WORK OUT PRINT LINE DISPLACEMENTS                                      
*                                                                               
SH039    XC    RCDTA,RCDTA         CLEAR MY SPEC AREA                           
         LA    R3,RCDTA                                                         
         LA    R1,NVSPECS                                                       
         MVI   BYTE,0                                                           
         MVI   CBSKIP,0                                                         
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         IC    RE,QSKIPLN                                                       
         SLL   RE,28                                                            
         SRL   RE,28                                                            
         STC   RE,HALF             SKIP LINE DATA CODE                          
         USING SPECD,R2                                                         
*                                                                               
SH040    CLI   0(R1),X'FF'         TEST FOR END OF SPECS                        
         BE    SH080                                                            
         OC    0(4,R1),0(R1)       TEST FOR HOLE                                
         BZ    SH075                                                            
         L     R2,0(R1)            LOAD SPEC ADDR                               
*                                                                               
         CLI   SPECDATA,SPECMGR1   SORT OUT MARKET AND PRODUCT GROUPS           
         BNE   *+14                MARKET GROUP 1                               
         MVC   SPECTITL(L'MGR1BK),MGR1BK                                        
         B     SH045                                                            
         CLI   SPECDATA,SPECMGR2   MARKET GROUP 2                               
         BNE   *+14                                                             
         MVC   SPECTITL(L'MGR2BK),MGR2BK                                        
         B     SH045                                                            
         CLI   SPECDATA,SPECMGR3   MARKET GROUP 3                               
         BNE   *+14                                                             
         MVC   SPECTITL(L'MGR3BK),MGR3BK                                        
         B     SH045                                                            
         CLI   SPECDATA,SPECPGR1   PRODUCT GROUP 1                              
         BNE   *+14                                                             
         MVC   SPECTITL(L'PGR1BK),PGR1BK                                        
         B     SH045                                                            
         CLI   SPECDATA,SPECPGR2   PRODUCT GROUP 2                              
         BNE   SH045                                                            
         MVC   SPECTITL(L'PGR2BK),PGR2BK                                        
*                                                                               
SH045    MVC   0(4,R3),0(R1)       MOVE SPEC ADDR                               
         TM    SPECIND,PL          TEST PRINTLINE SPEC                          
         BZ    SH070               NO - NO NEED FOR ROW/COL WIDTH               
         CLI   0(R1),NVKEYLEN      TEST FOR ROW                                 
         BNL   SH060                                                            
         IC    RF,0(R1)            FIND ITS ROW NUMBER                          
         SRL   RF,2                                                             
         LA    RF,1(RF)                                                         
         CLI   BYTE,0                                                           
         BNE   SH046                                                            
         MVI   BYTE,1                                                           
         STC   RF,CBPROW1          FIRST PRINT LINE ROW NUMBER                  
         B     SH047                                                            
*                                                                               
SH046    CLC   SPECDATA,HALF       TEST FOR SKIP A LINE ROW                     
         BNE   SH047                                                            
         STC   RF,CBSKIP           LEVEL AT WHICH TO SKIP A LINE                
*                                                                               
SH047    IC    RE,SPECCLEN         DETERMINE ROW WIDTH - CODE ONLY              
         CLI   SPECDATA,SPECMKT    TEST FOR MARKET ROW                          
         BNE   SH050                                                            
         IC    RF,SPECNLEN         YES - CODE AND NAME                          
         LA    RE,1(RF,RE)                                                      
*                                                                               
SH050    IC    RF,SPECTLEN         COMPARE AGAINST TITLE LENGTH                 
         CR    RE,RF                                                            
         BNL   *+6                 TAKE THE LARGER                              
         LR    RE,RF                                                            
         STC   RE,4(R3)            ROW WIDTH                                    
         B     SH070                                                            
*                                                                               
SH060    MVC   4(1,R3),SPECTLEN    COL WIDTH IS TITLE LENGTH                    
*                                                                               
SH070    LA    R3,8(R3)                                                         
*                                                                               
SH075    LA    R1,4(R1)                                                         
         B     SH040                                                            
*                                                                               
SH080    MVI   0(R3),X'FF'                                                      
         EJECT                                                                  
SH100    DS    0H                                                               
*                                                                               
*        FIND OUT LENGTH OF PRINT LINE                                          
*                                                                               
         LA    R0,NVROWMAX+NVCOLMAX                                             
         LA    RF,RCDTA                                                         
         SR    R1,R1                                                            
         SR    RE,RE                                                            
*                                                                               
SH110    CLI   0(RF),X'FF'                                                      
         BE    SH120                                                            
         ICM   RE,1,4(RF)                                                       
         BZ    *+10                                                             
         AR    R1,RE               ADD LENGTH OF THIS FIELD                     
         LA    R1,1(R1)              + SPACE BETWEEN                            
         LA    RF,8(RF)                                                         
         BCT   R0,SH110                                                         
*                                                                               
SH120    BCTR  R1,0                ADJUST FOR FINAL SPACE                       
*                                                                               
         CH    R1,=H'255'                                                       
         BNH   *+6                                                              
         DC    H'0'                                                             
         LA    RE,110                                                           
         SR    RE,R1                                                            
         BNM   *+6                                                              
         DC    H'0'                TOO MUCH PRINT LINE DATA                     
         LA    RE,1(RE)            ROUND UP                                     
         SRL   RE,1                GIVES LEFTMOST PRINT DSPL                    
         STC   RE,MARGIN           SAVE IT                                      
         AR    RE,R1                                                            
         STC   RE,RTMARGIN         SAVE RIGHTMOST PRINT DSPL                    
*                                                                               
         L     RF,=A(BXCOL)                                                     
         XC    0(L'BXCOL,RF),0(RF)                                              
         IC    RE,MARGIN                                                        
         AR    RE,RF                                                            
         BCTR  RE,0                                                             
         MVI   0(RE),C'L'          SET LEFT HAND BOX COL                        
         LA    RE,1(R1,RE)                                                      
         MVI   0(RE),C'R'          SET RIGHT HAND BOX COL                       
*                                                                               
         L     R4,ABOX             TURN BOXES ON NOW                            
         USING BOXD,R4                                                          
         L     RF,=A(BXROW)                                                     
         MVC   BOXROWS,0(RF)                                                    
         MVI   BOXWT,1                                                          
         MVI   BOXYORN,C'Y'                                                     
         MVI   BOXOFF,0                                                         
         MVI   BOXINIT,0                                                        
         EJECT                                                                  
*                                                                               
*        SET ACTUAL PRINT LINE DISPLACEMENTS                                    
*                                                                               
         LA    R0,NVROWMAX+NVCOLMAX                                             
         LA    RF,RCDTA                                                         
         ZIC   R1,MARGIN           GET LEFTMOST COL                             
         SR    RE,RE                                                            
*                                                                               
SH140    CLI   0(RF),X'FF'                                                      
         BE    SH150                                                            
         ICM   RE,1,4(RF)          MOVE FIELD LENGTH                            
         BZ    SH145               ZERO - IT'S A HEADLINE                       
         STC   R1,4(RF)            SET DISPLACEMENT                             
         AR    R1,RE                                                            
         LA    R1,1(R1)            ONE COL BETWEEN FIELDS                       
*                                                                               
SH145    LA    RF,8(RF)                                                         
         BCT   R0,SH140                                                         
*                                                                               
SH150    LA    RF,RCDTA                                                         
*                                                                               
SH155    CLI   0(RF),NVKEYLEN      FIND FIRST COL                               
         BE    SH160                                                            
         LA    RF,8(RF)                                                         
         CLI   0(RF),X'FF'                                                      
         BNE   SH155                                                            
         DC    H'0'                                                             
*                                                                               
SH160    IC    RE,4(RF)            DISPLACEMENT OF FIRST COL                    
         STC   RE,DSPCOLS          SAVE IT                                      
         L     RF,=A(BXCOL)                                                     
         AR    RE,RF                                                            
         BCTR  RE,0                                                             
         MVI   0(RE),C'C'          SET ROW/COL DIVIDER                          
         MVC   BOXCOLS(L'BXCOL),0(RF)                                           
         EJECT                                                                  
*                                                                               
*        MOVE TITLES OF PRINT LINES TO HEADLINES                                
*                                                                               
         LA    R3,RCDTA                                                         
         LA    R0,NVROWMAX+NVCOLMAX                                             
         SR    RE,RE                                                            
*                                                                               
SH170    CLI   0(R3),X'FF'                                                      
         BE    SH200                                                            
         CLI   4(R3),0             TEST FOR HEADLINE                            
         BE    SH190                                                            
         ZIC   R1,4(R3)            GET PRINT DSPL                               
         L     R2,0(R3)            GET SPEC ADDR                                
         LA    R1,HEAD9(R1)        POINT TO HEADLINE POSITION                   
         ZIC   RE,SPECTLEN         GET TITLE LENGTH                             
         BCTR  RE,0                                                             
         LA    RF,SPECTITL                                                      
         EX    RE,MOVETITL         MOVE TITLE TO HEADLINE                       
*                                                                               
SH190    LA    R3,8(R3)                                                         
         BCT   R0,SH170                                                         
*                                                                               
SH200    B     EXIT                                                             
*                                                                               
*                                                                               
MOVETITL MVC   0(0,R1),0(RF)       EXECUTED                                     
         EJECT                                                                  
CBFIRST  NTR1                                                                   
*                                                                               
*        ROUTINE TO PROCESS 'FIRSTS' FOR ROWS FROM CBLEVEL TO LAST ROW          
*                                                                               
CB005    ZIC   R3,CBLEVEL                                                       
         BCTR  R3,0                                                             
         SLL   R3,2                GET DISPLACEMENT INTO RECORD                 
         LA    R1,RCDTA                                                         
         MVI   BYTE,0                                                           
*                                                                               
CB007    CLI   0(R1),X'FF'         FIND SPEC FOR THIS LEVEL                     
         BE    CBNEXT                                                           
         CLI   0(R1),NVKEYLEN                                                   
         BL    *+8                 HAVE WE REACHED A COLUMN YET ?               
         MVI   BYTE,1              YES                                          
         CLM   R3,1,0(R1)                                                       
         BE    CB008                                                            
         LA    R1,8(R1)                                                         
         B     CB007                                                            
*                                                                               
CB008    L     R2,0(R1)                                                         
         TM    SPECDATA,X'80'                                                   
         BO    CBNEXT                                                           
         LA    R6,REC(R3)          POINT TO ROW CODE IN RECORD                  
         BAS   RE,GETNAME                                                       
         TM    SPECIND,PL                                                       
         BZ    CB010               HEADLINE                                     
         CLI   USRSW2,C'Y'         TEST FOR CALL FROM HEADHOOK                  
         BNE   *+12                                                             
         CLI   BYTE,1              YES - TEST FOR ROW AMONGST COLS              
         BE    CBNEXT                    YES - DO NOT POST                      
         B     CB050               PRINTLINE                                    
         EJECT                                                                  
CB010    DS    0H                                                               
*                                                                               
*        HEADLINE ROW                                                           
*                                                                               
         MVI   FORCEHED,C'P'                                                    
         ZIC   R4,CBLEVEL                                                       
         BCTR  R4,0                                                             
         MH    R4,=H'132'                                                       
         LA    R4,HEAD2(R4)        ROW 1 DATA GOES ON HEAD 2                    
         LR    R6,R4               STORE HEADLINE ADDR IN R6                    
         ZIC   RE,SPECTLEN         GET TITLE DATA LENGTH                        
         LTR   RE,RE                                                            
         BZ    CB020                                                            
         BCTR  RE,0                                                             
         EX    RE,CBMOVE                                                        
         B     CB020                                                            
*                                                                               
CBMOVE   MVC   0(0,R4),SPECTITL    EXECUTED                                     
*                                                                               
CB020    IC    RE,MAXTTL           GET MAX TITLE LENGTH                         
         LA    R4,1(RE,R4)         SET NEXT OUTPUT POSITION                     
         IC    RE,MAXCOD                                                        
         BCTR  RE,0                                                             
         EX    RE,CBMOVE2                                                       
         B     CB030                                                            
*                                                                               
CBMOVE2  MVC   0(0,R4),WORK                                                     
*                                                                               
CB030    LA    R4,2(R4,RE)         SET NEXT OUTPUT POSITION                     
         LA    RE,38(R6)           LIMIT LENGTH OF NAME                         
         SR    RE,R4                                                            
         BNM   *+6                                                              
         DC    H'0'                                                             
         EX    RE,CBMOVE3                                                       
         B     CBNEXT                                                           
*                                                                               
CBMOVE3  MVC   0(0,R4),WORK+8                                                   
         EJECT                                                                  
CB050    DS    0H                                                               
*                                                                               
*        PRINT LINE ROW                                                         
*                                                                               
         ZIC   R4,4(R1)            DISPLACEMENT TO ROW                          
         LA    R4,P(R4)            PRINT LINE ADDR                              
         ZIC   R5,SPECCLEN                                                      
         CLI   SPECDATA,SPECMKT                                                 
         BE    *+10                                                             
         BCTR  R5,0                                                             
         B     CB060                                                            
         GOTO1 SQUASHER,DMCB,WORK,64   SQUASH PRINT LINE                        
         ZIC   RE,SPECNLEN                                                      
         AR    R5,RE                                                            
*                                                                               
CB060    EX    R5,CBMOVE2                                                       
*                                                                               
CBNEXT   ZIC   RE,CBLEVEL                                                       
         LA    RE,1(RE)                                                         
         STC   RE,CBLEVEL                                                       
         CLI   CBLEVEL,NVROWMAX    PROCESS ALL ROWS                             
         BNH   CB005                                                            
*                                                                               
CB999    B     EXIT                                                             
         EJECT                                                                  
GETNAME  NTR1                                                                   
*                                                                               
*        ROUTINE TO BUILD PRINTABLE CODES AND EXTRACT NAMES AS REQUIRED         
*        R6 = A(ROW IN RECORD)                                                  
*        PRINTABLE DATA IS RETURNED IN WORK(64)                                 
*                                                                               
         MVC   WORK,SPACES                                                      
         LA    R1,GETTAB                                                        
*                                                                               
GN010    CLI   0(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   SPECDATA,0(R1)                                                   
         BE    GN020                                                            
         LA    R1,4(R1)                                                         
         B     GN010                                                            
*                                                                               
GN020    ICM   RF,7,1(R1)                                                       
         BZ    GETNAMX                                                          
         BR    RF                  GO                                           
*                                                                               
GETOFC   DS    0H                                                               
         CLI   1(R6),C' '          IS THIS A 2 CHAR OFFICE?                     
         BNH   GOFC10               NO                                          
         MVC   WORK(2),0(R6)        YES - JUST PRINT IT AS IS                   
         B     GETNAMX                                                          
*                                                                               
GOFC10   GOTO1 =V(OFFOUT),DMCB,(R6),HEXOUT,(C'L',WORK)                          
         B     GETNAMX                                                          
*                                                                               
GETCLINT XC    KEY,KEY                                                          
         MVC   KEY+1(1),BAGYMD                                                  
         MVC   KEY+2(2),0(R6)                                                   
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 GETCLT                                                           
         MVC   WORK(3),CLT                                                      
         TM    SPECIND,PL                                                       
         BO    GETNAMX                                                          
         MVC   WORK+8(24),CLTNM                                                 
         B     GETNAMX                                                          
*                                                                               
GETMGR1  CLC   MGR1LEN,MGR2LEN                                                  
         BE    GETMGR1A                                                         
         LA    R6,4(R6)                                                         
         CLC   MGR2LEN,MGR3LEN                                                  
         BE    GETMGR1A                                                         
         LA    R6,4(R6)                                                         
*                                                                               
GETMGR1A CLC   MGRPSV,0(R6)                                                     
         BE    *+8                                                              
         BAS   RE,GETMGRP                                                       
         CLC   MGRPSV,=X'9999'                                                  
         BE    GETMGR4                                                          
         MVC   WORK(6),MGR1N                                                    
         MVC   WORK+8(24),MGR1NM                                                
         B     GETMGR6                                                          
*                                                                               
GETMGR2  CLC   MGR2LEN,MGR3LEN                                                  
         BE    *+8                                                              
         LA    R6,4(R6)                                                         
         CLC   MGRPSV,0(R6)                                                     
         BE    *+8                                                              
         BAS   RE,GETMGRP                                                       
         CLC   MGRPSV,=X'9999'                                                  
         BE    GETMGR4                                                          
         MVC   WORK(6),MGR2N                                                    
         MVC   WORK+8(24),MGR2NM                                                
         B     GETMGR6                                                          
*                                                                               
GETMGR3  CLC   MGRPSV,0(R6)                                                     
         BE    *+8                                                              
         BAS   RE,GETMGRP                                                       
         CLC   MGRPSV,=X'9999'                                                  
         BE    GETMGR4                                                          
         MVC   WORK(6),MGR3N                                                    
         MVC   WORK+8(24),MGR3NM                                                
         B     GETMGR6                                                          
*                                                                               
GETMGR4  LA    RE,WORK                                                          
         MVC   0(2,RE),MGR1N                                                    
         XR    RF,RF                                                            
         ICM   RF,1,MGRLEN                                                      
         AR    RE,RF                                                            
         MVC   0(4,RE),=C'9999'                                                 
         MVC   WORK+8(24),BADNAME                                               
*                                                                               
GETMGR6  TM    SPECIND,PL                                                       
         BZ    GETNAMX                                                          
         XC    WORK+8(24),WORK+8                                                
         B     GETNAMX                                                          
*                                                                               
GETMKT   MVI   KEY,C'0'                                                         
         MVC   KEY+1(16),KEY                                                    
         MVI   KEY,C'M'                                                         
         MVC   KEY+1(1),QMED                                                    
         SR    R0,R0                                                            
         ICM   R0,3,0(R6)                                                       
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  KEY+2(4),DUB                                                     
         MVC   WORK(4),KEY+2       MARKET CODE                                  
         MVC   KEY+6(2),QAGY                                                    
         ICM   RF,15,ADMARKET                                                   
         BZ    *+14                                                             
         CLC   KEY(6),0(RF)                                                     
         BE    GETMKT2                                                          
         GOTO1 HIGHMKT                                                          
         L     RF,ADMARKET                                                      
         USING MKTRECD,RF                                                       
*                                                                               
GETMKT2  MVC   WORK+8(20),MKTNAME  MARKET NAME                                  
         CLC   KEY(8),0(RF)                                                     
         BE    GETNAMX                                                          
         MVC   WORK+8(24),BADNAME                                               
         B     GETNAMX                                                          
*                                                                               
GETSTA   BAS   RE,STAUNPK                                                       
         B     GETNAMX                                                          
*                                                                               
GETPER   MVC   DUB,0(R6)                                                        
         MVI   DUB+2,1                                                          
         GOTO1 DATCON,DMCB,(3,DUB),(6,WORK)                                     
         B     GETNAMX                                                          
*                                                                               
GETPGR1  CLC   PGR1LEN,PGR2LEN                                                  
         BE    *+8                                                              
         LA    R6,4(R6)                                                         
         CLC   PGRPSV,0(R6)                                                     
         BE    *+8                                                              
         BAS   RE,GETPGRP                                                       
         CLC   PGRPSV,=X'9999'                                                  
         BE    GETPGR3                                                          
         MVC   WORK(5),PGR1                                                     
         MVC   WORK+8(24),PGR1NM                                                
         B     GETPGR4                                                          
*                                                                               
GETPGR2  CLC   PGRPSV,0(R6)                                                     
         BE    *+8                                                              
         BAS   RE,GETPGRP                                                       
         CLC   PGRPSV,=X'9999'                                                  
         BE    GETPGR3                                                          
         MVC   WORK(5),PGR2                                                     
         MVC   WORK+8(24),PGR2NM                                                
         B     GETPGR4                                                          
*                                                                               
GETPGR3  MVC   WORK(1),QPGR                                                     
         MVC   WORK+1(3),=C'999'                                                
         MVC   WORK+8(24),BADNAME                                               
*                                                                               
GETPGR4  TM    SPECIND,PL                                                       
         BZ    GETNAMX                                                          
         XC    WORK+8(24),WORK+8                                                
         B     GETNAMX                                                          
*                                                                               
GETPROD  BAS   RE,EXTPROD                                                       
         B     GETNAMX                                                          
*                                                                               
GETESTIM ZIC   R0,0(R6)                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(3),DUB                                                      
         B     GETNAMX                                                          
*                                                                               
GETACT   OC    0(3,R6),0(R6)                                                    
         BZ    GETNAMX                                                          
         GOTO1 DATCON,DMCB,(3,0(R6)),(8,WORK)                                   
         B     GETNAMX                                                          
*                                                                               
GETNAMX  B     EXIT                                                             
*                                                                               
BADNAME  DC    CL24'*** UNKNOWN ***'                                            
         BR    R3                                                               
         EJECT                                                                  
** TABLE OF SPECIAL ROUTINE ADDRESSES FOR PRINTING ROW CODES/NAMES **           
         SPACE 1                                                                
GETTAB   DC    AL1(SPECOFC),AL3(GETOFC)                                         
         DC    AL1(SPECCLT),AL3(GETCLINT)                                       
         DC    AL1(SPECMGR1),AL3(GETMGR1)                                       
         DC    AL1(SPECMGR2),AL3(GETMGR2)                                       
         DC    AL1(SPECMGR3),AL3(GETMGR3)                                       
         DC    AL1(SPECMKT),AL3(GETMKT)                                         
         DC    AL1(SPECSTA),AL3(GETSTA)                                         
         DC    AL1(SPECPER),AL3(GETPER)                                         
         DC    AL1(SPECPGR1),AL3(GETPGR1)                                       
         DC    AL1(SPECPGR2),AL3(GETPGR2)                                       
         DC    AL1(SPECPRD),AL3(GETPROD)                                        
         DC    AL1(SPECEST),AL3(GETESTIM)                                       
         DC    AL1(SPECACT),AL3(GETACT)                                         
         DC    X'FF'                                                            
         EJECT                                                                  
* GET PRODUCT GROUP RECORD                                                      
*                                                                               
GETPGRP  NTR1                                                                   
         MVC   PGRPSV,0(R6)                                                     
         CLC   0(2,R6),=X'9999'                                                 
         BE    EXIT                                                             
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D01'                                                  
         MVC   KEY+2(1),BAGYMD                                                  
         LH    RF,NVDSPCLT                                                      
         LA    RF,REC(RF)                                                       
         MVC   KEY+3(2),0(RF)                                                   
         MVC   KEY+5(1),QPGR                                                    
         MVC   KEY+6(2),0(R6)                                                   
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 GETPRDGR                                                         
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* GET MARKET GROUP RECORD                                                       
*                                                                               
GETMGRP  NTR1                                                                   
         MVC   MGRPSV,0(R6)                                                     
         CLC   0(2,R6),=X'9999'                                                 
         BE    EXIT                                                             
         XC    KEY,KEY                                                          
         MVC   KEY(2),=X'0D02'                                                  
         MVC   KEY+2(7),SVMGRKEY+2  USE KEY SAVED BY INPUT ROUTINES             
         MVC   KEY+9(2),0(R6)                                                   
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 GETMKTGR                                                         
         B     EXIT                                                             
         EJECT                                                                  
FMT      NTR1                                                                   
*                                                                               
*        ROUTINE TO FORMAT THE COLS                                             
*                                                                               
         XC    MATROW,MATROW                                                    
         XC    CLRROW,CLRROW                                                    
         MVI   INVSW,C'Y'                                                       
         MVI   NOPRINT,C'N'                                                     
         LA    R0,NVROWMAX+NVCOLMAX                                             
         LA    R1,RCDTA            POINT TO MY SPECS                            
         LH    R4,CBEXLN                                                        
         LA    R4,1(R4)                                                         
*                                                                               
FM010    CLI   0(R1),X'FF'                                                      
         BE    FM055               FINISHED                                     
         L     R2,0(R1)                                                         
         CLM   R4,1,0(R1)          TEST FOR ROW/COLS BEYOND PRIMARY CB          
         BH    FM050                                                            
         ZIC   R6,0(R1)            POINT R6 TO ROW/COL IN RECORD                
         LA    R6,REC(R6)                                                       
         ZIC   R5,4(R1)            POINT R5 TO PRINT LINE POS                   
         LA    R5,P(R5)                                                         
         CLI   0(R1),NVKEYLEN      TEST FOR ROW                                 
         BNL   FM020                                                            
         BAS   RE,GETNAME          ROW                                          
         ZIC   RE,SPECCLEN                                                      
         BCTR  RE,0                                                             
         EX    RE,FMMOVE                                                        
         B     FM050                                                            
*                                                                               
FM020    LA    RF,COLTAB                                                        
*                                                                               
FM030    CLI   0(RF),X'FF'   SEARCH FOR SPEC DATA CODE IN BRANCH TAB            
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   SPECDATA,0(RF)                                                   
         BE    FM040                                                            
         LA    RF,4(RF)                                                         
         B     FM030                                                            
*                                                                               
FM040    L     RF,0(RF)            FOUND                                        
         BASR  RE,RF               GO FORMAT THE COL                            
         CLI   NOPRINT,C'Y'        TEST FOR ABANDON PRINT                       
         BNE   FM050                                                            
         MVC   P,SPACES                                                         
         B     EXIT                                                             
*                                                                               
FM050    LA    R1,8(R1)            NEXT ROW/COL                                 
         BCT   R0,FM010                                                         
*                                                                               
FM055    CLI   QMED,C'R'           FOR RADIO, MATCHED IS ALWAYS NONE            
         BE    FM057                                                            
         CLC   MATROW,=C'ALL '     CHECK MATCH AND CLEAR ARE ALL                
         BNE   FM060                                                            
*                                                                               
FM057    CLC   CLRROW,=C'ALL '                                                  
         BNE   FM060                                                            
         CLI   QOPT5,C'T'          TRACE, NO TOTAL                              
         BE    FM999                                                            
         CLI   QOPT5,C'B'          BOTH TRACE AND TOTAL                         
         BE    FM999                                                            
         ZIC   R1,DSPCLEAR         CLEAR PRINT LINE TO RIGHT OF                 
         LA    R1,P(R1)             PRIMARY CONTROL BREAK                       
         ZIC   RF,RTMARGIN                                                      
         LA    R0,P(RF)                                                         
         BAS   RE,CLEAR                                                         
         MVI   NOPRINT,C'Y'        AND DON'T PRINT THIS LINE                    
         B     FM999                                                            
*                                                                               
FM060    B     FM260               ONLY READ FOR NEW STYLE INVOICES             
*&&DO                                                                           
FM060    XC    KEY,KEY             READ THE INVOICE RECORD                      
         MVI   KEY,X'0B'           OLD STYLE RECORDS                            
         MVC   KEY+1(1),BAGYMD                                                  
         LH    RE,NVDSPSTA                                                      
         LA    RE,REC(RE)                                                       
         MVC   KEY+2(3),0(RE)                                                   
         LH    RE,NVDSPCLT                                                      
         LA    RE,REC(RE)                                                       
         MVC   KEY+5(2),0(RE)                                                   
         LH    RE,NVDSPPER                                                      
         LA    RE,REC(RE)                                                       
         LA    R1,NVDATES                                                       
*                                                                               
FM070    CLC   4(2,R1),0(RE)       LOOK UP DATE TABLE FOR YR/MN                 
         BE    *+12                                                             
         LA    R1,6(R1)                                                         
         B     FM070                                                            
         MVC   KEY+7(2),0(R1)      BROADCAST MONTH START, COMPRESSED            
*                                                                               
         LA    R0,NVROWMAX+NVCOLMAX                                             
         LA    R4,RCDTA                                                         
*                                                                               
FM080    CLI   0(R4),X'FF'         FIND ACTIVITY DATE ROW                       
         BNE   *+6                                                              
         DC    H'0'                                                             
         L     R2,0(R4)                                                         
         CLI   SPECDATA,SPECACT                                                 
         BE    FM090                                                            
         LA    R4,8(R4)                                                         
         BCT   R0,FM080                                                         
*                                                                               
FM090    ZIC   R5,4(R4)                                                         
         LA    R5,P(R5)            R5 POINT TO ACT DATE PRINT POS               
         XC    SVIDATE,SVIDATE                                                  
         XC    INVDATE,INVDATE                                                  
         GOTO1 HIGH                                                             
         B     FM094                                                            
*                                                                               
FM092    GOTO1 SEQ                 NEXT SEQUENTIAL INVOICE RECORD               
*                                                                               
FM094    CLC   KEY(9),KEYSAVE      TEST INVOICE REC EXISTS                      
         BE    FM100                                                            
*                                                                               
FM095    B     FM260             NO - TRY FOR NEW STYLE INVOICE RECS            
*                                                                               
FM100    MVC   AREC,ADBUY                                                       
         GOTO1 GET                 GET THE INVOICE RECORD                       
         L     R6,AREC                                                          
         MVC   DATADSP,=H'24'                                                   
         MVI   ELCODE,X'B0'        CHECK THE INVOICE CONTROL ELEMENT            
         BAS   RE,GETEL                                                         
         BNE   FM101                                                            
         USING ICTLELEM,R6                                                      
         TM    ICTLCTL,ICTLRES     TEST RESPONSE 'INVOICE'                      
         BO    FM092               YES-IGNORE                                   
*                                                                               
FM101    L     R6,AREC                                                          
         MVI   ELCODE,X'F1'        GET ACTIVITY DATE (INVOICE DATE)             
         BAS   RE,GETEL                                                         
         BNE   FM102                                                            
         USING ACTVD,R6                                                         
         MVC   INVDATE,ACTVADDT    DATE ADDED                                   
         CLI   PROGPROF+1,C'Y'     OPTION TO USE LATEST ACTIVITY DATE           
         BNE   FM102                                                            
         CLC   ACTVCHDT,ACTVADDT   YES-USE DATE LAST CHANGED                    
         BNH   FM102                                                            
         MVC   INVDATE,ACTVCHDT                                                 
         DROP  R6                                                               
*                                                                               
FM102    L     R6,AREC                                                          
         MVI   ELCODE,X'B1'        TRY TO MATCH PRODUCT IN INVOICE ELEM         
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
FM110    BAS   RE,NEXTEL                                                        
         BNE   FM092                                                            
         USING INVELEM,R6                                                       
         CLI   INVPRD,X'FF'        PRODUCT POOL IS OK                           
         BE    FM112                                                            
         CLI   LUMPPOL,C'Y'        SKIP PRODUCT COMPARE IF POL PRODUCTS         
         BE    *+14                LUMPED TOGETHER                              
         CLC   INVPRD,SVPRD1                                                    
         BNE   FM110                                                            
         CLI   SVPRD2,0                                                         
         BNE   *+12                                                             
         TM    INVSTAT,X'40'+X'08'                                              
         BNZ   FM112                                                            
         CLI   LUMPPOL,C'Y'                                                     
         BE    FM120                                                            
         CLC   INVPRD2,SVPRD2                                                   
         BNE   FM110                                                            
         B     FM120                                                            
*                                                                               
FM112    TM    INVSTAT,X'40'                                                    
         BZ    FM120                                                            
         LH    RE,NVDSPEST                                                      
         LA    RE,REC(RE)                                                       
         CLC   INVPRD2,0(RE)                                                    
         BNE   FM110                                                            
*                                                                               
FM120    OC    INVDATE,INVDATE                                                  
         BZ    FM999                                                            
         ZIC   RE,0(R4)                                                         
         LA    RE,REC(RE)                                                       
         CLC   0(3,RE),INVDATE     COMPARE DATES                                
         BNL   FM999               IF ACTIVITY DATE IS LOW, THEN PRINT          
         GOTO1 DATCON,DMCB,(3,INVDATE),(8,0(R5))  INVOICE DATE                  
*&&                                                                             
         EJECT                                                                  
*                                                                               
FM999    DS    0H                                                               
         MVC   DATADSP,=H'24'        RESTORE FOR NORMAL SPOT GETELS             
         B     EXIT                                                             
*                                                                               
FM260    DS    0H                                                               
         MVI   HAVINV,C'N'                                                      
         MVC   DATADSP,=H'42'      FOR EXPANDED SPOT FILE GETELS                
         XC    SVIHDEL,SVIHDEL                                                  
         XC    XKEY,XKEY           READ THE INVOICE RECORD                      
         LA    R6,XKEY                                                          
         USING SNVKEYD,R6                                                       
*                                                                               
         MVI   SNVKTYPE,SNVKTYPQ   NEW STYLE INVOICE RECS                       
         MVI   SNVKSUB,SNVKSUBQ                                                 
         MVC   SNVKAM,BAGYMD                                                    
         LH    RE,NVDSPSTA                                                      
         LA    RE,REC(RE)                                                       
         MVC   SNVKSTA,0(RE)                                                    
*                                                                               
         CLI   COUNTRY,C'C'        TEST CANADA                                  
         BE    *+16                 NFC (NO CABLE)                              
         CLI   SNVKSTA,X'E8'       IF CABLE HEAD    TEST CABLE                  
         BL    *+8                                                              
         NI    SNVKSTA+2,X'80'     LOSE NETWORK                                 
*                                                                               
         LH    RE,NVDSPCLT                                                      
         LA    RE,REC(RE)                                                       
         MVC   SNVKCLT,0(RE)                                                    
         LH    RE,NVDSPPER                                                      
         LA    RE,REC(RE)                                                       
*                                                                               
         MVC   DUB(2),0(RE)        YYMM BINARY                                  
         MVI   DUB+2,1             1ST OF MONTH                                 
         GOTO1 DATCON,DMCB,(3,DUB),(2,DUB+4)                                    
         XC    DUB+4(2),=X'FFFF'   COMPLEMENT                                   
*                                                                               
FM270    MVC   SNVKMOS,DUB+4       BROADCAST MONTH YYMM - RIGHT?                
*                                                                               
         LA    R0,NVROWMAX+NVCOLMAX                                             
         LA    R4,RCDTA                                                         
*                                                                               
FM280    CLI   0(R4),X'FF'         FIND ACTIVITY DATE ROW                       
         BNE   *+6                                                              
         DC    H'0'                                                             
         L     R2,0(R4)                                                         
         CLI   SPECDATA,SPECACT                                                 
         BE    FM290                                                            
         LA    R4,8(R4)                                                         
         BCT   R0,FM280                                                         
*                                                                               
FM290    ZIC   R5,4(R4)                                                         
         LA    R5,P(R5)            R5 POINT TO ACT DATE PRINT POS               
         XC    INVDATE,INVDATE                                                  
         MVC   XKEYSAVE,XKEY                                                    
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'XSPDIR',XKEY,XKEY                     
         B     FM294                                                            
*                                                                               
FM292    DS    0H                  NEXT SEQUENTIAL INVOICE RECORD               
         GOTO1 DATAMGR,DMCB,=C'DMRSEQ',=C'XSPDIR',XKEY,XKEY                     
*                                                                               
FM294    CLC   XKEY(10),XKEYSAVE    TEST INVOICE REC EXISTS                     
         BE    FM300                                                            
*                                                                               
FM295    DS    0H                  END OF INVOICE(S)                            
         CLI   HAVINV,C'Y'         HAVE WE FOUND INVOICE                        
         BE    FM320                                                            
*                                                                               
         MVC   0(8,R5),=C'*NO INV*'   NO - PRINT NO INVOICE                     
         L     RE,ALETREC                                                       
         C     RE,ALETBUFX                                                      
         BL    *+6                                                              
         DC    H'0'                                                             
         MVC   0(NVRECLEN,RE),REC          SAVE THE RECORD FOR LETTER           
         LA    RE,NVRECLEN(RE)              LATER ON                            
         ST    RE,ALETREC                                                       
         MVI   INVSW,C'N'                                                       
         B     FM999                                                            
*                                                                               
FM300    MVC   AREC,AXSPBUFF                                                    
         GOTO1 DATAMGR,DMCB,=C'GETREC',=C'XSPFILE',XKEY+36,AREC,       X        
               (0,DMWORK)                                                       
         TM    DMCB+8,X'80'                                                     
         BNZ   FM292                                                            
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R6,AREC                                                          
         MVI   ELCODE,X'10'        CHECK THE INVOICE HEADER ELEM                
         BAS   RE,GETEL                                                         
         BNE   *+10                                                             
         MVC   SVIHDEL,0(R6)       SAVE IT                                      
         LA    R6,SVIHDEL          TEST SAVED ELEM                              
         USING SNVHDELD,R6                                                      
         TM    SNVHDCTL,SNVHDRSQ   TEST RESPONSE 'INVOICE'                      
         BO    FM292               YES-IGNORE                                   
*                                                                               
*        NOTE- INVDATE TAKEN FROM INVOICE HEADER WILL BE                        
*              USED IF NO ACTIVITY ELEM                                         
*                                                                               
         GOTO1 DATCON,DMCB,(2,SNVHDIDT),(3,SVIDATE)                             
*                                                                               
FM301    DS    0H                                                               
         DROP  R6                                                               
*                                                                               
FM302    DS    0H                                                               
         CLI   HAVINV,C'Y'         IF ALREADY HAVE INV                          
         BE    FM314               TRY FOR ACTIVITY ELEM                        
         L     R6,AREC                                                          
         MVI   ELCODE,X'40'        TRY TO MATCH PRODUCT IN INVOICE ELEM         
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
FM310    BAS   RE,NEXTEL                                                        
         BNE   FM292                                                            
         USING SNVIDELD,R6                                                      
         CLI   SNVIDPRD,X'FF'        PRODUCT POOL IS OK                         
         BE    FM312                                                            
         CLI   LUMPPOL,C'Y'        SKIP PRODUCT COMPARE IF POL PRODUCTS         
         BE    FM312               LUMPED TOGETHER                              
*                                                                               
         MVC   DUB(2),SNVIDPRD     DETAIL PRDS                                  
         OC    DUB(2),DUB                                                       
         BNZ   *+10                                                             
         MVC   DUB(2),SVIHDEL+SNVHDPRD-SNVHDELD   HEADER PRDS                   
*                                                                               
         CLC   DUB(2),SVPRD1                                                    
         BNE   FM310                                                            
*                                                                               
FM312    DS    0H                                                               
*         LH    RE,NVDSPEST                                                     
         XR    RE,RE                                                            
         ICM   RE,3,NVDSPEST                                                    
         BZ    FM313                                                            
         LA    RE,REC(RE)                                                       
         CLC   SNVIDEST,0(RE)                                                   
         BE    FM313                                                            
         CLC   SVIHDEL+SNVHDEST-SNVHDELD(1),0(RE)                               
         BE    FM313                                                            
*                                                                               
         CLI   SNVIDEST,0                                                       
         BNE   FM310                                                            
         CLI   SVIHDEL+SNVHDEST-SNVHDELD,0                                      
         BNE   FM310                                                            
*                                                                               
FM313    DS    0H                                                               
         MVI   HAVINV,C'Y'         SET HAVE FOUND INVOICE                       
*                                                                               
FM314    DS    0H                                                               
         L     R6,AREC                                                          
         CLC   =X'FFFFFF',SNVKMINK-SNVKEY(R6)  TEST LAST OF SET                 
         BNE   FM292                                                            
         OC    INVDATE,INVDATE     UNLESS ALREADY HAVE ACTIVITY DATE            
         BNZ   FM322                                                            
*                                                                               
         L     R6,AREC                                                          
         MVI   ELCODE,X'F1'        GET ACTIVITY DATE (INVOICE DATE)             
         BAS   RE,GETEL                                                         
         BNE   FM316                                                            
         USING ACTVD,R6                                                         
         OC    ACTVADDT,ACTVADDT   IGNORE IF NO DATE                            
         BZ    FM316               (BAD ELEMENT)                                
         MVC   INVDATE,ACTVADDT    DATE ADDED                                   
         CLI   PROGPROF+1,C'Y'     OPTION TO USE LATEST ACTIVITY DATE           
         BNE   FM320                                                            
         CLC   ACTVCHDT,ACTVADDT   YES-USE DATE LAST CHANGED                    
         BNH   FM320                                                            
         MVC   INVDATE,ACTVCHDT                                                 
         DROP  R6                                                               
         B     FM320                                                            
*                                  IF NO ACTIVITY ELEM                          
FM316    DS    0H                                                               
         OC    SVIDATE,SVIDATE     BUT HAVE HEADER ELEM INV DATE                
         BZ    FM292                                                            
         MVC   INVDATE,SVIDATE     USE IT                                       
*                                                                               
FM320    OC    INVDATE,INVDATE                                                  
         BZ    FM999                                                            
FM322    DS    0H                                                               
         ZIC   RE,0(R4)                                                         
         LA    RE,REC(RE)                                                       
         CLC   0(3,RE),INVDATE     COMPARE DATES                                
         BNL   FM999               IF ACTIVITY DATE IS LOW, THEN PRINT          
         GOTO1 DATCON,DMCB,(3,INVDATE),(8,0(R5))  INVOICE DATE                  
*                                                                               
         B     FM999                                                            
         SPACE 2                                                                
FMMOVE   MVC   0(0,R5),WORK        EXECUTED                                     
         SPACE 2                                                                
         GETEL (R6),DATADSP,ELCODE                                              
         SPACE 2                                                                
COLTAB   DC    AL1(SPECSPT),AL3(FMTBIN)    SPOTS                                
         DC    AL1(SPECGRS),AL3(FMTBIN)    GROSS COST                           
         DC    AL1(SPECNET),AL3(FMTBIN)    NET COST                             
         DC    AL1(SPECMAT),AL3(FMTMCL)    MATCH                                
         DC    AL1(SPECCLR),AL3(FMTMCL)    CLEAR                                
         DC    X'FF'                                                            
         EJECT                                                                  
FMTBIN   NTR1                                                                   
*                                                                               
*        ROUTINE TO FORMAT 4 BYTE BINARY FILED                                  
*        R6 = A(INPUT FIELD)                                                    
*        R5 = A(OUTPUT FIELD)                                                   
*        RF BITS 0-7 = COLUMN SPEC CODE                                         
*        SPECTLEN = LENGTH OF OUTPUT FIELD                                      
*                                                                               
*        KEEPING A RUNNING TOTAL OF SPOTS AND GROSS COST FOR REPORT             
*                                                                               
         CLI   SPECDATA,SPECSPT                                                 
         BNE   FB10                                                             
         MVC   SVTOTSPT,RETOTSPT   BACKUP IN CASE NOT PRINTED                   
         L     RE,RETOTSPT                                                      
         A     RE,0(R6)                                                         
         ST    RE,RETOTSPT                                                      
FB10     CLI   SPECDATA,SPECGRS                                                 
         BNE   FB20                                                             
         MVC   SVTOTGRO,RETOTGRO   BACKUP IN CASE NOT PRINTED                   
         L     RE,RETOTGRO                                                      
         A     RE,0(R6)                                                         
         ST    RE,RETOTGRO                                                      
FB20     CLI   SPECDATA,SPECNET                                                 
         BNE   FB30                                                             
         MVC   SVTOTNET,RETOTNET   BACKUP IN CASE NOT PRINTED                   
         L     RE,RETOTNET                                                      
         A     RE,0(R6)                                                         
         ST    RE,RETOTNET                                                      
FB30     XC    EBLOCK,EBLOCK                                                    
         MVI   BYTE,SPECSPT                                                     
         CLM   RF,8,BYTE                                                        
         BE    *+8                                                              
         MVI   EBDECS,2                                                         
         MVI   EBTIN,C'B'                                                       
         MVI   EBLIN,4                                                          
         ST    R6,EBAIN                                                         
         ST    R5,EBAOUT                                                        
         MVC   EBLOUT,SPECTLEN                                                  
         OI    EBOPT,X'20'+X'40'   ZERO=NOBLANK,MINUS=YES                       
         GOTO1 EDITOR,DMCB,EBLOCK                                               
         B     EXIT                                                             
         EJECT                                                                  
FMTMCL   NTR1                                                                   
*                                                                               
*        ROUTINE TO FORMAT MATCH AND CLEAR FILEDS                               
*        R6 POINTS TO INPUT FIELD                                               
*        R5 POINTS TO OUTPUT FIELD                                              
*        SPECTLEN HAS LENGTH OF OUTPUT FIELD                                    
*                                                                               
**       OC    0(4,R6),0(R6)       THESE INSTRUCTIONS REMOVED                   
**       BNZ   *+12                TO LET THE LINE PRINT AS 'NONE'              
**       MVI   NOPRINT,C'Y'                                                     
**       B     MC999                                                            
         MVC   FULL,=C'NONE'                                                    
         OC    0(2,R6),0(R6)                                                    
         BZ    MC010                                                            
         MVC   FULL,=C'ALL '                                                    
         OC    2(2,R6),2(R6)                                                    
         BZ    MC010                                                            
         MVC   FULL,=C'PART'                                                    
*                                                                               
MC010    MVC   0(4,R5),FULL                                                     
         TM    SPECIND,CE                                                       
         BZ    MC020                                                            
         ZIC   R4,SPECTLEN                                                      
         GOTO1 CENTER,DMCB,(R5),(R4)                                            
*                                                                               
MC020    CLI   SPECDATA,SPECMAT    IF FORMATTING MATCH                          
         BNE   MC030                                                            
         MVC   MATROW,FULL         SAVE MATCH ROW                               
         B     MC999                                                            
*                                                                               
MC030    MVC   CLRROW,FULL         ELSE SAVE CLEAR ROW                          
*                                                                               
MC999    B     EXIT                                                             
         EJECT                                                                  
CLEAR    DS    0H                                                               
*                                                                               
*        ROUTINE TO MOVE SPACES FROM R1 TO R0                                   
*                                                                               
         SR    R0,R1               GIVES LENGTH TO CLEAR                        
         BP    *+6                                                              
         DC    H'0'                                                             
         LA    RF,256                                                           
*                                                                               
CLEAR2   CR    R0,RF                                                            
         BNH   CLEAR4                                                           
         MVI   0(R1),C' '                                                       
         MVC   1(255,R1),0(R1)                                                  
         AR    R1,RF                                                            
         SR    R0,RF                                                            
         B     CLEAR2                                                           
CLEAR4   LR    RF,R0                                                            
         BCTR  RF,0                                                             
         EX    RF,CLEARMVC                                                      
         BR    RE                                                               
CLEARMVC MVC   0(0,R1),SPACES      *EXECUTED*                                   
         EJECT                                                                  
*                                                                               
*        HEAD HOOK                                                              
*                                                                               
         DROP  RB,RC                                                            
         DS    0F                                                               
         USING *,RF                                                             
HEADHK   NTR1                                                                   
         LM    R7,RC,HHR7                                                       
         B     HH010                                                            
HHR7     DC    6F'0'                                                            
         DROP  RF                                                               
         USING SPNV02B,RB,RC,R7                                                 
*                                                                               
HH010    CLI   QOPT4,C'Y'          TEST EXCLUDE SPECIAL REP DOLLARS             
         BNE   *+10                                                             
         MVC   H5+36(38),=C'** SPECIAL REP DOLLARS ARE EXCLUDED **'             
         CLI   QOPT4,C'S'          TEST SPECIAL REP DOLLARS ONLY                
         BNE   *+10                                                             
         MVC   H5+40(30),=C'** SPECIAL REP DOLLARS ONLY **'                     
         CLI   NOPRINT,C'Y'        TEST FOR NO DETAIL PRINT                     
         BE    EXIT                                                             
         CLI   SKIPSW,C'Y'         ARE WE JUST SKIPPING A LINE ?                
         BNE   HH020                                                            
         L     R1,APSAVE                                                        
         MVC   P,0(R1)             YES - DON'T BOTHER, MOVE PSAVE               
         MVI   SKIPSW,C'N'          BACK INTO P                                 
*                                                                               
HH020    CLI   USRSW1,C'Y'         TEST FOR 1ST TIME FOR 1ST PRINT              
         BE    EXIT                 LINE ROW                                    
         MVC   P2,P                MOVE PRINT LINE TO SECOND                    
         ZIC   R4,DSPCLEAR         CLEAR PRINT LINE TO RIGHT OF                 
         LA    R1,P(R4)             PRIMARY CONTROL BREAK                       
         ZIC   RF,RTMARGIN                                                      
         LA    R0,P(RF)                                                         
         BAS   RE,CLEAR                                                         
         MVI   USRSW2,C'Y'                                                      
         MVC   CBLEVEL,CBPROW1     POST FIRSTS AGAIN FROM 1ST PRINT             
         BAS   RE,CBFIRST           LINE ROW                                    
         MVI   USRSW2,C'N'                                                      
         ZIC   R1,MARGIN           CLEAR 1ST PART OF SECOND PRINT LINE          
         LA    R1,P2(R1)                                                        
         IC    R4,DSPCOLS                                                       
         LA    R0,P2-1(R4)                                                      
         LR    R4,R1                                                            
         BAS   RE,CLEAR                                                         
         MVC   0(11,R4),=C'(CONTINUED)'   AND CONTINUED COMMENT ON P2           
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
*        MISC ROUTINES                                                          
*                                                                               
         SPACE 2                                                                
* EXTRACT PRODUCT CODES - R6 A(WORD CONTAINING UP TO 2 DISPLACEMENTS            
*                              INTO PROD CODE LIST IN CLT HDR)                  
*                         WORK WILL HAVE PROD CODES, EG AAA-BBB                 
*                                                                               
EXTPROD  LR    R0,RE                                                            
         XC    WORK,WORK                                                        
         L     R1,ADCLT            POINT TO PRODUCT CODE LIST                   
         TM    2(R6),X'F0'         TEST FOR TRAFFIC CLIENT CODE                 
         BZ    EXTPROD4                                                         
         CLC   TCLTCODE,2(R6)      YES-TEST FOR CHANGE                          
         BE    EXTPROD2                                                         
         MVC   TCLTCODE,2(R6)      YES-READ TRAFFIC CLIENT RECORD               
         XC    KEY,KEY                                                          
         MVC   KEY+1(1),BAGYMD                                                  
         MVC   KEY+2(2),TCLTCODE                                                
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   AREC,ATCLTREC                                                    
         GOTO1 GET                                                              
*                                                                               
EXTPROD2 L     R1,ATCLTREC         USE TRAFFIC CLIENT RECORD                    
*                                                                               
EXTPROD4 LA    R1,CLIST-CLTHDRD-1(R1)                                           
         MVI   SVPRD1,0                                                         
         MVI   SVPRD2,0                                                         
         OC    0(2,R6),0(R6)                                                    
         BZ    EXTPRODX                                                         
         LR    RF,R1               FIRST PRODUCT                                
         AH    RF,0(R6)                                                         
         MVC   WORK(3),0(RF)                                                    
         MVC   SVPRD1,3(RF)                                                     
         OC    2(2,R6),2(R6)                                                    
         BZ    EXTPRODX                                                         
         OC    TCLTCODE,TCLTCODE   TEST SPECIAL TRAFFIC CLIENT                  
         BNZ   EXTPRODX                                                         
         LR    RF,R1               NO-THEN IT'S A SECOND PRODUCT                
         AH    RF,2(R6)                                                         
         MVI   WORK+3,C'-'                                                      
         MVC   WORK+4(3),0(RF)                                                  
         MVC   SVPRD2,3(RF)                                                     
*                                                                               
EXTPRODX LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 2                                                                
* STATION UNPACK ROUTINE - R6 A(STATION CODE)                                   
*                          WORK WILL HAVE FORMATTED STATION, EG WABC-T          
*                                                                               
STAUNPK  ST    RE,WORD               R6 = A(STATION CODE)                       
         MVC   DUB+2(3),0(R6)                                                   
         GOTO1 MSUNPK,DMCB,(X'80',DUB),FULL,WORK                                
         L     RE,WORD                                                          
STAUNPK2 CLI   WORK,C'0'           TEST CABLE                                   
         BL    *+10                                                             
         MVI   WORK+4,C'/'         YES                                          
         BR    RE                                                               
         MVC   WORK+5(1),WORK+4                                                 
         MVI   WORK+4,C'-'                                                      
         CLI   WORK+5,C' '                                                      
         BNER  RE                                                               
         MVI   WORK+5,C'T'                                                      
         BR    RE                                                               
         EJECT                                                                  
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
         DS    0D                                                               
         DC    C'***REC**'                                                      
REC      DS    XL(NVRECLEN)                                                     
         DC    C'*NEWREC*'                                                      
NEWREC   DS    XL(NVRECLEN)                                                     
*                                                                               
         DC    CL8'*NVWORK*'                                                    
NVWORK   DCB   DDNAME=NVWORK,DSORG=PS,EODAD=*,LRECL=NVRECLEN,          X        
               BLKSIZE=16*NVRECLEN,MACRF=(GM,PM),RECFM=FB                       
*                                                                               
NVLET    DCB   DDNAME=NVLET,DSORG=PS,EODAD=NV102,LRECL=80,             X        
               BLKSIZE=80,MACRF=(GM,PM),RECFM=F                                 
*                                                                               
RCDTA    DS    CL(8*(NVROWMAX+NVCOLMAX))                                        
*                                                                               
ACOMAM   DC    A(AMCOMIO)                                                       
ACOMCLT  DC    A(CLCOMIO)                                                       
AXSPBUFF DC    A(XSPBUFF)                                                       
ATABLE   DC    A(TABLE)                                                         
ALETTER  DC    A(LETTER)                                                        
APSAVE   DC    A(PSAVE)                                                         
ATCLTREC DC    A(TCLTREC)                                                       
EDITOR   DC    V(EDITOR)                                                        
COVAIL   DC    V(COVAIL)                                                        
ALETBUF  DS    A              ADDR OF LETTER BUFFER                             
ALETBUFX DS    A              ADDR OF END OF LETTER BUFFER                      
ALETREC  DS    A              ADDR OF NEXT AVAILABLE LETTER RECORD AREA         
ALETLINE DS    A              ADDR OF CURRENT LETTER LINE                       
LLETBUF  DS    F              L'LETTER BUFFER                                   
CBEXLN   DS    H                                                                
LASTREC  DS    C                                                                
NOPRINT  DS    C                                                                
INVSW    DS    C                                                                
SKIPSW   DS    C                                                                
STADSW   DS    C                                                                
COMSW    DS    C                                                                
AMLET    DS    C                                                                
CLTLET   DS    C                                                                
COM      EQU   C'C'                                                             
NVL      EQU   C'N'                                                             
LUMPPOL  DS    C                                                                
ELCODE   DS    X                                                                
DATADSP  DS    H                                                                
FAXSW    DS    X                                                                
FAXON    EQU   X'80'                                                            
FAXCLTOK EQU   X'40'                                                            
FAXSTAOK EQU   X'20'                                                            
FAXNEWST EQU   X'10'                                                            
FAXFIRST EQU   X'08'                                                            
FAXOK    EQU   FAXON+FAXCLTOK+FAXSTAOK                                          
MAXTTL   DS    X                                                                
MAXCOD   DS    X                                                                
MARGIN   DS    X                                                                
RTMARGIN DS    X                                                                
CBLEVEL  DS    X                                                                
CBNUM    DS    X                                                                
CBSKIP   DS    X                                                                
CBPROW1  DS    X                                                                
DSPCLEAR DS    X                                                                
DSPCOLS  DS    X                                                                
SVPRD1   DS    X                                                                
SVPRD2   DS    X                                                                
INVDATE  DS    XL3                                                              
OFID     DS    CL3                                                              
MATROW   DS    CL4                                                              
CLRROW   DS    CL4                                                              
ACTDATE  DS    XL3                                                              
CLTSAVE  DS    XL2                                                              
CLTOVER  DS    XL2                                                              
CLTOFFC  DS    CL1                                                              
STASAVE  DS    CL8                                                              
STASAVEP DS    XL3                                                              
MGRPSV   DS    XL2                                                              
PGRPSV   DS    XL2                                                              
FAXNUM   DS    CL25                                                             
AMADDR   DS    CL65                                                             
AMSIGNAT DS    CL65                                                             
AMDEPART DS    CL65                                                             
CLADDR   DS    CL65                                                             
CLSIGNAT DS    CL65                                                             
CLDEPART DS    CL65                                                             
TCLTCODE DC    XL2'0000'                                                        
XFF      DC    100X'FF'                                                         
NULLS    DC    5X'00'                                                           
ASTERS   DC    20C'*'                                                           
FAXNDMSG DC    CL26'*** END OF DDS MESSAGE ***'                                 
*                                                                               
SVIHDEL  DS    XL(SNVHDLNQ)                                                     
XKEY     DS    XL64                                                             
XKEYSAVE DS    XL64                                                             
HAVINV   DS    CL1                 Y=HAVE FOUND INVOICE                         
SVIDATE  DS    XL3                                                              
RETOTSPT DS    F                   REPORT TOTAL SPOTS                           
RETOTGRO DS    F                   REPORT TOTAL GROSS COST                      
RETOTNET DS    F                   REPORT TOTAL NET CORST                       
SVTOTSPT DS    F                   REPORT TOTAL SPOTS (BACKUP)                  
SVTOTGRO DS    F                   REPORT TOTAL GROSS COST  (BACKUP)            
SVTOTNET DS    F                   REPORT TOTAL NET CORST   (BACKUP)            
         EJECT                                                                  
       ++INCLUDE DDEBLOCK                                                       
         EJECT                                                                  
PSAVE    DS    CL132                                                            
*                                                                               
BXROW    DC    7X'00',C'T',X'00',C'M',48X'00'                                   
         DC    C'B'                59                                           
BXCOL    DS    XL132                                                            
*                                                                               
TABLE    DC    XL80'00'                                                         
         DC    C'&&'                                                            
         DC    XL175'00'                                                        
*                                                                               
SVH1     DS    CL132                                                            
SVH2     DS    CL132                                                            
SVH3     DS    CL132                                                            
*                                                                               
LETTER   DS    (MAXLLINE*80)C HOLDING AREA FOR STANDARD LETTER                  
MAXLLINE EQU   50                                                               
*                                                                               
AMCOMIO  DS    2000X          I/O AREA FOR AGENCY/MEDIA COMMENT RECORD          
CLCOMIO  DS    2000X          I/O AREA FOR AGY/MED/CLIENT COMMENT REC           
XSPBUFF  DS    4000X          I/O AREA FOR SNV RECS ON XSPTFILE                 
TCLTREC  DS    XL(CLTHDRL)    I/O AREA FOR SPECIAL TRAFFIC CLIENT REC           
         EJECT                                                                  
*                                                                               
* ROUTINE TO GET FAX RECORD FOR A STATION                                       
*                                                                               
GETFAX   NTR1  BASE=*,LABEL=*                                                   
         XC    FAXNUM,FAXNUM                                                    
         NI    FAXSW,255-FAXSTAOK                                               
         L     R4,ADBUY                                                         
         USING CTFXKEY,R4                                                       
         XC    CTFXKEY,CTFXKEY                                                  
         MVI   CTFXKTYP,CTFXEQU                                                 
         MVC   CTFXAGY,AGENCY                                                   
         MVC   CTFXCODE(2),=C'NV'  STATION PRECEDED BY NV                       
         MVC   DUB+2(3),STASAVEP                                                
         GOTO1 MSUNPK,DMCB,(X'80',DUB),FULL,WORK                                
         MVC   CTFXCODE+2(5),WORK                                               
         CLI   WORK+3,C' '                                                      
         BH    *+16                                                             
         CLI   WORK+4,C' '                                                      
         BNH   *+8                                                              
         MVI   CTFXCODE+5,C'-'                                                  
         BAS   RE,STAUNPK2         GET FORMATTED STATION                        
         MVC   STASAVE,WORK                                                     
         GOTO1 DATAMGR,DMCB,=C'DMREAD  ',=C'CTFILE ',(R4),(R4)                  
         CLI   8(R1),0                                                          
         BNE   GETFAX6             RECORD NOT FOUND                             
         LA    R6,CTFXEL1                                                       
         SR    R0,R0               LOOK FOR FAX NUMBER                          
*                                                                               
GETFAX4  CLI   0(R6),0                                                          
         BE    GETFAX6                                                          
         CLI   0(R6),CTFX1ELQ                                                   
         BE    *+14                                                             
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     GETFAX4                                                          
         USING CTFX1EL,R6                                                       
         ZIC   R1,CTFX1LEN         FAX NUMBER                                   
         SH    R1,=Y(CTFX1NUM-CTFX1EL)                                          
         CH    R1,=Y(L'FAXNUM)                                                  
         BNH   *+8                                                              
         LA    R1,L'FAXNUM                                                      
         MVC   FAXNUM,SPACES                                                    
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   FAXNUM,CTFX1NUM                                                  
         OI    FAXSW,FAXSTAOK      STATION OK FOR FAXING                        
         B     GETFAXX                                                          
*                                                                               
GETFAX6  OI    FAXSW,FAXSTAOK      NO FAX NUMBER - STATION WILL BE              
*                                  FAXED VIA EASYLINK STATION LIST              
GETFAXX  XIT1                                                                   
         DROP  R6                                                               
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
PRNTOT   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    HEADHOOK,HEADHOOK   CLEAR HEADHOOK                               
         MVI   FORCEHED,C'P'       PRINT TOTAL AT NEW PAGE                      
         MVC   P,SPACES            CLEAR LEFTOVER                               
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         MVC   P+10(40),=40C'*'                                                 
         GOTO1 REPORT                                                           
         MVI   P+10,C'*'                                                        
         MVC   P+26(5),=C'TOTAL'                                                
         MVI   P+49,C'*'                                                        
         GOTO1 REPORT                                                           
         MVC   P+10(40),=40C'*'                                                 
         GOTO1 REPORT                                                           
*                                                                               
         MVI   P+10,C'*'                                                        
         MVC   P+13(11),=C'SPOTS     :'                                         
         MVI   P+49,C'*'                                                        
         L     RE,RETOTSPT                                                      
         EDIT  (RE),(12,P+30),ALIGN=LEFT                                        
         GOTO1 REPORT                                                           
*                                                                               
         CLI   QOPT1,C'N'                                                       
         BE    PRNT05                                                           
         MVI   P+10,C'*'                                                        
         MVC   P+13(11),=C'GROSS COST:'                                         
         MVI   P+49,C'*'                                                        
         L     RE,RETOTGRO                                                      
         EDIT  (RE),(12,P+30),2,COMMAS=YES,ALIGN=LEFT,FLOAT=$                   
         GOTO1 REPORT                                                           
*                                                                               
PRNT05   CLI   QOPT1,C'G'                                                       
         BE    PRNT10                                                           
         MVI   P+10,C'*'                                                        
         MVC   P+13(11),=C'NET   COST:'                                         
         MVI   P+49,C'*'                                                        
         L     RE,RETOTNET                                                      
         EDIT  (RE),(12,P+30),2,COMMAS=YES,ALIGN=LEFT,FLOAT=$                   
         GOTO1 REPORT                                                           
*                                                                               
PRNT10   MVC   P+10(40),=40C'*'                                                 
         GOTO1 REPORT                                                           
*                                                                               
PRNTOTX  XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
       ++INCLUDE SPREPNVWRK                                                     
         EJECT                                                                  
       ++INCLUDE SPGENNVL                                                       
         EJECT                                                                  
INVRECD  DSECT                                                                  
       ++INCLUDE SPGENINV                                                       
*                                                                               
       ++INCLUDE SPGENSNV                                                       
*                                                                               
*        PRINT OFF                                                              
       ++INCLUDE SPREPWORKD                                                     
       ++INCLUDE DDBIGBOX                                                       
       ++INCLUDE DDACTIVD                                                       
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE DDTSARD                                                        
CLTHDRD  DSECT                                                                  
       ++INCLUDE SPGENCLT                                                       
PRDHDRD  DSECT                                                                  
       ++INCLUDE SPGENPRD                                                       
STARECD  DSECT                                                                  
       ++INCLUDE SPGENSTA                                                       
MKTRECD  DSECT                                                                  
       ++INCLUDE SPGENMKT                                                       
ADDRRECD DSECT                                                                  
       ++INCLUDE SPGENADD                                                       
COMHDRD  DSECT                                                                  
       ++INCLUDE SPGENCOM                                                       
SPEDICTD DSECT                                                                  
       ++INCLUDE SPEDICT                                                        
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'098SPREPNV02B05/03/10'                                      
         END                                                                    

*          DATA SET CTCONCRETX AT LEVEL 004 AS OF 05/01/02                      
*CATALP CONCRETE                                                                
         TITLE 'CONTROL SYSTEM DUMP AND LOAD PROGRAM'                           
         PRINT NOGEN                                                            
CONCRETE CSECT                                                                  
         ENTRY UTL                                                              
         NBASE 0,CONCRETE,RA,R9,WORK=V(REGSAVE)                                 
         L     R6,AWORK                                                         
         USING CONWORKD,R6         R6=A(GLOBAL W/S)                             
*                                                                               
CON0     ST    R1,ACOMRG           SAVE MVS SUPV INFO                           
         L     R1,0(R1)                                                         
         LH    R2,0(R1)                                                         
         LTR   R2,R2               R2=L'PARM DATA                               
         BZ    CON0C                                                            
         CH    R2,=H'8'                                                         
         BNH   *+8                                                              
         LA    R2,8                                                             
         LA    R1,2(R1)            R1=A(PARM DATA)                              
         LA    RF,UPSITAB                                                       
CON0A    CLI   0(R1),C'0'                                                       
         BE    CON0B                                                            
         CLI   0(R1),C'1'                                                       
         BNE   CON0C                                                            
         OC    UPSIVAL,0(RF)                                                    
CON0B    LA    R1,1(R1)                                                         
         LA    RF,1(RF)                                                         
         BCT   R2,CON0A                                                         
CON0C    XC    APHASE,APHASE       CLEAR EXTERNAL LOAD POINT ADDR               
         B     CON0X                                                            
UPSITAB  DC    X'8040201008040201'                                              
CON0X    EQU   *                                                                
*                                                                               
         GOTO1 VDATCON,DMCB,(5,DUB),(10,DATEVAL)                                
         DATE  DUB,DATE=NO                                                      
         MVC   CTRYVAL(2),DUB+6                                                 
         EJECT                                                                  
*              READ AND VALIDATE CONTROL CARDS                                  
*                                                                               
CON1     L     R8,VCPRINT          R8=A(PRINTER CSECT)                          
         USING DPRINT,R8                                                        
         MVC   TITLE+16(27),=C'LIST OF INPUT CONTROL CARDS'                     
*                                                                               
CON2     GOTO1 VCARDS,DMCB,CDAREA,=C'RE00'                                      
         CLC   CDAREA(2),=C'/*'                                                 
         BE    CONVAL                                                           
*                                                                               
CON3     LA    R2,PARMTAB          SEARCH PARMTAB FOR PARAMETER                 
         SR    R3,R3                                                            
*                                                                               
CON4     CLI   0(R2),X'FF'                                                      
         BE    CONERR                                                           
         IC    R3,0(R2)                                                         
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         B     *+10                                                             
         CLC   1(0,R2),CDAREA                                                   
         BE    *+12                                                             
         LA    R2,L'PARMTAB(R2)                                                 
         B     CON4                                                             
         MVC   FULL+1(3),11(R2)                                                 
         L     R2,FULL                                                          
         LA    R3,CDAREA+2(R3)                                                  
         BR    R2                                                               
*                                                                               
CONIN    CLI   SWIN,0              INPUT=XXXX                                   
         BNE   CONERR                                                           
         CLC   0(4,R3),=C'DISK'                                                 
         BNE   *+12                                                             
         OI    SWIN,X'80'          SET INPUT=DISK                               
         B     CONPRT                                                           
         CLC   0(4,R3),=C'TAPE'                                                 
         BNE   CONERR                                                           
         OI    SWIN,X'40'          SET INPUT/OUTPUT=TAPE                        
         B     CONPRT                                                           
*                                                                               
CONOUT   CLI   SWOUT,0             OUTPUT=XXXX(,NNN)                            
         BNE   CONERR                                                           
         CLC   0(4,R3),=C'DISK'                                                 
         BNE   *+12                                                             
         OI    SWOUT,X'80'         SET OUTPUT=DISK                              
         B     CONPRT                                                           
         CLC   0(4,R3),=C'TAPE'                                                 
         BNE   CONERR                                                           
         OI    SWOUT,X'40'         SET INPUT/OUTPUT=TAPE                        
         B     CONPRT                                                           
*                                                                               
CONMODE  CLI   SWMODE,0            MODE=XXXXXX                                  
         BNE   CONERR                                                           
         CLC   0(4,R3),=C'COPY'                                                 
         BNE   *+12                                                             
         OI    SWMODE,X'80'                                                     
         B     CONPRT                                                           
         CLC   0(6,R3),=C'REPORT'                                               
         BNE   CONERR                                                           
         OI    SWMODE,X'40'                                                     
         B     CONPRT                                                           
*                                                                               
CONLOAD  CLI   SWLOAD,0            LOAD=XXXXXXXX                                
         BNE   CONERR                                                           
         OI    SWLOAD,X'80'        SET LOAD=YES                                 
         MVC   PHASE,0(R3)                                                      
         L     RF,APHASE                                                        
         GOTO1 =V(LOADER),DMCB,PHASE,(RF)                                       
         L     RF,4(R1)                                                         
         LTR   RF,RF                                                            
         BZ    CONERR                                                           
         ST    RF,APHASE           SAVE A(LOADED PHASE)                         
         B     CONPRT                                                           
*                                                                               
CONFILE  L     R4,ACTFILE          FILE=XXXXXXX                                 
         MVC   22(7,R4),0(R3)      PATCH FILE NAME                              
         B     CONPRT                                                           
*                                                                               
CONDDS   L     R4,=V(DDSIO)        DDSIO=XXXXXX                                 
         LTR   R4,R4                                                            
         BZ    CONERR                                                           
         MVC   0(8,R4),0(R3)       PATCH DDSIO LOAD MODULE NAME                 
         B     CONPRT                                                           
*                                                                               
CONSTRT  OI    SWSTRT,X'80'        START=XXXXXXXX                               
         LA    R4,KEYSTRT                                                       
         B     CONKEYS                                                          
*                                                                               
CONEND   OI    SWEND,X'80'         END=XXXXXXXX                                 
         LA    R4,KEYEND                                                        
*                                                                               
CONKEYS  GOTO1 VDECODE,DMCB,(25,(R3)),(0,(R4))                                  
         CLI   8(R1),0                                                          
         BNE   CONERR                                                           
         B     CONPRT                                                           
*                                                                               
CONLIB   LA    R4,SWLIB            LIBREORG=XXXXXX                              
         CLC   0(5,R3),=C'PRINT'                                                
         BNE   CONALL                                                           
         OI    SWLIB,X'88'         SET LIBREORG=YES/PRINT                       
         B     CONPRT                                                           
*                                                                               
CONORID  LA    R4,SWOVER           OVERRIDE=XXX                                 
         B     CONALL                                                           
*                                                                               
CONGEN   LA    R4,SWGEN            GENUP=XXX                                    
         B     CONALL                                                           
*                                                                               
CONDIR   LA    R4,SWDIR            DIRECTORY=XXX                                
         B     CONALL                                                           
*                                                                               
CONREP   LA    R4,SWREP            REPORT=XXX                                   
         B     CONALL                                                           
*                                                                               
CONDET   LA    R4,SWDEL            DELETE=XXX                                   
         B     CONALL                                                           
*                                                                               
CONCNT   LA    R4,SWCNT            COUNT=XXX                                    
         B     CONALL                                                           
*                                                                               
CONREC   LA    R4,SWREC            RECCHECK=XXX                                 
         B     CONALL                                                           
*                                                                               
CONDIT   LA    R4,SWDIT            DITTO=XXX                                    
         B     CONALL                                                           
*                                                                               
CONMSG   LA    R4,SWMSG            MSG=XXX                                      
         B     CONALL                                                           
*                                                                               
CONALL   TM    0(R4),X'01'         XXXXXXXX=YES/NO                              
         BO    CONERR                                                           
         OI    0(R4),X'01'         SET PARAM INPUT FLAG                         
         CLC   0(2,R3),=C'NO'                                                   
         BNE   *+12                                                             
         NI    0(R4),X'7F'                                                      
         B     CONPRT                                                           
         CLC   0(3,R3),=C'YES'                                                  
         BNE   CONERR                                                           
         OI    0(R4),X'80'                                                      
         B     CONPRT                                                           
*                                                                               
CONPRT   MVC   P(80),CDAREA                                                     
         GOTO1 VPRINTER                                                         
         B     CON2                                                             
         EJECT                                                                  
*              HANDLE CONTROL CARD ERRORS                                       
*                                                                               
CONERR   MVC   P(80),CDAREA                                                     
         MVC   P+80(20),=C'INVALID CONTROL CARD'                                
         GOTO1 VPRINTER                                                         
         GOTO1 VLOGIO,DMCB,1,(20,CDAREA)                                        
         GOTO1 (RF),(R1),1,=C'INVALID CONTROL CARD'                             
         GOTO1 (RF),(R1),1,=C'PLEASE CORRECT,IGNORE OR CANCEL'                  
         MVC   CDAREA,SPACES                                                    
         GOTO1 (RF),(R1),0,(20,CDAREA)                                          
         CLC   CDAREA(6),=C'IGNORE'                                             
         BE    CON2                                                             
         CLC   CDAREA(6),=C'CANCEL'                                             
         BNE   CON3                                                             
         MVI   DUB,0                                                            
         B     CONVERR             INVALID CONTROL CARD                         
         EJECT                                                                  
*              SEE IF PARAMETERS ARE LOGICALLY VALID                            
*                                                                               
CONVAL   MVI   DUB,1                                                            
         CLI   SWIN,0              INPUT MUST BE SPEC                           
         BE    CONVERR                                                          
         TM    SWMODE,X'80'                                                     
         BZ    *+16                                                             
         MVI   DUB,2                                                            
         CLI   SWOUT,0             OUTPUT MUST BE SPEC IF MODE=COPY             
         BE    CONVERR                                                          
         TM    SWMODE,X'40'                                                     
         BZ    *+16                                                             
         MVI   DUB,3                                                            
         CLI   SWOUT,0             OUTPUT MUST NOT BE SPEC IF MODE=REP          
         BNE   CONVERR                                                          
         MVI   DUB,4                                                            
         CLI   SWMODE,0            MODE MUST BE SPEC                            
         BE    CONVERR                                                          
         MVI   DUB,5                                                            
         TM    SWIN,X'80'                                                       
         BZ    *+12                                                             
         TM    SWOUT,X'80'         DISK CAN NOT BE INPUT & OUTPUT SPEC          
         BO    CONVERR                                                          
         TM    SWSTRT,X'80'                                                     
         BZ    CONSET                                                           
         TM    SWIN,X'80'          START ONLY VALID IF INPUT=DISK               
         BO    CONSET                                                           
         MVI   DUB,6                                                            
*                                                                               
CONVERR  SR    R1,R1               OUTPUT ERROR MESSAGE                         
         IC    R1,DUB                                                           
         MH    R1,=H'40'                                                        
         LA    R1,ERRTAB(R1)                                                    
         MVC   P(40),0(R1)                                                      
         GOTO1 VPRINTER                                                         
         B     EOJ                                                              
         EJECT                                                                  
*              BUILD CODE HOOK LIST FROM REQUESTED OPTIONS                      
*                                                                               
CONSET   LA    RE,SWTTAB                                                        
         MVI   DUB,0                                                            
CONSET0  CLI   0(RE),X'FF'                                                      
         BE    CONSETX                                                          
         CLI   0(RE),0                                                          
         BE    CONSET8                                                          
         MVC   DUB+1(3),1(RE)      X'80' HOOK                                   
         TM    0(RE),X'80'                                                      
         BO    *+10                                                             
         MVC   DUB+1(3),4(RE)      X'40' HOOK                                   
         OC    DUB(4),DUB                                                       
         BZ    CONSET8             HOOK NOT REQUIRED                            
         L     R1,DUB              A(HOOK TABLE ENTRY)                          
         LM    R2,R4,NEXTHOOK                                                   
         SR    R5,R5                                                            
         LA    R7,4(R1)                                                         
         IC    R5,0(R1)            L'FIRST TIME HOOKS                           
         LTR   R5,R5                                                            
         BZ    CONSET2                                                          
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R7)       SET FIRST                                    
         LA    R2,0(R5,R2)                                                      
         LA    R7,0(R5,R7)                                                      
*                                                                               
CONSET2  IC    R5,1(R1)            L'PROCESS HOOKS                              
         LTR   R5,R5                                                            
         BZ    CONSET4                                                          
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),0(R7)       SET PROCESS                                  
         LA    R3,0(R5,R3)                                                      
         LA    R7,0(R5,R7)                                                      
*                                                                               
CONSET4  IC    R5,2(R1)            L'LAST TIME HOOKS                            
         LTR   R5,R5                                                            
         BZ    CONSET6                                                          
         EX    R5,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R7)       SET LAST                                     
         LA    R4,0(R5,R4)                                                      
         LA    R7,0(R5,R7)                                                      
CONSET6  STM   R2,R4,NEXTHOOK                                                   
*                                                                               
CONSET8  LA    RE,L'SWTTAB(RE)     BUMP TO NEXT ENTRY                           
         B     CONSET0                                                          
CONSETX  MVC   INPDEV,SWIN         SET I/O DEVICES IN WORK                      
         MVC   OUTDEV,SWOUT                                                     
         B     FIRST                                                            
         EJECT                                                                  
* ROUTINES TO HANDLE READING OF TAPES                                           
*                                                                               
TINFRST  ST    R7,SAVER7           FIRST TIME                                   
         BAS   R1,OPNTINT                                                       
         BAS   R7,TINPROC                                                       
         L     R7,SAVER7                                                        
         BR    R7                                                               
*                                                                               
TINPROC  L     R1,ATINT            PROCESS                                      
         L     R0,AIOAREA                                                       
         GET   (1),(0)                                                          
         MVI   WRITE,0                                                          
         AP    PHINCNT,=P'1'                                                    
         BR    R7                                                               
*                                                                               
TINLAST  BAS   R1,CLSTINT          LAST TIME                                    
*                                                                               
TINLAST2 TM    SWMSG,X'80'         IF MSG=NO INPUT THEN ANSWER IS NO            
         BO    TINLAST3                                                         
         MVI   MSGAREA,C'N'                                                     
         B     TINLAST4                                                         
TINLAST3 GOTO1 VLOGIO,DMCB,1,=C'ANY MORE CON INPUT TAPES'                       
         GOTO1 (RF),(R1),0,(3,MSGAREA)                                          
TINLAST4 CLI   MSGAREA,C'N'                                                     
         BER   R7                                                               
         CLI   MSGAREA,C'Y'                                                     
         BE    TINLAST5                                                         
         GOTO1 (RF),(R1),1,=C'INVALID REPLY'                                    
         B     TINLAST3                                                         
*                                                                               
TINLAST5 BAS   R1,OPNTINT                                                       
         B     PROCESS                                                          
         EJECT                                                                  
* ROUTINES TO HANDLE READING OF DISK                                            
*                                                                               
DINFRST  ST    R7,SAVER7           FIRST TIME                                   
         GOTO1 VISDDS,IOPARM1                                                   
         MVC   IOPARM1,VISREAD                                                  
         BAS   R7,DINPROC                                                       
         MVC   IOPARM1,VISRDSEQ                                                 
         L     R7,SAVER7                                                        
         BR    R7                                                               
*                                                                               
DINPROC  LA    R1,IOPARM1          PROCESS                                      
         L     RF,VISDDS                                                        
         BASR  RE,RF                                                            
         MVI   WRITE,0                                                          
         L     R1,AIOAREA                                                       
         LA    R2,4(R1)                                                         
         USING CTCREC,R2                                                        
         MVC   HALF,CTCLEN                                                      
         LH    R2,HALF                                                          
         LA    R2,4(R2)                                                         
         XC    0(4,R1),0(R1)                                                    
         STH   R2,0(R1)                                                         
         OC    IOPARM3(2),IOPARM3                                               
         BNZ   DINPROC2                                                         
         AP    PHINCNT,=P'1'                                                    
         TM    SWEND,X'80'                                                      
         BZR   R7                                                               
         CLC   4(25,R1),KEYEND                                                  
         BH    *+6                                                              
         BR    R7                                                               
         SP    PHINCNT,=P'1'                                                    
         B     LAST                                                             
*                                                                               
DINPROC2 TM    IOPARM3+1,X'04'     EOF                                          
         BO    LAST                                                             
         MVI   DIE,C'N'                                                         
         MVC   MSGAREA,=CL40'UNRECOVERABLE DISK ERROR KEY -'                    
         B     BADREC                                                           
         EJECT                                                                  
* ROUTINES TO CHECK GENERATION RECORD. THIS CODE IS ALWAYS EXECUTED             
* AFTER INITIAL READ FROM FILE.                                                 
*                                                                               
GENCHCK  CLI   PROCREC,HEADER      IS RECORD TYPE=GENERATION                    
         BE    GENCHCK2                                                         
         MVI   DUB,7                                                            
         MVC   MSGAREA,=CL40'GENERATION RECORD MISSING KEY -'                   
         TM    SWGEN,X'80'         GENUP OPTION REQUESTED                       
         BO    GENCHCK4                                                         
         TM    SWOUT,X'80'         OUTPUT=DISK REQUIRES GENERATION REC          
         BO    GENCHCK4                                                         
         TM    SWSTRT,X'80'        IF START=KEY REQUESTED IGNORE                
         BOR   R7                                                               
         TM    SWIN,X'80'          INPUT=DISK REQUIRES GENERATION REC           
         BO    GENCHCK4                                                         
         BR    R7                  OTHERWISE OK                                 
*                                                                               
GENCHCK2 L     R2,AIOAREA          GET GENERATION ELEMENT                       
         LA    R2,4(R2)                                                         
         USING CTCREC,R2                                                        
         LA    R2,CTCDATA                                                       
         USING CTACTEL,R2                                                       
         MVI   FULL,0                                                           
         MVC   FULL+1(3),CTACTDT                                                
         MVC   GENNIN,FULL+1                                                    
         MVC   GENOUT,FULL+1                                                    
         TM    SWGEN,X'80'                                                      
         BZR   R7                                                               
         L     R1,FULL                                                          
         LA    R1,1(R1)                                                         
         ST    R1,FULL                                                          
         MVC   CTACTDT(3),FULL+1                                                
         MVC   GENOUT,FULL+1                                                    
         LA    R2,5(R2)                                                         
         L     R1,ACTFILE                                                       
         MVC   2(7,R2),22(R1)                                                   
         MVI   9(R2),C'-'                                                       
         LA    R1,DATEVAL                                                       
         MVC   10(2,R2),0(R1)                                                   
         MVC   12(2,R2),3(R1)                                                   
         MVC   14(2,R2),6(R1)                                                   
         BR    R7                                                               
*                                                                               
GENCHCK4 GOTO1 VLOGIO,DMCB,1,=C'**CONCRETE** GENERATION RECORD MISSING'         
         B     BADREC                                                           
         DROP  R2                                                               
         EJECT                                                                  
* ROUTINES TO CHECK PHYSICAL CONSISTENCY OF RECORDS.                            
*                                                                               
RECPROC  ST    R7,SAVER7           PROCESS                                      
         L     R2,AIOAREA                                                       
         LA    R2,4(R2)            R2=A(RECORD)                                 
         USING CTCREC,R2                                                        
         LA    R3,CTCDATA          R3=A(FIRST ELEMENT)                          
         MVC   HALF,CTCLEN                                                      
         LH    R5,HALF             R5=L'RECORD                                  
         LA    R4,0(R5,R2)                                                      
         BCTR  R4,0                R4=A(END OF RECORD)                          
         SR    R1,R1                                                            
         MVI   DIE,C'N'                                                         
         MVC   MSGAREA,=CL40'RECORD LENGTH LE MINIMUM KEY -'                    
         CH    R5,RECMIN                                                        
         BL    BADREC                                                           
         MVC   MSGAREA,=CL40'RECORD LENGTH GR MAXIMUM KEY -'                    
         CH    R5,RECMAX                                                        
         BNH   RECPROC1                                                         
*                                                                               
         CLI   0(R2),C'7'          SCRIPTS ALLOWED TO BE BIGGER                 
         BE    RECPROC1                                                         
*                                                                               
         CLI   0(R2),C'A'          LOW KEYS HAVE DIFFERENT MAX                  
         BNL   BADREC                                                           
         CH    R5,RECMAX1                                                       
         BH    BADREC                                                           
RECPROC1 XC    1(24,R4),1(R4)                                                   
*                                                                               
RECPROC2 CLI   0(R3),0             ELEMENT CODE=ZERO                            
         BE    RECPROC4                                                         
         CLI   1(R3),0             ELEMENT LENGTH=ZERO                          
         BE    RECPROC6                                                         
         IC    R1,1(R3)            BUMP TO NEXT ELEMENT                         
         AR    R3,R1                                                            
         CR    R3,R4               OUT OF SCOPE OF RECORD                       
         BH    RECPROC8                                                         
         BNE   RECPROC2                                                         
         MVI   0(R3),0             SET END OF RECORD                            
         B     RECPROCX                                                         
*                                                                               
RECPROC4 LA    R4,1(R4)                                                         
         SR    R4,R2               R4=LENGTH OF RECORD                          
         STH   R4,HALF                                                          
         MVC   CTCLEN,HALF         SET NEW RECORD LENGTH                        
         L     R2,AIOAREA                                                       
         LA    R4,4(R4)                                                         
         STH   R4,0(R2)                                                         
         B     RECPROCX                                                         
*                                                                               
RECPROC6 MVC   MSGAREA,=CL40'ELEMENT LENGTH OF ZERO DETECTED KEY -'             
         BCTR  R4,0                                                             
         CR    R3,R4                                                            
         BNE   BADREC                                                           
         MVI   0(R3),0                                                          
         B     RECPROC4                                                         
*                                                                               
RECPROC8 LA    R4,1(R4)                                                         
         CR    R3,R4                                                            
         BE    RECPROC4                                                         
         MVC   MSGAREA,=CL40'ELEMENT CHAIN ERROR DETECTED KEY -'                
         B     BADREC                                                           
*                                                                               
RECPROCX MVI   DIE,C'Y'            RESET FORCED CANCEL BYTE                     
         L     R7,SAVER7           RETURN                                       
         BR    R7                                                               
         DROP  R2                                                               
         EJECT                                                                  
* ROUTINE TO SET WHAT TYPE OF RECORD THAT HAS BEEN READ AND EXTRACT ANY         
* PERTINENT VALUES FROM IT. THIS CODE IS EXECUTED AFTER EVERY READ.             
*                                                                               
RECTYPE  XC    ADESCEL,ADESCEL                                                  
         L     R2,AIOAREA                                                       
         LA    R2,4(R2)                                                         
         LA    R3,RECTAB                                                        
         USING CTCREC,R2                                                        
*                                                                               
RECTYPE2 CLI   1(R3),0                                                          
         BE    RECTYPE4                                                         
         CLC   0(1,R3),0(R2)                                                    
         BE    RECTYPE4                                                         
         LA    R3,L'RECTAB(R3)                                                  
         B     RECTYPE2                                                         
*                                                                               
RECTYPE4 MVC   PROCREC,1(R3)       MOVE IN RECORD TYPE                          
         TM    2(R3),X'80'         RECORD TYPE HAS A PASSIVE POINTER            
         BZ    RECTYPE6                                                         
         CLI   PROCREC,TERMINAL                                                 
         BE    RECTYPEA                                                         
         CLI   PROCREC,USERID                                                   
         BE    RECTYPEC                                                         
         CLI   PROCREC,AUTHNAME                                                 
         BE    RECTYPEE                                                         
*                                                                               
RECTYPE6 MVI   BOOK,C'N'                                                        
         TM    2(R3),X'40'         SET SWITCH IF A BOOK RECORD                  
         BZ    *+8                                                              
         MVI   BOOK,C'Y'                                                        
         LA    R2,CTCDATA          FIND DESCRIPTION ELEMENT                     
         SR    R3,R3                                                            
*                                                                               
RECTYPE8 CLI   0(R2),0                                                          
         BER   R7                                                               
         CLI   0(R2),X'02'                                                      
         BHR   R7                                                               
         BNE   *+10                                                             
         ST    R2,ADESCEL                                                       
         BR    R7                                                               
         IC    R3,1(R2)                                                         
         AR    R2,R3                                                            
         B     RECTYPE8                                                         
*                                                                               
RECTYPEA OC    7(8,R2),7(R2)       TEST PASSIVE                                 
         BNZ   *+8                                                              
         MVI   PROCREC,TERMPASS                                                 
         B     RECTYPE6                                                         
*                                                                               
RECTYPEC OC    15(8,R2),15(R2)     TEST PASSIVE                                 
         BNZ   *+8                                                              
         MVI   PROCREC,IDPASS                                                   
         B     RECTYPE6                                                         
*                                                                               
RECTYPEE OC    3(12,R2),3(R2)                                                   
         BNZ   RECTYPE6                                                         
         MVI   PROCREC,AUTHPASS                                                 
         OC    3(20,R2),3(R2)                                                   
         BZ    RECTYPE6                                                         
         MVI   PROCREC,AUTHCODE                                                 
         B     RECTYPE6                                                         
         EJECT                                                                  
* REPORT ROUTINES                                                               
*                                                                               
REPFRST  BR    R7                                                               
*                                                                               
REPPROC  BR    R7                                                               
*                                                                               
REPLAST  BR    R7                                                               
         EJECT                                                                  
* ROUTINES TO HANDLE UPDATING AND DELETING OF RECORDS                           
*                                                                               
DELFRST  GOTO1 VDATCON,DMCB,(4,DATEVAL),(1,TODAY)                               
*                                  GET TODAYS DATE COMPRESSED                   
         GOTO1 VDATCON,DMCB,(5,DUB),(2,TODAYB)                                  
         BR    R7                                                               
*                                                                               
DELPROC  L     R2,AIOAREA          PROCESS                                      
         LA    R2,4(R2)                                                         
         USING CTCREC,R2                                                        
         CLI   PROCREC,UNKNOWN                                                  
         BNE   *+18                                                             
         MVC   MSGAREA,=CL40'RECORD TYPE UNKNOWN (DELETED) KEY -'               
         MVI   DIE,C'N'                                                         
         B     BADREC                                                           
         CLI   PROCREC,19          IGNORE BOOK RECORDS                          
         BL    DELPROC1                                                         
         CLI   PROCREC,22                                                       
         BH    DELPROC1                                                         
         BR    R7                                                               
*                                                                               
DELPROC1 DS    0H                                                               
         CLI   PROCREC,3           AND HEADER/TRAILER                           
         BLR   R7                                                               
         TM    CTCSTAT,X'80'       OTHERS MAY BE DELETED                        
         BZ    *+10                                                             
         MVI   WRITE,X'FF'                                                      
         BR    R7                                                               
*                                  ADDITIONAL PROCESSING FOR                    
         CLI   PROCREC,PROFILE       PROFILE RECORDS                            
         BE    DELPPROF                                                         
         CLI   PROCREC,AUTHPASS      AND PASSWORD CODE RECORDS                  
         BE    DELPPSWD                                                         
         CLI   PROCREC,AUTHCODE      AND PASSWORD NUMBER RECORDS                
         BE    DELPPSWD                                                         
         BR    R7                                                               
*                                  ADDITIONAL PROCESSING FOR                    
DELPPROF CLC   CTCLEN,=H'34'       DELETE USELESS PROFILES IE EMPTY             
         BH    *+10                                                             
         MVI   WRITE,X'FF'                                                      
         BR    R7                                                               
         MVI   BYTE,0                                                           
         LA    R3,CTCDATA                                                       
         SR    R4,R4                                                            
*                                                                               
DELPROC2 CLI   0(R3),0                                                          
         BE    DELPROC6                                                         
         MVC   WORK(1),0(R3)                                                    
         NI    WORK,X'F0'                                                       
         CLI   WORK,X'40'          PROFILE ELEMENT ?                            
         BNE   DELPROC4                                                         
         CLI   2(R3),C'T'          TEMP TYPE ?                                  
         BNE   DELPROC4                                                         
         CLC   3(3,R3),TODAY       EQ OR LEQ THAN TODAY                         
         BNL   DELPROC4                                                         
         MVI   0(R3),X'FF'         SET FOR DELETION                             
         OI    BYTE,X'80'                                                       
*                                                                               
DELPROC4 IC    R4,1(R3)                                                         
         AR    R3,R4                                                            
         B     DELPROC2                                                         
*                                                                               
DELPROC6 CLI   BYTE,0              ANTHING TO BE DELETED ?                      
         BER   R7                                                               
         GOTO1 VHELLO,DMCB,(C'D',=C'CTFILE '),(X'FF',(R2)),0                    
         L     R3,12(R1)           RE-BUILD LENGTH                              
         CH    R3,=H'34'           RE-CHECK FOR USELESS PROFILES                
         BH    *+8                                                              
         MVI   WRITE,X'FF'                                                      
         LA    R3,4(R3)                                                         
         L     R2,AIOAREA                                                       
         STH   R3,0(R2)                                                         
         BR    R7                                                               
*                                  DEAL WTIH OUTDATED PASSWORD RECORDS          
         USING SA0REC,R2                                                        
DELPPSWD LA    R3,SA0DATA                                                       
         SR    RF,RF                                                            
*                                  FIND EFFECTIVE DATE ELEMENT                  
DELPWD10 CLI   0(R3),0                                                          
         BER   R7                  IGNORE IF NOT FOUND                          
         USING SAPEFEL,R3                                                       
         CLI   SAPEFEL,SAPEFELQ                                                 
         BE    DELPWD20            FOUND                                        
         IC    RF,1(R3)            BUMP TO NEXT ELEMENT                         
         AR    R3,RF                                                            
         B     DELPWD10                                                         
*                                                                               
DELPWD20 CLC   SAPEFSTA,SAPEFEND   DELETE IF START>END EFFECTIVE DATE           
         BH    DELPWD30                                                         
         CLC   SAPEFEND,TODAYB     DELETE IF OUTDATED                           
         BNLR  R7                                                               
DELPWD30 MVI   WRITE,X'FF'                                                      
         BR    R7                                                               
         DROP  R3                                                               
         EJECT                                                                  
* ROUTINES TO PRODUCE FILE DIRECTORY LIST                                       
*                                                                               
DIRFRST  ST    R7,SAVER7           FIRST TIME                                   
         BAS   R7,SETPRINT                                                      
         MVC   TITLE+10(27),=C'CONTROL FILE DIRECTORY LIST'                     
         L     R7,SAVER7                                                        
         BR    R7                                                               
*                                                                               
DIRPROC  L     R2,AIOAREA          PROCESS                                      
         LA    R2,4(R2)                                                         
         CLI   PROCREC,IDPASS      IGNORE PASSIVE RECORDS                       
         BER   R7                                                               
         CLI   PROCREC,TERMPASS                                                 
         BER   R7                                                               
         CLI   PROCREC,19                                                       
         BL    DIRPROC2                                                         
         CLI   PROCREC,22                                                       
         BH    DIRPROC2                                                         
         CLI   24(R2),0            YES - INDEX RECORD                           
         BNER  R7                  NO  - IGNORE                                 
*                                                                               
DIRPROC2 TM    27(R2),X'80'                                                     
         BOR   R7                  IGNORE DELETES                               
         GOTO1 VKEYOUT,DMCB,(R2),P                                              
         GOTO1 VPRINTER                                                         
         BR    R7                                                               
         EJECT                                                                  
* ROUTINES TO REORGANIZE, DELETE AND PRINT BOOK RECORDS                         
*                                                                               
LIBFRST  ST    R7,SAVER7           FIRST TIME                                   
         TM    SWIN,X'80'          INPUT MUST BE DISK                           
         BZR   R7                                                               
         MVC   IOPARMA,VISREAD                                                  
         LA    R2,BOOKEY                                                        
         ST    R2,IOPARME                                                       
         TM    SWLIB,X'08'         PRINT BOOKS ?                                
         BZR   R7                                                               
         BAS   R7,SETPRINT                                                      
         MVC   TITLE+14(33),=C'CONTROL FILE LIBRARY BOOK LISTING'               
         L     R7,SAVER7                                                        
         BR    R7                                                               
*                                                                               
LIBPROC  ST    R7,SAVER7           PROCESS                                      
         TM    SWIN,X'80'          INPUT MUST BE DISK                           
         BZR   R7                                                               
         CLI   BOOK,C'Y'           TEST IF A BOOK RECORD                        
         BNER  R7                                                               
         L     R2,AIOAREA                                                       
         LA    R2,4(R2)                                                         
         USING CTCREC,R2                                                        
         MVC   BOOKEY,CTCKEY                                                    
         MVC   MSGAREA,=CL40'BOOK INDEX RECORD MISSING KEY -'                   
         CLI   24(R2),0                                                         
         BE    *+12                                                             
         MVI   DIE,C'N'                                                         
         B     BADREC                                                           
         MVC   MSGAREA,=CL40'BOOK INDEX ELEMENT MISSING KEY -'                  
         MVI   DIE,C'N'                                                         
         LA    R3,CTCDATA                                                       
         SR    R4,R4                                                            
*                                                                               
LIBPROC2 CLI   0(R3),X'04'         FIND INDEX ELEMENT                           
         BE    LIBPROC4                                                         
         CLI   0(R3),0                                                          
         BE    BADREC                                                           
         IC    R4,1(R3)                                                         
         AR    R3,R4                                                            
         B     LIBPROC2                                                         
*                                                                               
LIBPROC4 TM    SWLIB,X'08'         PRINT BOOKS                                  
         BZ    LIBPROC6                                                         
         ZAP   LINE,=P'99'                                                      
         ZAP   PAGE,=P'1'                                                       
         GOTO1 VKEYOUT,DMCB,(R2),MID1                                           
*                                                                               
LIBPROC6 MVC   BOOKIND,0(R3)                                                    
         MVC   BOOKSTA,CTCSTAT     SAVE STATUS                                  
         TM    CTCSTAT,X'80'       DELETED ?                                    
         BO    LIBPROCK                                                         
         LA    R4,3(R3)            R4=A(OLD INDEX)                              
         XC    0(251,R4),0(R4)                                                  
         LA    R5,BOOKIND+3        R5=A(SAVED OLD INDEX)                        
         SR    R1,R1                                                            
*                                  BUILD A NEW INDEX                            
LIBPROC8 CLI   0(R5),0             END OF OLD INDEX                             
         BE    LIBPROCA                                                         
         LA    R1,1(R1)                                                         
         STC   R1,0(R4)                                                         
         LA    R4,1(R4)                                                         
         LA    R5,1(R5)                                                         
         B     LIBPROC8                                                         
*                                                                               
LIBPROCA STC   R1,BOOKHI           SAVE NEW HIGH SEQUENCE NUMBER                
         STC   R1,2(R3)            INSERT NEW HISEQ INTO INDEX                  
         TM    SWOUT,X'40'                                                      
         BZ    *+8                                                              
         BAS   R7,TOUPROC          WRITE INDEX TO TAPE                          
         CLI   BOOKIND+2,0         ANY DATA RECORDS                             
         BE    LIBPROCK                                                         
         MVC   MSGAREA,=CL40'BOOK DATA RECORD MISSING KEY -'                    
         LA    R5,BOOKIND+3        R5=A(SAVED OLD INDEX)                        
         LA    R4,1                                                             
*                                                                               
LIBPROCC CLI   0(R5),0                                                          
         BE    LIBPROCK                                                         
         MVC   BOOKEY+24(1),0(R5)  READ OLD SEQUENCE RECORD                     
         GOTO1 VISDDS,IOPARMA                                                   
         OC    8(2,R1),8(R1)                                                    
         BNZ   BADREC                                                           
         MVC   HALF,CTCLEN         BUILD IBM RECORD LENGTH                      
         LH    R1,HALF                                                          
         L     RE,AIOAREA                                                       
         LA    R1,4(R1)                                                         
         STH   R1,0(RE)                                                         
         STC   R4,CTCKSUB          INSERT NEW SEQUENCE                          
         TM    SWOUT,X'40'                                                      
         BZ    *+8                                                              
         BAS   R7,TOUPROC                                                       
         TM    SWLIB,X'08'         PRINT BOOKS ?                                
         BZ    LIBPROCI                                                         
         LA    R3,CTCDATA                                                       
         CLI   0(R3),X'10'         DATA RECORD                                  
         BNE   LIBPROCE                                                         
         SR    RE,RE                                                            
         IC    RE,1(R3)                                                         
         SH    RE,=H'3'                                                         
         EX    RE,*+8                                                           
         B     LIBPROCG                                                         
         MVC   P(0),2(R3)                                                       
*                                                                               
LIBPROCE MVC   P(9),=C'++INCLUDE'  INCLUDE RECORD                               
         GOTO1 VKEYOUT,DMCB,2(R3),P+10                                          
*                                                                               
LIBPROCG CVD   R4,DUB              SEQUENCE NUMBER                              
         UNPK  P+73(4),DUB                                                      
         OI    P+76,X'F0'                                                       
         GOTO1 VPRINTER                                                         
*                                                                               
LIBPROCI LA    R5,1(R5)                                                         
         LA    R4,1(R4)                                                         
         B     LIBPROCC                                                         
*                                                                               
LIBPROCK SR    R3,R3               FUDGE LOGICAL/PHYSICAL TOTALS                
         LA    R4,RECTAB                                                        
LIBPROCL CLC   PROCREC,1(R4)                                                    
         BE    *+16                                                             
         LA    R4,L'RECTAB(R4)                                                  
         LA    R3,1(R3)                                                         
         B     LIBPROCL                                                         
         SLL   R3,3                                                             
         A     R3,ACNTGEN          R3=A(LOGICAL ACCUMS)                         
         SR    R4,R4                                                            
         IC    R4,BOOKIND+2        R4=OLD HISEQ                                 
         SR    R5,R5                                                            
         TM    BOOKSTA,X'80'                                                    
         BO    *+8                                                              
         IC    R5,BOOKHI           R5=NEW HISEQ                                 
         CVD   R4,DUB                                                           
         AP    PHINCNT,DUB         PHYSICAL INPUT                               
         LA    R4,1(R4)                                                         
         CVD   R4,DUB                                                           
         AP    0(4,R3),DUB         LOGICAL INPUT                                
         TM    BOOKSTA,X'80'                                                    
         BO    *+8                                                              
         BCTR  R4,0                                                             
         SR    R4,R5                                                            
         CVD   R4,DUB                                                           
         AP    4(4,R3),DUB         LOGICAL DELETES                              
         AP    PHDECNT,DUB         PHYSICAL DELETES                             
         MVC   BOOKEY+24(1),BOOKIND+2                                           
         CLI   BOOKIND+2,0                                                      
         BE    LIBPROCM                                                         
*                                  READ LAST DATA RECORD                        
         GOTO1 VISDDS,IOPARMA                                                   
         OC    8(2,R1),8(R1)                                                    
         BNZ   BADREC                                                           
*                                                                               
LIBPROCM MVI   DIE,C'Y'            RE-SET CANCEL BYTE                           
         B     PROCESS                                                          
         EJECT                                                                  
* RECORD COUNTING ROUTINES                                                      
*                                                                               
CNTRPOC  SR    R2,R2               PROCESS                                      
         LA    R3,RECTAB                                                        
CNTRPOC2 CLC   PROCREC,1(R3)                                                    
         BE    *+16                                                             
         LA    R3,L'RECTAB(R3)                                                  
         LA    R2,1(R2)                                                         
         B     CNTRPOC2                                                         
         SLL   R2,3                                                             
         A     R2,ACNTGEN                                                       
         AP    0(4,R2),=P'1'       UPDATE INPUT COUNT                           
         CLI   WRITE,X'FF'                                                      
         BNER  R7                                                               
         AP    4(4,R2),=P'1'       UPDATE PURGE COUNT                           
         BR    R7                                                               
*                                                                               
CNTLAST  ST    R7,SAVER7           LAST TIME                                    
         BAS   R7,SETPRINT                                                      
         MVC   TITLE+20(21),=C'LOGICAL RECORD COUNTS'                           
         MVC   MID1(40),=C'-----------------RECORD-----------------'            
         MVC   MID2(40),=C'RECORD TYPE        INPUT  PURGED  OUTPUT'            
         L     R2,ACNTGEN                                                       
         LA    R3,RECTAB                                                        
         BAS   RE,CNTEDIT                                                       
         GOTO1 VPRINTER                                                         
         ZAP   LGINCNT,WORK(4)     NOW DO FILE TOTALS                           
         ZAP   LGDECNT,WORK+4(4)                                                
         LA    R2,LGINCNT                                                       
         LA    R3,FILTAB                                                        
         BAS   RE,CNTEDIT                                                       
         L     R7,SAVER7                                                        
         BR    R7                                                               
*                                                                               
CNTEDIT  NTR1                                                                   
         ZAP   WORK(4),=P'0'                                                    
         ZAP   WORK+4(4),=P'0'                                                  
*                                                                               
CNTEDIT2 CLC   0(3,R3),=3X'FF'                                                  
         BE    CNTEDITA                                                         
*                                                                               
CNTEDIT4 AP    WORK(4),0(4,R2)                                                  
         AP    WORK+4(4),4(4,R2)                                                
         CLC   0(8,R2),=2PL4'0'                                                 
         BE    CNTEDIT8                                                         
*                                                                               
CNTEDIT6 MVC   P(12),3(R3)                                                      
         ZAP   DUB(4),0(4,R2)                                                   
         SP    DUB(4),4(4,R2)                                                   
         UNPK  P+17(7),0(4,R2)                                                  
         OI    P+23,X'F0'                                                       
         UNPK  P+25(7),4(4,R2)                                                  
         OI    P+31,X'F0'                                                       
         UNPK  P+33(7),DUB(4)                                                   
         OI    P+39,X'F0'                                                       
         GOTO1 VPRINTER                                                         
*                                                                               
CNTEDIT8 LA    R2,8(R2)                                                         
         LA    R3,L'RECTAB(R3)                                                  
         B     CNTEDIT2                                                         
*                                                                               
CNTEDITA XIT1                                                                   
         EJECT                                                                  
* ROUTINES TO DO DITTO OF FILE                                                  
*                                                                               
DITFRST  ST    R7,SAVER7           FIRST TIME                                   
         BAS   R7,SETPRINT                                                      
         MVC   TITLE+18(23),=C'CONCRETE RECORD DISPLAY'                         
         L     R7,SAVER7                                                        
         BR    R7                                                               
*                                                                               
DITPROC  DS    0H                  PROCESS                                      
         MVC   MSGAREA,=CL40'RECORD TYPE=             -'                        
         MVC   WIDTH,=H'100'                                                    
         LA    R2,RECTAB                                                        
*                                                                               
DITPROC2 CLI   1(R2),0                                                          
         BE    DITPROC4                                                         
         CLC   1(1,R2),PROCREC                                                  
         BE    DITPROC4                                                         
         LA    R2,L'RECTAB(R2)                                                  
         B     DITPROC2                                                         
*                                                                               
DITPROC4 MVC   MSGAREA+12(12),3(R2)                                             
         BAS   RE,HEXREC                                                        
         BR    R7                                                               
         EJECT                                                                  
* ROUTINES TO HANDLE WRITING OF TAPES                                           
*                                                                               
TOUFRST  BAS   R1,OPNTOUT          FIRST TIME                                   
         BR    R7                                                               
*                                                                               
TOUPROC  CLI   WRITE,X'FF'         PROCESS                                      
         BNE   *+16                                                             
         MVI   WRITE,0                                                          
         AP    PHDECNT,=P'1'                                                    
         BR    R7                                                               
         L     R1,ATOUT                                                         
         L     R0,AIOAREA                                                       
         PUT   (1),(0)                                                          
         AP    PHOUCNT,=P'1'                                                    
         BR    R7                                                               
*                                                                               
TOULAST  BAS   R1,CLSTOUT          LAST TIME                                    
         BR    R7                                                               
         EJECT                                                                  
* ROUTINES TO HANDLE WRITING OF DISK                                            
*                                                                               
DOUFRST  ST    R7,SAVER7           FIRST TIME                                   
         MVC   IOPARM1,=A(ISOPEN)                                               
         L     R5,ACTFILE                                                       
         USING ISDTF,R5                                                         
         XC    ISCILAST,ISCILAST                                                
         DROP  R5                                                               
         GOTO1 VISDDS,IOPARM1                                                   
         MVC   IOPARM1,VISREAD                                                  
         TM    SWOVER,X'80'                                                     
         BOR   R7                                                               
         MVC   IOPARM2,AIOAREA2                                                 
         BAS   R7,DINPROC          READ GENERATION RECORD                       
         SP    PHINCNT,=P'1'       ADJUST INPUT COUNT                           
         MVC   MSGAREA,=CL40'GENERATION RECORD MISSING KEY -'                   
         OC    IOPARM3(2),IOPARM3                                               
         BZ    DOUFRST2                                                         
         GOTO1 VLOGIO,DMCB,1,=C'**CONCRETE** GENERATION RECORD MISSING'         
         GOTO1 (RF),(R1),1,=C'**CONCRETE** SEE IO/2 IN DUMP'                    
         DC    H'0'                                                             
*                                                                               
DOUFRST2 DS    0H                  GENERATION RECORD READ OK                    
         L     R2,AIOAREA2                                                      
         USING CTCREC,R2                                                        
         LA    R2,CTCDATA                                                       
         CLC   GENOUT,2(R2)                                                     
         BNH   DOUFRST4                                                         
         OI    SWOVER,X'80'                                                     
         GOTO1 VISDDS,IOPARM1,A(ISCLOSE)                                        
         L     R7,SAVER7                                                        
         B     DOUFRST                                                          
DOUFRST4 MVI   DUB,7                                                            
         B     CONVERR                                                          
*                                                                               
DOUPROC  CLI   WRITE,X'FF'         PROCESS                                      
         BNE   *+16                                                             
         AP    PHDECNT,=P'1'                                                    
         MVI   WRITE,0                                                          
         BR    R7                                                               
         L     R2,AIOAREA                                                       
         CLC   4(25,R2),LASTKEY                                                 
         BH    DOUPROC1                                                         
*&&UK*&& B     DOUPROC2                                                         
         MVC   MSGAREA,=CL40'RECORD OUT OF SEQUENCE KEY -'                      
         AP    PHBDCNT,=P'1'                                                    
         MVC   WIDTH,=H'90'                                                     
         BAS   RE,HEXREC                                                        
         BR    R7                                                               
*                                                                               
DOUPROC1 MVC   LASTKEY,4(R2)                                                    
         LA    R1,IOPARMA                                                       
         L     RF,VISLDDS                                                       
         BASR  RE,RF                                                            
         OC    IOPARMC(2),IOPARMC                                               
         BNZ   *+24                                                             
         AP    PHOUCNT,=P'1'                                                    
         CLI   PROCREC,TRAILER                                                  
         BNE   *+8                                                              
         MVI   EOFLOAD,C'Y'                                                     
         BR    R7                                                               
         MVC   MSGAREA,=CL40'UNRECOVERABLE DISK ERROR KEY -'                    
         B     BADREC                                                           
*                                                                               
DOUPROC2 GOTO1 VLOGIO,DMCB,1,=C'**CONCRETE** RECORD OUT OF SEQUENCE'            
         MVC   MSGAREA,=CL40'RECORD OUT OF SEQUENCE KEY -'                      
         B     BADREC                                                           
*                                                                               
DOULAST  CLI   EOFLOAD,C'Y'        LAST TIME                                    
         BE    DOULAST2                                                         
         GOTO1 VLOGIO,DMCB,1,=C'**CONCRETE** TRAILER RECORD MISSING'            
         MVC   MSGAREA,=CL40'TRAILER RECORD MISSING LAST KEY WAS -'             
         B     BADREC                                                           
*                                                                               
DOULAST2 L     R5,ACTFILE                                                       
         USING ISDTF,R5                                                         
         LA    R2,ISXTNTPD                                                      
         CLI   14(R2),X'FF'                                                     
         BE    *+12                                                             
         LA    R2,14(R2)                                                        
         B     *-12                                                             
         LH    R3,12(R2)                                                        
         SH    R3,ISPDLAST         R3=NUMBER OF TRKS AVAILABLE                  
         MVC   MSGAREA,=CL40'NUMBER OF TRACKS AVAILABLE='                       
         LA    R4,MSGAREA                                                       
         EDIT  (R3),(5,27(R4)),ALIGN=LEFT,ZERO=NOBLANK                          
         GOTO1 VLOGIO,DMCB,X'FF000001',(40,MSGAREA)                             
         L     R2,ISPDDA                                                        
         L     R3,ISOVDA                                                        
         MVC   MSGAREA,=CL40'CYLNDX SIZE=XXXXXX,MSTNDX SIZE=XXXXXX'             
         CLI   ISINDXTY,0                                                       
         BE    *+16                                                             
         MVC   MSGAREA(3),=C'MST'                                               
         MVC   MSGAREA+19(3),=C'CYL'                                            
         EDIT  (R2),(6,12(R4)),FILL=0                                           
         EDIT  (R3),(6,31(R4)),FILL=0                                           
         BASR  RE,RF                                                            
         BR    R7                                                               
         DROP  R5                                                               
         DROP  R2                                                               
         EJECT                                                                  
* PRINT PHYSICAL RECORD TOTALS. EXECUTED AT THE END OF EVERY RUN.               
*                                                                               
*                                                                               
RECTOTS  ST    R7,SAVER7           LAST TIME                                    
         BAS   R7,SETPRINT                                                      
         MVC   TITLE+19(22),=C'PHYSICAL RECORD COUNTS'                          
         MVC   MID1+2(29),=C'INPUT  PURGED  OUTPUT   ERROR'                     
         MVC   MID2+2(29),=C'-----  ------  ------   -----'                     
         GOTO1 VLOGIO,DMCB,1,(31,MID1)                                          
         GOTO1 (RF),(R1),1,(31,MID2)                                            
         LA    R2,P                                                             
         LA    R3,PHINCNT                                                       
         LA    R4,4                                                             
*                                                                               
RECTOTS2 UNPK  0(7,R2),0(4,R3)     EDIT PHYSICAL TOTALS                         
         OI    6(R2),X'F0'                                                      
         LA    R2,8(R2)                                                         
         LA    R3,4(R3)                                                         
         BCT   R4,RECTOTS2                                                      
         GOTO1 VLOGIO,DMCB,1,(31,P)                                             
         GOTO1 VPRINTER                                                         
         L     R7,SAVER7                                                        
         CP    PHBDCNT,=P'0'                                                    
         BER   R7                                                               
         GOTO1 VLOGIO,DMCB,1,=C'**CONCRETE** WARNING BAD RECORDS FOUND'         
         BR    R7                                                               
*                                                                               
* ROUTINE TO CLEAR DOWN PRINT DSECT                                             
*                                                                               
SETPRINT MVC   TITLE,SPACES                                                     
         MVC   MID1,SPACES                                                      
         MVC   MID2,SPACES                                                      
         MVC   MID3,SPACES                                                      
         MVC   MID4,SPACES                                                      
         MVC   SUB1,SPACES                                                      
         MVC   SUB2,SPACES                                                      
         MVC   SUB3,SPACES                                                      
         MVC   P,SPACES                                                         
         ZAP   LINE,=P'99'                                                      
         ZAP   PAGE,=P'1'                                                       
         BR    R7                                                               
         EJECT                                                                  
* ROUTINE TO PRINT ERROR MESSAGE AND KEY OF RECORD WHEN AN I/O ERROR            
* OCCURS.                                                                       
*                                                                               
BADREC   MVC   P,SPACES                                                         
         GOTO1 VPRINTER                                                         
         AP    PHBDCNT,=P'1'                                                    
         MVC   WIDTH,=H'90'                                                     
         BAS   RE,HEXREC                                                        
         CLI   DIE,C'N'            PROGRAM CHECK REQUESTED ?                    
         BE    *+10                                                             
         MVI   DIE,C'F'            SET FORCED KILL MODE                         
         DC    H'0'                                                             
         MVI   DIE,C'Y'                                                         
         B     PROCESS             IGNORE THIS RECORD                           
         EJECT                                                                  
* ROUTINE TO PRINT OUT KEY AND DATA OF RECORD IN HEX FORMAT                     
*                                                                               
HEXREC   NTR1                                                                   
         MVC   P(40),MSGAREA                                                    
         LA    R4,P+40                                                          
         CLI   0(R4),C' '                                                       
         BNE   *+10                                                             
         BCTR  R4,0                                                             
         B     *-10                                                             
         LA    R4,2(R4)                                                         
         L     R2,AIOAREA          R2=A(RECORD)                                 
         LH    R3,0(R2)                                                         
         LA    R2,4(R2)                                                         
         SH    R3,=H'4'            R3=L'RECORD                                  
         CH    R3,RECMAX                                                        
         BNH   *+8                                                              
         LH    R3,RECMAX                                                        
         L     R5,AIOAREA2         IOAREA2 USED AS WORK                         
         GOTO1 VHEXOUT,DUB,(R2),(R5),(R3),=C'SEP'                               
         CP    LINE,=P'57'                                                      
         BL    *+10                                                             
         ZAP   LINE,=P'99'                                                      
         MVC   0(28,R4),0(R2)                                                   
         XC    DUB(12),DUB         TRANSLATE CHARACTERS                         
         GOTO1 VDUMPOUT,DUB,(28,(R4))                                           
         GOTO1 VPRINTER            PRINT CHARACTERS                             
         LA    R7,0(R5,R3)         R5=A(ZONES),R7=A(DIGITS)                     
         MVC   0(28,R4),0(R5)                                                   
         BASR  RE,RF               PRINT ZONES                                  
         MVC   0(28,R4),0(R7)                                                   
         BASR  RE,RF               PRINT DIGITS                                 
         BASR  RE,RF                                                            
         LA    R2,28(R2)                                                        
         LA    R5,28(R5)                                                        
         LA    R7,28(R7)                                                        
         SH    R3,=H'28'                                                        
         BM    HEXREC4                                                          
         BZ    HEXREC4                                                          
         LH    R0,WIDTH            R0=W'PRINT LINE                              
         L     RF,VPRINTER                                                      
*                                                                               
HEXREC2  CR    R3,R0               PRINT REST OF RECORD                         
         BH    *+6                                                              
         LR    R0,R3                                                            
         LR    R1,R0                                                            
         BCTR  R1,0                                                             
         CP    LINE,=P'57'                                                      
         BL    *+10                                                             
         ZAP   LINE,=P'99'                                                      
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R2)                                                    
         ST    R1,FULL                                                          
*                                  TRANSLATE CHARACTERS                         
         GOTO1 VDUMPOUT,DUB,((R0),(R4))                                         
         GOTO1 VPRINTER            PRINT CHARACTERS                             
         L     R1,FULL                                                          
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R5)                                                    
         BASR  RE,RF               PRINT ZONES                                  
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R7)                                                    
         BASR  RE,RF               PRINT DIGITS                                 
         BASR  RE,RF               SPACE LINE                                   
         CR    R3,R0                                                            
         BE    HEXREC4                                                          
         AR    R2,R0               BUMP INPUT POINTERS                          
         AR    R5,R0                                                            
         AR    R7,R0                                                            
         SR    R3,R0                                                            
         B     HEXREC2                                                          
*                                                                               
HEXREC4  XIT1                                                                   
         EJECT                                                                  
OPNTINT  STM   RE,R2,SAVEIOR                                                    
         L     R2,ATINT                                                         
         OPEN  ((2),INPUT)                                                      
         LM    RE,R2,SAVEIOR                                                    
         BR    R1                                                               
*                                                                               
CLSTINT  STM   RE,R2,SAVEIOR                                                    
         L     R2,ATINT                                                         
         CLOSE ((2))                                                            
         LM    RE,R2,SAVEIOR                                                    
         BR    R1                                                               
*                                                                               
OPNTOUT  STM   RE,R2,SAVEIOR                                                    
         L     R2,ATOUT                                                         
         OPEN  ((2),OUTPUT)                                                     
         LM    RE,R2,SAVEIOR                                                    
         BR    R1                                                               
*                                                                               
CLSTOUT  STM   RE,R2,SAVEIOR                                                    
         L     R2,ATOUT                                                         
         CLOSE ((2))                                                            
         LM    RE,R2,SAVEIOR                                                    
         BR    R1                                                               
         EJECT                                                                  
         DC    CL8'**TBLS**'                                                    
* THIS TABLE CONTAINS ALL VALID REQUESTABLE OPTIONS                             
* BYTE 0     - L'KEYWORD                                                        
* BYTE 1-10  - KEYWORD                                                          
* BYTE 11-13 - A(VALIDATION ROUTINE)                                            
*                                                                               
PARMTAB  DS    0CL14                                                            
         DC    AL1(5),CL10'INPUT     ',AL3(CONIN)                               
         DC    AL1(6),CL10'OUTPUT    ',AL3(CONOUT)                              
         DC    AL1(4),CL10'MODE      ',AL3(CONMODE)                             
         DC    AL1(8),CL10'OVERRIDE  ',AL3(CONORID)                             
         DC    AL1(5),CL10'GENUP     ',AL3(CONGEN)                              
         DC    AL1(6),CL10'REPORT    ',AL3(CONREP)                              
         DC    AL1(9),CL10'DIRECTORY ',AL3(CONDIR)                              
         DC    AL1(8),CL10'LIBREORG  ',AL3(CONLIB)                              
         DC    AL1(6),CL10'DELETE    ',AL3(CONDET)                              
         DC    AL1(4),CL10'LOAD      ',AL3(CONLOAD)                             
         DC    AL1(5),CL10'COUNT     ',AL3(CONCNT)                              
         DC    AL1(8),CL10'RECCHECK  ',AL3(CONREC)                              
         DC    AL1(4),CL10'FILE      ',AL3(CONFILE)                             
         DC    AL1(5),CL10'DDSIO     ',AL3(CONDDS)                              
         DC    AL1(5),CL10'START     ',AL3(CONSTRT)                             
         DC    AL1(3),CL10'END       ',AL3(CONEND)                              
         DC    AL1(5),CL10'DITTO     ',AL3(CONDIT)                              
         DC    AL1(3),CL10'MSG       ',AL3(CONMSG)                              
         DC    X'FF'                                                            
         EJECT                                                                  
* THIS TABLE IS SET BY THE VALIDATION ROUTINES WHEN AN OPTION IS                
* REQUESTED (BYTE 0=X'80' OR X'40').                                            
* BYTE 0     - OPTION SETTING (X'00'=OPTION NOT REQUESTED)                      
* BYTE 1-3   - A(X'80' SETTING HOOKS)                                           
* BYTE 4-6   - A(X'40' SETTING HOOKS)                                           
*                                                                               
SWTTAB   DS    0CL7                                                             
*                                                                               
SWIN     DC    X'00',AL3(HOOKDIN),AL3(HOOKTIN)                                  
*                                                                               
SWCHK    DC    X'80',AL3(HOOKGEN),AL3(0)                                        
*                                                                               
SWREC    DC    X'00',AL3(HOOKREC),AL3(0)                                        
*                                                                               
SWREP    DC    X'00',AL3(HOOKREP),AL3(0)                                        
*                                                                               
SWDIR    DC    X'00',AL3(HOOKDIR),AL3(0)                                        
*                                                                               
SWLIB    DC    X'00',AL3(HOOKLIB),AL3(0)                                        
*                                                                               
SWDEL    DC    X'00',AL3(HOOKDEL),AL3(0)                                        
*                                                                               
SWLOAD   DC    X'00',AL3(HOOKLOD),AL3(0)                                        
*                                                                               
SWCNT    DC    X'00',AL3(HOOKCNT),AL3(0)                                        
*                                                                               
SWDIT    DC    X'00',AL3(HOOKDIT),AL3(0)                                        
*                                                                               
SWOUT    DC    X'00',AL3(HOOKOUD),AL3(HOOKOUT)                                  
*                                                                               
SWCON    DC    X'80',AL3(HOOKCON),AL3(0)                                        
*                                                                               
         DC    X'FF'                                                            
*                                  PASSIVE OPTIONS                              
SWOVER   DC    X'00'                                                            
SWGEN    DC    X'00'                                                            
SWMODE   DC    X'00'                                                            
SWSTRT   DC    X'00'                                                            
SWEND    DC    X'00'                                                            
SWMSG    DC    X'80'               MSG=YES                                      
         EJECT                                                                  
* THIS TABLE CONTAINS A LIST OF EXECUTABLE CODE ADDRESSED BY SWTTAB.            
* CODE FROM THIS TABLE IS BUILT INTO AN EXECUTABLE STRING.                      
* BYTE 0     * L'FIRST TIME HOOK INSTRUCTIONS                                   
* BYTE 1     * L'PROCESSING HOOK INSTRUCTIONS                                   
* BYTE 2     * L'LAST TIME HOOK INSTRUCTIONS                                    
* BYTE 4-N   * EXECUTABLE INSTRUCTIONS                                          
*                                                                               
         CNOP  0,4                                                              
HOOKDIN  DC    AL1(4,4,0,0)        INPUT=DISK     *                             
         BAS   R7,DINFRST                         *                             
         BAS   R7,DINPROC                         *                             
*                                                                               
HOOKTIN  DC    AL1(4,4,4,0)        INPUT=TAPE     *                             
         BAS   R7,TINFRST                         *                             
         BAS   R7,TINPROC                         *                             
         BAS   R7,TINLAST                         *                             
*                                                                               
HOOKGEN  DC    AL1(8,4,0,0)        CONTROL HOOKS  *                             
         BAS   R7,RECTYPE                         *                             
         BAS   R7,GENCHCK                         *                             
         BAS   R7,RECTYPE                         *                             
*                                                                               
HOOKREC  DC    AL1(0,4,0,0)        RECCHECK=YES   *                             
         BAS   R7,RECPROC                         *                             
*                                                                               
HOOKREP  DC    AL1(4,4,4,0)        REPORT=YES     *                             
         BAS   R7,REPFRST                         *                             
         BAS   R7,REPPROC                         *                             
         BAS   R7,REPLAST                         *                             
*                                                                               
HOOKDIR  DC    AL1(4,4,0,0)        DIRECTORY=YES  *                             
         BAS   R7,DIRFRST                         *                             
         BAS   R7,DIRPROC                         *                             
*                                                                               
HOOKLIB  DC    AL1(4,4,0,0)        LIBREORG=YES   *                             
         BAS   R7,LIBFRST                         *                             
         BAS   R7,LIBPROC                         *                             
*                                                                               
HOOKDEL  DC    AL1(4,4,0,0)        DELETE=YES     *                             
         BAS   R7,DELFRST                         *                             
         BAS   R7,DELPROC                         *                             
*                                                                               
HOOKLOD  DC    AL1(0,8,12,0)       LOAD=XXXXXXXX  *                             
         LR    R1,R6                              *                             
         L     RF,APHASE                          *                             
         BASR  RE,RF                              *                             
         LR    R1,R6                              *                             
         L     RF,APHASE                          *                             
         MVI   OVSWITCH,X'FF'                     *                             
         BASR  RE,RF                              *                             
*                                                                               
HOOKCNT  DC    AL1(0,4,4,0)        COUNT=YES      *                             
         BAS   R7,CNTRPOC                         *                             
         BAS   R7,CNTLAST                         *                             
*                                                                               
HOOKDIT  DC    AL1(4,4,0,0)        DITTO=YES      *                             
         BAS   R7,DITFRST                         *                             
         BAS   R7,DITPROC                         *                             
*                                                                               
HOOKOUD  DC    AL1(4,4,4,0)        OUTPUT=DISK    *                             
         BAS   R7,DOUFRST                         *                             
         BAS   R7,DOUPROC                         *                             
         BAS   R7,DOULAST                         *                             
*                                                                               
HOOKOUT  DC    AL1(4,4,4,0)        OUTPUT=TAPE    *                             
         BAS   R7,TOUFRST                         *                             
         BAS   R7,TOUPROC                         *                             
         BAS   R7,TOULAST                         *                             
*                                                                               
HOOKCON  DC    AL1(4,4,8,0)        CONTROL HOOKS  *                             
         B     PROCESS+4                          *                             
         B     PROCESS                            *                             
         BAS   R7,RECTOTS                         *                             
         B     EOJ                                *                             
         SPACE 2                                                                
EOJ      XBASE                                                                  
         EJECT                                                                  
*DMGREQUS                                                                       
       ++INCLUDE DMGREQUS                                                       
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              CONCRETE WORKING STORAGE                                         
*                                                                               
         DS    0D                                                               
FIRST    DC    60X'00'                                                          
PROCESS  DC    60X'00'                                                          
LAST     DC    60X'00'                                                          
PHASE    DC    CL8' '                                                           
AWORK    DC    A(CONWORK)                                                       
SAVER7   DS    F                                                                
SAVEIOR  DS    5F                                                               
NEXTHOOK DC    A(FIRST)                                                         
         DC    A(PROCESS)                                                       
         DC    A(LAST)                                                          
RECMIN   DC    H'25'                                                            
RECMAX   DC    H'1000'                                                          
RECMAX1  DC    H'2000'                                                          
LASTKEY  DC    XL25'00'                                                         
DIE      DC    C'Y'                                                             
EOFLOAD  DC    C'N'                                                             
WIDTH    DC    H'90'                                                            
TODAY    DS    CL3                                                              
TODAYB   DS    CL3                                                              
         SPACE 1                                                                
ERRTAB   DS    0CL40                                                            
         DC    CL40'CANCELLED DUE TO OPERATOR OPTION'                           
         DC    CL40'MISSING OR INVALID INPUT PARAMETER'                         
         DC    CL40'MISSING OR INVALID OUTPUT PARAMETER'                        
         DC    CL40'OUTPUT SPECIFIED FOR MODE=REPORT'                           
         DC    CL40'MISSING OR INVALID MODE PARAMETER'                          
         DC    CL40'INCOMPATIBLE INPUT/OUTPUT PARAMETER'                        
         DC    CL40'START=KEY ONLY VALID IF INPUT=DISK'                         
         DC    CL40'LOAD NOT AUTHORIZED (GENERATION)'                           
         EJECT                                                                  
*              TABLE OF RECORD TYPES                                            
*              BYTE 0    = KEY CHARACTER                                        
*                   1    = INTERNAL RECORD TYPE                                 
*                   2    = X'80' BIT ON IF RECORD HAS A PASSIVE POINTER         
*                          X'40' BIT ON IF A BOOK RECORD                        
*                   3-14 = RECORD TYPE NAME                                     
*                                                                               
RECTAB   DS    0CL15                                                            
         DC    X'00',AL1(HEADER)                                                
         DC    X'00',CL12'HEADER'                                               
         DC    X'01',AL1(PROGSAVE)                                              
         DC    X'00',CL12'PROGRAM SAVE'                                         
         DC    X'02',AL1(USERRECS)                                              
         DC    X'00',CL12'USER RECORDS'                                         
         DC    X'03',AL1(DSCHEMES)                                              
         DC    X'00',CL12'DATE SCHEMES'                                         
         DC    X'04',AL1(EDRRECS)                                               
         DC    X'00',CL12'EDR RECS'                                             
         DC    X'05',AL1(PHASRECS)                                              
         DC    X'00',CL12'PHASE RECS'                                           
         DC    X'06',AL1(BATTYPE)                                               
         DC    X'00',CL12'BATCH TYPE'                                           
         DC    X'07',AL1(PROVRECS)                                              
         DC    X'00',CL12'PROVER RECS'                                          
         DC    X'08',AL1(PNAMRECS)                                              
         DC    X'00',CL12'PNAME RECS'                                           
         DC    C'A',AL1(TWXLIST)                                                
         DC    X'00',CL12'TWX LIST'                                             
         DC    C'C',AL1(COMMENT)                                                
         DC    X'40',CL12'COMMENT BOOK'                                         
         DC    C'E',AL1(ERROR)                                                  
         DC    X'00',CL12'ERROR'                                                
         DC    C'F',AL1(SECURITY)                                               
         DC    X'00',CL12'SECURITY'                                             
         DC    C'H',AL1(HUT)                                                    
         DC    X'00',CL12'HUT RECORD'                                           
         DC    C'I',AL1(USERID)                                                 
         DC    X'80',CL12'USER ID'                                              
         DC    C'I',AL1(IDPASS)                                                 
         DC    X'00',CL12'ID (NUM)'                                             
         DC    C'J',AL1(JCL)                                                    
         DC    X'40',CL12'JCL BOOK'                                             
         DC    C'K',AL1(MARKET)                                                 
         DC    X'00',CL12'MARKET AUTH'                                          
         DC    C'L',AL1(LIBRARY)                                                
         DC    X'40',CL12'LIBRARY BOOK'                                         
         DC    C'M',AL1(SCRMAP)                                                 
         DC    X'00',CL12'SCREEN MAP'                                           
         DC    C'O',AL1(OUTPUT)                                                 
         DC    X'00',CL12'OUTPUT TYPE'                                          
         DC    C'P',AL1(PROFILE)                                                
         DC    X'00',CL12'PROFILE'                                              
         DC    C'T',AL1(TERMINAL)                                               
         DC    X'80',CL12'TERMINAL'                                             
         DC    C'T',AL1(TERMPASS)                                               
         DC    X'00',CL12'TERM (NUM)'                                           
         DC    C'U',AL1(USERPROF)                                               
         DC    X'00',CL12'USER PROFILE'                                         
         DC    C'V',AL1(VALUE)                                                  
         DC    X'00',CL12'VALUE RECORD'                                         
         DC    C'W',AL1(SYSLIST)                                                
         DC    X'00',CL12'SYSTEM LIST'                                          
         DC    C'X',AL1(EXTRULE)                                                
         DC    X'00',CL12'EXTRACT RULE'                                         
         DC    C'Y',AL1(FORMULA)                                                
         DC    X'00',CL12'FORMULA'                                              
         DC    C'Z',AL1(TAPECONT)                                               
         DC    X'00',CL12'TAPE CONTROL'                                         
         DC    C'B',AL1(DBOOK)                                                  
         DC    X'00',CL12'DEMO BOOK'                                            
         DC    C'D',AL1(DNAME)                                                  
         DC    X'00',CL12'DEMO NAME'                                            
         DC    C'G',AL1(DFORMULA)                                               
         DC    X'00',CL12'DEMO FORMULA'                                         
         DC    C'N',AL1(DCODE)                                                  
         DC    X'00',CL12'DEMO CODE'                                            
         DC    C'Q',AL1(DADJUST)                                                
         DC    X'00',CL12'DEMO ADJUST'                                          
         DC    C'R',AL1(DCONTROL)                                               
         DC    X'00',CL12'DEMO CONTROL'                                         
         DC    C'S',AL1(DSTATION)                                               
         DC    X'00',CL12'DEMO STATION'                                         
         DC    C'0',AL1(AUTHNAME)                                               
         DC    X'80',CL12'AUTH NAME'                                            
         DC    C'0',AL1(AUTHCODE)                                               
         DC    X'00',CL12'AUTH CODE'                                            
         DC    C'0',AL1(AUTHPASS)                                               
         DC    X'00',CL12'AUTH PASSIVE'                                         
         DC    C'1',AL1(CNAME)                                                  
         DC    X'00',CL12'COUNTRY NAME'                                         
         DC    C'2',AL1(CCODE)                                                  
         DC    X'00',CL12'COUNTRY CODE'                                         
         DC    C'3',AL1(HELPTEXT)                                               
         DC    X'00',CL12'HELP TEXT'                                            
         DC    C'4',AL1(MESSTEXT)                                               
         DC    X'00',CL12'MESSAGE TEXT'                                         
         DC    C'5',AL1(ACCESS)                                                 
         DC    X'00',CL12'ACCESS'                                               
         DC    C'6',AL1(TRAFFTWX)                                               
         DC    X'00',CL12'TRAFFIC TWX'                                          
         DC    C'7',AL1(EXCHRATE)                                               
         DC    X'00',CL12'RATE'                                                 
         DC    C'8',AL1(LOCKETS)                                                
         DC    X'00',CL12'LOCK RECS   '                                         
         DC    C'9',AL1(FAXRECS)                                                
         DC    X'00',CL12'FAX RECS    '                                         
         DC    X'FF',AL1(TRAILER)                                               
         DC    X'00',CL12'TRAILER'                                              
         DC    X'00',AL1(UNKNOWN)                                               
         DC    X'00',CL12'UNKNOWN'                                              
         DC    3X'FF'                                                           
*                                                                               
FILTAB   DC    3X'00',CL12'FILE TOTALS'                                         
         DC    3X'FF'                                                           
         EJECT                                                                  
* WORKING STORAGE FOR LOGICAL COUNTING ROUTINES                                 
*                                                                               
LGINCNT  DC    PL4'0'                                                           
LGDECNT  DC    PL4'0'                                                           
ACNTGEN  DC    A(CNTGEN)                                                        
         SPACE 1                                                                
* WORKING STORAGE FOR LIBRARY REORG                                             
*                                                                               
BOOK     DS    C                                                                
BOOKSTA  DS    C                                                                
BOOKHI   DS    C                                                                
BOOKEY   DS    CL25                                                             
BOOKIND  DS    CL256                                                            
*                                                                               
* NOTE:- ANYTHING AFTER THIS POINT SHOULD BE ADDRESSED WITH AN A-TYPE           
*                                                                               
         EJECT                                                                  
* GLOBAL WORKING STORAGE                                                        
*                                                                               
CONWORK  DS    0D                                                               
         DC    CL8'**VYTP**'                                                    
         DC    V(ISDDS)                                                         
         DC    V(ISLDDS)                                                        
         DC    A(ISREAD)                                                        
         DC    A(ISRDSEQ)                                                       
         DC    A(ISADD)                                                         
         DC    A(ISWRITE)                                                       
         DC    A(ISERASE)                                                       
         DC    V(CARDS)                                                         
         DC    V(CHOPPER)                                                       
         DC    V(CPRINT)                                                        
         DC    V(CTKEYOUT)                                                      
         DC    V(DATCON)                                                        
         DC    V(DECODE)                                                        
         DC    V(DIVIDER)                                                       
         DC    V(DUMPOUT)                                                       
         DC    V(HELLO)                                                         
         DC    V(HEXOUT)                                                        
         DC    V(LOGIO)                                                         
         DC    V(LOZENGE)                                                       
         DC    V(PRINT)                                                         
         DC    V(PRINTER)                                                       
         DC    CL8'**ADTF**'                                                    
         DC    A(CTFILE)                                                        
         DC    A(TINT)                                                          
         DC    A(TOUT)                                                          
         DC    CL8'**AIOS**'                                                    
         DC    A(IOAREA1)                                                       
         DC    A(IOAREA2)                                                       
         DC    CL8'**AELM**'                                                    
         DC    A(0)                                                             
         DC    CL8'**ARTN**'                                                    
         DC    A(FIRST)                                                         
         DC    A(PROCESS)                                                       
         DC    A(LAST)                                                          
         DC    A(0)                                                             
         DC    CL8'**DMCB**'                                                    
         DC    6F'0'                                                            
         DC    CL8'**DIN***'                                                    
         DC    A(ISOPEN)                                                        
         DC    A(IOAREA1+4)                                                     
         DC    A(0)                                                             
         DC    A(CTFILE)                                                        
         DC    A(KEY)                                                           
         DC    X'FF',AL3(TRKBUFF)                                               
         DC    CL8'**DOUT**'                                                    
         DC    A(0)                                                             
         DC    A(IOAREA1+4)                                                     
         DC    A(0)                                                             
         DC    A(CTFILE)                                                        
         DC    A(0)                                                             
         DC    A(0)                                                             
         DC    CL8'**PHCT**'                                                    
         DC    4PL4'0'                                                          
         DC    CL8'**GENS**'                                                    
         DC    2XL3'00'                                                         
         DC    CL4'DEVS'                                                        
         DC    2X'00'                                                           
         DC    CL8'**KEYS**'                                                    
KEY      DC    24XL1'00',X'01'                                                  
         DC    25XL1'FF'                                                        
         DC    CL8'**TWRK**'                                                    
         DC    CL80' '                                                          
         DC    CL40' '                                                          
         DC    2D'0'                                                            
         DC    2F'0'                                                            
         DC    2H'0'                                                            
         DC    2X'0'                                                            
         DC    CL20' '                                                          
         DC    CL8'**SWCH**'                                                    
         DC    6X'00'                                                           
         DC    CL8'**SUPV**'                                                    
         DC    A(0)                                                             
         DC    CL8' '                                                           
         DC    XL4'00'                                                          
         DC    CL8'**PWRK**'                                                    
         DS    3000C                                                            
         EJECT                                                                  
         DS    0D                                                               
         DC    CL8'**DCBS**'                                                    
TINT     DCB   DDNAME=TINT,DSORG=PS,MACRF=(GM),EODAD=LAST,             *        
               RECFM=VB,BLKSIZE=8200,LRECL=2048,BUFNO=2                         
*                                                                               
TOUT     DCB   DDNAME=TOUT,DSORG=PS,MACRF=(PM),                        *        
               RECFM=VB,BLKSIZE=8200,LRECL=2048,BUFNO=2                         
         SPACE 2                                                                
CTFILE   DMIS  KEYLEN=25,RECSIZE=V,BLKSIZE=4820,DEVICE=3380,SPARE=200, *        
               INDSIZE=2000                                                     
*                                                                               
BLDXTNT  DS    0C                                                               
         SPACE 2                                                                
         DS    0D                                                               
         DC    CL8'**I/O1**'                                                    
IOAREA1  DS    2000C                                                            
         DC    CL8'**I/O2**'                                                    
IOAREA2  DS    4000C                                                            
         DC    CL8'**TKBF**'                                                    
TRKBUFF  DS    60000C              ENOUGH FOR 3390'S                            
         EJECT                                                                  
* OTHER W/S REQUIREMENTS                                                        
*                                                                               
         DC    CL8'**BCNT**'                                                    
CNTGEN   DC    120PL4'0'                                                        
         DC    CL8'**END***'                                                    
         SPACE 2                                                                
UTL      DC    F'0'                                                             
         DC    X'0A000000'                                                      
         EJECT                                                                  
*CTCONWORKD                                                                     
       ++INCLUDE CTCONWORKD                                                     
         EJECT                                                                  
*CTGENFILE                                                                      
         PRINT OFF                                                              
       ++INCLUDE CTGENFILE                                                      
         PRINT ON                                                               
*SEACSFILE                                                                      
         PRINT OFF                                                              
       ++INCLUDE SEACSFILE                                                      
         PRINT ON                                                               
*DDDPRINT                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDDPRINT                                                       
         PRINT ON                                                               
*DMDTFIS                                                                        
         PRINT OFF                                                              
       ++INCLUDE DMDTFIS                                                        
         PRINT ON                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'004CTCONCRETX05/01/02'                                      
         END                                                                    

*          DATA SET NLPINSOR   AT LEVEL 064 AS OF 01/19/12                      
*CATALP NLPINSOR                                                                
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'PINSOR - PRINTPAK INSERTION ORDER MODULE'                       
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* SMYE  06/09   FIX HANDLING OF ADID ONLY JOB RECORDS                           
*                                                                               
* KWAN 09/14/01 "NEEDED ONLY" FOR LEGAL WARNING REVISIONS                       
*                                                                               
* KWAN 06/25/01 PRINT LEGAL WARNINGS AND QUARTERLY COMMENTS                     
*                                                                               
* KWAN 04/26/01 PRINT EMBEDDED COMMENT IN I/OCOM RECORD                         
*                                                                               
* KWAN 03/08/01 PRINT PRODUCTION HOUSE CODE, NAME AND REP FAX NUMBER            
*                                                                               
* KWAN 03/05/01 PRINT I/O COM (REC CODE X'42') AFTER STD COM                    
*                                                                               
* KWAN 02/09/01 BUY RECS ARE EXPANED TO 4000 BYTES                              
*                                                                               
* BPLA 10/00    BUG FIXED IN INSTRUCTION DISPLAY                                
*               WHEN USING THE MULTI-AD OPTION                                  
*               SOMETIMES THE WRONG INSTRUCTIONS SHOW                           
*                                                                               
* BPLA 10/00    BUG FIXED IN ADDCON                                             
*                                                                               
* BPLA 09/00    CHANGES FOR ONEEOPT (EST IN HEADLINES)                          
*               ONE ESTIMATE REQUESTS                                           
*                                                                               
* BPLA 06/00    CHANGES FOR REPEAT DATE AND PUB STORED IN ADLIST                
*                                                                               
* BPLA 06/00    NOW LIVE SOURCE (WAS NLPINSOB)                                  
*               CATALP AND ++INCLUDE T413WKA RESTORED                           
*                                                                               
* BPLA 02/00    COPY OF NLPINSOR/83 (7/15/99) MADE FEB02/00                     
*               CHANGES FOR MULTIPLE AD CODES ON THE SAME I/O                   
*                                                                               
* BPLA 07/99    NEW PROFILE OPTION ON P72A (+13) - TOTOPT                       
*               TO PRINT INSERTION ORDER TOTALS                                 
*               (WHEN SHOWING COSTS)                                            
*                                                                               
* BPLA 06/99    NEW PROFILE OPTION ON 72A PROFILE (+12)                         
*               TLFXOPT2                                                        
*               T = SHOW TELEPHONE FOR 2ND ADDRESS                              
*               F = SHOW FAX FOR 2ND ADDRESS                                    
*               B = SHOW BOTH TELEPHONE AND FAX FOR 2ND ADDRESS                 
*                                                                               
* SMYE 04/16/99 "JULJUI" CHANGED TO "JULJUL" IN DATETAB                         
*                                                                               
* BPLA 01/99    MODICATION TO LABEL OPTION - 2 ADDR OPTION                      
*               VALUE "L" MEANS TRAFFIC ADDDRESS PLUS                           
*               SHIPPING ADDRESS WITH LABEL                                     
*                                                                               
* BPLA 01/99    LABEL SHIPPING ADDRESS "SHIP MATERIALS TO:"                     
*                                                                               
* BPLA 01/99    IF LOOKING FOR SHIPPING ADDR WITH OUTDOOR                       
*               NO LONGER TRY FOR ADDR,TRA OR TRA REP                           
*               IF SHIPPING ADDRESS WAS NOT FOUND                               
*               I.E. TREAT LIKE ALL THE OTHER MEDIA (PIN8G30)                   
*               AND IN GETCONR                                                  
*               CKECK LINES MARKED "*OUT*"                                      
*                                                                               
* BPLA 11/97    NEW VALUE FOR ESTOPT "D" TO PRINT                               
*               NUMBER AND DESCRIPTION                                          
*                                                                               
* SMYE 04/97    USE CALL TO PPGETADR TO GET ADDRESSES (IN PIN8)                 
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PINSOR   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,**PINSOR,RR=R9                                                 
*                                                                               
         ST    R9,RELO                                                          
         B     *+8                                                              
RELO     DC    F'0'                                                             
*                                                                               
         L     R9,0(R1)                                                         
         USING POLWRKD,R9                                                       
         USING T413FFD,RA                                                       
         USING IOWORKD,R8                                                       
         L     RC,PPFILEC                                                       
         LA    R7,1(RC)                                                         
         LA    R7,4095(R7)                                                      
         USING POLFILED,RC,R7                                                   
         LA    R6,1(RB)                                                         
         LA    R6,4095(R6)                                                      
         USING PINSOR+4096,R6                                                   
*                                                                               
* NOTE USE OF R6 AS SECOND BASE REGISTER                                        
*                                                                               
         XC    DMCB(24),DMCB                                                    
         CLI   PBUYKEY,X'FF'       TEST EOF                                     
         BE    PIN11                                                            
         XC    ERR(2),ERR                                                       
*                                                                               
* INSURE THAT AUTO'S AND REQ'S DO NOT APPEAR ON SAME IO                         
*                                                                               
         CLC   QOPT3,QOPT3-QRECORD+SAVEQ                                        
         BE    *+8                                                              
         MVI   TSBFD-STATDIF,X'FF' FORCE BREAK                                  
         BAS   RE,SETLAST                                                       
         CLI   LASTIOEL,X'FF'      SEE IF IGNORING THIS BUY                     
         BNE   PIN2                NO                                           
         XC    LASTIOEL,LASTIOEL                                                
         B     EXIT                                                             
*                                                                               
PIN2     DS    0H                                                               
         L     R2,LASTIOEL                                                      
         USING PIOELEM,R2                                                       
*                                                                               
PIN2A    DS    0H                                                               
         XC    THISSTAT,THISSTAT                                                
         MVC   TSAGY(3),PBUYKAGY                                                
         MVC   TSCLT(6),PBUYKCLT                                                
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF DPOING MULTIPLE AD I/O                
         BE    *+10                IF SO - DON'T SET AD IN THISSTAT             
*                                                                               
         MVC   TSJOB,PBDJOB                                                     
         MVC   TSPUB,PBUYKPUB                                                   
         CLI   ZEOPT,C'Y'          IF MULTI Z/E                                 
         BNE   *+10                                                             
         XC    TSPUB+4(2),TSPUB+4  CLEAR ZONE/EDIT                              
         CLI   MULTOPT,C'Y'        MULTI INSERTS PER IO                         
         BE    *+8                 YES                                          
         MVI   TSBFD-STATDIF,X'FF' INSURE 1 INSERT PER IO                       
*                                                                               
         MVC   TSCHGSW,CHANGSW                                                  
         MVC   TSPBFREQ,PBDFREQ                                                 
         LTR   R2,R2                                                            
         BZ    PIN2B                                                            
         MVC   TSLIODAT,PIODATE                                                 
         MVC   TSLIONUM(4),PIONUM                                               
         MVI   TSLIONUM+2,0        REMOVE POSITIONAL NUMBER                     
*                                                                               
         CLI   REVOPT,C'Y'         SEE IF SUPPRESSING REASON FOR REV            
         BE    PIN2A5              MESSAGES                                     
         CLC   PBDJOB,PIOJOB                                                    
         BE    PIN2A5                                                           
         MVI   TSLJOB,C'Y'         SET JOB CHANGE IN THIS STATUS                
*                                                                               
PIN2A5   DS    0H                                                               
PIN2B    DS    0H                                                               
         CLI   LASTSTAT,0                                                       
         BE    PIN2D                                                            
*                                                                               
* TEST SAME A/M/C/P/JOB/PUB/                                                    
*                                                                               
         CLC   TSAGY(21),TSAGY-STATDIF                                          
         BNE   PIN11               NO - FINISH LAST IO NOW                      
*                                                                               
         L     R4,BUYDALST                                                      
         L     RE,ABUYMAX          LAST POSSIBLE ADDRESS                        
         CR    R4,RE                                                            
         BL    PIN2D                                                            
         B     PIN11               TOO MANY BUYS FOR ONE I/O                    
*                                                                               
PIN2D    DS    0H                  MUST FINISH LAST I/O NOW                     
*                                                                               
* TRY SETTING DICTIONARY HERE USING PUBLANG                                     
*                                                                               
         L     R5,=V(DICSECTP)                                                  
         A     R5,RELO                                                          
         USING DICSECTP,R5                                                      
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVI   DDLANG,0            DEFAULT TO ENGLISH                           
         CLI   PUBLANG,C'F'                                                     
         BNE   *+8                                                              
         MVI   DDLANG,4            4 IS FRENCH                                  
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
         GOTO1 CDICTATE                                                         
         DROP  R1,RF                                                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),PBDJOB                                                 
         CLC   PJOBKEY,KEY         CHECK ALREADY HAVE                           
         BE    PIN4                                                             
         BRAS  RE,RDPRT                                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
         LA    R0,PJOBREC                                                       
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN4     DS    0H                                                               
         CLC   PJOBCAP1(8),=C'INACTIVE'                                         
         BNE   PIN4B                                                            
         CLC   QPROG,=C'73'        DO 'INACTIVES' FOR PPROOF RUN                
         BE    PIN4B                                                            
*                                  BYPASS 'INACTIVE' BUYS                       
         CLI   BUYSW,C'F'                                                       
         BNE   PIN11               FINISH LAST IO NOW                           
         XC    LASTSTAT,LASTSTAT   PREVENT REPEAT OF END                        
         MVI   BUYSW,0                                                          
         B     EXIT                                                             
*                                  GET INS REC                                  
PIN4B    DS    0H                                                               
         MVC   KEY+16(6),PBUYKPUB                                               
         CLI   ZEOPT,C'Y'          IF MULTI ZONE/EDIT                           
         BNE   *+10                                                             
         XC    KEY+20(2),KEY+20    USE ONLY BASE PUB                            
         CLC   KEY(25),PINSREC     ALREADY HAVE                                 
         BE    PIN5B                                                            
         BRAS  RE,HIPRT                                                         
         BRAS  RE,TSTERR                                                        
         TM    KEY+25,X'80'        SEE IF DELETED                               
         BNZ   PIN4C                                                            
         CLC   KEY(22),KEYSAVE                                                  
         BE    PIN5                                                             
*                                                                               
PIN4C    DS    0H                                                               
         MVC   KEYSAVE+16(6),=6X'FF'                                            
         CLC   KEY(22),KEYSAVE     TEST HAVE FF DEFAULT                         
         BE    PIN5                                                             
         MVC   KEY,KEYSAVE                                                      
         BRAS  RE,RDPRT                                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN5     DS    0H                                                               
         CLC   KEY(25),PINSREC                                                  
         BE    PIN5B               ALREADY HAVE                                 
         LA    R0,PINSREC                                                       
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN5B    DS    0H                                                               
         LA    RE,SPACEND                                                       
         LA    RF,1600                                                          
         XCEF                                                                   
*                                                                               
         LA    R0,11               SET AT LEAST 11 LINES TO PRINT               
         LA    R1,SPACEND                                                       
         MVI   0(R1),C' '                                                       
         LA    R1,80(R1)                                                        
         BCT   R0,*-8                                                           
*                                                                               
         CLI   CHANGSW,C'C'                                                     
         BNE   PIN5D                                                            
*                                                                               
* BUILD LIST OF REASONS FOR CHANGE IN SPACEND                                   
* AND SET CHANGE STATUS FIELDS                                                  
*                                                                               
         OC    LASTIOEL,LASTIOEL                                                
         BZ    PIN5D                                                            
         GOTO1 ABLDREV,DMCB,LASTIOEL                                            
*                                                                               
PIN5D    DS    0H                                                               
         CLI   BUYSW,C'F'                                                       
         BE    PIN6                                                             
         CLC   THISSTAT,LASTSTAT                                                
         BNE   PIN11               FINISH LAST IO                               
         B     PIN10               CONTINUE SAME I.O.                           
*                                                                               
PIN6     DS    0H                  FIND AND SAVE CLT VEN NO.                    
         XC    SVCVNUM,SVCVNUM                                                  
         LA    RE,ESTLIST                                                       
         LHI   RF,400                                                           
         XCEF                                                                   
*                                                                               
         L     RE,AADLIST          CLEAR AD LIST (CAN HOLD 200 ADS)             
         LHI   RF,3216             WAS 1206                                     
         XCEF                                                                   
*                                                                               
         XC    IOCNTS,IOCNTS       CLEAR I/O COUNTERS                           
*                                                                               
         LA    RE,CONTAB           BUY COUNT GROSS AND NET                      
         LHI   RF,400                                                           
         XCEF                                                                   
*                                                                               
         LA    R2,PUBREC+33                                                     
         MVI   ELCODE,X'14'                                                     
PIN6B    BRAS  RE,NXTEL                                                         
         BNE   PIN6C                                                            
         CLC   2(3,R2),PCLTKCLT                                                 
         BNE   PIN6B                                                            
         CLI   17(R2),X'99'                                                     
         BNH   PIN6C               COULD BE A PUB NUMBER                        
         MVC   SVCVNUM,17(R2)                                                   
*                                                                               
PIN6C    DS    0H                                                               
         MVC   SVRPTDT,QRPTDAT     SAVE REQ RPT DATE                            
*                                                                               
         MVC   SVFRSTDT,PBUYKDAT                                                
         MVI   FORCEHED,C'Y'                                                    
         MVI   FORCEFUT,C'N'                                                    
         MVC   PAGE,=H'1'                                                       
*                                                                               
         CLI   CHANGSW,0                                                        
         BE    PIN6D                                                            
*                                  REVISION OR DELETE                           
*-->     MVC   P+1(07),=C'REVISES'                                              
         MVC   P+1(L'PP@REVIE),PP@REVIE                                         
         CLI   CHANGSW,C'C'                                                     
         BE    *+10                                                             
*--->    MVC   P+1(07),=C'CANCELS'                                              
         MVC   P+1(L'PP@CAN),PP@CAN                                             
*--->    MVC   P+09(09),=C'ORDER NO.'                                           
         MVC   P+09(L'PP@ORDNO),PP@ORDNO                                        
         MVC   P+19(1),PAGYKMED                                                 
         MVI   P+20,C'-'                                                        
*                                                                               
         L     R2,LASTIOEL                                                      
         USING PIOELEM,R2                                                       
         GOTO1 DATCON,DMCB,(3,PIODATE),(0,WORK)                                 
         MVC   P+21(5),WORK+1                                                   
         MVI   P+26,C'-'                                                        
         MVC   HALF,PIONUM                                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+27(4),DUB                                                      
*                                                                               
         LA    R1,PSECOND                                                       
         MVC   1(17,R1),DASHES                                                  
*--->    MVC   19(05,R1),=C'DATED'                                              
         MVC   19(L'PP@DATED,R1),PP@DATED                                       
*                                                                               
         GOTO1  DATCON,DMCB,(0,WORK),(5,WORK)                                   
*                                                                               
         CLI   PUBLANG,C'F'        SEE IF FRENCH                                
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
*                                                                               
         LA    R1,PSECOND                                                       
         MVC   26(08,R1),WORK                                                   
         DROP  R2                                                               
         B     PIN7                                                             
*                                  ORIGINAL ORDER                               
PIN6D    DS    0H                                                               
*--->    MVC   P+1(13),=C'PLEASE INSERT'                                        
         MVC   P+1(L'PP@IOP1),PP@IOP1                                           
         CLI   QMEDIA,C'O'                                                      
         BNE   PIN6E                                                            
         MVC   P+1(L'PP@IOP1),SPACES                                            
*--->    MVC   P+8(6),=C'POST  '                                                
         MVC   P+1(L'PP@IOP2),PP@IOP2                                           
         CLI   PBUYKEY+15,C'P'     TEST PAINT                                   
         BNE   PIN6E               NO                                           
         MVC   P+1(L'PP@IOP2),SPACES                                            
*--->    MVC   P+8(6),=C'PAINT '                                                
         MVC   P+1(L'PP@IOP3),PP@IOP3                                           
*                                                                               
PIN6E    DS    0H                                                               
*--->    MVC   PSECOND+1(15),=C'ADVERTISING OF-'                                
         MVC   PSECOND+1(L'PP@IOP4),PP@IOP4                                     
*                                                                               
PIN7     DS    0H                                                               
PIN7F    DS    0H                                                               
         MVI   SPACING,1                                                        
         GOTO1 AIOPRNT                                                          
         CLI   CHANGSW,0                                                        
         BNE   PIN8                                                             
         LA    R1,SPACEND                                                       
         LA    R1,83(R1)                                                        
*--->    MVC   00(06,R1),=C'CLIENT'                                             
         MVC   00(L'PP@CLI,R1),PP@CLI                                           
         MVC   09(03,R1),PCLTKCLT                                               
         MVC   13(20,R1),PCLTNAME                                               
*--->    MVC   80(07,R1),=C'PRODUCT'                                            
         MVC   80(L'PP@PRO,R1),PP@PRO                                           
         MVC   89(03,R1),PPRDKPRD                                               
         MVC   93(20,R1),PPRDNAME                                               
*                                                                               
         CLI   ONEEOPT,C'Y'                                                     
         BNE   PIN8                                                             
         CLC   PRQEST,=C'ALL'      SEE IF ONE ESTIMATE                          
         BE    PIN8                                                             
         MVC   160(08,R1),=C'ESTIMATE'                                          
         MVC   169(03,R1),PRQEST                                                
         MVC   173(20,R1),PESTNAME                                              
         MVC   253(20,R1),PESTNAM2                                              
*                                                                               
PIN8     DS    0H                  PUB/REP ADDRESS                              
         LA    R1,SPACEND                                                       
         LA    R1,45(R1)           1ST LINE, POS 46                             
*                                                                               
         MVI   ADR2SW,C'N'         CLEAR 2ND ADDRESS SWITCH                     
*                                                                               
         MVC   BYTE,PREPKEY        SAVE FIRST BYTE OF PREPKEY                   
*                                                                               
         CLI   PREPKEY,0           CHECK FOR REP OR ADDR,TRA                    
         BNE   PIN8F               IF FOUND DO FIRST                            
*                                                                               
PIN8A    MVC   000(20,R1),PUBNAME                                               
         MVC   080(20,R1),PUBZNAME                                              
         CLI   PUBZNAME,C' '                                                    
         BNH   *+8                                                              
         LA    R1,80(R1)                                                        
         MVC   080(30,R1),PUBLINE1                                              
         MVC   160(30,R1),PUBLINE2                                              
         MVI   240(R1),C' '                                                     
         LA    R2,PUBREC+33                                                     
         CLI   0(R2),X'11'                                                      
         BE    PIN8B                                                            
         MVI   ELCODE,X'11'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN8B5                                                           
*                                                                               
PIN8B    DS    0H                                                               
         USING PUBSADEL,R2                                                      
         OC    PUBATTN,SPACES                                                   
         CLC   PUBATTN,SPACES                                                   
         BE    PIN8B5                                                           
*                                                                               
         XC    80(30,R1),80(R1)    CLEAR PUBLINE 1+2                            
         XC    160(30,R1),160(R1)  AND PRINT AFTER ATTN:                        
         MVC   80(5,R1),=C'ATTN-'                                               
         MVC   86(24,R1),PUBATTN                                                
         MVC   160(30,R1),PUBLINE1                                              
         MVC   240(30,R1),PUBLINE2                                              
*                                                                               
         MVI   320(R1),C' '        SO I WON'T ABUT INSERTION HEADS              
*                                                                               
* SEE IF ONLY DOING PUB - NO REP OR OTHER ADDRESS                               
*                                                                               
PIN8B5   DS    0H                                                               
         CLI   ADR2SW,C'Y'         (BYTE WILL BE 0)                             
         BNE   PIN8G               DONE - ALREADY HAVE BEEN PRINTED             
*                                                                               
         CLI   0(R2),X'11'         MUST HAVE FOUND PUBSADEL                     
         BNE   PIN8G               NO-DONE                                      
         CLI   TLFXOPT2,C'T'       TELEPHONE OF 2ND ADDRESS?                    
         BE    PIN8B6                                                           
         CLI   TLFXOPT2,C'B'       OR TEL AND FAX OF 2ND ADDDRESS?              
         BE    PIN8B6                                                           
         B     PIN8B8                                                           
*                                                                               
PIN8B6   OC    PUBTEL,SPACES                                                    
         CLC   PUBTEL,SPACES       SEE IF I HAVE ONE                            
         BE    PIN8B8                                                           
         MVC   400(3,R1),=C'TEL'                                                
         MVC   400+4(L'PUBTEL,R1),PUBTEL                                        
*                                                                               
PIN8B8   CLI   TLFXOPT2,C'F'       FAX OF 2ND ADDRESS                           
         BE    PIN8B9                                                           
         CLI   TLFXOPT2,C'B'       OR TELEPHONE AND FAX                         
         BNE   PIN8B9X             NO - THEN DONE                               
*                                                                               
PIN8B9   OC    PUBSFAXN,SPACES                                                  
         CLC   PUBSFAXN,SPACES     SEE IF I HAVE A FAX                          
         BE    PIN8B9X             NO - THEN DONE                               
         MVC   400+L'PUBTEL+6(3,R1),=C'FAX'                                     
         MVC   400+L'PUBTEL+10(L'PUBSFAXN,R1),PUBSFAXN                          
*                                                                               
PIN8B9X  MVI   480(R1),C' '                                                     
         B     PIN8G                                                            
         DROP  R2                                                               
*                                                                               
PIN8F    DS    0H                  USE REP                                      
         MVC   000(30,R1),PREPNAME                                              
         MVC   080(30,R1),PREPLIN1                                              
         MVC   160(30,R1),PREPLIN2                                              
         OC    PREPATTN,SPACES                                                  
         CLC   PREPATTN,SPACES                                                  
         BE    PIN8F5                                                           
*                                                                               
         XC    80(30,R1),80(R1)    CLEAR PREPLIN1 + 2                           
         XC    160(30,R1),160(R1)  PRINT AFTER ATTN:                            
         MVC   80(5,R1),=C'ATTN-'                                               
         MVC   86(20,R1),PREPATTN                                               
         MVC   160(30,R1),PREPLIN1                                              
         MVC   240(30,R1),PREPLIN2                                              
*                                                                               
PIN8F5   DS    0H                                                               
PIN8G    DS    0H                                                               
         MVI   ADR2SW,C'Y'         SET DOING 2ND ADDRESS                        
*                                                                               
         CLI   ADDROPT,C'S'        SEE IF DOING TRA AND SHIP                    
         BE    PIN8G10                                                          
         CLI   ADDROPT,C'L'        SEE IF DOING TRA AND SHIP + LABEL            
         BE    PIN8G10                                                          
*                                                                               
         CLI   ADDROPT,C'C'        SEE IF DOING TRA AND CONTRACT                
         BE    GETCONR             REP                                          
*                                                                               
         CLI   ADDROPT,C'2'        MEANS SHIPPING AND PUB                       
         BE    PIN8G3                                                           
*                                                                               
         CLI   ADDROPT,C'Y'        SEE IF DOING PUB ADD ALSO                    
         BNE   PIN8I               NO                                           
PIN8G3   CLI   PREPKEY,0           SEE IF I JUST DID REP OR ADDR,TRA            
         BE    PIN8H               NO - THEN DONE                               
*                                                                               
PIN8G5   OI    240(R1),C' '        SKIP 3 LINES TO GET OUT OF WINDOW            
         MVI   320(R1),C' '                                                     
         MVI   400(R1),C' '                                                     
         LA    R1,480(R1)                                                       
         MVI   PREPKEY,0                                                        
         B     PIN8A               GO DO PUB NAME                               
*                                                                               
PIN8G10  DS    0H                  SEARCH FOR SHIPPING ADDRESS                  
         MVI   ADRTYP,C'S'         TRY FOR AOV ADDRESS                          
         MVC   CLTAGY,PUBKAGY      AGY                                          
         MVC   CLTMED,QMEDIA       MED                                          
         MVC   CLTCODE,PCLTKCLT    CLIENT CODE                                  
         MVC   CLTOFF,PCLTOFF      CLIENT OFFICE                                
*                                                                               
         ST    R1,WORD             SAVE PRINT O/P POINTER                       
*                                                                               
         GOTO1 APPGETAD,DMCB,(ADRTYP,CLTDATA),PUBREC,VDATAMGR                   
         LR    RE,R1                                                            
         L     R1,WORD             RESTORE PRINT O/P POINTER                    
*                                                                               
         CLI   0(RE),X'FF'         ERROR IN CALL ?                              
         BNE   *+6                 NO                                           
         DC    H'0'                                                             
*                                                                               
         CLI   0(RE),0             ADDRESS RECORD FOUND ?                       
         BE    PIN8G30             NO                                           
*                                                                               
         MVC   WORK+3(4),0(RE)     "RESULT"/ADDRESS LEVEL (2-4)                 
         L     R2,4(RE)            A(ADDRESS INFO FROM CALL)                    
         ST    R2,FULL             SAVE A(ADDRESS)                              
*                                                                               
         CLI   WORK+3,X'0B'        SEE IF SHIPPING ADDRESS                      
         BNE   PIN8G30             NO                                           
*                                                                               
PIN8G25  DS    0H                                                               
         USING PGETADRD,R2                                                      
         OI    240(R1),C' '        SKIP 3 LINES TO GET OUT OF WINDOW            
         MVI   320(R1),C' '                                                     
         MVI   400(R1),C' '                                                     
*                                                                               
         CLI   ADDROPT,C'L'        LABEL WITH SHIP ADDR?                        
         BNE   PIN8G29                                                          
*                                                                               
         LA    RE,449(R1)                                                       
         OC    0(18,RE),0(RE)      SOMETHING THERE?                             
         BZ    PIN8G27                                                          
         LA    RE,80(RE)                                                        
         OC    0(18,RE),0(RE)      SOMETHING THERE?                             
         BZ    PIN8G27                                                          
         LA    RE,80(RE)                                                        
         OC    0(18,RE),0(RE)      SOMETHING THERE?                             
         BNZ   PIN8G29             ONLY TRY 3 LINES                             
*                                                                               
* IF I STILL CAN'T PRINT IT JUST SKIP PRINTING LABEL                            
*                                                                               
PIN8G27  MVC   1(18,RE),=C'SHIP MATERIALS TO:'                                  
         CLI   PUBLANG,C'F'        SEE IF FRENCH PUB                            
         BNE   *+10                                                             
         MVC   1(22,RE),=C'ENVOYEZ LE MATERIEL A:'                              
*                                                                               
PIN8G29  LA    R1,480(R1)           PRINT ADDRESS                               
         MVC   000(30,R1),PGADNAME                                              
         MVC   080(30,R1),PGADLIN1                                              
         MVC   160(30,R1),PGADLIN2                                              
         MVI   240(R1),C' '                                                     
         OC    PGADATTN,SPACES                                                  
         CLC   PGADATTN,SPACES                                                  
         BE    PN8G4                                                            
         XC    80(30,R1),80(R1)                                                 
         XC    160(30,R1),160(R1)  PRINT AFTER ATTN:                            
         MVC   80(5,R1),=C'ATTN-'                                               
         MVC   86(20,R1),PGADATTN                                               
         MVC   160(30,R1),PGADLIN1                                              
         MVC   240(30,R1),PGADLIN2                                              
         MVI   320(R1),C' '                                                     
*                                                                               
PN8G4    CLI   ADR2SW,C'Y'         SECOND ADDRESS?                              
         BNE   PIN8I                                                            
         CLI   TLFXOPT2,C' '                                                    
         BNH   PIN8I               TEL/FAX FROM 2ND ADDR?                       
         MVI   320(R1),C' '        SKIP A LINE                                  
         CLI   TLFXOPT2,C'T'       TELEPHONE ONLY-2ND ADDRESS                   
         BE    PN8G6                                                            
         CLI   TLFXOPT2,C'B'       OR TELEPHONE AND FAX                         
         BE    PN8G6                                                            
         B     PN8G8                                                            
*                                                                               
PN8G6    MVC   400(3,R1),=C'TEL'                                                
         MVC   400+4(L'PGADTEL,R1),PGADTEL                                      
PN8G8    DS    0H                                                               
         CLI   TLFXOPT2,C'F'       FAX ONLY- 2ND ADDRESS                        
         BE    PN8G9                                                            
         CLI   TLFXOPT2,C'B'       OR FAX AND TELEPHONE                         
         BNE   PN8G9X              NO - DONE                                    
PN8G9    CLC   PGADFAX,SPACES                                                   
         BNH   PN8G9X              NO FAX THEN DONE                             
         MVC   400+L'PGADTEL+6(3,R1),=C'FAX'                                    
         MVC   400+L'PGADTEL+10(L'PGADFAX,R1),PGADFAX                           
*                                                                               
PN8G9X   MVI   480(R1),C' '                                                     
         B     PIN8I                                                            
         DROP  R2                                                               
*                                                                               
PIN8G30  DS    0H                  NO SHIPPING ADDRESS FOUND -                  
         EJECT                                                                  
*                                                                               
GETCONR  DS    0H                  FIND AND PRINT CONTRACT REP                  
         B     GETC5               (ADDROPT = C)                                
*                                                                               
GETC5    DS    0H                  TRY FOR REP                                  
         MVI   ELCODE,X'14'                                                     
         LA    R2,PUBREC+33                                                     
*                                                                               
GETC27B  DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   PIN8I                                                            
         USING PUBREPEL,R2                                                      
         CLC   PUBRPOFF,=3X'FF'                                                 
         BE    GETC27D                                                          
         CLC   PUBRPOFF,PCLTKCLT                                                
         BE    GETC27D                                                          
         CLI   PUBRPOFF,X'FF'                                                   
         BNE   GETC27B                                                          
         CLC   PUBRPOFF+1(1),PCLTOFF                                            
         BNE   GETC27B                                                          
*                                                                               
GETC27D  DS    0H                                                               
*                                                                               
* TEST ANY OVERRIDES                                                            
*                                                                               
GETC27G  OC    PUBPAREP(12),PUBPAREP                                            
         BZ    GETC27B                                                          
         LA    RF,PUBCNREP                                                      
         OC    0(4,RF),0(RF)       CHK FOR CON REP                              
         BZ    PIN8I               NONE                                         
*                                                                               
         XC    WORK(32),WORK                                                    
         MVC   WORK(2),PUBKAGY                                                  
         MVC   WORK+2(1),PRQMED                                                 
         MVI   WORK+3,X'11'                                                     
         MVC   WORK+4(4),0(RF)                                                  
         CLC   WORK(25),PREPKEY                                                 
         BE    GETC30                                                           
         MVC   KEY,WORK                                                         
         BRAS  RE,HIPRT                                                         
         CLC   KEY(8),KEYSAVE                                                   
         BNE   PIN8I               REP NOT FOUND                                
*                                                                               
         LA    R0,PREPREC                                                       
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         B     GETC30                                                           
*                                                                               
GETC30   DS    0H                                                               
         OI    240(R1),C' '        SKIP 3 LINES TO GET OUT OF WINDOW            
         MVI   320(R1),C' '                                                     
         MVI   400(R1),C' '                                                     
         LA    R1,480(R1)                                                       
*                                                                               
         MVC   000(30,R1),PREPNAME                                              
         MVC   080(30,R1),PREPLIN1                                              
         MVC   160(30,R1),PREPLIN2                                              
         MVI   240(R1),C' '                                                     
         CLI   PREPATTN,0                                                       
         BE    GETC30X                                                          
         CLI   PREPATTN,C' '                                                    
         BE    GETC30X                                                          
*                                                                               
* ATTENTION NOW BEFORE ADDRESS, SO ZIP WILL BE IN LAST LINE                     
*                                                                               
         XC    080(30,R1),080(R1)                                               
         XC    160(30,R1),160(R1)                                               
         MVC   080(5,R1),=C'ATTN-'                                              
         MVC   086(20,R1),PREPATTN                                              
         MVC   160(30,R1),PREPLIN1                                              
         MVC   240(30,R1),PREPLIN2                                              
         MVI   320(R1),C' '                                                     
*                                                                               
GETC30X  DS    0H                                                               
         CLI   TLFXOPT2,C' '                                                    
         BNH   PIN8I                                                            
         CLI   TLFXOPT2,C'N'                                                    
         BE    PIN8I                                                            
         CLI   TLFXOPT2,C'T'       TELEPHONE FOR 2ND ADDRESS                    
         BE    GETC40                                                           
         CLI   TLFXOPT2,C'B'       OR BOTH TELEPHONE AND FAX                    
         BE    GETC40                                                           
         B     GETC50                                                           
*                                                                               
GETC40   OC    PREPTEL,SPACES                                                   
         CLC   PREPTEL,SPACES      SEE IF THERE                                 
         BE    GETC50                                                           
         MVC   400(3,R1),=C'TEL'                                                
         MVC   400+4(L'PREPTEL,R1),PREPTEL                                      
*                                                                               
GETC50   CLI   TLFXOPT2,C'F'       FAX FOR 2ND ADDRESS                          
         BE    GETC60                                                           
         CLI   TLFXOPT2,C'B'       OR BOTH TELEPHONE AND FAX                    
         BE    GETC60                                                           
         B     GETC70                                                           
*                                                                               
GETC60   OC    PREPFAX,SPACES                                                   
         CLC   PREPFAX,SPACES      SEE IF THERE                                 
         BE    GETC70                                                           
         MVC   400+L'PREPTEL+6(3,R1),=C'FAX'                                    
         MVC   400+L'PREPTEL+10(L'PREPFAX,R1),PREPFAX                           
*                                                                               
GETC70   MVI   480(R1),C' '                                                     
         B     PIN8I                                                            
*                                                                               
PIN8H    DS    0H                  GET HERE IF ADDROPT WAS 2 OR Y               
*                                                                               
* FIRST BYTE OF REP MAY HAVE BEEN SET TO 0 AT PIN8G5                            
*                                                                               
         MVC   PREPKEY(1),BYTE     RESTORE                                      
*                                                                               
PIN8I    LA    R3,SPACEND          PRINT REASONS + ADDRESS                      
*                                                                               
PIN8J    DS    0H                                                               
         OC    0(80,R3),0(R3)                                                   
         BZ    PIN9                                                             
         MVC   P(80),0(R3)                                                      
         GOTO1 AIOPRNT                                                          
         LA    R3,80(R3)                                                        
         B     PIN8J                                                            
*                                                                               
PIN9     DS    0H                  FIRST BUY ON I.O.                            
         LA    R2,PINSREC+33                                                    
         MVI   BUYSW,0                                                          
         MVI   MATSW,0                                                          
         XC    BRPTDAT,BRPTDAT                                                  
         XC    RPTPUB,RPTPUB       ALSO CLEAR REPEAT PUB                        
         MVI   ELCODE,X'66'                                                     
         CLI   0(R2),X'66'                                                      
         BE    PIN9D                                                            
*                                                                               
PIN9B    DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   PIN9F                                                            
*                                                                               
PIN9D    DS    0H                                                               
         CLC   =C'//INSERTION//',2(R2)                                          
         BE    PIN9H               DO BUY LATER                                 
         B     PIN9B                                                            
*                                  DO BUY NOW                                   
PIN9F    DS    0H                                                               
         GOTO1 AFMTBUY                                                          
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD OPTION IS ON                 
         BNE   *+8                                                              
         BAS   RE,ADDADS           IF SO - ADD TO TABLE OF AD CODES             
*                                                                               
         BAS   RE,ADDDOLS                                                       
         BAS   RE,ADDESTN          ADD EST TO TABLE                             
         BAS   RE,ADDCON           ADD CONTRACT TO TABLE                        
         B     PIN30                                                            
*                                                                               
PIN9H    DS    0H                                                               
         MVI   BUYSW,C'M'          BUY PRINT BETWEEN COMMENTS                   
         MVI   SPACING,2                                                        
         GOTO1 AIOPRNT                                                          
*                                  START ON COMMENTS                            
         LA    R2,PINSREC+33                                                    
         CLI   0(R2),X'66'                                                      
         BE    PIN9M                                                            
*                                                                               
PIN9K    DS    0H                                                               
         MVI   ELCODE,X'66'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN30               DONE                                         
*                                                                               
PIN9M    DS    0H                                                               
         CLC   =C'//INSERTION//',2(R2)                                          
         BNE   PIN9R                                                            
         MVI   SPACING,2                                                        
         GOTO1 AIOPRNT                                                          
*                                                                               
         GOTO1 AFMTBUY                                                          
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD OPTION IS ON                 
         BNE   *+8                                                              
         BAS   RE,ADDADS           IF SO - ADD TO TABLE OF AD CODES             
*                                                                               
         BAS   RE,ADDDOLS                                                       
         BAS   RE,ADDESTN                                                       
         BAS   RE,ADDCON                                                        
         B     PIN30                                                            
*                                                                               
PIN9R    DS    0H                                                               
         CLC   =C'COM=',2(R2)                                                   
         BNE   PIN9T                                                            
         GOTO1 ASTDCOM,DMCB,(R2)                                                
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN9K                                                            
*                                                                               
PIN9T    DS    0H                                                               
         GOTO1 ACOMLIN,DMCB,(R2)                                                
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN9K                                                            
*                                                                               
PIN10    DS    0H                  CONTINUATION BUY ON I.O.                     
         GOTO1 AFMTBUY                                                          
*                                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD OPTION IS ON                 
         BNE   *+8                                                              
         BAS   RE,ADDADS           IF SO - ADD TO TABLE OF AD CODES             
*                                                                               
         BAS   RE,ADDDOLS                                                       
         BAS   RE,ADDESTN          ADD TO ESTIMATE TABLE                        
         BAS   RE,ADDCON                                                        
         B     PIN30                                                            
*                                                                               
PIN11    DS    0H                  FINISH I.O.                                  
         L     R5,=V(DICSECTP)     SET DATA DICTIONARY USING SVLANG             
         A     R5,RELO                                                          
         USING DICSECTP,R5                                                      
         XC    DMCB,DMCB                                                        
         LA    R1,DMCB                                                          
         USING DICTATED,R1                                                      
         MVI   DDACTN,DDACTNL      TRANSLATE LIST                               
         MVI   DDRETN,DDCASEU                                                   
         MVI   DDSYS,4                                                          
         MVI   DDLANG,0            DEFAULT TO ENGLISH                           
         CLI   SVLANG,C'F'                                                      
         BNE   *+8                                                              
         MVI   DDLANG,4            4 IS FRENCH                                  
         LA    RF,DCLIST                                                        
         STCM  RF,7,DDIADR                                                      
         LA    RF,DSLIST                                                        
         STCM  RF,7,DDOADR                                                      
         L     RF,VCOMFACS                                                      
         USING COMFACSD,RF                                                      
         GOTO1 CDICTATE                                                         
         DROP  R1,RF                                                            
         CLI   LASTSTAT,0                                                       
         BE    PIN25                                                            
         MVI   SPACING,2                                                        
         GOTO1 AIOPRNT                                                          
*                                                                               
         CLI   OLDOPT,C'Y'         TEST OLD FMT - NO MSGS HERE                  
         BE    PIN12                                                            
         CLI   TSCHGSW-STATDIF,0                                                
         BE    PIN12                                                            
*--->    MVC   P+5(28),=C'** THIS IS A CHANGE ORDER **'                         
         MVC   P+5(L'PP@IOP5),PP@IOP5                                           
*--->    MVC   PSECOND+18(6),DASHES                                             
*                                                                               
         CLI   SVLANG,C'F'         IF FRENCH - NO UNDERLINING                   
         BE    *+10                                                             
         MVC   PSECOND+18(6),DASHES                                             
         CLI   TSCHGSW-STATDIF,C'C'                                             
         BE    PIN11C                                                           
*--->    MVC   P+18(21),=C'CANCELLATION ORDER **'                               
         MVC   P+5(L'PP@IOP6),PP@IOP6                                           
*--->    MVC   PSECOND+18(12),DASHES                                            
*                                                                               
         CLI   SVLANG,C'F'         IF FRENCH - NO UNDERLINING                   
         BE    *+10                                                             
         MVC   PSECOND+18(12),DASHES                                            
*                                                                               
PIN11C   DS    0H                                                               
         MVI   SPACING,2                                                        
         GOTO1 AIOPRNT                                                          
*                                                                               
         CLI   TSLIONUM+3-STATDIF,1                                             
         BNH   PIN12                                                            
         L     RF,BUYDALST                                                      
         LA    R0,BUYDALST+4                                                    
         SR    RF,R0                                                            
         SRL   RF,2                                                             
         STC   RF,BYTE                                                          
         CLC   BYTE,TSLIONUM+3-STATDIF                                          
         BE    PIN12                                                            
*                                                                               
* MESSAGE ABOUT PARTIAL CHANGES/CANCELS                                         
*                                                                               
         MVC   W,SPACES                                                         
*--->    MVC   W(17),=C'NOTE- THIS CHANGE'                                      
*--->    LA    R3,W+18                                                          
*--->    CLI   TSCHGSW-STATDIF,C'C'                                             
*--->    BE    *+14                                                             
*--->    MVC   W+11(12),=C'CANCELLATION'                                        
*--->    LA    R3,W+24                                                          
*--->    MVC   0(18,R3),=C'ORDER AFFECTS ONLY'                                  
*--->    LA    R3,19(R3)                                                        
*                                                                               
         MVC   W(L'PP@IOP7),PP@IOP7                                             
         LA    R3,W+L'PP@IOP7+1                                                 
         CLI   TSCHGSW-STATDIF,C'C'                                             
         BE    *+14                                                             
         MVC   W(L'PP@IOP8),PP@IOP8                                             
         LA    R3,W+L'PP@IOP8+1                                                 
*                                                                               
PIN11C5  CLI   0(R3),C' '          SCAN BACKWARD FOR LAST LETTER                
         BH    *+8                                                              
         BCT   R3,PIN11C5                                                       
*                                                                               
         LA    R3,2(R3)            THEN BUMP 2 SPACES                           
         ZIC   RF,BYTE                                                          
         BAS   RE,EDLEFT                                                        
         AR    R3,R0                                                            
*--->    MVC   1(6,R3),=C'OF THE'                                               
         MVC   1(L'PP@OFTHE,R3),PP@OFTHE                                        
         LA    R3,8(R3)                                                         
         CLI   SVLANG,C'F'         SEE IF FRENCH                                
         BNE   *+8                                                              
         AHI   R3,-3               BACKUP 3 CHARS SINCE FRENCH IS "DES"         
*                                                                               
         IC    RF,TSLIONUM+3-STATDIF                                            
         BAS   RE,EDLEFT                                                        
         MVC   P+5(80),W                                                        
         MVC   W,SPACES                                                         
*--->    MVC   PSECOND+11(32),=C'INSERTIONS ON THE ORIGINAL ORDER'              
         MVC   PSECOND+11(L'PP@IOP9),PP@IOP9                                    
         MVI   SPACING,2                                                        
         GOTO1 AIOPRNT                                                          
*                                                                               
PIN12    DS    0H                                                               
         MVI   HPSW,1              SET DEFAULT TO INS HDR ALREADY PRNTD         
         CLI   MULTIAD,C'Y'                                                     
         BNE   PIN12A5                                                          
*                                                                               
         B     PIN12A                                                           
*                                                                               
PIN12A   DS    0H                                                               
         MVI   MATSW,0             MUST RESET                                   
         BRAS  RE,GETPINS          GET INSTRUCTIONS FOR NEXT AD                 
         CLC   MATJOB,=6X'FF'      LAST AD?                                     
         BE    PIN12J2             WILL HAVE SKIPPED A LINE                     
*                                                                               
         MVI   HPSW,0                                                           
*                                                                               
         L     RE,AADLIST                                                       
         OC    17(6,RE),17(RE)     SEE IF ONLY ONE AD                           
         BZ    PIN12A5             YES -THEN SKIP THIS MESSAGE                  
*                                                                               
         CLI   SVLANG,C'F'         SEE IF FRENCH I/O                            
         BNE   PIN12A3                                                          
*                                                                               
         MVC   P+10(40),=C'**CES INSTRUCTIONS SONT POR NO.D''ANNONCE'           
         MVC   P+51(6),MATJOB      GETPINS RETURNS CODE IN MATJOB               
*                                                                               
         CLI   MATJOB,X'FF'        ADID ONLY JOB RECORD ?                       
         BNE   PIN12A2             NO                                           
         BRAS  RE,ADIDGET          GET THE ADID CODE                            
         MVC   P+51(12),WORK       ADIDGET RETURNS CODE IN WORK                 
*                                                                               
PIN12A2  DS    0H                                                               
         MVC   P+63(2),=C'**'                                                   
         B     PIN12A5                                                          
                                                                                
PIN12A3  MVC   P+10(32),=C'**THESE INSTRUCTIONS APPLY TO AD'                    
         MVC   P+43(6),MATJOB      GETPINS RETURNS CODE IN MATJOB               
*                                                                               
         CLI   MATJOB,X'FF'        ADID ONLY JOB RECORD ?                       
         BNE   PIN12A4             NO                                           
         BRAS  RE,ADIDGET          GET THE ADID CODE                            
         MVC   P+43(12),WORK       ADIDGET RETURNS CODE IN WORK                 
*                                                                               
PIN12A4  DS    0H                                                               
         MVC   P+55(2),=C'**'                                                   
*                                                                               
PIN12A5  DS    0H                                                               
         LA    R2,PINSREC+33                                                    
         MVI   ELCODE,X'66'                                                     
         CLI   0(R2),X'66'                                                      
         BE    PIN12D                                                           
*                                                                               
PIN12B   DS    0H                                                               
         MVI   ELCODE,X'66'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN12J                                                           
*                                                                               
PIN12D   DS    0H                                                               
         CLI   HPSW,1              SEE IF I HAVE PRINTED INS HEADER             
         BE    PIN12D5                                                          
         GOTO1 AIOPRNT                                                          
         MVI   HPSW,1              SET INS HEADER PRINTED                       
*                                                                               
PIN12D5  DS    0H                                                               
         CLC   =C'//INSERTION//',2(R2)                                          
         BNE   PIN12F                                                           
         MVI   BUYSW,0                                                          
         B     PIN12B                                                           
*                                                                               
PIN12F   DS    0H                                                               
         CLI   BUYSW,0                                                          
         BNE   PIN12B                                                           
*                                                                               
         CLC   =C'COM=',2(R2)                                                   
         BNE   PIN12H                                                           
         GOTO1 ASTDCOM,DMCB,(R2)                                                
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN12B                                                           
*                                                                               
PIN12H   DS    0H                                                               
         MVC   PINLANG,PUBLANG     SAVE 'REAL' PUBLANG                          
         MVC   PUBLANG,SVLANG      SINCE MATCOM NEEDS LANG IN PUBLANG           
*                                  AND COMLIN GOES TO MATCOM                    
         GOTO1 ACOMLIN,DMCB,(R2)                                                
*                                                                               
         MVC   PUBLANG,PINLANG     RESTORE "REAL" PUBLANG                       
*                                                                               
         BRAS  RE,TSTERR                                                        
         B     PIN12B                                                           
*                                                                               
PIN12J   DS    0H                                                               
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD I/O                          
         BNE   PIN12J2                                                          
         MVC   P,SPACES            BE SURE P LINE IS CLEAR                      
         CLI   HPSW,1              DID I PRINT INS HEADER?                      
         BNE   PIN12A              NO - THEN DON'T SKIP                         
         GOTO1 AIOPRNT             SKIP A LINE                                  
*                                                                               
         BRAS  RE,PHOUSE           FOR MULTIPLE ADCODE                          
*                                                                               
         B     PIN12A              DO NEXT AD                                   
*                                                                               
PIN12J2  DS    0H                  BUILD ELEM FOR STDCOM                        
         CLI   MULTIAD,C'Y'        SEE IF MULTI-AD I/O                          
         BE    PIN12J2H                                                         
*                                                                               
         BRAS  RE,PHOUSE           FOR SINGLE ADCODE                            
*                                                                               
PIN12J2H XC    PPGKEY(24),PPGKEY                                                
         MVC   PPGKEY+25(1),TSCHGSW-STATDIF SAVE CANCEL INDICATOR               
         MVI   TSCHGSW-STATDIF,0   SO THESE COMMENTS ALWAYS                     
         MVI   PPGKEY,X'66'        PRINT                                        
         MVI   PPGKEY+1,X'0C'                                                   
         MVC   PPGKEY+2(4),=C'COM='                                             
         LA    R1,PPGKEY+6                                                      
         OC    SCPSCOM1,SCPSCOM1   CHK FOR PUB/CLT STANDARD COMMENT 1           
         BZ    PIN12J3                                                          
         MVC   PPGKEY+6(6),SCPSCOM1                                             
         LA    R1,PPGKEY+17                                                     
PIN12J3  OC    SCPSCOM2,SCPSCOM2                                                
         BZ    PIN12J5                                                          
         MVC   0(6,R1),SCPSCOM2                                                 
         OC    SCPSCOM1,SCPSCOM1   SEE IF I HAD FIRST COMMENT                   
         BZ    PIN12J5 NO                                                       
         MVI   PPGKEY+1,X'16'                                                   
         MVI   PPGKEY+12,C','                                                   
         MVC   PPGKEY+13(4),=C'COM='                                            
*                                                                               
PIN12J5  OC    PPGKEY+6(6),PPGKEY+6                                             
         BZ    PIN12J7                                                          
         GOTO1 ASTDCOM,DMCB,PPGKEY                                              
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN12J7  DS    0H                  NOW CHK STANDARD COMMENT ON CLT              
         LA    R2,PCLTELEM                                                      
         MVI   ELCODE,X'11'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PIN12J9                                                          
         XC    PPGKEY(20),PPGKEY                                                
         MVI   PPGKEY,X'66'        PRINT                                        
         MVI   PPGKEY+1,X'0C'                                                   
         MVC   PPGKEY+2(4),=C'COM='                                             
         MVC   PPGKEY+6(6),2(R2)                                                
         GOTO1 ASTDCOM,DMCB,PPGKEY                                              
         BRAS  RE,TSTERR                                                        
*                                                                               
         MVI   ELCODE,X'11'        TRY FOR ANOTHER                              
         BRAS  RE,NXTEL                                                         
         BNE   PIN12J9                                                          
         GOTO1 AIOPRNT             SKIP A LINE                                  
         XC    PPGKEY(20),PPGKEY                                                
         MVI   PPGKEY,X'66'                                                     
         MVI   PPGKEY+1,X'0C'                                                   
         MVC   PPGKEY+2(4),=C'COM='                                             
         MVC   PPGKEY+6(6),2(R2)                                                
         GOTO1 ASTDCOM,DMCB,PPGKEY                                              
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN12J9  BRAS  RE,IOCOMPRT                                                      
*                                                                               
         CLI   MULTOPT,C'Y'        MULTI INSERTS PER I/O?                       
         BE    *+8                 YES                                          
         BRAS  RE,LEGALW           LEGAL WARNINGS & QUARTERLY COMMENTS          
*                                                                               
         MVC   TSCHGSW-STATDIF(1),PPGKEY+25                                     
*                                                                               
         CLI   TOTOPT,C'N'         IF PRINTING TOTALS                           
         BNE   PIN12J95                                                         
         CLI   VNOOPT,C'Y'         IF PRINTING VEN NUMBER                       
         BE    PIN12J95                                                         
         CLI   ESTOPT,C'D'         OR EST AND NAME                              
         BE    PIN12J95                                                         
         CLI   ESTOPT,C'Y'         OR EST NUMBER                                
         BNE   PIN13                                                            
PIN12J95 GOTO1 AIOPRNT             SKIP A LINE                                  
         OC    SVCVNUM,SVCVNUM                                                  
         BZ    PIN12K                                                           
         CLI   VNOOPT,C'Y'         TEST PRINTING VEN NUMBER                     
         BNE   PIN12K                                                           
*--->    MVC   P+5(18),=C'CLIENT VENDOR NO.='                                   
         MVC   P+5(L'PP@CVNO),PP@CVNO                                           
*--->    MVC   P+24(12),SVCVNUM                                                 
         MVC   P+6+L'PP@CVNO(12),SVCVNUM                                        
         GOTO1 AIOPRNT                                                          
         DROP  R5                                                               
*                                                                               
PIN12K   DS    0H                                                               
         CLI   ONEEOPT,C'Y'        IN HEADLINES FOR ONE EST REQ                 
         BNE   PIN12KC                                                          
         CLC   PRQEST,=C'ALL'      SEE IF ONE EST REQ                           
         BNE   PIN13               YES - SKIP EST HERE                          
*                                                                               
PIN12KC  DS    0H                                                               
         CLI   ESTOPT,C'D'         NUMBER AND DESCRIPTION                       
         BE    PIN12Q                                                           
         CLI   ESTOPT,C'Y'         TEST PRINTING EST NUMBER                     
         BNE   PIN13                                                            
PIN12K1  DS    0H                                                               
         SR    R4,R4               SORT LIST                                    
         LA    R5,ESTLIST                                                       
*                                  COUNT ENTRIES FOR SORTER                     
PIN12K2  OC    0(2,R5),0(R5)                                                    
         BZ    PIN12K4             LAST                                         
         LA    R5,2(R5)                                                         
         LA    R4,1(R4)                                                         
         B     PIN12K2                                                          
*                                                                               
PIN12K4  DS    0H                                                               
         GOTO1 XSORT,DMCB,(0,ESTLIST),(R4),2,2,0                                
*                                                                               
*--->    LA    R4,P+14             PRINT EST NUMBERS                            
*--->    MVC   P+5(8),=C'EST NO.='                                              
*                                                                               
         L     RF,=V(DICSECTP)                                                  
         A     RF,RELO                                                          
         USING DICSECTP,RF                                                      
*                                                                               
         MVC   P+5(L'PP@IOP11),PP@IOP11                                         
         OC    ESTLIST+2(2),ESTLIST+2                                           
         BZ    PIN12L                                                           
*                                                                               
PIN12K6  DS    0H                                                               
*--->    LA    R4,P+15                                                          
*--->    MVC   P+5(9),=C'EST NOS.='                                             
         MVC   P+5(L'PP@IOP12),PP@IOP12                                         
         DROP  RF                                                               
*                                                                               
PIN12L   DS    0H                                                               
         LA    R4,P+16                                                          
PIN12L2  CLI   0(R4),C' '                                                       
         BH    PIN12L5                                                          
         BCT   R4,PIN12L2                                                       
*                                                                               
PIN12L5  DS    0H                                                               
         LA    R4,2(R4)                                                         
         LA    R5,ESTLIST                                                       
*                                                                               
PIN12M   OC    0(2,R5),0(R5)                                                    
         BZ    PIN12N              DONE                                         
         LH    R0,0(R5)                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R4),DUB                                                      
         OC    2(2,R5),2(R5)       SEE IF ANY MORE ESTS                         
         BZ    PIN12N              NO - DONE                                    
         MVI   3(R4),C','                                                       
         LA    R4,4(R4)                                                         
         LA    R5,2(R5)                                                         
         B     PIN12M              DO NEXT EST                                  
*                                                                               
PIN12N   GOTO1 AIOPRNT                                                          
         LA    RE,ESTLIST                                                       
         LHI   RF,400                                                           
         XCEF                                                                   
         B     PIN13                                                            
         EJECT                                                                  
*                                                                               
PIN12Q   DS    0H                  DISPLAY ESTIMATE NUMBERS AND NAMES           
         SR    R4,R4               SORT LIST                                    
         LA    R5,ESTLIST                                                       
*                                  COUNT ENTRIES FOR SORTER                     
PIN12Q2  OC    0(2,R5),0(R5)                                                    
         BZ    PIN12Q4             LAST                                         
         LA    R5,2(R5)                                                         
         LA    R4,1(R4)                                                         
         B     PIN12Q2                                                          
*                                                                               
PIN12Q4  DS    0H                                                               
         GOTO1 XSORT,DMCB,(0,ESTLIST),(R4),2,2,0                                
*--->    LA    R4,P+14             PRINT EST NUMBERS                            
*--->    MVC   P+5(8),=C'EST NO.='                                              
*                                                                               
         LA    R5,ESTLIST                                                       
*                                                                               
PIN12Q5  L     RF,=V(DICSECTP)                                                  
         A     RF,RELO                                                          
         USING DICSECTP,RF                                                      
*                                                                               
         MVC   P+5(L'PP@IOP11),PP@IOP11                                         
         DROP  RF                                                               
*                                                                               
* MUST READ ESTIMATE USING AGY/MED/CLT/PRD OF PJOBREC                           
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'07'                                                      
         MVC   KEY+10(2),0(R5)     EST                                          
         CLC   PESTREC(13),KEY     SEE IF I ALREADY HAVE                        
         BE    PIN12Q7                                                          
         BRAS  RE,RDPRT                                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
         LA    R0,PESTREC          READ INTO PESTREC                            
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN12Q7  DS    0H                                                               
         LH    R0,0(R5)            EST                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+15(3),DUB                                                      
         MVC   P+20(L'PESTNAME),PESTNAME                                        
         MVC   PSECOND+20(L'PESTNAM2),PESTNAM2                                  
         GOTO1 AIOPRNT                                                          
         LA    R5,2(R5)            NEXT ESTIMATE                                
         OC    0(2,R5),0(R5)       END OF LIST                                  
         BNZ   PIN12Q5                                                          
         LA    RE,ESTLIST                                                       
         LHI   RF,400                                                           
         XCEF                                                                   
         EJECT                                                                  
*                                                                               
PIN13    DS    0H                                                               
         L     RF,=V(DICSECTP)                                                  
         A     RF,RELO                                                          
         USING DICSECTP,RF                                                      
*                                                                               
         CLI   CONOPT,C'N'         SEE IF DISPLAY CONTRACT INFO                 
         BE    PIN14                                                            
         CLC   CONTAB(2),=X'0000'                                               
         BE    PIN14               NO CONTRACTS                                 
*--->    MVC   P+5(9),=C'CONTRACT='                                             
         MVC   P+5(L'PP@CONTR),PP@CONTR                                         
         CLC   CONTAB+CONLEN(2),=X'0000'                                        
         BE    PIN13B                                                           
*--->    MVC   P+5(10),=C'CONTRACTS='                                           
         MVC   P+5(L'PP@CONTS),PP@CONTS                                         
         DROP   RF                                                              
*                                                                               
PIN13B   DS    0H                                                               
         LA    R5,CONTAB                                                        
PIN13C   CLC   0(2,R5),=X'0000'                                                 
         BE    PIN13X                                                           
*                                                                               
         LA    R4,P+15                                                          
         CLC   CONTAB+CONLEN(2),=X'0000'                                        
         BE    *+8                                                              
         LA    R4,P+16                                                          
*                                                                               
         CLI   CONOPT,C'L'         SEE IF ONLY SHOWING LEVEL                    
         BNE   PIN13D                                                           
         CLI   8(R5),0             CHECK FOR LEVEL IND                          
         BE    PIN13I              SKIP THIS CONTRACT                           
*                                                                               
PIN13D   MVC   HALF,0(R5)                                                       
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(3,R4),DUB                                                      
*                                                                               
         LA    R4,4(R4)                                                         
         CLI   CONOPT,C'L'         SEE IF ONLY SHOWING LEVEL                    
         BE    PIN13E                                                           
         GOTO1 DATCON,DMCB,(3,2(R5)),(5,WORK)                                   
         CLI   SVLANG,C'F'                                                      
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
         MVC   0(8,R4),WORK                                                     
         MVI   8(R4),C'-'                                                       
         GOTO1 DATCON,DMCB,(3,5(R5)),(5,WORK)                                   
         CLI   SVLANG,C'F'                                                      
         BNE   *+8                                                              
         BAS   RE,FRDATE                                                        
         MVC   9(8,R4),WORK                                                     
         CLI   CONOPT,C'D'         SEE IF ONLY SHOWING DATES                    
         BE    PIN13H                                                           
         LA    R4,18(R4)                                                        
*                                                                               
PIN13E   DS    0H                                                               
         CLI   8(R5),X'00'         CHECK FOR LEVEL IND                          
         BE    PIN13H                                                           
         CLI   8(R5),C'S'          SPECIAL                                      
         BNE   PIN13F                                                           
         MVC   0(7,R4),=C'SPECIAL'                                              
         B     PIN13H                                                           
*                                                                               
PIN13F   CP    9(5,R5),=P'0'       CHECK FOR NO LEVEL                           
         BE    PIN13H                                                           
         CLI   8(R5),C'$'          $ VOLUME                                     
         BE    PIN13F5                                                          
         CLI   8(R5),C'N'          OR NET $ VOLUME                              
         BE    PIN13F5             DISPLAY EITHER WITH $ IN FRONT               
         B     PIN13F8                                                          
*                                                                               
PIN13F5  DS    0H                                                               
         EDIT  (P5,9(R5)),(10,0(R4)),0,COMMAS=YES,ALIGN=LEFT,FLOAT=$            
         B      PIN13H                                                          
*                                                                               
PIN13F8  DS    0H                                                               
         EDIT  (P5,9(R5)),(10,0(R4)),0,COMMAS=YES,ALIGN=LEFT                    
         LA    RE,0(R4)                                                         
         AR    RE,R0                                                            
*                                                                               
         L     RF,=V(DICSECTP)                                                  
         A     RF,RELO                                                          
         USING DICSECTP,RF                                                      
*                                                                               
*--->    MVC   2(5,RE),=C'TIMES'                                                
         MVC   2(L'PP@TIMS,RE),PP@TIMS                                          
         CLI   8(R5),C'X'                                                       
         BE    PIN13H                                                           
*--->    MVC   2(5,RE),=C'LINES'                                                
         MVC   2(L'PP@LINE,RE),PP@LINE                                          
         CLI   8(R5),C'L'                                                       
         BE    PIN13H                                                           
         MVC   2(5,RE),=C'PAGES'                                                
         CLI   8(R5),C'P'                                                       
         BE    PIN13H                                                           
*--->    MVC   2(6,RE),=C'INCHES'                                               
         MVC   2(L'PP@INCH,RE),PP@INCH                                          
         CLI   8(R5),C'I'                                                       
         BE    PIN13H                                                           
         MVC   2(6,RE),=C'ISSUES'                                               
         CLI   8(R5),C'U'                                                       
         BE    PIN13H                                                           
         MVC   2(6,RE),SPACES      UNKNOWN LEVEL INDICATOR                      
         MVC   2(1,RE),8(R5)       JUST DISPLAY IT - DON'T DIE                  
         B     PIN13H                                                           
         DROP  RF                                                               
*                                                                               
PIN13H   GOTO1 AIOPRNT                                                          
PIN13I   LA    R5,CONLEN(R5)                                                    
         B     PIN13C                                                           
*                                                                               
PIN13X   MVC   P(30),SPACES        CLEAR IN CASE NOTHING IS PRINTED             
*                                                                               
PIN14    DS    0H                                                               
         CLI   TOTOPT,C'N'         SEE IF PRINT ANY TOTALS                      
         BE    PIN16                                                            
         OC    IOGROSS(8),IOGROSS  CHECK FOR ANY $ GROSS AND NET                
         BZ    PIN16               SKIP TOTALS                                  
         MVC   P+5(5),=C'TOTAL'                                                 
         CLI   TOTOPT,C'B'         SEE IF SHOW BOTH GROSS AND NET               
         BNE   PIN14B                                                           
         MVI   P+10,C'S'                                                        
         CLI   SVLANG,C'F'         SEE IF FRENCH I/O                            
         BNE   PIN14B                                                           
         MVC   P+5(6),=C'TOTAUX'                                                
*                                                                               
PIN14B   DS    0H                                                               
         LA    R5,P+12                                                          
         CLI   TOTOPT,C'T'         ONLY SHOWING NET                             
         BE    PIN14N                                                           
*                                                                               
* NOTE CAN'T USE CURED SINCE IT GETS COUNTRY AND LANGUAGE FROM =V(SSB)          
*                                                                               
         EDIT  (B4,IOGROSS),(14,0(R5)),2,ALIGN=LEFT,CR=YES,COMMAS=YES           
         CLI   SVLANG,C'F'         SEE IF FRENCH                                
         BNE   PIN14BX                                                          
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14B2  CLI   0(R1),C','                                                       
         BNE   PIN14B4                                                          
         MVI   0(R1),C' '          CHANGE COMMA TO SPACE                        
PIN14B4  LA    R1,1(R1)                                                         
         BCT   RE,PIN14B2                                                       
*                                                                               
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14B6  CLI   0(R1),C'.'                                                       
         BNE   PIN14B8                                                          
         MVI   0(R1),C','          CHANGE PERIOD TO COMMA                       
PIN14B8  LA    R1,1(R1)                                                         
         BCT   RE,PIN14B6                                                       
*                                                                               
PIN14BX  DS    0H                                                               
         LA    R5,P+26                                                          
         CLI   0(R5),C' '          SCAN BACKWARD FOR NONE SPACE                 
         BH    *+8                                                              
         BCT   R5,*-8                                                           
*                                                                               
         L     RF,=V(DICSECTP)                                                  
         A     RF,RELO                                                          
         USING DICSECTP,RF                                                      
*                                                                               
         MVC   2(L'PP@GROSP,R5),PP@GROSP                                        
         CLI   TOTOPT,C'G'         SEE IF SHOW ONLY GROSS                       
         BE    PIN14P              THEN DONE                                    
         LA    R5,L'PP@GROSP+3(R5)                                              
*                                                                               
PIN14N   DS    0H                                                               
         EDIT  (B4,IONET),(14,0(R5)),2,ALIGN=LEFT,CR=YES,COMMAS=YES             
         CLI   SVLANG,C'F'         SEE IF FRENCH                                
         BNE   PIN14NX                                                          
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14N2  CLI   0(R1),C','                                                       
         BNE   PIN14N4                                                          
         MVI   0(R1),C' '          CHANGE COMMA TO SPACE                        
PIN14N4  LA    R1,1(R1)                                                         
         BCT   RE,PIN14N2                                                       
*                                                                               
         LR    R1,R5                                                            
         LA    RE,14               FOR BCT                                      
PIN14N6  CLI   0(R1),C'.'                                                       
         BNE   PIN14N8                                                          
         MVI   0(R1),C','          CHANGE PERIOD TO COMMA                       
PIN14N8  LA    R1,1(R1)                                                         
         BCT   RE,PIN14N6                                                       
*                                                                               
PIN14NX  DS    0H                                                               
         LA    R5,14(R5)                                                        
         CLI   0(R5),C' '          SCAN BACKWARD FOR NONE SPACE                 
         BH    *+8                                                              
         BCT   R5,*-8                                                           
*                                                                               
         L     RF,=V(DICSECTP)     RESET RF                                     
         A     RF,RELO                                                          
         MVC   2(L'PP@NETP,R5),PP@NETP                                          
         DROP  RF                                                               
*                                                                               
PIN14P   DS    0H                                                               
         GOTO1 AIOPRNT                                                          
         XC    IOCNTS,IOCNTS       CLEAR ALL IO COUNTERS                        
*                                                                               
PIN16    DS    0H                                                               
         LA    RE,CONTAB                                                        
         LHI   RF,400                                                           
         XCEF                                                                   
*                                                                               
         XC    IOCNTS,IOCNTS       CLEAR ALL IO COUNTERS                        
         MVI   FORCEFUT,C'Y'       INSURE SIGNATURE PRINT                       
         GOTO1 AIOPRNT                                                          
*                                                                               
PIN17    DS    0H                  NOW MARK BUYRECS                             
*                                                                               
* SAVE CURRENT BUY REC                                                          
*                                                                               
         MOVE  (SPACEND,4000),PBUYREC                                           
*                                                                               
         L     R5,BUYDALST                                                      
         LA    R0,BUYDALST+4                                                    
         SR    R5,R0                                                            
         SRL   R5,2                R5 = NO. OF RECS                             
         LA    R3,1                R3 = THIS REC NO.                            
         LA    R4,BUYDALST+4       FIRST DA                                     
         LA    R0,PBUYREC                                                       
         ST    R0,AREC                                                          
*                                                                               
PIN18    DS    0H                                                               
         OC    0(4,R4),0(R4)                                                    
         BZ    PIN24               EOL                                          
         MVC   KEY+27(4),0(R4)                                                  
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
* IF MULTI-AD MODE GET REPEAT DATE AND PUB FROM ADLIST                          
*                                                                               
         CLI   MULTIAD,C'Y'                                                     
         BNE   PIN18A8                                                          
         L     RE,AADLIST                                                       
         OC    17(6,RE),17(RE)     SEE IF ONLY ONE AD                           
         BZ    PIN18A8                                                          
*                                                                               
* SET REPEAT DATE AND PUB FROM ADLIST                                           
*                                                                               
PIN18A2  CLC   1(6,RE),PBDJOB                                                   
         BE    PIN18A4                                                          
         LA    RE,16(RE)           NEXT ENTRY                                   
         OC    0(7,RE),0(RE)       END OF TABLE                                 
         BNZ   PIN18A2                                                          
*                                                                               
         DC    H'0'                AD CODE NOT IN TABLE - HOW?                  
*                                                                               
PIN18A4  MVC   BRPTDAT,7(RE)       SET REPEAT DATE AND PUB FROM ADLIST          
         MVC   RPTPUB,10(RE)                                                    
*                                                                               
PIN18A8  DS    0H                                                               
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
* CREATE NEW PIOELEM                                                            
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PIN20    DS    0H                                                               
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'                                                     
PIN20B   DS    0H                                                               
         BRAS  RE,NXTEL                                                         
         BNE   PIN21                                                            
         USING PIOELEM,R2                                                       
         OC    PIODATE,PIODATE                                                  
         BNZ   PIN20B                                                           
*                                                                               
* SEE IF A REPEAT PUB IS PRESENT AND IF SO, DOES IT MATCH BUY?                  
*                                                                               
         OC    RPTPUB,RPTPUB       CHECK FOR REPEAT PUB                         
         BZ    PIN22                                                            
         CLC   RPTPUB,PBUYKPUB     SEE IF IT MATCHES BUY                        
         BE    PIN22                                                            
*                                                                               
* MUST DELETE SMALL EMPTY ELEM AND ADD BIG ONE                                  
*                                                                               
         GOTO1 RECUP,DMCB,(1,PBUYREC),(R2),0                                    
*                                                                               
         MVC   HALF,PBUYREC+25                                                  
         LH    RE,HALF                                                          
         LA    RF,PBUYREC                                                       
         AR    RF,RE                                                            
         MVC   0(2,RF),=X'0000'    CLEAR END OF RECORD                          
*                                                                               
         B     PIN20                                                            
*                                                                               
PIN21    DS    0H                                                               
         XC    W,W                                                              
         MVI   W,X'70'             ELEM CODE                                    
         MVI   W+1,50              ELEM LENGTH                                  
*                                                                               
         OC    RPTPUB,RPTPUB       CHECK FOR REPEAT PUB                         
         BZ    PIN21C                                                           
         CLC   RPTPUB,PBUYKPUB     SEE IF IT MATCHES BUY                        
         BE    PIN21C                                                           
         MVI   W+1,56              TO STORE REPEAT PUB (BIG ELEMENT)            
*                                                                               
PIN21C   DS    0H                                                               
         CLC   PBUYREC+25(2),=H'3900'                                           
         BL    *+6                                                              
         DC    H'0'                RECORD IS 100 BYTES TO MAX                   
*                                                                               
         GOTO1 RECUP,DMCB,(1,PBUYREC),W,(R2)                                    
*                                                                               
PIN22    DS    0H                                                               
         MVC   PIODATE,BTODAY                                                   
         MVC   PIONUM(2),REFNO                                                  
         STC   R3,PIONUM+2         THIS REC NO                                  
         STC   R5,PIONUM+3         NO. OF RECS                                  
         MVI   PIOTYP,C'N'                                                      
         CLI   TSCHGSW-STATDIF,0                                                
         BE    *+10                                                             
         MVC   PIOTYP,TSCHGSW-STATDIF                                           
         MVI   PIOTURN,C'T'                                                     
         CLI   QOPT3-QRECORD+SAVEQ,C'A'                                         
         BE    PIN22A                                                           
         MVI   PIOTURN,0                                                        
         CLI   QOPT3-QRECORD+SAVEQ,C'T'                                         
         BE    PIN22A                                                           
         MVI   PIOTURN,C'R'        REQUEST                                      
*                                                                               
PIN22A   DS    0H                                                               
         CLI   QOPT7-QRECORD+SAVEQ,C'F'                                         
         BNE   *+8                                                              
         MVI   PIOFAX,C'F'                                                      
*                                                                               
         MVC   PIORPTDT,BRPTDAT                                                 
         CLI   SVIGNDAT,X'FF'      NO CONTROL DATE                              
         BE     *+10                                                            
         MVC   PIOCDATE,SVIGNDAT                                                
*                                                                               
PIN22B   DS    0H                                                               
         MVC   PIOIDATE,PBUYKDAT                                                
         CLI   PBUYKMED,C'N'                                                    
         BE    PIN22D                                                           
*                                                                               
         MVC   PIOSPACE,PBDSPACE                                                
         B     PIN22F                                                           
*                                                                               
PIN22D   DS    0H                                                               
         ZAP   PIOUNITS,PBDUNITS                                                
         ZAP   PIOCLMS,PBDCLMS                                                  
         MVC   PIOUIND,PBDUIND                                                  
         MVC   PIOPRM(1),PBDCL                                                  
         MVC   PIOSAU,PBDSPACE                                                  
*                                                                               
PIN22F   DS    0H                                                               
         MVC   PIOJOB,PBDJOB                                                    
         CLI   ZEOPT,C'Y'          TEST MULTI Z/E                               
         BNE   *+8                                                              
         OI    PIOSTAT,X'80'                                                    
*                                                                               
* NOTE: LEGAL WARNING CODES CAN BE A,B,C,D OR NULL (X IS NOT RECORDED!)         
*       QUARTERLY CODES CAN BE     1,2,3,4 OR NULL (X IS NOT RECORDED!)         
*                                                                               
         CLI   MULTOPT,C'Y'        MULTI INSERTS PER IO                         
         BE    PIN22F4             YES                                          
         MVC   PIOLWCD,LWCCODE     LEGAL WARNING CODE (IF PRESENT)              
         MVC   PIOQUCD,QUCCODE     QUARTERLY CODE (IF PRESENT)                  
*                                                                               
PIN22F4  OC    RPTPUB,RPTPUB       CHECK FOR REPEST PUB                         
         BZ    PIN22F5                                                          
         CLC   RPTPUB,PBUYKPUB     SEE IF IT MATCHES BUY                        
         BE    PIN22F5                                                          
         CLI   PIOELEM+1,56        BE SURE IT IS A BIG ELEM                     
         BL    PIN22F5                                                          
*                                                                               
* SHOULDN'T HAPPEN, BUT IF IT DOES, REPEAT PUB WILL NOT BE SAVED                
*                                                                               
         MVC   PIORPUB,RPTPUB      STORE REPEAT PUB - IN BIG ELEMENT            
*                                                                               
PIN22F5  DS    0H                                                               
         XC    PBDIODAT,PBDIODAT                                                
*                                  WRITE BUY REC                                
         CLI   RCWRITE,C'Y'                                                     
         BNE   PIN22H                                                           
         BRAS  RE,PUTPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
PIN22H   DS    0H                                                               
         LA    R4,4(R4)            NEXT DISK ADDRESS                            
         LA    R3,1(R3)                                                         
         GOTO1 AWFMOD,DMCB,(R2)    POST TO REGISTER                             
         B     PIN18                                                            
*                                                                               
PIN24    DS    0H                                                               
*                                                                               
* DO NOT RESOTRE CURRENT BUY REC IF SAME KEY AS LAST POSTED                     
*                                                                               
         CLC   PBUYREC(25),SPACEND                                              
         BNE   PIN24A                                                           
         CLI   0(R2),X'70'         BE SURE IT POINTS TO AN I/O ELEM             
         BNE   PIN24B                                                           
         OC    2(3,R2),2(R2)       CHECK FOR DATE                               
         BZ    PIN24B                                                           
*                                                                               
         ST    R2,LASTIOEL         BEFORE STORING IN LASTIOEL                   
         B     PIN24B                                                           
*                                                                               
PIN24A   DS    0H                  RESTORE BUYREC                               
         MOVE  (PBUYREC,4000),SPACEND                                           
*                                                                               
PIN24B   DS    0H                                                               
         LH    RF,REFNO                                                         
         LA    RF,1(RF)                                                         
         STH   RF,REFNO            BUMP IO NUMBER                               
*                                                                               
         CLI   MULTOPT,C'Y'        FIRST SEE IF DOING MULTIPLE                  
         BNE   PIN25               INSERTS ON ONE I/O                           
*                                                                               
* GO TO BLDREV NOW TO SET DATE,SPACE JOB OF LASTIO INTO THISSTAT                
* BEFORE IT GETS MOVED INTO LASTSTAT                                            
*                                                                               
         CLI   CHANGSW,C'C'        ONLY NEEDED FOR CHANGES                      
         BNE   PIN25                                                            
*                                                                               
         OC    LASTIOEL,LASTIOEL   JUST IN CASE                                 
         BZ    PIN25                                                            
*                                                                               
         L     RF,LASTIOEL                                                      
         CLI   0(RF),X'70'         BE SURE IT REALLY IS AN I/O ELEM             
         BNE   PIN25                                                            
*                                                                               
         CLI   1(RF),X'32'         DOUBLE CHECK FOR AN I/O ELEM                 
         BL    PIN25               I/O ELEM MUST BE AT LEAST 50 BYTES           
*                                                                               
         OC    2(3,RF),2(RF)       CHECK FOR DATE                               
         BZ    PIN25                                                            
*                                                                               
* GO TO BLDREV TO SET THISSTAT                                                  
*                                                                               
         GOTO1 ABLDREV,DMCB,LASTIOEL                                            
         LA    RE,SPACEND          CLEAR SPACEND                                
         LA    RF,1600                                                          
         XCEF                                                                   
*                                                                               
PIN25    DS    0H                                                               
         XC    LASTSTAT,LASTSTAT                                                
*                                                                               
PIN26    DS    0H                                                               
         CLI   PBUYKEY,X'FF'                                                    
         BE    PIN90                                                            
*                                                                               
         MVC   LASTSTAT,THISSTAT                                                
         MVC   HLIN1,SPACES        CLEAR HEADLINES                              
         XC    LASTBUY,LASTBUY                                                  
         LA    R4,BUYDALST+4                                                    
         ST    R4,BUYDALST                                                      
         XC    0(4,R4),0(R4)                                                    
         MVI   BUYSW,C'F'          SET END OF I.O.                              
         MVC   SAVEQ,QRECORD                                                    
         MVC   SVIGNDAT,BIGNDAT                                                 
         B     PIN2D                                                            
*                                                                               
PIN30    DS    0H                  ADD TO BUYREC DISK ADDR LIST                 
         CLC   QPROG-QRECORD+SAVEQ,=C'72'                                       
         BH    PIN90                                                            
         MVC   KEY(25),PBUYKEY                                                  
         BRAS  RE,RDPRT                                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
         L     R4,BUYDALST                                                      
         L     RE,ABUYMAX          LAST POSSIBLE ADDRESS                        
         CR    R4,RE                                                            
         BL    *+6                                                              
         DC    H'0'                TOO MANY BUYS FOR ONE I/O                    
*                                                                               
* IF TOO MANY BUYS FOR ONE 1/O OCCURED, EXPAND BUYDALST (IN T413WKA)            
* AND REASSEMBLE ALL PHASES THAT INCLUDE T413WKA                                
*                                                                               
         MVC   0(4,R4),KEY+27                                                   
         LA    R4,4(R4)                                                         
         XC    0(4,R4),0(R4)                                                    
         ST    R4,BUYDALST                                                      
*                                                                               
PIN90    DS    0H                                                               
*                                                                               
EXIT     XIT1                                                                   
         EJECT                                                                  
*                                  DATAMGR LINKS                                
HIPRT    LA    R0,DMRDHI                                                        
         MVC   KEYSAVE,KEY                                                      
         J     DIRPRT                                                           
*                                                                               
SEQPRT   LA    R0,DMRSEQ                                                        
         J     DIRPRT                                                           
*                                                                               
RDPRT    LA    R0,DMREAD                                                        
         MVC   KEYSAVE,KEY                                                      
*                                                                               
DIRPRT   NTR1                                                                   
*                                                                               
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R0)),PRTDIR,KEY,KEY                       
         J     EXIT                                                             
*                                                                               
GETPRT   LA    R0,GETREC                                                        
         J     FILPRT                                                           
*                                                                               
PUTPRT   LA    R0,PUTREC                                                        
*                                                                               
FILPRT   NTR1                                                                   
*                                                                               
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R0)),PRTFILE,KEY+27,AREC,DMWORK           
         J     EXIT                                                             
*                                                                               
TSTERR   DS    0H                                                               
         OC    ERR(2),ERR                                                       
         JNE   TSTERR2                                                          
         MVC   BYTE,DMCB+8                                                      
         NC    BYTE,DMOUTBTS                                                    
         BZR   RE                                                               
         MVC   ERR+1,DMCB+8                                                     
TSTERR2  LR    R0,RE                                                            
         DC    H'0'                                                             
         GOTO1 AERRMOD                                                          
         J     EXIT                                                             
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
SETLAST NTR1                       FIND LAST IO ELEM                            
*                                                                               
         MVI   FULL,1              SET FOR DATE COMPARISON                      
         XC    LASTIOEL,LASTIOEL                                                
*                                                                               
* MAKE SURE THIS BUY NOT ALREADY ON THIS IO.                                    
*                                                                               
         OC    BUYDALST+4(4),BUYDALST+4                                         
         BZ    SETL1                                                            
         MVC   KEY(25),PBUYKEY                                                  
         BRAS  RE,RDPRT                                                         
         BRAS  RE,TSTERR                                                        
         LA    R4,BUYDALST+4                                                    
SETL0    CLC   KEY+27(4),0(R4)                                                  
         BE    SETL10                                                           
         LA    R4,4(R4)                                                         
         C     R4,BUYDALST         TEST EOL                                     
         BNH   SETL0                                                            
*                                                                               
SETL1    LA    R2,PBUYREC+33                                                    
SETL2    MVI   ELCODE,X'70'                                                     
*                                                                               
         BRAS  RE,NXTEL                                                         
         BNE   SETL4                                                            
         USING PIOELEM,R2                                                       
         CLC   PIODATE,FULL        TEST LATEST                                  
         BL    SETL2                                                            
         CLC   PIODATE,BIGNDAT     TEST VS CONTROL DATE                         
         BNL   SETL2                                                            
*                                  TEST RIGHT MULTI Z/E STATUS                  
         MVI   BYTE,C'N'                                                        
         TM    PIOSTAT,X'80'       TEST IO ELEM FROM MULTI                      
         BZ    *+8                                                              
         MVI   BYTE,C'Y'                                                        
         CLC   ZEOPT,BYTE                                                       
         BNE   SETL2                                                            
*                                                                               
SETL3    ST    R2,LASTIOEL         SAVE LATEST                                  
         B     SETL2                                                            
*                                                                               
SETL4    DS    0H                                                               
         TM    PBUYCNTL,X'80'                                                   
         BZ    SETL5                                                            
         OC    LASTIOEL,LASTIOEL                                                
         BZ    SETL10                                                           
         CLI   QOPT2,C'Y'          TEST 'NEEDED ONLY' REQ                       
         BNE   SETL4B                                                           
         L     R2,LASTIOEL                                                      
         CLI   PIOTYP,C'D'                                                      
         BE    SETL10                                                           
*                                                                               
SETL4B   DS    0H                                                               
         MVI   CHANGSW,C'D'                                                     
         B     XIT                                                              
*                                                                               
SETL5    DS    0H                                                               
         MVI   CHANGSW,0                                                        
         OC    LASTIOEL,LASTIOEL                                                
         BZ    XIT                                                              
         L     R2,LASTIOEL                                                      
         CLI   QOPT2,C'Y'          IF 'NEEDED ONLY' REQ                         
         BE    SETL5B                                                           
*                                                                               
* TEST ANY REAL CHANGE, PREVENT DUPLICATE ON SAME DAY                           
*                                                                               
         CLC   PIODATE,BTODAY      TEST IO TODAY                                
         BNE   SETL5D                                                           
         CLI   QOPT3,C'T'          OK IF REMOTE                                 
         BE    SETL5D                                                           
         CLI   PIOTURN,0                                                        
         BNE   SETL10                                                           
*                                  TEST IF ANY 'REAL' CHANGE                    
SETL5B   DS    0H                                                               
         XC    TSLDATE(44),TSLDATE                                              
         GOTO1 ABLDREV,DMCB,(R2)                                                
*                                                                               
         TM    NEEDOIND,X'80'      "NEEDED ONLY" FOR LEGALW REVISION?           
         BO    SETL5D                                                           
*                                                                               
         OC    TSLDATE(44),TSLDATE                                              
         BZ    SETL10              NO 'REAL' CHANGE                             
*                                                                               
SETL5D   DS    0H                                                               
         MVI   CHANGSW,C'C'                                                     
         B     XIT                                                              
*                                                                               
SETL10   DS    0H                                                               
         MVI   LASTIOEL,X'FF'                                                   
         B     XIT                                                              
*                                                                               
XIT      EQU   EXIT                                                             
         DROP  R2                                                               
*                                                                               
NXTEL    ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLC   ELCODE,0(R2)                                                     
         JE    NXTELX              CC IS EQUAL                                  
         CLI   0(R2),0                                                          
         JNE   NXTEL                                                            
         LTR   R2,R2               CC IS NOT EQUAL                              
NXTELX   BR    RE                                                               
*                                                                               
EDLEFT   DS    0H                                                               
         EDIT  (RF),(3,0(R3)),ALIGN=LEFT                                        
         BR    RE                                                               
         EJECT                                                                  
*                                                                               
* ADD BUY DOLLARS TO I/O TOTALS (EVEN IF TOTOPT IS "N")                         
*                                                                               
ADDDOLS  DS    0H                                                               
         L     R1,IOBUYS                                                        
         LA    R1,1(R1)                                                         
         ST    R1,IOBUYS                                                        
         L     R1,IOGROSS                                                       
         A     R1,GROSS                                                         
         ST    R1,IOGROSS                                                       
         L     R1,IONET                                                         
         A     R1,GROSS                                                         
         S     R1,AGYCOM                                                        
         ST    R1,IONET                                                         
         BR    RE                  RETURN                                       
*                                                                               
ADDESTN  DS    0H                                                               
         CLI   ESTOPT,C'D'         NUMBER AND NAME                              
         BE    ADDEN1                                                           
         CLI   ESTOPT,C'Y'                                                      
         BNE   ADDESTNX                                                         
*                                                                               
ADDEN1   LA    R4,ESTLIST          ADD EST NUMBER TO LIST                       
         LA    R5,200              FOR BCT MAX ESTS                             
*                                                                               
ADDEN2   CLC   0(2,R4),PBUYKEST                                                 
         BE    ADDESTNX                                                         
         OC    0(2,R4),0(R4)                                                    
         BZ    ADDEN3                                                           
         LA    R4,2(R4)                                                         
         BCT   R5,ADDEN2                                                        
         DC    H'0'                TOO MANY ESTS                                
*                                                                               
ADDEN3   MVC   0(2,R4),PBUYKEST                                                 
*                                                                               
ADDESTNX BR    RE                  RETURN                                       
         EJECT                                                                  
*                                                                               
ADDADS   DS    0H                                                               
*                                                                               
ADDAN1   L     R4,AADLIST          ADD AD CODES TO LIST                         
         LA    R5,200              FOR BCT MAX ADS  (200)                       
*                                                                               
ADDAN2   CLC   1(6,R4),PBDJOB                                                   
         BE    ADDASTNX                                                         
         OC    0(7,R4),0(R4)                                                    
         BZ    ADDAN3                                                           
         LA    R4,16(R4)                                                        
         BCT   R5,ADDAN2                                                        
         DC    H'0'                TOO MANY ADS                                 
*                                                                               
ADDAN3   MVC   1(6,R4),PBDJOB                                                   
*                                                                               
ADDASTNX BR    RE                  RETURN                                       
*                                                                               
ADDCON   NTR1                      FIND CONTRACT AND ADD TO CONTAB              
*                                                                               
         CLI   CONOPT,C'N'                                                      
         BE    ADDCX                                                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),PBUYREC                                                   
         MVI   KEY+3,X'10'                                                      
         MVC   KEY+4(3),PBUYKCLT                                                
         CLI   PCLTPROF+5,C'2'     SEE IF SLAVE                                 
         BNE   *+10                                                             
         MVC   KEY+4(3),PCLTPROF+6 USE MASTER CLIENT                            
*                                                                               
         MVC   KEY+7(6),PBUYKPUB                                                
         BRAS  RE,HIPRT                                                         
         B     ADDC5                                                            
ADDC4    BRAS  RE,SEQPRT                                                        
*                                                                               
ADDC5    CLC   KEYSAVE(13),KEY                                                  
         BNE   ADDCX                                                            
         GOTO1 DATAMGR,DMCB,GETREC,PRTFILE,KEY+27,PLISREC,DMWORK                
         LA    R5,PLISREC                                                       
         USING PCONRECD,R5                                                      
         CLC   PCONSDT,PBUYKDAT                                                 
         BH    ADDC4                                                            
         CLC   PCONEDT,PBUYKDAT                                                 
         BL    ADDC4                                                            
         CLI   PCONPRD,C' '        SEE IF A PRODUCT CONTRACT                    
         BNH   ADDC8                                                            
         CLC   PCONPRD,PBUYKPRD                                                 
         BNE   ADDC4                                                            
*                                                                               
ADDC8    DS    0H                                                               
         LA    R4,CONTAB                                                        
ADDC9    CLC   0(2,R4),PCONNUM     SEE IF IN TABLE                              
         BE    ADDCX                                                            
         CLC   0(2,R4),=X'0000'                                                 
         BE    ADDC10                                                           
         LA    R4,CONLEN(R4)                                                    
         LA    RE,CONTABX                                                       
         CR    R4,RE                                                            
         BL    ADDC9                                                            
         DC    H'0'                NO MORE ROOM IN CONTAB                       
*                                                                               
ADDC10   MVC   0(2,R4),PCONNUM                                                  
         MVC   2(6,R4),PCONSDT     SAVE START AND END DATE                      
*                                                                               
         MVI   ELCODE,X'20'                                                     
         LA    R2,PCONREC+33                                                    
         BRAS  RE,NXTEL                                                         
         BNE   ADDCX                                                            
*                                                                               
         DROP  R5                                                               
         USING PRBELEM,R2                                                       
         MVC   8(1,R4),PRBLIND                                                  
         MVC   9(5,R4),PRBLEVEL                                                 
         MVC   14(3,R4),PRBDATE    EFFECTIVE DATE                               
*                                                                               
ADDCX    J     EXIT                                                             
         DROP  R2                                                               
*                                                                               
FRDATE   NTR1                      CONVERT DATE IN WORK (MMMDD/YY)              
*                                                                               
         LA    R1,DATETAB                                                       
FRDAT2   CLI   0(R1),X'FF'         END OF TABLE                                 
         BNE   *+6                                                              
         DC    H'0'                SOMEHTING VERY WRONG                         
*                                                                               
         CLC   WORK(3),0(R1)                                                    
         BE    FRDAT10                                                          
         LA    R1,6(R1)                                                         
         B     FRDAT2                                                           
*                                  TO FRENCH                                    
FRDAT10  MVC   WORK(3),3(R1)                                                    
         J     EXIT                                                             
*                                                                               
HPSW     DS    CL1                 INS HEADER PRINTED SWITCH                    
*                                                                               
PINLANG  DS    CL1                 TEMP STORAGE FOR "REAL" PUB LANGUAGE         
*                                                                               
ADRTYP   DS    CL1                 TYPE OF ADDR REC-PAY,TRAFFIC,ETC.            
CLTDATA  DS    0CL7                PASS KEY INFO TO PPGETADR MODULE             
CLTAGY   DS    CL2                                                              
CLTMED   DS    CL1                                                              
CLTCODE  DS    CL3                                                              
CLTOFF   DS    CL1                                                              
*                                                                               
DATETAB  DC    C'JANJAN'                                                        
         DC    C'FEBFEV'                                                        
         DC    C'MARMAR'                                                        
         DC    C'APRAVR'                                                        
         DC    C'MAYMAI'                                                        
         DC    C'JUNJUN'                                                        
         DC    C'JULJUL'                                                        
         DC    C'AUGAOU'                                                        
         DC    C'SEPSEP'                                                        
         DC    C'OCTOCT'                                                        
         DC    C'NOVNOV'                                                        
         DC    C'DECDEC'                                                        
         DC    X'FF'                                                            
*                                                                               
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
* THIS ROUTINE WILL READ INSTRUCTION RECORDS FOR ADS IN ADLIST                  
*                                                                               
GETPINS  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   MATJOB,=6X'FF'      END OF LIST RETURN                           
         L     R2,AADLIST          SEARCH ADLIST                                
GPIN1    OC    0(7,R2),0(R2)       END OF LIST                                  
         BE    GETPINX                                                          
         CLI   0(R2),X'FF'         SEE IF I ALREAD DONE                         
         BNE   GPIN2                                                            
         LA    R2,16(R2)           TRY NEXT AD                                  
         B     GPIN1                                                            
*                                                                               
GPIN2    DS    0H                                                               
         MVC   MATJOB(6),1(R2)                                                  
         MVI   0(R2),X'FF'         SET ALREADY PROCESSED                        
         XC    KEY,KEY                                                          
         MVC   KEY(10),RCSVAGY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),MATJOB                                                 
         MVC   KEY+16(6),TSPUB-STATDIF                                          
         CLI   ZEOPT,C'Y'          IF MULTI ZONE/EDIT                           
         BNE   *+10                                                             
         XC    KEY+20(2),KEY+20    USE ONLY BASE PUB                            
         CLC   KEY(25),PINSREC     ALREADY HAVE                                 
         BE    GPIN5B                                                           
         BRAS  RE,HIPRT                                                         
         BRAS  RE,TSTERR                                                        
         TM    KEY+25,X'80'        SEE IF DELETED                               
         BNZ   GPIN4C                                                           
         CLC   KEY(22),KEYSAVE                                                  
         BE    GPIN5                                                            
*                                                                               
GPIN4C   DS    0H                                                               
         MVC   KEYSAVE+16(6),=6X'FF'                                            
         CLC   KEY(22),KEYSAVE     TEST HAVE FF DEFAULT                         
         BE    GPIN5                                                            
         MVC   KEY,KEYSAVE                                                      
         BRAS  RE,RDPRT                                                         
         BRAS  RE,TSTERR                                                        
*                                                                               
GPIN5    DS    0H                                                               
         CLC   KEY(25),PINSREC                                                  
         BE    GPIN5B              ALREADY HAVE                                 
         LA    R0,PINSREC                                                       
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
GPIN5B   DS    0H                                                               
GETPINX  DS    0H                                                               
*****    J     EXIT                                                             
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*    THIS ROUTINE WILL READ INSTRUCTION RECORD FOR ADID CODE                    
*   (ONLY X'FF' "ADIDCODE ONLY" MATJOB JOB CODES ARE SENT HERE)                 
*                                                                               
ADIDGET  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(10),PBUYKEY                                                  
         MVC   KEY(2),QAGENCY                                                   
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),MATJOB    THE X'FF' "ADIDCODE ONLY" JOB CODE           
         BRAS  RE,HIPRT                                                         
         BRAS  RE,TSTERR                                                        
         CLC   KEY(25),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                MUST BE FOUND                                
*                                                                               
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
         XC    WORK,WORK                                                        
         L     RE,AREC                                                          
         USING PJOBREC,RE                                                       
         MVC   WORK(L'PJOBADID),PJOBADID                                        
         DROP  RE                                                               
*                                                                               
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
IOCOMPRT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    RE,IOCOMREC                                                      
         LA    RF,IOCOMRQ                                                       
         XCEF                                                                   
         MVC   IWKWORK(25),KEY     SAVE ORIGINAL KEY                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(2),QAGENCY                                                   
         MVC   KEY+2(1),QMEDIA                                                  
         MVI   KEY+3,X'42'         IO COMMENT RECORD CODE                       
         MVC   KEY+4(3),QCLIENT                                                 
         MVC   KEYSAVE,KEY                                                      
         BRAS  RE,HIPRT                                                         
         CLC   KEY(7),KEYSAVE                                                   
         BE    ICOMP30             GET RECORD AND PROCESS                       
*                                                                               
         MVC   KEYSAVE+4(3),=X'FF4040'                                          
         MVC   KEYSAVE+5(1),PCLTOFF                                             
         MVC   KEY,KEYSAVE                                                      
         BRAS  RE,HIPRT            OFFICE CODE                                  
         CLC   KEY(7),KEYSAVE                                                   
         BE    ICOMP30             GET RECORD AND PROCESS                       
*                                                                               
         MVC   KEYSAVE+4(3),=X'FFFFFF'                                          
         MVC   KEY,KEYSAVE                                                      
         BRAS  RE,HIPRT            ALL CLIENTS                                  
         CLC   KEY(7),KEYSAVE                                                   
         BNE   ICOMP80             NOTHING MORE TO CHECK                        
*                                                                               
ICOMP30  DS    0H                                                               
         LA    R0,IOCOMREC                                                      
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
         GOTO1 AIOPRNT             SKIP A LINE                                  
         LA    R2,IOCOMREC+33                                                   
         MVI   ELCODE,X'40'                                                     
         CLC   ELCODE,0(R2)                                                     
         BE    ICOMP70                                                          
*                                                                               
ICOMP50  BRAS  RE,NXTEL                                                         
         BNE   ICOMP80             RETURN                                       
ICOMP70  CLC   =C'COM=',2(R2)      EMBEDDED COMMENT?                            
         BNE   ICOMP70H                                                         
         GOTO1 ASTDCOM,DMCB,(R2)   PRINTING EMBEDDED COMMENT                    
         BRAS  RE,TSTERR                                                        
         B     ICOMP50                                                          
ICOMP70H GOTO1 ACOMLIN,DMCB,(R2)   PRINTING COMMENT LINE                        
         B     ICOMP50                                                          
*                                                                               
ICOMP80  DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(25),IWKWORK     RESTORE ORIGINAL KEY                         
*                                                                               
         J     EXIT                                                             
*                                                                               
IOCOMREC DS    CL1200              MAX IS 16 ELEM OF MAX LENGTH OF 70           
IOCOMRQ  EQU   *-IOCOMREC                                                       
*                                                                               
IWKWORK  DS    CL32                GENERAL WORK AREA FOR IOCOMPRT USE           
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LEGALW   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   LWWORK(32),KEY      SAVE ORIGINAL KEY                            
*                                                                               
         CLI   LWCCODE,0           ANY LEGAL WARNING COMMENT TO PROC?           
         BE    LEGW90                                                           
         MVI   LWBYTE1,X'45'       LEGAL WARNINGS COMMENT RECORD CODE           
         MVC   LWBYTE2,LWCCODE     LEGAL WARNINGS COMMENT CODE                  
         BAS   RE,LWPROC           PROCESS COMMENT RECORD                       
*                                                                               
         CLI   QUCCODE,0           ANY QUARTERLY COMMENT TO PROC?               
         BE    LEGW90                                                           
         MVI   LWBYTE1,X'46'       QUARTERLY COMMENT RECORD CODE                
         MVC   LWBYTE2,QUCCODE     QUARTERLY COMMENT CODE                       
         BAS   RE,LWPROC           PROCESS COMMENT RECORD                       
*                                                                               
LEGW90   DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(32),LWWORK      RESTORE ORIGINAL KEY                         
         J     EXIT                                                             
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
LWPROC   DS    0H                                                               
         ST    RE,LWFULL                                                        
         XC    KEY,KEY                                                          
         MVC   KEY(2),QAGENCY                                                   
         MVC   KEY+2(1),QMEDIA                                                  
         MVC   KEY+3(1),LWBYTE1    COMMENT RECORD CODE                          
         MVC   KEY+4(3),QCLIENT                                                 
         MVC   KEY+7(1),LWBYTE2    COMMENT CODE                                 
         MVC   KEYSAVE,KEY                                                      
         BRAS  RE,HIPRT                                                         
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BE    LWPROC30            YES                                          
*                                                                               
         MVC   KEYSAVE+4(3),=X'FF4040'                                          
         MVC   KEYSAVE+5(1),PCLTOFF                                             
         MVC   KEY,KEYSAVE                                                      
         MVC   KEY+7(1),LWBYTE2    COMMENT CODE                                 
         BRAS  RE,HIPRT                                                         
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BE    LWPROC30            YES                                          
*                                                                               
         MVC   KEYSAVE+4(3),=X'FFFFFF'                                          
         MVC   KEY,KEYSAVE                                                      
         MVC   KEY+7(1),LWBYTE2    COMMENT CODE                                 
         BRAS  RE,HIPRT                                                         
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BNE   LWPROCX             NO                                           
*                                                                               
LWPROC30 LA    RE,LWWKREC          INITIALIZE RECORD AREA                       
         LA    RF,LWWKRECQ                                                      
         XCEF                                                                   
*                                                                               
         LA    R0,LWWKREC                                                       
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
         GOTO1 AIOPRNT             SKIP A LINE                                  
         LA    R2,LWWKREC+33                                                    
         MVI   ELCODE,X'40'                                                     
         CLC   ELCODE,0(R2)        FIRST ELEM IS X'40'?                         
         BE    LWPROC50            YES, PROCESS IT                              
*                                                                               
LWPROC40 BRAS  RE,NXTEL                                                         
         BNE   LWPROCX                                                          
LWPROC50 GOTO1 ACOMLIN,DMCB,(R2)   PRINTING COMMENT LINE                        
         B     LWPROC40                                                         
*                                                                               
LWPROCX  L     RE,LWFULL                                                        
         BR    RE                                                               
*                                                                               
LWWKREC  DS    CL1200              RECORD AREA (ENOUGH FOR COMMENT REC)         
LWWKRECQ EQU   *-LWWKREC                                                        
*                                                                               
LWWORK   DS    CL32                GENERAL WORK AREA FOR LEGALW USE             
*                                                                               
LWFULL   DS    F                                                                
LWBYTE1  DS    C                                                                
LWBYTE2  DS    C                                                                
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
PHOUSE   NTR1  BASE=*,LABEL=*      PRINTING PRODUCTION HOUSE ITEMS              
*                                                                               
         CLI   PHOUSOPT,C'N'       PROFILE SAYS TO PRINT NOTHING?               
         JE    EXIT                                                             
*                                                                               
         LA    RE,PHOUSREC                                                      
         LA    RF,PHOUSRQ                                                       
         XCEF                                                                   
         MVC   PWKWORK(25),KEY     SAVE ORIGINAL KEY                            
         MVC   SVPHCODE,SPACES     PRODUCTION HOUSE CODE                        
         MVC   SVRPNAME,SPACES     REP NAME                                     
         MVC   SVRPTELN,SPACES     REP TEL NUMBER                               
         MVC   SVRPFAXN,SPACES     REP FAX NUMBER                               
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(16),PINSREC     AGY/MED/REC CODE/CLT/PRD/ADCODE              
         BRAS  RE,HIPRT                                                         
         CLC   KEY(16),KEYSAVE     RECORD FOUND?                                
         BNE   PHOUS80             NO SUCH PRODUCTION HOUSE CODE                
         LA    R0,PHOUSREC                                                      
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
*                                                                               
         LA    R2,PHOUSREC+33                                                   
         CLI   0(R2),X'15'                                                      
         BE    PHOUS20                                                          
         MVI   ELCODE,X'15'                                                     
         BRAS  RE,NXTEL                                                         
         BNE   PHOUS80                                                          
         USING PJOBELEM,R2                                                      
*                                                                               
PHOUS20  OC    PJOBPROD,PJOBPROD   PRODUCTION HOUSE CODE PRESENT?               
         BZ    PHOUS70             NOT PRESENT, NO NEED TO GO FURTHER           
         MVC   SVPHCODE,PJOBPROD   SAVE OFF PRODUCTION HOUSE CODE               
         DROP  R2                                                               
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(3),PINSREC      AGENCY AND MEDIA                             
         MVI   KEY+3,X'11'         REP RECORD CODE                              
         MVC   KEY+4(4),SVPHCODE   PRODUCTION HOUSE CODE (REP CODE)             
         BRAS  RE,HIPRT                                                         
         CLC   KEY(8),KEYSAVE      RECORD FOUND?                                
         BE    *+6                                                              
         DC    H'0'                BAD PRODUCTION HOUSE CODE DETECTED           
*                                                                               
         LA    R0,PHOUSREC                                                      
         ST    R0,AREC                                                          
         BRAS  RE,GETPRT                                                        
         BRAS  RE,TSTERR                                                        
         LA    R2,PHOUSREC+33                                                   
         MVI   ELCODE,X'11'                                                     
         CLC   ELCODE,0(R2)                                                     
         BE    PHOUS60                                                          
         BRAS  RE,NXTEL                                                         
         BNE   PHOUS70                                                          
         USING PREPELEM,R2                                                      
*                                                                               
PHOUS60  OC    PREPNAME,PREPNAME                                                
         BZ    *+10                                                             
         MVC   SVRPNAME,PREPNAME                                                
         OC    PREPTEL,PREPTEL                                                  
         BZ    *+10                                                             
         MVC   SVRPTELN,PREPTEL                                                 
         OC    PREPFAX,PREPFAX                                                  
         BZ    PHOUS70                                                          
         MVC   SVRPFAXN,PREPFAX    FAX NUM IS LEFT JUST AND NULL PADDED         
         CLC   PREPFAX(3),=C'FX='  NEED TO READ CONTROL FILE?                   
         BNE   PHOUS70                                                          
         DROP  R2                                                               
*                                                                               
         OC    SVRPFAXN+3(7),SVRPFAXN+3                                         
         BNZ   *+14                                                             
         MVC   SVRPFAXN,SPACES                                                  
         B     PHOUS70             NO VALID FAX CODE IS FOUND                   
         XC    KEY,KEY                                                          
         LA    RE,KEY                                                           
         USING CTFXKEY,RE                                                       
         MVI   CTFXKTYP,CTFXEQU    RECORD TYPE                                  
         MVC   CTFXAGY,QAGENCY                                                  
         MVC   CTFXCODE,SVRPFAXN+3                                              
         OC    CTFXCODE,SPACES     LEFT JUST AND SPACE PADDED                   
         DROP  RE                                                               
*                                                                               
         MVC   KEYSAVE,KEY                                                      
         GOTO1 DATAMGR,DMCB,(0,=C'DMREAD'),=C'CTFILE',KEY,PHOUSREC              
*                                                                               
         MVC   SVRPFAXN,SPACES                                                  
         CLC   KEY(18),KEYSAVE     COMPARE UP TO FAX CODE                       
         BNE   PHOUS70             FAX CODE IS NOT FOUND IN CNTL FILE           
         LA    R2,PHOUSREC+28      POINT TO FIRST ELEM IN CNTL FILE             
         MVI   ELCODE,CTFX1ELQ                                                  
         CLC   ELCODE,0(R2)        FIRST ELEM IS CNTL FILE FAX NUM?             
         BE    *+12                                                             
         BRAS  RE,NXTEL                                                         
         BNE   PHOUS70                                                          
         ZIC   RE,1(R2)                                                         
         AHI   RE,-3               2 FOR ELEM OVERHEAD AND 1 FOR EX             
         CHI   RE,0                                                             
         BNL   *+6                                                              
         DC    H'0'                BAD ELEM LENGTH IN CNTL FILE                 
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   SVRPFAXN(0),2(R2)   GET FAX NUMBER IN CNTL FILE                  
*                                                                               
PHOUS70  CLC   SVPHCODE,SPACES     ANY PRODUCTION HOUSE CODE TO PRINT?          
         BE    PHOUS80             NO, DONE                                     
         MVC   P+05(24),=C'MATERIALS SHIPPED FROM: '                            
         MVC   P+29(25),=C'(REP NAME IS NOT DEFINED)'                           
         CLC   SVRPNAME,SPACES                                                  
         BE    *+16                                                             
         MVC   P+29(25),SPACES                                                  
         MVC   P+29(30),SVRPNAME                                                
         GOTO1 AIOPRNT                                                          
*                                                                               
         CLI   PHOUSOPT,C'T'       PROFILE SAYS TO PRINT TEL?                   
         BE    *+12                                                             
         CLI   PHOUSOPT,C'B'       BOTH TEL AND FAX?                            
         BNE   PHOUS75                                                          
         CLC   SVRPTELN,SPACES     NO TEL TO BE PRINTED?                        
         BE    PHOUS75                                                          
         OC    SVRPTELN,SPACES     GET RID OF TRAILING NULLS                    
         MVC   P+29(12),=C'TEL NUMBER: '                                        
         MVC   P+41(12),SVRPTELN                                                
         GOTO1 AIOPRNT                                                          
*                                                                               
PHOUS75  CLI   PHOUSOPT,C'F'       PROFILE SAYS TO PRINT FAX?                   
         BE    *+12                                                             
         CLI   PHOUSOPT,C'B'       BOTH TEL AND FAX?                            
         BNE   PHOUS80                                                          
         CLC   SVRPFAXN,SPACES     FAX TO BE PRINTED?                           
         BE    PHOUS80                                                          
         MVC   P+29(12),=C'FAX NUMBER: '                                        
         MVC   P+41(20),SVRPFAXN                                                
         GOTO1 AIOPRNT                                                          
*                                                                               
PHOUS80  DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(25),PWKWORK     RESTORE ORIGINAL KEY                         
*                                                                               
         J     EXIT                                                             
*                                                                               
PHOUSREC DS    CL1000                                                           
PHOUSRQ  EQU   *-PHOUSREC                                                       
*                                                                               
PWKWORK  DS    CL32                GENERAL WORK AREA FOR IOCOMPRT USE           
SVPHCODE DS    CL4                                                              
SVRPNAME DS    CL30                                                             
SVRPTELN DS    CL12                                                             
SVRPFAXN DS    CL20                                                             
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         PRINT OFF                                                              
*                                                                               
* DICTIONARY FOR PP72PINS AND NLPINSOR                                          
*                                                                               
       ++INCLUDE PPIOPIND                                                       
         EJECT                                                                  
*                                                                               
PUBAOVD  DSECT                                                                  
       ++INCLUDE PUBAOVEL                                                       
         EJECT                                                                  
*                                                                               
PGETADRD DSECT                                                                  
       ++INCLUDE PPGETADRD                                                      
         EJECT                                                                  
*                                                                               
PUBREPD  DSECT                                                                  
       ++INCLUDE PUBREPEL                                                       
         EJECT                                                                  
*                                                                               
PCONRECD DSECT                                                                  
       ++INCLUDE PCONREC                                                        
         EJECT                                                                  
*                                                                               
PIOCOMD  DSECT                                                                  
       ++INCLUDE PIOCREC                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE T413WKA                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE POLFILE                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE T413WKB                                                        
         EJECT                                                                  
*                                                                               
       ++INCLUDE CTGENFAX          FOR FAX CODE LOOK UPS IN CNTL FILE           
         EJECT                                                                  
*                                                                               
         PRINT ON                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'064NLPINSOR  01/19/12'                                      
         END                                                                    

*          DATA SET PP6602CM   AT LEVEL 009 AS OF 05/01/02                      
*CATALP PP6602C                                                                 
ESMONTHS CSECT                                                                  
*                                                                               
         ENTRY JOBLST                                                           
*                                                                               
         NMOD1 0,ESMONTHS                                                       
         USING PPWORKD,RA          RA=V(PPWROKC)                                
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9       R9=RC+4096                                   
         USING PP66WRKD,R8         R8=A(PP66WRKC)                               
*                                                                               
         MVC   WORK(12),QSTART                                                  
         CLI   QBPDATE,C' '        TEST PAY/BILL FILTER REQUEST                 
         BE    ESM1                NO                                           
         CLC   QEST,SPACES         TEST HAVE EST                                
         BE    ESM1                                                             
         CLC   QESTEND,SPACES                                                   
         BNE   ESM1                                                             
         MVC   WORK(12),PESTST     IF YES, USE EST DATES                        
*                                                                               
ESM1     DS    0H                                                               
         GOTO1 DTCNV,DMCB,WORK,(1,BSTART)                                       
         GOTO1 (RF),(R1),WORK+6,(1,BEND)                                        
*                                                                               
         XC    RMTAB,RMTAB                                                      
* START BACK 6 MONTHS                                                           
         LA    R2,RMTAB+10         THIS IS FIRST MONTH BACK                     
         SR    R0,R0                                                            
         IC    R0,BSTART                                                        
         SR    R1,R1                                                            
         IC    R1,BSTART+1                                                      
         LA    RE,6                                                             
ESM2     BCTR  R1,0                                                             
         LTR   R1,R1                                                            
         BP    *+10                                                             
         BCTR  R0,0                                                             
         LA    R1,12                                                            
         STC   R0,0(R2)                                                         
         STC   R1,1(R2)                                                         
         SH    R2,=H'2'                                                         
         BCT   RE,ESM2                                                          
* NOW GO FORWARD TO END DATE                                                    
         LA    R2,RMTAB+12                                                      
         IC    R0,BSTART                                                        
         IC    R1,BSTART+1                                                      
         LA    RE,12               MAX 12 MONTHS                                
         B     ESM4A                                                            
ESM4     LA    R1,1(R1)                                                         
         CH    R1,=H'12'                                                        
         BNH   *+12                                                             
         AH    R0,=H'1'                                                         
         LA    R1,1                                                             
ESM4A    STC   R0,0(R2)                                                         
         STC   R1,1(R2)                                                         
         CLC   0(2,R2),BEND                                                     
         BE    ESM6                                                             
         LA    R2,2(R2)                                                         
         BCT   RE,ESM4                                                          
         B     *+8                                                              
* NOW GO FORWARD 3 MONTHS                                                       
ESM6     LA    R2,2(R2)            SET NEXT OUTPUT POSITION                     
         LA    RE,3                                                             
ESM6A    LA    R1,1(R1)                                                         
         CH    R1,=H'12'                                                        
         BNH   *+12                                                             
         AH    R0,=H'1'                                                         
         LA    R1,1                                                             
ESM6B    STC   R0,0(R2)                                                         
         STC   R1,1(R2)                                                         
         LA    R2,2(R2)                                                         
         BCT   RE,ESM6A                                                         
*                                                                               
*                                  PROCESS PROFILES                             
         OC    PROF,PROF                                                        
         BNZ   ESM20                                                            
         MVC   PROF,PCLTPROF                                                    
         CLC   QEST,SPACES                                                      
         BE    ESM20                                                            
         CLC   QESTEND,SPACES                                                   
         BNE   ESM20                                                            
         CLI   PESTPROF+18,C'0'                                                 
         BE    *+10                                                             
         MVC   PROF,PESTPROF                                                    
ESM20    DS    0H                                                               
         XC    ESCTL,ESCTL                                                      
*                                                                               
         LA    R3,DETLST                                                        
ESM21    CLC   0(1,R3),PROF+19                                                  
         BE    ESM22                                                            
         CLI   0(R3),C' '                                                       
         BE    ESM22                                                            
         LA    R3,4(R3)                                                         
         B     ESM21                                                            
ESM22    MVC   ESCDETS,1(R3)            DETAIL $                                
         LA    R3,DATLST                                                        
ESM23    CLC   0(1,R3),PROF+20                                                  
         BE    ESM24                                                            
         CLI   0(R3),C' '                                                       
         BE    ESM24                                                            
         LA    R3,3(R3)                                                         
         B     ESM23                                                            
ESM24    MVC   ESCDATS,1(R3)            DATES                                   
         LA    R3,SUMLST                                                        
ESM25    CLC   0(1,R3),PROF+23                                                  
         BE    ESM26                                                            
         CLI   0(R3),C' '                                                       
         BE    ESM26                                                            
         LA    R3,6(R3)                                                         
         B     ESM25                                                            
ESM26    MVC   ESCSUMS,1(R3)            SUMMARY $                               
         CLI   QOPT6,C'A'          AUDIT                                        
         BE    *+8                                                              
         MVI   ESCSUMS+1,6         ALTER $ FOR FORECAST                         
         MVC   ESCPBAD,PROF+21          PUB ADDR                                
         MVC   ESCCONC,PROF+22          CONTRACT CTL                            
         CLI   QPUB,C' '           SEE IF DOING ONE PUB                         
         BNE   ESM26B                                                           
         CLC   QPUB+1(3),=C'   '   ASPO - SO SET FOR NO CONTRACT INFO           
         BE    *+8                                                              
         MVI   ESCCONC,C'N'                                                     
ESM26B   MVC   ESCLINS,PROF+24                                                  
         CLI   PROF+24,C'0'             LINES                                   
         BE    ESM27                                                            
         OI    ESCLINS,X'01'       SET PUB LINE TOTS                            
ESM27    MVC   ESCOS,PROF+25            OS NOT INS SUMMARY                      
*                                                                               
***      MVC   ESCCENTS,PCLTPROF+18                                             
***      CLI   ESCCENTS,C'1'                                                    
***      BNE   *+8                                                              
*NO-OP   MVI   ESCCENTS,C'$'       NO CENTS FOR PP66                            
***                                QTR TOTS OPT                                 
         MVI   ESCQTRS,0                                                        
         CLI   PROF+26,C'0'                                                     
         BE    ESM27D                                                           
         MVI   ESCQTRS,1                                                        
         CLI   PROF+26,C'Q'                                                     
         BE    ESM27D                                                           
         SR    R1,R1                                                            
         IC    R1,PROF+26                                                       
         SR    R0,R0                                                            
         D     R0,=F'3'                                                         
         LTR   R0,R0                                                            
         BNZ   *+8                                                              
         LA    R0,3                                                             
         STC   R0,ESCQTRS          1,2,3 = JAN,FEB,MAR                          
ESM27D   DS    0H                                                               
         MVC   ESCPBTOT,PROF+27         PUB TOTS + 1 PUB PER PAGE               
         MVC   ESCPBREC,PROF+28         PUB RECAP ON SUMMARIES                  
*                                                                               
         CLC   QPUB+1(3),=C'ALL'    SET TO DO ASPO RECAP                        
         BNE   *+8                                                              
         MVI   ESCPBREC,C'A'                                                    
*                                                                               
         MVC   ESCCIRC,PROF+30     CIRC CONTROL                                 
         MVI   ESCJOB,C'0'                                                      
         CLI   QOPT7,C' '                                                       
         BE    *+10                                                             
         MVC   ESCJOB,QOPT7        AD NO. OPTION                                
*                                                                               
         MVC   ESCSUMSB,ESCSUMS                                                 
         CLI   PROF+29,C'0'                                                     
         BE    ESM40               NO BUDGET                                    
         CLI   QOPT1,C'S'          OPTION TO SUPPRESS BUDG                      
         BE    ESM40                                                            
         MVI   ESCBUDG,X'01'       MONTHLY                                      
         CLI   PROF+29,C'3'                                                     
         BNE   *+8                                                              
         MVI   ESCBUDG,X'02'       YEARLY                                       
         MVI   BYTE,1              GROSS                                        
         CLI   PCLTPROF+14,C'N'                                                 
         BNE   *+12                                                             
         OI    ESCBUDG,X'80'       NET NOT GROSS                                
         MVI   BYTE,2              NET                                          
         TM    ESCBUDG,X'01'                                                    
         BZ    ESM40                                                            
*                                  IF MONTHLY BUDGET FIX ESCSUMS                
         MVC   WORK(5),ESCSUMS                                                  
         LA    R2,ESCSUMS                                                       
         LA    R3,5                                                             
ESM28    CLC   BYTE,0(R2)                                                       
         BE    ESM29                                                            
         CLI   0(R2),0                                                          
         BE    ESM28A                                                           
         LA    R2,1(R2)                                                         
         BCT   R3,ESM28                                                         
ESM28A   LA    R2,ESCSUMS                                                       
ESM29    MVC   1(2,R2),=X'0A0C'         GROSS                                   
         TM    ESCBUDG,X'80'                                                    
         BZ    *+10                                                             
         MVC   1(2,R2),=X'0B0D'         NET                                     
         LR    R3,R2                                                            
         LA    R2,2(R2)                                                         
         CLI   PROF+29,C'1'             TEST DIFF OPT                           
         BE    *+8                      NO                                      
         LA    R2,1(R2)                                                         
         LA    R0,ESCSUMS                                                       
         SR    R3,R0                                                            
         LA    R3,WORK+1(R3)                                                    
         LA    R4,ESCSUMS+4                                                     
         SR    R4,R2                                                            
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R3)            SHIFT OVER 1 OR 2                       
*                                                                               
*                                  HEADLINES                                    
*                                                                               
ESM40    MVC   MYHEAD8,SPACES                                                   
         MVC   MYHEAD9,SPACES                                                   
         MVC   MYHEAD10,SPACES                                                  
         MVC   MYSUMHD8,SPACES                                                  
         MVC   MYSUMH10,SPACES                                                  
         MVC   MYSUMH11,SPACES                                                  
         MVC   MYSUMH12,SPACES                                                  
         MVC   MYSMBH10,SPACES                                                  
         MVC   MYSMBH11,SPACES                                                  
         MVC   MYSMBH12,SPACES                                                  
         CLI   QMEDIA,C'N'                                                      
         BNE   ESM60                                                            
*                                       NEWS                                    
         MVC   MYHEAD9+1(11),=C'PUBLICATION'                                    
         MVC   MYHEAD10+1(11),DASHES                                            
         MVC   MYHEAD8+39(9),=C'INSERTION'                                      
         MVC   MYHEAD9+41(4),=C'DATE'                                           
         MVC   MYHEAD10+39(08),DASHES                                           
         MVC   MYHEAD9+48(5),=C'SPACE'                                          
         MVC   MYHEAD10+48(5),DASHES                                            
         MVC   MYHEAD9+56(4),=C'RATE'                                           
         MVC   MYHEAD10+56(4),DASHES                                            
*                                  REST SAME AS MAGS                            
         B     ESM63D                                                           
*                                  MAGS                                         
*                                                                               
ESM60    DS    0H                                                               
         CLI   QMEDIA,C'O'                                                      
         BE    ESM62                                                            
         MVC   MYHEAD9+1(11),=C'PUBLICATION'                                    
         MVC   MYHEAD10+1(11),DASHES                                            
         MVC   MYHEAD8+39(9),=C'INSERTION'                                      
         MVC   MYHEAD9+41(4),=C'DATE'                                           
         MVC   MYHEAD10+39(08),DASHES                                           
         B     ESM63                                                            
*                                                                               
*                                  OUTDORR                                      
ESM62    DS    0H                                                               
         MVC   MYHEAD9+1(6),=C'VENDOR'                                          
         MVC   MYHEAD8+39(7),=C'POSTING'                                        
         MVC   MYHEAD9+41(4),=C'DATE'                                           
         MVC   MYHEAD10+1(6),DASHES                                             
         MVC   MYHEAD10+39(7),DASHES                                            
*                                                                               
*                                                                               
ESM63    DS    0H                                                               
         CLI   ESCDETS,0                                                        
         BNE   ESM64                                                            
*                                  NO 3RD $                                     
         CLI   QMEDIA,C'O'                                                      
         BNE   ESM63B                                                           
         CLI   PESTPROF+5,C'N'                                                  
         BNE   ESM63B                                                           
*                                  NEW OUTDOOR                                  
         MVC   MYHEAD8+48(16),=C'SIZE  -DISPLAYS-'                              
         MVC   MYHEAD9+48(16),=C'SHOW  REG  ILLUM'                              
         MVC   MYHEAD10+48(16),=C'----  ---  -----'                             
         B     ESM63D                                                           
*                                                                               
ESM63B   DS    0H                                                               
         MVC   MYHEAD9+48(17),=C'SPACE DESCRIPTION'                             
         MVC   MYHEAD10+48(17),DASHES                                           
ESM63D   DS    0H                                                               
         LA    R4,MYHEAD8+66                                                    
         LA    R3,17                                                            
         BAS   RE,FILLHEAD                                                      
         CLI   QOPT6,C'A'          AUDIT                                        
         BNE   ESM63F                                                           
         LA    R4,MYHEAD8+77                                                    
         LA    R3,18                                                            
         BAS   RE,FILLHEAD                                                      
         LA    R4,MYHEAD8+86                                                    
         LA    R3,19                                                            
         BAS   RE,FILLHEAD                                                      
         B     ESM63G                                                           
*                                                                               
ESM63F   LA    R4,MYHEAD8+86                                                    
         MVC   ESCDETS+1(1),ESCDETS+2                                           
         MVI   ESCDETS+2,6         ALTER $ FOR FORECAST                         
         SR    R3,R3                                                            
         IC    R3,ESCDETS+1                                                     
         BAS   RE,FILLHEAD                                                      
         SR    R3,R3                                                            
         IC    R3,ESCDETS+2                                                     
         LA    R4,MYHEAD8+98                                                    
         B     ESM63H                                                           
*                                                                               
ESM63G   LA    R4,MYHEAD8+98                                                    
         SR    R3,R3                                                            
         IC    R3,ESCDETS+2                                                     
ESM63H   BAS   RE,FILLHEAD                                                      
         B     ESM70                                                            
*                                       3 $ ON DETAIL                           
ESM64    LA    R4,MYHEAD8+55                                                    
         SR    R3,R3                                                            
         IC    R3,ESCDATS                                                       
         BAS   RE,FILLHEAD                                                      
         LA    R4,MYHEAD8+61                                                    
         SR    R3,R3                                                            
         IC    R3,ESCDATS+1                                                     
         BAS   RE,FILLHEAD                                                      
         CLI   QMEDIA,C'O'                                                      
         BNE   ESM64B                                                           
         CLI   PESTPROF+5,C'N'                                                  
         BE    ESM65                                                            
ESM64B   DS    0H                                                               
         MVC   MYHEAD9+48(5),=C'SPACE'                                          
         MVC   MYHEAD10+48(5),DASHES                                            
         CLI   ESCDATS,0                                                        
         BNE   ESM67                                                            
         MVC   MYHEAD9+54(5),=C'DESC.'                                          
         MVC   MYHEAD10+53(6),DASHES                                            
         CLI   ESCDATS+1,0                                                      
         BNE   ESM67                                                            
         MVC   MYHEAD9+58(7),=C'RIPTION'                                        
         MVC   MYHEAD10+58(7),DASHES                                            
         B     ESM67                                                            
ESM65    DS    0H                                                               
         OC    ESCDATS,ESCDATS                                                  
         BNZ   ESM67                                                            
         MVC   MYHEAD8+48(16),=C'SIZE  -DISPLAYS-'                              
         MVC   MYHEAD9+48(16),=C'SHOW  REG  ILLUM'                              
         MVC   MYHEAD10+48(16),=C'----  ---  -----'                             
ESM67    DS    0H                                                               
         MVC   MYHEAD8+68(4),=C'BILL'                                           
         MVC   MYHEAD9+67(5),=C'MONTH'                                          
         MVC   MYHEAD10+67(5),DASHES                                            
         LA    R4,MYHEAD8+74                                                    
         SR    R3,R3                                                            
         IC    R3,ESCDETS                                                       
         BAS   RE,FILLHEAD                                                      
         LA    R4,12(R4)                                                        
         SR    R3,R3                                                            
         IC    R3,ESCDETS+1                                                     
         BAS   RE,FILLHEAD                                                      
         LA    R4,12(R4)                                                        
         SR    R3,R3                                                            
         IC    R3,ESCDETS+2                                                     
         BAS   RE,FILLHEAD                                                      
*                                                                               
*                                  SET PRD-EST HEADLINE                         
ESM70    DS    0H                                                               
ESM72B   DS    0H                                                               
         MVI   PRDESTSW,C'B'       BOTH, AGY-PRD                                
         MVC   MYHEAD9+31(7),=C'AGY-PRD'                                        
         MVC   MYHEAD10+31(7),DASHES                                            
ESM74    DS    0H                                                               
         LA    R6,2                                                             
         LA    R4,MYSUMH10+37                                                   
         LA    R5,ESCSUMS                                                       
ESM74A   DS    0H                                                               
         LA    R0,5                                                             
ESM76    SR    R3,R3                                                            
         IC    R3,0(R5)                                                         
         LTR   R3,R3                                                            
         BZ    ESM78                                                            
         BAS   RE,FILLHEAD                                                      
         LA    R4,15(R4)                                                        
         LA    R5,1(R5)                                                         
         BCT   R0,ESM76                                                         
         B     ESM79               NO ROOM FOR LINES                            
ESM78    TM    ESCLINS,X'02'       TEST LINES ON SUMMARY                        
         BZ    ESM79                                                            
         LA    R3,16               POSTINGS                                     
         CLI   QMEDIA,C'O'                                                      
         BE    ESM78A                                                           
         LA    R3,14               INSERTIONS                                   
         CLI   QMEDIA,C'N'                                                      
         BNE   ESM78A                                                           
         LA    R3,9                LINES                                        
         TM    ESCLINS,X'20'                                                    
         BNZ   *+8                                                              
         LA    R3,15               INCHES                                       
ESM78A   DS    0H                                                               
         BAS   RE,FILLHEAD                                                      
*                                                                               
ESM79    LA    R4,MYSMBH10+37                                                   
         LA    R5,ESCSUMSB                                                      
         BCT   R6,ESM74A                                                        
*                                                                               
ESM80    DS    0H                                                               
*                                  SET MEDIA NAME AND UNDERLINE                 
         MVC   MEDIANM,SPACES                                                   
         MVC   MEDIAUL,SPACES                                                   
         MVC   WORK(25),SPACES                                                  
         MVC   WORK(10),PAGYMED                                                 
         LA    R4,WORK+9                                                        
         OI    0(R4),C' '                                                       
         CLI   0(R4),C' '                                                       
         BNE   *+8                                                              
         BCT   R4,*-12                                                          
         MVC   2(5,R4),=C'AUDIT'                                                
         CLI   QOPT6,C'A'          SEE IF DOING AN AUDIT                        
         BNE   ESM80D                                                           
         CLC   QPUB+1(3),=C'ALL'                                                
         BE    ESM80A                                                           
         CLI   QPUB,C' '           SEE IF DOING ONE PUB                         
         BNE   ESM80AA                                                          
         CLC   QPUB+1(3),=C'   '                                                
         BNE   ESM80A              DOING ONE ASPO                               
ESM80AA  LA    R4,6(R4)                                                         
         B     ESM80H                                                           
*                                                                               
ESM80A   MVC   2(10,R4),=C'ASPO AUDIT'                                          
         LA    R4,11(R4)                                                        
         B     ESM80H                                                           
*                                                                               
ESM80D   MVC   2(8,R4),=C'FORECAST'                                             
         CLC   QPUB+1(3),=C'ALL'                                                
         BE    ESM80E                                                           
         CLI   QPUB,C' '           SEE IF DOING ONE PUB                         
         BNE   ESM80DA                                                          
         CLC   QPUB+1(3),=C'   '                                                
         BNE   ESM80E              DOING ONE ASPO                               
ESM80DA  LA    R4,9(R4)                                                         
         B     ESM80H                                                           
*                                                                               
ESM80E   MVC   2(13,R4),=C'ASPO FORECAST'                                       
         LA    R4,14(R4)                                                        
*                                                                               
ESM80H   DS    0H                                                               
         LA    R0,WORK-1                                                        
         SR    R4,R0                                                            
         LA    R5,25                                                            
         SR    R5,R4                                                            
         SRL   R5,1                                                             
         LA    R6,MEDIANM(R5)                                                   
         BCTR  R4,R0                                                            
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R6),WORK                                                     
         LA    R6,MEDIAUL(R5)                                                   
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R6),DASHES                                                   
*                                                                               
         MVC   PERHD,SPACES                                                     
         CLI   QBPDATE,C' '                                                     
         BE    ESM80B                                                           
         MVC   PERHD,=C' *** BILLING PERIOD ***  '                              
         CLI   QBPDATE,C'B'                                                     
         BE    ESM80B                                                           
         MVC   PERHD,=C' *** PAYABLE PERIOD ***  '                              
         CLI   QBPDATE,C'P'                                                     
         BE    ESM80B                                                           
         MVC   PERHD,=C' *** ON-SALE DATES ***   '                              
         CLI   QBPDATE,C'S'                                                     
         BE    ESM80B                                                           
         MVC   PERHD,=C' *** CLOSING DATES ***   '                              
         CLI   QBPDATE,C'C'                                                     
         BE    ESM80B                                                           
*                                                                               
ESM80B   DS    0H                                                               
*                                                                               
         CLI   ESCPBREC,C'0'                                                    
         BE    ESM90                                                            
         MVC   PBHEAD10,SPACES                                                  
         MVC   PBHEAD11,SPACES                                                  
         MVC   PBHEAD12,SPACES                                                  
         CLI   ESCPBREC,C'A'                                                    
         BE    ESM81B                                                           
         CLI   QMEDIA,C'N'                                                      
         BE    ESM81                                                            
         CLI   QMEDIA,C'O'                                                      
         BNE   ESM80C                                                           
         MVC   PBHEAD11+03(06),=C'VENDOR'        OUTDOOR                        
         MVC   PBHEAD12+03(06),DASHES                                           
         MVC   PBHEAD11+24(11),=C'VENDOR CODE'                                  
         MVC   PBHEAD12+24(11),DASHES                                           
         CLI   PESTPROF+5,C'N'                                                  
         BNE   ESM80J                                                           
         MVC   PBHEAD10+45(16),=C'SIZE  -DISPLAYS-'                             
         MVC   PBHEAD11+45(16),=C'SHOW  REG  ILLUM'                             
         MVC   PBHEAD12+45(16),=C'----  ---  -----'                             
         B     ESM82                                                            
ESM80C   DS    0H                                                               
         MVC   PBHEAD11+03(11),=C'PUBLICATION'                                  
         MVC   PBHEAD12+03(11),DASHES                                           
         MVC   PBHEAD11+24(08),=C'PUB CODE'                                     
         MVC   PBHEAD12+24(08),DASHES                                           
ESM80J   DS    0H                                                               
         MVC   PBHEAD11+45(17),=C'SPACE DESCRIPTION'                            
         MVC   PBHEAD12+45(17),DASHES                                           
         B     ESM82                                                            
*                                                                               
ESM81    MVC   PBHEAD11+03(08),=C'ST, CITY'                                     
         MVC   PBHEAD12+03(08),DASHES                                           
         MVC   PBHEAD11+24(11),=C'PUBLICATION'                                  
         MVC   PBHEAD12+24(11),DASHES                                           
         MVC   PBHEAD11+45(08),=C'PUB CODE'                                     
         MVC   PBHEAD12+45(08),DASHES                                           
*                                                                               
         B     ESM82                                                            
*                                                                               
ESM81B   DS    0H                                                               
         MVC   PBHEAD11+24(11),=C'ASPO NUMBER'                                  
         MVC   PBHEAD12+24(11),DASHES                                           
ESM82    LA    R4,PBHEAD10+67                                                   
         LA    R5,ESCDETS                                                       
         LA    R6,3                                                             
ESM83    DS    0H                                                               
         CLI   0(R5),1             GROSS                                        
         BE    ESM85                                                            
         CLI   0(R5),2             NET                                          
         BE    ESM85                                                            
         CLI   0(R5),5             N-CD                                         
         BE    ESM85                                                            
ESM84    LA    R5,1(R5)                                                         
         BCT   R6,ESM83                                                         
         B     ESM86                                                            
ESM85    SR    R3,R3                                                            
         IC    R3,0(R5)                                                         
         BAS   RE,FILLHEAD                                                      
         LA    R4,15(R4)                                                        
         B     ESM84                                                            
*                                                                               
ESM86    DS    0H                                                               
         CLI   ESCLINS,C'0'                                                     
         BZ    ESM90                                                            
         LA    R3,16               POSTINGS                                     
         CLI   QMEDIA,C'O'                                                      
         BE    ESM86A                                                           
         LA    R3,14               INSERTIONS                                   
         CLI   QMEDIA,C'N'                                                      
         BNE   ESM86A                                                           
         LA    R3,9                LINES                                        
         TM    ESCLINS,X'20'                                                    
         BNZ   *+8                                                              
         LA    R3,15               INCHES                                       
ESM86A   DS    0H                                                               
         BAS   RE,FILLHEAD                                                      
*                                                                               
ESM90    DS    0H                                                               
         SPACE 2                                                                
         XMOD1 1                                                                
         SPACE 3                                                                
FILLHEAD LTR   R3,R3                                                            
         BZR   RE                                                               
         MH    R3,=H'30'                                                        
         LA    R3,HEADWDS-30(R3)                                                
         MVC   000(10,R4),00(R3)                                                
         MVC   132(10,R4),10(R3)                                                
         MVC   264(10,R4),20(R3)                                                
         BR    RE                                                               
*                                                                               
         SPACE                                                                  
*                                                                               
*                                                                               
DATLST   DC    C'1',X'0806'        P + C                                        
         DC    C'2',X'0607'        C + S                                        
         DC    C'3',X'0708'        S + P                                        
         DC    C'4',X'0008'        P                                            
         DC    C'5',X'0006'        C                                            
         DC    C'6',X'0007'        S                                            
         DC    C'7',X'0000'        NONE                                         
         DC    C' ',X'0607'        C + S DEFAULT                                
*                                                                               
DETLST   DC    C'1',X'000100'      G                                            
         DC    C'2',X'000103'      G + CD                                       
         DC    C'3',X'000200'      N                                            
         DC    C'4',X'000203'      N + CD                                       
         DC    C'5',X'000102'      G + N                                        
         DC    C'6',X'010203'      G + N + CD                                   
         DC    C'7',X'010304'      G + CD + G-CD                                
         DC    C'8',X'020305'      N+ CD + N-CD                                 
         DC    C'A',X'000005'      N-CD                                         
         DC    C' ',X'000103'      G + CD  DEFAULT                              
*                                                                               
SUMLST   DC    C'1',X'0100000000'       G                                       
         DC    C'2',X'0103040000'       G + CD + G-CD                           
         DC    C'3',X'0200000000'       N                                       
         DC    C'4',X'0203050000'       N + CD + N-CD                           
         DC    C'5',X'0102000000'       G + N                                   
         DC    C'6',X'0102030405'       G + N + CD + G-CD + N-CD                
         DC    C'7',X'0102030400'      G + N + CD + G-CD                        
         DC    C'A',X'0500000000'    N-CD                                       
         DC    C' ',X'0103040000'       G + CD + G-CD  DEFAULT                  
*                                                                               
*                                                                               
*                                                                               
*                                                                               
HEADWDS  DC    C'          '                                                    
         DC    C'GROSS COST'                                                    
         DC    C'----------'                                                    
         DC    C'          '                                                    
         DC    C'  NET COST'                                                    
         DC    C'  --------'                                                    
         DC    C'    CASH  '                                                    
         DC    C'  DISCOUNT'                                                    
         DC    C'  --------'                                                    
         DC    C'GROSS LESS'                                                    
         DC    C'CASH DISC.'                                                    
         DC    C'----------'                                                    
         DC    C' NET LESS '                                                    
         DC    C'CASH DISC.'                                                    
         DC    C'----------'                                                    
         DC    C'BILLED NET'                                                    
         DC    C' LESS C/D '                                                    
         DC    C'----------'                                                    
         DC    C' SALE     '                                                    
         DC    C' DATE     '                                                    
         DC    C' ----     '                                                    
         DC    C' PYBL     '                                                    
         DC    C' DATE     '                                                    
         DC    C' ----     '                                                    
         DC    C'          '                                                    
         DC    C'     LINES'                                                    
         DC    C'     -----'                                                    
         DC    C'AUTHORIZED'                                                    
         DC    C'  (GROSS) '                                                    
         DC    C'----------'                                                    
         DC    C'AUTHORIZED'                                                    
         DC    C'   (NET)  '                                                    
         DC    C'----------'                                                    
         DC    C'GROSS LESS'                                                    
         DC    C'AUTHORIZED'                                                    
         DC    C'----------'                                                    
         DC    C' NET LESS '                                                    
         DC    C'AUTHORIZED'                                                    
         DC    C'----------'                                                    
         DC    C'          '                                                    
         DC    C'INSERTIONS'                                                    
         DC    C'----------'                                                    
         DC    C'          '                                                    
         DC    C'    INCHES'                                                    
         DC    C'    ------'                                                    
         DC    C'          '                                                    
         DC    C'  POSTINGS'                                                    
         DC    C'  --------'                                                    
         DC    C' ASPO     '                                                    
         DC    C'NUMBER    '                                                    
         DC    C'------    '                                                    
         DC    C'INVOICE   '                                                    
         DC    C'NUMBER    '                                                    
         DC    C'-------   '                                                    
         DC    C'INVOICE   '                                                    
         DC    C' DATE     '                                                    
         DC    C'-------   '                                                    
*                                                                               
*                                                                               
         LTORG                                                                  
         TITLE 'PP5202 - GET + PRINT COMMENT'                                   
*                                  GET + PRINT COMMENT                          
         SPACE 2                                                                
COMPRT   CSECT                                                                  
         NMOD1 0,COMPRT                                                         
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
         MVC   SAVEP,P             HOLD PRINT LINES                             
         MVC   SAVEP2,PSECOND                                                   
         MVC   P,SPACES                                                         
         MVC   PSECOND,SPACES                                                   
         MVC   SAVESPC,SPACING                                                  
         CLI   COMSW,C'E'                                                       
         BNE   CP6                                                              
*                                                                               
CP2      DS    0H                                                               
         CLI   QEST,C' '                                                        
         BE    CP6                                                              
         CLI   QESTEND,C' '                                                     
         BNE   CP6                                                              
         CLI   PESTZZZ,C' '                                                     
         BNH   CP4                                                              
         CLI   COMSW,C'E'                                                       
         BNE   CP4                                                              
         MVC   P+1(19),=C'PRODUCT ALLOCATION='                                  
         MVC   P+21(47),PESTZZZ                                                 
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
CP4      DS    0H                                                               
         CLC   PESTCOM,SPACES                                                   
         BNH   CP6                                                              
         LA    R2,PESTCOM                                                       
         BAS   RE,COMPRT0                                                       
*                                                                               
CP6      DS    0H                                                               
CP10     DS    0H                                                               
         CLC   QPAY,SPACES                                                      
         BE    COMPRTXX                                                         
         LA    R2,QPAY                                                          
         BAS   RE,COMPRT0                                                       
         B     COMPRTXX                                                         
         SPACE 3                                                                
COMPRT0  NTR1                                                                   
         MVC   WORK(32),KEY        SAVE KEY FOR PPG                             
         XC    KEY,KEY                                                          
         MVC   KEY(3),QAGENCY                                                   
         MVI   KEY+3,X'40'                                                      
         MVC   WORK2+6(6),0(R2)                                                 
         MVC   WORK2(6),SPACES                                                  
         LA    R2,WORK2+6                                                       
         CLI   5(R2),C' '                                                       
         BNE   *+8                                                              
         BCT   R2,*-8                                                           
         MVC   KEY+4(6),0(R2)                                                   
         BAS   RE,COMHI                                                         
         CLC   KEY(10),KEYSAVE                                                  
         BNE   COMPRTX2                                                         
         BAS   RE,COMGET                                                        
*                                  RESTORE PPG READ                             
         MVC   KEY,WORK                                                         
         BAS   RE,COMHI                                                         
* NOTE - COMMENT REC READ INTO PLISREC                                          
COMPRT1  DS    0H                                                               
         LA    R2,PLISREC+33                                                    
COMPRT2  DS    0H                                                               
         CLI   0(R2),0             EOR                                          
         BE    COMPRTX                                                          
         CLI   0(R2),X'40'                                                      
         BE    COMPRT6                                                          
COMPRT4  DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         AR    R2,R0                                                            
         B     COMPRT2                                                          
COMPRT6  DS    0H                                                               
         LA    R4,2(R2)                                                         
         SR    R5,R5                                                            
         IC    R5,1(R2)                                                         
         SH    R5,=H'2'                                                         
         CLI   0(R4),C'+'                                                       
         BNE   COMPRT8                                                          
         MVC   SPACING,1(R4)                                                    
         NI    SPACING,X'0F'                                                    
         CLI   SPACING,3                                                        
         BNH   *+8                                                              
         MVI   SPACING,3                                                        
         CLI   SPACING,0                                                        
         BNE   *+8                                                              
         MVI   SPACING,1                                                        
         LA    R4,2(R4)                                                         
         SH    R5,=H'2'                                                         
         GOTO1 APRNT               DO SPACING                                   
COMPRT8  DS    0H                                                               
         LTR   R5,R5                                                            
         BNP   COMPRT4                                                          
         BCTR  R5,R0                                                            
         EX    R5,COMMVC                                                        
         MVI   SPACING,1                                                        
         GOTO1 APRNT                                                            
         B     COMPRT4                                                          
COMMVC   MVC   P+1(0),0(R4)                                                     
COMPRTX  DS    0H                                                               
         MVI   SPACING,2                                                        
         GOTO1 APRNT                                                            
*                                                                               
         B     COMPRTX2                                                         
COMPRTXX DS    0H                                                               
         MVC   P,SAVEP             RESTORE PRINT LINES                          
         MVC   PSECOND,SAVEP2                                                   
         MVC   SPACING,SAVESPC                                                  
COMPRTX2 DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
COMHI    MVC   KEYSAVE,KEY                                                      
         ST    RE,SAVERE                                                        
         GOTO1 DATAMGR,DMCB,(DMINBTS,DMRDHI),PRTDIR,KEY,KEY                     
         SPACE 1                                                                
         B     COMCHK                                                           
COMGET   ST    RE,SAVERE                                                        
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),PRTFILE,KEY+27,           X        
               PLISREC,DMWORK                                                   
         SPACE 1                                                                
COMCHK   DS    0H                                                               
         MVC   BYTE,DMCB+8                                                      
         NC    BYTE,DMOUTBTS                                                    
         BZ    *+6                                                              
         DC    H'0'                                                             
         L     RE,SAVERE                                                        
         BR    RE                                                               
         SPACE 3                                                                
         LTORG                                                                  
         TITLE 'PP6602 - WORKFILE MODULE'                                       
WFMOD    CSECT                                                                  
         NMOD1 0,**WFMOD                                                        
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
*                                                                               
         CLC   QPROG,=C'53'                                                     
         BE    WFEXIT                                                           
         BC    0,WFMOD2                                                         
         OI    *-3,X'F0'                                                        
*&&DO                                                                           
         OPENR PP66WF                                                           
*&&                                                                             
*&&OS                                                                           
         OPEN  (PP66WF,(OUTIN))                                                 
*&&                                                                             
*                                                                               
*                                                                               
WFMOD2   DS    0H                                                               
         XC    DSTBUD(8),DSTBUD                                                 
         XC    WFREC,WFREC                                                      
         CLI   ESCPBREC,C'A'       TEST DOING ASPO RECAP                        
         BNE   WFMOD2B                                                          
*                                                                               
         CLI   MODE,LBUYPRO        LAST FOR ASPO                                
         BE    WFASPT                                                           
         CLI   MODE,LBUYCLI                                                     
         BE    WFESTT                                                           
         B     WFEXIT                                                           
         B     WFESTT                                                           
*                                                                               
WFMOD2B  DS    0H                                                               
         CLI   LASTMODE,LBUYPUB                                                 
         BE    WFPUBT                                                           
         CLI   MODE,LBUYDST                                                     
         BE    WFDSTT                                                           
         CLI   MODE,LBUYREG                                                     
         BE    WFREGT                                                           
         CLI   MODE,LBUYMKT                                                     
         BE    WFMKTT                                                           
         B     WFESTT                                                           
*                                                                               
WFEXIT   XMOD1 1                                                                
*                                                                               
WFPUBT   DS    0H                                                               
         CLI   WFREGSW,C'R'                                                     
         BNE   WFPUBT1                                                          
         MVI   WFREGSW,0                                                        
*                                       REGION NAME                             
         MVC   WFREC(3),=C'RN '                                                 
         MVC   WFREC+3(3),PREGKREG                                              
         MVC   WFREC+6(20),PREGNAME                                             
         BAS   RE,WFWRITE                                                       
         BAS   RE,WFNOTE                                                        
         ST    R1,REGNOTE                                                       
         STH   R0,REGNOTE+4                                                     
WFPUBT1  DS    0H                                                               
         CLI   WFDSTSW,C'D'                                                     
         BNE   WFPUBT1B                                                         
         MVI   WFDSTSW,0                                                        
*                                       DISTRICT NAME                           
         MVC   WFREC(3),=C'DN '                                                 
         MVC   WFREC+3(3),PDSTKDST                                              
         MVC   WFREC+6(20),PDSTNAME                                             
         BAS   RE,WFWRITE                                                       
         BAS   RE,WFNOTE                                                        
         ST    R1,DSTNOTE                                                       
         STH   R0,DSTNOTE+4                                                     
*                                       PUB TOTALS                              
WFPUBT1B DS    0H                                                               
         CLI   ESCPBREC,C'0'                                                    
         BE    WFEXIT                                                           
         CLI   QMEDIA,C'N'                                                      
         BE    WFPUBT4                                                          
         MVC   WFREC(3),=C'PS '                                                 
         MVC   WFREC+23(6),SVPKPUB                                              
         MVC   WFREC+29(40),SVPNAME                                             
         L     R3,ASPCTAB                                                       
         LA    R4,40                                                            
         L     R5,ASPCTABX                                                      
WFPUBT2  CLI   0(R3),0                                                          
         BE    WFPUBT4                                                          
         MVC   WFREC+69(17),0(R3)                                               
         MVC   WFREC+3(20),20(R3)                                               
         BAS   RE,WFWRITE                                                       
         XC    WFREC+23(46),WFREC+23                                            
         XC    0(40,R3),0(R3)                                                   
         BXLE  R3,R4,WFPUBT2                                                    
*                                                                               
WFPUBT4  DS    0H                                                               
         MVC   WFREC(3),=C'ET '                                                 
         CLI   EDVENSW,C'E'                                                     
         BE    *+10                                                             
         MVC   WFREC(3),=C'VT '                                                 
         MVC   WFREC+3(20),WRITTOTS                                             
         MVC   WFREC+23(6),SVPKPUB                                              
         MVC   WFREC+29(20),SVPNAME                                             
         MVC   WFREC+49(20),SVPZNAME                                            
         MVC   WFREC+69(16),SVPCITY                                             
         MVC   WFREC+85(2),SVPSTATE                                             
         BAS   RE,WFWRITE                                                       
         B     WFEXIT                                                           
*                                  MARKET TOTALS                                
WFMKTT   DS    0H                                                               
         CLI   ESCPBREC,C'0'                                                    
         BE    WFEXIT                                                           
         MVC   WFREC(3),=C'MT '                                                 
         MVC   WFREC+3(20),WRITTOTS                                             
         MVC   WFREC+23(20),PUBZNAME                                            
         CLI   QMEDIA,C'O'                                                      
         BE    WFMKTT2                                                          
         MVC   WFREC+23(2),PUBSTATE                                             
         MVI   WFREC+25,C','                                                    
         MVC   WFREC+27(16),PUBCITY                                             
WFMKTT2  DS    0H                                                               
         BAS   RE,WFWRITE                                                       
         B     WFEXIT                                                           
*                                       DISTRICT TOTALS                         
WFDSTT   DS    0H                                                               
         CLI   WFDSTSW,C'D'        TEST DST ACTIVE                              
         BE    WFEXIT              NO                                           
         MVC   WFREC(3),=C'DT '                                                 
         MVC   WFREC+3(20),WRITTOTS                                             
         MVC   WFREC+23(3),PDSTKDST                                             
         MVC   WFREC+26(20),PDSTNAME                                            
         BAS   RE,WFWRITE                                                       
         CLI   ESCPBREC,C'0'                                                    
         BE    WFEXIT                                                           
         LA    R0,DSTNOTE                                                       
         BAS   RE,WFPOINT                                                       
         BAS   RE,WFPUBR                                                        
         B     WFEXIT                                                           
*                                       REGION TOTALS                           
WFREGT   DS    0H                                                               
         CLI   WFREGSW,C'R'        TEST REG ACTIVE                              
         BE    WFEXIT              NO                                           
         MVC   WFREC(3),=C'RT '                                                 
         MVC   WFREC+3(20),WRITTOTS                                             
         MVC   WFREC+23(3),PREGKREG                                             
         MVC   WFREC+26(20),PREGNAME                                            
         BAS   RE,WFWRITE                                                       
*                                                                               
         CLC   QDIST,=C'ALL'                                                    
         BNE   WFREGT2                                                          
         MVC   RDHEAD11,SPACES                                                  
         MVC   RDHEAD12,SPACES                                                  
         MVC   RDHEAD11+6(8),=C'DISTRICT'                                       
         MVC   RDHEAD12+6(8),=C'--------'                                       
         MVC   MYSUMHD8,SPACES                                                  
         MVC   MYSUMHD8+37(28),DSRCHD                                           
*                                                                               
         LA    R0,REGNOTE                                                       
         BAS   RE,WFPOINT                                                       
         BAS   RE,WFRDR                                                         
*                                                                               
WFREGT2  CLI   ESCPBREC,C'0'                                                    
         BE    WFEXIT                                                           
         LA    R0,REGNOTE                                                       
         BAS   RE,WFPOINT                                                       
         BAS   RE,WFPUBR                                                        
         B     WFEXIT                                                           
*                                       ESTIMATE TOTALS                         
WFESTT   MVC   WFREC(3),=C'GT '                                                 
         MVC   WFREC+3(20),WRITTOTS                                             
         BAS   RE,WFWRITE                                                       
*                                                                               
         MVC   MYSUMHD8,SPACES                                                  
         MVC   RDHEAD11,SPACES                                                  
         MVC   RDHEAD12,SPACES                                                  
         CLC   QREGION(6),=C'ALLALL'                                            
         BNE   WFESTT2                                                          
         MVC   RDHEAD11+3(15),=C'REGION/DISTRICT'                               
         MVC   RDHEAD12+3(15),=C'---------------'                               
         MVC   MYSUMHD8+37(28),RGDSRCHD                                         
         B     WFESTT6                                                          
*                                                                               
WFESTT2  CLC   QREGION,=C'ALL'                                                  
         BNE   WFESTT4                                                          
         MVC   RDHEAD11+3(6),=C'REGION'                                         
         MVC   RDHEAD12+3(6),=C'------'                                         
         MVC   MYSUMHD8+37(28),RGRCHD                                           
         B     WFESTT6                                                          
*                                                                               
WFESTT4  CLC   QDIST,=C'ALL'                                                    
         BNE   WFESTT8                                                          
         MVC   RDHEAD11+6(8),=C'DISTRICT'                                       
         MVC   RDHEAD12+6(8),=C'--------'                                       
         MVC   MYSUMHD8+37(28),DSRCHD                                           
WFESTT6  DS    0H                                                               
         BAS   RE,WFPOINS                                                       
         BAS   RE,WFRDR                                                         
WFESTT8  DS    0H                                                               
         CLI   ESCPBREC,C'0'                                                    
         BE    WFESTT10                                                         
         BAS   RE,WFPOINS                                                       
         BAS   RE,WFPUBR                                                        
*                                                                               
WFESTT10 BAS   RE,WFPOINS                                                       
         B     WFEXIT                                                           
         SPACE 2                                                                
WFASPT   DS    0H                                                               
         MVC   WFREC(3),=C'AT '                                                 
         MVC   WFREC+3(20),WRITTOTS                                             
         MVC   WFREC+23(13),BUYASPO                                             
         BAS   RE,WFWRITE                                                       
         B     WFEXIT                                                           
*                                                                               
         EJECT                                                                  
*                                  PUB RECAP                                    
         SPACE 2                                                                
WFPUBR   DS    0H                                                               
         ST    RE,SAVERE                                                        
         MVI   LASTEDVN,C'V'                                                    
         MVC   MYSUMHD8,SPACES                                                  
         CLI   ESCPBREC,C'A'                                                    
         BNE   WFPBR0                                                           
         MVC   MYSUMHD8+37(16),=C'** ASPO RECAP **'                             
         B     WFPBR0A                                                          
*                                                                               
WFPBR0   MVC   MYSUMHD8+37(28),PUBRCHD                                          
         CLI   QMEDIA,C'O'                                                      
         BNE   *+10                                                             
         MVC   MYSUMHD8+37(28),PUBRCHDV                                         
         CLI   ESCPBREC,C'2'       NEW PAGE OPT                                 
         BE    WFPBR1              YES                                          
WFPBR0A  SR    RE,RE          NEED 10 LINES TO START                            
         IC    RE,LINE                                                          
         LA    RE,10(RE)                                                        
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BNH   *+12                                                             
WFPBR1   DS    0H                                                               
         MVI   LINE,99                                                          
         B     WFPBR2                                                           
*                                                                               
         MVI   SPACING,2                                                        
         BAS   RE,WFPBREP                                                       
*                                                                               
         MVI   SPACING,2                                                        
         MVC   P,MYSUMHD8                                                       
         BAS   RE,WFPBREP                                                       
*                                                                               
         CLC   PBHEAD10,SPACES                                                  
         BE    *+14                                                             
         MVC   P,PBHEAD10                                                       
         BAS   RE,WFPBREP                                                       
         MVI   SPACING,1                                                        
         MVC   P,PBHEAD11                                                       
         MVC   PSECOND,PBHEAD12                                                 
         BAS   RE,WFPBREP                                                       
*                                                                               
WFPBR2   DS    0H                                                               
*                                                                               
WFPBR4   BAS   RE,WFREAD                                                        
         CLC   WFREC(2),=C'AT'                                                  
         BE    WFPBR15                                                          
         CLC   WFREC(2),=C'PS'                                                  
         BE    WFPBR5                                                           
         CLC   WFREC(2),=C'ET'                                                  
         BE    WFPBR6                                                           
         CLC   WFREC(2),=C'VT'                                                  
         BE    WFPBR6                                                           
         CLC   WFREC(2),=C'MT'                                                  
         BE    WFPBR7                                                           
         CLC   WFREC(2),=C'DN'                                                  
         BE    WFPBR8                                                           
         CLC   WFREC(2),=C'RN'                                                  
         BE    WFPBR10                                                          
         CLC   WFREC(2),=C'DT'                                                  
         BE    WFPBR12                                                          
         CLC   WFREC(2),=C'RT'                                                  
         BE    WFPBR14                                                          
         CLC   WFREC(2),=C'GT'                                                  
         BE    WFPBR16                                                          
         DC    H'0'                                                             
*                                  SPACE RECORD - MAGS ONLY                     
WFPBR5   DS    0H                                                               
         MVI   BYTE,0                                                           
         CLC   P,SPACES                                                         
         BE    *+8                                                              
         MVI   MAXLINES,99                                                      
         OC    WFREC+29(40),SPACES                                              
         OC    P+03(20),WFREC+29                                                
         MVC   P+45(17),WFREC+69                                                
         OC    WFREC+23(6),WFREC+23     24                                      
         BZ    WFPBR5B                                                          
         IC    R0,PAGYPROF+12                                                   
         GOTO1 APUBEDIT,DMCB,((R0),WFREC+23),P+24                               
*                                                                               
*                                                                               
*                                                                               
WFPBR5B  BAS   RE,WFPBFMT                                                       
         BAS   RE,WFPBREP                                                       
         MVC   P+03(20),WFREC+49        ZONE ON NEXT LINE                       
         B     WFPBR4                                                           
*                                                                               
WFPBR6   DS    0H                       PUB LINE                                
         CLI   QMEDIA,C'N'                                                      
         BNE   WFPBR6B                                                          
         MVI   BYTE,0                                                           
         CLI   WFREC,C'E'                                                       
         BE    WFPBR6C                                                          
         CLI   LASTEDVN,C'V'       WAS LAST A 'VEN' TOTAL                       
         BNE   WFPBR6B                                                          
         TM    ESCPBTOT,X'04'      TEST ED/VEN TOTS                             
         BZ    WFPBR6C             - ONLY VEN                                   
         MVI   BYTE,1                                                           
         MVI   SPACING,2                                                        
         B     WFPBR6C                                                          
WFPBR6B  DS    0H                                                               
         MVI   MAXLINES,99                                                      
         MVC   P+45(17),=C'**VENDOR TOTALS**'                                   
         CLI   WFREC,C'V'                                                       
         BE    *+10                                                             
         MVC   P+45(18),=C'**EDITION TOTALS**'                                  
         MVI   SPACING,2                                                        
         MVI   BYTE,1                                                           
         B     WFPBR6F                                                          
*                                                                               
WFPBR6C  MVC   P+03(2),WFREC+85         STATE                                   
         MVI   P+05,C','                                                        
         MVC   P+07(16),WFREC+69        CITY                                    
         MVC   P+24(20),WFREC+29                                                
         OC    WFREC+49(20),SPACES                                              
         MVC   PSECOND+24(20),WFREC+49  ZONE ON 2ND LINE                        
*                                                                               
WFPBR6D  DS    0H                                                               
         IC    R0,PAGYPROF+12                                                   
         GOTO1 APUBEDIT,DMCB,((R0),WFREC+23),P+45                               
*                                                                               
*                                                                               
WFPBR6F  DS    0H                                                               
         BAS   RE,WFPBFMT                                                       
         BAS   RE,WFPBREP                                                       
         MVC   LASTEDVN,WFREC      SAVE LAST EDIT OR VEN                        
         B     WFPBR4                                                           
*                                                                               
*                                  MARKET TOTALS                                
WFPBR7   DS    0H                                                               
         MVC   P+03(20),WFREC+23                                                
         MVC   P+24(17),=C'**MARKET TOTALS**'                                   
         MVI   BYTE,1                                                           
         MVC   SPACING,2                                                        
         BAS   RE,WFPBFMT                                                       
         BAS   RE,WFPBREP                                                       
         B     WFPBR4                                                           
WFPBR8   DS    0H                  DISTRIC NAME                                 
         CLI   MODE,LBUYDST                                                     
         BE    WFPBR4                                                           
*                                                                               
WFPBR8B  MVC   P+03(8),=C'DISTRICT'                                             
         MVC   P+12(3),WFREC+3                                                  
         MVC   P+17(20),WFREC+6                                                 
*                                                                               
         SR    RE,RE                                                            
         IC    RE,LINE                                                          
         LA    RE,3(RE)            NEED 3 LINES                                 
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BNH   *+8                                                              
         MVI   LINE,99                                                          
         MVI   SPACING,2                                                        
         BAS   RE,WFPBREP                                                       
         B     WFPBR4                                                           
*                                                                               
WFPBR10  DS    0H                  REGION NAME                                  
         CLI   MODE,LBUYDST                                                     
         BE    WFPBR4                                                           
         CLI   MODE,LBUYREG                                                     
         BE    WFPBR4                                                           
         MVI   SPACING,2                                                        
         MVC   P+03(6),=C'REGION'                                               
         MVC   P+12(3),WFREC+3                                                  
         MVC   P+17(20),WFREC+6                                                 
*                                                                               
         SR    RE,RE                                                            
         IC    RE,LINE                                                          
         LA    RE,5(RE)            NEED 5 LINES                                 
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BNH   *+8                                                              
         MVI   LINE,99                                                          
         BAS   RE,WFPBREP                                                       
         B     WFPBR4                                                           
*                                                                               
WFPBR12  DS    0H                  DISTRICT TOTAL                               
         MVC   P+24(19),=C'**DISTRICT TOTALS**'                                 
         MVI   BYTE,X'11'     X'10' BIT ON MEANS DIST OR HIGHER                 
         BAS   RE,WFPBFMT                                                       
         MVI   SPACING,2                                                        
         MVI   MAXLINES,99                                                      
         BAS   RE,WFPBREP                                                       
         CLI   MODE,LBUYDST                                                     
         BE    WFPBRX                                                           
         B     WFPBR4                                                           
*                                                                               
WFPBR14  DS    0H                  REGION TOTALS                                
         MVC   P+24(17),=C'**REGION TOTALS**'                                   
         MVI   BYTE,X'12'     X'10' BIT ON MEANS DIST OR HIGHER                 
         BAS   RE,WFPBFMT                                                       
         MVI   SPACING,2                                                        
         MVI   MAXLINES,99                                                      
         BAS   RE,WFPBREP                                                       
         CLI   MODE,LBUYREG                                                     
         BE    WFPBRX                                                           
         B     WFPBR4                                                           
*                                                                               
WFPBR15  DS    0H                                                               
         MVI   BYTE,0                                                           
         MVC   P+24(13),WFREC+23                                                
         BAS   RE,WFPBFMT                                                       
         BAS   RE,WFPBREP                                                       
         B     WFPBR4                                                           
*                                                                               
WFPBR16  DS    0H                                                               
         MVI   MAXLINES,99                                                      
         BAS   RE,WFPBREP                                                       
         MVI   BYTE,X'12'     X'10' BIT ON MEANS DIST OR HIGHER                 
         MVC   P+24(17),=C'**REPORT TOTALS**'                                   
         BAS   RE,WFPBFMT                                                       
         MVI   MAXLINES,99                                                      
         BAS   RE,WFPBREP                                                       
         B     WFPBRX                                                           
*                                                                               
WFPBRX   L     RE,SAVERE                                                        
         BR    RE                                                               
*                                                                               
WFPBREP  DS    0H                                                               
         MVC   HEAD8,MYSUMHD8                                                   
         MVC   HEAD10,PBHEAD10                                                  
         MVC   HEAD11,PBHEAD11                                                  
         MVC   HEAD12,PBHEAD12                                                  
         LR    R0,RE                                                            
         GOTO1 APRNT                                                            
*                                                                               
         MVC   MAXLINES,SAVEMAX                                                 
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
WFPBFMT  LR    R7,RE                                                            
         LA    R4,P+62                                                          
         LA    R5,ESCDETS                                                       
         LA    R6,3                                                             
WFPBFMT2 CLI   0(R5),1             GROSS                                        
         BE    WFPBFMT4                                                         
         CLI   0(R5),2                                                          
         BE    WFPBFMT5                                                         
         CLI   0(R5),5             N L CD                                       
         BE    WFPBFMT6                                                         
WFPBFMT3 LA    R5,1(R5)                                                         
         BCT   R6,WFPBFMT2                                                      
         B     WFPBFMTZ                                                         
*                                                                               
WFPBFMT4 LA    RF,WFPBGR                                                        
         B     WFPBFMTW                                                         
WFPBFMT5 LA    RF,WFPBNT                                                        
         B     WFPBFMTW                                                         
WFPBFMT6 LA    RF,WFPBNLC                                                       
WFPBFMTW BASR  RE,RF                                                            
         LA    R4,15(R4)                                                        
         B     WFPBFMT3                                                         
*                                                                               
WFPBFMTZ DS    0H                                                               
         TM    ESCLINS,X'01'       LINES                                        
         BZ    WFPBFMTX                                                         
         BAS   RE,WFPBLN                                                        
*                                                                               
WFPBFMTX LR    RE,R7                                                            
         BR    RE                                                               
*                                                                               
WFPBGR   MVC   FULL,WFREC+3        GROSS                                        
         L     R0,FULL                                                          
         B     WFPBEDT                                                          
*                                                                               
WFPBNT   MVC   FULL,WFREC+3        GROSS                                        
         L     R0,FULL                                                          
         MVC   FULL,WFREC+11       LESS AC = NET                                
         S     R0,FULL                                                          
         B     WFPBEDT                                                          
*                                                                               
WFPBNLC  MVC   FULL,WFREC+3        GROSS                                        
         L     R0,FULL                                                          
         MVC   FULL,WFREC+7        LESS CD                                      
         S     R0,FULL                                                          
         MVC   FULL,WFREC+11       LESS AC                                      
         S     R0,FULL                                                          
*                                                                               
*                                                                               
WFPBEDT  DS    0H                                                               
         TM    BYTE,X'10'          MEANS DIST OR HIGHER                         
         BZ    WFPBEDT4                                                         
         CLI   ESCCENTS,C'$'       SEE IF DROPPING CENTS                        
         BNE   WFPBEDT4                                                         
         EDIT  (R0),(14,1(R4)),0,COMMAS=YES,FLOAT=-                             
         B     WFPBEDT6                                                         
WFPBEDT4 EDIT  (R0),(14,1(R4)),2,COMMAS=YES,FLOAT=-                             
WFPBEDT6 NI    BYTE,X'0F'          SET OFF X'10'                                
         CLI   BYTE,1                                                           
         BLR   RE                                                               
         MVI   15(R4),C'*'                                                      
         BER   RE                                                               
         MVI   16(R4),C'*'                                                      
         BR    RE                                                               
*                                                                               
WFPBLN   MVC   FULL,WFREC+3+12                                                  
         L     R1,FULL                                                          
         TM    ESCLINS,X'20'       LINES VS INCHES                              
         BNZ   WFPBLIN2                                                         
         SR    R0,R0                                                            
         AH    R1,=H'7'                                                         
         D     R0,=F'14'           INCH = 14 LINES                              
WFPBLIN2 DS    0H                                                               
         EDIT  (R1),(15,(R4)),COMMAS=YES                                        
         CLI   BYTE,1                                                           
         BLR   RE                                                               
         MVI   15(R4),C'*'                                                      
         BER   RE                                                               
         MVI   16(R4),C'*'                                                      
         BR    RE                                                               
         EJECT                                                                  
*                                  REG/DIST RECAP                               
         SPACE 2                                                                
WFRDR    ST    RE,SAVERE                                                        
         SR    RE,RE               NEED 10 LINES TO START                       
         IC    RE,LINE                                                          
         LA    RE,10(RE)                                                        
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BNH   *+12                                                             
         MVI   LINE,99                                                          
         B     WFRDR2                                                           
*                                                                               
         MVI   SPACING,2                                                        
         BAS   RE,WFRDREP                                                       
*                                                                               
         MVC   P,MYSUMHD8                                                       
         BAS   RE,WFRDREP                                                       
         MVI   SPACING,2                                                        
         MVC   P(18),RDHEAD11                                                   
         MVC   PSECOND(18),RDHEAD12                                             
         BAS   RE,WFRDREP                                                       
*                                                                               
WFRDR2   DS    0H                                                               
         MVI   SUMSW,C'I'                                                       
         MVC   SUMSUMS,ESCSUMS                                                  
         CLI   BUDSW,0             TEST BUDGET DATA                             
         BNE   *+10                YES                                          
         MVC   SUMSUMS,ESCSUMSB    NO- SUPRESS BUDGET COLS                      
*                                                                               
WFRDR4   BAS   RE,WFREAD                                                        
         CLC   WFREC(2),=C'RN'                                                  
         BE    WFRDR6                                                           
         CLC   WFREC(2),=C'DT'                                                  
         BE    WFRDR8                                                           
         CLC   WFREC(2),=C'RT'                                                  
         BE    WFRDR10                                                          
         CLC   WFREC(2),=C'GT'                                                  
         BE    WFRDR12                                                          
         B     WFRDR4                                                           
*                                                                               
WFRDR6   CLI   MODE,LBUYREG                                                     
         BE    WFRDR4                                                           
         CLC   QDIST,=C'ALL'                                                    
         BNE   WFRDR4                                                           
         MVC   P+3(3),WFREC+3                                                   
         MVC   P+8(20),WFREC+6                                                  
         MVI   SPACING,2                                                        
*                                                                               
         SR    RE,RE                                                            
         IC    RE,LINE                                                          
         LA    RE,4(RE)            NEED 4 LINES                                 
         STC   RE,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BNH   *+8                                                              
         MVI   LINE,99                                                          
         BAS   RE,WFRDREP                                                       
         B     WFRDR4                                                           
*                                                                               
WFRDR8   MVC   P+6(3),WFREC+23                                                  
         MVC   P+11(20),WFREC+26                                                
         GOTO1 ASUMFMT,DMCB,WFREC+3                                             
         BAS   RE,WFRDREP                                                       
*                                                                               
         MVC   FULL,WFREC+19       BUDG                                         
         L     R0,DSTBUD                                                        
         A     R0,FULL                                                          
         ST    R0,DSTBUD                                                        
         B     WFRDR4                                                           
*                                                                               
WFRDR10  DS    0H                                                               
         CLC   DSTBUD,WFREC+19                                                  
         BE    WFRDR10A                                                         
         OC    DSTBUD,DSTBUD                                                    
         BZ    WFRDR10A                                                         
         MVC   FULL,WFREC+19                                                    
         L     R0,FULL                                                          
         S     R0,DSTBUD                                                        
         XC    QTRTOTS,QTRTOTS                                                  
         ST    R0,QTRTOTS+16                                                    
         GOTO1 ASUMFMT,DMCB,QTRTOTS                                             
*                                                                               
         MVC   P+6(8),=C'DISTRICT'                                              
         MVC   P+14(14),=C'(S) WITH AUTH-'                                      
         MVC   PSECOND+6(22),=C'ORIZATIONS BUT NO BUYS'                         
         BAS   RE,WFRDREP                                                       
*                                                                               
WFRDR10A CLI   MODE,LBUYREG                                                     
         BE    WFRDR10B                                                         
         CLC   QDIST,=C'ALL'                                                    
         BE    WFRDR10B                                                         
*                                                                               
         MVC   P+3(3),WFREC+23                                                  
         MVC   P+8(20),WFREC+26                                                 
         SR    R0,R0               NO TOTALS*                                   
         B     WFRDR10D                                                         
*                                                                               
WFRDR10B DS    0H                                                               
         MVI   MAXLINES,99         GET ON SAME PAGE                             
         BAS   RE,WFRDREP          SKIP A LINE                                  
         MVI   SPACING,2                                                        
         LA    R0,1                TOTALS*                                      
         MVC   P+3(15),=C'*REGION TOTALS*'                                      
*                                                                               
WFRDR10D DS    0H                                                               
         GOTO1 ASUMFMT,DMCB,((R0),WFREC+03)                                     
*                                                                               
         MVI   MAXLINES,99                                                      
         BAS   RE,WFRDREP                                                       
*                                                                               
*                                                                               
WFRDR10E DS    0H                                                               
         XC    DSTBUD,DSTBUD                                                    
         MVC   FULL,WFREC+19                                                    
         L     R0,REGBUD                                                        
         A     R0,FULL                                                          
         ST    R0,REGBUD                                                        
*                                                                               
         CLI   MODE,LBUYREG                                                     
         BE    WFRDR12D                                                         
         B     WFRDR4                                                           
*                                                                               
WFRDR12  DS    0H                                                               
         CLC   REGBUD,WFREC+19                                                  
         BE    WFRDR12C                                                         
         OC    REGBUD,REGBUD                                                    
         BNZ   WFRDR12A                                                         
         CLC   DSTBUD,WFREC+19                                                  
         BE    WFRDR12C                                                         
         OC    DSTBUD,DSTBUD                                                    
         BZ    WFRDR12C                                                         
*                                                                               
         MVC   P+3(8),=C'DISTRICT'                                              
         B     *+10                                                             
WFRDR12A MVC   P+3(8),=C'  REGION'                                              
         MVC   P+11(14),=C'(S) WITH AUTH-'                                      
         MVC   PSECOND+3(22),=C'ORIZATIONS BUT NO BUYS'                         
         MVC   FULL,WFREC+19                                                    
         L     R0,FULL                                                          
         L     R1,REGBUD                                                        
         LTR   R1,R1                                                            
         BNZ   *+8                                                              
         L     R1,DSTBUD                                                        
         SR    R0,R1                                                            
         XC    QTRTOTS,QTRTOTS                                                  
         ST    R0,QTRTOTS+16                                                    
         GOTO1 ASUMFMT,DMCB,QTRTOTS                                             
*                                                                               
         BAS   RE,WFRDREP                                                       
WFRDR12C DS    0H                                                               
         MVI   MAXLINES,99         GET ON SAME PAGE                             
         BAS   RE,WFRDREP          SKIP A LINE                                  
         MVC   P+3(08),=C'*TOTALS*'                                             
         GOTO1 ASUMFMT,DMCB,(1,WFREC+03)                                        
*                                                                               
         MVI   MAXLINES,99                                                      
         BAS   RE,WFRDREP                                                       
*                                                                               
*                                                                               
WFRDR12D XC    DSTBUD(8),DSTBUD                                                 
         MVI   LINE,99                                                          
         B     WFRDRX                                                           
*                                                                               
WFRDRX   L     RE,SAVERE                                                        
         BR    RE                                                               
*                                                                               
WFRDREP  DS    0H                                                               
         MVC   HEAD10,MYSUMH10                                                  
         MVC   HEAD11,MYSUMH11                                                  
         MVC   HEAD12,MYSUMH12                                                  
         MVC   HEAD11(18),RDHEAD11                                              
         MVC   HEAD12(18),RDHEAD12                                              
         MVC   HEAD8,MYSUMHD8                                                   
         CLI   BUDSW,0             TEST BUDGET DATA                             
         BNE   WFRDREP3            YES                                          
*                                  NO - SUPPRESS BUDGET COLUMNS                 
         MVC   HEAD10,MYSMBH10                                                  
         MVC   HEAD11,MYSMBH11                                                  
         MVC   HEAD12,MYSMBH12                                                  
*                                                                               
WFRDREP3 DS    0H                                                               
         LR    R0,RE                                                            
         GOTO1 APRNT                                                            
*                                                                               
         MVC   MAXLINES,SAVEMAX                                                 
         LR    RE,R0                                                            
         BR    RE                                                               
         SPACE 3                                                                
WFFLOAT  OI    0(R7),C' '                                                       
         CLI   0(R7),C' '                                                       
         BNER  RE                                                               
         BCT   R7,WFFLOAT                                                       
         SPACE 3                                                                
*                                                                               
*                                                                               
WFSAVRE  DS    F                                                                
         SPACE 2                                                                
WFREAD   ST    RE,WFSAVRE                                                       
         LA    R2,PP66WF                                                        
         LA    R0,WFREC                                                         
*&&DO                                                                           
         READ  (2),SQ,(0)                                                       
*&&                                                                             
*&&OS                                                                           
         READ  DECB0001,SF,(2),(0)                                              
*&&                                                                             
*                                                                               
*&&DO                                                                           
         CHECK (1)                                                              
*&&                                                                             
*&&OS                                                                           
         CHECK DECB0001                CHECK                                    
*&&                                                                             
*                                                                               
         B     WFBACK                                                           
         SPACE 2                                                                
WFWRITE  ST    RE,WFSAVRE                                                       
         LA    R2,PP66WF                                                        
         LA    R0,WFREC                                                         
*&&DO                                                                           
         WRITE  (2),SQ,(0)                                                      
*&&                                                                             
*&&OS                                                                           
         WRITE DECB0002,SF,(2),(0)                                              
*&&                                                                             
*                                                                               
*&&DO                                                                           
         CHECK (1)                                                              
*&&                                                                             
*&&OS                                                                           
         CHECK DECB0002                CHECK                                    
*&&                                                                             
*                                                                               
         B     WFBACK                                                           
         SPACE 2                                                                
WFPOINT  ST    RE,WFSAVRE                                                       
         LA    R1,PP66WF                                                        
*&&DO                                                                           
         POINTR (1),(0)                                                         
*&&                                                                             
*&&OS                                                                           
         POINT  (1),(0)                                                         
*&&                                                                             
*                                                                               
         B     WFBACK                                                           
         SPACE 2                                                                
WFPOINS  ST    RE,WFSAVRE                                                       
         LA    R1,PP66WF                                                        
*&&DO                                                                           
         POINTS (1)                                                             
*&&                                                                             
*&&OS                                                                           
         POINT (1),TTRFIRST                                                     
*&&                                                                             
*                                                                               
         B     WFBACK                                                           
         SPACE 2                                                                
WFNOTE   ST    RE,WFSAVRE                                                       
         LA    R1,PP66WF                                                        
         NOTE  (1)                                                              
*                                                                               
         B     WFBACK                                                           
         SPACE 2                                                                
WFBACK   L     RE,WFSAVRE                                                       
         BR    RE                                                               
         SPACE 3                                                                
DSRCHD   DC    C'   ** DISTRICT RECAP **     '                                  
RGRCHD   DC    C'    ** REGION RECAP **      '                                  
RGDSRCHD DC    C'** REGION/DISTRICT RECAP ** '                                  
PUBRCHD  DC    C'  ** PUBLICATION RECAP **   '                                  
PUBRCHDV DC    C'     ** VENDOR RECAP **     '                                  
         EJECT                                                                  
*&&DO                                                                           
PP66WF   DTFSD BLKSIZE=100,RECFORM=FIXUNB,TYPEFLE=WORK,NOTEPNT=YES,    X        
               EOFADDR=EOF,DEVICE=3340                                          
*&&                                                                             
*&&OS                                                                           
PP66WF   DCB   DDNAME=PP66WF,                                          X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,          DOS BLKSIZE=00100               X        
               MACRF=(RP,WP)           CHECK                                    
TTRFIRST DC    A(1)                                                             
                                                                                
*&&                                                                             
         SPACE 3                                                                
EOF      DC    H'0'                                                             
         SPACE 3                                                                
         LTORG                                                                  
         TITLE 'PP6602 - GET BUDGET RECS AND POST TO ACCUMS'                    
GETBUD   CSECT                                                                  
         NMOD1 0,**GETBUD                                                       
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
         L     R7,APRDTAB          PRD NAME TABLE FREE UNTIL BRD SUMS           
         USING PBUDREC,R7                                                       
*                                                                               
*                                  NOTE- ALL RECORDS ARE REREAD                 
*                                  AT END OF REGION/ESTIMATE TO                 
*                                  INSURE THAT ALL ARE FOUND                    
*                                                                               
         CLI   MODE,LBUYDST                                                     
         BE    GB4                                                              
         CLI   MODE,LBUYREG                                                     
         BE    GB4                                                              
GB2      CLI   MODE,LBUYEST                                                     
         BE    GB3                                                              
         CLI   MODE,LBUYPRO                                                     
         BNE   GETBUDX                                                          
         CLC   QEST,=C'ALL'                                                     
         BE    GETBUDX                                                          
GB3      DS    0H                                                               
         B     GB4                                                              
GETBUDX  XMOD1 1                                                                
*                                                                               
GB4      DS    0H                                                               
         MVC   WORK(L'KEY),KEY                                                  
         XC    KEY,KEY                                                          
         MVC   KEY(7),PCLTKEY                                                   
         MVI   KEY+3,X'18'                                                      
*                                                                               
         CLC   QPRODUCT,SPACES                                                  
         BE    *+20                                                             
         CLC   QPRODUCT,=C'ZZZ'                                                 
         BE    *+10                                                             
         MVC   KEY+7(3),PPRDKPRD                                                
*                                                                               
         CLC   QEST,SPACES                                                      
         BE    GB6                                                              
         CLC   QESTEND,SPACES                                                   
         BNE   GB5                                                              
         LH    R0,PESTKEST                                                      
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  KEY+10(3),DUB                                                    
         B     GB6                                                              
*                                                                               
GB5      MVC   KEY+10(3),QEST                                                   
*                                                                               
GB6      CLI   MODE,LBUYREG                                                     
         BNE   GB8                                                              
         MVC   KEY+13(3),PREGKREG                                               
         CLC   QDIST,SPACES                                                     
         BE    GB12                                                             
         CLC   QDIST,=C'ALL'                                                    
         BE    GB12                                                             
         MVC   KEY+16(3),QDIST                                                  
         B     GB12                                                             
*                                                                               
GB8      CLI   MODE,LBUYDST                                                     
         BNE   GB10                                                             
         MVC   KEY+13(6),PDSTKREG                                               
         B     GB12                                                             
*                                                                               
GB10     CLC   QREGION,SPACES                                                   
         BE    *+20                                                             
         CLC   QREGION,=C'ALL'                                                  
         BE    *+10                                                             
         MVC   KEY+13(3),QREGION                                                
         CLC   QDIST,SPACES                                                     
         BE    *+20                                                             
         CLC   QDIST,=C'ALL'                                                    
         BE    *+10                                                             
         MVC   KEY+16(3),QDIST                                                  
*                                                                               
GB12     BAS   RE,GBHIGH                                                        
         B     *+8                                                              
*                                                                               
GB14     BAS   RE,GBSEQ                                                         
         CLC   KEY(7),KEYSAVE                                                   
         BNE   GB50                                                             
*                                                                               
         OC    KEYSAVE+7(3),KEYSAVE+7                                           
         BZ    *+14                                                             
         CLC   KEY+7(3),KEYSAVE+7                                               
         BNE   GB50                                                             
*                                                                               
         OC    KEYSAVE+10(3),KEYSAVE+10                                         
         BZ    GB15                                                             
         CLC   KEY+10(3),KEYSAVE+10                                             
         BE    GB15                                                             
         CLC   QESTEND,SPACES                                                   
         BE    GB14                                                             
         CLC   KEY+10(3),QESTEND                                                
         BH    GB14                                                             
*                                                                               
GB15     DS    0H                                                               
         OC    KEYSAVE+13(3),KEYSAVE+13                                         
         BZ    *+14                                                             
         CLC   KEY+13(3),KEYSAVE+13                                             
         BNE   GB14                                                             
*                                                                               
         OC    KEYSAVE+16(3),KEYSAVE+16                                         
         BZ    *+14                                                             
         CLC   KEY+16(3),KEYSAVE+16                                             
         BNE   GB14                                                             
*                                                                               
         CLC   QPRODUCT,=C'ZZZ'                                                 
         BNE   GB20                                                             
*                                  IF ZZZ MAKE SURE THERE IS A                  
*                                  ZZZ EST FOR THIS BUDGET REC                  
         MVC   WORK2(64),KEY       SAVE KEY AND KEYSAVE                         
         MVI   KEY+3,7                                                          
         MVC   KEY+7(3),=C'ZZZ'                                                 
         PACK DUB,KEY+10(3)                                                     
         CVB   R0,DUB                                                           
         STH   R0,KEY+10                                                        
         XC    KEY+12(13),KEY+12                                                
         BAS   RE,GBHIGH                                                        
         MVI   BYTE,0                                                           
         CLC   KEY(25),KEYSAVE                                                  
         BE    *+8                                                              
         MVI   BYTE,1              NOT FOUND                                    
         MVC   KEY,WORK2           RESTORE KEY                                  
         BAS   RE,GBHIGH                                                        
         MVC   KEYSAVE,WORK2+32    RESTORE KEYSAVE                              
         CLI   BYTE,1                                                           
         BE    GB14                DO NOT PROCESS                               
*                                                                               
*                                                                               
GB20     DS    0H                                                               
         BAS   RE,GBGETREC                                                      
*                                                                               
         DS    0H                                                               
         OC    PBUDAMTS(48),PBUDAMTS                                            
         BNZ   GB22                                                             
*                                  NO MONTHLY AMOUNTS                           
*                                                                               
         LA    R0,1                DST                                          
         L     R4,ADSTTOT                                                       
         CLI   MODE,LBUYDST                                                     
         BE    GB20A                                                            
         L     R4,AREGTOT                                                       
         CLI   MODE,LBUYREG                                                     
         BE    GB20A                                                            
         LA    R0,4                EST/PRD/DIV/CLT                              
         L     R4,AESTTOT                                                       
GB20A    DS    0H                                                               
         MVC   FULL,PBUDAMTS+48                                                 
*                                                                               
GB21     L     R5,FULL                                                          
         A     R5,ACCL-8(R4)       POST BUDG TOTALS                             
         ST    R5,ACCL-8(R4)                                                    
         LA    R4,ACCL(R4)                                                      
         BCT   R0,GB21                                                          
         B     GB30                                                             
*                                                                               
GB22     DS    0H                                                               
         LA    R2,RMTAB                                                         
         GOTO1 DTCNV,DMCB,PBUDST,(1,DUB)                                        
*                                                                               
GB23     CLC   DUB(2),0(R2)                                                     
         BE    GB24                                                             
         OC    0(2,R2),0(R2)                                                    
         LA    R2,2(R2)                                                         
         BNZ   GB23                                                             
         B     GB14                                                             
*                                                                               
GB24     ST    R2,WORK2            SAVE MONTH ADDR OF BUDGET START              
         LA    R0,RMTAB                                                         
         SR    R2,R0                                                            
         MH    R2,=Y(ROWL/2)                                                    
         ST    R2,IMDSPL                                                        
*                                                                               
         LA    R0,1                DST                                          
         L     R4,ADSTTOT                                                       
         CLI   MODE,LBUYDST                                                     
         BE    GB24A                                                            
         L     R4,AREGTOT                                                       
         CLI   MODE,LBUYREG                                                     
         BE    GB24A                                                            
         LA    R0,4                EST/PRD/DIV/CLT                              
         L     R4,AESTTOT                                                       
GB24A    DS    0H                                                               
GB25     L     R3,WORK2                                                         
         L     R2,IMDSPL                                                        
         LA    R6,PBUDAMTS                                                      
*                                                                               
GB26     CLC   0(2,R3),BSTART                                                   
         BL    GB27                                                             
         CLC   0(2,R3),BEND                                                     
         BH    GB28                                                             
*                                                                               
         MVC   DUB(4),0(R6)                                                     
         L     RE,DUB                                                           
         A     RE,16(R4,R2)                                                     
         ST    RE,16(R4,R2)                                                     
*                                                                               
GB27     LA    R3,2(R3)                                                         
         LA    R2,ROWL(R2)                                                      
         LA    R6,4(R6)                                                         
         B     GB26                                                             
*                                                                               
GB28     LA    R4,ACCL(R4)                                                      
         BCT   R0,GB25                                                          
*                                                                               
*                                                                               
GB30     DS    0H                                                               
         CLI   MODE,LBUYDST                                                     
         BE    GB14                                                             
         CLI   MODE,LBUYREG                                                     
         BE    GB14                                                             
         CLC   QPRODUCT,=C'ZZZ'                                                 
         BE    GB32                                                             
         CLC   QPRODUCT,=C'ALL'                                                 
         BE    GB32                                                             
         CLC   QPRODUCT,SPACES                                                  
         BE    GB32                                                             
         B     GB14                                                             
*                                  POST TO BRAND SUMS                           
GB32     L     R3,ABRDT            FIND BRD ACCUM OR ADD ONE                    
         LA    R4,ACCL                                                          
         L     R5,ABRDTX                                                        
GB33     OC    ACCL-3(3,R3),ACCL-3(R3)                                          
         BZ    GB34                                                             
         CLC   ACCL-3(3,R3),PBUDKPRD                                            
         BE    GB34                                                             
         BXLE  R3,R4,GB33                                                       
         DC    H'0'                                                             
*                                                                               
GB34     L     R4,ABRDT                                                         
         SR    R4,R3                                                            
         LPR   R4,R4                                                            
         A     R4,ABRDTB                                                        
*                                                                               
         MVC   ACCL-3(3,R3),PBUDKPRD    MOVE PRODUCT CODES                      
         MVC   ACCL-3(3,R4),PBUDKPRD                                            
*                                                                               
         OC    PBUDAMTS(48),PBUDAMTS                                            
         BNZ   GB35                                                             
*                                       NO MONTHLY $                            
         MVC   FULL,PBUDAMTS+48                                                 
         L     R0,FULL                                                          
         A     R0,ACCL-8(R3)            POST BUDGET TOTAL                       
         ST    R0,ACCL-8(R3)                                                    
         B     GB14                     DONE                                    
*                                                                               
GB35     A     R3,IMDSPL                                                        
         L     R2,WORK2                 MONTH ADDR OF BUD START                 
         LA    R6,PBUDAMTS                                                      
GB36     CLC   0(2,R2),BSTART                                                   
         BL    GB37                                                             
         CLC   0(2,R2),BEND                                                     
         BH    GB14                     DONE                                    
         MVC   DUB(4),0(R6)                                                     
         L     RE,DUB                                                           
         A     RE,16(R3)                                                        
         ST    RE,16(R3)                                                        
GB37     LA    R3,ROWL(R3)                                                      
         LA    R2,2(R2)                                                         
         LA    R6,4(R6)                                                         
         B     GB36                                                             
*                                                                               
GB50     DS    0H                                                               
         MVC   KEY,WORK                                                         
         BAS   RE,GBHIGH                                                        
         B     GETBUDX                                                          
         SPACE 3                                                                
*                                                                               
GBHIGH   MVC   KEYSAVE,KEY                                                      
         LA    R2,DMRDHI                                                        
         B     *+8                                                              
GBSEQ    LA    R2,DMRSEQ                                                        
*                                                                               
         ST    RE,SAVERE                                                        
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R2)),PRTDIR,KEY,KEY                       
*                                                                               
         B     GBDMCHK                                                          
*                                                                               
GBGETREC ST    RE,SAVERE                                                        
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),PRTFILE,KEY+27,           X        
               PBUDREC,DMWORK                                                   
*                                                                               
GBDMCHK  DS    0H                                                               
         MVC   BYTE,DMCB+8                                                      
         NC    BYTE,DMOUTBTS                                                    
         BZ    *+6                                                              
         DC    H'0'                                                             
         L     RE,SAVERE                                                        
         BR    RE                                                               
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
FNDJOB   CSECT                                                                  
         NMOD1 0,FNDJOB                                                         
         SPACE 2                                                                
         USING PPWORKD,RA                                                       
         L     RC,PPFILEC                                                       
         USING PPFILED,RC,R9                                                    
         USING PP66WRKD,R8                                                      
         SPACE 2                                                                
         XC    DMCB(4),DMCB                                                     
         OC    PBDJOB,SPACES                                                    
         CLC   PBDJOB,SPACES                                                    
         BE    FNDJOBX             NO JOB NO.                                   
*                                                                               
FJ2      DS    0H                                                               
         L     R3,AJOBLST                                                       
         OC    0(2,R3),0(R3)                                                    
         BNZ   FJ3                                                              
         MVC   0(2,R3),=Y(JOBLSTEL)                                             
         LA    R5,5(R3)                                                         
         ST    R5,2(R3)                                                         
*                                                                               
FJ3      DS    0H                                                               
         LH    R4,0(R3)                                                         
         L     R5,2(R3)                                                         
         LA    R3,6(R3)                                                         
*                                                                               
*                                                                               
FJ4      DS    0H                                                               
         CLC   PBUYKPRD,0(R3)                                                   
         BNE   *+14                                                             
         CLC   PBDJOB(6),3(R3)                                                  
         BE    FJ8                                                              
         BXLE  R3,R4,FJ4                                                        
*                                                                               
         BAS   RE,RJOB                                                          
*                                                                               
         LH    R0,=Y(JOBLSTEL*JOBLSTN+6-1)                                      
         A     R0,AJOBLST                                                       
         CR    R0,R5                                                            
         BH    *+6                                                              
         SR    R3,R4               NO MORE ROOM - USE LAST OVER                 
         MVC   0(3,R3),PBUYKPRD                                                 
         MVC   3(6,R3),PBDJOB                                                   
         MVC   9(17,R3),PJOBCPY                                                 
         MVC   26(50,R3),PJOBCAP1                                               
         AR    R4,R3                                                            
         BCTR  R4,R0                                                            
         L     R5,AJOBLST                                                       
         ST    R4,2(R5)                                                         
FJ8      DS    0H                                                               
         ST    R3,DMCB             RETURN A(JOB INFO)                           
         B     FNDJOBX                                                          
*                                                                               
FNDJOBX  DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
RJOB     NTR1                                                                   
         SPACE 2                                                                
         MVC   WORK(64),KEY                                                     
         XC    KEY,KEY                                                          
         MVC   KEY(10),PBUYKEY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),PBDJOB                                                 
         BAS   RE,RJHI                                                          
         CLC   KEY(25),KEYSAVE                                                  
         BE    RJ2                                                              
         MVC   PJOBCPY,SPACES                                                   
         MVC   PJOBCPY(13),=C'**NOT FOUND**'                                    
         MVC   PJOBCAP1(50),SPACES                                              
         B     RJ4                                                              
RJ2      DS    0H                                                               
         BAS   RE,RJGET                                                         
*                                                                               
RJ4      DS    0H                                                               
         MVC   KEY,WORK                                                         
         BAS   RE,RJHI             RESTORE SEQ                                  
         B     RJOBX                                                            
*                                                                               
RJOBX    DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
RJHI     MVC   KEYSAVE,KEY                                                      
         LA    R2,DMRDHI                                                        
*                                                                               
         ST    RE,SAVERE                                                        
         GOTO1 DATAMGR,DMCB,(DMINBTS,(R2)),PRTDIR,KEY,KEY                       
*                                                                               
         B     RJDMCK                                                           
*                                                                               
RJGET    ST    RE,SAVERE                                                        
         GOTO1 DATAMGR,DMCB,(DMINBTS,GETREC),PRTFILE,KEY+27,           X        
               PJOBREC,DMWORK                                                   
*                                                                               
RJDMCK   DS    0H                                                               
         MVC   BYTE,DMCB+8                                                      
         NC    BYTE,DMOUTBTS                                                    
         BZ    *+6                                                              
         DC    H'0'                                                             
         L     RE,SAVERE                                                        
         BR    RE                                                               
         SPACE 2                                                                
         DROP R7                                                                
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
JOBLSTEL EQU   76                                                               
JOBLSTN  EQU   20                                                               
*                                                                               
         CNOP  2,4                                                              
JOBLST   DC    H'0'                                                             
         DC    A(JOBLSTEL)                                                      
         DC    A(0)                                                             
*                                                                               
         ORG   *+JOBLSTEL*JOBLSTN                                               
*                                  PRD/JOB/COPY/CAPTIONS                        
*                                                                               
*                                                                               
*                                                                               
       ++INCLUDE PP66WRK                                                        
*                                                                               
         PRINT OFF                                                              
*                                                                               
       ++INCLUDE PPWORKD                                                        
       ++INCLUDE PPFILED                                                        
       ++INCLUDE PPMODEQU                                                       
*                                                                               
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'009PP6602CM  05/01/02'                                      
         END                                                                    

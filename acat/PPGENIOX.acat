*          DATA SET PPGENIOX   AT LEVEL 038 AS OF 05/01/02                      
*CATALP GENIOS                                                                  
         TITLE 'GENIOS - GENERATE TURNAROUND INS. ORDER REQS'                   
*                                                                               
*         CHANGE LOG                                                            
* BPLA 1/24/92   SKIP TEST BUYS                                                 
*                                                                               
GENIOS   CSECT                                                                  
         NMOD1 32,**GENIOS                                                      
         SPACE 2                                                                
         USING GENIOSWD,RC                                                      
         ST    R1,SAVR1                                                         
         MVC   PARS(24),0(R1)                                                   
         L     R9,PARS                                                          
         L     RA,PARS+4                                                        
         USING PBUYREC,R9                                                       
         USING PAGYREC,RA                                                       
         L     RF,12(R1)                                                        
         MVC   DATCON(16),0(RF)    A(DATCON,GETDAY,ADDAY,DATAMGR)               
         L     R8,PARS+8                                                        
         USING RQRECD,R8                                                        
         XC    RQREC,RQREC                                                      
         XC    RPTDAT,RPTDAT                                                    
*                                                                               
         MVC   HALF,PBUYLEN                                                     
         LA    RF,PBUYREC                                                       
         AH    RF,HALF                                                          
         ST    RF,EOR              A(END OF REC)                                
         BC    0,GEN2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DATCON,DMCB,(5,0),TODAY                                          
*                                                                               
         MVC   SVTODAY,TODAY                                                    
         GOTO1 DATCON,DMCB,TODAY,(3,SVBTODAY)                                   
*                                                                               
*                                  COMPUTE NEW 'TODAY'                          
*                                  FOR DATE COMPARES                            
         GOTO1 GETDAY,DMCB,TODAY,WORK                                           
         ZIC   RE,DMCB             DAY OF WEEK                                  
*                                                                               
         LA    RF,TAB133-1                                                      
         CLI   PARS,0              FROM ACTIVITY                                
         BE    GEN01                                                            
         LA    RF,TAB49-1                                                       
         CLI   PARS,1              FROM 49                                      
         BE    GEN01                                                            
         LA    RF,TABGI-1                                                       
*                                  FROM PPGI02                                  
*                                                                               
GEN01    DS    0H                                                               
         ZIC   R0,0(RF,RE)                                                      
         STH   R0,DAYADJ                                                        
*                                                                               
         GOTO1 ADDAY,DMCB,TODAY,TODAY,(R0)                                      
*                                                                               
         GOTO1 DATCON,DMCB,TODAY,(3,BTODAY)                                     
*                                                                               
*                                                                               
GEN1     DS    0H                                                               
         LA    R3,JOBTAB+12                                                     
         LA    R4,JOBENTL                                                       
         LA    R5,JOBTABX                                                       
         STM   R3,R5,JOBTAB                                                     
*                                                                               
GEN2     DS    0H                                                               
         CLI   DAYADJ+1,255        NO IO'S TODAY FOR THIS RUN                   
         BE    GEN90                                                            
         CLI   PAGYPROF+22,C'N'    NO IO'S                                      
         BE    GEN90                                                            
         CLI   PAGYPROF+22,C'C'    ONLY CHANGES AND CNACELS                     
         BE    GEN10                                                            
         CLC   PAGYPROF+22(4),=C'0000'    NO AUTOS                              
         BE    GEN90                                                            
*                                                                               
         CLC   PAGYKEY(3),LASTKEY                                               
         BE    GEN10                                                            
*                                       NEW AGY/MED                             
         XC    DATLIM1,DATLIM1                                                  
         CLC   PAGYPROF+22(2),=C'00'                                            
         BNH   GEN4                                                             
         OC    PAGYPROF+22(2),=C'00'                                            
         PACK  DUB,PAGYPROF+22(2)                                               
         CVB   R3,DUB                                                           
         GOTO1 ADDAY,DMCB,TODAY,WORK,(R3)                                       
*                                                                               
         GOTO1 DATCON,DMCB,WORK,(3,DATLIM1)                                     
*                                                                               
GEN4     DS    0H                                                               
         XC    DATLIM2,DATLIM2                                                  
         CLC   PAGYPROF+24(2),=C'00'                                            
         BE    GEN6                                                             
         OC    PAGYPROF+24(2),=C'00'                                            
         PACK  DUB,PAGYPROF+24(2)                                               
         CVB   R3,DUB                                                           
         GOTO1 ADDAY,DMCB,TODAY,WORK,(R3)                                       
*                                                                               
         GOTO1 DATCON,DMCB,WORK,(3,DATLIM2)                                     
*                                                                               
GEN6     DS    0H                                                               
GEN10    DS    0H                                                               
         CLC   PBUYKEY(16),LASTKEY      A/M/C/P/DUB                             
         BE    GEN12                                                            
*                                       CLEAR JOBTAB ON BREAK                   
         LA    RE,JOBTAB+12                                                     
         LA    RF,JOBTABL                                                       
         XCEF                                                                   
*                                                                               
GEN12    DS    0H                                                               
*                                                                               
         CLI   PBDBFD,C'T'         SEE IF TEST BUY                              
         BE    GEN90                                                            
**                                                                              
         XC    LASTDAT,LASTDAT                                                  
         XC    LASTIOD,LASTIOD            COMPRESSED                            
         XC    LASTIOEL,LASTIOEL                                                
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'70'                                                     
*                                                                               
GEN14    DS    0H                                                               
         BAS   RE,NEXTEL                                                        
         BNE   GEN18                                                            
         USING PIOELEM,R2                                                       
         OC    PIODATE,PIODATE                                                  
         BZ    GEN14                                                            
         CLC   PIODATE,LASTDAT                                                  
         BL    GEN14                                                            
         MVC   LASTDAT,PIODATE                                                  
         ST    R2,LASTIOEL                                                      
         B     GEN14                                                            
*                                                                               
GEN18    DS    0H                                                               
         L     R2,LASTIOEL                                                      
         CLI   PIOTYP,C'D'                                                      
         BE    GEN19                                                            
         CLC   PBDJOB,PIOJOB                                                    
         BNE   GEN19                                                            
         GOTO1 POSTJOB,DMCB,PIOJOB,PIOIDATE                                     
*                                                                               
GEN19    DS    0H                                                               
         CLI   PBDIODAT,X'FF'      INS ORD SUPPRESSED                           
         BE    GEN90                                                            
         CLI   PBDIODAT,0          INS ORD REQ'D FOR                            
         BNE   GEN32               PARTICULAR DAY                               
*              IF INSERT DATE PAST NO AUTO IO UNLESSCANCEL                      
         TM    PBUYCNTL,X'80'                                                   
         BNZ   GEN20                                                            
         CLC   PBUYKDAT,SVBTODAY                                                
         BL    GEN90                                                            
*                                                                               
GEN20    DS    0H                                                               
         OC    LASTIOEL,LASTIOEL        TEST PREVIOUS IO                        
         BZ    GEN26                    NONE                                    
*                                  COMPRESS LAST IO DATE                        
*                                  IN LASTIOD                                   
*                                                                               
         GOTO1 DATCON,DMCB,(3,LASTDAT),(2,LASTIOD)                              
         L     R2,LASTIOEL                                                      
         TM    PBUYCNTL,X'80'           IF DELETED                              
         BZ    GEN22                                                            
GEN21    DS    0H                                                               
         CLI   PIOTYP,C'D'              WAS CANCEL ORDER SENT                   
         BE    GEN90                    YES                                     
         B     GEN80                    NO                                      
*                                                                               
GEN22    DS    0H                                                               
         CLC   PBDJOB,PIOJOB                                                    
         BNE   GEN70                    JOB CHG                                 
         XC    RPTDAT,RPTDAT                                                    
         CLC   PBUYKDAT,PIOIDATE                                                
         BNE   GEN80                    DATE CHG                                
         CLI   PBUYKMED,C'N'                                                    
         BE    GEN24                                                            
*                                                                               
         OC    PBDSPACE,SPACES                                                  
         OC    PIOSPACE,SPACES                                                  
         CLC   PBDSPACE,PIOSPACE                                                
         BNE   GEN80                    SPC CHG                                 
         B     GEN25                                                            
*                                                                               
GEN24    DS    0H                                                               
*                                      NOW I MAY HAVE SPACES AND UNITS          
*                                      AND PIOSAU IS 8 CHARS                    
         OC    PBDSPACE(8),SPACES                                               
         OC    PIOSAU,SPACES                                                    
         CLC   PBDSPACE(8),PIOSAU  YES - TEST SPACE CHG                         
         BNE   GEN80                                                            
         CP    PBDUNITS,PIOUNITS                                                
         BNE   GEN80                    UNITS CHG                               
         CP    PBDCLMS,PIOCLMS                                                  
         BNE   GEN80                    COLUMNS CHG                             
         CLC   PBDUIND,PIOUIND                                                  
         BNE   GEN80                    TYPE UNITS CHG                          
GEN24D   DS    0H                                                               
         CLC   PBDCL,PIOPRM                                                     
         BNE   GEN80                    PREM CHG                                
         B     GEN25                                                            
*                                                                               
GEN25    DS    0H                 SEE IF POSITION INSTRUCTIONS CHANGED          
*                                 SINCE LAST I/O                                
         OC    LASTIOD,LASTIOD                                                  
         BZ    GEN90                                                            
         LA    R2,PBUYREC+33                                                    
         MVI   ELCODE,X'24'   SEE IF PI COMM CHANGED SINCE LASTIO               
GEN25C   BAS   RE,NEXTEL                                                        
         BNE   GEN25F                                                           
         USING PCHGELEM,R2                                                      
         CLC   PCHGDAT,LASTIOD                                                  
         BNH   GEN25C              WAS BL                                       
         TM    PCHGIND3,X'01'      POSITION INSTRUCTIONS CHANGE                 
         BO    GEN80                                                            
         B     GEN25C                                                           
*                                                                               
GEN25F   DS    0H                                                               
         B     GEN90               NO POSITION INS CHG                          
*                                                                               
*                                  NO PREVIOUS ORDER                            
GEN26    DS    0H                                                               
         CLI   PAGYPROF+22,C'C'    CHANGES AND CANCELS ONLY                     
         BE    GEN90                                                            
         OC    PBDJOB,PBDJOB       NO JOB, NO ORDER                             
         BZ    GEN90                                                            
         TM    PBUYCNTL,X'80'      DELETED, NO ORDER                            
         BNZ   GEN90                                                            
*                                                                               
         CLI   PBUYKMED,C'N'                                                    
         BNE   GEN28                                                            
*                                  FOR NEWSPAPERS                               
*                                  CHECK INS DATE VS DATLIM1                    
         CLC   PBUYKDAT,DATLIM1                                                 
         BH    GEN90                                                            
         B     GEN70                                                            
*                                  FOR MAGS TRY CLOSE DATE                      
GEN28    DS    0H                                                               
         OC    PBDCDATE,PBDCDATE                                                
         BZ    GEN30                                                            
         OC    DATLIM1,DATLIM1                                                  
         BZ    GEN30                                                            
         CLC   PBDCDATE,DATLIM1                                                 
         BH    GEN90                                                            
         B     GEN70                                                            
*                                  NO CLOSE DATE                                
GEN30    DS    0H                                                               
         CLC   PBUYKDAT,DATLIM2    TRY INSERT DATE                              
         BH    GEN90                                                            
         B     GEN70                                                            
*                                  REQ FOR CERTAIN DATE                         
*                                  (ID=)                                        
GEN32    DS    0H                                                               
         TM    PBUYCNTL,X'80'                                                   
         BNZ   GEN21                                                            
         CLC   PBDIODAT,BTODAY                                                  
         BH    GEN90                                                            
         B     GEN70                                                            
*                                                                               
*                                                                               
*                                                                               
*                                  FIND IF REPEAT                               
GEN70    DS    0H                                                               
         GOTO1 FINDJOB,DMCB,PBDJOB,RPTDAT                                       
*                                                                               
GEN80    DS    0H                                                               
         BAS   RE,GETJOB                                                        
         BNE   GEN90               NO IO                                        
*                                       POST THIS ORDER TO JOBTAB               
         GOTO1 POSTJOB,DMCB,PBDJOB,PBUYKDAT                                     
*                                                                               
         BAS   RE,GENREQ                                                        
*                                                                               
GEN90    DS    0H                                                               
         MVC   LASTKEY,PBUYKEY                                                  
GENXT    DS    0H                                                               
         XIT1                                                                   
         SPACE 3                                                                
POSTJOB  NTR1                                                                   
         SPACE 2                                                                
         LM    R2,R3,0(R1)         R2=A(JOB)                                    
*                                  R3=A(DATE)                                   
         LM    R5,R7,JOBTAB                                                     
PJ4      DS    0H                                                               
         CLI   0(R5),0                                                          
         BE    PJ6                                                              
         CLC   0(6,R2),0(R5)                                                    
         BE    PJ6                                                              
         BXLE  R5,R6,PJ4                                                        
         B     PJX                 IF NO MORE ROOM                              
*                                  DONT POST THIS JOB                           
PJ6      DS    0H                                                               
         MVC   0(6,R5),0(R2)       JOB                                          
         MVC   6(3,R5),0(R3)       DATE                                         
PJX      DS    0H                                                               
         B     GENXT                                                            
         SPACE 3                                                                
FINDJOB  NTR1                                                                   
         SPACE 2                                                                
         LM    R2,R3,0(R1)         R2=A(JOB)                                    
*                                  R3=A(DATE)                                   
         LM    R5,R7,JOBTAB                                                     
FJ4      DS    0H                                                               
         CLI   0(R5),0                                                          
         BE    FJ6                                                              
         CLC   0(6,R5),0(R2)                                                    
         BE    FJ6                                                              
         BXLE  R5,R6,FJ4                                                        
*                                                                               
         XC    0(3,R3),0(R3)                                                    
         B     FJX                                                              
FJ6      DS    0H                                                               
         MVC   0(3,R3),6(R5)                                                    
FJX      DS    0H                                                               
         B     GENXT                                                            
         SPACE 3                                                                
GENREQ   NTR1                                                                   
         SPACE 2                                                                
         MVC   REQORIG,PJOBORIG                                                 
         MVC   REQDATE,SVTODAY                                                  
*                                                                               
         MVI   RQCRD,C' '                                                       
         MVC   RQCRD+1(79),RQCRD                                                
         MVC   RQPRG,=C'72'                                                     
         MVC   RQAGY(3),PBUYKAGY                                                
         MVC   RQCLT,PBUYKCLT                                                   
         MVC   RQPRD,PBUYKPRD                                                   
         MVC   HALF,PBUYKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  RQEST,DUB                                                        
         UNPK  RQPUB(11),PBUYKPUB(06)                                           
         MVC   RQPUB+10(1),PBUYKPUB+5                                           
         OI    RQPUB+10,C' '                                                    
         GOTO1 DATCON,DMCB,(3,PBUYKDAT),RQSTART                                 
*                                                                               
         MVC   RQEND,RQSTART                                                    
         MVC   RQSORT,=C'NO'                                                    
         SR    R0,R0                                                            
         IC    R0,PBUYKLIN                                                      
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  RQLIN,DUB                                                        
         MVI   RQTYP,C'N'                                                       
         OC    LASTIOEL,LASTIOEL                                                
         BZ    GR4                                                              
         MVI   RQTYP,C'C'                                                       
         TM    PBUYCNTL,X'80'                                                   
         BZ    GR4                                                              
         MVI   RQTYP,C'D'                                                       
GR4      DS    0H                                                               
         MVI   RQSRC,C'A'          AUTO                                         
         OC    RPTDAT,RPTDAT                                                    
         BZ    GR6                                                              
         GOTO1 DATCON,DMCB,(3,RPTDAT),RQRPT                                     
*                                                                               
GR6      DS    0H                                                               
         B     GENXT                                                            
         SPACE 3                                                                
GETJOB   NTR1                                                                   
         MVI   DMINBTS,X'88'                                                    
         MVI   DMOUTBTS,X'FD'                                                   
         XC    KEY(25),KEY                                                      
         MVC   KEY(10),PBUYKEY                                                  
         MVI   KEY+3,X'15'                                                      
         MVC   KEY+10(6),PBDJOB                                                 
         CLC   PJOBREC(25),KEY         ALREADY HAVE                             
         L     R1,SAVR1                                                         
         MVI   4(R1),0                                                          
         BE    GJ6                                                              
         BAS   RE,HIGH                                                          
         CLC   KEY(25),KEYSAVE                                                  
         BE    GJ3                                                              
         MVI   PJOBKEY,0                                                        
         MVC   PJOBCAP1(8),=C'INACTIVE'                                         
         B     GJ4                                                              
GJ3      DS    0H                                                               
         BAS   RE,GET                                                           
*                                                                               
GJ4      DS    0H                                                               
         L     R1,SAVR1                                                         
         MVI   4(R1),1             CALLER WILL RESTORE SEQ READ                 
*                                                                               
GJ6      DS    0H                                                               
         CLC   PJOBCAP1(8),=C'INACTIVE'                                         
         BNE   GJYES                                                            
*                                                                               
GJNO     DS    0H                                                               
         LTR   RE,RE                                                            
         B     GENXT                                                            
*                                                                               
GJYES    DS    0H                                                               
         SR    R0,R0                                                            
         B     GENXT                                                            
         SPACE 3                                                                
HIGH     DS    0H                                                               
         LR    R0,RE                                                            
         MVC   KEYSAVE,KEY                                                      
         GOTO1 DATAMGR,DMCB,(DMINBTS,=C'DMRDHI'),=C'PRTDIR',KEY,KEY,0           
*                                                                               
         B     DMCHK                                                            
GET      DS    0H                                                               
         LR    R0,RE                                                            
         GOTO1 DATAMGR,DMCB,(DMINBTS,=C'GETREC'),=C'PRTFILE',          X        
               KEY+27,PJOBREC,WORK                                              
*                                                                               
         B     DMCHK                                                            
*                                                                               
DMCHK    DS    0H                                                               
         LR    RE,R0                                                            
         MVC   BYTE,DMOUTBTS                                                    
         NC    BYTE,DMCB+8                                                      
         BZR   RE                                                               
         DC    H'0'                                                             
         SPACE 3                                                                
NEXTEL   DS    0H                                                               
         SR    R0,R0                                                            
         IC    R0,1(R2)                                                         
         LTR   R0,R0                                                            
         BNP   NEXTEL2                                                          
         AR    R2,R0                                                            
         C     R2,EOR                                                           
         BNL   NEXTEL2                                                          
         CLC   0(1,R2),ELCODE                                                   
         BER   RE                                                               
         B     NEXTEL                                                           
NEXTEL2  DS    0H                                                               
         LTR   R2,R2                                                            
         BR    RE                                                               
         EJECT                                                                  
TODAY    DS    CL6                                                              
SVTODAY  DS    CL6                                                              
BTODAY   DS    XL3                                                              
SVBTODAY DS    XL3                                                              
DAYADJ   DC    H'0'                                                             
LASTKEY  DC    XL32'00'                                                         
LASTJOB  DC    XL6'00'                                                          
DATLIM1  DC    XL3'00'                                                          
DATLIM2  DC    XL3'00'                                                          
SPACES   DC    17C' '                                                           
*                                  TABLES OF DAYS TO ADD TO                     
*                                  TODAY TO GET COMPARE DATE                    
TAB49    DC    AL1(1,1,1,1,3,2,1)       IF FROM 49'S                            
TAB133   DC    AL1(3,2,1,0,255,5,4)     IF FROM ACTIVITY (NO FRIDAY)            
TABGI    DC    AL1(3,2,1,0,6,5,4)       IF FROM PPGI02 (IO GENERATOR)           
*                                                                               
*                                                                               
         DS    0F                                                               
JOBTAB   DS    A                                                                
         DS    F                                                                
         DS    A                                                                
         DS    10CL10         10 X (JOB + DATE OF LAST IO)                      
JOBTABX  EQU   *                                                                
JOBTABL  EQU   100                                                              
JOBENTL  EQU   10                                                               
*                                                                               
         SPACE 3                                                                
         LTORG                                                                  
         SPACE 2                                                                
*                                                                               
JOBIO    DS    2000C                                                            
         ORG   JOBIO                                                            
       ++INCLUDE PJOBREC                                                        
         EJECT                                                                  
*                                                                               
PCHGELD  DSECT                                                                  
       ++INCLUDE PCHGELEM                                                       
         SPACE 2                                                                
PIOELEMD DSECT                                                                  
*                                                                               
       ++INCLUDE PIOELEM                                                        
         SPACE 2                                                                
PBUYRECD DSECT                                                                  
*                                                                               
       ++INCLUDE PBUYREC                                                        
*                                                                               
       ++INCLUDE PBDELEM                                                        
         SPACE 2                                                                
PAGYRECD DSECT                                                                  
*                                                                               
         SPACE 3                                                                
       ++INCLUDE PAGYREC                                                        
         SPACE 3                                                                
GENIOSWD DSECT                                                                  
DUB      DS    D                                                                
FULL     DS    F                                                                
HALF     DS    H                                                                
BYTE     DS    X                                                                
BYTE2    DS    X                                                                
WORK     DS    CL64                                                             
DMCB     DS    6F                                                               
PARS     DS    6F                                                               
EOR      DS    A                                                                
ELCODE   DS    X                                                                
LASTDAT  DS    XL3                                                              
LASTIOD  DS    XL2         DATE OF LAST I/O COMPRESSED                          
LASTIOEL DS    F                                                                
SAVR1    DS    F                                                                
KEY      DS    XL32                                                             
KEYSAVE  DS    XL32                                                             
RPTDAT   DS    XL3                                                              
DMINBTS  DS    X                                                                
DMOUTBTS DS    X                                                                
DATCON   DS    A                                                                
GETDAY   DS    A                                                                
ADDAY    DS    A                                                                
DATAMGR  DS    A                                                                
         SPACE 3                                                                
RQRECD   DSECT                                                                  
RQREC    DS    0CL106                                                           
*                                                                               
       ++INCLUDE DMREQHDR                                                       
*                                                                               
RQCRD    DS    0CL80                                                            
RQPRG    DS    CL2                                                              
RQAGY    DS    CL2                                                              
RQMED    DS    CL1                                                              
RQCLT    DS    CL3                                                              
         DS    CL3                                                              
RQPRD    DS    CL3                                                              
RQJOB    DS    CL6                                                              
RQEST    DS    CL3                                                              
         DS    CL3                                                              
RQPUB    DS    CL11                                                             
RQSTART  DS    CL6                                                              
RQEND    DS    CL6                                                              
         DS    CL1                                                              
RQSORT   DS    CL2                                                              
         DS    CL7                                                              
RQLIN    DS    CL2                                                              
RQTYP    DS    CL1                                                              
         DS    CL1                                                              
RQSRC    DS    CL1                                                              
         DS    CL4                                                              
RQRPT    DS    CL6                                                              
         DS    CL6                                                              
*                                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'038PPGENIOX  05/01/02'                                      
         END                                                                    

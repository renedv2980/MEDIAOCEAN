*          DATA SET DEGETIUN   AT LEVEL 001 AS OF 07/13/01                      
*CATALP DEGETIUN                                                                
DEGETIUN TITLE '- CALCULATE IUN VALUES'                                         
***********************************************************************         
* ON ENTRY - P1 BYTE 0     1 = EXTRACT UNIVERSES, RATINGS, AND IMPS   *         
*                          2 = EXTRACT PUTS AND TOTS                  *         
*                          4 = EXTRACT UNIVERSES, RATINGS, IMPS, PUTS *         
*                              AND TOTS                               *         
*                          9   EXTRACT ENTIRE RECORD (IUN RECORD ONLY)*         
*                                                                     *         
*                    1-3     = A(DBLOCK USED FOR DEMAND CALL)         *         
*                                                                     *         
*            P2 BYTE 0       = CALLING SYSTEM (S=SPOT, R=REP)         *         
*                                                                     *         
*                    1-3     = A(DEMO VALUES)                         *         
*                                                                     *         
* REGISTER CONVENTIONS                                                *         
*                                                                     *         
* R2=A(DBLOCK)                                                        *         
* R3=A(OUTPUT AREA)                                                   *         
* R4=A(DEMO ELEMENT TABLE)                                            *         
* R5=A(ELEMENT DEMO LIST)                                             *         
* R6=RECORD DEMO ELEMENT POINTER                                      *         
***********************************************************************         
                                                                                
GETIUN   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 WORKL,**GETIUN,CLEAR=YES                                         
         USING WORKD,RC            RC=A(W/S)                                    
         MVC   CALLTYPE,0(R1)      SAVE CALLING TYPE                            
         MVC   CALLSYST,4(R1)      SAVE CALLER                                  
         ST    RB,AGETIUN          SAVE A(START OF PROGRAM)                     
         MVC   WVALUES(WVALUESL),LVALUES                                        
         LM    R2,R3,0(R1)                                                      
         LA    R2,0(R2)                                                         
         USING DBLOCKD,R2          R2=A(DBLOCK)                                 
         LA    R3,0(R3)                                                         
         USING IUNRECD,R3          R3=A(OUTPUT IUN RECORD)                      
                                                                                
         MVI   DMAIMP,C'N'         SAVE DMA RTGS INSTEAD OF IMPS                
         CLI   DBTAPEP,C'Y'        SAVE DMA IMPS                                
         BNE   *+8                                                              
         MVI   DMAIMP,C'I'                                                      
         MVC   RTGTOIMP,DBTAPEP                                                 
                                                                                
***********************************************************************         
* FIND BOOK ELEMENT ON DEMO RECORD AND LOCATE ORGTAB ENTRY ASSOCIATED *         
* WITH IT. THEN BRANCH TO DEMO EXTRACT ROUTINE FOR REQUESTED CALL.    *         
*                                                                     *         
* COULD HAVE NO BOOK ELEM IF NO MARKET TOTALS ARE FOUND (TYPE 2 CALL) *         
***********************************************************************         
                                                                                
GETIUN02 XC    BOOKTYPE,BOOKTYPE   RESET THE BOOKTYPE                           
         L     R1,DBAREC           ATTEMPT TO SAVE FOR LATER TESTS              
         CLC   =C'RT',0(R1)        TPT                                          
         BNE   GETIUN04                                                         
         MVC   BOOKTYPE,(DRBTYP-DRKEY)(R1)  SAVE BTYPE FOR LATER TESTS          
                                                                                
GETIUN04 CLC   =C'PT',0(R1)        PAV                                          
         BNE   GETIUN06                                                         
         MVI   FILTYP,FILTPAVQ                                                  
                                                                                
GETIUN06 L     R1,DBAQUART         R1=A(QUARTER HOUR ELEMENT)                   
         SR    R0,R0               LOCATE BOOK ELEMENT                          
GETIUN08 CLI   0(R1),0             TEST EOR                                     
         BE    GETIUNX             EXIT IF NO BOOK ELEMENT FOUND                
         CLI   0(R1),X'49'         TEST X'49' ELEMENT PRESENT                   
         BNE   *+8                                                              
         MVI   RTGPUT,C'Y'         FOR NSI-IUN RATINGS/PUTS ON RECORD           
         CLI   0(R1),X'51'         TEST PUT ELEMENT                             
         BNE   *+8                                                              
         ST    R1,APUTEL                                                        
         CLI   0(R1),BKELQ         TEST BOOK ELEMENT                            
         BE    GETIUN10                                                         
         IC    R0,1(R1)            NO BUMP TO NEXT ELEMENT                      
         AR    R1,R0                                                            
         B     GETIUN08                                                         
                                                                                
GETIUN10 CLI   1(R1),4             TEST FOR COMPRESSED BOOK ELEMENT             
         BNE   GETIUN12                                                         
         ICM   RE,3,2(R1)                                                       
         SLL   RE,17                                                            
         SRL   RE,17                                                            
         L     R1,DBAREC                                                        
         LA    R1,0(RE,R1)         YES - POINT TO UNCOMPRESSED ELEMENT          
                                                                                
GETIUN12 ST    R1,ABOOKEL          SAVE ADDR OF BOOK ELEM                       
                                                                                
* THIS CODE IS DISASTER PROTECTION FOR LUNATICS THAT CHANGE                     
* PROFILES FROM IMP BASED TO RATINGS BASED FORMULAS                             
                                                                                
         LTR   R1,R1               INSURE ADDRESS                               
         BZ    GETIUN14                                                         
         CLC   =C'IUN',2(R1)       ONLY FOR INVENTORY                           
         BNE   GETIUN14                                                         
         CLI   DBTAPEP,C'Y'        IMP BASED ALWAYS OK                          
         BE    GETIUN14                                                         
         CLC   5(2,R1),=AL1(91,06) IMP BASED INPUT PUT UPG                      
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(90,12) IMP BASED INPUT INDEX UPG                    
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(90,11) IMP BASED INPUT REG                          
         BNE   GETIUN14                                                         
         MVI   DMAIMP,C'I'         FORCE IMP BASED OUTPUT                       
         MVI   RTGTOIMP,C'I'                                                    
         MVI   DBTAPEP,C'Y'                                                     
                                                                                
GETIUN14 LHI   RE,ORGTAB-GETIUN                                                 
         A     RE,AGETIUN                                                       
         USING ORGTABD,RE          RE=A(FILE/BOOK TABLE)                        
         LHI   R0,ORGTABN          R0=N'ENTRIES IN TABLE                        
GETIUN16 CLC   ORGFILE,2(R1)       MATCH FILE/MEDIA/SOURCE                      
         BNE   GETIUN18                                                         
         TM    ORGINDS,ORGINETQ    TEST NETWORK FILE (NO BOOK MATCH)            
         BNZ   GETIUN20                                                         
         CLC   ORGBOOK,5(R1)       NO - MATCH BOOK ALSO                         
         BE    GETIUN20                                                         
GETIUN18 AHI   RE,ORGTABL          NO MATCH - BUMP TO NEXT                      
         BCT   R0,GETIUN16                                                      
         DC    H'0'                                                             
                                                                                
***********************************************************************         
* NOW POINT TO ELEMENT TABLE FOR BOOK AND BRANCH TO PROCESSING        *         
* ROUTINE FOR CALL.                                                   *         
***********************************************************************         
                                                                                
GETIUN20 SR    R4,R4                                                            
         ICM   R4,3,ORGDELEM       GET DISP TO ELEMENT TABLE                    
         A     R4,AGETIUN          R4=A(ELEMENT TABLE)                          
         USING ELEMTABD,R4                                                      
         SR    RF,RF                                                            
         ICM   RF,3,ORGDROUT       GET DISP TO ROUTINE                          
         A     RF,AGETIUN          RF=A(PROCESSING ROUTINE)                     
         L     R6,DBAQUART         R6=A(QUARTER HOUR ELEMENT)                   
                                                                                
         MVI   ELEMMASK,MASK1      SET ELEMENT DEMO TYPE MASK                   
         CLI   CALLTYPE,1          TEST RATINGS AND IMPS REQUESTED              
         BE    GETIUN22                                                         
         MVI   ELEMMASK,MASK2      TEST PUTS AND TOTS REQUIRED                  
         CLI   CALLTYPE,2                                                       
         BE    GETIUN22                                                         
         MVI   ELEMMASK,MASK4      TEST ONLY UNIVERSES REQUIRED                 
         CLI   CALLTYPE,5                                                       
         BE    GETIUN22                                                         
         MVI   ELEMMASK,MASK3                                                   
         CLI   CALLTYPE,4          TEST ALL DEMOS EXCEPT UNIVERSES              
         BE    GETIUN22                                                         
         CLI   CALLTYPE,9          TEST FOR EXPLODING IUN RECORD                
         BE    GETIUN22                                                         
         CLI   CALLTYPE,10         TEST FOR EXPLODING IUN RECORD                
         BE    GETIUN22                                                         
         DC    H'0'                                                             
                                                                                
GETIUN22 GOTOR (RF)                CALL EXPLODE ROUTINE                         
                                                                                
GETIUNX  J     EXIT                                                             
         DROP  RB                                                               
                                                                                
LVALUES  DS    0D                  VALUES MOVED TO W/S                          
         DC    F'1'                                                             
         DC    F'10'                                                            
         DC    F'100'                                                           
         DC    F'500'                                                           
         DC    F'1000'                                                          
         DC    F'10000'                                                         
         DC    F'50000'                                                         
         DC    F'100000'                                                        
         DC    X'0103070F'                                                      
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* NSI TIME PERIOD PROCESSING ROUTINE                                  *         
* FIRST EXTRACT DEMOS INTO WORKING STORAGE                            *         
***********************************************************************         
                                                                                
TTNDEM   NTR1  BASE=*,LABEL=*                                                   
         SR    R0,R0                                                            
         CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    *+12                                                             
         CLI   CALLSYST,SYSSPTQ    ALWAYS COMPUTE RTGS FOR SPOT                 
         BE    *+12                                                             
         TM    ELEMMASK,RATING     TEST RATINGS                                 
         BZ    *+8                                                              
         OI    ELEMMASK,DMA        NO-SO NEED DMA IMPS TO COMPUTE RTGS          
         TM    ELEMMASK,PUT        TEST PUTS REQUIRED                           
         BZ    TTNDEM02                                                         
         OI    ELEMMASK,TSA        YES-SO NEED TSA IMPRESSIONS TOO              
                                                                                
TTNDEM02 CLI   0(R6),QHCODEQ       TEST FOR CURRENT QUARTER HOUR                
         BE    TTNDEM06                                                         
         BH    TTNDEM08                                                         
         IC    R0,1(R6)                                                         
         AR    R6,R0               BUMP TO NEXT DEMO ELEMENT                    
         B     TTNDEM02                                                         
                                                                                
TTNDEM06 IC    R0,1(R6)                                                         
         AR    R6,R0               BUMP TO NEXT DEMO ELEMENT                    
         CLI   0(R6),0             TEST FOR EOR                                 
         BE    TTNDEMX                                                          
         CLI   0(R6),QHCODEQ       TEST FOR NEXT QUARTER HOUR                   
         BE    TTNDEMX                                                          
TTNDEM08 CLI   0(R6),X'30'         TEST START OF DEMO ELEMENTS FOR              
         BL    TTNDEM06            THIS QUARTER HOUR                            
                                                                                
TTNDEM10 CLI   0(R6),0             TEST FOR EOR                                 
         BE    TTNDEM20                                                         
         CLI   ELEMNUM,EOT         TEST END OF ELEMENT TABLE                    
         BE    TTNDEM20                                                         
         CLC   0(1,R6),ELEMNUM     TEST ELEMENT CODE MATCHES TABLE              
         BNE   TTNDEM18            NO BUMP TO NEXT TABLE ENTRY                  
                                                                                
TTNDEM12 MVC   DEMOTYPE,ELEMTYPE   EXTRACT ELEMENT DEMO TYPE                    
         NC    DEMOTYPE,ELEMMASK   'AND' DEMO TYPE MASK INTO IT                 
         BZ    TTNDEM16            NOT A DEMO TYPE WE WANT                      
         SR    R5,R5                                                            
         ICM   R5,3,ELEMDISP       GET DISP TO ELEMENT DEMO LIST                
         A     R5,AGETIUN          RELOCATE TABLE ADDRESS                       
         USING TTNLISTD,R5                                                      
                                                                                
         LR    R1,R6               R1=A(DEMO ELEMENT)                           
         TM    2(R6),X'80'         TEST IF DUPLICATE DEMO ELEMENT               
         BZ    TTNDEM14            NO                                           
         ICM   RE,3,2(R6)          YES                                          
         SLL   RE,17               SHIFT OFF X'80' BIT                          
         SRL   RE,17               RE=DISP INTO DEMO RECORD                     
         L     R1,DBAREC                                                        
         LA    R1,0(RE,R1)                                                      
                                                                                
TTNDEM14 GOTOR XPLDEL              EXPLODE DEMO ELEMENT                         
                                                                                
TTNDEM16 IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
                                                                                
TTNDEM18 AHI   R4,ELEMTABL         NEXT ELEMENT TABLE ENTRY                     
         B     TTNDEM10                                                         
                                                                                
* CALCULATE THE IUN VALUES FROM THE NSI SUPPLIED CATEGORIES                     
* FIRST COMPUTE THE UNIVERSES                                                   
                                                                                
TTNDEM20 MVC   IUNVS+HOMES(4),NUHOMES                                           
         MVC   IUNVS+WWORK(4),NUWWORK                                           
         MVC   IUNVS+METROA(4),NUMETROA                                         
         MVC   IUNVS+METROB(4),NUMETROB                                         
         MVC   IUNVS+V611(4),NUV611                                             
                                                                                
         OC    NUW1820,NUW1820     CHECK FOR EXISTANCE                          
         BZ    TTNDEM22                                                         
* UNIVERSES                                                                     
         LM    R4,R7,NUW1820       W1820,W2124,M1820,M2124                      
         AR    R4,R5                                                            
         ST    R4,NUW1824                                                       
         AR    R6,R7                                                            
         ST    R6,NUM1824                                                       
* DMA                                                                           
         LM    R4,R7,NDW1820       W1820,W2124,M1820,M2124                      
         AR    R4,R5                                                            
         ST    R4,NDW1824                                                       
         AR    R6,R7                                                            
         ST    R6,NDM1824                                                       
* TSA                                                                           
         LM    R4,R7,NTW1820       W1820,W2124,M1820,M2124                      
         AR    R4,R5                                                            
         ST    R4,NTW1824                                                       
         AR    R6,R7                                                            
         ST    R6,NTM1824                                                       
* TSA TOT                                                                       
         LM    R4,R7,NQW1820       W1820,W2124,M1820,M2124                      
         AR    R4,R5                                                            
         ST    R4,NQW1824                                                       
         AR    R6,R7                                                            
         ST    R6,NQM1824                                                       
* DMA TOT                                                                       
         LM    R4,R7,NWW1820       W1820,W2124,M1820,M2124                      
         AR    R4,R5                                                            
         ST    R4,NWW1824                                                       
         AR    R6,R7                                                            
         ST    R6,NWM1824                                                       
                                                                                
TTNDEM22 LM    R4,R9,NUW1824       W1824,W2534,W3549,W5054,W5564,W65+           
         LR    RE,R4               UW1824                                       
         AR    RE,R5               UW1834=UW1824+UW2534                         
         ST    RE,IUNVS+W1834                                                   
         LR    R0,RE               SAVE UW1834 IN R0                            
                                                                                
         LR    RF,R5               UW2534                                       
         AR    RF,R6               UW2549=UW2534+UW3549                         
         ST    RF,IUNVS+W2549                                                   
         AR    RE,R6               UW1849=UW1834+UW3549                         
         ST    RE,IUNVS+W1849                                                   
         LR    R1,RE               SAVE UW1849 IN R1                            
                                                                                
         AR    RF,R7               UW2554=UW2549+UW5054                         
         ST    RF,IUNVS+W2554                                                   
         AR    RF,R8               UW2564=UW2554+UW5564                         
         ST    RF,IUNVS+W2564                                                   
         AR    RF,R4               UW1864=UW2564+UW1824                         
         AR    RF,R9               UW18+=UW1864+UW65+                           
         ST    RF,IUNVS+W1849                                                   
                                                                                
         LM    R4,R9,NUM1824       M1824,M2534,M3549,M5054,M5564,M65+           
         LR    RE,R4               UM1824                                       
         AR    RE,R5               UM1834=UM1824+UM2534                         
         ST    RE,IUNVS+M1834                                                   
         AR    R0,RE               UV1834=UW1834+UM1834                         
         ST    R0,IUNVS+V1834                                                   
                                                                                
         LR    RF,R5               UM2534                                       
         AR    RF,R6               UM2549=UM1834+UM3549                         
         ST    RF,IUNVS+M2549                                                   
         AR    RE,R6               UM1849=UM1834+UM3549                         
         ST    RE,IUNVS+M1849                                                   
         AR    R1,RE               UV1849=UW1849+UM1849                         
         ST    R1,IUNVS+V1849                                                   
                                                                                
         AR    RF,R7               UM2554=UM2549+UM5054                         
         ST    RF,IUNVS+M2554                                                   
         LR    R0,RF                                                            
         A     R0,IUNVS+W2554      UV2554=WM2554+UW2554                         
         ST    R0,IUNVS+V2554                                                   
         AR    RF,R8               UM2564=UM2554+UM5564                         
         ST    RF,IUNVS+M2564                                                   
         AR    RF,R4               UM1864=UM2564+UM1824                         
         AR    RF,R9               UM18+=UM1864+UM65+                           
         ST    RF,IUNVS+M1899                                                   
                                                                                
         A     RF,IUNVS+W1849      UV18+=UM18+ + UW18+                          
         ST    RF,IUNVS+V1899                                                   
         LM    R0,R1,NUV25         V2-5, V6-11                                  
         LM    R4,R6,NUW1217       W1217,W1824,W2534                            
         LM    R7,R9,NUM1217       M1217,M1824,M2534                            
                                                                                
         AR    R0,R1               UV211=UV25+UV611                             
         ST    R0,IUNVS+V211                                                    
         LR    RE,R4                                                            
         AR    RE,R7               UV1217=UW1217+UM1217                         
         ST    RE,IUNVS+V1217                                                   
         AR    R0,RE               UV2-17=UV2-11+UV12-17                        
         AR    R0,RF               UV2+=UV2-17+UV18+                            
         ST    R0,IUNVS+V299                                                    
         LR    R1,R4                                                            
         AR    R1,R5               UW1224=UW1217+UW1824                         
         ST    R1,IUNVS+W1224                                                   
                                                                                
         LR    RE,R7               UM1217                                       
         AR    RE,R8               UM1224=UMU217+UM1824                         
         AR    RE,R1               UV1224=UM1224+UW1224                         
         ST    RE,IUNVS+V1224                                                   
                                                                                
         AR    R1,R6               UW1234=UW1224+UW2534                         
         ST    R1,IUNVS+W1234                                                   
         AR    RE,R6               UV1224+UW2534                                
         AR    RE,R9               +UM2534=UV1234                               
         ST    RE,IUNVS+V1234                                                   
                                                                                
         OC    NUW1820,NUW1820                                                  
         BZ    TTNDEM24                                                         
         L     RE,IUNVS+W1849                                                   
         S     RE,NUW1820                                                       
         ST    RE,IUNVS+W2149                                                   
         L     RF,IUNVS+M1849                                                   
         S     RF,NUM1820                                                       
         ST    RF,IUNVS+M2149                                                   
         AR    RE,RF                                                            
         ST    RE,IUNVS+V2149                                                   
                                                                                
* NEXT COMPUTE THE IMPRESSIONS                                                  
                                                                                
TTNDEM24 CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    *+12                                                             
         CLI   CALLSYST,SYSSPTQ    ALWAYS COMPUTE RTGS FOR SPOT                 
         BE    *+12                                                             
         TM    ELEMMASK,IMP                                                     
         BZ    TTNDEM34                                                         
                                                                                
         MVC   IIMPS+HOMES(4),NTHOMES                                           
         MVC   IIMPS+WWORK(4),NTWWORK                                           
         MVC   IIMPS+V611(4),NTV611                                             
                                                                                
         LM    R4,R9,NTW1824       W1824,W2534,W3549,W5054,W5564,W65+           
         LR    RE,R4               TW1824                                       
         AR    RE,R5               TW1834=TW1824+TW2534                         
         ST    RE,IIMPS+W1834                                                   
         LR    R0,RE               SAVE TW1834 IN R0                            
                                                                                
         LR    RF,R5               TW2534                                       
         AR    RF,R6               TW2549=TW2534+TW3549                         
         ST    RF,IIMPS+W2549                                                   
         AR    RE,R6               TW1849=TW1834+TW3549                         
         ST    RE,IIMPS+W1849                                                   
         LR    R1,RE               SAVE TW1849 IN R1                            
                                                                                
         AR    RF,R7               TW2554=TW2549+TW5054                         
         ST    RF,IIMPS+W2554                                                   
         AR    RF,R8               TW2564=TW2554+TW5564                         
         ST    RF,IIMPS+W2564                                                   
         AR    RF,R4               TW1864=TW2564+TW1824                         
         AR    RF,R9               TW18+=TW1864+TW65+                           
         ST    RF,IIMPS+W1899                                                   
                                                                                
         LM    R4,R9,NTM1824       M1824,M2534,M3549,M5054,M5564,M65+           
         LR    RE,R4               TM1824                                       
         AR    RE,R5               TM1834=TM1824+TM2534                         
         ST    RE,IIMPS+M1834                                                   
         AR    R0,RE               TV1834=TW1834+TM1834                         
         ST    R0,IIMPS+V1834                                                   
                                                                                
         LR    RF,R5               TM2534                                       
         AR    RF,R6               TM2549=TM1834+TM3549                         
         ST    RF,IIMPS+M2549                                                   
         AR    RE,R6               TM1849=TM1834+TM3549                         
         ST    RE,IIMPS+M1849                                                   
         AR    R1,RE               TV1849=TW1849+TM1849                         
         ST    R1,IIMPS+V1849                                                   
                                                                                
         AR    RF,R7               TM2554=TM2549+TM5054                         
         ST    RF,IIMPS+M2554                                                   
         LR    R0,RF                                                            
         A     R0,IIMPS+W2554      TV2554=TM2554+TW2554                         
         ST    R0,IIMPS+V2554                                                   
         AR    RF,R8               TM2564=TM2554+TM5564                         
         ST    RF,IIMPS+M2564                                                   
         AR    RF,R4               TM1864=TM2564+TM1824                         
         AR    RF,R9               TM18+=TM1864+TM65+                           
         ST    RF,IIMPS+M1899                                                   
                                                                                
         A     RF,IIMPS+W1899      TV18+=TM18+ + TW18+                          
         ST    RF,IIMPS+V1899                                                   
         LM    R0,R1,NTV25         V2-5, V6-11                                  
         LM    R4,R6,NTW1217       W1217,W1824,W2534                            
         LM    R7,R9,NTM1217       M1217,M1824,M2534                            
                                                                                
         AR    R0,R1               TV211=TV25+TV611                             
         ST    R0,IIMPS+V211                                                    
         LR    RE,R4                                                            
         AR    RE,R7               TV1217=TW1217+TM1217                         
         ST    RE,IIMPS+V1217                                                   
         AR    R0,RE               TV2-17=TV2-11+TV12-17                        
         AR    R0,RF               TV2+=TV2-17+TV18+                            
         ST    R0,IIMPS+V299                                                    
         LR    R1,R4                                                            
         AR    R1,R5               TW1224=TW1217+TW1824                         
         ST    R1,IIMPS+W1224                                                   
                                                                                
         LR    RE,R7               TM1217                                       
         AR    RE,R8               TM1224=TM1217+TM1824                         
         AR    RE,R1               TV1224=TM1224+TW1224                         
         ST    RE,IIMPS+V1224                                                   
                                                                                
         AR    R1,R6               TW1234=TW1224+TW2534                         
         ST    R1,IIMPS+W1234                                                   
         AR    RE,R6               TV1224+TW2534                                
         AR    RE,R9               +TM2534=TV1234                               
         ST    RE,IIMPS+V1234                                                   
                                                                                
* ADDITIONAL OCT/90 DEMOS                                                       
                                                                                
         OC    NUW1820,NUW1820     UNIV WILL BE THERE IF                        
         BZ    TTNDEM26            DATA IS AVAILABLE                            
         L     RE,IIMPS+W1849                                                   
         S     RE,NTW1820                                                       
         ST    RE,IIMPS+W2149                                                   
         L     RF,IIMPS+M1849                                                   
         S     RF,NTM1820                                                       
         ST    RF,IIMPS+M2149                                                   
         AR    RE,RF                                                            
         ST    RE,IIMPS+V2149                                                   
                                                                                
* NOW ADJUST THE PRECISION OF IMPRESSIONS TO IUN (HUNDREDS)                     
                                                                                
TTNDEM26 LHI   R0,IUNDEMS          R0=COUNTER                                   
         LHI   R1,10               R1=10                                        
         LHI   RE,500              RE=500                                       
         LHI   RF,1000             RF=1000                                      
         LA    R6,IIMPS            R6=A(VALUE)                                  
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM28                                                         
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
                                                                                
TTNDEM28 SR    R4,R4                                                            
         L     R5,0(R6)            GET IMPRESSION                               
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
         ST    R5,0(R6)                                                         
         AHI   R6,L'IIMPS                                                       
         BCT   R0,TTNDEM28                                                      
                                                                                
* COMPUTE TMETROA AND TMETROB                                                   
                                                                                
         LHI   R0,5                                                             
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   *+6                                                              
         SR    R0,R0                                                            
                                                                                
         L     R5,NRMETROA         R5=RMETROA                                   
         SR    R4,R4               SCALE IT TO 1 DECIMAL DINKED                 
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
                                                                                
         L     R7,IUNVS+METROA     R7=UMETROA                                   
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               TMETROA=RMETROA*UMETROA                      
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
                                                                                
         CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    TTNDEM30                                                         
         CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BNE   TTNDEM30                                                         
         SR    R4,R4                                                            
         AR    R5,R0               OPTIONALLY ROUND & DROP DECIMAL              
         DR    R4,R1               /10                                          
         MR    R4,R1               *10                                          
TTNDEM30 ST    R5,IIMPS+METROA                                                  
                                                                                
         L     R5,NRMETROB         R5=RMETROB                                   
         SR    R4,R4               SCALE IT                                     
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
                                                                                
         L     R7,IUNVS+METROB     R7=UMETROB                                   
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               TMETROB=RMETROB*UMETROB                      
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         CLI   FILTYP,FILTPAVQ                                                  
         BE    TTNDEM32                                                         
         CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BNE   TTNDEM32            NO                                           
         SR    R4,R4                                                            
         AR    R5,R0               OPTIONALLY ROUND & DROP DECIMAL              
         DR    R4,R1               /10                                          
         MR    R4,R1               *10                                          
TTNDEM32 ST    R5,IIMPS+METROB                                                  
                                                                                
* USE THE IUN RATINGS IF PRESENT, OTHERWISE CALCULATE THEM FROM THE             
* DMA IMPRESSIONS                                                               
                                                                                
TTNDEM34 CLI   FILTYP,FILTPAVQ                                                  
         BE    TTNDEM36                                                         
         CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BNE   TTNDEM36                                                         
         CLI   DMAIMP,C'I'         SAVE DMA IMPS INTEAD OF RTG?                 
         BE    TTNDEM46            FORCE TO BUILD IMPRESSIONS                   
         CLI   RTGPUT,C'Y'         TEST IF RATING ELEMENT PRESENT               
         BNE   TTNDEM46            NO                                           
         CLI   BOOKTYPE,X'05'      TEST IF NSI 2A-6A DATA                       
         BE    TTNDEM46            YES, MISSING SOME RTGS, BUILD IMPS           
         OC    NUW1820,NUW1820                                                  
         BNZ   TTNDEM38                                                         
         B     TTNDEM42                                                         
                                                                                
TTNDEM36 TM    ELEMMASK,RATING                                                  
         BZ    TTNDEM60                                                         
         OC    NUW1820,NUW1820     OCT/90 AVAILABLE                             
         BZ    TTNDEM40                                                         
                                                                                
TTNDEM38 L     R4,NDW2124                                                       
         LM    R5,R6,NDW2534                                                    
         AR    R5,R4                                                            
         AR    R5,R6                                                            
         LR    R8,R5               W2149                                        
         M     R4,F1000                                                         
         L     R0,IUNVS+W2149      R0 = UW2149                                  
         DR    R4,R0                                                            
         ST    R5,IRTGS+W2149                                                   
                                                                                
         L     R4,NDM2124                                                       
         LM    R5,R6,NDM2534                                                    
         AR    R5,R4                                                            
         AR    R5,R6                                                            
         LR    R9,R5               M2149                                        
         M     R4,F1000                                                         
         L     R0,IUNVS+M2149      R0 = UM2149                                  
         DR    R4,R0                                                            
         ST    R5,IRTGS+M2149                                                   
                                                                                
         AR    R9,R8                                                            
         M     R8,F1000                                                         
         L     R0,IUNVS+V2149      R0 = UV2149                                  
         DR    R8,R0                                                            
         ST    R9,IRTGS+V2149                                                   
                                                                                
TTNDEM40 CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BE    TTNDEM42                                                         
         CLI   DMAIMP,C'I'         SAVE IMPRESSIONS?                            
         BE    TTNDEM46            BUILD THEM                                   
         CLI   RTGPUT,C'Y'         TEST IF RATING ELEMENT PRESENT               
         BNE   TTNDEM46            NO                                           
         CLI   BOOKTYPE,X'05'      TEST IF NSI 2A-6A DATA                       
         BE    TTNDEM46            YES, MISSING SOME RTGS, BUILD IMPS           
                                                                                
TTNDEM42 LHI   R0,IUNDEMS          YES-DINK THE ELEMENT VALUES                  
         LHI   RE,5                RE=5                                         
         LHI   RF,10               RF=10                                        
         LA    R6,IRTGS            R6=A(UNROUNDED RATINGS)                      
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM44                                                         
         SR    RE,RE                                                            
         LHI   RF,1                                                             
                                                                                
TTNDEM44 L     R5,0(R6)            GET UNROUNDED RATING                         
         CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    *+12                                                             
         SR    R4,R4                                                            
         AR    R5,RE               +5                                           
         DR    R4,RF               /10                                          
         MR    R4,RF               *10                                          
         ST    R5,0(R6)                                                         
         AHI   R6,L'IRTGS                                                       
         BCT   R0,TTNDEM44                                                      
                                                                                
         OC    IRTGS+V2554(4),IRTGS+V2554 TEST RV2554 THERE                     
         BNZ   TTNDEM54            YES                                          
                                                                                
         LM    R4,R6,NDW2534       R4=DW2534,R5=DW3549,R6=DW5054                
         LM    R7,R9,NDM2534       R7=DM2534,R8=DM3549,R9=DM5054                
         AR    R5,R4                                                            
         AR    R5,R6                                                            
         AR    R5,R7                                                            
         AR    R5,R8                                                            
         AR    R5,R9               R5=DV2554                                    
                                                                                
         M     R4,F1000            SCALE THE DIVIDEND                           
         ICM   R0,15,IUNVS+V2554   R0=UV2554                                    
         BNZ   *+14                                                             
         SR    R5,R5                                                            
         ST    R5,IRTGS+V2554                                                   
         B     TTNDEM54                                                         
                                                                                
         DR    R4,R0               DV2554*1000/UV2554                           
         CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    *+12                                                             
         SR    R4,R4                                                            
         AR    R5,RE               +5 OR ZERO                                   
         DR    R4,RF               /10 OR 1                                     
         MR    R4,RF               *10 OR 1                                     
         ST    R5,IRTGS+V2554                                                   
         B     TTNDEM54                                                         
                                                                                
* RATINGS MISSING - COMPUTE THE DMA IMPRESSIONS                                 
                                                                                
TTNDEM46 MVC   IDMAS+HOMES(4),NDHOMES                                           
         MVC   IDMAS+WWORK(4),NDWWORK                                           
         MVC   IDMAS+V611(4),NDV611                                             
         LM    R4,R9,NDW1824       W1824,W2534,W3549,W5054,W5564,W65+           
         LR    RE,R4               DW1824                                       
         AR    RE,R5               DW1834=DW1824+DW2534                         
         ST    RE,IDMAS+W1834                                                   
         LR    R0,RE               SAVE DW1834 IN R0                            
                                                                                
         LR    RF,R5               DW2534                                       
         AR    RF,R6               DW2549=DW2534+DW3549                         
         ST    RF,IDMAS+W2549                                                   
         AR    RE,R6               DW1849=DW1834+DW3549                         
         ST    RE,IDMAS+W1849                                                   
         LR    R1,RE               SAVE DW1849 IN R1                            
                                                                                
         AR    RF,R7               DW2554=DW2549+DW5054                         
         ST    RF,IDMAS+W2554                                                   
         AR    RF,R8               DW2564=DW2554+DW5564                         
         ST    RF,IDMAS+W2564                                                   
         AR    RF,R4               DW1864=DW2564+DW1824                         
         AR    RF,R9               DW18+=DW1864+DW65+                           
         ST    RF,IDMAS+W1899                                                   
                                                                                
         LM    R4,R9,NDM1824       M1824,M2534,M3549,M5054,M5564,M65+           
         LR    RE,R4               DM1824                                       
         AR    RE,R5               DM1834=DM1824+DM2534                         
         ST    RE,IDMAS+M1834                                                   
         AR    R0,RE               DV1834=DW1834+DM1834                         
         ST    R0,IDMAS+V1834                                                   
                                                                                
         LR    RF,R5               DM2534                                       
         AR    RF,R6               DM2549=DM1834+DM3549                         
         ST    RF,IDMAS+M2549                                                   
         AR    RE,R6               DM1849=DM1834+DM3549                         
         ST    RE,IDMAS+M1849                                                   
         AR    R1,RE               DV1849=DW1849+DM1849                         
         ST    R1,IDMAS+V1849                                                   
                                                                                
         AR    RF,R7               DM2554=DM2549+DM5054                         
         ST    RF,IDMAS+M2554                                                   
         LR    R0,RF                                                            
         A     R0,IDMAS+W2554      DV2554=DM2554+DW2554                         
         ST    R0,IDMAS+V2554                                                   
         AR    RF,R8               DM2564=DM2554+DM5564                         
         ST    RF,IDMAS+M2564                                                   
         AR    RF,R4               DM1864=DM2564+DM1824                         
         AR    RF,R9               DM18+=DM1864+DM65+                           
         ST    RF,IDMAS+M1899                                                   
                                                                                
         A     RF,IDMAS+W1899      DV18+=DM18+ + DW18+                          
         ST    RF,IDMAS+V1899                                                   
         LM    R0,R1,NDV25         V2-5, V6-11                                  
         LM    R4,R6,NDW1217       W1217,W1824,W2534                            
         LM    R7,R9,NDM1217       M1217,M1824,M2534                            
                                                                                
         AR    R0,R1               DV211=DV25+DV611                             
         ST    R0,IDMAS+V211                                                    
         LR    RE,R4                                                            
         AR    RE,R7               DV1217=DW1217+DM1217                         
         ST    RE,IDMAS+V1217                                                   
         AR    R0,RE               DV2-17=DV2-11+DV12-17                        
         AR    R0,RF               DV2+=DV2-17+DV18+                            
         ST    R0,IDMAS+V299                                                    
         LR    R1,R4                                                            
         AR    R1,R5               DW1224=DW1217+DW1824                         
         ST    R1,IDMAS+W1224                                                   
                                                                                
         LR    RE,R7               DM1217                                       
         AR    RE,R8               DM1224=DMU217+DM1824                         
         AR    RE,R1               DV1224=DM1224+DW1224                         
         ST    RE,IDMAS+V1224                                                   
                                                                                
         AR    R1,R6               DW1234=DW1224+DW2534                         
         ST    R1,IDMAS+W1234                                                   
         AR    RE,R6               DV1224+DW2534                                
         AR    RE,R9               +DM2534=DV1234                               
         ST    RE,IDMAS+V1234                                                   
                                                                                
* ADDITIONAL OCT/90 DEMOS                                                       
                                                                                
         OC    NUW1820,NUW1820     UNIV WILL BE THERE IF                        
         BZ    TTNDEM48            DATA IS AVAILABLE                            
         L     RE,IDMAS+W1849                                                   
         S     RE,NDW1820                                                       
         ST    RE,IDMAS+W2149                                                   
         L     RF,IDMAS+M1849                                                   
         S     RF,NDM1820                                                       
         ST    RF,IDMAS+M2149                                                   
         AR    RE,RF                                                            
         ST    RE,IDMAS+V2149                                                   
                                                                                
* NOW COMPUTE THE RATINGS FROM THE DMA IMPRESSIONS AND UNIVERSES                
                                                                                
TTNDEM48 LHI   R0,IUNDEMS          R0=LOOP COUNTER                              
         LHI   R1,1000                                                          
         LHI   RE,5                                                             
         LHI   RF,10                                                            
         LA    R6,IDMAS            R6=A(DMA IMPRESSION)                         
         LA    R7,IUNVS            R7=A(UNIVERSE)                               
         LA    R8,IRTGS            R8=A(RATING)                                 
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM50                                                         
         SR    RE,RE                                                            
         LHI   RF,1                                                             
                                                                                
TTNDEM50 L     R5,0(R6)            GET DMA IMPRESSION                           
         CLI   DMAIMP,C'I'         SAVE IMPS RATHER THAN RTGS                   
         BE    TTNDEM52                                                         
         MR    R4,R1               *1000                                        
         ICM   R9,15,0(R7)         GET UNIVERSE                                 
         BNZ   *+10                                                             
         SR    R5,R5                                                            
         B     TTNDEM52                                                         
                                                                                
         DR    R4,R9               R5=UNROUNDED RATING                          
         CLI   FILTYP,FILTPAVQ                                                  
         BE    TTNDEM52                                                         
         AR    R5,RE               +5 OR 0                                      
         SR    R4,R4                                                            
         DR    R4,RF               /10 OR 1                                     
         MR    R4,RF               *10 OR 1                                     
                                                                                
TTNDEM52 ST    R5,0(R8)                                                         
         AHI   R6,L'IDMAS          NEXT DMA IMPRESSION                          
         AHI   R7,L'IUNVS          NEXT UNIVERSE                                
         AHI   R8,L'IRTGS          NEXT RATING                                  
         BCT   R0,TTNDEM50                                                      
                                                                                
* ADJUST RHOMES,RMETROA,RMETROB FROM NSI PRECISION TO IUN PRECISION             
                                                                                
TTNDEM54 LHI   R0,3                R0=LOOP COUNTER                              
         LHI   R1,10                                                            
         LHI   RE,500                                                           
         LHI   RF,1000                                                          
         CLI   FILTYP,FILTPAVQ                                                  
         BNE   *+16                                                             
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
         LA    R6,NRHOMES                                                       
         LA    R7,IRTGS+HOMES                                                   
                                                                                
         CLI   BOOKTYPE,X'05'      IF NSI 2A-6A DATA,                           
         BNE   *+12                                                             
         CLI   DMAIMP,C'I'         AND IT'S RATINGS-BASED,                      
         BNE   TTNDEM60            ALREADY IN IUN PRECISION                     
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM56                                                         
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
         B     TTNDEM58                                                         
                                                                                
TTNDEM56 CLI   DMAIMP,C'I'                                                      
         BNE   TTNDEM58                                                         
         BCT   R0,*+4              LEAVE DMA HOMES ALONE                        
         MVC   0(4,R7),NDHOMES                                                  
         AHI   R6,L'NRHOMES                                                     
         AHI   R7,L'IRTGS                                                       
                                                                                
TTNDEM58 L     R5,0(R6)            GET UNADJUSTED RATING                        
         CHI   R1,1                TRUNCATE IF NO RESCALING                     
         BE    *+6                                                              
         AR    R5,RE               +50 OR 500                                   
         SR    R4,R4                                                            
         DR    R4,RF               /100 OR 100                                  
         MR    R4,R1               *1 OR 10                                     
         ST    R5,0(R7)                                                         
         AHI   R6,L'NRHOMES                                                     
         AHI   R7,L'IRTGS                                                       
         BCT   R0,TTNDEM58                                                      
                                                                                
* NEXT COMPUTE THE TOTS                                                         
                                                                                
TTNDEM60 TM    ELEMMASK,TOT        TEST TOT REQUIRED                            
         BZ    TTNDEM72            NO                                           
                                                                                
         MVC   ITOTS+HOMES(4),NQHOMES                                           
         MVC   ITOTS+WWORK(4),NQWWORK                                           
         MVC   ITOTS+V611(4),NQV611                                             
                                                                                
         LM    R4,R9,NQW1824       W1824,W2534,W3549,W5054,W5564,W65+           
         LR    RE,R4               QW1824                                       
         AR    RE,R5               QW1834=QW1824+QW2534                         
         ST    RE,ITOTS+W1834                                                   
         LR    R0,RE               SAVE QW1834 IN R0                            
                                                                                
         LR    RF,R5               QW2534                                       
         AR    RF,R6               QW2549=QW2534+QW3549                         
         ST    RF,ITOTS+W2549                                                   
         AR    RE,R6               QW1849=QW1834+QW3549                         
         ST    RE,ITOTS+W1849                                                   
         LR    R1,RE               SAVE QW1849 IN R1                            
                                                                                
         AR    RF,R7               QW2554=QW2549+QW5054                         
         ST    RF,ITOTS+W2554                                                   
         AR    RF,R8               QW2564=QW2554+QW5564                         
         ST    RF,ITOTS+W2564                                                   
         AR    RF,R4               QW1864=QW2564+QW1824                         
         AR    RF,R9               QW18+=QW1864+QW65+                           
         ST    RF,ITOTS+W1899                                                   
                                                                                
         LM    R4,R9,NQM1824       M1824,M2534,M3549,M5054,M5564,M65+           
         LR    RE,R4               QM1824                                       
         AR    RE,R5               QM1834=QM1824+QM2534                         
         ST    RE,ITOTS+M1834                                                   
         AR    R0,RE               QV1834=QW1834+QM1834                         
         ST    R0,ITOTS+V1834                                                   
                                                                                
         LR    RF,R5               QM2534                                       
         AR    RF,R6               QM2549=QM1834+QM3549                         
         ST    RF,ITOTS+M2549                                                   
         AR    RE,R6               QM1849=QM1834+QM3549                         
         ST    RE,ITOTS+M1849                                                   
         AR    R1,RE               QV1849=QW1849+QM1849                         
         ST    R1,ITOTS+V1849                                                   
                                                                                
         AR    RF,R7               QM2554=QM2549+QM5054                         
         ST    RF,ITOTS+M2554                                                   
         LR    R0,RF                                                            
         A     R0,ITOTS+W2554      QV2554=QM2554+QW2554                         
         ST    R0,ITOTS+V2554                                                   
         AR    RF,R8               QM2564=QM2554+QM5564                         
         ST    RF,ITOTS+M2564                                                   
         AR    RF,R4               QM1864=QM2564+QM1824                         
         AR    RF,R9               QM18+=QM1864+QM65+                           
         ST    RF,ITOTS+M1899                                                   
                                                                                
         A     RF,ITOTS+W1899      QV18+=QM18+ + QW18+                          
         ST    RF,ITOTS+V1899                                                   
         LM    R0,R1,NQV25         V2-5, V6-11                                  
         LM    R4,R6,NQW1217       W1217,W1824,W2534                            
         LM    R7,R9,NQM1217       M1217,M1824,M2534                            
                                                                                
         AR    R0,R1               QV211=QV25+QV611                             
         ST    R0,ITOTS+V211                                                    
         LR    RE,R4                                                            
         AR    RE,R7               QV1217=QW1217+QM1217                         
         ST    RE,ITOTS+V1217                                                   
         AR    R0,RE               QV2-17=QV2-11+QV12-17                        
         AR    R0,RF               QV2+=QV2-17+QV18+                            
         ST    R0,ITOTS+V299                                                    
         LR    R1,R4                                                            
         AR    R1,R5               QW1224=QW1217+QW1824                         
         ST    R1,ITOTS+W1224                                                   
                                                                                
         LR    RE,R7               QM1217                                       
         AR    RE,R8               QM1224=QM1217+QM1824                         
         AR    RE,R1               QV1224=QM1224+QW1224                         
         ST    RE,ITOTS+V1224                                                   
                                                                                
         AR    R1,R6               QW1234=QW1224+QW2534                         
         ST    R1,ITOTS+W1234                                                   
         AR    RE,R6               QV1224+QW2534                                
         AR    RE,R9               +QM2534=QV1234                               
         ST    RE,ITOTS+V1234                                                   
                                                                                
* ADDITIONAL OCT/90 DEMOS                                                       
                                                                                
         OC    NUW1820,NUW1820     UNIV WILL BE THERE IF                        
         BZ    TTNDEM62            DATA IS AVAILABLE                            
         L     RE,ITOTS+W1849                                                   
         S     RE,NQW1820                                                       
         ST    RE,ITOTS+W2149                                                   
         L     RF,ITOTS+M1849                                                   
         S     RF,NQM1820                                                       
         ST    RF,ITOTS+M2149                                                   
         AR    RE,RF                                                            
         ST    RE,ITOTS+V2149                                                   
                                                                                
* NOW ADJUST THE PRECISION OF TOTS TO IUN (HUNDREDS)                            
                                                                                
TTNDEM62 LHI   R0,IUNDEMS          R0=COUNTER                                   
         LHI   R1,10               R1=10                                        
         LHI   RE,500              RE=500                                       
         LHI   RF,1000             RF=1000                                      
         LA    R6,ITOTS            R6=A(VALUE)                                  
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM64                                                         
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
                                                                                
TTNDEM64 SR    R4,R4                                                            
         L     R5,0(R6)            GET TOT                                      
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
         ST    R5,0(R6)                                                         
         AHI   R6,L'ITOTS                                                       
         BCT   R0,TTNDEM64                                                      
                                                                                
* WIND UP BY COMPUTING QMETROA AND QMETROB                                      
                                                                                
         LHI   R0,5                                                             
         LHI   R1,10                                                            
         LHI   RE,500                                                           
         LHI   RF,1000                                                          
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM66                                                         
         SR    R0,R0                                                            
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
                                                                                
TTNDEM66 L     R5,NPMETROA         GET NSI PUT                                  
         SR    R4,R4               SCALE TO ONE DECIMAL PLACE                   
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10  ROUNDED                                 
                                                                                
         L     R7,IUNVS+METROA     GET UMETA (INTEGER)                          
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               QMETA=PMETA*UMETA                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BNE   TTNDEM68                                                         
         CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    TTNDEM68                                                         
         SR    R4,R4                                                            
         AR    R5,R0                                                            
         DR    R4,R1                                                            
         MR    R4,R1                                                            
TTNDEM68 ST    R5,ITOTS+METROA                                                  
                                                                                
         L     R5,NPMETROB         GET NSI PMETROB                              
         SR    R4,R4                                                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
                                                                                
         L     R7,IUNVS+METROB     GET UMETB (INTEGER)                          
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               QMETB=PMETB * UMETB                          
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BNE   TTNDEM70                                                         
         CLI   FILTYP,FILTPAVQ     TEST PAV FILE                                
         BE    TTNDEM70                                                         
         SR    R4,R4                                                            
         AR    R5,R0                                                            
         DR    R4,R1                                                            
         MR    R4,R1                                                            
TTNDEM70 ST    R5,ITOTS+METROB                                                  
                                                                                
* USE THE IUN PUTS IF PRESENT, OTHERWISE CALCULATE THEM FROM THE                
* TSA IMPRESSIONS                                                               
                                                                                
TTNDEM72 TM    ELEMMASK,PUT        TEST IF PUT REQUIRED                         
         BZ    TTNDEM86                                                         
         CLI   DMAIMP,C'I'         TOTALS NOT %AGE                              
         BE    *+12                                                             
         CLI   RTGPUT,C'Y'         TEST IF PUT ELEMENT PRESENT                  
         BE    TTNDEM80                                                         
                                                                                
* PUTS MISSING - COMPUTE THE DMA TOTAL IMPRESSIONS                              
                                                                                
         MVC   ITSAS+HOMES(4),NWHOMES                                           
         MVC   ITSAS+WWORK(4),NWWWORK                                           
         MVC   ITSAS+V611(4),NWV611                                             
         LM    R4,R9,NWW1824       W1824,W2534,W3549,W5054,W5564,W65+           
         LR    RE,R4               WW1824                                       
         AR    RE,R5               WW1834=WW1824+WW2534                         
         ST    RE,ITSAS+W1834                                                   
         LR    R0,RE               SAVE WW1834 IN R0                            
                                                                                
         LR    RF,R5               WW2534                                       
         AR    RF,R6               WW2549=WW2534+WW3549                         
         ST    RF,ITSAS+W2549                                                   
         AR    RE,R6               WW1849=WW1834+WW3549                         
         ST    RE,ITSAS+W1849                                                   
         LR    R1,RE               SAVE WW1849 IN R1                            
                                                                                
         AR    RF,R7               WW2554=WW2549+WW5054                         
         ST    RF,ITSAS+W2554                                                   
         AR    RF,R8               WW2564=WW2554+WW5564                         
         ST    RF,ITSAS+W2564                                                   
         AR    RF,R4               WW1864=WW2564+WW1824                         
         AR    RF,R9               WW18+=WW1864+WW65+                           
         ST    RF,ITSAS+W1899                                                   
                                                                                
         LM    R4,R9,NWM1824       M1824,M2534,M3549,M5054,M5564,M65+           
         LR    RE,R4               WM1824                                       
         AR    RE,R5               WM1834=WM1824+WM2534                         
         ST    RE,ITSAS+M1834                                                   
         AR    R0,RE               WV1834=WW1834+WM1834                         
         ST    R0,ITSAS+V1834                                                   
                                                                                
         LR    RF,R5               WM2534                                       
         AR    RF,R6               WM2549=WM1834+WM3549                         
         ST    RF,ITSAS+M2549                                                   
         AR    RE,R6               WM1849=WM1834+WM3549                         
         ST    RE,ITSAS+M1849                                                   
         AR    R1,RE               WV1849=WW1849+WM1849                         
         ST    R1,ITSAS+V1849                                                   
                                                                                
         AR    RF,R7               WM2554=WM2549+WM5054                         
         ST    RF,ITSAS+M2554                                                   
         LR    R0,RF                                                            
         A     R0,ITSAS+W2554      WV2554=WM2554+WW2554                         
         ST    R0,ITSAS+V2554                                                   
         AR    RF,R8               WM2564=WM2554+WM5564                         
         ST    RF,ITSAS+M2564                                                   
         AR    RF,R4               WM1864=WM2564+WM1824                         
         AR    RF,R9               WM18+=WM1864+WM65+                           
         ST    RF,ITSAS+M1899                                                   
                                                                                
         A     RF,ITSAS+W1899      WV18+=WM18+ + WW18+                          
         ST    RF,ITSAS+V1899                                                   
         LM    R0,R1,NWV25         V2-5, V6-11                                  
         LM    R4,R6,NWW1217       W1217,W1824,W2534                            
         LM    R7,R9,NWM1217       M1217,M1824,M2534                            
                                                                                
         AR    R0,R1               WV211=WV25+WV611                             
         ST    R0,ITSAS+V211                                                    
         LR    RE,R4                                                            
         AR    RE,R7               WV1217=WW1217+WM1217                         
         ST    RE,ITSAS+V1217                                                   
         AR    R0,RE               WV2-17=WV2-11+WV12-17                        
         AR    R0,RF               WV2+=WV2-17+WV18+                            
         ST    R0,ITSAS+V299                                                    
         LR    R1,R4                                                            
         AR    R1,R5               WW1224=WW1217+WW1824                         
         ST    R1,ITSAS+W1224                                                   
                                                                                
         LR    RE,R7               WM1217                                       
         AR    RE,R8               WM1224=WMU217+WM1824                         
         AR    RE,R1               WV1224=WM1224+WW1224                         
         ST    RE,ITSAS+V1224                                                   
                                                                                
         AR    R1,R6               WW1234=WW1224+WW2534                         
         ST    R1,ITSAS+W1234                                                   
         AR    RE,R6               WV1224+WW2534                                
         AR    RE,R9               +WM2534=WV1234                               
         ST    RE,ITSAS+V1234                                                   
                                                                                
* ADDITIONAL OCT/90 DEMOS                                                       
                                                                                
         OC    NUW1820,NUW1820     UNIV WILL BE THERE IF                        
         BZ    TTNDEM74            DATA IS AVAILABLE                            
         L     RE,ITSAS+W1849                                                   
         S     RE,NWW1820                                                       
         ST    RE,ITSAS+W2149                                                   
         L     RF,ITSAS+M1849                                                   
         S     RF,NWM1820                                                       
         ST    RF,ITSAS+M2149                                                   
         AR    RE,RF                                                            
         ST    RF,ITSAS+V2149                                                   
                                                                                
* NOW COMPUTE THE PUTS FROM THE DMA TOTAL IMPRESSIONS AND UNIVERSES             
                                                                                
TTNDEM74 LHI   R0,IUNDEMS          R0=LOOP COUNTER                              
         LHI   R1,1000                                                          
         LHI   RE,5                                                             
         LHI   RF,10                                                            
         LA    R6,ITSAS            R6=A(TSA IMPRESSION)                         
         LA    R7,IUNVS            R7=A(UNIVERSE)                               
         LA    R8,IPUTS            R8=A(PUT)                                    
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   TTNDEM76                                                         
         SR    RE,RE                                                            
         LHI   RF,1                                                             
                                                                                
TTNDEM76 L     R5,0(R6)            GET TSA IMPRESSION                           
         CLI   DMAIMP,C'I'                                                      
         BE    TTNDEM78            JUST COMPUTE TOTAL                           
         MR    R4,R1               *1000                                        
         ICM   R9,15,0(R7)         GET UNIVERSE                                 
         BNZ   *+10                                                             
         SR    R5,R5                                                            
         B     TTNDEM78                                                         
                                                                                
         DR    R4,R9               R5=UNROUNDED PUT                             
         CLI   FILTYP,FILTPAVQ                                                  
         BE    TTNDEM78                                                         
         SR    R4,R4                                                            
         AR    R5,RE               +5                                           
         DR    R4,RF               /10                                          
         MR    R4,RF               *10                                          
                                                                                
TTNDEM78 ST    R5,0(R8)                                                         
         AHI   R6,L'ITSAS          NEXT TSA IMPRESSION                          
         AHI   R7,L'IUNVS          NEXT UNIVERSE                                
         AHI   R8,L'IPUTS          NEXT PUT                                     
         BCT   R0,TTNDEM76                                                      
                                                                                
* ADJUST PMETROA AND PMETROB FROM NSI PRECISION TO IUN PRECISION                
                                                                                
TTNDEM80 LHI   R1,500                                                           
         LHI   RE,1000                                                          
         LHI   RF,10                                                            
                                                                                
         CLI   DBSELMED,C'C'                                                    
         BNE   TTNDEM82                                                         
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
                                                                                
TTNDEM82 L     R5,NPMETROA                                                      
         SR    R4,R4                                                            
         AR    R5,R1                                                            
         DR    R4,RE                                                            
         MR    R4,RF                                                            
         ST    R5,IPUTS+METROA                                                  
                                                                                
         L     R5,NPMETROB                                                      
         SR    R4,R4                                                            
         AR    R5,R1                                                            
         DR    R4,RE                                                            
         MR    R4,RF                                                            
         ST    R5,IPUTS+METROB                                                  
                                                                                
* WHEN PUT ELEMENT PRESENT, COMPUTE PHOMES FROM DMA TOT IMP & UNIVERSE          
                                                                                
         LHI   RE,5                                                             
         LHI   RF,10                                                            
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   *+10                                                             
         SR    RE,RE                                                            
         LHI   RF,1                                                             
                                                                                
         CLI   DMAIMP,C'I'         FORCE TOTALS NOT %AGE                        
         BE    TTNDEM86                                                         
         CLI   RTGPUT,C'Y'         TEST IF PUT ELEMENT PRESENT                  
         BNE   TTNDEM86            NO-HAVE CALCULATED PHOMES ALREADY            
         L     R5,NWHOMES          GET HOMES TSA IMP                            
         M     R4,F1000            *1000 FOR SCALING                            
         D     R4,IUNVS+HOMES      /HOMES UNIVERSE                              
         CLI   FILTYP,FILTPAVQ                                                  
         BE    *+12                                                             
         SR    R4,R4                                                            
         AR    R5,RE               ROUND THE VALUE                              
         DR    R4,RF                                                            
         MR    R4,RF                                                            
         ST    R5,IPUTS+HOMES                                                   
                                                                                
         L     R5,IPUTS+V211       COMPENSATE FOR BUG IN FORMULA                
         CLI   FILTYP,FILTPAVQ     PRIOR TO FEB87 BY ROUNDING PV211             
         BE    *+12                                                             
         SR    R4,R4                                                            
         AR    R5,RE               ROUND THE VALUE                              
         DR    R4,RF                                                            
         MR    R4,RF                                                            
         ST    R5,IPUTS+V211                                                    
                                                                                
         OC    NUW1820,NUW1820                                                  
         BZ    TTNDEM84                                                         
         L     R4,NWW2124                                                       
         LM    R5,R6,NWW2534                                                    
         AR    R5,R4                                                            
         AR    R5,R6                                                            
         LR    R8,R5               W2149                                        
         M     R4,F1000                                                         
         L     R0,IUNVS+W2149      R0 = UW2149                                  
         DR    R4,R0                                                            
         ST    R5,IPUTS+W2149                                                   
                                                                                
         L     R4,NWM2124                                                       
         LM    R5,R6,NWM2534                                                    
         AR    R5,R4                                                            
         AR    R5,R6                                                            
         LR    R9,R5               M2149                                        
         M     R4,F1000                                                         
         L     R0,IUNVS+M2149      R0 = UM2149                                  
         DR    R4,R0                                                            
         ST    R5,IPUTS+M2149                                                   
                                                                                
         AR    R9,R8                                                            
         M     R8,F1000                                                         
         L     R0,IUNVS+V2149      R0 = UV2149                                  
         DR    R8,R0                                                            
         ST    R9,IPUTS+V2149                                                   
                                                                                
TTNDEM84 OC    IPUTS+V2554(4),IPUTS+V2554 TEST IF PV2554 THERE                  
         BNZ   TTNDEM86            YES                                          
                                                                                
         LM    R4,R6,NWW2534       R4=WW2534,R5=WW3549,R6=WW5054                
         LM    R7,R9,NWM2534       R7=WM2534,R8=WM3549,R9=WM5054                
         AR    R5,R4                                                            
         AR    R5,R6                                                            
         AR    R5,R7                                                            
         AR    R5,R8                                                            
         AR    R5,R9               R5=WV2554                                    
                                                                                
         M     R4,F1000            SCALE THE DIVIDEND                           
         ICM   R0,15,IUNVS+V2554 R0=UV2554                                      
         BNZ   *+14                                                             
         SR    R5,R5                                                            
         ST    R5,IPUTS+V2554                                                   
         B     TTNDEM86                                                         
                                                                                
         LHI   RE,5                                                             
         LHI   RF,10                                                            
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BNE   *+10                                                             
         SR    RE,RE                                                            
         LHI   RF,1                                                             
                                                                                
         DR    R4,R0               WV2554*1000/UV2554                           
         CLI   FILTYP,FILTPAVQ                                                  
         BE    *+12                                                             
         SR    R4,R4                                                            
         AR    R5,RE               +5                                           
         DR    R4,RF               /10                                          
         MR    R4,RF               *10                                          
         ST    R5,IPUTS+V2554                                                   
                                                                                
* ADJUST UNIVERSES TO IUN PRECISION AFTER ALL CALCULATIONS ARE DONE             
* AND MOVE TO OUTPUT AREA                                                       
                                                                                
TTNDEM86 LHI   R0,IUNDEMS          R0=LOOP COUNTER                              
         LHI   R1,10                                                            
         LHI   RE,500                                                           
         LHI   RF,1000                                                          
         LA    R6,IUNVS            R6=A(UNIVERSE)                               
                                                                                
         CLI   DBSELMED,C'C'       TEST CANADIAN                                
         BE    *+12                                                             
         CLI   DMAIMP,C'I'         FULL PRECISION (UNIVERSE 100)                
         BNE   TTNDEM88                                                         
         LHI   R1,1                                                             
         LHI   RE,50                                                            
         LHI   RF,100                                                           
                                                                                
TTNDEM88 L     R5,0(R6)            GET UNADJUSTED UNIVERSE                      
         SR    R4,R4               SCALE TO THOUSANDS                           
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
         ST    R5,0(R6)                                                         
         AHI   R6,L'IUNVS                                                       
         BCT   R0,TTNDEM88                                                      
                                                                                
         MVC   UNVS(UNVSL),IUNVS   MOVE ADJUSTED UNVIS OUT                      
         CLI   CALLSYST,SYSSPTQ    TEST SPOT SYSTEM                             
         BE    TTNDEM92                                                         
                                                                                
* MOVE THE IUN VALUES TO USER WORK AREA                                         
                                                                                
         CLI   CALLTYPE,2          TEST PUTS/TOTS ONLY                          
         BE    TTNDEM90                                                         
         MVC   RTGS(RTGSL),IRTGS                                                
         MVC   IMPS(IMPSL),IIMPS                                                
         CLI   CALLTYPE,1          TEST RATINGS/IMPS ONLY                       
         BE    TTNDEMX             YES                                          
         MVC   PUTS(PUTSL),IPUTS                                                
         MVC   TOTS(TOTSL),ITOTS                                                
         B     TTNDEMX                                                          
                                                                                
TTNDEM90 MVC   SPUTS(SPUTSL),IPUTS                                              
         MVC   STOTS(STOTSL),ITOTS                                              
         B     TTNDEMX                                                          
                                                                                
TTNDEM92 LA    R6,IRTGS            YES - APPLY WEIGHTING FACTOR                 
         LA    R7,RTGS                                                          
         LA    R0,IUNDEMS*2                                                     
         TM    ELEMMASK,PUT+TOT                                                 
         BNO   TTNDEM94                                                         
         AR    R0,R0                                                            
                                                                                
TTNDEM94 L     R5,0(R6)                                                         
         MH    R5,DBFACTOR                                                      
         A     R5,0(R7)                                                         
         ST    R5,0(R7)                                                         
         AHI   R6,L'IRTGS                                                       
         AHI   R7,L'IRTGS                                                       
         BCT   R0,TTNDEM94                                                      
                                                                                
TTNDEMX  J     EXIT                                                             
         DROP  RB                                                               
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* IUN PROCESSING ROUTINE                                              *         
* EXTRACT SELECTED IUN DEMOS BASED ON ELEMENT TABLES                  *         
***********************************************************************         
                                                                                
IUNDEM   NTR1  BASE=*,LABEL=*                                                   
         SR    R0,R0                                                            
         B     IUNDEM04            LOOK AT FIRST ELEMENT                        
                                                                                
IUNDEM02 IC    R0,1(R6)                                                         
         AR    R6,R0               BUMP TO NEXT ELEMENT                         
                                                                                
IUNDEM04 CLI   0(R6),0             TEST FOR EOR                                 
         BE    IUNDEMX                                                          
                                                                                
IUNDEM06 CLI   0(R6),0             TEST FOR EOR                                 
         BE    IUNDEM20                                                         
         CLI   ELEMNUM,EOT         TEST END OF ELEMENT TABLE                    
         BE    IUNDEM20                                                         
         CLC   ELEMNUM,0(R6)       TEST ELEMENT CODE MATCHES TABLE              
         BH    IUNDEM02            NO BUMP TO NEXT ELEMENT                      
         BL    IUNDEM18            NO BUMP TO NEXT TABLE ENTRY                  
                                                                                
IUNDEM08 SR    RF,RF                                                            
         ICM   RF,3,ELEMDISP       GET DISP TO ELEMENT DEMO LIST                
         LA    R5,IUNVALS(RF)      RELOCATE TABLE ADDRESS                       
                                                                                
         SR    R9,R9                                                            
         IC    R9,1(R6)            GET ELEMENT LENGTH                           
         LA    R9,0(R6,R9)         POINT PAST ELEMENT                           
         BCTR  R9,0                BACK UP TO LAST BYTE-BXLE LIMIT              
         TM    0(R6),X'01'         TEST FOR ODD ELEMENT CODE                    
         BO    IUNDEM10            YES                                          
                                                                                
         LHI   R8,1                EVEN CODE MEANS L'DEMO ENTRY=1               
         LA    R7,2(R6)            AND DO NOT HAVE CONTROL BYTE                 
         B     IUNDEM12            ALL VALUES MUST BE MULTPLD BY 10             
                                                                                
IUNDEM10 IC    R8,2(R6)                                                         
         SLL   R8,28                                                            
         SRL   R8,28               ISOLATE FIELD LENGTH-BXLE INCREMENT          
         LA    R7,3(R6)            R7=INDEX REGISTER FOR BXLE                   
         MVC   EXPAND,F1           SET MULTIPLIER FOR ALL VALUES                
         TM    2(R6),X'40'         TEST FOR X 10 MULTIPLICATION                 
         BO    IUNDEM14            NO                                           
                                                                                
IUNDEM12 MVC   EXPAND,F10          SET 10X MULTIPLIER                           
                                                                                
IUNDEM14 SR    RF,RF               RF=VALUE                                     
         TM    0(R6),X'01'         TEST EVEN ELEMENT CODE                       
         BZ    IUNDEM16            YES-VALUE IS ALWAYS POSITIVE                 
         TM    2(R6),X'20'         TEST NEGATIVE VALUES PRESENT                 
         BZ    IUNDEM16                                                         
         TM    0(R7),X'80'         TEST SIGN BIT ON IN FIELD                    
         BZ    IUNDEM16                                                         
         LCR   RF,RF               SET VALUE TO ALL EFFS                        
                                                                                
IUNDEM16 IC    R1,ICMMASK-1(R8)    USE FIELD LENGTH AS TABLE INDEX              
         EX    R1,*+8                                                           
         B     *+8                                                              
         ICM   RF,0,0(R7)          GET VALUE INTO RF                            
         M     RE,EXPAND                                                        
         ST    RF,0(R5)            SET IUNVAL ENTRY                             
         AHI   R5,4                NEXT IUNVAL ENTRY                            
         BXLE  R7,R8,IUNDEM14                                                   
                                                                                
         IC    R0,1(R6)            NEXT ELEMENT                                 
         AR    R6,R0                                                            
                                                                                
IUNDEM18 AHI   R4,ELEMTABL         NEXT ELEMENT TABLE ENTRY                     
         B     IUNDEM06                                                         
                                                                                
IUNDEM20 SR    R0,R0               LOCATE BOOK ELEMENT                          
         L     R1,ABOOKEL          R1=A(BOOK ELEMENT)                           
         CLI   DMAIMP,C'I'         PROTECT AGAINST MULTI PASS                   
         BNE   *+8                                                              
         MVI   RTGTOIMP,C'Y'                                                    
         CLC   5(2,R1),=AL1(91,06) ALREADY IN IMP BASE                          
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(90,12) ALREADY IN IMP BASE                          
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(90,11) ALREADY IN IMP BASE                          
         BNE   IUNDEM22                                                         
         MVI   RTGTOIMP,C'N'       RESET CONVERSION                             
                                                                                
IUNDEM22 CLC   5(2,R1),=AL1(82,06) TEST PUT (JUN/82)                            
         BE    IUNDEM30                                                         
         CLC   5(2,R1),=AL1(84,06) TEST PUT (JUN/84)                            
         BE    IUNDEM30                                                         
         CLC   5(2,R1),=AL1(91,06) TEST PUT (JUN/91)                            
         BE    IUNDEM30                                                         
         CLC   5(2,R1),=AL1(83,12) TEST INDEX (DEC/83)                          
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(90,12) TEST INDEX (DEC/90)                          
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(82,05) TEST INDEX (MAY/82)                          
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(90,11) TEST INDEX (NOV/90)                          
         BE    *+10                                                             
         CLC   5(2,R1),=AL1(83,11) TEST INDEX (NOV/83)                          
         BNE   IUNDEM36                                                         
                                                                                
         OC    IRTGS+V2554(4),IRTGS+V2554 TEST OLD RTG=0                        
         BZ    *+14                YES-FORCE CALCULATION                        
         OC    INEWRTGS+V2554(4),INEWRTGS+V2554      TEST NEW RTG=0             
         BNZ   IUNDEM24                                                         
         GOTOR CV2554              YES-CALCULATE V2554 VALUES                   
                                                                                
IUNDEM24 IC    R0,1(R1)            BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         CLI   0(R1),0             TEST EOR                                     
         BE    IUNDEM36                                                         
         CLI   0(R1),X'DE'         TEST INDEX UPGRADE ELEMENT                   
         BL    IUNDEM24                                                         
         BH    IUNDEM36                                                         
                                                                                
         CLC   2(2,R1),NDXDEM2     '&&',X'FE'                                   
         BE    *+14                                                             
         CLC   2(2,R1),NDXDEM1     '&&',X'FF'                                   
         BNE   IUNDEM24                                                         
                                                                                
         SR    RF,RF               RF - INDEX                                   
         ICM   RF,3,4(R1)                                                       
         CLI   1(R1),6             TEST FOR 6 BYTE ELEMENT                      
         BE    *+8                 YES-INDEX VALUE IS HALFWORD                  
         ICM   RF,7,4(R1)          NO-INDEX VALUE IS 3 BYTES                    
         LTR   RF,RF                                                            
         BZ    IUNDEM36                                                         
         C     RF,F10000           TEST FOR NO ADJUSTMENT (100.00)              
         BE    IUNDEM36                                                         
                                                                                
         LA    R4,INEWRTGS         R4 - IUNVALS...NEW RTGS                      
                                                                                
         LHI   RE,IUNDEMS          RE - LOOP CONTROL                            
         L     R1,ABOOKEL                                                       
         CLC   5(2,R1),=AL1(83,11) TEST INDEX (NOV/83)                          
         BE    IUNDEM28                                                         
         CLC   5(2,R1),=AL1(83,12) TEST INDEX (DEC/83)                          
         BE    IUNDEM28                                                         
         CLC   5(2,R1),=AL1(90,11) TEST INDEX (NOV/90)                          
         BE    IUNDEM28                                                         
         CLC   5(2,R1),=AL1(90,12) TEST INDEX (DEC/90)                          
         BE    IUNDEM28                                                         
                                                                                
IUNDEM26 L     R1,0(R4)                                                         
         MR    R0,RF                                                            
         A     R1,F50000           ROUND                                        
         D     R0,F100000                                                       
         M     R0,F10                                                           
         ST    R1,0(R4)                                                         
         AHI   R4,L'INEWRTGS       BUMP NEW RTGS                                
         BCT   RE,IUNDEM26                                                      
         B     IUNDEM36                                                         
                                                                                
IUNDEM28 L     R1,0(R4)            UNROUNDED                                    
         MR    R0,RF                                                            
         AHI   R1,5000             ROUND                                        
         D     R0,F10000                                                        
         ST    R1,0(R4)                                                         
         AHI   R4,L'INEWRTGS       BUMP NEW RTGS                                
         BCT   RE,IUNDEM28                                                      
         B     IUNDEM36                                                         
                                                                                
IUNDEM30 DS    0H                  PUT UPGRADE                                  
         LA    R4,INEWRTGS         R4 - IUNVALS...NEW RTGS (OR IMPS)            
         LA    R5,IRTGS            R5 - IUNVALS...ORG RTGS (OR IMPS)            
         LA    R6,INEWPUTS         R6 - IUNVALS...NEW PUTS (OR TOTS)            
         LA    R7,IPUTS            R7 - IUNVALS...ORG PUTS (OR TOTS)            
         LHI   RE,IUNDEMS*2        RE - LOOP CONTROL (RTGS & IMPS)              
IUNDEM32 ICM   R1,15,0(R5)         R1 - ORG RTG                                 
         BZ    IUNDEM34            BYPASS ZERO RTG OR IMP                       
         M     R0,F1000                                                         
         OC    0(4,R7),0(R7)       TEST FOR ZERO DIVISOR                        
         BNZ   *+10                                                             
         SR    R1,R1               FORCE ZERO RESULT                            
         B     IUNDEM34                                                         
                                                                                
         D     R0,0(R7)            ORG RTG / ORG PUT                            
         SR    R0,R0                                                            
                                                                                
         M     R0,0(R6)            SHARE X NEW PUT                              
         AHI   R1,500              ROUND                                        
         D     R0,F1000            R1 - NEW RTG                                 
                                                                                
IUNDEM34 ST    R1,0(R4)                                                         
         AHI   R4,L'INEWRTGS       BUMP NEW RTGS (OR IMPS)                      
         AHI   R5,L'IRTGS          BUMP ORG RTGS (OR IMPS)                      
         AHI   R6,L'INEWPUTS       BUMP NEW PUTS (OR TOTS)                      
         AHI   R7,L'IPUTS          BUMP ORG PUTS (OR TOTS)                      
         BCT   RE,IUNDEM32                                                      
                                                                                
         OC    IRTGS+V2554(4),IRTGS+V2554 TEST OLD RTG=0                        
         BZ    *+14                YES-FORCE CALCULATION                        
         OC    INEWRTGS+V2554(4),INEWRTGS+V2554      TEST NEW RTG=0             
         BNZ   IUNDEM36                                                         
         GOTOR CV2554              YES-CALCULATE V2554 VALUES                   
                                                                                
IUNDEM36 L     R6,DBAQUART         RESTORE QUARTER HOUR ELEMENT ADDRESS         
         SR    R0,R0               APPLY OVERRIDES                              
IUNDEM38 IC    R0,1(R6)                                                         
         AR    R6,R0               BUMP TO FIRST DEMO ELEMENT                   
                                                                                
IUNDEM40 CLI   0(R6),0             TEST FOR EOR                                 
         BE    IUNDEM52                                                         
         CLI   0(R6),X'DE'         TEST FOR OVERRIDE ELEMENT CODE               
         BL    IUNDEM38                                                         
         BH    IUNDEM52                                                         
                                                                                
         LHI   R4,CATTAB-GETIUN                                                 
         A     R4,AGETIUN          R4 - CATEGORY TABLE                          
         LHI   R5,MODTAB-GETIUN                                                 
         A     R5,AGETIUN          R5 - MODIFIER TABLE                          
                                                                                
IUNDEM42 CLI   0(R5),EOT           TEST FOR END OF MODTAB                       
         BE    IUNDEM38                                                         
         CLC   0(1,R5),2(R6)       TEST MODIFIER EQUALS TABLE                   
         BE    *+12                                                             
         AHI   R5,L'MODTAB         BUMP MODTAB                                  
         B     IUNDEM42                                                         
                                                                                
         CLI   2(R6),C'S'          TEST FOR SHARE                               
         BNE   IUNDEM44                                                         
         LHI   R4,SHRTAB-GETIUN                                                 
         A     R4,AGETIUN          USE SPECIAL TABLE FOR SHARES                 
                                                                                
IUNDEM44 CLI   0(R4),EOT           TEST FOR END OF SHRTAB                       
         BE    IUNDEM38                                                         
         CLC   0(1,R4),3(R6)       TEST CATEGORY EQUALS TABLE                   
         BE    IUNDEM46                                                         
         AHI   R4,L'SHRTAB         BUMP SHRTAB                                  
         B     IUNDEM44                                                         
                                                                                
IUNDEM46 LA    RE,IUNVALS          OBTAIN DISPLACEMENT INTO IUNVALS             
         MVC   DUB(2),1(R5)        EXTRACT DISPLACEMENT                         
         AH    RE,DUB              MODTAB DISPLACEMENT                          
         SR    RF,RF                                                            
         IC    RF,1(R4)            CATTAB DISPLACEMENT                          
         AR    RE,RF                                                            
                                                                                
         SR    R1,R1                                                            
         ICM   R1,3,4(R6)          GET OVERRIDE VALUE                           
         CLI   0(R5),C'U'          TEST FOR UNIVERSE                            
         BE    IUNDEM48                                                         
         CLI   0(R5),C'Q'          TEST NEW TOTS                                
         BE    IUNDEM48                                                         
         CLI   0(R5),C'T'          TEST NEW IMPS                                
         BNE   IUNDEM50                                                         
                                                                                
IUNDEM48 M     R0,F10              MULTIPLY NEW TOTS + NEW IMPS BY 10           
                                                                                
IUNDEM50 ST    R1,0(RE)            SET OVERRIDE IN IUNVALS                      
         B     IUNDEM38                                                         
                                                                                
* MOVE OUT IUN VALUES INTO WORK AREA                                            
                                                                                
IUNDEM52 CLI   CALLTYPE,10         SEED OVERRIDE REQUEST?                       
         BNE   IUNDEM66                                                         
                                                                                
         L     R6,DBAQUART                                                      
IUNDEM54 CLI   0(R6),0             EOR                                          
         BE    IUNDEM66            NO (MORE) OVR ELEMS                          
         CLI   0(R6),X'DE'         R6 -> X'DE' ELEMENT                          
         BNE   IUNDEM64                                                         
         CLI   1(R6),12            ONLY DEAL W/NEW OVR ELEMS                    
         BNE   IUNDEM64                                                         
         CLI   4(R6),C'T'          HANDLE IMP & RTG OVR ONLY                    
         BE    IUNDEM56                                                         
         CLI   4(R6),C'R'                                                       
         BNE   IUNDEM64                                                         
                                                                                
IUNDEM56 SR    R5,R5                                                            
         CLI   4(R6),C'T'                                                       
         BNE   *+8                                                              
         LA    R5,INEWIMPS         R5 -> IMPS WORK AREA                         
         CLI   4(R6),C'R'                                                       
         BNE   *+8                                                              
         LA    R5,INEWRTGS         R5 -> RTGS WORK AREA                         
         LHI   R7,CATTAB-GETIUN                                                 
         A     R7,AGETIUN                                                       
         LHI   R0,CATTABN                                                       
IUNDEM58 CLC   5(1,R6),0(R7)       MATCH DEMO# ON OVR W/TBL TO GET DSP          
         BE    IUNDEM60                                                         
         AHI   R7,L'CATTAB                                                      
         BCT   R0,IUNDEM58                                                      
         B     IUNDEM64            OVR IS FOR CALC CELL, GET NXT OVR            
                                                                                
IUNDEM60 SR    RF,RF                                                            
         IC    RF,1(R7)            DISP TO DEMO CTGY                            
         AR    R5,RF               R5 -> OUTPUT BUCKET IN WORK                  
         ICM   R1,15,8(R6)         PICK UP OVR VALUE FROM RECD                  
                                                                                
         CLI   4(R6),C'R'          FOR RTGS ONLY                                
         BNE   IUNDEM62                                                         
         CLI   DMAIMP,C'I'         IMP BASED, SAVE OVR RTG * UNIV               
         BNE   IUNDEM62                                                         
         CLI   RTGTOIMP,C'Y'                                                    
         BE    IUNDEM62                                                         
         XC    DUB,DUB                                                          
         MVI   DUB+1,C'U'          LOOK UP UNIV FOR THIS DEMO                   
         MVC   DUB+2(1),5(R6)      MOVE IN MODIFIER AND DEMO CTGY               
         MVI   DUB+3,X'FF'                                                      
         MVC   HALF,DBACTBK                                                     
         L     RF,DBCOMFCS                                                      
         L     RF,CDEMOUT-COMFACSD(RF)                                          
         GOTOR (RF),DMCB,(C'L',DUB),DBLOCKD,DUB+4                               
         MVC   DBACTBK,HALF                                                     
         SR    R1,R1                                                            
         CLI   DBERROR,0                                                        
         BNE   IUNDEM66            IF ERROR, BYPASS OVERRIDE                    
         ICM   R1,15,DUB+4         PICK UP UNIVERSE                             
         MVC   HALF,10(R6)         PICK UP OVERRIDE RTG VALUE                   
         MH    R1,HALF             RTG * UNV-> MAKE IMP BASED                   
                                                                                
IUNDEM62 STCM  R1,15,0(R5)         SEED OVERRIDE                                
                                                                                
IUNDEM64 SR    R0,R0               LOOK FOR ANOTHER OVERRIDE ELEMENT            
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     IUNDEM54                                                         
                                                                                
IUNDEM66 MVC   UNVS(UNVSL),IUNVS                                                
         MVC   RTGS(RTGSL),IRTGS                                                
         MVC   IMPS(IMPSL),IIMPS                                                
         MVC   PUTS(PUTSL),IPUTS                                                
         MVC   TOTS(TOTSL),ITOTS                                                
         MVC   NEWRTGS(NEWRTGSL),INEWRTGS                                       
         MVC   NEWIMPS(NEWIMPSL),INEWIMPS                                       
         MVC   NEWPUTS(NEWPUTSL),INEWPUTS                                       
         MVC   NEWTOTS(NEWTOTSL),INEWTOTS                                       
         MVC   SHRS(SHRSL),ISHRS                                                
                                                                                
* CONVERT PERCENTS TO IMPS IF MISMATCH ON FILE PRECISIONS                       
                                                                                
         CLI   RTGTOIMP,C'Y'                                                    
         BNE   IUNDEMX                                                          
         LA    R8,UNVS             SET UP UNIVERSES                             
         LA    RE,RTGS             CONVERT THE RATINGS                          
         LHI   R9,IUNDEMS                                                       
         SR    R7,R7                                                            
IUNDEM68 SR    R0,R0                                                            
         L     R1,0(R7,RE)                                                      
         L     R0,0(R7,R8)                                                      
         MR    R0,R0                                                            
         SR    R0,R0                                                            
         AHI   R1,5                                                             
         D     R0,F10                                                           
         ST    R1,0(R7,RE)                                                      
         AHI   R7,4                                                             
         BCT   R9,IUNDEM68                                                      
                                                                                
         LA    RE,PUTS             CONVERT THE PUTS                             
         LHI   R9,IUNDEMS                                                       
         SR    R7,R7                                                            
IUNDEM70 SR    R0,R0                                                            
         L     R1,0(R7,RE)                                                      
         L     R0,0(R7,R8)                                                      
         MR    R0,R0                                                            
         SR    R0,R0                                                            
         AHI   R1,5                                                             
         D     R0,F10                                                           
         ST    R1,0(R7,RE)                                                      
         AHI   R7,4                                                             
         BCT   R9,IUNDEM70                                                      
                                                                                
         LA    RE,NEWRTGS          CONVERT THE NEW RATINGS                      
         LHI   R9,IUNDEMS                                                       
         SR    R7,R7                                                            
IUNDEM72 SR    R0,R0                                                            
         L     R1,0(R7,RE)                                                      
         L     R0,0(R7,R8)                                                      
         MR    R0,R0                                                            
         SR    R0,R0                                                            
         AHI   R1,5                                                             
         D     R0,F10                                                           
         ST    R1,0(R7,RE)                                                      
         AHI   R7,4                                                             
         BCT   R9,IUNDEM72                                                      
                                                                                
         LA    RE,NEWPUTS          CONVERT THE NEW PUTS                         
         LHI   R9,IUNDEMS                                                       
         SR    R7,R7                                                            
IUNDEM74 SR    R0,R0                                                            
         L     R1,0(R7,RE)                                                      
         L     R0,0(R7,R8)                                                      
         MR    R0,R0                                                            
         SR    R0,R0                                                            
         AHI   R1,5                                                             
         D     R0,F10                                                           
         ST    R1,0(R7,RE)                                                      
         AHI   R7,4                                                             
         BCT   R9,IUNDEM74                                                      
                                                                                
IUNDEMX  J     EXIT                                                             
         DROP  RB                                                               
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* NSI WEEKLY PROCESSING ROUTINE                                       *         
* NOTE - DECIMAL PRECISION MAINTAINED ON RATINGS AND PUTS             *         
***********************************************************************         
                                                                                
TWNDEM   NTR1  BASE=*,LABEL=*                                                   
         SR    R0,R0                                                            
                                                                                
TWNDEM02 IC    R0,1(R6)                                                         
         AR    R6,R0               BUMP TO FIRST DEMO ELEMENT                   
         CLI   0(R6),0             TEST FOR EOR                                 
         BE    TWNDEMX                                                          
         CLI   0(R6),X'20'         TEST FOR NEXT QUARTER HOUR                   
         BE    TWNDEMX                                                          
         CLI   0(R6),X'30'         TEST START OF DEMO ELEMENTS FOR              
         BL    TWNDEM02            THIS QUARTER HOUR                            
                                                                                
TWNDEM04 CLI   0(R6),0             TEST FOR EOR                                 
         BE    TWNDEM12                                                         
         CLI   ELEMNUM,EOT         TEST END OF ELEMENT TABLE                    
         BE    TWNDEM12                                                         
         CLC   0(1,R6),ELEMNUM     TEST ELEMENT CODE MATCHES TABLE              
         BNE   TWNDEM10            NO BUMP TO NEXT TABLE ENTRY                  
                                                                                
         MVC   DEMOTYPE,ELEMTYPE   EXTRACT ELEMENT DEMO TYPE                    
         NC    DEMOTYPE,ELEMMASK   'AND' DEMO TYPE MASK INTO IT                 
         BZ    TWNDEM08            NOT A DEMO TYPE WE WANT                      
         SR    R5,R5                                                            
         ICM   R5,3,ELEMDISP       GET DISP TO ELEMENT DEMO LIST                
         A     R5,AGETIUN          RELOCATE TABLE ADDRESS                       
         USING TTNLISTD,R5                                                      
                                                                                
         LR    R1,R6               R1=A(DEMO ELEMENT)                           
         TM    2(R6),X'80'         TEST IF DUPLICATE DEMO ELEMENT               
         BZ    TWNDEM06            NO                                           
         ICM   RE,3,2(R6)          YES                                          
         SLL   RE,17               SHIFT OFF X'80' BIT                          
         SRL   RE,17               RE=DISP INTO DEMO RECORD                     
         L     R1,DBAREC                                                        
         LA    R1,0(RE,R1)                                                      
                                                                                
TWNDEM06 GOTOR XPLDEL              EXPLODE DEMO ELEMENT                         
                                                                                
TWNDEM08 IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
                                                                                
TWNDEM10 AHI   R4,ELEMTABL         NEXT ELEMENT TABLE ENTRY                     
         B     TWNDEM04                                                         
                                                                                
***********************************************************************         
* CALCULATE THE IUN VALUES FROM THE NSI SUPPLIED CATEGORIES           *         
***********************************************************************         
                                                                                
TWNDEM12 MVC   IUNVS+HOMES(4),NUHOMES                                           
         MVC   IUNVS+METROA(4),NUMETROA                                         
         MVC   IUNVS+METROB(4),NUMETROB                                         
         MVC   IIMPS+HOMES(4),NTHOMES                                           
                                                                                
         LHI   R0,IUNDEMS          R0=COUNTER                                   
         LHI   R1,10               R1=10                                        
         LHI   RE,500              RE=500                                       
         LHI   RF,1000             RF=1000                                      
         LA    R6,IIMPS            R6=A(VALUE)                                  
                                                                                
TWNDEM14 SR    R4,R4                                                            
         L     R5,0(R6)            GET IMPRESSION                               
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
         ST    R5,0(R6)                                                         
         LA    R6,4(R6)                                                         
         BCT   R0,TWNDEM14                                                      
                                                                                
* COMPUTE TMETROA AND TMETROB                                                   
                                                                                
         LHI   R0,5                                                             
         L     R5,NRMETROA         SCALE TO ONE DECIMAL PLACE                   
         SR    R4,R4                                                            
         AHI   R5,50               +50                                          
         D     R4,F100             /100                                         
                                                                                
         L     R7,IUNVS+METROA                                                  
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               TMETA=RMETA*UMETA                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         SR    R4,R4               NOW DINK THE IMP                             
         AR    R5,R0               +5                                           
         DR    R4,R1               /10                                          
         MR    R4,R1               *10                                          
         ST    R5,IIMPS+METROA                                                  
                                                                                
         L     R5,NRMETROB         SCALE TO ONE DECIMAL PLACE                   
         SR    R4,R4                                                            
         AHI   R5,50               +50                                          
         D     R4,F100             /100                                         
                                                                                
         L     R7,IUNVS+METROB                                                  
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               TMETB=RMETB*UMETB                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         SR    R4,R4               NOW DINK THE IMP                             
         AR    R5,R0               +5                                           
         DR    R4,R1               /10                                          
         MR    R4,R1               *10                                          
         ST    R5,IIMPS+METROB                                                  
                                                                                
         MVC   IDMAS+HOMES(4),NDHOMES                                           
                                                                                
         LHI   R0,3                R0=LOOP COUNTER                              
         LHI   RE,50                                                            
         LHI   RF,100                                                           
         LA    R6,NRHOMES                                                       
         LA    R7,IRTGS+HOMES                                                   
                                                                                
TWNDEM16 L     R5,0(R6)            GET UNADJUSTED RATING                        
         SR    R4,R4                                                            
         AR    R5,RE               +50                                          
         DR    R4,RF               /100                                         
         ST    R5,0(R7)                                                         
         LA    R6,4(R6)                                                         
         LA    R7,4(R7)                                                         
         BCT   R0,TWNDEM16                                                      
                                                                                
         TM    ELEMMASK,TOT        TEST TOT REQUIRED                            
         BZ    TWNDEM18            NO                                           
         MVC   ITOTS+HOMES(4),NQHOMES                                           
                                                                                
         LHI   R0,5                                                             
         LHI   R1,10                                                            
         LHI   RE,500                                                           
         LHI   RF,1000                                                          
                                                                                
         L     R5,NPMETROA         GET NSI PUT                                  
         SR    R4,R4               SCALE TO ONE DECIMAL PLACE                   
         AHI   R5,50               +50                                          
         D     R4,F100             /100                                         
                                                                                
         L     R7,IUNVS+METROA     GET UMETA (INTEGER)                          
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               QMETA=PMETA*UMETA                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         SR    R4,R4               NOW DINK THE TOT                             
         AR    R5,R0               +5                                           
         DR    R4,R1               /10                                          
         MR    R4,R1               *10                                          
         ST    R5,ITOTS+METROA                                                  
                                                                                
         L     R5,NPMETROB         GET NSI PMETROB                              
         SR    R4,R4               SCALE TO ONE DECIMAL PLACE                   
         AHI   R5,50               +50                                          
         D     R4,F100             /100                                         
                                                                                
         L     R7,IUNVS+METROB     GET UMETB (INTEGER)                          
         SR    R6,R6               SCALE TO HUNDREDS                            
         AR    R7,RE               +500                                         
         DR    R6,RF               /1000                                        
         MR    R6,R1               *10                                          
                                                                                
         MR    R4,R7               QMETB=PMETB*UMETB                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         SR    R4,R4               NOW DINK THE TOT                             
         AR    R5,R0               +5                                           
         DR    R4,R1               /10                                          
         MR    R4,R1               *10                                          
         ST    R5,ITOTS+METROB                                                  
                                                                                
* USE THE IUN PUTS IF PRESENT, OTHERWISE CALCULATE THEM FROM THE                
* TSA IMPRESSIONS                                                               
                                                                                
TWNDEM18 TM    ELEMMASK,PUT        TEST IF PUT REQUIRED                         
         BZ    TWNDEM20                                                         
         MVC   ITSAS+HOMES(4),NWHOMES                                           
                                                                                
* ADJUST PMETROA AND PMETROB FROM NSI PRECISION TO IUN PRECISION                
* ALSO PHOMES                                                                   
                                                                                
         L     R5,NPMETROA                                                      
         SR    R4,R4                                                            
         AHI   R5,50                                                            
         D     R4,F100                                                          
         ST    R5,IPUTS+METROA                                                  
                                                                                
         L     R5,NPMETROB                                                      
         SR    R4,R4                                                            
         AHI   R5,50                                                            
         D     R4,F100                                                          
         ST    R5,IPUTS+METROB                                                  
                                                                                
         L     R5,NPHOMES                                                       
         SR    R4,R4                                                            
         AHI   R5,50                                                            
         D     R4,F100                                                          
         ST    R5,IPUTS+HOMES                                                   
                                                                                
* ADJUST UNIVERSES TO IUN PRECISION AFTER ALL CALCULATIONS ARE DONE             
* AND MOVE TO OUTPUT AREA                                                       
                                                                                
TWNDEM20 LHI   R0,IUNDEMS          R0=LOOP COUNTER                              
         LHI   R1,10                                                            
         LHI   RE,500                                                           
         LHI   RF,1000                                                          
         LA    R6,IUNVS            R6=A(UNIVERSE)                               
                                                                                
TWNDEM22 L     R5,0(R6)            GET UNADJUSTED UNIVERSE                      
         SR    R4,R4                                                            
         AR    R5,RE               +500                                         
         DR    R4,RF               /1000                                        
         MR    R4,R1               *10                                          
         ST    R5,0(R6)                                                         
         LA    R6,4(R6)                                                         
         BCT   R0,TWNDEM22                                                      
                                                                                
         MVC   UNVS(UNVSL),IUNVS   MOVE ADJUSTED UNIVS OUT                      
                                                                                
* FINISH BY WEIGHTING THE IUN VALUES AND UPDATING WORK AREA                     
* ACCUMULATORS                                                                  
                                                                                
         LA    R1,IUNDEMS*2        R1=LOOP COUNTER                              
         TM    ELEMMASK,PUT+TOT    TEST IF PUTS AND TOTS NEEDED                 
         BNO   *+8                                                              
         LA    R1,IUNDEMS*2(R1)    YES-TWICE AS MANY DEMOS                      
         LH    R0,DBFACTOR         R0=WEIGHTING FACTOR                          
         LA    R6,IRTGS            R6=A(UNWEIGHTED VALUE)                       
         LA    R7,RTGS             R7=A(ACCUMULATOR)                            
                                                                                
TWNDEM24 L     R5,0(R6)            GET UNWEIGHTED VALUE                         
         MR    R4,R0               WEIGHT                                       
         A     R5,0(R7)            ADD TO ACCUMULATOR                           
         ST    R5,0(R7)                                                         
         LA    R6,4(R6)            NEXT INPUT VALUE                             
         LA    R7,4(R7)            NEXT OUTPUT VALUE                            
         BCT   R1,TWNDEM24                                                      
                                                                                
TWNDEMX  J     EXIT                                                             
         DROP  RB                                                               
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* NETWORK  - CONVERT NETWORK FILES INTO IUN FORMAT                    *         
***********************************************************************         
                                                                                
NETWRK   NTR1  BASE=*,LABEL=*                                                   
         OC    DBCOMFCS,DBCOMFCS   COMFACS MUST BE RESOLVED FOR NETWORK         
         BNZ   NETWRK02                                                         
         MVI   DBERROR,1                                                        
         B     NETWRKX                                                          
                                                                                
NETWRK02 LHI   RF,NETDEMS-GETIUN                                                
         A     RF,AGETIUN                                                       
         MVC   DEMOLST,0(RF)                                                    
         LHI   R5,NETMDF-GETIUN                                                 
         A     R5,AGETIUN          MODIFIERS                                    
         CLC   DBSELSRC,0(R5)                                                   
         BE    NETWRK04                                                         
         AHI   R5,L'NETMDF                                                      
         CLI   0(R5),EOT                                                        
         BNE   *-18                                                             
         MVI   DBERROR,4           INVALID SOURCE                               
         B     NETWRKX                                                          
                                                                                
NETWRK04 LHI   R1,IUNDEMS          BUILD DEMOLIST                               
         LA    RE,DEMOLST                                                       
                                                                                
NETWRK06 MVI   0(RE),0                                                          
         MVC   1(1,RE),1(R5)       SET MODIFIER                                 
         AHI   RE,3                                                             
         BCT   R1,NETWRK06                                                      
         CLC   =C'KZ',0(R5)                                                     
         BNE   *+12                                                             
         LA    RE,DEMOLST+((HOMES/4)*3)                                         
         MVI   1(RE),C'P'          LK UP P1 NOT Z1                              
         LH    R6,2(R5)            GET A(WHERE TO SAVE DEMS)                    
         LA    R6,WORKD(R6)                                                     
                                                                                
         MVC   DUB(5),DBACTSTA                                                  
         OC    DBACTSTA,DBACTSTA                                                
         BNZ   *+10                                                             
         MVC   DUB(5),DBSELSTA                                                  
         CLC   =C'HUT',DUB                                                      
         BNE   NETWRK08                                                         
         CLC   =C'HZ',0(R5)        NHT FILE/PUT LOOKUP                          
         BE    NETWRK10            BYPASS ALTOGETHER --> NOT THERE              
                                                                                
NETWRK08 MVC   HALF,DBACTBK                                                     
         L     RF,DBCOMFCS                                                      
         L     RF,CDEMOUT-COMFACSD(RF)                                          
         GOTOR (RF),DMCB,(C'L',DEMOLST),DBLOCKD,(R6)                            
         MVC   DBACTBK,HALF                                                     
         CLI   DBERROR,0                                                        
         BNE   NETWRKX                                                          
                                                                                
NETWRK10 AHI   R5,L'NETMDF         PROCESS NEXT MODIFIERS DEMOS                 
         CLC   DBSELSRC,0(R5)                                                   
         BE    NETWRK04                                                         
         MVC   DUB(L'DBACTSTA),DBACTSTA                                         
         OC    DBACTSTA,DBACTSTA                                                
         BNZ   *+10                                                             
         MVC   DUB(L'DBSELSTA),DBSELSTA                                         
         CLC   =C'HUT',DUB                                                      
         BNE   *+10                                                             
         MVC   IPUTS(IUNDEMS),IIMPS                                             
                                                                                
         MVC   IRTGS(IUNDEMS),IIMPS                                             
         CLI   DMAIMP,C'I'         RATING BASED, CALCULATE RATING               
         BNE   NETWRK12                                                         
         CLI   DBSELSRC,C'K'       NTI POCKET PIECE FILE?                       
         BNE   NETWRK20                                                         
         L     R1,IPUTS+HOMES      P1 IS A PERCENT, ADJUST TO RAW VALUE         
         L     RF,IUNVS+HOMES      HOMES UNIVERSE                               
         MHI   RF,10               UNIVS * 10                                   
         SR    RE,RE                                                            
         MR    RE,R1               P1 * (UNIVS*10) = HOMES USAGE                
         ST    RF,IPUTS+HOMES                                                   
         B     NETWRK20            LEAVE 'RTGS' IN IMPR BASE                    
                                                                                
NETWRK12 LHI   R0,IUNDEMS          R0=LOOP COUNTER                              
         SR    R6,R6                                                            
NETWRK14 L     R5,IIMPS(R6)        GET IMPS                                     
         L     RF,IUNVS(R6)        GET UNIVS                                    
         LTR   RF,RF                                                            
         BNZ   NETWRK16                                                         
         ST    RF,IRTGS(R6)                                                     
         ST    RF,IPUTS(R6)                                                     
         B     NETWRK18            AVOID DIVIDE BY ZERO                         
                                                                                
NETWRK16 SR    R4,R4                                                            
         DR    R4,RF               IMPS/UNIVS                                   
         SR    R4,R4                                                            
         AHI   R5,5                +5                                           
         D     R4,F10              /10                                          
         ST    R5,IRTGS(R6)                                                     
         L     R5,IPUTS(R6)        GET PUT IMPRESSIONS                          
         CLI   DBSELSRC,C'K'       NTI POCKETPC?                                
         BNE   *+12                                                             
         CHI   R6,HOMES                                                         
         BE    NETWRK18            P1 IS ALREADY A PERCENT OF UNIV              
         SR    R4,R4                                                            
         DR    R4,RF               PUT= USAGE IMPS/UNIVS                        
         AHI   R5,5                +5                                           
         SR    R4,R4                                                            
         D     R4,F10              /10                                          
         ST    R5,IPUTS(R6)                                                     
NETWRK18 AHI   R6,4                NEXT IUN DEMO                                
         BCT   R0,NETWRK14                                                      
                                                                                
NETWRK20 DS    0H                  IMPS =UNITS/100 ->> HUNDREDS ON IUN          
         SR    R6,R6               COUNTER THRU IUN DEMOS                       
         LHI   R0,IUNDEMS          R0=LOOP COUNTER                              
         LHI   R1,100              <<--GET UNIVS AND IMPS IN HUNDREDS           
NETWRK22 L     R5,IUNVS(R6)         ADJUST UNIVERSE                             
         SR    R4,R4                                                            
         MR    R4,R1               *100 UNIVS -> HUNDREDS                       
         ST    R5,IUNVS(R6)                                                     
         L     R5,IIMPS(R6)        ADJUST IMPS                                  
         AHI   R5,50                                                            
         SR    R4,R4                                                            
         DR    R4,R1               /100 IMPS  -> HUNDREDS                       
         ST    R5,IIMPS(R6)                                                     
         AHI   R6,4                                                             
         BCT   R0,NETWRK22                                                      
                                                                                
         CLI   CALLTYPE,2          TEST PUTS/TOTS ONLY                          
         BE    NETWRK24                                                         
         MVC   UNVS(UNVSL),IUNVS                                                
         MVC   RTGS(RTGSL),IRTGS                                                
         MVC   IMPS(IMPSL),IIMPS                                                
         CLI   CALLTYPE,1          TEST RATINGS/IMPS ONLY                       
         BE    NETWRKX             YES                                          
         MVC   PUTS(PUTSL),IPUTS                                                
         MVC   TOTS(TOTSL),IPUTS                                                
         B     NETWRKX                                                          
                                                                                
NETWRK24 MVC   SPUTS(SPUTSL),IPUTS                                              
         MVC   STOTS(STOTSL),IPUTS                                              
                                                                                
NETWRKX  J     EXIT                                                             
         DROP  RB                                                               
                                                                                
NDXDEM1  DC    C'&&',X'FF'                                                      
NDXDEM2  DC    C'&&',X'FE'                                                      
                                                                                
         LTORG                                                                  
         EJECT                                                                  
*********************************************************************           
* SUB-ROUTINE TO EXPLODE DEMO ELEMENT AGAINST LIST TABLE FOR ELEMENT*           
*                                                                   *           
* AT ENTRY, R5=A(DEMO ELEMENT LIST TABLE), R1=A(DEMO ELEMENT)       *           
*                                                                   *           
* REGISTER CONVENTIONS FOR SUB-ROUTINE                              *           
*                                                                   *           
* R0=WORK REGISTER                                                  *           
* R1=PARM VALUE-THEN WORK REGISTER                                  *           
* R2=A(DBLOCK)                                                      *           
* R4=MULTIPLICATION FACTOR FOR EXTRACTED VALUE                      *           
* R5=A(DEMO LIST ENTRIES)                                           *           
* R6=DEMO ELEMENT POINTER                                           *           
* R7=DEMO VALUE FIELD POINTER - BXLE INDEX REGISTER                 *           
* R8=DEMO VALUE FIELD LENGTH  - BXLE INCREMENT REGISTER             *           
* R9=A(END OF DEMO ELEMENT)   - BXLE LIMIT REGISTER                 *           
* RE=WORK REGISTER FOR ARITHMETIC                                   *           
* RF=DEMO VALUE REGISTER                                            *           
*********************************************************************           
                                                                                
XPLDEL   STM   RE,RC,12(RD)                                                     
         LR    R6,R1               TRANSFER DEMO ELEMENT POINTER TO R6          
         SR    R9,R9                                                            
         IC    R9,1(R6)            GET ELEMENT LENGTH                           
         LA    R9,0(R6,R9)         POINT PAST ELEMENT                           
         BCTR  R9,0                BACK UP TO LAST BYTE-BXLE LIMIT              
         TM    0(R6),X'01'         TEST FOR ODD ELEMENT CODE                    
         JO    XPLDEL02            YES                                          
                                                                                
         LHI   R8,1                EVEN CODE MEANS L'DEMO ENTRY=1               
         LA    R7,2(R6)            AND DO NOT HAVE CONTROL BYTE                 
         LHI   R4,10               ALL VALUES MUST BE MULTPLD BY 10             
         J     XPLDEL04                                                         
                                                                                
XPLDEL02 IC    R8,2(R6)                                                         
         SLL   R8,28                                                            
         SRL   R8,28               ISOLATE FIELD LENGTH-BXLE INCREMENT          
         LA    R7,3(R6)            R7=INDEX REGISTER FOR BXLE                   
         LHI   R4,1                SET MULTIPLIER FOR ALL VALUES                
         TM    2(R6),X'40'         TEST FOR X 10 MULTIPLICATION                 
         JO    XPLDEL04            NO                                           
         LHI   R4,10               YES                                          
                                                                                
XPLDEL04 CLI   TTNDISPS,EOT        TEST END OF DEMO LIST FOR ELEMENT            
         JE    XPLDELX             YES                                          
         CLI   TTNTYPE,X'FF'       TEST FIELD IS IRRELEVANT                     
         JE    XPLDEL08            YES-NEXT FIELD                               
         MVC   DUB(1),TTNTYPE      GET DEMO TYPE                                
         NC    DUB(1),ELEMMASK     TEST IF VALUE NEEDED                         
         JZ    XPLDEL08            NO                                           
         SR    RF,RF               RF=VALUE                                     
         TM    0(R6),X'01'         TEST EVEN ELEMENT CODE                       
         JZ    XPLDEL06            YES-VALUE IS ALWAYS POSITIVE                 
         TM    2(R6),X'20'         TEST NEGATIVE VALUES PRESENT                 
         JZ    XPLDEL06                                                         
         TM    0(R7),X'80'         TEST SIGN BIT ON IN FIELD                    
         JZ    XPLDEL06                                                         
         LCR   RF,RF               SET VALUE TO ALL EFFS                        
                                                                                
XPLDEL06 IC    R1,ICMMASK-1(R8)    USE FIELD LENGTH AS TABLE INDEX              
         BASR  RA,0                                                             
         EX    R1,8(RA)                                                         
         J     *+8                                                              
         ICM   RF,0,0(R7)          GET VALUE INTO RF                            
         MR    RE,R4               MULTIPLY BY EXPANSION FACTOR                 
                                                                                
         SR    R1,R1                                                            
         ICM   R1,3,TTNDISPS       DISP TO WORKING STORAGE SECTION              
         LA    R1,WORKD(R1)        R1=A(VALUE POSITION)                         
         ST    RF,0(R1)            REPLACE WORK AREA VALUE                      
                                                                                
XPLDEL08 AHI   R5,TTNLISTL         NEXT DEMO LIST ENTRY                         
         BRXLE R7,R8,XPLDEL04                                                   
                                                                                
XPLDELX  LM    RE,RC,12(RD)                                                     
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* SUB-ROUTINE TO CALCULATE MISSING V2554 CELL VALUES FROM IUN RECORD  *         
***********************************************************************         
                                                                                
CV2554   STM   RE,RC,12(RD)                                                     
                                                                                
         L     R6,IUNVS+W2554      UV2554=UW2554+UM2554                         
         A     R6,IUNVS+M2554                                                   
         ST    R6,IUNVS+V2554                                                   
                                                                                
         L     R6,IIMPS+W2554      OLD IMP                                      
         A     R6,IIMPS+M2554                                                   
         ST    R6,IIMPS+V2554                                                   
                                                                                
         L     R6,ITOTS+W2554      OLD TOT                                      
         A     R6,ITOTS+M2554                                                   
         ST    R6,ITOTS+V2554                                                   
                                                                                
         L     R6,INEWIMPS+W2554   TV2554=TW2554+TM2554                         
         A     R6,INEWIMPS+M2554                                                
         ST    R6,INEWIMPS+V2554                                                
                                                                                
         L     R6,INEWTOTS+W2554   QV2554=QW2554+QM2554                         
         A     R6,INEWTOTS+M2554                                                
         ST    R6,INEWTOTS+V2554                                                
                                                                                
         L     R7,IRTGS+W2554      COMPUTE OLD RATING                           
         M     R6,IUNVS+W2554      ADI IMP (W2554)                              
         L     R5,IRTGS+M2554                                                   
         M     R4,IUNVS+M2554      ADI IMP (M2554)                              
         AR    R7,R5               ADI IMP V2554                                
         SR    R6,R6                                                            
         OC    IUNVS+V2554(4),IUNVS+V2554        TEST ZERO DIVISOR              
         JNZ   *+10                                                             
         SR    R7,R7               YES-FORCE QUOTIENT TO ZERO                   
         J     *+8                                                              
         D     R6,IUNVS+V2554                                                   
         ST    R7,IRTGS+V2554                                                   
                                                                                
         L     R7,INEWRTGS+W2554   COMPUTE NEW RATING                           
         M     R6,IUNVS+W2554      ADI IMP (W2554)                              
         L     R5,INEWRTGS+M2554                                                
         M     R4,IUNVS+M2554      ADI IMP (M2554)                              
         AR    R7,R5               ADI IMP V2554                                
         SR    R6,R6                                                            
         OC    IUNVS+V2554(4),IUNVS+V2554        TEST ZERO DIVISOR              
         JNZ   *+10                                                             
         SR    R7,R7               YES-FORCE QUOTIENT TO ZERO                   
         J     *+8                                                              
         D     R6,IUNVS+V2554                                                   
         ST    R7,INEWRTGS+V2554                                                
                                                                                
         L     R7,IPUTS+W2554      COMPUTE OLD PUT                              
         M     R6,IUNVS+W2554      MKT IMP (W2554)                              
         L     R5,IPUTS+M2554                                                   
         M     R4,IUNVS+M2554      MKT IMP (M2554)                              
         AR    R7,R5               MKT IMP V2554                                
         SR    R6,R6                                                            
         OC    IUNVS+V2554(4),IUNVS+V2554        TEST ZERO DIVISOR              
         JNZ   *+10                                                             
         SR    R7,R7               YES-FORCE QUOTIENT TO ZERO                   
         J     *+8                                                              
         D     R6,IUNVS+V2554                                                   
         ST    R7,IPUTS+V2554                                                   
                                                                                
         L     R7,INEWPUTS+W2554   COMPUTE NEW PUTS                             
         M     R6,IUNVS+W2554      MKT IMP (W2554)                              
         L     R5,INEWPUTS+M2554                                                
         M     R4,IUNVS+M2554      MKT IMP (M2554)                              
         AR    R7,R5               MKT IMP V2554                                
         SR    R6,R6                                                            
         OC    IUNVS+V2554(4),IUNVS+V2554        TEST ZERO DIVISOR              
         JNZ   *+10                                                             
         SR    R7,R7               YES-FORCE QUOTIENT TO ZERO                   
         J     *+8                                                              
         D     R6,IUNVS+V2554                                                   
         ST    R7,INEWPUTS+V2554                                                
         LM    RE,RC,12(RD)                                                     
CV2554X  BR    RE                                                               
                                                                                
EXIT     XIT1  ,                                                                
         EJECT                                                                  
EOT      EQU   X'FF'                                                            
BKELQ    EQU   X'5E'                                                            
                                                                                
UNIVERSE EQU   X'80'                                                            
RATING   EQU   X'40'                                                            
IMP      EQU   X'20'                                                            
PUT      EQU   X'10'                                                            
TOT      EQU   X'08'                                                            
DMA      EQU   X'04'                                                            
TSA      EQU   X'02'                                                            
TSAHOMES EQU   X'01'                                                            
                                                                                
MASK1    EQU   UNIVERSE+RATING+IMP                                              
MASK2    EQU   UNIVERSE+PUT+TOT+TSAHOMES                                        
MASK3    EQU   UNIVERSE+RATING+IMP+PUT+TOT+TSAHOMES                             
MASK4    EQU   UNIVERSE                                                         
                                                                                
IUNDEMS  EQU   32                                                               
                                                                                
* TABLE OF MODIFIERS FOUND IN OVERRIDE ELEMENTS FOR IUN RECORDS                 
                                                                                
MODTAB   DS    0XL3                                                             
         DC    C'R',AL2(NEWRTGS-IUNRECD)                                        
         DC    C'T',AL2(NEWIMPS-IUNRECD)                                        
         DC    C'S',AL2(SHRS-IUNRECD)                                           
         DC    C'P',AL2(NEWPUTS-IUNRECD)                                        
         DC    C'Q',AL2(NEWTOTS-IUNRECD)                                        
         DC    C'U',AL2(UNVS-IUNRECD)                                           
MODTABX  DC    AL1(EOT)                                                         
                                                                                
* TABLE OF HOMES SHARES AND DISPLACEMENTS                                       
                                                                                
SHRTAB   DS    0XL2                                                             
         DC    AL1(001),AL1(0)                                                  
         DC    AL1(002),AL1(4)                                                  
         DC    AL1(003),AL1(8)                                                  
SHRTABX  DC    AL1(EOT)                                                         
                                                                                
* TABLE OF IUN CATEGORIES AND DISPLACEMENTS                                     
                                                                                
CATTAB   DS    0XL2                                                             
         DC    AL1(127),AL1(V299)                                               
         DC    AL1(145),AL1(V1899)                                              
         DC    AL1(129),AL1(V1234)                                              
         DC    AL1(128),AL1(V1224)                                              
         DC    AL1(125),AL1(V1217)                                              
         DC    AL1(123),AL1(V611)                                               
         DC    AL1(122),AL1(V211)                                               
         DC    AL1(045),AL1(W1899)                                              
         DC    AL1(041),AL1(W1834)                                              
         DC    AL1(042),AL1(W1849)                                              
         DC    AL1(047),AL1(W2549)                                              
         DC    AL1(048),AL1(W2554)                                              
         DC    AL1(028),AL1(W1224)                                              
         DC    AL1(049),AL1(W2564)                                              
         DC    AL1(029),AL1(W1234)                                              
         DC    AL1(095),AL1(M1899)                                              
         DC    AL1(091),AL1(M1834)                                              
         DC    AL1(092),AL1(M1849)                                              
         DC    AL1(098),AL1(M2554)                                              
         DC    AL1(099),AL1(M2564)                                              
         DC    AL1(001),AL1(HOMES)                                              
         DC    AL1(002),AL1(METROA)                                             
         DC    AL1(003),AL1(METROB)                                             
         DC    AL1(065),AL1(WWORK)                                              
         DC    AL1(097),AL1(M2549)                                              
         DC    AL1(142),AL1(V1849)                                              
         DC    AL1(141),AL1(V1834)                                              
         DC    AL1(148),AL1(V2554)                                              
         DC    AL1(191),AL1(V2149) STARTS WITH FEB/87 ARB ONLY                  
         DC    AL1(071),AL1(W2149) *                                            
         DC    AL1(115),AL1(M2149) *                                            
         DC    AL1(153),AL1(V3564) STARTS WITH FEB/88 ARB ONLY                  
CATTABN  EQU   (*-CATTAB)/L'CATTAB                                              
CATTABX  DC    AL1(EOT)                                                         
                                                                                
* TABLE OF SUPPORTED FILES/MEDIAS/SOURCES (SEE ORGTABD)                         
                                                                                
ORGTAB   DS    0XL(ORGTABL)                                                     
                                                                                
         DC    C'TTN',AL1(82,10)   NSI TP                                       
         DC    AL2(NOCT82-GETIUN)                                               
         DC    AL2(TTNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'TTN',AL1(90,10)   NSI TP                                       
         DC    AL2(NOCT90-GETIUN)                                               
         DC    AL2(TTNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'TWN',AL1(87,01)   NSI WEEKLY                                   
         DC    AL2(NW8701-GETIUN)                                               
         DC    AL2(TWNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'PTN',AL1(82,10)   NSI PAV                                      
         DC    AL2(NOCT82-GETIUN)  SAME ELEMENT LAYOUT AS TP                    
         DC    AL2(TTNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'PTN',AL1(90,10)   NSI PAV                                      
         DC    AL2(NOCT90-GETIUN)  SAME ELEMENT LAYOUT AS TP                    
         DC    AL2(TTNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(82,05)                                                
         DC    AL2(IUN82-GETIUN)   INDEX UPGRADE (MAY/82)                       
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(82,06)                                                
         DC    AL2(IUN82-GETIUN)   PUT UPGRADE (JUN/82)                         
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(83,11)   SPOT-REP                                     
         DC    AL2(IUN82-GETIUN)   INDEX UPGRADE (NOV/83)                       
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(83,12)   SPOT-REP                                     
         DC    AL2(IUN82-GETIUN)   INDEX UPGRADE (DEC/83) NEW                   
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(84,06)   SPOT-REP                                     
         DC    AL2(IUN82-GETIUN)   PUT UPGRADE (JUN/84)                         
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(90,11)   SPOT-REP TAPE PREC                           
         DC    AL2(IUN82-GETIUN)   INDEX UPGRADE (NOV/90)                       
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(90,12)   SPOT-REP TAPE PREC                           
         DC    AL2(IUN82-GETIUN)   INDEX UPGRADE (DEC/90)                       
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'IUN',AL1(91,06)   SPOT-REP                                     
         DC    AL2(IUN82-GETIUN)   PUT UPGRADE (JUN/91)                         
         DC    AL2(IUNDEM-GETIUN)                                               
         DC    AL1(0)                                                           
                                                                                
         DC    C'NHN',AL1(00,00)   NHTI FILE                                    
         DC    AL2(0)                                                           
         DC    AL2(NETWRK-GETIUN)                                               
         DC    AL1(ORGINETQ)                                                    
                                                                                
         DC    C'NNN',AL1(00,00)   NAD FILE                                     
         DC    AL2(0)                                                           
         DC    AL2(NETWRK-GETIUN)                                               
         DC    AL1(ORGINETQ)                                                    
                                                                                
         DC    C'PNN',AL1(00,00)   NTI FILE                                     
         DC    AL2(0)                                                           
         DC    AL2(NETWRK-GETIUN)                                               
         DC    AL1(ORGINETQ)                                                    
                                                                                
         DC    C'CNN',AL1(00,00)   CABLE FILE                                   
         DC    AL2(0)                                                           
         DC    AL2(NETWRK-GETIUN)                                               
         DC    AL1(ORGINETQ)                                                    
                                                                                
ORGTABN  EQU   (*-ORGTAB)/L'ORGTAB                                              
                                                                                
ORGTABD  DSECT                     ** ORIGIN TABLE **                           
ORGFILE  DS    C                   FILE (T=TIME PERIOD)                         
ORGMED   DS    C                   MEDIA (T=USTV)                               
ORGSRC   DS    C                   SOURCE (A=ARB, N=NSI)                        
ORGBOOK  DS    XL2                 BOOK (YM)                                    
ORGDELEM DS    AL2                 DISP TO ELEMENT TABLE                        
ORGDROUT DS    AL2                 DISP TO PROCESSING ROUTINE                   
ORGINDS  DS    XL1                 INDICATORS                                   
ORGINETQ EQU   X'80'               NETWORK FILE                                 
ORGTABL  EQU   *-ORGTABD           TABLE ENTRY LENGTH                           
GETIUN   CSECT                                                                  
         EJECT                                                                  
* TABLE OF NSI TIME PERIOD (OCT82) ELEMENTS AND DISPLACEMENTS TO                
* DEMO LISTS                                                                    
                                                                                
NOCT82   DS    0XL(ELEMTABL)                                                    
         DC    X'31',AL2(NOCT8231-GETIUN),AL1(RATING+PUT)                       
         DC    X'33',AL2(NOCT8233-GETIUN),AL1(IMP+DMA)                          
         DC    X'35',AL2(NOCT8235-GETIUN),AL1(IMP+DMA)                          
         DC    X'37',AL2(NOCT8237-GETIUN),AL1(UNIVERSE)                         
         DC    X'39',AL2(NOCT8239-GETIUN),AL1(UNIVERSE)                         
         DC    X'41',AL2(NOCT8241-GETIUN),AL1(DMA)                              
         DC    X'43',AL2(NOCT8243-GETIUN),AL1(TSA+TSAHOMES)                     
         DC    X'45',AL2(NOCT8245-GETIUN),AL1(TSA)                              
         DC    X'47',AL2(NOCT8247-GETIUN),AL1(TOT)                              
         DC    X'49',AL2(NOCT8249-GETIUN),AL1(RATING)                           
         DC    X'51',AL2(NOCT8251-GETIUN),AL1(PUT)                              
         DC    AL1(EOT)                                                         
                                                                                
NOCT90   DS    0XL(ELEMTABL)                                                    
         DC    X'31',AL2(NOCT8231-GETIUN),AL1(RATING+PUT)                       
         DC    X'33',AL2(NOCT8233-GETIUN),AL1(IMP+DMA)                          
         DC    X'35',AL2(NOCT9035-GETIUN),AL1(IMP+DMA)                          
         DC    X'37',AL2(NOCT8237-GETIUN),AL1(UNIVERSE)                         
         DC    X'39',AL2(NOCT9039-GETIUN),AL1(UNIVERSE)                         
         DC    X'41',AL2(NOCT9041-GETIUN),AL1(DMA)                              
         DC    X'43',AL2(NOCT8243-GETIUN),AL1(TSA+TSAHOMES)                     
         DC    X'45',AL2(NOCT9045-GETIUN),AL1(TSA)                              
         DC    X'47',AL2(NOCT9047-GETIUN),AL1(TOT)                              
         DC    X'49',AL2(NOCT8249-GETIUN),AL1(RATING)                           
         DC    X'51',AL2(NOCT8251-GETIUN),AL1(PUT)                              
         DC    AL1(EOT)                                                         
                                                                                
NW8701   DS    0CL(ELEMTABL)                                                    
         DC    X'31',AL2(NW870131-GETIUN),AL1(RATING+PUT)                       
         DC    X'33',AL2(NW870133-GETIUN),AL1(IMP+DMA)                          
         DC    X'37',AL2(NW870137-GETIUN),AL1(UNIVERSE)                         
         DC    X'43',AL2(NW870143-GETIUN),AL1(TSA+TSAHOMES)                     
         DC    X'47',AL2(NW870147-GETIUN),AL1(TOT)                              
         DC    AL1(EOT)                                                         
                                                                                
* TABLE OF IUN ELEMENTS AND THEIR DISPLACEMENTS INTO WORK AREA                  
                                                                                
IUN82    DS    0XL(ELEMTABL)                                                    
         DC    X'31',AL2(UNVS-IUNRECD),AL1(0)                                   
         DC    X'33',AL2(RTGS-IUNRECD),AL1(0)                                   
         DC    X'35',AL2(IMPS-IUNRECD),AL1(0)                                   
         DC    X'37',AL2(PUTS-IUNRECD),AL1(0)                                   
         DC    X'39',AL2(TOTS-IUNRECD),AL1(0)                                   
         DC    X'41',AL2(NEWRTGS-IUNRECD),AL1(0)                                
         DC    X'43',AL2(NEWIMPS-IUNRECD),AL1(0)                                
         DC    X'45',AL2(NEWPUTS-IUNRECD),AL1(0)                                
         DC    X'47',AL2(NEWTOTS-IUNRECD),AL1(0)                                
         DC    X'49',AL2(SHRS-IUNRECD),AL1(0)                                   
         DC    AL1(EOT)                                                         
                                                                                
ELEMTABD DSECT                     ** ELEMENT TABLE **                          
ELEMNUM  DS    X                   ELEMENT NUMBER                               
ELEMDISP DS    AL2                 DISPLACEMENT TO ELEMENT DEMO LIST            
*                                  FOR IUN-DISPLACEMENT INTO WORK AREA          
ELEMTYPE DS    X                   DEMO TYPE (EQUATED, E.G. RATING)             
ELEMTABL EQU   *-ELEMTABD                                                       
GETIUN   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* NSI OCT82 TIME PERIOD DEMO LIST TABLES                              *         
*                                                                     *         
* EACH TABLE CONSISTS OF 6-BYTE DEMO ENTRIES CONTAINING THE           *         
* DISPLACEMENT INTO WORKING STORAGE FOR THE EXTRACTED VALUE,          *         
* THE DEMO TYPE, AND 3 SPARE BYTES.                                   *         
***********************************************************************         
                                                                                
NOCT8231 DS    0X                                                               
                                                                                
         DC    AL2(NRHOMES-WORKD),AL1(RATING)                                   
         DC    5X'0000FF'                                                       
         DC    AL2(NPMETROA-WORKD),AL1(PUT)                                     
         DC    X'0000FF'                                                        
         DC    AL2(NRMETROA-WORKD),AL1(RATING)                                  
         DC    AL2(NPMETROB-WORKD),AL1(PUT)                                     
         DC    X'0000FF'                                                        
         DC    AL2(NRMETROB-WORKD),AL1(RATING)                                  
         DC    AL1(EOT)                                                         
                                                                                
NOCT8233 DS    0X                                                               
                                                                                
         DC    AL2(NTHOMES-WORKD),AL1(IMP)                                      
         DC    AL2(NDHOMES-WORKD),AL1(DMA)                                      
         DC    AL2(NTWWORK-WORKD),AL1(IMP)                                      
         DC    AL2(NDWWORK-WORKD),AL1(DMA)                                      
         DC    AL2(NTW6599-WORKD),AL1(IMP)                                      
         DC    AL2(NDW6599-WORKD),AL1(DMA)                                      
         DC    AL2(NTM6599-WORKD),AL1(IMP)                                      
         DC    AL2(NDM6599-WORKD),AL1(DMA)                                      
         DC    2X'0000FF'                                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT8235 DS    0X                                                               
                                                                                
         DC    AL2(NTM1217-WORKD),AL1(IMP)                                      
         DC    AL2(NTW1217-WORKD),AL1(IMP)                                      
         DC    AL2(NTM1824-WORKD),AL1(IMP)                                      
         DC    AL2(NTW1824-WORKD),AL1(IMP)                                      
         DC    AL2(NTM2534-WORKD),AL1(IMP)                                      
         DC    AL2(NTW2534-WORKD),AL1(IMP)                                      
         DC    AL2(NTM3549-WORKD),AL1(IMP)                                      
         DC    AL2(NTW3549-WORKD),AL1(IMP)                                      
         DC    AL2(NTM5564-WORKD),AL1(IMP)                                      
         DC    AL2(NTW5564-WORKD),AL1(IMP)                                      
         DC    AL2(NTM5054-WORKD),AL1(IMP)                                      
         DC    AL2(NTW5054-WORKD),AL1(IMP)                                      
         DC    AL2(NTV25-WORKD),AL1(IMP)                                        
         DC    AL2(NDV25-WORKD),AL1(DMA)                                        
         DC    AL2(NTV611-WORKD),AL1(IMP)                                       
         DC    AL2(NDV611-WORKD),AL1(DMA)                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT9035 DS    0X                                                               
                                                                                
         DC    AL2(NTM1217-WORKD),AL1(IMP)                                      
         DC    AL2(NTW1217-WORKD),AL1(IMP)                                      
         DC    AL2(NTM1820-WORKD),AL1(IMP)                                      
         DC    AL2(NTW1820-WORKD),AL1(IMP)                                      
         DC    AL2(NTM2124-WORKD),AL1(IMP)                                      
         DC    AL2(NTW2124-WORKD),AL1(IMP)                                      
         DC    AL2(NTM2534-WORKD),AL1(IMP)                                      
         DC    AL2(NTW2534-WORKD),AL1(IMP)                                      
         DC    AL2(NTM3549-WORKD),AL1(IMP)                                      
         DC    AL2(NTW3549-WORKD),AL1(IMP)                                      
         DC    AL2(NTM5564-WORKD),AL1(IMP)                                      
         DC    AL2(NTW5564-WORKD),AL1(IMP)                                      
         DC    AL2(NTM5054-WORKD),AL1(IMP)                                      
         DC    AL2(NTW5054-WORKD),AL1(IMP)                                      
         DC    AL2(NTV25-WORKD),AL1(IMP)                                        
         DC    AL2(NDV25-WORKD),AL1(DMA)                                        
         DC    AL2(NTV611-WORKD),AL1(IMP)                                       
         DC    AL2(NDV611-WORKD),AL1(DMA)                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT8237 DS    0X                                                               
                                                                                
         DC    AL2(NUHOMES-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM6599-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW6599-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUWWORK-WORKD),AL1(UNIVERSE)                                 
         DC    3X'0000FF'                                                       
         DC    AL2(NUMETROA-WORKD),AL1(UNIVERSE)                                
         DC    AL2(NUMETROB-WORKD),AL1(UNIVERSE)                                
         DC    AL1(EOT)                                                         
                                                                                
NOCT8239 DS    0X                                                               
                                                                                
         DC    AL2(NUM1217-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW1217-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM1824-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW1824-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM2534-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW2534-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM3549-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW3549-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM5564-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW5564-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM5054-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW5054-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUV25-WORKD),AL1(UNIVERSE)                                   
         DC    AL2(NUV611-WORKD),AL1(UNIVERSE)                                  
         DC    AL1(EOT)                                                         
                                                                                
NOCT9039 DS    0X                                                               
                                                                                
         DC    AL2(NUM1217-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW1217-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM1820-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW1820-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM2124-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW2124-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM2534-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW2534-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM3549-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW3549-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM5564-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW5564-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUM5054-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUW5054-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUV25-WORKD),AL1(UNIVERSE)                                   
         DC    AL2(NUV611-WORKD),AL1(UNIVERSE)                                  
         DC    AL1(EOT)                                                         
                                                                                
NOCT8241 DS    0X                                                               
                                                                                
         DC    AL2(NDM1217-WORKD),AL1(DMA)                                      
         DC    AL2(NDW1217-WORKD),AL1(DMA)                                      
         DC    AL2(NDM1824-WORKD),AL1(DMA)                                      
         DC    AL2(NDW1824-WORKD),AL1(DMA)                                      
         DC    AL2(NDM2534-WORKD),AL1(DMA)                                      
         DC    AL2(NDW2534-WORKD),AL1(DMA)                                      
         DC    AL2(NDM3549-WORKD),AL1(DMA)                                      
         DC    AL2(NDW3549-WORKD),AL1(DMA)                                      
         DC    AL2(NDM5564-WORKD),AL1(DMA)                                      
         DC    AL2(NDW5564-WORKD),AL1(DMA)                                      
         DC    AL2(NDM5054-WORKD),AL1(DMA)                                      
         DC    AL2(NDW5054-WORKD),AL1(DMA)                                      
         DC    AL1(EOT)                                                         
                                                                                
NOCT9041 DS    0X                                                               
                                                                                
         DC    AL2(NDM1217-WORKD),AL1(DMA)                                      
         DC    AL2(NDW1217-WORKD),AL1(DMA)                                      
         DC    AL2(NDM1820-WORKD),AL1(DMA)                                      
         DC    AL2(NDW1820-WORKD),AL1(DMA)                                      
         DC    AL2(NDM2124-WORKD),AL1(DMA)                                      
         DC    AL2(NDW2124-WORKD),AL1(DMA)                                      
         DC    AL2(NDM2534-WORKD),AL1(DMA)                                      
         DC    AL2(NDW2534-WORKD),AL1(DMA)                                      
         DC    AL2(NDM3549-WORKD),AL1(DMA)                                      
         DC    AL2(NDW3549-WORKD),AL1(DMA)                                      
         DC    AL2(NDM5564-WORKD),AL1(DMA)                                      
         DC    AL2(NDW5564-WORKD),AL1(DMA)                                      
         DC    AL2(NDM5054-WORKD),AL1(DMA)                                      
         DC    AL2(NDW5054-WORKD),AL1(DMA)                                      
         DC    AL1(EOT)                                                         
                                                                                
NOCT8243 DS    0X                                                               
                                                                                
         DC    AL2(NWHOMES-WORKD),AL1(TSA+TSAHOMES)                             
         DC    AL2(NWWWORK-WORKD),AL1(TSA)                                      
         DC    AL2(NWW6599-WORKD),AL1(TSA)                                      
         DC    AL2(NWM6599-WORKD),AL1(TSA)                                      
         DC    2X'0000FF'                                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT8245 DS    0X                                                               
                                                                                
         DC    AL2(NWM1217-WORKD),AL1(TSA)                                      
         DC    AL2(NWW1217-WORKD),AL1(TSA)                                      
         DC    AL2(NWM1824-WORKD),AL1(TSA)                                      
         DC    AL2(NWW1824-WORKD),AL1(TSA)                                      
         DC    AL2(NWM2534-WORKD),AL1(TSA)                                      
         DC    AL2(NWW2534-WORKD),AL1(TSA)                                      
         DC    AL2(NWM3549-WORKD),AL1(TSA)                                      
         DC    AL2(NWW3549-WORKD),AL1(TSA)                                      
         DC    AL2(NWM5564-WORKD),AL1(TSA)                                      
         DC    AL2(NWW5564-WORKD),AL1(TSA)                                      
         DC    AL2(NWM5054-WORKD),AL1(TSA)                                      
         DC    AL2(NWW5054-WORKD),AL1(TSA)                                      
         DC    AL2(NWV25-WORKD),AL1(TSA)                                        
         DC    AL2(NWV611-WORKD),AL1(TSA)                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT9045 DS    0X                                                               
                                                                                
         DC    AL2(NWM1217-WORKD),AL1(TSA)                                      
         DC    AL2(NWW1217-WORKD),AL1(TSA)                                      
         DC    AL2(NWM1820-WORKD),AL1(TSA)                                      
         DC    AL2(NWW1820-WORKD),AL1(TSA)                                      
         DC    AL2(NWM2124-WORKD),AL1(TSA)                                      
         DC    AL2(NWW2124-WORKD),AL1(TSA)                                      
         DC    AL2(NWM2534-WORKD),AL1(TSA)                                      
         DC    AL2(NWW2534-WORKD),AL1(TSA)                                      
         DC    AL2(NWM3549-WORKD),AL1(TSA)                                      
         DC    AL2(NWW3549-WORKD),AL1(TSA)                                      
         DC    AL2(NWM5564-WORKD),AL1(TSA)                                      
         DC    AL2(NWW5564-WORKD),AL1(TSA)                                      
         DC    AL2(NWM5054-WORKD),AL1(TSA)                                      
         DC    AL2(NWW5054-WORKD),AL1(TSA)                                      
         DC    AL2(NWV25-WORKD),AL1(TSA)                                        
         DC    AL2(NWV611-WORKD),AL1(TSA)                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT8247 DS    0X                                                               
                                                                                
         DC    AL2(NQHOMES-WORKD),AL1(TOT)                                      
         DC    AL2(NQWWORK-WORKD),AL1(TOT)                                      
         DC    AL2(NQW6599-WORKD),AL1(TOT)                                      
         DC    AL2(NQM6599-WORKD),AL1(TOT)                                      
         DC    AL2(NQM1217-WORKD),AL1(TOT)                                      
         DC    AL2(NQW1217-WORKD),AL1(TOT)                                      
         DC    AL2(NQM1824-WORKD),AL1(TOT)                                      
         DC    AL2(NQW1824-WORKD),AL1(TOT)                                      
         DC    AL2(NQM2534-WORKD),AL1(TOT)                                      
         DC    AL2(NQW2534-WORKD),AL1(TOT)                                      
         DC    AL2(NQM3549-WORKD),AL1(TOT)                                      
         DC    AL2(NQW3549-WORKD),AL1(TOT)                                      
         DC    AL2(NQM5564-WORKD),AL1(TOT)                                      
         DC    AL2(NQW5564-WORKD),AL1(TOT)                                      
         DC    AL2(NQM5054-WORKD),AL1(TOT)                                      
         DC    AL2(NQW5054-WORKD),AL1(TOT)                                      
         DC    AL2(NQV25-WORKD),AL1(TOT)                                        
         DC    AL2(NQV611-WORKD),AL1(TOT)                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT9047 DS    0X                                                               
                                                                                
         DC    AL2(NQHOMES-WORKD),AL1(TOT)                                      
         DC    AL2(NQWWORK-WORKD),AL1(TOT)                                      
         DC    AL2(NQW6599-WORKD),AL1(TOT)                                      
         DC    AL2(NQM6599-WORKD),AL1(TOT)                                      
         DC    AL2(NQM1217-WORKD),AL1(TOT)                                      
         DC    AL2(NQW1217-WORKD),AL1(TOT)                                      
         DC    AL2(NQM1820-WORKD),AL1(TOT)                                      
         DC    AL2(NQW1820-WORKD),AL1(TOT)                                      
         DC    AL2(NQM2124-WORKD),AL1(TOT)                                      
         DC    AL2(NQW2124-WORKD),AL1(TOT)                                      
         DC    AL2(NQM2534-WORKD),AL1(TOT)                                      
         DC    AL2(NQW2534-WORKD),AL1(TOT)                                      
         DC    AL2(NQM3549-WORKD),AL1(TOT)                                      
         DC    AL2(NQW3549-WORKD),AL1(TOT)                                      
         DC    AL2(NQM5564-WORKD),AL1(TOT)                                      
         DC    AL2(NQW5564-WORKD),AL1(TOT)                                      
         DC    AL2(NQM5054-WORKD),AL1(TOT)                                      
         DC    AL2(NQW5054-WORKD),AL1(TOT)                                      
         DC    AL2(NQV25-WORKD),AL1(TOT)                                        
         DC    AL2(NQV611-WORKD),AL1(TOT)                                       
         DC    AL1(EOT)                                                         
                                                                                
NOCT8249 DS    0X                                                               
                                                                                
         DC    AL2(IRTGS+V299-WORKD),AL1(RATING)                                
         DC    AL2(IRTGS+V1899-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V1234-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V1224-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V1217-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V611-WORKD),AL1(RATING)                                
         DC    AL2(IRTGS+V211-WORKD),AL1(RATING)                                
         DC    AL2(IRTGS+W1899-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W1834-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W1849-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W2549-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W2554-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W1224-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W2564-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+W1234-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+M1899-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+M1834-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+M1849-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+M2554-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+M2564-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+WWORK-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+M2549-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V1849-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V1834-WORKD),AL1(RATING)                               
         DC    AL2(IRTGS+V2554-WORKD),AL1(RATING)                               
         DC    AL1(EOT)                                                         
                                                                                
NOCT8251 DS    0X                                                               
                                                                                
         DC    AL2(IPUTS+V299-WORKD),AL1(PUT)                                   
         DC    AL2(IPUTS+V1899-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V1234-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V1224-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V1217-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V611-WORKD),AL1(PUT)                                   
         DC    AL2(IPUTS+V211-WORKD),AL1(PUT)                                   
         DC    AL2(IPUTS+W1899-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W1834-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W1849-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W2549-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W2554-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W1224-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W2564-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+W1234-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+M1899-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+M1834-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+M1849-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+M2554-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+M2564-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+WWORK-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+M2549-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V1849-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V1834-WORKD),AL1(PUT)                                  
         DC    AL2(IPUTS+V2554-WORKD),AL1(PUT)                                  
         DC    AL1(EOT)                                                         
                                                                                
NW870131 DS    0X                                                               
                                                                                
         DC    AL2(NRHOMES-WORKD),AL1(RATING)                                   
         DC    AL2(NPHOMES-WORKD),AL1(PUT)                                      
         DC    X'0000FF'                                                        
         DC    AL2(NPMETROA-WORKD),AL1(PUT)                                     
         DC    X'0000FF'                                                        
         DC    AL2(NRMETROA-WORKD),AL1(RATING)                                  
         DC    AL2(NPMETROB-WORKD),AL1(PUT)                                     
         DC    X'0000FF'                                                        
         DC    AL2(NRMETROB-WORKD),AL1(RATING)                                  
         DC    AL1(EOT)                                                         
                                                                                
NW870133 DS    0X                                                               
                                                                                
         DC    AL2(NTHOMES-WORKD),AL1(IMP)                                      
         DC    AL2(NDHOMES-WORKD),AL1(DMA)                                      
         DC    2X'0000FF'                                                       
         DC    AL1(EOT)                                                         
                                                                                
NW870137 DS    0X                                                               
                                                                                
         DC    AL2(NUHOMES-WORKD),AL1(UNIVERSE)                                 
         DC    AL2(NUMETROA-WORKD),AL1(UNIVERSE)                                
         DC    AL2(NUMETROB-WORKD),AL1(UNIVERSE)                                
         DC    AL1(EOT)                                                         
                                                                                
NW870143 DS    0X                                                               
                                                                                
         DC    AL2(NWHOMES-WORKD),AL1(TSA+TSAHOMES)                             
         DC    2X'0000FF'                                                       
         DC    AL1(EOT)                                                         
                                                                                
NW870147 DS    0X                                                               
                                                                                
         DC    AL2(NQHOMES-WORKD),AL1(TOT)                                      
         DC    AL1(EOT)                                                         
                                                                                
TTNLISTD DSECT                     ** NSI/TP DEMO LIST ENTRY **                 
TTNDISPS DS    AL2                 DISPLACEMENT TO VALUE POSITION               
TTNTYPE  DS    X                   DEMO TYPE (X'FF'=IGNORE VALUE)               
TTNLISTL EQU   *-TTNLISTD          L'DEMO LIST ENTRY                            
GETIUN   CSECT                                                                  
         EJECT                                                                  
                                                                                
* EQUATES FOR FULLWORD DISPLACEMENTS INTO SECTION OF WORK AREA                  
                                                                                
V299     EQU   000                                                              
V1899    EQU   004                                                              
V1234    EQU   008                                                              
V1224    EQU   012                                                              
V1217    EQU   016                                                              
V611     EQU   020                                                              
V211     EQU   024                                                              
W1899    EQU   028                                                              
W1834    EQU   032                                                              
W1849    EQU   036                                                              
W2549    EQU   040                                                              
W2554    EQU   044                                                              
W1224    EQU   048                                                              
W2564    EQU   052                                                              
W1234    EQU   056                                                              
M1899    EQU   060                                                              
M1834    EQU   064                                                              
M1849    EQU   068                                                              
M2554    EQU   072                                                              
M2564    EQU   076                                                              
HOMES    EQU   080                                                              
METROA   EQU   084                                                              
METROB   EQU   088                                                              
WWORK    EQU   092                                                              
M2549    EQU   096                                                              
V1849    EQU   100                                                              
V1834    EQU   104                                                              
V2554    EQU   108                                                              
V2149    EQU   112                                                              
W2149    EQU   116                                                              
M2149    EQU   120                                                              
V3564    EQU   124                                                              
         EJECT                                                                  
NETMDF   DS    0XL4                ** NETWORK MODIFIERS **                      
         DC    C'H',C'U',AL2(IUNVS-WORKD)   NHTI FILE--> DBSELSRC=H             
         DC    C'H',C'Y',AL2(IIMPS-WORKD)                                       
         DC    C'H',C'Z',AL2(IPUTS-WORKD)                                       
                                                                                
         DC    C'D',C'U',AL2(IUNVS-WORKD)   NAD FILE --> DBSELSRC=D             
         DC    C'D',C'Y',AL2(IIMPS-WORKD)    (NO PUTS FOR NAD)                  
                                                                                
         DC    C'K',C'U',AL2(IUNVS-WORKD)   NTI  FILE--> DBSELSRC=K             
         DC    C'K',C'Y',AL2(IIMPS-WORKD)                                       
         DC    C'K',C'Z',AL2(IPUTS-WORKD)                                       
                                                                                
         DC    C'C',C'U',AL2(IUNVS-WORKD)   NTI  FILE--> DBSELSRC=K             
         DC    C'C',C'Y',AL2(IIMPS-WORKD)                                       
         DC    C'C',C'Z',AL2(IPUTS-WORKD)                                       
                                                                                
         DC    AL1(EOT)                                                         
                                                                                
NETDEMS  DS    0XL3                ** NETWORK DEMOS FOR DEMOLIST **             
         DC    AL3(127)            V299                                         
         DC    AL3(145)            V1899                                        
         DC    AL3(129)            V1234                                        
         DC    AL3(128)            V1224                                        
         DC    AL3(125)            V1217                                        
         DC    AL3(123)            V611                                         
         DC    AL3(122)            V211                                         
         DC    AL3(045)            W1899                                        
         DC    AL3(041)            W1834                                        
         DC    AL3(042)            W1849                                        
         DC    AL3(047)            W2549                                        
         DC    AL3(048)            W2554                                        
         DC    AL3(028)            W1224                                        
         DC    AL3(049)            W2564                                        
         DC    AL3(029)            W1234                                        
         DC    AL3(095)            M1899                                        
         DC    AL3(091)            M1834                                        
         DC    AL3(092)            M1849                                        
         DC    AL3(098)            M2554                                        
         DC    AL3(099)            M2564                                        
         DC    AL3(001)            HOMES                                        
         DC    AL3(000)            METROA  N/A FOR NET                          
         DC    AL3(000)            METROB  N/A FOR NET                          
         DC    AL3(065)            WWORK                                        
         DC    AL3(097)            M2549                                        
         DC    AL3(142)            V1849                                        
         DC    AL3(141)            V1834                                        
         DC    AL3(148)            V2554                                        
         DC    AL3(191)            V2149                                        
         DC    AL3(071)            W2149                                        
         DC    AL3(115)            M2149                                        
         DC    AL3(103)            V3564                                        
         DC    AL1(EOT)            ** END OF LIST INDICATOR **                  
NETDEMSL EQU   *-NETDEMS                                                        
         EJECT                                                                  
WORKD    DSECT                     ** LOCAL WORKING STORAGE **                  
                                                                                
DUB      DS    D                                                                
DMCB     DS    6F                                                               
HALF     DS    H                                                                
EXPAND   DS    F                   VALUE EXPANSION FACTOR                       
ABOOKEL  DS    A                   A(BOOK ELEMENT)                              
APUTEL   DS    A                   A(PUT ELEMENT)                               
                                                                                
AGETIUN  DS    A                   MODULE ENTRY ADDRESS                         
                                                                                
WVALUES  DS    0D                                                               
F1       DS    F                                                                
F10      DS    F                                                                
F100     DS    F                                                                
F500     DS    F                                                                
F1000    DS    F                                                                
F10000   DS    F                                                                
F50000   DS    F                                                                
F100000  DS    F                                                                
ICMMASK  DS    XL4                                                              
WVALUESL EQU   *-WVALUES                                                        
                                                                                
CALLTYPE DS    X                   CALL TYPE                                    
CALLSYST DS    X                   CALLER                                       
SYSSPTQ  EQU   C'S'                SPOT SYSTEM APPLICATION                      
SYSREPQ  EQU   C'R'                REP SYSTEM APPLICATION                       
RTGTOIMP DS    X                   CONVERT TO IMP BASE                          
DMAIMP   DS    X                   'I'=SAVE DMA IMPS NOT RATINGS                
ELEMMASK DS    X                                                                
DEMOTYPE DS    X                                                                
RTGPUT   DS    C                   IUN RATING/PUT ELEMENTS FOUND (NSI)          
FILTYP   DS    C                   T/P/I/N                                      
FILTPAVQ EQU   C'P'                PAV FILE                                     
BOOKTYPE DS    XL(L'DRBTYP)        BOOKTYPE EXTRACTED FROM DEMO RECORD          
                                                                                
* IUN RECORD WORK AREA VALUES                                                   
                                                                                
IUNVALS  DS    0F                                                               
IUNVS    DS    (IUNDEMS)F                                                       
IRTGS    DS    (IUNDEMS)F                                                       
IIMPS    DS    (IUNDEMS)F                                                       
IPUTS    DS    (IUNDEMS)F                                                       
ITOTS    DS    (IUNDEMS)F                                                       
IDMAS    DS    0F                  DMA IMPRESSIONS                              
INEWRTGS DS    (IUNDEMS)F                                                       
ITSAS    DS    0F                  TSA IMPRESSIONS                              
INEWIMPS DS    (IUNDEMS)F                                                       
INEWPUTS DS    (IUNDEMS)F                                                       
INEWTOTS DS    (IUNDEMS)F                                                       
ISHRS    DS    3F                  3 ORIGINAL SHRS                              
                                                                                
* RATINGS                                                                       
                                                                                
NRHOMES  DS    F                                                                
NRMETROA DS    F                                                                
NRMETROB DS    F                                                                
                                                                                
* IMPRESSIONS                                                                   
                                                                                
NTHOMES  DS    F                                                                
NTWWORK  DS    F                                                                
                                                                                
NTW1217  DS    F                                                                
NTW1824  DS    F                                                                
NTW2534  DS    F                                                                
NTW3549  DS    F                                                                
NTW5054  DS    F                                                                
NTW5564  DS    F                                                                
NTW6599  DS    F                                                                
                                                                                
NTM1217  DS    F                                                                
NTM1824  DS    F                                                                
NTM2534  DS    F                                                                
NTM3549  DS    F                                                                
NTM5054  DS    F                                                                
NTM5564  DS    F                                                                
NTM6599  DS    F                                                                
                                                                                
NTV25    DS    F                                                                
NTV611   DS    F                                                                
NTW1820  DS    F                   AFTER OCT/90                                 
NTW2124  DS    F                   AFTER OCT/90                                 
NTM1820  DS    F                   AFTER OCT/90                                 
NTM2124  DS    F                   AFTER OCT/90                                 
                                                                                
* UNIVERSES                                                                     
                                                                                
NUHOMES  DS    F                                                                
NUWWORK  DS    F                                                                
                                                                                
NUW1217  DS    F                                                                
NUW1824  DS    F                                                                
NUW2534  DS    F                                                                
NUW3549  DS    F                                                                
NUW5054  DS    F                                                                
NUW5564  DS    F                                                                
NUW6599  DS    F                                                                
                                                                                
NUM1217  DS    F                                                                
NUM1824  DS    F                                                                
NUM2534  DS    F                                                                
NUM3549  DS    F                                                                
NUM5054  DS    F                                                                
NUM5564  DS    F                                                                
NUM6599  DS    F                                                                
                                                                                
NUV25    DS    F                                                                
NUV611   DS    F                                                                
                                                                                
NUMETROA DS    F                                                                
NUMETROB DS    F                                                                
NUW1820  DS    F                   AFTER OCT/90                                 
NUW2124  DS    F                   AFTER OCT/90                                 
NUM1820  DS    F                   AFTER OCT/90                                 
NUM2124  DS    F                   AFTER OCT/90                                 
                                                                                
* DMA IMPRESSIONS                                                               
                                                                                
NDHOMES  DS    F                                                                
NDWWORK  DS    F                                                                
                                                                                
NDW1217  DS    F                                                                
NDW1824  DS    F                                                                
NDW2534  DS    F                                                                
NDW3549  DS    F                                                                
NDW5054  DS    F                                                                
NDW5564  DS    F                                                                
NDW6599  DS    F                                                                
                                                                                
NDM1217  DS    F                                                                
NDM1824  DS    F                                                                
NDM2534  DS    F                                                                
NDM3549  DS    F                                                                
NDM5054  DS    F                                                                
NDM5564  DS    F                                                                
NDM6599  DS    F                                                                
                                                                                
NDV25    DS    F                                                                
NDV611   DS    F                                                                
NDW1820  DS    F                   AFTER OCT/90                                 
NDW2124  DS    F                   AFTER OCT/90                                 
NDM1820  DS    F                   AFTER OCT/90                                 
NDM2124  DS    F                   AFTER OCT/90                                 
                                                                                
* PUTS                                                                          
                                                                                
NPHOMES  DS    F                   WEEKLYS ONLY                                 
NPMETROA DS    F                                                                
NPMETROB DS    F                                                                
                                                                                
* TOTALS                                                                        
                                                                                
NQHOMES  DS    F                                                                
NQWWORK  DS    F                                                                
                                                                                
NQW1217  DS    F                                                                
NQW1824  DS    F                                                                
NQW2534  DS    F                                                                
NQW3549  DS    F                                                                
NQW5054  DS    F                                                                
NQW5564  DS    F                                                                
NQW6599  DS    F                                                                
                                                                                
NQM1217  DS    F                                                                
NQM1824  DS    F                                                                
NQM2534  DS    F                                                                
NQM3549  DS    F                                                                
NQM5054  DS    F                                                                
NQM5564  DS    F                                                                
NQM6599  DS    F                                                                
                                                                                
NQV25    DS    F                                                                
NQV611   DS    F                                                                
NQW1820  DS    F                   AFTER OCT/90                                 
NQW2124  DS    F                   AFTER OCT/90                                 
NQM1820  DS    F                   AFTER OCT/90                                 
NQM2124  DS    F                   AFTER OCT/90                                 
                                                                                
* TSA IMPRESSIONS                                                               
                                                                                
NWHOMES  DS    F                                                                
NWWWORK  DS    F                                                                
                                                                                
NWW1217  DS    F                                                                
NWW1824  DS    F                                                                
NWW2534  DS    F                                                                
NWW3549  DS    F                                                                
NWW5054  DS    F                                                                
NWW5564  DS    F                                                                
NWW6599  DS    F                                                                
                                                                                
NWM1217  DS    F                                                                
NWM1824  DS    F                                                                
NWM2534  DS    F                                                                
NWM3549  DS    F                                                                
NWM5054  DS    F                                                                
NWM5564  DS    F                                                                
NWM6599  DS    F                                                                
                                                                                
NWV25    DS    F                                                                
NWV611   DS    F                                                                
NWW1820  DS    F                   AFTER OCT/90                                 
NWW2124  DS    F                   AFTER OCT/90                                 
NWM1820  DS    F                   AFTER OCT/90                                 
NWM2124  DS    F                   AFTER OCT/90                                 
                                                                                
DEMOLST  DS    XL(NETDEMSL)        NETWORK DEMO LOOKUP LIST                     
                                                                                
WORKL    EQU   *-WORKD                                                          
         EJECT                                                                  
IUNRECD  DSECT                     ** OUTPUT IUN RECORD **                      
                                                                                
SPUTS    DS    (IUNDEMS)F                                                       
SPUTSL   EQU   *-SPUTS                                                          
STOTS    DS    (IUNDEMS)F                                                       
STOTSL   EQU   *-STOTS                                                          
         ORG   IUNRECD                                                          
                                                                                
UNVS     DS    (IUNDEMS)F                                                       
UNVSL    EQU   *-UNVS                                                           
RTGS     DS    (IUNDEMS)F                                                       
RTGSL    EQU   *-RTGS                                                           
IMPS     DS    (IUNDEMS)F                                                       
IMPSL    EQU   *-IMPS                                                           
PUTS     DS    (IUNDEMS)F                                                       
PUTSL    EQU   *-PUTS                                                           
TOTS     DS    (IUNDEMS)F                                                       
TOTSL    EQU   *-TOTS                                                           
NEWRTGS  DS    (IUNDEMS)F                                                       
NEWRTGSL EQU   *-NEWRTGS                                                        
NEWIMPS  DS    (IUNDEMS)F                                                       
NEWIMPSL EQU   *-NEWIMPS                                                        
NEWPUTS  DS    (IUNDEMS)F                                                       
NEWPUTSL EQU   *-NEWPUTS                                                        
NEWTOTS  DS    (IUNDEMS)F                                                       
NEWTOTSL EQU   *-NEWTOTS                                                        
SHRS     DS    3F                                                               
SHRSL    EQU   *-SHRS                                                           
                                                                                
* DEDBLOCK                                                                      
         PRINT OFF                                                              
DBLOCKD  DSECT                                                                  
       ++INCLUDE DEDBLOCK                                                       
         PRINT ON                                                               
                                                                                
* DDCOMFACS                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACS                                                      
         PRINT ON                                                               
                                                                                
* DEDEMFILE                                                                     
         PRINT OFF                                                              
       ++INCLUDE DEDEMFILE                                                      
         PRINT ON                                                               
                                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'001DEGETIUN  07/13/01'                                      
         END                                                                    

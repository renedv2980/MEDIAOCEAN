*          DATA SET DDPAN1UP   AT LEVEL 016 AS OF 05/01/02                      
*CATALP PAN1UP                                                                  
*                                                                               
*        NOTE THIS IS USED BY DEIS TO PRINT MANUALS                             
*                                                                               
         TITLE 'PAN1UP - PRINT SYSTEMS MANUALS 1-UP'                            
PAN1UP   CSECT                                                                  
         PRINT NOGEN                                                            
         NBASE 0,**PAN1UP,=V(REGSAVE),R9,RR=R2                                  
         ST    R2,RELO                                                          
         SPACE 1                                                                
         GOTO1 =V(DATCON),DMCB,(5,0),(8,TODAY)                                  
         SPACE 1                                                                
       ++INCLUDE DDGETIME                                                       
         ST    R1,WORK                                                          
         XC    DUB,DUB                                                          
         MVC   DUB+5(3),WORK                                                    
         OI    DUB+7,X'0F'                                                      
         CVB   R6,DUB                                                           
         EDIT  (R6),(5,TIMENOW),2                                               
         L     R8,=V(BOXAREA)                                                   
         USING BOXD,R8                                                          
         EJECT                                                                  
*              HANDLE THE CARD DECK                                             
         SPACE 3                                                                
CARD     GOTO1 =V(CARDS),DMCB,C,=C'RE00'                                        
         CLC   C(2),=C'/*'                                                      
         BNE   CARD2                                                            
         GOTO1 =V(PRINT),DMCB,=C'CLOSE'                                         
         XBASE                                                                  
         SPACE 1                                                                
CARD2    CLI   C,C'<'              CHECK FOR CONTROL CARDS                      
         BNE   CARD4                                                            
         BAS   RE,DOCON                                                         
         B     CARD                                                             
         SPACE 1                                                                
CARD4    CLC   C(7),=C'COPIES='                                                 
         BNE   CARD6                                                            
         BAS   RE,DOCOPY                                                        
         B     CARD                                                             
         SPACE 1                                                                
CARD6    CLC   C(4),=C'PAN='                                                    
         BNE   CARD8                                                            
         BAS   RE,DOPAN                                                         
         B     CARD                                                             
         SPACE 1                                                                
CARD8    GOTO1 POOLPOST,DMCB,C                                                  
         B     CARD                                                             
         EJECT                                                                  
*              HANDLE THE CONTROL CARDS                                         
         SPACE 3                                                                
DOCON    NTR1                                                                   
         CLC   C(9),=C'<DOCNAME>'  CHECK FOR SPECIAL CONTROL CARDS              
         BE    DOCCARD                                                          
         CLC   C(6),=C'<CHAP>'                                                  
         BE    CHAPCARD                                                         
         CLC   C(3),=C'<T>'                                                     
         BE    TCARD                                                            
         CLC   C(4),=C'<PA>'                                                    
         BE    SKIPCARD                                                         
         CLC   C(6),=C'<LEFT>'     OPTION TO SKIP TO NEXT LEFT                  
         BE    LEFTCARD                                                         
         CLC   C(7),=C'<RIGHT>'    OPTION TO SKIP TO NEXT RIGHT                 
         BE    RGHTCARD                                                         
         CLC   C(3),=C'<X>'                                                     
         BE    INDXCARD                                                         
         CLC   C(9),=C'<INCLUDE>'                                               
         BE    INCCARD                                                          
         CLC   C(7),=C'<PRINT>'                                                 
         BE    PRNTCARD                                                         
         B     XIT                                                              
         SPACE 1                                                                
DOCCARD  MVC   DOCNAME,C+9         <DOCNAME>                                    
         B     XIT                                                              
         SPACE 1                                                                
CHAPCARD BAS   RE,DOPAGE                                                        
         MVC   CHAPNAME,C+6                                                     
         MVC   WORK,SPACES                                                      
         MVC   WORK(74),C+6                                                     
         LH    R1,CHAP                                                          
         LA    R1,1(R1)                                                         
         STH   R1,CHAP                                                          
         MVC   PAGE,=H'1'                                                       
         BAS   RE,TOCPOST                                                       
         BAS   RE,INDXPOST                                                      
         MVC   THISTIT,SPACES                                                   
         B     XIT                                                              
         SPACE 1                                                                
TCARD    BAS   RE,NEWPAGE                                                       
         MVC   WORK,SPACES                                                      
         MVC   WORK+4(72),C+3                                                   
         BAS   RE,TOCPOST                                                       
         MVC   P,SPACES                                                         
         MVC   P(64),CHAPNAME                                                   
         MVC   P+65(64),WORK+4                                                  
         GOTO1 =V(SQUASHER),DMCB,P,130                                          
         MVC   WORK,P                                                           
         MVC   P,SPACES                                                         
         BAS   RE,INDXPOST                                                      
         MVC   THISTIT,C+3                                                      
         MVC   WORK,SPACES                                                      
         MVI   WORK,X'BF'                                                       
         GOTO1 POOLPOST,DMCB,WORK                                               
         MVC   WORK,SPACES                                                      
         MVC   WORK(64),THISTIT                                                 
         GOTO1 =V(CENTER),DMCB,WORK,80                                          
         GOTO1 POOLPOST,DMCB,WORK                                               
         MVC   C,SPACES                                                         
         GOTO1 =V(UNDERLIN),DMCB,(80,WORK),(X'BF',C)                            
         GOTO1 POOLPOST,DMCB,C                                                  
         GOTO1 POOLPOST,DMCB,SPACES                                             
         B     XIT                                                              
         SPACE 1                                                                
SKIPCARD BAS   RE,NEWPAGE          <PA>                                         
         B     XIT                                                              
         SPACE 1                                                                
LEFTCARD BAS   RE,NEWPAGE          <LEFT>                                       
         TM    PAGE+1,X'01'                                                     
         BO    XIT                                                              
         BAS   RE,NEWPAGE                                                       
         B     XIT                                                              
         SPACE 1                                                                
RGHTCARD BAS   RE,NEWPAGE          <RIGHT>                                      
         TM    PAGE+1,X'01'                                                     
         BNO   XIT                                                              
         BAS   RE,NEWPAGE                                                       
         B     XIT                                                              
         SPACE 1                                                                
INDXCARD MVC   WORK,SPACES         <X>                                          
         MVC   SUPER,C+3                                                        
         BAS   RE,INDXPOST                                                      
         B     XIT                                                              
         SPACE 1                                                                
INCCARD  MVI   INCOPT,X'80'        <INCLUDE>OFF/ON                              
         CLC   C+9(3),=C'OFF'                                                   
         BNE   XIT                                                              
         MVI   INCOPT,0                                                         
         B     XIT                                                              
         SPACE 1                                                                
PRNTCARD MVI   PRINTOPT,C'Y'       <PRINT>OFF/ON                                
         CLC   C+9(3),=C'OFF'                                                   
         BNE   XIT                                                              
         MVI   PRINTOPT,C'N'                                                    
         B     XIT                                                              
         EJECT                                                                  
*              HANDLE THE COPIES= CARD                                          
         SPACE 3                                                                
DOCOPY   NTR1                                                                   
         LA    R2,C+7                                                           
         SR    R3,R3                                                            
         SPACE 1                                                                
DOCC2    CLI   0(R2),C'0'                                                       
         BL    DOCC4                                                            
         CLI   0(R2),C'9'                                                       
         BH    DOCC4                                                            
         ZIC   R1,0(R2)                                                         
         SLL   R1,28                                                            
         SRL   R1,28                                                            
         MH    R3,=H'10'                                                        
         AR    R3,R1                                                            
         LA    R2,1(R2)                                                         
         B     DOCC2                                                            
         SPACE 1                                                                
DOCC4    STC   R3,COPIES                                                        
         CLI   COPIES,0                                                         
         BNE   XIT                                                              
         MVI   COPIES,1                                                         
         B     XIT                                                              
         EJECT                                                                  
*              HANDLE THE PAN BOOKS                                             
         SPACE 3                                                                
DOPAN    NTR1                                                                   
         MVC   PANNAME,C+4                                                      
         ZIC   R0,COPIES           SET UP FOR N COPIES                          
         SPACE 1                                                                
DOPAN2   MVI   PPOPT,C'N'                                                       
         MVI   LAP,1                                                            
         BAS   RE,DOPANBK                                                       
         MVI   PPOPT,C'Y'                                                       
         BAS   RE,DOCPAGE                                                       
         BAS   RE,TOC              PRINT TABLE OF CONTENTS                      
         MVI   LAP,2                                                            
         BAS   RE,DOPANBK          THEN HANDLE THE MAIN TEXT                    
         BAS   RE,INDEX            FINALLY PRINT THE INDEX                      
         BCT   R0,DOPAN2                                                        
         B     XIT                                                              
         SPACE 1                                                                
DOPANBK  NTR1                                                                   
         XC    CHAP,CHAP           INITIALIZE FOR BOOK                          
         MVC   PAGE,=H'1'                                                       
         L     R2,=A(PAGEPOOL)     CLEAR OUT PAGE POOL                          
         A     R2,RELO                                                          
         XC    0(4,R2),0(R2)                                                    
         L     R0,4(R2)                                                         
         LA    R2,8(R2)                                                         
         SPACE 1                                                                
CLEAR2   XC    0(84,R2),0(R2)                                                   
         LA    R2,84(R2)                                                        
         BCT   R0,CLEAR2                                                        
         MVC   THISTIT,SPACES      TITLE DEFAULTS TO PANNAME                    
         CLC   PANNAME(2),=C'DC'                  WITHOUT THE DC                
         BNE   *+10                                                             
         MVC   THISTIT(8),PANNAME+2                                             
         MVI   PANPOPT,C'Y'                                                     
         SPACE 1                                                                
DOPANNXT GOTO1 =V(PANIC),DMCB,(INCOPT,=C'READ'),=C'PAN',PANNAME,C               
         TM    DMCB+8,X'80'                                                     
         BO    DOPANEND                                                         
         CLI   DMCB+8,0                                                         
         BNE   DOPANERR                                                         
         CLC   C+9(9),=C'PRINT OFF'                                             
         BNE   *+8                                                              
         MVI   PANPOPT,C'N'                                                     
         CLC   C+9(9),=C'PRINT ON '                                             
         BNE   *+8                                                              
         MVI   PANPOPT,C'Y'                                                     
         CLI   PANPOPT,C'N'                                                     
         BE    DOPANNXT                                                         
         CLI   C,C'<'              CHECK FOR CONTROLS                           
         BE    DOPANCON                                                         
         CLC   C(2),=C'*<'                                                      
         BE    DOPANCON                                                         
         SPACE 1                                                                
         CLC   C+9(5),=C'<   >'    BEHAVES LIKE A TITLE                         
         BE    DOPANTIT                                                         
         CLC   C+9(5),=C'TITLE'                                                 
         BE    DOPANTIT                                                         
         CLC   C+9(5),=C'EJECT'                                                 
         BE    DOPANEJE                                                         
         CLC   C+9(5),=C'SPACE'                                                 
         BE    DOPANSPA                                                         
         CLC   C(15),=C'*          DATA'                                        
         BE    DOPANNXT                                                         
         CLC   C(2),=C'*-'                                                      
         BNE   *+8                                                              
         MVI   C,C'-'                                                           
         MVC   WORK(5),=C'00000'   REMOVE SEQUENCE AND STAMP                    
         MVZ   WORK(5),C+72                                                     
         CLC   WORK(5),=C'00000'                                                
         BNE   DOPANN2                                                          
         MVC   WORK,SPACES                                                      
         MVC   WORK+3(72),C        AND INDENT                                   
         MVC   C,WORK                                                           
         SPACE 1                                                                
DOPANN2  LA    R2,C                                                             
         LA    R0,80                                                            
         SPACE 1                                                                
DOPANLIN CLI   0(R2),C'-'          USE BETTER UNDERLINE CHARACTER               
         BNE   *+8                                                              
         MVI   0(R2),X'BF'                                                      
         CLI   0(R2),C'_'          CHECK FOR UNDERSCORE                         
         BNE   *+8                                                              
         MVI   0(R2),X'BF'                                                      
         CLI   0(R2),C'º'          CHECK FOR V BAR                              
         BNE   *+8                                                              
         MVI   0(R2),X'FA'         USE VERTICAL                                 
         LA    R2,1(R2)                                                         
         BCT   R0,DOPANLIN                                                      
         GOTO1 POOLPOST,DMCB,C                                                  
         B     DOPANNXT                                                         
         EJECT                                                                  
*              HANDLE SPECIAL CARDS IN PAN BOOKS                                
         SPACE 1                                                                
DOPANTIT BAS   RE,SETTIT           TITLE                                        
         MVI   ALLOW,12            ENSURE ROOM FOR NEW TOPIC                    
         MVC   WORK,SPACES                                                      
         MVI   WORK,X'BF'                                                       
         GOTO1 POOLPOST,DMCB,WORK                                               
         MVC   WORK,SPACES                                                      
         GOTO1 POOLPOST,DMCB,WORK                                               
         MVC   WORK,SPACES                                                      
         MVC   WORK(64),THISTIT                                                 
         GOTO1 =V(CENTER),DMCB,WORK,80                                          
         MVI   THISFONT,1                                                       
         GOTO1 POOLPOST,DMCB,WORK                                               
         MVI   THISFONT,0                                                       
         MVC   C,SPACES                                                         
         GOTO1 =V(UNDERLIN),DMCB,(80,WORK),(X'BF',C)                            
         GOTO1 POOLPOST,DMCB,C                                                  
         GOTO1 POOLPOST,DMCB,SPACES                                             
         MVC   WORK,SPACES                                                      
         MVC   WORK(64),THISTIT                                                 
         BAS   RE,INDXPOST                                                      
         B     DOPANNXT                                                         
         SPACE 1                                                                
DOPANEJE BAS   RE,NEWPAGE          EJECT                                        
         B     DOPANNXT                                                         
         SPACE 1                                                                
*                                  SPACE                                        
DOPANSPA GOTO1 POOLPOST,DMCB,SPACES                                             
         CLI   C+15,C'2'                                                        
         BL    DOPANNXT                                                         
         GOTO1 POOLPOST,DMCB,SPACES                                             
         B     DOPANNXT                                                         
         SPACE 1                                                                
DOPANCON CLI   C,C'*'              CONTROLS CAN START WITH *<                   
         BNE   *+10                                                             
         MVC   C(79),C+1           STRIP OFF ASTERISK                           
         BAS   RE,DOCON                                                         
         B     DOPANNXT                                                         
         SPACE 1                                                                
DOPANEND BAS   RE,DOPAGE                                                        
         B     XIT                                                              
         SPACE 1                                                                
DOPANERR MVC   C,SPACES                                                         
         MVC   C(10),PANNAME                                                    
         MVC   C+12(20),=C'** BOOK NOT FOUND **'                                
         GOTO1 POOLPOST,DMCB,C                                                  
         GOTO1 POOLPOST,DMCB,SPACES                                             
         B     XIT                                                              
         EJECT                                                                  
*              ROUTINE TO POST INTO POOL                                        
         SPACE 3                                                                
POOLPOST NTR1                                                                   
         L     R3,0(R1)            P1=A(DATA)                                   
         L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         L     R1,0(R2)            CHECK WE HAVE SPACE FOR ALLOW                
         C     R1,MAX                                                           
         BL    *+8                                                              
         S     R1,MAX                                                           
         CLI   0(R3),X'BF'         IF WE ARE TRYING A HORIZ                     
         BNE   PP0                                                              
         CH    R1,=H'2'            AND WE ARE AT THE TOP OF THE PAGE            
         BL    XIT                 DONT BOTHER                                  
         SPACE 1                                                                
PP0      ZIC   R0,ALLOW                                                         
         MVI   ALLOW,0                                                          
         AR    R1,R0                                                            
         C     R1,MAX                                                           
         BL    PP1                                                              
         BAS   RE,NEWPAGE          IF NOT SKIP TO NEW PAGE                      
         CLI   0(R3),X'BF'         IF WE ARE TRYING A HORIZ                     
         BE    XIT                 NOT NEEDED                                   
         SPACE 1                                                                
PP1      CLC   0(4,R2),4(R2)       HAVE WE FILLED UP YET                        
         BNE   PP2                                                              
         BAS   RE,DOPAGE                                                        
         XC    0(4,R2),0(R2)                                                    
         SPACE 1                                                                
PP2      CLC   LTIT,SPACES         SET FIRST TITLE                              
         BNE   *+10                                                             
         MVC   LTIT,THISTIT                                                     
         MVC   RTIT,THISTIT        ALWAYS SET LAST                              
         L     R1,0(R2)            DISPLACE INTO POOL                           
         LA    RF,1(R1)                                                         
         ST    RF,0(R2)            ADD TO PRESENT COUNT                         
         MH    R1,=H'84'                                                        
         LA    R1,8(R1,R2)                                                      
         MVC   0(1,R1),THISFONT    SAVE THE PRESENT FONT                        
         MVC   4(80,R1),0(R3)      AND THE TEXT                                 
         CLC   0(4,R2),MAX         IF WE HAVE JUST FILLED LEFT PAGE             
         BNE   XIT                                                              
         LH    R1,PAGE                                                          
         LA    R1,1(R1)            ADD 1 TO PAGE NUMBER                         
         STH   R1,PAGE                                                          
         B     XIT                                                              
         EJECT                                                                  
*              ROUTINE TO POST INTO TABLE OF CONTENTS & INDEX                   
         SPACE 3                                                                
TOCPOST  NTR1                                                                   
         L     R2,=A(TOCPOOL)                                                   
         B     BOTHPOST                                                         
         SPACE 1                                                                
INDXPOST NTR1                                                                   
         L     R2,=A(INDXPOOL)                                                  
         CLC   SUPER,SPACES                                                     
         BE    BOTHPOST                                                         
         MVC   SAVEWORK,WORK                                                    
         MVC   WORK,SPACES                                                      
         MVC   WORK(64),SUPER                                                   
         CLC   SAVEWORK(64),SPACES                                              
         BE    BOTHPOST                                                         
         MVI   WORK+19,X'FF'                                                    
         MVC   WORK+20(50),SAVEWORK                                             
         SPACE 1                                                                
BOTHPOST CLI   LAP,2                                                            
         BE    XIT                                                              
         A     R2,RELO                                                          
         CLC   0(4,R2),4(R2)       HAVE WE FILLED UP YET                        
         BE    XIT                                                              
         L     R1,0(R2)            DISPLACE INTO POOL                           
         LA    RF,1(R1)                                                         
         ST    RF,0(R2)            ADD TO PRESENT COUNT                         
         MH    R1,=H'80'                                                        
         LA    R1,8(R1,R2)                                                      
         MVC   0(80,R1),WORK       SAVE THE TEXT                                
         LA    R2,70(R1)           SAVE THE PRESENT PAGE NUMBER                 
         BAS   RE,EDITPNO                                                       
         B     XIT                                                              
         EJECT                                                                  
*              TITLE ROUTINES                                                   
         SPACE 3                                                                
SETTIT   NTR1                                                                   
         CLC   C+9(5),=C'<   >'    SPECIAL FORMAT                               
         BNE   SETTIT1                                                          
         MVC   THISTIT(56),C+15                                                 
         B     XIT                                                              
         SPACE 1                                                                
SETTIT1  MVC   THISTIT,SPACES                                                   
         LA    R2,C+16                                                          
         LA    R3,THISTIT                                                       
         LA    R4,64                                                            
         SPACE 1                                                                
SETTIT2  CLI   0(R2),C''''                                                      
         BE    XIT                                                              
         MVC   0(1,R3),0(R2)                                                    
         LA    R2,1(R2)                                                         
         LA    R3,1(R3)                                                         
         BCT   R4,SETTIT2                                                       
         B     XIT                                                              
         EJECT                                                                  
*              PAGE ROUTINES                                                    
         SPACE 3                                                                
DOCPAGE  NTR1                                                                   
         CLC   DOCNAME,SPACES                                                   
         BE    XIT                                                              
         BAS   RE,DOCBOX                                                        
         MVC   P,SPACES                                                         
         LA    R0,11                                                            
         SPACE 1                                                                
DOCPAGE2 BAS   RE,SPACE                                                         
         BCT   R0,DOCPAGE2                                                      
         MVC   P+18(64),DOCNAME                                                 
         GOTO1 =V(CENTER),DMCB,P+18,64                                          
         MVI   BOXFONT,1                                                        
         BAS   RE,SPACE2                                                        
         MVI   BOXFONT,0                                                        
         MVC   P+18(9),TODAY                                                    
         GOTO1 =V(CENTER),DMCB,P+18,64                                          
         BAS   RE,SPACE2                                                        
         BAS   RE,SPACE2                                                        
         BAS   RE,SKIP                                                          
         B     XIT                                                              
         SPACE 1                                                                
NEWPAGE  NTR1                                                                   
         L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         OC    0(4,R2),0(R2)       DON'T SKIP IF WE ARE THERE                   
         BZ    XIT                                                              
         CLC   0(4,R2),MAX                                                      
         BE    XIT                                                              
         TM    PAGE+1,X'01'        ARE WE ON THE ODD PAGE?                      
         BO    NEWPAGE2                                                         
         BAS   RE,DOPAGE           NO - SO PRINT IT ALL OUT                     
         B     XIT                                                              
         SPACE 1                                                                
NEWPAGE2 L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         MVC   0(4,R2),MAX         SET TO HANDLE 2ND PAGE                       
         LH    R1,PAGE                                                          
         LA    R1,1(R1)                                                         
         STH   R1,PAGE                                                          
         B     XIT                                                              
         SPACE 1                                                                
EDITPAGE NTR1                                                                   
         MVC   0(4,R2),=C'PAGE'                                                 
         LA    R2,5(R2)                                                         
         B     EP1                                                              
         SPACE 1                                                                
EDITPNO  NTR1                                                                   
         SPACE 1                                                                
EP1      OC    CHAP,CHAP                                                        
         BZ    EP6                                                              
         EDIT  (2,CHAP),(3,0(R2)),ALIGN=LEFT,WRK=MYWORK                         
         SPACE 1                                                                
EP2      CLI   0(R2),C' '                                                       
         BE    EP4                                                              
         LA    R2,1(R2)                                                         
         B     EP2                                                              
         SPACE 1                                                                
EP4      MVI   0(R2),C'.'                                                       
         LA    R2,1(R2)                                                         
         SPACE 1                                                                
EP6      EDIT  (2,PAGE),(3,0(R2)),ALIGN=LEFT,WRK=MYWORK                         
         B     XIT                                                              
         EJECT                                                                  
*              CONTROL DOUBLE PAGE PRINTING                                     
         SPACE 3                                                                
DOPAGE   NTR1                                                                   
         L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         OC    0(4,R2),0(R2)                                                    
         BZ    XIT                                                              
         BAS   RE,ODDBOX                                                        
         BAS   RE,SPACE                                                         
         SPACE 1                                                                
         LA    R2,P+6              ODD PAGE HEADINGS                            
         MVC   0(64,R2),DOCNAME                                                 
         MVI   BOXFONT,1                                                        
         BAS   RE,SPACE2                                                        
         MVI   BOXFONT,0                                                        
         L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         LA    R2,8(R2)            R2=A(ODD PAGE)                               
         L     R4,MAX                                                           
         SPACE 1                                                                
DOODD2   MVC   P+6(80),4(R2)                                                    
         MVC   BOXFONT,0(R2)                                                    
         LA    R5,P+3                                                           
         BAS   RE,DOHORIZ                                                       
         MVC   4(80,R2),SPACES                                                  
         MVI   0(R2),0                                                          
         BAS   RE,SPACE                                                         
         LA    R2,84(R2)                                                        
         BCT   R4,DOODD2                                                        
         SPACE 1                                                                
         BAS   RE,SPACE                                                         
         LA    R2,P+6                                                           
         MVC   0(64,R2),LTIT       FIRST (LEFT) TITLE                           
         MVC   LTIT,SPACES                                                      
         LH    R1,PAGE                                                          
         TM    PAGE+1,X'01'        GET PAGE BACK TO ODD NUMBER                  
         BO    *+6                                                              
         BCTR  R1,0                                                             
         STH   R1,PAGE                                                          
         LA    R2,72(R2)                                                        
         BAS   RE,EDITPAGE                                                      
         MVI   BOXFONT,1                                                        
         BAS   RE,SKIP                                                          
         MVI   BOXFONT,0                                                        
         LH    R1,PAGE                                                          
         LA    R1,1(R1)                                                         
         STH   R1,PAGE                                                          
         SPACE 1                                                                
         BAS   RE,EVENBOX          NOW DO THE EVEN PAGE                         
         BAS   RE,SPACE                                                         
         LA    R2,P+14                                                          
         MVC   16(64,R2),CHAPNAME  CHAPTER NAME                                 
         CLC   CHAPNAME,SPACES     OR DOCNAME IF NO CHAPTER                     
         BNE   *+10                                                             
         MVC   16(64,R2),DOCNAME                                                
         GOTO1 =V(RIGHT),DMCB,16(R2),64                                         
         MVI   BOXFONT,1                                                        
         BAS   RE,SPACE2                                                        
         MVI   BOXFONT,0                                                        
         L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         LA    R2,8(R2)                                                         
         L     R3,MAX                                                           
         MH    R3,=H'84'                                                        
         AR    R2,R3                                                            
         L     R4,MAX                                                           
         SPACE 1                                                                
DOEVEN2  MVC   P+14(80),4(R2)                                                   
         MVC   BOXFONT,0(R2)                                                    
         LA    R5,P+11                                                          
         BAS   RE,DOHORIZ                                                       
         MVC   4(80,R2),SPACES                                                  
         MVI   0(R2),0                                                          
         BAS   RE,SPACE                                                         
         LA    R2,84(R2)                                                        
         BCT   R4,DOEVEN2                                                       
         SPACE 1                                                                
         BAS   RE,SPACE                                                         
         LA    R2,P+14                                                          
         BAS   RE,EDITPAGE                                                      
         MVC   16(64,R2),RTIT      LAST (RIGHT) TITLE                           
         GOTO1 =V(RIGHT),DMCB,16(R2),64                                         
         MVC   RTIT,SPACES                                                      
         SPACE 1                                                                
         LH    R1,PAGE                                                          
         LA    R1,1(R1)                                                         
         STH   R1,PAGE                                                          
         MVI   BOXFONT,1                                                        
         BAS   RE,SKIP                                                          
         MVI   BOXFONT,0                                                        
         L     R2,=A(PAGEPOOL)                                                  
         A     R2,RELO                                                          
         XC    0(4,R2),0(R2)                                                    
         B     XIT                                                              
         SPACE 1                                                                
DOHORIZ  NTR1                                                                   
         CLI   3(R5),X'BF'         WRITE HORIZ LINES                            
         BNE   XIT                                                              
         CLC   4(20,R5),SPACES                                                  
         BNE   XIT                                                              
         MVI   3(R5),C' '                                                       
         MVI   0(R5),X'EB'                                                      
         MVI   1(R5),X'BF'                                                      
         MVC   2(83,R5),1(R5)                                                   
         MVI   85(R5),X'EC'                                                     
         B     XIT                                                              
         EJECT                                                                  
*              PRINT TABLE OF CONTENTS                                          
         SPACE 3                                                                
TOC      NTR1                                                                   
         L     R2,=A(TOCPOOL)                                                   
         A     R2,RELO                                                          
         L     R0,0(R2)                                                         
         LTR   R0,R0                                                            
         BZ    XIT                                                              
         XC    0(4,R2),0(R2)                                                    
         LA    R2,8(R2)                                                         
         MVC   CHAPNAME,SPACES                                                  
         MVC   CHAPNAME(17),=C'TABLE OF CONTENTS'                               
         XC    CHAP,CHAP                                                        
         MVC   PAGE,=H'1'                                                       
         MVC   C,SPACES                                                         
         MVC   C+3(64),CHAPNAME                                                 
         MVI   BOXFONT,1                                                        
         GOTO1 POOLPOST,DMCB,C                                                  
         MVI   BOXFONT,0                                                        
         GOTO1 =V(UNDERLIN),DMCB,(64,CHAPNAME),(X'BF',C+3)                      
         GOTO1 POOLPOST,DMCB,C                                                  
         MVC   C,SPACES                                                         
         GOTO1 POOLPOST,DMCB,C                                                  
         SPACE 1                                                                
TOC2     MVC   C,SPACES                                                         
         MVC   C+70(10),70(R2)                                                  
         MVC   C+3(64),0(R2)                                                    
         LA    RE,C+7                                                           
         LA    RF,30                                                            
         SPACE 1                                                                
TOC4     CLC   0(2,RE),SPACES                                                   
         BNE   *+8                                                              
         MVI   1(RE),C'.'          PUT DOTS ACROSS                              
         LA    RE,2(RE)                                                         
         BCT   RF,TOC4                                                          
         SPACE 1                                                                
         GOTO1 POOLPOST,DMCB,C                                                  
         MVC   0(80,R2),SPACES                                                  
         LA    R2,80(R2)                                                        
         CLC   0(4,R2),SPACES      IF NEXT IS CHAPTER, ANOTHER SPACE            
         BE    TOC6                                                             
         GOTO1 POOLPOST,DMCB,SPACES                                             
         SPACE 1                                                                
TOC6     BCT   R0,TOC2                                                          
         BAS   RE,DOPAGE                                                        
         MVC   CHAPNAME,SPACES                                                  
         B     XIT                                                              
         EJECT                                                                  
*              PRINT INDEX                                                      
         SPACE 3                                                                
INDEX    NTR1                                                                   
         CLI   LAP,1                                                            
         BE    XIT                                                              
         L     R2,=A(INDXPOOL)                                                  
         A     R2,RELO                                                          
         L     R0,0(R2)                                                         
         LTR   R0,R0                                                            
         BZ    XIT                                                              
         XC    0(4,R2),0(R2)                                                    
         LA    R2,8(R2)                                                         
         GOTO1 =V(XSORT),DMCB,(R2),(R0),80,80,0                                 
         MVC   THISTIT,SPACES                                                   
         MVC   THISTIT(5),=C'INDEX'                                             
         MVC   C,SPACES                                                         
         MVC   C+3(64),THISTIT                                                  
         MVI   BOXFONT,1                                                        
         GOTO1 POOLPOST,DMCB,C                                                  
         MVI   BOXFONT,0                                                        
         GOTO1 =V(UNDERLIN),DMCB,(64,THISTIT),(X'BF',C+3)                       
         GOTO1 POOLPOST,DMCB,C                                                  
         MVC   C,SPACES                                                         
         GOTO1 POOLPOST,DMCB,C                                                  
         XC    CHAP,CHAP                                                        
         MVC   PAGE,=H'1'                                                       
         MVC   LASTINDX,SPACES                                                  
         SPACE 1                                                                
INDEX2   MVC   C,SPACES                                                         
         CLC   LASTINDX(1),0(R2)   CHECK FOR LETTER CHANGE                      
         BE    INDEX4                                                           
         GOTO1 POOLPOST,DMCB,C                                                  
         MVC   C+6(1),0(R2)        SHOW THIS IN THE INDEX                       
         GOTO1 POOLPOST,DMCB,C                                                  
         MVC   C,SPACES                                                         
         GOTO1 POOLPOST,DMCB,C                                                  
         SPACE 1                                                                
INDEX4   MVC   C+3(64),0(R2)       MOVE IN THE DATA                             
         MVC   C+70(10),70(R2)         AND THE PAGE                             
         MVC   LASTINDX,C+3                                                     
         LA    RE,C+3                                                           
         LA    RF,32                                                            
         CLI   19(R2),X'FF'        SPECIAL CONVENTION FOR SUB-INDEX             
         BNE   INDEX10                                                          
         MVC   C+3(64),SPACES                                                   
         MVC   C+7(44),20(R2)                                                   
         LA    RE,C+7                                                           
         LA    RF,30                                                            
         SPACE 1                                                                
INDEX10  CLC   0(2,RE),SPACES                                                   
         BNE   *+8                                                              
         MVI   1(RE),C'.'          PUT DOTS ACROSS                              
         LA    RE,2(RE)                                                         
         BCT   RF,INDEX10                                                       
         SPACE 1                                                                
         GOTO1 POOLPOST,DMCB,C                                                  
         MVC   0(80,R2),SPACES                                                  
         LA    R2,80(R2)                                                        
         BCT   R0,INDEX2                                                        
         BAS   RE,DOPAGE                                                        
         MVC   CHAPNAME,SPACES                                                  
         B     XIT                                                              
         EJECT                                                                  
*              BOX ROUTINES                                                     
         SPACE 3                                                                
ODDBOX   NTR1                                                                   
         MVI   BOXYORN,C'Y'                                                     
         MVI   BOXWT,1                                                          
         MVI   BOXINIT,0                                                        
         MVI   BOXOFF,0                                                         
         MVC   BOXCOLS,SPACES                                                   
         MVC   BOXCOLSR,SPACES                                                  
         MVC   BOXROWS,SPACES                                                   
         MVI   BOXCOLS+3,C'L'                                                   
         MVI   BOXCOLS+88,C'R'                                                  
         MVI   BOXROWS,C'T'                                                     
         MVI   BOXROWS+2,C'M'                                                   
         MVI   BOXROWS+73,C'M'                                                  
         MVI   BOXROWS+75,C'B'                                                  
         MVI   BOXOPTCD,C'J'                                                    
         B     XIT                                                              
         SPACE 1                                                                
EVENBOX  NTR1                                                                   
         MVI   BOXYORN,C'Y'                                                     
         MVI   BOXWT,1                                                          
         MVI   BOXINIT,0                                                        
         MVI   BOXOFF,0                                                         
         MVC   BOXCOLS,SPACES                                                   
         MVC   BOXCOLSR,SPACES                                                  
         MVC   BOXROWS,SPACES                                                   
         MVI   BOXCOLS+11,C'L'                                                  
         MVI   BOXCOLS+96,C'R'                                                  
         MVI   BOXROWS,C'T'                                                     
         MVI   BOXROWS+2,C'M'                                                   
         MVI   BOXROWS+73,C'M'                                                  
         MVI   BOXROWS+75,C'B'                                                  
         MVI   BOXOPTCD,C'J'                                                    
         B     XIT                                                              
         SPACE 1                                                                
DOCBOX   NTR1                                                                   
         MVI   BOXYORN,C'Y'                                                     
         MVI   BOXWT,1                                                          
         MVI   BOXINIT,0                                                        
         MVI   BOXOFF,0                                                         
         MVC   BOXCOLS,SPACES                                                   
         MVC   BOXCOLSR,SPACES                                                  
         MVC   BOXROWS,SPACES                                                   
         MVI   BOXCOLS+18,C'L'                                                  
         MVI   BOXCOLS+82,C'R'                                                  
         MVI   BOXROWS+9,C'T'                                                   
         MVI   BOXROWS+15,C'B'                                                  
         MVI   BOXOPTCD,C'J'                                                    
         B     XIT                                                              
         EJECT                                                                  
*              PRINT UTILITIES                                                  
         SPACE 3                                                                
SPACE0   NTR1                                                                   
         MVC   COMMAND,=C'BL00'                                                 
         B     PRINTALL                                                         
         SPACE 1                                                                
SPACE    NTR1                                                                   
         MVC   COMMAND,=C'BL01'                                                 
         B     PRINTALL                                                         
         SPACE 1                                                                
SPACE2   NTR1                                                                   
         MVC   COMMAND,=C'BL02'                                                 
         B     PRINTALL                                                         
         SPACE 1                                                                
SKIP     NTR1                                                                   
         MVC   COMMAND,=C'BC01'                                                 
         SPACE 1                                                                
PRINTALL CLI   PPOPT,C'N'          CHECK PRINT SWITCH OPTIONS                   
         BE    PRINTX                                                           
         CLI   PRINTOPT,C'N'                                                    
         BE    PRINTX                                                           
         SPACE 1                                                                
         GOTO1 =V(PRINT),DMCB,P-1,COMMAND                                       
         SPACE 1                                                                
PRINTX   MVC   P,SPACES                                                         
         SPACE 1                                                                
XIT      XIT1                                                                   
         EJECT                                                                  
*              STORAGE FOR PROGRAM                                              
         SPACE 3                                                                
DUB      DS    D                                                                
WORK     DS    CL80                                                             
MYWORK   DS    CL16                                                             
DMCB     DS    6F                                                               
RELO     DS    F                                                                
MAX      DC    F'70'                                                            
C        DS    CL80                                                             
PFILL    DS    CL1                                                              
P        DC    CL165' '                                                         
SPACES   DC    CL165' '                                                         
DOCNAME  DC    CL64' '                                                          
CHAPNAME DC    CL64' '                                                          
THISTIT  DC    CL64' '                                                          
LTIT     DC    CL64' '                                                          
RTIT     DC    CL64' '                                                          
TODAY    DC    CL9' '                                                           
TIMENOW  DC    CL5' '                                                           
PANNAME  DC    CL10' '                                                          
CHAP     DC    H'0'                                                             
PAGE     DC    H'1'                                                             
INCOPT   DC    X'80'               DEFAULT IS TO INCLUDE                        
BOTH     DC    C'N'                                                             
LAP      DC    AL1(1)                                                           
COMMAND  DS    CL4                                                              
PRINTOPT DC    C'Y'                                                             
PPOPT    DC    C'Y'                                                             
ALLOW    DC    AL1(0)                                                           
COPIES   DC    AL1(1)                                                           
THISFONT DC    AL1(0)                                                           
LASTINDX DS    CL32                                                             
PANPOPT  DS    CL1                                                              
SUPER    DC    CL64' '                                                          
SAVEWORK DS    CL80                                                             
         EJECT                                                                  
*              LTORG FOR PAN1UP                                                 
         SPACE 3                                                                
         LTORG                                                                  
         EJECT                                                                  
*              MAJOR STORAGE AREAS                                              
         SPACE 3                                                                
         DS    0D                                                               
         DC    C'PAGEPOOL'                                                      
PAGEPOOL DC    F'0'                                                             
         DC    F'140'                                                           
         DC    140XL84'00'                                                      
         SPACE 1                                                                
         DS    0D                                                               
         DC    C'*TOCPOOL'                                                      
TOCPOOL  DC    F'0'                                                             
         DC    F'400'                                                           
         DC    32000C' '                                                        
         SPACE 1                                                                
         DS    0D                                                               
         DC    C'INDXPOOL'                                                      
INDXPOOL DC    F'0'                                                             
         DC    F'1000'                                                          
         DC    80000C' '                                                        
         SPACE 1                                                                
         EJECT                                                                  
       ++INCLUDE DDBIGBOX                                                       
         SPACE 1                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'016DDPAN1UP  05/01/02'                                      
         END                                                                    

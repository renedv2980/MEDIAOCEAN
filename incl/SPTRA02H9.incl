*          DATA SET SPTRA02H9  AT LEVEL 001 AS OF 05/07/09                      
         EJECT                                                                  
*<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
* THIS WAS FOR STARCOM - SO CODE IS NOP!!!!!                                    
*<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
*&&DO                                                                           
*===============================================================                
* GENERATE REPORT OF CMMLS UPDATED OR ADDED TODAY                               
*===============================================================                
                                                                                
PUTCML   NTR1  BASE=*,LABEL=*                                                   
                                                                                
         CLI   PQSW,1              HAS REPORT BEEN OPENED YET?                  
         BNE   *+8                                                              
         BAS   RE,OPNPQ            GO OPEN PRINT FILE                           
                                                                                
         L     R6,AIO                                                           
                                                                                
         MVI   ELCODE,X'F1'                                                     
                                                                                
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING ACTVD,R6                                                         
         CLC   BTODAY,ACTVADDT     ADDED TODAY                                  
         BE    PUTCML10                                                         
         CLC   BTODAY,ACTVCHDT     CHANGED TODAY                                
         NOP   PUTCMLX                                                          
         DROP  R6                                                               
                                                                                
PUTCML10 DS    0H                                                               
         L     R6,AIO1                                                          
         MVI   ELCODE,X'90'        BROADCAST BUSINESS ELEM                      
         BRAS  RE,GETEL                                                         
         BNE   PUTCMLX                                                          
         USING CMLBBEL,R6                                                       
         CLI   CMLBBBAG,C'Y'       BRAND AGENCY (LEO B. OR NOT)                 
         BNE   PUTCMLX                                                          
                                                                                
         LA    R2,FILTABL                                                       
         USING FILTSECT,R2                                                      
         LA    R5,P1                                                            
         ST    R5,SVNEXT                                                        
                                                                                
PUTCML20 DS   0H                                                                
         ZIC   R3,FILTOLN          TO FIELD LEN                                 
         ZIC   R4,FILFRLN          FROM FIELD LEN                               
                                                                                
         L     R5,SVNEXT           GET NEXT ADDR                                
                                                                                
* MOVE FROM P1 TO P2 TO P3 WHEN NEEDED                                          
                                                                                
         LA    RE,P2               START OF SECOND LINE                         
         LA    RF,P3                                                            
                                                                                
         CR    RF,R5               IS THIS AFTER START OF P3                    
         BL    PUTCML24             YES, WILL FINNISH IN P3                     
                                                                                
         LA    R1,4(R3,R5)         ADD 1 + 2 " PLUS 1 BLANK + LEN               
                                                                                
         CR    RE,R5               IS THIS BEFORE P2                            
         BL    PUTCML22             NO, CK IF RUNS OVER P3                      
                                                                                
         CR    R1,RE               IS END BEFORE  P2                            
         BL    PUTCML24                                                         
                                                                                
         LR    R5,RE               START AT P2                                  
         B     PUTCML24                                                         
                                                                                
PUTCML22 DS    0H                                                               
         CR    R1,RF               IS END BEFORE P3                             
         BL    PUTCML24             YES                                         
                                                                                
         LR    R5,RF               START AT P3                                  
                                                                                
PUTCML24 DS    0H                                                               
         L     R6,AIO                                                           
                                                                                
         CLI   FILTEL,0            THIS IN KEY FIELD OR NO FIELD                
         BE    PUTCML26                                                         
                                                                                
         MVC   ELCODE,FILTEL                                                    
         BRAS  RE,GETEL                                                         
         BE    PUTCML26                                                         
                                                                                
         SR    R6,R6                                                            
         B     PUTCML28                                                         
                                                                                
PUTCML26 DS    0H                                                               
         A     R6,FILTFROM                                                      
                                                                                
PUTCML28 DS    0H                                                               
         ICM   RF,15,FILTRTN                                                    
         BZ    PUTCML30                                                         
         A     RF,SPTR02RR         RELOCATE                                     
                                                                                
         BASR  RE,RF                                                            
                                                                                
         B     PUTCML50                                                         
                                                                                
PUTCML30 DS    0H                                                               
         LTR   R6,R6               NO SOURCE ELEM                               
         BZ    PUTCML40                                                         
                                                                                
         MVI   0(R5),C'"'                                                       
         LA    R5,1(,R5)                                                        
         EX    R4,PUTCML34                                                      
                                                                                
         EX    R4,PUTCML36                                                      
                                                                                
* NOW ELIMINATE "                                                               
                                                                                
         LR    RE,R5                                                            
         LR    RF,R3                                                            
         CLI   0(RE),C'"'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         LA    RE,1(,RE)                                                        
         BCT   RF,*-16                                                          
                                                                                
* NOW POINT PAST FIELD AND PUT ENDING " THERE                                   
                                                                                
         LA    R5,0(R3,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,2(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCML50                                                         
                                                                                
PUTCML34 DS    0H                                                               
         MVC   0(0,R5),0(R6)                                                    
PUTCML36 DS    0H                                                               
         OC    0(0,R5),SPACES                                                   
                                                                                
* PUT IN BLANK FIELD FOR MISSING ELEMENT                                        
                                                                                
PUTCML40 DS    0H                                                               
         MVI   0(R5),C'"'                                                       
                                                                                
         LA    R5,1(R3,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,2(,R5)                                                        
         ST    R5,SVNEXT                                                        
                                                                                
PUTCML50 DS    0H                                                               
                                                                                
         LA    R2,FILTNXT                                                       
                                                                                
         CLI   FILTFROM,X'FF'      END OF TABLE                                 
         BNE   PUTCML20             NO, GET NEXT FIELD                          
                                                                                
         L     R5,SVNEXT                                                        
         MVI   1(R5),X'5E'         END OF RECORD CHARACTER                      
                                                                                
         LA    R0,396                                                           
         LA    R1,P1                                                            
         CLI   0(R1),X'4A'         THIS A CENT SIGN                             
         BNE   *+8                                                              
         MVI   0(R1),C' '                                                       
         LA    R1,1(,R1)                                                        
         BCT   R0,*-16                                                          
                                                                                
         GOTO1 SPOOL,DMCB,(R8)                                                  
         MVI   LINE,1                                                           
         AP    CMLFILCT,=P'1'                                                   
                                                                                
* NOW SEE IF P/B COMML                                                          
                                                                                
         L     R6,AIO                                                           
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING CMLDTAEL,R6                                                      
         CLI   CMLSOLO,C'P'        THIS A P/B                                   
         BNE   PUTCMLX              NO BYPASS                                   
         DROP  R6                                                               
                                                                                
         MVI   ELCODE,X'60'        ANY ACTUAL COMMLS                            
         BRAS  RE,NEXTEL                                                        
         BNE   PUTCMLX              NO BYPASS                                   
         LA    R0,116               116*34 = 3944                               
         SR    R1,R1                                                            
         L     R6,AIO                                                           
         L     R5,AIO3                                                          
PUTCML60 DS    0H                                                               
         OC    0(16,R5),0(R5)      EMPTY SLOT                                   
         BZ    PUTCML62                                                         
         LA    R1,1(,R1)                                                        
         LA    R5,34(,R5)                                                       
         BCT   R0,PUTCML60                                                      
         DC    H'0'                                                             
PUTCML62 DS    0H                                                               
         CVD   R1,DUB                                                           
         CP    DUB,CMLPBCT                                                      
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   ELCODE,X'60'                                                     
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
PUTCML64 DS    0H                                                               
         CLC   KEY+3(10),2(R6)       IF EQUAL, BYPASS                           
         BE    PUTCML66                                                         
                                                                                
         MVC   0(10,R5),KEY+3      MOVE BCLT & COMML CODE                       
         MVC   18(8,R5),2(R6)      MOVE IN FIRST ACT COMML                      
         AP    CMLPBCT,=P'1'                                                    
         LA    R5,34(,R5)                                                       
                                                                                
PUTCML66 DS    0H                                                               
         BRAS  RE,NEXTEL                                                        
         BE    PUTCML64                                                         
                                                                                
PUTCMLX  DS    0H                                                               
         XIT1                                                                   
                                                                                
* PUT IN EITHER CLT CML OR CML CODE                                             
                                                                                
PCMCML   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
                                                                                
* IS THERE A CLT CMML                                                           
                                                                                
         OC    CMLCLTNO-CMLKEY(,R6),CMLCLTNO-CMLKEY(R6)                         
         BZ    PCMCML10                                                         
                                                                                
         MVC   1(L'FCML,R5),CMLCLTNO-CMLKEY(R6)                                 
         B     PCMCML20                                                         
                                                                                
PCMCML10 MVC   1(8,R5),CMLKCML-CMLKEY(R6)                                       
                                                                                
PCMCML20 DS   0H                                                                
         OC    1(L'FCML,R5),SPACES                                              
         LA    RE,1(,R5)                                                        
         LA    RF,L'FCML                                                        
         CLI   0(RE),C'"'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         LA    RE,1(,RE)                                                        
         BCT   RF,*-16                                                          
                                                                                
         MVI   1+L'FCML(R5),C'"'                                                
         LA    R5,3+L'FCML(,R5)                                                 
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
* MOVE IN CLIENT CODE                                                           
                                                                                
PCMCLT   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
         MVC   1(2,R5),SVCLTINT                                                 
                                                                                
* ELIMINATE ANY "                                                               
                                                                                
         CLI   1(R5),C'"'                                                       
         BNE   *+8                                                              
         MVI   1(R5),C' '                                                       
         CLI   2(R5),C'"'                                                       
         BNE   *+8                                                              
         MVI   2(R5),C' '                                                       
                                                                                
         MVI   3(R5),C'"'                                                       
         LA    R5,5(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
* MOVE IN COMMERCIAL DESCRIPTION                                                
                                                                                
PCMDSC   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
         USING CMLDTAEL,R6                                                      
         MVC   1(L'CMLTITLE,R5),0(R6)                                           
         DROP  R6                                                               
         L     R6,AIO1                                                          
         MVI   ELCODE,X'30'        OPTIONAL LONGER DESC                         
         BRAS  RE,GETEL                                                         
         BNE   PCMDSC20                                                         
         MVC   1(24,R5),3(R6)                                                   
PCMDSC20 DS   0H                                                                
         OC    1(24,R5),SPACES                                                  
                                                                                
* ELIMINATE ANY "                                                               
                                                                                
         LA    RE,1(,R5)                                                        
         LR    RF,R3                                                            
         CLI   0(RE),C'"'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         LA    RE,1(,RE)                                                        
         BCT   RF,*-16                                                          
                                                                                
         LA    R5,1(R3,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,2(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
* CHANGE LENGTH FROM BINARY TO ZD                                               
                                                                                
PCMLEN   NTR1                                                                   
         ZIC   R0,0(R6)                                                         
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         MVI   0(R5),C'"'                                                       
         UNPK  1(5,R5),DUB                                                      
         MVI   6(R5),C'"'                                                       
         LA    R5,8(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
PCMPRD   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
                                                                                
         MVC   SVKEY,KEY                                                        
                                                                                
         LA    R0,220                                                           
         L     R1,ASVCLIST                                                      
PCMPRD10 DS    0H                                                               
         CLC   2(1,R6),3(R1)                                                    
         BE    PCMPRD20                                                         
         LA    R1,4(,R1)                                                        
         CLI   0(R1),C' '                                                       
         BNH   *+8                                                              
         BCT   R0,PCMPRD10                                                      
         DC    H'0'                                                             
PCMPRD20 DS    0H                                                               
                                                                                
         MVC   1(3,R5),0(R1)                                                    
                                                                                
         MVC   QPRD,0(R1)          SAVE CODE FOR NAME LOOK-UP                   
                                                                                
         MVC   FILENAME(6),=C'SPTDIR'                                           
                                                                                
         XC    KEY,KEY                                                          
         MVC   KEY+1(3),SVKEY+2    MOVE IN A/M, BCLT                            
         MVC   KEY+4(3),QPRD                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R6,AIO2                                                          
         ST    R6,AIO                                                           
                                                                                
         MVC   FILENAME(6),=C'SPTFIL'                                           
                                                                                
         GOTO1 GETREC                                                           
                                                                                
         XC    FILENAME,FILENAME                                                
         MVC   AIO,AIO1                                                         
                                                                                
         USING PRDHDRD,R6                                                       
                                                                                
         MVC   1(3,R5),PACCT                                                    
                                                                                
* ELIMINATE ANY "                                                               
                                                                                
         LA    RE,1(,R5)                                                        
         LR    RF,R3                                                            
         CLI   0(RE),C'"'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         LA    RE,1(,RE)                                                        
         BCT   RF,*-16                                                          
                                                                                
         MVI   4(R5),C'"'                                                       
         LA    R5,6(,R5)                                                        
         ST    R5,SVNEXT                                                        
         MVC   KEY,SVKEY                                                        
                                                                                
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    PUTCMLX                                                          
         DC    H'0'                                                             
         DROP  R6                                                               
                                                                                
* GET PRODUCT NAME                                                              
                                                                                
PCMPNM   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
                                                                                
         MVC   SVKEY,KEY                                                        
         L     R6,AIO2                                                          
         USING PRDHDRD,R6                                                       
         MVC   1(L'FPRODSC,R5),PNAME                                            
         OC    1(L'FPRODSC,R5),SPACES                                           
                                                                                
* ELIMINATE ANY "                                                               
                                                                                
         LA    RE,1(,R5)                                                        
         LA    RF,L'FPRODSC                                                     
         CLI   0(RE),C'"'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         LA    RE,1(,RE)                                                        
         BCT   RF,*-16                                                          
                                                                                
         MVI   1+L'FPRODSC(R5),C'"'                                             
         LA    R5,2+1+L'FPRODSC(R5)                                             
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
         DROP  R6                                                               
                                                                                
* MOVE IN MEDIA                                                                 
                                                                                
PCMMED   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
         MVC   1(1,R5),QMED                                                     
         MVI   2(R5),C'"'                                                       
         LA    R5,4(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
* CONVERT DATES FROM BINARY - PUT OUT AS MM/DD/YYYY                             
                                                                                
PCMDTE   NTR1                                                                   
         LTR   R6,R6               IF ZERO, NO ELEM, NO DATA                    
         BZ    PCMDTE10            NO, DO DEFAULT                               
                                                                                
         OC    0(3,R6),0(R6)      IS THERE A DATE PRESENT?                      
         BZ    PCMDTE10            NO, DO DEFAULT                               
                                                                                
         CLC   =X'FFFFFF',0(R6)    THIS UFN                                     
         BE    PCMDTE10             YES, DO DEFAULT                             
                                                                                
         GOTO1 DATCON,DMCB,(3,(R6)),(23,WORK)                                   
                                                                                
* CONVERTS BINARY TO YYYY-MM-DA                                                 
                                                                                
         MVI   0(R5),C'"'                                                       
         MVC   1(2,R5),WORK+5                                                   
         MVI   3(R5),C'/'                                                       
         MVC   4(2,R5),WORK+8                                                   
         MVI   6(R5),C'/'                                                       
         MVC   7(4,R5),WORK                                                     
         MVI   11(R5),C'"'                                                      
         LA    R5,13(,R5)                                                       
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
PCMDTE10 DS   0H                                                                
         MVC   0(12,R5),=C'"00/00/0000"'                                        
         LA    R5,13(,R5)                                                       
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
* GET VARIABLE LENGTH INACTIVE REASON                                           
                                                                                
PCMIRC   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
                                                                                
         LTR   R6,R6               NO ELEM FOUND?                               
         BZ    PCMIRC10                                                         
         LR    RE,R6               GET FROM ADDR                                
         BCTR  RE,0                BACK UP TO ELEM LEN                          
         ZIC   RF,0(RE)                                                         
         AHI   RF,-3     SUBTRACT 2 + 1 FOR MOVE                                
                                                                                
         CHI   RF,L'FINACTRS       IF REASON CODE TOO LONG                      
         BL    *+8                                                              
         LA    RF,L'FINACTRS-1                                                  
         EX    RF,PCMIRCM                                                       
                                                                                
* ELIMINATE ANY "                                                               
                                                                                
PCMIRC10 DS    0H                                                               
         LA    RE,1(,R5)                                                        
         LA    RF,L'FINACTRS                                                    
         CLI   0(RE),C'"'                                                       
         BNE   *+8                                                              
         MVI   0(RE),C' '                                                       
         LA    RE,1(,RE)                                                        
         BCT   RF,*-16                                                          
                                                                                
         LA    R5,1(R3,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,2(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
PCMIRCM  MVC   1(0,R5),0(R6)       MOVE REASON                                  
                                                                                
                                                                                
* GET BRAND AGENCY                                                              
                                                                                
PCMBAG   NTR1                                                                   
         MVI   0(R5),C'"'                                                       
                                                                                
         LTR   R6,R6               NO ELEM FOUND?                               
         BZ    PCMBAG10                                                         
                                                                                
         CLI   0(R6),C'Y'          IS BRAND AGENCY = Y                          
         BNE   PCMBAG10             NO, SEND NOTHING                            
         MVC   1(3,R5),=C'   '                                                  
*        MVC   1(3,R5),=C'YES'                                                  
                                                                                
PCMBAG10 DS    0H                                                               
         LA    R5,1(R3,R5)                                                      
         MVI   0(R5),C'"'                                                       
         LA    R5,2(,R5)                                                        
         ST    R5,SVNEXT                                                        
         B     PUTCMLX                                                          
                                                                                
* ENTRIES ARE:                                                                  
*         4    FROM LABEL - DISP INTO INPUT ELEM                                
*         4    TO LABEL                                                         
*         4    OPTIONAL RTN ADDRESS                                             
*         1    FROM ELEMENT - ZERO = USE KEY DISPLACEMENT                       
*         1    FROM LENGTH                                                      
*         1    TO FIELD LENGTH                                                  
*         1    SPARE                                                            
                                                                                
FILTABL  DS    0D                                                               
         DC    A(0),A(FCML-CMLFILE),A(PCMCML),X'00'                             
         DC    AL1(7),AL1(L'FCML),X'00'                                         
                                                                                
         DC    A(0),A(FCLTCD-CMLFILE),A(PCMCLT),X'00'                           
         DC    AL1(L'FCLTCD-1),AL1(L'FCLTCD),X'00'                              
                                                                                
         DC    A(CMLTITLE-CMLDTAEL),A(FCMLTITL-CMLFILE),A(PCMDSC),X'10'         
         DC    AL1(14),AL1(L'FCMLTITL),X'00'                                    
                                                                                
* COMMERCIAL LENGTH                                                             
                                                                                
         DC    A(CMLSLN-CMLDTAEL),A(FCMLEN-CMLFILE),A(PCMLEN),X'10'             
         DC    AL1(4),AL1(L'FCMLEN),X'00'                                       
                                                                                
* PRODUCTION JOB #                                                              
                                                                                
         DC    A(CMLBBJOB-CMLBBEL),A(FPRODNO-CMLFILE),A(0),X'90'                
         DC    AL1(L'FPRODNO-1),AL1(L'FPRODNO),X'00'                            
                                                                                
* PRODUCT CODE                                                                  
                                                                                
         DC    A(0),A(FPRODCD-CMLFILE),A(PCMPRD),X'20'                          
         DC    AL1(2),AL1(3),X'00'                                              
                                                                                
* PRODUCT DESC                                                                  
                                                                                
         DC    A(0),A(FPRODSC-CMLFILE),A(PCMPNM),X'00'                          
         DC    AL1(L'FPRODSC-1),AL1(L'FPRODSC),X'00'                            
                                                                                
* BASIC ISCI - (SAG/AFTRA)                                                      
                                                                                
         DC    A(CMLBBBCP-CMLBBEL),A(FSAGISCI-CMLFILE),A(0),X'90'               
         DC    AL1(L'FSAGISCI-1),AL1(L'FSAGISCI),X'00'                          
                                                                                
* AFM ISCI - (AFM)                                                              
                                                                                
         DC    A(CMLBBBCM-CMLBBEL),A(FAFMISCI-CMLFILE),A(0),X'90'               
         DC    AL1(L'FAFMISCI-1),AL1(L'FAFMISCI),X'00'                          
                                                                                
* MEDIA                                                                         
                                                                                
         DC    A(0),A(FCMLMED-CMLFILE),A(PCMMED),X'00'                          
         DC    AL1(0),AL1(L'FCMLMED),X'00'                                      
                                                                                
* COMMERCIAL TYPE                                                               
                                                                                
         DC    A(CMLTYPE-CMLDTAEL),A(FPRODFMT-CMLFILE),A(0),X'10'               
         DC    AL1(L'FPRODFMT-1),AL1(L'FPRODFMT),X'00'                          
                                                                                
* FIRST FILM  DATE PRODUCTION DATE (WAS RELEASE DATE)                           
                                                                                
         DC    A(CMLBBPDT-CMLBBEL),A(FFRSTDTE-CMLFILE),A(PCMDTE),X'90'          
         DC    AL1(0),AL1(L'FACTDATE),X'00'                                     
                                                                                
* CLIENT APPROVAL DATE                                                          
                                                                                
         DC    A(CMLBBCAD-CMLBBEL),A(FAPRVDTE-CMLFILE),A(PCMDTE),X'90'          
         DC    AL1(0),AL1(L'FAPRVDTE),X'00'                                     
                                                                                
* MAX USE DATE                                                                  
                                                                                
         DC    A(CMLBBMXD-CMLBBEL),A(FMPUDATE-CMLFILE),A(PCMDTE),X'90'          
         DC    AL1(0),AL1(L'FMPUDATE),X'00'                                     
                                                                                
* RELEASE DATE = ACTIVE FILM DATE                                               
                                                                                
         DC    A(CMLRLSE-CMLDTAEL),A(FACTDATE-CMLFILE),A(PCMDTE),X'10'          
         DC    AL1(0),AL1(L'FACTDATE),X'00'                                     
                                                                                
* RECALL DATE = INACTIVE FILM DATE                                              
                                                                                
         DC    A(CMLRCL-CMLDTAEL),A(FINACTDT-CMLFILE),A(PCMDTE),X'10'           
         DC    AL1(0),AL1(L'FINACTDT),X'00'                                     
                                                                                
* INACTIVE REASON CODE                                                          
                                                                                
         DC    A(CMLINRSN-CMLINAEL),A(FINACTRS-CMLFILE),A(PCMIRC),X'92'         
         DC    AL1(0),AL1(L'FINACTRS),X'00'                                     
                                                                                
* BRAND AGENCY CODE                                                             
                                                                                
         DC    A(CMLBBBAG-CMLBBEL),A(FBRDAGY-CMLFILE),A(PCMBAG),X'90'           
         DC    AL1(L'CMLBBBAG-1),AL1(L'FBRDAGY),X'00'                           
         DC    X'FF'                                                            
         DROP  RB,R2                                                            
         EJECT                                                                  
* OPEN PRINT QUEUE FOR FILE DOWN LOAD                                           
                                                                                
OPNPQ    NTR1  BASE=*,LABEL=*                                                   
                                                                                
         XC    SPECS,SPECS                                                      
         XC    HEADHOOK,HEADHOOK                                                
                                                                                
         LA    R1,ELEM                                                          
         ST    R1,SPOOLQLK                                                      
         XC    ELEM(128),ELEM                                                   
         USING PQPLD,R1                                                         
         MVI   QLCLASS,C'Z'                                                     
****     MVI   QLRETND+1,12                                                     
         MVI   QLEXTRA,X'FF'       NEW PARM LIST                                
         OI    SPOOLIND,X'40'      USER VALUES PRESENT                          
         MVI   REQRTYP,REQTDOWN    SET TYPE AS DOWNLOAD                         
                                                                                
         MVC   REMUSER,=C'FTL'                                                  
                                                                                
         MVC   CONOUT(4),=C'DOWN'                                               
         MVI   CONOUTH+5,4                                                      
         OI    CONOUTH+6,X'80'                                                  
                                                                                
         MVC   QLDESC(1),QMED                                                   
         MVC   QLDESC+2(3),QCLT                                                 
                                                                                
         GOTO1 OPENPQ                                                           
                                                                                
         TM    WHEN,X'40'          IF WHEN = NOW PRINT FAKE REQUEST             
         BZ    OPNPQX                                                           
                                                                                
         MVC   P+5(30),=30C'*'                                                  
         MVI   P2+5,C'*'                                                        
         MVC   P2+10(20),=C'PRINT TO FORCE PIANO'                               
         MVC   P3+5(30),=30C'*'                                                 
         GOTO1 SPOOL,DMCB,(R8)                                                  
         MVI   FORCEHED,C'Y'                                                    
         MVI   P,0                                                              
         GOTO1 SPOOL,DMCB,(R8)                                                  
                                                                                
*        GOTO1 REQTWA,DMCB,(3,ATWA),0,VPRINT,(C'B',AIO3)                        
                                                                                
OPNPQX   DS    0H                                                               
         XIT1                                                                   
         DROP  RB                                                               
         EJECT                                                                  
* PUT OUT LAST REPORT(S)                                                        
                                                                                
PUTREP   NTR1  BASE=*,LABEL=*                                                   
                                                                                
* CLOSE  PRINT FILE REPORT                                                      
                                                                                
         MVI   SPMODE,X'FF'                                                     
         MVI   PQSW,X'FF'                                                       
         GOTO1 SPOOL,DMCB,(R8)    FORCE CLOSE OF SPOOL                          
         MVI   PQSW,1                                                           
                                                                                
         CLI   OFFLINE,C'Y'        OFFLINE, FORCE SEPARATE ENTRY                
         BNE   PUTREP10             NO, NOT NEEDED                              
                                                                                
         ICM   R4,15,TWAMASTC                                                   
         BNZ   *+6                                                              
         DC    H'0'                                                             
                                                                                
         L     R6,MCVREMOT-MASTD(,R4)                                           
         USING REMOTED,R6                                                       
                                                                                
         MVI   REMOTSUB,C'A'                                                    
         DROP  R6                                                               
                                                                                
PUTREP10 DS    0H                                                               
         MVI   PQSW,1                                                           
         BRAS  RE,OPNPQ            GO OPEN PRINT FILE                           
                                                                                
         TM    WHEN,X'40'          IF WHEN NOT NOW PRINT FAKE REQUEST           
         BO    PUTREP20             NOW DONE IN OPNPQ RTN                       
                                                                                
         MVC   P+5(30),=30C'*'                                                  
         MVI   P2+5,C'*'                                                        
         MVC   P2+10(20),=C'PRINT TO FORCE PIANO'                               
         MVC   P3+5(30),=30C'*'                                                 
         GOTO1 SPOOL,DMCB,(R8)                                                  
         MVI   FORCEHED,C'Y'                                                    
         MVI   P,0                                                              
         GOTO1 SPOOL,DMCB,(R8)                                                  
PUTREP20 DS    0H                                                               
         MVI   P,C'"'                                                           
         GOTO1 DATCON,DMCB,(5,0),(X'20',P+1)                                    
         MVI   P+7,C'"'                                                         
                                                                                
         MVI   P+9,C'"'                                                         
         MVI   P+10,C'|'                                                        
         MVI   P+11,C'"'                                                        
                                                                                
         MVI   P+13,C'"'                                                        
         MVC   P+14(8),=C'COMMERCI'                                             
         MVI   P+22,C'"'                                                        
                                                                                
         MVI   P+24,C'"'                                                        
         MVI   P+25,C'|'                                                        
         MVI   P+26,C'"'                                                        
                                                                                
         MVI   P+28,C'"'                                                        
         OI    CMLFILCT+2,X'0F'                                                 
         UNPK  P+29(6),CMLFILCT                                                 
         MVI   P+35,C'"'                                                        
         MVI   P+38,X'5E'                                                       
                                                                                
         GOTO1 SPOOL,DMCB,(R8)                                                  
                                                                                
* CLOSE  CML TOTALS FILE REPORT                                                 
                                                                                
         MVI   SPMODE,X'FF'                                                     
         MVI   PQSW,X'FF'                                                       
         GOTO1 SPOOL,DMCB,(R8)    FORCE CLOSE OF SPOOL                          
         MVI   PQSW,1                                                           
                                                                                
         CLI   OFFLINE,C'Y'        OFFLINE, FORCE SEPARATE ENTRY                
         BNE   PUTREP30             NO, NOT NEEDED                              
                                                                                
         ICM   R4,15,TWAMASTC                                                   
         BNZ   *+6                                                              
         DC    H'0'                                                             
                                                                                
* OPEN DIRECT ENTRY (WHICH WILL BE LOST)  TO PRESERVE REAL QUE ENTRY *          
                                                                                
         L     R6,MCVREMOT-MASTD(,R4)                                           
         USING REMOTED,R6                                                       
         MVI   REMOTSUB,C'B'                                                    
                                                                                
         DROP  R6                                                               
PUTREP30 DS    0H                                                               
         MVI   PQSW,1                                                           
                                                                                
         CP    CMLPBCT,=P'0'       ANY P/B TO REPORT                            
         BE    PUTREP60                                                         
                                                                                
         BRAS  RE,OPNPQ            GO OPEN PRINT FILE                           
                                                                                
         TM    WHEN,X'40'          IF WHEN NOT NOW PRINT FAKE REQUEST           
         BO    PUTREP40             NOW DONE IN OPNPQ RTN                       
                                                                                
         MVC   P+5(30),=30C'*'                                                  
         MVI   P2+5,C'*'                                                        
         MVC   P2+10(20),=C'PRINT TO FORCE PIANO'                               
         MVC   P3+5(30),=30C'*'                                                 
         GOTO1 SPOOL,DMCB,(R8)                                                  
         MVI   FORCEHED,C'Y'                                                    
         MVI   P,0                                                              
         GOTO1 SPOOL,DMCB,(R8)                                                  
PUTREP40 DS    0H                                                               
         ZAP   DUB,CMLPBCT                                                      
         CVB   R0,DUB                                                           
         L     R4,AIO3                                                          
PUTREP50 DS    0H                                                               
         MVI   P,C'"'                                                           
         MVC   P+1(16),2(R4)                                                    
         MVI   P+17,C'"'                                                        
         MVI   P+19,C'"'                                                        
         MVC   P+20(16),18(R4)                                                  
         MVI   P+36,C'"'                                                        
                                                                                
* BUILD KEY FOR COMML REC                                                       
                                                                                
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING CMLKEY,R6                                                        
         MVC   CMLKID,=X'0A21'                                                  
         MVC   CMLKAM(1),BAGYMD    A/M                                          
         MVC   CMLKCLT(2),0(R4)    BCLT                                         
         MVC   CMLKCML,2(R4)                                                    
                                                                                
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         L     R6,AIO1                                                          
         ST    R6,AIO                                                           
         GOTO1 GETREC                                                           
                                                                                
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         OC    CMLCLTNO-CMLDTAEL(,R6),CMLCLTNO-CMLDTAEL(R6)                     
         BZ    *+10                                                             
         MVC   P+1(16),CMLCLTNO-CMLDTAEL(R6)                                    
                                                                                
* NOW DO SAME TO ACT COMML                                                      
                                                                                
         LA    R6,KEY                                                           
         MVC   CMLKCML,18(R4)                                                   
                                                                                
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE                                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  R6                                                               
         L     R6,AIO1                                                          
         GOTO1 GETREC                                                           
                                                                                
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         OC    CMLCLTNO-CMLDTAEL(,R6),CMLCLTNO-CMLDTAEL(R6)                     
         BZ    *+10                                                             
         MVC   P+20(16),CMLCLTNO-CMLDTAEL(R6)                                   
                                                                                
         GOTO1 SPOOL,DMCB,(R8)                                                  
                                                                                
         LA    R4,34(,R4)                                                       
         BCT   R0,PUTREP50                                                      
                                                                                
* CLOSE  CML TOTALS FILE REPORT                                                 
                                                                                
         MVI   SPMODE,X'FF'                                                     
         MVI   PQSW,X'FF'                                                       
         GOTO1 SPOOL,DMCB,(R8)    FORCE CLOSE OF SPOOL                          
         MVI   PQSW,1                                                           
                                                                                
         CLI   OFFLINE,C'Y'        OFFLINE, FORCE SEPARATE ENTRY                
         BNE   PUTREP60             NO, NOT NEEDED                              
                                                                                
         ICM   R4,15,TWAMASTC                                                   
         BNZ   *+6                                                              
         DC    H'0'                                                             
                                                                                
* OPEN DIRECT ENTRY (WHICH WILL BE LOST)  TO PRESERVE REAL QUE ENTRY *          
                                                                                
         L     R6,MCVREMOT-MASTD(,R4)                                           
         USING REMOTED,R6                                                       
         MVI   REMOTSUB,C'C'                                                    
                                                                                
         DROP  R6                                                               
PUTREP60 DS    0H                                                               
         MVI   PQSW,1                                                           
         BRAS  RE,OPNPQ            GO OPEN PRINT FILE                           
                                                                                
         TM    WHEN,X'40'          IF WHEN NOT NOW PRINT FAKE REQUEST           
         BO    PUTREP70             NOW DONE IN OPNPQ RTN                       
                                                                                
         MVC   P+5(30),=30C'*'                                                  
         MVI   P2+5,C'*'                                                        
         MVC   P2+10(20),=C'PRINT TO FORCE PIANO'                               
         MVC   P3+5(30),=30C'*'                                                 
         GOTO1 SPOOL,DMCB,(R8)                                                  
         MVI   FORCEHED,C'Y'                                                    
         MVI   P,0                                                              
         GOTO1 SPOOL,DMCB,(R8)                                                  
                                                                                
PUTREP70 DS    0H                                                               
         MVI   P,C'"'                                                           
         GOTO1 DATCON,DMCB,(5,0),(X'20',P+1)                                    
         MVI   P+7,C'"'                                                         
                                                                                
         MVI   P+9,C'"'                                                         
         MVI   P+10,C'|'                                                        
         MVI   P+11,C'"'                                                        
                                                                                
         MVI   P+13,C'"'                                                        
         MVC   P+14(8),=C'PIGGY   '                                             
         MVI   P+22,C'"'                                                        
                                                                                
         MVI   P+24,C'"'                                                        
         MVI   P+25,C'|'                                                        
         MVI   P+26,C'"'                                                        
                                                                                
         MVI   P+28,C'"'                                                        
         OI    CMLPBCT+2,X'0F'                                                  
         UNPK  P+29(6),CMLPBCT                                                  
         MVI   P+35,C'"'                                                        
         MVI   P+38,X'5E'                                                       
         GOTO1 SPOOL,DMCB,(R8)                                                  
                                                                                
PUTREPX  DS    0H                                                               
         XIT1                                                                   
         LTORG                                                                  
         DROP  RB                                                               
*&&                                                                             
         EJECT                                                                  
*&&DO                                                                           
*<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
* THIS WAS FOR STARCOM - NOP THIS CODE !!!!!                                    
* (NOPPED FROM DRLEGAL TO FREFCML)                                              
*<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
* DISPLAY LEGAL SCREEN                                                          
                                                                                
DRLEGAL  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         CLI   TWASCR,X'9F'        IS LEGAL SCREEN LOADED ALREADY               
         BE    DRL20                YES                                         
                                                                                
         XC    DMCB(24),DMCB                                                    
         LA    RE,CONTAGH                                                       
         ST    RE,DMCB                                                          
         MVI   DMCB,X'9F'                                                       
         GOTO1 CALLOV,DMCB                                                      
         CLI   4(R1),X'FF'                                                      
         BNE   *+6                                                              
         DC    H'0'                                                             
                                                                                
         MVI   TWASCR,X'9F'                                                     
         MVC   CONREC(6),=C'LCOMML'                                             
         MVC   CONACT(7),=C'DISPLAY'                                            
         BRAS  RE,SETPFK                                                        
                                                                                
         LA    R2,CONHEADH                                                      
                                                                                
DRL10    OI    6(R2),X'80'         TURN ON TRANSMIT BITS                        
                                                                                
         ZIC   R1,0(R2)                                                         
         AR    R2,R1               BUMP                                         
                                                                                
         CLI   0(R2),0                                                          
         BNE   DRL10                                                            
                                                                                
         MVC   1(2,R2),=X'0101'    POP IN INDICATORS                            
                                                                                
* RE-DISPLAY MEDIA/CLIENT/COMMERCIAL                                            
                                                                                
         MVC   TRAMED(L'QMED),QMED                                              
         OI    TRAMEDH+6,X'80'                                                  
                                                                                
         MVC   TRACLT(L'QCLT),QCLT                                              
         OI    TRACLTH+6,X'80'                                                  
                                                                                
         MVC   TRACML(L'HOLDCML),HOLDCML                                        
         OI    TRACMLH+6,X'80'                                                  
                                                                                
         OI    TRLLCMTH+6,X'40'    CURSOR POSITION                              
                                                                                
* LEGAL COMMENTS                                                                
                                                                                
DRL20    L     R6,AIO                                                           
         LA    R2,TRLLCMTH         COMMENT FIELD                                
         LA    R0,TRLLCMXH                                                      
                                                                                
         MVI   ELCODE,X'70'                                                     
         BRAS  RE,GETEL                                                         
         BAS   RE,DCOMMENT         DISPLAY COMMENTS                             
                                                                                
* SCHEDULING RESTRICTIONS                                                       
                                                                                
         L     R6,AIO                                                           
         LA    R2,TRLSCMTH         SCHEDULING COMMENT FIELD                     
         LA    R0,TRLSCMXH         LAST SCHEDULING COMMENT FLD                  
                                                                                
         MVI   ELCODE,X'80'                                                     
         BRAS  RE,GETEL                                                         
         BAS   RE,DCOMMENT         DISPLAY COMMENTS                             
                                                                                
         L     R6,AIO                                                           
                                                                                
         XC    TRLATA,TRLATA       CLEAR APPROVED TO AIR                        
         OI    TRLATAH+6,X'80'     TRANSMIT                                     
                                                                                
         MVI   ELCODE,X'90'        BROADCAST BUSINESS ELEM                      
         BRAS  RE,GETEL                                                         
         BNE   DRLX                                                             
                                                                                
         USING CMLBBEL,R6                                                       
                                                                                
         MVC   TRLATA(L'CMLATAIR),CMLATAIR   APPROVED TO AIR                    
*                                                                               
* ZERO INTENSITY NETWORK FIELDS ON THE SCREEN                                   
* (ONLY NEEDED FOR NET TRAFFIC COMMERCIAL RECORDS)                              
*                                                                               
DRLX     DS    0H                                                               
         LA    R2,TRLATAH          APPROVED TO AIR FIELD                        
         LA    R0,TRLTAGH          END OF SCREEN                                
                                                                                
DRLX20   ZIC   RF,0(R2)            GET FIELD LENGTH                             
         AR    R2,RF               PROTECTED TITLE FIELD (ABC,CBS....)          
         CR    R2,R0               CK IF END OF SCREEN                          
         BNL   DRLX30               YES, DONE                                   
                                                                                
         OI    6(R2),X'0C'         ZERO INTENSITY                               
         OI    6(R2),X'80'         TRANSMIT                                     
                                                                                
         ZIC   RF,0(R2)            GET FIELD LENGTH                             
         AR    R2,RF               BUMP TO UNPROTECTED INPUT FIELD              
                                                                                
         OI    1(R2),X'20'         PROTECT THIS FIELD                           
         OI    6(R2),X'80'         TRANSMIT                                     
         B     DRLX20                                                           
                                                                                
DRLX30   OI    TRLLCMTH+1,X'01'    MODIFIED                                     
         OI    TRLLCMTH+6,X'80'    TRANSMIT                                     
         XIT1                                                                   
         EJECT                                                                  
                                                                                
* DISPLAY COMMENTS (IF ANY)                                                     
* (ON ENTRY R2=1ST COMMENT FIELD, R0=LAST COMMENT FIELD)                        
                                                                                
DCOMMENT NTR1                                                                   
         BNE   DCOM30              NO MORE ELEMENTS                             
                                                                                
DCOM05   ZIC   RE,1(R6)            GET ELEM LEN                                 
                                                                                
DCOM10   AHI   RE,-4               GET COMMENT LENGTH -1                        
                                                                                
         ZIC   RF,0(R2)            GET FIELD LENGTH                             
         LR    R1,RF                                                            
         AHI   RF,-9               GET FIELD LENGTH -1                          
                                                                                
         LTR   RF,RF               TRAP, IF NEGATIVE                            
         BP    *+6                                                              
         DC    H'0'                THEN DIE                                     
                                                                                
         EX    RF,DRLCLR           CLEAR OUTPUT FLD                             
                                                                                
         CR    RF,RE               COMPARE FIELD LEN TO COMMENT LEN             
         BNL   *+6                                                              
         DC    H'0'                WHAT? COMMENT IS LONGER THAN FIELD           
                                                                                
         EX    RE,DRLMVC           MOVE COMMENT TO FIELD                        
                                                                                
         OI    6(R2),X'80'         SET ON TRANSMIT BIT                          
                                                                                
         AR    R2,R1               POINT TO NEXT FIELD                          
                                                                                
         BRAS  RE,NEXTEL                                                        
         BNE   DCOM30                                                           
                                                                                
         CR    R2,R0               PAST LAST LINE OF COMMENT?                   
         BNH   DCOM05                                                           
         DC    H'0'                WHAT MORE THAN 5 LINES OF COMMENT?           
                                                                                
DCOM30   ZIC   RF,0(R2)            GET FIELD LENGTH                             
         LR    R1,RF                                                            
         AHI   RF,-9               GET FIELD LENGTH -1                          
                                                                                
         CR    R2,R0               PAST DESIRED END?                            
         BH    DCOMX                                                            
                                                                                
         LTR   RF,RF               TRAP, IF NEGATIVE                            
         BP    *+6                                                              
         DC    H'0'                THEN DIE                                     
                                                                                
         EX    RF,DRLCLR           CLEAR FIELD                                  
         OI    6(R2),X'80'         SET ON TRANSMIT BIT                          
         AR    R2,R1               POINT TO NEXT FIELD                          
         B     DCOM30                                                           
                                                                                
DCOMX    XIT1                                                                   
                                                                                
DRLMVC   MVC   8(0,R2),3(R6)       COMMENT                                      
DRLCLR   XC    8(0,R2),8(R2)       CLEAR FIELD                                  
                                                                                
         LTORG                                                                  
         DROP  RB                                                               
         EJECT                                                                  
* VALIDATE RECORD (BROADCAST BUSINESS SCREEN)                                   
                                                                                
VRBROAD  NTR1  BASE=*,LABEL=*                                                   
                                                                                
         LA    R2,TRBBAGYH         BRAND AGY (LEO B. - Y/N)                     
         GOTO1 ANY                                                              
                                                                                
         MVI   SVATOAIR,0          INIT APPROVED TO AIR                         
                                                                                
         LA    R2,TRBREFH                                                       
                                                                                
         CLI   TRBBAPP,C'Y'        BROADCST BUSINESS APPROVAL ?                 
         BE    VRB02                YES                                         
         CLI   5(R2),0             ANY REFERENCE #                              
         BE    VRB05                                                            
         B     REFNOERR            REFERENCE SHOULD BE BLANK                    
                                                                                
VRB02    GOTO1 ANY                 REFERENCE IS REQUIRED                        
                                                                                
         BAS   RE,FREFCML          FIND REFERENCED (CML)                        
         BNE   CMLERR              ERROR, NO SUCH CML                           
                                                                                
VRB05    L     R6,AIO                                                           
         MVI   ELCODE,X'90'        BROADCAST BUSINESS ELEM                      
         BRAS  RE,GETEL                                                         
         BNE   VRB10               DISPLAY DEFAULTS                             
                                                                                
         USING CMLBBEL,R6                                                       
         MVC   SVATOAIR,CMLATAIR   SAVE APPROVED TO AIR                         
                                                                                
VRB10    L     R6,AIO                                                           
         MVI   ELCODE,X'90'        BROADCAST BUSINESS ELEM                      
         XC    ELEM,ELEM                                                        
         GOTO1 REMELEM                                                          
         LA    R6,ELEM                                                          
                                                                                
         MVI   CMLBBEL,X'90'       BROADCAST BUSINESS ELEMENT                   
         MVI   CMLBBLN,CMLBBX-CMLBBEL   ELEMENT LENGTH FOR ADD                  
                                                                                
         MVC   CMLBBBCP,TRBPCML    BASIC CODE (PARENT CML)                      
         MVC   CMLBBBCM,TRBBCDE    BASIC CODE (MUSIC)                           
         MVC   CMLBBBAG,TRBBAGY    BRAND AGY (LEO B. - Y/N)                     
         MVC   CMLBBJOB,TRBJOBN    JOB NUMBER                                   
         MVC   CMLBBAPR,TRBBAPP    BROADCST BUSINESS APPROVAL                   
         MVC   CMLBBREF,TRBREF     REFERENCE #                                  
         MVC   CMLATAIR,SVATOAIR   APPROVED TO AIR                              
                                                                                
         XC    CMLBBPDT,CMLBBPDT                                                
         LA    R2,TRBPRDTH                                                      
         CLI   5(R2),0             PRODUCTION DATE ENTERED ?                    
         BE    VRB15                                                            
                                                                                
         GOTO1 DATVAL,DMCB,(0,TRBPRDT),DATE                                     
         OC    DMCB(4),DMCB                                                     
         BZ    DATERRB                                                          
                                                                                
         GOTO1 DATCON,DMCB,(0,DATE),(3,CMLBBPDT)                                
                                                                                
VRB15    XC    CMLBBCAD,CMLBBCAD                                                
         LA    R2,TRBCADTH            CLIENT APPROVAL DATE                      
         CLI   5(R2),0                                                          
         BE    VRB20                                                            
                                                                                
         GOTO1 DATVAL,DMCB,(0,TRBCADT),DATE                                     
         OC    DMCB(4),DMCB                                                     
         BZ    DATERRB                                                          
                                                                                
         GOTO1 DATCON,DMCB,(0,DATE),(3,CMLBBCAD)                                
                                                                                
VRB20    DS    0H                                                               
         XC    CMLBBMXD,CMLBBMXD   INIT MAX USE DATE                            
         LA    R2,TRBMDTEH                                                      
                                                                                
         CLI   5(R2),0             DATE ENTERED                                 
         BNE   *+12                                                             
         CLI   TRBBAGY,C'Y'        IS BRAND AGY=Y                               
         BNE   VRB25                NO                                          
                                                                                
         GOTO1 ANY                 MAX USE DATE ENTERED ?                       
                                                                                
         GOTO1 DATVAL,DMCB,(0,TRBMDTE),DATE                                     
         OC    DMCB(4),DMCB                                                     
         BZ    DATERRB                                                          
                                                                                
         GOTO1 DATCON,DMCB,(0,DATE),(3,CMLBBMXD)                                
                                                                                
VRB25    GOTO1 ADDELEM                                                          
                                                                                
         MVI   ELCODE,X'92'        INACTIVE DATA ELEM                           
         XC    ELEM,ELEM                                                        
         GOTO1 REMELEM                                                          
         LA    R6,ELEM                                                          
                                                                                
         USING CMLINAEL,R6                                                      
                                                                                
         MVI   CMLINAEL,X'92'      INACTIVE DATA ELEMENT                        
                                                                                
         CLI   TRBIRSNH+5,0        INACTIVE RSN ENTERED ?                       
         BE    VRB50                                                            
                                                                                
         LA    R2,TRBIRSNH         RSN INACTIVE                                 
         GOTO1 ANY                                                              
                                                                                
         ZIC   R1,5(R2)            INPUT LENGTH                                 
         LR    RE,R1                                                            
         AHI   R1,-1               MINUS 1                                      
                                                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   CMLINRSN(0),WORK                                                 
                                                                                
         AHI   RE,2                INPUT LEN (LEN/ELCODE)                       
         STC   RE,CMLINLN          TOTAL ELEMENT LENGTH                         
                                                                                
         GOTO1 ADDELEM                                                          
                                                                                
VRB50    LA    R2,TRBRSNH                                                       
                                                                                
         CLI   5(R2),0             REASON ?                                     
         BE    VRBX                                                             
                                                                                
         GOTO1 DATCON,DMCB,(5,0),(3,SVTODAY)  TODAY'S DATE                      
         XC    SVTODAY(3),=X'FFFFFF'  XC FOR LIFO                               
                                                                                
         MVI   BYTE,X'FF'          INIT REASON NUMBER                           
                                                                                
         L     R6,AIO                                                           
         USING CMLRSNEL,R6                                                      
                                                                                
         MVI   ELCODE,X'95'        REASON DATA ELEMENT                          
         BRAS  RE,GETEL                                                         
         BNE   VRB60                                                            
                                                                                
         CLC   CMLRSNDT,SVTODAY    COMPARE DATE IN ELEM TO TODAY                
         BNE   VRB60               NO, DONE                                     
                                                                                
         GOTO1 ANY                                                              
                                                                                
         ZIC   R1,CMLRSNN          LAST  REASON NUMBER USED                     
         AHI   R1,-1               NEXT NUMBER TO USE                           
         STC   R1,BYTE                                                          
                                                                                
         ZIC   R1,1(R6)            ELEM LEN                                     
         AHI   R1,-6               MINUS OVERHEAD                               
                                                                                
         ZIC   R0,5(R2)            LEN OF THIS COMMENT                          
         CR    R1,R0                                                            
         BNL   *+6                                                              
         LR    R1,R0               USE BIGGER OF THE TWO                        
                                                                                
         BCTR  R1,0                EXECUTED LENGTH                              
                                                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   CMLRSN(0),WORK      SAME COMMENT ?                               
         BE    VRBX                                                             
                                                                                
VRB60    XC    ELEM,ELEM                                                        
         LA    R6,ELEM                                                          
                                                                                
         MVI   CMLRSNEL,X'95'      REASON DATA ELEMENT                          
                                                                                
         GOTO1 ANY                                                              
                                                                                
         ZIC   R1,5(R2)            INPUT LENGTH                                 
         LR    RE,R1                                                            
         AHI   R1,-1               MINUS 1                                      
                                                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   CMLRSN(0),WORK                                                   
                                                                                
         AHI   RE,6          INPUT LEN+3+1+1+1 (DTE/NUM/LEN/ELCODE)             
         STC   RE,CMLRSNLN         TOTAL ELEMENT LENGTH                         
                                                                                
         MVC   CMLRSNDT,SVTODAY                                                 
                                                                                
         MVC   CMLRSNN,BYTE        REASON NUMBER                                
                                                                                
         GOTO1 ADDELEM                                                          
                                                                                
VRBX     XIT1                                                                   
         EJECT                                                                  
                                                                                
* FIND REFERENCED COMMERCIAL                                                    
                                                                                
FREFCML  NTR1                                                                   
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CMLKEY,R4                                                        
         MVC   CMLKID,=X'0A21'                                                  
         MVC   CMLKAM(3),BAGYMD & BCLT                                          
         MVC   CMLKCML,TRBREF                                                   
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE     SET CC CODE                                  
         XIT1                                                                   
                                                                                
CMLERR   MVI   ERROR,INVCOMM       INVALID CML                                  
         B     ERRX                                                             
*&&                                                                             
*<<<<<<<<<<<  END OF NOP  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
*&&DO                                                                           
*<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
* THIS WAS FOR STARCOM - NOP THIS CODE !!!!!                                    
*<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<                      
VRB      DS    0H                                                               
         CLC   =C'SJ',AGENCY       AGENCY SJR TEST                              
         BE    *+12                                                             
                                                                                
         TM    TWAAUTH+1,X'04'     AUTHORIZED TO CHANGE BRDCST SCREEN           
         BO    AUTHERR              NO, AUTHORIZATION ERROR                     
                                                                                
         CLI   ACTNUM,ACTADD       ACTION ADD IS INVALID                        
         BE    ADDBERR                                                          
                                                                                
         BAS   RE,CHKDEL           MAKE SURE CML IS NOT DELETED                 
                                                                                
         BRAS  RE,VRBROAD          VALIDATE BROADCAST SCREEN                    
         BRAS  RE,DR                                                            
         B     EXIT                                                             
         EJECT                                                                  
VRL      DS    0H                                                               
         CLC   =C'SJ',AGENCY       AGENCY SJR TEST                              
         BE    *+12                                                             
                                                                                
         TM    TWAAUTH+1,X'08'     AUTHORIZED TO CHANGE LEGAL SCREEN            
         BO    AUTHERR              NO, AUTHORIZATION ERROR                     
                                                                                
         CLI   ACTNUM,ACTADD       ACTION ADD IS INVALID                        
         BE    ADDBERR                                                          
                                                                                
         BAS   RE,CHKDEL           MAKE SURE CML IS NOT DELETED                 
                                                                                
         BRAS  RE,VRLEGAL          VALIDATE LEGAL SCREEN                        
         BRAS  RE,DR                                                            
         B     EXIT                                                             
         EJECT                                                                  
*================================================================               
* SEE THAT THIS CML IS NOT DELETED                                              
*================================================================               
                                                                                
CHKDEL   NTR1                                                                   
         L     R6,AIO                                                           
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                HAS TO BE COMMERCIAL ELEMENT                 
                                                                                
         USING CMLDTAEL,R6                                                      
                                                                                
         TM    CMLSTAT,X'80'                                                    
         BZ    CHKDELX                                                          
         LHI   R0,CMLISDEL                                                      
         LA    R2,TRACMLH                                                       
         J     TRAPERR2                                                         
CHKDELX  J     EXIT                                                             
                                                                                
AUTHERR  LA    R2,TRAMEDH                                                       
         LHI   R0,BADAUTH                                                       
         J     TRAPERR2                                                         
                                                                                
ADDBERR  MVI   ERROR,INVACT        ADD BCOM/LCOM RECORD IS NOT VALID            
         LA    R2,CONACTH          POINT TO ACTION FLD                          
         GOTO1 ERREX                                                            
*&&                                                                             

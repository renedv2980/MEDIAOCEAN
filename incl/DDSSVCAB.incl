       ++INCLUDE  DDSVCAPARM                                            00000100
FWRDSPC1 CSECT                                                          00010000
FWRDSPC1 AMODE 31                                                       00020001
FWRDSPC1 RMODE ANY                                                      00030003
         ENTRY FWRDSPC1                                                 00031099
*** MUST BE ASSEMBLED WITH ESA LEVEL CVT                                00040001
**                                                                      00050002
**    THIS ROUTINE IS PART OF SVC 247.  IT PROVIDES CROSS ADDRESS       00060002
**    SPACE DATASPACE SERVICES AS FOLLOWS:                              00070002
**     1.  FOR THE CREATE FUNCTION IT WILL CREATE A SCOPE=ALL           00080002
**         DATASPACE ON BEHALF OF THE CALLER PROVIDED ONE DOESN'T       00090002
**         ALREADY EXIST FOR THIS "ID".  IT THEN RECORDS THE            00100002
**         EXISTANCE OF THIS DATASPACE & IT'S ID.                       00110002
**                                                                      00120002
**                                                                      00130002
         USING *,RF                                                     00140000
         BAKR  RE,0             SAVE REGS                               00150039
         SAC   512                                                      00160039
         SYSSTATE ASCENV=AR   TELL MACROS THAT AS MODE IS AR            00170039
         B     START                                                    00180002
         DC    C'&SYSDATE &SYSTIME'                                     00190000
START    LAE   RC,0(RF,0)                                               00200039
         DROP  RF                                                       00200040
         USING FWRDSPC1,RC                                              00210039
         LR    R7,R1          SAVE INPUT PARM VALUE                     00230024
*NOP     B     CHECKESA       COULD BE XA UP TO NOW, IF SO ABEND        00240039
*                             AS ESA INSTRUCTIONS WILL NOW BE USED      00250002
ESAMAIN  L     R0,SIZE                                                  00260002
         STORAGE OBTAIN,LENGTH=(0)                                      00270002
         LR    RA,R1                                                    00280002
         USING DATA,RA                                                  00290002
         SAC   0              SWITCH TO PRIMARY MODE                    00300002
         SYSSTATE ASCENV=P    TELL MACROS THAT AS MODE IS PRIMARY       00310002
         ST    RD,SAVE+4      SAVE CALLERS SAVE AREA IN MINE            00320002
         LA    R3,SAVE                                                  00330000
         ST    R3,8(RD)       STORE MY SAVE AREA IN HIS                 00340000
         LR    RD,R3          SET R13 TO MY SAVE AREA                   00350000
         ST    R7,CALLRPRM    PRESERVE CALLER'S PARM VALUE              00360024
*                                                                       00370000
         L     R5,PSATOLD-PSA   GET CURRENT TCB                         00380084
         USING TCB,R5                                                   00390084
         MODESET EXTKEY=TCB,WORKREG=8   SWITCH TO USER'S KEY            00400084
         DROP  R5                                                       00410084
         L     R7,CALLRPRM                                              00420084
         USING PARMLIST,R7                                              00430084
         ICM   R5,15,ACTION   ACCESS USER'S ACTION CODE IN HIS KEY      00440084
         MODESET EXTKEY=ZERO,WORKREG=R8  GO BACK TO KEY 0               00450084
         STCM  R5,15,ACTNCPY  CREATE OUR LOCAL COPY OF ACTION CODE      00460084
         BAS   RE,GETSSCT     GO GET OUR SUBSYSTEM CVT                  00470007
         LTR   RF,RF                                                    00480011
         BNZ   ERR1                                                     00490011
         LR    R3,R1                                                    00490012
         ST    R3,SSCTPTR     SAVE FOR LATER USE                        00510034
         USING SSCT,R3        ADDRESSIBILITY ON SSCT                    00520013
         CLC   ACTNCPY,=C'RSET'   RESET THE POINTER IN THE SSCT         00530084
         BE    RESET                                                    00540083
         L     R6,SSCTSUSE    GET SUBSYSTEM OWNED FIELD                 00550083
         USING DDSVT,R6                                                 00560064
         LTR   R6,R6          HAVE WE INITIALIZED ALREADY?              00570064
         BNZ   DSPC3          YES, SKIP INITIALIZATION                  00580030
         DROP  R3             DONE WITH SSCT                            00590021
*DEBUG   WTO   MF=(E,MSG1)                                              00600089
         BAS   RE,DDSVTINI    GO INITIALIZE MASTER TABLE                00610021
         LR    R6,R1                                                    00620063
DSPC3    EQU   *                                                        00630030
         MVC   MSG1+12(20),DDSVTID  DISPLAY HEADER                      00640029
*DEBUG   WTO   MF=(E,MSG1)                                              00650095
** NOW PROCESS USER'S REQUEST BY FIRST FINDING THE MATCHING             00660064
** ID ENTRY IN THE ENTRY TABLE ARRAY                                    00670064
         L     R2,DDSETRYA         GET POINTER TO ARRAY                 00680063
         USING ETRY,R2                                                  00690064
         DROP  R6                                                       00700063
NXTENTRY CLI   ETRYID,X'FF'        ARE WE AT END OF TABLE               00710064
         BE    IDUNKWN             YES, ID IS NOT IN THE TABLE          00720064
         CLC   ETRYID(4),DDSID     DO WE HAVE A MATCH?                  00730064
         BE    DOACT1                                                   00740064
         LA    R2,ETRYLEN(R2)      BUMP PTR TO NEXT ENTRY               00750064
         B     NXTENTRY            GO CHECK NEXT ENTRY                  00760064
IDUNKWN  EQU   *                                                        00770064
         DC    H'0'                                                     00780092
         LA    R9,RTCDEIDU                                              00790064
         B     EXIT                                                     00800064
         SPACE 2                                                        00810064
DOACT1   CLC   ACTNCPY,=C'GETA'   GET ACCESS TO EXISTING DATASPACE      00820084
         BE    GETACCES                                                 00830025
         CLC   ACTNCPY,=C'MAKE'   CREATE DATASPACE                      00840084
         BE    MAKEDSPC                                                 00850025
         CLC   ACTNCPY,=C'DEL '   DELETE/DISABLE ENTRY                  00860084
         BE    DELETE1                                                  00870051
         CLC   ACTNCPY,=C'DISP'   INITIALIZE &/OR DISPLAY ENTRYS        00880084
         BE    DISP1                                                    00890051
         CLC   ACTNCPY,=C'PALE'   GET ACCESS2                           00900093
         BE    ALESERV2                                                 00910093
         CLC   ACTNCPY,=C'PDEL'   DELETE ALET TO ADDRESS SPACE          00920097
         BE    ALESERVD                                                 00930097
         CLC   ACTNCPY,=C'LOAD'   LOAD IN THIS MODULE                   00930098
         BE    LOADIT                                                   00930099
         CLC   ACTNCPY,=C'FIX1'   CHECK/FIX UP TROUBLE SPOTS            00930100
         BE    FIXUP                                                    00930110
         MVC   MSGBADA+10(4),ACTNCPY                                    00940084
         WTO   MF=(E,MSGBADA)                                           00950036
         DC    H'0'       ACTION VALUE UNKNOWN                          00960025
         LTORG                                                          00960026
MSGBADA  WTO   ' BAD ACTION CODE ',MF=L                                 00970036
         DROP  R7                                                       00980066
*                                                                       00990000
EXIT     DS    0H                                                       01000037
*                              FREEMAIN OF MY SAVE AREA                 01010002
         SAC   0               EXIT AR MODE                             01020002
         SYSSTATE ASCENV=P                                              01030002
         L     R0,SIZE                                                  01040002
         LR    R1,RA                                                    01050002
         STORAGE RELEASE,LENGTH=(0),ADDR=(1)                            01060002
         LR    RF,R9           SET RETURN CODE                          01070035
         LR    R0,R7           SET REASON CODE    12/5/97               01071099
         PR                    RETURN TO CALLER                         01080039
RTCDECNG EQU   16          CREATE FAILED                                01090035
RTCDEIDU EQU   20          ID UNKOWN/NOT DEFINED                        01100035
RTCDEEXS EQU   24          REQUEST TO CREATE ALREADY EXISTING D.S.      01110035
         SPACE 3                                                        01120021
ERR1     STCM  RF,15,MSG2+16                                            01130021
         WTO   MF=(E,MSG2)                                              01140021
         B     EXIT                                                     01150021
MSG2     WTO   'ERROR LOCATING #DDS SUBSYSTEM',ROUTCDE=(2),MF=L         01160012
MSGSSCT  WTO   'WE HAVE SSCT      ',ROUTCDE=(2),MF=L                    01170033
*NOP     PR                    RETURN TO CALLER                         01180002
         EJECT                                                          01190002
         L      R5,16          GET CVT  FROM 10 HEX                     01200002
         USING  CVTMAP,R5                                               01210002
         L      R5,CVTSMCA       GET SMCA                               01220002
         DROP   R5                                                      01230002
*        MVC    SMFSID,SMCASID-SMCABASE(R5)  SMF SYSTEM ID              01240002
BADTYPE  LH     R2,ABEND3F7                                             01250002
         ABEND  (R2),DUMP,STEP,SYSTEM                                   01260002
**                                                                      01270002
ABEND3F7 DC     XL2'03F7'                                               01280002
         EJECT                                                          01290000
*** CREATE DATASPACE & GET SET FOR ADDRESSIBLITY                        01300001
MAKEDSPC EQU   *                                                        01310025
**               CREATE A SHARABLE DATASPACE FOR THE USER               01320025
**               MAKING SURE ONE DOES NOT ALREADY EXIST                 01330025
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              01340025
**         REG 2 HAS ADDRESS OF ENTRY TABLE ARRAY ITEM                  01350064
         USING PARMLIST,R7                                              01360025
         USING ETRY,R2                                                  01370063
         TM    ETRYFLGS,ETRYCRTD   DOES D. S. ALREADY EXIST?            01380064
         BO    EXISTS              YES, ERROR - RETURN                  01390063
         MVC   ETRYNAME(8),DSPNAME     GET USER'S DESIRED NAME          01400063
         MVC   ETRYBLKS(4),DSPBLCKS    GET USER'S DESIRED NO OF BLKS    01410025
         DSPSERV CREATE,STOKEN=ETRYSTKN,NAME=ETRYNAME,SCOPE=ALL,       X01420025
               BLOCKS=(ETRYBLKS),ORIGIN=ETRYORGN,KEY=EIGHT              01430038
         LTR   RF,RF                                                    01440001
         BNZ   CREATENG                                                 01450004
         MVC   ETRYID(4),DDSID     REGISTER                             01460025
         TIME  BIN             R0=TIME R1=DATE                          01470025
         STCM  R0,15,ETRYTIME                                           01480025
         STCM  R1,15,ETRYDATE                                           01490025
         L     R5,PSATOLD-PSA   GET CURRENT TCB                         01500025
         USING TCB,R5                                                   01510025
         L     R6,TCBTIO        GET ADDRESS OF TIOT                     01520025
         DROP  R5                                                       01530025
         USING TIOT1,R6                                                 01540025
         MVC   ETRYJBNM,TIOCNJOB GET THE JOBNAME FROM TIOT              01550025
         LA    R3,ASIDFLD                                               01560059
         EXTRACT (R3),'S',FIELDS=(ASID)                                 01570059
         L     R1,ASIDFLD                                               01580059
         L     R9,0(,R1)                                                01590088
         LOCASCB ASID=(R9)                                              01600088
         DROP  R6                                                       01610025
*NOP     MVC   DSTOKEN(8),ETRYSTKN     RETURN STOKEN TO USER            01620040
         MVC   DSORIGIN(4),ETRYORGN    RETURN ORIGIN TO USER            01630025
         OI    ETRYFLGS,ETRYCRTD   INDICATED D.S  CREATED               01640063
         DROP  R2,R7                                                    01650025
         SR    R9,R9               SET ZERO RETURN CODE -- ALL OK       01660063
         SR    R7,R7               CLEAR REASON CODE                    01661099
         B     EXIT                                                     01670026
CREATENG EQU   *                                                        01680004
         LA    R9,RTCDECNG                                              01690035
         LR    R7,RF               SAVE CREATE RETURN CODE              01691099
         B     EXIT                                                     01700035
EXISTS   EQU   *                                                        01710026
         LA    R9,RTCDEEXS                                              01720035
         SR    R7,R7               CLEAR REASON CODE                    01721099
         B     EXIT                                                     01730035
         DC    H'0'                                                     01740004
ANUM     DC    F'6000'                                                  01750024
         EJECT                                                          01760001
GETACCES DS    0H                                                       01770026
**               GET ACCESS TO A SHARED DATASPACE FOR THE USER          01780027
**                                                                      01790027
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              01800026
**         REG 2 HAS ADDRESS OF DDS ENTRY TABLE ITEM                    01810064
**                                                                      01820027
         USING PARMLIST,R7                                              01830026
         USING ETRY,R2                                                  01840064
         TM    ETRYFLGS,ETRYCRTD   DOES D.S. EXIST?                     01850064
         BNO   NOTFND              NO,ERROR - RETURN                    01860064
         MVC   EXFORM(ALEAREAL),ALEAREA   COPY EX PARAMETER LIST        01860065
         SAC   512                                                      01870039
         SR    R1,R1                                                    01870040
         SAR   R2,R1               MAKE SURE AR 2 IS ZERO               01870050
         ALESERV ADD,STOKEN=ETRYSTKN,ALET=MYALET,AL=WORKUNIT,          X01880039
               MF=(E,EXFORM)                                            01890039
         LTR   RF,RF                                                    01900039
         BNZ   ADDNG                                                    01910039
         SAC   0                                                        01920039
**  THE TARGETS OF THE FOLLOWING MOVES ARE IN THE CALLER'S STORAGE KEY  01930056
         MVC   DSALET,MYALET                                            01940055
         MVC   DSORIGIN(4),ETRYORGN    RETURN ORIGIN TO USER            01950027
         MVC   DSTOKEN(8),ETRYSTKN     RETURN STOKEN TO USER            01960054
         SR    R9,R9                   CLEAR RETURN CODE REGISTER       01980035
*DEBUG   WTO   MF=(E,MSG1)                                              01990096
         B     EXIT                                                     02000027
NOTFND   LA    R9,RTCDENF                                               02010035
         SR    R7,R7                   CLEAR REASON CODE                02011099
         MVC   WTONI+32(14),ETRY       DISPLAY ENTRY IN TABLE           02011100
         WTO   MF=(E,WTONI)                                             02011200
         B     EXIT                                                     02020035
ADDNG    MVC   MSGACT+17(4),ACTNCPY                                     02020037
         MVC   MSGACT+29(4),DDSID                                       02020038
         DROP  R2,R7                                                    02020039
         WTO   MF=(E,MSGACT)                                            02020040
         LA    R9,RTCDEANG            ADD IS NO GOOD                    02030039
         LR    R7,RF                  SAVE ACTUAL RETURN CODE           02031099
         SAC   0                                                        02040039
         B     EXIT                                                     02050039
RTCDENF  EQU   12                                                       02060035
RTCDEANG EQU   24                                                       02070039
MSGACT   WTO   ' ACTION CODE=XXXX FOR ID XXXX FAILED',MF=L              02070040
WTONI    WTO   'DATASPACE NOT INITIALIZED: XXXXXXXXXXXXXX',MF=L         02070050
         EJECT                                                          02080093
ALESERV2 DS    0H                                                       02090093
**               GET ACCESS TO A SHARED **ADDRESS** SPACE               02100093
**                                                                      02110093
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              02120093
**               IN THIS CASE THE USER PROVIDES AN STOKEN               02130094
**                                                                      02140094
         USING PARMLIST,R7                                              02150093
         SAC   512                                                      02160093
         ALESERV ADD,STOKEN=DSTOKEN,ALET=MYALET,AL=WORKUNIT,           X02170094
               ACCESS=PUBLIC,CHKEAX=NO,                                X02180093
               MF=(E,ALEAREA)                                           02190093
         LTR   RF,RF                                                    02200093
         BNZ   ADDNG                                                    02210093
         SAC   0                                                        02220093
**  THE TARGETS OF THE FOLLOWING MOVES ARE IN THE CALLER'S STORAGE KEY  02230093
         MVC   DSALET,MYALET           RETURN ALET GOTTEN               02240093
         DROP  R7                                                       02250094
         SR    R9,R9                   CLEAR RETURN CODE REGISTER       02260093
         WTO   MF=(E,MSG1)                                              02270093
         B     EXIT                                                     02280093
         EJECT                                                          02290027
ALESERVD DS    0H                                                       02300097
**               DELETE ACCESS TO AN **ADDRESS** SPACE                  02310097
**                                                                      02320097
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              02330097
**               IN THIS CASE THE USER PROVIDES AN ALET                 02340097
**                                                                      02350097
         USING PARMLIST,R7                                              02360097
         SAC   512                                                      02370097
         MVC   MYALET,DSALET                                            02371099
         ALESERV DELETE,ALET=MYALET,CHKEAX=NO,                         X02380098
               MF=(E,ALEAREA)                                           02390097
         LTR   R9,RF                                                    02400097
         BNZ   DELNG                                                    02410097
         SAC   0                                                        02420097
         DROP  R7                                                       02430097
         SR    R9,R9                   CLEAR RETURN CODE REGISTER       02440097
         B     EXIT                                                     02450097
DELNG    DC    H'0'                                                     02460097
         EJECT                                                          02470097
DISP1    DS    0H                                                       02480097
**             DISPLAY THE DDS VECTOR TABLE                             02490027
**                                                                      02500027
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              02510027
**         REG 6 HAS ADDRESS OF DDS VECTOR TABLE                        02520064
**                                                                      02530064
         USING DDSVT,R6                                                 02540064
         MVC   MSG1+12(44),DDSVTID  DISPLAY HEADER                      02550027
         WTO   MF=(E,MSG1)                                              02560027
         L     R2,DDSETRYA             GET POINTER TO ARRAY             02570064
         USING ETRY,R2                                                  02580066
DISP1EOT CLI   ETRYID,X'FF'            IS IT END OF TABLE?              02590066
         BE    DISP1EXT                                                 02600064
         MVC   MSG1+12(ETRYLEN),ETRYID   DISPLAY AN ENTRY               02610027
         WTO   MF=(E,MSG1)                                              02620027
         LA    R2,ETRYLEN(R2)          ADVANCE TO NEXT ENTRY            02630064
         B     DISP1EOT                                                 02640064
DISP1EXT SR    R9,R9                                                    02650064
         DROP  R2,R6                                                    02660064
         B     EXIT                                                     02670027
         EJECT                                                          02680051
MSG1     WTO   'DDSVT=>                                                X02690073
                            <=',ROUTCDE=(22),MF=L                       02700073
DELETE1  DS    0H                                                       02710051
**      DELETE FUNCTIONS                                                02720051
**        IF THIS USER/JOB IS THE DATASPACE CREATOR DELETE IT           02730051
**        OTHERWISE JUST DELETE THE ALET                                02740051
**                                                                      02750051
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              02760051
**         REG 2 HAS ADDRESS OF DDS ENTRY TABLE ITEM                    02770064
         USING ETRY,R2                                                  02780064
         TM    ETRYFLGS,ETRYCRTD   DOES D. S. ALREADY EXIST?            02790064
         BNO   NOTFND                  NO, FAIL                         02800064
         WTO   MF=(E,DELETEM)                                           02800065
         NI    ETRYFLGS,X'7F'      TURN OFF FLAG FOR NOW                02810064
** LATER ON MAKE SURE USER IS CREATOR AND ACTUALLY DELETE THE DSP       02820064
         DROP  R2                                                       02830064
         B     EXIT                                                     02840052
DELETEM  WTO   '#DDS ID XXXX DS HAS BEEN DELETED',MF=L                  02840053
         SPACE 2                                                        02850052
RESET    L     R3,SSCTPTR     GET PTR TO THE SSCT                       02860068
         USING SSCT,R3        ADDRESSIBILITY ON SSCT                    02870068
         MODESET EXTKEY=ZERO,SAVEKEY=(2),WORKREG=(R9)                   02880091
         XC    SSCTSUSE,SSCTSUSE                                        02890068
         MODESET KEYADDR=(2),WORKREG=(R9)                               02900091
         DROP  R3                                                       02910068
         SR    R9,R9                                                    02920068
         B     EXIT                                                     02930068
         EJECT                                                          02930069
FIXUP    DC    H'0'                                                     02930070
         EJECT                                                          02930071
LOADIT   DS    0H                                                       02930072
**             LOAD THIS MODULE INTO COMMON STORAGE AND RECORD IT'S     02930080
**             ADDRESS IN THE DDSVT FOR USAGE BY SVC2XX                 02930090
**                                                                      02930091
**  INPUT, REG 7 HAS ADDRESS OF USER PARMS                              02930100
**         REG 6 HAS ADDRESS OF DDS VECTOR TABLE                        02930200
**                                                                      02930300
         USING DDSVT,R6                                                 02930400
         USING PARMLIST,R7                                              02930401
         L     R1,DSPBLCKS   GET ADDRESS TO STORE                       02930410
         ST    R1,DDSRTN1    SAVE THE ADDRESS IN THE VECTOR TABLE       02930420
         SR    R9,R9                                                    02930430
         B     EXIT                                                     02930440
         SPACE 4                                                        02930450
         MODESET MF=(E,PROBSTAT)   GO TO PROBLEM STATE                  02930500
         STORAGE OBTAIN,LENGTH=4096                                     02932100
         LR    R8,R1                                                    02932101
         USING LOADAREA,R8                                              02932102
         MVC   RELODCB(DCBLEN),LOADDCB                                  02932110
         MVC   RELOOPEN(OPENLEN),OPENMFL                                02932111
         LA    R2,RELODCB                                               02932200
         LA    R3,RELOOPEN                                              02932201
         USING IHADCB,R2                                                02932210
         OPEN  ((R2),INPUT),MF=(E,(R3))                                 02932300
         TM    DCBOFLGS,X'10'    IS DCB OPEN?                           02932330
         BZ    NOTOPEN           ERROR IF NOT                           02932340
         BLDL  (R2),BUILDL                                              02932400
         LTR   RF,RF                                                    02932500
         BNZ   BLDLERR                                                  02932600
         LOAD  DE=DATASPC,DCB=(R2)                                      02932700
         LTR   RF,RF                                                    02932800
         BNZ   LOADERR                                                  02932900
         LR    R4,R1           GET AUTHCODE AND LENGTH                  02933000
         MODESET MF=(E,SUPSTATE)   GO TO SUPERVISOR STATE               02933100
         STORAGE OBTAIN,LENGTH=(R4),SP=241                              02933200
         LR    R3,R1                                                    02933300
         LA    R9,SFLOAD                 GET PTR TO PARM LIST           02933400
         LOAD  DE=DATASPC,ADDR=(R3),DCB=(R2),                          X02933500
               SF=(E,(R9)),ERRET=LOADERR                                02933600
         LR    R5,R0         PRESERVE LOAD RESULTS                      02933700
         ST    R1,DDSRTN1    SAVE THE ADDRESS IN THE VECTOR TABLE       02933800
         SR    R9,R9                                                    02933910
         B     EXIT                                                     02933920
         DROP  R6,R8                                                    02933930
         SPACE 2                                                        02934000
NOTOPEN  DC    H'0'                                                     02934100
BLDLERR  LA    R1,BLDLABD                                               02934900
         B     ABENDDMP                                                 02935000
BLDLABD  EQU   1                                                        02935100
LOADABD  EQU   2                                                        02935110
ABENDDMP ABEND (R1),DUMP,, SER                                          02935200
ABEND    ABEND (R1),,,USER                                              02935300
          SPACE 3                                                       02935400
*                     LOAD FUNCTION FAILED - TELL USER                  02935700
*                                                                       02935800
LOADERR  LA    R1,LOADABD                                               02935900
         B     ABENDDMP                                                 02936000
SFLOAD   LOAD  SF=L                                                     02936600
LOADLNG  EQU   *-SFLOAD    CALCULATE LENGTH FOR LIST FORM AREA          02936700
*                                                                       02936800
OPENMFL  OPEN  (,,),MF=L                                                02936810
OPENLEN  EQU   *-OPENMFL                                                02936820
SUPSTATE MODESET KEY=ZERO,MODE=SUP,MF=L                                 02936900
PROBSTAT MODESET KEY=NZERO,MODE=PROB,MF=L                               02937000
LOADDCB  DCB   DSORG=PO,MACRF=(R),DDNAME=LOADLIB                        02937100
DCBLEN   EQU   *-LOADDCB                                                02937110
BUILDL   DS    0F                                                       02937200
         DC    H'01'        NUMBER OF ENTRIES                           02937300
         DC    H'60'        LENGTH OF EACH ENTRY                        02937400
DATASPC  DC    CL8'FWRDSPC1'                                            02937500
         DC    XL52'00'                                                 02937600
         EJECT                                                          02940027
CHECKESA L     R2,CVTPTR       GET CVT POINTER                          02950001
         USING CVTMAP,R2                                                02960001
         L     R3,CVTDCB                                                02970001
         TM    CVTDCB,CVTOSEXT  IS CVT-OS-LVL AREA PRESENT?             02980001
         BNO   NOOSLVL          BRANCH IF NOT                           02990001
         TM    CVTOSLVL,CVTXAX  IS EXA/370 SUPPORTED ?                  03000001
         BNO   NOTESA                                                   03010001
         B     ESAMAIN                                                  03020001
         DROP  R2                                                       03030002
NOTESA   EQU   *                                                        03040001
NOOSLVL  EQU   *                                                        03050001
         ABEND 1                                                        03060001
GETSSCT  DS    0H                                                       03070007
         ST    RE,SUBSAVE                                               03080006
         STM   R2,RB,SUBSAVE+4  SAVE REGS                               03090006
         LA    R7,SSIBAREA      GET ADDRESS OF SSIBAREA                 03100006
         USING SSIB,R7                                                  03110006
         MVC   SSIBID,MYSSIBID  INSERT SSIB IDENT                       03120006
         LH    R8,SIZESSIB      GET SSIB LENGTH                         03130006
         STH   R8,SSIBLEN       SET SSIB LENGTH INTO SSIB               03140006
         MVC   SSIBSSNM,MSTRID  INDENTIFY MASTER SUBSYSTEM              03150006
         MVC   SSIBJBID,DDSSSI  STORE DDS SUBSYSTEM NAME                03160006
*                                                                       03170006
         LA    R5,SSOBAREA     GET ADDRESS OF SSOB STORAGE              03180006
         USING SSOB,R5                                                  03190006
**NOP    XC    SSVSBGN(SSVSSIZE),SSVSBGN  ZERO OUT SSOBVS               03200006
         LA    R8,SSVSSIZE(0)  GET SSVS LENGTH                          03210006
         STH   R8,SSVSLEN      SET SSVS LENGTH INTO SSOB                03220006
         SPACE                                                          03230006
         MVC   SSOBID,MYSSOBID                                          03240006
         LA    R8,SSOBHSIZ(0)                                           03250006
         STH   R8,SSOBLEN      SET SSOB LENGTH                          03260006
         LH    R8,VERFYFNC                                              03270006
         STH   R8,SSOBFUNC                                              03280006
         LA    R8,SSVSBGN                                               03290006
         ST    R8,SSOBINDV     POINT TO SSVS                            03300006
         ST    R7,SSOBSSIB     POINT TO SSIB                            03310006
         ST    R5,SSOBPTR      POINT TO SSOB                            03320006
         LA    R1,SSOBPTR      GET ADDRESS OF SSOB POINTER              03330006
         PRINT GEN                                                      03340007
         IEFSSREQ               ISSUE SSI REQUEST                       03350006
         DROP  R7               DONE WITH SSIB                          03360006
         SPACE                                                          03370006
         PRINT NOGEN                                                    03380007
         LTR   RF,RF            TEST SSI RETURN CODE                    03390006
         BZ    CKSSVS                                                   03400006
*NOP     LA    RF,16                                                    03410016
         DC    H'0'                                                     03420045
         B     VSSIEXIT                                                 03430006
CKSSVS   LA    R1,SSVSSNAM(0,0) GET SUCCESSFUL RETURN CODE              03440006
         C     R1,SSOBRETN      IS IT A SUBSYSTEM?                      03450006
         BE    LOADSSCT         YES, GET THE SSCT ADDRESS               03460007
         LA    RF,12                                                    03470006
         B     VSSIEXIT                                                 03480006
LOADSSCT L     R1,SSVSSCTP      GET SSCT ADDRESS                        03490007
VSSIEXIT EQU   *                                                        03500006
         LM    R2,RB,SUBSAVE+4  RESTORE REGS                            03510006
         L     RE,SUBSAVE                                               03520006
         BR    RE               RETURN TO CALLER                        03530006
         EJECT                                                          03540006
DDSVTINI DS    0H                                                       03550020
         ST    RE,SUBSAVE                                               03560020
         STM   R2,RB,SUBSAVE+4  SAVE REGS                               03570020
         L     R3,IDTAB         GET ADDRESS OF ID TABLE                 03580063
         SR    R4,R4                                                    03590063
TESTEND  CLI   0(R3),X'FF'      ARE WE AT THE END OF THE TABLE?         03600065
         BE    EOFTAB           YES, GO CONTINUE                        03610063
         LA    R4,1(0,R4)       ADD 1 TO COUNT                          03620063
         LA    R3,4(0,R3)       ADVANCE TO NEXT ENTRY                   03630063
         B     TESTEND          GO CHECK NEXT ENTRY                     03640063
EOFTAB   LA    R5,ETRYLEN(,0)   GET LENGTH OF ENTRY                     03650078
         STH   R5,HALFWRK                                               03660066
         MH    R4,HALFWRK       GET TOTAL SIZE OF ARRAY                 03670079
         AH    R4,=H'100'       ALLOW FOR OVERHEAD                      03680079
         CH    R4,PAGE          DOES SIZE EXCEED 1 PAGE                 03690080
         BH    TOOBIG           YES, DIE                                03700079
         STORAGE OBTAIN,LENGTH=(4),SP=241                               03710079
         LR    R3,R1            REALLY NEED TO SERIALIZE UPDATES        03720079
         USING DDSVT,R3                                                 03730079
         XC    DDSVT(256),DDSVT CLEAR IT OUT                            03740020
         MVC   DDSVTID,=C'DDSV'                                         03750063
         ST    R4,DDSVTSIZ      RECORD HOW BIG THIS AREA IS             03760079
         L     R5,PSATOLD-PSA   GET CURRENT TCB                         03770020
         USING TCB,R5                                                   03780020
         L     R6,TCBTIO        GET ADDRESS OF TIOT                     03790020
         L     R4,TCBJSCB       GET JSCB ADDRESS                        03800079
         DROP  R5                                                       03810020
         USING TIOT1,R6                                                 03820020
         MVC   DDSJOBNM,TIOCNJOB GET THE JOBNAME FROM TIOT              03830020
         DROP  R6                                                       03840020
         USING IEZJSCB,R4                                               03850079
         L     R4,JSCBACT                                               03860079
         L     R5,JSCBSSIB                                              03870020
         USING SSIB,R5                                                  03880020
         MVC   DDSJOBID,SSIBJBID     GET JES JOB NO.                    03890020
         STCM  R4,15,MSG1+12                                            03900033
         MVC   MSG1+17(20),DDSVTID  DISPLAY HEADER                      03910033
         WTO   MF=(E,MSG1)                                              03920033
         L     R6,IDTAB         GET ADDRESS OF ID TABLE                 03930079
         LA    R5,DDSARRAY                                              03940063
         ST    R5,DDSETRYA      STORE POINTER TO ARRAY                  03950063
         USING ETRY,R5                                                  03960063
TESTEND2 CLI   0(R6),X'FF'      ARE WE AT THE END OF THE TABLE?         03970079
         BE    EOFTAB2          YES, GO CONTINUE                        03980063
         XC    ETRY(ETRYLEN),ETRY CLEAR OUT ENTRY                       03990063
         MVC   ETRYID,0(R6)     COPY ID FROM TABLE                      04000079
         LA    R6,4(R6)         BUMP PTR TO NEXT ENTRY IN ID TABLE      04010082
         LA    R5,ETRYLEN(R5)   BUMP PTR TO NEXT ENTRY                  04020082
         B     TESTEND2         GO CHECK NEXT ENTRY                     04030063
EOFTAB2  DS    0H                                                       04040063
         MVC   ETRYID,=XL4'FFFFFFFF'  MARK END OF TABLE                 04050064
         DROP  R5                                                       04060065
         L     R6,SSCTPTR                                               04070033
         USING SSCT,R6          ADDRESSIBILITY ON SSCT                  04080022
         CLC   SSCTID,=C'SSCT'  DOUBLE CHECK IT IS SSCT                 04090034
         BNE   SSCTPTNG         AVOID KEY 0 UPDATE                      04100034
         ST    R3,SSCTSUSE      KEY 0 UPDATE SUBSYSTEM OWNED FIELD      04110087
         LR    R1,R3            RETURN DDSVT ADDRESS TO CALLER          04120087
         LM    R2,RB,SUBSAVE+4  RESTORE REGS                            04130020
         L     RE,SUBSAVE                                               04140020
         DROP  R4,R3,R6                                                 04150022
         BR    RE               RETURN TO CALLER                        04160020
TOOBIG   DC    F'0'                                                     04170079
SSCTPTNG DC    H'0'                                                     04180061
         USING SSVT,R5                                                  04190058
         LA    R6,1                                                     04200058
         STH   R6,SSVTFNUM      INDICATE NUMBER OF FUNCTION ROUTINES    04210058
         XC    SSVTFCOD,SSVTFCOD CLEAR OUT VECTOR TABLE                 04220058
         MVI   SSVTFCOD+SSOBEOM-1,X'01'  INDICATE SUPPORT FOR E.O.M     04230058
**       MVC   LOADGM(LOADLNG),LOADAREA  COPY LOAD PARM LIST            04240058
**       LA    R2,LOADAREA                                              04250060
         LOAD  EPLOC=(R3),DCB=0,ADDR=(R4),SF=(E,(R2)),ERRET=LOADERR2    04260060
LOADERR2 DS    0H                                                       04270061
         EJECT                                                          04270062
DDSVT    DSECT                                                          04310020
DDSVTID  DS    CL4                                                      04320020
DDSJOBNM DS    CL8                                                      04330021
DDSJOBID DS    CL8                                                      04340021
DDSCDATE DS    F           DATE OF CREATION                             04350080
DDSCTIME DS    F           TIME OF CREATION                             04360080
DDSVTSIZ DS    F           SIZE OF THIS AREA                            04370063
DDSETRYA DS    A           ADDRESS OF DATASPACE ENTRIES                 04380063
DDSRTN1  DS    A           ADDRESS OF PRELOADED COPY OF THIS MODULE     04390095
         DS    A           EXPANSION 2                                  04400095
DDSVTLEN EQU   *-DDSVT                                                  04410080
DDSARRAY DS    X                                                        04420063
ETRY     DSECT                                                          04430063
ETRYID   DS    CL4         DDS MNEMONIC ID                              04440025
ETRYFLGS DS    XL2                                                      04450025
ETRYCRTD EQU   X'80'       DATASPACE CREATED                            04460063
ETRYJBNM DS    CL8         CREATOR/OWNER JOB NAME                       04470025
ETRYNAME DS    CL8         DATASPACE NAME                               04480025
ETRYSTKN DS    CL8         STOKEN OF DATASPACE                          04490025
ETRYBLKS DS    XL4         NUMBER OF BLOCKS FOR CREATION                04500025
ETRYORGN DS    A           ORIGIN                                       04510025
ETRYASID DS    XL4         ASID OF OWNER                                04520025
ETRYDATE DS    XL4         DATE OF DATA SPACE CREATION                  04530025
ETRYTIME DS    XL4         TIME OF DATA SPACE CREATION                  04540025
ETRYLEN  EQU   *-ETRYID                                                 04550027
*  OWNED DATA SPACE TABLE  SWITCH KEY, FETCH PROTECT?                   04560021
*                                                                       04570021
*  ASID OF OWNER, JOB NAME, JOB NUMBER, DATE/TIME OF CREATION           04580021
*  'ID'                                                                 04590021
*  STOKEN                                                               04600021
*                                                                       04610021
*                                                                       04620021
*        COPY  PARMLIST   * NOW DONE VIA ++INCLUDE                      04630054
LOADAREA DSECT                                                          04640100
RELODCB  DS    XL(DCBLEN)                                               04640110
RELOOPEN DS    XL(OPENLEN)                                              04640120
RELOLOAD DS    XL(LOADLNG)                                              04640130
DATA     DSECT                                                          04640200
         DS    0D                                                       04650000
SAVE     DS    20F                                                      04660000
SUBSAVE  DS    20F                                                      04670006
BUFFER   DS    F                                                        04680000
CALLRPRM DS    A                                                        04690024
MYALET   DS    F                                                        04700039
COMPTR   DS    F                                                        04710006
ASIDFLD  DS    F                                                        04720057
SADDR    DS    F               SNAPX  STARTING ADDRESS                  04730001
EADDR    DS    F               SNAPX  ENDING ADDRESS                    04740001
SSOBPTR  DS    A                PTR TO SSOB                             04750006
SSCTPTR  DS    A                PTR TO SSCT                             04760022
HALFWRK  DS    H                HALFWORD WORK AREA                      04770067
ACTNCPY  DS    CL4              COPY OF USER'S ACTION CODE              04780084
SSOBAREA DS    XL34             SSOBLN1A SHOULD BE THE EQUATE USED.     04790017
**OBVS   DS    XL'SSOBVS'       VERFIY SSI EXTENSION AREA               04800006
SSIBAREA DS    XL24            SSIB AREA                                04810006
LOADGM   DS    XL10                                                     04820060
EXFORM   DS    XL(ALEAREAL)                                             04820070
FWRDSPC1 CSECT                                                          04840001
SIZE     DC    F'800'    REMEMBER THE DOUBLE WORD ALIGNMENT OF GETMAIN  04850010
ECBWAIT  DC    F'0'                                                     04860001
IDTAB    DC    V(FWRDSPTB)       DATASPACE ID TABLE                     04870063
PAGE     DC    H'4096'                                                  04880080
OVERHEAD DC    AL2(DDSVTLEN)                                            04890080
SIZESSIB DC    AL2(SSIBSIZE)                                            04900006
SIZESSOB DC    AL2(SSOBHSIZ)     SIZE OF SSOB HEADER ALONE              04910006
SIZESSVS DC    AL2(SSVSSIZE)                                            04920006
VERFYFNC DC    AL2(SSOBVERS)     VERIFY FUNCTION CODE VALUSE            04930006
MYSSIBID DC    C'SSIB'                                                  04940006
MYSSOBID DC    C'SSOB'                                                  04950006
MSTRID   DC    C'MSTR'                                                  04960006
DDSSSI   DC    C'#DDS    '     NAME OF DDS SUBSYSTEM                    04970006
#DDS     DC    CL4'#DDS'                                                04980001
F1SA     DC    C'F1SA'                                                  04990080
OFFHIBIT DC    X'7FFFFFFF'                                              05000001
EIGHT    DC    X'88'                                                    05010038
ALEAREA  ALESERV MF=L          ALESERV PARM AREA                        05010039
ALEAREAL EQU   *-ALEAREA                                                05010040
         DS    0F                                                       05020001
LOGSNAP  DCB   DDNAME=LOGSNAP,RECFM=VBA,LRECL=125,BLKSIZE=882,MACRF=W, X05030001
               DSORG=PS                                                 05040001
TYPE1    EQU    1                                                       05050002
TYPE2    EQU    2                                                       05060000
R0       EQU    00                                                      05070000
R1       EQU    01                                                      05080000
R2       EQU    02                                                      05090000
R3       EQU    03                                                      05100000
R4       EQU    04                                                      05110000
R5       EQU    05                                                      05120000
R6       EQU    06                                                      05130000
R7       EQU    07                                                      05140000
R8       EQU    08                                                      05150000
R9       EQU    09                                                      05160000
RA       EQU    10                                                      05170000
RB       EQU    11                                                      05180000
RC       EQU    12                                                      05190000
RD       EQU    13                                                      05200000
RE       EQU    14                                                      05210000
RF       EQU    15                                                      05220000
         BAKR  R14,0              SAVE STATUS                           05230001
         SAC   512                SWITCH TO AR MODE                     05240001
         SYSSTATE ASCENV=AR       TELL MACROS THAT AR MODE IS ACTIVE    05250001
         LAE   R12,0(R15,0)       SET UP BASE REG                       05260001
         SAC   512              SWITCH TO A/R MODE                      05270001
         SYSSTATE ASCENV=AR     TELL MACROS THAT AS MODE IS ACC REG     05280001
*NOP     ALESERV DELETE,ALET=DSPALET                                    05290026
*        BNZ   ABEND                                                    05300003
*NOP     DSPSERV DELETE,STOKEN=DSTOKEN                                  05310026
*        BNZ   ABEND                                                    05320003
         B     EXIT                                                     05330001
         EJECT                                                          05340001
***                                                                     05350001
R12      EQU    12                                                      05480001
R14      EQU    14                                                      05500001
R15      EQU    15                                                      05510001
         CVT    DSECT=YES                                               05520003
         IEESMCA                                                        05530003
         IEFJESCT               JES CT                                  05540008
         IEFJSSIB               SSIB                                    05550008
         PRINT  GEN                                                     05560011
         IEFJSCVT               SSCT                                    05570007
         IEFJSSOB (VS,EN)                                               05580048
         IEFJSSVT               SUB SYSTEM VECTOR TABLE                 05590058
         PRINT  NOGEN                                                   05600011
         IEFTIOT1       TCBTIO  TIOT1 IN USING                          05610003
         IEZJSCB                IEZJSCB                                 05620003
         IHAPSA                                                         05630003
         IKJTCB                 TCB                                     05640003
         DCBD  DSORG=PS,DEVD=DA                                         05640004
         END                                                            05650001

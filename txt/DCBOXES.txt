         TITLE 'BOXES - in PRINT etc'                                           
Requesting Boxes                                                                
----------------                                                                
                                                                                
Boxes are produced by DDPRINT, under the control of specifications set          
up in an external interface. The dsect for this area is named BOXD, and         
is contained in member DDBIGBOX. The csect is included within DDPRINT.          
Fields within BOXD are principally concerned with boxes, but some have          
wider uses and are effective even when boxes are not.  For example              
BOXWIDTH controls the line width which defaults to 132, but can be up to        
264. Some fields are used to specify the font to be used for a line, and        
some to control shading, striping and patterning of output, with or             
without boxes.                                                                  
                                                                                
Boxes will only be produced if BOXYORN is set to C'Y' and BOXOFF is NOT         
set to C'Y'. These two fields initially contain nulls so boxes are not          
produced unless requested.                                                      
                                                                                
Two of the fields in the BOXD dsect are BOXCOLS, whic has a character           
for each column of the output page, and BOXROWS, which has a character          
for each line of a page.  Using these fields as a kind of grid, the             
basic structure of a box on a page can be defined by indicating where           
the sides, top and bottom will be and where any vertical and fixed              
horizontal lines will appear. PRINT will produce the box using these            
specifications by merging box characters into blank positions on each           
print line. The only variable is the line on which the bottom of the box        
appears. This will be as defined in BOXROWS, unless a page skip occurs          
before the bottom is reached, in which case a box bottom is floated in          
before the skip.                                                                
                                                                                
PRINT will translate multiple line skips into a single skip and generate        
any extra blank lines so that the vertical form of the box is not broken        
up.                                                                             
                                                                                
Since PRINT only merges box characters into blank print positions, the          
caller must be careful to define the box rules clear of used print              
positions, and take care not to move print data into box positions.             
Where a horizontal line is to be drawn, the caller should print a blank         
line, or at least one with no data where the rule will go.                      
                                                                                
Most applications do not call PRINT directly, but instead use PRINTER           
which provides page and line count handling, headings, sub-headings and         
so forth. Printer in turn calls PRINT to handle the printing of any             
additional heading lines it generates as well as the users print lines.         
                                                                                
It is most common to start the top of a box below the main heading line         
and before the generated column headings, and to rule a horizontal              
seperator below the last column heading, but before the first detail            
line in the box. PRINTER seperates heading line groups with a blank             
line, which is most convenient for box purposes. The exact positions of         
the blank seperator lines depend on the heading contents, but it is easy        
to determine which rows they appear on, and to set accordingly the              
positions in BOXROWS of the box top and any horizontal rules among the          
column headings.                                                                
                                                                                
The positions of horizontal rules, if any, within the body of the box is        
likely to depend on the data being printed, as is the position of the           
box bottom.  PRINT will never place any box characters below the                
position of the final box bottom in BOXROWS, so one could accidently            
chop off a box too early. It is generally best, therefore, to place a           
box bottom in a BOXROWS position which is logically below the bottom of         
the page to ensure complete boxes. In any case a bottom is                      
automatically floated in on a page throw. The exception might be to             
allow for footings or suchlike, which would mean defining the bottom            
above the first footline position, and needs some precision.                    
                                                                                
Horizontal rows, as well as bottoms and subsequent tops on the same             
page, can all be floated in under calling program control according to          
the data being printed. Unless their row positions are known in advance         
(and except for the heading rules and the final box bottom) there is,           
therefore, little point in defining the positions of horizontal rules in        
BOXROWS.                                                                        
                                                                                
If a box bottom is processed, either being reached in BOXROWS or floated        
in at the callers request, no further box characters appear on the page.        
The box is considered 'closed'.  As long as a subsequent box bottom             
remains in BOXROWS, a new box can be opened at any time on the same page        
by being either floated in at the callers request, or reached in                
BOXROWS.                                                                        
                                                                                
Print is able to keep track of the box structure from one line to the           
next, and if required, the caller can change the shape of the box more          
or less as he pleases. It is easy to introduce new columns or to drop or        
merge columns and PRINT will look after the tidying up of any loose             
verticals that might otherwise result by extending horizontal lines to          
either side to join up with any adjacent verticals. The correct box             
junctions are always used to provide clean joins.                               
                                                                                
BOXROWS                                                                         
-------                                                                         
                                                                                
BOXROWS is set up using combinations of characters to indicate the lines        
on which to print the horizontal rules for the box.                             
                                                                                
Horizontal rules are drawn from the left edge to the right edge of a            
box. If there is more than one box across a page, the horizontal rule           
will continue through each of them, but not the space between.  PRINT           
supports nested boxes, ie boxes inside other boxes (see under BOXCOLS).         
Horizontal rules will pass right through inner boxes.  Appropriate joins        
are always made to any vertical lines.                                          
                                                                                
Each position in BOXROWS maps to a line (or row) on the page, with the          
first BOXROWS character corresponding to the line reached by a channel 1        
skip.                                                                           
                                                                                
The following BOXROWS characters can be used.                                   
                                                                                
C'T'  Indicates the top edge of a box.  If the current line has this            
      character, DDPRINT will start all boxes defined in BOXCOLS (even          
      if they are already started).                                             
                                                                                
C'B'  Indicates the bottom edge of a box.  If the current line has this         
      character, and boxes have been started, they will be ended. If            
      they have already been ended, or were never started, this                 
      character is ignored.                                                     
                                                                                
      Even if the box will always be closed explicitly using BOXREQ (as         
      described later), a bottom should be defined on, or anywhere              
      after, the last line on which a box may be open, otherwise the            
      results may not be as expected.                                           
                                                                                
C'M'  Indicates a horizontal rule within boxes. If the current line has         
      this character and no boxes have been started, it will be                 
      ignored. The rule is drawn only within the bounds of the boxes            
      defined in BOXCOLS.                                                       
                                                                                
C'D'  Indicates a dotted horizontal rule within a box, behaves as C'M'.         
                                                                                
Any other character is set to either a blank or a hyphen. Blanks are            
used outside boxes, that is before a box top and after a box bottom, and        
between a box bottom and a later box top.  Hyphens are used within              
boxes, that is after a box top, but before the next box bottom.                 
                                                                                
In BOXROWS, a sequence such as 'T T    B B', has no special meaning in          
respect of box nesting which is handled using BOXCOLS. Such sequences           
are handled as seen. In the example, two tops would be generated, the           
second rather disjointedly. Only the first bottom would be used, the            
second would be ignored unless a new box had been opened by the caller          
in the meantime.                                                                
                                                                                
BOXCOLS                                                                         
-------                                                                         
                                                                                
Regardless of the contents of BOXCOLS, PRINT will not merge any box data        
into a line, nor will it attempt to close a box at a page skip if there         
isn't one open.                                                                 
                                                                                
BOXCOLS is set up using combinations of characters to indicate which            
columns are to contain the vertical rules for the box.                          
                                                                                
Each column on the page maps to a position in BOXCOLS.                          
                                                                                
The following BOXCOLS characters can be used.                                   
                                                                                
C'L'  These indicate that the column is to form the left or right edge          
and   of a box, respectively. DDPRINT supports more than one box on a           
C'R'  line, and can also support 'nested' boxes, meaning boxes enclosed         
      within other boxes up to any depth. Each C'L' encountered by              
      DDPRINT increases by one the depth of nesting, while each C'R'            
      decreases it by one. Thus a string of the form 'L L R R L R'              
      defines two outer boxes, the first of which encloses an inner             
      box. Horizontal rules are drawn only within the limits of outer           
      boxes, they do not extend into the areas beyond and between them.         
                                                                                
C'C'  This indicates that the column is to form a vertical rule within          
      a box, typically as a column seperator.                                   
                                                                                
C'D'  This indicates that the column is to form a dotted vertical rule          
      within a box. It behaves exactly as a C'C'.                               
                                                                                
C'O'  This indicates that the column is to form an open left box edge.          
      It is treated as a C'L', but does not generate a vertical rule.           
      (Note there is no corresponding open right edge character).               
                                                                                
C'V'  This character indicates that the column is to form a vertical            
      line, outside of a box. If found within a box, it is changed to a         
      C'C'.  The line formed in this column has no crosses, T's or              
      corners, regardless of any horizontal being drawn within any              
      boxes on the same line, this contrasts with a C'C' placed outside         
      an outer box.                                                             
                                                                                
C'X'  This character indicates that a vertical rule defined previously          
      in BOXCOLS is to be terminated without ruling off.  Its use is            
      described under 'changing BOXCOLS'. This is a 'one shot'                  
      character and is always reset to a hyphen or blank before                 
      returning to the caller.                                                  
                                                                                
Any other character is set to either a blank or a hyphen. Blanks are            
used outside outer boxes, and hyphens are used within outer boxes.              
                                                                                
BOXSTAT                                                                         
-------                                                                         
                                                                                
The current state of the box is held in BOXSTAT.  If this field                 
indicates that a box is NOT open, no box characters will be merged with         
the line until a box top is processed, in other words, any BOXROWS              
character for subsequent lines is ignored except for a box top (C'T'),          
and all BOXREQ requests are ignored except for open (C'O').  DDPRINT            
itself relies on BOXSTAT when deciding if it is in a box or not, and if         
it must close a box before a page skip.                                         
                                                                                
The following values may be returned in BOXSTAT, and are maintained by          
DDPRINT even if boxes are disabled by BOXOFF or BOXYORN.                        
                                                                                
C'I'  In a box. A box top has been processed on this page, thus opening         
      the boxes, but no box bottom has been encountered since.  NOTE,           
      if BOXCOLS is all blank, no boxes appear, but BOXSTAT could               
      nevertheless show a status of C'I'                                        
                                                                                
C'B'  Before a box.  No box is currently open, and the first box top on         
      the page, as defined in BOXROWS, has yet to be reached.                   
                                                                                
C'A'  After a box. The last box bottom on the page, as defined in               
      BOXROWS, has been passed, and there is no box currently open.             
                                                                                
C'T'  BeTween boxes. The first box top on the page has been reached,            
      but not yet the last box bottom, i.e we are within the vertical           
      limits of the box(es) on this page, as defined in BOXROWS.                
      However, no box is currently open. This value would be returned           
      if a box had been closed before reaching the last box bottom in           
      BOXROWS.  If there is room, another box could be opened on the            
      same page.                                                                
                                                                                
BOXNEXT                                                                         
-------                                                                         
                                                                                
The BOXROWS character which will be used on the next non-skip call to           
DDPRINT is returned in BOXNEXT. This field is always maintained by              
DDPRINT even if boxes are disabled by BOYOFF and BOXYORN, and can be            
used to test if PRINT is about to do something special boxwise.                 
                                                                                
BOXBLANK                                                                        
--------                                                                        
                                                                                
DDPRINT, when closing a box on a page skip, normally prints the users           
line followed by an extra blank line into which it merges the box               
bottom. For those applications which perform channel skips by issuing a         
BC01 ('print before skip'), against a blank line, this gives an unwanted        
blank line immedately before the end of the box.                                
                                                                                
Such applications can set BOXBLANK to C'N', which will cause DDPRINT to         
merge the box bottom directly into the passed (normally blank) print            
line and then perform the requested skip action. This eliminates the            
extra blank line before the box bottom.                                         
                                                                                
DDPRINTER performs BC01 skips and so applications which use it can use          
this feature.                                                                   
                                                                                
BOXBLANK is not reset by DDPRINT.                                               
                                                                                
                                                                                
BOXREQ (overriding BOXROWS and requesting special actions)                      
---------------------------------------------------------                       
                                                                                
DDPRINT can be asked to perform certain 'row-level' box actions on the          
current print line by setting BOXREQ.  This field is honoured only on           
line level requests. For channel level requests, DDPRINT takes the              
default action of first closing an open box.  If this field is used, it         
overrides any action defined in BOXROWS for the current line.                   
                                                                                
BOXREQ can be set to any of the following values, and is always reset to        
a space by DDPRINT before returning to the caller.  Note that no extra          
blank line is generated by DDPRINT, box characters resulting from the           
request are merged into the print line passed.                                  
                                                                                
C'B'  Indicates that a horizontal rule is to be drawn as if the BOXROWS         
      value for this line contained the character 'M' for mid.  It is           
      ignored if BOXSTAT is not C'I'.                                           
                                                                                
C'D'  Indicates that a dotted horizontal rule is to be drawn as if the          
      BOXROWS value for this line contained the character 'D' for               
      dotted mid.  It is ignored if BOXSTAT is not C'I'.                        
                                                                                
C'O'  Open the box, i.e.  a box top is drawn as if the BOXROWS value            
      for this line contained the character 'T' for top. BOXSTAT will           
      be set to 'I' indicating Inside a box. DDPRINT will therefore             
      consider a box is currently open, and will close it on the next           
      page skip if it has not been closed in the meantime.                      
                                                                                
C'C'  Close the box, i.e.  a box bottom is to be drawn as if the                
      BOXROWS value for this line contained the character 'B' for               
      bottom.  A close request is ignored if BOXSTAT is not C'I'.               
      BOXSTAT will be set to 'T', 'A' or 'B' as appropriate indicating          
      not inside a box, and DDPRINT will therefore consider that NO box         
      is currently open.  Further lines can be printed below the box            
      and DDPRINT will not merge box characters into them.                      
                                                                                
      The box can be reopened later on the same page by using                   
      BOXREQ=C'O'.  DDPRINT will also open a new box if it subsequently         
      processes a line whose BOXROWS character is a 'T'.  DDPRINT does          
      not attempt to close a box on a page throw, unless BOXSTAT                
      indicates that one is open.                                               
                                                                                
C'N'  New box. This indicates that BOXCOLS has been changed since the           
      last call and DDPRINT is to sort out any loose ends. Only the             
      minimum amount of horizontal rule is used in this case. The other         
      BOXREQ values, which all produce horizontal rules, automatically          
      respond to a change to BOXCOLS  so C'N' need only be used if a            
      full horizontal line is not required.  It is ignored if BOXSTAT           
      is not C'I'.  Further details of this request appear under                
      'Changing BOXCOLS'.                                                       
                                                                                
Any other character in BOXREQ is ignored, and DDPRINT will process the          
line according to its corresponding BOXROWS character.                          
                                                                                
BOXHOOK                                                                         
-------                                                                         
                                                                                
BOXHOOK is normally zero, but can be set to the address of a user hook.         
DDPRINT will call this hook whenever it is about to merge box data into         
a print line. The hook can be used to modify fields in BIGBOX. The              
advantage of this hook is that it is called for every line, including           
blank lines generated due to multiple line skips. It is the only simple         
way for a user program to make modifications to the box structure during        
the printing of heading lines by, for example, DDPRINTERL or SPOOL              
and can also be used to intercept box bottoms generated at a page skip.         
                                                                                
The parameters passed are as follows.                                           
                                                                                
P1, byte 0      This contains the 'row' character for the line being            
                printed. It will be any of the values valid for                 
                BOXROWS, ie. T, M, D, B, '-' or blank. It may actually          
                be the BOXROWS character for the current line, or it            
                may have been caused by a non-blank BOXREQ, or by               
                DDPRINT performing an automatic close on a page skip.           
                The hook can change this character to any of the other          
                valid BOXROWS characters, if required.                          
                                                                                
P1, bytes 1-3   Contains the address of the line into which the box             
                data will be merged.This line is in DDPRINT's working           
                storage. It may be a copy of the users print line or            
                one generated by DDPRINT or by the PRINTER-type module          
                during its new page process.                                    
                                                                                
P2, byte 0      This always contains a copy of DDPRINT's internal               
                linecount, as used to index into BOXROWS. It can be             
                used for example to determine exactly which heading             
                line is about to be printed so modifications can be             
                made to the box structure between headlines.                    
                                                                                
P2, byte 1-3    Contains the address of BOXD.                                   
                                                                                
The hook is intended to allow the application to change BOXCOLS and/or          
BOXLASTL (the saved copy of BOXCOLS from the last line) according to the        
line being printed, thereby allowing fancy box structures amongst               
heading lines for example. The 'row' value can be changed to cause a box        
line to be drawn, or a box to be opened or closed, or whatever. If              
BOXCOLS and BOXLASTL need to be set to the same value, be sure to set           
BOXINIT to null, or the change will not be noticed.                             
                                                                                
If a full horizontal rule is NOT required, and BOXCOLS is changed by            
the hook, BOXREQ must be set to C'N', otherwise the old and new boxes           
will not be correctly joined. C'N' is the only value that the hook can          
place in BOXREQ, and then it is only neccessary and effective if the            
'row' type is c'-' ie not a horizontal rule.                                    
                                                                                
Any other BOXREQ type action that the user wants to use must be                 
requested by returning the appropriate BOXREQ character in P1, byte 0           
and not in BOXREQ.                                                              
         EJECT                                                                  
Changing BOXCOLS.                                                               
----------------                                                                
                                                                                
If not processing a 'minibox scheme', DDPRINT now saves the contents of         
BOXCOLS in BOXLASTL (and BOXCOLSR in BOXLASTR) before returning to the          
caller.  This means that a change made to BOXCOLS between calls will be         
recognized and appropriate action taken.                                        
                                                                                
The first action taken is to rescan BOXCOLS substituting with hyphens,          
blanks etc. as specified under 'BOXCOLS' above.  Since BOXLASTL may also        
be modified, this is also rescanned.                                            
                                                                                
When processing a box top, DDPRINT will always use BOXCOLS for its              
column definition, ignoring the definition saved in BOXLASTL, since it          
is not relevant to the new box.  In this case no special action is              
required to handle any changes made to BOXCOLS.                                 
                                                                                
When processing a box bottom, the saved definition is always used since         
it is the one which carries the latest definition of the box being              
closed. BOXCOLS is not used, but is still reinitialized if changed.             
                                                                                
When processing a mid line or dotted mid line within an open box, and           
BOXCOLS has been changed, the old and new column structure will be              
compared and the horizontal rule drawn such that all loose ends are             
correctly tied up. The following points are attended to.                        
                                                                                
 - Outer boxes which have been removed, are closed off with a line as a         
   normal box bottom would be.  Similarly, boxes which have been added          
   are opened.                                                                  
                                                                                
 - Where a change is made to the position of a left or right box edge,          
   the horizontal line is extended to join the old and new positions.           
                                                                                
 - Any inserted or deleted columns are correctly ended using top or             
   bottom T's as appropriate.                                                   
                                                                                
A dotted mid line is not appropriate for sections resulting from the            
first two cases which form part of the outer boundary of a box.  Solid          
lines are always substituted in these sections.                                 
                                                                                
In all cases, joins at vertical and horizontal intersections are made           
using the correct corner, 'T' or cross peices.                                  
                                                                                
If processing any other line within a box, which is not a top, bottom or        
mid, the default action is to ignore the old BOXCOLS definition and             
process the line using only the new values.  This can leave verticals           
hanging in mid air, and is fine if that is what is required.  If,               
however, BOXREQ is set to C'N', DDPRINT will insert any horizontal rules        
required to tidy up loose ends. These rules will not extend any further         
than the next vertical rule, which may be contrasted with the drawing of        
a complete mid line at a change of BOXCOLS as described before. Of              
course, all joins at vertical and horizontal intersections are made             
using the correct corner, 'T' or cross peices.                                  
         EJECT                                                                  
The following illustrates some of the changes that are possible.                
                                                                                
 - a vertical (C'C' or C'D') can be removed or inserted, a horizontal           
   line is drawn to either side as far as the next vertical line or             
   edge.  The line will be dotted if the new/deleted vertical is/was            
   dotted.                                                                      
                                                                                
   Example                                                                      
                                                                                
   +-----+-----+-----+                                                          
   |     |     |     |                                                          
   |     |     |     |                                                          
   +-----+-----+     |                                                          
   |           |     |                                                          
   |           |     |                                                          
   +-----------+-----+                                                          
                                                                                
 - a left or right edge can be moved in either direction.  A solid              
   horizontal line is drawn between the old and new position. At the            
   same time, the original edge can be turned into a center vertical,           
   while moving the new edge further out, thus creating a new column.           
                                                                                
   Example                                                                      
                                                                                
   +-----+-----+-----+                                                          
   |     |     |     |                                                          
   |     |     |     |                                                          
   |     |     |     +-----+                                                    
   |     |     |           |                                                    
   |     |     |           |                                                    
   +-----+-----+-----------+-----+                                              
         |     |           |     |                                              
         |     |           |     |                                              
         +-----+-----------+-----+                                              
                                                                                
 - a complete box can be removed or inserted by removing or inserting           
   its left and right edges and any contained centers. See below under          
   'nesting boxes'. Such a box will be properly closed off or opened.           
                                                                                
   Example                                                                      
                                                                                
   +-----------------+                                                          
   |                 |     +-----+-----+-----+                                  
   |   +---------+   |     |     |     |     |                                  
   |   |         |   |     |     |     |     |                                  
   |   +---------+   |     |     |     |     |                                  
   |                 |     +-----+-----+-----+                                  
   +-----------------+                                                          
                                                                                
 - any combination of the above should work, and no vertical will be            
   left hanging, especially, the outer bounds of outer boxes will               
   remain solid, ie no holes. Inner box tops or bottoms will not be             
   continuous if more than one vertical line passes through them.               
         EJECT                                                                  
 - if hanging verticals are required, a special character 'X' is used.          
   If this is inserted in BOXCOLS in place of a C'C' or C'D', a                 
   horizontal will not be generated in either direction, however                
   adjacent deleted columns may produce horizontals which could reach           
   the "X'ed" vertical from either direction. Note X is deleted after           
   use.                                                                         
                                                                                
   Example                                                                      
                                                                                
   +-----+-----+-----+                                                          
   |     |     |     |                                                          
   |     |     |     |                                                          
   |           |     |                                                          
   |           |     |                                                          
   +-----------+-----+                                                          
                                                                                
DDPRINT is perfectly happy to be conned by modifying the saved copy of          
BOXCOLS in BOXLASTL, either as well as or instead of BOXCOLS itself.            
This requires a little thought and can enable some pretty adventurous           
box structures.                                                                 
                                                                                
The simplest reason for modifying BOXLASTL is to accomplish the reverse         
of the above "X'ed" column, where instead of replacing a C'C' in BOXROWS        
with a C'X' to cancel a column without ruling off, a new C'C' can be            
added to BOXCOLS and a C'X' inserted in the corresponding place in              
BOXLASTL.  This will start a new vertical without ruling to right and           
left.                                                                           
                                                                                
Since DDPRINT recognizes a change to either BOXCOLS or BOXLASTL by              
comparing the two, it follows that if they are both changed to the same         
thing, the change will be missed, and they will not be rescanned.  If           
they are to be changed to the same value, it is better to change BOXCOLS        
only and then to set BOXINIT back to zero. This forces BOXCOLS to be            
rescanned and copied to BOXLASTL.                                               
                                                                                
A useful feature is the ability to cause a horizontal rule to rule off          
only selected columns. This can be done by setting up a box in the usual        
way, eg. BOXCOLS='L C C C R'. As soon as the box is open, change BOXCOLS        
to 'L C C R V', and BOXINIT to zero.  Thereafter, each box line drawn           
will pass through only the first three of the four columns. Before the          
box is closed, BOXCOLS must be changed back to 'L C C C R', and BOXINIT         
zeroed again. Since the box will be closed automatically at end of page,        
you have to watch the line count, and anticipate the close, perhaps by          
using BOXHOOK.                                                                  
         EJECT                                                                  
Nesting Boxes                                                                   
-------------                                                                   
                                                                                
When drawing a top, bottom or mid line, the left and right edges of             
inner boxes behave as if they are ordinary vertical rules (C'C's). Even         
when an inner box appears anew or is deleted, the effect, is still the          
same as if a pair of ordinary vertical rules had been added or removed.         
                                                                                
   Example                                                                      
                                                                                
     L     L     R     R                                                        
   T +-----+-----+-----+                                                        
     |     |     |     |                                                        
   C +-----+-----+-----+                                                        
     |     |     |     |                                                        
   B +-----+-----+-----+                                                        
                                                                                
However, when BOXREQ is set to C'N', and a new box (L and R) added to           
BOXCOLS within an existing box, the new inner box will be opened, quite         
independantly of the box in which it is contained.                              
                                                                                
   Example                                                                      
                                                                                
     L                 R                                                        
   T +-----------------+                                                        
     |                 |                                                        
     |     +-----+     |  -> New box left and right inserted.                   
     |     |     |     |                                                        
                                                                                
The reverse can be acheived by removing the inner box and setting BOXREQ        
to C'N'.                                                                        
                                                                                
   Example                                                                      
                                                                                
     L     L     R     R                                                        
     |     |     |     |                                                        
     |     +-----+     |  -> Inner box left and right removed.                  
     |                 |                                                        
   B +-----------------+                                                        
                                                                                
This effectively nests an inner box within an outer box, which would be         
opened and closed on different lines.  Taking this further, inner boxes         
can contain their own inner boxes, as well as their own vertical rules,         
independent of those in the outer box.  Outer box verticals can be made         
to continue across inner boxes or to stop at the top and continue from          
the bottom.                                                                     
         EJECT                                                                  
If you want even more excitement, a new outer box can be added outside          
an existing box, or an outer box can be removed from around an inner            
box, thus turning an outer box into an inner box or vice versa.  The            
horizontal rule forming the top or bottom of the outer box will not             
enter the continuing inner box.                                                 
                                                                                
   Example                                                                      
                                                                                
   +-----+----------------------+              +-----------+                    
   |     |                      |              |           |                    
   |     |    +-----------+     |              |           |                    
   |     |    |           |     |   +-----+----+           +-----+              
   |     |    |           |     |   |     |    |           |     |              
   +-----+----+           +-----+   |     |    |           |     |              
              |           |         |     |    +-----------+     |              
              |           |         |     |                      |              
              +-----------+         +-----+----------------------+              
         EJECT                                                                  
DDPRINTERL                                                                      
----------                                                                      
                                                                                
PCTLBOX is a field in the dsect DDDPRINT which can be set by the caller         
to request special box actions when printing any data line. It can take         
any of the values supported in BOXREQ, i.e.  C'B', C'O', C'N', C'D' or          
C'C'.                                                                           
                                                                                
For C'O', C'B', C'D' and C'N', The line count is checked to ensure there        
is space for the user's line(s) and an extra blank line as well.  If            
there is not room, a new page is started in the normal way and the box          
request is ignored.  MEREPPRINT prints an extra blank line, for DDPRINT         
to build the required box data, before printing the user's line(s).             
                                                                                
If there is room, an extra blank line is generated for DDPRINT to build         
the box line requested. The users line is then passed to DDRINT after           
the requested action is completed, which seems the most logical aproach.        
The line count is correctly updated.  This enables a box to be opened or        
a horizontal rule to be drawn immediately before printing a given line,         
and allows the box structure to be driven by the data to be printed.            
                                                                                
For C'C', the close request is issued using the user's line(s), no extra        
line is generated.  The line count is not checked, but is updated. NO           
page skip can occur with this action, the box is closed on the same             
page. If the line count does go high, the next call will cause a page           
skip in the normal way. If this happens, the box may be reopened                
automatically and if the caller intended to print data outside a box he         
must take action to prevent the box reopening (BOXOFF=Y), and to                
suppress any unwanted subheadings etc.                                          
                                                                                
Note that the close option is not needed to close a box before forcing a        
page throw. As before, this will be handled automatically, as will              
the re-opening of the box on the next page, as defined in BOXROWS.              
                                                                                
The use of PCTLBOX with PRINTER allows the user simply to set the field         
at any time, perhaps in isolation from the actual printing of a line,           
e.g when detecting a control break, knowing that the resulting box line         
will be printed on the current page before the next print line, unless          
there is no more room, when the box will be closed, and then reopened           
automatically on the next page.                                                 
                                                                                
MEREPPRINT (PRALL in MERLIN)                                                    
----------                                                                      
                                                                                
A field labelled CONTROLB in MEREPWORKD works in the same way as PCTLBOX        
in DDPRINTERL, ie any of the BOXREQ values can be placed in it.                 
                                                                                
A FINAL NOTE.                                                                   
------------                                                                    
                                                                                
DDPRINT always merges box data into blank spaces in a print line.               
Non-blanks are always left unchanged. This means that a box character           
can be suppressed if desired by inserting in its place in the line an           
unprintable character, usually a null.                                          
                                                                                
The lines into which horizontal box characters are merged may or may not        
be the users print line. The following gives some idea of which, when           
the usual 'print before advancing' control is used.                             
                                                                                
When boxes are active, DDPRINT converts all multiple line skips (but            
not channel skips) into a series of single line skips, with the users           
line being the FIRST one to be printed. The users line is therefore             
always the next line to be printed on a page. So, if the next line              
corresponds to a T, M, D or B in BOXROWS, horizontal box chars will be          
merged into the users line.                                                     
                                                                                
The extra blank lines, generated by DDPRINT to make up the required             
number of lines to be skipped, are printed AFTER the user's line and any        
of them may have horizontal box chars merged in, according to their             
corresponding BOXROWS character.                                                
                                                                                
The same applies when BOXREQ contains O, B, D, C or N. Horizontal box           
chars will be merged into the next line to be printed, which is the             
users line. In this case, the user might prefer to print a blank line,          
to receive the box characters, before his data line.  Remember that this        
applies to users calling PRINT directly, PRINTER users using PCTLBOX            
will find that PRINTER generates its own blank line first for this              
purpose, so avoiding the problem (except for a close request).                  
                                                                                
When DDPRINT is about to merge boxes into a line, be it the users line          
or any generated line, it will call the box hook if provided. At that           
point, the user can choose to cause a box line to be merged into the            
line and it is up to him to decide if the line is clear for him to do           
so.                                                                             
                                                                                
DDPRINTERL, MEREPPRINT, SPOOL and other print controllers will                  
themselves generate extra lines when processing headings, footings and          
page skips etc. It is up to the user to set up his BOXROWS in order to          
slip the box lines into the blank lines between headings etc.  He can           
make use of the box hook to do this dynamically if required. The hook           
will get control on every line generated by the print controller and            
every line generated in turn by DDPRINT.                                        
         EJECT                                                                  
Summary of BOXD fields                                                          
----------------------                                                          
                                                                                
BOXYORN  Indicates boxes are to be produced if set to C'Y', Initially           
         null.  Any value but C'Y' will prevent boxes being produced,           
         box status and page position is maintained so boxes can be             
         turned on and off at any time.                                         
                                                                                
BOXWT    Not referenced by DDPRINT                                              
                                                                                
BOXINIT  Initially null, set to 1 when BOXCOLS and BOXLAST have been            
         scanned This field should be left alone, unless you want to            
         force PRINT to rescan BOXCOLS. It will automatically do this           
         if BOXCOLS or BOXLAST are changed, but will not notice if the          
         same change is made to both.                                           
                                                                                
BOXLOW   During initialization, PRINT sets these to the row number of           
and      the first 'top' and last 'bottom' in BOXROWS. They therefore           
BOXHIGH  indicate the vertical limits of any boxes on the page. They            
         should not be changed.                                                 
                                                                                
BOXOFF   This field is used to disable boxes while some other output is         
         printed (LOGOS uses it for example). If the field is set to            
         C'Y', boxes will be disabled. It will not take effect until            
         the next page skip so that any open boxes can be properly              
         closed.                                                                
                                                                                
BOXMINI  If set to C'Y', a minibox scheme is in use. Miniboxes are              
         completely independent of boxes, which are disabled while              
         miniboxes are operating.                                               
                                                                                
BOXREQ   See description in text.                                               
                                                                                
BOXCOLS  See description in text.                                               
                                                                                
BOXROWS  See description in text.                                               
                                                                                
BOXSHADE Used for shading, with or without boxes.                               
BOXSHCH1 As above                                                               
BOXSHCH2 As above                                                               
BOXFLASH As above                                                               
BOXAPAT  As above                                                               
                                                                                
BOXABLOW Contains V(BLOWUP), not referenced by DDPRINT                          
                                                                                
BOXWIDTH Defines maximum width of print line. Can be up to 264                  
         characters, and defaults to 132. Sets SYSPRINT LRECL and can           
         be changed at any time, but causes the print DCB to be                 
         reopened. If BOXOFF=Y, print lines are truncated to 132 chars.         
                                                                                
BOXMAXL  Not referenced by DDPRINT                                              
                                                                                
BOXOFFST If not null, indicates offset by which users line is shifted           
         to right before printing. Line is shifted after box characters         
         are merged in, so boxes shift with user data. Relies on BOX-           
         WIDTH being 132 or less, characters shifted beyond 132 lost.           
                                                                                
BOXOPTCD If set to C'J', indicates OPTCD=J to be used for SYSLIST DCB.          
         PRINT will prefix print lines with font number given by either         
         BOXFONT or BOXHEADF.  If changed, DCB will be reopened.  User          
         does NOT need to allow space in front of line for font number.         
                                                                                
BOXFONT  If BOXOPTCD=J, this gives binary font number to be used for            
         the current line, must be 0, 1, 2 or 3. Ignored if BOXHEADF            
         is not zero                                                            
                                                                                
BOXHEADF If BOXOPTCD=J, this indicates the line number down to which            
         bold headings are required. Font 0 is used for lines numbered          
         below this value, font 1 is used for all others.                       
                                                                                
BOXBLANK See description in text.                                               
                                                                                
BOXSTAT  See description in text.                                               
                                                                                
BOXNEXT  See description in text.                                               
                                                                                
BOXHOOK  See description in text.                                               
                                                                                
BOXAWIDE Contains V(WIDE), not referenced by DDPRINT.                           
                                                                                
BOXLAST  Used with boxes and miniboxes to save contents of BOXCOLS.             
         Can be modified for special box effects as described in text.          
                                                                                
BOXSCORL Used with minboxes.                                                    

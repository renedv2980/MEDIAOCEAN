Document desribing DXTRACT, the mainframe system file EXTRACT program           
---------------------------------------------------------------------           
By JOMUDDLO 31/10/94.              See PAN.SYSTEMS.LIBRARY(DCEXTRACT)           
---------------------              ----------------------------------           
                                                                                
Introduction                                                                    
------------                                                                    
   The following is a description of the DDS System file offline                
extract control program DXTRACT. This acts as a generalised controller          
calling system specific sub programs as loaded phases. Data is                  
extracted from the mainframe Facpak system files, converted into                
'flat' format records and written to an MVS data set for eventual               
update of the target PC server data bases, (e.g. SQL database.)                 
The system specific sub program has the responsibility of extracting            
the sub set of data required and converting it to a format tailored             
to suit the particular remote PC application. The sub programs are              
custom written by the application programmer. The program DXTRACT               
provides a generalised shell within which the sub programs operate.             
   DXTRACT operates in Load or Update mode. Load mode is intended               
to call that part of system sub program which extracts database                 
initialisation data records directly from the system files.                     
Update mode passes system recovery file records at periodic intervals           
from every hour to daily update cycles. The process insures that no             
overlap with previous passes of the recovery file occur. System                 
recovery file records are passed one at a time to the sub system                
program in update mode which then filters and converts data                     
as required. Any resulting record is then written with a 'PUT'                  
style interface to the MVS data set opened by DXTRACT.                          
   DXTRACT in Update mode can also read records from Tape file                  
backups of previous days recovery files.                                        
   The MVS data set is written with Header and Trailer records                  
which define information used to control transfer and update                    
of the data on the remote PC/ESS destination. This data is derived              
from Xtract transfer control records on the CON/GEN file, AKA                   
'SQLPAK', which including XAGENCY, XFILE, XTRANS, XAPPL and XLOG                
records. These Xtract transfer control records are updated to indicate          
when file is awaiting transfer to PC/ESS destination.                           
The EXTRACT system is designed to operate in conjunction with                   
the HOSTESS mainframe program which manages transfer of files                   
from the mainframe HOST system to ESS destination applications                  
through APPC interfaces.                                                        
                                                                                
         EJECT                                                                  
Configuration                                                                   
-------------                                                                   
                                                                                
   EXTRACT control records are maintained in the FACPAK CONTROL                 
GENERAL file system using online program CONTROL/GEN.                           
Records can be Added, Displayed, Changed, Deleted and Listed.                   
These include the following.                                                    
                                                                                
XAGENCY record                                                                  
--------------                                                                  
    This record is set up to define a specific sub set of system file           
data for Extract. This is defined with a hierarchical key by agency             
FACPAK system and extract sub system. This can be associated with               
an entry in the DXTRACT table which points to the sub system extract            
program. Information in this record is passed as parameters to the sub          
system extract program.                                                         
                                                                                
Key fields:                                                                     
Alpha id          - 2 character agency alpha id 'ACCESS' record key.            
System            - 7 character FACPAK system id. E.g. MEDIA, ACCOUNT.          
                    As defined in FASYSLST and FASYSLSTD.                       
Sub system        - 7 character EXTRACT sub system id.                          
                    As defined in DXSUBLST and DXSUBLSTD.                       
                                                                                
Data fields:                                                                    
Level number      - 1 .. 255 EXTRACT sub system level number.                   
Version umber     - 1 .. 255 EXTRACT sub system version number.                 
Type              - 3 character record type filter code.                        
                    Depends on sub system extract module.                       
                    Default to 'ALL'.                                           
Filter            - 3 character filter code.                                    
                    Depends on sub system extract module.                       
                    Default to blanks.                                          
Primary size      - Primary size in Tracks of MVS data set allocation.          
Secondary size    - Secondary size in Tracks of MVS data set                    
                    allocation.                                                 
Frequency code    - 1 character code. Used to govern frequency or rate          
                    of data extract from the system recovery files.             
                    Default to 'E' for every hour.                              
Frequency time    - Time. Optional addictional parameter used with              
                    'Frequency code' to govern rate of extract.                 
                    Default to 'E' for every hour.                              
File Generation # - Current generation sequence number of last file             
                    of extract data allocated for this agency                   
                    subsystem.                                                  
Encryption key    - 10 characeter password encryption key.                      
                    used in level 1.1 and above to encrypt passwords.           
                                                                                
         EJECT                                                                  
XTRANS record                                                                   
-------------                                                                   
    This record is set up to associate a set of Extract data as                 
defined in the XAGENCY record with a specific detination ESS id.                
Information in this record is used to control transfer of the                   
extract file to the remote ESS system.                                          
More than ONE XTRANS record can be set up for a given XAGENCY                   
record. I.e. A given EXTRACT file can be transferred to more than               
one destination ESS id.                                                         
                                                                                
Key fields:                                                                     
ESSid id          - 8 character ESid 'ESSNNNNN', NNNNN is ESS id #.             
Alpha id          - 2 character agency alpha id 'ACCESS' record key.            
System            - 7 character FACPAK system id. E.g. MEDIA, ACCOUNT.          
                    As defined in FASYSLST and FASYSLSTD.                       
Sub system        - 7 character EXTRACT sub system id.                          
                    As defined in DXSUBLST and DXSUBLSTD.                       
                                                                                
Data fields:                                                                    
Frequency code    - 1 character code. Used to govern frequency or rate          
                    of data transfer to the ESS partner.                        
                    Default to 'E' for as soon as detected.                     
                    I fset to 'N' extract sub system file transfers             
                    to this ESS id are inhibited.                               
Frequency time    - Time. Optional addictional parameter used with              
                    'Frequency code' to govern rate of transfer                 
Transfer mode     - 1 character code. Not yet implemented.                      
Load control      - Parameter to control action on database update              
                    0 or, nothing default                                       
                    1 - Clear remote database update system for reload.         
                    2 - Clear and reload databse without check point            
                    This parameter is under developement                        
Last file transfer numbers processed.                                           
Created           - Transfer number for last file created                       
Notified          - Transfer number for last file notified to ESS               
Received          - Transfer number for last file received by ESS               
Committed         - Transfer number for last file committed by ESS              
                                                                                
         EJECT                                                                  
XAPPLIC record                                                                  
--------------                                                                  
    This record is set up to associate a set of Extract transfer                
data as defined by the XAGENCY and an associated XTRANS record                  
with a specific PC network destination application.                             
Information in this record is built into the EXTRACT file header                
which can be read at the ESS destination after file transfer.                   
More than ONE XAPPLIC record can be set up for a given XAGENCY/XTRANS           
record. I.e. A given EXTRACT file transferred to a given ESSId can be           
used to update more than ONE application or server database on the              
PC network system.                                                              
                                                                                
Key fields:                                                                     
ESSid id          - 8 character ESid 'ESSNNNNN', NNNNN is ESS id #.             
Alpha id          - 2 character agency alpha id 'ACCESS' record key.            
System            - 7 character FACPAK system id. E.g. MEDIA, ACCOUNT.          
                    As defined in FASYSLST and FASYSLSTD.                       
Sub system        - 7 character EXTRACT sub system id.                          
                    As defined in DXSUBLST and DXSUBLSTD.                       
Application id    - 8 character applciation id key. Used to uniquely            
                    distinguish different PC destination applications           
                    in APPC transactions with the asscociated ESS id.           
                                                                                
Data fields:                                                                    
Program name      - 32 character application program name.                      
                    Optional name of a program on the PC network that           
                    is responsible for processing extract data.                 
Program parameters- 48 character application program parameters.                
                    Optional command line program parameters for above.         
Server name       - PC network server name                                      
Database name     - PC network server database name                             
User id           - PC network server user id with valid access                 
Password          - PC network server password with valid access                
                                                                                
         EJECT                                                                  
XFILE record                                                                    
------------                                                                    
    This record is created when a set of Extract sub system data                
as defined by the XAGENCY is extracted and written to an MVS data set           
by the DXTRACT process. This can occur in either LOAD or UPDATE mode.           
DXTRACT also reads the associated XTRANS and XAPPLIC records and                
this information is included in the XFILE record for cross reference.           
Also several passive pointers are written for reference durring the             
file transfer processes. This information on the XFILE record is                
updated durring the progress of extract file transfer to ESS.                   
    Information in this record is built into the EXTRACT file header            
which can be read at the ESS destination after file transfer.                   
A given extract file can have more than ONE ESSid destination and               
information describing the progress of extract file transfer to each            
associated ESSid can be disaplayed on an additional screen which can            
be selected from a list on the main XFILE DISPLAY screen.                       
Also the XFILE record has a special ACTION 'TRANS' which displays an            
alternatively ordered list of EXTRACT file to ESSid Transfer status             
information.                                                                    
                                                                                
Key fields:                                                                     
Alpha id          - 2 character agency alpha id 'ACCESS' record key.            
System            - 7 character FACPAK system id. E.g. MEDIA, ACCOUNT.          
                    As defined in FASYSLST and FASYSLSTD.                       
Sub system        - 7 character EXTRACT sub system id.                          
                    As defined in DXSUBLST and DXSUBLSTD.                       
Application id    - 8 character application id key. Used to uniquely            
                    distinguish different PC destination applications           
                    in APPC transactions with the asscociated ESS id.           
Either:                                                                         
Date created      - Date extract file was created.                              
Time created      - Time extract file was created.                              
Or:                                                                             
File Generation # - Generation sequence number of this file                     
                                                                                
Data fields:                                                                    
Type              - 3 character record type from XAGENCY record                 
Record number     - 8 digit number of records in extract file                   
                    (including Header and Trailer records)                      
Mode              - 1 character extrfact file mode                              
                    L - LOAD mode.                                              
                    U - UPDATE mode.                                            
Byte number       - 10 digit number of bytes in extract file                    
                    (including Header and Trailer records)                      
Money number      - 12 digit number of checksum value.                          
DSN               - MVS Data Set Name of extract file.                          
From Time         - Time in recovery file of first extracted                    
                    update record data                                          
To Time           - Time in recovery file of last extracted                     
                    update record data                                          
From DA           - Disk Address in recovery file of first extracted            
                    update record data                                          
To DA             - Disk Address in recovery file of last extracted             
                    update record data                                          
                                                                                
XFILE ESS transfer data list: (Variable length list of ESS destinations)        
Act               - Action input field, 'S' selects ESS data screen             
ESSid id          - 8 character ESid 'ESSNNNNN', NNNNN is ESS id #.             
ESSid id          - 8 character ESid 'ESSNNNNN', NNNNN is ESS id #.             
Transfer number   - 5 digit number. Fil etransfer number to this ESSid          
Date transfer     - Date transfer completed to ESSid                            
Time transfer     - Time transfer completed to ESSid                            
Date commit       - Date commit completed for ESSid                             
Time commit       - Time commit completed for ESSid.                            
Status            - Transfer status to ESSid.                                   
                                                                                
XFILE ESS data screen:                                                          
                                                                                
         EJECT                                                                  
XLOG record                                                                     
-----------                                                                     
System            - 7 character FACPAK system id. E.g. MEDIA, ACCOUNT.          
                    As defined in FASYSLST and FASYSLSTD.                       
Date              - Date recovery file read.                                    
Time              - Time recovery file read.                                    
                                                                                
         EJECT                                                                  
Operations                                                                      
----------                                                                      
                                                                                
Operator console commands and messages                                          
-------------------------------------                                           
                                                                                
Start command                                                                   
-------------                                                                   
   'S DXTRACC' - I.e. use appropriate PROC name as below.                       
                                                                                
Stop command                                                                    
------------                                                                    
   'P DXTRACC'                                                                  
   If this fails then cancel with 'C DXTRACC'                                   
                                                                                
Modify commands.                                                                
----------------                                                                
1) CLode down EXTRACT process.                                                  
------------------------------                                                  
   'F DXTRACC,CLOSE' Shutdown EXTRACT program reading to end                    
   of recovery files.                                                           
                                                                                
JCL, PROCS and PARMS.                                                           
---------------------                                                           
                                                                                
   PROCS                                                                        
   -----                                                                        
   DDS.PROCLIB(DXTRACC) - Live configuration for UK                             
   DDS.PROCLIB(DXTRACT) - Test configuration for UK                             
                                                                                
E.g.:                                                                           
//DXTRACC PROC PROG=DXTRACT,PARMS=DXTRACTS                                      
//DXTRACC EXEC PGM=&PROG,REGION=5M,TIME=1440,PARM=00000000                      
//LOADLIB   DD DSN=DDS.LOADLIB,DISP=SHR                                         
//STEPLIB   DD DSN=DDS.LOADLIB,DISP=SHR                                         
//*                                                                             
//CRADIR    DD DSN=MED.CRADIRA,DISP=SHR                                         
//CRAFIL    DD DSN=MED.CRAFILA,DISP=SHR                                         
//*XFILE1   DD DSN=XTR.DC.AGY,DISP=(SHR,KEEP)                                   
//*CVTAPE   DD DUMMY                                                            
//*CVTAPE   DD DSN=ACCTAPE.ACLDFAR(0),DISP=(OLD,KEEP,KEEP),UNIT=TAPE            
//*CVTAPE   DD DSN=MEDTAPE.MELDFAR(0),DISP=(OLD,KEEP),UNIT=3480,                
//*            FREE=CLOSE                                                       
//SYSOUT    DD SYSOUT=X                                                         
//SYSPRINT  DD SYSOUT=X                                                         
//SYSUDUMP  DD SYSOUT=X                                                         
//*                                                                             
//SYSIN     DD DSN=DDS.CNTL.CARDS(&PARMS),DISP=SHR                              
                                                                                
   PARMS                                                                        
   -----                                                                        
   DDS.CNTL.CARDS(EXMED8U) - Update configuration for UK MEDIA8/SQL.            
   DDS.CNTL.CARDS(EXMED8L) - Load configuration for UK D8 agency MEDIA.         
                                                                                
E.g.:                                                                           
PLATFORM=SYBASE                                                                 
SYSTEM=MEDIA=8                                                                  
MODE=UPDATE                                                                     
TYPE=AUTO                                                                       
CLOSE=YES                                                                       
/*                                                                              
//                                                                              
                                                                                
   JCL                                                                          
   ---                                                                          
   JOMU.DDS.JCL(EXMED8U) - Update configuration for UK MEDIA8/SQL.              
   JOMU.DDS.JCL(EXMED8L) - Load configuration for UK D8 agency MEDIA.           
                                                                                
E.g.:                                                                           
//JOMUXM8U JOB APPL,JOMU,MSGCLASS=X,MSGLEVEL=(1,1),NOTIFY=JOMU                  
//*MAIN  CLASS=SYSLONG                                                          
//        EXEC DXTRACC,PROG=DXTRACT,PARMS=EXMED8U                               
                                                                                
Job Control parameter cards                                                     
---------------------------                                                     
   DXTRACT can be executed with a variety of control cards as follows.          
                                                                                
PLATFORM=<Name of SQL database platform - can be used to control                
          conversion of data by sub system extract program.)                    
         e.g.  PLATFORM=SYBASE - Name is required.                              
SYSTEM=<Name of FACPAK SYSTEM>                                                  
         e.g.  SYSTEM=ACCOUNT - Name is required.                               
SUBSYS=<Name of extract sub system filter>                                      
         e.g.  SUBSYS=SQL     - Name should exist and is optional.              
                                See DXSUBLST and DXSUBLSTD.                     
AGENCY=<Agency Alpha id filter>                                                 
         e.g.  AGENCY=SJ      - Id should exist and is optional.                
MODE=<Extract mode code>      - Required                                        
         MODE=LOAD   - Load mode                                                
         MODE=UPDATE - Update mode                                              
TYPE=<Extract type code>      - Required                                        
         TYPE=AUTO - drive extract process from info on SQLPAK                  
                     extract transfer control records on CON/GEN file           
         TYPE=<Record filter code, e.g. TYPE=ALL>                               
PSIZE=<Primary size in tracks of extract MVS data set>                          
         e.g.  PSIZE=100                                                        
SSIZE=<Secondary size in tracks of extract MVS data set>                        
         e.g.  SSIZE=30                                                         
START=<'YES' or 'NO'>                                                           
         START=YES - Read updates from start of recovery file                   
         START=NO  - Read updates from last extracted record on                 
                     recovery file. Used if DXTRACT stopped before              
                     end of days activity.                                      
                     Optioonal, default START=NO.                               
CLOSE=<'YES' or 'NO'>                                                           
         CLOSE=YES - Read updates upto current end of recovery file             
                     and stop DXTRACT.                                          
         CLOSE=NO  - Continue to read updates from recovery file                
                     and specidied rate until DXTRACT is stopped.               
                     Optional, default CLOSE=NO.                                
FREQUENCY=<Time period or 'DAILY'>                                              
         FREQUENCY=<Time> - e.g. FREQUENCTY=3600 - Read recovery file           
                     every 3600 seconds, or 1 hour.                             
         FREQUENCY=DAILY - Read whole recovery file from beginning to           
                     end to extract all updates for a days activity.            
                     Optional, default FREQUENCY=3600                           
EXTRATIME=<Time period for which recovery reader reads forward                  
            to ensure all activity processed for last task in pass>             
         e.g. EXTRATIME=60 - Read forward in recovery file 60 seconds           
                     Optional, default EXTRACTIME=600                           
SLEEPTIME=<Time period for which DXTRACT goes to sleep or time                  
            between polls of operator console or when check for time            
            elapsed before next read of recovery file for update.>              
         e.g. SLEEPTIME=10 - Poll every 10 seconds                              
                     Optional, default SLEEPTIME=30                             
NAME=<'LONG' or 'SHORT')                                                        
         NAME=LONG  Default, MVS data set name produced.                        
         NAME=SHORT Shorter MVS data set name produced (Not gauranteed          
            to be unique. E.g. DDS.XTR.AA.ALL where AA is agency alpha.         
                     Optional, default NAME=LONG                                
TEST=<phase test character) Appended to susbsystem extract module               
         load library pahse name for testing purposes. E.g. TEST=A              
                     Optional.                                                  
SQL=< key name of SQL BOOK record> reads records directly from SQL              
         type BOOK record on control file and appends lines to front            
         of extracted file records.                                             
                     Optional.                                                  
INPUT=<'TAPE'>  To redirect source of input data to tape file backups           
         of the system recorvery files. Used in conjunctyion with               
         specific file definition 'DD' statements in the JCL.                   
                     Optional.                                                  
COMMIT=< Upto 8 digit number>  Maximum number of records before                 
         extract file segmentation.                                             
                     Optional, default 99999999.                                
CLEAR=<'YES' or 'NO'>                                                           
         CLEAR=YES - Set ESS control system clear indicator in extract          
                     file transfer parameters in file header.                   
         CLOSE=NO  - Do not set clear indicator.                                
                     Optional, default CLEAR=NO.                                
                                                                                
         EJECT                                                                  
Output                                                                          
------                                                                          
                                                                                
EXTRACT file MVS data set                                                       
-------------------------                                                       
                                                                                
Extracted data is written to MVS data sets given unique names as                
follows:                                                                        
                                                                                
     ESS.XTR.AASU.GGGGGG.TYP.DDDDDDD.TTTTTTT                                    
                                                                                
     ( DDS.XTR.AASU.GGGGGG.TYP.DDDDDDD.TTTTTTT in NY )                          
                                                                                
Where:                                                                          
     'ESS.XTR.' - As is                                                         
     'AA' - Agency alpha id                                                     
     'S' - Facpak system code                                                   
     'U' - Extract sub system code                                              
     'TYP' - Extract data type as set by 'TYPE=..' control card                 
     'GGGGGG' - 'G' + File generation number                                    
     'DDDDDDD' - 'D' + Date when file was created                               
     'TTTTTTT' - 'T' + Time when file was created                               
                                                                                
E.g.:                                                                           
      ESS.XTR.MQMS.G00031.ALL.D941031.T205608                                   
                                                                                
EXTRACT file commit report MVS data set                                         
---------------------------------------                                         
                                                                                
After a extract file has been committed by the ESS application                  
a message is returned to HOSTESS containing a report deatiling                  
the result of the commit, whether it is in error or was sucesful.               
This informationism written by HOSTESS to an MVS data set. The  .               
MVS data set is given a unique name as follows:                                 
                                                                                
     ESS.XLG.ESSNNNNN.AASU.GGGGGG.APPLICID.TTTTTT                               
                                                                                
     ( DDS.XLG.ESSNNNNN.AASU.GGGGGG.APPLICID.TTTTTT in NY )                     
                                                                                
Where:                                                                          
     'ESS.XLG.' - As is                                                         
     'ESSNNNNN' - 8 character ESSid, NNNNN is ESS id #.                         
     'AA' - Agency alpha id                                                     
     'S' - Facpak system code                                                   
     'U' - Extract sub system code                                              
     'GGGGGG' - 'G' + File generation number for this sub system                
     'TTTTTT' - 'T' + File transfer number for this ESS id                      
                                                                                
E.g.:                                                                           
      ESS.XLG.ESS00003.MQMS.G00031.MQMEDIA.T00045                               
                                                                                
SYSOUT                                                                          
------                                                                          
In addition to the standard output the following SYSOUT data sets are           
produced.                                                                       
DDNAME - SYSPRINT - Trace of EXTRACT process activity.                          
                                                                                
FACPAK CONTROL system file                                                      
--------------------------                                                      
EXTRACT control records as described above are updated when an extract          
file is created.                                                                
XAGENCY record - File genration number incremented.                             
XTRANS record  - File transfer created number is incremented.                   
XFILE record   - A new XFILE record is added.                                   
XLOG record    - In update mode a new XLOG record is added to mark              
                 the last record read in the system recovery file.              
Passive pointers are also added and updated.                                    
This information is used by the extract file trasnfer program HOSTESS           
See DCHOSTESS.                                                                  
                                                                                
         EJECT                                                                  
Program structures.                                                             
-------------------                                                             
                                                                                
    The program is comprised of a generalised controller, phase                 
name DXTRACT, which loads sub system specific extract phases.                   
These are custom written to extract the desired format of                       
data from the given FACPAK system files. This format depends                    
on the PC program which will accept the data and update the                     
intended destination database on the PC network.                                
                                                                                
Program functions:                                                              
------------------                                                              
Initialise data areas and control blocks                                        
Read JCL control parameter card input                                           
Start timer pop loop:                                                           
Open control file for updates                                                   
Set current data and time                                                       
Read EXTRACT system control records                                             
Build extract system data control block, DXBLOCKD                               
Build sub system file data control block, SXDTABD                               
Start sub system file extract loop                                              
Open files for this sub system.                                                 
Allocate extract file MVS data sets                                             
Build extract data set header record.                                           
Call sub system extract MODULE in 'OPEN SYSTEM FILES MODE'                      
Test if EXTRACT mode LOAD or UPDATE                                             
EITHER:                                                                         
Process LOAD mode                                                               
Call sub system extract MODULE in 'EXTRACT FROM FILES IN LOAD MODE'             
OR:                                                                             
Process UPDATE mode. Read from last postion in system recovery file             
Call sub system extract MODULE in 'EXTRACT FROM FILES IN UPDATE MODE'           
THEN:                                                                           
Call sub system extract MODULE in 'CLOSE SYSTEM FILES MODE'                     
Build extract data set trailer record.                                          
Write data to EXTRACT control records.                                          
Close MVS data set extract file.                                                
Process operator command line - Exit to shutdown if request to stop.            
Return to loop through each system in SXDTABD                                   
Return to timer pop loop else exit if one pass or LOAD mode.                    
Close control file                                                              
EXIT.                                                                           
                                                                                
Data structures:                                                                
----------------                                                                
                                                                                
DXBLOCKD - extract system data control block                                    
--------------------------------------------                                    
DXBLOCKD DSECT                                                                  
*                                                                               
DXMODE   DS    XL1                 EXTRACT MODE                                 
DXOPENQ  EQU   1                   OPEN SYSTEM FILES MODE                       
DXCLOSEQ EQU   2                   CLOSE SYSTEM FILES MODE                      
DXLOADQ  EQU   3                   EXTRACT FROM FILES IN LOAD MODE              
DXUPDTQ  EQU   4                   EXTRACT FROM FILES IN UPDATE MODE            
*                                                                               
DXWRITE  DS    CL1                 WRITE OUTPUT FLAG (N/Y)                      
DXDAFORM DS    XL1                 DATE FORMAT FLAG                             
DXDELIM  DS    XL1                 DELIMITER CODE                               
DXEORSTR DS    XL1                 DATEFORM SPECIAL DATE FORMAT FLAG            
DXEORLEN DS    XL1                 DATEFORM SPECIAL DATE FORMAT FLAG            
DXTXTCOD DS    XL1                 DATEFORM SPECIAL DATE FORMAT FLAG            
DXNULCOD DS    XL1                 DATEFORM SPECIAL DATE FORMAT FLAG            
DXMONCOD DS    XL1                 DATEFORM SPECIAL DATE FORMAT FLAG            
DXMAXREC DS    XL4                 MAXIMUM LOAD RECORDS PER TYPE                
DXCOMMAX DS    PL8                 MAXIMUM COMMIT RECORDS PER DATA SET          
*                                                                               
DXCENT   DS    CL2                 CURRENT CENTURY VALUE                        
DXDATEN  DS    CL8                 DATE NOW EBCDIC                              
DXDATENC DS    XL2                 DATE NOW COMPRESSED                          
DXTIMEN  DS    CL8                 TIME NOW EBCDIC                              
DXFDATEP DS    XL3                 FILTER FROM DATE PWOS (YYMMDD)               
DXTDATEP DS    XL3                 FILTER TO DATE PWOS (YYMMDD)                 
DXFDATEC DS    XL2                 FILTER FROM DATE COMPRESSED                  
DXTDATEC DS    XL2                 FILTER TO DATE COMPRESSED                    
DXACTION DS    CL1                 EXTRACT RECORD ACTION TYPE CODE              
*                                                                               
DXPUT    DS    A                   A(ROUTINE TO PUT RECORD TO FILE)             
*                                                                               
DXSTSPTR DS    A                   SYSTEM DRIVER TABLE START POINTER            
DXSTEPTR DS    A                   SYSTEM DRIVER TABLE END PONTER               
DXSTPTR  DS    A                   SYSTEM DRIVER TABLE CURRENT POINTER          
*                                                                               
DXARECB  DS    A                   A(GENERAL IO RECORD BUFFER)                  
DXACPYB  DS    A                   A(RECOVERY RECORD COPY BUFFER)               
DXAXREC  DS    A                   A(EXTRACT RECORD BUFFER)                     
DXASQLB  DS    A                   A(SQL RECORD BUFFER)                         
DXARCVH  DS    A                   A(RECOVERY RECORD)                           
*                                                                               
DXSYSTEM DS    XL1                 SYSTEM BINARY CODE                           
DXSENUM  DS    XL1                 SYSTEM SE NUMBER                             
DXSYSCOD DS    CL1                 SYSTEM CHARACTER CODE                        
DXSUBSYS DS    CL1                 SUB SYSTEM BINARY CODE                       
DXFTIME  DS    XL4                 EXTRACT TRAWL FROM TIME                      
DXTTIME  DS    XL4                 EXTRACT TRAWL TO TIME                        
DXFDA    DS    AL4                 EXTRACT TRAWL FROM DISK ADDRESS              
DXTDA    DS    AL4                 EXTRACT TRAWL TO DISK ADDRESS                
*                                                                               
DXRTTAB  DS    0F                  RECOVERY TASK STATE SAVE TABLE               
DXRTLDA  DS    AL4                 LOW DISK ADDRESS                             
DXRTHDA  DS    AL4                 HIGH DISK ADDRESS                            
DXRTLSN  DS    XL3                 LOW SYSTEM INPUT NUMBER                      
DXRTLSI  DS    XL1                 LOW SYSTEM ID                                
DXRTHSN  DS    XL3                 HIGH SYSTEM INPUT NUMBER                     
DXRTHSI  DS    XL1                 HIGH SYSTEM ID                               
DXRTEVF  DS    XL1                 EVENT FLAG                                   
         DS    XL1                 N/D                                          
DXRTTLN  EQU   *-DXRTTAB           LENGTH OF TASK RECOVERY SAVE TABLE           
         ORG   DXRTTAB                                                          
         DS    (DXRTMAX)XL(DXRTTLN)                                             
DXRTMAX  EQU   48                  MAXIMIMU NUMBER POSSIBLE TASKS               
*                                                                               
DXBLOCKL EQU   *-DXBLOCKD          LENGTH OF DATA BLOCK                         
                                                                                
SXDTABD - extract sub system file data control block                            
----------------------------------------------------                            
*                                                                               
* DSECT TO COVER SYSTEM EXTRACT DRIVER TABLE                                    
* DATA IS SORTED INTO GROUPS BY SYSTEM SE NUMBER                                
*                                                                               
                                                                                
SXDTABD  DSECT                                                                  
SXDTSYS  DS    XL1                 SYSTEM NUMBER                                
SXDTSEN  DS    XL1                 SYSTEM SE NUMBER                             
SXDTSUB  DS    XL1                 SUB SYSTEM                                   
SXDTAGY  DS    CL2                 AGENCY ALPHA ID                              
SXDTAGB  DS    XL1                 AGENCY BINARY CODE                           
SXDTPIN  DS    XL2                 AGENCY PRINCIPLE USERID NUMBER               
SXDTSCOD DS    CL1                 SYSTEM CHARACTER CODE                        
SXDTSCHR DS    CL1                 SYSTEM FILE CODE                             
SXDTSLNM DS    CL7                 SYSTEM LOGICAL NAME                          
SXDTSUBC DS    CL1                 SUB SYSTEM CHARACTER CODE                    
SXDTLEV  DS    XL1                 LEVEL NUMBER                                 
SXDTVER  DS    XL1                 VERSION NUMBER                               
SXDTFLT1 DS    CL1                 SYSTEM FILTER 1                              
SXDTFLT2 DS    CL1                 SYSTEM FILTER 2                              
SXDTFLT3 DS    CL1                 SYSTEM FILTER 3                              
SXDTTYP  DS    CL3                 SYSTEM EXTRACT TYPE                          
SXDTPLFM DS    CL1                 SERVER PLATFORM                              
SXDTEKEY DS    CL10                AGENCY PASSWORD ENCRYPTION KEY               
SXDTGNUM DS    XL2                 EXTRACT FILE GENERATION NUMBER               
SXDTRNUM DS    PL8                 EXTRACT FILE NUMBER OF RECORDS               
SXDTBNUM DS    PL8                 EXTRACT FILE NUMBER OF BYTES                 
SXDTMTOT DS    PL8                 EXTRACT FILE MONEY TOTAL                     
*                                                                               
SXDTFTYP DS    XL4                 SYSTEM EXTRACT FILE TYPE                     
SXDTFTMQ EQU   C'M'                  FILE TYPE = MVS                            
*                                                                               
SXDTFCOD DS    CL1                 EXTRACT FREQUENCY CODE                       
SXDTFTIM DS    XL2                 EXTRACT FREQUENCY TIME                       
SXDTHDR  DS    XL1                 EXTRACT HEADER FLAG                          
SXDTPSZ  DS    XL3                 PRIMARY ALLOCATION FILE SIZE                 
SXDTSSZ  DS    XL3                 SECONDARY ALLOCATION FILE SIZE               
SXDTXDCB DS    A                   EXFILE DCB                                   
SXDTXDDN DS    CL8                 EXFILE DD NAME                               
SXDTXDSN DS    CL44                EXFILE DSN                                   
SXDTSLSA DS    A                   ESS SERVER ID LIST START ADDRESS             
SXDTSLEA DS    A                   ESS SERVER ID LIST END ADDRESS               
SXDTABL  EQU   *-SXDTABD                                                        
*                                                                               
SXSLLSTD DSECT                     ESS SERVER LIST                              
SXSLEID  DS    CL8                 ESS ID                                       
SXSLFNUM DS    XL2                 FILE NUMBER                                  
SXSLFCOD DS    CL1                 UPDATE FREQUENCY CODE                        
SXSLFTIM DS    XL2                 UPDATE FREQUENCY TIME (MINS)                 
SXSLMODE DS    CL1                 UPDATE MODE                                  
SXSLPLFM DS    XL1                 PLATFORM                                     
SXSLLOAD DS    CL1                 LOAD CONTROL                                 
SXSLANUM DS    XL1                 NUMBER OF APPLICATIONS IN SUBLIST            
SXSLLSTL EQU   *-SXSLLSTD                                                       
*                                                                               
*              SUB-LIST OF SERVER APPLICATION PARAMETERS                        
*                                                                               
SXSLAPAR EQU   *                                                                
SXSLSKEY DS    CL8                 SERVER APPLICATION KEY                       
SXSLPROG DS    CL32                PROGRAM NAME                                 
SXSLPARM DS    CL48                PROGRAM PARAMETERS                           
SXSLSNAM DS    CL16                SERVER NAME                                  
SXSLDBNM DS    CL16                DATA BASE NAME                               
SXSLUSER DS    CL16                USER ID                                      
SXSLPASS DS    CL16                PASSWORD                                     
SXSLAPAL EQU   *-SXSLAPAR                                                       
                                                                                
EXTRACT Sub system module definition table as defined in DXTRACT                
----------------------------------------------------------------                
SEXTAB   DS    0XL14                                                            
*&&UK*&& DC    C'M',X'01',AL4(0),CL8'MXTRACT '                                  
*&&US*&& DC    C'S',X'01',AL4(0),CL8'SXTRACT '                                  
*&&UK*&& DC    C'A',X'01',AL4(0),CL8'AXTRACT '                                  
         DC    C'C',X'01',AL4(0),CL8'CXTRACT '                                  
         DC    C'A',X'03',AL4(0),CL8'PXTRACT '                                  
         DC    C'A',X'04',AL4(0),CL8'AXTRACT '                                  
SEXTABX  DC    X'00'                                                            
                                                                                
DXSUBLST - EXTRACT system sub sytem list                                        
----------------------------------------                                        
* TABLE OF EXTRACT SUB SYSTEMS (SEE DXSUBSYSD FOR DESCRIPTION)                  
*                                                                               
         CNOP  2,4                                                              
SUBLST   DS    0CL16                                                            
         DC    AL2(L'SUBLST),AL4(SUBLSTX-1)                                     
         DC    X'0101',C'SECURE SEC',C'SS',X'0000'                              
         DC    X'0101',C'SQL    SQL',C'SS',X'0000'                              
         DC    X'0303',C'PRESTO PRE',C'PP',X'0000'                              
         DC    X'0404',C'TEMPO  TEM',C'TT',X'0000'                              
SUBLSTX  EQU   *                                                                
         DC    X'00'               TABLE TERMINATOR                             
                                                                                
DXSUBLSTD - EXTRACT system sub sytem list structure                             
---------------------------------------------------                             
* DSECT TO COVER EXTRACT SUB SYSTEM LIST                                        
*                                                                               
SUBLSTD  DSECT                                                                  
SUBLNUM  DS    XL1                 NATIVE SUB SYSTEM NUMBER                     
SUBLEQU  DS    XL1                 EQUATED SUB SYSTEM NUMBER                    
SUBLNAME DS    CL7                 SUB SYSTEM NAME                              
SUBLSHRT DS    CL3                 SHORT SUB SYSTEM NAME                        
SUBLKEY1 DS    CL1                 SUB SYSTEM KEY LETTER 1                      
SUBLKEY2 DS    CL1                 SUB SYSTEM KEY LETTER 2                      
SUBLIND1 DS    XL1                 INDICATORS 1                                 
SUBLIND2 DS    XL1                 INDICATORS 2                                 
SUBLLEN  EQU   *-SUBLSTD                                                        
                                                                                
DXHDRD - EXTRACT file header record structure.                                  
----------------------------------------------                                  
***********************************************************************         
*SYSTEM EXTRACT FILE - HEADER RECORD                                  *         
***********************************************************************         
         SPACE 1                                                                
DXHDRD   DSECT                     HEADER RECORD                                
DXHDRLEN DS    CL4                 HEADER RECORD LENGTH                         
DXHDRTYP DS    CL5     R CHAR      HEADER RECORD TYPE                           
         DS    C                                                                
DXHDRRTY DS    CL1     R CHAR      EXTRACT FILE RECORD TYPE                     
         DS    C                                                                
DXHDRCDT DS    CL8     R DATE      CREATE DATE YYYYMMDD                         
         DS    C                                                                
DXHDRCTI DS    CL6     R TIME      CREATE TIME HHMMSS                           
*                                                                               
         DS    C                                                                
DXHDRLEV DS    CL3     R TINYINT   LEVEL NUMBER                                 
         DS    C                                                                
DXHDRVER DS    CL3     R TINYINT   VERSION NUMBER                               
         DS    C                                                                
DXHDRAGA DS    CL2     R CHAR      AGENCY ALPHA                                 
         DS    C                                                                
DXHDRAGB DS    CL3     R TINYINT   AGENCY BINARY CODE                           
         DS    C                                                                
DXHDRPIN DS    CL5     R INT       AGENCY PRINCIPLE ID NUMBER                   
         DS    C                                                                
DXHDRFAC DS    CL1     R CHAR      FACPAK CODE                                  
         DS    C                                                                
DXHDRSYS DS    CL1     R CHAR      SYSTEM CODE                                  
         DS    C                                                                
DXHDRSFC DS    CL1     R CHAR      SYSTEM SE FILE CODE                          
         DS    C                                                                
DXHDRSUB DS    CL1     R CHAR      SUB SYSTEM CODE                              
         DS    C                                                                
DXHDRRTP DS    CL3     R CHAR      EXTRACTED RECORD TYPE CODE                   
         DS    C                                                                
DXHDRFLT DS    CL3     R CHAR      SYSTEM FILTERS (3 X CHARACTERS)              
         DS    C                                                                
DXHDRTXT DS    CL8     R CHAR      HEADER TEXT TAG FIELD                        
*                                                                               
DXHDRDX  DS    CL2                 BASIC RECORD END                             
DXHDRDL  EQU   *-DXHDRD            BASIC RECORD LENGTH                          
*                                                                               
         ORG   DXHDRDX             LIST OF REMOTE SERVER LUIDS                  
*                                                                               
*                                  ESS SERVER TRANSMISSION PARAMETERS           
DXHDRSL  DS    C                                                                
DXHDREID DS    CL8     R CHAR      ESS ID                                       
         DS    C                                                                
DXHDRFNM DS    CL8     R INT       FILE NUMBER                                  
         DS    C                                                                
DXHDRFRC DS    CL1     R CHAR      UPDATE FREQUENCY CODE                        
         DS    C                                                                
DXHDRFRT DS    CL6     R TIME      UPDATE FREQUENCY TIME (HHMMSS)               
         DS    C                                                                
DXHDRMOD DS    CL1     R CHAR      UPDATE MODE CODE                             
         DS    C                                                                
DXHDRANM DS    CL3     R TINY      NUMBER OF APPLICATIONS IN SUBLIST            
DXHDRSLL EQU   *-DXHDRSL                                                        
*                                                                               
*                                  SERVER APPLICATION PARAMETERS                
DXHDRAP  DS    C                                                                
DXHDRSKY DS    CL8     O CHAR      SERVER APPLICATION KEY                       
         DS    C                                                                
DXHDRPRG DS    CL32    O CHAR      PROGRAM NAME ( LEVEL 1.1)                    
         DS    C                                                                
DXHDRPAR DS    CL48    O CHAR      PROGRAM PARAMETERS (LEVEL 1.1)               
         DS    C                                                                
DXHDRSRN DS    CL16    O CHAR      SERVER NAME                                  
         DS    C                                                                
DXHDRDBN DS    CL16    O CHAR      DATA BASE NAME                               
         DS    C                                                                
DXHDRUID DS    CL16    0 CHAR      USER ID                                      
         DS    C                                                                
DXHDRPWD DS    CL16    O CHAR      PASSWORD                                     
DXHDRAPL EQU   *-DXHDRAP                                                        
*                                                                               
         DS    C                                                                
DXHDRDLX DS    CL2                 EXTENDED RECORD END                          
*                                                                               
DXHDRHL  EQU   DXHDRLEV-DXHDRD     STANDARD HEADER LENGTH (ALL RECORDS)         
                                                                                
DXTRLD - EXTRACT file trailer record structure.                                 
-----------------------------------------------                                 
***********************************************************************         
*SYSTEM EXTRACT FILE - TRAILER RECORD                                 *         
***********************************************************************         
         SPACE 1                                                                
DXTRLD   DSECT                     TRAILER RECORD                               
DXTRLLEN DS    CL4                 TRAILER RECORD LENGTH                        
DXTRLTYP DS    CL5     R CHAR      TRAILER RECORD TYPE                          
         DS    C                                                                
DXTRLRTY DS    CL1     R CHAR      TRAILER RECORD TYPE                          
         DS    C                                                                
DXTRLCDT DS    CL8     R DATE      CREATE DATE YYYYMMDD                         
         DS    C                                                                
DXTRLCTI DS    CL6     R TIME      CREATE TIME HHMMSS                           
*                                                                               
         DS    C                                                                
DXTRLLEV DS    CL3     R TINYINT   LEVEL NUMBER                                 
         DS    C                                                                
DXTRLVER DS    CL3     R TINYINT   VERSION NUMBER                               
         DS    C                                                                
DXTRLAGA DS    CL2     R CHAR      AGENCY ALPHA                                 
         DS    C                                                                
DXTRLAGB DS    CL3     R TINYINT   AGENCY BINARY CODE                           
         DS    C                                                                
DXTRLPIN DS    CL5     R INT       AGENCY PRINCIPLE ID NUMBER                   
         DS    C                                                                
DXTRLFAC DS    CL1     R CHAR      FACPAK CODE                                  
         DS    C                                                                
DXTRLSYS DS    CL1     R CHAR      SYSTEM CODE                                  
         DS    C                                                                
DXTRLSFC DS    CL1     R CHAR      SYSTEM SE FILE CODE                          
         DS    C                                                                
DXTRLSUB DS    CL1     R CHAR      SUB SYSTEM CODE                              
         DS    C                                                                
DXTRLRTP DS    CL3     R CHAR      EXTRACTED RECORD TYPE CODE                   
         DS    C                                                                
DXTRLFLT DS    CL3     R CHAR      SYSTEM FILTERS (3 X CHARACTERS)              
         DS    C                                                                
DXTRLTXT DS    CL8     R CHAR      TRAILER TEXT TAG FIELD                       
*                                                                               
DXTRLDX  DS    CL2                 BASIC RECORD END                             
DXTRLDL  EQU   *-DXTRLD            BASIC RECORD LENGTH                          
*                                                                               
         ORG   DXTRLDX             RECORD COUNTS ETC                            
DXTRLSL  DS    C                                                                
DXTRLNR  DS    CL8     R INT       NUMBER OF RECORDS                            
         DS    C                                                                
DXTRLNB  DS    CL10    R INT       NUMBER OF BYTES                              
         DS    C                                                                
DXTRLNM  DS    CL12    R MONEY     NUMBER OF PENNIES                            
         DS    C                                                                
DXTRLFRC DS    CL1     R CHAR      EXTRACT FREQUENCY CODE                       
         DS    C                                                                
DXTRLFRT DS    CL6     R TIME      EXTRACT FREQUENCY TIME (HHMMSS)              
         DS    C                                                                
DXTRLFTY DS    CL1     R CHR       FILE TYPE                                    
         DS    C                                                                
DXTRLFID DS    CL44    R CHR       FILE NAME                                    
DXTRLSLL EQU   *-DXTRLSL                                                        
*                                                                               
DXTRLDLX DS    CL2                 EXTENDED RECORD END                          
*                                                                               
DXTRLHL  EQU   DXTRLLEV-DXTRLD     STANDARD HEADER LENGTH (ALL RECORDS)         
                                                                                
DXSQLD - EXTRACT file SQL administration control record data structure          
----------------------------------------------------------------------          
***********************************************************************         
*SYSTEM EXTRACT FILE - SQL ADMINISTRATION CONTROL RECORD              *         
***********************************************************************         
         SPACE 1                                                                
DXSQLD   DSECT                     SQL RECORD                                   
DXSQLLEN DS    CL4                 SQL RECORD LENGTH                            
DXSQLTYP DS    CL5     R CHAR      SQL RECORD TYPE                              
         DS    C                                                                
DXSQLRTY DS    CL1     R CHAR      EXTRACT FILE RECORD TYPE                     
*                                                                               
         DS    C                                                                
DXSQLLIN DS    CL72    O CHAR      SQL TEXT LINE                                
*                                                                               
DXSQLDX  DS    CL2                 RECORD END                                   
DXSQLDL  EQU   *-DXSQLD            RECORD LENGTH                                
                                                                                
Software reference.                                                             
-------------------                                                             
                                                                                
Source code                                                                     
-----------                                                                     
Source code maintained in PAN LIBRARY PAN.SYSTEMS.LIBRARY, (in the UK,)         
includes the following Books.                                                   
   DXTRACT                                                                      
     General offline FACPAK system file data extract control program.           
   DXDSECTS                                                                     
     DSECTS for DXTRACT. Includes control blocks DXBLOCKD and                   
     SXDTABD which are passed to the sub system extract program.                
   DXHDRD                                                                       
     DSECT defining extract file header structure.                              
   DXTRLD                                                                       
     DSECT defining extract file trailer structure.                             
   DXSQLD                                                                       
     DSECT defines SQL administration record structure.                         
   DXRECID                                                                      
     DSECT defines SQL administration record structure.                         
   DXSUBLST + DXSUBLSTD                                                         
     CSECT and DSECT defining codes for data extract sub systems.               
                                                                                
Control system SQL EXTRACT for PC Security Database                             
--------------------------------------------------                              
   CXTRACT                                                                      
     Sub system extract program specific to extracting                          
     data from the Control system for PC security SQL databases.                
     Is defined in table in DXTRACT and is loaded and called                    
     by DXTRACT if specified by its execution parameter cards,                  
     (SYSTEM=CONTROL, SUBSYS=SQL.)                                              
   CXSRECD                                                                      
     DSECTS defining flat file records for CXTRACT sub system.                  
   CXSAAC + CXSAAD + CXSAAX                                                     
     AGENCY ACCESS AUTH record extract subroutines and DSECTS.                  
   CXSAGC + CXSAGD + CXSAGX                                                     
     AGENCY record extract subroutines and DSECTS.                              
   CXSALC + CXSALD + CXSALX                                                     
     GROUP ACCESS AUTH record extract subroutines and DSECTS.                   
   CXSPEC + CXSPED + CXSPEX                                                     
     PERSON PASSWORD record extract subroutines and DSECTS.                     
   CXSPPC + CXSPPD + CXSPPX                                                     
     PERSON PROGRAM AUTH record extract subroutines and DSECTS.                 
   CXSPUC + CXSPUD + CXSPUX                                                     
     PERSON USERID XREF record extract subroutines and DSECTS.                  
   CXSUIC + CXSUID + CXSUIX                                                     
     USERID record extract subroutines and DSECTS.                              
   CXSUPC + CXSUPD + CXSUPX                                                     
     USERID PROGRAM AUTH record extract subroutines and DSECTS.                 
   CXSFAC + CXSFAD + CXSFAX                                                     
     AGENCY Level FCONTROL extract subroutines and DSECTS.                      
   CXSFGC + CXSFGD + CXSFGX                                                     
     GROUP Level FCONTROL extract subroutines and DSECTS.                       
   CXSOAC + CXSOAD + CXSOAX                                                     
     AGENCY Level OCONTROL extract subroutines and DSECTS.                      
   CXSOGC + CXSOGD + CXSOGX                                                     
     GROUP Level OCONTROL extract subroutines and DSECTS.                       
                                                                                
Control General file maintenance program, CON/GEN                               
-------------------------------------------------                               
   CTGEN0A + CTGENF5 + CTGEND5 + CTGENB5                                        
     XAGENCY record                                                             
   CTGEN0B + CTGENF4 + CTGEND4 + CTGENB4 + CTGEND7 +                            
             CTGENDB + CTGENC0                                                  
     XFILE record                                                               
   CTGEN1D + CTGENE0 + CTGENC2 + CTGENA2                                        
     XLOG record                                                                
   CTGEN1E + CTGENDF + CTGENC1 + CTGENA1                                        
     XTRANS record                                                              
   CTGEN22 + CTGENDE + CTGENC3                                                  
     XAPPLIC record                                                             
   CTGEN01 level 42, CTGENWRK level 6                                           
   GEGENXTR                                                                     
     Con GEN file DSECTS for Xtract transfer control record types.              
                                                                                
Others                                                                          
------                                                                          
   Latest version of 'SOON' and 'EDICT' records CON/SFM                         
   maintenance see NY systems.                                                  
                                                                                
Compilations                                                                    
-----------                                                                     
                                                                                
General code                                                                    
------------                                                                    
   Phases                                                                       
   ------                                                                       
   DXTRACT                                                                      
                                                                                
                                                                                
Control system SQL EXTRACT for PC Security Database                             
---------------------------------------------------                             
   Phases                                                                       
   ------                                                                       
   CXTRACT                                                                      
                                                                                
   Relocatables                                                                 
   ------------                                                                 
   RMCXSAAC, RMCXSAAX                                                           
   RMCXSAGC, RMCXSAGX                                                           
   RMCXSALC, RMCXSALX                                                           
   RMCXSPEC, RMCXSPEX                                                           
   RMCXSPPC, RMCXSPPX                                                           
   RMCXSPUC, RMCXSPUX                                                           
   RMCXSAAC, RMCXSSAX                                                           
   RMCXSUIC, RMCXSUIX                                                           
   RMCXSUPC, RMCXSUPX                                                           
   RMCXSFAC, RMCXSFAX                                                           
   RMCXSFGC, RMCXSFGX                                                           
   RMCXSOAC, RMCXSOAX                                                           
   RMCXSOGC, RMCXSOGX                                                           
                                                                                
Control General file maintenance program, CON/GEN                               
-------------------------------------------------                               
   Phases                                                                       
   ------                                                                       
   TA0B0A, TA0B0B, TA0B1D, TA0B1E, TA0B22                                       
   TA0BF5, TA0BD5, TA0BB5, TA0BF4, TA0BD4                                       
   TA0BF5, TA0BB4, TA0BD7, TA0BDB, TA0BC0                                       
   TA0BF5, TA0BE0, TA0BC2, TA0BA2, TA0BDF                                       
   TA0BC1, TA0BA1, TA0BDE, TA0BC3, TA0BD4                                       
                                                                                
   TA0B01 level 42                                                              
                                                                                
         EJECT                                                                  
EXTRACT Sub System program Applications                                         
---------------------------------------                                         
                                                                                
The sub system program is loaded in by DXTRACT. DXTRACT then calls the          
the sub system program passing address of the system control block              
DXBLOCKD. This in turn points to the address of the sub system                  
data control block SXDTABD. These are used to configure and drive               
the routines called in the sub system program. The sub system program           
is called several times with differetn 'MODES as defined in DXBLOCKD.           
     An example of an extract sub system program is CXTRACT                     
written for the PC Security database. The openeing part of this                 
is reporduced below:                                                            
                                                                                
CXTRACT - Extract Sub System program example                                    
--------------------------------------------                                    
                                                                                
**********************************************************                      
*                                                        *                      
* PC SECURITY SUB SYSTEM EXTRACT CONTROL MODULE          *                      
*                                                        *                      
* CONTROL IS PASSED FROM DXTRACT WITH PARAMETERS:        *                      
* R1=A(EXTRACT CONTROL DATA BLOCK - SEE DSECT DXBLOCKD)  *                      
*                                                        *                      
* MODULE ENTERED WITH ONE OF FOLLOWING MODES IN DXMODE:  *                      
*   DXOPENQ  - OPEN SYSTEM FILES                         *                      
*   DXCLOSEQ - CLOSE SYSTEM FILES                        *                      
*   DXLOADQ  - EXTRACT FROM FILES IN LOAD MODE           *                      
*   DXUPDTQ  - EXTRACT FROM FILES IN UPDATE MODE         *                      
*                                                        *                      
* FOR DXLOADQ AND DXUPDTQ MODES,                         *                      
* DXBLOCKD CONTAINS DXSTPTR WHICH IS:                    *                      
* A(CURRENT ENTRY IN SUB SYSTEM EXTRACT DRIVER TABLE -   *                      
*     SEE DSECT SYSTABD)                                 *                      
*                                                        *                      
*                                                        *                      
* RETURN CC .NE. IF ERROR CONDITION ELSE CC .EQ. FOR OK  *                      
*                                                        *                      
**********************************************************                      
         SPACE 1                                                                
CXTRACT  CSECT                                                                  
         ENTRY CXSSPAT                                                          
         ENTRY CXSAGUT                                                          
         PRINT NOGEN                                                            
         NMOD1 WORKX-WORKD,**CXTRA*,RA,R9,RR=RE                                 
*                                                                               
         ENTRY SSB                 FOR DATAMGR                                  
*                                                                               
         USING WORKD,RC            RC=A(GLOBAL W/S)                             
         ST    RE,RELO                                                          
         L     R8,0(R1)            R8=A(EXTRACT CONTROL DATA BLOCK)             
         USING DXBLOCKD,R8                                                      
         L     R7,DXSTPTR          R7=A(EXTRACT SYSTEM TABLE ENTRY)             
         USING SXDTABD,R7                                                       
         B     MAIN                                                             
         EJECT                                                                  
***********************************************************************         
* MAIN CONTROL CODE                                                   *         
***********************************************************************         
         SPACE 1                                                                
MAIN     EQU   *                                                                
         BAL   RE,GENINIT          GENERAL INITIALISATION                       
*                                                                               
MOPEN    CLI   DXMODE,DXOPENQ                                                   
         BNE   MCLOSE                                                           
         BAL   RE,PROCOPEN         OPEN SYSTEM FILES                            
         BNE   MERR                  EXIT IF ERROR                              
         B     MXIT                                                             
*                                                                               
MCLOSE   CLI   DXMODE,DXCLOSEQ                                                  
         BNE   MLOAD                                                            
         BAL   RE,PROCCLOS         CLOSE SYSTEM FILES                           
         BNE   MERR                  EXIT IF ERROR                              
         B     MXIT                                                             
*                                                                               
MLOAD    CLI   DXMODE,DXLOADQ                                                   
         BNE   MUPDT                                                            
         BAL   RE,PROCLOAD         EXTRACT FROM FILES IN LOAD MODE              
         BNE   MERR                  EXIT IF ERROR                              
         B     MXIT                                                             
*                                                                               
MUPDT    CLI   DXMODE,DXUPDTQ                                                   
         BNE   MERR                                                             
         BAL   RE,PROCUPDT         EXTRACT FROM FILES IN UPDATE MODE            
         BNE   MERR                  EXIT IF ERROR                              
         B     MXIT                                                             
*                                                                               
MERR     MVI   RETCODE,0                                                        
         B     MXIT                                                             
*                                                                               
MXIT     XMOD1 1                                                                
                                                                                
         Etc, etc............                                                   
                                                                                
         EJECT                                                                  
Control blocks                                                                  
--------------                                                                  
   DXTRACT contains a table which associates sub system program                 
phase name with its 'key' composed of SYSTEM and SUB SYSTEM                     
codes. The sub system program is called with first parameter                    
containing the address of the extract control system data block                 
I.e. On entry to sub system program:                                            
                                                                                
   PARAMETER 1 = A(EXTRACT CONTROL DATA BLOCK)                                  
                                                                                
   This is defined by DSECT 'DXBLOCKD' in source book DXDSECTS which            
should be INCLUDED within the sub system program. This also contains            
a pointer to a further sub system specific control block defined                
by DSECT 'SXDTABD'. Registers can be pointed to each of these                   
control blocks on entry to the sub system program.                              
                                                                                
         EJECT                                                                  
FACPAK CONTROL GENERAL file EXTRACT Control record structures.                  
--------------------------------------------------------------                  
See  DATA SET GEGENXTR                                                          
***********************************************************************         
* EXTRACT CONTROL RECORDS                                             *         
***********************************************************************         
         SPACE 1                                                                
GXTRD    DSECT                                                                  
GXKEY    DS    0XL32               ** EXTRACT CONTROL RECORD KEY **             
GXKMAJ   DS    XL1                 MAJOR SYSTEM (ZERO)                          
GXKMIN   DS    XL1                 MINOR SYSTEM (ZERO)                          
GXKREC   DS    XL1                 RECORD TYPE                                  
GXKDATA  DS    0X                                                               
*                                                                               
GXAKRECQ EQU   X'10'               AGENCY EXTRACT RECORD TYPE                   
GXAKAGY  DS    CL2                 AGENCY ALPHA ID                              
         DS    CL25                SPARE (NULLS)                                
GXAKSYS  DS    CL1                 SYSTEM CODE                                  
GXAKSUB  DS    CL1                 SUB SYSTEM CODE                              
*                                                                               
         ORG   GXKDATA                                                          
GXSKRECQ EQU   X'20'               ESS (SERVER) CONTROL RECORD TYPE             
GXSKEID  DS    CL8                 ESS ID                                       
GXSKAGY  DS    CL2                 AGENCY ALPHA ID                              
GXSKSYS  DS    CL1                 SYSTEM CODE                                  
GXSKSUB  DS    CL1                 SUB SYSTEM CODE                              
GXSKAPID DS    CL8                 PC NETWORK APPLICATION ID                    
         DS    CL9                 SPARE (NULLS)                                
*                                                                               
         ORG   GXKDATA                                                          
GXFKRECQ EQU   X'30'               EXTRACT FILE DEFINITION RECORD TYPE          
GXFKDAT  DS    XL2                 DATE                                         
GXFKTIM  DS    XL4                 TIME                                         
GXFKAGY  DS    CL2                 AGENCY ID                                    
GXFKSYS  DS    CL1                 SYSTEM CODE                                  
GXFKSUB  DS    CL1                 SUB SYSTEM CODE                              
         DS    CL19                SPARE (NULLS)                                
*                                                                               
         ORG   GXKDATA                                                          
GXRKRECQ EQU   X'40'               EXTRACT RECOVERY SYSTEM LOG                  
GXRKSEN  DS    CL1                 SYSTEM SE NUMBER                             
GXRKDAT  DS    XL2                 DATE                                         
GXRKTMC  DS    XL4                 TIME - IN 1'S COMPLEMENT FORM                
         DS    CL22                SPARE (NULLS)                                
         EJECT                                                                  
*                                                                               
*                                  PASSIVE POINTER RECORDS                      
*                                                                               
         ORG   GXKDATA                                                          
GXSARECQ EQU   X'21'               ESS SERVER AGENCY PASSIVE                    
GXSAAGY  DS    CL2                 AGENCY ID                                    
GXSASYS  DS    CL1                 SYSTEM CODE                                  
GXSASUB  DS    CL1                 SUB SYSTEM CODE                              
GXSAEID  DS    CL8                 ESS ID                                       
GXSAAPID DS    CL8                 SERVER APPLICATION ID                        
         DS    CL9                 SPARE (NULLS)                                
*                                                                               
         ORG   GXKDATA                                                          
GXAFRECQ EQU   X'31'               AGENCY FILE DEFINITION PASSIVE               
GXAFAGY  DS    CL2                 AGENCY ID                                    
GXAFSYS  DS    CL1                 SYSTEM CODE                                  
GXAFSUB  DS    CL1                 SUB SYSTEM CODE                              
         DS    CL19                SPARE (NULLS)                                
GXAFDAT  DS    CL2                 DATE CREATED                                 
GXAFTIM  DS    CL4                 TIME CREATED                                 
*                                                                               
         ORG   GXKDATA                                                          
GXSFRECQ EQU   X'32'               ESS SERVER FILE DEFINITION PASSIVE           
GXSFEID  DS    CL8                 ESS ID                                       
GXSFAGY  DS    CL2                 AGENCY ALPHA ID                              
GXSFSYS  DS    CL1                 SYSTEM CODE                                  
GXSFSUB  DS    CL1                 SUB SYSTEM CODE                              
GXSFFNUM DS    XL2                 FILE TRANSFER NUMBER                         
         DS    CL15                N/D                                          
*                                                                               
         ORG   GXKEY+L'GXKEY                                                    
GXKEYL   EQU   *-GXKEY             KEY LENGTH                                   
         SPACE 1                                                                
*                                  ** DIRECTORY VALUES **                       
GXDSTAT  DS    XL1                 DIRECTORY STATUS - SEE GESTAT                
GXDELEM  DS    XL1                 ELEMENT FLAG                                 
GXDCTL   DS    XL2                 CONTROL                                      
*                                  CONTROL FLAGS                                
GXFTNOT  EQU   X'01'               SERVER NOTIFIED FILE READY TO SEND           
GXFTRCV  EQU   X'02'               FILE RECEIVED BY SERVER                      
GXFTCOM  EQU   X'04'               FILE COMMITTED BY SERVER DATABASE            
GXFTERR  EQU   X'80'               ERROR OCCURRED                               
GXFTRES  EQU   X'08'               RESEND OCCURRED                              
*                                                                               
GXDDA    DS    XL4                 DISK ADDRESS                                 
GXDLEN   EQU   *-GXTRD             DIRECTORY RECORD LENGTH                      
         ORG   GXDSTAT                                                          
         SPACE 1                                                                
*                                  ** FILE VALUES **                            
GXFLEN   DS    XL2                 RECORD LENGTH                                
GXFSTAT  DS    XL1                 STATUS                                       
GXFELEM  DS    XL1                 ELEMENT FLAG                                 
GXFCTL   DS    XL2                 CONTROL                                      
GXFSYS   DS    XL4                 SYSTEM LINKAGE AREA                          
GXFIRST  EQU   *-GXTRD             FIRST ELEMENT                                
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT SYSTEM DEFINITION ELEMENT                                  *         
***********************************************************************         
         SPACE 1                                                                
GXSDEL   DS    CL1                 ELEMENT CODE                                 
GXSDELQ  EQU   X'11'                                                            
GXSDELL  DS    CL1                 ELEMENT LENGTH                               
GXSDSYS  DS    CL1                 SYSTEM NUMBER                                
GXSDSUB  DS    CL1                 SUB SYSTEM CODE                              
GXSDLEV  DS    CL1                 LEVEL NUMBER                                 
GXSDVER  DS    CL1                 VERSION NUMBER                               
GXSDFLT1 DS    CL1                 SYSTEM FILTER 1                              
GXSDFLT2 DS    CL1                 SYSTEM FILTER 1                              
GXSDFLT3 DS    CL1                 SYSTEM FILTER 1                              
GXSDTYP  DS    CL3                 ELEMENT TYPE                                 
GXSDHDR  DS    XL1                 HEADER FLAG                                  
GXSDPSZ  DS    XL3                 PRIMARY ALLOCATION FILE SIZE                 
GXSDSSZ  DS    XL3                 SECONDARY ALLOCATION FILE SIZE               
GXSDFCOD DS    CL1                 FREQUENCY CODE OF EXTRACT                    
GXSDFCEQ EQU   C'E'                AFTER EVERY TIME PERIOD SPECIFIED            
GXSDFCDQ EQU   C'D'                DAILY                                        
GXSDFCLQ EQU   C'L'                LOAD ONLY (UPDATE MODE DISABLED)             
GXSDFTIM DS    XL2                 FREQUENCY TIME OF EXTRACT (MINS)             
GXSDELLQ EQU   *-GXSDEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT SYSTEM FILE GENERATION NUMBER ELEMENT                      *         
***********************************************************************         
         SPACE 1                                                                
GXGNEL   DS    CL1                 ELEMENT CODE                                 
GXGNELQ  EQU   X'12'                                                            
GXGNELL  DS    CL1                 ELEMENT LENGTH                               
GXGNNUM  DS    XL2                 FILE GENERATION NUMBER                       
GXGNELLQ EQU   *-GXGNEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT AGENCY SYSTEM PASSWORD ENCRYPTION KEY                      *         
***********************************************************************         
         SPACE 1                                                                
GXPCEL   DS    CL1                 ELEMENT CODE                                 
GXPCELQ  EQU   X'13'                                                            
GXPCELL  DS    CL1                 ELEMENT LENGTH                               
GXPCKEY  DS    CL10                PASSWORD ENCYPTION KEY                       
GXPCELLQ EQU   *-GXPCEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT ESS SERVER DEFINITION ELEMENT                              *         
***********************************************************************         
         SPACE 1                                                                
GXSLEL   DS    CL1                 ELEMENT CODE                                 
GXSLELQ  EQU   X'20'                                                            
GXSLELL  DS    CL1                 ELEMENT LENGTH                               
GXSLSRLU DS    CL8                 SERVER RECEIVE LUID                          
GXSLSSLU DS    CL8                 SERVER SEND LUID                             
GXSLHRLU DS    CL8                 HOST RECEIVE LUID                            
GXSLHSLU DS    CL8                 HOST SEND LUID                               
GXSLVTNM DS    CL8                 APPC OPEN VTAM NAME                          
GXSLTPNM DS    CL8                 APPC OPEN TPNAME                             
GXSLAPCM DS    XL1                 APPC MODE                                    
GXSLLOCN DS    CL30                LOCATION                                     
GXSLELLQ EQU   *-GXSLEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT ESS SERVER TRANSFER CONTROL ELEMENT                        *         
***********************************************************************         
         SPACE 1                                                                
GXSTEL   DS    CL1                 ELEMENT CODE                                 
GXSTELQ  EQU   X'21'                                                            
GXSTELL  DS    CL1                 ELEMENT LENGTH                               
GXSTAGY  DS    CL2                 AGENCY ALPHA ID                              
GXSTSYS  DS    CL1                 SYSTEM NUMBER                                
GXSTSUB  DS    CL1                 SUB SYSTEM CODE                              
GXSTFCOD DS    CL1                 UPDATE FREQUENCY CODE                        
GXSTFTIM DS    XL2                 UPDATE FREQUENCY TIME (MINS)                 
GXSTMODE DS    CL1                 UPDATE MODE                                  
GXSTCRFN DS    XL2                 LAST FILE TRANSFER NUMBER CREATED            
GXSTNOFN DS    XL2                 LAST FILE TRANSFER NUMBER NOTIFIED           
GXSTREFN DS    XL2                 LAST FILE TRANSFER NUMBER RECEIVED           
GXSTCOFN DS    XL2                 LAST FILE TRANSFER NUMBER COMMITTED          
GXSTLOAD DS    CL1                 LOAD CONTROL                                 
GXSTELLQ EQU   *-GXSTEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT ESS SERVER APPLICATION CONTROL ELEMENT                     *         
***********************************************************************         
         SPACE 1                                                                
GXAPEL   DS    CL1                 ELEMENT CODE                                 
GXAPELQ  EQU   X'22'                                                            
GXAPELL  DS    CL1                 ELEMENT LENGTH                               
GXAPAGY  DS    CL2                 AGENCY ALPHA ID                              
GXAPSYS  DS    CL1                 SYSTEM NUMBER                                
GXAPSUB  DS    CL1                 SUB SYSTEM CODE                              
GXAPAPID DS    CL8                 SERVER APPLICATION ID                        
         DS    CL8                 N/D                                          
GXAPSNAM DS    CL16                SERVER NAME                                  
GXAPDBNM DS    CL16                DATABASE NAME                                
GXAPUSER DS    CL16                USER ID                                      
GXAPPASS DS    CL16                PASSWORD                                     
GXAPELLQ EQU   *-GXAPEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT ESS SERVER APPLICATION PROGRAM ELEMENT                     *         
***********************************************************************         
         SPACE 1                                                                
GXPREL   DS    CL1                 ELEMENT CODE                                 
GXPRELQ  EQU   X'23'                                                            
GXPRELL  DS    CL1                 ELEMENT LENGTH                               
GXPRNAME DS    CL32                PROGRAM NAME                                 
GXPRPARM DS    CL48                PROGRAM PARAMETERS                           
GXPRELLQ EQU   *-GXPREL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT FILE DEFINITION ELEMENT                                    *         
***********************************************************************         
         SPACE 1                                                                
GXFDEL   DS    CL1                 ELEMENT CODE                                 
GXFDELQ  EQU   X'30'                                                            
GXFDELL  DS    CL1                 ELEMENT LENGTH                               
GXFDDAC  DS    XL2                 DATE CREATED                                 
GXFDTIC  DS    XL4                 TIME CREATED                                 
GXFDAGY  DS    CL2                 AGENCY ID                                    
GXFDSYS  DS    CL1                 SYSTEM CODE                                  
GXFDSEN  DS    XL1                 SYSTEM SE NUMBER                             
GXFDSUB  DS    CL1                 SUB SYSTEM CODE                              
GXFDTYP  DS    CL3                 EXTRACT DATA TYPE                            
GXFDSTA  DS    XL1                 STATUS CODE                                  
GXFDRNM  DS    PL8                 NUMBER OF RECORDS                            
GXFDBNM  DS    PL8                 NUMBER OF BYTES                              
GXFDMTO  DS    PL8                 MONEY CHECKSUM TOTAL                         
GXFDDSN  DS    CL44                DSN OF FILE                                  
GXFDFFL  DS    XL1                 FROM FLAGS                                   
GXFDTFL  DS    XL1                 TO FLAGS                                     
GXFDFTM  DS    XL4                 FROM TIME                                    
GXFDTTM  DS    XL4                 TO TIME                                      
GXFDFDA  DS    AL4                 FROM DISK ADDRESS                            
GXFDTDA  DS    AL4                 TO DISK ADDRESS                              
GXFDMOD  DS    CL1                 EXTRACT PROCESS MODE                         
*                                                                               
GXFDELLQ EQU   *-GXFDEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT FILE TRANSMISSION ELEMENT                                  *         
***********************************************************************         
         SPACE 1                                                                
GXFTEL   DS    CL1                 ELEMENT CODE                                 
GXFTELQ  EQU   X'31'                                                            
GXFTELL  DS    CL1                 ELEMENT LENGTH                               
GXFTEID  DS    CL8                 ESS ID                                       
         DS    CL15                N/D                                          
GXFTLOAD DS    CL1                 LOAD CONTROL                                 
GXFTPLFM DS    CL1                 SERVER PLATFORM                              
GXFTFNUM DS    XL2                 SERVER FILE TRANSFER NUMBER                  
GXFTCTL  DS    XL2                 STATUS CONTROL FLAGS SAVE                    
GXFTDNO  DS    XL2                 DATE NOTIFIED                                
GXFTTNO  DS    XL4                 TIME NOTIFIED                                
GXFTRNO  DS    CL6                 NOTIFICATION RETURN CODE                     
GXFTDRE  DS    XL2                 DATE RECEIVED                                
GXFTTRE  DS    XL4                 TIME RECEIVED                                
GXFTRRE  DS    CL6                 RECEIVE RETURN CODE                          
GXFTDCO  DS    XL2                 DATE COMMITTED                               
GXFTTCO  DS    XL4                 TIME COMMITTED                               
GXFTRCO  DS    CL6                 COMMIT RETURN CODE                           
GXFTELLQ EQU   *-GXFTEL            ELEMENT LENGTH (FIXED PART)                  
GXFTSLST DS    0CL(GXFTSLQ)        SERVER APPLICATION LIST                      
GXFTSKEY DS    CL8                 SERVER APPLICATION KEY                       
GXFTDSCO DS    XL2                 DATE COMMITTED TO SERVER                     
GXFTTSCO DS    XL4                 TIME COMMITTED TO SERVER                     
GXFTRSCO DS    CL6                 COMMIT RETURN CODE FRO SERVER                
GXFTSLQ  EQU   *-GXFTSKEY          LENGTH LIST ELEMENT                          
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT RECOVERY SYSTEM LOG ELEMENT                                *         
***********************************************************************         
         SPACE 1                                                                
GXRSEL   DS    CL1                 ELEMENT CODE                                 
GXRSELQ  EQU   X'40'                                                            
GXRSELL  DS    CL1                 ELEMENT LENGTH                               
GXRSNUM  DS    XL1                 NUMBER OF TASKS                              
GXRSDAT  DS    XL2                 DATE                                         
GXRSTIM  DS    XL4                 TIME                                         
*                                                                               
GXRSFFL  DS    XL1                 FROM FLAGS                                   
GXRSTFL  DS    XL1                 TO FLAGS                                     
GXRSFTM  DS    XL4                 FROM TIME                                    
GXRSTTM  DS    XL4                 TO TIME                                      
GXRSFDA  DS    AL4                 FROM DISK ADDRESS                            
GXRSTDA  DS    AL4                 TO DISK ADDRESS                              
GXRSLDA  DS    (GXRSTMAX)AL4       LAST DISK ADDRESS FOR EACH TASK              
GXRSTMAX EQU   48                                                               
*                                                                               
GXRSELLQ EQU   *-GXRSEL            ELEMENT LENGTH                               
         SPACE 1                                                                
***********************************************************************         
*  EXTRACT RECOVERY SYSTEM LAST SYSTEM INPUT VALUES ELEMENT           *         
***********************************************************************         
         SPACE 1                                                                
GXSIEL   DS    CL1                 ELEMENT CODE                                 
GXSIELQ  EQU   X'41'                                                            
GXSIELL  DS    CL1                 ELEMENT LENGTH                               
*                                                                               
GXSIVAL  DS    (GXRSTMAX)XL4       LAST SYSTEM INPUT MUNBER AND CODE            
*                                    FOR EACH TASK                              
*                                                                               
GXSIELLQ EQU   *-GXSIEL            ELEMENT LENGTH                               
         SPACE 1                                                                

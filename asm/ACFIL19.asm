*          DATA SET ACFIL19    AT LEVEL 053 AS OF 11/30/20                      
*&&      SET   NOP=N                                                            
*PHASE T62319A                                                                  
         TITLE 'ACCOUNT RECORD OBJECT VERSION'                                  
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*         
* FOR LIST SCREEN:  AIO8,AIO9 AND AIO10 ARE USED TO HOLD THE HIGHER LVL         
* ACCOUNTS WHICH ARE READ WHEN FILTERING SO DO NOT USE THESE IO AREAS.          
*                                                                               
* ALSO AIO6 HOLDS THE LEDGER RECORD SO DON'T USE IT.                            
* ALSO AIO4 IS USED FOR RAPPER CALLS SO DON'T USE IT BETWEEN THE                
* ADDACTEL AND THE ADDACTPT CALLS SINCE ADDACTPT NEEDS THE BLOCK INFO           
* BUILT IN ADDACTEL                                                             
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*         
         SPACE 2                                                                
***********************************************************************         
* RGUP 047 20JUN18 <SPEC-16604> Relink with new ACGENFILE to add      *         
*                  one byte to OATSUB6Q of OATELD 8C element          *         
* MPEN 048 DSRD-19243 LOCK 1N ACCOUNTS ON THE MF                      *         
* RGUP 049 SPEC-28552 Credit card payment method (CCARD)              *         
* JSAY 049 SPEC-24555 Display Future Time Allowed field in list and   *         
*                     also use it as filter for 1N records            *         
* MNAS 050 SPEC-44172 new delivery option RD for GroupM               *         
* VGUP 051 SPEC-44534 Fixed EDI check delivery filter issue           *         
* VGUP 051 SPEC-45168 Added EDI check delivery filter RDVender        *         
* RKEJ 052 SPEC-43417 Ability to use AEC codes on the 1R ledger       *         
* MNAS 053 SPEC-46491 add FFTEL free form fields to SC accounts       *         
***********************************************************************         
*                                                                               
FIL19    CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,**FL19**,R7,RR=RE                                              
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
         L     RC,AOVERWRK                                                      
         USING OVERWRKD,RC                                                      
         ST    RE,BORELO                                                        
         ST    R1,CALLR1                                                        
         MVC   SVPARMS,0(R1)                                                    
         LH    R5,=Y(TWUSER-TWAD)                                               
         AR    R5,RA                                                            
         USING TWUSER,R5                                                        
         L     R2,=A(DCLISTU)         TRANSLATE UPPERCASE WORDS                 
         A     R2,BORELO                                                        
         GOTO1 VDICTAT,BOPARM,C'LU  ',(R2),DSLISTU                              
*                                                                               
         L     R2,=A(DCLISTL)         TRANSLATE LOWERCASE WORDS                 
         A     R2,BORELO                                                        
         GOTO1 VDICTAT,BOPARM,C'LL  ',(R2),DSLISTL                              
*                                                                               
SETUP20  SRL   RF,24                                                            
         CLM   RF,1,=AL1(ROUTSN)                                                
         BNH   *+6                 UNKNOWN ROUTINE                              
         DC    H'0'                                                             
         SLL   RF,2                                                             
         B     ROUTS(RF)                                                        
         SPACE 1                                                                
ROUTS    DS    0XL4                                                             
         B     OBJECT              OBJECT INVOKER                               
         B     INIT                INITIALIZATION CALL                          
*                                                                               
ROUTSN   EQU   (*-ROUTS)/4                                                      
         SPACE 1                                                                
***********************************************************************         
* EXITS                                                               *         
***********************************************************************         
         SPACE 1                                                                
EXITH    CLI   *,0                 SET CC HIGH                                  
         B     EXIT                                                             
EXITL    CLI   *,FF                SET CC LOW                                   
         B     EXIT                                                             
EXITOK   CR    RB,RB               SET CC EQUAL                                 
         SPACE 1                                                                
         L     R1,CALLR1                                                        
         MVC   0(L'SVPARMS,R1),SVPARMS                                          
EXIT     XIT1  ,                   EXIT WITH CC SET                             
*                                                                               
EXITNV   MVC   FVMSGNO,=AL2(FVFNOTV)                                            
         B     EXITL               EXIT WITH FIELD NOT VALID SET                
EXITNO   MVC   FVMSGNO,=AL2(FVFNONE)                                            
         B     EXITL               EXIT WITH FIELD NOT INPUT SET                
EXITNOTN MVC   FVMSGNO,=AL2(FVFNOTN)                                            
         B     EXITL               EXIT WITH FIELD NOT NUMERIC SET              
ERRFILT  MVC   FVMSGNO,=AL2(AE$FLTNV) FILTER INVALID FOR THIS U/L               
         B     EXITL                                                            
*                                                                               
FLTXL    MVI   SVPARMS,DFLTL       EXIT LOW FOR FILTER                          
         B     EXITOK                                                           
FLTXE    MVI   SVPARMS,DFLTE       EXIT EQUAL FOR FILTER                        
         B     EXITOK                                                           
FLTXH    MVI   SVPARMS,DFLTH       EXIT HIGH FOR FILTER                         
         B     EXITOK                                                           
FLTXX    MVI   SVPARMS,DFLTX       EXIT DEFINATELY NOT VALID                    
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* INITIALIZATION                                                      *         
***********************************************************************         
         SPACE 1                                                                
         USING CPYRECD,R2                                                       
INIT     LA    R2,IOKEY                                                         
         XC    SVCPYEL,SVCPYEL                                                  
         MVC   CPYKEY,BCSPACES   READ COMPANY RECORD                            
         MVC   CPYKCPY,CUABIN      CONNECTED ID                                 
         LHI   R1,XOREAD+XOACCDIR+XIO1                                          
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         LHI   R1,XOGET+XOACCMST+XIO1                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                BAD COMPANY RECORD                           
*                                                                               
         USING CPYRECD,R2          DON'T USE GETEL HERE                         
         USING CPYELD,R4                                                        
         L     R2,AIO1                                                          
         LA    R4,CPYRECD+(CPYRFST-CPYRECD)                                     
         ZIC   R1,CPYLN                                                         
         BCTR  R1,0                                                             
         EXMVC R1,SVCPYEL,0(R4)                                                 
*                                                                               
         B     EXITOK                                                           
         DROP  R2,R4                                                            
         SPACE 2                                                                
***********************************************************************         
* TABLE  ITERATION ROUTINE - EXPECTS R1 TO HOLD EQUATED VERB          *         
*                          - EXPECTS RF TO HOLD A(TABLE)              *         
***********************************************************************         
         SPACE 1                                                                
         USING OBJTABD,RF                                                       
ITER     CLI   OBJVERB,EOT         E.O.T.                                       
         BE    EXITOK           ** NEED TO SET HIGH IF NOT OVERRIDE             
         CLM   R1,1,OBJVERB        R1 HOLDS EQUATE                              
         BE    ITER02              MATCHED                                      
         LA    RF,OBJTABL(RF)                                                   
         B     ITER                ITERATE TABLE                                
*                                                                               
ITER02   ICM   RF,15,OBJADR        INVOKE OBJECT                                
         A     RF,BORELO                                                        
         BR    RF                                                               
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* OBJECT CONTROLLER - INTERFACES TO ALL USER OBJECTS                  *         
*                                                                     *         
* P1 HOLDS EQUATED VERB                                               *         
***********************************************************************         
         SPACE 1                                                                
OBJECT   L     R1,SVPARMS                                                       
         LA    RF,TABLEOO                                                       
         B     ITER                                                             
*                                                                               
TABLEOO  DC    AL1(OKEY),AL1(0,0,0),AL4(KEY)                                    
         DC    AL1(ORECH),AL1(0,0,0),AL4(RECORD)                                
         DC    AL1(OSES),AL1(0,0,0),AL4(NTRSES)                                 
         DC    AL1(OSCRN),AL1(0,0,0),AL4(SCREEN)                                
         DC    AL1(ODATA),AL1(0,0,0),AL4(DATA)                                  
         DC    AL1(OPFK),AL1(0,0,0),AL4(PFK)                                    
         DC    AL1(OREP),AL1(0,0,0),AL4(REPORT)                                 
         DC    AL1(ODLOAD),AL1(0,0,0),AL4(DLOAD)                                
         DC    AL1(OLIST),AL1(0,0,0),AL4(LIST)                                  
         DC    AL1(OSUBACT),AL1(0,0,0),AL4(SUBACT)                              
         DC    AL1(OACTH),AL1(0,0,0),AL4(EXITH)                                 
                                                                                
         SPACE 2                                                                
***********************************************************************         
* NTRSES OBJECT                                                       *         
*                                                                     *         
* P1 HOLDS EQUATED OBJECT                                             *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(BLOCK) COVERED BY SSAVD                                  *         
***********************************************************************         
         SPACE 1                                                                
NTRSES   LM    R0,R3,SVPARMS                                                    
         USING SSAVD,R2                                                         
         LA    RF,NSSTABL                                                       
         B     ITER                                                             
*                                                                               
NSSTABL  DC    AL1(SNTROUT),AL1(0,0,0),AL4(NTROUT)                              
         DC    AL1(SXITIN),AL1(0,0,0),AL4(XITIN)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* ENTERING OUT FROM SESSION                                           *         
*                                                                     *         
* NTRY: P3 = A(NEXT SESSION DATA (SEE SSAVD))                         *         
***********************************************************************         
         SPACE 1                                                                
NTROUT   OI    SXINDS1,X'02'                                                    
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* PROCESS PARAMETER LIST FOR NTRSES TRANSFER FROM HIGHER LEVEL        *         
***********************************************************************         
         SPACE 1                                                                
XITIN    DS    0H                                                               
         TM    GCINDS2,GCIXITS     XITSES JUST ISSUED?                          
         BZ    EXITOK                                                           
         CLI   NSREC,O#DIS         JUST CAME BACK FROM COLUMN/DISPLAY?          
         BNE   EXITOK                                                           
         SR    R1,R1                                                            
         ICM   R1,3,=AL2(ACC#ADDRL) ADDRESS FIELD (ON LIST SCREEN)              
         STCM  R1,3,BCHALF         CHECK IF ADDRESS FLD HAS BEEN INCL           
         BRAS  RE,CKLCOL           AS A COLUMN ON THE LIST SCREEN.              
         BNE   XITN10                                                           
         TM    BYTE3,ADRCOL        WAS ADDR COLUMN PART OF LIST BEFORE?         
         BO    EXITOK              YES SO NO NEED TO RE-BUILD                   
         B     XITN20              NO SO NEED TO RE-BUILD                       
*                                                                               
* ADDRESS IS NOT PART OF LIST SO SEE IF IT WAS PART OF LIST PREVIOUSLY          
XITN10   TM    BYTE3,ADRCOL                                                     
         BZ    EXITOK              NO SO NO NEED TO REBUILD                     
*                                                                               
XITN20   OI    LSSCIND1,LSSCIFLT   FILTERS CHANGED?                             
         B     EXITOK                                                           
         DROP  R2                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SUB-ACTION OBJECT                                                   *         
***********************************************************************         
         SPACE 1                                                                
SUBACT   LA    R1,SUBTAB                                                        
         USING OBJTABD,R1                                                       
         L     RE,SVPARMS2                                                      
*                                                                               
SUB02    CLI   OBJVERB,EOT                                                      
         BE    EXITH                                                            
         CLM   RE,1,OBJVERB        RE HOLDS EQUATED VERB                        
         BE    SUB04               MATCHED                                      
         LA    R1,OBJTABL(R1)                                                   
         B     SUB02               BUMP & LOOP                                  
*                                                                               
SUB04    ICM   RF,15,OBJADR                                                     
         A     RF,BORELO                                                        
         BR    RF                                                               
         DROP  R1                                                               
*                                                                               
SUBTAB   DC    AL1(SAVAL),AL1(0,0,0),AL4(SUBVAL)                                
         DC    AL1(EOT)                                                         
         EJECT                                                                  
***********************************************************************         
* VALIDATE SUB-ACTION INPUT FIELD                                     *         
* IF ADDRESS IS A COLUMN ON THE LIST SCREEN THAT MEANS IT'S A VARIABLE*         
* ROW LIST.  MULTI-SELECTS VIA SEL+ OR CHA& FOR EXAMPLE ARE NOT VALID *         
* IN THE CASE OF VARIABLE ROWS.                                                 
***********************************************************************         
         SPACE 1                                                                
         USING FHD,R2                                                           
SUBVAL   LH    R2,LSCURLIN         DISPLACEMENT TO CURRENT LINE                 
         A     R2,ATWA                                                          
         LA    RF,FHDA             START OF INPUT DATA                          
         ZIC   R1,FHIL             LENGTH OF INPUT DATA                         
         LTR   R1,R1                                                            
         BZ    EXITH                                                            
SUBV10   CLI   0(RF),C'+'                                                       
         BE    SUBV20                                                           
         CLI   0(RF),C'&&'                                                      
         BE    SUBV20                                                           
         LA    RF,1(RF)                                                         
         BCT   R1,SUBV10                                                        
         B     EXITH                                                            
*                                                                               
SUBV20   TM    BYTE3,ADRCOL                                                     
         BZ    EXITH                                                            
         MVC   FVMSGNO,=AL2(AE$MUROW)                                           
         ST    R2,FVADDR                                                        
         B     EXITL                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* KEY OBJECT                                                          *         
*                                                                     *         
* P1 HOLDS EQUATED OBJECT                                             *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 A(KEY)                                                           *         
* P4 HOLDS SUB-ACTION                                                 *         
***********************************************************************         
         SPACE 1                                                                
KEY      LM    R0,R3,SVPARMS                                                    
         USING ACTRECD,R2                                                       
         LA    RF,KEYTABL                                                       
         B     ITER                                                             
*                                                                               
KEYTABL  DC    AL1(KFIRST),AL1(0,0,0),AL4(KEYFRST)                              
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR KEY OBJECT                                           *         
***********************************************************************         
         SPACE 1                                                                
KEYFRST  L     R1,SVPARMS4         TABLE OF KNOWN INVOKERS                      
         LA    RF,KFTABL           TABLE OF KNOWN INVOKERS                      
         B     ITER                                                             
*                                                                               
KFTABL   DC    AL1(KVAL),AL1(0,0,0),AL4(KFKVAL)      VALIDATE                   
         DC    AL1(KFVAL),AL1(0,0,0),AL4(KFKFVAL)    VALIDATE FILTER            
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR VALIDATE OF A KEY OBJECT                             *         
***********************************************************************         
         SPACE 1                                                                
KFKVAL   MVC   ACTKEY,BCSPACES     INITIALIZE KEY OF RECORD                     
         MVC   ACTKCPY,CUABIN      CONNECTED ID                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR VALIDATE OF A KEY FILTER                             *         
***********************************************************************         
         SPACE 1                                                                
KFKFVAL  MVC   ACTKEY,BCSPACES     INITIALIZE KEY OF RECORD                     
         MVC   ACTKCPY,CUABIN      CONNECTED ID                                 
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* RECORD OBJECT                                                       *         
*                                                                     *         
* P1 HOLDS EQUATED OBJECT                                             *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 A(RECORD)                                                        *         
* P4 HOLDS SUB-ACTION VERB                                            *         
***********************************************************************         
         SPACE 1                                                                
RECORD   LM    R0,R3,SVPARMS                                                    
         USING ACTRECD,R2                                                       
         LA    RF,TABLREC                                                       
         B     ITER                                                             
*                                                                               
TABLREC  DC    AL1(RFIRST),AL1(0,0,0),AL4(RECFRST)                              
         DC    AL1(RLAST),AL1(0,0,0),AL4(RECLAST)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR RECORD OBJECT                                        *         
***********************************************************************         
         SPACE 1                                                                
RECFRST  L     R1,SVPARMS4                                                      
         LA    RF,RFTABL           TABLE OF KNOWN INVOKERS                      
         B     ITER                                                             
*                                                                               
RFTABL   DC    AL1(RCPY),AL1(0,0,0),AL4(RFADD)                                  
         DC    AL1(RADD),AL1(0,0,0),AL4(RFADD)                                  
         DC    AL1(RWRT),AL1(0,0,0),AL4(RFWRT)                                  
         DC    AL1(RRES),AL1(0,0,0),AL4(RFADD)                                  
         DC    AL1(RDEL),AL1(0,0,0),AL4(RFDEL)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR RECORD OBJECT - ADD/COPY/RESTORE                     *         
*                                                                     *         
* WANTED TO PUT CODE IN THE INDIVIDUAL VALIDATION ROUTINES TO PROTECT *         
* THE FIELDS ON A COPY ACTION SINCE ANY ADDITIONS/CHANGES MADE TO     *         
* THOSE FIELDS ARE IGNORED (JUST CHANGES THE KEY), BUT I DO NOT GET   *         
* CALLED WITH THE ROUTINES FOR A COPY.  THEN WANTED TO PUT CODE IN    *         
* THIS ROUTINE TO BUMP THROUGH THE FIELDS AND PROTECT BUT DO NOT GET  *         
* CALLED WITH THIS ROUTINE UNTIL USER ENTERS A NEW KEY AND HITS ENTER *         
* BY THAN THE USER HAS PROBABLY ALREADY CHANGED THE FIELDS AND THE REC*         
* IS ADDED.                                                                     
***********************************************************************         
         SPACE 1                                                                
RFADD    MVC   FVADDR,AACCFLD      SET CURSOR TO ACCOUNT FIELD                  
         MVI   BYTE2C,0                                                         
         CLI   GSSMPAGE,1          DO NOT ALLOW ADDS FROM 2ND PAGE              
         BE    RFADD05             BECAUSE PROFILE SETTINGS TABLE               
         CLI   CSACT,A#ADD         IS ALREADY SET SO WON'T TAKE YOUR            
         BNE   RFADD05             PROFILES.                                    
         MVC   FVMSGNO,=AL2(AE$IACTN) INVALID ACTION FOR THIS SCREEN            
         B     EXITL                                                            
                                                                                
RFADD05  MVC   BCHALF,ACTKUNT      TEMPORARY UNIT AND LEDGER                    
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,VALHIGH          VALIDATE THAT THE HIGHER LVL                 
         BE    *+14                ALREADY EXISTS                               
         MVC   FVMSGNO,=AL2(AE$HLACM)                                           
         B     EXITL                                                            
*                                                                               
         CLI   CSACT,A#CPY         COPY ACTION?                                 
         BNE   RFADD90                                                          
         TM    GSINDSL1,GSIRCOPY   IS RECORD DISPLAYED TO COPY YET?             
         BZ    RFADD90                                                          
T        USING ACTRECD,GSCPYKEY             ONLY ALLOW COPY TO SAME             
         CLC   T.ACTKUNT(L'ACTKUNT+L'ACTKUNT),ACTKUNT    LEDGER                 
         BNE   RFADERR1                                                         
         BRAS  RE,VALCPYLN         MAKE SURE COPY TO AND COPY FROM              
         BNE   RFADERR2            ARE AT SAME LEVEL                            
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   RFADD10                                                          
         L     RF,12(,R1)                                                       
         USING RSTELD,RF                                                        
         MVC   RSTBDATE,BCTODAYP   SET TO TODAY                                 
         MVC   RSTTDATE,BCTODAYP                                                
         DROP  RF                                                               
*                                                                               
RFADD10  GOTO1 ADELEL,BOPARM,('ABLELQ',ACTRECD),0                               
         GOTO1 ADELEL,BOPARM,('APOELQ',ACTRECD),0                               
         GOTO1 ADELEL,BOPARM,('ASTELQ',ACTRECD),0                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('GDAELQ',ACTRECD),       *        
               (L'GDATYPE,=AL1(GDATMCST))   DEL E5 ELEM FOR BRANDOCEAN          
         MVC   IOKEY(L'ACTKEY),ACTKEY                                           
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
*MN      BRAS  RE,CHKACLN          TEST IF LOW LEVEL ACCOUNT                    
         BRASL RE,CHKACLN          TEST IF LOW LEVEL ACCOUNT                    
         BNE   RFADD90             NO DON'T ADD THESE ELEMENTS                  
         OI    GSRECSTA+(ACTKSTAT-ACTKSTA),ACTSABLP                             
         GOTO1 AADDAST,ACTRECD     ASTELD                                       
         GOTO1 AADDBAL,ACTRECD     ABLELD AND APOELD                            
         B     RFADD90                                                          
*                                                                               
RFADERR1 MVC   FVMSGNO,=AL2(AE$COPUL) COPY INVALID ACROSS LEDGERS               
         B     EXITL                                                            
RFADERR2 MVC   FVMSGNO,=AL2(AE$COPLV) COPY INVALID ACROSS LEVELS                
         B     EXITL                                                            
*                                                                               
RFADD90  DS    0H                                                               
         NI    GCINDS3,X'FF'-GCIDSMSG                                           
         USING CPYELD,RF                                                        
         LA    RF,SVCPYEL                                                       
         TM    CPYSTATA,CPYAUT2C   COMPANY AUTO UPDATE 2C?                      
         BZ    RFADD95                                                          
         BRAS  RE,CHKTX            CHECK FOR TAX INFORMATION ON UNIT S          
         BNE   RFADD95             NO TAX INFO SO SKIP THIS                     
RLADD02  BRAS  RE,V2CTX                                                         
         BNE   EXITL                                                            
         DROP  RF                                                               
*                                                                               
RFADD95  BRAS  RE,CHKPTRS                                                       
*        BL    RFADDXX                                                          
         BNL   RFADD100                                                         
         CLI   CSACT,A#CPY                                                      
         BNE   RFADDXX                                                          
RFADD100 GOTO1 ADDACTEL,AIOREC     ADD THE ACTIVITY ELEMENT                     
*                                                                               
RFADDXX  B     EXITOK                                                           
*                                                                               
* FEATURE REQUEST.  RIGHT NOW AC1RMNT ONLY READS PERSON LVL RATES               
* WANT TO READ HIGHER LEVEL OF 1R                                               
*        CLI   CSACT,A#RES         RESTORE ACTION?                              
*        BNE   EXITOK                                                           
*        CLC   =C'1R',ACTKUNT      FOR 1R ACCOUNTS                              
*        BNE   EXITOK                                                           
*        GOTO1 VAC1RMNT,BODMCB,(C'R',AIO1),VDMGR  RESTORE RATE RECS             
*        B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR RECORD OBJECT - DELETE                               *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,IOKEY                                                    
RFDEL    MVC   FVADDR,AACCFLD      SET CURSOR TO ACCOUNT FIELD                  
         MVI   BYTE2C,0                                                         
         MVC   SVKEY,IOKEY         SAVE KEY OF ACCOUNT RECORD                   
         CLC   =C'SJ',ACTKUNT                                                   
         BE    RFDELERR            CAN'T DELETE SJ HERE                         
         CLI   ACTKUNT,C'F'        MUST USE APGRULES REC FOR UNIT F             
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NOTF)                                            
         B     EXITL                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('PIDELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   *+14                ELEMENT NOT FOUND                            
         MVC   FVMSGNO,=AL2(AE$NPIDD) CANNOT DELETE ACCT IF PIDEL FOUND         
         B     EXITL                                                            
*                                                                               
         CLC   =C'1C',ACTKUNT      FOR 1C MUST CHECK IF COST METHOD             
         BNE   RFDEL02               BUCKETS EXIST                              
         BRAS  RE,CHKBUCK                                                       
         BNE   RFDELERR                                                         
*                                                                               
RFDEL02  CLC   =C'2D',ACTKUNT      IF THIS IS THE 1ST LEVEL OF A                
         BNE   RFDEL05             2D ACCOUNT MAKE SURE AN OFFICE REC           
         ZIC   R1,LNLEV1           DOES NOT EXIST BEFORE DELETING.              
         LA    RF,ACTKACT(R1)                                                   
         CLI   0(RF),C' '                                                       
         BNE   RFDEL05             NOT THE OFFICE LEVEL                         
         USING OFFRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   IOKEY,BCSPACES                                                   
         MVI   OFFKTYP,OFFKTYPQ                                                 
         MVC   OFFKCPY,CUABIN                                                   
         MVC   OFFKOFF,ACTKACT                                                  
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BNE   RFDEL05             NO OFFICE RECORD                             
         LA    R3,IOKEY                                                         
         TM    OFFKSTAT,OFFSLIST   IS IT AN OFFICE LST                          
         BZ    RFDELERR            NO, THAN CAN'T DELETE                        
         DROP  R3                                                               
*                                                                               
* FOR 1R ACCOUNTS ON NEW COST OR NOT DO NOT ALLOW DELETES TO                    
* LOWEST LEVEL.                                                                 
*                                                                               
RFDEL05  CLC   =C'1R',ACTKUNT      FOR 1R ACCOUNTS                              
         BNE   RFDEL10                                                          
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          CHECK IF LOWEST LEVEL                        
         BNE   RFDEL10                                                          
         MVC   FVMSGNO,=AL2(AE$RMICO) IF SO MUST USE COST PROGRAM               
         B     EXITL                                                            
*                                                                               
RFDEL10  MVC   IOKEY,SVKEY            RESET ORIGINAL KEY AND READ               
         LHI   R1,XOREAD+XOACCDIR+XIO1  AGAIN BECAUSE OF OFFICE REC             
         GOTO1 AIO                      READ                                    
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('DSCELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   RFDEL20                                                          
*                                                                               
         USING DSCELD,RF                                                        
         L     RF,12(R1)                                                        
         CP    DSCVAL,=P'0'        IF ANY DISTRIBUTOR UNITS                     
         BNE   RFDELERR            THAN CANT DELETE                             
         DROP  RF                                                               
*                                                                               
RFDEL20  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   RFDEL30                                                          
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         OC    RSTBDATE,RSTBDATE   IF ANY BAL BROUGHT FORWARD DATE              
         BZ    RFDEL30                                                          
         CLC   =C'3',ACTKUNT       FOR LEDGERS OTHER THAN RETAIL                
         BE    RFDEL30                                                          
         CLC   RSTTDATE,RSTBDATE   THAN CHECK FOR SELF BALANCING DR/CR          
         BH    RFDELERR                                                         
         DROP  RF                                                               
*                                                                               
RFDEL30  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ASTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   RFDEL40                                                          
*                                                                               
         USING ASTELD,RF                                                        
         L     RF,12(R1)                                                        
         OC    ASTDRAFT,ASTDRAFT                                                
         BZ    RFDEL40             NO DRAFT ITEMS - FINE                        
         MVC   FVMSGNO,=AL2(AE$DRFD)                                            
         B     EXITL                                                            
         DROP  RF                                                               
*                                                                               
RFDEL40  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   RFDEL50             IF NO 32 ELM THAN THIS IS A HIGH LVL         
*                                  ACCT SO MUST CHK IF LOWER LEVS EXIST         
         USING ABLELD,RF                                                        
         L     RF,12(R1)                                                        
         CP    ABLFRWD,=P'0'      ACCOUNT MUST HAVE BALANCE ELEMENT             
         BNE   RFDELERR            AND ALL BALANCES MUST BE ZERO                
         CP    ABLDR,=P'0'                                                      
         BNE   RFDELERR                                                         
         CP    ABLCR,=P'0'                                                      
         BNE   RFDELERR                                                         
         B     RFDEL90             LOW LEVEL ACCT WITH NO BALANCES SO           
         DROP  RF                  OK TO DELETE                                 
*                                                                               
RFDEL50  CLI   LNLEV1,L'ACTKACT    SINGLE LEVEL LEDGER?                         
         BE    RFDEL90             OK TO DELETE                                 
         ZIC   R3,LNLEV1                                                        
         LA    RF,T.ACTKACT(R3)      FIRST CHARACTER OF LEVEL B                 
         CLI   0(RF),C' '                                                       
         BE    RFDEL60             LEVEL B IS BLANK THIS IS LEVEL A             
*                                                                               
         IC    R3,LNLEV2                                                        
         LA    RF,T.ACTKACT(R3)                                                 
         CLI   LNLEV2,L'ACTKACT                                                 
         BE    RFDEL60                                                          
         CLI   0(RF),C' '                                                       
         BE    RFDEL60             LEVEL C IS BLANK THIS IS LEVEL B             
*                                                                               
         IC    R3,LNLEV3                                                        
         LA    RF,T.ACTKACT(R3)                                                 
         CLI   LNLEV3,L'ACTKACT                                                 
         BE    RFDEL60                                                          
         CLI   0(RF),C' '                                                       
         BE    RFDEL60             LEVEL D IS BLANK THIS IS LEVEL C             
         LA    R3,L'ACTKACT        LOWLEVEL ACCOUNT                             
         LA    RF,T.ACTKACT(R3)                                                 
*                                                                               
RFDEL60  ZIC   R0,0(,RF)           READ NEXT UNDELETED RECORD                   
         AHI   R0,1                                                             
         STC   R0,0(,RF)                                                        
*                                                                               
         LHI   R1,XOHIGH+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         LA    R3,2(,R3)           LENGTH FOR COMPARE                           
         EXCLC R3,IOKEY,IOKEYSAV                                                
         BNE   RFDEL90                                                          
*                                                                               
RFDELERR MVC   FVMSGNO,=AL2(AE$ACNVD) THAN CAN'T DELETE                         
         B     EXITL                                                            
*                                                                               
RFDEL90  DS    0H                                                               
         BRAS  RE,CHKPTRS                                                       
         BL    RFDELXX                                                          
RFDEL95  GOTO1 ADDACTEL,AIOREC     ADD THE ACTIVITY ELEMENT                     
*                                                                               
RFDELXX  B     EXITOK                                                           
* FEATURE REQUEST.  RIGHT NOW AC1RMNT ONLY READS PERSON LVL RATES               
* WANT TO READ HIGHER LEVEL OF 1R                                               
*        CLC   =C'1R',ACTKUNT      FOR 1R ACCOUNTS                              
*        BNE   EXITOK              DELETE THE RATE RECORDS.                     
*        GOTO1 VAC1RMNT,BODMCB,(C'D',AIO1),VDMGR                                
*        B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR WRITE (CHANGE)                                      *          
***********************************************************************         
         SPACE 1                                                                
RFWRT    DS    0H                                                               
         NI    GCINDS3,X'FF'-GCIDSMSG                                           
         USING CPYELD,RF                                                        
         LA    RF,SVCPYEL                                                       
         TM    CPYSTATA,CPYAUT2C   COMPANY AUTO UPDATE 2C?                      
         BZ    RFWRT10                                                          
         BRAS  RE,CHKTX            CHECK FOR TAX INFORMATION ON UNIT S          
         BNE   RFWRT10             NO TAX INFO SO SKIP THIS                     
         BRAS  RE,V2CTX                                                         
         BNE   EXITL                                                            
         DROP  RF                                                               
*                                                                               
RFWRT10  BRAS  RE,CHKPTRS                                                       
         BL    EXITOK                                                           
         GOTO1 ADDACTEL,AIOREC     ADD THE ACTIVITY ELEMENT                     
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* LAST TIME FOR RECORD OBJECT                                        *          
***********************************************************************         
         SPACE 1                                                                
RECLAST  L     R1,SVPARMS4                                                      
         LA    RF,RLTABL           TABLE OF KNOWN INVOKERS                      
         B     ITER                                                             
*                                                                               
******   DC    AL1(RCPY),AL1(0,0,0),AL4(RLADD)  RCPY NOT NEEDED B/C             
RLTABL   DC    AL1(RADD),AL1(0,0,0),AL4(RLADD)  RADD IS CALLED FOR              
         DC    AL1(RRES),AL1(0,0,0),AL4(RLADD)  COPY ACTION(WAS CAUSING         
         DC    AL1(RDEL),AL1(0,0,0),AL4(RLDEL)  DUPL. SEARCH POINTERS)          
         DC    AL1(RWRT),AL1(0,0,0),AL4(RLWRT)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* LAST TIME FOR WRITE                                                           
* IF TAX INFORMATION IS FOUND ON THE UNIT S ACCOUNT ADD/UPDATE 2C INFO.         
* UPDATE SEARCH POINTERS FOR CHANGED ACCOUNTS.                                  
***********************************************************************         
         SPACE 2                                                                
RLWRT    MVC   BODMCB(4),=C'CT  '  ACTION CHANGE                                
         BAS   RE,PUTSRC                                                        
*        CLC   =C'SY',ACTKUNT                                                   
*        BNE   RLWRT02                                                          
         CLI   ACTKUNT,C'S'        FOR UNIT S ONLY                              
         BNE   RLWRT02                                                          
         CLI   ACTKUNT+1,C'V'      FOR LEDGERS V,W,X,Y                          
         BL    RLWRT02                                                          
         CLI   ACTKUNT+1,C'Y'                                                   
         BH    RLWRT02                                                          
         BRAS  RE,GETPIDP          GET PID NUMBER                               
         MVC   SVNEWPID,BOWORK1                                                 
         BRAS  RE,GETPER           GET PERSONNEL ACCOUNT                        
         MVC   SVNEWPER,BOWORK1                                                 
         BRAS  RE,UPDPIDP          UPDATE PID/PERSONNEL RECORD                  
*                                                                               
RLWRT02  BRAS  RE,CHKPTRS                                                       
         BL    EXITOK                                                           
RLWRT10  GOTO1 ADDACTPT,AIOREC     UPDATE THE ACTIVITY POINTER                  
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* LAST TIME FOR ADD/COPY/RESTORE                                                
* IF TAX INFORMATION IS FOUND ON THE UNIT S ACCOUNT ADD/UPDATE 2C INFO.         
* ADD/RESTORE SEARCH POINTERS.                                                  
***********************************************************************         
         SPACE 2                                                                
RLADD    MVC   BODMCB(4),=C'AT  '                                               
         CLI   CSACT,A#RES       ACTION RESTORE?                                
         BNE   *+10                                                             
         MVC   BODMCB(4),=C'RT  '                                               
         BAS   RE,PUTSRC           UPDATE SEARCH NAME POINTER                   
         BRAS  RE,CHKPTRS                                                       
         BL    RLADD20                                                          
RLADD10  GOTO1 ADDACTPT,AIOREC     ADD THE ACTIVITY POINTER                     
*                                                                               
RLADD20  CLI   CSACT,A#RES         RESTORING?                                   
         BNE   RLADD30                                                          
*        CLC   =C'SY',ACTKUNT                                                   
*        BNE   RLADD30                                                          
         CLI   ACTKUNT,C'S'        FOR UNIT S ONLY                              
         BNE   RLADD30                                                          
         CLI   ACTKUNT+1,C'V'      FOR LEDGERS V,W,X,Y                          
         BL    RLADD30                                                          
         CLI   ACTKUNT+1,C'Y'                                                   
         BH    RLADD30                                                          
*                                                                               
         BRAS  RE,GETPIDP          GET PID NUMBER                               
         BNE   RLADD30                                                          
         MVC   SVNEWPID,BOWORK1    RESTORE PID PASSIVE                          
         BRAS  RE,GETPER           GET PERSONNEL ACCOUNT                        
         MVC   SVNEWPER,BOWORK1                                                 
         XC    SVOLDPID(SVPIDLNQ),SVOLDPID                                      
         BRAS  RE,UPDPIDP          UPDATE PID/PERSONNEL RECORD                  
*                                                                               
RLADD30  CLI   CSACT,A#ADD                                                      
         BNE   EXITOK                                                           
         CLI   BCPFKEY,8                                                        
         BNE   EXITOK                                                           
         OI    GENINDS,GENIENTR    ASK ROOT TO PRESS ENTER                      
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* LAST TIME FOR DELETE                                                *         
***********************************************************************         
         SPACE 1                                                                
RLDEL    MVC   BODMCB(4),=C'DT  '                                               
         BAS   RE,PUTSRC           UPDATE SEARCH NAME POINTER                   
         BRAS  RE,CHKPTRS                                                       
         BL    RLDEL20                                                          
RLDEL10  GOTO1 ADDACTPT,AIOREC     ADD THE ACTIVITY POINTER                     
RLDEL20  DS    0H                                                               
*        CLC   =C'SY',ACTKUNT      SY PAYABLE ACCOUNT ONLY                      
*        BNE   EXITOK                                                           
         CLI   ACTKUNT,C'S'        FOR UNIT S ONLY                              
         BNE   EXITOK                                                           
         CLI   ACTKUNT+1,C'V'      FOR LEDGERS V,W,X,Y                          
         BL    EXITOK                                                           
         CLI   ACTKUNT+1,C'Y'                                                   
         BH    EXITOK                                                           
*                                                                               
         BRAS  RE,GETPIDP          GET PID NUMBER                               
         BNE   EXITOK                                                           
         MVC   SVOLDPID,BOWORK1    DELETE PID PASSIVE                           
*                                                                               
         BRAS  RE,GETPER           GET PERSONNEL ACCOUNT                        
         MVC   SVOLDPER,BOWORK1                                                 
*                                                                               
         XC    SVNEWPID(SVPIDLNQ),SVNEWPID                                      
         BRAS  RE,UPDPIDP          UPDATE PID/PERSONNEL RECORD                  
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO CALL SEARCH NAME PASSIVE MAINTENANCE MODULE              *         
*                                                                     *         
* NTRY: BODMCB CONTAINS PARAMETER 1                                   *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
PUTSRC   NTR1  ,                                                                
         L     R3,AIOREC                                                        
         MVC   IOKEY(L'ACTKEY),T.ACTKEY                                         
         GOTO1 AGETLDG                                                          
         BNE   EXITL                                                            
         ICM   RE,15,ACALDG                                                     
         USING LDGTABD,RE                                                       
         LA    R1,LDGTLVA                                                       
         LA    R0,4                                                             
         XR    RF,RF                                                            
         CLI   CSACT,A#CHA                                                      
         BNE   PUTSRC10                                                         
         LA    RF,OLDNAME                                                       
         GOTO1 VACSRCHP,BODMCB,,AIOREC,GSRECDA,(RF),ACOM,0                      
         B     EXITOK                                                           
*                                                                               
PUTSRC10 CLI   0(R1),0                                                          
         BE    *+16                                                             
         LA    R1,1(,R1)                                                        
         LA    RF,1(,RF)           RF=LOWER LEVEL ACCOUNT                       
         BCT   R0,*-16                                                          
*                                                                               
         GOTO1 VACSRCHP,BODMCB,,AIOREC,GSRECDA,0,ACOM,((RF),0)                  
         B     EXITOK                                                           
         DROP  RE,T                                                             
         EJECT ,                                                                
***********************************************************************         
* ROUTINE TO GENERATE ACTIVITY POINTER ELEMENTS                                 
* R1 POINTS TO RECORD                                                           
***********************************************************************         
         SPACE 1                                                                
         USING RAPPERD,R3                                                       
         USING CPYELD,RF                                                        
ADDACTEL NTR1                                                                   
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   ADDAC10                                                          
         LA    RF,SVCPYEL                                                       
         TM    CPYSTATA,CPYSACCT    COMPANY USING ACCENT?                       
         BO    ADDAC20                                                          
         B     EXITOK                                                           
ADDAC10  TM    BCCPYST6,CPYSRAPP   TEST FOR RECORD ACTIVITY POINTERS            
         BZ    EXITOK              NO                                           
ADDAC20  L     R2,0(R1)                                                         
         L     RE,AIO4             CLEAR IO                                     
         LHI   RF,2000                                                          
         SR    R1,R1                                                            
         SR    R0,R0                                                            
         MVCL  RE,R0                                                            
         L     R3,AIO4                                                          
         XC    RAPBLK(RAPBLKL),RAPBLK                                           
         MVI   RAPACTN,RAPAELEM    BUILD RAP PTR ELEM                           
         MVC   RAPCPY,CUABIN                                                    
         MVI   RAPEMU,C'N'                                                      
         MVC   RAPACOM,ACOM                                                     
         ST    R2,RAPAREC         ADDRESS OF RECORD                             
         MVI   RAPRTYP,RAPKRPAL    1C P&L POINTERS?                             
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BE    ADDAC50                                                          
         MVI   RAPRTYP,RAPKRSUP   SUPPLIER/EXTRA SUPPLIER                       
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1R'                              
         BNE   ADDAC50                                                          
         CLI   LEVELN,1                                                         
         BNE   *+12                                                             
         MVI   RAPRTYP,RAPKR1RA    1R OFFICE CODE                               
         B     ADDAC50                                                          
         CLI   LEVELN,2                                                         
         BNE   *+12                                                             
         MVI   RAPRTYP,RAPKR1RB    1R DEPT CODE                                 
         B     ADDAC50                                                          
         CLI   LEVELN,3                                                         
         JNE   *+12                                                             
         MVI   RAPRTYP,RAPKR1RC    1R SUBDEPT CODE                              
         J     ADDAC50                                                          
         CLI   LEVELN,4                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   RAPRTYP,RAPKR1RD    1R SUBDEPT CODE                              
ADDAC50  GOTO1 VRAPPER,RAPBLK                                                   
         BE    EXITOK                                                           
         DC    H'0'                                                             
         DROP  R3,RF                                                            
         SPACE 2                                                                
***********************************************************************         
* ROUTINE TO GENERATE ACTIVITY POINTER                                *         
***********************************************************************         
         SPACE 1                                                                
         USING RAPPERD,R3                                                       
         USING CPYELD,RF                                                        
ADDACTPT NTR1                                                                   
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   ADDAP10                                                          
         LA    RF,SVCPYEL                                                       
         TM    CPYSTATA,CPYSACCT    COMPANY USING ACCENT?                       
         BO    ADDAP20                                                          
         B     EXITOK                                                           
ADDAP10  TM    BCCPYST6,CPYSRAPP   TEST FOR RECORD ACTIVITY POINTERS            
         BZ    EXITOK              NO                                           
*                                                                               
ADDAP20  L     R3,AIO4                                                          
         MVI   RAPACTN,RAPAPTR     BUILD RAP PTR RECORD                         
         MVC   RAPCPY,CUABIN                                                    
         MVI   RAPEMU,C'N'                                                      
         MVC   RAPACOM,ACOM                                                     
         ST    R2,RAPAREC         ADDRESS OF RECORD                             
         CLI   CSACT,A#CPY         FOR ACTN COPY CLEAR OUT THE OLD PTR          
         BNE   *+10                OR ELSE WON'T BUILD THE ACTIVITY             
         XC    RAPOLDP,RAPOLDP     REC                                          
         MVI   RAPRTYP,RAPKRPAL    1C P&L POINTERS?                             
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BE    ADDAP50                                                          
         MVI   RAPRTYP,RAPKRSUP                                                 
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1R'                              
         BNE   ADDAP50                                                          
         CLI   LEVELN,1                                                         
         BNE   *+12                                                             
         MVI   RAPRTYP,RAPKR1RA    1R OFFICE CODE                               
         B     ADDAP50                                                          
         CLI   LEVELN,2                                                         
         BNE   *+12                                                             
         MVI   RAPRTYP,RAPKR1RB    1R DEPT CODE                                 
         B     ADDAP50                                                          
         CLI   LEVELN,3                                                         
         JNE   *+12                                                             
         MVI   RAPRTYP,RAPKR1RC    1R SUBDEPT CODE                              
         J     ADDAP50                                                          
         CLI   LEVELN,4                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         MVI   RAPRTYP,RAPKR1RD    1R SUBDEPT CODE                              
ADDAP50  GOTO1 VRAPPER,RAPBLK                                                   
         BE    EXITOK                                                           
         DC    H'0'                                                             
         DROP  R3,RF                                                            
         EJECT                                                                  
***********************************************************************         
* SCREEN OBJECT                                                       *         
*                                                                     *         
* P1 HOLDS EQUATED OBJECT                                             *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 A(KEY)                                                           *         
* P4 HOLDS SUB-ACTION                                                 *         
***********************************************************************         
         SPACE 1                                                                
SCREEN   LM    R0,R3,SVPARMS                                                    
         USING ACTRECD,R2                                                       
         LA    RF,SCRTABL                                                       
         B     ITER                                                             
*                                                                               
SCRTABL  DC    AL1(SSET),AL1(0,0,0),AL4(SCRMSET)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* SET DATA SCREEN CODE                                                *         
* PAGE 2 IS SPECIFIC BY LEDGER SO CHECK WHAT LEDGER AND LOAD THE      *         
* APPROPRIATE SCREEN                                                  *         
***********************************************************************         
         SPACE 1                                                                
SCRMSET  GOTOR SETCODE                                                          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* PFKEY OBJECT                                                        *         
***********************************************************************         
         SPACE 1                                                                
PFK      LM    R0,R3,SVPARMS                                                    
         USING ACTRECD,R2                                                       
         LA    RF,PFKTABL                                                       
         B     ITER                                                             
*                                                                               
PFKTABL  DC    AL1(PFREC),AL1(0,0,0),AL4(PPFUSR)                                
*        DC    AL1(PFVAL),AL1(0,0,0),AL4(PPFVAL)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* SET THE RECORD PART OF THE PFKEY TAG                                          
***********************************************************************         
         SPACE 1                                                                
         USING FRPELD,RF                                                        
PPFUSR   DS    0H                                                               
         L     RF,SVPARMS3                                                      
         CLI   CSACT,A#LST              FOR PF16 KEY ON LIST SCREEN             
         BNE   EXITOK                   DISPALY AS 'FILTER/CLEAR'               
         CLI   0(RF),PFK16                                                      
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@FLT),AC@FLT                                          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE PFKEY PRESSED                                                        
***********************************************************************         
         SPACE 1                                                                
PPFVAL   DS    0H                                                               
         B     EXITOK                                                           
***********************************************************************         
* REPORT OBJECT                                                       *         
***********************************************************************         
         SPACE 1                                                                
REPORT   LM    R0,R3,SVPARMS                                                    
         USING ACTRECD,R2                                                       
         LA    RF,REPTABL                                                       
         B     ITER                                                             
*                                                                               
REPTABL  DC    AL1(RPQINIT),AL1(0,0,0),AL4(RINTPQ)                              
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* INITALIZE PRINT QUE                                                 *         
***********************************************************************         
         SPACE 1                                                                
         USING REPD,R3                                                          
RINTPQ   DS    0H                                                               
         L     R3,AREP                                                          
         MVC   REPDESC(11),=C'ACCT REPORT'                                      
         MVC   REPSUBID,=C'AAL'                                                 
         MVI   REPWIDTH,REPWIDEQ   SET WIDE PRINTING                            
         B     EXITOK                                                           
         DROP  R3                                                               
         EJECT                                                                  
***********************************************************************         
* DOWNLOAD OBJECT                                                     *         
***********************************************************************         
         SPACE 1                                                                
DLOAD    LM    R0,R3,SVPARMS                                                    
         USING ACTRECD,R2                                                       
         LA    RF,DLDTABL                                                       
         B     ITER                                                             
*                                                                               
DLDTABL  DC    AL1(DPQINIT),AL1(0,0,0),AL4(DINTPQ)                              
         DC    AL1(DSETCOLS),AL1(0,0,0),AL4(SETCOLS)                            
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* INITALIZE PRINT QUE                                                 *         
***********************************************************************         
         SPACE 1                                                                
         USING REPD,R3                                                          
DINTPQ   DS    0H                                                               
         L     R3,AREP                                                          
         MVC   REPDESC(10),=C'ACCT DLOAD'                                       
         MVC   REPSUBID,=C'AAL'                                                 
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* OVERRIDE THE HEADINGS FOR THE REPORT/DOWNLOAD FOR CERTAIN FIELDS    *         
* P3=FVIFLD (THIS IS WHERE THE HEADING IS STORED)                               
* P4=FDRELD (FIELD ELEMENT FROM THE CON FIELD RECORD)                           
***********************************************************************         
         SPACE 1                                                                
SETCOLS  DS    0H                                                               
         L     R2,SVPARMS3                                                      
         L     R4,SVPARMS4                                                      
         USING FDRELD,R4                                                        
         ZICM  R1,FDRNUM,2                                                      
         DROP  R4                                                               
*                                                                               
         LA    RF,SCOLTAB                                                       
SETCOL02 DS    0H                                                               
         CLC   =AL2(EOT),0(RF)                                                  
         BE    EXITOK              UNCHANGED COLUMN HEADING                     
         CLM   R1,3,0(RF)                                                       
         BE    SETCOL04                                                         
         LA    RF,6(RF)                                                         
         B     SETCOL02                                                         
*                                                                               
SETCOL04 DS    0H                                                               
         ICM   RF,15,2(RF)                                                      
         A     RF,BORELO                                                        
         BR    RF                                                               
*                                                                               
SCOLTAB  DS    0H                                                               
         DC    AL2(ACC#EQCD1),AL4(HDCD1)                                        
         DC    AL2(ACC#EQCD2),AL4(HDCD2)                                        
         DC    AL2(ACC#EQCD3),AL4(HDCD3)                                        
         DC    AL2(ACC#EQCD4),AL4(HDCD4)                                        
         DC    AL2(ACC#EQCD5),AL4(HDCD5)                                        
         DC    AL2(EOT)                                                         
         EJECT                                                                  
***********************************************************************         
* LIST OBJECT                                                         *         
*                                                                     *         
* P1 HOLDS EQUATED OBJECT                                             *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS CURRENT KEY BUILD AREA                                     *         
* P4 HOLDS PREVIOUS KEY                                               *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
LIST     LM    R0,R3,SVPARMS                                                    
THIS     USING ACTRECD,R2                                                       
LAST     USING ACTRECD,R3                                                       
         LA    RF,LISTABL                                                       
         USING OBJTABD,RF                                                       
LITER    CLI   OBJVERB,EOT         E.O.T.                                       
         BE    EXITOK                                                           
         CLM   R1,1,OBJVERB        R1 HOLDS EQUATE                              
         BE    LITER02             MATCHED                                      
         LA    RF,OBJTABL(RF)                                                   
         B     LITER               ITERATE TABLE                                
*                                                                               
LITER02  CLC   OBJIND3,GSSMPAGE    CHECK PAGE OK (0 FOR LIST)                   
         BE    LITER04                                                          
         LA    RF,OBJTABL(RF)                                                   
         B     LITER                                                            
*                                                                               
LITER04  ICM   RF,15,OBJADR        INVOKE OBJECT                                
         A     RF,BORELO                                                        
         BR    RF                                                               
         DROP  RF                                                               
         SPACE 2                                                                
LISTABL  DC    AL1(LINIT),AL1(0,0,0),AL4(INITL)                                 
         DC    AL1(LGETFRST),AL1(0,0,0),AL4(FLST)                               
         DC    AL1(LKEYCLM),AL1(0,0,0),AL4(LKYCLM)                              
         DC    AL1(LDEFCLM),AL1(0,0,0),AL4(DEFCLM)                              
         DC    AL1(LGETNEXT),AL1(0,0,0),AL4(NLST)                               
         DC    AL1(LTSARFIL),AL1(0,0,0),AL4(TSARFIL)                            
         DC    AL1(LSCRFRST),AL1(0,0,0),AL4(LSCR1)                              
         DC    AL1(LSCRLAST),AL1(0,0,0),AL4(SCRLAST)                            
         DC    AL1(LLSTLAST),AL1(0,0,0),AL4(LSTLAST)                            
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
         SPACE 1                                                                
***********************************************************************         
* INITIALIZE NEW LIST                                                           
***********************************************************************         
         SPACE 1                                                                
INITL    NI    ERRIND,X'FF'-ERMAXIO      MAX IO'S INDICATOR                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* NEED TO CHECK IF UL HAS CHANGED SO THAT I CAN SET A BIT TO REBUILD            
* THE COLUMNS AGAIN.                                                            
***********************************************************************         
         SPACE 1                                                                
         USING SCRTABD,RF                                                       
LKYCLM   DS    0H                                                               
         CLI   ACTKUNT,C' '        FIRST MAKE SURE WE HAVE A U/L                
         BE    EXITOK                                                           
         LA    RF,SCRTAB                                                        
LKYC35   CLI   0(RF),X'FF'                                                      
         BE    LKYC70                                                           
         LA    R1,2                COMPARE FOR 2 BYTES (UL) UNLESS              
         CLI   ACTKUNT,C'3'        FOR UNIT 3 AND UNIT G LEDGERS                
         BE    *+12                ONLY CHECK FIRST BYTE                        
         CLI   ACTKUNT,C'G'                                                     
         BNE   *+8                                                              
         LA    R1,1                                                             
         BCTR  R1,0                                                             
         EXCLC R1,ACTKUNT,SCRUL                                                 
         BE    LKYC50                                                           
*                                                                               
LKYC45   LA    RF,SCRLNQ(RF)       BUMP TO NEXT TABLE ENTRY                     
         B     LKYC35                                                           
*                                                                               
LKYC50   CLC   =C'SV',ACTKUNT      FOR SV,SW,SX,SY NEED TO MAKE                 
         BE    LKYC60              ADDITIONAL CHECKS                            
         CLC   =C'SW',ACTKUNT                                                   
         BE    LKYC60                                                           
         CLC   =C'SX',ACTKUNT                                                   
         BE    LKYC60                                                           
         CLC   =C'SY',ACTKUNT                                                   
         BNE   LKYC65                                                           
*                                                                               
LKYC60   CLI   SCRCTRY,0           IS THIS LEDGER COUNTRY SPECIFIC?             
         BE    LKYC65              NO                                           
         CLC   CUCTRY,SCRCTRY      MATCH ON COUNTRY?                            
         BNE   LKYC45              NO - READ AGAIN                              
*                                                                               
LKYC65   CLC   GSSMCODE,SCRCODE    ALREADY HAVE THE RIGHT SCREEN CODE?          
         BE    LKYC110             YES                                          
         B     LKYC100             NO - SET BIT TO REBUILD                      
*                                                                               
LKYC70   CLI   ACTKUNT,C'S'        IF WE GET HERE MEANS NO MATCH IN             
         BNE   LKYC75              TABLE.  FOR REMAINING UNIT S LEDGERS         
         CLC   ACTKUNT(2),=C'S9'   (EXCEPT S9) SHOULD HAVE SCREEN CODE          
         BE    LKYC75              'Q'                                          
         CLI   GSSMCODE,C'Q'                                                    
         BE    LKYC110                                                          
         B     LKYC100                                                          
*                                                                               
LKYC75   OC    GSSMCODE,GSSMCODE   IF GET HERE MEANS USE DEFAULT SCREEN         
         BZ    LKYC110                                                          
         B     LKYC100                                                          
*                                                                               
LKYC100  OI    LSSCIND1,LSSCICLM                                                
         OI    LSSCIND2,LSSCIDLM                                                
LKYC110  MVC   SVUL,ACTKUNT                                                     
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR LIST SCREEN                                          *         
* THIS CODE IS HERE SO I CAN GET CALLED WITH VERB DHED TO ALLOW       *         
* CHANGING OF THE ACCOUNT EQUIVALENCY POINTER HEADLINE.               *         
***********************************************************************         
         SPACE 1                                                                
LSCR1    CLC   SVUNT,ACTKUNT                                                    
         BE    LSCR20                                                           
         OC    SVUNT,SVUNT                                                      
         BNZ   LSCR10                                                           
         OC    LSLST#1,LSLST#1                                                  
         BNZ   LSCR20                                                           
LSCR10   OI    LSSCIND1,LSSCICLM                                                
LSCR20   MVC   SVUNT,ACTKUNT                                                    
         B     EXITOK              SO I CAN OVERRIDE THE ACCT. EQU'S            
         SPACE 2                                                                
***********************************************************************         
* SET UP DEFAULT COLUMN LIST                                          *         
***********************************************************************         
         SPACE 1                                                                
DEFCLM   GOTOR SETCODE                                                          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* FIRST FOR LIST                                                      *         
* SAVE THE UL IN SVUL AND SVUNT HERE BECAUSE WHEN GET BACK FROM COLUMN*         
* LIST SCREEN THE FIELDS ARE CLEARED SO WOULD REBUILD COLUMNS AND YOU *         
* WOULD GET THE DEFAULT COLUMNS BACK AGAIN INSTEAD OF THE CHANGES YOU *         
* MADE IN THE COLUMN LIST SCREEN                                                
***********************************************************************         
         SPACE 1                                                                
FLST     DS    0H                                                               
         NI    LSSTAT3,X'FF'-LS3RVAR                                            
         CLI   LNLEV1,X'40'        DO WE HAVE THIS INFO ALREADY?                
         BNH   *+12                IF SO DON'T READ LEDGER                      
         CLI   LEVELN,X'40'                                                     
         BH    FLST10                                                           
*                                                                               
         L     R3,AIO6                                                          
         GOTO1 AGETEL,BOPARM,('ACLELQ',AIO6),0                                  
         BNE   FLST05              NO ACCOUNT LENGTHS ELEMENT                   
         USING ACLELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVC   LNLEV1,ACLVALS                                                   
         MVC   LNLEV2,ACLVALS+(L'ACLVALS*1)                                     
         MVC   LNLEV3,ACLVALS+(L'ACLVALS*2)                                     
         MVC   LNLEV4,ACLVALS+(L'ACLVALS*3)                                     
*                                                                               
FLST05   TM    LSSCIND1,LSSCIFLT   TEST FILTERS CHANGED                         
         BO    FLST06              YES, IGNORE ERRIND                           
         TM    ERRIND,ERMAXIO                                                   
         BZ    FLST10                                                           
         MVC   THIS.ACTRECD(L'ACTKEY),SKEYLAST                                  
FLST06   NI    ERRIND,X'FF'-ERMAXIO                                             
         XC    SKEYLAST,SKEYLAST   OR CLEAR SAVED LAST KEY                      
*                                                                               
* NOT SURE WHAT THIS CODE WAS SUPPOSED TO DO BUT IT WAS CAUSING A               
* PROBLEM WHEN REACHING MAX IO WHILE LISTING ACCOUNTS.  DO NOT USE              
* UNLESS YOU FIGURE OUT WHAT THIS IS FOR.                                       
*                                                                               
*        CLI   LSLST#X,0           DID WE FIND AT LEAST ONE ENTRY?              
*        BNE   FLST10              YES SO DON'T NEED TO SET FIELDS              
*        MVI   LSPAG#1,1                                                        
*        LH    R1,LSPAG#1          SET LIST NO. OF END OF PAGE                  
*        AH    R1,LSLINPAG                                                      
*        BCTR  R1,0                                                             
*        STH   R1,LSPAG#X                                                       
*                                                                               
FLST10   MVC   SVUL,1(R2)     SAVE THE UL HERE                                  
         MVC   SVUNT,1(R2)                                                      
         NI    BYTE3,X'FF'-ADRCOL                                               
         SR    R1,R1                                                            
         ICM   R1,3,=AL2(ACC#ADDRL) ADDRESS FIELD (ON LIST SCREEN)              
         STCM  R1,3,BCHALF          CHECK IF ADDRESS FLD HAS BEEN INCL          
         BRAS  RE,CKLCOL            AS A COLUMN ON THE LIST SCREEN.             
         BNE   FLST20                                                           
         OI    BYTE3,ADRCOL        ADDRESS ADDED AS A COL ON LIST SCR           
         OI    LSSTAT3,LS3RVAR     LIST HAS VARIABLE # OF ROWS PER REC          
FLST20   MVC   IOKEY(L'ACTKEY),THIS.ACTRECD                                     
         MVI   ERRIND,0           RESET ERROR INDICATOR                         
         L     R1,=AL4(XOHID+XOACCDIR+XIO11)                                    
         GOTO1 AIO                                                              
         BE    NLST02                                                           
         BL    EXITL               HARD I/O ERROR                               
         TM    IOERR,IOEDEL        IF ERROR IS THAT REC IS DELETED              
         BO    NLST                READ NEXT INSTEAD OF EXIT                    
         B     EXITL                                                            
         SPACE 2                                                                
***********************************************************************         
* NEXT FOR LIST                                                       *         
***********************************************************************         
         SPACE 1                                                                
TEMP     USING ACTRECD,IOKEY                                                    
NLST     DS    0H                                                               
         XR    RF,RF                                                            
         IC    RF,TEMP.ACTKACT+L'ACTKACT-1                                      
         LA    RF,1(RF)                                                         
         STC   RF,TEMP.ACTKACT+L'ACTKACT-1                                      
         L     R1,=AL4(XOHID+XOACCDIR+XIO11)                                    
         GOTO1 AIO                                                              
*                                                                               
NLST02   DS    0H                                                               
         BRAS  RE,IOCHK            MAX IO'S MET?                                
         BE    NLST10              NO                                           
         OI    ERRIND,ERMAXIO                                                   
         MVC   SKEYLAST,IOKEY      WHEN RESUMED, START HERE                     
         B     EXITL                                                            
*                                                                               
NLST10   CLC   TEMP.ACTKCPY(L'ACTKCPY+L'ACTKUNT+L'ACTKLDG),THIS.ACTKCPY         
         BE    *+12                FOR ACCOUNT U/L IS REQUIRED & FIXED          
         OI    ERRIND,EOLSET       DONE FOR THIS U/L                            
         B     EXITL                                                            
         CLC   TEMP.ACTKACT,BCSPACES                                            
         BNH   NLST                MUST HAVE AN ACCOUNT                         
         TM    TEMP.ACTKSTAT,ACTSDELT          IS THIS REC DELETED?             
         BO    NLST                            THAN IGNORE IT                   
         GOTOX AGEN,BOPARM,OFILT,FFFLT,ACC#LVFLT  CHK IF ACCT LEVEL             
         BNE   NLST100             NO             FILTER IS SET                 
         GOTOX AGEN,BOPARM,OFILT,FDUSR,ACC#LVFLT  FILTER ON ACCT LEVEL          
         BNE   NLST                NO             WHILE BUILDING LIST           
*                                                                               
NLST100  GOTO1 ATSTSEC             TEST SECURITY                                
         MVC   FVXTRA,BCSPACES     CLEAR OUT ANY MSG'S FROM GETACT              
         BNE   NLST                                                             
         MVC   IODAOVER,IOKEY+(ACTKDA-ACTRECD) GET RIGHT RECORD                 
*                                                                               
NLST110  BRAS  RE,HILEVELS         SAVE HIGHER LEVEL ACCOUNTS                   
         BE    NLST120                                                          
         MVC   FVMSGNO,=AL2(AE$HLACM)                                           
         XC    IODAOVER,IODAOVER   THIS IS SET SOMETIMES!                       
         B     EXITL                                                            
*                                                                               
NLST120  DS    0H                                                               
         LHI   R1,XOREAD+XOACCDIR+XIO11   RE-READ THE ORIGINAL RECORD           
         GOTO1 AIO                                                              
         MVC   THIS.ACTKEY(ACCKLEN),TEMP.ACTRECD                                
         B     EXITOK                                                           
         DROP  TEMP                                                             
         SPACE 2                                                                
***********************************************************************         
* SET UP TSAR FROM FILE 0 (LIST SCREEN)                               *         
***********************************************************************         
         SPACE 1                                                                
         USING TLSTD,R4                                                         
TSARFIL  DS    0H                                                               
* CAN FILL IN TLROWS EVERYTIME IF NEEDED B/C IT ONLY COMES INTO PLAY            
* IF THE LS3RVAR BIT IS SET.                                                    
         TM    BYTE3,ADRCOL        DID USER ADD ADDRESS AS A LIST COL?          
         BZ    EXITOK              NO THAN NOTHING TO DO                        
         L     R4,ATLST                                                         
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ADRELQ',ACTRECD),0               
         SR    R0,R0               R0 WILL HOLD COUNT OF ADDRESS LINES          
         CLI   12(R1),0                                                         
         BNE   TSF010                                                           
         L     RF,12(,R1)                                                       
         USING ADRELD,RF                                                        
         ZIC   R0,ADRNUM          # OF ADDRESS LINES                            
*                                                                               
TSF010   LTR   R0,R0               IF NO ADDRESS MUST SET AT 1 ROW              
         BNZ   *+8                                                              
         LHI   R0,1                                                             
         STC   R0,TLROWS                                                        
         B     EXITOK                                                           
         DROP  R4,RF                                                            
         SPACE 2                                                                
***********************************************************************         
* LAST FOR LIST SCREEN                                                *         
* THIS MODE GETS CALLED AFTER A FULL SCREEN IS DISPLAYED.  SINCE      *         
* THIS PGM CHECKS FOR MAX IO'S AND EXITS LOW IF MAX IS REACHED THIS   *         
* MODE WILL NOT GET CALLED ALL THE TIME.                              *         
* NOT SURE IF THIS CODE WORKS BECAUSE I CUT DONW ON THE NUMBER OF IO'S*         
* SO HAVE NOT COME ACROSS THIS SITUATION.                             *         
*                                                                               
* THIS ROUTINE IS ALSO USED AFTER THE REPORT/DOWNLOAD IS PROCESSED    *         
* USED TO PUT OUT THE 'REPORT HAS BEEN SPOOLED' MSG...                          
***********************************************************************         
         SPACE 1                                                                
         USING REPD,R1                                                          
SCRLAST  CLI   NSACT,A#REPT        FOR REPORT OR DOWNLOAD                       
         BE    *+12                NEED TO DISPLAY MESSAGE                      
         CLI   NSACT,A#DLOAD                                                    
         BNE   SCRL10                                                           
         TM    ERRIND,ERMAXIO      DID WE REACH MAX IO'S?                       
         BNO   SCRL02              NO                                           
         MVC   FVMSGNO,=AL2(AE$PREP)  PARTIAL REPORT SPOOLED                    
         BRAS  RE,SETMSGID         SET UP XXX,9999 IN FVXTRA                    
         MVI   FVOMTYP,GTMERR      SET ERROR MESSAGE                            
         NI    ERRIND,X'FF'-ERMAXIO                                             
         B     EXITOK                                                           
*                                                                               
SCRL02   L     R1,AREP             REPORT BLOCK                                 
         TM    GCINDS2,GCIXITS     XITSES JUST ISSUED?                          
         BZ    SCRL10              NO                                           
         TM    GENINDS,GENWREP     REPORT TOO WIDE?                             
         BZ    SCRL05              NO                                           
         MVC   FVMSGNO,=AL2(AE$TOOWD) USE DLOAD INSTEAD                         
         MVI   FVOMTYP,GTMERR      SET ERROR MESSAGE                            
         MVI   FVOMTYP,GTMERR      SET INFORMATION MESSAGE                      
         NI    GENINDS,X'FF'-GENWREP                                            
         B     EXITOK                                                           
*                                                                               
SCRL05   BRAS  RE,SETMSGID         SET UP XXX,9999 IN FVXTRA                    
         MVI   FVOMTYP,GTMINF      SET INFORMATION MESSAGE                      
         MVC   FVMSGNO,=AL2(AI$REPSP)                                           
         CLI   NSACT,A#REPT                                                     
         BE    EXITOK                                                           
         MVC   FVMSGNO,=AL2(AI$DWNLD)                                           
         B     EXITOK                                                           
*                                                                               
SCRL10   TM    ERRIND,ERMAXIO      DID WE REACH MAX IO'S?                       
         BNO   EXITOK              NO                                           
*                                                                               
* SINCE THIS MESSAGE IS POTENTIALLY DISPLAYED BEFORE A WHOLE PAGE OF            
* ACCOUNTS IS DISPLAYED NEED TO CHECK THE ACTUAL # OF LINES DISPLAYED           
* TO THE MAX # OF LINES PER PAGE.  IF LOWER THAN DO NOT LET ENTER KEY           
* ACT AS A SCROLL B/C IT WILL AUTOMATICALLY GO TO THE NEXT PAGE OF              
* ACCTS WHICH MEANS SOME ACCOUNTS WILL NOT BE DISPLAYED.                        
*                                                                               
         MVC   FVMSGNO,=AL2(GI$DISNX)                                           
         CLC   LSNUMPAG,LSLINPAG   DID WE DISPLAY A FULL PAGE                   
         BNL   EXITL               YES SO IT'S OKAY                             
         NI    LSLTIND1,FF-LSLTIEOL NOT DONE YET                                
         OI    LSSTAT3,LS3NOSCR                                                 
         MVC   FVMSGNO,=AL2(AI$IOLMT)                                           
         MVI   FVOMTYP,C'I'                                                     
         B     EXITL                                                            
*                                                                               
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* LAST FOR LIST                                                       *         
* THIS MODE GETS CALLED AFTER AN EXIT LOW IN FLST/NLST (WHICH MAY BE  *         
* WHEN ALL RECORDS HAVE BEEN LISTED OR WHEN MAX IO'S HAVE BEEN REACHED*         
* NOT SURE IF THIS CODE WORKS BECAUSE I CUT DONW ON THE NUMBER OF IO'S*         
* SO HAVE NOT COME ACROSS THIS SITUATION.                             *         
***********************************************************************         
         SPACE 1                                                                
LSTLAST  DS    0H                                                               
         XC    IODAOVER,IODAOVER   THIS IS SET SOMETIMES!                       
         NI    LSSTAT3,X'FF'-LS3NOSCR                                           
         TM    ERRIND,EOLSET       DID WE FINISH LISTING ACCT RECS?             
         BZ    *+14                NO SO SEE IF WE REACHED MAX IO'S             
         XC    SKEYLAST,SKEYLAST                                                
         B     EXITOK                                                           
*                                                                               
         TM    ERRIND,ERMAXIO      DID WE REACH MAX IO'S?                       
         BNO   EXITOK              NO - OKAY THAN                               
         MVI   FVOMTYP,C'I'                                                     
         MVC   FVMSGNO,=AL2(GI$DISNX)                                           
         CLC   LSNUMPAG,LSLINPAG   DID WE DISPLAY A FULL PAGE                   
         BNL   EXITOK                                                           
         NI    LSLTIND1,FF-LSLTIEOL NOT DONE YET                                
         OI    LSSTAT3,LS3NOSCR                                                 
         MVC   FVMSGNO,=AL2(AI$IOLMT)                                           
         B     EXITL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT                                                         *         
*                                                                     *         
* P1 HOLDS EQUATED OBJECT IDENTIFIER                                  *         
* P2 HOLDS EQUATED DATA IDENTIFIER OR 0 IF GLOBAL DATA ACTION         *         
* P3 BYTE  0   HOLDS EQUATED DATA VERB IF P2 IS ZERO                  *         
* P3 BYTES 1-3 HOLDS EQUATED ACTION VERB                              *         
* P4 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P5 HOLDS A(FIELD TABLE ENTRY) OR ZERO IF P2 IS ZERO                 *         
*                                                                     *         
* FIELD DATA IS EXTRACTED/OUTPUT INTO FVIFLD                          *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
DATA     ICM   R1,15,SVPARMS2      R1 HOLDS DATA IDENTIFIER                     
         BNZ   DATA02              ACTION IS ON A DATA OBJECT                   
*                                                                               
         L     R2,SVPARMS+12                                                    
         USING ACTRECD,R2                                                       
         XR    R1,R1                                                            
         IC    R1,SVPARMS+8        GET GLOBAL VERB                              
         LA    RF,DTATABL                                                       
         B     ITER                                                             
*                                                                               
DATA02   LA    RF,KNOWTAB          TABLE OF KNOWN OBJECTS                       
         USING KNOWTABD,RF                                                      
*                                                                               
DATA04   CLC   KNOWID,=AL2(EOT)    REACH END - NOT A KNOWN DATA TYPE            
         BE    EXITH                                                            
         CLM   R1,3,KNOWID         IS THIS A KNOWN TYPE?                        
         BE    DATA06                                                           
         LA    RF,KNOWLQ(RF)                                                    
         B     DATA04                                                           
         SPACE 1                                                                
DATA06   ICM   RF,15,KNOWADD       A(KNOWN OBJECT)                              
         A     RF,BORELO           RELOCATE IT                                  
         LM    R1,R3,SVPARMS3      R1 HOLDS VERB                                
         USING ACTRECD,R2          R2 HOLDS A(RECORD)                           
         USING FDRELD,R3           R3 HOLDS A(FIELD TABLE ENTRY)                
         BR    RF                                                               
         SPACE 1                                                                
*                                                                               
DTATABL  DC    AL1(DFIRST),AL1(0,0,0),AL4(DTAFRST)                              
         DC    AL1(DLAST),AL1(0,0,0),AL4(DTALAST)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
         SPACE 1                                                                
KNOWTAB  DC    AL2(ACC#UL),AL4(ULCDTA)        UNIT AND LEDGER                   
         DC    AL2(ACC#ACCDE),AL4(ACCDTA)     ACCOUNT CODE                      
         DC    AL2(ACC#NAME),AL4(ACCNAME)     NAMEREC                           
         DC    AL2(ACC#FLT1),AL4(FLT1)        FILTER 1                          
         DC    AL2(ACC#FLT2),AL4(FLT2)        FILTER 2                          
         DC    AL2(ACC#FLT3),AL4(FLT3)        FILTER 3                          
         DC    AL2(ACC#FLT4),AL4(FLT4)        FILTER 4                          
         DC    AL2(ACC#FLT5),AL4(FLT5)        FILTER 5                          
         DC    AL2(ACC#GPEI),AL4(STAFF)       PERSONAL ANALYSIS STAFF=          
         DC    AL2(ACC#ACIL),AL4(LOCKED)      LOCKED                            
         DC    AL2(ACC#DEPT),AL4(DEPART)      DEPARTMENT                        
         DC    AL2(ACC#CSTNG),AL4(COSTING)    COST=Y/N                          
         DC    AL2(ACC#FAXNO),AL4(FAXNO)      FAX NUMBER                        
         DC    AL2(ACC#PAYEXL),AL4(PAYEXCL)   PAY=                              
         DC    AL2(ACC#1099),AL4(DO1099)      1099=                             
         DC    AL2(ACC#VEND2C),AL4(VEND2C)    VEND2C=PROFILE                    
         DC    AL2(ACC#GSTC),AL4(CANADTAX)    GSTCODE=                          
         DC    AL2(ACC#PSTC),AL4(CANADTAX)    PQ= (PST-CANADA)                  
         DC    AL2(ACC#VTYPE),AL4(VTYPE)      VENDOR TYPE                       
         DC    AL2(ACC#OUTF),AL4(OUTFILE)     OUTFILE                           
         DC    AL2(ACC#ACTL),AL4(ACTUAL)      ACTUAL                            
         DC    AL2(ACC#TMSLV),AL4(TSLEV)      T/S=P AND T/S=J                   
         DC    AL2(ACC#TASK),AL4(TASKC)       TASK=                             
         DC    AL2(ACC#OIN),AL4(OVINCACC)     OIN=                              
         DC    AL2(ACC#OWO),AL4(OVWOACC)      OWO=                              
         DC    AL2(ACC#CLTYP),AL4(CLTYP)      HOUSE=/NEWBIZ=/PROBONO=           
         DC    AL2(ACC#DISC),AL4(DISCOUNT)    DISCOUNT                          
         DC    AL2(ACC#ANALSE),AL4(ANALCODE)    ANALYSIS CODE FOR SE            
         DC    AL2(ACC#ANAL1R),AL4(ANALCODE)    ANALYSIS CODE FOR 1R            
         DC    AL2(ACC#ANAL1N),AL4(ANALCODE)    ANALYSIS CODE FOR 1N            
         DC    AL2(ACC#ANALSI),AL4(ANALCODE)    ANALYSIS CODE FOR SI            
         DC    AL2(ACC#OTNUM),AL4(NUMBER)      TAX ID NUMBER                    
         DC    AL2(ACC#TXTYPE),AL4(TXTYPE)   TAX ID TYP FOR ABOVE PROF          
         DC    AL2(ACC#GACC),AL4(GENERAL)     GENERAL ACC (NOT F)               
         DC    AL2(ACC#GLOFF),AL4(GLOFF)      GENERAL LEDGER OFFICE             
         DC    AL2(ACC#ETYPE),AL4(ETYPE)      EXEC=Y                            
         DC    AL2(ACC#LVL),AL4(GETLVL)       LVL WHERE PROFILE IS SET          
         DC    AL2(ACC#PRCR),AL4(RECON)       REQ DEBITS/CREDITS (SC)           
         DC    AL2(ACC#EMAIL),AL4(EMAIL)      EM= PROFILE EMAIL                 
         DC    AL2(ACC#MAIL),AL4(MAIL)        MAIL= PROF CHK DELIVERY           
         DC    AL2(ACC#EQCDS),AL4(EQCDS)     'ACC EQUIVALENT CODES' HDR         
         DC    AL2(ACC#EQNM1),AL4(EQNM1)      ACC EQU NAME 1                    
         DC    AL2(ACC#EQNM2),AL4(EQNM2)      ACC EQU NAME 2                    
         DC    AL2(ACC#EQNM3),AL4(EQNM3)      ACC EQU NAME 3                    
         DC    AL2(ACC#EQNM4),AL4(EQNM4)      ACC EQU NAME 4                    
         DC    AL2(ACC#EQNM5),AL4(EQNM5)      ACC EQU NAME 5                    
         DC    AL2(ACC#EQCD1),AL4(EQCD1)      ACC EQU CODE 1                    
         DC    AL2(ACC#EQCD2),AL4(EQCD2)      ACC EQU CODE 2                    
         DC    AL2(ACC#EQCD3),AL4(EQCD3)      ACC EQU CODE 3                    
         DC    AL2(ACC#EQCD4),AL4(EQCD4)      ACC EQU CODE 4                    
         DC    AL2(ACC#EQCD5),AL4(EQCD5)      ACC EQU CODE 5                    
         DC    AL2(ACC#RECV),AL4(RECV)        RBRRECB RECV=                     
         DC    AL2(ACC#COST1C),AL4(COST1C)    RBRCOST COST= (UNIT 3)            
         DC    AL2(ACC#COMM),AL4(COMM)        FFTTCOMR COMM= (UNIT3)            
         DC    AL2(ACC#BBFWD),AL4(BBFWD)      DATE BAL B/FD RSTBDATE            
         DC    AL2(ACC#ACTDT),AL4(ACTDT)      ACTIVITY DATE RSTTDATE            
         DC    AL2(ACC#CHADT),AL4(CHADT)      LAST CHANGED DATE RACELD          
         DC    AL2(ACC#LVFLT),AL4(DOFLTLV)    ACCOUNT LEVEL (LIST SCR)          
         DC    AL2(ACC#DUEF),AL4(DUEDF)       DUE DATE FORMULA                  
         DC    AL2(ACC#RCLEAR),AL4(RCLEAR)    REFRESH W/ CLEARANCE              
         DC    AL2(ACC#BNKCD),AL4(BNKCD)      BANK CODE (SC) (& BRANCH)         
         DC    AL2(ACC#BSCACN),AL4(BSCACC)    BANK ACCT NUMBER ON SC            
*SPEC-46491                                                                     
         DC    AL2(ACC#SCFFT1),AL4(BSCFFT1)   FREEFORM TEXT FLD1 ON SC          
         DC    AL2(ACC#SCFFT2),AL4(BSCFFT1)   FREEFORM TEXT FLD2 ON SC          
         DC    AL2(ACC#SCFFT3),AL4(BSCFFT1)   FREEFORM TEXT FLD3 ON SC          
         DC    AL2(ACC#SCFFT4),AL4(BSCFFT1)   FREEFORM TEXT FLD4 ON SC          
         DC    AL2(ACC#SCFFT5),AL4(BSCFFT1)   FREEFORM TEXT FLD5 ON SC          
         DC    AL2(ACC#SCFFT6),AL4(BSCFFT1)   FREEFORM TEXT FLD6 ON SC          
         DC    AL2(ACC#SCFFT7),AL4(BSCFFT1)   FREEFORM TEXT FLD7 ON SC          
         DC    AL2(ACC#SCFFT8),AL4(BSCFFT1)   FREEFORM TEXT FLD8 ON SC          
*SPEC-46491                                                                     
         DC    AL2(ACC#BPYACN),AL4(BPYACC)    BANK ACCT NUMBER PAYABLES         
         DC    AL2(ACC#ROUTN),AL4(BNKROUT)    BANK ROUTING # (PAYABLES)         
         DC    AL2(ACC#PAYMTH),AL4(PAYMTH)    PAYMENT METHOD (PAYABLES)         
         DC    AL2(ACC#PCARDT),AL4(PCARDT)    PCARD TYPE     (PAYABLES)         
         DC    AL2(ACC#RMDELI),AL4(RMDELI)    REMMT DLVRY INSTR(PAYBLS)         
         DC    AL2(ACC#CNTNM),AL4(CONTNM)     CONTACT NAME (PAYABLES)           
         DC    AL2(ACC#ADDRL),AL4(ADDRL)      ADDRESS(ON LIST SCR ONLY)         
         DC    AL2(ACC#RVSGN),AL4(RVSGN)      REVERSE SIGN OF CR BAL            
         DC    AL2(ACC#CRMC),AL4(MSGCL)       MSG CLASS FOR ACR                 
         DC    AL2(ACC#EFMC),AL4(MSGCL)       MSG CLASS FOR EFT                 
         DC    AL2(ACC#PPMC),AL4(MSGCL)       MSG CLASS FOR POSPAY              
         DC    AL2(ACC#820MC),AL4(MSGCL)      MSG CLASS FOR 820                 
         DC    AL2(ACC#CRDSN),AL4(DSNAME)     DATASET NAME FOR ACR              
         DC    AL2(ACC#EFDSN),AL4(DSNAME)     DATASET NAME FOR EFT              
         DC    AL2(ACC#PPDSN),AL4(DSNAME)     DATASET NAME FOR POSPAY           
         DC    AL2(ACC#820DSN),AL4(DSNAME)    DATASET NAME FOR 820              
         DC    AL2(ACC#PHONE),AL4(PHONE)      PHONE #                           
         DC    AL2(ACC#LCHGBY),AL4(CHABY)     LAST CHANGED BY RACELD            
         DC    AL2(ACC#2PTE),AL4(PERDTA)      2P T&E CODE                       
         DC    AL2(ACC#2DDPT),AL4(DPTDTA)     2D DEPT CODE                      
         DC    AL2(ACC#PID),AL4(PIDCDTA)      PID CODE                          
         DC    AL2(ACC#FTIMA),AL4(FUTA)       FUTURE TIME ALLOWED - 1N          
         DC    AL2(ACC#BCNM),AL4(BCNM)        BUSINESS CONTACT NAME             
         DC    AL2(ACC#BPHN),AL4(BPHN)        BUSINESS PHONE NUMBER             
         DC    AL2(ACC#BFAX),AL4(BFAX)        BUSINESS FAX NUMBER               
         DC    AL2(ACC#BEML),AL4(BEML)        BUSINESS EMAIL ADDRESS            
         DC    AL2(ACC#CENT),AL4(CENT)        CORPORATE ENTITY ACCOUNT          
         DC    AL2(ACC#CENTN),AL4(CENTN)      CORP ENTITY ACCT NAME             
         DC    AL2(ACC#GAPUSE),AL4(GAPS)      GAP-SEND ORDER TO VENDOR          
         DC    AL2(ACC#GAPASK),AL4(GAPQ)      GAP-ACKNOWLEDGE/QUESTION          
         DC    AL2(ACC#MILES),AL4(MILES)      MILEAGE ANALYSIS (SE)             
         DC    AL2(ACC#SWIFT),AL4(SWIFT)      INTNL BANK SWIFT CODE             
         DC    AL2(ACC#IBAN),AL4(IBAN)        INTNL BANK ACCT NUMBER            
         DC    AL2(ACC#IBNM),AL4(IBNM)        INTNL BANK NAME                   
         DC    AL2(ACC#IBAL1),AL4(IBADD1)     INTNL BANK ADDR LINE 1            
         DC    AL2(ACC#IBAL2),AL4(IBADD2)     INTNL BANK ADDR LINE 2            
         DC    AL2(ACC#IBAL3),AL4(IBADD3)     INTNL BANK ADDR LINE 3            
         DC    AL2(ACC#TLOC),AL4(TLO)         LOCK 1N ACCOUNTS FROM T/S         
         DC    AL2(EOT)                                                         
         SPACE 2                                                                
*                                                                               
KNOWTABD DSECT                                                                  
KNOWID   DS    XL2                 IDENTIFIER                                   
KNOWADD  DS    AL4                 A(OBJECT)                                    
KNOWLQ   EQU   *-KNOWTABD                                                       
*                                                                               
FIL19    CSECT                                                                  
         SPACE 2                                                                
*                                                                               
* TABLE OF SCREEN CODES BASED ON UL/COUNTRY/AGENCY ALPHA                        
*                                                                               
* NOTE:  EVEN THOUGH CODE 'Q' IS NOT IN THE TABLE IT'S STILL IN USE             
*        SO DON'T DELETE THE SCREEN RECORD OR THE DEF_CLM RECORD.               
*                                                                               
SCRTAB   DC    C'SV',AL1(CTRYUSA),X'00',C'I'   SV/USA (JWT TOO)                 
         DC    C'SV',AL1(CTRYCAN),X'00',C'J'   SV/CANADA                        
         DC    C'SW',AL1(CTRYUSA),X'00',C'L'   SW/USA                           
         DC    C'SW',AL1(CTRYCAN),X'00',C'K'   SW/CANADA                        
         DC    C'SX',AL1(CTRYUSA),X'00',C'M'   SX/USA                           
         DC    C'SX',AL1(CTRYCAN),X'00',C'K'   SX/CANADA                        
         DC    C'SY',AL1(CTRYUSA),X'00',C'N'   SY/USA                           
         DC    C'SY',AL1(CTRYCAN),X'00',C'R'   SY/CANADA                        
         DC    C'SP',AL1(0),X'00',C'A'                                          
         DC    C'SQ',AL1(0),X'00',C'A'                                          
         DC    C'SS',AL1(0),X'00',C'A'                                          
         DC    C'ST',AL1(0),X'00',C'A'                                          
         DC    C'SU',AL1(0),X'00',C'A'                                          
         DC    C'1R',AL1(0),X'00',C'B'                                          
         DC    C'1C',AL1(0),X'00',C'C'                                          
         DC    C'1N',AL1(0),X'00',C'D'                                          
         DC    C'SC',AL1(0),X'00',C'E'                                          
         DC    C'2C',AL1(0),X'00',C'F'                                          
         DC    C'SE',AL1(0),X'00',C'G'                                          
         DC    C'SI',AL1(0),X'00',C'O'                                          
         DC    C'3 ',AL1(0),X'00',C'P'       FOR ALL OF UNIT 3                  
         DC    C'G ',AL1(0),X'00',C'H'       FOR ALL OF UNIT G                  
         DC    X'FF'                                                            
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR DATA OBJECT                                          *         
***********************************************************************         
         SPACE 1                                                                
DTAFRST  L     R1,SVPARMS3                                                      
         LA    RF,DFTABL           TABLE OF KNOWN INVOKERS                      
         B     ITER                                                             
*                                                                               
DFTABL   DC    AL1(DDIS),AL1(0,0,0),AL4(DFDDIS)                                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(DFDVAL)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR DISPLAY OF A DATA OBJECT                             *         
***********************************************************************         
         SPACE 1                                                                
DFDDIS   LA    R0,SETTAB           CLEAR TABLE OF SETTINGS                      
         L     R1,=A(SETEND-SETTAB)                                             
         LR    RE,R0                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
         MVI   BYTE,0                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         NI    ACCINDS,X'FF'-ACCICKSP   ROUTINE CHKSPAC HAS BEEN CALLED         
         XC    ARSTEL,ARSTEL                                                    
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         L     R4,12(,R1)                                                       
         ST    R4,ARSTEL           SAVE A(RECORD STATUS ELEMENT)                
*        CLI   GSSMPAGE,2          BUT FOR PAGE 1 OF DATA SCREEN                
*        BE    *+8                                                              
*        NI    GCINDS3,X'FF'-GCIDSMSG                                           
*                                                                               
*        USING RSTELD,RF                                                        
*        XC    BOELEM,BOELEM                                                    
*        GOTO1 AGETEL,BOPARM,('RSTELQ',ACTRECD),0                               
*        BNE   EXITOK                                                           
*        LA    RF,BOELEM                                                        
*        CLI   RSTLN,RSTLN3Q       ALWAYS DEAL WITH X'30' LONGEST LEN           
*        BNL   EXITOK                                                           
*        MVI   RSTSTAT5,0                                                       
*        MVI   RSTMAIL,0                                                        
*        MVI   RSTSTAT6,0                                                       
*        MVI   RSTX1099,0                                                       
*        MVC   RSTDFTSK,BCSPACES                                                
*        MVI   RSTLN,RSTLN3Q       NEW LENGTH                                   
*        GOTO1 AREPEL,BOPARM,('RSTELQ',ACTRECD),0,BOELEM                        
*        DROP  RF                                                               
*                                                                               
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* FIRST TIME FOR VALIDATE OF A DATA OBJECT                            *         
***********************************************************************         
         SPACE 1                                                                
         USING RSTELD,R3                                                        
T        USING RSTELD,BOELEM                                                    
DFDVAL   MVI   BYTE,0                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         XC    SVOLDPID(SVPIDLNQ),SVOLDPID                                      
         GOTO1 AGETEL,BOPARM,('RSTELQ',ACTRECD),0                               
         BE    DFDV01                                                           
*                                                                               
         LA    R3,BOELEM           ADD 30 ELEMENT W/ LONG LENGTH                
         XC    RSTELD(RSTLN3Q),RSTELD                                           
         MVI   RSTEL,RSTELQ                                                     
         MVI   RSTLN,RSTLN3Q                                                    
         MVC   RSTBDATE,BCTODAYP                                                
         MVC   RSTTDATE,BCTODAYP                                                
         MVI   RSTCOSTG,C' '                                                    
         MVI   RSTFILT1,C' '                                                    
         MVI   RSTFILT2,C' '                                                    
         MVI   RSTFILT3,C' '                                                    
         MVI   RSTFILT4,C' '                                                    
         MVI   RSTFILT5,C' '                                                    
         MVC   RSTDFTSK,BCSPACES                                                
         GOTO1 VHELLO,BCPARM,(C'P',GCFILNAM),(R2),RSTELD,0                      
         CLI   12(R1),0                                                         
         BNE   EXITL                                                            
         B     DFDV02                                                           
*                                                                               
DFDV01   LA    R3,BOELEM           ADD 30 ELEMENT W/ LONG LENGTH                
         CLI   T.RSTLN,RSTLN3Q     MAKE SURE THE STATUS ELEMENT                 
         BNL   DFDV02              IS CONSISTENT FOR PRE-EXISTING               
         MVI   RSTSTAT5,0                                                       
         MVI   RSTMAIL,0                                                        
         MVI   RSTSTAT6,0                                                       
         MVI   RSTX1099,0                                                       
         MVC   RSTDFTSK,BCSPACES                                                
         MVI   T.RSTLN,RSTLN3Q     NEW LENGTH                                   
         GOTO1 AREPEL,BOPARM,('RSTELQ',ACTRECD),0,BOELEM                        
*                                                                               
DFDV02   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   ARSTEL,12(R1)       SAVE FOR LATER                               
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          CHECK IF LOW LEVEL ACCT                      
         BNE   EXITOK                                                           
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ASTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    DFDV04                                                           
         GOTO1 AADDAST,ACTRECD     ADD AN ASTEL IF NONE THERE                   
         BNE   EXITL                                                            
*                                                                               
DFDV04   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('APOELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    DFDV06                                                           
*                                                                               
         USING APOELD,R3           ADD PEEL OFF ELEMENT                         
         LA    R3,BOELEM                                                        
         XC    APOELD(APOLN1Q),APOELD                                           
         MVI   APOEL,APOELQ                                                     
         MVI   APOLN,APOLN1Q                                                    
         ZAP   APODR,=P'0'                                                      
         ZAP   APOCR,=P'0'                                                      
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),ACTRECD,APOELD,0                   
         DROP  R3                                                               
*                                                                               
DFDV06   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    EXITOK                                                           
*                                                                               
         OI    GSRECSTA+(ACTKSTAT-ACTKSTA),ACTSABLP                             
         USING ABLELD,R3           ADD BALANCE ELEMENT                          
         LA    R3,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   ABLEL,ABLELQ                                                     
         MVI   ABLLN,ABLLN3Q                                                    
         ZAP   ABLFRWD,=P'0'                                                    
         ZAP   ABLDR,=P'0'                                                      
         ZAP   ABLCR,=P'0'                                                      
         ZAP   ABLURG,=P'0'                                                     
         GOTO1 VHELLO,BCPARM,(C'P',GCFILNAM),ACTRECD,ABLELD                     
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* LAST TIME FOR DATA OBJECT                                           *         
***********************************************************************         
         SPACE 1                                                                
DTALAST  L     R1,SVPARMS3                                                      
         LA    RF,DLTABL           TABLE OF KNOWN INVOKERS                      
         B     ITER                                                             
*                                                                               
DLTABL   DC    AL1(DVAL),AL1(0,0,0),AL4(DLDVAL)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* LAST TIME FOR VALIDATE OF A DATA OBJECT                             *         
***********************************************************************         
         SPACE 1                                                                
DLDVAL   B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR UNIT/LEDGER CODE ACTKUNT+ACTKLDG                    *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ULCDTA   LA    RF,ULCTBL                                                        
         B     ITER                                                             
*                                                                               
ULCTBL   DC    AL1(DDIS),AL1(0,0,0),AL4(DISULC)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISULC)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALULC)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFLTULC)                               
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFLTULC)                               
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFTULC)                                
         DC    AL1(DNTR),AL1(0,0,0),AL4(DISULC)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY A LEDGER FIELD                                              *         
***********************************************************************         
         SPACE 1                                                                
DISULC   MVC   FVIFLD(L'ACTKUNT+L'ACTKLDG),ACTKUNT                              
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE A LEDGER FIELD                                             *         
* SAVE THE LEDGER RECORD INTO AIO6 FOR USE BY OTHER ROUTINES          *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,IOKEY                                                    
VALULC   MVC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),FVIFLD                              
         CLC   =C'SJ',ACTKUNT       PRODUCTION LEDGER                           
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$UPROD)   MUST USE PRODUCTION SYSTEM              
         B     EXITL                                                            
         CLI   ACTKUNT,C'F'        MUST USE APGRULES REC FOR UNIT F             
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NOTF)                                            
         B     EXITL                                                            
*                                                                               
         MVC   T.ACTKEY,BCSPACES   READ THE LEDGER RECORD FOR T                 
         MVC   T.ACTKCPY(3),ACTKCPY     COMPANY/UNIT/LEDGER                     
         DROP  T                                                                
         GOTO1 AGETACT,0                                                        
         BNE   EXITL                                                            
         GOTO1 AGETEL,BOPARM,('LDGELQ',AIO1),0                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   SVLDGEL,BOELEM     SAVE LEDGER ELEMENT                           
*                                                                               
         GOTO1 AGETEL,BOPARM,('ACLELQ',AIO1),0                                  
         BNE   EXITNV              NO ACCOUNT LENGTHS ELEMENT                   
         USING ACLELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVC   LNLEV1,ACLVALS                                                   
         MVC   LNLEV2,ACLVALS+(L'ACLVALS*1)                                     
         MVC   LNLEV3,ACLVALS+(L'ACLVALS*2)                                     
         MVC   LNLEV4,ACLVALS+(L'ACLVALS*3)                                     
*                                                                               
         L     R0,AIO6             COPY LEDGER RECORD INTO AIO6 IN              
         LHI   R1,2000             ORDER TO SAVE IT FOR USE BY OTHER            
         L     RE,AIO1             ROUTINES.                                    
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY A LEDGER FILTER FIELD                                       *         
***********************************************************************         
         SPACE 1                                                                
DFLTULC  CLI   FLTIFLD,0           HAS THIS FILTER BEEN CLEARED WITH            
         BNE   *+10                A PFKEY?  IF SO RESET                        
         MVC   FLTIFLD(L'SVUL),SVUL                                             
         MVC   FVIFLD(L'ACTKUNT+L'ACTKLDG),FLTIFLD                              
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE A LEDGER FILTER FIELD                                      *         
* SAVE THE LEDGER RECORD INTO AIO6 FOR USE BY OTHER ROUTINES          *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,IOKEY                                                    
VFLTULC  DS    0H                                                               
         NI    BYTE2,X'FF'-FILTCLR                                              
         CLI   BCPFKEY,16          WANT TO CLEAR FILTERS WITH PFKEY?            
         BNE   VFUL80              NO                                           
         BRAS  RE,CLRQFLT                                                       
         B     VFUL90                                                           
*                                                                               
VFUL80   CLC   SVUL,FVIFLD         IS USER CHANGING U/L'S?                      
         BE    VFUL100             NO                                           
         OC    SVUL,SVUL           IS THIS THE FIRST TIME IN?                   
         BZ    VFUL90              YES                                          
         OI    BYTE2,FILTCLR        SET BIT FOR OTHER FILTER ROUTINES           
VFUL90   BRAS  RE,CLRFILT                                                       
*                                                                               
VFUL100  DS    0H                                                               
         CLI   CSREC,O#FLTR            TRIED TO ALLOW USER TO CHANGE            
         BNE   VFUL110                 U/L ON THE FILTER SCREEN BUT             
         CLC   SVUL,FVIFLD             WHEN YOU RETURN FROM THE LIST            
         BE    VFUL110                 THE CORRECT COLUMNS ARE NOT              
         MVC   FVMSGNO,=AL2(AE$ULNO)                                            
         B     EXITL                                                            
*                                                                               
VFUL110  MVC   FLTIFLD,BCSPACES                                                 
         MVC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),FVIFLD                              
         CLC   =C'SJ',ACTKUNT       PRODUCTION LEDGER                           
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$UPROD)   MUST USE PRODUCTION SYSTEM              
         B     EXITL                                                            
         CLI   ACTKUNT,C'F'        MUST USE APGRULES REC FOR UNIT F             
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NOTF)                                            
         B     EXITL                                                            
*                                                                               
         MVC   FLTIFLD(L'ACTKUNT+L'ACTKLDG),FVIFLD                              
         MVC   T.ACTKEY,BCSPACES   READ THE LEDGER RECORD FOR T                 
         MVC   T.ACTKCPY,CUABIN    IF THE U/L IS BEING ENTERED ON THE           
*                                  FILTER SCRN INSTEAD OF LIST SCREEN           
*                                  THAN THE CO CODE NOT FILLED IN               
         MVC   T.ACTKUNT(2),ACTKUNT     UNIT/LEDGER                             
         DROP  T                                                                
*                                                                               
         GOTO1 AGETACT,0                                                        
         BNE   EXITL                                                            
         GOTO1 AGETEL,BOPARM,('LDGELQ',AIO1),0                                  
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   SVLDGEL,BOELEM     SAVE LEDGER ELEMENT                           
*                                                                               
         GOTO1 AGETEL,BOPARM,('ACLELQ',AIO1),0                                  
         BNE   EXITNV              NO ACCOUNT LENGTHS ELEMENT                   
         USING ACLELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVC   LNLEV1,ACLVALS                                                   
         MVC   LNLEV2,ACLVALS+(L'ACLVALS*1)                                     
         MVC   LNLEV3,ACLVALS+(L'ACLVALS*2)                                     
         MVC   LNLEV4,ACLVALS+(L'ACLVALS*3)                                     
*                                                                               
         L     R0,AIO6             COPY LEDGER RECORD INTO AIO6 IN              
         LHI   R1,2000             ORDER TO SAVE IT FOR USE BY OTHER            
         L     RE,AIO1             ROUTINES.                                    
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR LEDGER                                             *         
***********************************************************************         
         SPACE 1                                                                
DOFTULC  CLI   ACTKLDG,C' '        IS THERE A LEDGER TO COMPARE ON?             
         BNH   FLTXX               NO - WE DON`T WANT IT THEN                   
*                                                                               
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),FLTIFLD                             
         BL    FLTXL                                                            
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT                                             *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ACCDTA   LA    RF,ACCTBL                                                        
         B     ITER                                                             
*                                                                               
ACCTBL   DC    AL1(DDIS),AL1(0,0,0),AL4(DISACC)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISACC)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALACC)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFLTACC)                               
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFLTACC)                               
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFTACC)                                
         DC    AL1(DNTR),AL1(0,0,0),AL4(DISACC)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCHACC)                               
         DC    AL1(DNTR),AL1(0,0,0),AL4(DISACC)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY AN ACCOUNT FIELD                                            *         
***********************************************************************         
         SPACE 1                                                                
DISACC   DS    0H                                                               
         BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVC   FVIFLD(L'ACTKACT),ACTKACT                                        
         CLI   CSACT,A#LST         LIST/REPORT/DOWLOAD?                         
         BE    DISAC05             NO-THAN DON'T NEED TO DO THIS CODE           
         CLI   CSACT,A#REPT                                                     
         BE    DISAC05                                                          
         CLI   CSACT,A#DLOAD                                                    
         BNE   DISACCX                                                          
*                                                                               
DISAC05  CLI   LNLEV1,X'40'        DO WE HAVE THIS INFO ALREADY?                
         BNH   DISAC60                                                          
         LA    RE,12                                                            
         LA    R1,ACTKACT+L'ACTKACT-1 POINT TO END OF ACCOUNT                   
DISAC10  CLI   0(R1),C' '             FIND OUT HOW MANY CHARACTERS              
         BNE   DISAC20                OF ACCOUNT USER ENTERED                   
         SHI   R1,1                                                             
         BCT   RE,DISAC10                                                       
*                                                                               
DISAC20  STC   RE,BCBYTE1                                                       
         BRAS  RE,SETLEN           IS SO DON'T READ LEDGER BUT SET              
         B     DISACCX             LEVELN FIELD                                 
*                                                                               
* AIO6 HOLDS THE LEDGER RECORD UNLESS YOU JUST CAME BACK FROM THE               
* COLUMN/LIST SCREEN OR THE FILTER/LIST SCREEN.  IN THAT CASE YOU NEED          
* TO READ THE LEDGER RECORD AGAIN.                                              
         USING LDGRECD,R3                                                       
DISAC60  L     R3,AIO6                                                          
         CLC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),GSRECKEY+1                          
         BE    *+8                                                              
         BRAS  RE,RDLDG                                                         
         GOTO1 AGETEL,BOPARM,('ACLELQ',AIO6),0                                  
         BNE   EXITNV              NO ACCOUNT LENGTHS ELEMENT                   
         USING ACLELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVC   LNLEV1,ACLVALS                                                   
         MVC   LNLEV2,ACLVALS+(L'ACLVALS*1)                                     
         MVC   LNLEV3,ACLVALS+(L'ACLVALS*2)                                     
         MVC   LNLEV4,ACLVALS+(L'ACLVALS*3)                                     
         MVC   IOKEY,SVKEY                                                      
*                                                                               
         LA    RE,12                                                            
         LA    R1,ACTKACT+L'ACTKACT-1 POINT TO END OF ACCOUNT                   
DISAC80  CLI   0(R1),C' '             FIND OUT HOW MANY CHARACTERS              
         BNE   DISAC100               OF ACCOUNT USER ENTERED                   
         SHI   R1,1                                                             
         BCT   RE,DISAC80                                                       
*                                                                               
DISAC100 STC   RE,BCBYTE1                                                       
         BRAS  RE,SETLEN                                                        
*                                                                               
DISACCX  B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* SEARCH ON AN ACCOUNT FIELD                                          *         
***********************************************************************         
         SPACE 1                                                                
SRCHACC  CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         GOTO1 VACSRCHC,BOPARM,(3,SVPARMS5),ATWA,ACTKUNT,              X        
               ACOM,(X'14',0)                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE AN ACCOUNT FIELD                                           *         
***********************************************************************         
         SPACE 1                                                                
         USING CPYELD,R4                                                        
VALACC   DS    0H                                                               
         BRAS  RE,READCO                                                        
         MVC   ACTKACT,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,ACTKACT,FVIFLD                                                
*                                                                               
         MVC   BCWORK,BCSPACES                                                  
         SR    R3,R3                                                            
         ICM   R3,3,GSDSPACT       SAVE THE ACTION IN BCWORK                    
         A     R3,ATWA                                                          
         USING FHD,R3                                                           
         MVC   BCWORK(8),FHDA                                                   
         OC    BCWORK,BCSPACES     CAPTIALIZE                                   
*                                                                               
         CLC   BCWORK(L'AC@CHG),AC@CHG       IS THE ACTION CHANGE?              
         BNE   VACC05                                                           
         CLI   GSSMPAGE,1             USERS ARE TRYING TO ADD FROM THE          
         BNH   VACC05                 2ND PAGE W/O CHANGING THE ACTION          
         MVC   IOKEY,BCSPACES         TO CHANGE FIRST.                          
         MVC   IOKEY(L'ACTKEY),0(R2)                                            
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    VACC05                                                           
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         MVC   FVXTRA(L'ACTKUNT+L'ACTKLDG),1(R2)                                
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FVXTRA+L'ACTKUNT+L'ACTKLDG,3(R2)                              
         B     EXITL                                                            
*                                                                               
VACC05   CLI   CSACT,A#CPY         COPY?                                        
         BNE   VACC20                                                           
         OC    GSCPYKEY,GSCPYKEY   AND JUST FINISHED ENTERING COPY TO           
         BZ    VACC20              ACCOUNT?                                     
         TM    GSINDSL1,GSIRCOPY   AND REC TO BE COPIED IS DISPLAYED?           
         BZ    VACC20                                                           
T        USING ACTRECD,GSCPYKEY    ONLY ALLOW COPY TO SAME                      
         CLC   T.ACTKUNT(L'ACTKUNT+L'ACTKUNT),ACTKUNT    LEDGER                 
         BNE   VACCERR1                                                         
         BRAS  RE,VALCPYLN         MAKE SURE COPY TO AND COPY FROM              
         BNE   VACCERR2            ARE AT SAME LEVEL                            
*                                                                               
* SINCE ADD WORKS AS A MAINTAIN ACTION I NEED TO SEE IF THIS IS A BRAND         
* NEW RECORD                                                                    
VACC20   CLC   BCWORK(L'AC@ADD2),AC@ADD2     ADD?                               
         BNE   VACC30                                                           
         MVC   IOKEY,BCSPACES                                                   
         MVC   IOKEY(L'ACTKEY),0(R2)                                            
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                    DOES RECORD EXIST ALREADY?                
         BNE   VACC25                 NO                                        
         CLI   BCPFKEY,8              YES, BUT IF HIT PF8 IT'S OKAY             
         BNE   VACC22                 B/C ACTION WILL BE AUTO CHANGED           
         SR    R3,R3               AND USER HITS PF8 TO ADD PROFILES            
         ICM   R3,3,GSDSPACT       ON 2ND PAGE-ADDS REC & HITS PF8 &            
         A     R3,ATWA             CHANGES THE ACTION TO CHANGE ALL IN          
         USING FHD,R3              ONE KEYSTROKE                                
         MVC   FHDA(6),=CL6'CHANGE'                                             
         B     VACC30                                                           
VACC22   MVC   FVMSGNO,=AL2(AE$RECAE) YES-RECORD ALREADY EXISTS MSG             
         B     EXITL                                                            
VACC25   CLI   GSSMPAGE,1          NO-TRYING TO ADD FROM 2ND PAGE?              
         BNH   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$IACTN) YES-ERROR                                 
         B     EXITL                                                            
*                                                                               
VACC30   CLI   CSACT,A#ADD         FOR ACTION ADD/COPY                          
         BE    *+12                MAKE SURE HIGHER LEVEL EXISTS 1ST            
         CLI   CSACT,A#CPY                                                      
         BNE   VACC40                                                           
         MVC   BCHALF,ACTKUNT      TEMPORARY UNIT AND LEDGER                    
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,VALHIGH                                                       
         BE    *+14                ALREADY EXISTS                               
         MVC   FVMSGNO,=AL2(AE$HLACM)                                           
         B     EXITL                                                            
*                                                                               
VACC40   MVC   AACCFLD,FVADDR      SAVE A(ACCOUNT FIELD)                        
         LA    R4,SVCPYEL                                                       
*                                                                               
VACC50   MVC   BCBYTE1,FVILEN      INPUT LENGTH OF ACCOUNT                      
         BRAS  RE,SETLEN                                                        
*                                                                               
VACC60   CLI   ACTKACT,C' '        THE 1ST CHAR OF THE 1ST LVL SHOULD           
         BE    EXITNV              NOT BE A SPACE                               
         SR    R1,R1                                                            
         LA    RF,FVIFLD                                                        
         CLI   LEVELN,4            DID USER ENTER 4TH LEVEL ACCOUNT?            
         BNE   *+12                                                             
         IC    R1,LNLEV3           THEN BUMP TO 4TH LEVEL                       
         B     VACC70                                                           
         CLI   LEVELN,3            DID USER ENTER 3RD LEVEL ACCOUNT?            
         BNE   *+12                                                             
         IC    R1,LNLEV2           THEN BUMP TO 3RD LEVEL                       
         B     VACC70                                                           
         CLI   LEVELN,2            DID USER ENTER 2ND LEVEL ACCOUNT?            
         BNE   *+8                                                              
         IC    R1,LNLEV1           THEN BUMP TO 2ND LEVEL OR FOR 1ST            
VACC70   AR    RF,R1               LEVEL DON'T BUMP                             
         CLI   0(RF),C' '          1ST CHARACTER OF LEVEL CANNOT BE             
         BNE   VACC72              NO                                           
         CLI   CSACT,A#ADD         YES-SPACE NOT VALID IF ADDING A NEW          
         BE    EXITNV              ACCOUNT OR COPYING AN ACCOUNT                
         CLI   CSACT,A#CPY                                                      
         BE    EXITNV                                                           
         CLI   LEVELN,1            IS THIS THE 1ST LEVEL? YES NO SPACE          
         BE    EXITNV              IS VALID BUT FOR LOWER LVLS ALLOW            
*                                  USER TO MAINTAIN THE ACCOUNT.                
*                                                                               
VACC72   MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          CHECK ACCOUNT LENGTH                         
         BNE   VACCX               NOT LOW LEVEL-SO DONE                        
*                                  LOW LEVEL-SO MORE CHECKS                     
         CLI   CSACT,A#ADD                                                      
         BNE   VACC80                                                           
         CLC   =C'SP',ACTKUNT      ADDING AN SP OR SQ ACCOUNT?                  
         BE    *+14                                                             
         CLC   =C'SQ',ACTKUNT                                                   
         BNE   VACC80                                                           
         CLI   FVILEN,5            IF 5 OR LESS IT'S A REP-SO DON'T             
         BNH   VACC80              CALL PUBVAL.  IF 10 OR MORE IT'S A           
         CLI   FVILEN,9            PUB W/ A ZONE/EDITION SO DON'T CALL          
         BH    VACC80              PUBVAL B/C IT DOESN'T ACCEPT ACCTS           
         MVC   BCWORK,BCSPACES     > THAN 8 BYTES (NOT INCL MEDIA)              
         MVC   BCWORK(L'ACTKEY),ACTKEY                                          
         GOTO1 VPUBVAL,BODMCB,(FVXLEN,ACTKEY+4),(1,BCWORK+4)                    
         CLI   0(R1),X'FF'         TEST FOR ERROR                               
         BE    *+14                                                             
         CLC   ACTKEY(L'ACTKCULA),BCWORK ARE THE ACCTS THE SAME?                
         BE    VACC80                                                           
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         B     EXITL                                                            
*                                                                               
VACC80   CLC   =C'1R',ACTKUNT          FOR 1R ACCTS ONLY ALLOW CHANGES          
         BNE   VACCX                   TO LOWEST LEVEL                          
         CLI   CSACT,A#DIS                                                      
         BE    VACCX                                                            
         CLI   CSACT,A#LST                                                      
         BE    VACCX                                                            
         CLI   CSACT,A#CHA                                                      
         BE    VACCX                                                            
         MVC   FVMSGNO,=AL2(AE$RMICO)  MAINTAIN IN =COST                        
         B     EXITL                                                            
*                                                                               
VACCX    CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    EXITOK              THAN DON'T READ FOR IT YET                   
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    EXITOK                                                           
T        USING ACTRECD,RF                                                       
         LA    RF,IOKEY                                                         
         MVC   IOKEY(L'ACTKEY),0(R2)                                            
         DROP  T                                                                
         GOTO1 AGETACT,1           READ ACCT AND TEST SECURITY                  
         BNE   EXITL               AND READ FOR DELETES                         
         B     EXITOK                                                           
*                                                                               
VACCERR1 MVC   FVMSGNO,=AL2(AE$COPUL) COPY INVALID ACROSS LEDGERS               
         B     EXITL                                                            
VACCERR2 MVC   FVMSGNO,=AL2(AE$COPLV) COPY INVALID ACROSS LEVELS                
         B     EXITL                                                            
         SPACE 2                                                                
***********************************************************************         
* DISPLAY AN ACCOUNT FILTER FIELD                                     *         
***********************************************************************         
         SPACE 1                                                                
DFLTACC  MVC   FVIFLD(L'ACTKACT),FLTIFLD                                        
         MVC   ACTKACT,FLTIFLD   B/C OF BUG IN CONTROLLER WHEN CLEARING         
         OC    ACTKACT,BCSPACES  A KEY FILTER MUST FILL IN ACCT HERE.           
         MVC   AACCFLD,FVADDR                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE AN ACCOUNT FILTER FIELD                                    *         
***********************************************************************         
         SPACE 1                                                                
VFLTACC  DS    0H                                                               
         MVC   AACCFLD,FVADDR      SAVE A(ACCOUNT FIELD)                        
         ZIC   R1,FVILEN           INPUT LENGTH OF ACCT FILTER                  
         CLI   LNLEV1,L'ACTKACT    IS THERE ONLY ONE LEVEL?                     
         BE    VFACC10             YES THAN DON'T WORRY ABOUT IT                
         ZIC   RF,LNLEV1           LENGTH OF LEVEL 1                            
         CR    R1,RF               IF BELOW MINIMUM GIVE MESSAGE                
         BNL   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$WLACE)                                           
         B     EXITL                                                            
*                                                                               
VFACC10  MVC   FLTIFLD(L'ACTKACT),FVIFLD                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,ACTKACT,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCOUNT FIELD                                       *         
***********************************************************************         
         SPACE 1                                                                
DOFTACC  CLC   FLTIFLD(L'ACTKACT),BCSPACES  IS THERE AN ACCOUNT FILTER?         
         BE    FLTXE               NO - THAN ALWAYS ADD IT TO THE LIST          
*                                                                               
         LA    R1,12                                                            
         LA    RE,FLTIFLD+L'ACTKACT-1                                           
DOFTA10  CLI   0(RE),C' '                                                       
         BNE   DOFTA20                                                          
         BCTR  RE,0                                                             
         BCT   R1,DOFTA10                                                       
         B     FLTXX                                                            
*                                                                               
DOFTA20  BCTR  R1,0                                                             
         EXCLC R1,ACTKACT,FLTIFLD                                               
         BE    FLTXE                                                            
         BL    FLTXL                                                            
         BH    FLTXH                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FILTER 1                                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FLT1     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FLT1TBL                                                       
         B     ITER                                                             
*                                                                               
FLT1TBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISFLT1)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFLT1)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFLT1)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFLT1)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFLT1)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFLT1)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FILTER 1 VALUE                                              *         
* READ ALL LEVELS                                                     *         
* IF FILTER IS FOUND AT A HIGHER LEVEL DON'T DISPLAY IN THIS FIELD,   *         
* BUT INSTEAD SET IT UP TO DISPLAY HERE (IN SETLVL) AND DISPLAY IN    *         
* PROTECTED LEVEL FIELD (#509)                                        *         
* FOR THE LIST SCREEN DISPLAY ALL THE FILTERS SINCE THEY ARE ALL PART *         
* OF THE SAME FIELD.                                                  *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
DISFLT1  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         MVC   FVIFLD,BCSPACES                                                  
         NI    BYTE2,X'FF'-PROCFILT                                             
*                                                                               
         MVI   FILTIND,1           PROCESSING FILTER 1                          
         BRAS  RE,FINDPRF                                                       
*                                                                               
         CLI   CSACT,A#LST         FOR ACTION LIST-ALL THE FILTERS ARE          
         BE    DFLT05              GROUPED UNDER THE 1ST SO SHOW ALL            
         CLI   CSACT,A#REPT        GROUPED UNDER THE 1ST                        
         BE    DFLT05                                                           
         CLI   CSACT,A#DLOAD                                                    
         BNE   DFLT10                                                           
*                                                                               
DFLT05   MVC   FVIFLD(L'ACTKSAF1),FILTSV                                        
         MVI   FILTIND,2           PROCESSING FILTER 2                          
         BRAS  RE,FINDPRF                                                       
         MVC   FVIFLD+1(L'ACTKSAF1),FILTSV                                      
         MVI   FILTIND,3           PROCESSING FILTER 3                          
         BRAS  RE,FINDPRF                                                       
         MVC   FVIFLD+2(L'ACTKSAF1),FILTSV                                      
         MVI   FILTIND,4           PROCESSING FILTER 4                          
         BRAS  RE,FINDPRF                                                       
         MVC   FVIFLD+3(L'ACTKSAF1),FILTSV                                      
         MVI   FILTIND,5           PROCESSING FILTER 5                          
         BRAS  RE,FINDPRF                                                       
         MVC   FVIFLD+4(L'ACTKSAF1),FILTSV                                      
         B     DFLT1X                                                           
*                                                                               
DFLT10   OI    BYTE2,PROCFILT      SET LEVEL FIELD                              
         BRAS  RE,SETLEV           SET LEVEL FIELD                              
         NI    BYTE2,X'FF'-PROCFILT                                             
         BRAS  RE,DISSET           SET LEVEL FIELD                              
DFLT1X   B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 1 VALUE                                         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
VALFLT1  NI    FILTBIT,X'FF'-FLT1CHA                                            
         CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    VFLT105             THAN DON'T CHECK IF SETTING HAS CHA          
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    VFLT105                                                          
         BRAS  RE,VALSET           SET LEVEL FIELD                              
         BE    EXITOK                            NO CHANGE                      
*                                                                               
VFLT105  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   VFLT110             FOR 1C CHECK IF ADDING A FILTER OR           
         CLC   RSTFILT1,FVIFLD     CHANGING A FILTER                            
         BE    VFLT110                                                          
         OI    FILTBIT,FLT1CHA                                                  
*                                                                               
VFLT110  MVC   RSTFILT1,FVIFLD     MOVE INTO 30 ELEM                            
         MVC   T.ACTKSAF1,FVIFLD   AND DIRECTORY STATUS TOO                     
         BRAS  RE,DISSET           SET LEVEL FIELD                              
         B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* DISPLAY THE FILTER 1 FILTER                                                   
***********************************************************************         
         SPACE 1                                                                
DFFLT1   MVC   FVIFLD(L'ACTKSAF1),FLTIFLD                                       
         MVC   AFLT1FLD,FVADDR                                                  
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 1 FILTER                                                  
***********************************************************************         
         SPACE 1                                                                
VFFLT1   BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         MVC   FLTIFLD(L'ACTKSAF1),FVIFLD                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR THE FILTER 1 FILTER (!)  READ HIGHER LEVELS                  
***********************************************************************         
         SPACE 1                                                                
DOFLT1   DS    0H                                                               
         BRASL RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FILTER 2                                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FLT2     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FLT2TBL                                                       
         B     ITER                                                             
*                                                                               
FLT2TBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISFLT2)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFLT2)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFLT2)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFLT2)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFLT2)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFLT2)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FILTER 2 VALUE                                              *         
* THIS IS JUST FOR THE DISPLAY SCREEN-FOR THE LIST SCREEN THIS IS     *         
* TAKEN CARE OF IN THE DISFLT1 ROUTINE BECAUSE OF THE WAY THAT THE    *         
* DDICT WAS DEFINED IN THE FILTER 1 FIELD RECORD IN CON/NFILE         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
DISFLT2  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    BYTE2,X'FF'-PROCFILT                                             
*                                                                               
         MVI   FILTIND,2           PROCESSING FILTER 2                          
         BRAS  RE,FINDPRF                                                       
*                                                                               
         OI    BYTE2,PROCFILT                                                   
         BRAS  RE,SETLEV           SET LEVEL FIELD                              
         NI    BYTE2,X'FF'-PROCFILT                                             
         BRAS  RE,DISSET           SET LEVEL FIELD                              
DFLT2X   B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 2 VALUE                                         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
VALFLT2  NI    FILTBIT,X'FF'-FLT2CHA                                            
         CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    VFLT205             THAN DON'T CHECK IF SETTING HAS CHA          
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    VFLT205                                                          
         BRAS  RE,VALSET           SET LEVEL FIELD                              
         BE    EXITOK                            NO CHANGE                      
*                                                                               
VFLT205  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   VFLT210             FOR 1C CHECK IF ADDING A FILTER OR           
         CLC   RSTFILT2,FVIFLD     CHANGING A FILTER                            
         BE    VFLT210                                                          
         OI    FILTBIT,FLT2CHA                                                  
*                                                                               
VFLT210  MVC   RSTFILT2,FVIFLD     MOVE INTO 30 ELEM                            
         MVC   T.ACTKSAF2,FVIFLD   AND DIRECTORY STATUS TOO                     
         BRAS  RE,DISSET           SET LEVEL FIELD                              
         B     EXITOK                                                           
         DROP  T,RF                                                             
         SPACE 2                                                                
***********************************************************************         
* DISPLAY THE FILTER 2 FILTER                                                   
***********************************************************************         
         SPACE 1                                                                
DFFLT2   MVC   FVIFLD(L'ACTKSAF2),FLTIFLD                                       
         MVC   AFLT2FLD,FVADDR                                                  
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 2 FILTER                                                  
***********************************************************************         
         SPACE 1                                                                
VFFLT2   BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         MVC   FLTIFLD(L'ACTKSAF2),FVIFLD                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR THE FILTER 2 FILTER (!)  READ HIGHER LEVELS                  
***********************************************************************         
         SPACE 1                                                                
DOFLT2   BRASL RE,FILTPRF                                                       
*                                                                               
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FILTER 3                                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FLT3     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FLT3TBL                                                       
         B     ITER                                                             
*                                                                               
FLT3TBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISFLT3)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFLT3)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFLT3)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFLT3)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFLT3)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFLT3)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FILTER 3 VALUE                                              *         
* THIS IS JUST FOR THE DISPLAY SCREEN-FOR THE LIST SCREEN THIS IS     *         
* TAKEN CARE OF IN THE DISFLT1 ROUTINE BECAUSE OF THE WAY THAT THE    *         
* DDICT WAS DEFINED IN THE FILTER 1 FIELD RECORD IN CON/NFILE         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
DISFLT3  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    BYTE2,X'FF'-PROCFILT                                             
*                                                                               
         MVI   FILTIND,3           PROCESSING FILTER 3                          
         BRAS  RE,FINDPRF                                                       
*                                                                               
         OI    BYTE2,PROCFILT                                                   
         BRAS  RE,SETLEV           SET LEVEL FIELD                              
         NI    BYTE2,X'FF'-PROCFILT                                             
         BRAS  RE,DISSET           UPDATE TABLE SETTINGS                        
DFLT3X   B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 3 VALUE                                         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
VALFLT3  NI    FILTBIT,X'FF'-FLT3CHA                                            
         CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    VFLT305             THAN DON'T CHECK IF SETTING HAS CHA          
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    VFLT305                                                          
         BRAS  RE,VALSET           UPDATE TABLE SETTINGS                        
         BE    EXITOK                            NO CHANGE                      
*                                                                               
VFLT305  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   VFLT310             FOR 1C CHECK IF ADDING A FILTER OR           
         CLC   RSTFILT3,FVIFLD     CHANGING A FILTER                            
         BE    VFLT310                                                          
         OI    FILTBIT,FLT3CHA                                                  
*                                                                               
VFLT310  MVC   RSTFILT3,FVIFLD     MOVE INTO 30 ELEM                            
         MVC   T.ACTKSAF3,FVIFLD   AND DIRECTORY STATUS TOO                     
         BRAS  RE,DISSET           UPDATE TABLE SETTINGS                        
         B     EXITOK                                                           
         DROP  T,RF                                                             
         SPACE 2                                                                
***********************************************************************         
* DISPLAY THE FILTER 3 FILTER                                                   
***********************************************************************         
         SPACE 1                                                                
DFFLT3   MVC   FVIFLD(L'ACTKSAF3),FLTIFLD                                       
         MVC   AFLT3FLD,FVADDR                                                  
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 3 FILTER                                                  
***********************************************************************         
         SPACE 1                                                                
VFFLT3   BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         MVC   FLTIFLD(L'ACTKSAF3),FVIFLD                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR THE FILTER 3 FILTER (!)  READ HIGHER LEVELS                  
***********************************************************************         
         SPACE 1                                                                
DOFLT3   BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FILTER 4                                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FLT4     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FLT4TBL                                                       
         B     ITER                                                             
*                                                                               
FLT4TBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISFLT4)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFLT4)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFLT4)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFLT4)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFLT4)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFLT4)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FILTER 4 VALUE                                              *         
* THIS IS JUST FOR THE DISPLAY SCREEN-FOR THE LIST SCREEN THIS IS     *         
* TAKEN CARE OF IN THE DISFLT1 ROUTINE BECAUSE OF THE WAY THAT THE    *         
* DDICT WAS DEFINED IN THE FILTER 1 FIELD RECORD IN CON/NFILE         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
DISFLT4  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    BYTE2,X'FF'-PROCFILT                                             
*                                                                               
         MVI   FILTIND,4           PROCESSING FILTER 4                          
         BRAS  RE,FINDPRF                                                       
*                                                                               
         OI    BYTE2,PROCFILT                                                   
         BRAS  RE,SETLEV           UPDATE TABLE SETTINGS                        
         NI    BYTE2,X'FF'-PROCFILT                                             
         BRAS  RE,DISSET                                                        
DFLT4X   B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 4 VALUE                                         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
VALFLT4  NI    FILTBIT,X'FF'-FLT4CHA                                            
         CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    VFLT405             THAN DON'T CHECK IF SETTING HAS CHA          
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    VFLT405                                                          
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
VFLT405  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   VFLT410             FOR 1C CHECK IF ADDING A FILTER OR           
         CLC   RSTFILT4,FVIFLD     CHANGING A FILTER                            
         BE    VFLT410                                                          
         OI    FILTBIT,FLT4CHA                                                  
*                                                                               
VFLT410  MVC   RSTFILT4,FVIFLD     MOVE INTO 30 ELEM                            
         MVC   T.ACTKSAF4,FVIFLD   AND DIRECTORY STATUS TOO                     
         BRAS  RE,DISSET           UPDATE TABLE SETTINGS                        
         B     EXITOK                                                           
         DROP  T,RF                                                             
         SPACE 2                                                                
***********************************************************************         
* DISPLAY THE FILTER 4 FILTER                                                   
***********************************************************************         
         SPACE 1                                                                
DFFLT4   MVC   FVIFLD(L'ACTKSAF4),FLTIFLD                                       
         MVC   AFLT4FLD,FVADDR     ON THE FILTER LIST SCR THE ADDRESS           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 4 FILTER                                                  
***********************************************************************         
         SPACE 1                                                                
VFFLT4   BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         MVC   FLTIFLD(L'ACTKSAF4),FVIFLD                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR THE FILTER 4 FILTER (!)  READ HIGHER LEVELS                  
***********************************************************************         
         SPACE 1                                                                
DOFLT4   BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FILTER 5                                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FLT5     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FLT5TBL                                                       
         B     ITER                                                             
*                                                                               
FLT5TBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISFLT5)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFLT5)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFLT5)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFLT5)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFLT5)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFLT5)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FILTER 5 VALUE                                              *         
* THIS IS JUST FOR THE DISPLAY SCREEN-FOR THE LIST SCREEN THIS IS     *         
* TAKEN CARE OF IN THE DISFLT1 ROUTINE BECAUSE OF THE WAY THAT THE    *         
* DDICT WAS DEFINED IN THE FILTER 1 FIELD RECORD IN CON/NFILE         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
DISFLT5  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    BYTE2,X'FF'-PROCFILT                                             
*                                                                               
         MVI   FILTIND,5           PROCESSING FILTER 5                          
         BRAS  RE,FINDPRF                                                       
*                                                                               
         OI    BYTE2,PROCFILT                                                   
         BRAS  RE,SETLEV                                                        
         NI    BYTE2,X'FF'-PROCFILT                                             
         BRAS  RE,DISSET           UPDATE TABLE SETTINGS                        
DFLT5X   B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 5 VALUE                                         *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTKSTA,GSRECSTA                                                 
VALFLT5  NI    FILTBIT,X'FF'-FLT5CHA                                            
         CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    VFLT505             THAN DON'T CHECK IF SETTING HAS CHA          
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    VFLT505                                                          
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
VFLT505  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                              
         BNE   VFLT510             FOR 1C CHECK IF ADDING A FILTER OR           
         CLC   RSTFILT5,FVIFLD     CHANGING A FILTER                            
         BE    VFLT510                                                          
         OI    FILTBIT,FLT5CHA                                                  
*                                                                               
VFLT510  MVC   RSTFILT5,FVIFLD     MOVE INTO 30 ELEM                            
         MVC   T.ACTKSAF5,FVIFLD   AND DIRECTORY STATUS TOO                     
         B     EXITOK                                                           
         DROP  T,RF                                                             
         SPACE 2                                                                
***********************************************************************         
* DISPLAY THE FILTER 5 FILTER                                                   
***********************************************************************         
         SPACE 1                                                                
DFFLT5   MVC   FVIFLD(L'ACTKSAF5),FLTIFLD                                       
         MVC   AFLT5FLD,FVADDR                                                  
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE FILTER 5 FILTER                                                  
***********************************************************************         
         SPACE 1                                                                
VFFLT5   BRAS  RE,CHKFLTVL         CHECK FOR SPECIAL CHARACTERS WHICH           
         BNE   EXITNV              ARE NOT ALLOWED                              
*                                                                               
         MVC   FLTIFLD(L'ACTKSAF5),FVIFLD                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR THE FILTER 5 FILTER (!) READ HIGHER LEVELS                   
***********************************************************************         
         SPACE 1                                                                
DOFLT5   BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR STAFF= PROFILE                                      *         
* STAFF= - PERSON ANALYSIS                                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
STAFF    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,STAFTABL                                                      
         B     ITER                                                             
*                                                                               
STAFTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISSTF)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISSTF)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALSTF)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFSTF)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFSTF)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFSTF)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY STAFF= PROFILE                                              *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISSTF   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISSTF10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISSTFX                                                          
*                                                                               
DISSTF10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISSTFX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT,RSTSGPEI                                                 
         BZ    DISSTFX                                                          
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DISSTFX  MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE STAFF= PROFILE                                             *         
***********************************************************************         
         SPACE 1                                                                
VALSTF   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALSTFX                       THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VSTAF02                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALSTFX                                                          
*                                                                               
VSTAF02  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT,X'FF'-(RSTSGPEI)                                         
         CLI   FVILEN,0                                                         
         BE    VALSTFX                                                          
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VALSTFX             NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VSTAF04             YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VSTAF04  OI    RSTSTAT,RSTSGPEI    STAFF FLAG ON                                
VALSTFX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY STAFF= FILTER                                               *         
***********************************************************************         
         SPACE 1                                                                
DFSTF    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE STAFF= FILTER                                              *         
***********************************************************************         
         SPACE 1                                                                
VFSTF    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SE',ACTKUNT      FILTER ONLY VALID FOR SE                     
         BNE   ERRFILT                                                          
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NO                                                  
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@YES                                                 
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON STAFF= PROFILE                                      *         
***********************************************************************         
         SPACE 1                                                                
DOFSTF   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   FLTIFLD,C'N'        WANT ALL NON-STAFF                           
         BNE   DOSTAF02                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT IT'S ALWAYS               
         BNE   FLTXE               'NO' SO DEFINITELY SHOW IT                   
         TM    RSTSTAT,RSTSGPEI                                                 
         BO    FLTXL               IT IS STAFF - NOT WANTED                     
         B     FLTXE                                                            
*                                                                               
DOSTAF02 CLI   FLTIFLD,C'Y'        WANT ALL STAFF                               
         BNE   FLTXL                                                            
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT CAN'T BE SET              
         BNE   FLTXL               TO 'YES' SO DEFINITELY DON'T SHOW IT         
         TM    RSTSTAT,RSTSGPEI                                                 
         BZ    FLTXL               IT ISN`T STAFF - NOT WANTED                  
         B     FLTXE                                                            
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSACIL BIT IN RSTEL                               *         
* 'PREVENT POSTINGS'                                                            
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
LOCKED   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,LOCTBL                                                        
         B     ITER                                                             
*                                                                               
LOCTBL   DC    AL1(DDIS),AL1(0,0,0),AL4(DISLOC)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISLOC)       *FOR REPORT              
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALLOC)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFLOC)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFLOC)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFLOC)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSACIL BIT IN RSTEL                                       *         
***********************************************************************         
         SPACE 1                                                                
DISLOC   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISLOC10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISLOCX                                                          
*                                                                               
DISLOC10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISLOCX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT,RSTSACIL                                                 
         BZ    DISLOCX                                                          
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
*                                                                               
DISLOCX  MVI   SBYTE,LOCSEC        MOVE IN SEC NUMBER                           
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
         BRAS  RE,CHKSEC                                                        
         BL    *+8                                                              
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE RSTSACIL BIT IN RSTEL                                      *         
***********************************************************************         
         SPACE 1                                                                
VALLOC   NI    FVATRB,X'FF'-FVAPROT                                             
         CLI   CSACT,A#ADD         ADDING THIS ACCOUNT?                         
         BE    VLOC01              THAN DON'T CHECK IF SETTING HAS CHA          
         CLI   CSACT,A#CPY         OR IS THIS A COPY ACTION?                    
         BE    VLOC01                                                           
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
VLOC01   DS    0H                                                               
         MVI   SBYTE,LOCSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VDEPTX                        THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VLOC02                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VLOCX                                                            
*                                                                               
VLOC02   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R3,12(R1)                                                        
         USING RSTELD,R3                                                        
         NI    RSTSTAT,X'FF'-(RSTSACIL)                                         
         NI    GSRECSTA+(ACTKSTAT-ACTKSTA),X'FF'-(ACTSLOCK)                     
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    VLOCX                                                            
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VLOCX               NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VLOC05              YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VLOC05   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ASTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VLOC10              NO ASTEL                                     
*                                                                               
         USING ASTELD,RF                                                        
         L     RF,12(R1)                                                        
         OC    ASTDRAFT,ASTDRAFT   ANY DRAFT ITEMS ON ACCOUNT?                  
         BZ    VLOC10              NO                                           
         MVC   FVMSGNO,=AL2(AE$DRFL)  GIVE ERROR MESSAGE                        
         B     EXITL                                                            
VLOC10   OI    RSTSTAT,RSTSACIL    LOCKED FLAG ON                               
         OI    GSRECSTA+(ACTKSTAT-ACTKSTA),ACTSLOCK  SET IN DIR TOO             
VLOCX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3,RF                                                            
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT IS LOCKED FILTER                                    *         
***********************************************************************         
         SPACE 1                                                                
DFLOC    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCOUNT IS LOCKED FILTER                                   *         
***********************************************************************         
         SPACE 1                                                                
VFLOC    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VFLOCK02            NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
         B     VFLOCK04                                                         
*                                                                               
VFLOCK02 MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
*                                                                               
VFLOCK04 EX    RE,*+8                                                           
         BE    VFLOCK06            YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VFLOCK06 MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
*                                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCOUNT IS LOCKED STATUS                            *         
***********************************************************************         
         SPACE 1                                                                
DOFLOC   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   FLTIFLD,C'N'        WANT ALL NON-LOCKED                          
         BNE   DOLOCK02                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT IT'S ALWAYS               
         BNE   FLTXE               'NO' SO DEFINITELY SHOW IT                   
         TM    RSTSTAT,RSTSACIL                                                 
         BO    FLTXL               IT IS LOCKED - NOT WANTED                    
         B     FLTXE                                                            
*                                                                               
DOLOCK02 CLI   FLTIFLD,C'Y'        WANT ALL LOCKED                              
         BNE   FLTXL                                                            
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT IT CAN'T BE SET           
         BNE   FLTXL               TO 'YES' SO DEFINITELY DON'T SHOW IT         
         TM    RSTSTAT,RSTSACIL                                                 
         BZ    FLTXL               IT ISN`T LOCKED - NOT WANTED                 
         B     FLTXE                                                            
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR DEPT= PROFILE (SE ONLY)                             *         
* DEPT= - DEPT ANALYSIS                                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
DEPART   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,DEPTTABL                                                      
         B     ITER                                                             
*                                                                               
DEPTTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISDEP)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISDEP)       *FOR REPORT              
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALDEP)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFDEP)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFDEP)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFDEP)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY DEPT= PROFILE                                               *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
DISDEP   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISDEP10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISDEPX                                                          
*                                                                               
DISDEP10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISDEPX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT,RSTSEADD                                                 
         BZ    DISDEPX                                                          
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
*                                                                               
DISDEPX  MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE DEPT= PROFILE                                              *         
***********************************************************************         
         SPACE 1                                                                
VALDEP   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VDEPTX                        THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VDEPT02                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VDEPTX                                                           
*                                                                               
VDEPT02  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT,X'FF'-(RSTSEADD)                                         
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    VDEPTX                                                           
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VDEPTX              NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VDEPT04             YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VDEPT04  OI    RSTSTAT,RSTSEADD    DEPARTMENT FLAG ON                           
VDEPTX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY DEPT= FILTER                                                *         
***********************************************************************         
         SPACE 1                                                                
DFDEP    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE DEPT= FILTER                                               *         
***********************************************************************         
         SPACE 1                                                                
VFDEP    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SE',ACTKUNT      FILTER ONLY VALID FOR SE                     
         BNE   ERRFILT                                                          
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VFDEPT02            NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
         B     VFDEPT04                                                         
*                                                                               
VFDEPT02 MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
*                                                                               
VFDEPT04 EX    RE,*+8                                                           
         BE    VFDEPT06            YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VFDEPT06 MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
*                                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON DEPT= PROFILE                                       *         
***********************************************************************         
         SPACE 1                                                                
DOFDEP   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   FLTIFLD,C'N'        WANT ALL NON-DEPT                            
         BNE   DODEPT02                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT IT'S ALWAYS               
         BNE   FLTXE               'NO' SO DEFINITELY SHOW IT                   
         TM    RSTSTAT,RSTSEADD                                                 
         BO    FLTXL               IT IS DEPT - NOT WANTED                      
         B     FLTXE                                                            
*                                                                               
DODEPT02 CLI   FLTIFLD,C'Y'        WANT ALL DEPT                                
         BNE   FLTXL                                                            
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT CAN'T BE SET              
         BNE   FLTXL               TO 'YES' SO DEFINITELY DON'T SHOW IT         
         TM    RSTSTAT,RSTSEADD                                                 
         BZ    FLTXL               IT ISN`T DEPT - NOT WANTED                   
         B     FLTXE                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSYCST/RSTSNCST BIT IN RSTEL (SE ONLY)            *         
* COST= - CLIENT ANALYSIS                                             *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
COSTING  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,COSTTABL                                                      
         B     ITER                                                             
*                                                                               
COSTTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISCOS)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCOS)    *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCOS)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCOS)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCOS)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCOS)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSYCST/RSTSNCST BIT IN RSTEL                                        
* 1) LOOK IN ACCT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT             
* RECORDS.  3) LOOK IN LEDGER RECORD                                            
***********************************************************************         
         SPACE 1                                                                
DISCOS   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          HAS THE PROFILE BEEN FOUND ON                
         BNE   DISCOSX             ANY LEVEL?                                   
*                                                                               
         USING LDGELD,RF                                                        
         LA    RF,SVLDGEL          RF POINTS TO SAVED LDG STATUS ELEM           
         TM    LDGSTAT,LDGSCOST               MAKE COST POSTINGS?               
         BZ    DISCOS20                       NO SO USE DEFAULT                 
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,LEDGLV     TURN ON BIT FOR LEDGER LVL                   
         B     DISCOSX                                                          
*                                                                               
DISCOS20 DS    0H                                                               
         MVC   FVIFLD(L'AC@NO),AC@NO SET DEFAULT IN SETTING FLD                 
         OI    LEVELBIT,LDGLVDEF   NOT ON=DEFAULT                               
*                                                                               
DISCOSX  DS    0H                                                               
         MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE RSTSYCST/RSTSNCST BIT IN RSTEL                                       
***********************************************************************         
         SPACE 1                                                                
VALCOS   NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   ACOSTPR,FVADDR      SAVE A(CLIENT ANALYSIS PROFILE FLD)          
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VCOSX                         THIS PROFILE                       
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT2,X'FF'-(RSTSYCST+RSTSNCST)                               
         CLI   FVILEN,0            NO INPUT - DEFAULT IS BLANK                  
         BE    VCOSX                                                            
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VCOS06              NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VCOS04              YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VCOS04   OI    RSTSTAT2,RSTSYCST    COST=Y FLAG ON                              
         B     VCOSX                                                            
VCOS06   OI    RSTSTAT2,RSTSNCST    COST=N FLAG ON                              
VCOSX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSYCST/RSTSNCST FILTER                                              
***********************************************************************         
         SPACE 1                                                                
DFCOS    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE RSTSYCST/RSTSNCST FILTER                                             
***********************************************************************         
         SPACE 1                                                                
VFCOS    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SE',ACTKUNT      FILTER IS ONLY FOR SE                        
         BNE   ERRFILT                                                          
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VFCOST02            NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
         B     VFCOST04                                                         
*                                                                               
VFCOST02 MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
*                                                                               
VFCOST04 EX    RE,*+8                                                           
         BE    VFCOST06            YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VFCOST06 MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
*                                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON RSTSYCST/RSTSNCST                                   *         
***********************************************************************         
         SPACE 1                                                                
DOFCOS   CLC   =C'SE',ACTKUNT      FOR SE ONLY                                  
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'Y'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'N'                                                      
         BE    FLTXL                                                            
*                                                                               
         USING LDGELD,RF                                                        
         LA    RF,SVLDGEL          NOW CHECK LEDGER                             
         CLI   FLTIFLD,C'N'        WANT ALL ACCTS NOT MAKING                    
         BNE   DOFCOS10            COST POSTINGS?                               
         TM    LDGSTAT,LDGSCOST                                                 
         BZ    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFCOS10 TM    LDGSTAT,LDGSCOST                                                 
         BO    FLTXE                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FAX NUMBER                                          *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                     *         
* FAX= - FAX NUMBER                                                   *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FAXNO    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FAXNTABL                                                      
         B     ITER                                                             
*                                                                               
FAXNTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISFAXN)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFAXN)    *FOR REPORT                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFAXN)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFAXF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFAXF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFFAXF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FAX NUMBER                                                  *         
***********************************************************************         
         SPACE 1                                                                
DISFAXN  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISFAX10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT                                                   
         B     DISFAXX                                                          
*                                                                               
DISFAX10 GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTPFAX                                  
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
DISFAXX  B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE FAX NUMBER                                                 *         
***********************************************************************         
         SPACE 1                                                                
VALFAXN  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALFAX5                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALFAXX                                                          
*                                                                               
VALFAX5  CLI   FVILEN,0                                                         
         BE    VALFAX30                                                         
         CLI   FVILEN,11           MAX 11 CHARS                                 
         BH    EXITNV                                                           
         CLI   FVILEN,10           MIN 10 CHARS                                 
         BL    EXITNV                                                           
         ZIC   RF,FVXLEN                                                        
         EX    RF,VALFAX10                                                      
         EX    RF,VALFAX15                                                      
         EX    RF,VALFAX20                                                      
         B     VALFAX25                                                         
*                                                                               
VALFAX10 MVC   BCWORK(0),=15X'F0'                                               
VALFAX15 MVZ   BCWORK(0),FVIFLD                                                 
VALFAX20 CLC   BCWORK(0),=15X'F0'                                               
*                                                                               
VALFAX25 BNE   EXITNV                                                           
VALFAX30 GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTPFAX                                  
VALFAXX  B     EXITOK                                                           
*                                                                               
         LTORG                                                                  
***********************************************************************         
* DISPLAY FAX FILTER                                                            
***********************************************************************         
         SPACE 1                                                                
DFFAXF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE FAX FILTER                                                           
***********************************************************************         
         SPACE 1                                                                
VFFAXF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON FAX NUMBER                                          *         
***********************************************************************         
         SPACE 1                                                                
DOFFAXF  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R2)),          +        
               (L'FFTTYPE,=AL1(FFTTPFAX))                                       
         CLI   12(R1),0                                                         
         BNE   FLTXL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
         LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
DOFAX10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BH    DOFAX20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOFAX10                                                       
*                                                                               
DOFAX20  LTR   R1,R1                                                            
         BZ    FLTXX                                                            
         BCTR  R1,0                                                             
         EXCLC R1,FFTDATA,FLTIFLD                                               
         BL    FLTXL                                                            
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         DROP  RF                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR PAY= PROFILE.                                       *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                     *         
* PAY= - PAYMENT INSTRUCTIONS                                         *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PAYEXCL  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PAYEXCLT                                                      
         B     ITER                                                             
*                                                                               
PAYEXCLT DC    AL1(DDIS),AL1(0,0,0),AL4(DISPAYX)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISPAYX)   *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALPAYX)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFPAYX)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFPAYX)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFPAYX)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PAY= PROFILE (PAY IN GENERAL CHECK RUN PROFILE)             *         
***********************************************************************         
         SPACE 1                                                                
DISPAYX  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         MVC   FVIFLD,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DSPAYX10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@INCL),AC@INCL      DEFAULT IS 'INCLUDE'              
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DSPAYXX                                                          
*                                                                               
DSPAYX10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DSPAYXX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         TM    RSTSTAT2,RSTSPLOK                                                
         BZ    DSPAYX15                                                         
         MVC   FVIFLD(L'AC@EXCL),AC@EXCL    EXCLUDE                             
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
         B     DSPAYXX                                                          
DSPAYX15 MVC   FVIFLD(L'AC@INCL),AC@INCL   DEFAULT IS 'INCLUDE'                 
*                                                                               
DSPAYXX  MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PAY= PROFILE (EXCLUDE PAY IN GENERAL CHECK RUN PROFILE)    *         
***********************************************************************         
         SPACE 1                                                                
VALPAYX  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                                                        
         BNE   VLPAYXX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VLPAYX10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VLPAYXX                                                          
*                                                                               
VLPAYX10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT2,X'FF'-(RSTSPLOK)                                        
         CLI   FVILEN,0            NO INPUT - DEFAULT IS YES                    
         BE    VLPAYXX                                                          
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VLPAY15             EXCLUDE                                      
         CLC   FVIFLD(0),AC@EXCL                                                
*                                                                               
         EX    RE,*+8                                                           
         BE    VLPAYXX             INCLUDE                                      
         CLC   FVIFLD(0),AC@INCL                                                
         B     EXITNV                                                           
*                                                                               
VLPAY15  OI    RSTSTAT2,RSTSPLOK   EXCLUDE VENDOR FROM CHECK RUN                
VLPAYXX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PAYMENT INSTRUCTIONS FILTER                                 *         
***********************************************************************         
         SPACE 1                                                                
DFPAYX   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PAYMENT INSTRUCTIONS FILTER                                *         
***********************************************************************         
         SPACE 1                                                                
VFPAYX   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SP',ACTKUNT      PAYABLES LEDGER SP,SQ,SS,ST,SU               
         BE    VFPAY10             GET SCREEN CODE A                            
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFPAY10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
VFPAY10  ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@EXCL   EXCLUDE                                      
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@EXCL),AC@EXCL                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@INCL   INCLUDE                                      
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@INCL),AC@INCL                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON PAYMENT INSTRUCTIONS PROFILE                        *         
***********************************************************************         
         SPACE 1                                                                
DOFPAYX  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLC   FLTIFLD(L'AC@EXCL),AC@EXCL   FILTER ON EXCLUDE?                  
         BNE   DFPAYX10                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'EXCLUDE' SO DON'T SHOW IN LIST              
         TM    RSTSTAT2,RSTSPLOK   THAN BIT MUST BE ON                          
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DFPAYX10 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-IT'S ALWAYS               
         BNE   FLTXE               'INCLUDE' SO SHOW IN LIST                    
         TM    RSTSTAT2,RSTSPLOK   MUST BE FILTER ON INCLUDE                    
         BZ    FLTXE               BIT MUST BE OFF                              
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR 1099= PROFILE                                       *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                     *         
* 1099= - PRINTING OPTIONS (RENAMED TO 'COMPENSATION TYPE')           *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
DO1099   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,DO1099TB                                                      
         B     ITER                                                             
*                                                                               
DO1099TB DC    AL1(DDIS),AL1(0,0,0),AL4(DIS1099)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DIS1099)   *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VAL1099)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DF1099)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VF1099)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOF1099)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY 1099= PROFILE                                               *         
***********************************************************************         
         SPACE 1                                                                
DIS1099  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DS109910                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DS1099X                                                          
*                                                                               
DS109910 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DS1099X                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                IF NOT THE LONGEST ELEM             
         BL    DS109940                     SHOW THE DEFAULT                    
         TM    RSTX1099,RSTXRENT                                                
         BZ    DS109915                                                         
         MVC   FVIFLD(L'AC@RENT),AC@RENT    RENT                                
         B     DS109930                                                         
*                                                                               
DS109915 TM    RSTX1099,RSTXROYL                                                
         BZ    DS109920                                                         
         MVC   FVIFLD(L'AC@ROYTY),AC@ROYTY  ROYALTIES                           
         B     DS109930                                                         
*                                                                               
DS109920 TM    RSTX1099,RSTXPRIZ                                                
         BZ    DS109925                                                         
         MVC   FVIFLD(L'AC@PRIZE),AC@PRIZE  PRIZES                              
         B     DS109930                                                         
*                                                                               
DS109925 TM    RSTX1099,RSTXMEDC                                                
         BZ    DS109940                                                         
         MVC   FVIFLD(L'AC@MEDCL),AC@MEDCL  MEDICAL                             
*                                                                               
DS109930 OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
         B     DS1099X                                                          
*                                                                               
DS109940 MVC   FVIFLD(L'AC@NEXPC),AC@NEXPC   NONEMPLOYEE IS DEFAULT             
*                                                                               
DS1099X  MVI   SBYTE,V1099         MOVE IN 1099 VENDOR PROF SEC #               
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE 1099= PROFILE                                              *         
***********************************************************************         
         SPACE 1                                                                
VAL1099  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,V1099         MOVE IN 1099 VENFOR PROF SEC #               
         BRAS  RE,CHKSEC                                                        
         BNE   VL1099X                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VL109910                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VL1099X                                                          
*                                                                               
VL109910 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTX1099,FF-(RSTXRENT+RSTXPRIZ+RSTXMEDC+RSTXROYL)                
         CLI   FVILEN,0            NO INPUT - DONE                              
         BE    VL1099X                                                          
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@ROY    ROYALTIES                                    
         BNE   *+12                                                             
         OI    RSTX1099,RSTXROYL                                                
         B     VL1099X                                                          
*                                                                               
         EXCLC RE,FVIFLD,AC@MEDC   MEDICAL                                      
         BNE   *+12                                                             
         OI    RSTX1099,RSTXMEDC                                                
         B     VL1099X                                                          
*                                                                               
         EXCLC RE,FVIFLD,AC@PRZ    PRZ                                          
         BE    VL109920                                                         
         EXCLC RE,FVIFLD,AC@PRIZE  PRIZES                                       
         BNE   *+12                                                             
VL109920 OI    RSTX1099,RSTXPRIZ                                                
         B     VL1099X                                                          
*                                                                               
         EXCLC RE,FVIFLD,AC@RNT    RNT                                          
         BE    VL109930                                                         
         EXCLC RE,FVIFLD,AC@RENT   RENT                                         
         BNE   EXITNV                                                           
VL109930 OI    RSTX1099,RSTXRENT                                                
*                                                                               
VL1099X  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY COMPENSATION TYPE (1099=) FILTER                            *         
***********************************************************************         
         SPACE 1                                                                
DF1099   MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE COMPENSATION TYPE (1099=) FILTER                           *         
***********************************************************************         
         SPACE 1                                                                
VF1099   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'2C',ACTKUNT      FILTER VALID FOR 2C ONLY                     
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NEXPC      NONEMPLOYEE                              
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NEMP),AC@NEMP                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@ROYTY      ROYALTY                                  
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@ROY),AC@ROY                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@PRIZE      PRIZE                                    
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@PRIZ2),AC@PRIZ2                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@MEDCL      MEDICAL                                  
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@MEDC),AC@MEDC                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@RENT       RENT                                     
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@RENT),AC@RENT                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON COMPENSATION TYPE (1099=) PROFILE                   *         
* N/A AT HIGHER LEVELS SO ALWAYS SKIP THOSE ACCOUNTS                  *         
***********************************************************************         
         SPACE 1                                                                
DOF1099  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCOUNT SKIP IT B/C            
         BNE   FLTXL               THIS PROFILE IS N/A AT HIGHER LEVELS         
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                   IF NOT THE LONGEST ELEM          
         BNL   DF109910                        LENGTH                           
         CLC   FLTIFLD(L'AC@NEMP),AC@NEMP      ONLY THE DEFAULT FILTER          
         BE    FLTXE                           CAN BE EQUAL                     
         B     FLTXL                                                            
*                                                                               
DF109910 CLC   FLTIFLD(L'AC@NEMP),AC@NEMP      NONEMP                           
         BNE   DF109920                                                         
         CLI   RSTX1099,0                                                       
         BE    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DF109920 CLC   FLTIFLD(L'AC@ROY),AC@ROY        ROY                              
         BNE   DF109930                                                         
         TM    RSTX1099,RSTXROYL                                                
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DF109930 CLC   FLTIFLD(L'AC@MEDC),AC@MEDC     MED                               
         BNE   DF109940                                                         
         TM    RSTX1099,RSTXMEDC                                                
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DF109940 CLC   FLTIFLD(L'AC@PRIZE),AC@PRIZE    PRIZE                            
         BNE   DF109950                                                         
         TM    RSTX1099,RSTXPRIZ                                                
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DF109950 TM    RSTX1099,RSTXRENT               MUST BE RENT                     
         BO    FLTXE                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR POST TO 2C PROFILE (VEND2C=)                        *         
* VEND2C= - 1099 VENDOR                                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
VEND2C   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,V2CTABL                                                       
         B     ITER                                                             
*                                                                               
V2CTABL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISV2C)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISV2C)    *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALV2C)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFV2C)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFV2C)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFV2C)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY VEND2C= PROFILE                                             *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
DISV2C   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISV2C10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISV2CX                                                          
*                                                                               
DISV2C10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISV2CX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT1,RSTSVB2C                                                
         BZ    DISV2CX                                                          
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
*                                                                               
DISV2CX  MVI   SBYTE,V1099         MOVE IN 1099 VENDOR SEC #                    
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE VEND2C= PROFILE                                            *         
***********************************************************************         
         SPACE 1                                                                
VALV2C   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE2,X'FF'-PROF1099                                             
         BRAS  RE,VALSET                         EVEN IF THERE IS NO            
         BNE   VAL2C05                           CHANGE VALIDATE IF SET         
         CLC   FVIFLD(L'AC@NO),AC@NO             TO YES B/C OF THE              
         BE    EXITOK                            V2CTX ROUTINE                  
*                                                                               
VAL2C05  MVI   SBYTE,V1099         MOVE IN 1099 VENDOR SEC #                    
         BRAS  RE,CHKSEC                                                        
         BNE   VALV2CX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALV2C10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALV2CX                                                          
*                                                                               
VALV2C10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT1,X'FF'-(RSTSVB2C)                                        
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    VALV2CX                                                          
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VALV2CX             NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VALV2C15            YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VALV2C15 OI    RSTSTAT1,RSTSVB2C    DEPARTMENT FLAG ON                          
         OI    BYTE2,PROF1099                                                   
VALV2CX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY 1099 VENDOR FILTER                                          *         
***********************************************************************         
         SPACE 1                                                                
DFV2C    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE 1099 VENDOR FILTER                                         *         
***********************************************************************         
         SPACE 1                                                                
VFV2C    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLI   CUCTRY,CTRYUSA      THIS FILTER IS ONLY VALID FOR US             
         BNE   ERRFILT             FOR SV/SX/SY                                 
         CLC   =C'SV',ACTKUNT                                                   
         BE    VFV2C10                                                          
         CLC   =C'SY',ACTKUNT                                                   
         BE    VFV2C10                                                          
         CLC   =C'SX',ACTKUNT                                                   
         BNE   ERRFILT                                                          
VFV2C10  ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NO                                                  
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@YES                                                 
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON 1099 VENDOR PROFILE                                 *         
***********************************************************************         
         SPACE 1                                                                
DOFV2C   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   FLTIFLD,C'Y'                                                     
         BNE   DOFV2C10                                                         
*                                                                               
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'YES' SO DEFINITELY DON'T SHOW IT            
         TM    RSTSTAT1,RSTSVB2C   THAN BIT CAN'T BE ON                         
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFV2C10 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-IT'S ALWAYS               
         BNE   FLTXE               'NO' SO DEFINITELY SHOW IT                   
         TM    RSTSTAT1,RSTSVB2C                                                
         BZ    FLTXE                                                            
         B     FLTXL                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR:                                                    *         
* GST= OR GSTCODE= (THE SAME PROFILE) (THIS PROFILE CONSISTS OF TAX   *         
* TYPE-DATE)                                                          *         
* NN-N-MMDD/YY (THIS PROFILE CONSISTS OF PROVINCE CODE-TAX TYPE-DATE  *         
* VALID ON LOW LEVEL CANADIAN LEDGERS ONLY                            *         
* GST TYPE / PST PROVINCE/TYPE                                        *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CANADTAX DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CTAXTAB                                                       
         B     ITER                                                             
*                                                                               
CTAXTAB  DC    AL1(DDIS),AL1(0,0,0),AL4(DCATAX)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DCATAX)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VCATAX)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCTAX)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCTAX)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCTAX)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY GST OR PST PROFILE                                          *         
***********************************************************************         
         SPACE 1                                                                
DCATAX   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DCATAX10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          (N/A)IS DEFAULT FOR PST           
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#GSTC) GST PROFILE?                                 
         BNE   *+10                                                             
         MVC   FVIFLD(L'AC@NFA39),AC@NFA39   (GST RULES) IS DEF FOR GST         
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DCATAXX                                                          
*                                                                               
         USING ITCELD,R4                                                        
DCATAX10 L     R3,AIO2                                                          
         LA    R4,ACTRECD+(ACTRFST-ACTRECD)                                     
DCATAX15 CLI   0(R4),0                                                          
         BE    DCATAX40                                                         
         CLI   0(R4),ITCELQ        INPUT TAX TYPE ELEMENT (E4)                  
         BE    DCATAX25                                                         
DCATAX20 ZIC   R1,1(R4)                                                         
         AR    R4,R1                                                            
         B     DCATAX15                                                         
*                                                                               
DCATAX25 L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#GSTC) GST PROFILE?                                 
         BNE   DCATAX30                                                         
         OC    ITCPROV,ITCPROV     GST CODE WILL HAVE ZEROS IN PROVINCE         
         BNZ   DCATAX20                                                         
         LA    RF,FVIFLD                                                        
         MVC   0(L'ITCTYPE,RF),ITCTYPE      MOVE IN TAX TYPE                    
         MVI   L'ITCTYPE(RF),C'-'                                               
         GOTO1 VDATCON,BODMCB,(1,ITCEFFD),(17,L'ITCTYPE+1(RF))                  
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DCATAXX                                                          
*                                                                               
DCATAX30 L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#PSTC) PST PROFILE?                                 
         BNE   DCATAX20                                                         
         OC    ITCPROV,ITCPROV     PST CODE WILL HAVE PROVINCE FILLED           
         BZ    DCATAX20                                                         
         LA    RF,FVIFLD                                                        
         MVC   0(L'ITCPROV,RF),ITCPROV                                          
         MVI   L'ITCPROV(RF),C'-'                                               
         MVC   L'ITCPROV+1(L'ITCTYPE,(RF)),ITCTYPE                              
         MVI   L'ITCPROV+L'ITCTYPE+1(RF),C'-'                                   
         GOTO1 VDATCON,BODMCB,(1,ITCEFFD),                             +        
               (17,L'ITCPROV+L'ITCTYPE+2(RF))                                   
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DCATAXX                                                          
*                                                                               
DCATAX40 MVC   FVIFLD(L'AC@NONE),AC@NONE      NONE IS DEFAULT FOR PST           
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#GSTC) GST PROFILE?                                 
         BNE   *+10                                                             
         MVC   FVIFLD(L'AC@NFA39),AC@NFA39   (GST RULES) IS DEF FOR GST         
*                                                                               
DCATAXX  MVI   SBYTE,VENDINV       MOVE IN CANADIAN TAX PAYABLES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R4                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE GST OR PST PROFILE                                         *         
***********************************************************************         
         SPACE 1                                                                
VCATAX   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VENDINV       MOVE IN CANADIAN TAX PAYABLES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VCATAXX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VCATAX10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NFA39),AC@NFA39    SHOW '(GST RULES)'                
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VCATAXX                                                          
*                                                                               
         USING ITCELD,R4                                                        
VCATAX10 L     R3,AIO2                                                          
         LA    R4,ACTRECD+(ACTRFST-ACTRECD)                                     
VCATAX15 CLI   0(R4),0                                                          
         BE    VCATAX35                                                         
         CLI   0(R4),ITCELQ        INPUT TAX TYPE ELEMENT (E4)                  
         BE    VCATAX25                                                         
VCATAX20 ZIC   R1,1(R4)                                                         
         AR    R4,R1                                                            
         B     VCATAX15                                                         
*                                                                               
VCATAX25 L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#GSTC) GST PROFILE?                                 
         BNE   VCATAX30                                                         
         OC    ITCPROV,ITCPROV     FOR GST PROV CODE WILL BE ZEROS              
         BNZ   VCATAX20            NOT ZEROS LOOK FOR NEXT                      
         MVI   0(R4),X'FF'         MARK ELEM FOR DELETE & CHK NEXT              
         B     VCATAX20                                                         
*                                                                               
VCATAX30 L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#PSTC) PST PROFILE?                                 
         BNE   VCATAX20                                                         
         OC    ITCPROV,ITCPROV     FOR PST PROV CODE WILL BE FILLED IN          
         BZ    VCATAX20            ZEROS LOOK FOR NEXT ELEM                     
         MVI   0(R4),X'FF'         MARK ELEM FOR DELETE & CHK NEXT              
         B     VCATAX20                                                         
*                                                                               
VCATAX35 GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),(X'FF',ACTRECD),0,0                
*                                                                               
         CLI   FVILEN,0            ANY INPUT ENTERED?                           
         BE    VCATAXX             NO                                           
*                                                                               
         XC    SVPROV,SVPROV       GST HAS NO PROVINCE CODE                     
         L     R1,SVPARMS2         VALIDATION FOR GST                           
         CLM   R1,3,=AL2(ACC#PSTC) PST PROFILE?                                 
         BE    VCATAX40                                                         
         CLI   FVILEN,10           FORMAT MUST BE N-MMMDD/YY                    
         BNE   EXITNV                                                           
         CLI   FVIFLD+1,C'-'                                                    
         BNE   EXITNV                                                           
         MVC   SVTXTYPE,FVIFLD     SAVE TAX TYPE ENTERED                        
         LA    R3,FVIFLD                                                        
         GOTO1 VDATVAL,BODMCB,(0,2(R3)),BOWORK1                                 
         OC    0(4,R1),0(R1)                                                    
         BZ    EXITNV                                                           
         B     VCATAX55                                                         
*                                                                               
VCATAX40 CLI   FVILEN,13           FORMAT MUST BE NN-N-MMMDD/YY                 
         BNE   EXITNV                                                           
         CLI   FVIFLD+2,C'-'                                                    
         BNE   EXITNV                                                           
         CLI   FVIFLD+4,C'-'                                                    
         BNE   EXITNV                                                           
         MVC   SVTXTYPE,FVIFLD+3   SAVE TAX TYPE ENTERED                        
         L     R1,=A(PRVTAB)       SEE IF PROVINCE IN TABLE                     
         A     R1,BORELO                                                        
VCATAX45 CLI   0(R1),X'FF'         EOT?                                         
         BE    EXITNV                                                           
         CLC   FVIFLD(2),0(R1)                                                  
         BE    VCATAX50                                                         
         LA    R1,L'PRVTAB(,R1)                                                 
         B     VCATAX45                                                         
*                                                                               
VCATAX50 MVC   SVPROV,0(R1)        SAVE THE PROVINCE CODE                       
         LA    R3,FVIFLD                                                        
         GOTO1 VDATVAL,BODMCB,(0,5(R3)),BOWORK1                                 
         OC    0(4,R1),0(R1)                                                    
         BZ    EXITNV                                                           
*                                                                               
VCATAX55 GOTO1 VDATCON,BODMCB,(0,BOWORK1),(1,BOWORK2)                           
*                                                                               
         USING VTCD,R1             CALL VATICAN TO VALIDATE CODE                
         L     R1,AVATBLK                                                       
         XC    VTCD(VTCLNQ),VTCD                                                
         MVI   VTCACTN,VTCAIVAL    VALIDATE INPUT TAX TYPE                      
         MVC   VTCCPY,CUABIN       MOVE IN COMPANY                              
         MVC   VTCPRV,SVPROV       THIS WILL TELL VATICAN, GST/PST              
         MVC   VTCCOMF,ACOM                                                     
         MVC   VTCINVD,BOWORK2                                                  
         USING FVIHDR,RF                                                        
         LA    RF,VATFLDH                                                       
         XC    VATFLDH,VATFLDH     SET UP DUMMY FIELD HEADER                    
         MVI   FVTLEN,L'VATFLDH    HEADER+DATALEN                               
         MVI   FVILEN,1            DATA LENGTH                                  
         MVC   FVIFLD(1),SVTXTYPE  MOVE GST/PST TAX TYPE                        
         ST    RF,VTCAFLDH         PASS A(DUMMY TWA FIELD) TO VATICAN           
         DROP  RF                                                               
         GOTO1 VVATICAN,VTCD                                                    
         BNE   EXITNV              CODE INVALID                                 
*                                                                               
         TM    VTCINDS,VTCINA      GST NOT APPLICABLE                           
         BO    EXITNV              YES, ERROR                                   
*                                                                               
         LA    R4,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   ITCEL,ITCELQ                                                     
         MVI   ITCLN,ITCLNQ                                                     
         MVC   ITCEFFD,BOWORK2     EFFECTIVE DATE                               
         MVC   ITCTYPE,SVTXTYPE    TAX TYPE                                     
         MVC   ITCPROV,SVPROV      PROVINCE CODE                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),ITCELD,0                      
*                                                                               
VCATAXX  BRAS  RE,DISSET           UPDATE TABLE SETTINGS                        
         B     EXITOK                                                           
         SPACE 2                                                                
       ++INCLUDE ACPRVTAB                                                       
         SPACE 2                                                                
***********************************************************************         
* DISPALY GST/PST PROFILE FILTER                                      *         
***********************************************************************         
         SPACE 1                                                                
DFCTAX   CLI   FLTIFLD,0                                                        
         BE    EXITOK                                                           
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE GST/PST PROFILE FILTER                                     *         
***********************************************************************         
         SPACE 1                                                                
VFCTAX   CLI   FVILEN,0                                                         
         BE    EXITOK                                                           
*                                                                               
         CLI   CUCTRY,CTRYCAN      FILTER IS ONLY VALID FOR CANADIAN            
         BNE   ERRFILT             AGENCIES FOR SV/SW                           
         CLC   =C'SV',ACTKUNT                                                   
         BE    *+14                                                             
         CLC   =C'SW',ACTKUNT                                                   
         BNE   ERRFILT                                                          
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NONE   'NONE'?                                      
         BNE   VFCTAX10                                                         
         L     RF,SVPARMS2         'NONE' IS ONLY VALID FOR PST                 
         CLM   RF,3,=AL2(ACC#PSTC) PST PROFILE?                                 
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
VFCTAX10 EXCLC R1,FVIFLD,AC@NFA97       'GST RULES'?                            
         BNE   VFCTAX20                                                         
         L     RF,SVPARMS2         'GST RULES' IS ONLY VALID FOR                
         CLM   RF,3,=AL2(ACC#GSTC) GST PROFILE?                                 
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@NFA97),AC@NFA97                                     
         B     EXITOK                                                           
*                                                                               
VFCTAX20 L     RF,SVPARMS2         FOR PST PROFILE NEED TO VALIDATE             
         CLM   RF,3,=AL2(ACC#GSTC) THE PROVINCE CODE                            
         BE    VFCTAX50                                                         
         CLI   FVILEN,13           FORMAT MUST BE NN-N-MMMDD/YY FOR PST         
         BNE   EXITNV                                                           
         CLI   FVIFLD+2,C'-'                                                    
         BNE   EXITNV                                                           
         CLI   FVIFLD+4,C'-'                                                    
         BNE   EXITNV                                                           
         L     R1,=A(PRVTAB)       SEE IF PROVINCE IN TABLE                     
         A     R1,BORELO                                                        
VFCTAX30 CLI   0(R1),X'FF'         EOT?                                         
         BE    EXITNV                                                           
         CLC   FVIFLD(L'ITCPROV),0(R1)                                          
         BE    *+12                                                             
         LA    R1,L'PRVTAB(,R1)                                                 
         B     VFCTAX30                                                         
         GOTO1 VDATVAL,BODMCB,(0,FVIFLD+5),BOWORK1                              
         OC    0(4,R1),0(R1)                                                    
         BZ    EXITNV                                                           
         B     VFCTAX60                                                         
*                                                                               
VFCTAX50 CLI   FVILEN,10           FORMAT MUST BE N-MMMDD/YY FOR GST            
         BNE   EXITNV                                                           
         CLI   FVIFLD+1,C'-'                                                    
         BNE   EXITNV                                                           
         GOTO1 VDATVAL,BODMCB,(0,FVIFLD+2),BOWORK1                              
         OC    0(4,R1),0(R1)                                                    
         BZ    EXITNV                                                           
*                                                                               
VFCTAX60 ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
***********************************************************************         
* DO FILTERING ON GST/PST PROFILE                                     *         
* N/A AT HIGHER LEVELS FOR PST PROFILE SO SKIP THOSE ACCTS            *         
* GSTRULES IS THE SETTING FOR HIGH LVL ACCTS FOR GST                  *         
***********************************************************************         
         SPACE 1                                                                
DOFCTAX  DS    0H                                                               
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          LOW LEVEL ACCOUNT?                           
         BE    DOFCTX10            YES                                          
         L     R1,SVPARMS2         NO-SO IF PST PROFILE SKIP ACCOUNT            
         CLM   R1,3,=AL2(ACC#PSTC) ELSE FOR GST CHK IF FILTERING ON             
         BE    FLTXL               'GST RULES' IF SO DEFINITELY SHOW            
         CLC   FLTIFLD(L'AC@NFA97),AC@NFA97 IT ELSE SKIP IT.                    
         BE    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
         USING ITCELD,R4                                                        
DOFCTX10 XC    BOWORK1,BOWORK1                                                  
         XC    BOWORK2,BOWORK2                                                  
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#PSTC) DATE COMES FROM A DIFFERENT PLACE            
         BE    DOFCTX20            FOR PST THAN GST                             
         GOTO1 VDATVAL,BODMCB,(0,FLTIFLD+2),BOWORK1                             
         GOTO1 VDATCON,BODMCB,(0,BOWORK1),(1,BOWORK2)                           
         B     DOFCTX25                                                         
DOFCTX20 GOTO1 VDATVAL,BODMCB,(0,FLTIFLD+5),BOWORK1                             
         GOTO1 VDATCON,BODMCB,(0,BOWORK1),(1,BOWORK2)                           
DOFCTX25 LA    R4,ACTRECD+(ACTRFST-ACTRECD)                                     
DOFCTX30 CLI   0(R4),0                                                          
         BE    DOFCTX90            NO ELEM FOUND                                
         CLI   0(R4),ITCELQ        INPUT TAX TYPE ELEMENT (E4)                  
         BE    DOFCTX50                                                         
DOFCTX40 ZIC   R1,1(R4)                                                         
         AR    R4,R1                                                            
         B     DOFCTX30                                                         
*                                            NO ELEM SO IF FILTERING ON         
DOFCTX50 L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#GSTC) GST PROFILE?                                 
         BNE   DOFCTX60                                                         
         OC    ITCPROV,ITCPROV     GST CODE WILL HAVE ZEROS IN PROVINCE         
         BNZ   DOFCTX40                                                         
         CLC   FLTIFLD(L'AC@NFA97),AC@NFA97 FILTERING ON GST RULES?             
         BE    FLTXL               THAN DON'T WANT THIS ACCOUNT                 
         CLC   ITCTYPE,FLTIFLD     COMPARE ON TAX TYPE                          
         BNE   FLTXL                                                            
         CLC   ITCEFFD,BOWORK2     AND COMPARE ON DATE                          
         BE    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFCTX60 OC    ITCPROV,ITCPROV     PST CODE WILL HAVE A PROVINCE FILLED         
         BZ    DOFCTX40                                                         
         CLC   ITCPROV,FLTIFLD     COMPARE ON PROVINCE CODE                     
         BNE   FLTXL                                                            
         CLC   ITCTYPE,FLTIFLD+3   COMPARE ON TAX TYPE                          
         BNE   FLTXL                                                            
         CLC   ITCEFFD,BOWORK2     AND COMPARE ON DATE                          
         BE    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
** NEED TO FILL IN CODE HERE TO LOOK AT PROVINCE CODE & TAX TYPE **             
*                                                                               
DOFCTX90 CLC   FLTIFLD(L'AC@NONE),AC@NONE    DEFAULT THAN SHOW ACCOUNT          
         BE    FLTXE                         ELSE SKIP IT                       
         CLC   FLTIFLD(L'AC@NFA97),AC@NFA97                                     
         BE    FLTXE                                                            
         B     FLTXL                                                            
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR EXEC= PROFILE                                       *         
* EXEC= - EMPLOYEE TYPE (1R)                                          *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ETYPE    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,ETYPETBL                                                      
         B     ITER                                                             
*                                                                               
ETYPETBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISETYP)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISETYP)   *FOR REPORT                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFETY)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFETY)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFETY)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY EXEC= PROFILE                                               *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISETYP  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DETYP10                        VALID TO SHOW AT THIS LVL         
         CLI   CSACT,A#LST                                                      
         BE    DETYP05                                                          
         CLI   CSACT,A#REPT                                                     
         BE    DETYP05                                                          
         CLI   CSACT,A#DLOAD                                                    
         BNE   DETYP07                                                          
DETYP05  MVC   FVIFLD(L'AC@COP04),AC@COP04 SHOW 'STD'                           
         B     *+10                                                             
DETYP07  MVC   FVIFLD(L'AC@STDRD),AC@STDRD    SHOW 'STANDARD'                   
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DETYPX                                                           
*                                                                               
DETYP10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DETYPX                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         TM    RSTSTAT1,RSTSPIAE                                                
         BO    DETYP20                                                          
         CLI   CSACT,A#LST                                                      
         BE    DETYP15                                                          
         CLI   CSACT,A#REPT                                                     
         BE    DETYP15                                                          
         CLI   CSACT,A#DLOAD                                                    
         BNE   DETYP17                                                          
DETYP15  MVC   FVIFLD(L'AC@COP04),AC@COP04 SHOW 'STD' FOR LIST                  
         B     DETYPX                                                           
DETYP17  MVC   FVIFLD(L'AC@STDRD),AC@STDRD SHOW 'STANDARD' FOR DISPLAY          
         B     DETYPX                                                           
DETYP20  MVC   FVIFLD(L'AC@EXEC),AC@EXEC                                        
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DETYPX   OI    BYTE,CHK1R                                                       
         MVI   SBYTE,COSTPROF      MOVE IN COST ALLOCATION SEC #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY EXEC= FILTER                                                *         
***********************************************************************         
         SPACE 1                                                                
DFETY    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE EXEC= FILTER                                               *         
***********************************************************************         
         SPACE 1                                                                
VFETY    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1R',ACTKUNT      FILTER ON 1R ONLY                            
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@EXEC   EXECUTIVE                                    
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@EXEC),AC@EXEC                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@COP04  STD                                          
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@COP04),AC@COP04                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON EXEC= PROFILE                                       *         
***********************************************************************         
         SPACE 1                                                                
DOFETY   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLC   FLTIFLD(L'AC@EXEC),AC@EXEC    FILTERING ON EXECUTIVE?            
         BNE   DOFETY10                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'EXEC' SO DEFINITELY DON'T SHOW IT           
         TM    RSTSTAT1,RSTSPIAE                                                
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFETY10 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-IT'S ALWAYS               
         BNE   FLTXE               'STD' SO DEFINITELY SHOW IT                  
         TM    RSTSTAT1,RSTSPIAE           MUST BE FILTERING ON STD             
         BO    FLTXL                       DO BIT CAN'T BE ON                   
         B     FLTXE                                                            
*                                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSPROD AND RSTPRJB (T/S=P AND T/S=J PROFILES)     *         
* T/S= - REQUIRED ENTRY LEVEL (1C AND 1R)                             *         
* TSLEV2 IS THE ROUTINE TO DISPLAY THE PROFILE                        *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
TSLEV    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,TSLEVTBL                                                      
         B     ITER                                                             
*                                                                               
TSLEVTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISTSLV)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISTSLV)    *FOR REPORTING             
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALTSLV)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFTSLV)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFTSLV)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFTSLV)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSPROD/RSTSPRJB BIT IN RSTEL                                        
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DISTSLV  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF          READ ACC LEVELS FOR THE PROFILE              
         CLI   LEVELBIT,0          HAS THE PROFILE BEEN FOUND ON                
         BNE   DISTSLX             ANY LEVEL?  YES                              
         MVC   FVIFLD(L'AC@CLIC),AC@CLIC  CLIENT IS THE DEFAULT                 
*                                                                               
DISTSLX  MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         CLC   =C'1R',ACTKUNT                                                   
         BNE   *+8                                                              
         OI    BYTE,CHK1R                                                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE RSTSIVAT BIT IN RSTEL                                      *         
***********************************************************************         
         SPACE 1                                                                
VALTSLV  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VTSLVX                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT5,X'FF'-(RSTSPROD+RSTSPRJB)                               
         CLI   FVILEN,0            NO INPUT?                                    
         BE    VTSLVX                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@PROC   ENTERED PRODUCT?                             
         BNE   VTSLV10                                                          
         OI    RSTSTAT5,RSTSPROD   PRODUCT FLAG ON                              
         CLC   =C'1R',ACTKUNT      FOR 1R ACCTS MAKE SURE HIGHER LEVEL          
         BNE   VTSLVX              ACCTS DO NOT HAVE A MORE SPECIFIC            
         BRAS  RE,TSLHIGH          VALUE ENTERED                                
         BNE   EXITNV                                                           
         B     VTSLVX                                                           
*                                                                               
VTSLV10  EXCLC RE,FVIFLD,AC@JOB    ENTERED JOB?                                 
         BNE   EXITNV                                                           
         OI    RSTSTAT5,RSTSPRJB   JOB FLAG ON                                  
         B     VTSLVX                                                           
*                                                                               
VTSLVX   BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY T/S= FILTER                                                 *         
***********************************************************************         
         SPACE 1                                                                
DFTSLV   MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE T/S= FILTER                                                *         
***********************************************************************         
         SPACE 1                                                                
VFTSLV   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1R',ACTKUNT      FILTER VALID FOR 1R/1C ONLY                  
         BE    *+14                                                             
         CLC   =C'1C',ACTKUNT                                                   
         BNE   ERRFILT                                                          
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@PROC   PRODUCT?                                     
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@PROC),AC@PROC     FILL IN WHOLE WORD                
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@JOB    JOB?                                         
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@JOB),AC@JOB                                         
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@CLIC   CLIENT?                                      
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@CLIC),AC@CLIC                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON T/S= PROFILE                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFTSLV  CLC   =C'1C',ACTKUNT      ONLY VALID FOR 1C/1R                         
         BE    *+14                                                             
         CLC   =C'1R',ACTKUNT                                                   
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'Y'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         B     FLTXL                                                            
         EJECT                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTDFTSK TASK= PROFILE                              *         
* TASK= - DEFAULT TASK CODE                                           *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
TASKC    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,TASKCTBL                                                      
         B     ITER                                                             
*                                                                               
TASKCTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISTASK)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISTASK)   *FOR REPORTING              
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALTASK)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFTASK)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFTASK)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFTASK)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTDFTSK RSTEL                                                        
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DISTASK  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DISTSKX             YES SO DONE                                  
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42   '(NONE)' IS THE DEFAULT            
*                                                                               
DISTSKX  OI    BYTE,CHK1R                                                       
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE RSTDFTSK BIT IN RSTEL                                      *         
***********************************************************************         
         SPACE 1                                                                
VALTASK  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILES SEC #                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VTSKX                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R3,12(R1)                                                        
         USING RSTELD,R3                                                        
         MVC   RSTDFTSK,BCSPACES                                                
         CLI   FVILEN,0            NO INPUT?                                    
         BE    VTSKX                                                            
         CLI   FVILEN,2                                                         
         BNE   EXITNV              MUST BE 2 BYTES LONG                         
*                                                                               
         USING WCORECD,RF                                                       
         LA    RF,IOKEY                                                         
         MVC   WCOKEY,BCSPACES     READ LEDGER RECORD                           
         MVI   WCOKTYP,WCOKTYPQ    X'0A'                                        
         MVC   WCOKCPY,CUABIN      CONNECTED ID                                 
         MVC   WCOKUNT(L'WCOKUNT+L'WCOKLDG),=C'SJ'                              
         MVC   WCOKWRK,FVIFLD                                                   
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ESTAE) INVALID TASK CODE                         
         B     EXITL                                                            
*                                                                               
         MVC   RSTDFTSK,FVIFLD                                                  
*                                                                               
VTSKX    BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  R3,RF                                                            
         SPACE 2                                                                
***********************************************************************         
* DISPLAY DEFAULT TASK CODE FILTER                                              
***********************************************************************         
         SPACE 1                                                                
DFTASK   MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE DEFAULT TASK CODE FILTER                                             
***********************************************************************         
         SPACE 1                                                                
VFTASK   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1R',ACTKUNT      FILTER VALID FOR 1R ONLY                     
         BNE   ERRFILT                                                          
         CLC   FVIFLD(3),AC@NONE  ENTERED NONE?                                 
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         CLI   FVILEN,2            IF DIDN'T ENTER NONE THAN CAN'T BE           
         BNE   EXITNV              MORE THAN 2 BYTES                            
*                                                                               
         MVC   FLTIFLD(2),FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON DEFAULT TASK CODE                                   *         
***********************************************************************         
         SPACE 1                                                                
DOFTASK  CLC   =C'1R',ACTKUNT      FILTER VALID FOR 1R ONLY                     
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR SPATINCO OIN=PROFILE                                *         
* OIN= - INCOME ACCOUNT                                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
OVINCACC DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,OVINCTBL                                                      
         B     ITER                                                             
*                                                                               
OVINCTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DSOVINC)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSOVINC)   *FOR REPORTING              
         DC    AL1(DVAL),AL1(0,0,0),AL4(VLOVINC)                                
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCINC)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFOVINC)                               
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFOVINC)                               
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFOVINC)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY OVERRIDE INCOME ACCT IN SPAELD                                        
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DSOVINC  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DOVINCX             YES SO DONE                                  
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42   '(NONE)' IS THE DEFAULT            
*                                                                               
DOVINCX  OI    BYTE,CHK1R                                                       
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE OVERRIDE INCOME ACCT                                       *         
***********************************************************************         
         SPACE 1                                                                
VLOVINC  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VOVINCX                                                          
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('SPAELQ',ACTRECD),       *        
               (L'SPATYPE,=AL1(SPATINCO))        DELETE 2C ELEMENT              
*                                                                               
         CLI   FVILEN,0            ANY ACCOUNT ENTERED?                         
         BE    VOVINCX             NO                                           
*                                                                               
         CLC   =C'SI',FVIFLD       ONLY SI/SK ARE VALID                         
         BE    *+14                                                             
         CLC   =C'SK',FVIFLD                                                    
         BNE   EXITNV                                                           
*                                                                               
T        USING ACTRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES     READ LEDGER RECORD                         
         MVC   T.ACTKCPY,CUABIN      CONNECTED ID                               
         ZIC   RF,FVXLEN                                                        
         EXMVC RF,T.ACTKUNT,FVIFLD                                              
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         B     EXITL                                                            
         LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
                                                                                
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',AIO2),0                  
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)  MUST BE A LOW LEVEL ACCT                 
         B     EXITL                                                            
*                                                                               
         USING SPAELD,RF                                                        
         LA    RF,BOELEM           BUILD SPAEL                                  
         XC    BOELEM,BOELEM                                                    
         MVI   SPAEL,SPAELQ                                                     
         MVI   SPALN,SPALNQ                                                     
         MVI   SPATYPE,SPATINCO                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,SPAAULA,FVIFLD                                                
         OC    SPAAULA,BCSPACES                                                 
                                                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SPAELD,0                      
VOVINCX  BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* SEARCH ON OVERRIDE INCOME ACCOUNT                                   *         
***********************************************************************         
         SPACE 1                                                                
SRCINC   CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,0,ACOM,(0,0)                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY OVERRIDE INCOME ACCOUNT FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DFOVINC  MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE OVERRIDE INCOME ACCOUNT FILTER                             *         
***********************************************************************         
         SPACE 1                                                                
VFOVINC  CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1R',ACTKUNT      FILTER ONLY VALID FOR 1R                     
         BNE   ERRFILT                                                          
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NONE                                                
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         CLC   =C'SI',FVIFLD                                                    
         BE    VFOVI10                                                          
         CLC   =C'SK',FVIFLD                                                    
         BNE   EXITNV                                                           
*                                                                               
VFOVI10  EXMVC RE,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON OVERRIDE INCOME ACCOUNT PROFILE                     *         
***********************************************************************         
         SPACE 1                                                                
DOFOVINC CLC   =C'1R',ACTKUNT      FILTER ONLY VALID FOR 1R                     
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR SPATWOFF OWO=PROFILE                                *         
* OWO= - WRITEOFF ACCOUNT                                             *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
OVWOACC  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,OVWOTBL                                                       
         B     ITER                                                             
*                                                                               
OVWOTBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DSOVWO)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSOVWO)   *FOR REPORTING               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VLOVWO)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SROVWO)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFOVWO)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFOVWO)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFOVWO)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY OVERRIDE WRITE OFF ACCT IN IN SPAELD                                  
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DSOVWO   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DOVWOX              YES SO DONE                                  
*                                                                               
T        USING ACTRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(4),=C'SIWO'     BILL PGM TRIES TO POST TO SIWO         
         LHI   R1,XOREAD+XOACCDIR+XIO2   SO IF THAT EXISTS AND IT IS A          
         GOTO1 AIO                       LOW LEVEL ACCOUNT THAN THAT'S          
         BNE   DOVWO20                   WHAT I SHOW ELSE SHOW (NONE)           
         MVC   FVIFLD(L'AC@SIWO),AC@SIWO                                        
*                                                                               
         USING LDGRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   LDGKEY,BCSPACES                                                  
         MVC   LDGKCPY,CUABIN                                                   
         MVC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),=C'SI'                              
         GOTO1 AGETLDG                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         ICM   RE,15,ACALDG                                                     
         USING LDGTABD,RE                                                       
         LA    R1,2                SIWO ACCT IS 2 BYTES LONG                    
         CLI   LDGTLVA,L'ACTKACT   ONE LEVEL LEDGER?                            
         BE    DOVWOX              THAN AT THE LOWEST LEVEL                     
         ZIC   RF,LDGTLVC          IF 4 LEVEL LEDGER MUST CHECK                 
         CLI   LDGTLVD,0           3RD LEVEL                                    
         BNE   DOVWO10                                                          
         ZIC   RF,LDGTLVB          IF 3 LEVEL LEDGER MUST CHECK                 
         CLI   LDGTLVC,0           2ND LEVEL                                    
         BNE   DOVWO10                                                          
         ZIC   RF,LDGTLVA          CAN ASSUME A 2 LEVEL LEDGER                  
DOVWO10  CR    R1,RF               IS SIWO A LOW LEVEL ACCT?                    
         BH    DOVWOX                                                           
*                                                                               
DOVWO20  MVC   FVIFLD(L'AC@NFA42),AC@NFA42                                      
*                                                                               
DOVWOX   OI    BYTE,CHK1R                                                       
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* VALIDATE OVERRIDE WRITE-OFF ACCOUNT                                 *         
***********************************************************************         
         SPACE 1                                                                
VLOVWO   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VOVWOX                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('SPAELQ',ACTRECD),       *        
               (L'SPATYPE,=AL1(SPATWOFF))        DELETE 2C ELEMENT              
*                                                                               
         CLI   FVILEN,0            ANY ACCOUNT ENTERED?                         
         BE    VOVWOX              NO                                           
         CLC   =C'SI',FVIFLD       ONLY SI IS VALID                             
         BNE   EXITNV                                                           
*                                                                               
T        USING ACTRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES     VALIDATE THE ACCOUNT                       
         MVC   T.ACTKCPY,CUABIN      CONNECTED ID                               
         ZIC   RF,FVXLEN                                                        
         EXMVC RF,T.ACTKUNT,FVIFLD                                              
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         B     EXITL                                                            
         LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
                                                                                
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',AIO2),0                  
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)  MUST BE A LOW LEVEL ACCT                 
         B     EXITL                                                            
*                                                                               
         USING SPAELD,RF                                                        
         LA    RF,BOELEM           BUILD SPAEL                                  
         XC    BOELEM,BOELEM                                                    
         MVI   SPAEL,SPAELQ                                                     
         MVI   SPALN,SPALNQ                                                     
         MVI   SPATYPE,SPATWOFF                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,SPAAULA,FVIFLD                                                
         OC    SPAAULA,BCSPACES                                                 
                                                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SPAELD,0                      
VOVWOX   BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* SEARCH OVERRIDE WRITE-OFF ACCOUNT                                   *         
***********************************************************************         
         SPACE 1                                                                
SROVWO   CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,0,ACOM,(0,0)                     
         B     EXITOK                                                           
***********************************************************************         
* DISPLAY OVERRIDE WRITEOFF ACCOUNT FILTER                            *         
***********************************************************************         
         SPACE 1                                                                
DFOVWO   MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE OVERRIDE WRITEOFF ACCOUNT FILTER                           *         
***********************************************************************         
         SPACE 1                                                                
VFOVWO   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1R',ACTKUNT      FILTER ONLY VALID FOR 1R                     
         BNE   ERRFILT                                                          
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NONE                                                
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         CLC   =C'SI',FVIFLD                                                    
         BNE   EXITNV                                                           
*                                                                               
         EXMVC RE,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON OVERRIDE WRITEOFF ACCOUNT PROFILE                   *         
***********************************************************************         
         SPACE 1                                                                
DOFOVWO  CLC   =C'1R',ACTKUNT      FILTER ONLY VALID FOR 1R                     
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSHOUS/RSTSNBIZ/RSTSBONO                          *         
* HOUSE=/NEWBIZ=/PROBONO= - CLIENT TYPE                               *         
* CTYP2 IS THE ROUTINE TO DISPLAY THE PROFILE                         *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CLTYP    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CLTYPTBL                                                      
         B     ITER                                                             
*                                                                               
CLTYPTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISCTYP)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCTYP)  *FOR REPORTING               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCTYP)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCTYP)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCTYP)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCTYP)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSHOUS/RSTSNBIZ/RSTSBONO IN RSTEL                                   
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DISCTYP  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF          READ ACC LEVEL FOR THE PROFILE               
         CLI   LEVELBIT,0                                                       
         BNE   DISCTYX                                                          
*                                                                               
         MVC   FVIFLD(L'AC@BLB),AC@BLB    BILLABLE IS THE DEFAULT               
*                                                                               
DISCTYX  MVI   SBYTE,COSTPROF      MOVE IN COST ALLOCATION SEC #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE RSTSHOUS/RSTSNBIZ/RSTSBONO IN RSTEL                        *         
***********************************************************************         
         SPACE 1                                                                
VALCTYP  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,COSTPROF      MOVE IN COST ALLOCATION SEC #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VCTYPX                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT5,X'FF'-(RSTSHOUS+RSTSNBIZ+RSTSBONO)                      
         CLI   FVILEN,0            NO INPUT?                                    
         BE    VCTYPX                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@HOUSE  ENTERED HOUSE?                               
         BNE   *+12                                                             
         OI    RSTSTAT5,RSTSHOUS   HOUSE FLAG ON                                
         B     VCTYPX                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@NB     ENTERED NB?                                  
         BNE   *+12                                                             
         OI    RSTSTAT5,RSTSNBIZ   NEWBIZ FLAG ON                               
         B     VCTYPX                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@NEWBZ  ENTERED NEWBIZ?                              
         BNE   *+12                                                             
         OI    RSTSTAT5,RSTSNBIZ   NEWBIZ FLAG ON                               
         B     VCTYPX                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@PB     ENTERED PB?                                  
         BNE   *+12                                                             
         OI    RSTSTAT5,RSTSBONO   PROBONO FLAG ON                              
         B     VCTYPX                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@PBONO  ENTERED PROBONO?                             
         BNE   EXITNV                                                           
         OI    RSTSTAT5,RSTSBONO   PROBONO FLAG ON                              
*                                                                               
VCTYPX   BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY CLIENT TYPE FILTER                                          *         
***********************************************************************         
         SPACE 1                                                                
DFCTYP   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE CLIENT TYPE FILTER                                         *         
***********************************************************************         
         SPACE 1                                                                
VFCTYP   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1C',ACTKUNT      FILTER VALID FOR 1C ONLY                     
         BNE   ERRFILT                                                          
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@HOUSE  HOUSE?                                       
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@HOUSE),AC@HOUSE                                     
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@NEWBZ  NEWBIZ?                                      
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NEWBZ),AC@NEWBZ                                     
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@PBONO  PROBONO?                                     
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@PBONO),AC@PBONO                                     
         B     EXITOK                                                           
         EXCLC RE,FVIFLD,AC@BLB    BILLABLE?                                    
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@BLB),AC@BLB                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON CLIENT TYPE PROFILE                                 *         
***********************************************************************         
         SPACE 1                                                                
DOFCTYP  CLC   =C'1C',ACTKUNT      FILTER FOR 1C ONLY                           
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'Y'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR VENDOR TYPE (SV ONLY)                               *         
* USED TO BE ON FIRST PAGE OF ACCOUNT REC IN =FILE                    *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
VTYPE    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,VTYPETBL                                                      
         B     ITER                                                             
*                                                                               
VTYPETBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISVTY)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISVTY)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALVTY)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFVTY)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFVTY)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFVTY)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY VENDOR TYPE                                                 *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
DISVTY   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISVTY10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@COP04),AC@COP04 FOR LIST SHOW 'STD'                  
         CLI   CSACT,A#LST                                                      
         BE    DISVTY05                                                         
         CLI   CSACT,A#REPT                                                     
         BE    DISVTY05                                                         
         CLI   CSACT,A#DLOAD                                                    
         BE    DISVTY05                                                         
         MVC   FVIFLD(L'AC@STDRD),AC@STDRD                                      
DISVTY05 OI    FVATRB,FVAPROT      IF NOT DISPLAY 'STANDARD'                    
         B     DISVTYX             PROTECT PROFILE AND EXIT                     
*                                                                               
DISVTY10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISVTYX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                IF NOT THE LONGEST ELEM             
         BL    *+12                         SHOW THE DEFAULT                    
         TM    RSTSTAT5,RSTSPROV                                                
         BO    DISVTY20                                                         
         MVC   FVIFLD(L'AC@COP04),AC@COP04 FOR LIST SHOW 'STD'                  
         CLI   CSACT,A#LST                                                      
         BE    DISVTYX                                                          
         CLI   CSACT,A#REPT                                                     
         BE    DISVTYX                                                          
         CLI   CSACT,A#DLOAD                                                    
         BE    DISVTYX                                                          
         MVC   FVIFLD(L'AC@STDRD),AC@STDRD  STANDARD IS THE DEFAULT             
         B     DISVTYX                                                          
DISVTY20 MVC   FVIFLD(L'AC@PROV1),AC@PROV1                                      
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
*                                                                               
DISVTYX  MVI   SBYTE,VENDINV       MOVE IN VENDOR TYPE/FAX SECURITY #           
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE VENDOR TYPE PROFILE                                        *         
***********************************************************************         
         SPACE 1                                                                
VALVTY   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VENDINV       MOVE IN VENDOR TYPE/FAX SECURITY #           
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALVTYX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALVTY5                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALVTYX                                                          
*                                                                               
VALVTY5  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT5,X'FF'-(RSTSPROV)                                        
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    VALVTYX                                                          
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VALVTY10            PROVISIONAL?  GO CHECK FOR TRANS             
         CLC   FVIFLD(0),AC@PROV1                                               
*                                                                               
         CLC   FVIFLD(0),AC@COP04  STD                                          
         BE    VALVTYX             STD IS THE DEFAULT                           
         B     EXITNV                                                           
*                                                                               
VALVTY10 BAS   RE,CHKPROV                                                       
         BE    VALVTY15                                                         
         MVC   FVMSGNO,=AL2(AE$BEN3C)  TRANSACTIONS FOUND                       
         B     EXITL                                                            
*                                                                               
VALVTY15 OI    RSTSTAT5,RSTSPROV   PROVISIONAL VENDOR FLAG ON                   
VALVTYX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY VENDOR TYPE PROFILE                                         *         
***********************************************************************         
         SPACE 1                                                                
DFVTY    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE VENDOR TYPE PROFILE                                        *         
***********************************************************************         
         SPACE 1                                                                
VFVTY    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SV',ACTKUNT      FILTER IS ONLY VALID FOR SV                  
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@PROV1  PROVISIONAL                                  
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@PROV1),AC@PROV1                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@COP04  STD                                          
         BE    VFVTY10                                                          
         EXCLC R1,FVIFLD,AC@STDRD  STANDARD                                     
         BNE   EXITNV                                                           
VFVTY10  MVC   FLTIFLD(L'AC@STDRD),AC@STDRD                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON VENDOR TYPE                                         *         
***********************************************************************         
         SPACE 1                                                                
DOFVTY   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                   IF NOT THE LONGEST ELEM          
         BNL   DOFVTY05                        LENGTH                           
         CLC   FLTIFLD(L'AC@STDRD),AC@STDRD    ONLY THE DEFAULT FILTER          
         BE    FLTXE                           CAN BE EQUAL                     
         B     FLTXL                                                            
*                                                                               
DOFVTY05 ZIC   R1,FVXLEN                                                        
         EXCLC R1,FLTIFLD,AC@PROV1 FILTER ON PROVISIONAL VENDORS?               
         BNE   DOFVTY10                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'PROV' SO DEFINITELY DON'T SHOW IT           
         TM    RSTSTAT5,RSTSPROV   THAN THE BIT SHOULD BE ON                    
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFVTY10 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-IT'S ALWAYS               
         BNE   FLTXE               'STD' SO DEFINITELY SHOW IT                  
         TM    RSTSTAT5,RSTSPROV   MUST BE FILTERING ON STD VENDORS             
         BZ    FLTXE               THE BIT MUST BE OFF                          
         B     FLTXL                                                            
         EJECT                                                                  
*-------------------------------------------------------------------*           
*        PROVISIONAL ACCOUNTS MAY NOT HAVE TRANSACTIONS                         
*        READ FOR DRAFT AND LIVE TRANSACTIONS. IF ANY FOUND ERROR               
*-------------------------------------------------------------------*           
         SPACE 1                                                                
         USING TRNRECD,R3                                                       
CHKPROV  NTR1                                                                   
         LA    R3,IOKEY                                                         
         LHI   R1,XOHI+XOACCDIR+XIO2                                            
         GOTO1 AIO                                                              
         BE    CHKPV10                                                          
         DC    H'0'                                                             
CHKPV05  LHI   R1,XOSEQ+XOACCDIR+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
CHKPV10  CLC   IOKEY(L'TRNKCULA),IOKEYSAV      STILL SAME KEY ?                 
         BNE   CHKPVE              NO, PROVISIONAL OK                           
*                                                                               
         LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
*                                                                               
         L     R3,AIO2                                                          
         LA    R4,TRNRECD+(TRNRFST-TRNRECD)                                     
         CLI   0(R4),TRNELQ        X'44'=TRANSACTION                            
         BNE   CHKPV05                                                          
*                                                                               
CHKPVL   CLI   *,FF                                                             
         B     CHKPVX                                                           
CHKPVE   CR    RB,RB                                                            
CHKPVX   XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSOFBR BIT IN RSTEL OUTFILE=                      *         
* OUTFILE= - GENERATE POSPAY FILE (SC)                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
OUTFILE  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,OUTFTABL                                                      
         B     ITER                                                             
*                                                                               
OUTFTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISOUTF)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISOUTF)   *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALOUTF)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFOUTF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFOUTF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFOUTF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSOFBR BIT IN RSTEL                                       *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                               
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISOUTF  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DOUT10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DOUTFX                                                           
*                                                                               
DOUT10   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DOUTFX                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         TM    RSTSTAT1,RSTSOFBR                                                
         BO    *+14                                                             
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         B     DOUTFX                                                           
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DOUTFX   MVI   SBYTE,BANKPROF      MOVE IN CASH REC SEC NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE RSTSOFBR BIT IN RSTEL                                      *         
***********************************************************************         
         SPACE 1                                                                
VALOUTF  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN CASH RECONCILIATION SEC #            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VOUTFX                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT,X'FF'-(RSTSOFBR)                                         
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    VOUTFX                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VOUTFX              NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VOUTF02             YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VOUTF02  OI    RSTSTAT,RSTSOFBR    OUTFILE FLAG ON                              
*                                                                               
VOUTFX   BRAS  RE,DISSET                                                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY OUTFILE= FILTER                                             *         
***********************************************************************         
         SPACE 1                                                                
DFOUTF   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE OUTFILE= FILTER                                            *         
***********************************************************************         
         SPACE 1                                                                
VFOUTF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SC',ACTKUNT      FILTER ONLY VALID FOR SC                     
         BNE   ERRFILT                                                          
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NO                                                  
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NO),AC@NO     NO                                    
         B     EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@YES                                                 
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@YES),AC@YES   YES                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON OUTFILE= PROFILE                                    *         
* N/A AT HIGHER LEVELS SO ALWAYS SKIP THOSE ACCOUNTS                  *         
***********************************************************************         
         SPACE 1                                                                
DOFOUTF  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          TEST IF LOW LEVEL ACCOUNT                    
         BNE   FLTXL                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   FLTIFLD,C'N'        WANT ALL OUTFILE=NO?                         
         BNE   DOFOUT10                                                         
*                                                                               
         TM    RSTSTAT1,RSTSOFBR                                                
         BO    FLTXL                                                            
         B     FLTXE                                                            
*                                                                               
DOFOUT10 TM    RSTSTAT1,RSTSOFBR                                                
         BO    FLTXE                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR EMPSACT BIT IN EMPELD                               *         
* ACTUAL= - STANDARD ALLOC HOURS                                      *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ACTUAL   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,ACTLTABL                                                      
         B     ITER                                                             
*                                                                               
ACTLTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISACT)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISACT)  *FOR REPORT                   
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFACT)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFACT)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFACT)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY EMPSACT BIT IN EMPELD.  ONLY VALID AT LOWEST LEVELS WHICH   *         
* CANNOT BE CHANGED IN =AFM SO THIS PROFILE IS DISPLAY ONLY.          *         
***********************************************************************         
         SPACE 1                                                                
DISACT   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISACT05                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@COP04),AC@COP04     SHOW 'STD'                       
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISACTX                                                          
*                                                                               
DISACT05 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('EMPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISACT10            MUST BE AN OVERHEAD ACCT OR A HIGH           
         L     RF,12(R1)           LEVEL 1R ACCOUNT                             
         USING EMPELD,RF                                                        
         TM    EMPSTAT,EMPSACT                                                  
         BZ    DISACT10                                                         
         MVC   FVIFLD(L'AC@ACL),AC@ACL       'ACTUAL'                           
         OI    LEVELBIT,ACCTLV                                                  
         B     DISACTX                                                          
*                                                                               
DISACT10 MVC   FVIFLD(L'AC@COP04),AC@COP04 STD IS THE DEFAULT                   
*                                                                               
DISACTX  OI    BYTE,CHK1R                                                       
         MVI   SBYTE,COSTPROF      MOVE IN COST ALLOCATION SEC #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACTUAL= FILTER                                              *         
***********************************************************************         
         SPACE 1                                                                
DFACT    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACTUAL= FILTER                                             *         
***********************************************************************         
         SPACE 1                                                                
VFACT    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'1R',ACTKUNT      FILTER ON 1R ONLY                            
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@ACL    ACTUAL                                       
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@ACL),AC@ACL                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@COP04  STD                                          
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@COP04),AC@COP04                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACTUAL= PROFILE                                     *         
***********************************************************************         
         SPACE 1                                                                
DOFACT   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('EMPELQ',ACTRECD),0               
         CLI   12(R1),0                     NO ELEM?                            
         BE    DOFACT5                      MUST BE A HIGH LVL 1R ACCT          
         CLC   FLTIFLD(L'AC@COP04),AC@COP04  OR AN OVERHEAD ACCT                
         BE    FLTXE                        IF FILTERING ON THE DEFAULT         
         B     FLTXL                        'STD' - INCLUDE THIS ACCT           
*                                                                               
DOFACT5  L     RF,12(R1)                                                        
         USING EMPELD,RF                                                        
         CLC   FLTIFLD(L'AC@ACL),AC@ACL    FILTERING ON ACTUAL?                 
         BNE   DOFACT10                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'STD' SO DEFINITELY DON'T SHOW IT            
         TM    EMPSTAT,EMPSACT                                                  
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFACT10 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-IT'S ALWAYS               
         BNE   FLTXE               'STD' SO DEFINITELY SHOW IT                  
         TM    EMPSTAT,EMPSACT     ACTUAL?                                      
         BO    FLTXL                                                            
         B     FLTXE                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSPRCR/RSTSPRDR BIT IN RSTEL                      *         
* RECCR=/RECDR= - PEELING PROFILES(SC)                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
RECON    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,RECONTBL                                                      
         B     ITER                                                             
*                                                                               
RECONTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISREC)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISREC)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALREC)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFREC)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFREC)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFREC)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSPRCR/RSTSPRDR BIT IN RSTEL                              *         
* VALID ON LOW LEVEL ACCOUNT ONLY                                               
***********************************************************************         
         SPACE  1                                                               
DISREC   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISREC10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISRECX                                                          
*                                                                               
DISREC10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         TM    RSTSTAT3,RSTSPRCR+RSTSPRDR                                       
         BNO   *+14                                                             
         MVC   FVIFLD(L'AC@BOTH),AC@BOTH          'BOTH'                        
         B     DISREC20                                                         
         TM    RSTSTAT3,RSTSPRCR                                                
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@CRS),AC@CRS            'CREDITS'                     
         B     DISREC20                                                         
         TM    RSTSTAT3,RSTSPRDR                                                
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@DRS),AC@DRS            'DEBITS'                      
         B     DISREC20                                                         
         MVC   FVIFLD(L'AC@NONE),AC@NONE          'NONE'                        
         B     DISRECX                                                          
*                                                                               
DISREC20 OI    LEVELBIT,ACCTLV                                                  
*                                                                               
DISRECX  MVI   SBYTE,PEELSC              MOVE IN SC PEELING PROF SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE RSTSPRCR/RSTPRDR BIT IN RSTEL                              *         
***********************************************************************         
         SPACE 1                                                                
VALREC   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,PEELSC        MOVE IN SC PEELING PROFILE SEC #             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALRECX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALREC10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALRECX                                                          
*                                                                               
VALREC10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT3,FF-(RSTSPRCR+RSTSPRDR)                                  
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NONE                   
         BE    EXITOK                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NONE   ENTERED NONE?                                
         BE    EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@DR     DR                                           
         BE    VALREC20                                                         
         EXCLC RE,FVIFLD,AC@DRS    DEBITS                                       
         BNE   *+12                                                             
VALREC20 OI    RSTSTAT3,RSTSPRDR                                                
         B     VALRECX                                                          
*                                                                               
         EXCLC RE,FVIFLD,AC@CRS    CR                                           
         BE    VALREC30                                                         
         EXCLC RE,FVIFLD,AC@CRS    CREDITS                                      
         BNE   *+12                                                             
VALREC30 OI    RSTSTAT3,RSTSPRCR                                                
         B     VALRECX                                                          
*                                                                               
         EXCLC RE,FVIFLD,AC@BOTH   BOTH                                         
         BNE   EXITNV                                                           
         OI    RSTSTAT3,RSTSPRCR+RSTSPRDR                                       
*                                                                               
VALRECX  BRAS  RE,DISSET           UPDATE TABLE SETTINGS                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RECCR/RECDR FILTER                                          *         
***********************************************************************         
         SPACE 1                                                                
DFREC    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE RECCR/RECDR FILTER                                         *         
***********************************************************************         
         SPACE 1                                                                
VFREC    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SC',ACTKUNT      FILTER VALID FOR SC ONLY                     
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@BOTH   BOTH                                         
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@BOTH),AC@BOTH                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@CRS    CREDITS                                      
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@CRS),AC@CRS                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@DRS    DEBITS                                       
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@DRS),AC@DRS                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@NONE   NONE                                         
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON RECCR/RECDR FILTER                                  *         
* N/A AT HIGHER LEVELS                                                *         
***********************************************************************         
         SPACE 1                                                                
DOFREC   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
DOFREC02 CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BH    DOFREC04                 VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOFREC02                                                      
*                                                                               
DOFREC04 LTR   R1,R1                                                            
         BZ    FLTXL                                                            
         BCTR  R1,0                                                             
         EXCLC R1,FLTIFLD,AC@BOTH  FILTERING ON BOTH?                           
         BNE   DOFREC10                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LVL ACCT CAN'T BE SET TO             
         BNE   FLTXL               'BOTH' SO DEFINITELY DON'T SHOW              
         TM    RSTSTAT3,RSTSPRCR+RSTSPRDR   BOTH BITS MUST BE ON                
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFREC10 EXCLC R1,FLTIFLD,AC@CRS   FILTERING ON CREDITS?                        
         BNE   DOFREC20                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LVL ACCT CAN'T BE SET TO             
         BNE   FLTXL               'CREDITS' SO DEFINITELY DON'T SHOW           
         TM    RSTSTAT3,RSTSPRCR   CREDIT BIT MUST BE ON                        
         BZ    FLTXL                                                            
         TM    RSTSTAT3,RSTSPRDR   AND DEBIT BIT MUST BE OFF                    
         BZ    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFREC20 EXCLC R1,FLTIFLD,AC@DRS   FILTERING ON DEBITS?                         
         BNE   DOFREC30                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LVL ACCT CAN'T BE SET TO             
         BNE   FLTXL               'DEBITS' SO DEFINITELY DON'T SHOW            
         TM    RSTSTAT3,RSTSPRDR   DEBIT BIT MUST BE ON                         
         BZ    FLTXL                                                            
         TM    RSTSTAT3,RSTSPRCR   AND CREDIT BIT MUST BE OFF                   
         BZ    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFREC30 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          MUST BE FILTERING ON 'NONE'                  
         BNE   FLTXE               IF HIGH LEV ACCT DEFINITELY SHOW             
         TM    RSTSTAT3,RSTSPRDR+RSTSPRCR                                       
         BZ    FLTXE               BOTH BITS MUST BE OFF                        
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FFTTEML                                             *         
* EM= - E-MAIL ID (SV,SX,SW,SY)                                       *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EMAIL    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EMTBL                                                         
         B     ITER                                                             
*                                                                               
EMTBL    DC    AL1(DDIS),AL1(0,0,0),AL4(DISEM)                                  
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISEM)   *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALEM)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FFTTEML                                                     *         
* VALID ON LOW LEVEL ACCOUNT ONLY                                               
***********************************************************************         
         USING ACTRECD,R2                                                       
DISEM    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISEM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISEMX                                                           
*                                                                               
DISEM10  GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTEML                                   
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
DISEMX   B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE EM= PROFILE                                                *         
***********************************************************************         
         SPACE 1                                                                
VALEM    NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALEM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VALEM10  CLI   FVILEN,0                                                         
         BE    VALEM20                                                          
         GOTO1 VEMAIL,BOPARM,FVIHDR,0,0,0                                       
         CLI   0(R1),0                                                          
         BE    VALEMX                                                           
         SR    RE,RE                                                            
         ICM   RE,7,BOPARM+1                                                    
         MVC   FVXTRA,0(RE)                                                     
         B     EXITNV                                                           
*                                                                               
VALEM20  DS    0H                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VALEMX                                                           
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         TM    VBPPAYM,VBPPCRD     IS PCARD SET IN PAYMENT METHOD ?             
         BZ    VALEMX                                                           
         MVC   FVMSGNO,=AL2(AE$BEML) CAN'T REMOVE EMAIL WHEN PCARD SET          
         B     EXITL                                                            
VALEMX   GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTEML                                   
         B     EXITOK                                                           
*                                                                               
         EJECT                                                                  
*                                                                               
***********************************************************************         
* DATA OBJECT FOR RSTMAIL                                             *         
* MAIL= - EDI CHECK DELIVERY (ALL PAYABLE LEDGERS)                    *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
MAIL     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,MAILTBL                                                       
         B     ITER                                                             
*                                                                               
MAILTBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISML)                                  
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISML) *FOR REPORT                     
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALML)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFML)                                  
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFML)                                  
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFML)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTMAIL                                                     *         
* VALID ON LOW LEVEL ACCOUNT ONLY                                               
***********************************************************************         
         USING ACTRECD,R2                                                       
DISML    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISML10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@COP04),AC@COP04    FOR LIST SHOW 'STD'               
         CLI   CSACT,A#LST                                                      
         BE    DISML05                                                          
         CLI   CSACT,A#REPT                                                     
         BE    DISML05                                                          
         CLI   CSACT,A#DLOAD                                                    
         BE    DISML05                                                          
         MVC   FVIFLD(L'AC@STDRD),AC@STDRD    SHOW 'STANDARD'                   
DISML05  OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISMLX                                                           
*                                                                               
DISML10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISMLX                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                IF NOT THE LONGEST ELEM             
         BL    DISML15                      SHOW THE DEFAULT                    
*SPEC-44172                                                                     
         TM    RSTMAIL,RSTMAOV2                                                 
         BZ    DISML11                                                          
         MVC   FVIFLD(L'AC@OVR2),AC@OVR2    FOR ACTION LIST SHOW 'OV'           
         CLI   CSACT,A#LST                                                      
         BE    DISML12                                                          
         CLI   CSACT,A#REPT                                                     
         BE    DISML12                                                          
         CLI   CSACT,A#DLOAD                                                    
         BE    DISML12                                                          
         MVC   FVIFLD(L'AC@NFA2A),AC@NFA2A  'RDVENDOR'                          
         B     DISML12                                                          
*SPEC-44172                                                                     
DISML11  TM    RSTMAIL,RSTMAIOV                                                 
         BZ    DISML15                                                          
         MVC   FVIFLD(L'AC@OVRI),AC@OVRI    FOR ACTION LIST SHOW 'OV'           
DISML11A CLI   CSACT,A#LST                                                      
         BE    DISML12                                                          
         CLI   CSACT,A#REPT                                                     
         BE    DISML12                                                          
         CLI   CSACT,A#DLOAD                                                    
         BE    DISML12                                                          
         MVC   FVIFLD(L'AC@NFA25),AC@NFA25  'OVERNIGHT'                         
DISML12  OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DISMLX                                                           
*                                                                               
DISML15  MVC   FVIFLD(L'AC@COP04),AC@COP04   SHOW 'STD' FOR LIST SCREEN         
         CLI   CSACT,A#LST                                                      
         BE    DISMLX                                                           
         CLI   CSACT,A#REPT                                                     
         BE    DISMLX                                                           
         CLI   CSACT,A#DLOAD                                                    
         BE    DISMLX                                                           
         MVC   FVIFLD(L'AC@STDRD),AC@STDRD   'STANDARD' IS THE DEFAULT          
*                                                                               
DISMLX   MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE MAIL= PROFILE                                              *         
***********************************************************************         
         SPACE 1                                                                
VALML    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALMLX                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALML5                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@STDRD),AC@STDRD    SHOW 'STANDARD'                   
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALMLX                                                           
*                                                                               
VALML5   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
*SPEC-44172                                                                     
*        NI    RSTMAIL,X'FF'-(RSTMAIOV)                                         
         NI    RSTMAIL,X'FF'-(RSTMAIOV+RSTMAOV2)                                
*SPEC-44172                                                                     
         CLI   FVILEN,0                                                         
         BE    VALMLX                                                           
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@STDRD                                               
         BE    VALMLX              STANDARD IS THE DEFAULT                      
         EXCLC R1,FVIFLD,AC@COP04  STD IS VALID TOO                             
         BE    VALMLX                                                           
*SPEC-44172                                                                     
         EXCLC R1,FVIFLD,AC@NFA2A  OVERRIDE DIRECT TO VENDOR                    
         BNE   VALML8                                                           
         OI    RSTMAIL,RSTMAOV2                                                 
         B     VALMLX                                                           
*SPEC-44172                                                                     
VALML8   EXCLC R1,FVIFLD,AC@NFA25                                               
         BNE   EXITNV                                                           
         OI    RSTMAIL,RSTMAIOV                                                 
*                                                                               
VALMLX   BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY EDI CHECK DELIVERY FILTER                                   *         
***********************************************************************         
         SPACE 1                                                                
DFML     CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE EDI CHECK DELIVERY FILTER                                  *         
***********************************************************************         
         SPACE 1                                                                
VFML     CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SP',ACTKUNT      PAYABLES LEDGER SP,SQ,SS,ST,SU               
         BE    VFML10              GET SCREEN CODE A                            
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFML10                                                           
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
VFML10   ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NFA25  OVERNIGHT                                    
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA25),AC@NFA25                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@NFA2A RDVendor                                      
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA2A),AC@NFA2A                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@COP04  STD                                          
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@COP04),AC@COP04                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON EDI CHECK DELIVERY                                  *         
***********************************************************************         
         SPACE 1                                                                
DOFML    GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                   IF NOT THE LONGEST ELEM          
         BNL   DOFML05                         LENGTH                           
         CLC   FLTIFLD(L'AC@COP04),AC@COP04    ONLY THE DEFAULT FILTER          
         BE    FLTXE                           CAN BE EQUAL                     
         B     FLTXL                                                            
*                                                                               
DOFML05  CLC   FLTIFLD(L'AC@NFA2A),AC@NFA2A FILTERING ON RDVendor?              
         BNE   DOFML07                                                          
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'OV' SO DEFINITELY DON'T SHOW IT             
         TM    RSTMAIL,RSTMAIOV                                                 
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFML07  CLC   FLTIFLD(L'AC@NFA2A),AC@NFA2A FILTERING ON RDVendor?              
         BNE   DOFML10                                                          
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-CAN'T BE SET TO           
         BNE   FLTXL               'OV' SO DEFINITELY DON'T SHOW IT             
         TM    RSTMAIL,RSTMAOV2                                                 
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFML10  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT-IT'S ALWAYS               
         BNE   FLTXE               'STD' SO DEFINITELY SHOW IT                  
         TM    RSTMAIL,RSTMAIOV+RSTMAOV2 MUST WANT INCLUDES ONLY                
         BZ    FLTXE               THAN BIT MUST BE OFF                         
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTSCCBJ BIT IN RSTEL                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CLICOS   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CCBJTABL                                                      
         B     ITER                                                             
*                                                                               
CCBJTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISCCB)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCCB)    *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCCB)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTSCCBJ BIT IN RSTEL                                       *         
***********************************************************************         
         SPACE  1                                                               
DISCCB   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT3,RSTSCCBJ                                                
         BZ    EXITOK                                                           
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         B     EXITOK                                                           
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE RSTSCCBJ BIT IN RSTEL                                      *         
***********************************************************************         
         SPACE 1                                                                
VALCCB   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT3,X'FF'-(RSTSCCBJ)                                        
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    EXITOK                                                           
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    EXITOK              NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
*                                                                               
         EX    RE,*+8                                                           
         BE    VCCBJ02             YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VCCBJ02  OI    RSTSTAT3,RSTSCCBJ   PROFIT/LOSS FLAG ON                          
         B     EXITOK                                                           
         DROP  RF                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RATEDSCQ - DISCOUNT                                 *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                     *         
* DISCOUNT= - CASH DISCOUNT % (SV,SW,SX)                              *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
DISCOUNT DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,DISCTABL                                                      
         B     ITER                                                             
*                                                                               
DISCTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISDSC)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISDSC)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALDSC)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFDSC)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFDSC)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFDSC)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RATEDSCQ                                                    *         
***********************************************************************         
         SPACE  1                                                               
DISDSC   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
DISDSC5  BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISDSC10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISDSCX                                                          
*                                                                               
DISDSC10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RATEDSCQ',ACTRECD),0             
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42      '(NONE)'                        
         B     DISDSCX                                                          
         L     R3,12(R1)                                                        
         USING RATELD,R3                                                        
*                                                                               
         CURED RATRATE,(8,FVIFLD),2,ALIGN=LEFT,MINUS=YES,DMCB=BOPARM            
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
DISDSCX  MVI   SBYTE,VENDINV       MOVE IN VENDOR INVOICE SEC #                 
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  R3                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE RATEDSCQ                                                   *         
***********************************************************************         
         SPACE 1                                                                
VALDSC   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VENDINV       MOVE IN VENDOR INVOICE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALDSCX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALDSC10                       VALID TO SHOW AT THIS LVL         
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VALDSC10 GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('RATEDSCQ',ACTRECD),0             
         CLI   FVILEN,0                                                         
         BE    VALDSCX                                                          
*                                                                               
         LA    R3,BOWORK1                                                       
         USING RATELD,R3                                                        
         MVI   RATEL,RATEDSCQ                                                   
         MVI   RATLN,RATLNQ                                                     
         XR    RF,RF                                                            
         IC    RF,FVILEN                                                        
         GOTO1 VCASHVAL,BOPARM,(X'80',FVIFLD),(RF)  FIRST CALL CASHVAL          
         CLI   0(R1),X'FF'                          TO GET PACKED AMT           
         BE    VDISCERR                                                         
         CP    BOPARM+4(8),=P'0'        DO NOT ALLOW FOR 0.00 OR NEG'S          
         BNH   VDISCERR                                                         
         CP    BOPARM+4(8),=P'9999'                                             
         BH    VDISCERR                                                         
         XR    RF,RF                                                            
         IC    RF,FVILEN                                                        
         GOTO1 VCASHVAL,BOPARM,FVIFLD,(RF)  NOW CALL CASHVAL TO GET             
         CLI   0(R1),X'FF'                  BINARY AMT FOR STORING              
         BE    VDISCERR                     IN ELEMENT                          
*                                                                               
         MVC   RATRATE,BOPARM+6                                                 
         GOTO1 VHELLO,BODMCB,(C'P',GCFILNAM),(R2),RATELD,0                      
         CLI   12(R1),0                                                         
         BE    VALDSCX                                                          
         DC    H'0'                                                             
*                                                                               
VDISCERR MVC   FVMSGNO,=AL2(AE$INAMT)  INVALID AMOUNT                           
         B     EXITL                                                            
*                                                                               
VALDSCX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY DISCOUNT PCT FILTER                                         *         
***********************************************************************         
         SPACE 1                                                                
DFDSC    MVC   FVIFLD,BCSPACES                                                  
         OC    FLTIFLD(L'RATRATE),FLTIFLD                                       
         BZ    EXITOK              NOTHING TO FILTER ON                         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
         B     EXITOK                                                           
         CURED (2,FLTIFLD),(8,FVIFLD),2,ALIGN=LEFT,MINUS=YES,          +        
               DMCB=BOPARM                                                      
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE DISCOUNT PCT FILTER                                        *         
***********************************************************************         
         SPACE 1                                                                
VFDSC    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SV',ACTKUNT      FILTER VALID FOR SV,SW,SX ONLY               
         BE    VFDSC10                                                          
         CLC   =C'SW',ACTKUNT                                                   
         BE    VFDSC10                                                          
         CLC   =C'SX',ACTKUNT                                                   
         BNE   ERRFILT                                                          
VFDSC10  ZIC   RF,FVXLEN                                                        
         EXCLC RF,FVIFLD,AC@NONE                                                
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         ZIC   RF,FVILEN                                                        
         GOTO1 VCASHVAL,BOPARM,(X'80',FVIFLD),(RF)                              
         CLI   0(R1),X'FF'                                                      
         BE    EXITNOTN                                                         
         CP    BOPARM+4(8),=P'0'        DO NOT ALLOW FOR 0.00 OR NEG'S          
         BNH   VDISCERR                                                         
         CP    BOPARM+4(8),=P'9999'                                             
         BH    VDISCERR                                                         
*                                                                               
         ZIC   RF,FVILEN                                                        
         GOTO1 VCASHVAL,BOPARM,FVIFLD,(RF)  NOW CALL CASHVAL TO GET             
         CLI   0(R1),X'FF'                  BINARY AMT FOR STORING              
         BE    EXITNV                       IN FILTER FIELD                     
*                                                                               
         MVC   FLTIFLD,BOPARM+6                                                 
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DO FILTERING ON DISCOUNT PERCENT                                    *         
* N/A AT HIGHER LEVELS                                                *         
***********************************************************************         
         SPACE 1                                                                
DOFDSC   MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT SKIP IT SINCE             
         BNE   FLTXL               N/A AT HIGHER LEVELS                         
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RATEDSCQ',ACTRECD),0             
         CLI   12(R1),0                                                         
         BE    DOFDSC10                                                         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE NO ELEMENT SO ONLY 'NONE'             
         BE    FLTXE                      IS A VALID FILTER                     
         B     FLTXL                                                            
*                                                                               
DOFDSC10 L     R3,12(R1)                                                        
         USING RATELD,R3                                                        
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         BNE   DOFDSC20                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT AND FILTERING             
         BNE   FLTXE               ON NONE THAN SHOW IT                         
         B     FLTXL                                                            
*                                                                               
DOFDSC20 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          FILTERING ON A VALID RATE SO IF              
         BNE   FLTXL               HIGH LEVEL ACCOUNT DON'T SHOW IT             
         CLC   RATRATE,FLTIFLD                                                  
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RSTCOSTG                                            *         
* ANALYSIS= - DIRECT EXP ACCT (OVERRIDE) (SE)                         *         
* ANALYSIS= - INDIRECT TIME TYPE (1N)                                 *         
* ANALYSIS= - DIRECT LABOR ACCOUNT (1R)                               *         
* ANALYSIS= - BILLINGS & REVENUE ANALYSIS ACCT (SI)                   *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ANALCODE DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,ANALTABL                                                      
         B     ITER                                                             
*                                                                               
ANALTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISANL)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISANL)    *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALANL)                                 
*        DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCANL)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFANL)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFANL)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFANL)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RSTCOSTG                                                    *         
* FOR 1R OR 1N ACCT ANY ANALYSIS (1 BYTE ONLY) WILL BE FOUND IN THE 30*         
* ELEMENT.  FOR SE OR SI ACCT IF 1 BYTE ANALYSIS WILL BE FOUND IN THE *         
* 30 ELEMENT.  MORE THAN 1 BYTE IT WILL BE FOUND IN THE 2C ELEMENT    *         
* CAN BE SET AT ANY LEVEL OF THE ACCOUNT RECORD EXCEPT FOR 1N WHICH   *         
* CAN ONLY BE AT THE LOWEST LEVEL.  FOR SE CAN ALSO BE STORED ON THE  *         
* LEDGER RECORD.                                                      *         
***********************************************************************         
         SPACE 1                                                                
DISANL   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         CLC   =C'1R',ACTKUNT      FOR 1R THE ANALYSIS CANNOT BE SET            
         BNE   DSANL02             AT THE OFFICE LEVEL                          
         LR    R3,R2                                                            
         BRAS  RE,ANL1R                                                         
         BNE   DSANL10                                                          
         B     DSANL20                                                          
*                                                                               
DSANL02  CLC   =C'SI',ACTKUNT                                                   
         BE    *+14                                                             
         CLC   =C'1N',ACTKUNT                                                   
         BNE   DSANL20                                                          
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DSANL20                        VALID TO SHOW AT THIS LV          
DSANL10  MVC   FVIFLD(L'AC@NA),AC@NA       (N/A) IS DEFAULT FOR SI              
         CLC   =C'1N',ACTKUNT                                                   
         BNE   *+10                                                             
         MVC   FVIFLD(L'AC@DPT),AC@DPT   DEPARTMENT IS DEFAULT FOR 1N           
         CLC   =C'1R',ACTKUNT                                                   
         BNE   *+10                                                             
         MVC   FVIFLD(L'AC@NFCP),AC@NFCP COST PROFILE IS DEFAULT FOR 1R         
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DSANL100                                                         
*                                                                               
DSANL20  CLC   =C'1N',ACTKUNT      FOR SE/1R CALL ROUTINE TO CHECK              
         BE    DSANL40             ALL LEVELS                                   
         CLC   =C'SI',ACTKUNT                                                   
         BNE   DSANL60                                                          
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DSANL30                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTCOSTG,C' '                                                    
         BE    DSANL30                                                          
         MVC   FVIFLD(L'RSTCOSTG),RSTCOSTG                                      
         OI    LEVELBIT,ACCTLV                                                  
         B     DSANL100                                                         
*                                                                               
DSANL30  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',ACTRECD),       *        
               (L'SPATYPE,=AL1(SPATANAL))                                       
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42 (NONE) IS THE DEFAULT FOR SI         
         B     DSANL100                                                         
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         MVC   FVIFLD(L'SPAAANAL),SPAAANAL                                      
         OI    LEVELBIT,ACCTLV                                                  
         B     DSANL100                                                         
*                                                                               
* 1N                                                                            
*                                                                               
DSANL40  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DSANL100                                                         
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTCOSTG,C' '                                                    
         BNE   DSANL50                                                          
         MVC   FVIFLD(L'AC@DPT),AC@DPT    'DEPARTMENT' IS DEFAULT               
         B     DSANL100                                                         
*                                                                               
DSANL50  OI    LEVELBIT,ACCTLV                                                  
         CLI   RSTCOSTG,C'C'                                                    
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@CORP),AC@CORP 'CORPORATE'                            
         B     DSANL100                                                         
         CLI   RSTCOSTG,C'O'                                                    
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@OFFC),AC@OFFC 'OFFICE'                               
         B     DSANL100                                                         
         CLI   RSTCOSTG,C'P'                                                    
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@PRSN),AC@PRSN  'PERSON'                              
         B     DSANL100                                                         
         CLI   RSTCOSTG,C'L'                                                    
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@NFA77),AC@NFA77 'LV OF ABSENCE'                      
         B     DSANL100                                                         
         MVC   FVIFLD(L'AC@DPT),AC@DPT   'DEPARTMENT'                           
         B     DSANL100                                                         
*                                                                               
DSANL60  BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DSANL100            YES SO DONE                                  
         CLC   =C'1R',ACTKUNT      FOR 1R THE DEFAULT IS "COST PROFILE"         
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@NFCP),AC@NFCP                                        
         B     DSANL100                                                         
*                                                                               
* NOW CHECK THE EXPENSE ANALYSIS FIELD (YYYNNNNNNNNN) ON THE LEDGER             
* REC.  DISPLAY AS MANY CHARACTERS AS I CAN BASED ON THE NUMBER OF              
* CHARACTERS IN THE SE ACCOUNT CODE.                                            
*                                                                               
         USING LDGELD,RF                                                        
         LA    RF,SVLDGEL          RF POINTS TO 14 ELEMENT                      
         SR    R4,R4                                                            
         ICM   R4,3,LDGXMSK        R4=EXPENSE CATEGORY MASK                     
         SLL   R4,16                                                            
         LA    R0,12                                                            
         LA    RE,ACTKACT          RE = EXPENSE ACCOUNT                         
         LA    R1,FVIFLD           R1 = OUTPUT FIELD                            
*                                                                               
DSANL70  LTR   R4,R4               TEST BIT ON                                  
         BNM   DSANL80             BRANCH IF OFF                                
         CLI   0(RE),C' '          MAKE SURE THIS PART OF THE ACCT IS           
         BNE   *+12                FILLED IN                                    
         MVI   0(R1),C'?'          IF NOT DISPLAY '?'                           
         B     *+10                                                             
         MVC   0(1,R1),0(RE)       MOVE ACCOUNT BYTE TO OUTPUT FIELD            
         LA    R1,1(R1)            BUMP UP TO NEXT BYTE IN OUTPUT FLD           
DSANL80  LA    RE,1(RE)            BUMP UP TO NEXT BYTE IN ACCT FIELD           
         SLL   R4,1                SETUP THE NEXT BIT                           
         BCT   R0,DSANL70          AND TEST IT                                  
         CLC   FVIFLD,BCSPACES     NOW CHECK IF ANYTHING IN OUTPUT              
         BE    *+12                                                             
         OI    LEVELBIT,LEDGLV     SET BIT THAT PROFILE SET AT LDGR             
         B     DSANL100                                                         
*                                                                               
DSANL90  MVC   FVIFLD(L'AC@NFA42),AC@NFA42  FOR SE '(NONE)' IS THE DFLT         
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         OI    LEVELBIT,LDGLVDEF                                                
*                                                                               
DSANL100 DS    0H                                                               
         NI    BYTE,X'FF'-CHK1R                                                 
         MVI   SBYTE,COSTPROF      MOVE IN COST ALLOCATION SEC #                
         CLC   =C'1R',ACTKUNT      FOR 1R ALSO CHECK IF LOWEST LEVEL            
         BNE   DSANL110            ENTERED BECAUSE MUST PROTECT IF SO           
         OI    BYTE,CHK1R                                                       
         B     DSANL120                                                         
DSANL110 CLC   =C'1N',ACTKUNT                                                   
         BE    DSANL120                                                         
         CLC   =C'SI',ACTKUNT                                                   
         BNE   *+12                                                             
         MVI   SBYTE,INCANAL       MOVE IN SI INCOME ANALYSIS SEC #             
         B     DSANL120                                                         
         MVI   SBYTE,EXPSEC        MOVE IN SE EXP SEC NUMBER                    
*                                                                               
DSANL120 BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         NI    BYTE,X'FF'-CHK1R                                                 
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ANALYSIS CODE                                              *         
* IF 1 BYTE STORED IN 30 ELEM.  >1 BYTE STORE IN 2C ELEMENT           *         
***********************************************************************         
         SPACE 1                                                                
VALANL   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE,X'FF'-OLDPROF                                               
*                                                                               
         BRAS  RE,VALSET           CHK IF SETTING HAS CHA                       
         BE    EXITOK                                                           
         MVI   SBYTE,COSTPROF      MOVE IN COST ALLOCATION SEC #                
         CLC   =C'1R',ACTKUNT                                                   
         BE    VANL20                                                           
         CLC   =C'1N',ACTKUNT                                                   
         BE    VANL20                                                           
         CLC   =C'SI',ACTKUNT                                                   
         BNE   *+12                                                             
         MVI   SBYTE,INCANAL       MOVE IN INCOME ANALYSIS SEC #                
         B     VANL20                                                           
         MVI   SBYTE,EXPSEC        ELSE MOVE IN SE EXPENSE SEC #                
VANL20   BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VANALX                        THIS PROFILE                       
*                                                                               
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1R'  FOR 1R ACCTS                
         BNE   VANL22                  ANALYSIS CANNOT BE SET AT                
         BRAS  RE,ANL1R                AT THE OFFICE LEVEL                      
         BNE   VANL23                                                           
         B     VANL25                                                           
*                                                                               
VANL22   CLC   =C'SI',ACTKUNT                                                   
         BE    *+14                                                             
         CLC   =C'1N',ACTKUNT                                                   
         BNE   VANL25                                                           
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VANL25                         VALID TO SHOW AT THIS LV          
VANL23   MVC   FVIFLD(L'AC@NFA42),AC@NFA42    (NONE) IS DEFAULT FOR SI          
         CLC   =C'1N',ACTKUNT                                                   
         BNE   *+10                                                             
         MVC   FVIFLD(L'AC@DPT),AC@DPT   DEPARTMENT IS DEFAULT FOR 1N           
         CLC   =C'1R',ACTKUNT                                                   
         BNE   *+10                                                             
         MVC   FVIFLD(L'AC@NFCP),AC@NFCP COST PROFILE IS DEFAULT FOR 1R         
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VANALX                                                           
*                                                                               
VANL25   TM    BYTE,OLDPROF         IF JUST CHECKING THE PROFILE                
         BO    VANL30              DON'T DELETE ANY ELEMENTS                    
*                                                                               
         CLC   =C'1R',ACTKUNT      FOR 1R/1N CAN'T BE STORED IN 2C SO           
         BE    VANL30              DON'T DELETE                                 
         CLC   =C'1N',ACTKUNT                                                   
         BE    VANL30                                                           
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('SPAELQ',ACTRECD),       *        
               (L'SPATYPE,=AL1(SPATANAL))        DELETE 2C ELEMENT              
*                                                                               
VANL30   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   RSTCOSTG,BCSPACES                                                
         CLI   FVILEN,0                                                         
         BE    VANALX                                                           
         CLC   =C'SE',ACTKUNT      FOR SE VALIDATE AGAINST 13 LEDGER            
         BNE   *+12                                                             
         BRAS  RE,VSEANAL                                                       
         BNE   EXITNV                                                           
         CLC   =C'SI',ACTKUNT      FOR SI 'NO' CANNOT BE A VALID ENTRY          
         BNE   VANL57A             SINCE THIS DELETED THE ANALYSIS IN           
         BRAS  RE,VSIANAL          VALIDATE 11&12 ACCT. ANY ERRORS ARE          
         BNE   EXITL               SET IN THIS ROUTINE.                         
         CLI   FVILEN,2                                                         
         BNE   VANL57A                                                          
         CLC   FVIFLD(L'AC@NO),AC@NO  THE FILE PROGRAM.                         
         BE    EXITNV                                                           
VANL57A  CLI   FVILEN,1                                                         
         BNH   VANL60                                                           
         CLC   =C'1R',ACTKUNT      FOR 1R CAN ONLY BE ONE BYTE                  
         BE    EXITNV                                                           
         CLC   =C'1N',ACTKUNT                                                   
         BE    VANL60              CAN ENTER >1 BUT CAN ONLY STORE 1 BT         
         B     VANL90                                                           
*                                                                               
VANL60   CLC   =C'1N',ACTKUNT      1N HAS IT'S OWN SET OF RULES                 
         BE    VANL70                                                           
         CLI   FVIFLD,C'('         ( IS OK                                      
         BE    VANL80                                                           
         CLI   FVIFLD,C')'         ) IS OK                                      
         BE    VANL80                                                           
         CLI   FVIFLD,C'A'         LOWER THAN A IS NOT OK                       
         BL    EXITNV                                                           
         CLI   FVIFLD,C'9'                                                      
         BH    EXITNV              HIGHER THAN 9 IS NOT OK                      
         CLC   =C'1R',ACTKUNT                                                   
         BNE   VANL80                                                           
         BRAS  RE,V1RANAL          VALIDATE 1R ANALYSIS AGAINST 14              
         BNE   EXITNV                                                           
         B     VANL80                                                           
*                                                                               
VANL70   ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@CORP      CORPORATE?                                
         BE    VANL80                                                           
         EXCLC R1,FVIFLD,AC@OFFC      OFFICE?                                   
         BE    VANL80                                                           
         EXCLC R1,FVIFLD,AC@DPT       DEPARTMENT?                               
         BE    VANL80                                                           
         EXCLC R1,FVIFLD,AC@PRSN      PERSON?                                   
         BE    VANL80                                                           
         EXCLC R1,FVIFLD,AC@NFA77     LV OF ABSENCE?                            
         BNE   EXITNV                                                           
*                                                                               
VANL80   MVC   RSTCOSTG,FVIFLD     STORE 1ST BYTE                               
         B     VANALX                                                           
*                                                                               
         USING SPAELD,RF                                                        
VANL90   LA    RF,BOELEM           BUILD SPAEL                                  
         XC    BOELEM,BOELEM                                                    
         MVI   SPAEL,SPAELQ                                                     
         MVI   SPALN,SPALNQ                                                     
         MVI   SPATYPE,SPATANAL                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,SPAAULA,FVIFLD                                                
         OC    SPAAULA,BCSPACES                                                 
                                                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SPAELD,0                      
VANALX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
*&&DO                                                                           
***********************************************************************         
* SEARCH ON ANALYSIS ACCOUNT                                          *         
***********************************************************************         
         SPACE 1                                                                
SRCANL   CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         CLI   ACTKUNT,C'S'        VALID FOR UNIT S (SE/SI) ONLY                
         BNE   EXITOK                                                           
         GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,0,ACOM,(0,0)                     
         B     EXITOK                                                           
         SPACE 2                                                                
*&&                                                                             
***********************************************************************         
* DISPLAY ANALYSIS FILTER                                                       
***********************************************************************         
         SPACE 1                                                                
DFANL    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         CLC   =C'1N',ACTKUNT      FOR 1N SPELL OUT THE WORD                    
         BE    DFANL100                                                         
DFANL80  MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
*                                                                               
DFANL100 CLI   FLTIFLD,C'C'                                                     
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@CORP2),AC@CORP2  CORP                                
         B     EXITOK                                                           
         CLI   FLTIFLD,C'O'                                                     
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@OFFC),AC@OFFC    OFFICE                              
         B     EXITOK                                                           
         CLI   FLTIFLD,C'D'                                                     
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@DPT2),AC@DPT2    DEPT                                
         B     EXITOK                                                           
         CLI   FLTIFLD,C'P'                                                     
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@PRSN),AC@PRSN    PERSON                              
         B     EXITOK                                                           
         CLI   FLTIFLD,C'L'                                                     
         BNE   EXITOK                                                           
         MVC   FVIFLD(L'AC@LOA),AC@LOA      LOA                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ANALYSIS FILTER                                                      
***********************************************************************         
         SPACE 1                                                                
VFANL    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#ANALSE)   IF 'DIRECT EXPENSE ACCOUNT' PROF         
         BNE   *+18                                                             
         CLC   =C'SE',ACTKUNT          MAKE SURE SE ACCOUNT                     
         BE    VFANL40                                                          
         B     ERRFILT                                                          
         CLM   R1,3,=AL2(ACC#ANAL1R)   IF 'DIRECT LABOR ACCOUNT' PROF           
         BNE   *+18                                                             
         CLC   =C'1R',ACTKUNT          MAKE SURE 1R ACCOUNT                     
         BE    VFANL40                                                          
         B     ERRFILT                                                          
         CLM   R1,3,=AL2(ACC#ANALSI)   IF 'BILL/REV ACCOUNT' PROF               
         BNE   *+18                                                             
         CLC   =C'SI',ACTKUNT          MAKE SURE SI ACCOUNT                     
         BE    VFANL40                                                          
         B     ERRFILT                                                          
         CLC   =C'1N',ACTKUNT         MUST BE 'INDIRECT TIME TYPE' PROF         
         BNE   ERRFILT                SO MAKE SURE 1N ACCOUNT                   
*                                                                               
VFANL40  CLC   FVIFLD(L'AC@NTAVL),AC@NTAVL  'N/A' IS NOT VALID                  
         BE    EXITNV                                                           
         MVC   FLTIFLD,BCSPACES                                                 
         CLC   =C'1N',ACTKUNT                                                   
         BNE   VFANL45                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@DPT    DEPARMENT?                                   
         BE    VFANL80                                                          
         EXCLC R1,FVIFLD,AC@DPT2   DEPT?                                        
         BE    VFANL80                                                          
         EXCLC R1,FVIFLD,AC@CORP   CORPORATE?                                   
         BE    VFANL80                                                          
         EXCLC R1,FVIFLD,AC@OFFC   OFFICE?                                      
         BE    VFANL80                                                          
         EXCLC R1,FVIFLD,AC@PRSN   PERSON?                                      
         BE    VFANL80                                                          
         EXCLC R1,FVIFLD,AC@NFA91  LV OF ABSENCE?                               
         BE    VFANL80                                                          
         EXCLC R1,FVIFLD,AC@LOA    LOA?                                         
         BE    VFANL80                                                          
         B     EXITNV                                                           
*                                                                               
VFANL45  CLC   =C'1R',ACTKUNT      FOR 1R                                       
         BNE   VFANL50                                                          
         CLC   FVIFLD(2),AC@NFA93  COST PROFILE                                 
         BNE   VFANL50                                                          
         MVC   FLTIFLD(L'AC@NFA92),AC@NFA93                                     
         B     EXITOK                                                           
*                                                                               
VFANL50  CLC   FVIFLD(L'AC@NONE),AC@NONE   NONE?                                
         BNE   VFANL60                                                          
         CLC   =C'1R',ACTKUNT      NONE IS ONLY VALID FOR SE AND SI             
         BE    EXITNV                                                           
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
VFANL60  CLI   FVILEN,1                                                         
         BH    VFANL80                                                          
         CLI   FVIFLD,C'('         ( IS OK                                      
         BE    VFANL80                                                          
         CLI   FVIFLD,C')'         ) IS OK                                      
         BE    VFANL80                                                          
         CLI   FVIFLD,C'A'         LOWER THAN A IS NOT OK                       
         BL    EXITNV                                                           
         CLI   FVIFLD,C'9'                                                      
         BH    EXITNV              HIGHER THAN 9 IS NOT OK                      
*                                                                               
VFANL80  ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ANALYSIS CODE                                       *         
***********************************************************************         
         SPACE 1                                                                
DOFANL   NI    BYTE,X'FF'-NOANALYS                                              
         CLC   =C'11',ACTKUNT      FOR 1N AND SI CAN ONLY BE SET AT THE         
         BE    EXITNV                                                           
         CLC   =C'1N',ACTKUNT      FOR 1N AND SI CAN ONLY BE SET AT THE         
         BE    *+14                LOWEST LEVEL SO DO OWN FILTER CHECK          
         CLC   =C'SI',ACTKUNT                                                   
         BNE   DOFANL50                                                         
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCOUNT SKIP IT B/C            
         BNE   FLTXL               THIS PROFILE IS N/A AT HIGHER LVL            
*                                                                               
* 1N AND SI *                                                                   
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+18                                                             
         CLC   =C'1N',ACTKUNT      NO ELEM AND 1N?  THAN DON'T SHOW             
         BE    FLTXL               BUT FOR SI CAN LOOK IN 2C ELEM               
         B     DOFANL20                                                         
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTCOSTG,C' '       ANALYSIS FOUND?                              
         BNE   DOFANL10                                                         
         CLC   =C'SI',ACTKUNT      NO ANALYSIS FOUND SO FOR SI LOOK FOR         
         BNE   *+12                2C ELEMENT                                   
         OI    BYTE,NOANALYS                                                    
         B     DOFANL20                                                         
         CLI   FLTIFLD,C'D'        FOR 1N DEPT IS DEFAULT SO SHOW ACCT          
         BE    FLTXE               FOR DEPT FILTER                              
         B     FLTXL                                                            
*                                                                               
DOFANL10 CLC   =C'1N',ACTKUNT                                                   
         BE    *+12                                                             
         CLI   FLTIFLD+1,C' '      IF FILTERING ON MORE THAN 1 BYTE             
         BH    FLTXL               THAN DON'T BOTHER LOOKING IN 30 ELEM         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  IF FILTERING ON NONE THAN            
         BE    FLTXL               SKIP THIS ACCT                               
         CLC   RSTCOSTG,FLTIFLD    MATCH ON ANALYSIS?                           
         BE    FLTXE               YES                                          
         CLC   =C'SI',ACTKUNT      NO - FOR SI LOOK IN 2C                       
         BNE   FLTXL               NO - FOR 1N DON'T SHOW ACCT                  
*                                                                               
DOFANL20 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',ACTRECD),       *        
               (L'SPATYPE,=AL1(SPATANAL))                                       
          CLI  12(R1),0                                                         
          BE   DOFANL22                                                         
          CLC  FLTIFLD(L'AC@NONE),AC@NONE  NO 2C ELEM FOUND-IF FLTERING         
          BNE  FLTXL                       ON 'NONE' MAKE SURE THERE IS         
          TM   BYTE,NOANALYS               NO ANALYSIS FOUND IN 30 ELEM         
          BO   FLTXE                                                            
          B    FLTXL                                                            
*                                                                               
DOFANL22  L     RF,12(R1)                                                       
          USING SPAELD,RF                                                       
          OC    SPAAULA,SPAAULA                                                 
          BNZ   DOFANL25                 IF NO INCOME ACCT FOUND                
          CLC   FLTIFLD(L'AC@NONE),AC@NONE AND FILTERING ON 'NONE'              
          BE    FLTXE                      THAN SHOW THIS ACCOUNT               
          B     FLTXL                                                           
*                                                                               
DOFANL25  CLC   FLTIFLD(L'AC@NONE),AC@NONE  IF FILTERING ON NONE THAN           
          BE    FLTXL               SKIP THIS ACCT                              
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
          LA    R1,14               MAX INPUT LENGTH                            
          LA    RE,FLTIFLD+L'SPAAULA-1   POINT TO LAST CHARACTE                 
DOFANL30  CLI   0(RE),C' '               AND CHECK HOW MANY BYT                 
          BNE   DOFANL35                 VALIDATE                               
          BCTR  RE,0                                                            
          BCT   R1,DOFANL30                                                     
          B     FLTXL                                                           
*                                                                               
DOFANL35  BCTR  R1,0                                                            
          EXCLC R1,SPAAANAL,FLTIFLD                                             
          BE   FLTXE                                                            
          BH   FLTXH                                                            
          B    FLTXL                                                            
*                                                                               
* SE AND 1R *                                                                   
DOFANL50 CLC   =C'SE',ACTKUNT      IF NOT SE OR 1R IGNORE                       
         BE    *+14                                                             
         CLC   =C'1R',ACTKUNT                                                   
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR NUMBER= PROFILE (TAX ID OR SS#)                     *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                     *         
* NUMBER= - TAX ID NUMBER (2C)                                        *         
* NUMBER= - TAX ID NUMBER (PAYABLE LEDGERS FOR JWT ONLY)              *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
NUMBER   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,OTHNTABL                                                      
         B     ITER                                                             
*                                                                               
OTHNTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISNUM)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISNUM)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALNUM)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFNUM)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFNUM)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFNUM)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY NUMBER= PROFILE (TAX ID OR SS#)                             *         
***********************************************************************         
         SPACE 1                                                                
DISNUM   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         MVC   TAXIDTY,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISNUM10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISNUMX                                                          
*                                                                               
DISNUM10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISNUM20            NO ELEM FOUND SHOW DEFAULT                   
         L     R3,12(R1)                                                        
         USING OTHELD,R3                                                        
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
         CLC   OTHNUM,BCSPACES                                                  
         BNH   DISNUM20            NO NUMBER SO SHOW DEFAULT                    
         MVC   FVIFLD(L'OTHNUM),OTHNUM                                          
         TM    CUSTAT,CUSDDS       IS THIS A DDS TERMINAL?                      
         BZ    DISNUM15                                                         
         LA    RE,9                MAX LENGTH OF EIN/SSN #                      
         STC   RE,BCBYTE1                                                       
         BRAS  RE,HIDE             ENCRYPT THE FIELD WITH *'S                   
*                                                                               
DISNUM15 OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
         CLI   CUCTRY,CTRYCAN      CANADA HAS DIFFERENT TAX TYPES               
         BNE   DISNUM18                                                         
         CLI   OTHPROF,C'I'                                                     
         BNE   *+14                                                             
         MVC   TAXIDTY(L'AC@BN),AC@BN       BN                                  
         B     DISNUMX                                                          
         MVC   TAXIDTY(L'AC@SIN),AC@SIN     SIN                                 
         B     DISNUMX                                                          
*                                                                               
DISNUM18 CLI   OTHPROF,C'I'        IF OTHPROF=I THAT REPRESENTS EIN #           
         BNE   *+14                                                             
         MVC   TAXIDTY(L'AC@NFA65),AC@NFA65    EIN                              
         B     DISNUMX                                                          
         MVC   TAXIDTY(L'AC@NFA64),AC@NFA64    SSN                              
         B     DISNUMX                                                          
*                                                                               
DISNUM20 MVC   FVIFLD(L'AC@NFA42),AC@NFA42  '(NONE)' IS THE DEFAULT             
*                                                                               
DISNUMX  MVI   SBYTE,V1099         MOVE IN 1099 VENDOR SEC #                    
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  R3                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE NUMBER= PROFILE (TAX ID OR SS #)                           *         
***********************************************************************         
         SPACE 1                                                                
VALNUM   NI    FVATRB,X'FF'-FVAPROT                                             
         USING CPYELD,RF                                                        
         LA    RF,SVCPYEL                                                       
         TM    CPYSTATA,CPYAUT2C   COMPANY AUTO 2C UPDATE?                      
         BZ    VALNUM4             NO THAN DON'T CHECK THE TAX PROFS            
         CLC   =C'SV',ACTKUNT      ONLY DO THIS CHECK FOR SV,SX,SY              
         BE    VALNUM2                                                          
         CLC   =C'SX',ACTKUNT                                                   
         BE    VALNUM2                                                          
         CLC   =C'SY',ACTKUNT                                                   
         BNE   VALNUM4                                                          
VALNUM2  TM    BYTE2,PROF1099      IS THE 1099 PROFILE SET TO YES?              
         BZ    VALNUM4             NO                                           
         CLI   FVILEN,0            YES SO THERE MUST BE A # ENTERED             
         BE    EXITNO                                                           
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NFA42                                               
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$TAXST) MUST ENTER TAX ID AT SAME TIME            
         B     EXITL                  AS 1099 VENDOR                            
*                                                                               
VALNUM4  CLC   FVIFLD(5),=C'*****' IF *'S THAN USER DIDN'T CHANGE               
         BE    EXITOK              THIS FIELD SO DON'T VALIDATE                 
         MVC   SVTXNUM,BCSPACES                                                 
         BRAS  RE,VALSET                         EVEN IF THERE IS NO            
         BNE   *+14                              CHANGE VALIDATE IF A           
         CLC   FVIFLD(L'AC@NFA42),AC@NFA42       NUMBER EXISTS BECAUSE          
         BE    EXITOK                            OF THE TYPE FIELD              
*                                                                               
         MVI   SBYTE,V1099         MOVE IN 1099 VENDOR SEC #                    
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALNUMX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALNUM5                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALNUMX                                                          
*                                                                               
VALNUM5  MVC   BOWORK2(L'OTHPROF),BCSPACES                                      
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VALNUM10            NO OTHEL                                     
         L     R3,12(R1)                                                        
         USING OTHELD,R3                                                        
         MVC   BOWORK2(L'OTHPROF),OTHPROF    SAVE OTHER FIELD                   
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('OTHELQ',ACTRECD),0               
*                                                                               
VALNUM10 CLI   FVILEN,0                                                         
         BE    VALNUMX                                                          
         CLI   FVILEN,9            MUST BE A NINE BYTE EIN/SS #                 
         BNE   EXITNV                                                           
**                                                                              
         ZIC   R1,FVILEN           MAKE SURE INPUT IS NUMERIC                   
         LA    RF,FVIFLD           * CAN'T RELY ON THE FVINUM BIT!              
VALNUM20 CLI   0(RF),C'0'                                                       
         BL    EXITNV                                                           
         CLI   0(RF),C'9'                                                       
         BH    EXITNV                                                           
         LA    RF,1(RF)                                                         
         BCT   R1,VALNUM20                                                      
*                                                                               
         MVC   SVTXNUM,FVIFLD                                                   
*                                                                               
         LA    R3,BOWORK1          BUILD DUMMY OTHEL                            
         USING OTHELD,R3                                                        
         MVI   OTHEL,OTHELQ                                                     
         MVI   OTHLN,OTHLN1Q                                                    
         MVC   OTHPROF,BOWORK2     SAVED PROFILE VALUE                          
         MVC   OTHNUM,BCSPACES                                                  
         MVC   OTHNUM(9),FVIFLD                                                 
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),OTHELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
VALNUMX  DS    0H                                                               
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
***********************************************************************         
* DISPLAY TAX ID/SS NUMBER FILTER                                     *         
***********************************************************************         
         SPACE 1                                                                
DFNUM    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE TAX ID/SS NUMBER FILTER                                    *         
***********************************************************************         
         SPACE 1                                                                
VFNUM    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         BRAS  RE,TXVFLT           VALIDATE FILTER VALID FOR THIS LDGR          
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NONE   NONE                                         
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         CLI   FVILEN,9            IF NOT 'NONE' MUST BE 9 DIGIT NUMBER         
         BNE   EXITNV                                                           
         ZIC   R1,FVILEN           MAKE SURE INPUT IS NUMERIC                   
         LA    RF,FVIFLD           * CAN'T RELY ON THE FVINUM BIT!              
VFNUM10  CLI   0(RF),C'0'                                                       
         BL    EXITNV                                                           
         CLI   0(RF),C'9'                                                       
         BH    EXITNV                                                           
         LA    RF,1(RF)                                                         
         BCT   R1,VFNUM10                                                       
*                                                                               
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON TAX ID/SS NUMBER                                    *         
* N/A AT HIGHER LEVELS SO ALWAYS SKIP THOSE ACCOUNTS                  *         
***********************************************************************         
         SPACE 1                                                                
DOFNUM   MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT SKIP IT SINCE             
         BNE   FLTXL               N/A AT HIGHER LEVELS                         
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DOFNUM50            NO ELEMENT FOUND                             
*                                                                               
         L     RF,12(R1)                                                        
         USING OTHELD,RF                                                        
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON 'NONE'?                  
         BNE   DOFNUM10                                                         
         CLC   OTHNUM,BCSPACES     ANY TAX ID/SS NUMBER?                        
         BE    FLTXE               NO - EQUAL                                   
         B     FLTXL               YES - NOT EQUAL                              
*                                                                               
DOFNUM10 MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          NOT VALID FOR HIGH LEVEL ACCOUNTS            
         BNE   FLTXL                                                            
         CLC   OTHNUM,FLTIFLD                                                   
         BE    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFNUM50 CLC   FLTIFLD(L'AC@NONE),AC@NONE  IF GET HERE NO ELEM FOUND OR         
         BE    FLTXE                       NO # SO ONLY 'NONE' IS VALID         
         B     FLTXL                                                            
*                                                                               
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR TAX TYPE (EITHER SSN OR EIN)                        *         
* TAX ID TYPE PROFILE                                                 *         
* NOTE:  INFORMATIONAL ONLY-NOT AN ACTUAL PROFILE                     *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
TXTYPE   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,TXTYPTBL                                                      
         B     ITER                                                             
*                                                                               
TXTYPTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DISTY)                                  
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISTY)  *FOR REPORT                    
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALTY)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFTY)                                  
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFTY)                                  
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFTY)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY TAX TYPE                                                    *         
***********************************************************************         
         SPACE 1                                                                
DISTY    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISTY10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISTYX                                                           
*                                                                               
DISTY10  CLI   CSACT,A#LST         FOR ACTION LIST TAXIDTY MAY NOT BE           
         BE    DISTY50             FILLED IN DUE TO COLUMN SWITCHING            
*                                  SO READ DIRECTLY FROM ELEMENT                
         CLI   CSACT,A#REPT        (AND REPORT/DOWLNLOAD TOO)                   
         BE    DISTY50                                                          
         CLI   CSACT,A#DLOAD                                                    
         BE    DISTY50                                                          
         CLC   TAXIDTY,BCSPACES    IF SPACES THAN NO TAX ID NUMBER              
         BNE   *+14                SO DISPLAY (N/A) IN THIS FIELD               
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42 DEFAULT IS (NONE)                    
         B     DISTYX                                                           
         MVC   FVIFLD(L'TAXIDTY),TAXIDTY    ELSE MOVE IN THE TAX TYPE           
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCOUNT LEVEL                  
         B     DISTYX                                                           
*                                                                               
DISTY50  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42   NO ELEM MEANS NO TAX #             
         B     DISTYX                                                           
         L     RF,12(R1)                                                        
         USING OTHELD,RF                                                        
         CLC   OTHNUM,BCSPACES                                                  
         BNH   DISTY60             NO NUMBER SO SHOW DEFAULT                    
         CLI   CUCTRY,CTRYCAN      CANADA HAS DIFFERENT TAX TYPES               
         BNE   DISTY55                                                          
         CLI   OTHPROF,C'I'                                                     
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@BN),AC@BN       BN                                   
         B     DISTYX                                                           
         MVC   FVIFLD(L'AC@SIN),AC@SIN     SIN                                  
         B     DISTYX                                                           
*                                                                               
DISTY55  CLI   OTHPROF,C'I'                                                     
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@NFA65),AC@NFA65 EIN                                  
         B     DISTYX                                                           
         MVC   FVIFLD(L'AC@NFA64),AC@NFA64 SSN                                  
         B     DISTYX                                                           
*                                                                               
DISTY60  MVC   FVIFLD(L'AC@NFA42),AC@NFA42   '(NONE)'                           
*                                                                               
DISTYX   MVI   SBYTE,V1099         MOVE IN 1099 VENDOR SEC #                    
         BRAS  RE,CHKSEC                                                        
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE TABLE SETTINGS          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE TAX TYPE (CAN ONLY ENTER A TAX TYPE IF A TAX ID NUMBER *         
* HAS BEEN ENTERED.                                                   *         
***********************************************************************         
         SPACE 1                                                                
VALTY    MVC   BOWORK2,BCSPACES                                                 
         MVI   TAXIND,C'S'                                                      
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VALTY40             NO ELEMENT MEANS NO TAX NUMBER               
*                                                                               
         L     R3,12(R1)                                                        
         USING OTHELD,R3                                                        
         CLC   OTHNUM,BCSPACES     ANY TAX NUMBER ENTERED?                      
         BE    VALTY40             NO SO PROTECT AND XIT                        
*                                                                               
         ZIC   R1,FVXLEN                                                        
         CLI   CUCTRY,CTRYCAN      CANADA HAS DIFFERENT TAX TYPES               
         BNE   VALTY10                                                          
         EXCLC R1,FVIFLD,AC@SIN             SIN                                 
         BE    VALTY30                                                          
         EXCLC R1,FVIFLD,AC@BN              BN                                  
         BE    VALTY15                                                          
         MVC   FVMSGNO,=AL2(AE$TXTYP)       MUST ENTER A TYPE                   
         B     EXITL                                                            
*                                                                               
VALTY10  EXCLC R1,FVIFLD,AC@NFA64           SSN                                 
         BE    VALTY30                                                          
         EXCLC R1,FVIFLD,AC@NFA65           EIN                                 
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$TXTYP)       MUST ENTER A TYPE                   
         B     EXITL                                                            
VALTY15  MVI   TAXIND,C'E'                  INDICATE EIN/BN NUMBER              
*                                                                               
VALTY30  MVC   BOWORK2(L'OTHNUM),OTHNUM                                         
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('OTHELQ',ACTRECD),0               
*                                                                               
         LA    R3,BOWORK1                                                       
         USING OTHELD,R3                                                        
         MVC   BOWORK1,BCSPACES                                                 
         MVI   OTHEL,OTHELQ                                                     
         MVI   OTHLN,OTHLN1Q                                                    
         MVC   OTHNUM,BOWORK2      SAVED NUMBER VALUE                           
         CLI   TAXIND,C'E'         ENTERED EIN(US)/BN(CANADA)?                  
         BNE   *+8                                                              
         MVI   OTHPROF,C'I'        YES THAN SAVE THAT INFO                      
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),OTHELD,0                      
         CLI   12(R1),0                                                         
         BE    VALTYX                                                           
         DC    H'0'                                                             
*                                                                               
VALTY40  MVC   FVIFLD(L'AC@NA),AC@NA   NO     SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALTYX                                                           
*                                                                               
VALTYX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B      EXITOK                                                          
         DROP   R3                                                              
         SPACE 2                                                                
***********************************************************************         
* DISPLAY TAX TYPE FILTER                                             *         
***********************************************************************         
         SPACE 1                                                                
DFTY     CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE TAX TYPE FILTER                                            *         
***********************************************************************         
         SPACE 1                                                                
VFTY     CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         BRAS  RE,TXVFLT           VALIDATE THAT LDGR IS VALID                  
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         CLI   CUCTRY,CTRYCAN      CANADA HAS DIFFERENT TAX TYPES               
         BNE   VFTY10                                                           
         EXCLC R1,FVIFLD,AC@SIN    SIN                                          
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@SIN),AC@SIN                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@BN     BN                                           
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@BN),AC@BN                                           
         B     EXITOK                                                           
*                                                                               
VFTY10   EXCLC R1,FVIFLD,AC@NFA64  SSN                                          
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA64),AC@NFA64                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@NFA65  EIN                                          
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@NFA65),AC@NFA65                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON TAX TYPE                                            *         
* N/A AT HIGHER LEVELS SO ALWAYS SKIP THOSE ACCOUNTS                  *         
***********************************************************************         
         SPACE 1                                                                
DOFTY    MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          THIS IS ONLY VALID FOR LOW LEVEL             
         BNE   FLTXL               ACCOUNTS                                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   FLTXL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING OTHELD,RF                                                        
         CLC   OTHNUM,BCSPACES     IF NO TAX NUMBER THAN NO TYPE                
         BE    FLTXL               TO FILTER ON.                                
*                                                                               
         CLI   FLTIFLD,C'S'        FILTERING ON SSN (US) OR SIN (CA)?           
         BNE   DOFTY10                                                          
         CLI   OTHPROF,C'I'        I=EIN OR BN                                  
         BNE   FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFTY10  CLI   OTHPROF,C'I'        I=EIN OR BN                                  
         BE    FLTXE                                                            
         B     FLTXL                                                            
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR OTHPROF                                             *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PROFILE  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PROFTABL                                                      
         B     ITER                                                             
*                                                                               
PROFTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISPRO)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISPRO)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALPRO)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY OTHPROF                                                     *         
***********************************************************************         
         SPACE 1                                                                
DISPRO   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         L     RF,12(R1)                                                        
         USING OTHELD,RF                                                        
         CLC   OTHPROF,BCSPACES                                                 
         BNH   EXITOK                                                           
         MVC   FVIFLD(L'OTHPROF),OTHPROF                                        
         B     EXITOK                                                           
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE OTHPROF                                                    *         
***********************************************************************         
         SPACE 1                                                                
VALPRO   MVC   BOWORK2(L'OTHNUM),BCSPACES                                       
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VPROF02             NO OTHEL                                     
         L     RF,12(R1)                                                        
         USING OTHELD,RF                                                        
         MVC   BOWORK2(L'OTHNUM),OTHNUM                                         
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('OTHELQ',ACTRECD),0               
         DROP  RF                                                               
*                                                                               
VPROF02  LA    R3,BOWORK1          BUILD DUMMY OTHEL                            
         USING OTHELD,R3                                                        
         MVI   OTHEL,OTHELQ                                                     
         MVI   OTHLN,OTHLN1Q                                                    
         MVC   OTHNUM,BOWORK2      SAVED NUMBER VALUE                           
         MVC   OTHPROF,BCSPACES                                                 
         CLI   FVILEN,0                                                         
         BE    VPROF04                                                          
         MVC   OTHPROF,FVIFLD      GET PROFILE                                  
*                                                                               
VPROF04  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),OTHELD,0                      
         CLI   12(R1),0                                                         
         BE    EXITOK                                                           
         DC    H'0'                                                             
         DROP  R3                                                               
*                                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR GLPACC1 - NOT VALID FOR UNIT F                      *         
* GENERAL= - GL ACCT (UNIT 'S' LEDGERS)                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
GENERAL  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,GLPATABL                                                      
         B     ITER                                                             
*                                                                               
GLPATABL DC    AL1(DDIS),AL1(0,0,0),AL4(DSGEN)                                  
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSGEN)    *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALGEN)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCGEN)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFGEN)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFGEN)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFGEN)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY GLPACC1                                                     *         
* 1) LOOK IN ACCT LEVEL ENTERED.                                      *         
* 2) LOOK IN HIGHER LEVEL ACCT.                                       *         
* 3) LOOK IN LEDGER RECORD FOR ANY OVERRIDES (NNN=)                   *         
* 4) LOOK IN LEDGER RECORD FOR DEFAULT ACCT. (DEFAULT=)               *         
* 5) DISPLAY 'NONE' IF DON'T FIND ANY G/L ACCOUNT AT ANY LEVEL        *         
* NOTE:  IF USING A WILDCARD TO DETERMINE THE G/L ACCOUNT I CANNOT    *         
*        DETERMINE WHAT THE OFFICE WILL BE SO I DISPLAY THE ACCOUNT   *         
*        WITH THE WILDCARD BUT HERE IS THE HIERARCHY THE A25 USES:    *         
* 1) LOOK IN GLRULES IF 'USE G/L OFFICE RULES' PROFILE IS SET TO YES  *         
* 2) LOOK IN LEDGER RECORD FOR OFFPOS=                                *         
* 3) DEFAULT:  USE OFFICE OF THE SUBSIDIARY TRANSACTION               *         
***********************************************************************         
         SPACE 1                                                                
DSGEN    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DSGENX              YES SO DONE                                  
*                                                                               
* NOW CHECK TO SEE IF PROFILE IS SET AT THE LEDGER LEVEL                        
*                                                                               
* AIO6 HOLDS THE LEDGER RECORD UNLESS YOU JUST CAME BACK FROM THE               
* COLUMN/LIST SCREEN OR THE FILTER/LIST SCREEN.  IN THAT CASE YOU NEED          
* TO READ THE LEDGER RECORD AGAIN.                                              
         USING LDGRECD,R3                                                       
         L     R3,AIO6                                                          
         CLC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),GSRECKEY+1                          
         BE    *+8                                                              
         BRAS  RE,RDLDG                                                         
         LA    R4,LDGRECD+(LDGRFST-LDGRECD)                                     
DSGEN60  CLI   0(R4),0                                                          
         BE    DSGEN85                                                          
         CLI   0(R4),X'15'         GL POSTING ELEMENT                           
         BE    DSGEN65                                                          
DSGEN62  ZIC   R1,1(R4)                                                         
         AR    R4,R1                                                            
         B     DSGEN60                                                          
*                                                                               
         USING GLPELD,R4                                                        
DSGEN65  CLC   GLPSUB,BCSPACES     ACC FILTER?                                  
         BE    DSGEN80             NO THIS MUST BE THE DEFAULT                  
         LA    R1,10               FILTER HAS MAX OF 10 BYTES                   
         SR    RF,RF                                                            
         LA    RE,GLPSUB                                                        
DSGEN70  CLI   0(RE),C' '          SEE HOW MANY BYTES ARE USED                  
         BE    DSGEN75                                                          
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)            KEEP TRACK OF # OF BYTES                     
         BCT   R1,DSGEN70                                                       
*                                                                               
DSGEN75  BCTR  RF,0                                                             
         EXCLC RF,GLPSUB,ACTKACT   SAME ACCOUNT?                                
         BNE   DSGEN62             NO SO CHECK FOR OTHER ELEMENTS               
DSGEN80  MVC   FVIFLD(L'GLPACC1),GLPACC1                                        
         OI    LEVELBIT,LEDGLV                                                  
         B     DSGEN62             CHECK FOR ACCT SPECIFIC OVERRIDES            
*                                                                               
DSGEN85  CLC   FVIFLD,BCSPACES     DID WE FIND ANY GL ACCOUNT?                  
         BNE   DSGENX              YES                                          
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42  NO SET DEFAULT                      
*                                                                               
DSGENX   MVI   SBYTE,GLSEC         MOVE IN G/L SECURITY NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R4                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE GLPACC1                                                    *         
***********************************************************************         
         SPACE 1                                                                
VALGEN   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,GLSEC         MOVE IN G/L SECURITY NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALGENX                                                          
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('GLPELQ',ACTRECD),0               
*                                                                               
         CLI   FVILEN,0                                                         
         BE    VALGENX             NO INPUT INTO FIELD                          
*                                                                               
         CLI   FVIFLD,C'G'         UNIT G ONLY                                  
         BNE   EXITNV                                                           
         CLI   FVIFLD+1,C'B'       LEDGER B OR                                  
         BE    *+12                                                             
         CLI   FVIFLD+1,C'P'       OR P ONLY                                    
         BNE   EXITNV                                                           
*                                                                               
         LA    R3,IOKEY            BUILD RECORD KEY                             
TEMP     USING ACTRECD,R3                                                       
         MVC   TEMP.ACTKCPY,CUABIN                                              
         MVC   TEMP.ACTKULA,FVIFLD                                              
         LA    RF,TEMP.ACTKACT                                                  
         LA    RE,L'ACTKACT                                                     
         DROP  TEMP                                                             
         CLI   0(RF),C'*'          WAS A * INPUT?                               
         BE    VGLPA02                                                          
         LA    RF,1(RF)                                                         
         BCT   RE,*-12                                                          
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         B     EXITL                                                            
*                                                                               
         LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                UNABLE TO 'GET' THE RECORD                   
         L     RF,AIO2                                                          
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',(RF)),0                  
         CLI   12(R1),0                                                         
         BE    VGLPA04             MUST BE LOW LEVEL ACCOUNT                    
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         B     EXITL                                                            
*                                                                               
         USING CPYELD,R1                                                        
VGLPA02  LA    R1,SVCPYEL                                                       
         TM    CPYSTAT4,X'01'      NEW OFFICES?                                 
         BO    EXITNV              THAN WILDCARDS NOT VALID                     
         MVI   0(RF),C' '          CLEAR THE * IN THE KEY                       
         SR    RF,R3               GET LENGTH TO COMPARE ON                     
         LR    R3,RF               SAVE IT                                      
         LHI   R1,XOHI+XOACCDIR+XIO2                                            
         GOTO1 AIO                                                              
         BCTR  R3,0                                                             
         EX    R3,*+8                                                           
         BE    VGLPA04             WAS IT THE SAME AS BEFORE?                   
         CLC   IOKEY(0),IOKEYSAV                                                
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         B     EXITL                                                            
         DROP  R1                                                               
*                                                                               
VGLPA04  LA    R3,BOWORK1                                                       
         USING GLPELD,R3                                                        
         MVI   GLPEL,GLPELQ                                                     
         MVI   GLPLN,GLPLN1Q                                                    
         MVC   GLPSUB,FVIFLD       STORE IN BOTH PLACES                         
         MVC   GLPACC1,FVIFLD                                                   
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),GLPELD,0                      
         CLI   12(R1),0                                                         
         BE    VALGENX                                                          
         DC    H'0'                                                             
*                                                                               
VALGENX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
*                                                                               
         SPACE 2                                                                
***********************************************************************         
* SEARCH ON GENERAL ACCOUNT                                           *         
***********************************************************************         
         SPACE 1                                                                
SRCGEN   CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,0,ACOM,(0,0)                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY GENERAL ACCOUNT FILTER                                                
***********************************************************************         
         SPACE 1                                                                
DFGEN    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE GENERAL ACCOUNT FILTER                                               
***********************************************************************         
         SPACE 1                                                                
VFGEN    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLI   ACTKUNT,C'S'        FILTER IS ONLY FOR UNIT S                    
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NONE                                                
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         CLC   =C'GB',FVIFLD       ONLY GB/GP IS VALID                          
         BE    *+14                                                             
         CLC   =C'GP',FVIFLD                                                    
         BNE   EXITNV                                                           
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON GENERAL ACCOUNT CODE                                *         
***********************************************************************         
         SPACE 1                                                                
DOFGEN   CLI   ACTKUNT,C'S'        ONLY VALID FOR UNIT S                        
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,0           0 = NO GL ACCT FOUND AT ACCT LEVELS           
         BE    DOFGEN5            SO CHECK LEDGER                               
         CLI   FILTEQ,C'E'        ACCT PASSED FILTER TEST?                      
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
*                                                                               
* NOW CHECK LEDGER LEVEL TO SEE IF GL ACCT TO FILTER ON                         
DOFGEN5  DS    0H                                                               
*        MVC   IOKEY,SVKEY            RESET ORIGINAL KEY AND READ               
*        LHI   R1,XOREAD+XOACCDIR+XIO1  AGAIN BECAUSE OF LEDGER REC             
*        GOTO1 AIO                      READ                                    
*                                                                               
* AIO6 HOLDS THE LEDGER RECORD UNLESS YOU JUST CAME BACK FROM THE               
* COLUMN/LIST SCREEN OR THE FILTER/LIST SCREEN.  IN THAT CASE YOU NEED          
* TO READ THE LEDGER RECORD AGAIN.                                              
         USING LDGRECD,R3                                                       
         L     R3,AIO6                                                          
         CLC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),GSRECKEY+1                          
         BE    *+8                                                              
         BRAS  RE,RDLDG                                                         
         LA    R4,LDGRECD+(LDGRFST-LDGRECD)                                     
DFGEN10  CLI   0(R4),0                                                          
         BE    DOFGENLX            NOTHING TO FILTER ON                         
         CLI   0(R4),X'15'         GL POSTING ELEMENT                           
         BE    DFGEN30                                                          
DFGEN20  ZIC   R1,1(R4)                                                         
         AR    R4,R1                                                            
         B     DFGEN10                                                          
*                                                                               
         USING GLPELD,R4                                                        
DFGEN30  CLC   GLPSUB,BCSPACES     ACC FILTER?                                  
         BE    DFGEN60             NO THIS MUST BE THE DEFAULT                  
         LA    R1,10               FILTER HAS MAX OF 10 BYTES                   
         SR    RF,RF                                                            
         LA    RE,GLPSUB                                                        
DFGEN40  CLI   0(RE),C' '          SEE HOW MANY BYTES ARE USED                  
         BE    DFGEN50                                                          
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)            KEEP TRACK OF # OF BYTES                     
         BCT   R1,DFGEN40                                                       
*                                                                               
DFGEN50  BCTR  RF,0                                                             
         EXCLC RF,GLPSUB,ACTKACT   SAME ACCOUNT?                                
         BNE   DFGEN20             NO SO CHECK FOR OTHER ELEMENTS               
DFGEN60  DS    0H                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         LA    R1,14               MAX FILTER LENGTH                            
         LA    RE,FLTIFLD+L'GLPACC1-1   POINT TO LAST CHARACTER                 
DFGEN70  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DFGEN80                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DFGEN70                                                       
         B     FLTXL                                                            
*                                                                               
DFGEN80  BCTR  R1,0                                                             
         EXCLC R1,GLPACC1,FLTIFLD                                               
         BNE   FLTXL                                                            
         B     FLTXE                                                            
*                                                                               
DOFGENLX CLC   FLTIFLD(L'AC@NONE),AC@NONE  GET HERE IS NO ELEM FOUND            
         BE    FLTXE                       IF FILTERING ON 'NONE' THAN          
         B     FLTXL                       OKAY TO SHOW THIS ACCOUNT.           
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR GENERAL LEDGER OFFICE                               *         
* GLOFF= - GL OFFICE (ALL UNIT 'S' LEDGERS)                           *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
GLOFF    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,GLOFFTBL                                                      
         B     ITER                                                             
*                                                                               
GLOFFTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DSGLOF)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSGLOF)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VLGLOF)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFGLOF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFGLOF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFGLOF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY GENERAL LEDGER OFFICE                                       *         
* 1) LOOK IN LOWEST LEVEL OF ACCOUNT.                                 *         
* 2) LOOK IN LEDGER RECORD FOR GLOFF=                                 *         
* THE FOLLOWING HIERARCHY RULES ARE HONORED BY THE A25 BUT I CANNOT   *         
* DETERMINE THE OFFICE SO WILL DISPLAY 'GL HEIRARCHY'                 *         
* 3) LOOK IN GLRULES RECORD IF 'USE GLRULES FOR TRANS' AND 'USE G/L   *         
*    OFFICE RULES' ARE BOTH SET TO YES.                               *         
* 4) LOOK IN LEDGER RECORD FOR OFFPOS=                                *         
* 5) DEFAULT:  TAKE OFFICE FROM SUBSIDIARY TRANSACTION                *         
***********************************************************************         
         SPACE 1                                                                
DSGLOF   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE,X'FF'-GLOFFLEV                                              
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DSGLO05                        VALID TO SHOW AT THIS LVL         
         OI    BYTE,GLOFFLEV                   NO, BUT NEED TO READ LDG         
         B     DSGLO10                        RECORD ANYWAY                     
*                                                                               
DSGLO05  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DSGLO10             CHECK LEDGER                                 
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         OC    RSTOFFC,RSTOFFC                                                  
         BZ    DSGLO10                                                          
         MVC   FVIFLD(L'RSTOFFC),RSTOFFC                                        
         OI    LEVELBIT,ACCTLV                                                  
         B     DSGLOX                                                           
*                                                                               
* NOW CHECK TO SEE IF PROFILE IS SET AT THE LEDGER LEVEL                        
         USING LDGELD,RF                                                        
DSGLO10  LA    RF,SVLDGEL          RF POINTS TO SAVED LDG STATUS ELEM           
         OC    LDGOFFC,LDGOFFC                                                  
         BZ    DSGLO15                                                          
         MVC   FVIFLD(L'LDGOFFC),LDGOFFC                                        
         OI    LEVELBIT,LEDGLV                                                  
         TM    BYTE,GLOFFLEV                                                    
         BZ    DSGLOX                                                           
         OI    FVATRB,FVAPROT                                                   
         B     DSGLOX                                                           
         DROP  RF                                                               
*                                                                               
DSGLO15  CLI   CSACT,A#LST                                                      
         BE    DSGLO20                     FOR ACTION LIST SHOW                 
         CLI   CSACT,A#REPT                                                     
         BE    DSGLO20                                                          
         CLI   CSACT,A#DLOAD                                                    
         BNE   DSGLO25                                                          
DSGLO20  MVC   FVIFLD(L'AC@NFA90),AC@NFA90  (HEIR) AS THE DEFAULT               
         B     *+10                                                             
DSGLO25  MVC   FVIFLD(L'AC@NFA89),AC@NFA89   (GL HEIRARCHY) IS THE DEF          
         OI    LEVELBIT,GLOFFDEF         SET BIT FOR SPECIAL SETTING            
         TM    BYTE,GLOFFLEV                                                    
         BZ    DSGLOX                                                           
         OI    FVATRB,FVAPROT                                                   
*                                                                               
DSGLOX   MVI   SBYTE,GLSEC         MOVE IN G/L SECURITY NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE GENERAL LEDGER OFFICE                                                
***********************************************************************         
         SPACE 1                                                                
VLGLOF   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,GLSEC         MOVE IN G/L SECURITY NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VLGLOX                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
         XC    RSTOFFC,RSTOFFC                                                  
         CLI   FVILEN,0                                                         
         BE    VLGLOX                                                           
         CLI   FVILEN,2                                                         
         BH    EXITNV              NEVER MORE THAN 2                            
         ST    RF,SVADDR           SAVE ADDRESS OF RSTELD                       
         TM    BCCPYST4,CPYSOFF2                                                
         BO    VLGL20                                                           
         CLI   FVILEN,1                                                         
         BH    EXITNV              IF OLD OFFICES NOT MORE THAN 1               
*                                                                               
T        USING ACTRECD,R3                                                       
         LA    R3,IOKEY            READ 2D LEDGER REC                           
         MVC   T.ACTKEY,BCSPACES     FOR 1 BYTE OFFICES                         
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(2),=C'2D'                                              
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,T.ACTKACT,FVIFLD                                              
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    VLGL30                                                           
         MVC   FVMSGNO,=AL2(AE$IVOFF)                                           
         B     EXITL                                                            
         DROP  T                                                                
*                                                                               
         USING OFFRECD,R3                                                       
VLGL20   LA    R3,IOKEY            READ 01 OFFICE REC                           
         MVC   OFFKEY,BCSPACES     FOR 2 BYTE OFFICES                           
         MVI   OFFKTYP,OFFKTYPQ                                                 
         MVC   OFFKCPY,CUABIN                                                   
         MVC   OFFKOFF,FVIFLD                                                   
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    VLGL25                                                           
         MVC   FVMSGNO,=AL2(AE$IVOFF)     INVALID OFFICE                        
         B     EXITL                                                            
VLGL25   TM    OFFKSTAT,OFFSLIST   CAN'T USE AN OFFICE LIST AS A                
         BZ    VLGL30              POSTING OFFICE                               
         MVC   FVMSGNO,=AL2(AE$OLNO)                                            
         B     EXITL                                                            
*                                                                               
VLGL30   L     RF,SVADDR           RESTORE ADDRESS OF RSTELD                    
         MVC   RSTOFFC,FVIFLD                                                   
*                                                                               
VLGLOX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3,RE,RF                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY GENERAL LEDGER OFFICE FILTER                                          
***********************************************************************         
         SPACE 1                                                                
DFGLOF   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE GENERAL LEDGER OFFICE FILTER                                         
***********************************************************************         
         SPACE 1                                                                
VFGLOF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLI   ACTKUNT,C'S'        FILTER ONLY VALID FOR UNIT S                 
         BNE   ERRFILT                                                          
         CLC   FVIFLD(L'AC@NFA96),AC@NFA96  HEIR?                               
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA96),AC@NFA96                                     
         B     EXITOK                                                           
         TM    BCCPYST4,CPYSOFF2                                                
         BO    VFGLO10                                                          
         CLI   FVILEN,1            ON OLD OFFICES MUST BE ONE BYTE              
         BE    VFGLO20                                                          
         B     EXITNV                                                           
*                                                                               
VFGLO10  CLI   FVILEN,2            ON NEW OFFICES MUST BE TWO BYTES             
         BNE   EXITNV                                                           
*                                                                               
VFGLO20  ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON GENERAL LEDGER OFFICE                               *         
***********************************************************************         
         SPACE 1                                                                
DOFGLOF  OC    FLTIFLD,BCSPACES                                                 
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF NOT A LOW LEVEL ACCOUNT THAN CAN          
         BE    DOFGL5              ONLY FILTER ON HEIR                          
         CLC   FLTIFLD(L'AC@NFA96),AC@NFA96                                     
         BE    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOFGL5   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING RSTELD,RF                                                        
         L     RF,12(R1)                                                        
*                                                                               
         CLC   FLTIFLD(L'AC@NFA96),AC@NFA96 FILTERING ON HEIR?                  
         BNE   *+18                                                             
         OC    RSTOFFC,RSTOFFC              THAN SHOULDN'T HAVE OFFICE          
         BNZ   FLTXL                        HERE OR IN LEDGER                   
         B     DFGLOF10                                                         
*                                                                               
         CLC   RSTOFFC,BCSPACES                                                 
         BNH   DFGLOF10                                                         
         CLC   RSTOFFC,FLTIFLD                                                  
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
         DROP  RF                                                               
*                                                                               
* NOW CHECK TO SEE IF OFFICE AT LEDGER LEVEL TO FILTER ON                       
         USING LDGELD,RF                                                        
DFGLOF10 LA    RF,SVLDGEL          RF POINTS TO SAVED LDG STATUS ELEM           
         CLC   FLTIFLD(L'AC@NFA96),AC@NFA96 FILTERING ON HEIR?                  
         BNE   *+18                                                             
         OC    LDGOFFC,LDGOFFC      IF FILTERING ON HEIR SHOULDN'T              
         BZ    FLTXE                HAVE AN OFFICE.                             
         B     FLTXL                                                            
*                                                                               
         OC    LDGOFFC,LDGOFFC     IF NO OFFICE HERE DEFINITELY DON'T           
         BZ    FLTXX               WANT THIS ACCOUNT.                           
         CLC   LDGOFFC,FLTIFLD                                                  
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FFNONUM                                             *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FFNUM    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FFNOTABL                                                      
         B     ITER                                                             
*                                                                               
FFNOTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DISFFN)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFFN)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFFN)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FFNONUM                                                     *         
***********************************************************************         
         SPACE 1                                                                
DISFFN   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFNELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         L     R3,12(R1)                                                        
         USING FFNELD,R3                                                        
         XR    RF,RF                                                            
         IC    RF,FFNLN                                                         
         SH    RF,=Y(FFNLN1Q+1)                                                 
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   FVIFLD(0),FFNONUM                                                
         B     EXITOK                                                           
         DROP  R3                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE FFNONUM                                                    *         
***********************************************************************         
         SPACE 1                                                                
VALFFN   GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('FFNELQ',ACTRECD),0               
         CLI   FVILEN,0                                                         
         BE    EXITOK                                                           
*                                                                               
         LA    R3,BOWORK1          BUILD DUMMY FFNEL                            
         USING FFNELD,R3                                                        
         MVI   FFNEL,FFNELQ                                                     
         MVI   FFNLN,OTHLN2Q                                                    
         XC    FFNUMBER,FFNUMBER                                                
         MVC   FFNONUM,FVIFLD      NUMBER VALUE                                 
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),FFNELD,0                      
         CLI   12(R1),0                                                         
         BE    EXITOK                                                           
         DC    H'0'                                                             
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR 'ACCOUNT EQUIVALENT CODES' HEADER (PROTECTED FIELD) *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQCDS    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQCDSTB                                                       
         B     ITER                                                             
*                                                                               
EQCDSTB  DC    AL1(DDIS),AL1(0,0,0),AL4(DSQCDS)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSQCDS)  *FOR REPORT                   
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* THIS ROUTINE IS TO SEE IF THE LEDGER IS SETUP TO USE THESE CODES    *         
* AND TO BUILD A TABLE OF THE ACCT NAMES AND RULES.  IF THE LEDGER IS *         
* NOT SET UP DISPLAY "(N/A)".  IF THE LEDGER IS SET UP BUT NO ACCT    *         
* CODES ARE SET UP THAN DISPLAY "(NONE)".  DISPLAY NOTHING IF CODES   *         
* ARE SET UP.                                                         *         
***********************************************************************         
         SPACE 1                                                                
DSQCDS   DS    0H                                                               
         MVC   FVIFLD,BCSPACES                                                  
         BRAS  RE,EQSET                                                         
*                                                                               
DSQC40   TM    BYTE,EQURULE         ARE RULES SET UP                            
         BO    DSQCX                                                            
         CLI   ACTKUNT,C'G'        FOR UNIT G - GB/GP ARE VALID                 
         BNE   DSQC41                                                           
         CLI   ACTKLDG,C'B'                                                     
         BE    DSQC50                                                           
         CLI   ACTKLDG,C'P'                                                     
         BE    DSQC50                                                           
         BNE   DSQC60                                                           
*                                                                               
DSQC41   CLI   ACTKUNT,C'S'        FOR UNIT S ALL VALID                         
         BNE   DSQC42              EXCEPT S9                                    
         CLI   ACTKLDG,C'9'                                                     
         BE    DSQC60                                                           
         B     DSQC50                                                           
*                                                                               
DSQC42   CLI   ACTKUNT,C'1'        FOR UNIT 1 ONLY 1C,1N,1R                     
         BNE   DSQC44              IS VALID                                     
         CLI   ACTKLDG,C'C'                                                     
         BE    DSQC50                                                           
         CLI   ACTKLDG,C'N'                                                     
         BE    DSQC50                                                           
         CLI   ACTKLDG,C'R'                                                     
         BE    DSQC50                                                           
         B     DSQC60                                                           
*                                                                               
DSQC44   CLI   ACTKUNT,C'2'        FOR UNIT 2 ONLY 2D AND 28                    
         BNE   DSQC60              ARE VALID                                    
         CLI   ACTKLDG,C'D'        NO OTHER U/L'S ARE VALID                     
         BE    DSQC50                                                           
         CLI   ACTKLDG,C'8'                                                     
         BE    DSQC50                                                           
         B     DSQC60                                                           
*                                                                               
DSQC50   MVC   FVIFLD(L'AC@NFA42),AC@NFA42    DISPLAY '(NONE)'                  
         B     DSQCX                                                            
*                                                                               
DSQC60   MVC   FVIFLD(L'AC@NA),AC@NA          DISPLAY '(N/A)'                   
*                                                                               
DSQCX    B     EXITOK                                                           
         EJECT                                                                  
*                                                                               
***********************************************************************         
* DATA OBJECT FOR ACCOUNT CODE NAME 1                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQNM1    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQNM1TB                                                       
         B     ITER                                                             
*                                                                               
EQNM1TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DSEQN1)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSEQN1)   *FOR REPORT                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT CODE NAME 1                                         *         
***********************************************************************         
         SPACE 1                                                                
DSEQN1   TM    BYTE,EQURULE         DOES THIS LEDGER ALLOW EQU CODES?           
         BO    *+14                                                             
         MVC   FVIFLD,BCSPACES     NO SO JUST CLEAR FIELD HIDE THE              
         B     EXITOK                                                           
*                                                                               
         MVI   CODESEQ,0           CODE 1 GETS SEQUENCE NUMBER 0                
         BRAS  RE,GETCDNM          GET THE CODE NAME                            
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DATA OBJECT FOR ACCOUNT EQU CODE 1                                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQCD1    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQCD1TB                                                       
         B     ITER                                                             
*                                                                               
EQCD1TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISCD1)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCD1)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCD1)                                 
         DC    AL1(DHED),AL1(0,0,0),AL4(HDCD1)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCD1)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCD1)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCD1)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* CALL ROUTINE TO EDIT COLUMN HEADING FOR LIST/REPORT/DOWNLOAD        *         
***********************************************************************         
         SPACE 1                                                                
HDCD1    MVI   CODESEQ,0                                                        
         BRAS  RE,HEDCD                                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT EQU CODE 1                                          *         
***********************************************************************         
         SPACE 1                                                                
DISCD1   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         CLI   CSACT,A#LST         FOR ACTION LIST MUST BUILD THE               
         BE    DISCD05             TABLE OF EQU ACCOUNT FIRST                   
         CLI   CSACT,A#REPT        (FOR REPORT/DOWNLOAD TOO)                    
         BE    DISCD05                                                          
         CLI   CSACT,A#DLOAD                                                    
         BNE   DISCD10                                                          
DISCD05  BRAS  RE,EQSET                                                         
*                                                                               
DISCD10  TM    BYTE,EQURULE         IS THIS LEDGER SET UP FOR ACCT EQU          
         BO    *+12                CODES?                                       
         OI    FVATRB,FVAPROT      NO THAN PROTECT FIELD AND EXIT               
         B     EXITOK                                                           
         MVI   CODESEQ,0           EQU CODE 1 GETS SEQ # ZERO                   
         BRAS  RE,FINDPRF          GET THE EQU CODE                             
         MVI   SBYTE,EQUCODES      MOVE IN EQU CODES SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         B     EXITOK                                                           
         SPACE 1                                                                
***********************************************************************         
* VALIDATE ACCOUNT EQU CODE 1                                         *         
***********************************************************************         
         SPACE 1                                                                
VALCD1   NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,EQUCODES      MOVE IN ACC EQUIVALENCY CODES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   EXITOK                                                           
                                                                                
         CLI   FVIFLD,C'('         IF DATA SURROUNDED BY () THAN COMES          
         BE    EXITOK              FROM A HIGHER LEVEL SO DON'T ADD TO          
*                                  ACCOUNT                                      
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('FFTELQ',ACTRECD),       *        
               (L'FFTTYPE,=AL1(FFTTEPTR))                                       
         CLI   FVILEN,0            ANY INPUT?                                   
         BE    EXITOK              NO                                           
         MVI   CODESEQ,0           EQU CODE 1 GETS SEQ # ZERO                   
         BRAS  RE,CHKRULE          VALIDATE THE CODE ENTERED                    
         BNE   EXITL                                                            
         BRAS  RE,BLDEQUS          BUILD FFTELD ELEMENT                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCT EQU CODE 1 FILTER                                                
***********************************************************************         
         SPACE 1                                                                
DFCD1    MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCT EQU CODE 1 FILTER                                               
* SAVE INPUT LENGTH -1 IN 1ST BYTE OF FLTIFLD ***I NO LONGER DO THIS!           
***********************************************************************         
         SPACE 1                                                                
VFCD1    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
                                                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCT EQU CODE 1 FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCD1   MVI   CODESEQ,0           EQU CODE 1 GETS SEQ # ZERO                   
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT CODE NAME 2                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQNM2    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQNM2TB                                                       
         B     ITER                                                             
*                                                                               
EQNM2TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DSEQN2)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSEQN2) *FOR REPORT                    
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT CODE NAME 2                                         *         
* FOR THE REST OF THE NAMES (2,3,4,5) THERE ARE NO LABELS ATTACHED SO *         
* JUST CLEAR THE FIELD IF LEDGER NOT SET UP FOR EQU CODES.            *         
***********************************************************************         
         SPACE 1                                                                
DSEQN2   TM    BYTE,EQURULE         DOES THIS LEDGER ALLOW EQU CODES?           
         BO    *+14                                                             
         MVC   FVIFLD,BCSPACES     NO SO JUST CLEAR FIELD AND EXIT              
         B     EXITOK                                                           
*                                                                               
         MVI   CODESEQ,1           CODE 2 GETS SEQUENCE NUMBER 1                
         BRAS  RE,GETCDNM          GET THE CODE NAME                            
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT EQU CODE 2                                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQCD2    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQCD2TB                                                       
         B     ITER                                                             
*                                                                               
EQCD2TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISCD2)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCD2)    *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCD2)                                 
         DC    AL1(DHED),AL1(0,0,0),AL4(HDCD2)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCD2)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCD2)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCD2)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* CALL ROUTINE TO EDIT COLUMN HEADING FOR LIST/REPORT/DOWNLOAD        *         
***********************************************************************         
         SPACE 1                                                                
HDCD2    MVI   CODESEQ,1                                                        
         BRAS  RE,HEDCD                                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT EQU CODE 2                                          *         
***********************************************************************         
         SPACE 1                                                                
DISCD2   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         CLI   CSACT,A#LST         FOR ACTION LIST MAKE SURE TABLE IS           
         BE    DISCD210            SET (CAN'T RELY ON DOING THIS ONCE           
         CLI   CSACT,A#REPT                                                     
         BE    DISCD210                                                         
         CLI   CSACT,A#DLOAD                                                    
         BNE   DISCD220                                                         
DISCD210 BRAS  RE,EQSET            B/C CAN SWTCH COLS AROUND ON LST SCR         
*                                                                               
DISCD220 TM    BYTE,EQURULE         IS THIS LEDGER SET UP FOR ACCT EQU          
         BO    *+12                CODES?                                       
         OI    FVATRB,FVAPROT      NO THAN PROTECT FIELD AND EXIT               
         B     EXITOK                                                           
         MVI   CODESEQ,1           EQU CODE 2 GETS SEQ # ZERO                   
         BRAS  RE,FINDPRF          GET THE EQU CODE                             
         MVI   SBYTE,EQUCODES      MOVE IN EQU CODES SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         B     EXITOK                                                           
         SPACE 1                                                                
***********************************************************************         
* VALIDATE ACCOUNT EQU CODE 2                                         *         
***********************************************************************         
         SPACE 1                                                                
VALCD2   NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,EQUCODES      MOVE IN ACC EQUIVALENCY CODES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   EXITOK                                                           
*                                                                               
         CLI   FVIFLD,C'('         IF DATA SURROUNDED BY () THAN COMES          
         BE    EXITOK              FROM A HIGHER LEVEL SO DON'T ADD TO          
*                                  ACCOUNT                                      
         CLI   FVILEN,0            ANY INPUT?                                   
         BE    EXITOK              NO                                           
         MVI   CODESEQ,1           EQU CODE 2 GETS SEQ # ONE                    
         BRAS  RE,CHKRULE          VALIDATE THE CODE ENTERED                    
         BNE   EXITL                                                            
         BRAS  RE,BLDEQUS          BUILD FFTELD ELEMENT                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCT EQU CODE 2 FILTER                                                
***********************************************************************         
         SPACE 1                                                                
*        MVC   FVIFLD(FILTLN),FLTIFLD+1                                         
DFCD2    MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCT EQU CODE 2 FILTER                                               
* SAVE INPUT LENGTH -1 IN 1ST BYTE OF FLTIFLD ***I NO LONGER DO THIS!           
***********************************************************************         
         SPACE 1                                                                
VFCD2    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCT EQU CODE 2 FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCD2   MVI   CODESEQ,1           EQU CODE 2 GETS SEQ # ONE                    
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT CODE NAME 3                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQNM3    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQNM3TB                                                       
         B     ITER                                                             
*                                                                               
EQNM3TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DSEQN3)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSEQN3)    *FOR REPORT                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT CODE NAME 3                                         *         
***********************************************************************         
         SPACE 1                                                                
DSEQN3   TM    BYTE,EQURULE         DOES THIS LEDGER ALLOW EQU CODES?           
         BO    *+14                                                             
         MVC   FVIFLD,BCSPACES     NO SO JUST CLEAR FIELD AND EXIT              
         B     EXITOK                                                           
*                                                                               
         MVI   CODESEQ,2           CODE 3 GETS SEQUENCE NUMBER 2                
         BRAS  RE,GETCDNM          GET THE CODE NAME                            
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT EQU CODE 3                                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQCD3    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQCD3TB                                                       
         B     ITER                                                             
*                                                                               
EQCD3TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISCD3)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCD3)    *FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCD3)                                 
         DC    AL1(DHED),AL1(0,0,0),AL4(HDCD3)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCD3)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCD3)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCD3)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* CALL ROUTINE TO EDIT COLUMN HEADING FOR LIST/REPORT/DOWNLOAD        *         
***********************************************************************         
         SPACE 1                                                                
HDCD3    MVI   CODESEQ,2                                                        
         BRAS  RE,HEDCD                                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT EQU CODE 3                                          *         
***********************************************************************         
         SPACE 1                                                                
DISCD3   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         CLI   CSACT,A#LST         FOR ACTION LIST MAKE SURE TABLE IS           
         BE    DISCD310            SET (CAN'T RELY ON DOING THIS ONCE           
         CLI   CSACT,A#REPT                                                     
         BE    DISCD310                                                         
         CLI   CSACT,A#DLOAD                                                    
         BNE   DISCD320                                                         
DISCD310 BRAS  RE,EQSET            B/C CAN SWTCH COLS AROUND ON LST SCR         
*                                                                               
DISCD320 TM    BYTE,EQURULE         IS THIS LEDGER SET UP FOR ACCT EQU          
         BO    *+12                CODES?                                       
         OI    FVATRB,FVAPROT      NO THAN PROTECT FIELD AND EXIT               
         B     EXITOK                                                           
         MVI   CODESEQ,2           EQU CODE 3 GETS SEQ # ZERO                   
         BRAS  RE,FINDPRF          GET THE EQU CODE                             
         MVI   SBYTE,EQUCODES      MOVE IN EQU CODES SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         B     EXITOK                                                           
         SPACE 1                                                                
***********************************************************************         
* VALIDATE ACCOUNT EQU CODE 3                                         *         
***********************************************************************         
         SPACE 1                                                                
VALCD3   NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,EQUCODES      MOVE IN ACC EQUIVALENCY CODES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   EXITOK                                                           
*                                                                               
         CLI   FVIFLD,C'('         IF DATA SURROUNDED BY () THAN COMES          
         BE    EXITOK              FROM A HIGHER LEVEL SO DON'T ADD TO          
*                                  ACCOUNT                                      
         CLI   FVILEN,0            ANY INPUT?                                   
         BE    EXITOK              NO                                           
         MVI   CODESEQ,2           EQU CODE 3 GETS SEQ # TWO                    
         BRAS  RE,CHKRULE          VALIDATE THE CODE ENTERED                    
         BNE   EXITL                                                            
         BRAS  RE,BLDEQUS          BUILD FFTELD ELEMENT                         
         B     EXITOK                                                           
***********************************************************************         
* DISPLAY ACCT EQU CODE 3 FILTER                                                
***********************************************************************         
         SPACE 1                                                                
*        MVC   FVIFLD(FILTLN),FLTIFLD+1                                         
DFCD3    MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCT EQU CODE 3 FILTER                                               
* SAVE INPUT LENGTH -1 IN 1ST BYTE OF FLTIFLD ***I NO LONGER DO THIS!           
***********************************************************************         
         SPACE 1                                                                
VFCD3    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCT EQU CODE 3 FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCD3   MVI   CODESEQ,2           EQU CODE 3 GETS SEQ # 2                      
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT CODE NAME 4                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQNM4    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQNM4TB                                                       
         B     ITER                                                             
*                                                                               
EQNM4TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DSEQN4)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSEQN4)  *FOR REPORT                   
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT CODE NAME 4                                         *         
***********************************************************************         
         SPACE 1                                                                
DSEQN4   TM    BYTE,EQURULE         DOES THIS LEDGER ALLOW EQU CODES?           
         BO    *+14                                                             
         MVC   FVIFLD,BCSPACES     NO SO JUST CLEAR FIELD AND EXIT              
         B     EXITOK                                                           
*                                                                               
         MVI   CODESEQ,3           CODE 4 GETS SEQUENCE NUMBER 3                
         BRAS  RE,GETCDNM          GET THE CODE NAME                            
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT EQU CODE 4                                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQCD4    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQCD4TB                                                       
         B     ITER                                                             
*                                                                               
EQCD4TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISCD4)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCD4)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCD4)                                 
         DC    AL1(DHED),AL1(0,0,0),AL4(HDCD4)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCD4)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCD4)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCD4)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* CALL ROUTINE TO EDIT COLUMN HEADING FOR LIST/REPORT/DOWNLOAD        *         
***********************************************************************         
         SPACE 1                                                                
HDCD4    MVI   CODESEQ,3                                                        
         BRAS  RE,HEDCD                                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT EQU CODE 4                                          *         
***********************************************************************         
         SPACE 1                                                                
DISCD4   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         CLI   CSACT,A#LST         FOR ACTION LIST MAKE SURE TABLE IS           
         BE    DISCD410            SET (CAN'T RELY ON DOING THIS ONCE           
         CLI   CSACT,A#REPT        B/C CAN SWITCH COLS AROUND ON LST            
         BE    DISCD410            SCREEN                                       
         CLI   CSACT,A#DLOAD                                                    
         BNE   DISCD420                                                         
DISCD410 BRAS  RE,EQSET            B/C CAN SWTCH COLS AROUND ON LST SCR         
*                                                                               
DISCD420 TM    BYTE,EQURULE         IS THIS LEDGER SET UP FOR ACCT EQU          
         BO    *+12                CODES?                                       
         OI    FVATRB,FVAPROT      NO THAN PROTECT FIELD AND EXIT               
         B     EXITOK                                                           
         MVI   CODESEQ,3           EQU CODE 4 GETS SEQ # ZERO                   
         BRAS  RE,FINDPRF          GET THE EQU CODE                             
         MVI   SBYTE,EQUCODES      MOVE IN EQU CODES SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         B     EXITOK                                                           
         SPACE 1                                                                
***********************************************************************         
* VALIDATE ACCOUNT EQU CODE 4                                         *         
***********************************************************************         
         SPACE 1                                                                
VALCD4   NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,EQUCODES      MOVE IN ACC EQUIVALENCY CODES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   EXITOK                                                           
*                                                                               
         CLI   FVIFLD,C'('         IF DATA SURROUNDED BY () THAN COMES          
         BE    EXITOK              FROM A HIGHER LEVEL SO DON'T ADD TO          
*                                  ACCOUNT                                      
         CLI   FVILEN,0            ANY INPUT?                                   
         BE    EXITOK              NO                                           
         MVI   CODESEQ,3           EQU CODE 4 GETS SEQ # THREE                  
         BRAS  RE,CHKRULE          VALIDATE THE CODE ENTERED                    
         BNE   EXITL                                                            
         BRAS  RE,BLDEQUS          BUILD FFTELD ELEMENT                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCT EQU CODE 4 FILTER                                                
***********************************************************************         
         SPACE 1                                                                
DFCD4    MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCT EQU CODE 4 FILTER                                               
* SAVE INPUT LENGTH -1 IN 1ST BYTE OF FLTIFLD ***I NO LONGER DO THIS!           
***********************************************************************         
         SPACE 1                                                                
VFCD4    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCT EQU CODE 4 FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCD4   MVI   CODESEQ,3           EQU CODE 4 GETS SEQ # 3                      
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT CODE NAME 5                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQNM5    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQNM5TB                                                       
         B     ITER                                                             
*                                                                               
EQNM5TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DSEQN5)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSEQN5)  *FOR REPORT                   
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT CODE NAME 5                                         *         
***********************************************************************         
         SPACE 1                                                                
DSEQN5   TM    BYTE,EQURULE         DOES THIS LEDGER ALLOW EQU CODES?           
         BO    *+14                                                             
         MVC   FVIFLD,BCSPACES     NO SO JUST CLEAR FIELD AND EXIT              
         B     EXITOK                                                           
*                                                                               
         MVI   CODESEQ,4           CODE 5 GETS SEQUENCE NUMBER 4                
         BRAS  RE,GETCDNM          GET THE CODE NAME                            
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT EQU CODE 5                                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
EQCD5    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,EQCD5TB                                                       
         B     ITER                                                             
*                                                                               
EQCD5TB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISCD5)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCD5)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCD5)                                 
         DC    AL1(DHED),AL1(0,0,0),AL4(HDCD5)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCD5)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCD5)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCD5)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* CALL ROUTINE TO EDIT COLUMN HEADING FOR LIST/REPORT DOWNLOAD        *         
***********************************************************************         
         SPACE 1                                                                
HDCD5    MVI   CODESEQ,4                                                        
         BRAS  RE,HEDCD                                                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT EQU CODE 5                                          *         
***********************************************************************         
         SPACE 1                                                                
DISCD5   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         CLI   CSACT,A#LST         FOR ACTION LIST MAKE SURE TABLE IS           
         BE    DISCD510            SET (CAN'T RELY ON DOING THIS ONCE           
         CLI   CSACT,A#REPT        B/C CAN SWITCH COLS AROUND ON LST            
         BE    DISCD510            SCREEN                                       
         CLI   CSACT,A#DLOAD                                                    
         BNE   DISCD520                                                         
DISCD510 BRAS  RE,EQSET            B/C CAN SWTCH COLS AROUND ON LST SCR         
*                                                                               
DISCD520 TM    BYTE,EQURULE         IS THIS LEDGER SET UP FOR ACCT EQU          
         BO    *+12                CODES?                                       
         OI    FVATRB,FVAPROT      NO THAN PROTECT FIELD AND EXIT               
         B     EXITOK                                                           
         MVI   CODESEQ,4           EQU CODE 5 GETS SEQ # ZERO                   
         BRAS  RE,FINDPRF           GET THE EQU CODE                            
         MVI   SBYTE,EQUCODES      MOVE IN EQU CODES SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         B     EXITOK                                                           
         SPACE 1                                                                
***********************************************************************         
* VALIDATE ACCOUNT EQU CODE 5                                         *         
***********************************************************************         
         SPACE 1                                                                
VALCD5   NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,EQUCODES      MOVE IN ACC EQUIVALENCY CODES SEC #          
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   EXITOK                                                           
*                                                                               
         CLI   FVIFLD,C'('         IF DATA SURROUNDED BY () THAN COMES          
         BE    EXITOK              FROM A HIGHER LEVEL SO DON'T ADD TO          
*                                  ACCOUNT                                      
         CLI   FVILEN,0            ANY INPUT?                                   
         BE    EXITOK              NO                                           
         MVI   CODESEQ,4           EQU CODE 5 GETS SEQ # FOUR                   
         BRAS  RE,CHKRULE          VALIDATE THE CODE ENTERED                    
         BNE   EXITL                                                            
         BRAS  RE,BLDEQUS          BUILD FFTELD ELEMENT                         
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCT EQU CODE 5 FILTER                                                
***********************************************************************         
         SPACE 1                                                                
DFCD5    MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCT EQU CODE 5 FILTER                                               
* SAVE INPUT LENGTH -1 IN 1ST BYTE OF FLTIFLD ***I NO LONGER DO THIS!           
***********************************************************************         
         SPACE 1                                                                
VFCD5    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCT EQU CODE 5 FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCD5   MVI   CODESEQ,4           EQU CODE 5 GETS SEQ # 4                      
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RETAIL BILL RECEIVABLE ACCOUNT                      *         
* RECV=                                                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
RECV     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,RECVTB                                                        
         B     ITER                                                             
*                                                                               
RECVTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISRCV)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISRCV)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALRCV)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCRCV)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFRCV)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFRCV)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFRCV)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RETAIL RECEIVALBE ACCOUNT                                             
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DISRCV   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DISRCVX             YES SO DONE                                  
         MVC   FVIFLD(L'AC@NFA72),AC@NFA72 '(CLI/PROD REC)' IS DEFAULT          
*                                                                               
DISRCVX  MVI   SBYTE,UNIT3PRF      MOVE IN UNIT 3 PROFILE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE RETAIL RECEIVABLE ACCOUNT                                  *         
***********************************************************************         
         SPACE 1                                                                
VALRCV   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,UNIT3PRF      MOVE IN UNIT 3 PROFILE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALRCVX                                                          
*                                                                               
         XC    BOWORK2,BOWORK2                                                  
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RBRELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VALRCV05            NO ELEMENT FOUND                             
         L     RF,12(R1)                                                        
         USING RBRELD,RF                                                        
         MVC   BOWORK2(L'RBRCOST),RBRCOST    SAVE RETAIL COST ACCT              
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('RBRELQ',ACTRECD),0               
*                                                                               
VALRCV05 CLI   FVILEN,0            ANY ACCOUNT ENTERED?                         
         BNE   VALRCV10            YES                                          
         OC    BOWORK2,BOWORK2     IF COST ACCT NEED TO REBUILD ELEM            
         BZ    VALRCVX             ELSE DONE                                    
         B     VALRCV17                                                         
*                                                                               
T        USING ACTRECD,R3                                                       
VALRCV10 LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN      CONNECTED ID                               
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SR'                            
         ZIC   RF,FVXLEN                                                        
         EXMVC RF,T.ACTKACT,FVIFLD                                              
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    VALRCV15                                                         
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         MVC   FVXTRA(2),=C'SR'                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FVXTRA+2,FVIFLD                                               
         B     EXITL                                                            
VALRCV15 LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
                                                                                
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',AIO2),0                  
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)  MUST BE A LOW LEVEL ACCT                 
         B     EXITL                                                            
*                                                                               
         USING RBRELD,RF                                                        
VALRCV17 LA    RF,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   RBREL,RBRELQ                                                     
         MVI   RBRLN,RBRLNQ                                                     
         MVC   RBRCOST,BOWORK2     REPLACE RETAIL COST ACCOUNT                  
         XC    RBRRECB,RBRRECB                                                  
         CLI   FVILEN,0            NO ACCT SO JUST WRITE ELEMENT                
         BE    VALRCV20                                                         
         MVC   RBRRECB(2),=C'SR'                                                
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,RBRRECB+2,FVIFLD                                              
         OC    RBRRECB,BCSPACES                                                 
                                                                                
VALRCV20 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),RBRELD,0                      
VALRCVX  BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* SEARCH UNIT 3 RECEIVABLE ACCOUNT                                    *         
***********************************************************************         
         SPACE 1                                                                
SRCRCV   CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,(0,=C'SR'),ACOM,(0,0)            
         B     EXITOK                                                           
***********************************************************************         
* DISPLAY RETAIL RECEIVABLE ACCOUNT FILTER                            *         
***********************************************************************         
         SPACE 1                                                                
DFRCV    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE RETAIL RECEIVABLE ACCOUNT FILTER                           *         
***********************************************************************         
         SPACE 1                                                                
VFRCV    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLI   ACTKUNT,C'3'        FILTER IS ONLY FOR UNIT 3                    
         BNE   ERRFILT                                                          
         CLC   FVIFLD(4),AC@NFA92   CLI/PROD REC                                
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA92),AC@NFA92                                     
         B     EXITOK                                                           
         MVC   FLTIFLD,FVIFLD                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON RETAIL RECEIVABLE ACCOUNT PROFILE                   *         
***********************************************************************         
         SPACE 1                                                                
DOFRCV   CLI   ACTKUNT,C'3'        THIS FILTER FOR UNIT 3 ONLY                  
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         EQUAL?                                       
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'         HIGH?                                        
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RETAIL BILL COSTING ACCOUNT                         *         
* COST=                                                               *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
COST1C   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CST1CTB                                                       
         B     ITER                                                             
*                                                                               
CST1CTB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISC1C)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISC1C)  *FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALC1C)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCC1C)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFC1C)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFC1C)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFC1C)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RETAIL COSTING ACCOUNT                                                
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DISC1C   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DISC1CX             YES SO DONE                                  
         MVC   FVIFLD(L'AC@NFA72),AC@NFA72 '(CLI/PROD REC)' IS DEFAULT          
*                                                                               
DISC1CX  MVI   SBYTE,UNIT3PRF      MOVE IN UNIT 3 PROFILE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE RETAIL COSTING ACCOUNT                                     *         
***********************************************************************         
         SPACE 1                                                                
VALC1C   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,UNIT3PRF      MOVE IN UNIT 3 PROFILE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALC1CX                                                          
*                                                                               
         XC    BOWORK2,BOWORK2                                                  
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RBRELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VALC1C05            NO ELEMENT FOUND                             
         L     RF,12(R1)                                                        
         USING RBRELD,RF                                                        
         MVC   BOWORK2(L'RBRRECB),RBRRECB    SAVE RETAIL RCVB ACCT              
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('RBRELQ',ACTRECD),0               
*                                                                               
VALC1C05 CLI   FVILEN,0            ANY ACCOUNT ENTERED?                         
         BNE   VALC1C10            YES                                          
         OC    BOWORK2,BOWORK2     IF NO RCVB ACCT THAN DONE                    
         BZ    VALC1CX             IF RCVB ACCT NEED TO PUT BACK ELEM           
         B     VALC1C17                                                         
*                                                                               
T        USING ACTRECD,R3                                                       
VALC1C10 LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN      CONNECTED ID                               
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'                            
         ZIC   RF,FVXLEN                                                        
         EXMVC RF,T.ACTKACT,FVIFLD                                              
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    VALC1C15                                                         
         MVC   FVMSGNO,=AL2(AE$INACC)                                           
         MVC   FVXTRA(2),=C'1C'                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FVXTRA+2,FVIFLD                                               
         B     EXITL                                                            
VALC1C15 LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
                                                                                
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ABLELQ',AIO2),0                  
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)  MUST BE A LOW LEVEL ACCT                 
         B     EXITL                                                            
*                                                                               
         USING RBRELD,RF                                                        
VALC1C17 LA    RF,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   RBREL,RBRELQ                                                     
         MVI   RBRLN,RBRLNQ                                                     
         MVC   RBRRECB,BOWORK2     REPLACE RETAIL RECB ACCOUNT                  
         CLI   FVILEN,0            IF NO ACCT JUST WRITE ELEMENT                
         BE    VALC1C20                                                         
         XC    RBRCOST,RBRCOST     NO-CLEAR FIELD AND PUT BACK ELEMENT          
         MVC   RBRCOST(2),=C'1C'                                                
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,RBRCOST+2,FVIFLD                                              
         OC    RBRCOST,BCSPACES                                                 
                                                                                
VALC1C20 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),RBRELD,0                      
VALC1CX  BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* SEARCH UNIT 3 COST ACCOUNT                                          *         
***********************************************************************         
         SPACE 1                                                                
SRCC1C   CLI   CSACT,A#LST         FOR ACTION LIST                              
         BE    EXITOK              DON'T SEARCH(MESSES UP FILTERING)            
         GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,(0,=C'1C'),ACOM,(0,0)            
         B     EXITOK                                                           
***********************************************************************         
* DISPLAY COSTING ACCOUNT FILTER                                      *         
***********************************************************************         
         SPACE 1                                                                
DFC1C    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE COSTING ACCOUNT FILTER                                     *         
***********************************************************************         
         SPACE 1                                                                
VFC1C    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLI   ACTKUNT,C'3'        FILTER IS ONLY FOR UNIT 3                    
         BNE   ERRFILT                                                          
         CLC   FVIFLD(4),AC@NFA92   CLI/PROD REC                                
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA92),AC@NFA92                                     
         B     EXITOK                                                           
         MVC   FLTIFLD,FVIFLD                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON COSTING ACCOUNT PROFILE                             *         
***********************************************************************         
         SPACE 1                                                                
DOFC1C   CLI   ACTKUNT,C'3'        THIS FILTER FOR UNIT 3 ONLY                  
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         EQUAL?                                       
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'         HIGH?                                        
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR RETAIL SPECIAL COMMISSION RATE                      *         
* COMM=                                                               *         
* NOTE - NOT FILTERING ON THIS PROFILE SINCE IT'S A RATE.             *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
COMM     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,COMMTB                                                        
         B     ITER                                                             
*                                                                               
COMMTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISCOM)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCOM) * FOR REPORT                   
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCOM)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCOM)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCOM)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCOM)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY RETAIL SPECIAL COMMISION RATE                                         
* 1) LOOK IN ACCOUNT RECORD ENTERED.  2) LOOK IN ANY HIGHER LEVEL ACCT*         
* RECORDS                                                                       
***********************************************************************         
         SPACE 1                                                                
DISCOM   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          WAS IT SET AT A HIGHER LEVEL?                
         BNE   DISCOMX             YES SO DONE                                  
         MVC   FVIFLD(L'AC@NFA73),AC@NFA73 '(OPT/MAINT)' IS DEFAULT             
*                                                                               
DISCOMX  MVI   SBYTE,UNIT3PRF      MOVE IN UNIT 3 PROFILE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* VALIDATE RETAIL COMMISSION RATE                                     *         
***********************************************************************         
         SPACE 1                                                                
VALCOM   DS    0H                                                               
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,UNIT3PRF      MOVE IN UNIT 3 PROFILE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALCOMX                                                          
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('FFTELQ',ACTRECD),       +        
               (L'FFTTYPE,=AL1(FFTTCOMR))                                       
*                                                                               
         CLI   FVILEN,0            ANY COMMISSION ENTERED?                      
         BE    VALCOMX             NO                                           
*                                                                               
         CLI   FVILEN,1                 L(DATA) > ONE BYTE?                     
         BNH   EXITNV                   NO, ERROR                               
         CLI   FVILEN,8                 L(DATA) > 8 BYTES?                      
         BH    EXITNV                   YES, ERROR                              
         ZIC   RF,FVXLEN                GET LENGTH OF DATA-1                    
         LA    RE,FVIFLD                                                        
         AR    RE,RF                    POINT TO LAST CHARACTER                 
         CLI   0(RE),C'%'               PERCENT SIGN?                           
         BNE   EXITNV                   NO, ERROR                               
*                                                                               
         GOTO1 VCASHVAL,BODMCB,(X'84',FVIFLD),(RF)                              
         CLI   BODMCB,X'00'               VALID NUMBER?                         
         BNE   EXITNV                                                           
         CP    BODMCB+4(8),=P'1000000'    >= 100.0000%                          
         BNL   EXITNV                   YES, ERROR                              
*                                                                               
         USING FFTELD,RF                                                        
         LA    RF,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   FFTEL,FFTELQ        DB ELEMENT                                   
         MVI   FFTTYPE,FFTTCOMR         COMMISSION RATE                         
         LA    RE,4                                                             
         STC   RE,FFTDLEN                                                       
         LA    RE,FFTLN1Q+1(RE)                                                 
         STC   RE,FFTLN                                                         
         ZAP   FFTDATA(4),BODMCB+4(8)                                           
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),FFTELD,0                      
*                                                                               
VALCOMX  BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY COMMISSION RATE FILTER                                      *         
***********************************************************************         
         SPACE 1                                                                
DFCOM    MVC   FVIFLD,BCSPACES                                                  
         OC    FLTIFLD(4),FLTIFLD                                               
         BZ    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         CLC   FLTIFLD(L'AC@NFA94),AC@NFA94   OPT/MAINT                         
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@NFA94),AC@NFA94                                      
         B     EXITOK                                                           
*                                                                               
         XC    BOWORK1,BOWORK1                                                  
         UNPK  BOWORK1(6),FLTIFLD(4)                                            
         OI    BOWORK1+5,X'F0'                                                  
         LA    RF,FVIFLD                                                        
         CLI   BOWORK1,C'0'            TENS  DIGIT ZERO ?                       
         BE    DFCOMM10                                                         
         MVC   0(1,RF),BOWORK1        MOVE  TENS  DIGIT                         
         LA    RF,1(,RF)              NEXT  'TO'  CHARACTER                     
*                                                                               
DFCOMM10 CLI   BOWORK1+1,C'0'          UNITS DIGIT ZERO ?                       
         BNE   DFCOMM20               NO,   MOVE  IT                            
         CLI   BOWORK1,C'0'            WAS   TENS  DIGIT ALSO ZERO ?            
         BE    DFCOMM30               YES,  SKIP  UNITS DIGIT                   
*                                                                               
DFCOMM20 MVC   0(1,RF),BOWORK1+1       MOVE  UNITS DIGIT                        
         LA    RF,1(,RF)              NEXT  'TO'  CHARACTER                     
DFCOMM30 MVI   0(RF),C'.'             INSERT      DECIMAL   POINT               
         MVC   1(4,RF),BOWORK1+2      MOVE  THE   REST OF   THE  NUMBER         
         MVI   5(RF),C'%'                                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE COMMISSION RATE FILTER                                     *         
***********************************************************************         
         SPACE 1                                                                
VFCOM    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLI   ACTKUNT,C'3'        FILTER IS ONLY FOR UNIT 3                    
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NFA94  OPT/MAINT                                    
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NFA94),AC@NFA94                                     
         B     EXITOK                                                           
*                                                                               
         CLI   FVILEN,1                 L(DATA) > ONE BYTE?                     
         BNH   EXITNV                   NO, ERROR                               
         CLI   FVILEN,8                 L(DATA) > 8 BYTES?                      
         BH    EXITNV                   YES, ERROR                              
         ZIC   RF,FVXLEN                GET LENGTH OF DATA-1                    
         LA    RE,FVIFLD                                                        
         AR    RE,RF                    POINT TO LAST CHARACTER                 
         CLI   0(RE),C'%'               PERCENT SIGN?                           
         BNE   EXITNV                   NO, ERROR                               
         GOTO1 VCASHVAL,BODMCB,(X'84',FVIFLD),(RF)                              
         CLI   BODMCB,X'00'               VALID NUMBER?                         
         BNE   EXITNV                                                           
         CP    BODMCB+4(8),=P'1000000'    >= 100.0000%                          
         BNL   EXITNV                   YES, ERROR                              
*                                                                               
         ZAP   FLTIFLD(4),BODMCB+4(8)   STORE IN FILTER FIELD AS PACKED         
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DO FILTERING ON CMMISSION RATE PROFILE                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCOM   CLI   ACTKUNT,C'3'        THIS FILTER FOR UNIT 3 ONLY                  
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR DATE BALANCE BROUGHT FORWARD (FOR LIST SCREEN ONLY) *         
* FILTER SCREEN - 'ALL  ADDED OR PEELED'                                        
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BBFWD    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BBFTB                                                         
         B     ITER                                                             
*                                                                               
BBFTB    DC    AL1(DDIS),AL1(0,0,0),AL4(DISBBF)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISBBF) *FOR REPORT                    
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFBBF)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFBBF)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFBBF)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY DATE BALANCE BROUGHT FORWARD ON LIST SCREEN                           
***********************************************************************         
         SPACE 1                                                                
DISBBF   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         GOTO1 VDATCON,BODMCB,(1,RSTBDATE),(5,FVIFLD)                           
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BALANCE BROUGHT FORWARD FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DFBBF    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         GOTO1 VDATCON,BODMCB,(1,FLTIFLD),(5,FVIFLD)                            
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BALANCE BROUGHT FORWARD FILTER                             *         
* STORE FILTER AS A 3 BYTE PACKED DATE IN FLTIFLD                               
***********************************************************************         
         SPACE 1                                                                
VFBBF    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         XC    BOWORK1,BOWORK1                                                  
         ZIC   RF,FVILEN                                                        
         GOTO1 VPERVAL,BOPARM,((RF),FVIFLD),BOWORK1                             
         CLI   BOPARM+4,X'01'                                                   
         BE    EXITNV                                                           
         USING PERVALD,R1                                                       
         LA    R1,BOWORK1                                                       
         MVC   FLTIFLD(L'PVALPSTA),PVALPSTA                                     
         B     EXITOK                                                           
         DROP  R1                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON BALANCE BROUGHT FORWARD FILTER                      *         
***********************************************************************         
         SPACE 1                                                                
DOFBBF   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLC   RSTBDATE,FLTIFLD                                                 
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACTIVITY DATE (FOR LIST SCREEN ONLY)                *         
* FILTER SCREEN - 'ALL  LAST TRANSACTION'                             *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ACTDT    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,ADTTB                                                         
         B     ITER                                                             
*                                                                               
ADTTB    DC    AL1(DDIS),AL1(0,0,0),AL4(DISADT)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISADT)   *FOR REPORT                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFADT)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFADT)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFADT)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACTIVITY DATE ON LIST SCREEN                                          
***********************************************************************         
         SPACE 1                                                                
DISADT   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISADTX                                                          
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         GOTO1 VDATCON,BODMCB,(1,RSTTDATE),(5,FVIFLD)                           
*                                                                               
DISADTX  B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACTIVITY DATE FILTER                                        *         
***********************************************************************         
         SPACE 1                                                                
DFADT    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         GOTO1 VDATCON,BODMCB,(1,FLTIFLD),(5,FVIFLD)                            
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACTIVITY DATE FILTER                                       *         
* STORE FILTER AS A 3 BYTE PACKED DATE IN FLTIFLD                               
***********************************************************************         
         SPACE 1                                                                
VFADT    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         XC    BOWORK1,BOWORK1                                                  
         ZIC   RF,FVILEN                                                        
         GOTO1 VPERVAL,BOPARM,((RF),FVIFLD),BOWORK1                             
         CLI   BOPARM+4,X'01'                                                   
         BE    EXITNV                                                           
         USING PERVALD,R1                                                       
         LA    R1,BOWORK1                                                       
         MVC   FLTIFLD(L'PVALPSTA),PVALPSTA                                     
         B     EXITOK                                                           
         DROP  R1                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACTIVITY DATE FILTER                                *         
***********************************************************************         
         SPACE 1                                                                
DOFADT   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLC   RSTTDATE,FLTIFLD                                                 
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR LAST CHANGED DATE (FOR LIST SCREEN ONLY)            *         
* FILTER SCREEN - 'ALL  LAST CHANGED'                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CHADT    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CHATB                                                         
         B     ITER                                                             
*                                                                               
CHATB    DC    AL1(DDIS),AL1(0,0,0),AL4(DISCDT)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCDT)   *FOR REPORT                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCDT)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCDT)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCDT)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY LAST CHANGED DATE ON LIST SCREEN                                      
***********************************************************************         
         SPACE 1                                                                
DISCDT   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RACELQ',ACTRECD),       +        
               (L'RACTYPE,=AL1(RACTCHA))                                        
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42  DISPLAY '(NONE)'                    
         B     EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RACELD,RF                                                        
         GOTO1 VDATCON,BODMCB,(1,RACDATE),(5,FVIFLD)                            
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY LAST CHANGED DATE FILTER                                    *         
***********************************************************************         
         SPACE 1                                                                
DFCDT    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         GOTO1 VDATCON,BODMCB,(1,FLTIFLD),(5,FVIFLD)                            
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE LAST CHANGED DATE FILTER                                   *         
* STORE FILTER AS A 3 BYTE PACKED DATE IN FLTIFLD                               
***********************************************************************         
         SPACE 1                                                                
VFCDT    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         XC    BOWORK1,BOWORK1                                                  
         ZIC   RF,FVILEN                                                        
         GOTO1 VPERVAL,BOPARM,((RF),FVIFLD),BOWORK1                             
         CLI   BOPARM+4,X'01'                                                   
         BE    EXITNV                                                           
         USING PERVALD,R1                                                       
         LA    R1,BOWORK1                                                       
         MVC   FLTIFLD(L'PVALPSTA),PVALPSTA                                     
         B     EXITOK                                                           
         DROP  R1                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON LAST CHANGED DATE FILTER                            *         
***********************************************************************         
         SPACE 1                                                                
DOFCDT   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RACELQ',ACTRECD),       +        
               (L'RACTYPE,=AL1(RACTCHA))                                        
         CLI   12(R1),0                                                         
         BNE   FLTXL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RACELD,RF                                                        
         CLC   RACDATE,FLTIFLD                                                  
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR LAST CHANGED BY (FOR LIST SCREEN ONLY)              *         
* FILTER SCREEN - 'ALL  LAST CHANGED BY'                              *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CHABY    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CHABYT                                                        
         B     ITER                                                             
*                                                                               
CHABYT   DC    AL1(DDIS),AL1(0,0,0),AL4(DISCBY)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCBY)   *FOR REPORT                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCBY)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCBY)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCBY)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY LAST CHANGED BY ON LIST SCREEN                                        
***********************************************************************         
         SPACE 1                                                                
DISCBY   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RACELQ',ACTRECD),       +        
               (L'RACTYPE,=AL1(RACTCHA))                                        
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42  DISPLAY '(NONE)'                    
         B     EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RACELD,RF                                                        
         GOTOX ('GETPID',AGROUTS),RACPERS                                       
         MVC   FVIFLD(8),BCWORK                                                 
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY LAST CHANGED BY FILTER                                      *         
***********************************************************************         
         SPACE 1                                                                
DFCBY    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(8),FLTIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE LAST CHANGED BY FILTER                                     *         
* STORE FILTER AS A 3 BYTE PACKED DATE IN FLTIFLD                               
***********************************************************************         
         SPACE 1                                                                
VFCBY    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON LAST CHANGED BY FILTER                              *         
***********************************************************************         
         SPACE 1                                                                
DOFCBY   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RACELQ',ACTRECD),       +        
               (L'RACTYPE,=AL1(RACTCHA))                                        
         CLI   12(R1),0                                                         
         BE    *+18                                                             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE   FILTERING ON 'NONE'?                
         BE    FLTXE                        YES-SO SHOW ACCT SINCE ELEM         
         B     FLTXL                        DOES NOT EXIST                      
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE   FILTERING ON 'NONE'?                
         BE    FLTXL                        DON'T SHOW THIS ACCT SINCE          
*                                           ELEM EXISTS.                        
         L     RF,12(R1)                                                        
         USING RACELD,RF                                                        
         GOTOX ('GETPID',AGROUTS),RACPERS                                       
         CLC   BCWORK(8),FLTIFLD                                                
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         B     FLTXL                                                            
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT LEVEL FILTER                                *         
* VALID ENTRIES ARE 1,2,3,4,1-2,1-3,2-3,2-4,3-4                       *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* GSRECKEY HOLDS KEY OF THE RECORD                                    *         
* GSRECSTA HOLDS STATUS                                               *         
***********************************************************************         
*                                                                               
DOFLTLV  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FLTLVTBL                                                      
         B     ITER                                                             
*                                                                               
FLTLVTBL DS    0H                                                               
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFLTLVLS)                              
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFLTLVLS)                              
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFTLVLS)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY A ACCOUNT LEVELS FILTER FIELD                               *         
***********************************************************************         
         SPACE 1                                                                
DFLTLVLS MVC   FVIFLD,BCSPACES                                                  
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         MVC   ALVLFLD,FVADDR                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACCOUNT LEVEL FILTER FIELD                                 *         
***********************************************************************         
         SPACE 1                                                                
VFLTLVLS XC    LVLFILT,LVLFILT                                                  
         CLI   FVILEN,0                                                         
         BE    EXITOK                                                           
*                                                                               
         CLI   FVILEN,1            INPUT MUST EITHER BE 1 OR 3 CHAR             
         BH    VFTLV10                                                          
         CLI   FVIFLD,C'1'                                                      
         BE    VFTLV50                                                          
         CLI   FVIFLD,C'2'                                                      
         BE    VFTLV50                                                          
         CLI   FVIFLD,C'3'                                                      
         BE    VFTLV50                                                          
         CLI   FVIFLD,C'4'                                                      
         BE    VFTLV50                                                          
         B     EXITNV                                                           
*                                                                               
VFTLV10  CLI   FVILEN,3            INPUT LEN NOT 1 MUST BE 3                    
         BNE   EXITL                                                            
         CLC   FVIFLD(3),=C'1-2'                                                
         BE    VFTLV50                                                          
         CLC   FVIFLD(3),=C'1-3'                                                
         BE    VFTLV50                                                          
         CLC   FVIFLD(3),=C'2-3'                                                
         BE    VFTLV50                                                          
         CLC   FVIFLD(3),=C'2-4'                                                
         BE    VFTLV50                                                          
         CLC   FVIFLD(3),=C'3-4'                                                
         BNE   EXITNV                                                           
*                                                                               
VFTLV50  ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         EXMVC R1,LVLFILT,FVIFLD   NEED TO SAVE HERE SINCE FILTER IS            
         B     EXITOK              DEFINED AS 'USER'-FLTIFLD NOT FILLED         
         SPACE 2                   IN WHEN EXECUTING FILTER.                    
***********************************************************************         
* DO FILTERING ON LEVELS                                              *         
* USER HAS THE FOLLOWING OPTIONS                                      *         
* 1) LEVEL=1   (MEANS SHOW 1ST LEVEL ACCOUNTS ONLY.                   *         
* 2) LEVEL=2   (MEANS SHOW 2ND LEVEL ACCOUNTS ONLY.                   *         
* 3) LEVEL=3   (MEANS SHOW 3RD LEVEL ACCOUNTS ONLY.                   *         
* 4) LEVEL=4   (MEANS SHOW 4TH LEVEL ACCOUNTS ONLY.                   *         
* 5) LEVEL=1-2 (MEANS SHOW ACCOUNTS ONLY ON FIRST AND SECOND LEVEL.   *         
* 6) ETC, ETC, ETC.                                                   *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,IOKEY                                                    
DOFTLVLS DS    0H                                                               
         CLI   LVLFILT+1,C'-'      FILTERING ON A RANGE OF LEVELS?              
         BE    DOFTLV40                                                         
         CLI   LVLFILT,C'1'        DOES USER WANT 1ST LEVEL?                    
         BNE   DOFTLV10                                                         
         ZIC   RE,LNLEV1           ONLY ONE CHECK NEEDED:                       
         LA    R1,T.ACTKACT(RE)    NEED TO MAKE SURE THERE IS NOTHING           
         ZIC   RF,LNLEV2           AT THE 2ND LEVEL                             
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXE               EQUAL TO SPACES SO 1ST LEVEL ACCT            
         B     FLTXL                                                            
*                                                                               
DOFTLV10 DS    0H                                                               
         CLI   LVLFILT,C'2'        DOES USER WANT 2ND LEVEL?                    
         BNE   DOFTLV20                                                         
         ZIC   RF,LNLEV2           MAKE SURE THERE IS A 2ND LEVEL               
         LTR   RF,RF                                                            
         BZ    FLTXL                                                            
         ZIC   RE,LNLEV1           2 CHECKS NEEDED:                             
         LA    R1,T.ACTKACT(RE)    1ST CHECK IS TO MAKE SURE THERE IS           
         SR    RF,RE               SOMETHING AT THE 2ND LEVEL                   
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES   IF NOTHING THERE SKIP THIS ACCOUNT           
         BNH   FLTXL                                                            
*                                                                               
         ZIC   RE,LNLEV2           2ND CHECK IS TO MAKE SURE THERE IS           
         LA    R1,T.ACTKACT(RE)    NOTHING AT THE 3RD LEVEL                     
         ZIC   RF,LNLEV3                                                        
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXE               EQUAL TO SPACES SO 2ND LEVEL ACCT            
         B     FLTXL                                                            
*                                                                               
DOFTLV20 DS    0H                                                               
         CLI   LVLFILT,C'3'        DOES USER WANT 3RD LEVEL?                    
         BNE   DOFTLV30                                                         
         ZIC   RF,LNLEV3           MAKE SURE THERE IS A 3RD LEVEL               
         LTR   RF,RF                                                            
         BZ    FLTXL                                                            
         ZIC   RE,LNLEV2           2 CHECKS NEEDED:                             
         LA    R1,T.ACTKACT(RE)    1ST CHECK IS TO MAKE SURE THERE IS           
         SR    RF,RE               SOMETHING AT THE 3RD LEVEL                   
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES   IF NOTHING THERE SKIP THIS ACCOUNT           
         BNH   FLTXL                                                            
*                                                                               
         ZIC   RE,LNLEV3           2ND CHECK IS TO MAKE SURE THERE IS           
         LA    R1,T.ACTKACT(RE)    NOTHING AT THE 4TH LEVEL                     
         ZIC   RF,LNLEV4                                                        
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXE               EQUAL TO SPACES SO 3RD LEVEL ACCT            
         B     FLTXL                                                            
*                                                                               
DOFTLV30 DS    0H                                                               
         CLI   LVLFILT,C'4'        DOES USER WANT 4TH LEVEL?                    
         BNE   DOFTLV40                                                         
         ZIC   RF,LNLEV4           MAKE SURE THERE IS A 4TH LEVEL               
         LTR   RF,RF                                                            
         BZ    FLTXL                                                            
         ZIC   RE,LNLEV3           ONLY ONE CHECK NEEDED:                       
         LA    R1,T.ACTKACT(RE)    NEED TO MAKE SURE THERE IS SOMETHING         
         SR    RF,RE               AT THE 4TH LEVEL                             
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXL               EQUAL TO SPACES SO NOT A 4TH LEVEL           
         B     FLTXE               ACCOUNT                                      
*                                                                               
* THIS IS THE CODE FOR MULTI LEVELS                                             
*                                                                               
DOFTLV40 CLC   LVLFILT(3),=C'1-2'  DOES USER WANT 1ST AND 2ND LEVEL?            
         BNE   DOFTLV50                                                         
         ZIC   RF,LNLEV3           CHECK IF THERE'S A 3RD LEVEL                 
         LTR   RF,RF               IF NOT THAN ALWAYS SHOW IT                   
         BZ    FLTXE                                                            
         ZIC   RE,LNLEV2           NOW CHECK TO MAKE SURE THERE IS              
         LA    R1,T.ACTKACT(RE)    NOTHING AT THE 3RD LEVEL                     
         ZIC   RF,LNLEV3                                                        
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXE               EQUAL TO SPACES SO 1ST OR 2ND LEVEL          
         B     FLTXL               ACCOUNT                                      
*                                                                               
DOFTLV50 CLC   LVLFILT(3),=C'1-3'  DOES USER WANT 1ST, 2ND & 3RD LVLS?          
         BNE   DOFTLV60                                                         
         ZIC   RF,LNLEV4           CHECK IF THERE'S A 4TH LEVEL                 
         LTR   RF,RF               IF NOT THAN ALWAYS SHOW IT                   
         BZ    FLTXE                                                            
         ZIC   RE,LNLEV3           NOW CHECK TO MAKE SURE THERE IS              
         LA    R1,T.ACTKACT(RE)    NOTHING AT THE 4TH LEVEL                     
         ZIC   RF,LNLEV4                                                        
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXE               EQUAL TO SPACES SO 1ST, 2ND OR 3RD           
         B     FLTXL               LEVEL ACCOUNT                                
*                                                                               
DOFTLV60 CLC   LVLFILT(3),=C'2-3'  DOES USER WANT THE 2ND & 3RD LEVELS?         
         BNE   DOFTLV70                                                         
         ZIC   RF,LNLEV2           CHECK TO MAKE SURE IT IS AT LEAST A          
         LTR   RF,RF               2 LEVEL LEDGER                               
         BZ    FLTXL                                                            
         ZIC   RE,LNLEV1           2 CHECKS NEEDED:                             
         LA    R1,T.ACTKACT(RE)    NEED TO MAKE SURE THERE IS SOMETHING         
         ZIC   RF,LNLEV2           AT THE 2ND LEVEL                             
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXL               EQUAL TO SPACES SO 1ST LEVEL ACCT            
*                                                                               
         ZIC   RE,LNLEV3           IF NOT AT LEAST A 3RD LEVEL LEDGER           
         LTR   RE,RE               THAN ALWAYS SHOW IT                          
         BZ    FLTXE                                                            
         LA    R1,T.ACTKACT(RE)    2ND CHECK IS TO MAKE SURE THERE IS           
         ZIC   RF,LNLEV4           NOTHING AT THE 4TH LEVEL                     
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXE               EQUAL TO SPACES SO 3RD LEVEL ACCT            
         B     FLTXL                                                            
*                                                                               
DOFTLV70 CLC   LVLFILT(3),=C'2-4'  DOES USER WANT THE 2,3 & 4TH LVLS?           
         BNE   DOFTLV80                                                         
         ZIC   RF,LNLEV2           CHECK TO MAKE SURE IT IS AT LEAST A          
         LTR   RF,RF               2 LEVEL LEDGER                               
         BZ    FLTXL                                                            
         ZIC   RE,LNLEV1           1 CHECK NEEDED:                              
         LA    R1,T.ACTKACT(RE)    NEED TO MAKE SURE THERE IS SOMETHING         
         ZIC   RF,LNLEV2           AT THE 2ND LEVEL                             
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXL               EQUAL TO SPACES SO 1ST LEVEL ACCT            
         B     FLTXE                                                            
*                                                                               
DOFTLV80 CLC   LVLFILT(3),=C'3-4'  DOES USER WANT THE 3 & 4TH LVLS?             
         BNE   EXITOK                                                           
         ZIC   RF,LNLEV3           CHECK TO MAKE SURE IT IS AT LEAST A          
         LTR   RF,RF               3 LEVEL LEDGER                               
         BZ    FLTXL                                                            
         ZIC   RE,LNLEV2           ONE CHECK NEEDED:                            
         LA    R1,T.ACTKACT(RE)    NEED TO MAKE SURE THERE IS SOMETHING         
         ZIC   RF,LNLEV3                                                        
         SR    RF,RE                                                            
         BCTR  RF,0                AT THE 3RD LEVEL                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNH   FLTXL               EQUAL TO SPACES SO NOT A 3RD OR 4TH          
         B     FLTXE               LEVEL ACCOUNT                                
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT NAME                                        *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
***********************************************************************         
*                                                                               
ACCNAME  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,ACCNMTBL                                                      
         B     ITER                                                             
*                                                                               
ACCNMTBL DS    0H                                                               
         DC    AL1(DDIS),AL1(0,0,0),AL4(DISNAM)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISNAM)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALNAM)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFNAM)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFNAM)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFNAM)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY A NAME                                                      *         
***********************************************************************         
         SPACE 1                                                                
DISNAM   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         LR    R1,R2               A(ACTRECD)                                   
         GOTO1 AGETNAM                                                          
         BRAS  RE,CKLOPRO                                                       
         B     EXITOK                                                           
         SPACE 1                                                                
***********************************************************************         
* VALIDATE A NAME                                                     *         
***********************************************************************         
         SPACE 1                                                                
VALNAM   NI    BYTE2,X'FF'-NAM1CCHA                                             
         MVC   OLDNAME,BCSPACES                                                 
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('NAMELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VALNAM10                                                         
*                                                                               
         USING NAMELD,RF                                                        
         L     RF,12(,R1)                                                       
         ZIC   R1,NAMLN                                                         
         BCTR  R1,0                                                             
         EXMVC R1,OLDNAME,0(RF)                                                 
*                                                                               
VALNAM10 GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('NAMELQ',ACTRECD),0               
         CLI   FVIFLD,C' '         1ST CHAR CAN'T BE A SPACE                    
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$INVNM) INVALID NAME                              
         B     EXITL                                                            
         DROP  RF                                                               
*                                                                               
* USERS WOULD DELETE A RECORD IN =FILE BY RENAMING THE RECORD TO                
* 'DELETE'.  IN =NFILE THERE IS A DELETE ACTION SO WE DO NOT WANT               
* USERS TO RENAME A TON OF RECORDS TO DELETE ONLY TO REALIZE THAT               
* THEY ARE STILL ON THE FILE.                                                   
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@DEL                                                 
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$INVNM)    INVALID NAME                           
         B     EXITL                                                            
*                                                                               
         XC    BOWORK2,BOWORK2                                                  
         LA    R3,BOWORK2          BUILD A NAMEL                                
         USING NAMELD,R3                                                        
         MVI   NAMEL,NAMELQ                                                     
         IC    RE,FVILEN                                                        
         LA    RE,NAMLN1Q(RE)                                                   
         STC   RE,NAMLN                                                         
         MVC   NAMEREC,FVIFLD                                                   
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),NAMELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         ZIC   RF,FVXLEN                                                        
         LA    RE,OLDNAME+NAMLN1Q                                               
         EXCLC RF,FVIFLD,0(RE)                                                  
         BE    EXITOK                                                           
         OI    BYTE2,NAM1CCHA       SET BIT FOR P&L POINTERS                    
         CLI   CSACT,A#CHA         IF ACTION CHANGE AND NAME HAS                
         BNE   EXITOK              CHANGED WRITE POINTER RECORD                 
         GOTO1 ANAMCHA,ACTRECD     WRITE NAME CHANGE POINTER X'31' REC          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY AN ACCOUNT NAME FILTER                                      *         
***********************************************************************         
         SPACE 1                                                                
DFNAM    MVC   FVIFLD,BCSPACES                                                  
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         MVC   ANAMFLD,FVADDR                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE AN ACCOUNT NAME FILTER                                     *         
***********************************************************************         
         SPACE 1                                                                
VFNAM    ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACCOUNT NAME                                        *         
* READ ACCT NAME SEARCH POINTERS FOR SEARCH WORD AND COMPARE TO       *         
* ACCOUNTS IN LIST                                                    *         
***********************************************************************         
         SPACE 1                                                                
         USING SRCRECD,R3                                                       
DOFNAM   MVC   SVKEY,IOKEY         SAVE KEY OF ACCOUNT RECORD                   
         NI    BYTE,X'FF'-OKSEARCH                                              
         OC    FLTIFLD,BCSPACES                                                 
         MVC   BOWORK1,BCSPACES                                                 
         GOTO1 VPARSNIP,BOPARM,('FILTLN',FLTIFLD),('FILTLN',BLOCK),    +        
               ('PSNNONLQ',PDSEP)                                               
         CLI   8(R1),0                                                          
         BNE   FLTXX                                                            
         USING PSND,R4                                                          
         LA    R4,BLOCK                                                         
*                                                                               
DOFNM50  LA    RE,WORDTAB          POINT TO INSIGNIFICANT WORD TABLE            
         L     RF,PSNCOMP          POINT TO SEARCH WORD                         
DOFNM52  CLI   0(RE),X'FF'                                                      
         BE    DOFNM60                                                          
         ZIC   R1,PSNLEN                                                        
         BCTR  R1,0                                                             
         EXCLC R1,0(RF),1(RE)                                                   
         BE    DOFNM54             IGNORE THIS SEARCH WORD                      
         ZIC   R1,0(RE)            BUMP TO NEXT ENTRY                           
         AR    RE,R1                                                            
         LA    RE,1(RE)            BUMP PAST LENGTH TOO                         
         B     DOFNM52                                                          
*                                                                               
DOFNM54  OC    PSNFLD,PSNFLD       IS THERE ANOTHER WORD TO SEARCH FOR?         
         BZ    *+12                                                             
         LA    R4,PSNL(R4)         BUMP TO NEXT PARSNIP LINE                    
         B     DOFNM50                                                          
         TM    BYTE,OKSEARCH        IS THERE 1 WORD THAT'S OK FOR SRCH?         
         BO    DOFNAME                                                          
         B     DOFNAML                                                          
*                                                                               
DOFNM60  LA    R3,IOKEY            READ ACCT NAME SEARCH POINTER                
         XC    SRCKEY,SRCKEY                                                    
         MVI   SRCKTYP,SRCKTYPQ                                                 
         MVC   SRCKCPY,CUABIN                                                   
         MVC   SRCKUNT(L'SRCKUNT+L'SRCKLDG),ACTKUNT                             
         MVI   SRCKSUB,SRCKWDSQ    SUB TYPE '01'                                
         L     RF,PSNCOMP          RF POINTS TO SEARCH WORD                     
         ZIC   R1,PSNLEN           LENGTH OF SEARCH WORD                        
         BCTR  R1,0                                                             
         EXMVC R1,SRCKWRD1,0(RF)      FILL IN SEARCH WORD                       
         OC    SRCKWRD1,BCSPACES                                                
         LHI   R1,XOHIGH+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         CLC   IOKEY(SRCKSEQ1-SRCKEY),IOKEYSAV                                  
         BNE   DOFNAML                   NO MATCH FOR THIS WORD                 
         B     DOFNM100                                                         
DOFNM90  LHI   R1,XOSEQ+XOACCDIR+XIO2                                           
         GOTO1 AIO                                                              
         CLC   IOKEY(SRCKSEQ1-SRCKEY),IOKEYSAV                                  
         BNE   DOFNAML                   NO MATCH FOR THIS WORD                 
*                                                                               
DOFNM100 LA    R3,IOKEY                  FOUND A MATCH BUT NEED TO SEE          
         CLC   SRCKACT,ACTKACT           IF THIS IS FOR THE RIGHT ACCT          
         BNE   DOFNM90                   ACCT DOES NOT MATCH-READ NEXT          
*                                                                               
         OI    BYTE,OKSEARCH                                                    
         OC    PSNFLD,PSNFLD       IS THERE ANOTHER WORD TO SEARCH FOR?         
         BZ    DOFNAME             NO THAN ADD THIS ACCT TO THE LIST            
         LA    R4,PSNL(R4)               BUMP TO NEXT PARSNIP LINE              
         B     DOFNM50                   NO MORE WORDS SO EQUAL                 
*                                                                               
DOFNAML  MVC   IOKEY,SVKEY               RE-READ ACCOUNT KEY                    
         LHI   R1,XOREAD+XOACCDIR+XIO1                                          
         GOTO1 AIO                                                              
         B     FLTXL                                                            
*                                                                               
DOFNAME  MVC   IOKEY,SVKEY               RE-READ ACCOUNT KEY                    
         LHI   R1,XOREAD+XOACCDIR+XIO1                                          
         GOTO1 AIO                                                              
         B     FLTXE                                                            
*                                                                               
PDSEP    DC    AL1(1),C'='                                                      
         DC    AL1(1),C' '                                                      
         DC    AL1(1),C' '                                                      
         DC    AL1(1),C' '                                                      
*                                                                               
WORDTAB  DC    AL1(3),C'AND'                                                    
         DC    AL1(3),C'THE'                                                    
         DC    AL1(2),C'OF'                                                     
         DC    AL1(2),C'IN'                                                     
         DC    AL1(2),C'ON'                                                     
         DC    AL1(2),C'TO'                                                     
         DC    X'FF'                                                            
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR LEVEL FIELD                                         *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
GETLVL   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,LVLTABL                                                       
         B     ITER                                                             
*                                                                               
LVLTABL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISLVL)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY LEVEL                                                       *         
***********************************************************************         
         SPACE 1                                                                
DISLVL   MVC   FVIFLD(L'SVLEVEL),SVLEVEL                                        
         B     EXITOK                                                           
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR DUE DATE FORMULA                                    *         
* VALID FOR SV,SX,SW,SY FOR USA AND CANADA                            *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
DUEDF    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,DUEDFTB                                                       
         B     ITER                                                             
*                                                                               
DUEDFTB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISDDF)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISDDF)   *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALDDF)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFDDF)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFDDF)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFDDF)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY THE DUE DATE FORMULA FOR PAYABLES                                     
* VALID AT HIGHER LEVELS                                                        
***********************************************************************         
         SPACE 1                                                                
DISDDF   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF                                                       
         CLI   LEVELBIT,0          HAS THE PROFILE BEEN FOUND ON                
         BNE   DSDDFX              ANY LEVEL? YES                               
         MVC   FVIFLD(L'AC@NO),AC@NO SET DEFAULT IN SETTING FLD                 
*                                                                               
DSDDFX   DS    0H                                                               
         MVI   SBYTE,VENDINV       MOVE IN VENDOR INVOICE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE DUE DATE FORMULA                                           *         
***********************************************************************         
         SPACE 1                                                                
VALDDF   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VENDINV       MOVE IN VENDOR INVOICE SEC #                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VDUEX                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('DEXELQ',ACTRECD),0               
         CLI   FVILEN,0            ANY INPUT?                                   
         BE    VDUEX                                                            
*                                                                               
T        USING DEXELD,BOELEM       DUMMY DUE DATE ELEMENT                       
         XC    T.DEXEL(DEXLNQ),T.DEXEL                                          
         MVI   T.DEXEL,DEXELQ                                                   
         MVI   T.DEXLN,DEXLNQ                                                   
*                                                                               
         LA    R1,BOWORK1                                                       
         USING CONBLKD,R1                                                       
         XC    CONBLK(CONBLKL),CONBLK                                           
         MVI   CONACTN,CONAVALQ    VALIDATE INPUT EXPRESSION                    
         MVI   CONFLD,CONFIDUE     DUE DATE EXPRESSION                          
         MVC   CONILEN,FVILEN      LENGTH OF INPUT                              
         LA    RF,T.DEXVAL                                                      
         STCM  RF,15,CONOADD                                                    
         LA    RF,FVIFLD                                                        
         STCM  RF,15,CONIADD                                                    
         MVC   CONCOMF,ACOM                                                     
         GOTO1 VCNVERT             TRANSLATED BY CONVERT                        
*                                                                               
         CLI   CONERR,0                                                         
         BNE   VDUEDID             CONVERT ERROR                                
         CLI   T.DEXVAL,1                                                       
         BE    VDUEDID             DATE (RATHER THAN FORMULA)                   
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),ACTRECD,T.DEXELD                   
         CLI   12(R1),0                                                         
         BE    VDUEX                                                            
         DC    H'0'                                                             
*                                                                               
VDUEDID  MVC   FVMSGNO,=AL2(AE$INDAT) INVALID DATE                              
         B     EXITL                                                            
*                                                                               
VDUEX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R1,T                                                             
         SPACE 2                                                                
***********************************************************************         
* DISPLAY DUE DATE FILTER                                             *         
***********************************************************************         
         SPACE 1                                                                
DFDDF    MVC   FVIFLD,BCSPACES                                                  
         CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE DUE DATE FORMULA FILTER                                    *         
***********************************************************************         
         SPACE 1                                                                
VFDDF    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         MVC   FLTIFLD,BCSPACES                                                 
*                                                                               
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SV'   VALID FOR                  
         BL    ERRFILT                               SV,SW,SX,SY ONLY           
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
         CLI   FVIFLD,C'N'              ENTERED NO?                             
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
*                                                                               
         LA    R1,BOWORK1                                                       
         USING CONBLKD,R1                                                       
         XC    CONBLK(CONBLKL),CONBLK                                           
         MVI   CONACTN,CONAVALQ    VALIDATE INPUT EXPRESSION                    
         MVI   CONFLD,CONFIDUE     DUE DATE EXPRESSION                          
         MVC   CONILEN,FVILEN      LENGTH OF INPUT                              
         LA    RF,FLTIFLD                                                       
         STCM  RF,15,CONOADD                                                    
         LA    RF,FVIFLD                                                        
         STCM  RF,15,CONIADD                                                    
         MVC   CONCOMF,ACOM                                                     
         GOTO1 VCNVERT             TRANSLATED BY CONVERT                        
*                                                                               
         CLI   CONERR,0                                                         
         BNE   VDUEDID2            CONVERT ERROR                                
         CLI   FLTIFLD,1                                                        
         BE    VDUEDID             DATE (RATHER THAN FORMULA)                   
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
*                                                                               
VDUEDID2 MVC   FVMSGNO,=AL2(AE$INDAT) INVALID DATE                              
         B     EXITL                                                            
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR DUE DATE FORMULA                                   *         
***********************************************************************         
         SPACE 1                                                                
DOFDDF   BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR BANK AND BRANCH CODE (ON SC)                        *         
* AFM:   BANK/BRANCH CODE                                             *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BNKCD    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BNKCDTBL                                                      
         B     ITER                                                             
*                                                                               
BNKCDTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DBBC)                                   
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DBBC)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VBBC)                                   
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFBBCF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFBBCF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFBBCF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK/BRANCH CODE                                            *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DBBC     BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DBBC10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DBBCX                                                            
*                                                                               
DBBC10   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DBBC20              NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING CBPFELD,RF                                                       
         CLC   CBPBCDE,BCSPACES                                                 
         BNH   DBBC20              NO BANK ACCCT - SHOW DEFAULT                 
         MVC   FVIFLD(L'CBPBCDE+L'CBPBRCH),CBPBCDE                              
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DBBCX                                                            
*                                                                               
DBBC20   MVC   FVIFLD(L'AC@NFA42),AC@NFA42                                      
*                                                                               
DBBCX    MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SEC NUMBER                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         TM    CUSTAT,CUSDDS       IF NOT A DDS TERMINAL PROTECT THE            
         BO    *+8                 FIELD - EVEN IF WRITE/READ ACCESS            
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK/BRANCH CODE                                           *         
***********************************************************************         
         SPACE 1                                                                
VBBC     NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VBBCX                                                            
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBBC10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VBBCX                                                            
*                                                                               
VBBC10   NI    BYTE4,X'FF'-(SCBCDF+SCBACCF)                                     
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VBBC20                                                           
         L     R3,12(R1)                                                        
         USING CBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    CBPBCDE,CBPBCDE     ANY BANK/BRANCH CODE FOUND IN ELEM?          
         BZ    *+8                                                              
         OI    BYTE4,SCBCDF                                                     
         OC    CBPBACC,CBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE4,SCBACCF                                                    
         XC    CBPBCDE,CBPBCDE                                                  
         XC    CBPBRCH,CBPBRCH                                                  
         ZIC   R1,CBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('CBPELQ',ACTRECD),0               
*                                                                               
VBBC20   CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VBBC30              NO                                           
         MVC   BCWORK,BCSPACES                                                  
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,BCWORK,FVIFLD                                                 
         BRAS  RE,VALBANK                                                       
         BNE   EXITNV                                                           
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VBBC40                                                           
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBCDE,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VBBCX                                                            
*                                                                               
* NO BANK/BRANCH CODE ENTERED                                                   
VBBC30   TM    BYTE4,SCBACCF                IF ANY OTHER SETTINGS EXIST         
         BZ    VBBCX                                                            
         B     VBBC50                       MUST PUT BACK ELEMENT               
*                                                                               
VBBC40   LA    R3,BOELEM                                                        
         USING CBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   CBPEL,CBPELQ                                                     
         MVI   CBPLN,CBPLN1Q                                                    
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBCDE,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),CBPFELD,0                     
         CLI   12(R1),0                                                         
         BE    VBBCX                                                            
         DC    H'0'                                                             
*                                                                               
VBBC50   GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VBBCX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
*&&DO                                                                           
* THIS ROUTINE ALWAYS VALIDATES THE BANK/BRANCH CODE AND SETS THE               
* PROFBNK BIT IF NO BANK/BRANCH CODE ENTERED TO CHECK WHEN VALIDATING           
* THE BANK ACCT NUMBER.  COULD NOT USE THIS B/C OF COOMBE WHICH NEEDS           
* A BANK/BRANCH CODE BUT NOT THE BANK ACCT NUMBER.                              
***********************************************************************         
* VALIDATE BANK/BRANCH CODE                                           *         
***********************************************************************         
         SPACE 1                                                                
VBBC     NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         NI    BYTE4,X'FF'-PROFBNK                                              
         BRAS  RE,VALSET                                                        
*        BE    EXITOK                            EVEN IF THERE IS NO            
         BNE   VBBC05                            CHANGE VALIDATE IF SET         
         CLC   FVIFLD(L'AC@NFA42),AC@NFA42       B/C OF THE                     
         BE    EXITOK                            BANK ACCT ROUTINE              
*                                                                               
VBBC05   MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VBBCX                                                            
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBBC10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VBBCX                                                            
*                                                                               
VBBC10   NI    BYTE4,X'FF'-(SCBCDF+SCBACCF)                                     
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VBBC20                                                           
         L     R3,12(R1)                                                        
         USING CBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    CBPBCDE,CBPBCDE     ANY BANK/BRANCH CODE FOUND IN ELEM?          
         BZ    *+8                                                              
         OI    BYTE4,SCBCDF                                                     
         OC    CBPBACC,CBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE4,SCBACCF                                                    
         XC    CBPBCDE,CBPBCDE                                                  
         XC    CBPBRCH,CBPBRCH                                                  
         ZIC   R1,CBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('CBPELQ',ACTRECD),0               
*                                                                               
VBBC20   CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VBBC30              NO                                           
         MVC   BCWORK,BCSPACES                                                  
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,BCWORK,FVIFLD                                                 
         BRAS  RE,VALBANK                                                       
         BNE   EXITNV                                                           
         OI    BYTE4,PROFBNK                                                    
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VBBC40                                                           
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBCDE,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VBBCX                                                            
*                                                                               
* NO BANK/BRANCH CODE ENTERED                                                   
VBBC30   TM    BYTE4,SCBACCF                IF ANY OTHER SETTINGS EXIST         
         BZ    VBBCX                                                            
         B     VBBC50                       MUST PUT BACK ELEMENT               
*                                                                               
VBBC40   LA    R3,BOELEM                                                        
         USING CBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   CBPEL,CBPELQ                                                     
         MVI   CBPLN,CBPLN1Q                                                    
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBCDE,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),CBPFELD,0                     
         CLI   12(R1),0                                                         
         BE    VBBCX                                                            
         DC    H'0'                                                             
*                                                                               
VBBC50   GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VBBCX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
*&&                                                                             
***********************************************************************         
* DISPLAY BANK/BRANCH CODE FILTER FOR SC                              *         
***********************************************************************         
         SPACE 1                                                                
DFBBCF   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK/BRANCH CODE FILTER FOR SC                             *         
***********************************************************************         
         SPACE 1                                                                
VFBBCF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLC   =C'SC',ACTKUNT      FILTER IS FOR SC ONLY                        
         BNE   ERRFILT                                                          
         CLC   FVIFLD(L'AC@NTAVL),AC@NTAVL    'N/A' IS NOT VALID                
         BE    EXITNV                                                           
         CLC   FVIFLD(L'AC@NONE),AC@NONE      'NONE' ENTERED?                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         MVC   FLTIFLD,FVIFLD                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON BANK/BRANCH CODE FILTER FOR SC                      *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFBBCF  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING CBPFELD,RF                                                       
         CLC   CBPBCDE,BCSPACES    ANY BANK/BRANCH CODE?                        
         BH    *+18                YES                                          
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  BANK/BR FOUND SO IF FLTRNG           
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,L'CBPBCDE+L'CBPBRCH     MAX FILTER LENGTH                     
         LA    RE,FLTIFLD+L'CBPBCDE+L'CBPBRCH-1   POINT TO LAST CHAR            
DOFBBC10 CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOFBBC20                 VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOFBBC10                                                      
         B     FLTXL                                                            
*                                                                               
DOFBBC20 BCTR  R1,0                                                             
         EXCLC R1,CBPBCDE,FLTIFLD                                               
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR BANK ACCOUNT NUMBER (ON SC) PAYER'S B/A #           *         
* AFM:   BANK ACCOUNT                                                 *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BSCACC   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BSCATBL                                                       
         B     ITER                                                             
*                                                                               
BSCATBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DSBNKAC)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSBNKAC)  * FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VSBNKAC)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFSCBA)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFSCBA)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFSCBA)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK ACCOUNT ON SC                                          *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DSBNKAC  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DSBNKA10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DSBNKAX                                                          
*                                                                               
DSBNKA10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DSBNKA20            NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING CBPFELD,RF                                                       
         CLC   CBPBACC,BCSPACES                                                 
         BNH   DSBNKA20            NO BANK ACCOUNT- SHOW DEFAULT                
         MVC   FVIFLD(L'CBPBACC),CBPBACC                                        
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DSBNKAX                                                          
*                                                                               
DSBNKA20 MVC   FVIFLD(L'AC@NFA42),AC@NFA42                                      
*                                                                               
DSBNKAX  MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SEC NUMBER                 
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         TM    CUSTAT,CUSDDS       IF NOT A DDS TERMINAL PROTECT THE            
         BO    *+8                 FIELD - EVEN IF WRITE/READ ACCESS            
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ACCOUNT CODE ON SC                                    *         
***********************************************************************         
         SPACE 1                                                                
VSBNKAC  NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VSBNKAX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VSBNKA10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VSBNKAX                                                          
*                                                                               
VSBNKA10 NI    BYTE4,X'FF'-(SCBCDF+SCBACCF)                                     
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VSBNKA20                                                         
         L     R3,12(R1)                                                        
         USING CBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    CBPBCDE,CBPBCDE     ANY BANK/BRANCH CODE IN ELEM?                
         BZ    *+8                                                              
         OI    BYTE4,SCBCDF                                                     
         OC    CBPBACC,CBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE4,SCBACCF                                                    
         XC    CBPBACC,CBPBACC                                                  
         ZIC   R1,CBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('CBPELQ',ACTRECD),0               
*                                                                               
VSBNKA20 CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VSBNKA30            NO                                           
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VSBNKA40                                                         
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBACC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VSBNKAX                                                          
*                                                                               
* NO BANK CODE ENTERED                                                          
VSBNKA30 TM    BYTE4,SCBCDF                 IF ANY OTHER SETTINGS EXIST         
         BZ    VSBNKAX                                                          
         B     VSBNKA50                     MUST PUT BACK ELEMENT               
*                                                                               
VSBNKA40 LA    R3,BOELEM                                                        
         USING CBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   CBPEL,CBPELQ                                                     
         MVI   CBPLN,CBPLN1Q                                                    
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBACC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),CBPFELD,0                     
         CLI   12(R1),0                                                         
         BE    VSBNKAX                                                          
         DC    H'0'                                                             
*                                                                               
VSBNKA50 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VSBNKAX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
*&&DO                                                                           
* THIS ROUTINE CHECKS THE PROFBNK BIT TO SEE WHETHER TO VALIDATE WHEN           
* A BANK/BRANCH IS NOT ENTERED.  COULD NOT USE THIS B/C OF COOMBE WHICH         
* DOES USES A BANK/BRANCH CODE BUT DOES NOT USE A BANK ACCT NUMBER.             
***********************************************************************         
* VALIDATE BANK ACCOUNT CODE ON SC                                    *         
***********************************************************************         
         SPACE 1                                                                
VSBNKAC  NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         TM    BYTE4,PROFBNK       IF BANK/BRANCH ENTERED THEN NEED             
         BZ    VSBNKA5             BANK ACCT TOO                                
         CLI   FVILEN,0                                                         
         BE    EXITNO                                                           
         CLC   FVIFLD(L'AC@NFA42),AC@NFA42                                      
         BE    EXITNO                                                           
VSBNKA5  BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VSBNKAX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VSBNKA10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VSBNKAX                                                          
*                                                                               
VSBNKA10 NI    BYTE4,X'FF'-(SCBCDF+SCBACCF)                                     
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VSBNKA20                                                         
         L     R3,12(R1)                                                        
         USING CBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    CBPBCDE,CBPBCDE     ANY BANK/BRANCH CODE IN ELEM?                
         BZ    *+8                                                              
         OI    BYTE4,SCBCDF                                                     
         OC    CBPBACC,CBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE4,SCBACCF                                                    
         XC    CBPBACC,CBPBACC                                                  
         ZIC   R1,CBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('CBPELQ',ACTRECD),0               
*                                                                               
VSBNKA20 CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VSBNKA30            NO                                           
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VSBNKA40                                                         
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBACC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VSBNKAX                                                          
*                                                                               
* NO BANK CODE ENTERED                                                          
VSBNKA30 TM    BYTE4,SCBCDF                 IF ANY OTHER SETTINGS EXIST         
         BZ    VSBNKAX                                                          
*        B     VSBNKA50                     MUST PUT BACK ELEMENT               
         B     EXITNO                                                           
*                                                                               
VSBNKA40 LA    R3,BOELEM                                                        
         USING CBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   CBPEL,CBPELQ                                                     
         MVI   CBPLN,CBPLN1Q                                                    
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,CBPBACC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),CBPFELD,0                     
         CLI   12(R1),0                                                         
         BE    VSBNKAX                                                          
         DC    H'0'                                                             
*                                                                               
VSBNKA50 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VSBNKAX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
*&&                                                                             
***********************************************************************         
* DISPLAY BANK ACCOUNT FOR SC FILTER                                  *         
***********************************************************************         
         SPACE 1                                                                
DFSCBA   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ACCOUNT FOR SC FILTER                                 *         
***********************************************************************         
         SPACE 1                                                                
VFSCBA   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLC   =C'SC',ACTKUNT      FILTER IS FOR SC ONLY                        
         BNE   ERRFILT                                                          
         CLC   FVIFLD(L'AC@NONE),AC@NONE      'NONE' ENTERED?                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         MVC   FLTIFLD,FVIFLD                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON BANK ACCOUNT FOR SC                                 *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFSCBA  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DOFSC05             NO ELEMENT FOUND                             
         L     RF,12(R1)                                                        
         USING CBPFELD,RF                                                       
         CLC   CBPBACC,BCSPACES    ANY BANK ACCOUNT?                            
         BH    *+18                YES                                          
DOFSC05  CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  BANK ACCT FOUND SO IF FLTRNG         
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,FILTLN                MAX FILTER LENGTH                       
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)          POINT TO LAST CHAR                      
DOFSC10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOFSC20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOFSC10                                                       
         B     FLTXL                                                            
*                                                                               
DOFSC20  BCTR  R1,0                                                             
         EXCLC R1,CBPBACC,FLTIFLD                                               
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*SPEC-46491                                                                     
***********************************************************************         
* DATA OBJECT FOR FREEFORM TEXT FIELD (ON SC)                         *         
* AFM:   BANK ACCOUNT                                                 *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BSCFFT1  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BSCF1TBL                                                      
         B     ITER                                                             
*                                                                               
BSCF1TBL DC    AL1(DDIS),AL1(0,0,0),AL4(DSCFFT1)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DSCFFT1)  * FOR REPORT                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VSCFFT1)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFSCFFT)                               
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFSCFFT)                               
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFSCFF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK ACCOUNT ON SC                                          *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DSCFFT1  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV               VALIDATE THIS IS LOWEST LEVEL           
         BE    DSCFFT1C                 VALID TO SHOW AT THIS LVL               
         MVC   FVIFLD(L'AC@NA),AC@NA    SHOW 'N/A'                              
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT           IF NOT PROTECT FIELD AND XIT            
         B     DSCFFT1X                                                         
*                                                                               
DSCFFT1C GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',ACTRECD),       X        
               (L'FFTTYPE,=AL1(FFTTSCTX))                                       
         CLI   12(R1),0                                                         
         BNE   DSCFFT1H            NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
                                                                                
         L     R4,SVPARMS2                                                      
         LA    R3,FFTXSCF1                                                      
         CLM   R4,3,=AL2(ACC#SCFFT1)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF2                                                      
         CLM   R4,3,=AL2(ACC#SCFFT2)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF3                                                      
         CLM   R4,3,=AL2(ACC#SCFFT3)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF4                                                      
         CLM   R4,3,=AL2(ACC#SCFFT4)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF5                                                      
         CLM   R4,3,=AL2(ACC#SCFFT5)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF6                                                      
         CLM   R4,3,=AL2(ACC#SCFFT6)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF7                                                      
         CLM   R4,3,=AL2(ACC#SCFFT7)                                            
         BE    DSCFFT1E                                                         
         LA    R3,FFTXSCF8                                                      
         CLM   R4,3,=AL2(ACC#SCFFT8)                                            
         BE    DSCFFT1E                                                         
                                                                                
DSCFFT1E MVC   FVIFLD(L'FFTXSCF1),0(R3)                                         
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DSCFFT1X                                                         
         DROP  RF                                                               
*                                                                               
DSCFFT1H DS    0H                  IF NO ELEMENT FOUND FIELD IS BLANK           
*                                                                               
DSCFFT1X DS    0H                                                               
         MVI   SBYTE,BANKPROF      MOVE IN CASH RECONCILIATION SEC #            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         TM    CUSTAT,CUSDDS       IF NOT A DDS TERMINAL PROTECT THE            
         BO    *+8                 FIELD - EVEN IF WRITE/READ ACCESS            
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ACCOUNT CODE ON SC                                    *         
***********************************************************************         
         SPACE 1                                                                
VSCFFT1  NI    FVATRB,X'FF'-FVAPROT                                             
***      BRAS  RE,VALSET                     CHK IF SETTING HAS CHA             
***      BE    EXITOK                        NO CHANGE                          
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN CASH RECONCILIATION SEC #            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VSCFFT1X                                                         
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VSCFFT1A                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VSCFFT1X                                                         
*                                                                               
VSCFFT1A DS    0H                                                               
*        CLI   FVILEN,0            ANYTHING ENTERED?                            
*        BE    VSCFFT1X            NO                                           
*                                                                               
         USING FFTELD,R3                                                        
         LA    R3,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   FFTEL,FFTELQ             DB ELEMENT CODE                         
         MVI   FFTLN,FFTXSCQ2              ELEMENT LENGTH                       
         MVI   FFTTYPE,FFTTSCTX            FREEFORM TEXT ELEMENT                
         MVI   FFTDLEN,FFTXSCQ1            DATA LENGTH                          
***      MVC   FFTDATA(FFTXSCQ1),BCSPACES                                       
         MVC   FFTXSCF1(4*L'FFTXSCF1),BCSPACES                                  
         MVC   FFTXSCF5(4*L'FFTXSCF1),BCSPACES                                  
*                                                                               
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',ACTRECD),       *        
               (L'FFTTYPE,=AL1(FFTTSCTX))                                       
         CLI   12(R1),0            ELEMENT FOUND                                
         BNE   VSCFFT1E                                                         
         L     R4,12(R1)                                                        
         MVC   BOELEM(FFTXSCQ2),0(R4)                                           
*                                                                               
VSCFFT1E DS    0H                                                               
         L     R4,SVPARMS2                  DATA IDENTIFIER                     
         LA    RF,FFTXSCF1                                                      
         CLM   R4,3,=AL2(ACC#SCFFT1)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF2                                                      
         CLM   R4,3,=AL2(ACC#SCFFT2)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF3                                                      
         CLM   R4,3,=AL2(ACC#SCFFT3)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF4                                                      
         CLM   R4,3,=AL2(ACC#SCFFT4)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF5                                                      
         CLM   R4,3,=AL2(ACC#SCFFT5)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF6                                                      
         CLM   R4,3,=AL2(ACC#SCFFT6)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF7                                                      
         CLM   R4,3,=AL2(ACC#SCFFT7)                                            
         BE    VSCFFT1H                                                         
         LA    RF,FFTXSCF8                                                      
         CLM   R4,3,=AL2(ACC#SCFFT8)                                            
         BE    VSCFFT1H                                                         
*                                                                               
VSCFFT1H MVC   0(L'FFTXSCF1,RF),FVIFLD                                          
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('FFTELQ',(R2)),          *        
               (L'FFTTYPE,=AL1(FFTTSCTX))                                       
*                                                                               
         LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),(R3),0                        
         CLI   12(R1),0                                                         
         BE    VSCFFT1X                                                         
         DC    H'0'                                                             
*                                                                               
VSCFFT1X BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
***********************************************************************         
* DISPLAY FREEFORM FIELDS FOR SC FILTER                               *         
***********************************************************************         
DFSCFFT  DS    0H                                                               
*        CLI   FLTIFLD,0                                                        
*        BE    EXITOK                                                           
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
*                                                                               
***********************************************************************         
* VALIDATE FREEFORM FIELDS FOR SC FILTER                              *         
***********************************************************************         
VFSCFFT  CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SC',ACTKUNT      FILTER IS FOR SC ONLY                        
         BNE   ERRFILT                                                          
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         MVC   FLTIFLD,FVIFLD                                                   
         B     EXITOK                                                           
*                                                                               
***********************************************************************         
* DO FILTERING ON FREEFORM FIELDS ON SC                               *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
DOFSCFF  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',ACTRECD),       X        
               (L'FFTTYPE,=AL1(FFTTSCTX))                                       
         CLI   12(R1),0                                                         
         BNE   DOFSCF05             NO ELEMENT FOUND                            
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
                                                                                
         L     R4,SVPARMS2                                                      
         LA    R3,FFTXSCF1                                                      
         CLM   R4,3,=AL2(ACC#SCFFT1)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF2                                                      
         CLM   R4,3,=AL2(ACC#SCFFT2)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF3                                                      
         CLM   R4,3,=AL2(ACC#SCFFT3)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF4                                                      
         CLM   R4,3,=AL2(ACC#SCFFT4)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF5                                                      
         CLM   R4,3,=AL2(ACC#SCFFT5)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF6                                                      
         CLM   R4,3,=AL2(ACC#SCFFT6)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF7                                                      
         CLM   R4,3,=AL2(ACC#SCFFT7)                                            
         BE    DOFSCF03                                                         
         LA    R3,FFTXSCF8                                                      
         CLM   R4,3,=AL2(ACC#SCFFT8)                                            
         BE    DOFSCF03                                                         
                                                                                
DOFSCF03 CLC   0(L'FFTXSCF1,R3),BCSPACES                                        
         BH    DOFSCF08                                                         
                                                                                
DOFSCF05 CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
DOFSCF08 CLC   FLTIFLD(L'AC@NONE),AC@NONE  BANK ACCT FOUND SO IF FLTRNG         
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,FILTLN                MAX FILTER LENGTH                       
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)          POINT TO LAST CHAR                      
DOFSCF10 CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOFSCF20                  VALIDATE                               
         BCTR  RE,0                                                             
         BCT   R1,DOFSCF10                                                      
         B     FLTXL                                                            
*                                                                               
DOFSCF20 BCTR  R1,0                                                             
         EXCLC R1,0(R3),FLTIFLD                                                 
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         LTORG                                                                  
         EJECT                                                                  
*SPEC-46491                                                                     
***********************************************************************         
* DATA OBJECT FOR BANK ACCOUNT NUMBER (ON PAYABLES)                   *         
* AFM:   BANK ACCOUNT NUMBER                                          *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BPYACC   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BPYACTBL                                                      
         B     ITER                                                             
*                                                                               
BPYACTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DPBNKAC)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DPBNKAC)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VPBNKAC)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFPYBA)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFPYBA)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFPYBA)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK ACCOUNT NUMBER (FOR PAYABLES)                          *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DPBNKAC  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DPBNKA10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DPBNKAX                                                          
*                                                                               
DPBNKA10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DPBNKA50            NO ELEM SHOW DEFAULT                         
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         CLC   VBPBACC,BCSPACES                                                 
         BNH   DPBNKA50            NO BANK ACCT - SHOW DEFAULT                  
         MVC   FVIFLD(L'VBPBACC),VBPBACC                                        
         TM    CUSTAT,CUSDDS       IS THIS A DDS TERMINAL?                      
         BZ    DPBNKA30                                                         
         LA    RE,L'VBPBACC        MAX LENGTH OF BANK ACCOUNT                   
         STC   RE,BCBYTE1                                                       
         BRAS  RE,HIDE             ENCRYPT THE FIELD WITH *'S                   
DPBNKA30 OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DPBNKAX                                                          
*                                                                               
DPBNKA50 MVC   FVIFLD(L'AC@NFA42),AC@NFA42                                      
*                                                                               
DPBNKAX  MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SEC NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ACCOUNT NUMBER PROFILE FOR PAYABLES                   *         
***********************************************************************         
         SPACE 1                                                                
VPBNKAC  NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BNE   VPBNKA02                                                         
         CLC   FVIFLD(L'AC@NONE),AC@NONE   IF SET TO NONE NEED TO CHK           
         BNE   VPBNKAX                     B/C OF PAYMENT METHOD PROF           
*                                                                               
VPBNKA02 MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SECURITY NUMBER             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VPBNKAX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VPBNKA10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VPBNKAX                                                          
*                                                                               
VPBNKA10 NI    BYTE3,X'FF'-(BACCF+BROUTF+BPAYMF+BRDELF)                         
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VPBNKA20                                                         
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    VBPBACC,VBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE3,BACCF                                                      
         OC    VBPROUT,VBPROUT     ANY BANK ROUTING # FOUND IN ELEM?            
         BZ    *+8                                                              
         OI    BYTE3,BROUTF                                                     
         CLI   VBPPAYM,0           ANY PAYMENT METHOD FOUND IN ELEM?            
         BE    *+14                                                             
         OI    BYTE3,BPAYMF                                                     
         MVC   BCBYTE1,VBPPAYM     SAVE BIT SETTINGS                            
         CLI   VBPRDEL,0           ANY REMITTANCE DEL FOUND IN ELEM?            
         BE    *+8                                                              
         OI    BYTE3,BRDELF                                                     
         XC    VBPBACC,VBPBACC                                                  
         ZIC   R1,VBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('VBPELQ',ACTRECD),0               
*                                                                               
VPBNKA20 ZIC   R1,FVXLEN           MAKE SURE INPUT IS NUMERIC                   
         EXCLC R1,FVIFLD,AC@NONE                                                
         BE    VPBNKA30                                                         
         CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VPBNKA30            NO                                           
         CLI   FVILEN,4            CANNOT BE LESS THAN 4 CHARACTERS             
         BL    EXITNV                                                           
*        ZIC   R1,FVILEN           MAKE SURE INPUT IS NUMERIC                   
*        LA    RF,FVIFLD           * CAN'T RELY ON THE FVINUM BIT!              
*PBNKA22 CLI   0(RF),C'0'                                                       
*        BL    EXITNV                                                           
*        CLI   0(RF),C'9'                                                       
*        BH    EXITNV                                                           
*        LA    RF,1(RF)                                                         
*        BCT   R1,VPBNKA22                                                      
*                                                                               
VPBNKA22 TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VPBNKA40                                                         
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,VBPBACC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VPBNKAX                                                          
*                                                                               
* NO BANK ACCOUNT ENTERED                                                       
VPBNKA30 DS    0H                                                               
         TM    BCBYTE1,VBPEFT               IF PAYMENT METHOD IS EFT            
         BO    EXITNO                       BANK ROUT # MUST EXIST              
         TM    BYTE3,(BROUTF+BPAYMF+BRDELF) IF ANY OTHER SETTINGS EXIST         
         BZ    VPBNKAX                                                          
         B     VPBNKA50                     MUST PUT BACK ELEMENT               
*                                                                               
VPBNKA40 DS    0H                                                               
         LA    R3,BOELEM                                                        
         USING VBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   VBPEL,VBPELQ                                                     
         MVI   VBPLN,VBPLN1Q                                                    
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,VBPBACC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),BOELEM,0                      
         CLI   12(R1),0                                                         
         BE    VPBNKAX                                                          
         DC    H'0'                                                             
*                                                                               
VPBNKA50 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VPBNKAX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK ACCOUNT FILTER FOR PAYABLES                            *         
***********************************************************************         
         SPACE 1                                                                
DFPYBA   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ACCOUNT FILTER FOR PAYABLES                           *         
***********************************************************************         
         SPACE 1                                                                
VFPYBA   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLC   =C'SP',ACTKUNT      PAYABLES LEDGERS                             
         BE    VFPYB10                                                          
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFPYB10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
*                                                                               
VFPYB10  CLC   FVIFLD(L'AC@NONE),AC@NONE      'NONE' ENTERED?                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         MVC   FLTIFLD,FVIFLD                                                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON BANK ACCOUNT FOR PAYABLES                           *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFPYBA  MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DOFPY05             NO ELEMENT FOUND                             
         L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         CLC   VBPBACC,BCSPACES    ANY BANK ACCOUNT?                            
         BH    *+18                YES                                          
DOFPY05  CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  BANK ACCT FOUND SO IF FLTRNG         
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,FILTLN                MAX FILTER LENGTH                       
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)          POINT TO LAST CHAR                      
DOFPY10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOFPY20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOFPY10                                                       
         B     FLTXL                                                            
*                                                                               
DOFPY20  BCTR  R1,0                                                             
         EXCLC R1,VBPBACC,FLTIFLD                                               
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR BANK ROUTING NUMBER (PAYABLES ONLY)                 *         
* AFM:   BANK ROUTING NUMBER                                          *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BNKROUT  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BNKRTTBL                                                      
         B     ITER                                                             
*                                                                               
BNKRTTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DBNKRT)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DBNKRT)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VBNKRT)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFBRT)                                 
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFBRT)                                 
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFBRT)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK ROUTING NUMBER                                         *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DBNKRT   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DBNKR10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DBNKRX                                                           
*                                                                               
DBNKR10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DBNKR20             NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         CLC   VBPROUT,BCSPACES                                                 
         BNH   DBNKR20             NO BANK ACCCT - SHOW DEFAULT                 
         MVC   FVIFLD(L'VBPROUT),VBPROUT                                        
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DBNKRX                                                           
*                                                                               
DBNKR20  MVC   FVIFLD(L'AC@NFA42),AC@NFA42                                      
*                                                                               
DBNKRX   MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SEC NUMBER                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ROUTING NUMBER PROFILE                                *         
***********************************************************************         
         SPACE 1                                                                
VBNKRT   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BNE   VBNKR02                                                          
         CLC   FVIFLD(L'AC@NONE),AC@NONE   IF SET TO NONE NEED TO CHK           
         BNE   VBNKRX                      B/C OF PAYMENT METHOD PROF           
*                                                                               
VBNKR02  MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VBNKRX                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBNKR10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VBNKRX                                                           
*                                                                               
VBNKR10  NI    BYTE3,X'FF'-(BACCF+BROUTF+BPAYMF+BRDELF)                         
         MVI   BCBYTE1,0                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VBNKR20                                                          
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    VBPBACC,VBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE3,BACCF                                                      
         OC    VBPROUT,VBPROUT     ANY BANK ROUTING # FOUND IN ELEM?            
         BZ    *+8                                                              
         OI    BYTE3,BROUTF                                                     
         CLI   VBPPAYM,0           ANY PAYMENT METHOD FOUND IN ELEM?            
         BE    *+14                                                             
         OI    BYTE3,BPAYMF                                                     
         MVC   BCBYTE1,VBPPAYM     SAVE THE BIT SETTINGS                        
         CLI   VBPRDEL,0           ANY REMITTANCE DEL FOUND IN ELEM?            
         BE    *+8                                                              
         OI    BYTE3,BRDELF                                                     
         XC    VBPROUT,VBPROUT                                                  
         ZIC   R1,VBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('VBPELQ',ACTRECD),0               
*                                                                               
VBNKR20  ZIC   R1,FVXLEN           MAKE SURE INPUT IS NUMERIC                   
         EXCLC R1,FVIFLD,AC@NONE   'NONE' ENTERED?                              
         BE    VBNKR30                                                          
         CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VBNKR30             NO                                           
         ZIC   R1,FVILEN           MAKE SURE INPUT IS NUMERIC                   
         CHI   R1,9                                                             
         BL    EXITNV                                                           
         LA    RF,FVIFLD           * CAN'T RELY ON THE FVINUM BIT!              
VBNKR22  CLI   0(RF),C'0'                                                       
         BL    EXITNV                                                           
         CLI   0(RF),C'9'                                                       
         BH    EXITNV                                                           
         LA    RF,1(RF)                                                         
         BCT   R1,VBNKR22                                                       
*                                                                               
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VBNKR40                                                          
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,VBPROUT,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VBNKRX                                                           
*                                                                               
* NO ROUTING NUMBER ENTERED                                                     
VBNKR30  DS    0H                                                               
         TM    BCBYTE1,VBPEFT               IF PAYMENT METHOD IS EFT            
         BO    EXITNO                       BANK ROUT # MUST EXIST              
         TM    BYTE3,(BACCF+BPAYMF+BRDELF)  IF ANY OTHER SETTINGS EXIST         
         BZ    VBNKRX                                                           
         B     VBNKR50                      MUST PUT BACK ELEMENT               
*                                                                               
VBNKR40  DS    0H                                                               
         LA    R3,BOELEM                                                        
         USING VBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   VBPEL,VBPELQ                                                     
         MVI   VBPLN,VBPLN1Q                                                    
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,VBPROUT,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),BOELEM,0                      
         CLI   12(R1),0                                                         
         BE    VBNKRX                                                           
         DC    H'0'                                                             
*                                                                               
VBNKR50  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VBNKRX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BANK ROUTING NUMBER FILTER FOR PAYABLES                     *         
***********************************************************************         
         SPACE 1                                                                
DFBRT    CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BANK ROUTING NUMBER FILTER FOR PAYABLES                    *         
***********************************************************************         
         SPACE 1                                                                
VFBRT    CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLC   =C'SP',ACTKUNT      PAYABLES LEDGERS                             
         BE    VFBRT10                                                          
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFBRT10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
*                                                                               
VFBRT10  CLC   FVIFLD(L'AC@NONE),AC@NONE      'NONE' ENTERED?                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON BANK ROUTING NUMBER FOR PAYABLES                    *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFBRT   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+18                                                             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BE    FLTXE               THAN SHOW IF NO ELEM EXISTS                  
         B     FLTXL               ELSE DON'T SHOW                              
*                                                                               
         L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
         CLC   VBPROUT,BCSPACES    ANY ROUTING NUMBER?                          
         BH    *+18                YES                                          
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  ROUTING # FOUND SO IF FLTRNG         
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,L'VBPROUT             MAX FILTER LENGTH                       
         LA    RE,FLTIFLD+L'VBPROUT-1                                           
DOBRT10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOBRT20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOBRT10                                                       
         B     FLTXL                                                            
*                                                                               
DOBRT20  BCTR  R1,0                                                             
         EXCLC R1,VBPROUT,FLTIFLD                                               
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR PAYMENT METHOD (PAYABLES ONLY)                      *         
* AFM:   PAYMENT METHOD                                               *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PAYMTH   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PAYMTBL                                                       
         B     ITER                                                             
*                                                                               
PAYMTBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DPAYMT)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DPAYMT)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VPAYMT)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFPAYF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFPAYF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOPAYF)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PAYMENT METHOD                                              *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DPAYMT   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DPYMT10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@PRNTD),AC@PRNTD   DEFAULT IS PRINTED                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DPYMTX                                                           
*                                                                               
DPYMT10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DPYMT40             NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         TM    VBPPAYM,VBPEFT      EFT?                                         
         BZ    DPYMT20                                                          
         MVC   FVIFLD(L'AC@EFT),AC@EFT                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DPYMTX                                                           
*                                                                               
DPYMT20  DS    0H                                                               
         TM    VBPPAYM,VBPPCRD     PCARD?                                       
         BZ    DPYMT30                                                          
         MVC   FVIFLD(L'AC@PCARD),AC@PCARD                                      
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DPYMTX                                                           
*                                                                               
DPYMT30  DS    0H                                                               
         TM    VBPPAYM,VBPCCRD     CCARD?                                       
         BZ    DPYMT40                                                          
         MVC   FVIFLD(L'AC@CCARD),AC@CCARD                                      
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DPYMTX                                                           
*                                                                               
DPYMT40  MVC   FVIFLD(L'AC@PRNTD),AC@PRNTD   DEFAULT IS PRINTED                 
*                                                                               
DPYMTX   MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PAYMENT METHOD                                             *         
***********************************************************************         
         SPACE 1                                                                
VPAYMT   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VPYMTX                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VPYMT10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VPYMTX                                                           
*                                                                               
VPYMT10  NI    BYTE4,X'FF'-(VEMLF)                                              
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',ACTRECD),       X        
               (1,=AL1(FFTTEML))                                                
         CLI   12(R1),0                                                         
         BNE   VPYMT15                                                          
         L     R3,12(R1)                                                        
         USING FFTELD,R3                                                        
         OC    FFTDLEN,FFTDLEN     ANY EMAIL FOUND IN ELEM?                     
         BZ    *+8                                                              
         OI    BYTE4,VEMLF                                                      
         DROP  R3                                                               
*                                                                               
VPYMT15  NI    BYTE5,X'FF'-(BSWIFT)                                             
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   VPYMT20                                                          
         L     R3,12(R1)                                                        
         USING OATELD,R3                                                        
         CLC   OATSWIFT,BCSPACES  ANY SWIFT OR BANK IBAN?                       
         BNH   *+8                                                              
         OI    BYTE5,BSWIFT                                                     
         DROP  R3                                                               
*                                                                               
*                                                                               
VPYMT20  NI    BYTE3,X'FF'-(BACCF+BROUTF+BPAYMF+BRDELF)                         
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VPYMT30                                                          
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         NI    VBPPCTY,X'FF'-(VBPSING+VBPMULT) INIT PCARD TYPE FIELD?           
         OI    BYTE3,ELEMF                                                      
         OC    VBPBACC,VBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE3,BACCF                                                      
         OC    VBPROUT,VBPROUT     ANY BANK ROUTING # FOUND IN ELEM?            
         BZ    *+8                                                              
         OI    BYTE3,BROUTF                                                     
         CLI   VBPPAYM,0           ANY PAYMENT METHOD FOUND IN ELEM?            
         BE    *+8                                                              
         OI    BYTE3,BPAYMF                                                     
         CLI   VBPRDEL,0           ANY REMITTANCE DEL FOUND IN ELEM?            
         BE    *+8                                                              
         OI    BYTE3,BRDELF                                                     
         MVI   VBPPAYM,0                                                        
         ZIC   R1,VBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('VBPELQ',ACTRECD),0               
*                                                                               
VPYMT30  CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VPYMT80             NO                                           
         MVI   BCBYTE1,0                                                        
*        ZIC   R1,FVXLEN                                                        
         LHI   R1,1                COMPARE PRI FOR PRINTED.                     
         EXCLC R1,FVIFLD,AC@PRNTD  USER ENTERED PRINTED?                        
         BE    VPYMT50                                                          
*                                                                               
         EXCLC R1,FVIFLD,AC@PCARD  USER ENTERED PCARD OR PCA ?                  
         BNE   VPYMT40                                                          
         TM    BYTE4,VEMLF         VENDOR EMAIL ADDRESS FOUND ?                 
         BO    *+14                FOR EFT SETTING                              
         MVC   FVMSGNO,=AL2(AE$BEML)                                            
         B     EXITL                                                            
         MVI   BCBYTE1,C'P'        MARK IT AS PCARD PAYMENT                     
         B     VPYMT50                                                          
*                                                                               
VPYMT40  EXCLC R1,FVIFLD,AC@CCARD  USER ENTERED CCARD OR CCA ?                  
         BNE   VPYMT42                                                          
         MVI   BCBYTE1,C'C'        MARK IT AS CCARD PAYMENT                     
         B     VPYMT50                                                          
*                                                                               
VPYMT42  EXCLC R1,FVIFLD,AC@EFT    USER ENTERED EFT?                            
         BNE   EXITNV                                                           
         TM    BYTE3,BACCF+BROUTF  BANK ACCT & BANK ROUT # MUST EXIST           
         BO    VPYMT45             FOR EFT SETTING                              
         TM    BYTE5,BSWIFT        OR THE SWIFT OR IBAN MUST EXIST              
         BO    VPYMT45             FOR EFT SETTING                              
         MVC   FVMSGNO,=AL2(AE$BEFT)                                            
         B     EXITL                                                            
VPYMT45  TM    BYTE3,BRDELF                                                     
         BO    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$BEFT2)                                           
         B     EXITL                                                            
         MVI   BCBYTE1,C'E'        EFT                                          
*                                                                               
VPYMT50  TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VPYMT90                                                          
         LA    R3,SVELEM                                                        
         NI    VBPPAYM,X'FF'-(VBPEFT+VBPPCRD+VBPCCRD)                           
         CLI   BCBYTE1,C'E'        EFT                                          
         BNE   VPYMT60                                                          
         OI    VBPPAYM,VBPEFT      MARK PAYMENT METHOD AS EFT                   
         B     VPYMT70                                                          
VPYMT60  CLI   BCBYTE1,C'P'        PCARD                                        
         BNE   VPYMT65                                                          
         OI    VBPPAYM,VBPPCRD     MARK PAYMENT METHOD AS PCARD                 
         OI    VBPPCTY,VBPSING     DEFAULT IS SINGLE SWIPE                      
         B     VPYMT70                                                          
VPYMT65  CLI   BCBYTE1,C'C'        CCARD                                        
         BNE   VPYMT70                                                          
         OI    VBPPAYM,VBPCCRD     MARK PAYMENT METHOD AS CCARD                 
VPYMT70  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VPYMTX                                                           
*                                                                               
* NO PAYMENT METHOD ENTERED                                                     
VPYMT80  DS    0H                                                               
         TM    BYTE3,(BACCF+BROUTF+BRDELF)  IF ANY OTHER SETTINGS EXIST         
         BZ    VPYMTX                                                           
         B     VPYMT120                     MUST PUT BACK ELEMENT               
*                                                                               
VPYMT90  DS    0H                                                               
         LA    R3,BOELEM                                                        
         USING VBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   VBPEL,VBPELQ                                                     
         MVI   VBPLN,VBPLN1Q                                                    
         NI    VBPPAYM,X'FF'-(VBPEFT+VBPPCRD+VBPCCRD)                           
         CLI   BCBYTE1,C'E'                EFT ?                                
         BNE   VPYMT100                                                         
         OI    VBPPAYM,VBPEFT                                                   
         B     VPYMT110                                                         
VPYMT100 CLI   BCBYTE1,C'P'                 PCARD ?                             
         BNE   VPYMT105                                                         
         OI    VBPPAYM,VBPPCRD                                                  
         OI    VBPPCTY,VBPSING     DEFAULT IS SINGLE SWIPE                      
         B     VPYMT110                                                         
VPYMT105 CLI   BCBYTE1,C'C'                 CCARD ?                             
         BNE   VPYMT110                                                         
         OI    VBPPAYM,VBPCCRD                                                  
VPYMT110 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),BOELEM,0                      
         CLI   12(R1),0                                                         
         BE    VPYMTX                                                           
         DC    H'0'                                                             
*                                                                               
VPYMT120 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VPYMTX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PAYMENT METHOD FILTER                                                 
***********************************************************************         
         SPACE 1                                                                
DFPAYF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PAYMENT METHOD FILTER                                      *         
***********************************************************************         
         SPACE 1                                                                
VFPAYF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SP',ACTKUNT      VALID FOR PAYABLE LEDGERS                    
         BE    VFPYM10             SP,SQ,SS,ST,SU,SS AND SY                     
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFPYM10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
VFPYM10  ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@PRNTD  PRINTED                                      
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@PRNTD),AC@PRNTD                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@EFT    EFT                                          
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@EFT),AC@EFT                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@PCARD  PCARD                                        
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@PCARD),AC@PCARD                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@CCARD  CCARD                                        
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@CCARD),AC@CCARD                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR PAYMENT METHOD                                     *         
***********************************************************************         
         SPACE 1                                                                
DOPAYF   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    DOPYF10                                                          
         CLC   FLTIFLD(L'AC@PRNTD),AC@PRNTD  ELEMENT DOESN'T EXIST SO           
         BE    FLTXE                         ONLY PRINTED IS VALID.             
         B     FLTXL                                                            
*                                                                               
DOPYF10  L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         CLC   FLTIFLD(L'AC@EFT),AC@EFT  FILTERING ON EFT SO ONLY SHOW          
         BNE   DOPYF20                   ACCT IF BIT IS ON.                     
         TM    VBPPAYM,VBPEFT                                                   
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOPYF20  CLC   FLTIFLD(L'AC@PCARD),AC@PCARD FILTERING ON PCARD - SHOW           
         BNE   DOPYF25                   ACCT IF BIT IS ON.                     
         TM    VBPPAYM,VBPPCRD                                                  
         BO    FLTXE                                                            
         B     FLTXL                                                            
DOPYF25  CLC   FLTIFLD(L'AC@CCARD),AC@CCARD FILTERING ON CCARD - SHOW           
         BNE   DOPYF30                   ACCT IF BIT IS ON.                     
         TM    VBPPAYM,VBPCCRD                                                  
         BO    FLTXE                                                            
         B     FLTXL                                                            
DOPYF30  TM    VBPPAYM,VBPEFT+VBPPCRD+VBPCCRD FILT ON PRINTED SO ONLY           
         BZ    FLTXE                     SHOW ACCT IF BIT IS OFF.               
         B     FLTXL                                                            
*                                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR PCARD TYPE     (PAYABLES ONLY)                      *         
* AFM:   PCARD TYPE                                                   *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PCARDT   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PCTYTBL                                                       
         B     ITER                                                             
*                                                                               
PCTYTBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DPCATY)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DPCATY)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VPCATY)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFPCTF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFPCTF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOPCTF)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PCARD TYPE (SINGLE/MULTIPLE)                                *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DPCATY   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DPCTY10                        VALID TO SHOW AT THIS LVL         
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DPCTYX                                                           
*                                                                               
DPCTY10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DPCTY40             NO ELEM                                      
         L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         TM    VBPPCTY,VBPSING     SWIPE TYPE SINGLE?                           
         BNO   DPCTY20                                                          
         MVC   FVIFLD(L'AC@SING),AC@SING                                        
         B     DPCTY30                                                          
DPCTY20  TM    VBPPCTY,VBPMULT     SWIPE TYPE MULTI?                            
         BNO   DPCTY40                                                          
         MVC   FVIFLD(L'AC@MULT),AC@MULT                                        
DPCTY30  OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DPCTYX                                                           
*                                                                               
DPCTY40  MVC   FVIFLD(L'AC@NONE),AC@NONE      NONE                              
         OI    FVATRB,FVAPROT                                                   
*                                                                               
DPCTYX   MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PCARD TYPE (SINGLE/MULTIPLE)                               *         
***********************************************************************         
         SPACE 1                                                                
VPCATY   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,CHKDISB       MOVE IN CASH DISBURSEMENT SEC #              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VPCTYX                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VPCTY10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VPCTYX                                                           
*                                                                               
VPCTY10  DS    0H                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VPCTYX                                                           
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         NI    VBPPCTY,X'FF'-(VBPSING+VBPMULT)                                  
         TM    VBPPAYM,VBPPCRD                                                  
         BO    VPCTY20                                                          
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VPCTYX                                                           
*                                                                               
VPCTY20  CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VPCTY30             NO - SET DEFAULT TO SINGLE                   
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@SING   USER ENTERED SINGLE ?                        
         BE    VPCTY30                                                          
         EXCLC R1,FVIFLD,AC@MULT   USER ENTERED MULTIPLE ?                      
         BE    VPCTY40                                                          
         B     EXITNV                                                           
*                                                                               
VPCTY30  OI    VBPPCTY,VBPSING    SAVE SINGLE SWIPE                             
         B     VPCTYX                                                           
VPCTY40  OI     VBPPCTY,VBPMULT    SAVE MULTIPLE SWIPE                          
*                                                                               
VPCTYX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PCARD TYPE FILTER                                                     
***********************************************************************         
         SPACE 1                                                                
DFPCTF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PCARD TYPE FILTER                                          *         
***********************************************************************         
         SPACE 1                                                                
VFPCTF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SP',ACTKUNT      VALID FOR PAYABLE LEDGERS                    
         BE    VFPCT10             SP,SQ,SS,ST,SU,SS AND SY                     
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFPCT10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
VFPCT10  ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@SING   SINGLE                                       
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@SING),AC@SING                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@MULT   MULTIPLE                                     
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@MULT),AC@MULT                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR PCARD TYPE                                         *         
***********************************************************************         
         SPACE 1                                                                
DOPCTF   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    DOPCT10                                                          
         CLC   FLTIFLD(L'AC@SING),AC@SING                                       
         BE    FLTXE                         ONLY SINGLE IS VALID.              
         B     FLTXL                                                            
*                                                                               
DOPCT10  L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         CLC   FLTIFLD(L'AC@MULT),AC@MULT FLTRNG ON MULT SO ONLY SHOW           
         BNE   DOPCT20                   ACCT IF BIT IS ON.                     
         TM    VBPPCTY,VBPMULT                                                  
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOPCT20  TM    VBPPCTY,VBPSING           FILTERING ON SINGLE  SO ONLY           
         BO    FLTXE                     SHOW ACCT IF SINGLE IS SET             
         B     FLTXL                                                            
*                                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR REMITTANCE DELIVERY (PAYABLES ONLY)                 *         
* AFM:   REMITTANCE DELIVERY                                          *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
RMDELI   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,RMDELTBL                                                      
         B     ITER                                                             
*                                                                               
RMDELTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DRMDEL)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DRMDEL)                                
         DC    AL1(DVAL),AL1(0,0,0),AL4(VRMDEL)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFRMDF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFRMDF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DORMDF)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY REMITTANCE DELIVERY                                         *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
DRMDEL   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DRDEL12                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DRDELX                                                           
*                                                                               
DRDEL12  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DRDEL20             NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         TM    VBPRDEL,VBPMLRM     MAIL REMITTANCE?                             
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@MAIL),AC@MAIL                                        
         B     DRDEL15                                                          
         TM    VBPRDEL,VBPFXRM     FAX REMITTANCE?                              
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@FAX),AC@FAX                                          
         B     DRDEL15                                                          
         TM    VBPRDEL,VBPEMRM     EMAIL REMITTANCE?                            
         BZ    DRDEL20                                                          
         MVC   FVIFLD(L'AC@EMAIL),AC@EMAIL                                      
DRDEL15  OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DRDELX                                                           
*                                                                               
DRDEL20  MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
*                                                                               
DRDELX   MVI   SBYTE,CHKDISB       MOVE IN CHECK DISB SEC #                     
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE REMITTANCE DELIVERY PROFILE                                *         
***********************************************************************         
         SPACE 1                                                                
VRMDEL   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
*        BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
*        BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,CHKDISB       MOVE IN CHK DISB SEC #                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VRDELX                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VRDEL10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VRDELX                                                           
*                                                                               
VRDEL10  NI    BYTE3,X'FF'-(BACCF+BROUTF+BPAYMF+BRDELF)                         
         NI    BYTE4,X'FF'-PAYEFT                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VRDEL20                                                          
         L     R3,12(R1)                                                        
         USING VBPFELD,R3                                                       
         OI    BYTE3,ELEMF                                                      
         OC    VBPBACC,VBPBACC     ANY BANK ACCOUNT FOUND IN ELEM?              
         BZ    *+8                                                              
         OI    BYTE3,BACCF                                                      
         OC    VBPROUT,VBPROUT     ANY BANK ROUTING # FOUND IN ELEM?            
         BZ    *+8                                                              
         OI    BYTE3,BROUTF                                                     
         CLI   VBPPAYM,0           ANY PAYMENT METHOD FOUND IN ELEM?            
         BE    *+8                                                              
         OI    BYTE3,BPAYMF                                                     
         TM    VBPPAYM,VBPEFT                                                   
         BZ    *+8                                                              
         OI    BYTE4,PAYEFT                                                     
         CLI   VBPRDEL,0           ANY REMITTANCE DEL FOUND IN ELEM?            
         BE    *+8                                                              
         OI    BYTE3,BRDELF                                                     
         MVI   VBPRDEL,0                                                        
         ZIC   R1,VBPLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('VBPELQ',ACTRECD),0               
*                                                                               
VRDEL20  MVI   BCBYTE1,0                                                        
         CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VRDEL30             NO                                           
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NONE   NONE ENTERED?                                
         BNE   *+16                                                             
         TM    BYTE4,PAYEFT        IS PAYMENT METHOD EFT?                       
         BO    EXITNO              THAN CAN'T HAVE NONE                         
         B     VRDEL25                                                          
         MVI   BCBYTE1,C'M'                                                     
         EXCLC R1,FVIFLD,AC@MAIL   USER WANTS TO MAIL REMITTANCE?               
         BE    VRDEL25                                                          
         MVI   BCBYTE1,C'F'                                                     
         EXCLC R1,FVIFLD,AC@FAX    USER WANTS TO FAX REMITTANCE?                
         BE    VRDEL22                                                          
         MVI   BCBYTE1,C'E'                                                     
         EXCLC R1,FVIFLD,AC@EMAIL  USER WANTS TO EMAIL REMITTANCE?              
         BNE   EXITNV                                                           
*                                                                               
VRDEL22  BRAS  RE,CHKCNT                                                        
         BNE   EXITL                                                            
*                                                                               
VRDEL25  TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VRDEL40                                                          
         LA    R3,SVELEM                                                        
         CLI   BCBYTE1,C'M'                                                     
         BNE   *+12                                                             
         OI    VBPRDEL,VBPMLRM     MARK REMITTANCE DELIVERY AS MAIL             
         B     VRDEL28                                                          
         CLI   BCBYTE1,C'F'                                                     
         BNE   *+12                                                             
         OI    VBPRDEL,VBPFXRM     MARK REMITTANCE DELIVERY AS FAX              
         B     VRDEL28                                                          
         CLI   BCBYTE1,C'E'                                                     
         BNE   *+8                 MUST BE 'NONE'                               
         OI    VBPRDEL,VBPEMRM     MARK REMITTANCE DELIVERY AS EMAIL            
VRDEL28  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VRDELX                                                           
*                                                                               
* NO REMITTANCE DELIVERY ENTERED                                                
VRDEL30  DS    0H                                                               
         TM    BYTE4,PAYEFT        IS PAYMENT METHOD EFT?                       
         BO    EXITNO              THAN MUST ENTER SOMETHING                    
         TM    BYTE3,(BACCF+BROUTF+BPAYMF) IF ANY OTHER SETTINGS EXIST          
         BZ    VRDELX                                                           
         B     VRDEL50                      MUST PUT BACK ELEMENT               
*                                                                               
VRDEL40  DS    0H                                                               
         CLI   BCBYTE1,0           ANYTHING ENTERED FOR THIS FIELD?             
         BE    VRDELX              NO SO NOTHING TO ADD                         
         LA    R3,BOELEM                                                        
         USING VBPFELD,R3                                                       
         XC    BOELEM,BOELEM                                                    
         MVI   VBPEL,VBPELQ                                                     
         MVI   VBPLN,VBPLN1Q                                                    
         CLI   BCBYTE1,C'M'                                                     
         BNE   *+12                                                             
         OI    VBPRDEL,VBPMLRM     MARK REMITTANCE DELIVERY AS MAIL             
         B     VRDEL45                                                          
         CLI   BCBYTE1,C'F'                                                     
         BNE   *+12                                                             
         OI    VBPRDEL,VBPFXRM     MARK REMITTANCE DELIVERY AS FAX              
         B     VRDEL45                                                          
         OI    VBPRDEL,VBPEMRM     MUST BE REMITTANCE DELIVERY AS EMAIL         
*                                                                               
VRDEL45  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),BOELEM,0                      
         CLI   12(R1),0                                                         
         BE    VRDELX                                                           
         DC    H'0'                                                             
*                                                                               
VRDEL50  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VRDELX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY REMITTANCE DELIVERY FILTER                                            
***********************************************************************         
         SPACE 1                                                                
DFRMDF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE REMITTANCE DELIVERY FILTER                                 *         
***********************************************************************         
         SPACE 1                                                                
VFRMDF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         CLC   =C'SP',ACTKUNT      VALID FOR PAYABLE LEDGERS                    
         BE    VFRMD10             SP,SQ,SS,ST,SU,SS AND SY                     
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFRMD10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
VFRMD10  ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@MAIL   MAIL                                         
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@MAIL),AC@MAIL                                       
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@FAX    FAX                                          
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@FAX),AC@FAX                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@EMAIL  EMAIL                                        
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@EMAIL),AC@EMAIL                                     
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@NONE   NONE                                         
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING FOR REMITTANCE DELIVERY PROFILE                        *         
***********************************************************************         
         SPACE 1                                                                
DORMDF   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('VBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    DORMD10                                                          
*                                                                               
         LA    RE,12                                                            
         LA    R1,ACTKACT+L'ACTKACT-1 POINT TO END OF ACCOUNT                   
DORMD02  CLI   0(R1),C' '             FIND OUT HOW MANY CHARACTERS              
         BNE   DORMD05                OF ACCOUNT USER ENTERED                   
         SHI   R1,1                                                             
         BCT   RE,DORMD02                                                       
*                                                                               
DORMD05  STC   RE,BCBYTE1                                                       
         BRAS  RE,SETLEN                                                        
         BRAS  RE,VALIDLV          NO ELEM FOUND - LOW LVL ACCT?                
         BNE   FLTXL               NO THAN DON'T SHOW                           
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  YES & IF FILTERING ON NONE           
         BE    FLTXE                       OK TO SHOW ELSE DON'T SHOW           
         B     FLTXL                                                            
*                                                                               
DORMD10  L     RF,12(R1)                                                        
         USING VBPFELD,RF                                                       
         CLC   FLTIFLD(L'AC@NONE),AC@NONE    FILTERING ON NONE?                 
         BNE   DORMD15                                                          
         TM    VBPRDEL,VBPMLRM+VBPFXRM+VBPEMRM  THEN THESE BITS MUST BE         
         BZ    FLTXE                            OFF                             
         B     FLTXL                                                            
*                                                                               
DORMD15  CLC   FLTIFLD(L'AC@MAIL),AC@MAIL                                       
         BNE   DORMD20                                                          
         TM    VBPRDEL,VBPMLRM            FILTERING ON MAIL                     
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DORMD20  CLC   FLTIFLD(L'AC@EMAIL),AC@EMAIL                                     
         BNE   DORMD30                                                          
         TM    VBPRDEL,VBPEMRM           FILTERING ON EMAIL                     
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DORMD30  TM    VBPRDEL,VBPFXRM           MUST BE FILTERING ON FAX               
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR CONTACT NAME                                        *         
* AFM:   CONTACT (PAGE 1)                                             *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CONTNM   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CNNMTBL                                                       
         B     ITER                                                             
*                                                                               
CNNMTBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DCNNM)                                  
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DCNNM)      FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VCNNM)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCNMF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCNMF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCNMF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY CONTACT NAME                                                *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DCNNM    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DCNNM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DCNNMX                                                           
*                                                                               
DCNNM10  GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTCONT                                  
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
DCNNMX   B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE CONTACT NAME                                               *         
***********************************************************************         
         SPACE 1                                                                
VCNNM    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VCNNM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VCNNMX                                                           
*                                                                               
VCNNM10  GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('FFTELQ',ACTRECD),       *        
               (L'FFTTYPE,=AL1(FFTTCONT))                                       
         CLI   FVILEN,0                                                         
         BE    VCNNMX                                                           
         GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTCONT                                  
VCNNMX   B     EXITOK                                                           
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAY CONTACT NAME FILTER                                                   
***********************************************************************         
         SPACE 1                                                                
DFCNMF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE CONTACT NAME FILTER                                                  
***********************************************************************         
         SPACE 1                                                                
VFCNMF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON CONTACT NAME                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFCNMF  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R2)),          +        
               (L'FFTTYPE,=AL1(FFTTCONT))                                       
         CLI   12(R1),0                                                         
         BE    *+18                                                             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE    NO CONTACT NAME FOUND SO           
         BE    FLTXE                         ONLY 'NONE' IS VALID               
         B     FLTXL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
         LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
DOCNM10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BNE   DOCNM20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOCNM10                                                       
*                                                                               
DOCNM20  LTR   R1,R1                                                            
         BZ    FLTXX                                                            
         BCTR  R1,0                                                             
         EXCLC R1,FFTDATA,FLTIFLD                                               
         BL    FLTXL                                                            
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         DROP  RF                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ADDRESS FIELDS (ON LIST SCREEN ONLY)                *         
* WILL FORMAT ADDRESS ON LIST SCREEN WITH A MAX OF 4 ROWS PER ACCOUNT *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
ADDRL    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,ADDRLTB                                                       
         B     ITER                                                             
*                                                                               
ADDRLTB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISADR)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ADDRESS ON LIST SCREEN                                      *         
* LSROWREP CONTAINS THE CURRENT LIST ROW BEING PROCESSED SO THAT      *         
* DETERMINES WHAT ADDRESS LINE # WE NEED TO GET                       *         
***********************************************************************         
         SPACE 1                                                                
DISADR   DS    0H                                                               
         LH    R0,LSROWREP         CURRENT ROW BEING PROCESSED                  
         CLI   CSACT,A#REPT        FOR REPORT OR DOWNLOAD USE                   
         BE    *+12                SVNROWS SINCE LSROWREP IS NOT                
         CLI   CSACT,A#DLOAD       FILLED IN.                                   
         BNE   DISADR2                                                          
         ZIC   R0,SVNROWS                                                       
*                                                                               
DISADR2  MVI   BCBYTE1,4           DEFAULT TO ROW 4                             
         CHI   R0,4                                                             
         BNL   DISADR10                                                         
         MVI   BCBYTE1,3                                                        
         CHI   R0,3                                                             
         BNL   DISADR10                                                         
         MVI   BCBYTE1,2                                                        
         CHI   R0,2                                                             
         BNL   DISADR10                                                         
         MVI   BCBYTE1,1                                                        
*                                                                               
DISADR10 GOTO1 AGETADR,BOPARM,(BCBYTE1,ACTRECD)                                 
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR MESSAGE CLASS (FOR ACR/EFT/POSPAY) ON SC            *         
* AFM:   ACR    MESSAGE CLASS                                         *         
* AFM:   EFT    MESSAGE CLASS                                         *         
* AFM:   POSPAY MESSAGE CLASS                                         *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
MSGCL    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,MSGCLTB                                                       
         B     ITER                                                             
*                                                                               
MSGCLTB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISMSGCL)                               
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISMSGCL)   FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALMSGCL)                               
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFMSGF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFMSGF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFMSGF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY MESSAGE CLASS FOR ACR/EFT/POSPAY/820                        *         
* 1.  CHECK AT LOW LEVEL ACCOUNT RECORD                               *         
* 2.  IF NOT FOUND CHECK ON AFM BANK RECORD                           *         
* 3.  IF NOT FOUND CHECK ON CFILE BANK RECORD                         *         
***********************************************************************         
         SPACE 1                                                                
DISMSGCL BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DMSGC10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DMSGCX                                                           
*                                                                               
DMSGC10  MVI   BCBYTE1,0                                                        
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#CRMC)       ACR MSG CLASS?                         
         BNE   *+12                                                             
         OI    BCBYTE1,FFTACR                                                   
         B     DMSGC20                                                          
         CLM   R1,3,=AL2(ACC#EFMC)       EFT MSG CLASS?                         
         BNE   *+12                                                             
         OI    BCBYTE1,FFTEFT                                                   
         B     DMSGC20                                                          
         CLM   R1,3,=AL2(ACC#PPMC)       POSPAY MSG CLASS ?                     
         BNE   *+12                                                             
         OI    BCBYTE1,FFTPOS            POSPAY                                 
         B     DMSGC20                                                          
         CLM   R1,3,=AL2(ACC#820MC)      820 MSG CLASS ?                        
         BE    *+6                                                              
         DC    H'0'                      UNDEFINED TRANSMISSION TYPE            
         OI    BCBYTE1,FFT820            820                                    
         B     DMSGC20                                                          
*                                                                               
DMSGC20  MVI   BCBYTE2,C'M'        LOOKING FOR MESSAGE CLASS                    
         BRAS  RE,RDLLSC           LOOK AT LOW LEVEL SC ACCOUNT                 
         BNE   *+14                                                             
         MVC   FVIFLD(L'FFTMSGC),BCWORK  FOUND ON LOW LVL ACCT                  
         B     DMSGCX                                                           
         BRAS  RE,GTBNK            READ AFM/CFILE BANK RECS (DDGETBANK)         
         BE    DMSGC30                                                          
         MVC   FVIFLD(L'AC@NA),AC@NA  IF NO BANK/BRANCH SHOW 'N/A'              
         OI    LEVELBIT,NOTAPPL                                                 
         B     DMSGCX                                                           
*                                                                               
DMSGC30  BRAS  RE,EDIBNK           DISPLAY EDI BANK INFO FROM DDGETBANK         
         BNE   *+14                                                             
         MVC   FVIFLD(L'BANEFCLS),BCWORK                                        
         B     DMSGCX              FOUND ON AFM BANK REC                        
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
*                                                                               
DMSGCX   MVI   SBYTE,BANKPROF      MOVE IN BANK PROFILE SECURITY NUMBER         
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         TM    CUSTAT,CUSDDS       IF NOT A DDS TERMINAL PROTECT THE            
         BO    *+8                 FIELD - EVEN IF WRITE/READ ACCESS            
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
***********************************************************************         
* VALIDATE THE MESSAGE CLASS FOR ACR/EFT/POSPAY/820                   *         
***********************************************************************         
         SPACE 1                                                                
VALMSGCL NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VMSGCLX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VMSGC10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VMSGCLX                                                          
*                                                                               
VMSGC10  MVI   BCBYTE1,0                                                        
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#CRMC)       ACR MSG CLASS?                         
         BNE   *+12                                                             
         OI    BCBYTE1,FFTACR                                                   
         B     VMSGC20                                                          
         CLM   R1,3,=AL2(ACC#EFMC)       EFT MSG CLASS?                         
         BNE   *+12                                                             
         OI    BCBYTE1,FFTEFT                                                   
         B     VMSGC20                                                          
         CLM   R1,3,=AL2(ACC#PPMC)       POS MSG CLASS?                         
         BNE   *+12                                                             
         OI    BCBYTE1,FFTPOS            MUST BE POSPAY                         
         B     VMSGC20                                                          
         CLM   R1,3,=AL2(ACC#820MC)      POS MSG CLASS?                         
         BE    *+6                                                              
         DC    H'0'                      ADD FIELD NUMBER HERE                  
         OI    BCBYTE1,FFT820            MUST BE POSPAY                         
         B     VMSGC20                                                          
*                                                                               
VMSGC20  NI    BYTE4,X'FF'-(MSGCLF+DSNF)                                        
         LA    R3,ACTRFST                                                       
         USING FFTELD,R3                                                        
VMSGC30  CLI   0(R3),0                                                          
         BE    VMSGC60                                                          
         CLI   0(R3),FFTELQ                                                     
         BNE   *+12                                                             
         CLI   FFTTYPE,FFTTEDIP                                                 
         BE    VMSGC50                                                          
VMSGC40  ZIC   R1,1(R3)                                                         
         AR    R3,R1                                                            
         B     VMSGC30                                                          
*                                                                               
VMSGC50  CLC   FFTETYP,BCBYTE1                                                  
         BNE   VMSGC40                                                          
         OI    BYTE3,ELEMF                                                      
         CLC   FFTDNAM,BCSPACES    ANY DATASET NAME FOUND IN ELEM?              
         BNH   *+8                                                              
         OI    BYTE4,DSNF                                                       
         MVC   FFTMSGC,BCSPACES                                                 
         ZIC   R1,FFTLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         MVI   0(R3),X'FF'                                                      
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),(X'FF',ACTRECD),0                  
*                                                                               
VMSGC60  ZIC   R1,FVXLEN           MAKE SURE INPUT IS NUMERIC                   
         EXCLC R1,FVIFLD,AC@NONE   'NONE' ENTERED?                              
         BE    VMSGC70                                                          
         CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VMSGC70             NO                                           
*                                                                               
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VMSGC80                                                          
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FFTMSGC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VMSGCLX                                                          
*                                                                               
* NO MESSAGE CLASS ENTERED                                                      
VMSGC70  DS    0H                                                               
         TM    BYTE4,DSNF            IF ANY OTHER SETTINGS EXIST                
         BZ    VMSGCLX                                                          
         B     VMSGC90               MUST PUT BACK ELEMENT                      
*                                                                               
VMSGC80  DS    0H                                                               
         LA    R3,BOELEM                                                        
         USING FFTELD,R3                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   FFTEL,FFTELQ                                                     
         MVI   FFTLN,FFTBLNQ+FFTLN1Q+1      TOTAL LENGTH                        
         MVI   FFTDLEN,FFTBLNQ     ACTUAL LENGTH OF DATA                        
         MVI   FFTTYPE,FFTTEDIP                                                 
         MVC   FFTETYP,BCBYTE1     CONTAINS THE TYPE OF EDI (ACR,EFT..)         
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FFTMSGC,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),BOELEM,0                      
         CLI   12(R1),0                                                         
         BE    VMSGCLX                                                          
         DC    H'0'                                                             
*                                                                               
VMSGC90  GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VMSGCLX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAY ACR/POSPAY/EFT MESSAGE CLASS FILTER                                   
***********************************************************************         
         SPACE 1                                                                
DFMSGF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE ACR/POSPAY/EFT MESSAGE CLASS FILTER                              
***********************************************************************         
         SPACE 1                                                                
VFMSGF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SC',ACTKUNT      FILTER ONLY VALID FOR SC                     
         BNE   ERRFILT                                                          
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACR/POSPAY/EFT MESSAGE CLASS FILTER                           
* 1.  CHECK AT LOW LEVEL ACCOUNT RECORD                               *         
* 2.  IF NOT FOUND CHECK ON AFM BANK RECORD                           *         
* 3.  IF NOT FOUND CHECK ON CFILE BANK RECORD                         *         
***********************************************************************         
         SPACE 1                                                                
DOFMSGF  MVI   BCBYTE2,C'M'        LOOKING FOR MESSAGE CLASS                    
         BRAS  RE,FLTBNK                                                        
         CLI   FILTEQ,0                                                         
         BE    DOFMSG10            NOTHING FOUND ON LOW LEVEL SC                
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
*                                                                               
DOFMSG10 BRAS  RE,GTBNK            READ AFM/CFILE BANK RECS (DDGETBANK)         
         BE    DOFMSG20                                                         
         CLC   FLTIFLD(L'AC@NTAVL),AC@NTAVL IF BNK/BRNCH CODE NOT FOUND         
         BE    FLTXE                   FILTER VALUE OF N/A IS THE ONLY          
         B     FLTXL                   FILTER THAT IS VALID.                    
*                                                                               
DOFMSG20 BRAS  RE,EDIBNK                                                        
         BE    DOFMSG30                                                         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE IF DSN NOT FOUND FILTER VALUE         
         BE    FLTXE                      OF NONE IS THE ONLY FILTER            
         B     FLTXL                      THAT IS VALID.                        
*                                                                               
DOFMSG30 ZIC   R1,FVXLEN                                                        
         EXCLC R1,BCWORK,FLTIFLD   BCWORK CONTAINS THE VALUE FROM THE           
         BE    FLTXE               DDGETBANK EDIBNK ROUTINE                     
         BL    FLTXL                                                            
         BH    FLTXH                                                            
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR DATASET NAME (FOR ACR/EFT/POSPAY/820) ON SC         *         
* AFM:   ACR    DATASET NAME                                          *         
* AFM:   EFT    DATASET NAME                                          *         
* AFM:   POSPAY DATASET NAME                                          *         
* AFM:   820    DATASET NAME                                          *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
DSNAME   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,DSNMETB                                                       
         B     ITER                                                             
*                                                                               
DSNMETB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISDSN)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISDSN)     FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALDSN)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFDSNF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFDSNF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFDSNF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY MESSAGE CLASS FOR ACR/EFT/POSPAY/820                        *         
* 1.  CHECK AT LOW LEVEL ACCOUNT RECORD                               *         
* 2.  IF NOT FOUND CHECK ON AFM BANK RECORD                           *         
* 3.  IF NOT FOUND CHECK ON CFILE BANK RECORD                         *         
***********************************************************************         
         SPACE 1                                                                
DISDSN   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DDSN10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DDSNX                                                            
*                                                                               
DDSN10   MVI   BCBYTE1,0                                                        
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#CRDSN)      ACR DATAEST NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTACR                                                   
         B     DDSN20                                                           
         CLM   R1,3,=AL2(ACC#EFDSN)      EFT DATASET NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTEFT                                                   
         B     DDSN20                                                           
         CLM   R1,3,=AL2(ACC#PPDSN)      POSPAY DATASET NAME?                   
         BNE   *+12                                                             
         OI    BCBYTE1,FFTPOS                                                   
         B     DDSN20                                                           
         CLM   R1,3,=AL2(ACC#820DSN)     820 DATASET NAME?                      
         BE    *+6                                                              
         DC    H'0'                                                             
         OI    BCBYTE1,FFT820                                                   
         B     DDSN20                                                           
*                                                                               
DDSN20   MVI   BCBYTE2,C'D'        LOOKING FOR DATASET NAME                     
         BRAS  RE,RDLLSC           LOOK AT LOW LEVEL SC ACCOUNT                 
         BNE   *+14                                                             
         MVC   FVIFLD(L'FFTDNAM),BCWORK    FOUND ON LOW LVL ACCT                
         B     DDSNX                                                            
         BRAS  RE,GTBNK            READ AFM/CFILE BANK RECS (DDGETBANK)         
         BE    DDSN30                                                           
         MVC   FVIFLD(L'AC@NA),AC@NA  IF NO BANK/BRANCH SHOW 'N/A'              
         OI    LEVELBIT,NOTAPPL                                                 
         B     DDSNX                                                            
*                                                                               
DDSN30   BRAS  RE,EDIBNK           DISPLAY EDI BANK INFO FROM DDGETBANK         
         BNE   *+14                                                             
         MVC   FVIFLD(L'BANEFDSN),BCWORK                                        
         B     DDSNX               FOUND ON AFM BANK REC                        
         MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
*                                                                               
DDSNX    MVI   SBYTE,BANKPROF      MOVE IN BANK PROFILE SECURITY NUMBER         
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         TM    CUSTAT,CUSDDS       IF NOT A DDS TERMINAL PROTECT THE            
         BO    *+8                 FIELD - EVEN IF WRITE/READ ACCESS            
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
***********************************************************************         
* VALIDATE THE MESSAGE CLASS FOR ACR/EFT/POSPAY                       *         
***********************************************************************         
         SPACE 1                                                                
VALDSN   NI    FVATRB,X'FF'-FVAPROT                                             
         NI    BYTE3,X'FF'-ELEMF                                                
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,BANKPROF      MOVE IN BANK PROF SECURITY NUMBER            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VDSNX                                                            
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VDSN10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VDSNX                                                            
*                                                                               
VDSN10   MVI   BCBYTE1,0                                                        
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#CRDSN)      ACR DATASET NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTACR                                                   
         B     VDSN20                                                           
         CLM   R1,3,=AL2(ACC#EFDSN)      EFT DATASET NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTEFT                                                   
         B     VDSN20                                                           
         CLM   R1,3,=AL2(ACC#PPDSN)      POSPAY DATASET NAME?                   
         BNE   *+12                                                             
         OI    BCBYTE1,FFTPOS                                                   
         B     VDSN20                                                           
         CLM   R1,3,=AL2(ACC#820DSN)     820 DATASET NAME?                      
         BE    *+6                                                              
         DC    H'0'                                                             
         OI    BCBYTE1,FFT820                                                   
         B     VDSN20                                                           
*                                                                               
VDSN20   NI    BYTE4,X'FF'-(MSGCLF+DSNF)                                        
         LA    R3,ACTRFST                                                       
         USING FFTELD,R3                                                        
VDSN30   CLI   0(R3),0                                                          
         BE    VDSN60                                                           
         CLI   0(R3),FFTELQ                                                     
         BNE   *+12                                                             
         CLI   FFTTYPE,FFTTEDIP                                                 
         BE    VDSN50                                                           
VDSN40   ZIC   R1,1(R3)                                                         
         AR    R3,R1                                                            
         B     VDSN30                                                           
*                                                                               
VDSN50   CLC   FFTETYP,BCBYTE1                                                  
         BNE   VDSN40                                                           
         OI    BYTE3,ELEMF                                                      
         CLC   FFTMSGC,BCSPACES    ANY MESSAGE CLASS FOUND IN ELEM?             
         BNH   *+8                                                              
         OI    BYTE4,MSGCLF                                                     
         MVC   FFTDNAM,BCSPACES                                                 
         ZIC   R1,FFTLN            ELEMENT LENGTH                               
         BCTR  R1,0                                                             
         EXMVC R1,SVELEM,0(R3)                                                  
         MVI   0(R3),X'FF'                                                      
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),(X'FF',ACTRECD),0                  
*                                                                               
VDSN60   ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NONE   'NONE' ENTERED?                              
         BE    VDSN70                                                           
         CLI   FVILEN,0            ANYTHING ENTERED?                            
         BE    VDSN70              NO                                           
*                                                                               
         TM    BYTE3,ELEMF         ELEMENT FOUND?                               
         BZ    VDSN80                                                           
         LA    R3,SVELEM                                                        
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FFTDNAM,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
         B     VDSNX                                                            
*                                                                               
* NO DATASET NAME ENTERED                                                       
VDSN70   DS    0H                                                               
         TM    BYTE4,MSGCLF          IF ANY OTHER SETTINGS EXIST                
         BZ    VDSNX                                                            
         B     VDSN90                MUST PUT BACK ELEMENT                      
*                                                                               
VDSN80   DS    0H                                                               
         LA    R3,BOELEM                                                        
         USING FFTELD,R3                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   FFTEL,FFTELQ                                                     
         MVI   FFTLN,FFTBLNQ+FFTLN1Q+1      TOTAL LENGTH                        
         MVI   FFTDLEN,FFTBLNQ     ACTUAL LENGTH OF DATA                        
         MVI   FFTTYPE,FFTTEDIP                                                 
         MVC   FFTETYP,BCBYTE1     CONTAINS THE TYPE OF EDI (ACR,EFT)           
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FFTDNAM,FVIFLD                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),BOELEM,0                      
         CLI   12(R1),0                                                         
         BE    VDSNX                                                            
         DC    H'0'                                                             
*                                                                               
VDSN90   GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),(R2),SVELEM,0                      
*                                                                               
VDSNX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAY ACR/POSPAY/EFT DATASET NAME FILTER                                    
***********************************************************************         
         SPACE 1                                                                
DFDSNF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE THE ACR/POSPAY/EFT DATASET NAME FILTER                               
***********************************************************************         
         SPACE 1                                                                
VFDSNF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'SC',ACTKUNT      FILTER ONLY VALID FOR SC                     
         BNE   ERRFILT                                                          
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON ACR/POSPAY/EFT DATASET NAME FILTER                            
* 1.  CHECK AT LOW LEVEL ACCOUNT RECORD                               *         
* 2.  IF NOT FOUND CHECK ON AFM BANK RECORD                           *         
* 3.  IF NOT FOUND CHECK ON CFILE BANK RECORD                         *         
***********************************************************************         
         SPACE 1                                                                
DOFDSNF  MVI   BCBYTE2,C'D'        LOOKING FOR DATASET NAME                     
         BRAS  RE,FLTBNK                                                        
         CLI   FILTEQ,0                                                         
         BE    DOFDSN10            NOTHING FOUND ON LOW LEVEL SC                
         CLI   FILTEQ,C'E'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         CLI   FILTEQ,C'H'                                                      
         BE    FLTXH                                                            
         B     FLTXL                                                            
*                                                                               
DOFDSN10 BRAS  RE,GTBNK            READ AFM/CFILE BANK RECS (DDGETBANK)         
         BE    DOFDSN20                                                         
         CLC   FLTIFLD(L'AC@NTAVL),AC@NTAVL IF BNK/BRNCH CODE NOT FOUND         
         BE    FLTXE                   FILTER VALUE OF N/A IS THE ONLY          
         B     FLTXL                   FILTER THAT IS VALID.                    
*                                                                               
DOFDSN20 BRAS  RE,EDIBNK                                                        
         BE    DOFDSN30                                                         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE IF DSN NOT FOUND FILTER VALUE         
         BE    FLTXE                      OF NONE IS THE ONLY FILTER            
         B     FLTXL                      THAT IS VALID.                        
*                                                                               
DOFDSN30 ZIC   R1,FVXLEN                                                        
         EXCLC R1,BCWORK,FLTIFLD   BCWORK CONTAINS THE VALUE FROM THE           
         BE    FLTXE               DDGETBANK EDIBNK ROUTINE                     
         BL    FLTXL                                                            
         BH    FLTXH                                                            
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR REFRESH W/ CLEARANCE PROFILE ON VENDOR PAYABLES     *         
* AFM:   REFRESH W/ CLEARANCE                                         *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
RCLEAR   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,RCLRTB                                                        
         B     ITER                                                             
*                                                                               
RCLRTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISCLR)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISCLR)     FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALCLR)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFCLRF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFCLRF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFCLRF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY REFRESH W/ CLEARANCE PROFILE                                *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISCLR   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISCLR10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISCLRX                                                          
*                                                                               
DISCLR10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISCLRX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         TM    RSTSTAT6,RSTLNAM+RSTLADDR                                        
         BZ    DISCLR25                        BOTH BITS OFF (REF BOTH)         
         BO    DISCLR15                        BOTH BITS ON (REF NONE)          
         TM    RSTSTAT6,RSTLNAM                DON'T REFRESH NAME?              
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@NF111),AC@NF111       THAN SHOW ADDR                 
         B     DISCLR20                                                         
         TM    RSTSTAT6,RSTLADDR               DON'T REFRESH ADDRESS?           
         BZ    DISCLRX                                                          
         MVC   FVIFLD(L'AC@NF111),AC@NAME        THAN SHOW NAME                 
         B     DISCLR20                                                         
DISCLR15 MVC   FVIFLD(L'AC@NONE),AC@NONE                                        
DISCLR20 OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     DISCLRX                                                          
DISCLR25 MVC   FVIFLD(L'AC@BOTH),AC@BOTH       DEFAULT TO BOTH                  
*                                                                               
DISCLRX  MVI   SBYTE,VACCSEC       MOVE IN VENDOR ACC SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE REFRESH W/ CLEARANCE PROFILE                               *         
***********************************************************************         
         SPACE 1                                                                
VALCLR   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VACCSEC       MOVE IN VENDOR ACCT SEC NUM                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VALCLRX                       THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VCLR02                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALCLRX                                                          
*                                                                               
VCLR02   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT6,X'FF'-(RSTLNAM+RSTLADDR)                                
         CLI   FVILEN,0                                                         
         BE    VALCLRX                                                          
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NONE   REFRESH NONE?                                
         BNE   VCLR05                                                           
         OI    RSTSTAT6,RSTLNAM+RSTLADDR  TURN ON BOTH BITS                     
         B     VALCLRX                                                          
*                                                                               
VCLR05   EXCLC RE,FVIFLD,AC@NAME   REFRESH NAME ONLY?                           
         BE    VCLR10                                                           
         EXCLC RE,FVIFLD,AC@NF110  REFRESH NAME ONLY?                           
         BNE   VCLR15                                                           
VCLR10   OI    RSTSTAT6,RSTLADDR   ONLY TURN ON ADDRESS BIT                     
         B     VALCLRX                                                          
*                                                                               
VCLR15   EXCLC RE,FVIFLD,AC@NF111  REFRESH ONLY ADDRESS?                        
         BE    VCLR20                                                           
         EXCLC RE,FVIFLD,AC@ADD    REFRESH ONLY ADDRESS?                        
         BNE   VCLR25                                                           
VCLR20   OI    RSTSTAT6,RSTLNAM    ONLY TURN ON NAME BIT                        
         B     VALCLRX                                                          
*                                                                               
VCLR25   EXCLC RE,FVIFLD,AC@BOTH   REFRESH BOTH? (LEAVE BOTH BITS OFF)          
         BNE   EXITNV              DEFAULT                                      
*                                                                               
VALCLRX  BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY REFRESH W/ CLEARANCES FILTER                                *         
***********************************************************************         
         SPACE 1                                                                
DFCLRF   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE REFRESH W/ CLEARANCE FILTER                                *         
***********************************************************************         
         SPACE 1                                                                
VFCLRF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SP'  FILTER ONLY VALID           
         BL    ERRFILT                              FOR MEDIA PAYABLE           
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SU'  LEDGERS SP,SQ,SS,           
         BH    ERRFILT                              ST,SU                       
         CLC   =C'SR',ACTKUNT                                                   
         BE    ERRFILT                                                          
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NONE               ENTERED 'NONE'                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@NAME               ENTERED 'NAME'                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NAME),AC@NAME                                       
         B     EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@NF110              ENTERED 'NM'                     
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NAME),AC@NAME                                       
         B     EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@NF111              ENTERED 'ADDR'                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NF111),AC@NF111                                     
         B     EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@ADD                ENTERED 'AD'                     
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NF111),AC@NF111                                     
         B     EXITOK                                                           
*                                                                               
         EXCLC RE,FVIFLD,AC@BOTH                                                
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@BOTH),AC@BOTH      ENTERED 'BOTH'                   
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON REFRESH W/ CLEAR PROFILE                            *         
***********************************************************************         
         SPACE 1                                                                
DOFCLRF  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          DON'T FILTER ON HIGH LEVEL ACCTS             
         BNE   FLTXL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLC   FLTIFLD(L'AC@BOTH),AC@BOTH      REFRESH BOTH?                    
         BNE   DOCLRF10                                                         
         TM    RSTSTAT6,RSTLNAM+RSTLADDR                                        
         BZ    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOCLRF10 CLC   FLTIFLD(L'AC@NONE),AC@NONE        REFRESH NONE?                  
         BNE   DOCLRF20                                                         
         TM    RSTSTAT6,RSTLNAM+RSTLADDR                                        
         BO    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOCLRF20 CLC   FLTIFLD(L'AC@NAME),AC@NAME      REFRESH NAMES?                   
         BNE   DOCLRF30                                                         
         TM    RSTSTAT6,RSTLADDR               THAN THE ADDRESS BIT             
         BZ    FLTXL                           MUST BE ON BUT THE               
         TM    RSTSTAT6,RSTLNAM                NAME BIT MUST BE OFF             
         BZ    FLTXE                                                            
         B     FLTXL                                                            
*                                                                               
DOCLRF30 TM    RSTSTAT6,RSTLNAM                MUST WANT ADDRESS                
         BZ    FLTXL                           THAN THE NAME BIT MUST           
         TM    RSTSTAT6,RSTLADDR               BE ON BUT THE ADDRESS            
         BZ    FLTXE                           BIT MUST BE OFF                  
         B     FLTXL                                                            
*                                                                               
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR ACCOUNT PHONE #                                     *         
* AFM:   PHONE #                                                      *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PHONE    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PHN#TB                                                        
         B     ITER                                                             
*                                                                               
PHN#TB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISPHN)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISPHN)     FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALPHN)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFPHNF)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFPHNF)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFPHNF)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACCOUNT PHONE NUMBER                                        *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
DISPHN   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISPHN10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT                                                   
         B     DISPHNX                                                          
*                                                                               
DISPHN10 GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTPTEL                                  
         BRAS  RE,CKLOPRO          CHECK LOW LEVEL AND PROTECT FIELD            
DISPHNX  B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PHONE NUMBER                                               *         
***********************************************************************         
         SPACE 1                                                                
VALPHN   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VALPHN5                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VALPHNX                                                          
*                                                                               
VALPHN5  CLI   FVILEN,0                                                         
         BE    VALPHN30                                                         
         ZIC   RF,FVXLEN                                                        
         EX    RF,VALPHN10                                                      
         EX    RF,VALPHN15                                                      
         EX    RF,VALPHN20                                                      
         B     VALPHN25                                                         
*                                                                               
VALPHN10 MVC   BCWORK(0),=15X'F0'                                               
VALPHN15 MVZ   BCWORK(0),FVIFLD                                                 
VALPHN20 CLC   BCWORK(0),=15X'F0'                                               
*                                                                               
VALPHN25 BNE   EXITNV                                                           
VALPHN30 GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTPTEL                                  
VALPHNX  B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DISPLAY PHONE # FILTER                                                        
***********************************************************************         
         SPACE 1                                                                
DFPHNF   MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PHONE # FILTER                                                       
***********************************************************************         
         SPACE 1                                                                
VFPHNF   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         MVC   FLTIFLD,BCSPACES                                                 
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON PHONE #                                             *         
***********************************************************************         
         SPACE 1                                                                
DOFPHNF  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R2)),          +        
               (L'FFTTYPE,=AL1(FFTTPTEL))                                       
         CLI   12(R1),0                                                         
         BNE   FLTXL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
         LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
DOPHN10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BH    DOPHN20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOPHN10                                                       
*                                                                               
DOPHN20  LTR   R1,R1                                                            
         BZ    FLTXX                                                            
         BCTR  R1,0                                                             
         EXCLC R1,FFTDATA,FLTIFLD                                               
         BL    FLTXL                                                            
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* REVERSE SIGN OF CR BAL (FOR ACCENT)                                 *         
* G/L LEDGERS ONLY.  ONLY VALID AT HIGH LEVEL GB/GP ACCOUNTS          *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
RVSGN    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,RVSGNTB                                                       
         B     ITER                                                             
*                                                                               
RVSGNTB  DC    AL1(DDIS),AL1(0,0,0),AL4(DISRVSGN)                               
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISRVSGN) *FOR REPORT                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALRVSGN)                               
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFRVSGN)                               
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFRVSGN)                               
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFRVSGN)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY REVERSE SIGN OF CR BAL PROFILE                              *         
* VALID ON HIGHEST LEVEL GB/GP ACCOUNT ONLY BUT AFFECTS ALL LEVELS    *         
***********************************************************************         
         USING ACTRECD,R2                                                       
DISRVSGN BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,FINDPRF          READ ACC LEVELS FOR THE PROFILE              
         CLI   LEVELBIT,0          HAS THE PROFILE BEEN FOUND ON                
         BNE   DRSGN10             ANY LEVEL?  YES                              
         MVC   FVIFLD(L'AC@NO),AC@NO    NO IS THE DEFAULT                       
*                                                                               
DRSGN10  CLI   LEVELN,1            FIRST LEVEL?                                 
         BE    DRSGNX                                                           
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD                         
                                                                                
DRSGNX   MVI   SBYTE,GLSEC         GENERAL LEDGER SECURITY #                    
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE REVERSE SIGN OF CR BALANCE                                 *         
***********************************************************************         
         SPACE 1                                                                
VALRVSGN NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,GLSEC         MOVE IN G/L SEC #                            
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VRSGNX                                                           
*                                                                               
         CLI   LEVELN,1            FIRST LEVEL?                                 
         BE    VRSGN10                                                          
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VRSGNX                                                           
*                                                                               
*        BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
*        BE    VALML5                         VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@STDRD),AC@STDRD    SHOW 'STANDARD'                   
*        OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
*        B     VALMLX                                                           
*                                                                               
VRSGN10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT6,X'FF'-(RSTYREVS+RSTNREVS)                               
         CLI   FVILEN,0                                                         
         BE    VRSGNX                                                           
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@NO                                                  
         BNE   *+12                                                             
         OI    RSTSTAT6,RSTNREVS                                                
         B     VRSGNX                                                           
         EXCLC R1,FVIFLD,AC@YES                                                 
         BNE   EXITNV                                                           
         OI    RSTSTAT6,RSTYREVS                                                
*                                                                               
VRSGNX   BRAS  RE,DISSET           UPDATE SETTINGS TABLE                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY REVERSE SIGN OF CR BALANCE FILTER                           *         
***********************************************************************         
         SPACE 1                                                                
DFRVSGN  CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         CLI   FLTIFLD,C'N'        NO                                           
         BNE   *+14                                                             
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         B     EXITOK                                                           
         CLI   FLTIFLD,C'Y'        YES                                          
         BNE   EXITOK                                                           
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE REVERSE SIGN OF CR BALANCE FILTER                          *         
***********************************************************************         
         SPACE 1                                                                
VFRVSGN  CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         CLC   =C'G',ACTKUNT       UNIT G ONLY                                  
         BNE   ERRFILT                                                          
         ZIC   R1,FVXLEN                                                        
         EXCLC R1,FVIFLD,AC@YES    YES                                          
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
         EXCLC R1,FVIFLD,AC@NO     NO                                           
         BNE   EXITNV                                                           
         MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON REVERSE SIGN OF CR BAL                              *         
***********************************************************************         
         SPACE 1                                                                
DOFRVSGN CLC   =C'G',ACTKUNT      ONLY VALID FOR UNIT G                         
         BNE   FLTXX                                                            
         BRAS  RE,FILTPRF                                                       
         CLI   FILTEQ,C'Y'         ACCT PASSED FILTER TEST?                     
         BE    FLTXE                                                            
         B     FLTXL                                                            
         EJECT                                                                  
         SPACE 1                                                                
***********************************************************************         
* DATA OBJECT FOR 2P T&E ACCT CODE FOR SY (BRANDOCEAN)                *         
* AFM:   2P T&E CODE                                                  *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PERDTA   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PERDTB                                                        
         B     ITER                                                             
*                                                                               
PERDTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISPER)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISPER)     FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALPER)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCHPER)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY 2P T&E ACCOUNT CODE                                         *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISPER   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISPER10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISPERX                                                          
*                                                                               
DISPER10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',ACTRECD),       X        
               (L'SPATYPE,=AL1(SPATPERS))                                       
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42      '(NONE)' IS THE DEFAULT         
         B     DISPERX                                                          
         L     RF,12(,R1)                                                       
         MVC   FVIFLD(L'SPAAACT),SPAAACT-SPAELD(RF)                             
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DISPERX  MVI   SBYTE,BRDOEXP       MOVE IN BRANDO EXP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE 2P T&E ACCOUNT CODE                                        *         
***********************************************************************         
         SPACE 1                                                                
VALPER   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
         CLI   FVILEN,0                                                         
         BNE   VPER01                                                           
         BRAS  RE,GETPER                                                        
         MVC   SVOLDPER,BOWORK1    SAVE OLD PERSONNEL ACCOUNT                   
         B     VPER30                                                           
*                                                                               
VPER01   MVI   SBYTE,BRDOEXP       MOVE IN BRANDOCEAN EXP SEC NUM               
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VPERX                         THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VPER05                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VPERX                                                            
*                                                                               
VPER05   TM    ACCINDS,ACCICKSP    ROUTINE CHKSPAC HAS BEEN CALLED?             
         BO    *+8                                                              
         BRAS  RE,CHKSPAC          CHECK STAFF PAYABLES ACCOUNTS                
*                                                                               
         TM    ACCINDS,ACCISPAC                                                 
         BO    *+14                                                             
*        MVC   FVXTRA(L'ACTKULA),ACTKULA                                        
         MVC   FVMSGNO,=AL2(AE$IASPA)                                           
         B     EXITL               INPUT ALLOWED FOR STAFF PAYABLE ONLY         
         OI    ACCINDS,ACCIPER     PERSONNEL ACCOUNT HAS BEEN ENTERED           
*                                                                               
         BRAS  RE,GETPER                                                        
         MVC   SVOLDPER,BOWORK1    SAVE OLD PERSONNEL ACCOUNT                   
*                                                                               
T        USING ACTRECD,IOKEY       NOW TRY TO FIND THE ACCOUNT                  
VPER10   MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,ACTKCPY                                                
         MVC   T.ACTKUNT(2),=C'2P'                                              
         MVC   T.ACTKACT,FVIFLD                                                 
         GOTO1 AGETACT,0           READ ACCOUNT/TEST SECURITY                   
         BNE   EXITL                                                            
*                                                                               
         TM    ACINDS1,ACIACTLO    TEST LOW LEVEL ACCOUNT                       
         BO    *+20                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)                                           
         MVC   FVXTRA(L'ACTKULA),T.ACTKULA                                      
         B     EXITL               NOT A LOWER LEVEL ACCOUNT                    
*                                                                               
         TM    ACBSTAT,ACBSLOCK    TEST LOCKED ACCOUNT                          
         BZ    *+20                                                             
         MVC   FVMSGNO,=AL2(AE$ACTLK)                                           
         MVC   FVXTRA(L'ACTKULA),T.ACTKULA                                      
         B     EXITL               ACCOUNT IS LOCKED                            
*                                                                               
*                                  2P ACCOUNT RECORD IN AIO1                    
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('PIDELQ',AIO1),0                  
         CLI   12(R1),0                                                         
         BNE   VPER30              OK-PIDEL NOT FOUND IN 2P ACCT                
         L     R3,12(,R1)                                                       
P1       USING PIDELD,R3                                                        
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('PIDELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   VPER20              ERROR - PIDEL NO FOUND IN CREDITOR           
         L     R4,12(,R1)                                                       
P2       USING PIDELD,R4                                                        
         CLC   P1.PIDNO,P2.PIDNO                                                
         BE    VPER30              OK - SAME PID CODE                           
VPER20   MVC   FVMSGNO,=AL2(AE$PEREX)                                           
         B     EXITL               2P ACCOUNT ALREADY EXISTS                    
*                                                                               
VPER30   GOTO1 ABLDSPA,BOPARM,ACTRECD,SPATPERS,T.ACTKULA                        
*                                                                               
VPERX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  T,P1,P2                                                          
         SPACE 2                                                                
***********************************************************************         
* SEARCH ON A PERSONNEL ACCOUNT                                       *         
***********************************************************************         
         SPACE 1                                                                
SRCHPER  GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,=C'2P',ACOM,(X'44',0)            
         B     EXITOK                                                           
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR 2D DEPT ACCOUNT CODE FOR SY (BRANDOCEAN)            *         
* AFM:   2D DEPT CODE                                                 *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
DPTDTA   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,DPTTB                                                         
         B     ITER                                                             
*                                                                               
DPTTB    DC    AL1(DDIS),AL1(0,0,0),AL4(DISDPT)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISDPT)     FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALDPT)                                 
         DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCHDPT)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY 2D DEPT ACCOUNT CODE                                        *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISDPT   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISDPT10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISDPTX                                                          
*                                                                               
DISDPT10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',ACTRECD),       X        
               (L'SPATYPE,=AL1(SPATDEPT))                                       
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42      '(NONE)' IS THE DEFAULT         
         B     DISDPTX                                                          
         L     RF,12(,R1)                                                       
         MVC   FVIFLD(L'SPAAACT),SPAAACT-SPAELD(RF)                             
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DISDPTX  MVI   SBYTE,BRDOEXP       MOVE IN BRANDO EXP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE 2D T&E ACCOUNT CODE                                        *         
***********************************************************************         
         SPACE 1                                                                
VALDPT   NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
         CLI   FVILEN,0                                                         
         BE    VDPT10                                                           
*                                                                               
         MVI   SBYTE,BRDOEXP       MOVE IN BRANDOCEAN EXP SEC NUM               
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VDPTX                         THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VDPT05                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VDPTX                                                            
*                                                                               
VDPT05   TM    ACCINDS,ACCICKSP    ROUTINE CHKSPAC HAS BEEN CALLED?             
         BO    *+8                                                              
         BRAS  RE,CHKSPAC          CHECK STAFF PAYABLES ACCOUNTS                
*                                                                               
         TM    ACCINDS,ACCISPAC                                                 
         BO    *+14                                                             
*        MVC   FVXTRA(L'ACTKULA),ACTKULA                                        
         MVC   FVMSGNO,=AL2(AE$IASPA)                                           
         B     EXITL               INPUT ALLOWED FOR STAFF PAYABLE ONLY         
         OI    ACCINDS,ACCIDPT     DEPARTMENT ACCT HAS BEEN ENTERED             
*                                                                               
T        USING ACTRECD,IOKEY       NOW TRY TO FIND THE ACCOUNT                  
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,ACTKCPY                                                
         MVC   T.ACTKUNT(2),=C'2D'                                              
         MVC   T.ACTKACT,FVIFLD                                                 
         GOTO1 AGETACT,0           READ ACCOUNT/TEST SECURITY                   
         BNE   EXITL                                                            
*                                                                               
         TM    ACINDS1,ACIACTLO    TEST LOW LEVEL ACCOUNT                       
         BO    *+20                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)                                           
         MVC   FVXTRA(L'ACTKULA),T.ACTKULA                                      
         B     EXITL               NOT A LOWER LEVEL ACCOUNT                    
*                                                                               
         TM    ACBSTAT,ACBSLOCK    TEST LOCKED ACCOUNT                          
         BZ    *+20                                                             
         MVC   FVMSGNO,=AL2(AE$ACTLK)                                           
         MVC   FVXTRA(L'ACTKULA),T.ACTKULA                                      
         B     EXITL               ACCOUNT IS LOCKED                            
*                                                                               
VDPT10   GOTO1 ABLDSPA,BOPARM,ACTRECD,SPATDEPT,T.ACTKULA                        
*                                                                               
VDPTX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* SEARCH ON A DEPARTMENT ACCOUNT                                      *         
***********************************************************************         
         SPACE 1                                                                
SRCHDPT  GOTO1 VACSRCHC,BOPARM,(3,FVADDR),ATWA,=C'2P',ACOM,(X'44',0)            
         B     EXITOK                                                           
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR PERSONAL ID FOR SY (BRANDOCEAN)                     *         
* AFM:   PERSONAL ID                                                  *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
PIDCDTA  DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,PIDTB                                                         
         B     ITER                                                             
*                                                                               
PIDTB    DC    AL1(DDIS),AL1(0,0,0),AL4(DISPID)                                 
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISPID)     FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALPIDC)                                
*        DC    AL1(DSRCH),AL1(0,0,0),AL4(SRCHPID)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY PERSONAL ID                                                 *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISPID   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DPID10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DPIDX                                                            
*                                                                               
DPID10   GOTO1 VHELLO,BCPARM,(C'G',GCFILNAM),('PIDELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42      '(NONE)' IS THE DEFAULT         
         B     DPIDX                                                            
         L     RF,12(,R1)          RF=A(PID ELEMENT)                            
         MVC   BOWORK1(L'PIDNO),PIDNO-PIDELD(RF)                                
         GOTOX ('GETPID',AGROUTS),BOWORK1                                       
         MVC   FVIFLD(L'SAPALPID),BCWORK                                        
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DPIDX    MVI   SBYTE,BRDOEXP       MOVE IN BRANDO EXP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE PERSONAL ID                                                *         
***********************************************************************         
         SPACE 1                                                                
VALPIDC  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
         CLI   FVILEN,0                                                         
         BNE   VPID02                                                           
         BRAS  RE,GETPIDP                                                       
         MVC   SVOLDPID,BOWORK1    SAVE OLD PID NUMBER                          
         XC    BCWORK,BCWORK       CLEAR THIS SO ELEM WILL BE DELETED           
         B     VPID50              DELETE PIDEL FROM ACCOUNT REC.               
*                                                                               
VPID02   MVI   SBYTE,BRDOEXP       MOVE IN BRANDOCEAN EXP SEC NUM               
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VPIDX                         THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VPID05                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VPIDX                                                            
*                                                                               
VPID05   MVC   FVXTRA,BCSPACES                                                  
         CLI   FVILEN,0                                                         
         BNE   VPID10                                                           
         TM    ACCINDS,ACCIPER+ACCIDPT                                          
         BZ    VPID20                                                           
         B     EXITNO              MISSING INPUT FIELD                          
*                                                                               
VPID10   TM    ACCINDS,ACCICKSP    ROUTINE CHKSPAC HAS BEEN CALLED?             
         BO    *+8                                                              
         BRAS  RE,CHKSPAC          CHECK STAFF PAYABLES ACCOUNTS                
*                                                                               
         TM    ACCINDS,ACCISPAC                                                 
         BO    *+14                                                             
*        MVC   FVXTRA(L'ACTKULA),ACTKULA                                        
         MVC   FVMSGNO,=AL2(AE$IASPA)                                           
         B     EXITL               INPUT ALLOWED FOR STAFF PAYABLE ONLY         
*                                                                               
VPID20   BRAS  RE,GETPIDP                                                       
         MVC   SVOLDPID,BOWORK1    SAVE OLD PID NUMBER                          
*                                                                               
VPID30   GOTOX ('VALPID',AGROUTS),FVIFLD                                        
         BE    VPID40                                                           
         MVC   FVMSGNO,=AL2(AE$INPID)                                           
         MVI   FVOSYS,QSACC        INVALID PERSONAL ID                          
         B     EXITL                                                            
*                                                                               
T        USING PIDRECD,IOKEY       READ FOR CREDITOR PID PASSIVE                
VPID40   XC    T.PIDKEY,T.PIDKEY   CLEAR KEY                                    
         MVC   T.PIDKCPY,ACTKCPY   SET UP PASSIVE KEY                           
         MVI   T.PIDKTYP,PIDKTYPQ                                               
         MVI   T.PIDKSUB,PIDKSUBQ                                               
         MVC   T.PIDKPID,BCWORK    SET PASSIVE PID                              
         MVI   T.PIDKSTYP,PIDKCRDQ SET CREDITOR PASSIVE SUB TYPE                
         LHI   R1,XOHIGH+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BNE   VPID50                                                           
         CLC   T.PIDKEY(PIDKULA-PIDRECD),IOKEYSAV                               
         BNE   VPID50                                                           
         CLC   T.PIDKULA,ACTKULA   TEST SAME ACCOUNT                            
         BE    VPID50              YES - OK                                     
         MVC   FVMSGNO,=AL2(AE$PIDAC)                                           
         MVC   FVXTRA(L'PIDKULA),T.PIDKULA                                      
         B     EXITL               PERSONAL PID EXISTS ON ACCOUNT REC.          
         DROP  T                                                                
*                                                                               
VPID50   GOTO1 ABLDPID,BOPARM,ACTRECD,BCWORK                                    
*                                                                               
VPIDX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR FUTURE TIME ALLOWED                                 *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
FUTA     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,FUTATBL                                                       
         B     ITER                                                             
*                                                                               
FUTATBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DISFUTA)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISFUTA)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALFUTA)                                
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFFUTA)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFFUTA)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFFUTA)                                
         DC    AL1(EOT)                                                         
***********************************************************************         
* DISPLAY FUTURE TIME ALLOWED - FOR 1N ONLY                           *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                               
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISFUTA  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DFUT10                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DFUTX                                                            
*                                                                               
DFUT10   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DFUTX                                                            
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         CLI   RSTLN,RSTLN3Q                                                    
         JL    DFUTX                                                            
         TM    RSTSTAT7,RSTSFUTM                                                
         BZ    DFUTX                                                            
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DFUTX    MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC NUMBER              
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE FUTURE TIME ALLOWED - 1N                                   *         
***********************************************************************         
         SPACE 1                                                                
VALFUTA  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,TIMEPROF      MOVE IN TIME PROFILE SEC #                   
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VFUTAX                                                           
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT7,X'FF'-(RSTSFUTM)                                        
         CLI   FVILEN,0            NO INPUT - DEFAULT IS NO                     
         BE    VFUTAX                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NO                                                  
         BE    VFUTAX              NO                                           
         CLC   FVIFLD(0),AC@YES                                                 
         BNE   EXITNV                                                           
         OI    RSTSTAT7,RSTSFUTM                                                
*                                                                               
VFUTAX   BRAS  RE,DISSET                                                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY FUTURE TIME ALLOWED FILTER - 1N                             *         
***********************************************************************         
         SPACE 1                                                                
DFFUTA   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
*                                                                               
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE FUTURE TIME ALLOWED FILTER - 1N                            *         
***********************************************************************         
         SPACE 1                                                                
VFFUTA   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
*                                                                               
         XR    RE,RE                                                            
         IC    RE,FVXLEN                                                        
         EX    RE,*+8                                                           
         BE    VFFUTA02            NO                                           
         CLC   FVIFLD(0),AC@NO                                                  
         B     VFFUTA04                                                         
*                                                                               
VFFUTA02 MVC   FLTIFLD(L'AC@NO),AC@NO                                           
         B     EXITOK                                                           
*                                                                               
VFFUTA04 EX    RE,*+8                                                           
         BE    VFFUTA06            YES                                          
         CLC   FVIFLD(0),AC@YES                                                 
         B     EXITNV                                                           
*                                                                               
VFFUTA06 MVC   FLTIFLD(L'AC@YES),AC@YES                                         
         B     EXITOK                                                           
*                                                                               
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON FUTURE TIME  ALLOWED - 1N                           *         
***********************************************************************         
         SPACE 1                                                                
DOFFUTA  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLC   FLTIFLD(L'AC@NO),AC@NO  NO FUTURE TIME ALLOWED                   
         BNE   DOFUTA02                                                         
         TM    RSTSTAT7,RSTSFUTM                                                
         BO    FLTXL               IT IS LOCKED - NOT WANTED                    
         B     FLTXE                                                            
*                                                                               
DOFUTA02 CLC   FLTIFLD(L'AC@YES),AC@YES FUTURE TIME ALLOWED                     
         BNE   FLTXL               NO                                           
         CLI   RSTLN,RSTLN3Q                                                    
         JL    FLTXL                                                            
         TM    RSTSTAT7,RSTSFUTM   IT IS FUTURE TIME ALLOWED                    
         BZ    FLTXL               NO                                           
         B     FLTXE               YES                                          
         DROP  RF                                                               
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR BUSINESS CONTACT NAME                               *         
* AFM:   CONTACT (PAGE 4)                                             *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BCNM     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BCNMTBL                                                       
         B     ITER                                                             
*                                                                               
BCNMTBL  DC    AL1(DDIS),AL1(0,0,0),AL4(DBCNM)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VBCNM)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BUSINESS CONTACT NAME                                       *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DBCNM    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DBCNM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DBCNMX                                                           
*                                                                               
DBCNM10  GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTBCNM                                  
DBCNMX   B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BUSINESS CONTACT NAME                                      *         
***********************************************************************         
         SPACE 1                                                                
VBCNM    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBCNM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VBCNMX                                                           
*                                                                               
VBCNM10  GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('FFTELQ',ACTRECD),       *        
               (L'FFTTYPE,=AL1(FFTTBCNM))                                       
         CLI   FVILEN,0                                                         
         BE    VBCNMX                                                           
         GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTBCNM                                  
VBCNMX   B     EXITOK                                                           
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR BUSINESS PHONE NUMBER                               *         
* AFM:   PHONE #                                                      *         
* FILE:  DID NOT EXIST                                                *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BPHN     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BPHNTB                                                        
         B     ITER                                                             
*                                                                               
BPHNTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DBPHN)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VBPHN)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BUSINESS ACCOUNT PHONE NUMBER                               *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
DBPHN    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DBPHN10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT                                                   
         B     DBPHNX                                                           
*                                                                               
DBPHN10  GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTBPHN                                  
DBPHNX   B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BUSINESS ACCOUNT PHONE NUMBER                              *         
***********************************************************************         
         SPACE 1                                                                
VBPHN    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBPHN5                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VBPHNX                                                           
*                                                                               
VBPHN5   CLI   FVILEN,0                                                         
         BE    VBPHN30                                                          
         ZIC   RF,FVXLEN                                                        
         EX    RF,VBPHN10                                                       
         EX    RF,VBPHN15                                                       
         EX    RF,VBPHN20                                                       
         B     VBPHN25                                                          
*                                                                               
VBPHN10  MVC   BCWORK(0),=30X'F0'                                               
VBPHN15  MVZ   BCWORK(0),FVIFLD                                                 
VBPHN20  CLC   BCWORK(0),=30X'F0'                                               
*                                                                               
VBPHN25  BNE   EXITNV                                                           
VBPHN30  GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTBPHN                                  
VBPHNX   B     EXITOK                                                           
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR BUSINESS FAX #                                      *         
* VALID AT LOW LEVEL ACCOUNT ONLY                                     *         
* FAX= - FAX NUMBER                                                   *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BFAX     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BFAXTB                                                        
         B     ITER                                                             
*                                                                               
BFAXTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DBFAX)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VBFAX)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BUSINESS FAX NUMBER                                         *         
***********************************************************************         
         SPACE 1                                                                
DBFAX    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DBFAX10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT                                                   
         B     DBFAXX                                                           
*                                                                               
DBFAX10  GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTBFAX                                  
DBFAXX   B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BUSINESS FAX NUMBER                                        *         
***********************************************************************         
         SPACE 1                                                                
VBFAX    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBFAX5                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VBFAXX                                                           
*                                                                               
VBFAX5   CLI   FVILEN,0                                                         
         BE    VBFAX30                                                          
         ZIC   RF,FVXLEN                                                        
         EX    RF,VBFAX10                                                       
         EX    RF,VBFAX15                                                       
         EX    RF,VBFAX20                                                       
         B     VBFAX25                                                          
*                                                                               
VBFAX10  MVC   BCWORK(0),=30X'F0'                                               
VBFAX15  MVZ   BCWORK(0),FVIFLD                                                 
VBFAX20  CLC   BCWORK(0),=30X'F0'                                               
*                                                                               
VBFAX25  BNE   EXITNV                                                           
VBFAX30  GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTBFAX                                  
VBFAXX   B     EXITOK                                                           
*                                                                               
***********************************************************************         
* DATA OBJECT FOR BUSINESS EMAIL ADDRESS                              *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
BEML     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,BEMLTB                                                        
         B     ITER                                                             
*                                                                               
BEMLTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DBEML)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VBEML)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY BUSINESS EMAIL ADDRESS                                      *         
* VALID ON LOW LEVEL ACCOUNT ONLY                                               
***********************************************************************         
         USING ACTRECD,R2                                                       
DBEML    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DBEML10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DBEMLX                                                           
*                                                                               
DBEML10  GOTO1 AGETFFT,BOPARM,ACTRECD,FFTTBEML                                  
DBEMLX   B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE BUSINESS EMAIL ADDRESS                                     *         
***********************************************************************         
         SPACE 1                                                                
VBEML    NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VBEML10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD,BCSPACES                                                  
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VBEML10  CLI   FVILEN,0                                                         
         BE    VBEMLX                                                           
         GOTO1 VEMAIL,BOPARM,FVIHDR,0,0,0                                       
         CLI   0(R1),0                                                          
         BE    VBEMLX                                                           
         SR    RE,RE                                                            
         ICM   RE,7,BOPARM+1                                                    
         MVC   FVXTRA,0(RE)                                                     
         B     EXITNV                                                           
*                                                                               
VBEMLX   GOTO1 ABLDFFT,BOPARM,ACTRECD,FFTTBEML                                  
         B     EXITOK                                                           
         LTORG                                                                  
***********************************************************************         
* DATA OBJECT FOR CORPORATE ENTITY ACCOUNT CODE                       *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
CENT     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CENTTB                                                        
         B     ITER                                                             
*                                                                               
CENTTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DCENT)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VCENT)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY CORPORATE ENTITY ACCOUNT                                    *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DCENT    BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DCENT10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DCENTX                                                           
*                                                                               
DCENT10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',ACTRECD),       X        
               (L'SPATYPE,=AL1(SPATCENT))                                       
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42      '(NONE)' IS THE DEFAULT         
         B     DCENTX                                                           
         L     RF,12(,R1)                                                       
         MVC   FVIFLD(L'SPAAULA),SPAAULA-SPAELD(RF)                             
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
*                                                                               
DCENTX   MVI   SBYTE,CORPENT       MOVE IN BRANDO EXP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE CORPORATE ENTITY ACCOUNT                                   *         
* CAN BE SV/SW/SX/SY ACCOUNT ONLY                                               
***********************************************************************         
         SPACE 1                                                                
VCENT    NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
         CLI   FVILEN,0                                                         
         BE    VCNT10                                                           
*                                                                               
         MVI   SBYTE,CORPENT       MOVE IN BRANDOCEAN EXP SEC NUM               
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VCNTX                         THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VCNT05                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VCNTX                                                            
*                                                                               
T        USING ACTRECD,IOKEY       NOW TRY TO FIND THE ACCOUNT                  
VCNT05   CLC   FVIFLD(L'ACTKUNT+L'ACTKLDG),=C'SV'                               
         BL    EXITNV                                                           
         CLC   FVIFLD(L'ACTKUNT+L'ACTKLDG),=C'SY'                               
         BH    EXITNV                                                           
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,ACTKCPY                                                
         MVC   T.ACTKUNT(L'ACTKULA),FVIFLD                                      
         GOTO1 AGETACT,0           READ ACCOUNT/TEST SECURITY                   
         BNE   EXITL                                                            
*                                                                               
         TM    ACINDS1,ACIACTLO    TEST LOW LEVEL ACCOUNT                       
         BO    *+20                                                             
         MVC   FVMSGNO,=AL2(AE$NLOWA)                                           
         MVC   FVXTRA(L'ACTKULA),T.ACTKULA                                      
         B     EXITL               NOT A LOWER LEVEL ACCOUNT                    
*                                                                               
         TM    ACBSTAT,ACBSLOCK    TEST LOCKED ACCOUNT                          
         BZ    *+20                                                             
         MVC   FVMSGNO,=AL2(AE$ACTLK)                                           
         MVC   FVXTRA(L'ACTKULA),T.ACTKULA                                      
         B     EXITL               ACCOUNT IS LOCKED                            
*                                                                               
VCNT10   GOTO1 ABLDSPA,BOPARM,ACTRECD,SPATCENT,T.ACTKULA                        
*                                                                               
VCNTX    BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  T                                                                
         SPACE 2                                                                
***********************************************************************         
* DATA OBJECT FOR CORPORATE ENTITY ACCOUNT NAME                       *         
*                                                                     *         
***********************************************************************         
         SPACE 1                                                                
CENTN    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,CENTNT                                                        
         B     ITER                                                             
*                                                                               
CENTNT   DC    AL1(DDIS),AL1(0,0,0),AL4(DCENTN)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY CORPORATE ENTITY ACCOUNT NAME                               *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DCENTN   BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DCENTN10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         B     DCENTNX                                                          
*                                                                               
DCENTN10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',ACTRECD),       X        
               (L'SPATYPE,=AL1(SPATCENT))                                       
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVIFLD(L'AC@NFA42),AC@NFA42      '(NONE)' IS THE DEFAULT         
         B     DCENTNX                                                          
         USING SPAELD,RF                                                        
         L     RF,12(,R1)                                                       
*                                                                               
T        USING ACTRECD,IOKEY       NOW TRY TO FIND THE ACCOUNT                  
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,ACTKCPY                                                
         MVC   T.ACTKUNT(L'ACTKULA),SPAAULA                                     
         GOTO1 AGETACT,0           READ ACCOUNT/TEST SECURITY                   
         BNE   DCENTNX                                                          
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('NAMELQ',AIO1),0                  
         CLI   12(R1),0                                                         
         BNE   DCENTNX                                                          
*                                                                               
         USING NAMELD,RF                                                        
         L     RF,12(,R1)                                                       
         ZIC   R1,NAMLN                                                         
         SH    R1,=Y(NAMLN1Q+1)                                                 
         EXMVC R1,FVIFLD,NAMEREC                                                
*                                                                               
DCENTNX  MVI   SBYTE,CORPENT       MOVE IN BRANDO EXP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         SPACE 2                                                                
         DROP  T,RF                                                             
***********************************************************************         
* DATA OBJECT FOR SEND ORDER TO VENDOR (GAP SERVICE)                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
GAPS     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,GAPSTB                                                        
         B     ITER                                                             
*                                                                               
GAPSTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISGAPS)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISGAPS)    FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALGAPS)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY SEND ORDER TO VENDOR PROFILE                                *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISGAPS  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DGAPS10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DGAPSX                                                           
*                                                                               
DGAPS10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DGAPSX                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT7,RSTGAPYN                                                
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV                                                  
*                                                                               
DGAPSX   MVI   SBYTE,BRDOGAP       MOVE IN BRANDO GAP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE SEND ORDER TO VENDOR PROFILE                               *         
***********************************************************************         
         SPACE 1                                                                
VALGAPS  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VACCSEC       MOVE IN VENDOR ACCT SEC NUM                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VGAPSX                        THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VGAPS02                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VGAPSX                                                           
*                                                                               
VGAPS02  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT7,X'FF'-RSTGAPYN                                          
         CLI   FVILEN,0                                                         
         BE    VGAPSX                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NO                                                  
         BE    VGAPSX                                                           
         EXCLC RE,FVIFLD,AC@YES                                                 
         BNE   EXITNV                                                           
         OI    RSTSTAT7,RSTGAPYN                                                
*                                                                               
VGAPSX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* DATA OBJECT FOR ACKNOWLEDGE/QUESTION (GAP SERVICE)                  *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
GAPQ     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,GAPQTB                                                        
         B     ITER                                                             
*                                                                               
GAPQTB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISGAPQ)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISGAPQ)    FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALGAPQ)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY ACKNOWLEDGE/QUESTION                                        *         
* VALID AT LOW LEVEL ACCOUNT RECORD ONLY                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
DISGAPQ  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DGAPQ10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DGAPQX                                                           
*                                                                               
DGAPQ10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DGAPQX                                                           
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT7,RSTGAPAQ                                                
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV                                                  
*                                                                               
DGAPQX   MVI   SBYTE,BRDOGAP       MOVE IN BRANDO GAP SECURITY #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE ACKNOWLEDGE/QUESTION PROFILE                               *         
***********************************************************************         
         SPACE 1                                                                
VALGAPQ  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,VACCSEC       MOVE IN VENDOR ACCT SEC NUM                  
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VGAPQX                        THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VGAPQ02                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VGAPQX                                                           
*                                                                               
VGAPQ02  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ELNOF)                                           
         B     EXITL               CAN`T FIND RSTEL                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT7,X'FF'-RSTGAPAQ                                          
         CLI   FVILEN,0                                                         
         BE    VGAPQX                                                           
*                                                                               
         ZIC   RE,FVXLEN                                                        
         EXCLC RE,FVIFLD,AC@NO                                                  
         BE    VGAPQX                                                           
         EXCLC RE,FVIFLD,AC@YES                                                 
         BNE   EXITNV                                                           
         OI    RSTSTAT7,RSTGAPAQ                                                
*                                                                               
VGAPQX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
         DROP  RF                                                               
***********************************************************************         
* DATA OBJECT FOR MILEAGE ANALYSIS                                    *         
*                                                                     *         
* P1 HOLDS EQUATED DATA IDENTIFIER                                    *         
* P2 HOLDS EQUATED VERB                                               *         
* P3 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* P4 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
MILES    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,MILETB                                                        
         B     ITER                                                             
*                                                                               
MILETB   DC    AL1(DDIS),AL1(0,0,0),AL4(DISMILE)                                
         DC    AL1(DLDIS),AL1(0,0,0),AL4(DISMILE)    FOR DLOAD/REPORT           
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALMILE)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY MILEAGE ANALYSIS                                            *         
***********************************************************************         
         SPACE 1                                                                
DISMILE  BRAS  RE,CHKROW           CHK WHAT ROW IS PROCESSING (IF LIST)         
         BL    EXITOK                                                           
         MVI   LEVELBIT,0                                                       
         MVI   LEVELBT2,0                                                       
         MVC   SVLEVEL,BCSPACES                                                 
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVC   FVIFLD,BCSPACES                                                  
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DISMI10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     DISMILX                                                          
*                                                                               
DISMI10  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   DISMILX                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT2,RSTSMILE                                                
         BZ    DISMILX             NO                                           
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         OI    LEVELBIT,ACCTLV                                                  
*                                                                               
DISMILX  MVI   SBYTE,EXPSEC        MOVE IN EXPENSE PROFILE REC #                
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BH    *+8                                                              
         BRAS  RE,SETLEV                         SET LEVEL FIELD                
         BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
***********************************************************************         
* VALIDATE MILEAGE ANALYSIS                                                     
***********************************************************************         
         SPACE 1                                                                
VALMILE  NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALSET                         CHK IF SETTING HAS CHA         
         BE    EXITOK                            NO CHANGE                      
*                                                                               
         MVI   SBYTE,EXPSEC        MOVE IN EXP SEC NUMBER                       
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VMILEX                        THIS PROFILE                       
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VMIL02                         VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VMILEX                                                           
*                                                                               
VMIL02   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         NI    RSTSTAT2,X'FF'-RSTSMILE                                          
         CLI   FVILEN,0            NO INPUT - DEFAULT IS BLANK                  
         BE    VMILEX                                                           
*                                                                               
         CLC   FVIFLD(1),AC@NO                                                  
         BE    VMILEX                                                           
         CLC   FVIFLD(1),AC@YES                                                 
         BNE   EXITNV                                                           
         OI    RSTSTAT2,RSTSMILE                                                
VMILEX   BRAS  RE,DISSET                         UPDATE SETTINGS TABLE          
         B     EXITOK                                                           
***********************************************************************         
* DATA OBJECT FOR INTERNATIONAL BANK SWIFT CODE                       *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
SWIFT    DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,SWIFTTBL                                                      
         B     ITER                                                             
*                                                                               
SWIFTTBL DC    AL1(DDIS),AL1(0,0,0),AL4(DSWIFT)                                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VSWIFT)                                 
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFSWIFT)                               
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFSWIFT)                               
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFSWIFT)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY SWIFT CODE                                                  *         
***********************************************************************         
         SPACE 1                                                                
DSWIFT   MVC   BOELEM,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SECURITY NUMBER             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BE    *+8                                                              
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DSWIFT10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
DSWIFT10 LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         USING OATELD,RF                                                        
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'OATSWIFT),OATSWIFT                                      
*        OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE SWIFT CODE                                                 *         
***********************************************************************         
         USING OATELD,R3                                                        
VSWIFT   LA    R3,BOELEM                                                        
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SECURITY NUMBER             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VSWIFTX                                                          
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VSWIFT10                       VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VSWIFTX                                                          
*                                                                               
VSWIFT10 GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   VSWIFT20           No element found                              
         L     RF,12(,R1)                                                       
         IC    RE,1(,RF)                                                        
         BCTR  RE,0                                                             
         MVC   OATELD(0),0(RF)                                                  
         EX    RE,*-6                                                           
         XC    BOPARM,BOPARM                                                    
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
*                                                                               
VSWIFT20 LA    R3,BOELEM                                                        
         XC    BOELEM,BOELEM                                                    
         MVI   OATEL,OATELQ        BUILD X'8C' ELEMENT IN BOELE                 
         MVI   OATLN,OATLN6Q                                                    
         MVI   OATSUB,OATSUB6Q     INTERNATIONAL BANK INFORMATION               
         MVC   OATSWIFT,BCSPACES                                                
         MVC   OATSWIFT,FVIFLD      MOVE SWIFT CODE                             
*                                                                               
VSWIFTX  B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY SWIFT CODE FILTER FOR PAYABLES                              *         
***********************************************************************         
         SPACE 1                                                                
DFSWIFT  CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE SWIFT CODE FILTER FOR PAYABLES                             *         
***********************************************************************         
         SPACE 1                                                                
VFSWIFT  CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLC   =C'SP',ACTKUNT      PAYABLES LEDGERS                             
         BE    VFSWF10                                                          
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFSWF10                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
*                                                                               
VFSWF10  CLC   FVIFLD(L'AC@NONE),AC@NONE      'NONE' ENTERED?                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON SWIFT CODE FOR PAYABLES                             *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFSWIFT GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BE    *+18                                                             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BE    FLTXE               THAN SHOW IF NO ELEM EXISTS                  
         B     FLTXL               ELSE DON'T SHOW                              
*                                                                               
         L     RF,12(R1)                                                        
         USING OATELD,RF                                                        
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
         CLC   OATSWIFT,BCSPACES    ANY SWIFT CODE?                             
         BH    *+18                YES                                          
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  SWIFT CDE FOUND SO IF FLTRNG         
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,L'OATSWIFT            MAX FILTER LENGTH                       
         LA    RE,FLTIFLD+L'OATSWIFT-1                                          
DOSWF10  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOSWF20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOSWF10                                                       
         B     FLTXL                                                            
*                                                                               
DOSWF20  BCTR  R1,0                                                             
         EXCLC R1,OATSWIFT,FLTIFLD                                              
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR INTERNATIONAL BANK ACCOUNT NUMBER IBAN              *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
IBAN     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,IBANTABL                                                      
         B     ITER                                                             
*                                                                               
IBANTABL DC    AL1(DDIS),AL1(0,0,0),AL4(DIBAN)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VIBAN)                                  
         DC    AL1(DFDIS),AL1(0,0,0),AL4(DFIBAN)                                
         DC    AL1(DFVAL),AL1(0,0,0),AL4(VFIBAN)                                
         DC    AL1(DFDO),AL1(0,0,0),AL4(DOFIBAN)                                
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY IBAN CODE                                                   *         
***********************************************************************         
         SPACE 1                                                                
DIBAN    MVC   BOELEM,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BE    *+8                                                              
         OI    FVATRB,FVAPROT                                                   
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DIBAN10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
DIBAN10  LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         USING OATELD,RF                                                        
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'OATIBAN),OATIBAN                                        
         OI    LEVELBIT,ACCTLV     ONLY VALID AT ACCT LEVEL                     
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE IBAN CODE                                                  *         
***********************************************************************         
         SPACE 1                                                                
         USING OATELD,R3                                                        
VIBAN    LA    R3,BOELEM                                                        
         NI    FVATRB,X'FF'-FVAPROT                                             
         MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SECURITY NUMBER             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   VIBANX                                                           
*                                                                               
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VIBAN10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA                                            
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     VIBANX                                                           
*                                                                               
VIBAN10  MVI   OATEL,OATELQ        BUILD X'8C' ELEMENT IN BOELE                 
         MVI   OATLN,OATLN6Q                                                    
         MVI   OATSUB,OATSUB6Q     CREDITOR ADDRESS                             
         MVC   OATIBAN,BCSPACES                                                 
         MVC   OATIBAN,FVIFLD                                                   
*                                                                               
VIBANX   B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DISPLAY IBAN  CODE FILTER FOR PAYABLES                              *         
***********************************************************************         
         SPACE 1                                                                
DFIBAN   CLI   FLTIFLD,0                                                        
         BE    EXITOK              NOTHING TO FILTER ON                         
         MVC   FVIFLD(FILTLN),FLTIFLD                                           
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE IBAN  CODE FILTER FOR PAYABLES                             *         
***********************************************************************         
         SPACE 1                                                                
VFIBAN   CLI   FVILEN,0            NO INPUT - DEFAULT IS NO FILTER              
         BE    EXITOK                                                           
         CLC   =C'SP',ACTKUNT      PAYABLES LEDGERS                             
         BE    VFIBAN10                                                         
         CLC   =C'SQ',ACTKUNT                                                   
         BE    VFIBAN10                                                         
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SS'                              
         BL    ERRFILT                                                          
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'SY'                              
         BH    ERRFILT                                                          
*                                                                               
VFIBAN10 CLC   FVIFLD(L'AC@NONE),AC@NONE      'NONE' ENTERED?                   
         BNE   *+14                                                             
         MVC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         B     EXITOK                                                           
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FLTIFLD,FVIFLD                                                
         OC    FLTIFLD,BCSPACES                                                 
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* DO FILTERING ON IBAN  CODE FOR PAYABLES                             *         
* VALID AT LOW LEVEL ACCT ONLY                                        *         
***********************************************************************         
         SPACE 1                                                                
DOFIBAN  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BE    *+18                                                             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BE    FLTXE               THAN SHOW IF NO ELEM EXISTS                  
         B     FLTXL               ELSE DON'T SHOW                              
*                                                                               
         L     RF,12(R1)                                                        
         USING OATELD,RF                                                        
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          IF HIGH LEVEL ACCT DON'T SHOW                
         BNE   FLTXL                                                            
         CLC   OATIBAN,BCSPACES    ANY IBAN CODE?                               
         BH    *+18                YES                                          
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  NO SO ONLY IF FILTERING ON           
         BE    FLTXE                       'NONE' SHOW THE ACCOUNT              
         B     FLTXL                                                            
*                                                                               
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  IBAN CDE FOUND SO IF FLTRNG          
         BE    FLTXL                       ON 'NONE' DON'T SHOW ACCT            
*                                                                               
         LA    R1,L'OATIBAN             MAX FILTER LENGTH                       
         LA    RE,FLTIFLD+L'OATIBAN-1                                           
DOIBAN10 CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   DOIBAN20                 VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DOIBAN10                                                      
         B     FLTXL                                                            
*                                                                               
DOIBAN20 BCTR  R1,0                                                             
         EXCLC R1,OATIBAN,FLTIFLD                                               
         BE    FLTXE                                                            
         BH    FLTXH                                                            
         BL    FLTXL                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DATA OBJECT FOR INTERNATIONAL BANK NAME                             *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
IBNM     DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,IBNMTAB                                                       
         B     ITER                                                             
*                                                                               
IBNMTAB  DC    AL1(DDIS),AL1(0,0,0),AL4(DIBNM)                                  
         DC    AL1(DVAL),AL1(0,0,0),AL4(VIBNM)                                  
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY INTERNATIONAL BANK NAME                                     *         
***********************************************************************         
         SPACE 1                                                                
DIBNM    MVC   BOELEM,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DIBNM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
DIBNM10  LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         USING OATELD,RF                                                        
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'OATIBNM),OATIBNM                                        
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE INTERNATIONAL BANK NAME                                    *         
***********************************************************************         
         SPACE 1                                                                
         USING OATELD,R3                                                        
VIBNM    LA    R3,BOELEM                                                        
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VIBNM10                        VALID TO SHOW AT THIS LVL         
         MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
         OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VIBNM10  MVI   OATEL,OATELQ        BUILD X'8C' ELEMENT IN BOELE                 
         MVI   OATLN,OATLN6Q                                                    
         MVI   OATSUB,OATSUB6Q     INTERNATIONAL BANK INFO                      
         MVC   OATIBNM,BCSPACES                                                 
         MVC   OATIBNM,FVIFLD                                                   
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DATA OBJECT FOR INTERNATIONAL BANK ADDRESS LINE 1                   *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
IBADD1   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,IBADDTB1                                                      
         B     ITER                                                             
*                                                                               
IBADDTB1 DC    AL1(DDIS),AL1(0,0,0),AL4(DIBADDL1)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VIBADDL1)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY INTERNATIONAL BANK ADDRESS LINE 1                           *         
***********************************************************************         
         SPACE 1                                                                
DIBADDL1 MVC   BOELEM,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DIBAD110                       VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
*        OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
DIBAD110 LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         USING OATELD,RF                                                        
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'OATIADL1),OATIADL1                                      
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE INTERNATIONAL BANK ADDRESS LINE 1                          *         
***********************************************************************         
         SPACE 1                                                                
         USING OATELD,R3                                                        
VIBADDL1 LA    R3,BOELEM                                                        
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VIBAD110                       VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
*        OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VIBAD110 MVI   OATEL,OATELQ        BUILD X'8C' ELEMENT IN BOELE                 
         MVI   OATLN,OATLN6Q                                                    
         MVI   OATSUB,OATSUB6Q     INTERNATIONAL BANK INFO                      
         MVC   OATIADL1,BCSPACES                                                
         MVC   OATIADL1,FVIFLD                                                  
         B     EXITOK                                                           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DATA OBJECT FOR INTERNATIONAL BANK ADDRESS LINE 2                   *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
IBADD2   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,IBADDTB2                                                      
         B     ITER                                                             
*                                                                               
IBADDTB2 DC    AL1(DDIS),AL1(0,0,0),AL4(DIBADDL2)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VIBADDL2)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY INTERNATIONAL BANK ADDRESS LINE 2                           *         
***********************************************************************         
         SPACE 1                                                                
DIBADDL2 MVC   BOELEM,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DIBAD210                       VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
*        OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
DIBAD210 LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         USING OATELD,RF                                                        
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'OATIADL2),OATIADL2                                      
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE INTERNATIONAL BANK ADDRESS LINE 2                          *         
***********************************************************************         
         SPACE 1                                                                
         USING OATELD,R3                                                        
VIBADDL2 LA    R3,BOELEM                                                        
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VIBAD210                       VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
*        OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VIBAD210 MVI   OATEL,OATELQ        BUILD X'8C' ELEMENT IN BOELE                 
         MVI   OATLN,OATLN6Q                                                    
         MVI   OATSUB,OATSUB6Q     CREDITOR ADDRESS                             
         MVC   OATIADL2,BCSPACES                                                
         MVC   OATIADL2,FVIFLD                                                  
         B     EXITOK              Don't write till we process LINE 3           
         DROP  R3                                                               
         SPACE 2                                                                
***********************************************************************         
* DATA OBJECT FOR INTERNATIONAL BANK ADDRESS LINE 3                   *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
IBADD3   DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,IBADDTB3                                                      
         B     ITER                                                             
*                                                                               
IBADDTB3 DC    AL1(DDIS),AL1(0,0,0),AL4(DIBADDL3)                               
         DC    AL1(DVAL),AL1(0,0,0),AL4(VIBADDL3)                               
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY INTERNATIONAL BANK ADDRESS LINE 3                           *         
***********************************************************************         
         SPACE 1                                                                
DIBADDL3 MVC   BOELEM,BCSPACES                                                  
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    DIBAD310                       VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
*        OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
DIBAD310 LA    R3,BOELEM                                                        
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OATELQ',ACTRECD),       C        
               (L'OATSUB,=AL1(OATSUB6Q))                                        
         CLI   12(R1),0                                                         
         BNE   EXITOK                                                           
         USING OATELD,RF                                                        
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'OATIADL3),OATIADL3                                      
         B     EXITOK                                                           
         DROP  RF                                                               
         SPACE 2                                                                
***********************************************************************         
* VALIDATE INTERNATIONAL BANK ADDRESS LINE 3                          *         
***********************************************************************         
         SPACE 1                                                                
         USING OATELD,R3                                                        
VIBADDL3 LA    R3,BOELEM                                                        
         MVI   SBYTE,BANKPROF      MOVE IN EDI PROF SECURITY NUMBER             
         BRAS  RE,CHKSEC                     CHECK IF HAVE ACCESS TO            
         BNE   EXITOK                                                           
*                                                                               
         NI    FVATRB,X'FF'-FVAPROT                                             
         BRAS  RE,VALIDLV                         CHK IF PROFILE IS             
         BE    VIBAD310                       VALID TO SHOW AT THIS LVL         
*        MVC   FVIFLD(L'AC@NA),AC@NA          SHOW 'N/A'                        
*        OI    LEVELBIT,NOTAPPL                                                 
         OI    FVATRB,FVAPROT      IF NOT PROTECT FIELD AND XIT                 
         B     EXITOK                                                           
*                                                                               
VIBAD310 MVI   OATEL,OATELQ        BUILD X'8C' ELEMENT IN BOELE                 
         MVI   OATLN,OATLN6Q                                                    
         MVI   OATSUB,OATSUB6Q     INTERNATIONAL BANK INFO                      
         MVC   OATIADL3,BCSPACES                                                
         MVC   OATIADL3,FVIFLD                                                  
*                                                                               
         LA    RF,OATSWIFT                                                      
         CLC   OATSWIFT,BCSPACES   IS THERE SOMETHING IN SWIFT CODE             
         BNH   VIBAL310            IF TRUE                                      
         CLC   OATIBAN,BCSPACES    MAKE SURE IBANK IS NOT EMPTY.                
         BNH   VIBAL3NO                                                         
         B     VIBAL330            PUT THE ELEMENT BACK.                        
*                                                                               
VIBAL310 CLC   OATIBAN,BCSPACES                                                 
         BNH   VIBAL320                                                         
         B     VIBAL3NO                                                         
*                                                                               
VIBAL320 CLC   0(OATIBLNQ,RF),BCSPACES   ANY BANK  INFO?                        
         BE    EXITOK                                                           
VIBAL330 GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),ACTRECD,OATELD                     
         B     EXITOK                                                           
VIBAL3NO DS    0H                                                               
         MVC   FVMSGNO,=AL2(AE$MESIB)                                           
         B     EXITL                                                            
         DROP  R3                                                               
***********************************************************************         
* DATA OBJECT FOR LOCKED FROM T/S                                     *         
*                                                                     *         
* R1 HOLDS EQUATED VERB                                               *         
* R2 HOLDS A(RECORD AT CORRECT LEVEL)                                 *         
* R3 HOLDS A(FIELD TABLE ENTRY)                                       *         
***********************************************************************         
         SPACE 1                                                                
TLO      DS    0H                                                               
         USING *,R6                                                             
         LR    R6,RF                                                            
         LA    RF,TLOTBL                                                        
         B     ITER                                                             
*                                                                               
TLOTBL   DC    AL1(DDIS),AL1(0,0,0),AL4(DISTLO)                                 
         DC    AL1(DVAL),AL1(0,0,0),AL4(VALTLO)                                 
         DC    AL1(EOT)                                                         
         SPACE 2                                                                
***********************************************************************         
* DISPLAY LOCKED FROM T/S                                             *         
***********************************************************************         
         SPACE 1                                                                
DISTLO   L     RF,ARSTEL                                                        
         MVC   FVIFLD(L'BC@NO),BC@NO    NO                                      
         TM    RSTLSTAT-RSTELD(RF),RSTLSTIQ                                     
         BZ    EXITOK                                                           
         MVC   FVIFLD(L'BC@YES),BC@YES  YES                                     
         B     EXITOK                                                           
         SPACE 2                                                                
***********************************************************************         
* VALIDATE TIMESHEET LOCK                                                       
***********************************************************************         
         SPACE 1                                                                
VALTLO   L     RF,AIOREC                                                        
         CLC   =C'1N',ACTKUNT-ACTRECD(RF)                                       
         BE    VALTLO02                                                         
         MVC   FVMSGNO,=AL2(AE$INLDG)  INVALID LEDGER                           
         MVC   FVXTRA(L'ACTKUNT+L'ACTKLDG),ACTKUNT-ACTRECD(RF)                  
         B     EXITL                                                            
*                                                                               
VALTLO02 L     RF,ARSTEL                                                        
         NI    RSTLSTAT-RSTELD(RF),X'FF'-RSTLSTIQ                               
         CLC   FVIFLD(1),BC@YES        YES                                      
         BNE   EXITOK                                                           
         OI    RSTLSTAT-RSTELD(RF),RSTLSTIQ                                     
         B     EXITOK                                                           
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE THAT THE HIGHER LEVEL EXISTS WHEN ADDING/COPYING ACCOUNT   *         
* BCHALF CONTAINS THE UNIT AND LEDGER TO READ FOR SINCE IT'S NOT                
* ALWAYS THE SAME AS THE UL THAT THE USER IS WORKING WITH!                      
* TLEVS CONTAINS THE LEDGER LENGTHS                                             
***********************************************************************         
         SPACE 1                                                                
VALHIGH  NTR1  BASE=*,LABEL=*                                                   
         LA    R1,L'ACTKACT           12 MAX FOR THE ACCOUNT                    
         LA    RF,ACTKACT+L'ACTKACT-1 POINT TO LAST BYTE                        
         CLI   0(RF),C' '             FIND OUT HOW MANY CHARACTERS              
         BNE   *+10                   THE USER ENTERED                          
         BCTR  RF,0                                                             
         BCT   R1,*-10                                                          
*                                                                               
         CLI   TLEV1,L'ACTKACT     ONE LEVEL LEDGER?                            
         BE    VALHIE              THAN OKAY TO ADD/COPY                        
         ZIC   RE,TLEV3                                                         
         LTR   RE,RE                                                            
         BZ    VALHI2                                                           
         CR    R1,RE               DID USER ENTER THE 4TH LVL                   
         BH    VALHI10             YES THAN READ THE 3RD LVL                    
VALHI2   ZIC   RE,TLEV2                                                         
         CR    R1,RE               DIS USER ENTER THE 3RD LVL                   
         BH    VALHI10             YES THAN READ THE 2ND LVL                    
         ZIC   RE,TLEV1                                                         
         CR    R1,RE               DID USER ENTER THE 2ND LVL                   
         BH    VALHI10             YES THAN READ THE 1ST LVL                    
         B     VALHIE              MUST HAVE ENTERED 1ST LVL                    
*                                                                               
VALHI10  MVC   SVKEY,IOKEY                                                      
         MVC   IOKEY,BCSPACES                                                   
         MVC   IOKEY(L'ACTKCULA),0(R2)                                          
         MVC   IOKEY+1(L'BCHALF),BCHALF   UL OVERRIDE IF EXISTS                 
         LA    R1,IOKEY+3                                                       
         AR    R1,RE               RE CONTAINS DISPL INTO ACCT TO CLEAR         
         LA    RF,L'ACTKACT                                                     
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXMVC RF,0(R1),BCSPACES                                                
         L     R1,=AL4(XORDD+XOACCDIR+XIO1)                                     
         GOTO1 AIO                                                              
         BE    VALHIE              HIGHER LEVEL EXISTS                          
*                                                                               
VALHIL   CLI   *,FF                                                             
         B     VALHIX                                                           
VALHIE   CR    RB,RB                                                            
VALHIX   MVC   IOKEY(L'SVKEY),SVKEY                                             
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TEST NEW OR EXISTING ACCOUNT IS LOW-LEVEL                           *         
* TLEVS CONTAINS THE LEVEL LENGTHS                                              
* XIT - EQUAL IF LOW LEVEL ACCOUNT                                              
*       LOW IF NOT LOW LEVEL ACCOUNT                                            
***********************************************************************         
         SPACE 1                                                                
CHKACLN  NTR1  BASE=*,LABEL=*                                                   
         LA    R1,L'ACTKACT           12 MAX FOR THE ACCOUNT                    
         LA    RF,ACTKACT+L'ACTKACT-1 POINT TO LAST BYTE                        
         CLI   0(RF),C' '             FIND OUT HOW MANY CHARACTERS              
         BNE   *+10                   THE USER ENTERED                          
         BCTR  RF,0                                                             
         BCT   R1,*-10                                                          
*                                                                               
         CLI   TLEV1,L'ACTKACT     ONE LEVEL LEDGER?                            
         BE    CHKACE                                                           
         ZIC   RF,TLEV3            IF 4 LEVEL LEDGER MUST CHECK                 
         CLI   TLEV4,0             3RD LEVEL                                    
         BNE   CHKAC10                                                          
         ZIC   RF,TLEV2            IF 3 LEVEL LEDGER MUST CHECK                 
         CLI   TLEV3,0             2ND LEVEL                                    
         BNE   CHKAC10                                                          
         ZIC   RF,TLEV1            CAN ASSUME A 2 LEVEL LEDGER SO               
CHKAC10  CR    R1,RF               R1 CONTAINS LENGTH USER ENTERED              
         BH    CHKACE                                                           
*                                                                               
CHKACL   CLI   *,FF                                                             
         B     CHKACX                                                           
CHKACE   CR    RB,RB                                                            
CHKACX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* THIS ROUTINE HANDLES THE LOOKUP FOR FILTERS ON THE LIST SCREEN                
* NTRY - SVLEVS = # OF LEVELS LEFT TO CHECK                                     
* XIT  - IO2 POINTS TO HIGHER LEVEL ACCOUNT RECORD                              
***********************************************************************         
         SPACE 1                                                                
FILTPRF  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         MVC   SVKEY,IOKEY         SAVE KEY BEFORE READING DIFF LEVS            
         MVI   SVLEVS,X'FF'        SVLEVS=FF TO INDICATE 1ST TIME               
FILTP101 BRAS  RE,FILTLEV                                                       
         BL    FILTP301                                                         
         USING RTNTABD,R3                                                       
         LA    R3,FILTAB2          R1 POINTS TO TABLE OF ROUTINES               
FILTP151 CLI   0(R3),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         L     R1,SVPARMS2                                                      
         CLM   R1,3,RTNFLD         SAME FIELD NUMBER?                           
         BE    FILTP201                                                         
FILTP171 LA    R3,RTN1LNQ(R3)                                                   
         B     FILTP151                                                         
*                                                                               
FILTP201 SR    RF,RF                                                            
         L     RF,RTNRTNE                                                       
         A     RF,BORELO                                                        
         BASR  RE,RF                                                            
*                                                                               
         CLI   FILTEQ,0            FILTER VALUE FOUND?                          
         BNE   FILTPX1             YES SO EXIT                                  
         OC    RTNRTNE2,RTNRTNE2   IS THERE A 2ND ROUTINE?                      
         BZ    FILTP301                                                         
         SR    RF,RF                                                            
         L     RF,RTNRTNE2                                                      
         A     RF,BORELO                                                        
         BASR  RE,RF                                                            
         CLI   FILTEQ,0            FILTER VALUE FOUND?                          
         BNE   FILTPX1             YES SO EXIT                                  
*                                                                               
FILTP301 ZIC   RF,SVLEVS                                                        
         BCTR  RF,0                                                             
         STC   RF,SVLEVS                                                        
         LTR   RF,RF               ANY MORE LEVELS TO CHECK?                    
         BP    FILTP101            YES                                          
*                                                                               
FILTPX1  MVC   IOKEY,SVKEY         RESTORE KEY TO CONTINUE LIST                 
         XIT1                                                                   
         DROP  R3                                                               
*                                                                               
FILTAB2  DS    0F                                                               
         DC    AL2(ACC#CSTNG),AL2(0),AL4(COS3),AL4(0)         COST=             
* ANALYSIS= FOR SE                                                              
         DC    AL2(ACC#ANALSE),AL2(0),AL4(ANL30),AL4(ANL2C)                     
* ANALYSIS= FOR 1R                                                              
         DC    AL2(ACC#ANAL1R),AL2(0),AL4(ANL30),AL4(0)                         
         DC    AL2(ACC#GACC),AL2(0),AL4(GEN3),AL4(0)          GENERAL=          
         DC    AL2(ACC#TMSLV),AL2(0),AL4(TSLEV3),AL4(0)       T/S=P/J           
         DC    AL2(ACC#TASK),AL2(0),AL4(TASKC3),AL4(0)        TASK=             
         DC    AL2(ACC#OIN),AL2(0),AL4(CHKOIN2),AL4(0)        OIN=              
         DC    AL2(ACC#OWO),AL2(0),AL4(CHKOWO2),AL4(0)        OWO=              
         DC    AL2(ACC#CLTYP),AL2(0),AL4(CTYP3),AL4(0)                          
         DC    AL2(ACC#RECV),AL2(0),AL4(RECV3),AL4(0)         RECV=             
         DC    AL2(ACC#COST1C),AL2(0),AL4(CO1C3),AL4(0)       COST=UN 3         
         DC    AL2(ACC#COMM),AL2(0),AL4(COMM3),AL4(0)         COMM=             
         DC    AL2(ACC#EQCD1),AL2(0),AL4(EQ1F),AL4(0)         EQU CD 1          
         DC    AL2(ACC#EQCD2),AL2(0),AL4(EQ1F),AL4(0)         EQU CD 2          
         DC    AL2(ACC#EQCD3),AL2(0),AL4(EQ1F),AL4(0)         EQU CD 3          
         DC    AL2(ACC#EQCD4),AL2(0),AL4(EQ1F),AL4(0)         EQU CD 4          
         DC    AL2(ACC#EQCD5),AL2(0),AL4(EQ1F),AL4(0)         EQU CD 5          
         DC    AL2(ACC#FLT1),AL2(0),AL4(FLT1F),AL4(0)         FILTER 1          
         DC    AL2(ACC#FLT2),AL2(0),AL4(FLT1F),AL4(0)         FILTER 2          
         DC    AL2(ACC#FLT3),AL2(0),AL4(FLT1F),AL4(0)         FILTER 3          
         DC    AL2(ACC#FLT4),AL2(0),AL4(FLT1F),AL4(0)         FILTER 4          
         DC    AL2(ACC#FLT5),AL2(0),AL4(FLT1F),AL4(0)         FILTER 5          
         DC    AL2(ACC#DUEF),AL2(0),AL4(DUEF3),AL4(0)         DUE DATE          
         DC    AL2(ACC#RVSGN),AL2(0),AL4(RVSGN3),AL4(0)       RV CR SGN         
         DC    X'00'                                                            
         SPACE 2                                                                
         LTORG                                                                  
***********************************************************************         
* IO COUNTING ROUTINE                                                 *         
***********************************************************************         
         SPACE 1                                                                
IOCHK    NTR1  BASE=*,LABEL=*                                                   
*        LH    R0,IOCOUNT                                                       
*        AH    R0,=H'1'                                                         
*        STH   R0,IOCOUNT                                                       
*        CLM   R0,2,IOCOUNT        256 IO BOUNDARY?                             
*        BE    IOCHKE                                                           
         GOTO1 VGETFACT,BODMCB,0     GET PHYSICAL IO COUNT                      
         L     R1,0(R1)                                                         
         ICM   R0,3,FATIOCNT-FACTSD(R1)                                         
         AH    R0,=H'200'          WITHIN 200 OF LIMIT?                         
         CLM   R0,3,FATMAXIO-FACTSD(R1)                                         
         BNH   IOCHKE                                                           
*                                                                               
IOCHKL   CLI   *,FF                                                             
         B     IOCHKX                                                           
IOCHKE   CR    RB,RB                                                            
IOCHKX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* THIS ROUTINE IS TO SET THE GSSMCODE FIELD WHEN BUILDING SCREENS AND           
* BUILDING THE COLUMNS FROM THE DEF_CLM RECORD FOR THE LIST SCREEN              
***********************************************************************         
         SPACE 2                                                                
         USING SCRTABD,RF                                                       
SETCODE  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         XC    GSSMCODE,GSSMCODE                                                
         CLI   CSACT,A#LST         FOR LIST SCREEN NEED A CODE                  
         BE    *+12                                                             
         CLI   GSSMPAGE,1          BUT FOR PAGE 1 OF DATA SCREEN                
         BNH   SETCX               NO CODE NEEDED.                              
*                                                                               
         XC    GSSMCODE,GSSMCODE                                                
         LA    RE,IOKEY                                                         
         LA    RF,SCRTAB                                                        
*                                                                               
SETC10   CLI   0(RF),X'FF'                                                      
         BE    SETC70              END OF TABLE                                 
         LA    R1,2                COMPARE FOR 2 BYTES (UL) UNLESS              
         CLI   ACTKUNT,C'3'        FOR UNIT 3 AND UNIT G LEDGERS                
         BE    *+12                ONLY CHECK FIRST BYTE                        
         CLI   ACTKUNT,C'G'                                                     
         BNE   *+8                                                              
         LA    R1,1                                                             
         BCTR  R1,0                                                             
         EXCLC R1,ACTKUNT,SCRUL                                                 
         BE    SETC30                                                           
*                                                                               
SETC20   LA    RF,SCRLNQ(RF)       BUMP TO NEXT TABLE ENTRY                     
         B     SETC10                                                           
*                                                                               
SETC30   CLC   =C'SV',ACTKUNT      FOR SV,SW,SX,SY NEED TO MAKE                 
         BE    SETC40              ADDITIONAL CHECKS                            
         CLC   =C'SW',ACTKUNT                                                   
         BE    SETC40                                                           
         CLC   =C'SX',ACTKUNT                                                   
         BE    SETC40                                                           
         CLC   =C'SY',ACTKUNT                                                   
         BNE   SETC60                                                           
*                                                                               
SETC40   CLI   SCRCTRY,0           IS THIS TAB ENTRY COUNTRY SPECIFIC?          
         BE    SETC60                                                           
         CLC   CUCTRY,SCRCTRY      MATCH ON COUNTRY?                            
         BNE   SETC20              NO - READ AGAIN                              
*                                                                               
SETC60   MVC   GSSMCODE,SCRCODE    MOVE IN CODE                                 
         B     SETCX                                                            
*                                                                               
SETC70   CLI   ACTKUNT,C'S'        IF WE GET HERE MEANS NO MATCH IN             
         BNE   SETCX               TABLE.  FOR REMAINING UNIT S LEDGERS         
         CLC   ACTKUNT(2),=C'S9'   (EXCEPT S9) SHOULD HAVE SCREEN CODE          
         BE    SETCX               'Q'                                          
         MVI   GSSMCODE,C'Q'                                                    
         BE    SETCX                                                            
*                                                                               
SETCX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* MAKE SURE COPY FROM AND COPY TO ACCOUNTS ARE AT SAME LEVEL                    
* GSCPYKEY HOLDS THE COPY FROM ACCOUNT                                          
* R2 POINTS TO THE COPY TO ACCOUNT                                              
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
VALCPYLN NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY(L'ACTKCPY+L'ACTKUNT+L'ACTKLDG),GSCPYKEY                
         GOTO1 AGETLDG                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  T                                                                
*                                                                               
T        USING ACTRECD,GSCPYKEY                                                 
         LA    R1,12               FIGURE OUT LENGTH OF COPY FROM ACCT          
         LA    RE,T.ACTKACT+L'ACTKACT-1                                         
VCPYL10  CLI   0(RE),C' '                                                       
         BNE   VCPYL20                                                          
         BCTR  RE,0                                                             
         BCT   R1,VCPYL10                                                       
         DC    H'0'                                                             
         DROP  T                                                                
*                                                                               
         USING LDGTABD,RE                                                       
VCPYL20  ICM   RE,15,ACALDG        R1 CONTAIN LENGTH OF COPY FROM ACCT          
         ZIC   RF,LDGTLVA                                                       
         CR    R1,RF               ENTERED FIRST LEVEL?                         
         BH    *+12                                                             
         MVI   CPYFRLEV,1                                                       
         B     VCPYL30                                                          
         ZIC   RF,LDGTLVB          ENTERED SECOND LEVEL?                        
         CR    R1,RF                                                            
         BH    *+12                                                             
         MVI   CPYFRLEV,2                                                       
         B     VCPYL30                                                          
         ZIC   RF,LDGTLVC                                                       
         CR    R1,RF               ENTERED THIRD LEVEL?                         
         BH    *+12                                                             
         MVI   CPYFRLEV,3                                                       
         B     VCPYL30                                                          
         MVI   CPYFRLEV,4          MUST HAVE ENTERED FOURTH LEVEL               
*                                                                               
VCPYL30  LA    R1,12               FIGURE OUT LENGTH OF COPY TO ACCT            
         LA    RE,ACTKACT+L'ACTKACT-1                                           
VCPYL40  CLI   0(RE),C' '                                                       
         BNE   VCPYL50                                                          
         BCTR  RE,0                                                             
         BCT   R1,VCPYL40                                                       
         DC    H'0'                                                             
*                                                                               
VCPYL50  ICM   RE,15,ACALDG        R1 CONTAIN LENGTH OF COPY FROM ACCT          
         ZIC   RF,LDGTLVA                                                       
         CR    R1,RF               ENTERED FIRST LEVEL?                         
         BH    *+12                                                             
         MVI   CPYTOLEV,1                                                       
         B     VCPYL60                                                          
         ZIC   RF,LDGTLVB          ENTERED SECOND LEVEL?                        
         CR    R1,RF                                                            
         BH    *+12                                                             
         MVI   CPYTOLEV,2                                                       
         B     VCPYL60                                                          
         ZIC   RF,LDGTLVC                                                       
         CR    R1,RF               ENTERED THIRD LEVEL?                         
         BH    *+12                                                             
         MVI   CPYTOLEV,3                                                       
         B     VCPYL60                                                          
         MVI   CPYTOLEV,4          MUST HAVE ENTERED FOURTH LEVEL               
*                                                                               
VCPYL60  CLC   CPYFRLEV,CPYTOLEV   LEVELS MUST MATCH                            
         BE    VCPYE                                                            
*                                                                               
VCPYL    CLI   *,FF                                                             
         B     VCPYX                                                            
VCPYE    CR    RB,RB                                                            
VCPYX    XIT1                                                                   
         DROP  RE                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK LEDGER AGAINST COMPANY RECORD VALUES TO SEE IF WE NEED TO ADD           
* RAPPER POINTERS FOR PRESTO                                                    
* EXIT - EQUAL MEANS ADD POINTER                                                
*        LOW MEANS DO NOT ADD POINTER                                           
***********************************************************************         
         SPACE 1                                                                
         USING CPYELD,RF                                                        
CHKPTRS  NTR1  BASE=*,LABEL=*                                                   
         LA    RF,SVCPYEL                                                       
         CLI   ACTKUNT,C'S'        ONLY CHECK THESE TWO FOR UNIT S              
         BNE   CPTRS20                                                          
         CLC   CPYSUPP,ACTKUNT     SUPPLIER U/L?                                
         BE    CPTRSE                                                           
         CLC   CPYXSUPP,ACTKLDG    EXTRA SUPPLIER LEDGER?                       
         BE    CPTRSE                                                           
         LHI   R1,6                PRESTO LEDGERS? 6 MAX                        
         LA    RE,CPYPRSTL                                                      
CPTRS10  CLC   0(1,RE),ACTKLDG                                                  
         BE    CPTRSE                                                           
         LA    RE,1(RE)                                                         
         BCT   R1,CPTRS10                                                       
CPTRS20  CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1R'                              
         BE    CPTRSE                                                           
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1C'   FOR 1C IF NAME OR          
         BNE   CPTRSL                        FILTER ADDED OR CHANGED            
         TM    BYTE2,NAM1CCHA                WAS THE NAM ADDED/CHANGED?         
         BO    CPTRSE                        YES                                
         CLI   FILTBIT,0                     WERE THE FILTRS ADDED/CHA?         
         BNE   CPTRSE                        NO                                 
*                                                                               
CPTRSL   CLI   *,FF                                                             
         B     CPTRSX                                                           
CPTRSE   CR    RB,RB                                                            
CPTRSX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
***********************************************************************         
**                                                                              
* ADD NEW PROFILES HERE                                                         
**                                                                              
***********************************************************************         
* CHECK IF THE PROFILE SETTING HAS CHANGED                                      
* XIT - EQUAL IF SETTING HAS NOT CHANGED                                        
*     - NOT EQUAL IF SETTING HAS CHANGED                                        
***********************************************************************         
         SPACE 1                                                                
         USING SETTABD,RF                                                       
VALSET   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    RF,SETTAB           RF=TABLE OF PROFILE SETTINGS                 
VSET10   LA    RE,SETEND           RE=END OF TABLE                              
         CR    RF,RE                                                            
         BL    *+6                                                              
         DC    H'0'                DIDN'T FIND IT-SOMETHINGS WRONG              
         L     R1,SVPARMS2         R1=FIELD NUMBER                              
         CLM   R1,3,SETFLDN        FIND RIGHT ENTRY                             
         BE    VSET20              FOUND IT                                     
         LA    RF,SETTBLNQ(RF)                                                  
         B     VSET10                                                           
*                                                                               
VSET20   CLC   SETPROF,FVIFLD      HAS SETTING CHANGED?                         
         BE    VSETE               NO-SO EXIT                                   
         B     VSETL                                                            
*                                                                               
VSETL    CLI   *,FF                                                             
         B     VSETX                                                            
VSETE    CR    RB,RB                                                            
VSETX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* UPDATE TABLE OF PROFILE SETTINGS                                              
***********************************************************************         
         SPACE 1                                                                
         USING SETTABD,RF                                                       
DISSET   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    RF,SETTAB           RF=TABLE OF PROFILE SETTINGS                 
DSET10   LA    RE,SETEND           RE=END OF TABLE                              
         OC    0(L'SETFLDN,RF),0(RF)                                            
         BZ    DSET20                                                           
         CLC   0(L'SETFLDN,RF),BCSPACES                                         
         BE    DSET20                                                           
         CR    RF,RE                                                            
         BL    *+6                                                              
         DC    H'0'                DIDN'T FIND IT-SOMETHINGS WRONG              
         L     R1,SVPARMS2         R1=FIELD NUMBER                              
         CLM   R1,3,SETFLDN        FIND RIGHT ENTRY                             
         BE    DSET20              FOUND IT                                     
         LA    RF,SETTBLNQ(RF)                                                  
         B     DSET10                                                           
*                                                                               
DSET20   MVC   SETPROF,BCSPACES                                                 
         L     R1,SVPARMS2                                                      
         STCM  R1,3,SETFLDN        SAVE FIELD #                                 
         OC    FVIFLD,FVIFLD       NOTHING SET FOR PROFILE?                     
         BZ    DSETX                                                            
         OC    FVIFLD,BCSPACES     NOTHING SET FOR PROFILE?                     
         BE    DSETX                                                            
         MVC   SETPROF,FVIFLD                                                   
         OC    SETPROF,BCSPACES                                                 
DSETX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET LEVEL BASED ON LEVELBIT SET IN PROFILE ROUTINES                 *         
* FOR F1-F5 WILL DISPLAY AS "FROM ULNNNNNNNNNNNN"                     *         
***********************************************************************         
         SPACE 1                                                                
SETLEV   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   SVLEVEL,BCSPACES                                                 
         TM    BYTE2,PROCFILT      PROCESSING F1-F5?                            
         BZ    SETLV05                                                          
         CLC   FVIFLD,BCSPACES     IF NO FILTER FOUND JUST EXIT                 
         BE    SETLVX                                                           
         MVC   SVLEVEL(L'AC@FROM),AC@FROM                                       
         TM    LEVELBIT,ACCTLV     PROFILE SET AT ACCOUNT LEVEL?                
         BZ    *+14                                                             
         MVC   SVLEVEL+L'AC@FROM+1(L'ACTKULA),ACTKUNT                           
         B     SETLVX                                                           
         L     RF,AIO2             THAN MUST BE SET AT HIGHER LEV               
         MVC   SVLEVEL+L'AC@FROM+1(L'ACTKULA),1(RF)                             
         B     SETLVX                                                           
SETLV05  TM    LEVELBIT,GLOFFDEF   GLOFF= PROFILE?                              
         BZ    *+14                                                             
         MVC   SVLEVEL(L'AC@UNKWN),AC@UNKWN    DISPLAY UNKNOWN                  
         B     SETLVX                                                           
         TM    LEVELBIT,ACCTLV     PROFILE SET AT ACCOUNT LEVEL?                
         BZ    SETLV10                                                          
         MVC   SVLEVEL,ACTKUNT                                                  
         B     SETLVX                                                           
SETLV10  TM    LEVELBIT,HIGHLV     PROFILE SET AT HIGHER ACCT LEVEL?            
         BZ    SETLV20                                                          
         L     RF,AIO2             IO2 CONTAINS ACCT WHERE PROFILE IS           
         MVC   SVLEVEL,1(RF)       SET.                                         
         B     SETLVX                                                           
SETLV20  TM    LEVELBIT,LEDGLV     PROFILE SET AT LEDGER LEVEL?                 
         BZ    SETLV30                                                          
         MVC   SVLEVEL(L'ACTKUNT+L'ACTKLDG),ACTKUNT                             
         MVC   SVLEVEL+3(L'AC@LGR),AC@LGR                                       
         B     SETLVX                                                           
SETLV30  TM    LEVELBIT,COMPLV     PROFILE SET AT COMPANY LEVEL?                
         BZ    SETLV40             NO MUST BE DEFAULT THEN                      
         MVC   SVLEVEL(L'AC@AGY),AC@AGY                                         
         B     SETLVX                                                           
SETLV40  TM    LEVELBIT,LDGLVDEF   SPECIAL SETTING FOR COST= PROF?              
         BZ    SETLV50             NO MUST BE DEFAULT THEN                      
         MVC   SVLEVEL(L'AC@DDSDF),AC@DDSDF   DDS DEFAULT/XX LEDGER             
         MVI   SVLEVEL+L'AC@DDSDF,C'/'                                          
         MVC   SVLEVEL+L'AC@DDSDF+1(L'ACTKUNT+L'ACTKLDG),ACTKUNT                
         MVC   SVLEVEL+L'AC@DDSDF+4(L'AC@LGR),AC@LGR                            
         B     SETLVX                                                           
                                                                                
SETLV50  TM    LEVELBIT,NOTAPPL    PROFILE NOT APPLICABLE?                      
         BZ    SETLV60                                                          
         MVC   SVLEVEL(L'AC@NAPPL),AC@NAPPL                                     
         B     SETLVX                                                           
SETLV60  TM    LEVELBT2,AFMBNKLV   PROF SET AT AFM BANK LVL?                    
         BZ    SETLV70                                                          
         MVC   SVLEVEL(L'AC@AFMBR),AC@AFMBR                                     
         B     SETLVX                                                           
SETLV70  TM    LEVELBT2,CFIBNKLV   PROF SET AT CFILE BANK LVL?                  
         BZ    SETLV80                                                          
         MVC   SVLEVEL(L'AC@CFIBR),AC@CFIBR                                     
         B     SETLVX                                                           
SETLV80  MVC   SVLEVEL(L'AC@DDSDF),AC@DDSDF   SET DEFAULT IN LVL FIELD          
SETLVX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* THIS ROUTINE IS CALLED BY PROFILES THAT CAN ONLY BE SET AT THE LOWEST         
* LEVEL.  CHECK TO SEE WHAT THE LOWEST LEVEL FOR THIS LEDGER IS AND   *         
* SEE IF WE MEET THE REQUIREMENTS.                                              
* XIT  -  EQUAL IF PROFILE IS VALID AT THIS LEVEL                               
*      -  NOT EQUAL IF NOT VALID                                                
***********************************************************************         
         SPACE 1                                                                
VALIDLV  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    R1,4                ASSUME 4 LEVEL LEDGER                        
         CLI   LNLEV4,L'ACTKACT    4 LEVEL LEDGER?                              
         BE    VALIDL10                                                         
         LA    R1,3                                                             
         CLI   LNLEV3,L'ACTKACT    3 LEVEL LEDGER?                              
         BE    VALIDL10                                                         
         LA    R1,2                                                             
         CLI   LNLEV2,L'ACTKACT    2 LEVEL LEDGER?                              
         BE    VALIDL10                                                         
         LA    R1,1                                                             
VALIDL10 ZIC   RE,LEVELN           RE HAS ACTUAL LEVEL ENTERED                  
         CR    R1,RE               MUST MATCH LOWEST LEVEL                      
         BE    VALIDE                                                           
VALIDL   CLI   *,FF                                                             
         B     VALIDX                                                           
VALIDE   CR    RB,RB                                                            
VALIDX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        CHECK FOR METHOD BUCKETS                                               
***********************************************************************         
         SPACE 1                                                                
         USING CACRECD,R3                                                       
CHKBUCK  NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         MVC   CACKEY,BCSPACES                                                  
         MVC   CACKCULA,0(R2)                                                   
         MVC   CACKCCPY,CUABIN                                                  
         MVC   CACKCUNT(2),=C'14'                                               
         LHI   R1,XOHIGH+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         B     CHKBUK04                                                         
CHKBUK02 LHI   R1,XOSEQ+XOACCDIR+XIO2                                           
         GOTO1 AIO                                                              
CHKBUK04 CLC   CACKCULA,0(R2)                                                   
         BNE   CHKBUK06                                                         
         CLC   CACKCUNT(2),=C'14'                                               
         BNE   CHKBUK06                                                         
         CLC   CACKSPAC,BCSPACES                                                
         BNE   CHKBUK02                                                         
         CLI   CACKBTYP,C' '                                                    
         BH    CHKBUKL                                                          
         B     CHKBUK02                                                         
CHKBUK06 LHI   R1,XOREAD+XOACCDIR+XIO1      RE-READ KEY                         
         GOTO1 AIO                                                              
         B     CHKBUKE                                                          
*                                                                               
CHKBUKL  CLI   *,FF                                                             
         B     CHKBUKX                                                          
CHKBUKE  CR    RB,RB                                                            
CHKBUKX  XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO GET PID NUMBER                                           *         
*                                                                     *         
* EXIT: BOWORK1 - PID NUMBER                                          *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
GETPIDP  NTR1  BASE=*,LABEL=*                                                   
         XC    BOWORK1(L'PIDNO),BOWORK1                                         
         LA    R3,ACTRFST-ACTRECD(R2)                                           
         USING PIDELD,R3                                                        
         SR    R0,R0                                                            
GETPI10  CLI   PIDEL,0                                                          
         BE    GETPIDL                                                          
         CLI   PIDEL,PIDELQ                                                     
         BE    *+14                                                             
         IC    R0,PIDLN                                                         
         AR    R3,R0                                                            
         B     GETPI10                                                          
*                                                                               
         MVC   BOWORK1(L'PIDNO),PIDNO                                           
         B     GETPIDE                                                          
*                                                                               
GETPIDL  CLI   *,FF                                                             
         B     GETPIDX                                                          
GETPIDE  CR    RB,RB                                                            
GETPIDX  XIT1                                                                   
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO GET PERSONNEL ACCOUNT                                    *         
*                                                                     *         
* EXIT: BOWORK1 - PERSONNEL ACCOUNT                                   *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
GETPER   NTR1  BASE=*,LABEL=*                                                   
         XC    BOWORK1(L'SPAAULA),BOWORK1                                       
         LA    R3,ACTRFST-ACTRECD(R2)                                           
         USING SPAELD,R3                                                        
         SR    R0,R0                                                            
GETPE10  CLI   SPAEL,0                                                          
         BE    GETPERL                                                          
         CLI   SPAEL,SPAELQ                                                     
         BNE   *+12                                                             
         CLI   SPATYPE,SPATPERS                                                 
         BE    *+14                                                             
         IC    R0,SPALN                                                         
         AR    R3,R0                                                            
         B     GETPE10                                                          
*                                                                               
         MVC   BOWORK1(L'SPAAULA),SPAAULA                                       
         B     GETPERE                                                          
*                                                                               
GETPERL  CLI   *,FF                                                             
         B     GETPERX                                                          
GETPERE  CR    RB,RB                                                            
GETPERX  XIT1                                                                   
         XIT1                                                                   
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO UPDATE PID PASSIVE POINTER                               *         
*                                                                     *         
* NTRY: P1       = A(ACTRECD)                                         *         
*       SVOLDPID = OLD PID NUMBER                                     *         
*       SVOLDPER = OLD PERSONNEL ACCOUNT                              *         
*       SVNEWPID = NEW PID NUMBER                                     *         
*       SVNEWPER = NEW PERSONNEL ACCOUNT                              *         
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
UPDPIDP  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLC   SVOLDPID(SVPIDLNQ),SVNEWPID                                      
         BE    UPDPIDX             OK - SAME PIDNO AND PERSONNEL A/C            
         CLC   SVOLDPID,SVNEWPID   HAS PID NUMBER BEEN CHANGED?                 
         BE    UPDPI20             NO - CHECK PERSONNEL ACCOUNT                 
         OC    SVOLDPID,SVOLDPID   ANY OLD PID?                                 
         BZ    UPDPI10             NO - SEE IF WE HAVE NEW PID                  
         GOTO1 APIDPAS,BOPARM,(X'80',ACTRECD),('PIDKCRDQ',SVOLDPID)             
*                                                                               
UPDPI10  OC    SVNEWPID,SVNEWPID   ANY NEW PID?                                 
         BZ    UPDPI20                                                          
         GOTO1 APIDPAS,BOPARM,ACTRECD,('PIDKCRDQ',SVNEWPID)                     
*                                                                               
UPDPI20  OC    SVOLDPER,SVOLDPER   ANY OLD PERSONNEL A/C?                       
         BNZ   UPDPI24                                                          
         OC    SVNEWPER,SVNEWPER   ANY NEW PERSONNEL A/C?                       
         BZ    UPDPIDX                                                          
         B     UPDPI36                                                          
*                                                                               
T        USING ACTRECD,IOKEY       NOW TRY TO FIND THE ACCOUNT                  
UPDPI24  MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,ACTKCPY                                                
         MVC   T.ACTKULA,SVOLDPER  OLD PERSONNEL ACCOUNT                        
*                                                                               
         L     R1,=AL4(XIO3+XOACCMST+XORDUP)                                    
         GOTO1 AIO                                                              
         BNE   UPDPI32             PERSONNEL ACCOUNT NOT FOUND!!!               
*                                                                               
         XC    BOWORK1(L'PIDNO),BOWORK1                                         
         CLC   SVOLDPER,SVNEWPER   SAME PERSONNEL A/C?                          
         BNE   *+10                                                             
         MVC   BOWORK1(L'SVNEWPID),SVNEWPID                                     
         GOTO1 ABLDPID,BOPARM,AIO3,BOWORK1   UPDATE PIDEL FOR 2P A/C            
         LHI   R1,XOPUTREC+XOACCMST+XIO3     CHANGE 2P A/C RECORD               
         GOTO1 AIO                                                              
*                                                                               
         GOTO1 APIDPAS,BOPARM,(X'80',AIO3),('PIDKPSNQ',SVOLDPID)                
*                                                                               
UPDPI32  OC    SVNEWPER,SVNEWPER   ANY NEW PERSONNEL A/C?                       
         BZ    UPDPIDX             NO - EXIT                                    
         CLC   SVOLDPER,SVNEWPER   SAME PERSONNEL A/C?                          
         BE    UPDPI40             YES 2P A/C HAS BEEN UPDATED                  
*                                                                               
UPDPI36  MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,ACTKCPY                                                
         MVC   T.ACTKULA,SVNEWPER  NEW PERSONNEL ACCOUNT                        
                                                                                
         L     R1,=AL4(XIO3+XOACCMST+XORDUP)                                    
         GOTO1 AIO                                                              
         BNE   UPDPIDX             PERSONNEL ACCOUNT NOT FOUND!!!               
         GOTO1 ABLDPID,BOPARM,AIO3,SVNEWPID  UPDATE PIDEL FOR 2P A/C            
         LHI   R1,XOPUTREC+XOACCMST+XIO3     CHANGE 2P A/C RECORD               
         GOTO1 AIO                                                              
*                                                                               
UPDPI40  GOTO1 APIDPAS,BOPARM,AIO3,('PIDKPSNQ',SVNEWPID)                        
UPDPIDX  XIT1                                                                   
         DROP  T,R2                                                             
         EJECT ,                                                                
**********************************************************************          
*  CHECK STAFF PAYABLES ACCOUNT                                      *          
*                                                                    *          
*  NTRY - R2=ACCOUNT RECORD                                          *          
*  EXIT - ACCISPAC SET IF ACCOUNT IS STAFF PAYABLES                  *          
**********************************************************************          
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
CHKSPAC  NTR1  BASE=*,LABEL=*                                                   
         OI    ACCINDS,ACCICKSP    ROUTINE CHKSPAC HAS BEEN CALLED              
         NI    ACCINDS,FF-ACCISPAC RESET                                        
                                                                                
*        MVC   IOKEY(L'ACTKEY),ACTKEY                                           
*        GOTO1 AGETLDG                                                          
*        BE    *+6                                                              
*        DC    H'0'                CAN'T READ LEDGER RECORD                     
*        ICM   R3,15,ACALDG                                                     
*        USING LDGTABD,R3                                                       
*                                                                               
         MVC   IOKEY,BCSPACES                                                   
         MVC   IOKEY(1),CUABIN     CONNECTED ID                                 
         LHI   R1,XOREAD+XOACCMST+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                COMPANY RECORD NOT FOUND!!!!!                
*                                                                               
         L     R4,AIO2                                                          
         LA    R4,ACTRFST-ACTRECD(R4)                                           
*                                                                               
         USING SPAELD,R4                                                        
CHKSP10  CLI   SPAEL,0                                                          
         BE    CHKSPX                                                           
         CLI   SPAEL,SPAELQ                                                     
         BNE   CHKSP18                                                          
         CLI   SPATYPE,SPATSTFP    STAFF PAYABLES ACCOUNT                       
         BNE   CHKSP18                                                          
         CLC   SPAAULA,BCSPACES                                                 
         BNH   CHKSP18             MAKE SURE THERE IS AN ACCOUNT!!!             
         CLC   SPAAULA(2),ACTKULA                                               
         BNE   CHKSP18             NOT THE SAME UNIT/LEDGER                     
         CLC   SPAAACT,BCSPACES                                                 
         BNH   CHKSP20             OK IF UNIT/LEDGER CODE ONLY                  
*                                                                               
         ZIC   RE,LNLEV1                                                        
         CHI   RE,L'ACTKACT        SINGLE LEVEL LEDGER?                         
         BE    CHKSP14             YES - OK                                     
         LA    RF,SPAAACT(RE)      FIRST CHARACTER OF LEVEL B                   
         CLI   0(RF),C' '                                                       
         BE    CHKSP14             LEVEL B IS BLANK THIS IS LEVEL A             
*                                                                               
         ZIC   RE,LNLEV2                                                        
         CHI   RE,L'ACTKACT        2 LEVEL LEDGER?                              
         BE    CHKSP14             YES - OK                                     
         LA    RF,SPAAACT(RE)      FIRST CHARACTER OF LEVEL C                   
         CLI   0(RF),C' '                                                       
         BE    CHKSP14             LEVEL C IS BLANK THIS IS LEVEL B             
*                                                                               
         ZIC   RE,LNLEV3                                                        
         CHI   RE,L'ACTKACT        3 LEVEL LEDGER?                              
         BE    CHKSP14             YES - OK                                     
         LA    RF,SPAAACT(RE)      FIRST CHARACTER OF LEVEL D                   
         CLI   0(RF),C' '                                                       
         BE    CHKSP14             LEVEL B IS BLANK THIS IS LEVEL C             
*                                                                               
         ZIC   RE,LNLEV4           4 LEVEL LEDGER                               
*                                                                               
CHKSP14  SHI   RE,1                                                             
         EXCLC RE,SPAAACT,ACTKACT                                               
         BE    CHKSP20                                                          
*                                                                               
CHKSP18  SR    R0,R0                                                            
         IC    R0,SPALN                                                         
         AR    R4,R0                                                            
         B     CHKSP10                                                          
*                                                                               
CHKSP20  OI    ACCINDS,ACCISPAC    ACCOUNT IS STAFF PAYABLES                    
CHKSPX   XIT1                                                                   
         DROP  R2,R4                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET LEVELN FIELD WHICH KEEPS TRACK OF WHAT LEVEL ACCT WE ARE                  
* PROCESSING                                                                    
* BCBYTE1 CONTAINS THE LENGTH OF THE ACCOUNT BEING PROCESSED                    
***********************************************************************         
         SPACE 1                                                                
SETLEN   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         ZIC   RE,BCBYTE1                                                       
         MVI   LEVELN,1            ASSUME ENTERED 1ST LEVEL ACCOUNT             
         ZIC   R1,LNLEV1           RF POINTS TO FIRST LENGTH                    
         CR    RE,R1               INPUT LENGTH > LEVEL 1 LENGTH?               
         BNH   SETLENX             NO SO FIRST LEVEL ENTERED                    
         MVI   LEVELN,2                                                         
*                                                                               
         ZIC   R1,LNLEV2           BUMP TO 2ND LEVEL                            
         LTR   R1,R1                                                            
         BZ    SETLENX                                                          
         CR    RE,R1                                                            
         BNH   SETLENX                                                          
         MVI   LEVELN,3                                                         
*                                                                               
         ZIC   R1,LNLEV3           BUMP TO THIRD LEVEL                          
         LTR   R1,R1                                                            
         BZ    SETLENX                                                          
         CR    RE,R1                                                            
         BNH   SETLENX                                                          
         MVI   LEVELN,4            MUST HAVE ENTERED 4TH LEVEL ACCT             
*                                                                               
SETLENX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET UP FILTERING FOR THE BANK PROFILES ON THE 3RD PAGE OF SC.                 
* THEN CALL RDLLSC TO SEE IF ANY VALUE FOUND ON LOW LEVEL SC                    
* ON EXIT - FILTEQ WILL BE SET TO 'E' FOR EQUAL, 'H' FOR HIGH OR 'L'            
*           FOR LOW OR ZERO IF VALUE NOT FOUND.                                 
***********************************************************************         
         SPACE 1                                                                
FLTBNK   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVI   FILTEQ,0                                                         
         MVI   BCBYTE1,0                                                        
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#CRDSN)      ACR DATAEST NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTACR                                                   
         B     FLTBNK10                                                         
         CLM   R1,3,=AL2(ACC#CRMC)       OR ACR MSG CLASS?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTACR                                                   
         B     FLTBNK10                                                         
*                                                                               
         CLM   R1,3,=AL2(ACC#EFDSN)      EFT DATASET NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTEFT                                                   
         B     FLTBNK10                                                         
         CLM   R1,3,=AL2(ACC#EFMC)       OR EFT MSG CLASS?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFTEFT                                                   
         B     FLTBNK10                                                         
*                                                                               
         CLM   R1,3,=AL2(ACC#PPDSN)      POSPAY DATASET NAME?                   
         BNE   *+12                                                             
         OI    BCBYTE1,FFTPOS                                                   
         B     FLTBNK10                                                         
         CLM   R1,3,=AL2(ACC#PPMC)       OR POSPAY MSG CLASS?                   
         BNE   *+12                                                             
         OI    BCBYTE1,FFTPOS                                                   
         B     FLTBNK10                                                         
*                                                                               
         CLM   R1,3,=AL2(ACC#820DSN)     820 DATASET NAME?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFT820                                                   
         B     FLTBNK10                                                         
         CLM   R1,3,=AL2(ACC#820MC)      OR 820 MSG CLASS?                      
         BNE   *+12                                                             
         OI    BCBYTE1,FFT820                                                   
         B     FLTBNK10                                                         
*                                                                               
FLTBNK10 BRAS  RE,RDLLSC           LOOK AT LOW LEVEL SC ACCOUNT                 
         BNE   FLTBNKX             NOT FOUND                                    
*                                                                               
         LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
FLTBNK20 CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BH    FLTBNK30                 VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,FLTBNK20                                                      
*                                                                               
FLTBNK30 LTR   R1,R1                                                            
         BZ    FLTBNKX                                                          
         BCTR  R1,0                                                             
         EXCLC R1,BCWORK,FLTIFLD   BCWORK CONTAINS THE VALUE FROM THE           
         BE    FLTBNKE             LOW LEVEL SC ACCOUNT RDLLSC ROUTINE          
         BL    FLTBNKL                                                          
         BH    FLTBNKH                                                          
*                                                                               
FLTBNKE  MVI   FILTEQ,C'E'                                                      
         B     FLTBNKX                                                          
FLTBNKH  MVI   FILTEQ,C'H'                                                      
         B     FLTBNKX                                                          
FLTBNKL  MVI   FILTEQ,C'L'                                                      
*                                                                               
FLTBNKX  XIT1                                                                   
*                                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* READ CASH ACCOUNT BANK PROFILE ELEMENT TO GET BANK/BRANCH CODE.               
* THEN CALL DDGETBANK TO GET BANK INFORMATION TO DISPLAY.                       
* DDGETBANK READS CONTROL/NFILE BANK RECORD AND AFM BANK RECORD                 
* USE AIO3 AS BANK BLOCK                                                        
***********************************************************************         
         SPACE 1                                                                
         USING ACTRECD,R2                                                       
GTBNK    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   SVBNKBR,BCSPACES                                                 
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('CBPELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   GTBNKX              NO ELEM SHOW DEFAULT                         
         L     RF,12(R1)                                                        
         USING CBPFELD,RF                                                       
         CLC   CBPBCDE,BCSPACES                                                 
         BNH   GTBNKL                                                           
         MVC   BCWORK(L'CBPBCDE+L'CBPBRCH),CBPBCDE                              
*                                                                               
         L     RE,AIO3                                                          
         LHI   RF,2000                                                          
         SR    R1,R1                                                            
         SR    R0,R0                                                            
         MVCL  RE,R0                                                            
*                                                                               
         L     R3,AIO3                                                          
         USING BANKD,R3                                                         
         MVC   BANCPY,CUABIN       COMPANY CODE                                 
         MVC   BANCDE,BCWORK       BANK CODE                                    
         MVC   BANBRN,BCWORK+3     BRANCH CODE                                  
         GOTO1 VGETBANK,BOPARM,(X'01',AIO3),ACOM,0                              
         B     GTBNKE                                                           
*                                                                               
GTBNKL   CLI   *,FF                                                             
         B     GTBNKX                                                           
GTBNKE   CR    RB,RB                                                            
GTBNKX   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LOOK AT THE LOW LEVEL SC ACCOUNT LOOKING FOR EDI INFORMATION        *         
* NTRY - BCBYTE1 CONTAINS THE TYPE OF EDI (ACR/EFT/POSPAY/820)        *         
*        BCBYTE2 CONTAINS AN INDICATOR FOR WHICH EDI INFORMATION IS   *         
*        NEEDED:  C'M'- MESSAGE CLASS, C'D'- DATASET NAME             *         
* XIT -  BCWORK CONTAINS THE MESSAGE CLASS IF FOUND AT THIS LEVEL     *         
***********************************************************************         
         SPACE 1                                                                
RDLLSC   NTR1  BASE=*,LABEL=*                                                   
         MVC   BCWORK,BCSPACES                                                  
*                                                                               
         LA    R3,ACTRFST                                                       
         USING FFTELD,R3                                                        
RDLL10   CLI   0(R3),0                                                          
         BE    RDLLL                                                            
         CLI   0(R3),FFTELQ                                                     
         BNE   *+12                                                             
         CLI   FFTTYPE,FFTTEDIP                                                 
         BE    RDLL30                                                           
RDLL20   ZIC   R1,1(R3)                                                         
         AR    R3,R1                                                            
         B     RDLL10                                                           
*                                                                               
RDLL30   CLC   FFTETYP,BCBYTE1                                                  
         BNE   RDLL20                                                           
         CLI   BCBYTE2,C'M'        WANT MESSAGE CLASS?                          
         BNE   RDLL40                                                           
         CLC   FFTMSGC,BCSPACES    ANY MESSAGE CLASS?                           
         BNH   RDLLL               NO                                           
         MVC   BCWORK(L'FFTMSGC),FFTMSGC                                        
         B     RDLLE                                                            
*                                                                               
RDLL40   CLI   BCBYTE2,C'D'        WANT DATASET NAME?                           
         BNE   RDLLL                                                            
         CLC   FFTDNAM,BCSPACES    ANY DATASET NAME?                            
         BNH   RDLLL               NO                                           
         MVC   BCWORK(L'FFTDNAM),FFTDNAM                                        
         B     RDLLE                                                            
*                                                                               
RDLLL    CLI   *,FF                                                             
         B     RDLLX                                                            
RDLLE    OI    LEVELBIT,ACCTLV     AT ACCT LEVEL                                
         CR    RB,RB                                                            
RDLLX    XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAY THE EDI BANK INFORMATION FOR THE 3RD PAGE OF THE SC ACCOUNT *         
* NTRY - AIO3 POINTS TO THE BANK BLOCK FROM DDGETBANK WHICH CONTAINS            
*        THE LOWEST LEVEL EDI INFORMATION.                                      
*        BCBYTE1 CONTAINS THE TYPE OF EDI (ACR/EFT/POSPAY/820)        *         
*        BCBYTE2 CONTAINS AN INDICATOR FOR WHICH EDI INFORMATION IS   *         
*        NEEDED:  C'M'- MESSAGE CLASS, C'D'- DATASET NAME, C'F'-      *         
*        FORMAT KEY                                                   *         
* XIT -  BCWORK CONTAINS THE MESSAGE CLASS IF FOUND AT THIS LEVEL     *         
***********************************************************************         
         SPACE 1                                                                
         USING BANKD,R3                                                         
EDIBNK   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   BCWORK,BCSPACES                                                  
         L     R3,AIO3                                                          
         CLI   BCBYTE2,C'M'        WANT MESSAGE CLASS?                          
         BNE   EDIB30                                                           
*                                                                               
* MESSAGE CLASS - EFT/AFM                                                       
         CLI   BCBYTE1,FFTEFT                                                   
         BNE   EDIB10                                                           
         CLC   BANEFCLS,BCSPACES   ANY MSG CLASS AT AFM BANK LVL?               
         BNH   EDIMSGD             NO                                           
         MVC   BCWORK(L'BANEFCLS),BANEFCLS                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* MESSAGE CLASS - POSPAY/AFM                                                    
EDIB10   CLI   BCBYTE1,FFTPOS                                                   
         BNE   EDIB20                                                           
         CLC   BAN57CLS,BCSPACES   ANY MSG CLASS AT AFM BANK LVL?               
         BNH   EDIMSGD             NO                                           
         MVC   BCWORK(L'BAN57CLS),BAN57CLS                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* MESSAGE CLASS - ACR/AFM                                                       
EDIB20   CLI   BCBYTE1,FFTACR                                                   
         BNE   EDIB25                                                           
         CLC   BANCRCLS,BCSPACES   ANY MSG CLASS AT AFM BANK LVL?               
         BNH   EDIMSGD             NO                                           
         MVC   BCWORK(L'BANCRCLS),BANCRCLS                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* MESSAGE CLASS - 820/AFM                                                       
EDIB25   CLI   BCBYTE1,FFT820                                                   
         BE    *+6                                                              
         DC    H'0'                                                             
         CLC   BAN82CLS,BCSPACES   ANY MSG CLASS AT AFM BANK LVL?               
         BNH   EDIMSGD                                                          
         MVC   BCWORK(L'BAN82CLS),BAN82CLS                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* MESSAGE CLASS - CFILE                                                         
EDIMSGD  CLC   BANDFCLS,BCSPACES          IS IT BINARY ZEROS ?                  
         BNH   EDIMSGD1                                                         
         MVC   BCWORK(L'BANDFCLS),BANDFCLS                                      
         OI    LEVELBT2,CFIBNKLV   FOUND AT CFILE LEVEL                         
         B     EDIBE                                                            
*                                                                               
EDIMSGD1 MVC   BCWORK(L'AC@NONE),AC@NONE      NO ACCOUNT RECORD LVL.            
         B     EDIBE                                                            
*                                                                               
*                                                                               
EDIB30   CLI   BCBYTE2,C'D'        WANT DATASET NAME?                           
         BNE   EDIBX                                                            
*                                                                               
* DATASET NAME - EFT/AFM                                                        
         CLI   BCBYTE1,FFTEFT                                                   
         BNE   EDIB40                                                           
         CLC   BANEFDSN,BCSPACES   ANY DSN AT AFM BANK LVL?                     
         BNH   EDIBL               NO (& NOT ON CFILE BANK)                     
         MVC   BCWORK(L'BANEFDSN),BANEFDSN                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* DATASET NAME - POSPAY/AFM                                                     
EDIB40   CLI   BCBYTE1,FFTPOS                                                   
         BNE   EDIB50                                                           
         CLC   BAN57DSN,BCSPACES   ANY DSN AT AFM BANK LVL?                     
         BNH   EDIBL               NO (& NOT ON CFILE BANK)                     
         MVC   BCWORK(L'BAN57DSN),BAN57DSN                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* DATASET NAME - ACR/AFM                                                        
EDIB50   CLI   BCBYTE1,FFTACR                                                   
         BNE   EDIB60                                                           
         CLC   BANCRDSN,BCSPACES   ANY DSN AT AFM BANK LVL?                     
         BNH   EDIBL               NO (& NOT ON CFILE BANK)                     
         MVC   BCWORK(L'BANCRDSN),BANCRDSN                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
* DATASET NAME - 820/AFM                                                        
EDIB60   CLI   BCBYTE1,FFT820                                                   
         BE    *+6                                                              
         DC    H'0'                BAD DATA OR NEED TO ADD                      
         CLC   BAN82DSN,BCSPACES   ANY DSN AT AFM BANK LVL?                     
         BNH   EDIBL               NO (& NOT ON CFILE BANK)                     
         MVC   BCWORK(L'BAN82DSN),BAN82DSN                                      
         OI    LEVELBT2,AFMBNKLV   FOUND AT AFM BANK LEVEL                      
         B     EDIBE                                                            
*                                                                               
EDIBL    CLI   *,FF                                                             
         B     EDIBX                                                            
EDIBE    CR    RB,RB                                                            
EDIBX    XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* VALIDATE THE BANK/BRANCH CODE AGAINST THE AFM BANK REC              *         
* NTRY - BCWORK CONTAINS THE BANK/BRANCH CODE                         *         
***********************************************************************         
         SPACE 1                                                                
         USING BNKRECD,R3                                                       
VALBANK  NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         MVC   BNKKEY,BCSPACES     READ BANK RECORD                             
         MVI   BNKTYP,BNKTYPQ                                                   
         MVI   BNKSUB,BNKSUBQ                                                   
         MVC   BNKCPY,CUABIN       CONNECTED ID                                 
         MVC   BNKBANK(L'BNKBANK+L'BNKBRNCH),BCWORK                             
         MVI   BNKETYP,BNKDFT      MOVE IN DEFAULT TRANSMISSION TYPE            
         LHI   R1,XOHIGH+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         CLC   IOKEY(BNKETYP-BNKRECD),IOKEYSAV                                  
         BE    VALBNKE                                                          
*                                                                               
VALBNKL  CLI   *,FF                                                             
         B     VALBNKX                                                          
VALBNKE  CR    RB,RB                                                            
VALBNKX  XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* HIDE THE FIELD BY DISPLAY '*' EXCEPT THE LAST 4 DIGITS FOR DDS      *         
* TERMINALS.  USED BY:                                                          
* SSN/EIN                                                                       
* BANK ACCOUNT NUMBER                                                           
* NTRY - BCBYTE1 CONTAINS THE LENGTH OF THE FIELD                               
***********************************************************************         
         SPACE 1                                                                
HIDE     NTR1  BASE=*,LABEL=*                                                   
         ZIC   RE,BCBYTE1          MAX LENGTH OF FIELD YOU WANT TO HIDE         
         LA    R1,FVIFLD                                                        
         AR    R1,RE               BUMP TO END OF FIELD                         
         BCTR  R1,0                BACK UP ONE TO POINT TO LAST CHAR            
HIDE10   CLI   0(R1),C' '                                                       
         BH    HIDE20                                                           
         BCTR  RE,0                                                             
         BCT   R1,HIDE10                                                        
*                                                                               
HIDE20   LA    R1,FVIFLD                                                        
         AHI   RE,-4                                                            
         LTR   RE,RE                                                            
         BNP   HIDEX                                                            
HIDE30   MVI   0(R1),C'*'                                                       
         LA    R1,1(R1)                                                         
         BCT   RE,HIDE30                                                        
*                                                                               
HIDEX    XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* MAKE SURE CONTACT NAME EXITS IF FAXING OR EMAILING CHECK REMITTANCE           
* MAKE SURE FAX NUMBER EXISTS IF FAXING REMITTANCE                              
* MAKE SURE EMAIL ADDRESS EXISTS IF EMAILING REMITTANCE                         
* ON ENTRY - BCBYTE1 CONTAINS AN 'M','F' OR 'E' FOR MAIL/FAX/EMAIL              
***********************************************************************         
         SPACE 1                                                                
CHKCNT   NTR1  BASE=*,LABEL=*                                                   
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R2)),          +        
               (L'FFTTYPE,=AL1(FFTTCONT))                                       
         CLI   12(R1),0                                                         
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$VCONT) CONTACT NAME MUST EXIST IF                
         B     CKCNTL              NO CONTACT NAME FOUND                        
*                                                                               
         CLI   BCBYTE1,C'F'        FAXING REMITTANCE?                           
         BNE   CKCNT10             MAKE SURE FAX # EXISTS                       
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R2)),          +        
               (L'FFTTYPE,=AL1(FFTTPFAX))                                       
         CLI   12(R1),0                                                         
         BE    CKCNTEQ                                                          
         MVC   FVMSGNO,=AL2(AE$NOFAX)                                           
         B     CKCNTL                                                           
*                                                                               
CKCNT10  CLI   BCBYTE1,C'E'        EMAILING REMITTANCE?                         
         BNE   CKCNTEQ             MAKE SURE AN EMAIL ADDR EXISTS               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R2)),          +        
               (L'FFTTYPE,=AL1(FFTTEML))                                        
         CLI   12(R1),0                                                         
         BE    CKCNTEQ                                                          
         MVC   FVMSGNO,=AL2(AE$NOEML)                                           
         B     CKCNTL                                                           
*                                                                               
CKCNTL   CLI   *,FF                                                             
         B     CKCNTX                                                           
CKCNTEQ  CR    RB,RB                                                            
CKCNTX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* VALIDATE THAT THIS LEDGER IS VALID FOR THE TAX PROFILES                       
***********************************************************************         
         SPACE 1                                                                
TXVFLT   NTR1  BASE=*,LABEL=*                                                   
         CLC   =C'2C',ACTKUNT      VALID FOR 2C,SP,SQ,SS,ST,SU,SV,SW            
         BE    TXVFLTE             SX AND SY                                    
         CLI   ACTKUNT,C'S'                                                     
         BNE   TXVFLTL                                                          
         CLI   ACTKLDG,C'P'                                                     
         BE    TXVFLTE                                                          
         CLI   ACTKLDG,C'Q'                                                     
         BE    TXVFLTE                                                          
         CLI   ACTKLDG,C'S'                                                     
         BL    TXVFLTL                                                          
         CLI   ACTKLDG,C'Y'                                                     
         BNH   TXVFLTE                                                          
*                                                                               
TXVFLTL  CLI   *,FF                                                             
         B     TXVFLTX                                                          
TXVFLTE  CR    RB,RB                                                            
TXVFLTX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK WHAT ROW WE ARE PROCESSING (IF THIS IS A LIST)                          
* THIS ROUTINE GETS CALLED FOR ALL FIELDS THAT ARE NOT ELIGIBLE FOR             
* MULITPLE ROW OUTPUT ON THE LIST SCREEN. (IF THEY ARE PART OF A LEDGER         
* WHERE MULTIPLE ROWS ARE ELIGIBLE I.E. PAYABLES.)                              
*                                                                               
* ON EXIT - EQUAL IF THIS IS ROW 1 OF THE LIST OR NOT A LIST AT ALL             
*           NOT EQUAL IF THIS IS A LIST AND IT'S A ROW OTHER THAN 1             
***********************************************************************         
         SPACE 1                                                                
CHKROW   NTR1  BASE=*,LABEL=*                                                   
         CLI   CSACT,A#REPT        FOR REPORT OR DOWNLOAD USE                   
         BE    *+12                SVNROWS SINCE LSROWREP IS NOT                
         CLI   CSACT,A#DLOAD       FILLED IN.                                   
         BNE   CHKRW10                                                          
         ZIC   RF,SVNROWS          ROW 1 OF LIST SCREEN?                        
         B     CHKRW20             YES-SO ALWAYS PROCESS                        
*                                                                               
CHKRW10  CLI   CSACT,A#LST         FOR OTHER ACTIONS ALWAYS PROCESS             
         BNE   CHKROWE                                                          
         LH    RF,LSROWREP                                                      
CHKRW20  CHI   RF,1                ROW 1 OF LIST SCREEN?                        
         BNH   CHKROWE             YES - SO ALWAYS PROCESS                      
*                                                                               
CHKROWL  CLI   *,FF                                                             
         B     CHKROWX                                                          
CHKROWE  CR    RB,RB                                                            
CHKROWX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF A FIELD IS INCLUDED AS A COLUMN ON THE LIST SCREEN                   
* ENTRY - BCHALF CONTAINS THE FIELD NUMBER                                      
***********************************************************************         
         SPACE 1                                                                
         USING DCTABD,R3                                                        
CKLCOL   NTR1  BASE=*,LABEL=*                                                   
         XR    R0,R0               LOOP THROUGH FIXED COLUMNS                   
         ICM   R0,3,LSFIXNUM       NUMBER OF FIXED COLUMNS                      
         BZ    CKLCOL20            NO FIXED COLS                                
         LA    R3,LSFIXCLM                                                      
CKLCOL10 CLC   BCHALF,DCTFLD#      DID WE FIND A MATCH ON FIELD NUMBER?         
         BE    CKLCOLE                                                          
         LA    R3,DCTABL(R3)       NEXT COLUMN FOR THIS LINE                    
         BCT   R0,CKLCOL10                                                      
*                                                                               
CKLCOL20 XR    R0,R0               LOOP THROUGH VARIABLE COLUMNS                
         ICM   R0,3,LSVARNUM                                                    
         BZ    CKLCOLL                                                          
         LA    R3,LSVARCLM                                                      
CKLCOL30 CLC   BCHALF,DCTFLD#      DID WE FIND A MATCH ON FIELD NUMBER?         
         BE    CKLCOLE                                                          
         LA    R3,DCTABL(R3)       NEXT COLUMN FOR THIS LINE                    
         BCT   R0,CKLCOL30                                                      
*                                                                               
CKLCOLL  CLI   *,FF                                                             
         B     CKLCOLX                                                          
CKLCOLE  CR    RB,RB                                                            
CKLCOLX  XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET UP XXX,9999 IN FVXTRA FOR THE REPORT/DOWNLOAD MESSAGES                    
***********************************************************************         
         SPACE 1                                                                
         USING REPD,R1                                                          
SETMSGID NTR1  BASE=*,LABEL=*                                                   
         L     R1,AREP                                                          
         LA    RF,BCWORK                                                        
         MVC   0(3,RF),REPSUBID                                                 
         MVI   3(RF),C','                                                       
         XR    R0,R0                                                            
         ICM   R0,3,REPREPNO                                                    
         CVD   R0,BCDUB                                                         
         OI    BCDUB+7,X'0F'                                                    
         UNPK  BCWORK+4(5),BCDUB                                                
         LA    R1,4                                                             
         LA    RE,BCWORK+4                                                      
         CLI   0(RE),C'0'                                                       
         BNE   *+12                                                             
         LA    RE,1(RE)                                                         
         BCT   R1,*-12                                                          
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   4(0,RF),0(RE)                                                    
         LA    R1,1(R1)            TRUE LENGTH OF REPORT NUMBER                 
         LA    RF,BCWORK+4                                                      
         AR    RF,R1               BUMP TO SPOT PAST LAST NUMBER                
         LA    RE,BCWORK+L'BCWORK-1  CLEAR THE REST OF BCWORK                   
         SR    RE,RF                                                            
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         XC    0(0,RF),0(RF)                                                    
         LA    RF,BCWORK           SET UP XXX,99999                             
         LA    R1,4(R1)            L'TEXT - 1                                   
         CLM   R1,1,=AL1(L'FVXTRA-1)                                            
         BNH   *+8                                                              
         LA    R1,L'FVXTRA-1                                                    
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   FVXTRA(0),0(RF)     SET EXTRA INFORMATION XXX,99999              
         XIT1                                                                   
         DROP  R1                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*         
* READ COMPANY RECORD AND SAVE COMPANY ELEMENT                                  
*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*         
         SPACE 1                                                                
         USING CPYRECD,R3                                                       
READCO   NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         MVC   CPYKEY,BCSPACES     READ COMPANY RECORD                          
         MVC   CPYKCPY,CUABIN      CONNECTED ID                                 
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                BAD COMPANY RECORD                           
         GOTO1 AGETEL,BOPARM,('CPYELQ',AIO2),0                                  
         BE    *+6                                                              
         DC    H'0'                NO COMPANY ELEMENT                           
         MVC   SVCPYEL,BOELEM      SAVE COMPANY ELEMENT                         
         XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK FOR TAX INFORMATION ON UNIT S ACCOUNT                                   
* THIS ROUTINE GETS CALLED FROM RECLAST WHEN YOU ARE ADDING/CHANGING/           
* COPYING/RESTORING A UNIT S ACCOUNT AND YOU ARE ON THE 1ST PAGE.  CHK          
* FOR TAX INFORMATION AND IF IT EXISTS WILL ADD/UPDATE THE 2C ACCOUNT           
***********************************************************************         
         SPACE 1                                                                
CHKTX    NTR1  BASE=*,LABEL=*                                                   
         CLC   =C'2C',ACTKUNT      2C MAY HAVE TAX INFO BUT ONLY WANT           
         BE    CHKTXL              TO CHECK UNIT S                              
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R2)),0                  
         CLI   12(R1),0                                                         
         BNE   CHKTXL                                                           
         L     RF,12(R1)            1ST CHECK TO SEE IF 1099 VENDOR             
         USING RSTELD,RF            PROFILE IS SET TO YES                       
         TM    RSTSTAT1,RSTSVB2C                                                
         BZ    CHKTXL               NOT SET TO YES SO EXITL                     
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',(R2)),0                  
         CLI   12(R1),0                                                         
         BNE   CHKTXL                                                           
         L     RF,12(R1)           NOW CHECK TO SEE IF TAX # EXISTS             
         USING OTHELD,RF                                                        
         CLC   OTHNUM,BCSPACES                                                  
         BNH   CHKTXL              TAX # DOES NOT EXIST SO EXITL                
         MVC   SVTXNUM,OTHNUM      SAVE TAX NUMBER AND TYPE                     
         MVI   TAXIND,C'S'                                                      
         CLI   OTHPROF,C'I'                                                     
         BNE   CHKTXE                                                           
         MVI   TAXIND,C'E'                                                      
         B     CHKTXE                                                           
*                                                                               
CHKTXL   CLI   *,FF                                                             
         B     CHKTXX                                                           
CHKTXE   CR    RB,RB                                                            
CHKTXX   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* WHEN 1099 VENDOR PROFILE SET TO YES THIS ROUTINE WILL...                      
*** CHECK IF THE 2C LEDGER EXISTS.                                              
*** CHECK IF A 2C ACCOUNT W/ THE SAME ACCOUNT CODE EXISTS.                      
*** DOES NOT EXIST - ADD THE 2C ACCOUNT WITH THE INFO FROM THE PAYABLE.         
*** DOES EXIST - MAKE SURE THE TAX ID # AND TAX TYPE MATCH BETWEEN THE          
*** 2C AND THE PAYABLE.                                                         
*** MATCH - EXIT ROUTINE AND CONTINUE WITH VALIDATION                           
*** NO MATCH - GIVE ERROR MESSAGE                                               
*** IF NO TAX INFO EXISTS ON THE 2C ACCOUNT ADD THE TAX INFO FROM THE           
*** PAYABLE.                                                                    
***********************************************************************         
         SPACE 1                                                                
V2CTX    NTR1  BASE=*,LABEL=*                                                   
         MVI   BYTE2C,0                                                         
         USING LDGRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   LDGKEY,BCSPACES                                                  
         MVC   LDGKCPY,CUABIN                                                   
         MVC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),=C'2C'                              
         GOTO1 AGETLDG                                                          
         BNE   V2CTXE              2C LDG DOESN'T EXIST SO CONTINUE             
         ICM   RE,15,ACALDG                                                     
         USING LDGTABD,RE                                                       
         CLC   LDGTSEC,TWAAUTH+1   TEST SECURITY LEVEL                          
         BNH   *+18                                                             
         MVC   FVMSGNO,=AL2(AE$SEC2C)   REC CHANGED BUT SECURITY L/O 2C         
         OI    GCINDS3,GCIDSMSG    SET OWN DISPLAY MESSAGE                      
         B     V2CTXE                                                           
         MVC   TLEV1(4),LDGTLVA       TEMPORARY LEVEL LENGTHS                   
         BRAS  RE,CHKACLN          MAKE SURE IT'S A LOW LEVEL 2C                
         BE    *+18                                                             
         MVC   FVMSGNO,=AL2(AE$NLL2C)  REC CHNGED BUT NOT 2C                    
         OI    GCINDS3,GCIDSMSG    SET OWN DISPLAY MESSAGE                      
         B     V2CTXE                                                           
         DROP  R3,RE                                                            
*                                                                               
T        USING ACTRECD,R3                                                       
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'2C'                            
         MVC   T.ACTKACT,ACTKACT   MOVE IN PAYABLE ACCOUNT                      
         L     R1,=AL4(XORDUPD+XOACCDIR+XIO2)                                   
         GOTO1 AIO                                                              
         BE    V2CTX20             ACCT EXISTS SO GO CHECK FOR ELEMENT          
         TM    IOERR,IOEDEL        IF ERROR IS THAT REC IS DELETED              
         BO    V2CTX20             GO LOOK FOR TAX INFO                         
         ICM   RE,15,ACALDG        ACCT DOESN'T EXIST SO ADD IT (MAYBE)         
         USING LDGTABD,RE                                                       
         CLI   LDGTLVA,L'ACTKACT   ONE LEVEL LEDGER?                            
         BE    V2CTX10             YES SO NO HIGHER LEVELS TO CHECK             
         MVC   BCHALF,=C'2C'                                                    
         MVC   TLEV1(4),LDGTLVA       TEMPORARY LEVEL LENGTHS                   
         BRAS  RE,VALHIGH          MAKE SURE HIGHER LEVEL 2C EXISTS             
         BE    V2CTX10             ERROR                                        
         MVC   FVMSGNO,=AL2(AE$HI2CM)  REC CHNGED BUT NOT 2C                    
         OI    GCINDS3,GCIDSMSG    SET OWN DISPLAY MESSAGE                      
         B     V2CTXE                                                           
*                                                                               
V2CTX10  BRAS  RE,ADD2C            ADD 2C ACCT                                  
         MVC   FVMSGNO,=AL2(AE$2CADD) RECORD CHANGED AND 2C ADDED               
         OI    GCINDS3,GCIDSMSG    SET OWN DISPLAY MESSAGE                      
         CLI   CSACT,A#CPY         IS THE ACTION COPY?                          
         BNE   V2CTXE                                                           
         MVC   FVMSGNO,=AL2(AE$CPY2C) RECORD ADDED AND 2C ADDED                 
         B     V2CTXE              DONE                                         
*                                                                               
V2CTX20  TM    T.ACTKSTAT,ACTSDELT IS IT DELETED RECORD                         
         BNO   *+12                NO                                           
         NI    T.ACTKSTAT,X'FF'-ACTSDELT  YES UNDELETE IT                       
         OI    BYTE2C,UPD2C        SET BIT TO UPDATE 2C                         
*                                                                               
         L     R1,=AL4(XOGETRUP+XOACCMST+XIO2)                                  
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R3,AIO2                                                          
         TM    T.ACTRSTAT,ACTSDELT IS IT DELETED RECORD                         
         BNO   *+12                NO                                           
         NI    T.ACTRSTAT,X'FF'-ACTSDELT  ELSE UNDELETE IT                      
         OI    BYTE2C,UPD2C        SET BIT TO UPDATE 2C                         
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('OTHELQ',AIO2),0                  
         CLI   12(R1),0                                                         
         BNE   V2CTX30             NO ELEM FOUND SO ADD IT TO 2C                
         L     RF,12(R1)                                                        
         USING OTHELD,RF                                                        
         CLC   OTHNUM,SVTXNUM      DOES THE # MATCH BTN 2C AND PAYABLE?         
         BNE   V2CTXERR            NO GIVE ERROR                                
         CLI   TAXIND,C'S'         IS IT AN SS#/SIN# ON THE PAYABLE?            
         BNE   *+18                NO                                           
         CLC   OTHPROF,BCSPACES    YES SO THIS MUST BE SPACES                   
         BNE   V2CTXERR            ERROR                                        
         B     V2CTX40             EQUAL SO OK TO CONTINUE                      
         CLI   OTHPROF,C'I'        ELSE MUST HAVE 'I' TO INDICATE EIN           
         BNE   V2CTXERR            ERROR                                        
         B     V2CTX40             EQUAL SO OK TO CONTINUE                      
*                                                                               
V2CTX30  MVC   BOELEM,BCSPACES     ADD 23 ELEMENT TO EXISTING 2C                
         USING OTHELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVI   OTHEL,OTHELQ                                                     
         MVI   OTHLN,OTHLN1Q                                                    
         MVC   OTHNUM,SVTXNUM      TAX/SS# FROM PAYABLE ACCT                    
         CLI   TAXIND,C'E'         IS IT AN EIN#/BN# FROM THE PAYABLE?          
         BNE   *+8                 NO                                           
         MVI   OTHPROF,C'I'        YES                                          
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),AIO2,OTHELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         OI    BYTE2C,UPD2C        SET BIT TO UPDATE 2C                         
         DROP  RF                                                               
*                                                                               
* CHECK IF ADDRESSES MATCH                                                      
V2CTX40  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ADRELQ',AIO2),0                  
         CLI   12(R1),0            READ ADDRESS ON 2C ACCOUNT                   
         BE    *+12                                                             
         OI    BYTE2C,NO2CADDR     NO ADDR FOUND ON PAYABLE                     
         B     V2CTX50                                                          
         L     RF,12(R1)                                                        
         ST    RF,BOADDR1                                                       
*                                                                               
V2CTX50  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ADRELQ',(R2)),0                  
         CLI   12(R1),0            READ ADDRESS ON PAYABLE ACCOUNT              
         BE    *+12                                                             
         OI    BYTE2C,NOPYADDR     NO ADDR FOUND ON PAYABLE                     
         B     V2CTX60                                                          
         L     RF,12(R1)                                                        
         ST    RF,BOADDR2                                                       
*                                                                               
V2CTX60  TM    BYTE2C,NO2CADDR+NOPYADDR                                         
         BO    V2CTX80             NO ADDRESS FOR EITHER-CONTINUE               
         BM    V2CTX70             ONE ACCT HAS AN ADDR ONE DOESN'T -           
*                                  GIVE WARNING                                 
         L     RF,BOADDR1          RF=ADDRESS ELEM OF 2C                        
         L     RE,BOADDR2          RE=ADDRESS ELEM OF PAYABLE                   
         ZIC   R1,1(RE)            R1=LENGTH OF PAYABLE ADDRESS                 
         BCTR  R1,0                                                             
         EXCLC R1,0(RF),0(RE)                                                   
         BE    V2CTX80             ADDRESSES MATCH-CONTINUE                     
*                                                                               
V2CTX70  DS    0H                                                               
         OI    BYTE2C,NOADDRM      ADDRESSES DON'T MATCH-SET WARNING            
         MVC   FVMSGNO,=AL2(AE$ADDNM) ADDRESS DOES NOT MATCH 2C                 
         OI    GCINDS3,GCIDSMSG    SET OWN DISPLAY MESSAGE                      
*                                                                               
V2CTX80  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('NAMELQ',AIO2),0                  
         CLI   12(R1),0            READ NAME ON 2C ACCOUNT                      
         BE    *+12                                                             
         OI    BYTE2C,NO2CNME      NO NAME FOUND ON 2C                          
         B     V2CTX90                                                          
         L     RF,12(R1)                                                        
         ST    RF,BOADDR1                                                       
*                                                                               
* CHECK IF NAMES MATCH                                                          
V2CTX90  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('NAMELQ',(R2)),0                  
         CLI   12(R1),0            READ NAME ON PAYABLE ACCOUNT                 
         BE    *+12                                                             
         OI    BYTE2C,NOPYNME      NO NAME FOUND ON PAYABLE                     
         B     V2CTX100                                                         
         L     RF,12(R1)                                                        
         ST    RF,BOADDR2                                                       
*                                                                               
V2CTX100 TM    BYTE2C,NO2CNME+NOPYNME                                           
         BO    V2CTX110            NEITHER ACCT HAS A NAME-CONTINUE             
         L     RF,BOADDR1          RF=NAME ELEM OF 2C                           
         L     RE,BOADDR2          RE=NAME ELEM OF PAYABLE                      
         ZIC   R1,1(RE)            R1=LENGTH OF PAYABLE NAME                    
         BCTR  R1,0                                                             
         EXCLC R1,0(RF),0(RE)                                                   
         BE    V2CTX110            NAMES MATCH-CONTINUE                         
         GOTO1 VHELLO,BOPARM,(C'D',GCFILNAM),('NAMELQ',AIO2)                    
         XC    BOELEM,BOELEM                                                    
         USING NAMELD,RF                                                        
         L     RF,BOADDR2          NAME ELEM FROM PAYABLE                       
         ZIC   R1,1(RF)                                                         
         BCTR  R1,0                                                             
         EXMVC R1,BOELEM,0(RF)     CREATE NAME ELEMENT FOR 2C                   
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),AIO2,NAMELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         OI    BYTE2C,UPD2C        SET BIT TO UPDATE 2C                         
         DROP  RF                                                               
*                                                                               
V2CTX110 TM    BYTE2C,UPD2C        IF GET HERE 2C EXISTS AND TAX INFO           
         BO    V2CTX120            MATCHES.  WAS 2C DELETED? YES-WRITE          
         B     V2CTXE              BACK 2C.  NO-EXIT                            
*                                                                               
V2CTX120 GOTOX ('PUTRAC',AGROUTS),BOPARM,('RACTCHA',AIO2) CHG F9 ELEM           
         LHI   R1,XOPUT+XOACCMST+XIO2  PUT THE RECORD BACK                      
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                BAD ACCOUNT RECORD                           
*                                                                               
         LHI   R1,XOWRITE+XOACCDIR+XIO2   WRITE DIRECTORY RECORD BACK           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         MVC   FVMSGNO,=AL2(AE$2CUPD) RECORD CHANGED AND 2C UPDATED             
         TM    BYTE2C,NOADDRM         DID ADDRESSES MATCH?                      
         BZ    *+10                                                             
         MVC   FVMSGNO,=AL2(AE$NOADM)  REC CHANGED BUT ADDR DON'T MATCH         
         OI    GCINDS3,GCIDSMSG    SET OWN DISPLAY MESSAGE                      
         B     V2CTXE                                                           
         DROP  T                                                                
*                                                                               
V2CTXERR MVC   FVMSGNO,=AL2(AE$TAXNM) TAX ID INFO DOES NOT MATCH 2C             
*                                                                               
V2CTXL   CLI   *,FF                                                             
         B     V2CTXX                                                           
V2CTXE   CR    RB,RB                                                            
V2CTXX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ADD 2C ACCOUNT AND APPROPRIATE ELEMENTS                                       
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
ADD2C    NTR1  BASE=*,LABEL=*                                                   
         L     RE,AIO2                                                          
         LHI   RF,IOAREALN                                                      
         SR    R1,R1                                                            
         SR    R0,R0                                                            
         MVCL  RE,R0                                                            
*                                                                               
         L     R3,AIO2                                                          
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKEY,0(R2)            COPY OVER PAYABLE ACCOUNT              
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'2C'                            
*        MVC   T.ACTKEY,IOKEYSAV                                                
         LH    RE,=Y(ACTRFST-ACTRECD+1)  ACCOUNTS LENGTH                        
         STCM  RE,3,T.ACTRLEN                                                   
         XC    T.ACTRSTA,T.ACTRSTA  CLEAR STATUS FIELD                          
         OI    T.ACTRSTAT,ACTSABLP   ACCOUNT HAS BALANCE ELEMENT                
         MVI   T.ACTRSAF1,C' '                                                  
         MVI   T.ACTRSAF2,C' '                                                  
         MVI   T.ACTRSAF3,C' '                                                  
         MVI   T.ACTRSAF4,C' '                                                  
         MVI   T.ACTRSAF5,C' '                                                  
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('NAMELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                THERE SHOULD BE A NAME ELEMENT               
         L     RF,12(,R1)          ON THE PAYABLE                               
         USING NAMELD,RF                                                        
         XC    BOELEM,BOELEM                                                    
         ZIC   R1,NAMLN                                                         
         BCTR  R1,0                                                             
         EXMVC R1,BOELEM,0(RF)     CREATE NAME ELEMENT FOR 2C                   
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),AIO2,NAMELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('ADRELQ',ACTRECD),0               
         CLI   12(R1),0                                                         
         BNE   ADD2C10             NO ADDRESS ON PAYABLE                        
         L     RF,12(,R1)                                                       
         USING ADRELD,RF                                                        
         XC    BOELEM,BOELEM                                                    
         ZIC   R1,ADRLN                                                         
         BCTR  R1,0                                                             
         EXMVC R1,BOELEM,0(RF)     CREATE ADDRESS ELEMENT FOR 2C                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),AIO2,ADRELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
*                                                                               
ADD2C10  XC    BOELEM,BOELEM                                                    
         USING RSTELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVI   RSTEL,RSTELQ        BUILD 30 ELEMENT FOR 2C                      
         MVI   RSTLN,RSTLN3Q       LONGEST LENGTH                               
         MVC   RSTBDATE,BCTODAYP                                                
         MVC   RSTTDATE,BCTODAYP                                                
         MVI   RSTCOSTG,C' '                                                    
         MVI   RSTFILT1,C' '                                                    
         MVI   RSTFILT2,C' '                                                    
         MVI   RSTFILT3,C' '                                                    
         MVI   RSTFILT4,C' '                                                    
         MVI   RSTFILT5,C' '                                                    
         MVC   RSTDFTSK,BCSPACES                                                
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),AIO2,RSTELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
*                                                                               
         GOTO1 AADDAST,T.ACTRECD     ADD 31 ELEMENT TO 2C                       
         GOTO1 AADDBAL,T.ACTRECD     ADD 32 AND 33 ELEMENTS TO 2C               
*                                                                               
         MVC   BOELEM,BCSPACES                                                  
         USING OTHELD,RF                                                        
         LA    RF,BOELEM                                                        
         MVI   OTHEL,OTHELQ        BUILD 23 ELEMENT FOR 2C                      
         MVI   OTHLN,OTHLN1Q                                                    
         MVC   OTHNUM,SVTXNUM      TAX/SS# FROM PAYABLE ACCT                    
         CLI   TAXIND,C'E'         IS IT AN EIN#/BN# FROM THE PAYABLE?          
         BNE   *+8                 NO                                           
         MVI   OTHPROF,C'I'        YES                                          
         GOTO1 VHELLO,BOPARM,(C'P',GCFILNAM),AIO2,OTHELD,0                      
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
*                                                                               
         GOTOX ('PUTRAC',AGROUTS),BOPARM,('RACTADD',AIO2) ADD F9 ELEM           
         LHI   R1,XOADDREC+XOACCMST+XIO2                                        
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         XIT1                                                                   
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* READ THE LEDGER RECORD OF THE CURRENT ACCOUNT                                 
* EXIT:  AIO2 CONTAINS THE LEDGER RECORD                                        
***********************************************************************         
         SPACE 1                                                                
         USING LDGRECD,R3                                                       
RDLDG    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    R3,IOKEY                                                         
         MVC   LDGKEY,BCSPACES     READ LEDGER RECORD                           
         MVC   LDGKCPY,CUABIN      CONNECTED ID                                 
         MVC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),GSRECKEY+1                          
         LHI   R1,XOREAD+XOACCDIR+XIO6                                          
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         LHI   R1,XOGET+XOACCMST+XIO6                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                BAD LEDGER RECORD                            
         L     R3,AIO6                                                          
         MVC   IOKEY,SVKEY         RE-ESTABLISH READ OF ACCOUNT                 
         LHI   R1,XOREAD+XOACCDIR+XIO1                                          
         GOTO1 AIO                                                              
         XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CLEAR FILTER BLOCK WHEN PFKEY 16 IS PRESSED ON LIST SCREEN                    
*                                                                               
* NOTE:  IF WE DECIDE TO CLEAR THE QUICK FILTERS WHEN USER CHANGES UL'S         
*        NEED TO CALL THIS ROUINTE FOR ALL QUICK FILTERS SINCE YOU DONT         
*        KNOW WHICH ONES ARE IN USE AND YOU ONLY GET CALLED WITH                
*        VALIDATE FILTER ROUTINES WHEN IT'S ACTUALLY USED.  IF YOU DONT         
*        DO THIS IT WILL JUST RE-POPULATE THE FIELD AGAIN.                      
***********************************************************************         
         SPACE 1                                                                
CLRFILT  NTR1  BASE=*,LABEL=*                                                   
         OI    LSSCIND1,LSSCIFLT   YES - CLEAR FILTER BLOCK                     
         LH    RE,=Y(FLTELSV-TWAD)                                              
         A     RE,ATWA                                                          
         LA    RF,FLTELSVL                                                      
         XR    R1,R1                                                            
         MVCL  RE,R0                                                            
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK LOW LEVEL ACCOUNT AND PROTECT FIELD FOR CHANGE ACTION                   
***********************************************************************         
         SPACE 1                                                                
CKLOPRO  NTR1  BASE=*,LABEL=*                                                   
         CLI   CSACT,A#DIS         IS IT A DISPLAY?                             
         JE    *+12                NO                                           
         CLI   CSACT,A#CHA         IS IT A CHANGE ?                             
         JNE   CKLOPX              NO - GET OUT                                 
         CLC   ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'1R' 1R RECORD ?                  
         JNE   CKLOPX              NO - GET OUT                                 
         MVC   TLEVS,LNLEVELS      TEMPORARY LEVEL LENGTHS                      
         BRAS  RE,CHKACLN          LOW LEVEL ACCOUNT ?                          
         JNE   CKLOPX              NO - GET OUT                                 
         OI    FVATRB,FVAPROT      PROTECT IF LOW LVL 1R ACCT                   
CKLOPX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CLEAR QUICK FILTERS WHEN PFKEY 16 IS PRESSED                                  
***********************************************************************         
         SPACE 1                                                                
CLRQFLT  NTR1  BASE=*,LABEL=*                                                   
         LA    RE,QFLTTB                                                        
CLRQ10   LA    RF,QFLTTBND                                                      
         CR    RE,RF                                                            
         BNL   CLRQX                                                            
         OC    0(4,RE),0(RE)                                                    
         BZ    CLRQ20                                                           
         L     R1,0(RE)                                                         
         ZIC   RF,5(R1)            INPUT LENGTH                                 
         LTR   RF,RF                                                            
         BZ    CLRQ20                                                           
         BCTR  RF,0                                                             
         EXMVC RF,8(R1),BCSPACES                                                
CLRQ20   LA    RE,4(RE)                                                         
         B     CLRQ10                                                           
*                                                                               
CLRQX    XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* FOR EACH ACCOUNT REC PASSED IN LIST SAVE HIGHER LEVEL ACCTS IF                
* APPLICABLE                                                                    
* ON EXIT:                                                                      
* AIO8  = 1ST LEVEL                                                             
* AIO9  = 2ND LEVEL                                                             
* AIO10 = 3RD LEVEL                                                             
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3          CURRENT ACCOUNT RECORD                       
X        USING ACTRECD,RF          HIGHER LEVEL ACCOUNT RECORDS                 
HILEVELS NTR1  BASE=*,LABEL=*                                                   
         MVC   SVKEY,IOKEY                                                      
         OC    LNLEV1(L'LNLEVELS),LNLEV1  IF JUST RETURNED FROM COLUMN/         
         BNZ   HILEV10                    LIST SCREEN THE LEVELS ARE            
*                                         CLEARED                               
         USING LDGRECD,R4                                                       
         LA    R4,IOKEY                                                         
         MVC   LDGKEY,BCSPACES                                                  
         MVC   LDGKCPY,CUABIN                                                   
         MVC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),ACTKUNT                             
         GOTO1 AGETLDG                                                          
         BE    *+6                                                              
         DC    H'0'                DIDN'T FIND LEDGER RECORD                    
         ICM   RE,15,ACALDG                                                     
         USING LDGTABD,RE                                                       
         MVC   LNLEV1(L'LNLEVELS),LDGTLVA                                       
         MVC   IOKEY,SVKEY                                                      
         DROP  R4,RE                                                            
*                                                                               
HILEV10  BRAS  RE,HIGHACC          1ST LEVEL ACCOUNT?                           
         BNE   HILEV20             NO                                           
         L     RF,AIO8                                                          
         CLC   IOKEY(L'ACTKEY),0(RF)   IF ALREADY READ THIS DON'T READ          
         BE    HILEV12                 AGAIN.                                   
         LHI   R1,XOGET+XOACCMST+XIO8   GET 1ST LEVEL RECORD AND                
         GOTO1 AIO                      STORE INTO IO8                          
         BE    *+6                                                              
         DC    H'0'                                                             
HILEV12  L     RE,AIO9             CLEAR IO AREAS                               
         LHI   RF,2000                                                          
         XCEF                                                                   
         L     RE,AIOA             CLEAR IO AREAS                               
         LHI   RF,2000                                                          
         XCEF                                                                   
         B     HILEV110                                                         
*                                                                               
* 2ND LEVEL                                                                     
HILEV20  LA    R3,IOKEY                                                         
         LA    R3,ACTKACT-ACTKEY(R3)                                            
         ZIC   RE,LNLEV3           CHECK IF 2ND LEVEL IS LOWEST                 
         LTR   RE,RE                                                            
         BZ    HILEV30             YES THAN NO NEED TO CHECK                    
         ZIC   R1,LNLEV2           CHECK IF 2ND LEVEL ACCOUNT                   
         AR    R3,R1               R3 POINTS TO 3RD LEVEL                       
         SR    RE,R1               RE CONTAINS LENGTH OF 2ND LEVEL              
         BCTR  RE,0                                                             
         EXCLC RE,0(R3),BCSPACES                                                
         BNE   HILEV50             NOT 2ND LEVEL ACCOUNT                        
*                                                                               
HILEV30  L     RF,AIO9                                                          
         CLC   IOKEY(L'ACTKEY),0(RF)   IF ALREADY READ THIS DON'T READ          
         BE    HILEV32                 AGAIN.                                   
         LHI   R1,XOGET+XOACCMST+XIO9   GET 2ND LEVEL RECORD AND                
         GOTO1 AIO                      STORE INTO IO9                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
HILEV32  BRAS  RE,CHKLEV1          MAKE SURE 1ST LEVEL ACCT IS SAVED            
         BE    HILEV40             YES IT'S SAVED                               
*                                                                               
         LA    RF,XIO8             NO IT'S NOT SAVED SO GET THE ACCT            
         STCM  RF,15,MASK          AND STORE INTO AIO8                          
         MVC   BCBYTE1,LNLEV1                                                   
         BRAS  RE,SVLEVLS                                                       
         BNE   HILEVL                                                           
*                                                                               
HILEV40  L     RE,AIOA             CLEAR IO 10                                  
         LHI   RF,2000                                                          
         XCEF                                                                   
         B     HILEV110                                                         
*                                                                               
* 3RD LEVEL                                                                     
HILEV50  LA    R3,IOKEY                                                         
         LA    R3,ACTKACT-ACTKEY(R3)                                            
         ZIC   RE,LNLEV4           CHECK IF 3RD LEVEL IS LOWEST                 
         LTR   RE,RE                                                            
         BZ    HILEV60             YES SO NO NEED TO CHECK                      
         ZIC   R1,LNLEV3           CHECK IF 3RD LEVEL ACCOUNT                   
         AR    R3,R1               R3 POINTS TO 4TH LEVEL                       
         SR    RE,R1               RE CONTAINS LENGTH OF 3RD LEVEL              
         BCTR  RE,0                                                             
         EXCLC RE,0(R3),BCSPACES                                                
         BNE   HILEV80             NOT 3RD LEVEL ACCOUNT                        
*                                                                               
HILEV60  L     RF,AIOA                                                          
         CLC   IOKEY(L'ACTKEY),0(RF)   IF ALREADY READ THIS DON'T READ          
         BE    HILEV62                 AGAIN.                                   
         LHI   R1,XOGET+XOACCMST+XIO10  GET 2ND LEVEL RECORD AND                
         GOTO1 AIO                      STORE INTO IO10                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
HILEV62  BRAS  RE,CHKLEV1          MAKE SURE 1ST LEVEL ACCT IS SAVED            
         BE    HILEV70             YES IT'S SAVED                               
*                                                                               
         LA    RF,XIO8             NO SO READ 1ST LVL AND STORE IN AIO8         
         STCM  RF,15,MASK                                                       
         MVC   BCBYTE1,LNLEV1                                                   
         BRAS  RE,SVLEVLS                                                       
         BNE   HILEVL                                                           
*                                                                               
HILEV70  BRAS  RE,CHKLEV2          MAKE SURE 2ND LEVEL ACCT IS SAVED            
         BE    HILEV110            YES IT'S SAVED                               
*                                                                               
         LA    RF,XIO9             NO SO READ 2ND LVL AND STORE IN AIO9         
         STCM  RF,15,MASK                                                       
         MVC   BCBYTE1,LNLEV2                                                   
         BRAS  RE,SVLEVLS                                                       
         BNE   HILEVL                                                           
         B     HILEV110                                                         
*                                                                               
* 4TH LEVEL                                                                     
HILEV80  DS    0H                                                               
         BRAS  RE,CHKLEV1          MAKE SURE 1ST LEVEL ACCT IS SAVED            
         BE    HILEV90             YES IT'S SAVED                               
*                                                                               
         LA    RF,XIO8             NO SO READ 1ST LVL AND STORE IN AIO8         
         STCM  RF,15,MASK                                                       
         MVC   BCBYTE1,LNLEV1                                                   
         BRAS  RE,SVLEVLS                                                       
         BNE   HILEVL                                                           
*                                                                               
HILEV90  BRAS  RE,CHKLEV2          MAKE SURE 2ND LEVEL ACCT IS SAVED            
         BE    HILEV100            YES IT'S SAVED                               
*                                                                               
         LA    RF,XIO9             NO SO READ 2ND LVL AND STORE IN AIO9         
         STCM  RF,15,MASK                                                       
         MVC   BCBYTE1,LNLEV2                                                   
         BRAS  RE,SVLEVLS                                                       
         BNE   HILEVL                                                           
*                                                                               
HILEV100 BRAS  RE,CHKLEV3          MAKE SURE 3RD LEVEL ACCT IS SAVED            
         BE    HILEV110            YES IT'S SAVED                               
*                                                                               
         LA    RF,XIO10            NO SO READ 3RD LVL & STORE IN AIO10          
         STCM  RF,15,MASK                                                       
         MVC   BCBYTE1,LNLEV3                                                   
         BRAS  RE,SVLEVLS                                                       
         BNE   HILEVL                                                           
*                                                                               
HILEV110 DS    0H                                                               
         MVC   IOKEY,SVKEY                                                      
         B     HILEVE                                                           
*                                                                               
HILEVL   CLI   *,FF                                                             
         B     HILEVX                                                           
HILEVE   CR    RB,RB                                                            
HILEVX   XIT1                                                                   
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* AFTER SAVING THE CURRENT ACCT INTO IT'S RESPECTIVE IO AREA IF IT IS           
* NOT A HIGH LEVEL ACCT THIS ROUTINE GET'S CALLED TO MAKE SURE THAT             
* THE 1ST LEVEL ACCT IS PROPERLY SAVED INTO AIO8                                
* EXIT - EQUAL IF 1ST LEVEL ACCOUNT IS SAVED INTO AIO8                          
*        NOT EQUAL IF 1ST LEVEL ACCOUNT IS NOT SAVED INTO AIO8                  
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3          CURRENT ACCOUNT BEING PROCESSED              
X        USING ACTRECD,RF          HIGHER LEVEL ACCOUNT RECORDS                 
CHKLEV1  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     RF,AIO8             1ST LEVEL IO SAVE AREA                       
         LA    R3,IOKEY            CURRENT ACCOUNT BEING PROCESSED              
         ZIC   R1,LNLEV1                                                        
         BCTR  R1,0                                                             
         EXCLC R1,T.ACTKACT,X.ACTKACT  ARE THE 1ST LEVELS EQUAL?                
         BNE   CHKLV1L             NOT EQUAL                                    
         LA    RF,ACTKACT-ACTKEY(RF)                                            
         ZIC   R1,LNLEV1           EQUAL BUT MAKE SURE IT'S A 1ST               
         AR    RF,R1               LEVEL ACCOUNT THAT'S SAVED INTO              
         ZIC   RE,LNLEV2           THIS AREA                                    
         SR    RE,R1                                                            
         BCTR  RE,0                                                             
         EXCLC RE,0(RF),BCSPACES   IS THERE A 2ND LEVEL HERE?                   
         BE    CHKLV1E             NO SO THIS HIGH LEVEL ACCT IS OKAY           
*                                                                               
CHKLV1L  CLI   *,FF                                                             
         B     CHKLV1X                                                          
CHKLV1E  CR    RB,RB                                                            
CHKLV1X  XIT1                                                                   
         DROP  T,X                                                              
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* AFTER SAVING THE CURRENT ACCT INTO IT'S RESPECTIVE IO AREA IF IT IS           
* NOT A HIGH LEVEL ACCT THIS ROUTINE GET'S CALLED TO MAKE SURE THAT             
* THE 2ND LEVEL ACCT IS PROPERLY SAVED INTO AIO9                                
* EXIT - EQUAL IF 1ST LEVEL ACCOUNT IS SAVED INTO AIO9                          
*        NOT EQUAL IF 1ST LEVEL ACCOUNT IS NOT SAVED INTO AIO9                  
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3          CURRENT ACCOUNT BEING PROCESSED              
X        USING ACTRECD,RF          HIGHER LEVEL ACCOUNT RECORDS                 
CHKLEV2  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     RF,AIO9             2ND LEVEL IO SAVE AREA                       
         LA    R3,IOKEY            CURRENT ACCOUNT BEING PROCESSED              
         ZIC   R1,LNLEV2                                                        
         BCTR  R1,0                                                             
         EXCLC R1,T.ACTKACT,X.ACTKACT  ARE THE 1ST 2 LEVELS EQUAL?              
         BNE   CHKLV2L             NOT EQUAL                                    
         LA    RF,ACTKACT-ACTKEY(RF)                                            
         ZIC   R1,LNLEV2           EQUAL BUT MAKE SURE IT'S A 2ND               
         AR    RF,R1               LEVEL ACCOUNT THAT'S SAVED INTO              
         ZIC   RE,LNLEV3           THIS AREA                                    
         SR    RE,R1                                                            
         BCTR  RE,0                                                             
         EXCLC RE,0(RF),BCSPACES   IS THERE A 2ND LEVEL HERE?                   
         BE    CHKLV2E             NO SO THIS HIGH LEVEL ACCT IS OKAY           
*                                                                               
CHKLV2L  CLI   *,FF                                                             
         B     CHKLV2X                                                          
CHKLV2E  CR    RB,RB                                                            
CHKLV2X  XIT1                                                                   
         DROP  T,X                                                              
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* AFTER SAVING THE CURRENT ACCT INTO IT'S RESPECTIVE IO AREA IF IT IS           
* NOT A HIGH LEVEL ACCT THIS ROUTINE GET'S CALLED TO MAKE SURE THAT             
* THE 3RD LEVEL ACCT IS PROPERLY SAVED INTO AIOA                                
* EXIT - EQUAL IF 1ST LEVEL ACCOUNT IS SAVED INTO AIOA                          
*        NOT EQUAL IF 1ST LEVEL ACCOUNT IS NOT SAVED INTO AIOA                  
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3          CURRENT ACCOUNT BEING PROCESSED              
X        USING ACTRECD,RF          HIGHER LEVEL ACCOUNT RECORDS                 
CHKLEV3  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     RF,AIOA             3RD LEVEL IO SAVE AREA                       
         LA    R3,IOKEY            CURRENT ACCOUNT BEING PROCESSED              
         ZIC   R1,LNLEV3                                                        
         BCTR  R1,0                                                             
         EXCLC R1,T.ACTKACT,X.ACTKACT  ARE THE 1ST THREE LEVELS EQUAL?          
         BNE   CHKLV3L             NOT EQUAL                                    
         LA    RF,ACTKACT-ACTKEY(RF)                                            
         ZIC   R1,LNLEV3           EQUAL BUT MAKE SURE IT'S A 3RD               
         AR    RF,R1               LEVEL ACCOUNT THAT'S SAVED INTO              
         ZIC   RE,LNLEV4           THIS AREA                                    
         SR    RE,R1                                                            
         BCTR  RE,0                                                             
         EXCLC RE,0(RF),BCSPACES   IS THERE A 2ND LEVEL HERE?                   
         BE    CHKLV3E             NO SO THIS HIGH LEVEL ACCT IS OKAY           
*                                                                               
CHKLV3L  CLI   *,FF                                                             
         B     CHKLV3X                                                          
CHKLV3E  CR    RB,RB                                                            
CHKLV3X  XIT1                                                                   
         DROP  T,X                                                              
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* READ HIGHER LEVEL ACCOUNT AND SAVE INTO IO AREA                               
* BCBYTE1 CONTAINS CORRECT LEVEL LENGTH                                         
* MASK CONTAINS THE IO EQUATE TO READ INTO                                      
* XIT - EQUAL IF HIGH LEVEL ACCT                                                
*       LOW IF NOT HIGH LEVEL                                                   
***********************************************************************         
         SPACE 1                                                                
SVLEVLS  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   ACKEYSV,IOKEY                                                    
         LA    R1,SVACCT2                                                       
         MVC   SVACCT2,IOKEY+(ACTKACT-ACTKEY)                                   
         MVC   IOKEY,BCSPACES      IN ORDER TO READ HIGHER LEVEL                
         MVC   IOKEY(ACTKACT-ACTKEY),ACTKEY  C/U/L                              
*        MVC   SVACCT2,ACTKACT                                                  
         ZIC   RE,BCBYTE1                                                       
         LA    R1,SVACCT2(RE)      POINT TO NEXT LOWEST LEVEL                   
         ZIC   RF,LNLEV4                                                        
         CLI   LNLEV4,L'ACTKACT    4 LEVEL LEDGER?                              
         BE    SVLEV110                                                         
         ZIC   RF,LNLEV3                                                        
         CLI   LNLEV3,L'ACTKACT    3 LEVEL LEDGER?                              
         BE    SVLEV110                                                         
         ZIC   RF,LNLEV2                                                        
         CLI   LNLEV2,L'ACTKACT    2 LEVEL LEDGER?                              
         BE    *+6                                                              
         DC    H'0'                SHOULDN'T BE HERE IF 1 LEVEL LEDGER          
SVLEV110 SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXMVC RF,0(R1),BCSPACES   CLEAR OUT ALL LOWER LEVELS                   
         MVC   IOKEY+L'ACTKCPY+L'ACTKUNT+L'ACTKLDG(L'SVACCT2),SVACCT2           
         SR    R1,R1                                                            
         ICM   R1,15,MASK                                                       
         AHI   R1,XOREAD+XOACCDIR                                               
         GOTO1 AIO                                                              
         BNE   SVLEVL              DIDN'T FIND THE RECORD                       
         XC    IODAOVER,IODAOVER   THIS IS SET SOMETIMES!                       
         SR    R1,R1                                                            
         ICM   R1,15,MASK                                                       
         AHI   R1,XOGET+XOACCMST                                                
         GOTO1 AIO                                                              
         BE    SVLEVE                                                           
*                                                                               
SVLEVL   CLI   *,FF                                                             
         B     SVLEVX                                                           
SVLEVE   CR    RB,RB                                                            
SVLEVX   MVC   IOKEY,ACKEYSV                                                    
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF ACCOUNT IS A HIGH LEVEL ACCOUNT (1ST LEVEL)                          
* XIT - EQUAL IF HIGH LEVEL ACCT                                                
*       LOW IF NOT HIGH LEVEL                                                   
***********************************************************************         
         SPACE 1                                                                
HIGHACC  NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         LA    R3,ACTKACT-ACTRECD(R3)                                           
         CLI   LNLEV1,L'ACTKACT    ONE LEVEL LEDGER?                            
         BE    HIACCE              THAN ALWAYS HIGH LEVEL                       
         ZIC   R1,LNLEV1                                                        
         AR    R3,R1               R3 POINTS TO 2ND LEVEL OF ACCOUNT            
         ZIC   RE,LNLEV2                                                        
         SR    RE,R1               RE CONTAINTS LENGTH OF 2ND LEVEL             
         BCTR  RE,0                                                             
         EXCLC RE,0(R3),BCSPACES                                                
         BE    HIACCE                                                           
*                                                                               
HIACCL   CLI   *,FF                                                             
         B     HIACCX                                                           
HIACCE   CR    RB,RB                                                            
HIACCX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF 1R ACCOUNT ENTERED IS OFFICE LEVEL                         *         
* R3 POINTS TO THE ACCOUNT ENTERED                                              
***********************************************************************         
         SPACE 1                                                                
ANL1R    NTR1  BASE=*,LABEL=*                                                   
         LR    RF,R3                   THE OFFICE LEVEL                         
         LA    RF,ACTKACT-ACTKEY(RF)                                            
         ZIC   R1,LNLEV1                                                        
         AR    RF,R1                   POINT RF TO DEPT LEVEL                   
         ZIC   RE,LNLEV2                                                        
         SR    RE,R1                                                            
         BCTR  RE,0                    RE CONTAINS LENGTH OF DEP LVL            
         EXCLC RE,0(RF),BCSPACES                                                
         BNE   ANL1RE                                                           
*                                                                               
ANL1RL   CLI   *,FF                                                             
         B     ANL1RX                                                           
ANL1RE   CR    RB,RB                                                            
ANL1RX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* FOR THE REQUIRED ENTRY LEVEL PROFILE (1R) CHECK TO MAKE SURE ANY    *         
* HIGHER LEVEL 1R ACCOUNTS DO NOT HAVE A MORE SPECIFIC SETTING THAN   *         
* PRODUCT.                                                            *         
* THE MOST WE WILL HAVE TO CHECK IS THE 1ST TWO LEVELS SINCE THIS PROF*         
* CANNOT BE SET AT THE LOWEST LEVEL IN =AFM                           *         
***********************************************************************         
         SPACE 1                                                                
TSLHIGH  NTR1  BASE=*,LABEL=*                                                   
         LA    R4,2                                                             
         LA    R1,ACTKACT                                                       
         ZIC   RF,LNLEV3                                                        
         LTR   RF,RF                                                            
         BZ    TSLHI10                                                          
         ZIC   RE,LNLEV2                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   TSLHI20             3RD LVL ENTERED-CHK 1ST 2 LEVELS             
*                                                                               
TSLHI10  LA    R4,1                                                             
         LA    R1,ACTKACT                                                       
         ZIC   RF,LNLEV2                                                        
         LTR   RF,RF               ONE LEVEL LEDGER-NO NEED TO CHECK            
         BZ    TSLHIE                                                           
         ZIC   RE,LNLEV1                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BE    TSLHIE              1ST LEVEL ENTERED-NO NEED TO CHECK           
*                                                                               
T        USING ACTRECD,R3                                                       
TSLHI20  LA    R3,IOKEY               *SETTING UP READ FOR 1ST LEVEL            
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY(ACTKACT-ACTKEY),ACTKEY                                 
         ZIC   R1,LNLEV1           R1=LENGTH OF 1ST LEVEL                       
         BCTR  R1,0                                                             
         LA    RF,ACTKACT                                                       
         EXMVC R1,T.ACTKACT,0(RF)     MOVE IN 1ST LEVEL                         
         B     TSLHI40                GO READ FOR ACCOUNT                       
*                                                                               
TSLHI30  MVC   T.ACTKEY,BCSPACES      *SETTING UP READ FOR 2ND LEVEL            
         MVC   T.ACTKCPY(ACTKACT-ACTKEY),ACTKEY                                 
         ZIC   R1,LNLEV2           R2=LENGTH OF COMBINED 1ST & 2ND LVLS         
         BCTR  R1,0                                                             
         LA    RF,ACTKACT                                                       
         EXMVC R1,T.ACTKACT,0(RF)     MOVE IN 1ST AND 2ND LEVEL                 
*                                                                               
TSLHI40  LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',AIO2),0                  
         CLI   12(R1),0                                                         
         BNE   TSLHI50                                                          
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q       IF NOT THE LONGEST ELEM                      
         BL    *+12                THAN NOTHING TO CHECK                        
         TM    RSTSTAT5,RSTSPRJB   THE JOB BIT SHOULDN'T BE ON                  
         BO    TSLHIL                                                           
TSLHI50  BCT   R4,TSLHI30                                                       
         B     TSLHIE                                                           
*                                                                               
TSLHIL   CLI   *,FF                                                             
         B     TSLHIX                                                           
TSLHIE   CR    RB,RB                                                            
TSLHIX   XIT1                                                                   
         DROP  T,RF                                                             
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK THE FILTER FIELD FOR INVALID SPECIAL CHARACTERS               *         
* ONLY 1 BYTE FILTERS FOR NOW SO ONLY NEED TO CHECK FIRST BYTE.       *         
***********************************************************************         
         SPACE 1                                                                
CHKFLTVL NTR1  BASE=*,LABEL=*                                                   
         CLI   FVIFLD,C'<'                                                      
         BE    CHKFLTL                                                          
         CLI   FVIFLD,C'>'                                                      
         BE    CHKFLTL                                                          
         CLI   FVIFLD,C'*'                                                      
         BE    CHKFLTL                                                          
         CLI   FVIFLD,C'='                                                      
         BE    CHKFLTL                                                          
         CLI   FVIFLD,C'?'                                                      
         BE    CHKFLTL                                                          
         CLI   FVIFLD,C'.'                                                      
         BNE   CHKFLTE                                                          
*                                                                               
CHKFLTL  CLI   *,FF                                                             
         B     CHKFLTX                                                          
CHKFLTE  CR    RB,RB                                                            
CHKFLTX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        VALIDATE SE EXPENSE ANALYSIS ACCOUNT AGAINST 13                        
*        MAKE SURE USER ENTERS THE LENGTH OF 1ST LEVEL                          
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
VSEANAL  NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'13'                            
         GOTO1 AGETLDG                                                          
         BNE   VSEANLL                                                          
*                                                                               
         ICM   RE,15,ACALDG                                                     
         USING LDGTABD,RE                                                       
         CLI   LDGTLVA,L'ACTKACT   ONE LEVEL LEDGER?                            
         BE    VSEANLE             YES THAN CAN'T VALIDATE                      
         ZIC   R1,LDGTLVA          LENGTH OF 1ST LEVEL                          
         ZIC   RF,FVILEN           LENGTH USER ENTERED                          
         CR    RF,R1               THEY MUST BE THE SAME                        
         BNE   VSEANLL                                                          
*                                                                               
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'13'                            
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,T.ACTKACT,FVIFLD      MOVE IN CODE TO VALIDATE                
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BNE   VSEANLL                  NOT A VALID 13 ACCOUNT                  
*                                                                               
         LHI   R1,XOREAD+XOACCDIR+XIO1      RE-READ KEY                         
         GOTO1 AIO                                                              
         B     VSEANLE                                                          
*                                                                               
VSEANLL  CLI   *,FF                                                             
         B     VSEANLX                                                          
VSEANLE  CR    RB,RB                                                            
VSEANLX  XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* VALIDATE SI BILLING/REVENUE ANALYSIS ACCT AGAINST 11/12                       
* MAKE SURE USER ENTERS A LOW LEVEL ACCOUNT                                     
* IF ANY ERRORS LEAVE WITH ERROR MESSAGE SET                                    
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
VSIANAL  NTR1  BASE=*,LABEL=*                                                   
         NI    BYTE2,X'FF'-VAL12                                                
VSIANL5  LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'11'                            
         TM    BYTE2,VAL12           VALIDATING 12 LEDGER?                      
         BZ    *+10                                                             
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'12'                            
         GOTO1 AGETLDG                                                          
         BE    *+14                                                             
         MVC   FVMSGNO,=AL2(FVFNOTV)                                            
         B     VSIANLL                                                          
*                                                                               
         ICM   RE,15,ACALDG        MAKE SURE USER ENTERED LOW LVL ACCT          
         USING LDGTABD,RE                                                       
         ZIC   R1,FVILEN           R1 CONTAINS LENGTH OF INPUT                  
         CLI   LDGTLVA,L'ACTKACT   ONE LEVEL LEDGER?                            
         BE    VSIANL25            THEN ALWAYS AT THE LOWEST LEVEL              
         ZIC   RF,LDGTLVC          IF 4 LEVEL LEDGER MUST CHECK                 
         CLI   LDGTLVD,0           3RD LEVEL                                    
         BNE   VSIANL20                                                         
         ZIC   RF,LDGTLVB          IF 3 LEVEL LEDGER MUST CHECK                 
         CLI   LDGTLVC,0           2ND LEVEL                                    
         BNE   VSIANL20                                                         
         ZIC   RF,LDGTLVA          CAN ASSUME A 2 LEVEL LEDGER                  
VSIANL20 CR    R1,RF               DID USER ENTER A LOW LEVEL ACCT?             
         BH    *+14                YES                                          
         MVC   FVMSGNO,=AL2(AE$NLOWA)  MUST BE A LOW LEVEL ACCT                 
         B     VSIANLL                                                          
*                                                                               
VSIANL25 LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'11'                            
         TM    BYTE2,VAL12                                                      
         BZ    *+10                                                             
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'12'                            
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,T.ACTKACT,FVIFLD      MOVE IN CODE TO VALIDATE                
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                      IF NOT FOUND UNDER 11 LEDGER            
         BE    VSIANL30                 CHECK FOR 12 LEDGER                     
         CLC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'12'                            
         BE    VSIANL40                                                         
         OI    BYTE2,VAL12                                                      
         B     VSIANL5                                                          
*                                                                               
VSIANL30 LHI   R1,XOREAD+XOACCDIR+XIO1      RE-READ KEY                         
         GOTO1 AIO                                                              
         B     VSIANLE                                                          
*                                                                               
VSIANL40 MVC   FVMSGNO,=AL2(AE$INACC)       INVALID ACCOUNT                     
         MVC   FVXTRA(L'ACTKUNT+L'ACTKLDG),=C'11'                               
         ZIC   R1,FVXLEN                                                        
         EXMVC R1,FVXTRA+2,FVIFLD                                               
         TM    BYTE2,VAL12                                                      
         BZ    VSIANLL                                                          
         MVC   FVXTRA(L'ACTKUNT+L'ACTKLDG),=C'12'                               
*                                                                               
VSIANLL  CLI   *,FF                                                             
         B     VSIANLX                                                          
VSIANLE  CR    RB,RB                                                            
VSIANLX  XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        VALIDATE 1R DIRECT LABOR ACCOUNT AGAINST 14                            
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
V1RANAL  NTR1  BASE=*,LABEL=*                                                   
         LA    R3,IOKEY                                                         
         MVC   T.ACTKEY,BCSPACES                                                
         MVC   T.ACTKCPY,CUABIN                                                 
         MVC   T.ACTKUNT(L'ACTKUNT+L'ACTKLDG),=C'14'                            
         MVC   T.ACTKACT(1),FVIFLD MOVE IN CODE TO VALIDATE                     
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BNE   V1RANLL                  NOT A VALID 14 ACCOUNT                  
*                                                                               
         LHI   R1,XOREAD+XOACCDIR+XIO1      RE-READ KEY                         
         GOTO1 AIO                                                              
         B     V1RANLE                                                          
*                                                                               
V1RANLL  CLI   *,FF                                                             
         B     V1RANLX                                                          
V1RANLE  CR    RB,RB                                                            
V1RANLX  XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* EDIT COLUMN FOR LIST/REPORT/DOWNLOAD.  SHOW ACCOUNT EQUIVALENCY NAME          
* #1 AS A COLUMN HEADING IF IT EXISTS.                                          
* ENTRY:  CODESEQ CONTAINS THE SEQUENCE NUMBER TO READ FOR                      
* EXIT:   SVPARMS5 CONTAINS THE 1ST HEADLINE                                    
*         SVPARMS6 CONTAINS THE 2ND HEADLINE (AN UNDERLINE)                     
*         BCBYTE1 CONTAINS THE LENGTH OF THE 1ST HEADLINE                       
***********************************************************************         
         SPACE 1                                                                
HEDCD    NTR1  BASE=*,LABEL=*                                                   
         OC    SVUNT,SVUNT         IF NOTHING IS SET HERE THAN USER HAS         
         BNZ   *+10                NOT ENTERED U/L YET                          
         MVC   SVUNT,GSRECKEY+1   MOVE IN UNIT AND LEDGER FROM KEY              
*                                                                               
         OI    BYTE,EDTCOL          SET BIT SO GETS UL FROM RIGHT PLACE         
         BRAS  RE,EQSET                                                         
         TM    BYTE,EQURULE         DOES THIS LEDGER ALLOW EQU CODES?           
         BZ    HEDCDX              NO -  THAN LEAVE HEADINGS AS IS              
*                                                                               
*        MVI   CODESEQ,0           CODE 1 GETS SEQUENCE NUMBER 0                
         BRAS  RE,GETCDNM          GET THE CODE NAME                            
         NI    BYTE,X'FF'-EDTCOL                                                
         CLC   BLOCK,BCSPACES      ANY EQU NAME?                                
         BE    HEDCDX              NO - SHOW DEFAULT HEADLINES                  
*                                                                               
         L     R1,SVPARMS5         1ST HEADLINE                                 
         XC    0(20,R1),0(R1)      CLEAR HEADING FIRST                          
         ZIC   RF,NAMLEN           ACTUAL LENGTH OF ACCT EQU NAME               
         STC   RF,BCBYTE1                                                       
         BCTR  RF,0                                                             
         EXMVC RF,0(R1),BLOCK      MOVE IN NEW HEADLINE                         
         L     R1,SVPARMS6         2ND HEADLINE (UNDERSCORE)                    
         XC    0(20,R1),0(R1)                                                   
         MVI   0(R1),C'-'                                                       
         BCTR  RF,0                                                             
         EXMVC RF,1(R1),0(R1)                                                   
HEDCDX   XIT1                                                                   
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* THIS ROUTINE IS TO SEE IF THE LEDGER IS SETUP TO USE THESE CODES              
* AND TO BUILD A TABLE OF THE ACCT NAMES AND RULES.                             
***********************************************************************         
         SPACE 1                                                                
         USING LDGRECD,R3                                                       
EQSET    NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         LA    R0,EQRULTAB         CLEAR RULES TABLE                            
         L     R1,=A(EQRULEND-EQRULTAB)                                         
         LR    RE,R0                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         LA    RF,EQRULTAB         POINT RF TO RULE TABLE                       
         ST    RF,SVEQADDR                                                      
         XC    EQRULTAB,EQRULTAB   CLEAR TABLE                                  
         NI    BYTE,X'FF'-EQURULE                                               
*                                                                               
* AIO6 HOLDS THE LEDGER RECORD UNLESS YOU JUST CAME BACK FROM THE               
* COLUMN/LIST SCREEN OR THE FILTER/LIST SCREEN.  IN THAT CASE YOU NEED          
* TO READ THE LEDGER RECORD AGAIN.                                              
         L     R3,AIO6                                                          
         CLC   LDGKUNT(L'LDGKUNT+L'LDGKLDG),GSRECKEY+1                          
         BE    *+8                                                              
         BRAS  RE,RDLDG                                                         
*                                                                               
         LA    R4,LDGRECD+(LDGRFST-LDGRECD)                                     
EQSET10  CLI   0(R4),0                                                          
         BE    EQSETXX                                                          
         CLI   0(R4),X'CA'         CA ACCOUNT EQUIVALENT RULE ELEM              
         BE    EQSET30                                                          
EQSET20  ZIC   R1,1(R4)                                                         
         AR    R4,R1                                                            
         B     EQSET10                                                          
*                                                                               
* BUILD TABLE TO ACCOUNT EQUIVALENT NAMES AND RULES                             
*                                                                               
         USING EQRULTBD,RF                                                      
         USING APRELD,R4                                                        
EQSET30  OI    BYTE,EQURULE         SET BIT THAT RULES SET UP                   
         L     RF,SVEQADDR         POINT TO SAVED TABLE ADDR                    
         MVC   EQRLSEQ,APRSEQ      SEQUENCE NUMBER OF RULE                      
         MVC   EQRLLEN,APRTLEN     TOTAL LENGTH OF RULE                         
         MVC   EQRLNLVS,APRNLEVS   NUMBER OF LEVELS                             
         MVC   EQRLNAME,APRDESC    ACCT EQU NAME                                
         LA    R1,L'APRDESC        ACCT EQU NAME MAX IS 10                      
         LA    R2,APRDESC+L'APRDESC-1  PT TO LAST POSSIBLE CHAR OF NAME         
EQSET40  CLI   0(R2),C' '                                                       
         BNE   EQSET50                                                          
         BCTR  R1,0                                                             
         BCTR  R2,0                                                             
         B     EQSET40                                                          
*                                                                               
EQSET50  STC   R1,EQNMLEN          LENGTH OF ACCT EQU NAME                      
         LA    R1,EQRLRULE         R1 = RULE IN TABLE                           
         ZIC   R0,APRNLEVS         R0 = NUMBER OF LEVELS OF RULE                
         ZIC   R2,APRTLEN          R2 = TOTAL LENGTH OF RULES                   
         AR    R2,R0               R2 = TOTAL LENGTH OF LENGTHS & RULES         
         LA    RE,APRMLEN          RE = FIRST LENGTH AND RULE                   
         BCTR  R2,0                                                             
         EXMVC R2,0(R1),0(RE)      SAVE LENGTH AND RULE TO TABLE                
         LA    RF,EQRLLNQ(RF)      BUMP TO NEXT TABLE ENTRY                     
         ST    RF,SVEQADDR         SAVE ADDRESS OF NEXT TABLE ENTRY             
         B     EQSET20             CHECK FOR ANY MORE ELEMENTS                  
*                                                                               
EQSETXX  XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO GET ACC EQUIVALENCY CODE NAME FROM SAVED TABLE           *         
* NTRY - CODESEQ CONTAINS THE SEQUENCE NUMBER WE ARE READING FOR      *         
* EXIT - FVIFLD CONTAINS NAME OR SPACES IN NO RULE FOUND              *         
***********************************************************************         
         SPACE 1                                                                
         USING EQRULTBD,RF                                                      
GETCDNM  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         MVC   BLOCK,BCSPACES                                                   
         LA    RF,EQRULTAB                                                      
GETCD10  LA    RE,EQRULEND                                                      
         CR    RF,RE               REACHED END OF TABLE?                        
         BNL   GETCD30             YES SO CLEAR FIELD AND EXIT                  
         CLC   CODESEQ,EQRLSEQ     MATCH ON SEQUENCE NUMBER?                    
         BE    GETCD20                                                          
         LA    RF,EQRLLNQ(RF)      BUMP TO NEXT ENTRY                           
         B     GETCD10                                                          
*                                                                               
GETCD20  MVC   NAMLEN,EQNMLEN      ACCOUNT EQU NAME LENGTH                      
         TM    GENINDS,GENIREP+GENIDLD  IF A REPORT OR DOWNLOAD                 
         BO    *+12                     SAVE THE NAME INTO 'BLOCK'              
         TM    BYTE,EDTCOL                                                      
         BZ    GETCD22                                                          
         MVC   BLOCK(L'EQRLNAME),EQRLNAME                                       
         OC    BLOCK,BCSPACES                                                   
         B     GETCDX                                                           
GETCD22  MVC   FVIFLD(L'EQRLNAME),EQRLNAME                                      
         OC    FVIFLD,BCSPACES                                                  
         B     GETCDX                                                           
*                                                                               
GETCD30  TM    GENINDS,GENIREP+GENIDLD  IF A REPORT OR DOWNLOAD                 
         BO    *+12                     SAVE THE NAME INTO 'BLOCK'              
         TM    BYTE,EDTCOL                                                      
         BZ    GETCD32                                                          
         MVC   BLOCK,BCSPACES                                                   
         B     GETCDX                                                           
GETCD32  MVC   FVIFLD,BCSPACES                                                  
         B     GETCDX                                                           
*                                                                               
GETCDX   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK ACCOUNT EQUIVALENCY CODE AGAINST RULES FROM LEDGER RECORD               
* NTRY - ACC EQU CODE IN FVIFLD                                                 
*        CODESEQ CONTAINS SEQUENCE NUMBER WANTED                                
***********************************************************************         
         SPACE 1                                                                
         USING EQRULTBD,RF                                                      
CHKRULE  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         LA    RF,EQRULTAB         R4 = EQU RULE TABLE FROM LEDGER              
         LA    RE,EQRULEND                                                      
CHKRU10  CR    RF,RE                                                            
         BL    *+14                                                             
         MVC   FVMSGNO,=AL2(AE$TODAL) NO INPUT ALLOWED                          
         B     CHKRULL                                                          
         CLC   CODESEQ,EQRLSEQ     SAME SEQUENCE NUMBER?                        
         BE    CHKRU20                                                          
         LA    RF,EQRLLNQ(RF)                                                   
         B     CHKRU10                                                          
*                                                                               
CHKRU20  ZIC   R0,EQRLLEN          R0 = LENGTH OF RULE                          
         ZIC   R1,FVILEN           R1 = LENGTH USER ENTERED                     
         MVC   FVMSGNO,=AL2(AE$FLDTS)                                           
         CR    R1,R0                                                            
         BL    CHKRULL             INPUT LENGTH TOO SHORT                       
         MVC   FVMSGNO,=AL2(AE$FLDTL)                                           
         CR    R1,R0                                                            
         BH    CHKRULL             INPUT LENGTH TOO LONG                        
*                                                                               
         LA    R2,FVIFLD           R2 POINTS TO CODE ENTERED                    
         LA    R4,EQRLRULE         POINT TO LENGTH OF FIRST LEVEL               
         MVI   BCBYTE1,0                                                        
         ZIC   R1,EQRLNLVS         TOTAL NUMBER OF LEVEL                        
CHKRU30  DS    0H                                                               
         STC   R1,NLEVS            TOTAL LEVELS LEFT,OUTER LOOP CNTR            
         ZIC   RF,0(R4)            DON'T SCREW UP RF IT IS A LOOP CNTR          
         LA    R3,1(R4)            POINT TO FIRST CHARACTER OF RULE             
*                                                                               
CHKRU40  DS    0H                                                               
         ZIC   R1,BCBYTE1          POSITION OF CHARACTER COUNTER                
         AHI   R1,1                                                             
         STC   R1,BCBYTE1                                                       
         CLI   0(R3),X'83'         IS IT LOWER CASE 'C'                         
         BE    CHKRU50             SKIP CHCKNG FOR LOWER 'A' AND '#'            
         CLI   0(R3),X'81'         IS IT LOWER CASE 'A'                         
         BNE   CHKRU60             CHECK FOR NUMBER SIGN                        
CHKRU50  CLI   0(R2),C'A'                                                       
         BL    CHKRUERR                                                         
         CLI   0(R2),C'I'                                                       
         BNH   CHKRU90                                                          
         CLI   0(R2),C'J'                                                       
         BL    CHKRUERR                                                         
         CLI   0(R2),C'R'                                                       
         BNH   CHKRU90                                                          
         CLI   0(R2),C'S'                                                       
         BL    CHKRUERR                                                         
         CLI   0(R2),C'Z'                                                       
         BNH   CHKRU90                                                          
         CLI   0(R3),X'83'         IF ALPHANUMERIC THEN CHECK FOR NUM           
         BE    CHKRU70                                                          
CHKRU60  CLI   0(R3),C'#'                                                       
         BNE   CHKRU80                                                          
CHKRU70  CLI   0(R2),X'F0'         IS IT BETWEEN 0 AND 9                        
         BL    CHKRUERR                                                         
         CLI   0(R2),X'F9'                                                      
         BH    CHKRUERR                                                         
         B     CHKRU90                                                          
CHKRU80  CLC   0(1,R3),0(R2)       HAS TO BE A CONSTANT                         
         BNE   CHKRUERR                                                         
CHKRU90  LA    R2,1(R2)            BUMP ACCOUNT BY 1 CHARACTER                  
         LA    R3,1(R3)            BUMP RULE BY 1 CHARACTER                     
         BCT   RF,CHKRU40                                                       
*                                                                               
         ZIC   R3,0(R4)                                                         
         AHI   R3,1                ADD OVERHEAD                                 
         AR    R4,R3                                                            
         ZIC   R1,NLEVS            GET HOW MANY MORE LEVELS LEFT                
         BCT   R1,CHKRU30          GET NEXT RULE ELEMENT                        
         B     CHKRULEE                                                         
*                                                                               
CHKRUERR DS    0H                  SET POSITION OF WHICH BYTE IS ERROR          
         EDIT  BCBYTE1,(2,FVXTRA),ALIGN=LEFT,FILL=0,WRK=BOWORK1,       +        
               DUB=BODUB1                                                       
*                                                                               
         CLI   0(R3),X'83'         NOT ALPHANUMERIC ERROR                       
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ALNUM)                                           
         B     CHKRULL                                                          
*                                                                               
         CLI   0(R3),X'81'         NOT AN ALPHABET ERROR                        
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$ALPHA)                                           
         B     CHKRULL                                                          
*                                                                               
         CLI   0(R3),C'#'          NOT NUMERIC ERROR                            
         BNE   *+14                                                             
         MVC   FVMSGNO,=AL2(AE$NUMER)                                           
         B     CHKRULL                                                          
*                                                                               
         MVC   FVMSGNO,=AL2(AE$NCONS)  NOT A VALID CONSTANT ERROR               
*                                                                               
CHKRULL  CLI   *,FF                                                             
         B     CHKRULX                                                          
CHKRULEE CR    RB,RB                                                            
CHKRULX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* BUILD DB ELEMENT FOR ACCOUNT EQUIVALENT CODES                                 
* NTRY - VALIDATED ACC EQU CODE IN FVIFLD                                       
*        CODESEQ CONTAINS SEQUENCE NUMBER WANTED                                
***********************************************************************         
         SPACE 1                                                                
BLDEQUS  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         GOTO1 ABLDFFT,BOPARM,ACTRECD,(CODESEQ,FFTTEPTR)                        
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK SECURITY TO SEE IF SHOULD PROTECT, BUT FIRST IF 1R CHECK TO             
* SEE WHAT LVL ACCOUNT THE USER ENTERED.  IF LAST LEVEL THAN PROTECT            
* EVEN IF USER HAS FULL ACCESS.                                                 
* SBYTE CONTAINS THE FIELD SECURITY LEVEL TO CHECK                              
* ON EXIT:                                                                      
* EQUAL - WRITE ACCESS / LOW - READ ACCESS / HIGH - NO ACCESS                   
***********************************************************************         
         SPACE 1                                                                
CHKSEC   NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         MVI   BCBYTE1,C'N'        NOT A LOW LEVEL 1R ACCOUNT                   
         TM    BYTE,CHK1R           DO CHECK FOR 1R?                            
         BZ    CHKSEC20            NO                                           
         LA    R1,4                ASSUME 4 LEVEL LEDGER                        
         CLI   LNLEV4,L'ACTKACT    4 LEVEL LEDGER?                              
         BE    CHKSEC10                                                         
         LA    R1,3                                                             
         CLI   LNLEV3,L'ACTKACT    3 LEVEL LEDGER?                              
         BE    CHKSEC10                                                         
         LA    R1,2                                                             
         CLI   LNLEV2,L'ACTKACT    2 LEVEL LEDGER?                              
         BE    CHKSEC10                                                         
         LA    R1,1                                                             
CHKSEC10 ZIC   RE,LEVELN           RE HAS ACTUAL LEVEL ENTERED                  
         CR    R1,RE               IF MATCH THAT MEANS THEY ENTERED             
         BH    CHKSEC20            THE LOWEST LEVEL SO CAN'T GIVE               
         MVI   BCBYTE1,C'Y'        ACCESS TO                                    
*                                                                               
CHKSEC20 LA    R2,SBYTE                                                         
         GOTO1 VSECRET,BODMCB,('SECPFLDP',ASECBLK),(R2)                         
         CLI   BODMCB,SECPYES       WRITE ACCESS?                               
         BNE   CHKSEC30                                                         
         CLI   BCBYTE1,C'Y'         IF LOW LEVEL 1R PROTECT EVEN THOUGH         
         BE    CHKSECL              THEY HAVE WRITE ACCESS                      
         B     CHKSECE                                                          
*                                                                               
CHKSEC30 CLI   BODMCB,SECPREAD                                                  
         BE    CHKSECL                                                          
         CLI   CSACT,A#LST         FOR LIST/REPORT/DOWNLOAD ACTIONS-            
         BE    CHKSEC50            CLEAR THE FIELD SINCE THE ZERO               
         CLI   CSACT,A#REPT        INTENSITY IS NOT HONORED ON THE LIST         
         BE    CHKSEC50            SCREEN                                       
         CLI   CSACT,A#DLOAD                                                    
         BNE   CHKSECH                                                          
*                                                                               
CHKSEC50 MVC   FVIFLD,BCSPACES                                                  
*                                                                               
*                                                                               
CHKSECH  MVC   SVLEVEL,BCSPACES                                                 
         OI    FVATRB,FVAZERO+FVAPROT NO ACCESS-HIDE FIELD & PROTECT            
         CLI   *,0                 SET CC HIGH                                  
         B     CHKSECX                                                          
CHKSECL  OI    FVATRB,FVAPROT      READ ACCESS-PROTECT FIELD                    
         CLI   *,FF                SET CC LOW                                   
         B     CHKSECX                                                          
CHKSECE  CR    RB,RB               SET CC EQUAL                                 
CHKSECX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* THIS ROUTINE HANDLES THE LOOKUP FOR THE DISPLAYING OF PROFILES ON             
* PAGE 2 AND THE LIST SCREEN                                                    
* NTRY - SVLEVS = # OF LEVELS LEFT TO CHECK                                     
* XIT  - IO2 POINTS TO HIGHER LEVEL ACCOUNT RECORD                              
***********************************************************************         
         SPACE 1                                                                
FINDPRF  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         MVI   SVLEVS,X'FF'        SVLEVS=FF TO INDICATE 1ST TIME               
FINDP10  TM    GENINDS,GENIREP+GENIDLD     DOING A REPORT?                      
         BZ    *+12                                                             
         BRAS  RE,FILTLEV          YES THAN ALREADY READ ALL THE LVLS           
         B     FINDP12             IN LIST ROUTINE (HIGHLEV)                    
*                                                                               
         BRAS  RE,READLEV                                                       
         BL    FINDP35                                                          
         USING RTNTABD,R3                                                       
FINDP12  LA    R3,RTNTAB           R1 POINTS TO TABLE OF ROUTINES               
FINDP15  CLI   0(R3),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
         L     R1,SVPARMS2                                                      
         CLM   R1,3,RTNFLD         SAME FIELD NUMBER?                           
         BE    FINDP20                                                          
FINDP17  LA    R3,RTN1LNQ(R3)                                                   
         B     FINDP15                                                          
*                                                                               
FINDP20  SR    RF,RF                                                            
         L     RF,RTNRTNE                                                       
         A     RF,BORELO                                                        
         BASR  RE,RF                                                            
*                                                                               
         BL    FINDP30                                                          
         CLI   PROFLV,1            CHECK IF PROFILE IS COMING FROM LEV          
         BNE   *+12                THAT USER ENTERED OR A HIGHER LEVEL          
         OI    LEVELBIT,ACCTLV                                                  
         B     FINDPX                                                           
         OI    LEVELBIT,HIGHLV                                                  
         B     FINDPX                                                           
FINDP30  OC    RTNRTNE2,RTNRTNE2   IS THERE A 2ND ROUTINE?                      
         BZ    FINDP35                                                          
         SR    RF,RF                                                            
         L     RF,RTNRTNE2                                                      
         A     RF,BORELO                                                        
         BASR  RE,RF                                                            
         BL    FINDP35                                                          
         OI    LEVELBIT,HIGHLV     YES                                          
         B     FINDPX                                                           
*                                                                               
FINDP35  ZIC   RF,SVLEVS                                                        
         BCTR  RF,0                                                             
         STC   RF,SVLEVS                                                        
         LTR   RF,RF               ANY MORE LEVELS TO CHECK?                    
         BP    FINDP10             YES                                          
*                                                                               
FINDPX   XIT1                                                                   
         DROP  R3                                                               
*                                                                               
RTNTAB   DS    0F                                                               
         DC    AL2(ACC#CSTNG),AL2(0),AL4(COS2),AL4(0)         COST=             
* ANALYSIS= FOR SE                                                              
         DC    AL2(ACC#ANALSE),AL2(0),AL4(ANALY30),AL4(ANALY2C)                 
* ANALYSIS= FOR 1R                                                              
         DC    AL2(ACC#ANAL1R),AL2(0),AL4(ANALY30),AL4(0)                       
         DC    AL2(ACC#GACC),AL2(0),AL4(GEN2),AL4(0)          GENERAL=          
         DC    AL2(ACC#TMSLV),AL2(0),AL4(TSLEV2),AL4(0)       T/S=P/J           
         DC    AL2(ACC#TASK),AL2(0),AL4(TASKC2),AL4(0)        TASK=             
         DC    AL2(ACC#OIN),AL2(0),AL4(CHKOIN),AL4(0)         OIN=              
         DC    AL2(ACC#OWO),AL2(0),AL4(CHKOWO),AL4(0)         OWO=              
         DC    AL2(ACC#CLTYP),AL2(0),AL4(CTYP2),AL4(0)                          
         DC    AL2(ACC#RECV),AL2(0),AL4(RECV2),AL4(0)         RECV=             
         DC    AL2(ACC#COST1C),AL2(0),AL4(CO1C2),AL4(0)       COST=UN 3         
         DC    AL2(ACC#COMM),AL2(0),AL4(COMM2),AL4(0)         COMM=             
         DC    AL2(ACC#DUEF),AL2(0),AL4(DUEF2),AL4(0)         DUE DATE          
         DC    AL2(ACC#EQCD1),AL2(0),AL4(GETQCD),AL4(0)       EQU CD 1          
         DC    AL2(ACC#EQCD2),AL2(0),AL4(GETQCD),AL4(0)       EQU CD 2          
         DC    AL2(ACC#EQCD3),AL2(0),AL4(GETQCD),AL4(0)       EQU CD 3          
         DC    AL2(ACC#EQCD4),AL2(0),AL4(GETQCD),AL4(0)       EQU CD 4          
         DC    AL2(ACC#EQCD5),AL2(0),AL4(GETQCD),AL4(0)       EQU CD 5          
         DC    AL2(ACC#FLT1),AL2(0),AL4(GETFLT),AL4(0)        F1                
         DC    AL2(ACC#FLT2),AL2(0),AL4(GETFLT),AL4(0)        F2                
         DC    AL2(ACC#FLT3),AL2(0),AL4(GETFLT),AL4(0)        F3                
         DC    AL2(ACC#FLT4),AL2(0),AL4(GETFLT),AL4(0)        F4                
         DC    AL2(ACC#FLT5),AL2(0),AL4(GETFLT),AL4(0)        F5                
         DC    AL2(ACC#RVSGN),AL2(0),AL4(RVSGN2),AL4(0)       RV CR SGN         
         DC    X'00'                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF ANALYSIS= PROFILE IS SET IN 30 ELEM ON CURRENT LEVEL ACCT            
* OR A HIGHER LEVEL                                                             
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
ANALY30  NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         CLC   =C'1R',ACTKUNT      FOR 1R DO NOT READ THE OFFICE LEVEL          
         BNE   AN3010                                                           
         BRAS  RE,ANL1R                                                         
         BNE   AN30L                                                            
*                                                                               
AN3010   GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   AN30L                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTCOSTG,C' '       ANY ANALYSIS?                                
         BE    AN30L               NO                                           
         CLI   RSTCOSTG,X'00'      ANY ANALYSIS?                                
         BE    AN30L                                                            
         MVC   FVIFLD(L'RSTCOSTG),RSTCOSTG                                      
         B     AN30E                                                            
*                                                                               
AN30L    CLI   *,FF                                                             
         B     AN30X                                                            
AN30E    CR    RB,RB                                                            
AN30X    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF ANALYSIS= PROFILE IS SET IN 2C ELEM ON CURRENT LEVEL ACCT            
* OR A HIGHER LEVEL                                                             
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
ANALY2C  NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',(R3)),          *        
               (L'SPATYPE,=AL1(SPATANAL))                                       
         CLI   12(R1),0                                                         
         BNE   AN2CL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         MVC   FVIFLD(L'SPAAANAL),SPAAANAL                                      
         B     AN2CE                                                            
*                                                                               
AN2CL    CLI   *,FF                                                             
         B     AN2CX                                                            
AN2CE    CR    RB,RB                                                            
AN2CX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF GENERAL= PROFILE IS SET AT THE CURRENT LEVEL OR A HIGHER             
* LEVEL ACCOUNT                                                                 
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
T        USING GLPELD,RF                                                        
GEN2     NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('GLPELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   GENL                                                             
*                                                                               
         L     RF,12(R1)                                                        
         MVC   FVIFLD(L'T.GLPACC1),T.GLPACC1                                    
         B     GENE                                                             
*                                                                               
GENL     CLI   *,FF                                                             
         B     GENX                                                             
GENE     CR    RB,RB                                                            
GENX     XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF T/S= PROFILE IS SET IN 30 ELEM ON CURRENT LEVEL ACCT OR A            
* HIGHER LEVEL                                                                  
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
TSLEV2   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   TSLVL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BL    TSLVX                                                            
*                                                                               
TSLV5    TM    RSTSTAT5,RSTSPROD   PRODUCT LEVEL?                               
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@PROC),AC@PROC    'PRODUCT'                           
         B     TSLVE                                                            
                                                                                
         TM    RSTSTAT5,RSTSPRJB   JOB LEVEL?                                   
         BZ    TSLVL               NO                                           
         MVC   FVIFLD(L'AC@JOB),AC@JOB 'JOB'                                    
         B     TSLVE                                                            
*                                                                               
TSLVL    CLI   *,FF                                                             
         B     TSLVX                                                            
TSLVE    CR    RB,RB                                                            
TSLVX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF TASK= PROFILE IS SET IN 30 ELEM ON CURRENT LEVEL ACCT OR A           
* HIGHER LEVEL                                                                  
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
TASKC2   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   TSK2L                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BL    TSK2X                                                            
*                                                                               
         CLC   RSTDFTSK,BCSPACES   ANY DEFAULT TASK CODE?                       
         BE    TSK2L                                                            
         OC    RSTDFTSK,RSTDFTSK                                                
         BZ    TSK2L                                                            
         MVC   FVIFLD(L'RSTDFTSK),RSTDFTSK                                      
         B     TSK2E                                                            
*                                                                               
TSK2L    CLI   *,FF                                                             
         B     TSK2X                                                            
TSK2E    CR    RB,RB                                                            
TSK2X    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF OIN= PROFILE IS SET IN 2C ELEM ON CURRENT LEVEL ACCT OR A            
* HIGHER LEVEL                                                                  
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CHKOIN   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',(R3)),          *        
               (L'SPATYPE,=AL1(SPATINCO))                                       
         CLI   12(R1),0                                                         
         BNE   CHKOINL                                                          
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         MVC   FVIFLD(L'SPAAULA),SPAAULA                                        
         B     CHKOINE                                                          
*                                                                               
CHKOINL  CLI   *,FF                                                             
         B     CHKOINX                                                          
CHKOINE  CR    RB,RB                                                            
CHKOINX  XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF OWO= PROFILE IS SET IN 2C ELEM ON CURRENT LEVEL ACCT OR A            
* HIGHER LEVEL                                                                  
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CHKOWO   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',(R3)),          *        
               (L'SPATYPE,=AL1(SPATWOFF))                                       
         CLI   12(R1),0                                                         
         BNE   CHKOWOL                                                          
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         MVC   FVIFLD(L'SPAAULA),SPAAULA                                        
         B     CHKOWOE                                                          
*                                                                               
CHKOWOL  CLI   *,FF                                                             
         B     CHKOWOX                                                          
CHKOWOE  CR    RB,RB                                                            
CHKOWOX  XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF HOUSE=/NEWBIZ=/PROBONO= IS SET IN 30 ELEM ON CURRENT LEVEL           
* ACCT OR A HIGHER LEVEL                                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CTYP2    NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   CTYPL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q       IF NOT LONGEST ELEM READ NEXT                
         BL    CTYPX               LEVEL                                        
*                                                                               
CTYP5    TM    RSTSTAT5,RSTSHOUS   HOUSE?                                       
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@HOUSE),AC@HOUSE                                      
         B     CTYPE                                                            
*                                                                               
         TM    RSTSTAT5,RSTSNBIZ   NEWBIZ?                                      
         BZ    *+14                                                             
         MVC   FVIFLD(L'AC@NEWBZ),AC@NEWBZ                                      
         B     CTYPE                                                            
*                                                                               
         TM    RSTSTAT5,RSTSBONO   PROBONO?                                     
         BZ    CTYPL                                                            
         MVC   FVIFLD(L'AC@PBONO),AC@PBONO                                      
         B     CTYPE                                                            
*                                                                               
CTYPL    CLI   *,FF                                                             
         B     CTYPX                                                            
CTYPE    CR    RB,RB                                                            
CTYPX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF RECV= PROFILE IS SET IN 2B ELEM ON CURRENT LEVEL ACCT OR A           
* HIGHER LEVEL                                                                  
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
RECV2    NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RBRELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   RECV2L                                                           
         L     RF,12(R1)                                                        
         USING RBRELD,RF                                                        
         OC    RBRRECB,RBRRECB                                                  
         BZ    RECV2L                                                           
         MVC   FVIFLD(L'RBRRECB-2),RBRRECB+2                                    
         B     RECV2E                                                           
*                                                                               
RECV2L   CLI   *,FF                                                             
         B     RECV2X                                                           
RECV2E   CR    RB,RB                                                            
RECV2X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF COST= PROFILE IS SET IN 2B ELEM ON CURRENT LEVEL ACCT OR A           
* HIGHER LEVEL                                                                  
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CO1C2    NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RBRELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   CO1C2L                                                           
         L     RF,12(R1)                                                        
         USING RBRELD,RF                                                        
         OC    RBRCOST,RBRCOST                                                  
         BZ    CO1C2L                                                           
         MVC   FVIFLD(L'RBRCOST-2),RBRCOST+2                                    
         B     CO1C2E                                                           
*                                                                               
CO1C2L   CLI   *,FF                                                             
         B     CO1C2X                                                           
CO1C2E   CR    RB,RB                                                            
CO1C2X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF COMM= PROFILE IS SET IN DB ELEM ON CURRENT LEVEL ACCT OR             
* A HIGHER LEVEL                                                                
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
COMM2    NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R3)),          +        
               (L'FFTTYPE,=AL1(FFTTCOMR))                                       
         CLI   12(R1),0                                                         
         BNE   COMM2L              NOTHING FOUND AT THIS LEVEL                  
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
         UNPK  BODUB1(6),FFTDATA(4)   UNPACK                                    
         OI    BODUB1+5,X'F0'         CLEAR SIGN                                
         LA    RF,FVIFLD                                                        
         CLI   BODUB1,C'0'            TENS  DIGIT ZERO ?                        
         BE    COMM2A                                                           
         MVC   0(1,RF),BODUB1         MOVE  TENS  DIGIT                         
         LA    RF,1(,RF)              NEXT  'TO'  CHARACTER                     
*                                                                               
COMM2A   CLI   BODUB1+1,C'0'          UNITS DIGIT ZERO ?                        
         BNE   COMM2B                 NO,   MOVE  IT                            
         CLI   BODUB1,C'0'            WAS   TENS  DIGIT ALSO ZERO ?             
         BE    COMM2C                 YES,  SKIP  UNITS DIGIT                   
*                                                                               
COMM2B   MVC   0(1,RF),BODUB1+1       MOVE  UNITS DIGIT                         
         LA    RF,1(,RF)              NEXT  'TO'  CHARACTER                     
COMM2C   MVI   0(RF),C'.'             INSERT      DECIMAL   POINT               
         MVC   1(4,RF),BODUB1+2       MOVE  THE   REST OF   THE  NUMBER         
         MVI   5(RF),C'%'             INSERT      PERCENT   SIGN                
         B     COMM2E                                                           
*                                                                               
COMM2L   CLI   *,FF                                                             
         B     COMM2X                                                           
COMM2E   CR    RB,RB                                                            
COMM2X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF DUE DATE FORMULA PROFILE IS SET AT CURRENT LEVEL ACCT                
* OR A HIGHER LEVEL                                                             
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
DUEF2    NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('DEXELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   DUEF2L                                                           
*                                                                               
         L     RF,12(,R1)                                                       
         USING DEXELD,RF                                                        
         LA    R1,BOWORK1                                                       
         USING CONBLKD,R1                                                       
         XC    CONBLK(CONBLKL),CONBLK                                           
         MVI   CONACTN,CONATRAQ    TRANSLATE                                    
         MVI   CONFLD,CONFIDUE     DUE DATE EXPRESSION                          
         MVI   CONILEN,L'DEXVAL    LENGTH OF INPUT                              
         LA    RF,DEXVAL                                                        
         STCM  RF,15,CONIADD                                                    
         LA    RF,FVIFLD                                                        
         STCM  RF,15,CONOADD                                                    
         MVC   CONCOMF,ACOM                                                     
         GOTO1 VCNVERT             TRANSLATED BY CONVERT                        
         B     DUEF2E                                                           
*                                                                               
DUEF2L   CLI   *,FF                                                             
         B     DUEF2X                                                           
DUEF2E   CR    RB,RB                                                            
DUEF2X   XIT1                                                                   
         DROP  R1,RF                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK COST= BIT FOR HIGHER LEVEL ACCOUNTS                                     
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
COS2     NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   COS2L                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         TM    RSTSTAT2,RSTSYCST+RSTSNCST     COST=Y/N?                         
         BZ    COS2L               NO                                           
         MVC   FVIFLD(L'AC@NO),AC@NO                                            
         TM    RSTSTAT2,RSTSYCST          COST=Y?                               
         BZ    COS2E                          NO MUST BE COST=N                 
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         B     COS2E                                                            
*                                                                               
COS2L    CLI   *,FF                                                             
         B     COS2X                                                            
COS2E    CR    RB,RB                                                            
COS2X    XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* READ DB ELEMENT FOR ACCOUNT EQUIVALENT CODE (READ ALL LEVELS)       *         
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                              *         
* NTRY - CODESEQ CONTAINS SEQUENCE NUMBER WANTED                      *         
* EXIT - FVIFLD CONTAINS ACC EQU CODE OR SPACES                       *         
*        EQUAL IF BIT IS ON                                           *         
*        LOW IF BIT IS OFF                                            *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
GETQCD   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         LA    R3,T.ACTRFST                                                     
         USING FFTELD,R3                                                        
GETQ10   CLI   0(R3),0                                                          
         BE    GETQL                                                            
         CLI   0(R3),FFTELQ                                                     
         BNE   *+12                                                             
         CLI   FFTTYPE,FFTTEPTR                                                 
         BE    GETQ30                                                           
GETQ20   ZIC   R1,1(R3)                                                         
         AR    R3,R1                                                            
         B     GETQ10                                                           
*                                                                               
GETQ30   CLC   FFTSEQ,CODESEQ                                                   
         BNE   GETQ20                                                           
*                                                                               
         CLI   PROFLV,1            COMING FROM LEVEL USER ENTERED?              
         BNE   GETQ50                                                           
         ZIC   R1,FFTDLEN          YES SO JUST MOVE IN DATA                     
         BCTR  R1,0                                                             
         EXMVC R1,FVIFLD,FFTDATA                                                
         B     GETQE                                                            
*                                                                               
GETQ50   LA    RE,FVIFLD           NO SO MUST PUT BRACKETS ()                   
         MVI   0(RE),C'('          AROUND THE DATA                              
         LA    RE,1(RE)                                                         
         ZIC   R1,FFTDLEN                                                       
         BCTR  R1,0                                                             
         EXMVC R1,0(RE),FFTDATA                                                 
         LA    R1,1(R1)                                                         
         AR    RE,R1                                                            
         MVI   0(RE),C')'                                                       
         B     GETQE                                                            
*                                                                               
GETQL    CLI   *,FF                                                             
         B     GETQX                                                            
GETQE    CR    RB,RB                                                            
GETQX    XIT1                                                                   
         DROP  R3,T                                                             
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SEE IF FILTER EXISTS AT THIS LEVEL (THIS ROUTINE IS CALLED FOR ALL  *         
* LEVELS)                                                             *         
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                              *         
* NTRY - FILTIND CONTAINS SEQUENCE NUMBER WANTED                      *         
* EXIT - FVIFLD CONTAINS ACC EQU CODE OR SPACES                       *         
*        EQUAL IF BIT IS ON                                           *         
*        LOW IF BIT IS OFF                                            *         
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
GETFLT   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         MVC   FILTSV,BCSPACES                                                  
GETF10   MVI   BCBYTE1,C' '        PROCESSING FILTER 1?                         
         CLI   FILTIND,1                                                        
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF1                                               
         B     GETF20                                                           
         CLI   FILTIND,2           PROCESSING FILTER 2?                         
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF2                                               
         B     GETF20                                                           
         CLI   FILTIND,3           PROCESSING FILTER 3?                         
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF3                                               
         B     GETF20                                                           
         CLI   FILTIND,4           PROCESSING FILTER 4?                         
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF4                                               
         B     GETF20                                                           
         MVC   BCBYTE1,T.ACTRSAF5  MUST BE FILTER 5                             
*                                                                               
GETF20   CLI   BCBYTE1,C' '        ANY FILTER AT THIS LEVEL?                    
         BE    GETFL               NO GO READ NEXT HIGHEST LEVEL                
         CLI   BCBYTE1,X'00'                                                    
         BE    GETFL                                                            
         MVC   FILTSV,BCBYTE1      SAVE THE FILTER                              
         CLI   CSACT,A#LST         FOR ACTION LIST WILL FILL IN FLD             
         BE    GETFE               IN DISPLAY ROUTINE                           
         CLI   CSACT,A#REPT        ACTIONS REPORT AND DOWNLOAD TOO              
         BE    GETFE                                                            
         CLI   CSACT,A#DLOAD                                                    
         BE    GETFE                                                            
         MVC   FVIFLD(L'ACTRSAF1),BCBYTE1                                       
         B     GETFE                                                            
*                                                                               
GETFL    CLI   *,FF                                                             
         B     GETFX                                                            
GETFE    CR    RB,RB                                                            
GETFX    XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF REVERSE SIGN OF CREDIT BALANCE IS SET AT A HIGHER LEVEL              
* NOTE: THIS PROFILE CAN CURRENTLY ONLY BE SET AT THE HIGHEST LEVEL BUT         
*       AFFECTS ALL LEVELS.                                                     
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
RVSGN2   NTR1  BASE=*,LABEL=*                                                   
         CLI   SVLEVS,1            IS THIS THE FIRST LEVEL?                     
         BNE   RSGNL                                                            
         BRAS  RE,SETR3            POINT R3 TO CORRECT LEVEL ACCOUNT            
*                                                                               
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   RSGNL                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q       IF NOT LONGEST ELEM READ NEXT                
         BL    RSGNL               LEVEL                                        
*                                                                               
         TM    RSTSTAT6,RSTYREVS   YES?                                         
         BZ    RSGNL                                                            
         MVC   FVIFLD(L'AC@YES),AC@YES                                          
         B     RSGNE                                                            
*                                                                               
RSGNL    CLI   *,FF                                                             
         B     RSGNX                                                            
RSGNE    CR    RB,RB                                                            
RSGNX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET R3 TO POINT TO CORRECT LEVEL RECORD BASED ON WHETHER YOU ARE              
* READING THE CURRENT LEVEL OR A HIGHER LEVEL OR WHETHER YOU ARE DOING          
* A REPORT.                                                                     
***********************************************************************         
         SPACE 1                                                                
SETR3    NTR1  BASE=*,LABEL=*                                                   
         L     R3,SVADDR           IF DOING A REPORT OR DLOAD THE               
         TM    GENINDS,GENIREP+GENIDLD CORRECT LVL REC IS IN SVADDR             
         BNZ   SETR3X             (AIO8,9,10 OR CURRENT LVL BEING BUILT         
*                                                                               
*                                  IF NOT DOING A REPORT OR DOWNLOAD...         
         L     R3,AIO2             AIO2 CONTAINS THE HIGHER LEVEL               
         CLI   PROFLV,1            ACCT.  IF PROFLV IS 1 THAT MEANS             
         BNE   SETR3X              PROCESSING THE LEVEL THAT THE USER           
         LR    R3,R2               ENTERED SO USE WHAT'S BEING BUILT            
*                                  IN R2                                        
SETR3X   XIT1  REGS=(R3)                                                        
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK COST= BIT FOR ALL LEVEL ACCOUNTS (FOR FILTERING)                        
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
COS3     NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   COS3X                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   FLTIFLD,C'N'        WANT ALL ACCTS NOT MAKING                    
         BNE   COS3A               COST POSTINGS?                               
*                                                                               
         TM    RSTSTAT2,RSTSNCST   SET TO NO?                                   
         BO    COS3EQ              EQUAL                                        
         TM    RSTSTAT2,RSTSYCST   SET TO YES?                                  
         BO    COS3NEQ             NOT EQUAL                                    
         B     COS3X                                                            
*        CLI   SVLEVS,1            SINCE 'NO' IS THE DEFAULT IF THIS IS         
*        BNE   COS3X               A HIGH LEVEL ACCT THAN SHOW IT               
*        B     COS3EQ              IF NOT THAN READ HIGHER LEVELS               
*                                                                               
COS3A    TM    RSTSTAT2,RSTSYCST   SET TO YES?                                  
         BO    COS3EQ              EQUAL                                        
         TM    RSTSTAT2,RSTSNCST   SET TO NO?                                   
         BO    COS3NEQ             NOT EQUAL                                    
         B     COS3X                                                            
*        CLI   SVLEVS,1            SINCE 'YES' IS NOT THE DEFAULT IF            
*        BNE   COS3X               THIS IS A HIGH LVL ACCT THAN DON'T           
*        B     COS3NEQ             SHOW IT - ELSE READ HIGHER LEVELS            
*                                                                               
COS3EQ   MVI   FILTEQ,C'Y'                                                      
         B     COS3X                                                            
*                                                                               
COS3NEQ  MVI   FILTEQ,C'N'                                                      
*                                                                               
COS3X    XIT1                                                                   
         SPACE 2                                                                
         DROP  T                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF ANALYSIS= PROFILE IS SET IN 30 ELEM ON ANY LEVEL ACCT (FOR           
* FILTERING)                                                                    
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
ANL30    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
*                                                                               
         CLI   FLTIFLD+1,C' '   IF FILTERING ON MORE THAN 1 BYTE SKIP           
         BE    ANL3002          THIS 30 ELEM CHECK UNLESS FILTERING ON          
         CLC   FLTIFLD(L'AC@NFA93),AC@NFA93   'COST PROFILE' OR 'NONE'          
         BE    ANL3002                                                          
         CLC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         BNE   ANL30X                                                           
*                                                                               
ANL3002  CLC   =C'1R',ACTKUNT      FOR 1R ACCTS ANALYSIS IS NOT VALID           
         BNE   ANL3005             AT THE OFFICE LVL SO IF 'COST PROF'          
         BRAS  RE,ANL1R            IS THE FILTER THEN SHOW IT ELSE              
         BE    ANL3005             DO NOT SHOW THIS ACCOUNT.                    
         CLC   FLTIFLD(L'AC@NFA93),AC@NFA93                                     
         BE    ANL30E                                                           
         B     ANL30L                                                           
*                                  THAT NEEDS TO BE CHECKED                     
ANL3005  GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   ANL30X                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTCOSTG,C' '                                                    
         BE    ANL3010             NO ANALYSIS CODE FOUND                       
         CLI   RSTCOSTG,X'00'                                                   
         BE    ANL3010             NO ANALYSIS CODE FOUND                       
         CLC   FLTIFLD(L'AC@NFA93),AC@NFA93 FILTERING ON COST PROFILE?          
         BE    ANL30L                                                           
         CLC   FLTIFLD(L'AC@NONE),AC@NONE   OR NONE?                            
         BE    ANL30L                       THAN DON'T WANT THIS ACCT           
         CLC   RSTCOSTG,FLTIFLD    MATCH ON ANALYSIS?                           
         BE    ANL30E              NO                                           
         BH    ANL30H                                                           
         BL    ANL30L                                                           
*                                                                               
ANL3010  DS    0H                                                               
         CLC   FLTIFLD(L'AC@NFA93),AC@NFA93 FILTERING ON COST PROFILE?          
         BE    *+14                                                             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE   OR NONE?                            
         BNE   ANL30X                                                           
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   ANL30X                       EQUAL                               
*                                                                               
ANL30E   MVI   FILTEQ,C'E'                                                      
         B     ANL30X                                                           
ANL30H   MVI   FILTEQ,C'H'                                                      
         B     ANL30X                                                           
ANL30L   MVI   FILTEQ,C'L'                                                      
*                                                                               
ANL30X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF ANALYSIS= PROFILE IS SET IN 2C ELEM ON ANY LEVEL ACCT (FOR           
* FILTERING)                                                                    
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
ANL2C    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',(R3)),          *        
               (L'SPATYPE,=AL1(SPATANAL))                                       
         CLI   12(R1),0                                                         
         BNE   ANL2C30                                                          
*                                                                               
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         OC    SPAAULA,SPAAULA                                                  
         BZ    ANL2C30                  NO INCOME ACCT FOUND                    
         CLC   FLTIFLD(L'AC@NONE),AC@NONE INCOME ACCT FOUND SO                  
         BE    ANL2CL                     FILTERING ON 'NONE'                   
*                                       DON'T SHOW THIS ACCOUN                  
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         LA    R1,12               MAX INPUT LENGTH                             
         LA    RE,FLTIFLD+L'SPAAULA-1   POINT TO LAST CHARACTE                  
ANL2C10  CLI   0(RE),C' '               AND CHECK HOW MANY BYT                  
         BNE   ANL2C20                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,ANL2C10                                                       
         B     ANL2CX                                                           
*                                                                               
ANL2C20  BCTR  R1,0                                                             
         EXCLC R1,SPAAANAL,FLTIFLD                                              
         BE    ANL2CE                                                           
         BH    ANL2CH                                                           
         BL    ANL2CL                                                           
*                                                                               
ANL2C30  DS    0H                          NO ELEM OR NO ACCOUNT FOUND?         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BNE   ANL2CX                                                           
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   ANL2CX                       EQUAL                               
*                                                                               
ANL2CE   MVI   FILTEQ,C'E'                                                      
         B     ANL2CX                                                           
ANL2CH   MVI   FILTEQ,C'H'                                                      
         B     ANL2CX                                                           
ANL2CL   MVI   FILTEQ,C'L'                                                      
*                                                                               
ANL2CX   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK DEFAULT TABSK CODE FOR ALL LEVEL ACCOUNT (FOR FILTERING)                
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
TASKC3   NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   TSK3X                                                            
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BNL   TSK310                                                           
         CLI   SVLEVS,1                        IF NOT LONGEST ELEM              
         BNE   TSK3X                           READ NEXT LVL BUT IF             
         CLC   FLTIFLD(L'AC@NONE),AC@NONE      1ST LEVEL ONLY NONE              
         BE    TSK3E                           WILL BE VALID                    
         B     TSK3L                                                            
*                                                                               
TSK310   CLC   RSTDFTSK,BCSPACES                                                
         BE    TSK320                                                           
         OC    RSTDFTSK,RSTDFTSK                                                
         BZ    TSK320                                                           
         CLC   FLTIFLD(L'AC@NONE),AC@NONE                                       
         BE    TSK3L                                                            
         CLC   RSTDFTSK,FLTIFLD                                                 
         BE    TSK3E                                                            
         BH    TSK3H                                                            
         BL    TSK3L                                                            
*                                                                               
TSK320   CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BNE   TSK3X                                                            
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   TSK3X                        EQUAL                               
*                                                                               
TSK3E    MVI   FILTEQ,C'E'                                                      
         B     TSK3X                                                            
TSK3H    MVI   FILTEQ,C'H'                                                      
         B     TSK3X                                                            
TSK3L    MVI   FILTEQ,C'L'                                                      
*                                                                               
TSK3X    XIT1                                                                   
         EJECT                                                                  
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK CLIENT TYPE FOR ALL LEVEL ACCOUNTS (FOR FILTERING)                      
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CTYP3    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   CTYP3X                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BNL   CTYP302                                                          
         CLI   SVLEVS,1                        IF NOT LONGEST ELEM              
         BNE   CTYP3X                          READ NEXT LVL BUT IF             
         CLC   FLTIFLD(L'AC@BLB),AC@BLB        1ST LEVEL ONLY BILLABLE          
         BE    CTYPEQ                          WILL BE VALID                    
         B     CTYPNEQ                                                          
*                                                                               
CTYP302  CLC   FLTIFLD(L'AC@BLB),AC@BLB        FILTERING ON BILLABLE?           
         BNE   CTYP305                                                          
         TM    RSTSTAT5,RSTSHOUS+RSTSNBIZ+RSTSBONO   THAN THESE BITS            
         BNZ   CTYPNEQ                               SHOULD BE OFF              
         CLI   SVLEVS,1                        BUT EVEN IF BOTH BITS            
         BE    CTYPEQ                          ARE OFF NEED TO CHK              
         B     CTYP3X                          HIGHER LEVELS FIRST              
*                                                                               
CTYP305  CLC   FLTIFLD(L'AC@HOUSE),AC@HOUSE    FILTERING ON HOUSE?              
         BNE   CTYP310                                                          
         TM    RSTSTAT5,RSTSHOUS                                                
         BO    CTYPEQ                                                           
         TM    RSTSTAT5,RSTSNBIZ+RSTSBONO      NBIZ OR PROBONO ON?              
         BNZ   CTYPNEQ                         NOT EQUAL                        
         CLI   SVLEVS,1                        NO BITS SET SO IF LOW            
         BE    CTYPNEQ                         LEVEL REC READ FURTHER.          
         B     CTYP3X                                                           
*                                                                               
CTYP310  CLC   FLTIFLD(L'AC@NB),AC@NEWBZ       FILTERING ON NEWBIZ?             
         BNE   CTYP320                                                          
         TM    RSTSTAT5,RSTSNBIZ                                                
         BO    CTYPEQ                                                           
         TM    RSTSTAT5,RSTSHOUS+RSTSBONO      HOUSE OR PROBONO ON?             
         BNZ   CTYPNEQ                         NOT EQUAL                        
         CLI   SVLEVS,1                        NO BITS SET SO IF LOW            
         BE    CTYPNEQ                         LEVEL REC READ FURTHER.          
         B     CTYP3X                                                           
*                                                                               
CTYP320  TM    RSTSTAT5,RSTSBONO               MUST BE PROBONO                  
         BO    CTYPEQ                                                           
         TM    RSTSTAT5,RSTSHOUS+RSTSNBIZ      HOUSE OR NEWBIZ ON?              
         BNZ   CTYPNEQ                         NOT EQUAL                        
         CLI   SVLEVS,1                        NO BITS SET SO IF LOW            
         BE    CTYPNEQ                         LEVEL REC READ FURTHER.          
         B     CTYP3X                                                           
*                                                                               
CTYPEQ   MVI   FILTEQ,C'Y'                                                      
         B     CTYP3X                                                           
*                                                                               
CTYPNEQ  MVI   FILTEQ,C'N'                                                      
*                                                                               
CTYP3X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK T/S= FOR ALL LEVEL ACCOUNTS (FOR FILTERING)                             
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
TSLEV3   NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   TSLV3X                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BNL   TSLV302                                                          
         CLI   SVLEVS,1                        IF NOT LONGEST ELEM              
         BNE   TSLV3X                          READ NEXT LVL BUT IF             
         CLC   FLTIFLD(L'AC@CLIC),AC@CLIC      1ST LEVEL ONLY CLIENT            
         BE    TSLVEQ                          WILL BE VALID                    
         B     TSLVNEQ                                                          
*                                                                               
TSLV302  CLC   FLTIFLD(L'AC@CLIC),AC@CLIC      FILTERING ON CLIENT?             
         BNE   TSLV305                         CLIENT IS THE DEFAULT            
         TM    RSTSTAT5,RSTSPROD+RSTSPRJB      BOTH BITS SHOULD BE OFF          
         BNZ   TSLVNEQ                         BUT EVEN IS BOTH BITS            
         CLI   SVLEVS,1                        ARE OFF NEED TO CHK              
         BE    TSLVEQ                          HIGHER LEVELS FIRST              
         B     TSLV3X                                                           
TSLV305  CLC   FLTIFLD(L'AC@PROC),AC@PROC      FILTERING ON PRODUCT?            
         BNE   TSLV310                                                          
         TM    RSTSTAT5,RSTSPROD               PRODUCT ON?                      
         BO    TSLVEQ                          EQUAL                            
         TM    RSTSTAT5,RSTSPRJB               JOB ON?                          
         BO    TSLVNEQ                         NOT EQUAL                        
         CLI   SVLEVS,1                        PROD BIT NOT SET/JOB BIT         
         BE    TSLVNEQ                         NOT SET SO IF LOW LEVEL          
         B     TSLV3X                          REC READ FURTHER.                
*                                                                               
TSLV310  TM    RSTSTAT5,RSTSPRJB               JOB BIT ON?                      
         BO    TSLVEQ                          EQUAL                            
         TM    RSTSTAT5,RSTSPROD               PROD BIT ON?                     
         BO    TSLVNEQ                         NOT EQUAL                        
         CLI   SVLEVS,1                        JOB BIT NOT SET/PROD BIT         
         BE    TSLVNEQ                         NOT SET SO IF LOW LEVEL          
         B     TSLV3X                          REC READ FURTHER.                
*                                                                               
TSLVEQ   MVI   FILTEQ,C'Y'                                                      
         B     TSLV3X                                                           
*                                                                               
TSLVNEQ  MVI   FILTEQ,C'N'                                                      
*                                                                               
TSLV3X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK OVERRIDE INCOME ACCOUNT FOR ALL LEVEL ACCOUNTS (FOR FILTERING)          
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CHKOIN2  NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',(R3)),          *        
               (L'SPATYPE,=AL1(SPATINCO))                                       
         CLI   12(R1),0                                                         
         BNE   OIN230                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         OC    SPAAULA,SPAAULA                                                  
         BZ    OIN230                   NO INCOME ACCT FOUND                    
         CLC   FLTIFLD(L'AC@NONE),AC@NONE INCOME ACCT FOUND SO IF               
         BE    OIN2L                      FILTERING ON 'NONE' THAN              
*                                       DON'T SHOW THIS ACCOUNT                 
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         LA    R1,14               MAX FILTER LENGTH                            
         LA    RE,FLTIFLD+L'SPAAULA-1   POINT TO LAST CHARACTER                 
OIN210   CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   OIN220                   VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,OIN210                                                        
         B     OIN2X                                                            
*                                                                               
OIN220   BCTR  R1,0                                                             
         EXCLC R1,FLTIFLD,SPAAULA                                               
         BE    OIN2E                                                            
         BH    OIN2H                                                            
         BL    OIN2L                                                            
*                                                                               
OIN230   DS    0H                          NO ELEM OR NO ACCOUNT FOUND?         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BNE   OIN2X                                                            
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   OIN2X                        EQUAL                               
*                                                                               
OIN2E    MVI   FILTEQ,C'E'                                                      
         B     OIN2X                                                            
OIN2H    MVI   FILTEQ,C'H'                                                      
         B     OIN2X                                                            
OIN2L    MVI   FILTEQ,C'L'                                                      
*                                                                               
OIN2X    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK OVERRIDE WRITEOFF ACCT FOR ALL LEVEL ACCOUNTS (FOR FILTERING)           
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CHKOWO2  NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('SPAELQ',(R3)),          *        
               (L'SPATYPE,=AL1(SPATWOFF))                                       
         CLI   12(R1),0                                                         
         BNE   OWO230                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING SPAELD,RF                                                        
         OC    SPAAULA,SPAAULA                                                  
         BZ    OWO230                   NO WRITE OFF ACCT FOUND                 
         CLC   FLTIFLD(L'AC@NONE),AC@NONE WRITE OFF ACCT FOUND SO IF            
         BE    OWO2L                      FILTERING ON 'NONE' THAN              
*                                       DON'T SHOW THIS ACCOUNT                 
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         LA    R1,14               MAX FILTER LENGTH                            
         LA    RE,FLTIFLD+L'SPAAULA-1   POINT TO LAST CHARACTER                 
OWO210   CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   OWO220                   VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,OWO210                                                        
         B     OWO2X                                                            
*                                                                               
OWO220   BCTR  R1,0                                                             
         EXCLC R1,FLTIFLD,SPAAULA                                               
         BE    OWO2E                                                            
         BH    OWO2H                                                            
         BL    OWO2L                                                            
*                                                                               
OWO230   DS    0H                          NO ELEM OR NO ACCOUNT FOUND?         
         CLC   FLTIFLD(L'AC@NONE),AC@NONE FILTERING ON NONE?                    
         BNE   OWO2X                                                            
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   OWO2X                        EQUAL                               
*                                                                               
OWO2E    MVI   FILTEQ,C'E'                                                      
         B     OWO2X                                                            
OWO2H    MVI   FILTEQ,C'H'                                                      
         B     OWO2X                                                            
OWO2L    MVI   FILTEQ,C'L'                                                      
*                                                                               
OWO2X    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF RECV= PROFILE IS SET IN AT ANY LEVEL (FOR FILTERING)                 
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
RECV3    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RBRELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   RECV330             NO ELEMENT FOUND                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RBRELD,RF                                                        
         OC    RBRRECB,RBRRECB                                                  
         BZ    RECV330             NO COST ACCOUNT FOUND                        
         CLC   FLTIFLD(L'AC@NFA92),AC@NFA92 FILTERING ON CLI/PRD REC?           
         BE    RECV33L             THAN DON'T WANT THIS ACCOUNT                 
*                                                                               
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         LA    R1,12               MAX FILTER LENGTH                            
         LA    RE,FLTIFLD+L'RBRRECB-3   POINT TO LAST CHAR(-2 FOR U/L)          
RECV310  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   RECV320                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,RECV310                                                       
         B     RCV3X                                                            
*                                                                               
RECV320  BCTR  R1,0                                                             
         EXCLC R1,RBRRECB+2,FLTIFLD                                             
         BE    RECV33E                                                          
         BH    RECV33H                                                          
         BL    RECV33L                                                          
*                                                                               
RECV330  DS    0H                                                               
         CLC   FLTIFLD(L'AC@NFA92),AC@NFA92 FILTERING ON CLI/PRD REC?           
         BNE   RCV3X                                                            
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   RCV3X                        EQUAL                               
*                                                                               
RECV33E  MVI   FILTEQ,C'E'                                                      
         B     RCV3X                                                            
RECV33H  MVI   FILTEQ,C'H'                                                      
         B     RCV3X                                                            
RECV33L  MVI   FILTEQ,C'L'                                                      
         B     RCV3X                                                            
RCV3X    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF UNIT 3 COST= PROFILE IS SET IN AT ANY LEVEL (FOR FILTERING)          
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
CO1C3    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RBRELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   CO1C330             NO ELEMENT FOUND                             
*                                                                               
         L     RF,12(R1)                                                        
         USING RBRELD,RF                                                        
         OC    RBRCOST,RBRCOST                                                  
         BZ    CO1C330             NO COST ACCOUNT FOUND                        
         CLC   FLTIFLD(L'AC@NFA92),AC@NFA92 FILTERING ON CLI/PRD REC?           
         BE    CO1C33L             THAN DON'T WANT THIS ACCOUNT                 
*                                                                               
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         LA    R1,12               MAX FILTER LENGTH                            
         LA    RE,FLTIFLD+L'RBRCOST-3   POINT TO LAST CHAR(-2 FOR U/L)          
CO1C310  CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   CO1C320                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,CO1C310                                                       
         B     CO1CX                                                            
*                                                                               
CO1C320  BCTR  R1,0                                                             
         EXCLC R1,RBRCOST+2,FLTIFLD                                             
         BE    CO1C33E                                                          
         BH    CO1C33H                                                          
         BL    CO1C33L                                                          
*                                                                               
CO1C330  DS    0H                                                               
         CLC   FLTIFLD(L'AC@NFA92),AC@NFA92 FILTERING ON CLI/PRD REC?           
         BNE   CO1CX                                                            
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   CO1CX                        EQUAL                               
*                                                                               
CO1C33E  MVI   FILTEQ,C'E'                                                      
         B     CO1CX                                                            
CO1C33H  MVI   FILTEQ,C'H'                                                      
         B     CO1CX                                                            
CO1C33L  MVI   FILTEQ,C'L'                                                      
         B     CO1CX                                                            
CO1CX    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF UNIT 3 COMMISSION PROFILE IS SET AT ANY LEVEL (FILTERING)            
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* THE 1ST BYTE OF FLTIFLD CONTAINS THE INPUT LENGTH OF FILTER                   
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
COMM3    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('FFTELQ',(R3)),          +        
               (L'FFTTYPE,=AL1(FFTTCOMR))                                       
         CLI   12(R1),0                                                         
         BNE   COMM350                                                          
*                                                                               
COMM310  CLC   FLTIFLD(L'AC@NFA94),AC@NFA94   A RATE EXISTS SO IF               
         BE    COMM3L                       FILERING ON 'OPT/MAINT'             
*                                           SKIP THIS ACCOUNT                   
         L     RF,12(R1)                                                        
         USING FFTELD,RF                                                        
         CP    FFTDATA(4),FLTIFLD(4)                                            
         BE    COMM3E                                                           
         BH    COMM3H                                                           
         BL    COMM3L                                                           
*                                                                               
COMM350  CLC   FLTIFLD(L'AC@NFA94),AC@NFA94   NO RATE SO ONLY 'OPT/             
         BNE   COMM3X                         MAINT' IS A VALID FILTER          
         CLI   SVLEVS,1                     IF HIGH LEVEL ACCT THAN             
         BNE   COMM3X                       EQUAL                               
*                                                                               
COMM3E   MVI   FILTEQ,C'E'                                                      
         B     COMM3X                                                           
COMM3H   MVI   FILTEQ,C'H'                                                      
         B     COMM3X                                                           
COMM3L   MVI   FILTEQ,C'L'                                                      
*                                                                               
COMM3X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF ACCOUNT EQU CODE 1 IS SET IN AT ANY LEVEL (FOR FILTERING)            
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
EQ1F     NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         LA    R3,T.ACTRFST                                                     
*                                                                               
         USING FFTELD,R3                                                        
EQ1F20   CLI   0(R3),0                                                          
         BE    EQ1FX                                                            
         CLI   0(R3),FFTELQ                                                     
         BNE   EQ1F30                                                           
         CLI   FFTTYPE,FFTTEPTR                                                 
         BNE   EQ1F30                                                           
         CLC   FFTSEQ,CODESEQ                                                   
         BE    EQ1F40                                                           
EQ1F30   ZIC   R1,1(R3)                                                         
         AR    R3,R1                                                            
         B     EQ1F20                                                           
*                                                                               
EQ1F40   LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
EQ1F42   CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BNE   EQ1F44                   VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,EQ1F42                                                        
*                                                                               
EQ1F44   LTR   R1,R1                                                            
         BZ    EQ1FX                                                            
         BCTR  R1,0                                                             
         EXCLC R1,FFTDATA,FLTIFLD                                               
         BE    EQ1F50E                                                          
         BL    EQ1F50L                                                          
         BH    EQ1F50H                                                          
*                                                                               
EQ1F50E  MVI   FILTEQ,C'E'                                                      
         B     EQ1FX                                                            
EQ1F50L  MVI   FILTEQ,C'L'                                                      
         B     EQ1FX                                                            
EQ1F50H  MVI   FILTEQ,C'H'                                                      
*                                                                               
EQ1FX    XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF FILTER (1-5) IS SET IN AT ANY LEVEL (FOR FILTERING)                  
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
T        USING ACTRECD,R3                                                       
FLT1F    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         MVI   BCBYTE1,C' '                                                     
         L     R1,SVPARMS2                                                      
         CLM   R1,3,=AL2(ACC#FLT1) FILTER 1 FIELD?                              
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF1                                               
         B     FLTF30                                                           
         CLM   R1,3,=AL2(ACC#FLT2) FILTER 2 FIELD?                              
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF2                                               
         B     FLTF30                                                           
         CLM   R1,3,=AL2(ACC#FLT3) FILTER 3 FIELD?                              
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF3                                               
         B     FLTF30                                                           
         CLM   R1,3,=AL2(ACC#FLT4) FILTER 4 FIELD?                              
         BNE   *+14                                                             
         MVC   BCBYTE1,T.ACTRSAF4                                               
         B     FLTF30                                                           
         MVC   BCBYTE1,T.ACTRSAF5     MUST BE FILTER 5                          
*                                                                               
FLTF30   DS    0H                                                               
         CLI   BCBYTE1,C' '          ANY FILTER?                                
         BE    FLTFX              NO CHECK HIGHER LEVELS                        
         CLI   BCBYTE1,X'00'         ANY FILTER?                                
         BE    FLTFX                                                            
         CLC   BCBYTE1,FLTIFLD                                                  
         BE    FLTFE                                                            
         BL    FLTFL                                                            
         BH    FLTFH                                                            
*                                                                               
FLTFE    MVI   FILTEQ,C'E'                                                      
         B     FLTFX                                                            
FLTFL    MVI   FILTEQ,C'L'                                                      
         B     FLTFX                                                            
FLTFH    MVI   FILTEQ,C'H'                                                      
*                                                                               
FLTFX    XIT1                                                                   
         DROP  T                                                                
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK GENERAL= AT ALL LEVELS OF ACCOUNT (FOR FILTERING)                       
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
GEN3     NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('GLPELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   GEN3X                                                            
*                                                                               
* THIS CODE IS HERE BECAUSE EVEN THOUGH THE FILTER IS A TRUE FILTER             
* WE WANT TO SHOW ALL ACCTS THAT START WITH THE ENTERED VALUE BUT               
* NOT CONTINUE ON (E.G. ENTER 04 SHOW 1R04...1R040100ZZZ, NOT 1R05              
*                                                                               
         USING GLPELD,RF                                                        
         L     RF,12(R1)                                                        
         CLC   GLPACC1,BCSPACES                                                 
         BE    GEN3X                                                            
         CLC   FLTIFLD(L'AC@NONE),AC@NONE  IF FILTERING ON 'NONE'               
         BE    GEN3L                       THAN DON'T WANT THIS ACCT            
         LA    R1,14               MAX FILTER LENGTH                            
         LA    RE,FLTIFLD+L'GLPACC1-1   POINT TO LAST CHAR(-2 FOR U/L)          
GEN310   CLI   0(RE),C' '               AND CHECK HOW MANY BYTES TO             
         BNE   GEN320                   VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,GEN310                                                        
         B     GEN3X                                                            
*                                                                               
GEN320   BCTR  R1,0                                                             
         EXCLC R1,GLPACC1,FLTIFLD                                               
         BE    GEN3E                                                            
         BL    GEN3L                                                            
         BH    GEN3H                                                            
*                                                                               
GEN3E    MVI   FILTEQ,C'E'                                                      
         B     GEN3X                                                            
GEN3L    MVI   FILTEQ,C'L'                                                      
         B     GEN3X                                                            
GEN3H    MVI   FILTEQ,C'H'                                                      
*                                                                               
GEN3X    XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK DUE DATE FORMULA FOR ALL LEVEL ACCOUNT (FOR FILTERING)                  
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
DUEF3    NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('DEXELQ',(R3)),0                  
         CLI   12(R1),0                        IF NO ELEM FOUND LOOK TO         
         BE    DUEF310                         HIGHER LVLS UNLESS THIS          
         CLI   SVLEVS,1                        IS THE HIGHEST LEVEL IN          
         BNE   DUEF3X                          WHICH CASE ONLY NO IS            
         CLC   FLTIFLD(L'AC@NO),AC@NO          VALID                            
         BE    DUEF3E                                                           
         B     DUEF3L                                                           
*                                                                               
DUEF310  L     RF,12(R1)                                                        
         USING DEXELD,RF                       IF GET HERE MEANS FOUND          
         CLC   FLTIFLD(L'AC@NO),AC@NO          DUE DATE SO IF FILTERING         
         BE    DUEF3L                          ON NO - NOT EQUAL                
*                                                                               
         LA    R1,BOWORK1                                                       
         USING CONBLKD,R1                                                       
         XC    CONBLK(CONBLKL),CONBLK                                           
         MVI   CONACTN,CONATRAQ    TRANSLATE                                    
         MVI   CONFLD,CONFIDUE     DUE DATE EXPRESSION                          
         MVI   CONILEN,L'DEXVAL    LENGTH OF INPUT                              
         LA    RF,DEXVAL                                                        
         STCM  RF,15,CONIADD                                                    
         LA    RF,BOWORK2                                                       
         STCM  RF,15,CONOADD                                                    
         MVC   CONCOMF,ACOM                                                     
         GOTO1 VCNVERT             TRANSLATED BY CONVERT                        
         LA    R1,FILTLN           MAX LENGTH OF FILTER                         
         LA    RE,FLTIFLD                                                       
         LA    RE,FILTLN-1(RE)                                                  
DUEF320  CLI   0(RE),C' '               AND CHECK HOW MANY BYTE                 
         BH    DUEF330                  VALIDATE                                
         BCTR  RE,0                                                             
         BCT   R1,DUEF320                                                       
*                                                                               
DUEF330  LTR   R1,R1                                                            
         BZ    DUEF3X                                                           
         BCTR  R1,0                                                             
         EXCLC R1,BOWORK2,FLTIFLD                                               
         BE    DUEF3E                                                           
         BL    DUEF3L                                                           
         BH    DUEF3H                                                           
*                                                                               
DUEF3E   MVI   FILTEQ,C'E'                                                      
         B     DUEF3X                                                           
DUEF3H   MVI   FILTEQ,C'H'                                                      
         B     DUEF3X                                                           
DUEF3L   MVI   FILTEQ,C'L'                                                      
*                                                                               
DUEF3X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* LOADS THE CORRECT IO AREA BASED ON LEDGER STRUCTURE FOR THE FILTER            
* LOOKUP ROUTINES                                                               
* NTRY - SVLEVS = # OF LEVELS LEFT TO CHECK                                     
* XIT  - IO2 POINTS TO HIGHER LEVEL ACCOUNT FROM IO8,IO9 OR IO10                
***********************************************************************         
         SPACE 1                                                                
FILTLEV  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         CLI   SVLEVS,X'FF'        IF SVLEVS=FF THAN JUST STARTING TO           
         BNE   FILEV20             CHECK SO CHECK FOR # OF LEVS FIRST           
         MVI   PROFLV,1            SET TO 1 TO INDICATE CHECKING LEVEL          
*                                  OF ACCT THAT USER ENTERED                    
         LA    R4,4                THE MOST WE WILL HAVE TO CHECK IS            
         LA    R1,ACTKACT          4 LEVELS                                     
         ZIC   RF,LNLEV4           MUST FIND OUT WHAT LEVEL ACCOUNT             
         LTR   RF,RF               THE USER ENTERED AND THAN CHECK              
         BZ    FILEV10             THE HIGHER LEVELS                            
         ZIC   RE,LNLEV3                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   FILEV19             4TH LVL ENTERED                              
*                                                                               
FILEV10  LA    R4,3                                                             
         LA    R1,ACTKACT                                                       
         ZIC   RF,LNLEV3                                                        
         LTR   RF,RF                                                            
         BZ    FILEV15                                                          
         ZIC   RE,LNLEV2                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   FILEV19             3RD LVL ENTERED                              
*                                                                               
FILEV15  LA    R4,2                                                             
         LA    R1,ACTKACT                                                       
         ZIC   RF,LNLEV2                                                        
         LTR   RF,RF                                                            
         BZ    FILEV17                                                          
         ZIC   RE,LNLEV1                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   FILEV19                                                          
*                                                                               
FILEV17  LA    R4,1                IF GET HERE THAN ONLY 1 LEV TO CHK           
*                                                                               
T        USING ACTRECD,R1                                                       
FILEV19  STC   R4,SVLEVS           NOW SAVE # OF LEVELS TO CHECK                
         B     FILEV20A                                                         
FILEV20  ZIC   R1,PROFLV                                                        
         AHI   R1,1                                                             
         STC   R1,PROFLV                                                        
*                                                                               
FILEV20A MVC   SVADDR,AIOREC                                                    
         CLI   PROFLV,1           CHECKING THE LEVEL USER ENTERED?              
         BE    FILEVE                                                           
         ZIC   R4,SVLEVS                                                        
         MVC   SVADDR,AIOA                                                      
         CHI   R4,3                CHECKING THE 3RD LEVEL?                      
         BE    FILEVE                                                           
         MVC   SVADDR,AIO9                                                      
         CHI   R4,2                CHECKING THE 2ND LEVEL?                      
         BE    FILEVE                                                           
         MVC   SVADDR,AIO8           MUST BE CHECKING THE 1ST LEVEL?            
         B     FILEVE                                                           
*                                                                               
FILEVL   CLI   *,FF                                                             
         B     FILEVX                                                           
FILEVE   CR    RB,RB                                                            
FILEVX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* READS THE HIGHER LEVEL ACCTS BASED ON LEDGER STRUCTURE FOR THE                
* PROFILE LOOKUP ROUTINES.  THIS DIFFERS FROM THE FILTLEV ROUTINE B/C           
* THIS HAS TO READ THE HIGHER LEVELS                                            
* READS THE ACCOUNT INTO AIO2                                                   
* NTRY - SVLEVS = # OF LEVELS LEFT TO CHECK                                     
* XIT  - IO2 POINTS TO HIGHER LEVEL ACCOUNT RECORD                              
***********************************************************************         
         SPACE 1                                                                
READLEV  NTR1  BASE=*,LABEL=*                                                   
         USING TWAD,RA                                                          
         USING WORKD,R9                                                         
         L     R8,AGWORK                                                        
         USING GWORKD,R8                                                        
*                                                                               
         CLI   SVLEVS,X'FF'        IF SVLEVS=FF THAN JUST STARTING TO           
         BNE   RDLEV20             CHECK SO CHECK FOR # OF LEVS FIRST           
         MVI   PROFLV,1            SET TO 1 TO INDICATE CHECKING LEVEL          
*                                  OF ACCT THAT USER ENTERED                    
         LA    R4,4                THE MOST WE WILL HAVE TO CHECK IS            
         LA    R1,ACTKACT          4 LEVELS                                     
         ZIC   RF,LNLEV4           MUST FIND OUT WHAT LEVEL ACCOUNT             
         LTR   RF,RF               THE USER ENTERED AND THAN CHECK              
         BZ    RDLEV10             THE HIGHER LEVELS                            
         ZIC   RE,LNLEV3                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   RDLEV19             4TH LVL ENTERED                              
*                                                                               
RDLEV10  LA    R4,3                                                             
         LA    R1,ACTKACT                                                       
         ZIC   RF,LNLEV3                                                        
         LTR   RF,RF                                                            
         BZ    RDLEV15                                                          
         ZIC   RE,LNLEV2                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   RDLEV19             3RD LVL ENTERED                              
*                                                                               
RDLEV15  LA    R4,2                                                             
         LA    R1,ACTKACT                                                       
         ZIC   RF,LNLEV2                                                        
         LTR   RF,RF                                                            
         BZ    RDLEV17                                                          
         ZIC   RE,LNLEV1                                                        
         LA    R1,ACTKACT(RE)                                                   
         SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXCLC RF,0(R1),BCSPACES                                                
         BNE   RDLEV19                                                          
*                                                                               
RDLEV17  LA    R4,1                IF GET HERE THAN ONLY 1 LEV TO CHK           
*                                                                               
T        USING ACTRECD,R1                                                       
RDLEV19  STC   R4,SVLEVS           NOW SAVE # OF LEVELS TO CHECK                
         B     RDLEV20A                                                         
RDLEV20  ZIC   R1,PROFLV                                                        
         AHI   R1,1                                                             
         STC   R1,PROFLV                                                        
*                                                                               
RDLEV20A LA    R1,SVACCT           AND CLEAR OUT LEVEL(S) OF ACCOUNT            
         MVC   IOKEY,BCSPACES      IN ORDER TO READ HIGHER LEVEL                
         MVC   IOKEY(ACTKACT-ACTKEY),ACTKEY  C/U/L                              
         MVC   SVACCT,ACTKACT                                                   
         CLI   PROFLV,1            CHECKING THE LEVEL USER ENTERED?             
         BE    RDLEV35             YES SO NOTHING TO CLEAR                      
         ZIC   R4,SVLEVS                                                        
         CHI   R4,3                CHECKING THE 3RD LEVEL?                      
         BL    RDLEV25                                                          
         ZIC   RE,LNLEV3                                                        
         LA    R1,SVACCT(RE)       POINT TO 4TH LEVEL                           
         ZIC   RF,LNLEV4                                                        
         CLI   LNLEV4,L'ACTKACT    4 LEVEL LEDGER?                              
         BE    RDLEV22                                                          
         ZIC   RF,LNLEV3                                                        
         CLI   LNLEV3,L'ACTKACT    3 LEVEL LEDER?                               
         BE    RDLEV22                                                          
         ZIC   RF,LNLEV2                                                        
         CLI   LNLEV2,L'ACTKACT    2 LEVEL LEDER?                               
         BE    *+6                                                              
         DC    H'0'                SHOULDN'T BE HERE IF 1 LEVEL LEDGER          
RDLEV22  SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXMVC RF,0(R1),BCSPACES   AND CLEAR OUT 4TH LEVEL                      
         B     RDLEV35                                                          
*                                                                               
RDLEV25  CHI   R4,2                CHECKING THE 2ND LEVEL?                      
         BL    RDLEV30                                                          
         ZIC   RE,LNLEV2                                                        
         LA    R1,SVACCT(RE)       POINT TO 3RD LEVEL                           
         ZIC   RF,LNLEV4                                                        
         CLI   LNLEV4,L'ACTKACT    4 LEVEL LEDGER?                              
         BE    RDLEV27                                                          
         ZIC   RF,LNLEV3                                                        
         CLI   LNLEV3,L'ACTKACT    3 LEVEL LEDGER?                              
         BE    RDLEV27                                                          
         ZIC   RF,LNLEV2                                                        
         CLI   LNLEV2,L'ACTKACT    2 LEVEL LEDGER?                              
         BE    *+6                                                              
         DC    H'0'                SHOULDN'T BE HERE IF 1 LEVEL LEDGER          
RDLEV27  SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXMVC RF,0(R1),BCSPACES   AND CLEAR OUT 3RD LEVEL                      
         B     RDLEV35                                                          
*                                                                               
RDLEV30  CHI   R4,1                CHECKING THE 1ST LEVEL?                      
         BL    RDLEVE                                                           
         ZIC   RE,LNLEV1                                                        
         LA    R1,SVACCT(RE)       POINT TO 2ND LEVEL                           
         ZIC   RF,LNLEV4                                                        
         CLI   LNLEV4,L'ACTKACT    4 LEVEL LEDGER?                              
         BE    RDLEV32                                                          
         ZIC   RF,LNLEV3                                                        
         CLI   LNLEV3,L'ACTKACT    3 LEVEL LEDGER?                              
         BE    RDLEV32                                                          
         ZIC   RF,LNLEV2                                                        
         CLI   LNLEV2,L'ACTKACT    2 LEVEL LEDGER?                              
         BE    *+6                                                              
         DC    H'0'                SHOULDN'T BE HERE IF 1 LEVEL LEDGER          
RDLEV32  SR    RF,RE                                                            
         BCTR  RF,0                                                             
         EXMVC RF,0(R1),BCSPACES   AND CLEAR OUT 2ND LEVEL                      
*                                                                               
RDLEV35  MVC   IOKEY+L'ACTKCPY+L'ACTKUNT+L'ACTKLDG(L'SVACCT),SVACCT             
         LHI   R1,XOREAD+XOACCDIR+XIO2                                          
         GOTO1 AIO                                                              
         BNE   RDLEVL                                                           
RDLEV40  LHI   R1,XOGET+XOACCMST+XIO2                                           
         GOTO1 AIO                                                              
         BE    RDLEVE                                                           
         DC    H'0'                                                             
*                                                                               
RDLEVL   CLI   *,FF                                                             
         B     RDLEVX                                                           
RDLEVE   CR    RB,RB                                                            
RDLEVX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
***********************************************************************         
* CHECK REVERSE SIGN OF CR BALANCE (FOR FILTERING)                              
* NOTE: THIS PROFILE IS ONLY VALID AT THE HIGHEST LEVEL BUT AFFECTS             
*       ALL LEVELS.                                                             
* AIO2 POINTS TO THE HIGHER LEVEL RECORD                                        
* EXIT - EQUAL IF BIT IS ON                                                     
*        LOW IF BIT IS OFF                                                      
***********************************************************************         
         SPACE 1                                                                
RVSGN3   NTR1  BASE=*,LABEL=*                                                   
         MVI   FILTEQ,0                                                         
         CLI   SVLEVS,1            IS THIS THE FIRST LEVEL?                     
         BNE   RSGN3X                                                           
         L     R3,SVADDR           SVADDR PTS TO THE CURRENT LEVEL              
*                                  THAT NEEDS TO BE CHECKED                     
         GOTO1 VHELLO,BOPARM,(C'G',GCFILNAM),('RSTELQ',(R3)),0                  
         CLI   12(R1),0                                                         
         BNE   RSGN3X                                                           
*                                                                               
         L     RF,12(R1)                                                        
         USING RSTELD,RF                                                        
         CLI   RSTLN,RSTLN3Q                                                    
         BNL   RSGN302                                                          
         CLC   FLTIFLD(L'AC@NO),AC@NO          1ST LEVEL ONLY 'NO'              
         BE    RSGNEQ                          WILL BE VALID                    
         B     RSGNNEQ                                                          
*                                                                               
RSGN302  CLC   FLTIFLD(L'AC@YES),AC@YES        FILTERING ON YES?                
         BNE   RSGN305                                                          
         TM    RSTSTAT6,RSTYREVS                                                
         BO    RSGNEQ                                                           
         B     RSGNNEQ                                                          
*                                                                               
RSGN305  TM    RSTSTAT6,RSTYREVS               MUST BE FILTERING ON NO          
         BZ    RSGNEQ                                                           
         B     RSGNNEQ                                                          
*                                                                               
RSGNEQ   MVI   FILTEQ,C'Y'                                                      
         B     RSGN3X                                                           
*                                                                               
RSGNNEQ  MVI   FILTEQ,C'N'                                                      
*                                                                               
RSGN3X   XIT1                                                                   
         DROP  RF                                                               
         SPACE 2                                                                
         LTORG                                                                  
FIL19   CSECT                                                                   
***********************************************************************         
* LITERALS & CONSTANTS                                                *         
***********************************************************************         
         SPACE 1                                                                
         LTORG                                                                  
FF       EQU   X'FF'                                                            
FFFF     EQU   X'FFFF'                                                          
*                                                                               
DCLISTU  DS    0D                  DATA DICTIONARY INPUT (UPPERCASE)            
         DCDDL AC#YES,L'AC@YES,L                                                
         DCDDL AC#NO,L'AC@NO,L                                                  
         DCDDL AC#NONE,L'AC@NONE,L                                              
         DCDDL AC#NFA42,L'AC@NFA42,L                                            
         DCDDL AC#UNKWN,L'AC@UNKWN,L                                            
         DCDDL AC#NEXPC,L'AC@NEXPC,L                                            
         DCDDL AC#NEMP,L'AC@NEMP,L                                              
         DCDDL AC#RNT,L'AC@RNT,L                                                
         DCDDL AC#ROY,L'AC@ROY,L                                                
         DCDDL AC#PRZ,L'AC@PRZ,L                                                
         DCDDL AC#MEDC,L'AC@MEDC,L                                              
         DCDDL AC#PROV1,L'AC@PROV1,L                                            
         DCDDL AC#LGR,L'AC@LGR,L                                                
         DCDDL AC#AGY,L'AC@AGY,L                                                
         DCDDL AC#NFCP,L'AC@NFCP,L                                              
         DCDDL AC#DPT,L'AC@DPT,L                                                
         DCDDL AC#DPT,L'AC@DPT2,L                                               
         DCDDL AC#ACL,L'AC@ACL,L                                                
         DCDDL AC#COP04,L'AC@COP04,L                                            
         DCDDL AC#COP04,L'AC@STDRD,L                                            
         DCDDL AC#EXEC,L'AC@EXEC,L                                              
         DCDDL AC#CLIC,L'AC@CLIC,L                                              
         DCDDL AC#PROC,L'AC@PROC,L                                              
         DCDDL AC#JOB,L'AC@JOB,L                                                
         DCDDL AC#HOUSE,L'AC@HOUSE,L                                            
         DCDDL AC#NEWBZ,L'AC@NEWBZ,L                                            
         DCDDL AC#PBONO,L'AC@PBONO,L                                            
         DCDDL AC#BLB,L'AC@BLB,L                                                
         DCDDL AC#CORP,L'AC@CORP,L                                              
         DCDDL AC#CORP,L'AC@CORP2,L                                             
         DCDDL AC#OFFC,L'AC@OFFC,L                                              
         DCDDL AC#PRSN,L'AC@PRSN,L                                              
         DCDDL AC#DDSDF,L'AC@DDSDF,L                                            
         DCDDL AC#NB,L'AC@NB,L                                                  
         DCDDL AC#TXPB,L'AC@PB,L                                                
         DCDDL AC#NFNA,L'AC@NA,L                                                
         DCDDL AC#NAPPL,L'AC@NAPPL,L                                            
         DCDDL AC#NTAVL,L'AC@NTAVL,L                                            
         DCDDL AC#BOTH,L'AC@BOTH,L                                              
         DCDDL AC#DR,L'AC@DR,L                                                  
         DCDDL AC#DRS,L'AC@DRS,L                                                
         DCDDL AC#CRS,L'AC@CRS,L                                                
         DCDDL AC#ROYTY,L'AC@ROYTY,L                                            
         DCDDL AC#MEDCL,L'AC@MEDCL,L                                            
         DCDDL AC#PRIZE,L'AC@PRIZE,L                                            
         DCDDL AC#PRIZE,L'AC@PRIZ2,L                                            
         DCDDL AC#RENT,L'AC@RENT,L                                              
         DCDDL AC#OVRI,L'AC@OVRI,L                                              
         DCDDL AC#NFA25,L'AC@NFA25,L                                            
         DCDDL AC#NFA39,L'AC@NFA39,L                                            
         DCDDL AC#INCL,L'AC@INCL,L                                              
         DCDDL AC#EXCL,L'AC@EXCL,L                                              
         DCDDL AC#NFA64,L'AC@NFA64,L                                            
         DCDDL AC#NFA65,L'AC@NFA65,L                                            
         DCDDL AC#NFA72,L'AC@NFA72,L                                            
         DCDDL AC#NFA73,L'AC@NFA73,L                                            
         DCDDL AC#NFA77,L'AC@NFA77,L                                            
         DCDDL AC#QST,L'AC@QST,L                                                
         DCDDL AC#HST,L'AC@HST,L                                                
         DCDDL AC#ONT,L'AC@ONT,L                                                
         DCDDL AC#PST,L'AC@PST,L                                                
         DCDDL AC#SIWO,L'AC@SIWO,L                                              
         DCDDL AC#NFA89,L'AC@NFA89,L                                            
         DCDDL AC#NFA90,L'AC@NFA90,L                                            
         DCDDL AC#NFA91,L'AC@NFA91,L                                            
         DCDDL AC#ADD2,L'AC@ADD2,L                                              
         DCDDL AC#NFA92,L'AC@NFA92,L                                            
         DCDDL AC#NFA93,L'AC@NFA93,L                                            
         DCDDL AC#NFA94,L'AC@NFA94,L                                            
         DCDDL AC#NFA96,L'AC@NFA96,L                                            
         DCDDL AC#NFA97,L'AC@NFA97,L                                            
         DCDDL AC#LOA,L'AC@LOA,L                                                
         DCDDL AC#DEL,L'AC@DEL,L                                                
         DCDDL AC#FROM,L'AC@FROM,L                                              
         DCDDL AC#CHG,L'AC@CHG,L                                                
         DCDDL AC#EFT,L'AC@EFT,L                                                
         DCDDL AC#PRNTD,L'AC@PRNTD,L                                            
         DCDDL AC#MAIL,L'AC@MAIL,L                                              
         DCDDL AC#FAX,L'AC@FAX,L                                                
         DCDDL AC#EMAIL,L'AC@EMAIL,L                                            
         DCDDL AC#AFMBR,L'AC@AFMBR,L                                            
         DCDDL AC#CFIBR,L'AC@CFIBR,L                                            
         DCDDL AC#NF111,L'AC@NF111,L                                            
         DCDDL AC#NAME,L'AC@NAME,L                                              
         DCDDL AC#NF110,L'AC@NF110,L                                            
         DCDDL AC#ADD,L'AC@ADD,L                                                
         DCDDL AC#BN,L'AC@BN,L                                                  
         DCDDL AC#SIN,L'AC@SIN,L                                                
         DCDDL AC#PCARD,L'AC@PCARD,L                                            
         DCDDL AC#SING,L'AC@SING,L                                              
         DCDDL AC#MULT,L'AC@MULT,L                                              
         DCDDL AC#CCARD,L'AC@CCARD,L                                            
*SPEC-44172                                                                     
         DCDDL AC#OVR2,L'AC@OVR2,L                                              
         DCDDL AC#NFA2A,L'AC@NFA2A,L                                            
*SPEC-44172                                                                     
*SPEC-46491                                                                     
         DCDDL AC#FFT1,L'AC@FFT1,L                                              
         DCDDL AC#FFT2,L'AC@FFT2,L                                              
         DCDDL AC#FFT3,L'AC@FFT3,L                                              
         DCDDL AC#FFT4,L'AC@FFT4,L                                              
         DCDDL AC#FFT5,L'AC@FFT5,L                                              
         DCDDL AC#FFT6,L'AC@FFT6,L                                              
         DCDDL AC#FFT7,L'AC@FFT7,L                                              
         DCDDL AC#FFT8,L'AC@FFT8,L                                              
*SPEC-46491                                                                     
DCLSTUX  DC    X'00'                                                            
*                                                                               
DCLISTL  DS    0D                  DATA DICTIONARY INPUT (LOWERCASE)            
         DCDDL AC#FLT,L'AC@FLT,L                                                
DCLSTLX  DC    X'00'                                                            
         SPACE 2                                                                
***********************************************************************         
* INCLUDED BOOKS                                                      *         
***********************************************************************         
         SPACE 1                                                                
* ACFILWORK                                                                     
* FASECRETD                                                                     
* DDPARSNIPD                                                                    
* CONBLKD                                                                       
* ACRAPPERD                                                                     
* DDGETBANKD                                                                    
* SEACSFILE                                                                     
         PRINT OFF                                                              
       ++INCLUDE ACFILWORK                                                      
       ++INCLUDE FASECRETD                                                      
       ++INCLUDE DDPARSNIPD                                                     
CONBLKD  DSECT                                                                  
       ++INCLUDE DDCONBLK                                                       
RAPPERD  DSECT                                                                  
       ++INCLUDE ACRAPPERD                                                      
       ++INCLUDE DDGETBANKD                                                     
       ++INCLUDE SEACSFILE                                                      
         PRINT ON                                                               
***********************************************************************         
* DSECT TO COVER SAVED STORAGE @ TWUSER                                         
***********************************************************************         
         SPACE                                                                  
TWAD     DSECT                                                                  
         ORG   TWAPPLIC                                                         
SVUL     DS    CL2         FOR SETTING BIT TO BUILD CORRECT LIST SCREEN         
         ORG   TWUSER                                                           
SAVEVALS EQU   *                                                                
AACGTBNK DS    A                   A(ACGETBANK)                                 
SVADDR   DS    A                                                                
SVINFADR DS    A                                                                
ACOSTPR  DS    A                   A(CLIENT ANALYSIS PROFILE FIELD)             
SVEQADDR DS    A                   A(SAVED ACCT EQUIVALENCY RULE TABLE)         
* DON'T SEPERATE THESE FIELDS                                                   
QFLTTB   DS    0XL4                                                             
AACCFLD  DS    A                   A(ACCOUNT CODE FIELD)                        
AFLT1FLD DS    A                   A(FILTER 1 FILTER FIELD)                     
AFLT2FLD DS    A                   A(FILTER 2 FILTER FIELD)                     
AFLT3FLD DS    A                   A(FILTER 3 FILTER FIELD)                     
AFLT4FLD DS    A                   A(FILTER 4 FILTER FIELD)                     
AFLT5FLD DS    A                   A(FILTER 5 FILTER FIELD)                     
ANAMFLD  DS    A                   A(ACCT NAME FILTER FIELD)                    
ALVLFLD  DS    A                   A(ACC LEVEL FILTER FIELD)                    
QFLTTBND DS    0C                                                               
* DON'T SEPERATE THESE FIELDS                                                   
*                                                                               
TABEND   DS    A                                                                
FLDEND   DS    A                                                                
SFVIFLD  DS    A                                                                
DISPL    DS    H                                                                
*                                                                               
FILLER   DS    CL3                                                              
SVUNT    DS    CL2     TO REBUILD COLUMNS FOR ACC EQU CODES                     
ACKEYSV  DS    CL15                                                             
SVACCT   DS    CL12                                                             
SVACCT2  DS    CL12                                                             
SVLEVEL  DS    CL21                SAVED SETTING FOR LEVEL FIELD                
SVLEVS   DS    XL1                                                              
VATFLDH  DS    CL9                 DUMMY FLD HEADER TO PASS TO VATICAN          
* DO NOT SEPARATE THESE FIELDS                                                  
LNLEVELS DS    0XL4                LENGTHS OF EACH LEVEL                        
LNLEV1   DS    XL1                                                              
LNLEV2   DS    XL1                                                              
LNLEV3   DS    XL1                                                              
LNLEV4   DS    XL1                                                              
TLEVS    DS    0XL4                TEMP LENGTHS OF EACH LEVEL                   
TLEV1    DS    XL1                                                              
TLEV2    DS    XL1                                                              
TLEV3    DS    XL1                                                              
TLEV4    DS    XL1                                                              
* DO NOT SEPARATE THESE FIELDS                                                  
*                                                                               
NAMLEN   DS    XL1                 ACCOUNT NAME POINTER LENGTH                  
FILTIND  DS    XL1                 WHICH ACCT FILTER IS PROCESSING              
FILTEQ   DS    CL1                 SET TO Y IF ACCT PASSES FILTER TEST          
LEVELN   DS    XL1                 LEVEL OF ACCOUNT USER ENTERED                
SVPROV   DS    CL2                 SAVED PROVINCE CODE(GST/PST PROFILE)         
SVTXTYPE DS    XL1                 SAVED TAX TYPE (GST/PST PROFILE)             
CODESEQ  DS    XL1                 SEQ NUMBER FOR ACC EQU CODES/RULES           
TAXIDTY  DS    CL3                 SSN OR EIN (TAX TYPE)                        
TAXIND   DS    CL1                 E=EIN,S=SS#                                  
CPYFRLEV DS    XL1                 LENGTH OF COPY FROM ACCOUNT                  
CPYTOLEV DS    XL1                 LENGTH OF COPY TO ACCOUNT                    
NLEVS    DS    XL1                                                              
MASK     DS    XL4                                                              
SVTXNUM  DS    CL9                 SAVED TAX ID NUMBER                          
PROFLV   DS    XL1                 INDICATES WHAT LEVEL OF ACCT WE ARE          
*                                  CHECKING FOR A PROFILE                       
BYTE     DS    XL1                                                              
CHK1R    EQU   X'80'               CHECK WHAT LVL 1R ACCT USER ENTERED          
OLDPROF  EQU   X'40'               NO CHANGE THAT WOULD REQUIRE PROF            
*                                  TO BE VALIDATED BUT MAKE SURE SET            
*                                  UP CORRECTLY FROM OLD FILE (=FILE)           
ATFOUND  EQU   X'20'               @ SIGN FOUND FOR EMAIL VALIDATION            
EQURULE  EQU   X'10'               ACC EQUIVALENCY RULES SET UP ON LDGR         
EDTCOL   EQU   X'08'               EDITING LIST COLUMN HEADINGS                 
GLOFFLEV EQU   X'04'               GLOFF PROFILE NOT VALID AT THIS LVL          
OKSEARCH EQU   X'02'               AN ACCEPTABLE SEARCH WORD IS FOUND           
NOANALYS EQU   X'01'               1 BYTE ANALYSIS CODE NOT FOUND IN 30         
*                                                                               
BYTE2    DS    XL1                                                              
VAL12    EQU   X'80'                                                            
FILTCLR  EQU   X'40'               TELL RTNES TO IGNORE FLTR VALIDATION         
RANGE1   EQU   X'20'                                                            
RANGE2   EQU   X'10'                                                            
COMMA    EQU   X'08'                                                            
NAM1CCHA EQU   X'04'               AN ACCT NAME HAS CHANGED FOR A 1C            
PROCFILT EQU   X'02'               PROCESSING FILTERS                           
PROF1099 EQU   X'01'               1099 VENDOR PROFILE IN USE                   
*                                                                               
BYTE3    DS    XL1                                                              
ADRCOL   EQU   X'80'               ADDR ADDED AS A VARIABLE COL ON LIST         
ELEMF    EQU   X'40'               ELEMENT FOUND                                
BACCF    EQU   X'20'               BANK ACCOUNT FOUND                           
BROUTF   EQU   X'10'               BANK ROUTING # FOUND                         
BNKCF    EQU   X'08'               BANK CODE FOUND                              
BRCF     EQU   X'04'               BRANCH CODE FOUND                            
BPAYMF   EQU   X'02'               PAYMENT METHOD FOUND                         
BRDELF   EQU   X'01'               REMITTANCE DELIVERY FOUND                    
*                                                                               
BYTE4    DS    XL1                                                              
SCBCDF   EQU   X'80'               SC BANK/BRANCH CODE FOUND                    
SCBACCF  EQU   X'40'               SC BANK ACCOUNT FOUND                        
PAYEFT   EQU   X'20'               PAYMENT METH IS EFT                          
MSGCLF   EQU   X'10'               MESSAGE CLASS FOUND IN ELEM (SC)             
DSNF     EQU   X'08'               DATASET NAME FOUND IN ELEM (SC)              
PROFBNK  EQU   X'04'               BANK/BRACNCH PROFILE SET                     
VEMLF    EQU   X'02'               VENDOR EMAIL ADDRESS FOUND                   
*                                                                               
BYTE5    DS    XL1                                                              
BSWIFT   EQU   X'80'                                                            
*                                                                               
BYTE2C   DS    XL1                                                              
UPD2C    EQU   X'80'               2C CHANGED-NEED TO WRITE BACK                
NO2CADDR EQU   X'40'               NO ADDRESS FOUND ON 2C ACCOUNT               
NOPYADDR EQU   X'20'               NO ADDRESS FOUND ON PAYABLE ACCT             
NO2CNME  EQU   X'10'               NO NAME FOUND ON 2C ACCOUNT                  
NOPYNME  EQU   X'08'               NO NAME FOUND ON PAYABLE ACCT                
NOADDRM  EQU   X'04'               ADDRESS DOES NOT MATCH 2C                    
*                                                                               
FILTBIT  DS    XL1                 BITS WHEN FILTERS ADDED/CHANGED              
FLT1CHA  EQU   X'80'                                                            
FLT2CHA  EQU   X'40'                                                            
FLT3CHA  EQU   X'20'                                                            
FLT4CHA  EQU   X'10'                                                            
FLT5CHA  EQU   X'08'                                                            
*                                                                               
LEVELBIT DS    XL1                 ZERO MEANS DDS DEFAULT                       
ACCTLV   EQU   X'80'               PROFILE SET AT ACCOUNT LEVEL                 
HIGHLV   EQU   X'40'               PROFILE SET AT A HIGHER ACCT LEVEL           
LEDGLV   EQU   X'20'               PROFILE SET AT LEDGER LEVEL                  
COMPLV   EQU   X'10'               PROFILE SET AT COMPANY LEVEL                 
LDGLVDEF EQU   X'08'               SPECIAL SETTING FOR COST= PROFILE            
*                                  LEDGER LEVEL IS THE DEFAULT                  
NOTAPPL  EQU   X'04'               PROF IS NOT APPLICABLE AT THIS LVL           
GLOFFDEF EQU   X'02'               SPECIAL SETTING FOR GLOFF= PROFILE           
*                                                                               
LEVELBT2 DS    XL1                                                              
AFMBNKLV EQU   X'80'               PROFILE SET AT AFM BANK LEVEL                
CFIBNKLV EQU   X'40'               PROFILE SET AT CFILE BANK LEVEL              
*                                                                               
ERRIND   DS    XL1                                                              
ERMAXIO  EQU   X'80'               MAX IO'S RETURNED FOR LIST                   
EOLSET   EQU   X'40'                                                            
*                                                                               
SBYTE    DS    CL1                 SECURITY BYTE                                
EXPSEC   EQU   1                   FLD SEC #-SE EXPENSE PROFILES                
GLSEC    EQU   2                   FLD SEC #-G/L PROFILES                       
UNIT3PRF EQU   3                   FLD SEC #-UNIT 3 RETAIL PROFILES             
VENDINV  EQU   4                   FLD SEC #-VENDOR INVOICE PROFILES            
CHKDISB  EQU   5                   FLD SEC #-CHK DISB PROFS(PAYBLES)            
V1099    EQU   6                   FLD SEC #-1099 PRFS(PAYABLES & 2C)           
LOCSEC   EQU   7                   FLD SEC #-LOCK PROFILE                       
COSTPROF EQU   8                   FLD SEC #-COST ALLOC PRFS(1R/C/N/SI)         
TIMEPROF EQU   9                   FLD SEC #-TIME PROFILES (1R & 1C)            
BANKPROF EQU   10                  FLD SEC #-BANK PROFILES (SC)                 
PEELSC   EQU   11                  FLD SEC #-PEELING PROFILES (SC)              
INCANAL  EQU   13                  FLD SEC #-INCOME ANALYSIS PROFS (SI)         
EQUCODES EQU   14                  FLD SEC #-ACC EQUIVALENT CODES(PG 1)         
VACCSEC  EQU   15                  FLD SEC #-VENDOR ACCT PROFS(MED PAY)         
EDIPROF  EQU   16                  FLD SEC #-EDI PROFILES (PAYABLES)            
BRDOEXP  EQU   17                  FLD SEC #-BRANDOCEAN EXP PROFILES            
CORPENT  EQU   18                  FLD SEC #-BRANDOCEAN                         
BRDOGAP  EQU   19                  FLD SEC #-BRANDOCEAN GAP PROFILES            
*                                                                               
SVFLTER  DS    XL(FILTLN)                                                       
SVFLTER2 DS    XL(FILTLN)                                                       
SVFLTCNT DS    XL1                                                              
SVFLTMAX DS    XL1                                                              
SVFIND2  DS    XL1                 SAVED FLTIND2 FIELD                          
SVFLTNM  DS    XL2                 SAVED FIELD NUMBER OF THIS FILTER            
TRUELEN  DS    XL1                                                              
LVLFILT  DS    CL3                 SAVED ACCOUNT LEVEL FILTER                   
FILTSV   DS    CL1                 SAVED FILTER (F1-F5)                         
SVBNKBR  DS    CL10                SAVED BNK/BRNCH CODE FROM LOW LVL SC         
*                                                                               
ACCINDS  DS    XL1                                                              
ACCICKSP EQU   X'08'               CHKSPAC ROUTINE HAS BEEN CALLED              
ACCISPAC EQU   X'04'               ACCOUNT IS STAFF PAYABLES                    
ACCIDPT  EQU   X'02'               DEPARTMENT A/C HAS BEEN ENTERED              
ACCIPER  EQU   X'01'               PERSONNEL A/C HAS BEEN ENTERED               
*                                                                               
SVPIDLNQ EQU   L'SVNEWPID+L'SVNEWPER                                            
SVNEWPID DS    XL(L'PIDNO)         SAVE NEW BINARY PID                          
SVNEWPER DS    CL(L'SPAAULA)       SAVE NEW PERSONNEL ACCOUNT                   
SVOLDPID DS    XL(L'PIDNO)         SAVE OLD BINARY PID                          
SVOLDPER DS    CL(L'SPAAULA)       SAVE OLD PERSONNEL ACCOUNT                   
*                                                                               
OLDNAME  DS    CL(L'NAMEREC+NAMLN1Q) SAVED OLD NAME FOR SEARCH FUNCTION         
BLOCK    DS    CL160                                                            
SVKEY    DS    CL42                SAVED KEY                                    
SVELEM   DS    CL256               SAVED ELEMENT                                
SKEYLAST DS    CL(L'ACTKEY)        SAVED CONTINUATION KEY FOR LIST              
SVCPYEL  DS    CL(CPYLN4Q)         SAVE COMPANY ELEMENT                         
SVLDGEL  DS    CL(LDGLNQ)          SAVE LEDGER ELEMENT                          
SETTAB   DS    20CL(SETTBLNQ)      TABLE OF PROFILE SETTINGS                    
SETEND   DS    C                                                                
EQRULTAB DS    (MAXRULES)CL(EQRLLNQ) TABLE OF ACC EQUIVALENCY RULES             
EQRULEND DS    C                   END OF TABLE                                 
*                                                                               
MAXRULES EQU   5                   MAX # OF ACC EQUIVALENCLY RULES              
FILTLN   EQU   17                  USED TO DISPLAY FILTER FIELD                 
*                                                                               
         ORG   TWUSER+L'TWUSER-(*-SAVEVALS)                                     
         EJECT                                                                  
***********************************************************************         
* OVERLAY WORKING STORAGE                                             *         
***********************************************************************         
         SPACE 1                                                                
OVERWRKD DSECT                                                                  
CALLR1   DS    A                                                                
SVPARMS  DS    0XL24                                                            
SVPARMS1 DS    A                                                                
SVPARMS2 DS    A                                                                
SVPARMS3 DS    A                                                                
SVPARMS4 DS    A                                                                
SVPARMS5 DS    A                                                                
SVPARMS6 DS    A                                                                
IOCOUNT  DS    H                                                                
         SPACE 1                                                                
*                                                                               
ARSTEL   DS    A                   A(RECORD STATUS ELEMENT)                     
*                                                                               
DSLISTU  DS    0D                  DATA DICTIONARY OUTPUT (UPPERCASE)           
AC@YES   DS    CL3                                                              
AC@NO    DS    CL2                                                              
AC@NONE  DS    CL4                 'NONE'                                       
AC@NFA42 DS    CL6                 '(NONE)'                                     
AC@UNKWN DS    CL7                                                              
AC@NEXPC DS    CL11                NONEMPLOYEE                                  
AC@NEMP  DS    CL6                 NONEMP                                       
AC@RNT   DS    CL3                                                              
AC@ROY   DS    CL3                 ROY                                          
AC@PRZ   DS    CL3                                                              
AC@MEDC  DS    CL3                 MED                                          
AC@PROV1 DS    CL11                PROVISIONAL                                  
AC@LGR   DS    CL6                                                              
AC@AGY   DS    CL6                                                              
AC@NFCP  DS    CL14                                                             
AC@DPT   DS    CL10                DEPARTMENT                                   
AC@DPT2  DS    CL4                 DEPT                                         
AC@ACL   DS    CL6                                                              
AC@COP04 DS    CL3                 STD                                          
AC@STDRD DS    CL8                 STANDARD                                     
AC@EXEC  DS    CL4                                                              
AC@CLIC  DS    CL6                                                              
AC@PROC  DS    CL7                                                              
AC@JOB   DS    CL3                                                              
AC@HOUSE DS    CL5                                                              
AC@NEWBZ DS    CL6                                                              
AC@PBONO DS    CL7                                                              
AC@BLB   DS    CL8                                                              
AC@CORP  DS    CL9                 CORPORATE                                    
AC@CORP2 DS    CL4                 CORP                                         
AC@OFFC  DS    CL6                                                              
AC@PRSN  DS    CL6                                                              
AC@DDSDF DS    CL11                                                             
AC@NB    DS    CL2                                                              
AC@PB    DS    CL2                                                              
AC@NA    DS    CL5                 (N/A)                                        
AC@NAPPL DS    CL14                NOT APPLICABLE                               
AC@NTAVL DS    CL3                 N/A                                          
AC@BOTH  DS    CL4                                                              
AC@DR    DS    CL2                                                              
AC@DRS   DS    CL6                                                              
AC@CRS   DS    CL7                                                              
AC@ROYTY DS    CL9                                                              
AC@MEDCL DS    CL7                                                              
AC@PRIZE DS    CL6                 PRIZES                                       
AC@PRIZ2 DS    CL5                 PRIZE                                        
AC@RENT  DS    CL4                                                              
AC@OVRI  DS    CL2                                                              
AC@NFA25 DS    CL9                 OVERNIGHT                                    
AC@NFA39 DS    CL11                (GST RULES)                                  
AC@INCL  DS    CL7                                                              
AC@EXCL  DS    CL7                                                              
AC@NFA64 DS    CL3                 SSN                                          
AC@NFA65 DS    CL3                 EIN                                          
AC@NFA72 DS    CL14                (CLI/PROD REC)                               
AC@NFA73 DS    CL11                (OPT/MAINT)                                  
AC@NFA77 DS    CL13                LV OF ABSENCE                                
AC@QST   DS    CL3                 FOR ACPRVTAB INCLUDE                         
AC@HST   DS    CL3                                                              
AC@ONT   DS    CL3                                                              
AC@PST   DS    CL3                                                              
AC@SIWO  DS    CL6                 (SIWO)                                       
AC@NFA89 DS    CL14                (GL HEIRARCHY)                               
AC@NFA90 DS    CL6                 (HEIR)                                       
AC@NFA91 DS    CL13                LV OF ABSENCE                                
AC@ADD2  DS    CL3                 ADD                                          
AC@NFA92 DS    CL12                CLI/PROD REC                                 
AC@NFA93 DS    CL12                COST PROFILE                                 
AC@NFA94 DS    CL9                 OPT/MAINT                                    
AC@NFA96 DS    CL4                 HEIR                                         
AC@NFA97 DS    CL9                 GST RULES                                    
AC@LOA   DS    CL3                 LOA                                          
AC@DEL   DS    CL6                 DELETE                                       
AC@FROM  DS    CL4                 FROM                                         
AC@CHG   DS    CL6                 CHANGE                                       
AC@EFT   DS    CL3                 EFT                                          
AC@PRNTD DS    CL7                 PRINTED                                      
AC@MAIL  DS    CL4                 MAIL                                         
AC@FAX   DS    CL3                 FAX                                          
AC@EMAIL DS    CL5                 EMAIL                                        
AC@AFMBR DS    CL15                AFM BANK RECORD                              
AC@CFIBR DS    CL17                CFILE BANK RECORD                            
AC@NF111 DS    CL4                 ADDR                                         
AC@NAME  DS    CL4                 NAME                                         
AC@NF110 DS    CL2                 NM                                           
AC@ADD   DS    CL2                 AD                                           
AC@BN    DS    CL2                 BN                                           
AC@SIN   DS    CL3                 SIN                                          
AC@PCARD DS    CL5                 PCARD                                        
AC@SING  DS    CL6                 SINGLE                                       
AC@MULT  DS    CL8                 MULTIPLE                                     
AC@CCARD DS    CL5                 CCARD                                        
*                                                                               
*SPEC-44172                                                                     
AC@OVR2  DS    CL2                 RD/RDOverrd                                  
AC@NFA2A DS    CL8                 RDVendor                                     
*SPEC-44172                                                                     
*SPEC-46491                                                                     
AC@FFT1  DS    CL30                SC FREE FORM TEXT FIELD 1                    
AC@FFT2  DS    CL30                SC FREE FORM TEXT FIELD 2                    
AC@FFT3  DS    CL30                SC FREE FORM TEXT FIELD 3                    
AC@FFT4  DS    CL30                SC FREE FORM TEXT FIELD 4                    
AC@FFT5  DS    CL30                SC FREE FORM TEXT FIELD 5                    
AC@FFT6  DS    CL30                SC FREE FORM TEXT FIELD 6                    
AC@FFT7  DS    CL30                SC FREE FORM TEXT FIELD 7                    
AC@FFT8  DS    CL30                SC FREE FORM TEXT FIELD 8                    
*SPEC-46491                                                                     
DSLISTL  DS    0D                  DATA DICTIONARY OUTPUT (LOWERCASE)           
AC@FLT   DS    CL6                 FILTER                                       
OVERWRKN EQU   *-OVERWRKD                                                       
         SPACE 2                                                                
***********************************************************************         
* OTHER DSECTS                                                                  
***********************************************************************         
         SPACE 1                                                                
SETTABD  DSECT                                                                  
SETFLDN  DS    XL2                 FIELD NUMBER OF PROFILE                      
SETPROF  DS    CL15                CURRENT SETTING FOR PROFILE                  
SETTBLNQ EQU   *-SETTABD                                                        
         SPACE 2                                                                
EQRULTBD DSECT                                                                  
EQRLSEQ  DS    XL1                 SEQUENCE NUMBER OF THIS RULE (0-4)           
EQRLLEN  DS    XL1                 TOT LENGTH OF THIS RULE (W/O COMMAS)         
EQNMLEN  DS    XL1                 LENGTH OF ACCT EQUIVALENCY NAME              
EQRLNLVS DS    XL1                 NUMBER OF LEVELS                             
EQRLNAME DS    CL10                ACCT EQUIVALENCY NAME FROM LEDGER            
EQRLRULE DS    XL30                ACCT EQUIVALENCY RULE                        
EQRLLNQ  EQU   *-EQRULTBD                                                       
         SPACE 2                                                                
RTNTABD  DSECT                                                                  
RTNFLD   DS    XL2                 FIELD NUMBER FIELD DISPLAYING                
         DS    XL2                 SPARE                                        
RTNRTNE  DS    A                   A(ROUTINE TO CHECK HIGHER LEVEL)             
RTNRTNE2 DS    A                   OPTIONAL A(2ND ROUTINE)                      
RTN1LNQ  EQU   *-RTNTABD                                                        
         SPACE 2                                                                
FLTCDD   DSECT                                                                  
FLTCID   DS    XL2                 FIELD EQUATE ID                              
FLTNAME  DS    CL8                 FILTER NAME                                  
FLTCLNQ  EQU   *-FLTCID                                                         
         SPACE 2                                                                
DISPTBLD DSECT                                                                  
DISPNUM  DS    XL2                 FIELD EQUATE ID                              
         DS    XL2                 SPARE                                        
DISPRTN  DS    A                  A(DSPLY RTN FOR PROTECTED FILTER FLD)         
DISPLNQ  EQU   *-DISPNUM                                                        
         SPACE 2                                                                
SCRTABD  DSECT                                                                  
SCRUL    DS    CL2                 UNIT AND LEDGER                              
SCRCTRY  DS    AL1                 COUNTRY EQUATE                               
SCRSTAT1 DS    XL1                 STATUS BYTE                                  
SCRCODE  DS    CL1                 SCREEN CODE                                  
SCRLNQ   EQU   *-SCRUL                                                          
         SPACE 2                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'053ACFIL19   11/30/20'                                      
         END                                                                    

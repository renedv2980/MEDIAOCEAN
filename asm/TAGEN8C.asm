*          DATA SET TAGEN8C    AT LEVEL 077 AS OF 03/09/17                      
*PHASE T7028CB,*                                                                
         TITLE 'T7028C - ADVICE RECORD MAINTENANCE'                             
T7028C   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 STOREEQU,T7028C,R7,RR=R2,CLEAR=YES                               
         LR    R3,RC                                                            
         SPACE 1                                                                
         L     RC,0(R1)            RC=GENCON STORAGE AREA                       
         USING GEND,RC                                                          
         L     RA,ATWA             RA=A(TWA)                                    
         USING T702FFD,RA                                                       
         L     R9,ASYSD            R9=SYSTEM STORAGE AREA                       
         USING SYSD,R9                                                          
         L     R8,ASPOOLD          R8=SPOOL STORAGE AREA                        
         USING SPOOLD,R8                                                        
         SPACE 2                                                                
         ST    R3,ADCREC           SAVE A(ADVICE CAST RECORD)                   
         LA    RE,TWAHOLE                                                       
         ST    RE,ASVRU            SAVE A(SVRECUSE FOR PF FLIPS)                
         AHI   RE,1                                                             
         ST    RE,AELTAOC          SAVE A(OLD AGENCY/CID ELEMENT)               
         AHI   RE,TAOCLNQ                                                       
         ST    RE,ASVESTFD         SAVE A(SAVED ESTIMATE FIELD)                 
         AHI   RE,32                                                            
         ST    RE,AFAKEREC         SAVE A(FAKEREC)                              
         AHI   RE,2000                                                          
         ST    RE,AVERSION         SAVE A(VERSIONS)                             
         AHI   RE,250                                                           
         ST    RE,ATEMPKYF         SAVE A(SAVED FIELD KEY SCREENS)              
         AHI   RE,51                                                            
         ST    RE,ACSINFO          SAVE A(COM FLM AND REC INFO)                 
         AHI   RE,58                                                            
         ST    RE,APTRBLK          SAVE A(POINTER BLOCK)                        
         SPACE 2                                                                
         CLI   ACTNUM,ACTADD       IF ACTION IS ADD                             
         BNE   MODE03                                                           
         CLI   LWRSCR,SCR8C                                                     
         BE    MODE03                                                           
         CLI   PFAID,21            VERIFY                                       
         BE    ADDINC                                                           
         CLI   PFAID,22            SEND                                         
         BE    ADDINC                                                           
         CLI   PFAID,23            ASPLIT                                       
         BE    ADDINC                                                           
         CLI   PFAID,24            AND REPORT PF KEYS INVALID                   
         BE    ADDINC                                                           
         SPACE 1                                                                
*ODE03   BAS   RE,LOSEINFO                                                      
         SPACE 1                                                                
MODE03   CLI   PFAID,21                                                         
         BE    *+12                                                             
         CLI   PFAID,22                                                         
         BNE   *+8                                                              
         MVI   SELECT,0                                                         
         SPACE 2                                                                
         BAS   RE,CURRSCR          RETURN CURRENT SCREEN IN LWRSCR              
         GOTOR INIT                INITIALIZE                                   
         SPACE 2                                                                
         CLI   SELECT,C'Y'         IF ACTION REALLY SELECT BUT FAKING           
         BNE   MODE10              A DISPLAY/CHANGE/VERIFY/SEND                 
         TM    CONACTH+4,X'80'     AND ACTION FIELD HAS CHANGED                 
         BZ    MODE05                                                           
         MVI   SELECT,0            FAKING IS OVER                               
         MVI   TWALACT,ACTDIS                                                   
         CLI   ACTNUM,ACTDIS       CHANGE LAST ACTION TO DISPLAY                
         BE    MODE50                                                           
         MVI   TWALACT,ACTCHA      OR CHANGE RECORD                             
         B     MODE30                                                           
         SPACE 1                                                                
MODE05   MVI   ACTNUM,ACTSEL       IF ACTION REALLY SELECT BUT FAKING           
         MVI   TWALACT,ACTSEL      A D/C/V/S AND ACTION FIELD HASN'T            
         MVI   SELECT,0            CHANGED ... CHANGE ACTION TO SELECT          
         MVC   CONACT(7),=C'SELECT '  AND CLEAR FAKE DISPLAY INDICATOR          
         CLI   STATUS,0                                                         
         BE    MODE10                                                           
         MVC   CONACT(7),=C'CHANGE '                                            
         MVI   THISLSEL,C'C'                                                    
         SPACE 1                                                                
MODE10   CLI   ACTNUM,ACTSEL       IF ACTION SELECT                             
         BNE   MODE20                                                           
         CLI   PFAID,14            AND PF KEY 14 (FLIP SCREEN) HIT              
         BE    MODE15                                                           
         TM    STATUS,WAITUPFK     OR IF WAITING FOR UPGRADE                    
         BO    MODE15                                                           
         TM    STATUS,WAITLPFK     OR VERSION/LIFT VALIDATION                   
         BO    MODE15                                                           
         TM    STATUS,WAITVPFK     OR VERIFY AUTHENTICATION                     
         BO    MODE15                                                           
         TM    STATUS,WAITSPFK     OR SEND AUTHENTICATION                       
         BO    MODE15                                                           
         TM    STATUS,WAID1PFK     OR DATE 1 OVERRIDE                           
         BO    MODE15                                                           
         TM    STATUS,WAID2PFK     OR DATE 2 OVERRIDE                           
         BO    MODE15                                                           
         TM    STATUS2,DSPNXTPG    OR NEED TO DISPLAY NEXT PAGE                 
         BO    MODE15                                                           
         CLI   PFAID,20            PF KEY 20 IS VALID                           
         BE    PFKERR              OTHERWISE, IT'S NOT                          
         B     MODE20                                                           
MODE15   CLI   RECNUM,PV                                                        
         BNE   MODE16                                                           
         GOTO1 RECVAL,DMCB,TLPVCDQ,(X'30',0),('TLPVSCDQ',0)                     
         B     MODE17                                                           
MODE16   GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0) RE-READ ADVICE RECORD              
MODE17   MVI   ACTNUM,ACTDIS                                                    
         MVC   CONACT(7),=C'DISPLAY'         FAKE DISPLAY MODE                  
         CLI   STATUS,0                                                         
         BNE   MODE15A                                                          
         CLI   THISLSEL,C'C'                                                    
         BNE   *+14                                                             
MODE15A  MVI   ACTNUM,ACTCHA                 OR FAKE CHANGE MODE                
         MVC   CONACT(7),=C'CHANGE '                                            
         TM    STATUS,WAITVPFK                                                  
         BO    *+12                                                             
         CLI   THISLSEL,C'V'                                                    
         BNE   *+14                                                             
         MVI   ACTNUM,ACTVER                 OR FAKE VERIFY MODE                
         MVC   CONACT(7),=C'VERIFY '                                            
         TM    STATUS,WAITSPFK                                                  
         BO    *+12                                                             
         CLI   THISLSEL,C'N'                                                    
         BNE   *+14                                                             
         MVI   ACTNUM,ACTSEND                OR FAKE SEND MODE                  
         MVC   CONACT(7),=C'SEND   '                                            
         MVI   SELECT,C'Y'         SET FAKE DISPLAY INDICATOR                   
         TM    STATUS2,DSPNXTPG                                                 
         BO    MODE15B                                                          
         BAS   RE,FLIPCHK          AND DISPLAY NEW SCREEN                       
         B     XIT                                                              
         SPACE 1                                                                
MODE15B  BAS   RE,DREC                                                          
         B     MODE03                                                           
         SPACE 2                                                                
MODE20   CLI   MODE,VALKEY         VALIDATE KEY                                 
         BNE   MODE30                                                           
         BAS   RE,VKEY                                                          
         B     XIT                                                              
         SPACE 2                                                                
MODE30   CLI   MODE,VALREC         VALIDATE RECORD                              
         BNE   MODE40                                                           
         GOTO1 SAVPTRS,DMCB,APTRBLK                                             
         BAS   RE,VREC                                                          
         B     XIT                                                              
         SPACE 2                                                                
MODE40   CLI   MODE,DISPKEY        DISPLAY KEY                                  
         BNE   MODE50                                                           
         BAS   RE,DKEY                                                          
         BAS   RE,VKEY                                                          
         B     XIT                                                              
         SPACE 2                                                                
MODE50   CLI   MODE,DISPREC        DISPLAY RECORD                               
         BNE   MODE60                                                           
         BAS   RE,DREC                                                          
         BAS   RE,FLIPCHK                                                       
         SPACE 2                                                                
MODE60   CLI   MODE,RECREST        RESTORE RECORD                               
         BE    MODE70                                                           
         CLI   MODE,RECDEL         DELETE RECORD                                
         BNE   MODE80                                                           
         BRAS  RE,DELTEST                                                       
MODE70   GOTO1 SAVPTRS,DMCB,APTRBLK                                             
         B     XIT                                                              
         SPACE 2                                                                
MODE80   CLI   MODE,PRINTREP       PRINT REPORT                                 
         BNE   MODE90                                                           
         BAS   RE,PREP                                                          
         B     XIT                                                              
         SPACE 2                                                                
MODE90   CLI   MODE,XRECREST       JUST RESTORED RECORD                         
         BNE   MODE100                                                          
         GOTOR DRDCREC                                                          
         BAS   RE,ADDPOINT                                                      
         BAS   RE,DREC                                                          
         BAS   RE,FLIPCHK                                                       
         SPACE 2                                                                
MODE100  CLI   MODE,XRECDEL        JUST DELETED RECORD                          
         BNE   MODE110                                                          
         BAS   RE,ADDPOINT                                                      
         GOTOR DRDCREC                                                          
         B     XIT                                                              
         SPACE 2                                                                
MODE110  CLI   MODE,XRECADD        JUST ADDED RECORD                            
         BNE   MODE130                                                          
         CLI   IOOPT,C'Y'          IF REALLY JUST ADDED RECORD                  
         BE    MODE120                                                          
         MVC   CONACT(6),=C'CHANGE'   MAKE ACTION 'CHANGE'                      
         BAS   RE,ADDPOINT         ADD POINTERS                                 
         BAS   RE,DREC             AND DISPLAY RECORD                           
MODE120  MVI   IOOPT,C'N'                                                       
         BAS   RE,FLIPCHK                                                       
         SPACE 2                                                                
MODE130  CLI   MODE,XRECPUT        JUST PUT RECORD                              
         BNE   XIT                                                              
MODE140  BAS   RE,ADDPOINT                                                      
         BAS   RE,DREC                                                          
         BAS   RE,FLIPCHK                                                       
XIT      XIT1                                                                   
         SPACE 2                                                                
ADDINC   MVI   MYMSGNO1,104                                                     
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE TO MAKE ADD POINTERS CALL                                
ADDPOINT NTR1                                                                   
         SPACE 1                                                                
         MVI   BYTE,0                                                           
         L     R3,APTRBLK                                                       
         CLI   ACTNUM,ACTVER                                                    
         BNE   *+8                                                              
         MVI   BYTE,X'20'                                                       
         GOTO1 ADDPTRS,DMCB,(BYTE,(R3))                                         
         B     XIT                                                              
         EJECT                                                                  
*              ROUTINE TO RETURN CURRENT SCREEN IN LWRSCR                       
         SPACE 1                                                                
CURRSCR  MVI   LWRSCR,SCR8C        MENU                                         
         CLC   =C'MEN',MENTAGH+74                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCR0E        CLASS A                                      
         CLC   =C'CLA',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCRF0        TELEVISION                                   
         CLC   =C'TEL',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCRF1        RADIO                                        
         CLC   =C'RAD',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCRF2        ADDENDUM                                     
         CLC   =C'ADD',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCRF3        SPANISH                                      
         CLC   =C'SPA',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCRF4        CANADIAN                                     
         CLC   =C'CAN',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCR98        CABLE                                        
         CLC   =C'CAB',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCR53        INTERNET/NEWMEDIA                            
         CLC   =C'INT',MENTAGH+73                                               
         BER   RE                                                               
         SPACE 1                                                                
         MVI   LWRSCR,SCR04        SESSION                                      
         CLC   =C'FIN',MENTAGH+8                                                
         BER   RE                                                               
         DC    H'00'                                                            
         EJECT                                                                  
*              ROUTINE TO HANDLE SCREEN FLIPS                                   
         SPACE 1                                                                
FLIPCHK  CLI   SELECT,C'Y'         IF ACTION REALLY SELECT                      
         BNE   FCHK05                                                           
         TM    STATUS,WAITUPFK     AND WAITING FOR UPGRADE VALIDATION           
         BO    FCHK02                                                           
         TM    STATUS,WAITLPFK     OR VERSION/LIFT VALIDATION                   
         BO    FCHK02                                                           
         TM    STATUS,WAITVPFK     OR VERIFY AUTHENTICATION                     
         BO    FCHK02                                                           
         TM    STATUS,WAITSPFK     OR SEND AUTHENTICATION                       
         BO    FCHK02                                                           
         TM    STATUS,WAID1PFK     OR DATE OVERRIDE                             
         BO    FCHK02                                                           
         TM    STATUS,WAID2PFK                                                  
         BO    FCHK02                                                           
         CLI   THISLSEL,C'C'       OR FAKING CHANGE                             
         BE    FCHK02                                                           
         CLI   THISLSEL,C'V'       OR FAKING VERIFY                             
         BE    FCHK02                                                           
         CLI   THISLSEL,C'N'       OR FAKING SEND                               
         BNE   FCHK05                                                           
FCHK02   MVC   SVPF,PFAID          SAVE HIT PF KEY                              
         GOTO1 SAVPTRS,DMCB,APTRBLK                                             
         BAS   RE,VREC             VALIDATE RECORD                              
         GOTO1 PUTREC              PUT IT TO FILE                               
         BAS   RE,ADDPOINT                                                      
         MVI   PFAID,0                                                          
         CLI   SVPF,20             IF SAVED PF KEY WAS 20 DONE                  
         BE    FCHKX                                                            
         MVI   PFAID,14            IF 14 MUST FLIP SCREEN                       
         SPACE 1                                                                
FCHK05   CLI   PFAID,0             PF KEY PRESSED?                              
         BE    FCHKX               NO - EXIT                                    
         SPACE 1                                                                
         CLI   LWRSCR,SCR8C        IF ON MENU SCREEN                            
         BNE   FCHK10                                                           
         BAS   RE,VALPFK           PF KEY MUST BE VALID  -                      
         SPACE 1                                                                
FCHK10   GOTOR GOTOSCRN            FIND OUT WHAT SCREEN TO LOAD (FROM           
         GOTOR GETSCRN             HIT PF KEY) AND LOAD IT                      
         MVI   PFAID,0             CLEAR PRESSED PF KEY                         
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ADDING                                    
         BNE   FCHK30                                                           
         CLI   LWRSCR,SCR04        AND NEW SCREEN IS SESSION                    
         BNE   FCHK15                                                           
         GOTOR SETUPSES            SET UP SESSION SCREEN                        
         B     FCHKX                                                            
FCHK15   CLI   LWRSCR,SCR0E                                                     
         BNE   FCHK20                                                           
         OI    CLACCSTH+6,X'C0'                                                 
         SPACE 1                                                                
FCHK20   CLI   LWRSCR,SCR8C        IF ADDING AND NEW SCREEN IS MENU             
         BNE   FCHK40                                                           
FCHK30   BAS   RE,DREC             OR NOT ADDING, DISPLAY NEW SCREEN            
         CLI   SELECT,C'Y'         IF ACTION REALLY SELECT, BUT FAKING          
         BNE   FCHK40              DISPLAY - DO NOT RETURN TO GENCON            
         MVI   MYMSGNO1,99                                                      
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 1                                                                
FCHK40   CLI   ACTNUM,ACTADD       IF ADDING AND NEW SCREEN IS NOT              
         BNE   FCHKX               MENU OR SESSION                              
         MVI   MYMSGNO1,90                                                      
         L     R2,EFHREC           GIVE PLEASE ENTER FIELDS AS REQUIRED         
         OI    GENSTAT2,USGETTXT   MESSAGE                                      
         GOTO1 EXIT,DMCB,0                                                      
FCHKX    B     XIT                                                              
         SPACE 2                                                                
*              ROUTINE TO MAKE SURE HIT PF KEY ON MENU SCREEN IS VALID          
         SPACE 1                                                                
VALPFK   NTR1                                                                   
         LA    RF,VPFKTAB                                                       
VPFK10   CLI   0(RF),X'FF'         MATCH PRESSED PF KEY TO ENTRY IN             
         BE    PFKERR              VPFKTAB                                      
         CLC   PFAID,0(RF)                                                      
         BE    XIT                 VPFKTAB BUILT IN VREC/DREC -                 
         LA    RF,1(RF)            DMENBOT - BLDPFTAB                           
         B     VPFK10                                                           
         SPACE 1                                                                
PFKERR   MVI   ERROR,ERINVPFK      IF PRESSED PF KEY NOT IN VPFKTAB             
         LA    R2,MENAGYH          ERROR                                        
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*&&DO                                                                           
*              ROUTINE TO SEE IF PF KEY ACT WILL CAUSE LOSS OF INPUT            
         SPACE 1                                                                
LOSEINFO NTR1                                                                   
         TM    STATUS,LOSEINF      IF USER ALREADY KNOWS THAT THEIR             
         BO    LI50                NEW INPUT WILL NOT STAY - EXIT               
         SPACE 1                                                                
         CLI   PFAID,13            OTHERWISE IF LIST PF KEY                     
         BE    LI10                                                             
         CLI   PFAID,21            OR VERIFY PF KEY                             
         BE    LI10                                                             
         CLI   PFAID,22            OR SEND PF KEY                               
         BE    LI10                                                             
         CLI   PFAID,23            OR ASPLIT PF KEY                             
         BE    LI10                                                             
         CLI   PFAID,24            OR REPORT PF KEY HIT                         
         BNE   LI50                                                             
LI10     LA    R2,MENVERH          CHECK TO SEE IF ANY FLDS HAVE CHGD           
LI15     CLI   0(R2),0             IF AT END OF SCREEN AND NOTHING              
         BE    LI50                CHANGED NO NEED FOR WARNING                  
         TM    4(R2),X'80'                                                      
         BO    LI20                                                             
         ZIC   R0,0(R2)                                                         
         AR    R2,R0                                                            
         B     LI15                                                             
         SPACE 1                                                                
LI20     OI    STATUS,LOSEINF      IF SOMETHING DID CHANGE                      
         MVI   MYMSGNO1,104        GIVE WARNING MESSAGE                         
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         SPACE                                                                  
LI50     NI    STATUS,X'FF'-LOSEINF                                             
         B     XIT                                                              
         EJECT                                                                  
*&&                                                                             
*              VALIDATE ADVICE RECORD KEY FIELDS                                
         SPACE 1                                                                
VKEY     NTR1                                                                   
         CLI   ACTNUM,ACTADD       IF ACTION ADD                                
         BNE   VKEY05                                                           
         TM    AGYSTA3,TAAYSADV    AND AGENCY SET TO GENERATE                   
         BZ    VKEY05              ADVICE #'S AUTOMATICALLY                     
         CLI   MENADVH+5,0                                                      
         BE    VKEY05                                                           
         TWAXC MENADVH                                                          
         B     VKEY10              CLEAR ADVICE FIELD                           
         SPACE 1                                                                
VKEY05   TM    MENAGYH+4,X'20'     IF ANY KEY FIELD CHANGED                     
         BZ    VKEY10                                                           
         TM    MENCIDH+4,X'20'                                                  
         BZ    VKEY10                                                           
         TM    MENADVH+4,X'20'                                                  
         BO    VKEY20                                                           
VKEY10   MVI   OVERLAY,SCR8C                                                    
         GOTOR GETSCRN             LOAD MENU SCREEN                             
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ACTION IS ADD                             
         BNE   VKEY30                                                           
         NI    MENCIDH+4,X'DF'     SET TO RE-DISPLAY COMMERCIAL INFO            
         SPACE 1                                                                
VKEY20   CLI   ACTNUM,ACTADD       IF ACTION IS ADD                             
         BNE   VKEY30                                                           
         CLI   LWRSCR,SCR8C        ON NON-MENU SCREEN                           
         BE    VKEY30                                                           
         LA    R2,MENTAGH          POSITION CURSOR AT REGULAR                   
         ZIC   RE,0(R2)            CYCLE START DATE                             
         AR    R2,RE                                                            
         OI    6(R2),X'C0'                                                      
         SPACE 1                                                                
VKEY30   BAS   RE,VALAGY           VALIDATE AGENCY                              
         BAS   RE,VALCID           VALIDATE COMMERCIAL ID                       
         BAS   RE,VALADV           VALIDATE ADVICE                              
         MVC   ADVKEY,KEY          SAVE VALIDATED KEY                           
         SPACE 1                                                                
         BAS   RE,STUSESES         SET USE/SES PRESENT FLAG                     
         B     XIT                 AND DETERMINE IF REALLY ADDING               
         EJECT                                                                  
*              VALIDATE AGENCY PORTION OF ADVICE RECORD KEY                     
         SPACE 1                                                                
VALAGY   NTR1                                                                   
         TM    SCRSTAT,SCRCHG+RECCHG                                            
         BNZ   *+12                                                             
         TM    MENAGYH+4,X'20'     FIELD PREVIOUSLY VALIDATED?                  
         BO    XIT                 YES - EXIT                                   
         SPACE 1                                                                
         NI    MENCIDH+4,X'DF'     SET COMMERCIAL FIELD NOT VALIDATED           
         MVI   NWKREQ,C'N'         TURN OFF NETWORK REQ'D (CLA USES)            
         SPACE 1                                                                
VALAGY10 MVC   AIO,AIO2            AGENCY MUST EXIST                            
         GOTO1 RECVAL,DMCB,TLAYCDQ,(X'20',MENAGYH)                              
         GOTO1 RAVPPLSA,DMCB,0     SEE IF REC / ACT INVALID FOR P+              
         BNE   ERPPLSI                                                          
         BAS   RE,SETAGY           SAVE AGENCY'S INFORMATION                    
         MVC   AIO,AIO1                                                         
         B     XIT                                                              
         SPACE 2                                                                
*              ROUTINE TO SAVE INFORMATION FROM AGENCY RECORD                   
         SPACE 1                                                                
SETAGY   NTR1                                                                   
         L     R4,AIO              R4=A(AGENCY RECORD)                          
         MVI   ELCODE,TAAYELQ                                                   
         BRAS  RE,GETEL            R4=A(AGENCY DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TAAYD,R4                                                         
         MVC   TGOFF,TAAYTPOF      SAVE TALENT PARTNERS OFFICE                  
         MVC   AGYSTAT,TAAYSTAT    AGENCY STATUS                                
         MVC   AGYSTA3,TAAYSTA3    AND AGENCY STATUS 3                          
         MVC   AGYSTA4,TAAYSTA4    AND AGENCY STATUS 4                          
         MVC   AGYSTA5,TAAYSTA5    AND AGENCY STATUS 5                          
         SPACE 1                                                                
         BRAS  RE,GETRULES         SAVE WHETHER AGENCY REQUIRES                 
         MVC   AGYNWKRQ,NWKREQ     NETWORK FOR CLA USES INTO AGYNWKRQ           
         B     XIT                                                              
         DROP  R4                                                               
         SPACE 2                                                                
         EJECT                                                                  
*              VALIDATE COMMERCIAL ID PORTION OF ADVICE RECORD KEY              
         SPACE 1                                                                
VALCID   NTR1                                                                   
         LA    R2,MENCIDH          R2=A(COMMERCIAL FIELD)                       
         TM    4(R2),X'20'         FIELD PREVIOUSLY VALIDATED?                  
         BO    VCIDX               YES - EXIT                                   
         SPACE 1                                                                
         NI    MENADVH+4,X'DF'     SET ADVICE FIELD NOT VALIDATED               
         MVI   MAINEXST,C'Y'                                                    
         SPACE 1                                                                
         MVI   VERLIFT,C'N'        SET NO VERSION OR LIFT                       
         XC    COCLG,COCLG         CLEAR COM CLIENT GROUP                       
         XC    SVEXP,SVEXP         CLEAR COM EXPIRTATION DATE                   
         XC    SVEXP2,SVEXP2                                                    
         USING CSINFOD,RE                                                       
         L     RE,ACSINFO                                                       
         XC    CSINFO,CSINFO       CLEAR COM STUDIO INFORMATION                 
         DROP  RE                                                               
         L     RE,AELTAOC                                                       
         XC    0(TAOCLNQ,RE),0(RE) CLEAR OLD AGENCY/CID ELEMENT                 
         SPACE 1                                                                
         MVC   AIO,AIO2            READ FOR COMMERCIAL RECORD                   
         GOTO1 RECVAL,DMCB,(X'20',TLCOICDQ),(X'24',(R2))                        
         BE    *+12                                                             
         BAS   RE,NOCOM            IF COMMERCIAL/VERSION NOT FOUND              
         B     VCIDX               CALL NOCOM                                   
         SPACE 1                                                                
         USING TLCOPD,R3                                                        
         LA    R3,KEY                                                           
         MVC   TGCOM,TLCOICOM                                                   
         MVC   TGVER,TLCOIVER                                                   
         DROP  R3                                                               
         SPACE 1                                                                
         CLI   TGVER,26                                                         
         BNH   VCID10                                                           
         GOTO1 RECVAL,DMCB,TLCOCCDQ,(X'A4',0)                                   
         BE    VCID10                                                           
         DC    H'00'                                                            
         SPACE 1                                                                
VCID10   CLI   ACTNUM,ACTADD       IF COMMERCIAL/VERSION FOUND AND              
         BNE   *+12                ACTION IS ADD CALL COMFND                    
         BAS   RE,COMFND                                                        
         B     VCIDX                                                            
         SPACE 1                                                                
         CLI   TGVER,0             IF VERSION IS FOUND AND ACTION               
         BE    *+8                 IS NOT ADD CALL NOCOM                        
         BAS   RE,NOCOM            IF COM IS FOUND AND ACTION IS NOT            
         BAS   RE,COMFND           ADD CALL COMFND                              
         SPACE 1                                                                
VCIDX    CLI   ACTNUM,ACTADD                                                    
         BE    *+16                                                             
         MVC   TGCID,MENCID                                                     
         OC    TGCID,SPACES                                                     
         OI    4(R2),X'20'         SET COMMERICAL VALIDATED                     
         MVC   AIO,AIO1            RESET AIO TO ADVICE RECORD                   
         B     XIT                                                              
         EJECT                                                                  
*              VCID ROUTINE FOR WHEN COMMERICAL DOES NOT EXIST                  
         SPACE 1                                                                
NOCOM    NTR1                                                                   
         CLI   ERROR,0             IF ADVICE COMMERCIAL NO LONGER               
         BNE   NOCOM10             EXISTS AS A MAIN, SET STATUS                 
         CLI   ACTNUM,ACTADD                                                    
         BE    NOCOM10                                                          
         MVI   MAINEXST,C'N'                                                    
         B     NOCOM20                                                          
         SPACE 1                                                                
NOCOM10  CLI   ERROR,NOTFOUND      IF RECVAL FAILED FOR SOME REASON             
         BNE   THEEND              OTHER THAN 'RECORD NOT FOUND' GIVE           
         SPACE 1                                                                
NOCOM20  MVI   COMEXIST,C'N'       SET COMMERCIAL DOES NOT EXIST                
         MVI   COMCTYPE,0                                                       
         XC    COMAIR,COMAIR                                                    
         XC    COMSAIR,COMSAIR                                                  
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ACTION IS ADD                             
         BNE   NOCOMX                                                           
         XC    TGCLI,TGCLI                                                      
         LA    RE,MENCLINH         CLIENT FIELD IS FIRST FIELD TO               
*        ST    RE,ACURFORC         REQUIRE INPUT                                
NOCOMX   B     XIT                                                              
         EJECT                                                                  
*              VCID ROUTINE FOR WHEN COMMERCIAL DOES EXIST                      
         SPACE 1                                                                
COMFND   NTR1                                                                   
         MVI   COMEXIST,C'Y'                 SET COMMERICAL DOES EXIST          
         SPACE 1                                                                
         TM    MENCIDNH+4,X'80'                                                 
         BO    COMFND10                                                         
         GOTO1 CHAROUT,DMCB,TANAELQ,MENCIDNH       DISPLAY COM'L TITLE          
         SPACE 1                                                                
COMFND10 TM    MENLIDH+4,X'80'                                                  
         BO    COMFND20                                                         
         GOTOR DISLIFT                                    LIFT DETAILS          
         SPACE 1                                                                
COMFND20 TM    MENCON1H+4,X'80'                                                 
         BO    COMFND30                                                         
         GOTOR DISCONS                        AND AFM CONTRACT NUMBERS          
         SPACE 1                                                                
COMFND30 GOTO1 EXTRACT             EXTRACT GLOBAL VALUES                        
         BAS   RE,VERCHK           VERSION CHECK AND SAVE                       
         BAS   RE,TACOINFO         SAVE AND DISPLAY COMMERCIAL DETAILS          
         BAS   RE,CLIINFO          SAVE AND DISPLAY CLIENT INFO                 
         BRAS  RE,PRDINFO          DISPLAY PRODUCT INFO                         
         BAS   RE,BLDCSTU          SAVE COMMERCIAL STUDIO INFO                  
         BAS   RE,TAOCINFO         SAVE OLD AGENCY/CID ELEMENT                  
COMFNDX  MVC   AIO,AIO2            RESTORE AIO TO COMMERICAL                    
         B     XIT                                                              
         SPACE 2                                                                
*              ROUTINE TO SAVE AND DISPLAY COMMERCIAL DETAILS                   
         SPACE 1                                                                
TACOINFO NTR1                                                                   
         L     R4,AIO              R4=A(COMMERICAL RECORD)                      
         MVI   ELCODE,TACOELQ                                                   
         BRAS  RE,GETEL            R4=A(COMMERCIAL DETAILS ELEMENT)             
         BE    *+6                                                              
         DC    H'00'                                                            
         USING TACOD,R4                                                         
         MVC   COCLG,TACOCLG       SAVE COMMERCIAL CLIENT GROUP                 
         MVC   COMMEDIA,TACOMED    MEDIA                                        
         MVC   COMSTAT,TACOSTAT    STATUS                                       
         MVC   COMSTA2,TACOSTA2    STATUS 2                                     
         MVI   COMSTA3,0                                                        
         CLI   TACOLEN,TACOLNQ2                                                 
         BL    *+10                                                             
         MVC   COMSTA3,TACOSTA3    STATUS 3                                     
         MVC   COMSTATE,TACOADST   STATE                                        
         MVC   COMFFCYC,TACOFCYC   AND FIRST FIXED CYCLE                        
         SPACE 1                                                                
         GOTO1 CTYPVAL,DMCB,TACOTYPE SET COMMERCIAL TYPE VARIABLES              
         MVC   COMCTYPE,TACOTYPE                                                
         SPACE 1                                                                
         MVC   COMAIR,TACOAIR      SAVE AIR DATES                               
         MVC   COMSAIR,TACOSAIR                                                 
         SPACE 1                                                                
         TM    MENMEDH+4,X'80'                                                  
         BO    TACOIN10                                                         
         MVC   MENMED,TACOMED                      DISPLAY MEDIA                
         MVI   MENMEDH+5,L'TACOMED                                              
         SPACE 1                                                                
TACOIN10 TM    MENMEDH+4,X'80'                                                  
         BO    TACOIN20                                                         
         EDIT  TACOSEC,MENSEC,ALIGN=LEFT           MEDIA LENGTH                 
         STC   R0,MENSECH+5                                                     
         SPACE 1                                                                
TACOIN20 TM    MENEXPH+4,X'80'                                                  
         BO    COMFNDX                                                          
         OC    TACOEXP,TACOEXP                                                  
         BZ    COMFNDX                                                          
         GOTO1 DATCON,DMCB,(1,TACOEXP),(8,MENEXP)  EXPIRATION DATE              
         MVC   SVEXP,MENEXP                                                     
         MVC   SVEXP2,TACOEXP                                                   
         MVI   MENEXPH+5,8                                                      
         B     COMFNDX                                                          
         SPACE 2                                                                
*              SAVE AND DISPLAY COMMERCIAL'S CLIENT INFO                        
         SPACE 1                                                                
CLIINFO  NTR1                                                                   
         MVC   AIO,AIO3                                                         
         GOTO1 RECVAL,DMCB,TLCLCDQ,(X'20',0)   AIO3=A(CLIENT RECORD)            
         BNE   COMFNDX                                                          
         TM    MENCLINH+4,X'80'                                                 
         BO    CLIINF10                                                         
         GOTO1 CHAROUT,DMCB,TANAELQ,MENCLINH   DISPLAY CLIENT NAME              
CLIINF10 MVC   NWKREQ,AGYNWKRQ     SAVE WHETHER CLIENT REQUIRED NETWORK         
         BRAS  RE,GETRULES         FOR CLA USES - DEFAULT TO AGY VALUE          
         SPACE 1                                                                
         L     R4,AIO              R4=A(CLIENT RECORD)                          
         MVI   ELCODE,TACIELQ                                                   
         BRAS  RE,GETEL            R4=A(CLIENT INFO ELEMENT)                    
         BNE   COMFNDX                                                          
         USING TACID,R4                                                         
         TM    TACISTAT,TACIDCAE   IF DON'T CLEAR EST# ON                       
         BZ    COMFNDX                                                          
         OI    AGYSTA4,TAAYDCAE    SET SWITCH ON                                
         TM    TACISTAT,TACISCOD   IF C.O.D. CLIENT ON                          
         BZ    COMFNDX                                                          
         OI    AGYSTAT,TAAYSCOD    SET SWITCH ON                                
         B     COMFNDX                                                          
         SPACE 2                                                                
*              ROUTINE TO SAVE COMMERCIAL STUDIO INFO                           
*              (INFO NEEDED FOR SESSION ADVICES)                                
         SPACE 1                                                                
BLDCSTU  NTR1                                                                   
         L     R3,ACSINFO                                                       
         USING CSINFOD,R3                                                       
         SPACE                                                                  
         MVI   ELCODE,TACSELQ                                                   
         GOTO1 GETL,DMCB,(1,=AL1(TACSTYPF))                                     
         BNE   BLDCSTU5                                                         
         L     R4,TGELEM          R4=A(COMMERCIAL STUDIO ELEMENT                
         USING TACSD,R4                /TYPE FILM)                              
         MVC   CSFINFO,TACSDATE   SAVE DATE, STUDIO AND CITY                    
         CLI   TACSLEN,TACSLNQ                                                  
         BE    BLDCSTU5                                                         
         MVC   CSFSTAT,SPACES                                                   
         SPACE 1                                                                
BLDCSTU5 GOTO1 GETL,DMCB,(1,=AL1(TACSTYPR))                                     
         BNE   XIT                                                              
         L     R4,TGELEM          R4=A(COMMERCIAL STUDIO ELEMENT                
         USING TACSD,R4                /TYPE RECORD)                            
         MVC   CSRINFO,TACSDATE   SAVE DATE, STUDIO AND CITY                    
         CLI   TACSLEN,TACSLNQ                                                  
         BE    XIT                                                              
         MVC   CSRSTAT,SPACES                                                   
         B     XIT                                                              
         DROP  R3,R4                                                            
         SPACE 2                                                                
*              ROUTINE TO SAVE COMMERCIAL'S OLD AGENCY/CID ELEMENT              
         SPACE 1                                                                
TAOCINFO NTR1                                                                   
         L     R4,AIO              R4=A(COMMERICAL RECORD)                      
         MVI   ELCODE,TAOCELQ                                                   
         BAS   RE,GETEL            R4=A(OLD AGENCY CID ELEMENT)                 
         BNE   TAOCIX                                                           
         L     RE,AELTAOC                                                       
         MVC   0(TAOCLNQ,RE),0(R4)                                              
TAOCIX   B     XIT                                                              
         SPACE 2                                                                
*              IF INPUTTED COMMERCIAL IS A VERSION, MOVE VERSION LETTER         
*              TO VERSION FIELD AND COMMERCIAL NAME TO COMMERCIAL FIELD         
*              IF INPUTTED COMMERCIAL IS REGULAR COMMERCIAL, SAVE ITS           
*              VERSIONS INTO WORKING STORAGE                                    
         SPACE 1                                                                
VERCHK   NTR1                                                                   
         CLI   ACTNUM,ACTADD       IF ADDING AND                                
         BNE   VERCK20                                                          
         CLI   TGVER,0             IF COMMERCIAL IS A VERSION                   
         BE    VERCK20                                                          
         MVI   VERLIFT,C'V'        SET VERLIFT TO V                             
         EDIT  TGVER,MENVER,ALIGN=LEFT                                          
         STC   R0,MENVERH+5                                                     
         OI    MENVERH+6,X'80'                                                  
         SPACE 1                                                                
VERCK10  L     R4,AIO              R4=A(COMMERCIAL RECORD)                      
         USING TACOD,R4                                                         
         MVI   ELCODE,TACOELQ                                                   
         BRAS  RE,GETEL            R4=A(COMMERICAL DETAILS ELEMENT)             
         BE    *+6                                                              
         DC    H'00'                                                            
         MVC   MENCID,TACOCID      MOVE COMMERICAL ID TO COMMERCIAL             
         OI    MENCIDH+6,X'80'     SCREEN FIELD                                 
*        B     XIT                                                              
         SPACE 1                                                                
VERCK20  L     R2,AVERSION         PREPARE TO SAVE COMM'LS VERSIONS             
         XC    0(250,R2),0(R2)                                                  
         SPACE 1                                                                
         L     R4,AIO              SAVE VERSIONS FROM COMM'L RECORDS            
         USING TAVRD,R4                                                         
         MVI   ELCODE,TAVRELQ                                                   
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
VERCK30  BRAS  RE,NEXTEL                                                        
         BNE   VERCK50                                                          
VERCK40  MVI   VERLIFT,C'V'                                                     
         MVC   0(1,R2),TAVRVERS                                                 
         LA    R2,1(R2)                                                         
         B     VERCK30                                                          
         SPACE 1                                                                
VERCK50  L     R4,AIO                                                           
         MVC   KEYSAVE(L'TLCOKEY),0(R4)                                         
         SPACE 1                                                                
VERCK60  ZIC   RE,KEYSAVE+TLCOVER-TLCOD                                         
         AHI   RE,1                                                             
         CHI   RE,TLCOV250                                                      
         BH    VERCK70                                                          
         STC   RE,KEYSAVE+TLCOVER-TLCOD                                         
         SPACE 1                                                                
         XC    KEY,KEY                                                          
         MVC   KEY(L'TLCOKEY),KEYSAVE                                           
         GOTO1 HIGH                                                             
         CLC   KEY(L'TLCOKEY),KEYSAVE                                           
         BNE   VERCK60                                                          
         GOTO1 GETREC                                                           
         BRAS  RE,GETEL                                                         
         BE    VERCK40                                                          
         B     VERCK60                                                          
         SPACE 1                                                                
VERCK70  XC    KEY,KEY                                                          
         MVC   KEY(L'TLCOKEY),KEYSAVE                                           
         MVI   KEY+TLCOVER-TLCOD,TLCOV026                                       
         GOTO1 HIGH                                                             
         CLC   KEY(L'TLCOKEY),KEYSAVE                                           
         BE    *+6                                                              
         DC    H'00'                                                            
         GOTO1 GETREC                                                           
         B     COMFNDX                                                          
         EJECT                                                                  
*              VALIDATE ADVICE CODE PORTION OF ADVICE RECORD KEY                
         SPACE 1                                                                
VALADV   NTR1                                                                   
         LA    R2,MENADVH          R2=A(ADVICE FIELD)                           
         CLI   ACTNUM,ACTADD                                                    
         BNE   VADV10                                                           
         TM    AGYSTA3,TAAYSADV    AGENCY SET TO GENERATE                       
         BO    VADV10              ADVICE #'S AUTOMATICALLY                     
         ZIC   RF,MENADVH+5                                                     
         LA    R1,MENADV                                                        
ADV05    CLI   0(R1),C'-'          DISALLOW - = ,                               
         BE    ERRINV                                                           
         CLI   0(R1),C'='                                                       
         BE    ERRINV                                                           
         CLI   0(R1),C','                                                       
         BE    ERRINV                                                           
         AHI   R1,1                                                             
         BCT   RF,ADV05                                                         
         SPACE 1                                                                
VADV10   CLI   LWRSCR,SCR8C        IF ON MENU SCREEN                            
         BNE   VADV20                                                           
         MVI   FRSTSEQ,0           CLEAR DISPLAYED SEQUENCE #'S                 
         MVI   LASTSEQ,0                                                        
         XC    LASTCODE,LASTCODE                                                
         XC    LASTDATE,LASTDATE                                                
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ADDING ON MENU SCREEN                     
         BNE   VADV20                                                           
         TM    AGYSTA3,TAAYSNCS    AND AGENCY SET TO SHOW CAST MEMBERS          
         BO    VADV20                                                           
         MVI   NEEDPULL,C'Y'       NEED TO PULL NEW CAST                        
         B     VADV30                                                           
         SPACE 1                                                                
VADV20   CLI   ACTNUM,ACTADD       IF ACTION NOT ADD                            
         BE    VADV30              BUILD ADVICE KEY                             
         CLI   RECNUM,PV                                                        
         BNE   VADV21                                                           
         GOTO1 RECVAL,DMCB,TLPVCDQ,(X'40',(R2)),('TLPVSCDQ',0)                  
         B     VADV60                                                           
VADV21   GOTO1 RECVAL,DMCB,TLDVCDQ,(X'40',(R2))                                 
         B     VADV60                                                           
         SPACE 1                                                                
*                                  IF ACTION ADD AND                            
VADV30   TM    AGYSTA3,TAAYSADV    AGENCY *NOT* SET TO GENERATE                 
         BO    VADV40              ADVICE #'S AUTOMATICALLY                     
VADV35   GOTO1 RECVAL,DMCB,TLDVCDQ,(X'40',(R2))   BUILD ADVICE KEY              
         GOTO1 HIGH                                                             
         CLC   KEY(L'TLDVKEY),KEYSAVE    ADVICE CANNOT ALREADY EXIST            
         BE    RECONFIL                                                         
         MVC   KEY(L'TLDVKEY),KEYSAVE    RESTORE KEY                            
         B     VADV60                                                           
         SPACE 1                                                                
VADV40   XC    KEY,KEY             IF ACTION ADD AND AGENCY SET TO GEN          
         MVI   KEY,TLDVCDQ         ADVICE #'S AUTOMATICALLY ... BUILD           
         MVC   KEY+TLDVAGY-TLDVD(L'TGAGY),TGAGY           PARTIAL KEY           
         MVC   KEY+TLDVCID-TLDVD(L'TGCID),TGCID                                 
         XC    TGADV,TGADV                                                      
         SPACE 1                                                                
VADV60   CLI   ACTNUM,ACTVER       IF ACTION VERIFY                             
         BNE   *+16                                                             
         NI    STATUS,ALL-WAITSPFK CLEAR SEND WAITING FOR PF KEY                
         NI    WSPSTAT,ALL-NEEDDET                                              
         B     VADV70                                                           
         NI    STATUS,ALL-WAITVPFK OTHERWISE, CLEAR VERIFY WAIT FOR PF          
         SPACE 1                                                                
         CLI   ACTNUM,ACTDEL       IF ACTION IS NOT DELETE                      
         BE    VADV70                                                           
         CLI   ACTNUM,ACTSEND      OR SEND                                      
         BE    VADV70                                                           
         CLI   ACTNUM,ACTSEL       OR DELETING FROM LIST                        
         BNE   *+12                                                             
         CLI   THISLSEL,C'D'                                                    
         BE    VADV70                                                           
         NI    STATUS,ALL-WAITSPFK CLEAR SEND WAITING FOR PF KEY                
         NI    WSPSTAT,ALL-NEEDDET                                              
         B     VADVX                                                            
         SPACE 1                                                                
VADV70   GOTO1 READ                IF ACTION IS VERIFY, DELETE OR SEND          
         GOTO1 GETREC              GET ADVICE RECORD                            
         SPACE 1                                                                
         CLI   ACTNUM,ACTDEL       IF ACTION IS DELETE                          
         BE    VADV80                                                           
         CLI   ACTNUM,ACTSEL       OR DELETING FROM LIST                        
         BNE   *+12                                                             
         CLI   THISLSEL,C'D'                                                    
         BE    VADV80                                                           
         TM    4(R2),X'20'         OR ADVICE FIELD CHANGED                      
         BO    VADV90                                                           
VADV80   NI    STATUS,ALL-WAITVPFK-WAITSPFK  CLR VERIFY/SEND PENDING            
         NI    STATUS,ALL-NEEDDET                                               
         SPACE 1                                                                
VADV90   L     R4,AIO                                                           
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TADVD,R4                                                         
         CLI   ACTNUM,ACTVER       IF ACTION IS VERIFY                          
         BNE   *+12                                                             
         TM    TADVSTAT,TADVSVER   ADVICE CANNOT ALREADY BE VERIFIED            
         BO    VERIFIED                                                         
         SPACE 1                                                                
         CLI   ACTNUM,ACTDEL       IF ACTION IS DELETE                          
         BE    VADV100             ADVICE CANNOT BE SENT AND NOT                
         CLI   ACTNUM,ACTSEL       OR DELETING FROM LIST                        
         BNE   VADVX                                                            
         CLI   THISLSEL,C'D'                                                    
         BNE   VADVX                                                            
*        TM    TADVSTAT,TADVSSNT+TADVSRCV               RECEIVED                
*        BM    NODELETE                                                         
VADV100  TM    TADVSTAT,TADVSSNT                                                
         BNZ   NODELETE                                                         
VADVX    OI    4(R2),X'20'         SET FIELD VALIDATED                          
         B     XIT                                                              
         EJECT                                                                  
*              ROUTINE TO SET USESES VARIABLE ('ASSIGNED' IF ADVICE             
*              ALREADY DECLARED AS SESSION OR ADVICE) ('NASSIGND'               
*              IF ADVICE NOT ALREADY DECLARED AS SESSION OR ADVICE)             
*              AND DETERMINE WHETHER ADVICE SHOULD REALLY BE ADDED              
*              AT THIS TIME                                                     
         SPACE 1                                                                
STUSESES NTR1                                                                   
         CLI   ACTNUM,ACTADD       IF ACTION NOT ADD                            
         BE    ST05                                                             
         MVI   USESES,ASSIGNED     SET USESES AS ASSIGNED                       
         B     STX                 AND EXIT                                     
         SPACE 1                                                                
ST05     CLI   LWRSCR,SCR8C        IF ADDING ON MENU SCREEN                     
         BNE   ST10                                                             
         MVI   USESES,NASSIGND     SET USESES AS NOT YET ASSIGNED               
         MVI   IOOPT,C'Y'          SET DO NOT REALLY ADD ADVICE                 
         B     STX                 AND EXIT                                     
         SPACE 1                                                                
ST10     MVI   USESES,ASSIGNED     IF ADDING ON NON-MENU SCREEN AND             
         CLI   PFAID,14            IF FLIP BACK TO MENU PFKEY NOT HIT           
         BNE   STX                 USE MUST BE ENTERED                          
         SPACE 1                                                                
         CLI   LWRSCR,SCR04        IF ADDING ON SESS SCREEN & FLIP BACK         
         BE    ST40                TO MENU PFKEY HIT DO NOT ADD ADVICE          
         SPACE 1                                                                
         LA    R1,SDATTAB          IF ON NON-SESSION SCREEN AND FLIP            
ST20     CLI   0(R1),X'FF'         BACK TO MENU PFKEY HIT                       
         BNE   *+6                                                              
         DC    H'00'                                                            
         CLC   LWRSCR,0(R1)        R1=A(CURRENT SCREEN'S ENTRY IN               
         BE    ST30                     SDATTAB)                                
         LA    R1,7(R1)                                                         
         B     ST20                                                             
         SPACE 1                                                                
ST30     ZICM  R2,1(R1),2                                                       
         AR    R2,RA               IF REGULAR CYCLE START DATE INPUTTED         
         CLI   5(R2),0             REALLY ADD ADVICE (EXIT)                     
         BNE   STX                                                              
*                                  IF REG CYCLE START DATE NOT ENTERED          
         ZIC   R4,3(R1)            R4=NUMBER OF MAJ/MIN FLDS FOLLOWING          
         LR    R3,R2               REGULAR CYCLE START                          
ST35     ZIC   RF,0(R3)                                                         
         AR    R3,RF               IF ANY CHECKED, GIVE MISSING ERROR           
         TM    1(R3),X'20'         AT REGULAR CYCLE START DATE                  
         BO    ST35                                                             
         CLI   5(R3),0                                                          
         BNE   STMIS                                                            
         BCT   R4,ST35                                                          
         SPACE 1                                                                
         ZICM  R2,4(R1),2                                                       
         AR    R2,RA               IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0             REALLY ADD ADVICE (EXIT)                     
         BNE   STX                                                              
*                                  IF MUS CYCLE START DATE NOT ENTERED          
         ZIC   R4,6(R1)            R4=NUMBER OF MAJ/MIN FLDS FOLLOWING          
         LR    R3,R2               MUSIC CYCLE START                            
ST36     ZIC   RF,0(R3)                                                         
         AR    R3,RF               IF ANY CHECKED, GIVE MISSING ERROR           
         TM    1(R3),X'20'         AT MUSIC CYCLE START DATE                    
         BO    ST36                                                             
         CLI   5(R3),0                                                          
         BNE   STMIS                                                            
         BCT   R4,ST36                                                          
         SPACE 1                                                                
ST40     MVI   USESES,NASSIGND     OTHERWISE, SET UENTER TO NO USE YET          
         MVI   IOOPT,C'Y'          ASSIGNED AND DO NOT REALLY ADD ADV           
         SPACE 1                                                                
         L     R4,AIO                                                           
         L     R5,AFAKEREC         SAVE FAKEREC INTO AIO                        
         LA    R3,8                FOR MENU SCREEN DISPLAY                      
ST50     MVC   0(250,R4),0(R5)                                                  
         LA    R4,250(R4)                                                       
         LA    R5,250(R5)                                                       
         BCT   R3,ST50                                                          
         BAS   RE,FLIPCHK          FLIP BACK TO MENU SCREEN                     
STX      B     XIT                                                              
         SPACE 2                                                                
STMIS    MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
SDATTAB  DC    X'F0',AL2(TELCYSTH-T702FFD),AL1(41)                              
         DC    AL2(TELMUSTH-T702FFD),AL1(17)                                    
         DC    X'F1',AL2(RADCCSTH-T702FFD),AL1(31)                              
         DC    AL2(RADMUSTH-T702FFD),AL1(21)                                    
         DC    X'F2',AL2(ADDCYSTH-T702FFD),AL1(20)                              
         DC    AL2(ADDMCSTH-T702FFD),AL1(12)                                    
         DC    X'F3',AL2(SPACCSTH-T702FFD),AL1(22)                              
         DC    AL2(SPAMUSTH-T702FFD),AL1(8)                                     
         DC    X'F4',AL2(CANCCSTH-T702FFD),AL1(18)                              
         DC    AL2(CANMUSTH-T702FFD),AL1(11)                                    
         DC    X'0E',AL2(CLACCSTH-T702FFD),AL1(104)                             
         DC    AL2(CLAMUSTH-T702FFD),AL1(6)                                     
         DC    X'98',AL2(CBLCCSTH-T702FFD),AL1(81)                              
         DC    AL2(CBLMUSTH-T702FFD),AL1(19)                                    
         DC    X'53',AL2(INMCCSTH-T702FFD),AL1(40)                              
         DC    AL2(INMMUSTH-T702FFD),AL1(16)                                    
         DC    X'FF'                                                            
         EJECT                                                                  
*              ROUTINE TO DISPLAY KEY OF SELECTED ADVICE RECORD                 
         SPACE                                                                  
DKEY     NTR1                                                                   
         L     R4,AIO                                                           
         USING TLDVD,R4                                                         
         MVC   MENAGY,TLDVAGY      AGENCY                                       
         OI    MENAGYH+6,X'80'                                                  
         NI    MENAGYH+4,X'DF'                                                  
         MVI   MENAGYH+5,L'MENAGY                                               
         SPACE                                                                  
         MVC   MENCID,TLDVCID      COMMERCIAL ID                                
         OI    MENCIDH+6,X'80'                                                  
         NI    MENCIDH+4,X'DF'                                                  
         MVI   MENCIDH+5,L'MENCID                                               
         SPACE                                                                  
         MVC   MENADV,TLDVADV      ADVICE NUMBER                                
         OI    MENADVH+6,X'80'                                                  
         NI    MENADVH+4,X'DF'                                                  
         MVI   MENADVH+5,L'MENADV                                               
         B     XIT                                                              
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE CALLS VARIOUS SUBROUTINES TO DISPLAY                     
*              DIFFERENT ADVICE RECORD SCREENS                                  
         SPACE 1                                                                
DREC     NTR1                                                                   
         GOTO1 FLDVAL,DMCB,(X'01',MENVERH),(X'80',999) CLEAR SCREEN             
         MVC   MENVED,SPACES                                                    
         OI    MENVEDH+6,X'80'                                                  
         SPACE 1                                                                
         NI    STATUS2,X'FF'-DSPNXTPG                                           
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAFNELQ                                                   
         GOTO1 GETL,DMCB,(1,=AL1(TAFNTVER))                                     
         BNE   DREC01                                                           
         USING TAFND,R4            R4=A(VERSION/LIFT ELEMENT)                   
         L     R4,TGELEM                                                        
         MVC   MENVER(1),TAFNNAME  MOVE VERSION/LIFT TO SCREEN                  
         OI    MENVERH+4,X'20'                                                  
         OI    MENVERH+6,X'80'                                                  
         CLI   VERLIFT,C'V'                                                     
         BNE   DREC01A                                                          
         EDIT  (1,TAFNNAME),MENVER,ALIGN=LEFT                                   
DREC01A  MVC   VERVALUE,TAFNNAME                                                
         CLI   COMEXIST,C'Y'       IF COMMERICIAL EXISTS                        
         BNE   DREC01                                                           
         MVC   AIO,AIO2            READ FOR COMMERCIAL RECORD                   
         GOTO1 RECVAL,DMCB,TLCOICDQ,(X'24',MENCIDH)                             
         BE    DREC01B                                                          
         CLI   MAINEXST,C'N'                                                    
         BE    DREC01B                                                          
         DC    H'00'                                                            
         SPACE 1                                                                
DREC01B  BRAS  RE,VER2SCR          MOVE VERSION DESCRIPTION TO SCREEN           
         SPACE 1                                                                
DREC01   MVC   AIO,AIO1                                                         
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         SPACE 1                                                                
         CLI   LWRSCR,SCR8C        IF ON MENU SCREEN                            
         BNE   DREC05                                                           
         GOTOR DMENTOP             DISPLAY TOP OF MENU SCREEN                   
         GOTOR DMENBOT             DISPLAY BOTTOM OF MENU SCREEN                
         OI    MENAGYH+6,X'C0'     POSITION CURSOR AT AGENCY                    
         B     DREC90                                                           
         SPACE 1                                                                
DREC05   LA    R2,MENTAGH          IF NOT ON MENU SCREEN                        
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         OI    6(R2),X'C0'         POSITION CURSOR TO START DATE                
         SPACE 1                                                                
         CLI   LWRSCR,SCR04        IF ON SESSION SCREEN                         
         BNE   DREC06                                                           
         GOTOR DISSES              DISPLAY SESSION DATA                         
         BAS   RE,PGDISP           DISPLAY PAGE NUMBER                          
         B     DREC90                                                           
         SPACE 1                                                                
DREC06   MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BE    *+6                                                              
         DC    H'00'                                                            
         SPACE 1                                                                
         ST    R4,ATAVUEL                                                       
         SPACE 1                                                                
         CLI   LWRSCR,SCRF0        IF ON TELEVISION SCREEN                      
         BNE   DREC20                                                           
         GOTOR DISTV               DISPLAY TELEVISION DATA                      
         B     DREC90                                                           
         SPACE 1                                                                
DREC20   CLI   LWRSCR,SCRF1        IF ON RADIO SCREEN                           
         BNE   DREC30                                                           
         GOTOR DISRAD              DISPLAY RADIO DATA                           
         B     DREC90                                                           
         SPACE 1                                                                
DREC30   CLI   LWRSCR,SCRF2        IF ON ADDENDUM SCREEN                        
         BNE   DREC40                                                           
         GOTOR DISADD              DISPLAY ADDENDUM DATA                        
         B     DREC90                                                           
         SPACE 1                                                                
DREC40   CLI   LWRSCR,SCRF3        IF ON SPANISH SCREEN                         
         BNE   DREC50                                                           
         GOTOR DISSPA              DISPLAY SPANISH DATA                         
         B     DREC90                                                           
         SPACE 1                                                                
DREC50   CLI   LWRSCR,SCRF4        IF ON CANADIAN SCREEN                        
         BNE   DREC60                                                           
         GOTOR DISCAN              DISPLAY CANADIAN DATA                        
         B     DREC90                                                           
         SPACE 1                                                                
DREC60   CLI   LWRSCR,SCR0E        IF ON CLASS A SCREEN                         
         BNE   DREC70                                                           
         GOTOR DISCLA              DISPLAY CLASS A DATA                         
         BAS   RE,PGDISP           DISPLAY PAGE NUMBER                          
         B     DREC90                                                           
         SPACE 1                                                                
DREC70   CLI   LWRSCR,SCR98        IF ON CABLE SCREEN                           
         BNE   DREC80                                                           
         GOTOR DISCBL              DISPLAY CABLE DATA                           
         BAS   RE,PGDISP           DISPLAY PAGE NUMBER                          
         B     DREC90                                                           
         SPACE 1                                                                
DREC80   CLI   LWRSCR,SCR53        IF ON INTERNET/NEWMEDIA SCREEN               
         BE    *+6                                                              
         DC    H'00'                                                            
         GOTOR DISINM              DISPLAY INTERNET/NEWMEDIA DATA               
         SPACE 1                                                                
DREC90   CLI   MAINEXST,C'N'                                                    
         BNE   DRX                                                              
         MVI   MYMSGNO1,248                                                     
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
DRX      XIT1                                                                   
         EJECT                                                                  
*              ROUTINE DISPLAYS PAGE NUMBERS AND TOTAL NUMBER OF                
*              PAGES ON TOP OF SCREEN                                           
         SPACE 1                                                                
PGDISP   NTR1                                                                   
         CLI   MODE,XRECREST      IF RESTORING                                  
         BE    *+12                                                             
         CLI   MODE,XRECDEL       OR DELETING RECORD                            
         BNE   PGD0                                                             
         MVI   FRSTSEQ,0          CLEAR DISPLAYED SEQUENCE NUMBERS              
         MVI   LASTSEQ,0                                                        
         XC    LASTCODE,LASTCODE                                                
         XC    LASTDATE,LASTDATE                                                
         B     DRX                                                              
         SPACE 1                                                                
PGD0     CLI   PFAID,0             IF SCREEN HAS NOT SCROLLED                   
         BE    PGD1                EXIT                                         
         CLI   PFAID,15                                                         
         BNE   DRX                                                              
         SPACE 1                                                                
PGD1     CLI   SELECT,C'Y'                                                      
         BNE   PGD1A                                                            
         CLC   THISPG,NPAGES                                                    
         BE    PGD1A                                                            
         OI    STATUS2,DSPNXTPG                                                 
         SPACE 1                                                                
PGD1A    MVI   MYMSGNO1,54         PAGE X OF Y DISPLAYED                        
         L     R2,EFHREC                                                        
         SPACE 1                                                                
         CLI   ACTNUM,ACTDIS       IF ACTION NOT DISPLAY                        
         BE    PGD2                                                             
         MVI   MYMSGNO1,55          ... - ENTER CHANGES AS DESIRED              
         SPACE 1                                                                
         CLI   MODE,XRECPUT        IF RECORD WAS JUST PUT                       
         BNE   *+8                                                              
         MVI   MYMSGNO1,95         RECORD WAS CHANGED - ......                  
         L     R2,AFRSTREC                                                      
         SPACE 1                                                                
PGD2     LA    R1,BLOCK                                                         
         EDIT  THISPG,(2,1(R1)),ALIGN=LEFT                                      
         AHI   R0,1                                                             
         STC   R0,0(R1)                                                         
         AR    R1,R0                                                            
         EDIT  NPAGES,(2,1(R1)),ALIGN=LEFT                                      
         AHI   R0,1                                                             
         STC   R0,0(R1)                                                         
         AR    R1,R0                                                            
         MVI   0(R1),0                                                          
         SPACE 1                                                                
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE CALLS VARIOUS SUBROUTINES TO VALIDATE                    
*              INPUTTED INFORMATION ON DIFFERENT ADVICE RECORD SCREENS          
         SPACE 1                                                                
VREC     NTR1                                                                   
         TM    STATUS,WAITUPFK     IF NEED PFKEY TO VALIDATE UPGRADE            
         BZ    VREC05              FIELD                                        
         L     RE,UPGFLD                                                        
         CLI   8(RE),C'Y'          BUT UPGRADE FIELD HAS BEEN CLEARED           
         BE    VREC05                                                           
         NI    STATUS,ALL-WAITUPFK CLEAR WAITING FOR PFKEY                      
         XC    UPGFLD,UPGFLD                                                    
         SPACE 1                                                                
VREC05   TM    STATUS,WAITLPFK     IF NEED PFKEY TO VALIDATE VER/LIFT           
         BZ    VREC06              FIELD                                        
         CLC   MENVER,SVVER        BUT VERSION/LIFT FIELD HAS CHANGED           
         BE    VREC06                                                           
         NI    STATUS,ALL-WAITLPFK CLEAR WAITING FOR PFKEY                      
         XC    SVVER,SVVER                                                      
         SPACE 1                                                                
VREC06   CLI   ACTNUM,ACTVER       IF ACTION VERIFY                             
         BE    VERIFY              CALL VERIFY ROUTINE AND EXIT                 
         SPACE 1                                                                
         CLI   ACTNUM,ACTSEND      IF ACTION SEND                               
         BE    SEND                CALL SEND ROUTINE AND EXIT                   
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         USING TADVD,R4                                                         
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BNE   VREC10                                                           
         TM    TADVSTAT,TADVSSNT   DON'T ALLOW ANY CHANGES IF SENT              
         BO    ERMENSNT                                                         
         SPACE 1                                                                
VREC10   CLI   LWRSCR,SCR8C        IF ON MENU SCREEN                            
         BNE   VREC30                                                           
         GOTOR VALMEN              VALIDATE MENU DATA                           
         GOTOR VALVOL                                                           
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF FEIGNING ADD ON MENU SCREEN               
         BNE   VREC140                                                          
         L     R4,AIO              SAVE AIO INTO FAKEREC                        
         L     R5,AFAKEREC                                                      
         LA    R3,8                                                             
VREC20   MVC   0(250,R5),0(R4)                                                  
         LA    R4,250(R4)                                                       
         LA    R5,250(R5)                                                       
         BCT   R3,VREC20                                                        
         B     VRX                                                              
         SPACE 1                                                                
VREC30   CLI   ACTNUM,ACTADD       IF REALLY ADDING ON NON-MENU SCREEN          
         BNE   VREC50                                                           
         L     R4,AIO              SAVE FAKEREC INTO AIO                        
         L     R5,AFAKEREC                                                      
         LA    R3,8                                                             
VREC40   MVC   0(250,R4),0(R5)                                                  
         LA    R4,250(R4)                                                       
         LA    R5,250(R5)                                                       
         BCT   R3,VREC40                                                        
         SPACE 1                                                                
VREC50   MVI   ELCODE,TACMELQ      DELETE ALL NON-MENU SCREEN COMMENTS          
         GOTO1 DELL,DMCB,(1,=AL1(TACMTYPU))        AND UPGRADE ELEMENT          
         GOTO1 DELL,DMCB,(1,=AL1(TACMTYPM))                                     
         GOTO1 DELL,DMCB,(1,=AL1(TACMTYPA))                                     
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'00'                                                            
         SPACE 1                                                                
         CLI   LWRSCR,SCR04        IF ON SESSION SCREEN                         
         BNE   VREC60                                                           
         MVI   TADVTYPE,TADVTYPS   SET TYPE AS SESSION                          
         GOTOR VALSES              VALIDATE SESSION SCREEN                      
         B     VREC140                                                          
         SPACE 1                                                                
*                                    TYPECHK1=A(CHECKED OFF SCREEN              
VREC60   XC    TYPECHK1(8),TYPECHK1             FLD FOR REGULAR USE)            
         MVC   TYPECHK1(4),=C'XXXX'  TYPECHK2=A(CHECKED OFF SCREEN              
         XC    TEMPTAVU(TTAVULNQ),TEMPTAVU      FLD FOR MUSIC USE               
         MVI   UPGR,C'N'                                                        
         SPACE 1                                                                
         CLI   LWRSCR,SCRF0        IF ON TELEVISION SCREEN                      
         BNE   VREC70                                                           
         MVI   TADVTYPE,TADVTYPT   SET TYPE AS TELEVISION                       
         GOTOR VALTV               VALIDATE TELEVISION DATA                     
         B     VREC120                                                          
         SPACE                                                                  
VREC70   CLI   LWRSCR,SCRF1        IF ON RADIO SCREEN                           
         BNE   VREC80                                                           
         MVI   TADVTYPE,TADVTYPD   SET TYPE AS RADIO                            
         GOTOR VALRAD              VALIDATE RADIO DATA                          
         B     VREC120                                                          
         SPACE 1                                                                
VREC80   CLI   LWRSCR,SCRF2        IF ON ADDENDUM SCREEN                        
         BNE   VREC90                                                           
         MVI   TADVTYPE,TADVTYPA   SET TYPE AS ADDENDUM                         
         GOTOR VALADD              VALIDATE ADDENDUM DATA                       
         B     VREC120                                                          
         SPACE 1                                                                
VREC90   CLI   LWRSCR,SCRF3        IF ON SPANISH SCREEN                         
         BNE   VREC100                                                          
         MVI   TADVTYPE,TADVTYPP   SET TYPE AS SPANISH                          
         GOTOR VALSPA              VALIDATE SPANISH DATA                        
         B     VREC120                                                          
         SPACE 1                                                                
VREC100  CLI   LWRSCR,SCRF4        IF ON CANADIAN SCREEN                        
         BNE   VREC110                                                          
         MVI   TADVTYPE,TADVTYPN   SET TYPE AS CANADIAN                         
         GOTOR VALCAN              VALIDATE CANADIAN DATA                       
         B     VREC120                                                          
         SPACE 1                                                                
VREC110  CLI   LWRSCR,SCR0E        IF ON CLASS A SCREEN                         
         BNE   VREC115                                                          
         MVI   TADVTYPE,TADVTYPC   SET TYPE AS CLASS A                          
         GOTOR VALCLA              VALIDATE CLASS A DATA                        
         B     VREC120                                                          
         SPACE 1                                                                
VREC115  CLI   LWRSCR,SCR98        IF ON CABLE SCREEN                           
         BNE   VREC116                                                          
         MVI   TADVTYPE,TADVTYPB   SET TYPE AS CABLE                            
         GOTOR VALCBL              VALIDATE CABLE DATA                          
         B     VREC120                                                          
         SPACE 1                                                                
VREC116  CLI   LWRSCR,SCR53        IF ON INTERNET/NEWMEDIA SCREEN               
         BE    *+6                                                              
         DC    H'00'                                                            
         MVI   TADVTYPE,TADVTYPI   SET TYPE AS INTERNET/NEWMEDIA                
         GOTOR VALINM              VALIDATE INTERNET/NEWMEDIA DATA              
         SPACE 1                                                                
VREC120  CLI   UPGR,C'Y'           IF NOT AN UPGRADE                            
         BE    VREC121                                                          
         MVI   ELCODE,TAUPELQ      DELETE OLD UPGRADE ELEMENT                   
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
VREC121  CLI   COMEXIST,C'Y'       IF COMMERCIAL EXISTS                         
         BNE   VREC130                                                          
         BRAS  RE,SETTYPE                                                       
         OC    REGDATE,REGDATE     AND REG CYC START DATE ENTERED               
         BZ    VREC125                                                          
         CLI   USE1,0                                                           
         BE    VREC125                                                          
         GOTO1 USEVAL,DMCB,(X'80',USE1),(X'80',TYPE1)                           
         L     R2,TYPECHK1          VALIDATE REGULAR USE AND TYPE               
         GOTO1 VALTYP,DMCB,VLCOTYPE FOR AGENCY AND COMMERCIAL                   
         BNE   CTYPERR                                                          
         TM    COMSTA2,TACOPCYC                                                 
         BZ    VREC125                                                          
         TM    TGUSSTA2,HLDTYPE                                                 
         BZ    CTYPERR                                                          
         SPACE 1                                                                
VREC125  OC    MUSDATE,MUSDATE     IF MUSIC CYC START DATE ENTERED              
         BZ    VREC130                                                          
         CLI   USE2,0                                                           
         BE    VREC130                                                          
         GOTO1 USEVAL,DMCB,(X'80',USE2),(X'80',TYPE2)                           
         L     R2,TYPECHK2         VALIDATE MUSIC USE AND TYPE                  
         GOTO1 VALTYP,DMCB,VLCOTYPE  FOR AGENCY AND COMMERICAL                  
         BNE   CTYPERR                                                          
         SPACE 1                                                                
VREC130  BRAS  RE,BLDTAVU           BUILD ADVICE USE DETAILS ELEMENT            
         BAS   RE,VALVOL                                                        
VREC140  GOTO1 ACTVIN,DMCB,0        ADD ACTIVITY ELEMENT                        
         BRAS  RE,ADDDUES           BUILD DUE DATE ELEMENT(S)                   
         BAS   RE,GETADV            GET ADVICE NUMBER                           
         BRAS  RE,CHKLEN                                                        
         GOTOR WRTCAST              PUT CAST RECORD(S)                          
VRX      B     XIT                                                              
         SPACE 2                                                                
ERMENSNT MVI   ERROR,ERDVSENT      IF ADVICE ALREADY SENT MAY NOT               
         LA    R2,MENADVH          CHANGE ADVICE                                
         B     *+8                                                              
CTYPERR  MVI   ERROR,ERUSECTY                                                   
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE CONTROLS VERIFYING AN ADVICE                             
         SPACE 1                                                                
VERIFY   MVI   OVERLAY,SCR8C                                                    
         GOTOR GETSCRN             LOAD MENU SCREEN                             
         BAS   RE,DREC             DISPLAY RECORD                               
         SPACE 1                                                                
         CLI   SELECT,C'Y'                                                      
         BE    VER05                                                            
         CLI   TWALACT,ACTSEL                                                   
         BE    VER05                                                            
         CLI   TWALACT,ACTLIST     IF FAKING VERIFY                             
         BNE   VER06                                                            
VER05    MVI   SELECT,C'Y'         SET FAKE VERIFY INDICATOR                    
         MVI   THISLSEL,C'V'                                                    
         MVI   TWALACT,ACTSEL                                                   
         SPACE 1                                                                
VER06    TM    STATUS,WAITVPFK     IF NOT WAITING FOR PFKEY                     
         BO    VER10                                                            
         OI    STATUS,WAITVPFK     SET WAITING FOR PFKEY                        
         OI    MENPF21H+1,X'0C'                                                 
         MVI   MYMSGNO1,66                                                      
         B     VERMSG              GIVE MESSAGE - PFKEY TO VERIFY               
         SPACE 2                                                                
VER10    CLI   PFAID,20            IF WAITING FOR PFKEY AND NOT                 
         BE    VER20               PRESSED - GIVE MESSAGE AGAIN                 
         OI    MENPF21H+1,X'0C'                                                 
         MVI   MYMSGNO1,66                                                      
         B     VERMSG                                                           
         SPACE 1                                                                
VER20    GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0) READ ADVICE FOR UPDATE             
VER30    L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TADVD,R4                                                         
         OI    TADVSTAT,TADVSVER   SET VERIFIED                                 
         MVC   TADVVID,TWAORIG     USER ID                                      
         MVC   TADVVST,TGCTSTAF    STAFF ID                                     
         MVC   TADVVDTE,TGTODAY1   DATE                                         
         TIME  DEC                                                              
         STCM  R0,14,TADVVTIM      TIME                                         
         GOTO1 PUTREC              WRITE ADVICE RECORD BACK                     
         SPACE 1                                                                
         NI    STATUS,X'FF'-WAITVPFK                                            
         NI    MENADVH+4,X'DF'     UNVALIDATE ADVICE FIELD                      
         MVI   PFAID,0             CLEAR PRESSED PF KEY                         
         MVI   MYMSGNO1,51         DISPLAY VERIFIED MESSAGE                     
         BAS   RE,DREC             AND VERIFIED INFORMATION                     
         SPACE 1                                                                
*        CLI   SELECT,C'Y'                                                      
*        BE    *+10                                                             
         MVC   CONACT(7),=C'DISPLAY'                                            
         SPACE 1                                                                
         CLI   SELECT,C'Y'         IF FAKING VERIFY                             
         BNE   VERMSG                                                           
         MVI   THISLSEL,0                                                       
         MVI   SELECT,0            CLEAR FAKE DISPLAY INDICATOR                 
         MVI   VSDONE,C'Y'         SET FAKE VERIFY IS DONE                      
         SPACE 1                                                                
VERMSG   L     R2,EFHREC                                                        
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE CONTROLS SENDING AN ADVICE                               
         SPACE 1                                                                
SEND     MVI   OVERLAY,SCR8C                                                    
         GOTOR GETSCRN             LOAD MENU SCREEN                             
         SPACE 1                                                                
         L     RE,AIO              IF AIO IS EMPTY                              
         CLI   0(RE),TLDVCDQ                                                    
         BE    SND10               PUT ADVICE RECORD INTO IT                    
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
         SPACE 1                                                                
SND10    BAS   RE,DREC             DISPLAY RECORD                               
         SPACE 1                                                                
         L     R4,AIO                                                           
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'00'                                                            
         ST    R4,ATAVUEL          SAVE A(ADVICE USE DETAILS ELEMENT)           
         SPACE 1                                                                
         CLI   SELECT,C'Y'                                                      
         BE    SND20                                                            
         CLI   TWALACT,ACTSEL                                                   
         BE    SND20                                                            
         CLI   TWALACT,ACTLIST                                                  
         BNE   SND30                                                            
SND20    MVI   SELECT,C'Y'                                                      
         MVI   THISLSEL,C'N'                                                    
         MVI   TWALACT,ACTSEL                                                   
         SPACE 1                                                                
         USING TAVUD,R4                                                         
SND30    TM    AGYSTA5,TAAYCIHR    IF AGENCY SET UP FOR CIHR                    
         BZ    SND35               DO NOT ALLOW SEND OF HFEE ADVICES            
         GOTO1 USEVAL,DMCB,(X'C0',TAVUUSE)                                      
         BNE   SND35                                                            
         TM    TGUSSTA2,HLDTYPE                                                 
         BO    CIHRSEND                                                         
         DROP  R4                                                               
         SPACE 1                                                                
SND35    L     R4,AIO                                                           
         MVI   ELCODE,TAMTELQ      ARE THERE ANY CNET/CSYS/MARKET               
         BRAS  RE,GETEL            ELEMENTS ON THIS ADVICE?                     
         BNE   SND39                                                            
*&&DO                                                                           
         SPACE 1                                                                
         USING TAVUD,R4                                                         
         L     R4,ATAVUEL          IF WE RETURN FROM THIS ROUTINE               
         LA    R2,MENAGYH          THEN ALL CNET/CSYS/MKTS WERE FOUND           
         MVC   TGMENAME,TAVUMED    ELSE, MESSAGE RETURNED INSIDE                
         GOTOR CCBLUNIT,DMCB,TAVUUSE                                            
         DROP  R4                                                               
*&&                                                                             
         SPACE 1                                                                
SND39    TM    WSPSTAT,NEEDDET                                                  
         BO    SND40                                                            
         TM    STATUS,WAITSPFK     IF NOT WAITING FOR PFKEY                     
         BO    SND70                                                            
         SPACE 1                                                                
SND40    L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TADVD,R4                                                         
         TM    TADVSTAT,TADVSPAY   IF ADVICE ALREADY PAID                       
         BO    NOSEND              CANNOT SEND                                  
         BRAS  RE,WSPCHECK                                                      
         SPACE 1                                                                
*                                  IF ADVICE NOT ALREADY PAID                   
         OI    STATUS,WAITSPFK     SET WAITING FOR PFKEY                        
         SPACE 1                                                                
         TM    WSPSTAT,NEEDDET                                                  
         BZ    SND50               IF NO DETAILS RECORD ATTACHED                
         OI    MENPF22H+1,X'0C'    TO WSP ADVICE                                
         MVI   MYMSGNO1,115        GIVE MESSAGE INDICATING AS SUCH              
         B     SNDMSG                                                           
         SPACE 1                                                                
SND50    TM    TADVSTAT,TADVSSNT   IF ADVICE ALREADY SENT                       
         BZ    SND60                                                            
         MVI   MYMSGNO1,100        GIVE MESSAGE - ALREADY SENT                  
         B     SNDMSG              SURE YOU WANT TO SEND AGAIN?                 
         SPACE 1                                                                
SND60    OI    MENPF22H+1,X'0C'                                                 
         MVI   MYMSGNO1,67         IF NOT ALREADY SENT                          
         B     SNDMSG              GIVE MESSAGE - PFKEY TO SEND                 
         SPACE 1                                                                
SND70    CLI   PFAID,20            IF WAITING FOR PF KEY AND NOT                
         BE    SND80               PRESSED -  GIVE MESSAGE AGAIN                
         OI    MENPF22H+1,X'0C'                                                 
         MVI   MYMSGNO1,67                                                      
         B     SNDMSG                                                           
         SPACE 1                                                                
SND80    GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)  READ ADVICE FOR UPDATE            
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TADVD,R4                                                         
         TM    TADVSTAT,TADVSSNT   IF ADV ALREADY SENT SKIP TO REPORT           
         BO    SND90                                                            
         OI    TADVSTAT,TADVSSNT   SET SENT                                     
         MVC   TADVSID,TWAORIG     USER ID                                      
         MVC   TADVSST,TGCTSTAF    STAFF ID                                     
         MVC   TADVSDTE,TGTODAY1   DATE                                         
         TIME  DEC                                                              
         STCM  R0,14,TADVSTIM      TIME                                         
         GOTO1 PUTREC              WRITE ADVICE RECORD BACK                     
         BAS   RE,ADDPOINT         UPDATE ADVICE OFFICE POINTER                 
         SPACE 1                                                                
SND90    MVI   WHEN,X'40'          SET AS IF 'NOW' REPORT                       
         MVI   TWAWHEN,0                                                        
         MVC   REMUSER(2),TGCTSTAF SET ID                                       
         MVI   REMUSER+2,C' '                                                   
         GOTO1 OPENPQ              OPEN PQ MYSELF                               
         SPACE 1                                                                
         MVI   OVERLAY,X'8E'       LOAD ADVICE PRINTING PHASE                   
         GOTO1 LOADSOPH,DMCB,0     RETURNS R3=A(PHASE)                          
         GOTO1 (R3),DMCB,(RC),ADCREC  PASS CONTROL TO IT                        
         SPACE 1                                                                
         MVI   SPMODE,X'FF'        CLOSE PQ MYSELF                              
         GOTO1 SPOOL,DMCB,(R8)                                                  
         SPACE 1                                                                
         NI    STATUS,ALL-WAITSPFK                                              
         NI    WSPSTAT,ALL-NEEDDET                                              
         NI    MENADVH+4,X'DF'     SET TO RE-VALIDATE ADVICE NEXT TIME          
         MVI   PFAID,0             CLEAR PRESSED PF KEY                         
         BAS   RE,DREC             DISPLAY ADVICE SCREEN                        
         MVI   MYMSGNO1,53         SENT MESSAGE                                 
         MVI   BLOCK,9             AND REPORT ID                                
         MVC   BLOCK+1(2),SPOOLID                                               
         MVI   BLOCK+3,C','                                                     
         EDIT  SPOOLRPN,(5,BLOCK+4),ALIGN=LEFT                                  
         MVI   BLOCK+9,0                                                        
         SPACE 1                                                                
*        CLI   SELECT,C'Y'                                                      
*        BE    *+10                                                             
         MVC   CONACT(7),=C'DISPLAY'                                            
         SPACE 1                                                                
         CLI   SELECT,C'Y'         IF FAKING SEND                               
         BNE   SNDMSG                                                           
         MVI   THISLSEL,0                                                       
         MVI   SELECT,0            CLEAR FAKE SEND INDICATOR                    
         MVI   VSDONE,C'Y'         SET FAKE SEND IS DONE                        
         SPACE 1                                                                
SNDMSG   L     R2,EFHREC                                                        
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE TO VALIDATE VERSION OR LIFT                              
         SPACE                                                                  
VALVOL   NTR1                                                                   
         LA    R2,MENVERH          R2=A(VERSION/LIFT FIELD)                     
         SPACE 1                                                                
         USING TAVUD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BNE   VVOL01                                                           
         OC    TAVUCYCS,TAVUCYCS   IF REGULAR CYCLE IS PRESENT                  
         BZ    VVOL01                                                           
         GOTO1 USEVAL,DMCB,(X'C0',TAVUUSE)                                      
         TM    TGUSSTA2,HLDTYPE    AND REGULAR USE IS HOLDING FEE               
         BZ    VVOL01              TYPE                                         
         CLI   5(R2),0             INPUT IS NEVER ALLOWED IN THIS               
         BNE   ERRLVNT             FIELD                                        
         DROP  R4                                                               
         SPACE 1                                                                
VVOL01   MVC   ACTUAL,8(R2)        DEFAULT ACTUAL TO INPUTTED VALUE             
         SPACE 1                                                                
         CLI   VERLIFT,C'L'                                                     
         BE    VVOL02                                                           
         CLI   5(R2),0                                                          
         BE    VVOL02                                                           
         GOTO1 VALINUM                                                          
         SPACE 1                                                                
VVOL02   TM    4(R2),X'20'         SKIP AHEAD IF FIELD NOT CHANGED              
         BO    VVOL80                                                           
         SPACE 1                                                                
         CLI   5(R2),0             IF VERSION/LIFT INPUTTED                     
         BE    VVOL20                                                           
         CLI   COMEXIST,C'N'       IF ADVICE'S COMMERCIAL DOES NOT              
         BNE   VVOL10              EXIST                                        
         CLI   VERLIFT,C'L'        AND IF LIFT FIELD INPUTTED                   
         BNE   VVOL05                                                           
         CLI   5(R2),1             INPUT CANNOT EXCEED 1 CHARACTER              
         BNE   VERINV                                                           
         CLI   8(R2),C'Y'          AND MUST BE Y                                
         BE    VVOL20                                                           
         CLI   8(R2),C'N'          N                                            
         BE    VVOL20                                                           
         CLI   8(R2),C'A'          OR A                                         
         BNE   VERINV                                                           
         B     VVOL20                                                           
         SPACE 1                                                                
VVOL05   GOTO1 VALINUM                                                          
         CLI   ACTUAL,1            INPUT MUST BE VALID NUMERIC                  
         BL    VERINV              BETWEEN 1 AND 250                            
         CLI   ACTUAL,250                                                       
         BH    VERINV                                                           
         MVI   VERLIFT,C'V'        AND SET TO TREAT COMMERCIAL LIKE             
         B     VVOL20              A VERSION                                    
         SPACE 1                                                                
VVOL10   CLI   VERLIFT,C'V'        IF ADVICE'S COMMERCIAL EXISTS AND            
         BNE   VVOL12              HAS VERSIONS ...                             
         BAS   RE,VALVER           VALIDATE FIELD AS VERSION                    
         B     VVOL20                                                           
         SPACE 1                                                                
VVOL12   CLI   5(R2),1             OTHERWISE VALIDATE FIELD AS LIFT             
         BH    VERINV                                                           
         CLI   VERLIFT,C'N'        IF LIFT EXISTS                               
         BE    VVOL15              CAN BE BLANK, Y, N OR A                      
         CLI   8(R2),C'Y'                                                       
         BE    VVOL80                                                           
VVOL15   CLI   8(R2),C'N'          IF COMMERCIAL DOES NOT HAVE LIFT             
         BE    VVOL80              OR VERSION ELEMENT, FIELD CAN                
         CLI   8(R2),C'A'          BE BLANK, N OR A                             
         BE    VVOL80                                                           
         B     VERINV                                                           
         SPACE                                                                  
VVOL20   MVI   ELCODE,TAVUELQ                                                   
         L     R4,AIO                                                           
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BNE   VVOL80                                                           
         SPACE 1                                                                
         USING TAVUD,R4                                                         
         OC    TAVUCYCS,TAVUCYCS                                                
         BZ    VVOL30                                                           
         LA    R5,TAVUUSE          FIRST CALL USEVAL WITH REGULAR USE           
         B     VVOL40                                                           
VVOL30   CLI   TAVUUSE2,0                                                       
         BNE   VVOL35                                                           
         CLI   TAVULEN,27                                                       
         BL    VVOL80                                                           
         OC    TAVUMCYS,TAVUMCYS                                                
         BZ    VVOL80                                                           
VVOL35   LA    R5,TAVUUSE2         THEN CALL USEVAL WITH MUSIC USE              
         SPACE 1                                                                
VVOL40   GOTO1 USEVAL,DMCB,(X'C0',(R5))   CALL USEVAL                           
         LA    R2,MENVERH                                                       
         SPACE 1                                                                
         XC    ACURFORC,ACURFORC                                                
         LA    R1,MENVERH                                                       
         ZIC   R0,0(R1)                                                         
         AR    R1,R0                                                            
         ZIC   R0,0(R1)                                                         
         AR    R1,R0                                                            
         NI    6(R1),X'BF'                                                      
         SPACE 1                                                                
         CLI   VERLIFT,C'V'        IF COMMERCIAL HAS VERSIONS                   
         BNE   VVOL60                                                           
         CLI   5(R2),0                                                          
         BNE   VVOL50              CLA, WSP, CBL, SWS, AND MUS REQUIRE          
         TM    TGUSSTA3,VERSONLY   INPUT IN VERSION FIELD                       
         BNO   VVOL70                                                           
         B     VERMIS                                                           
         SPACE 1                                                                
VVOL50   CLI   8(R2),C'A'                                                       
         BE    VVOL70                                                           
         TM    TGUSSTA3,VERSONLY   IF COMMERCIAL HAS VERSIONS ...               
         BZ    VERINV              ONLY CLA, WSP, CBL, SWS, AND MUS             
         B     VVOL70              CAN HAVE INPUT IN VERSION FIELD              
         SPACE 1                                                                
VVOL60   CLI   8(R2),C'A'          IF COMMERCIAL DOES NOT HAVE VERSIONS         
         BNE   VVOL80              ... CLA, LNA, LNN AND LNC CANNOT             
         TM    TGUSSTA3,NWKUSE     HAVE C'A' AS LIFT INPUT IN VERSION           
         BO    VERINV              FIELD                                        
VVOL70   LA    RE,TAVUUSE2                                                      
         CR    R5,RE                                                            
         BNE   VVOL30                                                           
         DROP  R4                                                               
         SPACE 1                                                                
VVOL80   BRAS  RE,ADDVEREL         ADD VERSION ELEMENT                          
         B     VRX                                                              
         SPACE 2                                                                
*              ROUTINE TO VALIDATE LFT FIELD AS VERSION                         
         SPACE                                                                  
VALVER   NTR1                                                                   
         GOTO1 VALINUM             VALIDATE INPUT IS NUMERIC                    
         SPACE 1                                                                
         L     RF,AVERSION                                                      
         LHI   RE,250              IF COMMERCIAL EXISTS ...                     
VVER10   CLI   0(RF),0             INPUT MUST MATCH ONE OF                      
         BE    VERINV              COMMERCIAL'S VERSIONS                        
         CLC   0(1,RF),ACTUAL                                                   
         BE    VRX                                                              
         LA    RF,1(RF)                                                         
         BCT   RE,VVER10                                                        
         B     VERINV                                                           
         SPACE 2                                                                
         EJECT                                                                  
*              ROUTINE TO GET NEW ADVICE NUMBER IF FIRST TIME ADD               
         SPACE 1                                                                
GETADV   NTR1                                                                   
         CLI   ACTNUM,ACTADD       IF ADDING ADVICE                             
         BNE   GETADVX                                                          
         CLI   LWRSCR,SCR8C        ON NON-MENU SCREEN                           
         BE    GETADVX                                                          
         TM    AGYSTA3,TAAYSADV    AND AGENCY SET TO AUTOMATICALLY              
         BZ    GETADVX             GENERATE ADVICE NUMBER                       
         MVC   AIO,AIO2                                                         
         GOTO1 CHNADV              GET NEW ADVICE NUMBER                        
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE 1                                                                
         MVC   AIO,AIO1            RESTORE AIO AND AGY AND COM IN KEY           
         MVC   KEY,ADVKEY          STORE GENERATE ADVICE # IN KEY               
         MVC   KEY+TLDVADV-TLDVD(L'TLDVADV),TGADV                               
         L     R4,AIO                                                           
         MVC   TLDVADV-TLDVD(L'TGADV,R4),TGADV                                  
         MVC   ADVKEY,KEY          SAVE NEW KEY                                 
         MVC   MENADV,TGADV        AND DISPLAY BACK TO USER                     
         OI    MENADVH+4,X'20'                                                  
         OI    MENADVH+6,X'80'                                                  
GETADVX  B     VRX                                                              
         EJECT                                                                  
*              ROUTINE TO PRINT OUT AN ADVICE RECORD                            
         SPACE 1                                                                
PREP     NTR1                                                                   
         LA    R2,MENAGYH          POSITION CURSOR TO AGENCY                    
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'20',0) GET THE RECORD                     
         BNE   THEEND                                                           
         SPACE 1                                                                
         MVI   OVERLAY,X'8E'       LOAD ADVICE PRINTING PHASE                   
         GOTO1 LOADSOPH,DMCB,0     RETURNS R3=A(PHASE)                          
         GOTO1 (R3),DMCB,(RC),ADCREC PASS CONTROL TO IT                         
         SPACE 1                                                                
         XC    CONSERV,CONSERV     AUTO DQU                                     
         MVC   CONSERV(4),=C'$DQU'                                              
         B     XIT                                                              
         EJECT                                                                  
*              ERROR MESSAGES                                                   
         SPACE 1                                                                
NOSEND   MVI   ERROR,ERDVPAID      ALREADY PAID                                 
         B     SENDSET                                                          
SENT     MVI   ERROR,ERDVSENT      ALREADY SENT                                 
         B     SENDSET                                                          
CIHRSEND MVC   MYMSGNO,=Y(ERHFCRNO)                                             
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
         B     SENDSET                                                          
SENDSET  LA    R2,MENADVH                                                       
         B     THEEND                                                           
ERRMIS   MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     SETKEY                                                           
ERPPLSI  LA    R2,MENAGYH                                                       
         NI    4(R2),X'DF'                                                      
         LHI   RE,ERRIAPPA         RECORD / ACTION INVALID FOR P+               
         STH   RE,MYMSGNO                                                       
         J     ERREND                                                           
                                                                                
ERREND   MVI   MYMTYP,GTMERR       ERROR MESSAGE EXIT                           
         OI    GENSTAT2,USGETTXT                                                
         J     THEEND                                                           
                                                                                
VERINV   TM    STATUS,WAITLPFK                                                  
         BNZ   VERINVB                                                          
VERINVA  TM    MENVERH+4,X'20'                                                  
         BO    VERINVC                                                          
         XC    ACURFORC,ACURFORC                                                
         MVI   MYMSGNO1,93                                                      
         OI    GENSTAT2,USGETTXT                                                
         OI    STATUS,WAITLPFK                                                  
         MVC   SVVER,MENVER                                                     
         NI    MENCLINH+6,X'FF'-X'C0'                                           
         B     THEEND                                                           
VERINVB  CLI   PFAID,20                                                         
         BNE   VERINVA                                                          
VERINVC  NI    STATUS,X'FF'-WAITLPFK                                            
         XC    SVVER,SVVER                                                      
         LA    R2,MENVERH                                                       
         GOTO1 VALINUM                                                          
         OI    4(R2),X'20'                                                      
         BRAS  RE,ADDVEREL         ADD VERSION ELEMENT                          
         MVI   PFAID,0                                                          
         CLI   SELECT,C'Y'                                                      
         BNE   VERINVE                                                          
         CLI   THISLSEL,C'C'                                                    
         BNE   VERINVE                                                          
         MVI   PFAID,14                                                         
         B     XIT                                                              
VERINVE  CLI   ACTNUM,ACTADD                                                    
         BNE   XIT                                                              
         CLI   LWRSCR,SCR8C                                                     
         BNE   XIT                                                              
         MVI   MYMSGNO1,57                                                      
         OI    GENSTAT2,USGETTXT                                                
         NI    MENCLINH+6,X'FF'-X'C0'                                           
         B     THEEND                                                           
VERMIS   XC    ACURFORC,ACURFORC                                                
         TM    STATUS,WAITLPFK                                                  
         BNZ   VERMISB                                                          
VERMISA  MVI   MYMSGNO1,94                                                      
         OI    GENSTAT2,USGETTXT                                                
         OI    STATUS,WAITLPFK                                                  
         MVC   SVVER,MENVER                                                     
         NI    MENCLINH+6,X'FF'-X'C0'                                           
         B     THEEND                                                           
VERMISB  CLI   PFAID,20                                                         
         BNE   VERMISA                                                          
         MVI   PFAID,0                                                          
         NI    STATUS,X'FF'-WAITLPFK                                            
         XC    SVVER,SVVER                                                      
         OI    MENVERH+4,X'20'                                                  
         B     XIT                                                              
         SPACE 1                                                                
ERRLVNT  MVC   MYMSGNO,=Y(ERLVNTAL)                                             
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
         B     THEEND                                                           
         SPACE 1                                                                
ERRINV   NI    MENCLINH+6,X'FF'-X'C0'                                           
         MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         B     THEEND                                                           
RECONFIL XC    ACURFORC,ACURFORC                                                
         MVI   ERROR,RECEXIST      RECORD ALREADY ON FILE                       
SETKEY   OI    6(R2),X'81'         SET KEY MOD. TO VAL NEXT TIME TOO            
         NI    4(R2),X'DF'         SET FIELD NOT VALIDATED                      
         B     THEEND                                                           
NODELETE MVI   ERROR,ERINVDEL      CANNOT DELETE RECORD                         
         B     THEEND                                                           
NOINPUT  MVI   ERROR,ERNOINP       INPUT NOT ALLOWED                            
         B     THEEND                                                           
VERIFIED MVI   ERROR,ERDVVER       ALREADY VERIFIED                             
         B     THEEND                                                           
AGYUSERR MVI   ERROR,ERAGYUSE      INVALID USE FOR THIS AGENCY                  
         B     THEEND                                                           
THEEND   GOTO1 EXIT,DMCB,0                                                      
         DROP  R7                                                               
         SPACE 2                                                                
*              CONSTANTS AND LITERALS                                           
         SPACE 1                                                                
SCRF0    EQU   X'F0'                                                            
SCRF1    EQU   X'F1'                                                            
SCRF2    EQU   X'F2'                                                            
SCRF3    EQU   X'F3'                                                            
SCRF4    EQU   X'F4'                                                            
NOUPG    EQU   X'00'                                                            
         SPACE 2                                                                
STOREEQU EQU   40000                                                            
         SPACE 2                                                                
         GETEL (R4),DATADISP,ELCODE                                             
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
       ++INCLUDE TAUNIOND                                                       
         EJECT                                                                  
*              ROUTINE DISPLAYS COMMERCIAL CAST INFO ON SESSION SCRN            
         SPACE 1                                                                
SETUPSES NTR1  BASE=*,LABEL=*                                                   
         USING CSINFOD,R3                                                       
         L     R3,ACSINFO                                                       
         OC    CSFINFO,CSFINFO     DISPLAY FILM INFO                            
         BZ    SUPSES10                                                         
         GOTO1 DATCON,DMCB,(1,CSFDTE),(8,SDSFDTE)                               
         MVI   SDSFDTEH+5,8                                                     
         MVC   SDSFSTU,CSFSTUD                                                  
         MVI   SDSFSTUH+5,L'CSFSTUD                                             
         MVC   SDSFCIT,CSFCITY                                                  
         MVI   SDSFCITH+5,L'CSFCITY                                             
         MVC   SDSFSTA,CSFSTAT                                                  
         MVI   SDSFSTAH+5,L'CSFSTAT                                             
         GOTO1 FLDVAL,DMCB,(X'02',SDSFDTEH),(X'80',SDSFSTAH)                    
         SPACE 1                                                                
SUPSES10 OC    CSRINFO,CSRINFO     DISPLAY RECORD INFO                          
         BZ    SUPSES20                                                         
         GOTO1 DATCON,DMCB,(1,CSRDTE),(8,SDSRDTE)                               
         MVI   SDSRDTEH+5,8                                                     
         MVC   SDSRSTU,CSRSTUD                                                  
         MVI   SDSRSTUH+5,L'CSRSTUD                                             
         MVC   SDSRCIT,CSRCITY                                                  
         MVI   SDSRCITH+5,L'CSRCITY                                             
         MVC   SDSRSTA,CSRSTAT                                                  
         MVI   SDSRSTAH+5,L'CSRSTAT                                             
         GOTO1 FLDVAL,DMCB,(X'02',SDSRDTEH),(X'80',SDSRSTAH)                    
         SPACE 1                                                                
SUPSES20 XC    CSINFO,CSINFO                                                    
         DROP  R3                                                               
         SPACE 1                                                                
         CLI   NEEDPULL,C'Y'       IF AGENCY NOT SET TO SHOW NEW CAST           
         BNE   PLSENTER            MEMBERS - MUST BE INPUT                      
         SPACE 1                                                                
         MVI   NEEDPULL,C'N'       IF AGENCY SET TO SHOW NEW CAST MEM'S         
         BAS   RE,PULL             DISPLAY CAST                                 
         CLI   NCAST,0             IF NOTHING TO DISPLAY - MUST BE              
         BE    PLSENTER            INPUT                                        
         SPACE 1                                                                
DSPCAST  MVI   MYMSGNO1,96         DETAILS DSPLY'D - NN ACTUAL CAST             
         MVI   BLOCK,4                                                          
         EDIT  NCAST,(3,BLOCK+1),ALIGN=LEFT                                     
         MVI   BLOCK+4,0                                                        
         LA    R2,SDSFRSTH                                                      
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         B     INFEND                                                           
         SPACE 1                                                                
PLSENTER MVI   MYMSGNO1,2          IF NO CAST MEMBERS DISPLAYED                 
         MVI   MYMSYS,X'FF'                                                     
PLS1     LA    R2,MENTAGH                                                       
         SR    R1,R1                                                            
PLS2     TM    1(R2),X'20'         BUMP TO 1ST UNPROTECTED FIELD                
         BO    *+12                                                             
         CLI   8(R2),0             WITH NOTHING IN IT                           
         BE    INFEND                                                           
         IC    R1,0(R2)                                                         
         AR    R2,R1                                                            
         B     PLS2                                                             
INFEND   OI    GENSTAT2,USGETTXT   AND ASK FOR INPUT                            
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
*              ROUTINE CLEARS SESSION SCREEN AND READS CAST                     
         SPACE 1                                                                
PULL     NTR1                                                                   
         MVI   NCAST,0             NO CAST PULLED                               
         SPACE 1                                                                
         GOTOR STSCR04             SET SESSION SCREEN UNPROTECTED               
         SPACE 1                                                                
         GOTO1 FLDVAL,DMCB,(X'03',SDSFRSTH),(X'80',SDSLSTH)                     
         CLI   COMEXIST,C'Y'       IF COMMERCIAL RECORD ON FILE                 
         BNE   *+8                                                              
         BAS   RE,ACTCAST          SHOW SCREENFUL OF COMML CAST                 
PULLX    XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE SHOWS SCREENFUL OF COMMERCIAL CAST                       
         SPACE 1                                                                
ACTCAST  NTR1                                                                   
         MVC   ADVKEY,KEY          SAVE ADVICE KEY                              
         MVC   AIO,AIO3            SET IOAREA FOR CAST RECORDS                  
         LA    R2,1                R2=(SEQUENCE NUMBER FOR TAVCDS)              
         LA    R3,SDSFRSTH         R3=A(FIRST PERFORMER SCREEN LINE)            
         SPACE 1                                                                
         XC    KEY,KEY             READ HIGH FOR CAST RECORDS                   
         MVI   KEY,TLCACDQ                                                      
         MVC   KEY+TLCACOM-TLCAD(L'TLCACOM),TGCOM                               
         GOTO1 HIGH                                                             
         B     ACTCST10                                                         
         SPACE 1                                                                
ACTCST5  GOTO1 SEQ                 READ SEQ. SKIP MUSICIANS & EXTRAS            
ACTCST10 CLC   KEY(TLCASORT-TLCAKEY),KEYSAVE                                    
         BNE   ACTCST60                                                         
         TM    KEY+TLCASORT-TLCAKEY,X'80'                                       
         BO    ACTCST5                                                          
         TM    AGYSTA4,TAAYAEXT                                                 
         BNZ   ACTCST12                                                         
         TM    KEY+TLCASORT-TLCAKEY,X'20'                                       
         BO    ACTCST5                                                          
         SPACE 1                                                                
ACTCST12 CH    R2,=Y(PMAXSESS)     FOR FIRST FOUR PERFORMERS                    
         BH    ACTCST40                                                         
         GOTO1 GETREC              GET THE CAST RECORD                          
         GOTOR CVTAVC              CONVERTS TACAD TO TAVCD                      
         LA    R4,ELEMENT                                                       
         GOTOR DISTAVC             DISPLAY DIRECTLY ON SCREEN                   
         AHI   R3,LINLNQ           BUMP TO NEXT LINE                            
ACTCST40 LA    R2,1(R2)            INCREMENT TO NEXT SEQUENCE NUMBER            
         B     ACTCST5                                                          
         SPACE 1                                                                
ACTCST60 BCTR  R2,0                                                             
         CH    R2,=H'254'          NO MORE THAN 254 CAST MEMBERS                
         BNH   ACTCST65                                                         
         ZIC   R1,MODE                                                          
         MVI   MODE,PRINTREP                                                    
         GOTO1 FLDVAL,DMCB,(X'03',SDSFRSTH),(X'80',SDSLSTH)                     
         GOTOR STSCR04                                                          
         STC   R1,MODE                                                          
         NI    MENCIDH+4,X'DF'     SET TO RE-VALIDATE COMM'L NEXT TIME          
         OI    MENCIDH+6,X'01'     SET INPUT THIS TIME TO GET VALKEY            
         OI    MENCIDH+6,X'80'                                                  
         MVI   ERROR,ERTOOCST      TOO MANY CAST RECS                           
         LA    R2,MENCIDH                                                       
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 1                                                                
ACTCST65 STC   R2,NCAST            N'ACTUAL CAST MEMBERS FOR MESSAGE            
         LTR   R2,R2                                                            
         BZ    ACTCST70                                                         
         BAS   RE,ADDNAMES         SHOW NAMES FOR CAST ON SCREEN                
         SPACE 1                                                                
ACTCST70 MVC   AIO,AIO1            RESTORE IOAREA                               
         MVC   KEY,ADVKEY          RESTORE ADVICE KEY                           
         B     PULLX                                                            
         EJECT                                                                  
*              ROUTINE GETS NAMES FOR CAST MEMBERS ALREADY DISPLAYED            
         SPACE 1                                                                
ADDNAMES NTR1                                                                   
         ZIC   R2,NCAST            R2=N'CAST MEMBERS                            
         CH    R2,=Y(PMAXSESS)                                                  
         BNH   *+8                                                              
         LA    R2,PMAXSESS                                                      
         LA    R3,SDSFRSTH         R3=A(FIRST SESSION LINE)                     
         USING LINED,R3                                                         
         SPACE 1                                                                
ADDNAM10 MVC   TGSSN,LINSSN                                                     
         TM    TGSYSTAT,TASYSPID                                                
         BZ    ADDNAM20                                                         
         GOTO1 SSNUNPK,DMCB,LINSSN,TGSSN                                        
ADDNAM20 GOTO1 RECVAL,DMCB,TLW4CDQ,(X'88',TGSSN),LINNAMEH                       
         BE    *+10                                                             
         MVC   LINNAME,=CL26'** NOT FOUND **'                                   
         OI    LINNAMEH+6,X'80'                                                 
         AHI   R3,LINLNQ           BUMP TO NEXT CAST MEMBER ON SCREEN           
         BCT   R2,ADDNAM10         LOOP                                         
         B     PULLX                                                            
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        DISPLAY COMMERCIAL'S PRODUCT INFO                            *         
***********************************************************************         
                                                                                
PRDINFO  NTR1  BASE=*,LABEL=*                                                   
         TM    MENPRDNH+4,X'80'                                                 
         JO    PIX                                                              
         GOTO1 CHAROUT,DMCB,TAFNELQ,MENPRDNH,TAFNTPRD     PRODUCT NAME          
         L     R4,AIO                            R4=A(COMM'L RECORD)            
         USING TLCOD,R4                                                         
         OC    TLCOPRD,TLCOPRD                   IF COMM'L HAS PRODUCT          
         JZ    PIX                                                              
         MVC   AIO,AIO3                                                         
         GOTO1 RECVAL,DMCB,TLPRCDQ,(X'20',0)     AIO3=A(PRODUCT RECORD)         
         JNE   PIX                                                              
         GOTO1 CHAROUT,DMCB,TANAELQ,MENPRDNH     OVERWRITE PRODUCT NAME         
PIX      MVC   AIO,AIO2                                                         
         XIT1                                                                   
                                                                                
**********************************************************************          
*        CONSTANTS AND LITERALS                                                 
**********************************************************************          
                                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO SET NWKREQ (CALLED BY SETAGY AND VALCID)              
         SPACE                                                                  
GETRULES NTR1  BASE=*,LABEL=*                                                   
         L     R4,AIO              R4=A(AGENCY/CLIENT RECORD)                   
         MVI   ELCODE,TABRELQ                                                   
         BRAS  RE,GETEL            R4=A(BILLING RULES ELEMENT)                  
         BNE   GRX                                                              
         USING TABRD,R4                                                         
         TM    TABRSTAT,TABRSNWK   IF NETWORK REQ'D FOR CLA USES                
         BZ    GRX                                                              
         MVI   NWKREQ,C'Y'         SET SWITCH ON                                
GRX      XIT1                                                                   
         DROP  R4                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO ENSURE ADVICE RECORD NOT TOO LARGE                    
         SPACE 1                                                                
CHKLEN   NTR1  BASE=*,LABEL=*                                                   
         USING TLRCD,R4                                                         
         L     R4,AIO                                                           
         CLC   TLRCLEN,=H'1977'                                                 
         BL    CHKLENX                                                          
         DROP  R4                                                               
         SPACE 1                                                                
         MVI   ERROR,TOOLONG                                                    
         LA    R2,MENAGYH                                                       
         GOTO1 EXIT,DMCB,0                                                      
CHKLENX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE BUILDS ADVICE USE DETAILS ELEMENT                        
         SPACE 1                                                                
BLDTAVU  NTR1  BASE=*,LABEL=*                                                   
         MVI   ELCODE,TAVUELQ       DELETE EXISTING ADVICE USE DETAILS          
         GOTO1 REMELEM              ELEMENT                                     
         SPACE 1                                                                
BTAVU10  XC    ELEMENT,ELEMENT                                                  
         LA    R4,ELEMENT                                                       
         USING TAVUD,R4                                                         
         MVI   TAVUEL,TAVUELQ       ELEMENT CODE                                
         MVI   TAVULEN,TAVULNQ      ELEMENT LENGTH                              
         MVC   TAVUMED,TGMENAME     ADVICE MEDIA                                
         MVC   TAVUESPD,SVESTPER    ESTIMATE PERIOD                             
         MVC   TAVUUSE,USE1         USE EQUATE                                  
         MVC   TAVUTYPE,TYPE1       USE TYPE EQUATE                             
         MVC   TAVUUSE2,USE2        2ND USE EQUATE                              
         MVC   TAVUTYP2,TYPE2       2ND USE TYPE EQUATE                         
         MVC   TAVUCYC,REGDATE      CYCLE START DATE                            
         MVC   TAVUMCYS(6),MUSDATE  MUSIC CYCLE START DATE                      
         MVC   TAVUUNT,SVUNITS      UNITS                                       
         MVC   TAVUUSES,SVUSES      USES (ITN)                                  
         MVC   TAVUMAJ,MAJOR        MAJORS                                      
         MVC   TAVUABSS,APPLYS      APPLY SESSION                               
         MVC   TAVUAHLD,APPLYH      APPLY HOLD                                  
         MVC   TAVUWKS,WEEKS1       FIRST CYCLE LENGTH                          
         MVC   TAVUMWKS,WEEKS2      SECOND CYCLE LENGTH                         
         GOTO1 ADDELEM              ADD ADVICE USE DETAILS ELEMENT              
         XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE TO MOVE VERSION DESCRIPTION TO SCREEN FIELD              
         SPACE 1                                                                
VER2SCR  NTR1  BASE=*,LABEL=*                                                   
         USING TAVRD,R4                                                         
         L     R4,AIO2              R4=A(COMMERCIAL RECORD)                     
         MVI   ELCODE,TAVRELQ                                                   
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
V2S10    BRAS  RE,NEXTEL                                                        
         BNE   V2S30                                                            
V2S20    CLC   TAVRVERS,VERVALUE    GET VERSION ELEMENT WITH MATCHING           
         BNE   V2S10                VERSION CODE                                
         MVC   MENVED,TAVRCID       AND MOVE DESCRIPTION TO SCREEN              
         OI    MENVEDH+6,X'80'                                                  
         B     V2S50                                                            
         DROP  R4                                                               
         SPACE 1                                                                
V2S30    L     R4,AIO                    IF VERSION NOT FOUND ON                
         MVC   KEYSAVE(L'TLCOKEY),0(R4)  CURRENT COMM'L RECORD ...              
         SPACE 1                                                                
V2S40    ZIC   RE,KEYSAVE+TLCOVER-TLCOD  READ THROUGH VERSION ELEMENTS          
         AHI   RE,1                      ON ALL COMMERCIAL RECORDS              
         CHI   RE,TLCOV250               FOR A MATCH                            
         BH    V2S50                                                            
         STC   RE,KEYSAVE+TLCOVER-TLCOD                                         
         SPACE 1                                                                
         XC    KEY,KEY                                                          
         MVC   KEY(L'TLCOKEY),KEYSAVE                                           
         GOTO1 HIGH                                                             
         CLC   KEY(L'TLCOKEY),KEYSAVE                                           
         BNE   V2S40                                                            
         GOTO1 GETREC                                                           
         BRAS  RE,GETEL                                                         
         BE    V2S20                                                            
         B     V2S40                                                            
         SPACE 1                                                                
V2S50    L     R4,AIO                                                           
         XC    KEY,KEY                     RESTORE MAIN COMMERCIAL              
         MVC   KEY(L'TLCOKEY),0(R4)        RECORD IN AIO2                       
         MVI   KEY+TLCOVER-TLCOD,TLCOV026                                       
         GOTO1 HIGH                                                             
         CLC   KEY(L'TLCOKEY),KEYSAVE                                           
         BNE   V2SX                                                             
         GOTO1 GETREC                                                           
V2SX     XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO ADD FREE FORM NAME ELEMENT FOR VERSION                
*              NUMBER/LETTER STORED IN ACTUAL                                   
         SPACE 1                                                                
ADDVEREL NTR1  BASE=*,LABEL=*                                                   
         MVI   ELCODE,TAFNELQ                                                   
         GOTO1 DELL,DMCB,(1,=AL1(TAFNTVER))                                     
         SPACE 1                                                                
         USING TAFND,R4                                                         
         LA    R4,ELEMENT                                                       
         XC    ELEMENT,ELEMENT                                                  
         MVI   TAFNEL,TAFNELQ                                                   
         MVI   TAFNLEN,4                                                        
         MVI   TAFNTYPE,TAFNTVER                                                
         MVC   TAFNNAME,ACTUAL                                                  
         GOTO1 ADDELEM                                                          
         XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE ADDS DUE DATE ELEMENT                                    
         SPACE 1                                                                
ADDDUES  NTR1  BASE=*,LABEL=*                                                   
         MVI   ELCODE,TADDELQ    GET RID OF DUE DATE ELEMENT                    
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
         USING TADVD,R4                                                         
         L     R4,AIO            DO NOT CALCULATE DUE DATES                     
         MVI   ELCODE,TADVELQ    FOR SESSION ADVICES                            
         BRAS  RE,GETEL                                                         
         BNE   ADUESX                                                           
         CLI   TADVTYPE,TADVTYPS                                                
         BE    ADUESX                                                           
         DROP  R4                                                               
         SPACE 1                                                                
         USING TAVUD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   ADUESX                                                           
         MVC   REGDATE,TAVUCYC                                                  
         MVC   USE1,TAVUUSE      SAVE ADVICE'S USES AND TYPES                   
         MVC   TYPE1,TAVUTYPE                                                   
         MVC   MUSDATE,TAVUMCYS                                                 
         MVC   USE2,TAVUUSE2                                                    
         MVC   TYPE2,TAVUTYP2                                                   
         DROP  R4                                                               
         SPACE 1                                                                
         USING TADDD,R4                                                         
         LA    R4,ELEMENT        INITIALIZE DUE DATE ELEMENT                    
         XC    ELEMENT,ELEMENT                                                  
         MVI   TADDEL,TADDELQ                                                   
         MVI   TADDLEN,TADDLNQ                                                  
         DROP  R4                                                               
         SPACE 1                                                                
         OC    REGDATE,REGDATE   SET REGULAR USE'S GLOBALS                      
         BZ    ADUES20                                                          
         XC    TGUSDATA,TGUSDATA                                                
         MVI   TGUSXUNS,AFM                                                     
         CLI   USE1,0                                                           
         BE    ADUES30                                                          
         GOTO1 USEVAL,DMCB,(X'80',USE1),(X'80',TYPE1)                           
         B     ADUES30                                                          
         SPACE 1                                                                
*                                AFTER REGULAR USE DUE DATE HAS                 
*                                BEEN CALCULATED, SEE IF MUSIC DUE              
*                                DATE HAS BEEN CALCULATED                       
ADUES10  GOTO1 UNITEST,DMCB,TGUSXUNS,AFM,0,0,0                                  
         BZ    ADUES140                                                         
         SPACE 1                                                                
ADUES20  OC    MUSDATE,MUSDATE   IF NOT, SET MUSIC USE'S GLOBALS                
         BZ    ADUES140                                                         
         XC    TGUSDATA,TGUSDATA                                                
         XC    TGUSXUNS,TGUSXUNS                                                
         CLI   USE2,0                                                           
         BE    ADUES30                                                          
         GOTO1 USEVAL,DMCB,(X'80',USE2),(X'80',TYPE2)                           
         SPACE 1                                                                
ADUES30  MVC   DUB(3),TGTODAY1   SET DUE DATE AS TODAY                          
         SPACE 1                                                                
         TM    AGYSTAT,TAAYSCOD  IF COD CLIENT OR COD AGENCY                    
         BNZ   ADUES90           DUE DATE IS TODAY                              
         SPACE 1                                                                
         CLI   TGUSEQU,UPRR      IF PROMO USE                                   
         BE    ADUES40                                                          
         CLI   TGUSEQU,UFGR      OR IF FOREIGN USE                              
         BNE   ADUES50                                                          
         CLI   TGUSTYP,UFGREXT   AND EXTENSION TYPE                             
         BNE   ADUES50                                                          
ADUES40  LA    R0,1              DUE DATE IS TODAY + ONE DAY                    
         B     ADUES90                                                          
         SPACE 1                                                                
ADUES50  MVC   DUB(3),REGDATE                                                   
         GOTO1 UNITEST,DMCB,TGUSXUNS,AFM,0,0,0                                  
         BNZ   *+10                                                             
         MVC   DUB(3),MUSDATE    SET DUE DATE AS CYCLE START DATE               
         SPACE 1                                                                
         CLI   TGUSEQU,UITN                                                     
         BE    ADUES60                                                          
         TM    TGUSTYST,UPGRADE                                                 
         BZ    ADUES70                                                          
ADUES60  MVC   DUB(3),REGDATE+3                                                 
         LA    R0,15                                                            
         SPACE 1                                                                
         CLI   TGUSEQU,UITN      IF ITN USE                                     
         BE    ADUES90                                                          
         CLI   TGUSEQU,UWSP      OR WILDSPOT UPGRADE                            
         BE    ADUES90                                                          
         CLI   TGUSEQU,USWS      OR SPANISH WILDSPOT UPGRADE                    
         BE    ADUES90           USE CYCLE END + 15 DAYS                        
         SPACE 1                                                                
         CLC   TGTODAY1,DUB      ALL OTHER UPGRADES                             
         BNL   ADUES90                                                          
         MVC   DUB(3),TGTODAY1                                                  
         B     ADUES90           USE TODAY + 15 DAYS                            
         SPACE 1                                                                
ADUES70  TM    TGUSSTAT,CANUSE   IF CANADIAN USE                                
         BZ    ADUES80                                                          
         LA    R0,5              USE CYCLE START + 5 DAYS                       
         B     ADUES90                                                          
         SPACE 1                                                                
ADUES80  LA    R0,1                                                             
         TM    TGUSSTA2,HLDTYPE  FOR HOLDING FEE TYPE                           
         BZ    ADUES85                                                          
         B     ADUES90                                                          
         SPACE 1                                                                
*&&DO                                                                           
         CLI   COMCTYPE,CTYSEAS2                                                
         BNE   ADUES90                                                          
         LA    RF,COMAIR                                                        
         MVI   TGBYTE,1                                                         
         OC    COMSAIR,COMSAIR                                                  
         BZ    ADUES84                                                          
         CLC   COMSAIR,REGDATE                                                  
         BNL   ADUES84                                                          
         LA    RF,COMSAIR                                                       
         MVI   TGBYTE,2                                                         
ADUES84  XC    WORK,WORK                                                        
         GOTO1 DATCON,DMCB,(1,0(RF)),(8,WORK)                                   
         MVC   WORK+8(5),=C'-(3M)'                                              
         TM    AGYSTAT,TAAYS13W                                                 
         BZ    *+10                                                             
         MVC   WORK+8(6),=C'-(13W)'                                             
         GOTO1 PERVAL,DMCB,(14,WORK),('PVINSGLS+PVIN1DYL',BLOCK)                
         CLI   4(R1),PVRCOK                                                     
         BE    *+6                                                              
         DC    H'00'                                                            
         MVC   DUB(3),BLOCK+PVALPEND-PERVALD                                    
         LA    R0,12                                                            
         CLI   TGBYTE,1                                                         
         BE    ADUES90                                                          
         SPACE 1                                                                
         USING TADDD,R2                                                         
         LA    R2,ELEMENT                                                       
         MVC   TADDDATE,DUB                                                     
         LA    R2,TADDDATE                                                      
         B     ADUES130                                                         
         DROP  R2                                                               
*&&                                                                             
         SPACE 1                                                                
ADUES85  CLI   TGUSEQU,UREN      OR REN                                         
         BE    ADUES90                                                          
         CLI   TGUSEQU,UARN      OR ARN                                         
         BE    ADUES90                                                          
         CLI   TGUSEQU,USRE      OR SRE                                         
         BE    ADUES90           USE CYCLE START - 1 DAY                        
         SPACE                                                                  
         XR    R0,R0             ELSE 0 DAYS                                    
         TM    TGUSSTA2,ZERODUE  IF SPECIFIED                                   
         BO    ADUES90                                                          
         LA    R0,15             15 OR                                          
         TM    TGUSSTA4,DUE15DAY                                                
         BO    ADUES86                                                          
         LA    R0,12             12 FOR EVERYTHING ELSE                         
         SPACE 1                                                                
         USING TANPD,R4                                                         
ADUES86  TM    TGUSSTA3,NWKUSE   FOR NETWORK USES                               
         BZ    ADUES90                                                          
         L     R4,AIO                                                           
         MVI   ELCODE,TANPELQ    GET THE FIRST PROGRAM DATE                     
         BRAS  RE,GETEL          DUE DATE IS 12 DAYS AFTER THE                  
         BNE   ADUES90           FRIDAY OF THE FIRST PROGRAM'S WEEK             
         MVC   DUB(3),TANPDATE                                                  
         GOTO1 DATCON,DMCB,(1,DUB),(0,WORK)                                     
         GOTO1 GETDAY,DMCB,WORK,WORK+6                                          
         ZIC   RF,0(R1)                                                         
         LA    R3,5                                                             
         SR    R3,RF                                                            
         BNP   ADUES90                                                          
         GOTO1 ADDAY,DMCB,WORK,WORK+6,(R3)                                      
         GOTO1 DATCON,DMCB,(0,WORK+6),(1,DUB)                                   
         DROP  R4                                                               
         SPACE 1                                                                
ADUES90  MH    R0,=H'24'         MULTIPLY BY 24 TO GET TOTAL N'HOURS            
         SPACE 1                                                                
         XC    WORK,WORK         INITIALIZE GETRET BLOCK                        
         LA    R3,WORK                                                          
         USING GETRETD,R3                                                       
         STCM  R0,3,GRDHRS        SET N'HOURS                                   
****     OI    GRDFLAG,GRDFTAL                                                  
         OI    GRDFLAG,GRDFTPU    USE UNION CALENDAR                            
         GOTO1 DATCON,DMCB,(1,DUB),(3,GRDIDY) AND START DATE                    
         SPACE 1                                                                
         USING TADDD,R4                                                         
         LA    R4,ELEMENT                                                       
         LA    R2,TADDDATE                                                      
         GOTO1 UNITEST,DMCB,TGUSXUNS,AFM,0,0,0                                  
         BNZ   *+8                                                              
         LA    R2,TADDDATM                                                      
         MVC   0(L'TADDDATE,R2),DUB                                             
         SPACE 1                                                                
         TM    TGUSSTA2,HLDTYPE                                                 
         BZ    ADUES95                                                          
         B     ADUES100                                                         
*        CLI   COMCTYPE,CTYSEAS2                                                
*        BNE   ADUES100                                                         
*        B     ADUES105                                                         
         SPACE 1                                                                
ADUES95  CLI   TGUSEQU,UREN        OR REN                                       
         BE    ADUES100                                                         
         CLI   TGUSEQU,UARN        OR ARN                                       
         BE    ADUES100                                                         
         CLI   TGUSEQU,USRE        OR SRE                                       
         BNE   *+8                                                              
ADUES100 OI    GRDFLAG,GRDFBACK    SET TO GO BACKWARDS                          
ADUES105 OI    GRDFLAG,GRDFHLOK    SET START ON WEEKEND/HOLIDAY OK              
         SPACE 1                                                                
         MVI   GRDITH,0                                                         
         MVI   GRDITM,1                                                         
         GOTO1 GETRET,(R3)         DETERMINE DUE DATE                           
         BNE   ADUES130            SKIP IF NONE FOUND (NO CALENDAR YET)         
         GOTOR UNIOND,DMCB,GETRET,(R3),PARAS                                    
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE 1                                                                
         GOTO1 DATCON,DMCB,(3,GRDODY),(1,TGFULL)  CONVERT TO PWOS               
         MVC   0(L'TADDDATE,R2),TGFULL                                          
         SPACE 1                                                                
         CLI   TGUSEQU,UDLR        IF DLR PAYMENT                               
         BNE   ADUES130                                                         
                                                                                
         CLI   TGUSWKS,8           NON-8 WEEKS                                  
         JE    ADUES130                                                         
         TM    TGMEEQU,LIKETV      FOR TV,INT,OR NEW MED COMM                   
         BZ    ADUES130                                                         
         CLI   COMEXIST,C'Y'       THAT EXISTS                                  
         BNE   ADUES130                                                         
         OC    COMFFCYC,COMFFCYC   AND FIRST FIXED CYCLE IS ON COMM'L           
         BZ    ADUES130                                                         
         XC    TGFULL,TGFULL                                                    
         MVC   TGFULL(L'COMFFCYC),COMFFCYC                                      
         SPACE 1                                                                
         XC    WORK,WORK           SET TO CALCULATE HOLDING FEE CYCLES          
         MVI   TGBYTE,13           FOR THE COMMERCIAL BASED ON 3 MONTH          
         MVC   WORK+8(5),=C'-(3M)' OR 13 WEEKS                                  
         TM    AGYSTAT,TAAYS13W                                                 
         BZ    ADUES110                                                         
         MVI   TGBYTE,14                                                        
         MVC   WORK+8(6),=C'-(13W)'                                             
         SPACE 1                                                                
ADUES110 GOTO1 DATCON,DMCB,(1,TGFULL),(8,WORK)                                  
         GOTO1 PERVAL,DMCB,(TGBYTE,WORK),('PVINSGLS+PVIN1DYL',BLOCK)            
         CLI   4(R1),PVRCOK                                                     
         BE    *+6                                                              
         DC    H'00'                                                            
         SPACE 1                                                                
         CLC   BLOCK+PVALPSTA-PERVALD(L'PVALPEND),REGDATE                       
         BH    ADUES120                                                         
         GOTO1 ADDAY,DMCB,BLOCK+PVALEEND-PERVALD,TGDUB,1                        
         GOTO1 DATCON,DMCB,(0,TGDUB),(1,TGFULL)                                 
         B     ADUES110                                                         
         SPACE 1                                                                
ADUES120 XC    WORK,WORK           INITIALIZE GETRET BLOCK                      
         LA    R3,WORK                                                          
         USING GETRETD,R3                                                       
         MVC   GRDHRS,=H'24'                  SET N'HOURS                       
         OI    GRDFLAG,X'01'                                                    
         GOTO1 DATCON,DMCB,(1,BLOCK+PVALPSTA-PERVALD),(3,GRDIDY)                
         OI    GRDFLAG,GRDFBACK    SET TO GO BACKWARDS                          
         OI    GRDFLAG,GRDFHLOK    SET START ON WEEKEND/HOLIDAY OK              
         SPACE 1                                                                
         MVI   GRDITH,0            00:01                                        
         MVI   GRDITM,1                                                         
         GOTO1 GETRET,(R3)         DETERMINE DUE DATE                           
         BNE   ADUES130            SKIP IF NONE FOUND (NO CALENDAR YET)         
         GOTOR UNIOND,DMCB,GETRET,(R3),PARAS                                    
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE 1                                                                
         GOTO1 DATCON,DMCB,(3,GRDODY),(1,TGFULL) CONVERT TO PWOS                
         CLC   0(L'TADDDATE,R2),TGFULL                                          
         BNH   ADUES130                                                         
         MVC   0(L'TADDDATE,R2),TGFULL                                          
         SPACE 1                                                                
ADUES130 CLC   0(L'TADDDATE,R2),TGTODAY1                                        
         BNL   ADUES10                                                          
         MVC   0(L'TADDDATE,R2),TGTODAY1                                        
         B     ADUES10                                                          
         SPACE 1                                                                
ADUES140 GOTO1 ADDELEM                                                          
         DROP  R4                                                               
         SPACE 1                                                                
ADUESX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO CHECK IF A RECORD IS ELIGIBLE FOR DELETE              
         SPACE 1                                                                
DELTEST  NTR1  BASE=*,LABEL=*                                                   
         USING TADVD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   DTESTX                                                           
         TM    TADVSTAT,TADVSSNT                                                
         BNZ   NODEL                                                            
DTESTX   XIT1                                                                   
         SPACE 2                                                                
NODEL    MVI   ERROR,ERINVDEL      CANNOT DELETE RECORD                         
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO SEE IF ADVICE TO BE SENT SHOULD RETURN                
*              SPECIAL MESSAGE BECAUSE NO DETAIL RECORD ADDED                   
         SPACE 1                                                                
WSPCHECK NTR1  BASE=*,LABEL=*                                                   
         TM    WSPSTAT,NEEDDET     IF NEED DETAILS STATUS IS ALREADY            
         BZ    WSP10               ON AND PF20 HAS BEEN HIT, TURN IT            
         CLI   PFAID,20            OFF AND CONTINUE                             
         BNE   WSP10                                                            
         MVI   PFAID,0                                                          
         B     WSP50                                                            
         SPACE 1                                                                
WSP10    L     R4,AIO              IF MARKETS HAVE BEEN ENTERED                 
         MVI   ELCODE,TAMTELQ      DO NOT GIVE MESSAGE                          
         BRAS  RE,GETEL                                                         
         BE    WSP50                                                            
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            IF NO USE DETAILS ELEMENT                    
         BNE   WSPX                USE CAN'T BE WILDSPOT                        
         SPACE 1                                                                
         USING TAVUD,R4                                                         
         LA    RE,WSPTAB           IF USE IS NOT IN WILDSPOT                    
WSP20    CLI   0(RE),X'FF'         TABLE THEN NO NEED TO SEND                   
         BE    WSPX                MESSAGE                                      
         CLC   0(1,RE),TAVUUSE                                                  
         BE    WSP30                                                            
         LA    RE,1(RE)                                                         
         B     WSP20                                                            
         DROP  R4                                                               
         SPACE 1                                                                
WSP30    GOTO1 RECVAL,DMCB,TLCMCDQ,(X'C0',TYPEV)                                
         GOTO1 HIGH                                                             
         CLC   KEY(TLCMLEV-TLCMKEY),KEYSAVE                                     
         BE    WSP40               IF DETAILS RECORD DOES NOT EXIST             
         OI    WSPSTAT,NEEDDET     SET NEED DETAILS STATUS                      
         SPACE 1                                                                
WSP40    GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0) REREAD ADVICE RECORD               
         B     WSPX                                                             
         SPACE 1                                                                
WSP50    NI    WSPSTAT,ALL-NEEDDET                                              
WSPX     XIT1                                                                   
         SPACE 2                                                                
TYPEV    DC    C'V'                                                             
         SPACE 2                                                                
*              TABLE OF USES FOR ACTION SEND TO WANT DETAIL RECORD              
WSPTAB   DC    0AL1                                                             
         DC    AL1(UWSP)           TELEVISION/RADIO WILDSPOT                    
         DC    AL1(UADC)           ADDENDUM COMBINED SES/WSP                    
         DC    AL1(UADW)           ADDENDUM WILDSPOT                            
         DC    AL1(USWS)           SPANISH WILDSPOT                             
         DC    AL1(USNW)           SPANISH NETWORK/WILDSPOT COMBINED            
         DC    AL1(UWSC)           CANADIAN WILDSPOT                            
         DC    AL1(UWSM)           CANADIAN WILDSPOT COMBINED                   
         DC    X'FF'                                                            
         EJECT                                                                  
*              ROUTINE TO SET UP DETAILS SCREEN IF PFKEY HIT                    
         SPACE 1                                                                
PFCMNT   NTR1  BASE=*,LABEL=*                                                   
         CLI   LWRSCR,SCR8C        IF ON MENU SCREEN                            
         BNE   PFCMNTX                                                          
         CLI   PFAID,15            AND PF15 IS HIT                              
         BNE   PFCMNTX                                                          
         MVI   COMTYPV,TLCMTADV    SET COMMENT RECORD TYPE V                    
         L     R1,ASVRU                                                         
         MVI   0(R1),DV            AND SAVE WHERE WE CAME FROM                  
         MVI   SELECT,0                                                         
PFCMNTX  XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO CALL INITIAL BASED ON CURRENT SCREEN                  
         SPACE 1                                                                
INIT     NTR1  BASE=*,LABEL=*                                                   
         CLI   VSDONE,C'Y'         IF FAKING A SELECT AND JUST                  
         BNE   INIT01              FINISHED VERIFYING OR SENDING                
         CLI   PFAID,14                                                         
         BE    INIT01                                                           
         MVI   VSDONE,0                                                         
         CLI   PFAID,24                                                         
         BE    INIT01                                                           
         MVI   PFAID,21            RESTORE LIST SCREEN                          
         OI    TRNSTAT,OKINTPFK                                                 
         GOTO1 INITIAL,DMCB,APPPFTAB                                            
         SPACE 1                                                                
INIT01   LA    R3,PFTAB                                                         
         CLI   LWRSCR,SCR8C        MENU ADDS USE PFTAB                          
         BNE   INIT05                                                           
         CLI   ACTNUM,ACTADD       MENU NON-ADDS USE PFTAB5                     
         BE    INIT10                                                           
         GOTOR PFCMNT                                                           
         LA    R3,PFTAB5                                                        
         B     INIT10                                                           
         SPACE 1                                                                
INIT05   LA    R3,PFTAB3           CLASS A USES PFTAB3                          
         CLI   LWRSCR,SCR0E                                                     
         BE    INIT10                                                           
         CLI   LWRSCR,SCR98        CABLE USES PFTAB3                            
         BE    INIT10                                                           
         SPACE 1                                                                
         LA    R3,PFTAB4           SESSION USES PFTAB4                          
         CLI   LWRSCR,SCR04                                                     
         BE    INIT10                                                           
         SPACE 1                                                                
         LA    R3,PFTAB2           TELEVISION, RADIO, ADDENDUM, SPANISH         
INIT10   GOTO1 INITIAL,DMCB,(X'40',(R3))            CANADIAN USE PFTAB2         
         CLI   LWRSCR,SCR8C                                                     
         BE    INX                                                              
         CLI   PFAID,21            CANNOT VERIFY                                
         BE    *+12                                                             
         CLI   PFAID,22            OR SEND ADVICE                               
         BNE   INX                                                              
         CLI   ACTNUM,ACTADD       UNTIL ADVICE HAS BEEN ADDED                  
         BE    MUSTADD                                                          
         GOTO1 INITIAL,DMCB,(X'40',PFTAB6)                                      
INX      XIT1                                                                   
         SPACE 1                                                                
*        LA    R2,MENAGYH                                                       
MUSTADD  MVI   MYMSGNO1,101                                                     
         L     R2,EFHREC                                                        
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              PF KEY TABLE FOR MENU SCREEN ADDS                                
         SPACE 1                                                                
PFTAB    DS    0C                                                               
         DC    AL1(PF13XA-*,13,0,0,0)                                           
         DC    CL3' ',CL8'ADVICE  ',CL8'LIST    '                               
PF13XA   EQU   *                                                                
         DC    AL1(PF14XA-*,14,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF14XA   EQU   *                                                                
         DC    AL1(PF15XA-*,15,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF15XA   EQU   *                                                                
         DC    AL1(PF16XA-*,16,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF16XA   EQU   *                                                                
         DC    AL1(PF17XA-*,17,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF17XA   EQU   *                                                                
         DC    AL1(PF18XA-*,18,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF18XA   EQU   *                                                                
         DC    AL1(PF19XA-*,19,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF19XA   EQU   *                                                                
         DC    AL1(PF20XA-*,20,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF20XA   EQU   *                                                                
         DC    AL1(PF21XA-*,21,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF21XA   EQU   *                                                                
         DC    AL1(PF22XA-*,22,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF22XA   EQU   *                                                                
         DC    X'FF'                                                            
         SPACE 2                                                                
*              PF KEY TABLE FOR MENU SCREEN NON-ADDS                            
         SPACE 1                                                                
PFTAB5   DS    0C                                                               
         DC    AL1(PF13X-*,13,0,0,0)                                            
         DC    CL3' ',CL8'        ',CL8'LIST    '                               
PF13X    EQU   *                                                                
         DC    AL1(PF14X-*,14,0,0,PFTRETRN)                                     
         DC    CL3' ',CL8'        ',CL8'        '                               
PF14X    EQU   *                                                                
         DC    AL1(PF15X-*,15,0,(PF15X-PF15)/KEYLNQ,0)                          
         DC    CL3'  ',CL8'DETAILS ',CL8'DISPLAY'                               
PF15     DC    AL1(KEYTYGLB,L'TGAGY-1),AL2(TGAGY-TGD)                           
         DC    AL1(KEYTYTWA,L'COMTYPV-1),AL2(COMTYPV-T702FFD)                   
         DC    AL1(KEYTYGLB,L'TGCID-1),AL2(TGCID-TGD)                           
         DC    AL1(KEYTYGLB,L'TGADV-1),AL2(TGADV-TGD)                           
PF15X    EQU   *                                                                
         DC    AL1(PF16X-*,16,0,0,0)                                            
         DC    CL3' ',CL8'        ',CL8'COMPLETE'                               
PF16X    EQU   *                                                                
         DC    AL1(PF20X-*,20,0,0,PFTRETRN)                                     
         DC    CL3' ',CL8'        ',CL8'        '                               
PF20X    EQU   *                                                                
         DC    AL1(PF21X-*,21,0,0,0)                                            
         DC    CL3' ',CL8'        ',CL8'VERIFY  '                               
PF21X    EQU   *                                                                
         DC    AL1(PF22X-*,22,0,0,0)                                            
         DC    CL3' ',CL8'        ',CL8'SEND    '                               
PF22X    EQU   *                                                                
         DC    AL1(PF23X-*,23,0,0,0)                                            
         DC    CL3' ',CL8'ASPLIT  ',CL8'CHANGE  '                               
PF23X    EQU   *                                                                
         DC    AL1(PF24X-*,24,0,0,PFTSETPN)                                     
         DC    CL3' ',CL8'        ',CL8'REPORT  '                               
PF24X    EQU   *                                                                
         DC    X'FF'                                                            
*              PF TABLE FOR CLASS A SCREEN                                      
         SPACE 1                                                                
PFTAB3   DS    0C                                                               
         DC    AL1(PF13XC-*,13,0,0,0)                                           
         DC    CL3' ',CL8'ADVICE  ',CL8'LIST    '                               
PF13XC   EQU   *                                                                
         DC    AL1(PF14XC-*,14,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF14XC   EQU   *                                                                
         DC    AL1(PF15XC-*,15,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF15XC   EQU   *                                                                
         DC    AL1(PF20XC-*,20,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF20XC   EQU   *                                                                
         DC    AL1(PF21XC-*,21,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF21XC   EQU   *                                                                
         DC    AL1(PF22XC-*,22,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF22XC   EQU   *                                                                
         DC    AL1(PF23XC-*,23,0,0,0)                                           
         DC    CL3' ',CL8'ASPLIT  ',CL8'CHANGE  '                               
PF23XC   EQU   *                                                                
         DC    AL1(PF24XC-*,24,0,0,PFTSETPN)                                    
         DC    CL3' ',CL8'        ',CL8'REPORT  '                               
PF24XC   EQU   *                                                                
         DC    X'FF'                                                            
         SPACE 2                                                                
*              PF TABLE FOR TV, RADIO, ADDENDUM, SPANISH AND CANADIAN           
         SPACE 1                                                                
PFTAB2   DS    0C                                                               
         DC    AL1(PF13XE-*,13,0,0,0)                                           
         DC    CL3' ',CL8'ADVICE  ',CL8'LIST    '                               
PF13XE   EQU   *                                                                
         DC    AL1(PF14XE-*,14,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF14XE   EQU   *                                                                
         DC    AL1(PF20XE-*,20,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF20XE   EQU   *                                                                
         DC    AL1(PF21XE-*,21,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF21XE   EQU   *                                                                
         DC    AL1(PF22XE-*,22,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF22XE   EQU   *                                                                
         DC    AL1(PF23XE-*,23,0,0,0)                                           
         DC    CL3' ',CL8'ASPLIT  ',CL8'CHANGE  '                               
PF23XE   EQU   *                                                                
         DC    AL1(PF24XE-*,24,0,0,PFTSETPN)                                    
         DC    CL3' ',CL8'        ',CL8'REPORT  '                               
PF24XE   EQU   *                                                                
         DC    X'FF'                                                            
         SPACE 2                                                                
*              PF TABLE FOR SESSION SCREEN                                      
         SPACE 1                                                                
PFTAB4   DS    0C                                                               
         DC    AL1(PF13XS-*,13,0,0,0)                                           
         DC    CL3' ',CL8'ADVICE  ',CL8'LIST    '                               
PF13XS   EQU   *                                                                
         DC    AL1(PF14XS-*,14,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF14XS   EQU   *                                                                
         DC    AL1(PF15XS-*,15,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF15XS   EQU   *                                                                
         DC    AL1(PF16XS-*,16,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF16XS   EQU   *                                                                
         DC    AL1(PF20XS-*,20,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF20XS   EQU   *                                                                
         DC    AL1(PF21XS-*,21,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF21XS   EQU   *                                                                
         DC    AL1(PF22XS-*,22,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8'        ',CL8'        '                               
PF22XS   EQU   *                                                                
         DC    AL1(PF23XS-*,23,0,0,0)                                           
         DC    CL3' ',CL8'ASPLIT  ',CL8'CHANGE  '                               
PF23XS   EQU   *                                                                
         DC    AL1(PF24XS-*,24,0,0,PFTSETPN)                                    
         DC    CL3' ',CL8'        ',CL8'REPORT  '                               
PF24XS   EQU   *                                                                
         DC    X'FF'                                                            
         SPACE 2                                                                
APPPFTAB DS    0H                                                               
         DC    AL1(AP21X-*,21,PFTRPROG+PFTINT,0,0)                              
         DC    CL3' ',CL8' ',CL8' '                                             
AP21X    EQU   *                                                                
         DC    X'FF'                                                            
         SPACE 2                                                                
*              PF TABLE FOR NON-MENU SCREEN VERIFIES AND SENDS                  
         SPACE 1                                                                
PFTAB6   DS    0C                                                               
PF20X6   EQU   *                                                                
         DC    AL1(PF21X6-*,21,0,0,0)                                           
         DC    CL3' ',CL8'        ',CL8'VERIFY  '                               
PF21X6   EQU   *                                                                
         DC    AL1(PF22X6-*,22,0,0,0)                                           
         DC    CL3' ',CL8'        ',CL8'SEND    '                               
PF22X6   EQU   *                                                                
         DC    X'FF'                                                            
         EJECT                                                                  
*              ROUTINE DETERMINES WHICH SCREEN USER WANTS TO GO TO              
         SPACE 1                                                                
*  LWRSCR = CURRENT SCREEN      OVERLAY = WHERE TO GO                           
         SPACE 1                                                                
GOTOSCRN NTR1  BASE=*,LABEL=*                                                   
         CLI   LWRSCR,SCR8C        IF ADDING ON MENU SCREEN                     
         BNE   GOTO10                                                           
         CLI   ACTNUM,ACTADD                                                    
         BNE   GOTO05                                                           
         MVI   OVERLAY,SCRF0                                                    
         CLI   PFAID,15            IF PFKEY15 HIT                               
         BE    GOTOX               SET OVERLAY TO TELEVISION                    
         MVI   OVERLAY,SCRF1                                                    
         CLI   PFAID,16            IF PFKEY17 HIT                               
         BE    GOTOX               SET OVERLAY TO RADIO                         
         MVI   OVERLAY,SCR0E                                                    
         CLI   PFAID,17            IF PFKEY16 HIT                               
         BE    GOTOX               SET OVERLAY TO CLASS A                       
         MVI   OVERLAY,SCRF2                                                    
         CLI   PFAID,18            IF PFKEY18 HIT                               
         BE    GOTOX               SET OVERLAY TO ADDENDUM                      
         MVI   OVERLAY,SCRF3                                                    
         CLI   PFAID,19            IF PFKEY19 HIT                               
         BE    GOTOX               SET OVERLAY TO SPANISH                       
         MVI   OVERLAY,SCRF4                                                    
         CLI   PFAID,20            IF PFKEY20 HIT                               
         BE    GOTOX               SET OVERLAY TO CANADIAN                      
         MVI   OVERLAY,SCR98                                                    
         CLI   PFAID,21            IF PFKEY21 HIT                               
         BE    GOTOX               SET OVERLAY TO CABLE                         
         MVI   OVERLAY,SCR53                                                    
         CLI   PFAID,22            IF PFKEY22 HIT                               
         BE    GOTOX               SET OVERLAY TO INET/NEWMEDIA                 
         CLI   PFAID,14                                                         
         BE    *+6                 IF PFKEY14 HIT                               
         DC    H'00'               SET OVERLAY TO SESSIONS                      
         MVI   OVERLAY,SCR04                                                    
         B     GOTOX                                                            
         SPACE 1                                                                
GOTO05   CLI   PFAID,14            IF DISPLAYING OR CHANGING                    
         BE    *+6                 ON MENU SCREEN                               
         DC    H'00'               PF14 IS ONLY VALID PFKEY                     
         USING TADVD,R4                                                         
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'00'                                                            
         CLI   TADVTYPE,TADVTYPS                                                
         BNE   *+12                IF TYPE S                                    
         MVI   OVERLAY,SCR04       SET OVERLAY TO SESSION                       
         B     GOTOX                                                            
         MVI   OVERLAY,SCRF2       IF TYPE A                                    
         CLI   TADVTYPE,TADVTYPA   SET OVERLAY TO ADDENDUM                      
         BE    GOTOX                                                            
         MVI   OVERLAY,SCRF3       IF TYPE P                                    
         CLI   TADVTYPE,TADVTYPP   SET OVERLAY TO SPANISH                       
         BE    GOTOX                                                            
         MVI   OVERLAY,SCRF4       IF TYPE N                                    
         CLI   TADVTYPE,TADVTYPN   SET OVERLAY TO CANADIAN                      
         BE    GOTOX                                                            
         MVI   OVERLAY,SCR0E       IF TYPE C                                    
         CLI   TADVTYPE,TADVTYPC   SET OVERLAY TO CLASS A                       
         BE    GOTOX                                                            
         MVI   OVERLAY,SCRF0       IF TYPE T                                    
         CLI   TADVTYPE,TADVTYPT   SET OVERLAY TO TELEVISION                    
         BE    GOTOX                                                            
         MVI   OVERLAY,SCR98       IF TYPE B                                    
         CLI   TADVTYPE,TADVTYPB   SET OVERLAY TO CABLE                         
         BE    GOTOX                                                            
         MVI   OVERLAY,SCR53       IF TYPE I                                    
         CLI   TADVTYPE,TADVTYPI   SET OVERLAY TO INTERNET/NEWMEDIA             
         BE    GOTOX                                                            
         MVI   OVERLAY,SCRF1       IF TYPE D                                    
         CLI   TADVTYPE,TADVTYPD   SET OVERLAY TO RADIO                         
         BE    GOTOX                                                            
         CLI   TADVTYPE,TADVTYPR   IF TYPE R                                    
         BE    *+6                                                              
         DC    H'00'                                                            
         USING TAVUD,R4                                                         
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BE    *+6                                                              
         DC    H'00'                                                            
         LA    R5,TAVUUSE          IF REGULAR USE PRESENT CALL                  
         LA    R6,TAVUTYPE         USEVAL WITH REGULAR USE                      
         CLI   TAVUUSE,0                                                        
         BNE   GOTO06              IF REGULAR USE NOT PRESENT CALL              
         CLI   TAVUUSE2,0                                                       
         BE    GOTO07                                                           
         LA    R5,TAVUUSE2         USEVAL WITH MUSIC USE                        
         LA    R6,TAVUTYP2                                                      
GOTO06   GOTO1 USEVAL,DMCB,(X'80',(R5)),(X'80',(R6))                            
         MVI   OVERLAY,SCRF2                                                    
         TM    TGUSSTA3,ADDENUSE   IF USE'S 3RD STATUS IS ADDENDUSE             
         BO    GOTOX               SET OVERLAY TO ADDENDUM                      
         MVI   OVERLAY,SCRF3                                                    
         TM    TGUSSTA2,SPANUSE    IF USE'S 2ND STATUS IS SPANUSE               
         BO    GOTOX               SET OVERLAY TO SPANISH                       
         MVI   OVERLAY,SCRF4                                                    
         TM    TGUSSTAT,CANUSE     IF USE'S 1ST STATUS IS CANADIAN              
         BO    GOTOX               SET OVERLAY TO CANADIAN                      
         MVI   OVERLAY,SCR0E                                                    
         TM    TGUSSTA3,NWKUSE     IF ADVICE'S 3RD STATUS IS NETWORK            
         BO    GOTOX               SET OVERLAY TO CLASS A                       
GOTO07   MVI   OVERLAY,SCRF0                                                    
         CLI   TAVUMED,TACOMEDT    IF MEDIA IS TELEVISION                       
         BE    GOTOX               SET OVERLAY TO TELEVISION                    
         CLI   TAVUMED,TACOMEDI    IF MEDIA IS INTERNET                         
         BE    GOTOX               SET OVERLAY TO TELEVISION                    
         CLI   TAVUMED,TACOMEDN    IF MEDIA IS NEW MEDIA                        
         BE    GOTOX               SET OVERLAY TO TELEVISION                    
         MVI   OVERLAY,SCRF1                                                    
         CLI   TAVUMED,TACOMEDR    IF MEDIA IS RADIO                            
         BE    GOTOX               SET OVERLAY TO RADIO                         
         DC    H'00'                                                            
         SPACE 1                                                                
GOTO10   CLI   LWRSCR,SCR0E        IF ON CLASS A SCREEN                         
         BNE   GOTO20                                                           
         MVI   OVERLAY,SCR8C       IF PFKEY14 HIT                               
         CLI   PFAID,14            SET OVERLAY TO MENU                          
         BE    GOTOX                                                            
         MVI   OVERLAY,SCR0E       PFKEY15 (SCROLL) IS ALSO VALID               
         CLI   PFAID,15                                                         
         BE    GOTOX                                                            
         B     PFKINV                                                           
         SPACE                                                                  
GOTO20   CLI   LWRSCR,SCR04        IF ON SESSION SCREEN                         
         BNE   GOTO30                                                           
         MVI   OVERLAY,SCR8C       IF PFKEY14 HIT                               
         CLI   PFAID,14            SET OVERLAY TO MENU                          
         BE    GOTOX                                                            
         MVI   OVERLAY,SCR04                                                    
         CLI   PFAID,15            PFKEY15(SCROLL) AND                          
         BE    GOTOX                                                            
         CLI   PFAID,16            PFKEY16(DELETE/RESTORE) VALID                
         BE    GOTOX                                                            
         B     PFKINV                                                           
         SPACE                                                                  
GOTO30   CLI   PFAID,20                                                         
         BE    GOTOX                                                            
         MVI   OVERLAY,SCR8C       IF ON TV, RADIO, ADDENDUM, SPANISH           
         CLI   PFAID,14            OR CANADIAN SCREEN ... IF PFKEY14            
         BNE   PFKINV              HIT SET OVERLAY TO MENU                      
GOTOX    XIT1                                                                   
         SPACE 2                                                                
PFKINV   MVI   ERROR,ERINVPFK                                                   
         LH    R2,CURDISP                                                       
         AR    R2,RA                                                            
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE LOADS THE SCREEN IN OVERLAY                              
         SPACE 2                                                                
GETSCRN  NTR1  BASE=*,LABEL=*                                                   
         LA    R3,MENTAGH          SET STARTING POINT FOR LOAD                  
         CLI   OVERLAY,SCR8C                                                    
         BNE   GSCR4                                                            
         LA    R3,CONTAGH                                                       
         SPACE                                                                  
         CLI   LWRSCR,SCR8C                                                     
         BNE   GSCR3                                                            
         CLI   ACTNUM,ACTADD                                                    
         BNE   GSCR3                                                            
         LA    R4,MENCLINH                                                      
         LA    R5,MENCOM8H                                                      
GSCR1    TM    4(R4),X'80'                                                      
         BO    GSCR2                                                            
         GOTO1 FLDVAL,DMCB,(1,0(R4)),(X'80',1)                                  
GSCR2    ZIC   RE,0(R4)                                                         
         AR    R4,RE                                                            
         CR    R4,R5                                                            
         BNH   GSCR1                                                            
         TM    AGYSTA4,TAAYDCAE                                                 
         BZ    GSCRX                                                            
         L     RE,ASVESTFD                                                      
         OC    0(32,RE),0(RE)                                                   
         BZ    GSCRX                                                            
         CLI   0(RE),X'20'         ENSURE SAVED ESTIMATE FIELD IS OK            
         BNE   GSCRX                                                            
         MVC   MENESTH(32),0(RE)                                                
         B     GSCRX                                                            
         SPACE 1                                                                
         USING TEMPKYFD,RE                                                      
GSCR3    L     RE,ATEMPKYF                                                      
         MVC   TEMPAGY,MENAGYH     IF GOING TO MENU SCREEN                      
         MVC   TEMPCID,MENCIDH     SAVE KEY FIELDS                              
         MVC   TEMPADV,MENADVH                                                  
         DROP  RE                                                               
         SPACE                                                                  
GSCR4    MVC   LWRSCR,OVERLAY      LWRSCR = SCREEN TO BE LOADED                 
         GOTO1 LOADSOPH,DMCB,1     LOAD NEW SCREEN                              
         SPACE                                                                  
         CLI   OVERLAY,X'8C'       IF NOW ON MENU SCREEN                        
         BNE   GSCR8                                                            
         USING TEMPKYFD,RE                                                      
         L     RE,ATEMPKYF                                                      
         MVC   MENAGYH(14),TEMPAGY RE-INSERT KEY FIELDS                         
         MVC   MENCIDH(20),TEMPCID                                              
         MVC   MENADVH(14),TEMPADV                                              
         DROP  RE                                                               
         TM    AGYSTA4,TAAYDCAE    AND POSSIBLY ESTIMATE                        
         BZ    GSCR8                                                            
         L     RE,ASVESTFD                                                      
         OC    0(32,RE),0(RE)                                                   
         BZ    GSCR8                                                            
         CLI   0(RE),X'20'         ENSURE SAVED ESTIMATE FIELD IS OK            
         BNE   GSCR8                                                            
         MVC   MENESTH(32),0(RE)                                                
         SPACE                                                                  
GSCR8    OI    6(R3),X'80'         IF NOW ON SESSION SCREEN                     
         OI    7(R3),X'80'         BUILD AND TRANSMIT EACH FIELD                
         ZICM  R1,0(R3),1          UNTIL END OF SCREEN                          
         BZ    GSCRX                                                            
         AR    R3,R1                                                            
         B     GSCR8                                                            
GSCRX    XIT1                                                                   
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY TOP OF MENU SCREEN                            
         SPACE 2                                                                
DMENTOP  NTR1  BASE=*,LABEL=*                                                   
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         TWAXC MENVERH             CLEAR VERSION/LIFT FIELD                     
         MVI   ELCODE,TAFNELQ                                                   
         GOTO1 GETL,DMCB,(1,=AL1(TAFNTVER))                                     
         BNE   DMTOP10                                                          
         USING TAFND,R4            R4=A(VERSION/LIFT ELEMENT)                   
         L     R4,TGELEM                                                        
         MVC   MENVER(1),TAFNNAME  MOVE VERSION/LIFT TO SCREEN                  
         OI    MENVERH+6,X'80'                                                  
         CLI   VERLIFT,C'V'                                                     
         BNE   DMTOP03                                                          
         EDIT  (1,TAFNNAME),MENVER,ALIGN=LEFT                                   
DMTOP03  CLI   COMEXIST,C'Y'       IF COMMERICIAL EXISTS                        
         BNE   DMTOP10                                                          
         CLI   MAINEXST,C'N'                                                    
         BE    DMTOP10                                                          
         MVC   AIO,AIO2            READ FOR COMMERCIAL RECORD                   
         GOTO1 RECVAL,DMCB,TLCOICDQ,(X'24',MENCIDH)                             
         BE    *+6                                                              
         DC    H'00'                                                            
         SPACE 1                                                                
         BRAS  RE,VER2SCR          MOVE VERSION DESCRIPTION TO SCREEN           
         SPACE 1                                                                
DMTOP10  MVC   AIO,AIO1                                                         
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         SPACE 1                                                                
         CLI   RECNUM,PV                                                        
         BNE   DMTOP10A                                                         
         CLI   0(R4),TLPVCDQ                                                    
         BE    DMTOP11                                                          
         GOTO1 RECVAL,DMCB,TLPVCDQ,(X'30',0),('TLPVSCDQ',0)                     
         B     DMTOP11                                                          
         SPACE 1                                                                
DMTOP10A CLI   0(R4),TLDVCDQ                                                    
         BE    DMTOP11                                                          
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
         SPACE 1                                                                
DMTOP11  MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TADVD,R4                                DISPLAY                  
         GOTO1 CHAROUT,DMCB,TAFNELQ,MENCLINH,TAFNTCLI  CLIENT NAME              
         GOTO1 (RF),(R1),TAFNELQ,MENPRDNH,TAFNTPRD     PRODUCT NAME             
         GOTO1 (RF),(R1),TAFNELQ,MENCIDNH,TAFNTTTL     COMMERCIAL TITLE         
         GOTO1 (RF),(R1),TANUELQ,MENAUTHH,TANUTAUT     AUTH/PO                  
         GOTO1 (RF),(R1),TANUELQ,MENESTH,TANUTEST      ESTIMATE                 
         L     RE,ASVESTFD                                                      
         MVC   0(32,RE),MENESTH                                                 
         GOTO1 DATCON,DMCB,(1,TADVEXP),(8,MENEXP)      EXPIRATION DATE          
         EDIT  TADVSEC,MENSEC,ALIGN=LEFT               MEDIA LENGTH             
         STC   R0,MENSECH+5                                                     
         SPACE 1                                                                
         GOTO1 CHAROUT,DMCB,TACMELQ,(2,MENCOM1H),TACMTYPG                       
         SPACE 1                                                                
         LA    R2,MENCOM1H         R2=A(FIRST COMMENT FIELD)                    
         LA    R5,8                R5=# OF COMMENT FIELDS                       
         LA    R6,1                R6=COMMENT FIELD COUNTER                     
DMTOP15  L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAXCELQ                                                   
         BRAS  RE,GETEL            R4=A(COMMENT ELEMENT)                        
         B     *+8                                                              
DMTOP20  BRAS  RE,NEXTEL                                                        
         BNE   DMTOP25                                                          
         USING TAXCD,R4                                                         
         ZIC   RE,TAXCSEQ          MATCH UP SEQUENCE # IN ELEMENT               
         CR    R6,RE               TO SEQUENCE # OF COMMENT FIELD               
         BNE   DMTOP20                                                          
         ZIC   RE,TAXCLEN                                                       
         CHI   RE,73                                                            
         BNH   *+8                                                              
         LHI   RE,73                                                            
         SHI   RE,4                                                             
         STC   RE,5(R2)            PUT LENGTH TO SCREEN                         
         OI    6(R2),X'80'         TRANSMIT                                     
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),TAXCCMNT    DISPLAY COMMENT                              
DMTOP25  ZIC   RE,0(R2)                                                         
         AR    R2,RE               BUMP TO NEXT COMMENT FIELD                   
         LA    R6,1(R6)            INCREMENT COMMENT FIELD COUNTER              
         BCT   R5,DMTOP15                                                       
         SPACE                                                                  
DMTOP30  L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TASIELQ                                                   
         BRAS  RE,GETEL            IF SUBSIDARY INVOICE ELEMENT EXISTS          
         BNE   *+10                INDICATE SO                                  
         MVC   MENEST(16),=CL16'SPLIT'                                          
         SPACE                                                                  
         CLI   VERLIFT,C'V'        IF VERLIFT NOT SET AS V                      
         BE    DMTOP40                                                          
         GOTOR DISLIFT             DISPLAY LIFT DETAILS                         
         MVI   VERLIFT,C'N'                                                     
         CLI   MENLIDH+5,0                                                      
         BE    *+8                                                              
         MVI   VERLIFT,C'L'                                                     
         SPACE 1                                                                
DMTOP40  GOTOR DISCONS             DISPLAY AFM CONTRACT NUMBERS                 
         SPACE                                                                  
         USING TAVUD,R4            DISPLAY MEDIA AND ESTIMATE PERIOD            
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BE    *+6                                                              
         DC    H'00'                                                            
         MVC   MENMED,TAVUMED                                                   
         EDIT  TAVUESPD,MENESPD,ZERO=BLANK,ALIGN=LEFT                           
         SPACE 1                                                                
         GOTO1 FLDVAL,DMCB,MENRDUH,(X'08',MENRDTH)                              
         CLI   TGCTSTTY,TASTTYPC                                                
         BE    DMTOP50                                                          
         CLI   TGCTSTTY,TASTTYPF                                                
         BE    DMTOP50                                                          
         CLI   TGCTSTTY,TASTTYPD                                                
         BE    DMTOP50                                                          
         CLI   TAVUUSE,0                                                        
         BE    DMTOP50                                                          
         GOTO1 USEVAL,DMCB,(X'80',TAVUUSE),(X'80',TAVUTYPE)                     
         MVC   MENRDU,TGUSCDE                                                   
         SPACE 1                                                                
DMTOP50  GOTO1 FLDVAL,DMCB,MENMDUH,(X'08',MENMDTH)                              
         CLI   TGCTSTTY,TASTTYPC                                                
         BE    DMTOP60                                                          
         CLI   TGCTSTTY,TASTTYPF                                                
         BE    DMTOP60                                                          
         CLI   TGCTSTTY,TASTTYPD                                                
         BE    DMTOP60                                                          
         CLI   TAVUUSE2,0                                                       
         BE    DMTOP60                                                          
         GOTO1 USEVAL,DMCB,(X'80',TAVUUSE2),(X'80',TAVUTYP2)                    
         MVC   MENMDU,TGUSCDE                                                   
         DROP  R4                                                               
         SPACE 1                                                                
         USING TADDD,R4                                                         
DMTOP60  L     R4,AIO                                                           
         MVI   ELCODE,TADDELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   DMTOPX                                                           
         SPACE 1                                                                
         CLI   TGCTSTTY,TASTTYPC                                                
         BE    DMTOPX                                                           
         CLI   TGCTSTTY,TASTTYPF                                                
         BE    DMTOPX                                                           
         CLI   TGCTSTTY,TASTTYPD                                                
         BE    DMTOPX                                                           
         SPACE 1                                                                
         OC    TADDDATE,TADDDATE                                                
         BZ    DMTOP70                                                          
         GOTO1 DATCON,DMCB,(1,TADDDATE),(8,MENRDT)                              
         GOTO1 FLDVAL,DMCB,MENRDUH,(X'20',MENRDTH)                              
         SPACE 1                                                                
DMTOP70  OC    TADDDATM,TADDDATM                                                
         BZ    DMTOPX                                                           
         GOTO1 DATCON,DMCB,(1,TADDDATM),(8,MENMDT)                              
         GOTO1 FLDVAL,DMCB,MENMDUH,(X'20',MENMDTH)                              
DMTOPX   XIT1                                                                   
         DROP  R4                                                               
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY BOTTOM OF MENU SCREEN                         
         SPACE 1                                                                
DMENBOT  NTR1  BASE=*,LABEL=*                                                   
         CLI   ACTNUM,ACTREST      ACTION RESTORE?                              
         BE    DMBOTX              YES - EXIT                                   
         SPACE 1                                                                
         LA    RE,7                                                             
         LA    R2,MENPFK1H                                                      
DMBOT10  NI    1(R2),X'F7'         INITIALIZE BOTTOM LINE OF                    
         OI    1(R2),X'0C'         PF KEYS TO ZERO INTENSITY                    
         OI    6(R2),X'80'                                                      
         ZIC   RF,0(R2)                                                         
         AR    R2,RF                                                            
         BCT   RE,DMBOT10                                                       
         SPACE 1                                                                
         LA    RE,4                                                             
         LA    R2,MENLIN1H                                                      
DMBOT20  MVC   8(L'MENLIN1,R2),SPACES                                           
         OI    6(R2),X'80'                                                      
         ZIC   RF,0(R2)            INTIALIZE ALL FLIP TO SCREEN                 
         AR    R2,RF               PF KEY FIELDS TO SPACES                      
         BCT   RE,DMBOT20                                                       
         SPACE 1                                                                
         CLI   USESES,ASSIGNED     IF ADVICE NOT YET ASSIGNED A USE             
         BE    DMBOT30             OR SESSION                                   
         BAS   RE,PFS4ADD          DISPLAY VALID SCREEN FLIPS                   
         BRAS  RE,BLDPFTAB         BUILD TABLE OF VALID SCREEN FLIPS            
         B     DMBOTX                                                           
         SPACE 1                                                                
*                                  IF ADVICE HAD BEEN ASSIGNED A USE            
*                                  OR SESSION DISPLAY USES, VERIF               
DMBOT30  GOTOR DMENINFO            SENT, PAID, RECEIVED, LAST CHGD              
DMBOTX   XIT1                                                                   
         SPACE 2                                                                
*              DISPLAY VALID SCREEN FLIPS FOR ADD FROM MENU SCREEN              
         SPACE 1                                                                
PFS4ADD  NTR1                                                                   
         MVC   MENFEED,SPACES                                                   
         MVC   MENCOMP,SPACES                                                   
         OI    MENFEEDH+6,X'80'                                                 
         OI    MENCOMPH+6,X'80'                                                 
         SPACE 1                                                                
         MVC   MENLIN2(L'SESS),SESS   SESSION IS ALWAYS VALID                   
         SPACE 1                                                                
         CLI   COMEXIST,C'Y'          IF COMMERCIAL EXISTS ...                  
         JNE   PFS4A10                                                          
         BRAS  RE,SETTYPE             SET COM/VER TYPE FOR VALIDATION           
         SPACE 1                                                                
         CLI   VLCOTYPE,CTYADD        IF  COMERCIAL IS TYPE A                   
         BNE   PFS4A05                ADDENDUM AND CABLE ARE VALID              
         MVC   MENLIN3+18(L'ADN),ADN                                            
         B     PFS4AX                                                           
         SPACE 1                                                                
PFS4A05  CLI   VLCOTYPE,CTYSPAN       IF COMMERCIAL IS TYPE S                   
         BNE   PFS4A06                SPANISH, CABLE AND INTERNET/              
         MVC   MENLIN4+18(L'SPA),SPA  NEW MEDIA ARE VALID                       
*        MVC   MENLIN3+56(L'CBL),CBL                                            
         MVC   MENLIN4+56(L'INM),INM                                            
         B     PFS4AX                                                           
         SPACE 1                                                                
PFS4A06  TM    COMSTAT,TACOSCAN       IF COMMERCIAL STATUS IS CANDIAN           
         BZ    PFS4A10                CANADIAN, CABLE AND INTERNET/             
         MVC   MENLIN2+56(L'CAN),CAN  NEW MEDIA ARE VALID                       
*        MVC   MENLIN3+56(L'CBL),CBL                                            
         MVC   MENLIN4+56(L'INM),INM                                            
         SPACE 1                                                                
*                                     IF COMMERCIAL EXISTS OR DOES NOT          
PFS4A10  TM    TGMEEQU,LIKETV         EXIST                                     
         BZ    PFS4A20                IF ADVICE MEDIA IS TELEVISION             
         MVC   MENLIN3(L'TEL),TEL     TELEVISION IS VALID                       
         MVC   MENLIN2+18(L'CLA),CLA  CLASS A IS VALID                          
*        MVC   MENLIN3+56(L'CBL),CBL  CABLE IS VALID                            
         MVC   MENLIN4+56(L'INM),INM  INTERNET/NEWMEDIA IS VALID                
         SPACE 1                                                                
PFS4A20  TM    TGMEEQU,RADIO                                                    
         BZ    PFS4A25                IF ADVICE MEDIA IS RADIO                  
         MVC   MENLIN4(L'RAD),RAD     RADIO IS VALID                            
*        MVC   MENLIN3+56(L'CBL),CBL  CABLE IS VALID                            
         MVC   MENLIN4+56(L'INM),INM  INTERNET/NEWMEDIA IS VALID                
         SPACE 1                                                                
PFS4A25  TM    TGMEEQU,CABLE                                                    
         BZ    PFS4A30                IF ADVICE MEDIA IS CABLE                  
         MVC   MENLIN3(L'TEL),TEL     TELEVISION IS VALID                       
*        MVC   MENLIN3+56(L'CBL),CBL  CABLE IS VALID                            
         MVC   MENLIN4+56(L'INM),INM  INTERNET/NEWMEDIA IS VALID                
         B     PFS4AX                                                           
         SPACE 1                                                                
PFS4A30  CLI   COMEXIST,C'N'          IF COMMERCIAL DOES NOT EXIST              
         BNE   PFS4AX                 AND MEDIA IS NOT CABLE                    
         MVC   MENLIN3+18(L'ADN),ADN  ADDENDUM IS VALID                         
         MVC   MENLIN4+18(L'SPA),SPA  SPANISH IS VALID                          
         MVC   MENLIN2+56(L'CAN),CAN  CANADIAN IS VALID                         
*        MVC   MENLIN3+56(L'CBL),CBL  CABLE IS VALID                            
         MVC   MENLIN4+56(L'INM),INM  INTERNET/NEWMEDIA IS VALID                
PFS4AX   B     DMBOTX                                                           
         SPACE 2                                                                
SESS     DC    C'PF14=COMPLETION'                                               
TEL      DC    C'PF15=TELEVISION'                                               
RAD      DC    C'PF16=RADIO USE'                                                
CLA      DC    C'PF17=CLA NET, DIGINETS, LATE NITE, ITN'                        
ADN      DC    C'PF18=ADDENDUM USE'                                             
SPA      DC    C'PF19=SPANISH USE'                                              
CAN      DC    C'PF20=CANADIAN USE'                                             
CBL      DC    C'PF21=CABLE/WILDSPOT'                                           
INM      DC    C'PF22=INET/NEW MEDIA'                                           
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO BOTTOM OF MENU SCREEN ON NON-ADDS                     
         SPACE 1                                                                
DMENINFO NTR1  BASE=*,LABEL=*                                                   
         MVC   MENLIN2(L'VERI),VERI     DISPLAY VERIFIED HEADING                
         MVC   MENLIN3(L'RECE),RECE             RECEIVED HEADING                
         MVC   MENLIN4(L'LCHA),LCHA             LAST CHANGED HEADING            
         MVC   MENLIN2+42(L'SEN),SEN            SENT HEADING                    
         MVC   MENLIN3+42(L'PAID),PAID          PAID HEADING                    
         SPACE 1                                                                
         XC    VPFKTAB,VPFKTAB                                                  
         MVI   VPFKTAB,14               ONLY VALID SCREEN FLIP IS               
         MVI   VPFKTAB+1,X'FF'          PFKEY14                                 
         SPACE 1                                                                
         LA    RE,7                                                             
         LA    R2,MENPFK1H                                                      
DMINFO10 NI    1(R2),X'F3'              SET BOTTOM LINE OF PF KEYS              
         OI    1(R2),X'08'              TO HIGH INTENSITY                       
         OI    6(R2),X'80'                                                      
         ZIC   RF,0(R2)                                                         
         AR    R2,RF                                                            
         BCT   RE,DMINFO10                                                      
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE REOCRD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(TALENT ADVICE DETAILS ELEMENT)          
         BE    *+6                                                              
         DC    H'00'                                                            
         USING TADVD,R4                                                         
         CLI   TADVTYPE,TADVTYPS   IF TYPE SESSION ... DISPLAY FINAL            
         BNE   DMINFO20            CAST/COMPLETION INSTEAD OF USES              
         MVC   MENLIN1(L'SESN),SESN                                             
         B     DMINFO40                                                         
         SPACE 1                                                                
DMINFO20 MVC   MENLIN1(L'REGU),REGU     IF NOT TYPE SESSION ... DISPLAY         
         MVC   MENLIN1+42(L'MUSU),MUSU  REGULAR AND MUSIC USE HEADINGS          
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BE    *+6                                                              
         DC    H'00'                                                            
         USING TAVUD,R4                                                         
         OC    TAVUCYCS,TAVUCYCS   IF REGULAR CYCLE START DATE                  
         BZ    DMINFO30            PRESENT - CALL USEVAL WITH TAVUUSE           
         MVC   MENLIN1+14(5),=C'OTHER'                                          
         XC    BLOCK(8),BLOCK                                                   
         MVI   BLOCK,40+8                                                       
         GOTO1 CHAROUT,DMCB,TACMELQ,(X'80',BLOCK),TACMTYPU                      
         MVC   MENLIN1+20(18),BLOCK+8                                           
         CLI   TAVUUSE,0                                                        
         BE    DMINFO30                                                         
         GOTO1 USEVAL,DMCB,(X'80',TAVUUSE),TAVUTYPE                             
         MVC   MENLIN1+14(L'TGUSNAME+4),SPACES                                  
         GOTO1 UNITEST,DMCB,TGUSXUNS,ALL-NON-AFM,0,0,0                          
         BO    DMINFO35                                                         
         MVC   MENLIN1+14(L'TGUSNAME),TGUSNAME                                  
         CLI   TAVUUSE,UMUS                                                     
         BNE   DMINF20C                                                         
         CLI   TAVULEN,27                                                       
         BE    DMINF20C                                                         
         LA    RE,MENLIN1+14                                                    
         SR    RF,RF                                                            
DMINF20E CLI   0(RE),C' '                                                       
         BE    DMINF20D                                                         
         LA    RE,1(RE)                                                         
         B     DMINF20E                                                         
DMINF20D AHI   RF,1                                                             
         CHI   RF,2                                                             
         BE    *+12                                                             
         LA    RE,1(RE)                                                         
         B     DMINF20E                                                         
         MVC   1(2,RE),TAVUWKS                                                  
         CLI   2(RE),C' '                                                       
         BNE   *+8                                                              
         AHI   RE,-1                                                            
         MVC   3(2,RE),=C'WK'                                                   
DMINF20C CLI   TAVUUSE,UWSM                                                     
         BE    *+12                                                             
         CLI   TAVUUSE,UNET                                                     
         BNE   DMINF20B                                                         
         TM    TGUSTYST,UPGRADE                                                 
         BZ    DMINF20B                                                         
         MVC   MENLIN1+31(6),=C'UPGR  '                                         
DMINF20B CLI   TAVUMAJ,0                                                        
         BNE   DMINF20A                                                         
         CLI   TAVUUSE,URRN                                                     
         BNE   DMINF23                                                          
         MVC   MENLIN1+28(4),=C'NONE'                                           
         B     DMINF23                                                          
DMINF20A GOTO1 MAJVAL,DMCB,(X'80',TAVUMAJ)                                      
         OC    MENLIN1,SPACES                                                   
         LA    R3,MENLIN1+14                                                    
DMINF21  CLC   0(2,R3),=C'  '                                                   
         BE    DMINF22                                                          
         LA    R3,1(R3)                                                         
         B     DMINF21                                                          
DMINF22  MVC   1(L'TGMACHAR,R3),TGMACHAR                                        
DMINF23  CLI   TAVUUSE,UITN                                                     
         BE    *+14                                                             
         OC    TAVUUNT,TAVUUNT                                                  
         BZ    DMINF29M                                                         
         OC    MENLIN1,SPACES                                                   
         LA    R3,MENLIN1+14                                                    
DMINF24  CLC   1(2,R3),=C'  '                                                   
         BE    DMINF25                                                          
         LA    R3,1(R3)                                                         
         B     DMINF24                                                          
DMINF25  CLI   TAVUUSE,UITN                                                     
         BE    DMINF29                                                          
         EDIT  TAVUUNT,(4,2(R3)),ALIGN=LEFT                                     
         B     DMINFO30                                                         
DMINF26  LH    RF,TAVUUSES                                                      
         SHI   RF,1                                                             
         LH    RE,TAVUUNT                                                       
         SR    RE,RF                                                            
         EDIT  (RE),(4,2(R3)),ALIGN=LEFT                                        
         LA    R3,2(R3)                                                         
DMINF27  CLI   0(R3),C' '                                                       
         BE    DMINF28                                                          
         LA    R3,1(R3)                                                         
         B     DMINF27                                                          
DMINF28  MVI   0(R3),C'-'                                                       
         EDIT  TAVUUNT,(4,1(R3)),ALIGN=LEFT                                     
         B     DMINFO30                                                         
DMINF29  OC    TAVUUSES,TAVUUSES                                                
         BNZ   *+14                                                             
         MVC   2(4,R3),=C'AUTO'                                                 
         B     DMINFO30                                                         
         LA    R3,2(R3)                                                         
         LH    RE,TAVUUSES                                                      
         LH    RF,TAVUUNT                                                       
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         EDIT  (RF),(4,(R3)),ALIGN=LEFT                                         
         CLI   0(R3),C' '                                                       
         BE    *+12                                                             
         LA    R3,1(R3)                                                         
         B     *-12                                                             
         MVI   0(R3),C'-'                                                       
         EDIT  TAVUUNT,(3,1(R3)),ZERO=NOBLANK,ALIGN=LEFT                        
         B     DMINFO30                                                         
DMINF29M GOTOR CCBLUNIT,DMCB,TAVUUSE                                            
         OC    UNITCALC,UNITCALC                                                
         BZ    DMINF29P                                                         
         CLC   UNITCALC,=F'1000000'                                             
         BNL   DMINF29P                                                         
         OC    MENLIN1,SPACES                                                   
         LA    R3,MENLIN1+14                                                    
DMINF29N CLC   1(2,R3),=C'  '                                                   
         BE    DMINF29O                                                         
         LA    R3,1(R3)                                                         
         B     DMINF29N                                                         
DMINF29O EDIT  UNITCALC,(6,2(R3)),ZERO=NOBLANK,ALIGN=LEFT                       
DMINF29P MVC   AIO,AIO2                                                         
         CLI   RECNUM,PV                                                        
         BNE   DMINF29Q                                                         
         GOTO1 RECVAL,DMCB,TLPVCDQ,(X'30',0),('TLPVSCDQ',0)                     
         B     DMINF29R                                                         
DMINF29Q GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
DMINF29R MVC   AIO,AIO1                                                         
DMINFO30 BRAS  RE,DISFEED                                                       
         BRAS  RE,DISCOMP                                                       
         CLI   TAVUUSE2,0                                                       
         BNE   DMINFO34                                                         
         CLI   TAVULEN,27                                                       
         BL    DMINFO40                                                         
         OC    TAVUMCYS,TAVUMCYS   IF MUSIC CYCLE START DATE                    
         BZ    DMINFO40            PRESENT - CALL USEVAL WITH TAVUUSE2          
         MVC   MENLIN1+53(5),=C'OTHER'                                          
         XC    BLOCK(8),BLOCK                                                   
         MVI   BLOCK,40+8                                                       
         GOTO1 CHAROUT,DMCB,TACMELQ,(X'80',BLOCK),TACMTYPM                      
         MVC   MENLIN1+59(19),BLOCK+8                                           
         CLI   TAVUUSE2,0                                                       
         BE    DMINFO40                                                         
DMINFO34 GOTO1 USEVAL,DMCB,(X'80',TAVUUSE2),TAVUTYP2                            
DMINFO35 MVC   MENLIN1+53(L'TGUSNAME),TGUSNAME                                  
         CLI   TAVUUSE2,UMUS                                                    
         BNE   DMINFO40                                                         
         CLI   TAVUTYP2,UMUSDSH                                                 
         BNL   DMINFO40                                                         
         CLI   TAVULEN,27                                                       
         BNH   DMINFO40                                                         
         LA    RE,MENLIN1+53                                                    
         SR    RF,RF                                                            
DMINF35A CLI   0(RE),C' '                                                       
         BE    DMINF35B                                                         
         LA    RE,1(RE)                                                         
         B     DMINF35A                                                         
DMINF35B AHI   RF,1                                                             
         CHI   RF,2                                                             
         BE    *+12                                                             
         LA    RE,1(RE)                                                         
         B     DMINF35A                                                         
         MVC   1(2,RE),TAVUMWKS                                                 
         CLI   2(RE),C' '                                                       
         BNE   *+8                                                              
         AHI   RE,-1                                                            
         MVC   3(2,RE),=C'WK'                                                   
         SPACE 1                                                                
DMINFO40 XC    BLOCK(34),BLOCK      DISPLAY LAST CHANGED                        
         GOTO1 ACTVOUT,DMCB,BLOCK                                               
         MVC   MENLIN4+14(26),BLOCK+8                                           
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         USING TADVD,R4                                                         
         GOTOR INFOUT,DMCB,TADVVINF,MENLIN2+14  DISP VERIFIED                   
         GOTOR INFOUT,DMCB,TADVSINF,MENLIN2+49  DISP SENT                       
         GOTOR INFOUT,DMCB,TADVRINF,MENLIN3+14  DISP REC'D                      
         XC    BLOCK(L'TADVVINF),BLOCK                                          
         MVC   BLOCK+TADVVDTE-TADVVINF(L'TADVPINF),TADVPINF                     
         GOTOR INFOUT,DMCB,BLOCK,MENLIN3+49     DISP PAID                       
         DROP  R4                                                               
         SPACE 1                                                                
         USING TAAID,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAAIELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   DMINFOX                                                          
         MVC   MENLIN4+42(L'ASSG),ASSG          ASSIGN HEADING                  
         LA    RE,MENLIN4+42+L'ASSG+1                                           
         OC    TAAIINUM,TAAIINUM                                                
         BZ    DMINFO60                                                         
         MVC   0(L'TAAIINUM,RE),TAAIINUM                                        
         CLI   TAAILEN,TAAIILNQ                                                 
         BE    DMINFO50                                                         
         OC    TAAIINUX,TAAIINUX                                                
         BZ    DMINFO50                                                         
         MVI   L'TAAIINUM(RE),C'-'                                              
         MVC   L'TAAIINUM+1(L'TAAIINUX,RE),TAAIINUX                             
         AHI   RE,L'TAAIINUM+1                                                  
DMINFO50 OC    TAAIINU2,TAAIINU2                                                
         BZ    DMINFOX                                                          
         MVI   L'TAAIINUM(RE),C','                                              
         AHI   RE,L'TAAIINUM+1                                                  
DMINFO60 MVC   0(L'TAAIINU2,RE),TAAIINU2                                        
         DROP  R4                                                               
DMINFOX  XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE DISPLAYS FEED INFORMATION                                
         SPACE                                                                  
DISFEED  NTR1  BASE=*,LABEL=*                                                   
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TANXELQ      IF NETWORK TRANSFER ELEMENT                  
         BRAS  RE,GETEL            EXISTS, DISPLAY FEED INFORMATION             
         BNE   DFEEDX                                                           
         SPACE 1                                                                
         MVC   MENFEED(L'FEED),FEED                                             
         MVI   MENFEEDH+5,13                                                    
         SPACE 1                                                                
         USING TANPD,R4                                                         
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TANPELQ                                                   
         BRAS  RE,GETEL            GET NETWORK/CLASS A PROGRAM DETAILS          
         B     DF20                ELEMENTS                                     
DF10     BRAS  RE,NEXTEL                                                        
DF20     BNE   DFEEDX                                                           
         SPACE 1                                                                
         CLI   TANPLEN,TANPLNQ3    IF NEW ELEMENT LENGTH                        
         BNE   DF10                                                             
         OC    TANPFEED,SPACES     AND FEED CODE IS PRESENT                     
         CLC   TANPFEED,SPACES                                                  
         BE    DF10                                                             
         SPACE 1                                                                
         LHI   R3,1                INITIALIZE COUNTER                           
         SPACE 1                                                                
         LA    RE,MENFEED+13       RE=A(FEED CODE SCREEN LINE)                  
         ZIC   RF,MENFEEDH+5       RF=CURRENT LENGTH OF FEED CODE INFO          
         AHI   RF,-13                                                           
         AR    RF,RE               RF=A(NEXT OPEN FEED ENTRY)                   
         SPACE 1                                                                
         OC    0(L'TANPFEED,RE),SPACES                                          
         CLC   0(L'TANPFEED,RE),SPACES                                          
         BE    DF40                                                             
         SPACE 1                                                                
DF30     AHI   R3,1                                                             
         CLC   1(L'TANPFEED,RE),TANPFEED IF FEED CODE IS NOT ALREADY            
         BE    DF10                      LISTED IN SCREEN LINE                  
         LA    RE,5(RE)                                                         
         CR    RE,RF                                                            
         BL    DF30                                                             
         SPACE 1                                                                
         MVI   0(RE),C','                 MOVE COMMA                            
DF40     MVC   1(L'TANPFEED,RE),TANPFEED  AND FEED CODE                         
         MHI   R3,5                                                             
         AHI   R3,13                                                            
         STC   R3,MENFEEDH+5            AND NEW LENGTH TO SCREEN                
         B     DF10                                                             
         DROP  R4                                                               
         SPACE 1                                                                
DFEEDX   XIT1                                                                   
         SPACE 2                                                                
FEED     DC    C'FEEDS:'                                                        
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE DISPLAYS WHETHER ADVICE IS COMPLETED OR NOT              
         SPACE                                                                  
DISCOMP  NTR1  BASE=*,LABEL=*                                                   
         USING TADVD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   DCOMPX                                                           
         TM    TADVSTAT,TADVSRCV                                                
         BZ    DCOMPX                                                           
         DROP  R4                                                               
         SPACE 1                                                                
         MVC   MENCOMP(L'PREDATE),PREDATE                                       
         OI    MENCOMPH+1,X'08'                                                 
         OI    MENCOMPH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,AIO                                                           
         MVI   ELCODE,TAAIELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   DCOMPX                                                           
         SPACE 1                                                                
         MVC   MENCOMP(L'PREDATE),SPACES                                        
         MVC   MENCOMP(L'NOTCOMPL),NOTCOMPL                                     
         SPACE 1                                                                
         USING TAACD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAACELQ                                                   
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
DCOMP10  BRAS  RE,NEXTEL                                                        
         BNE   DCOMPX                                                           
         CLI   TAACSCR,X'7A'                                                    
         BNE   DCOMP10                                                          
         SPACE 1                                                                
         MVC   MENCOMP(L'NOTCOMPL),SPACES                                       
         MVC   MENCOMP(L'COMPLETE),COMPLETE                                     
         GOTO1 DATCON,DMCB,(1,TAACCDTE),(8,MENCOMP+L'COMPLETE)                  
         MVC   MENCOMP+L'COMPLETE+8(L'BY),BY                                    
         MVC   MENCOMP+L'COMPLETE+L'BY+8(L'TAACSTAF),TAACSTAF                   
         DROP  R4                                                               
DCOMPX   XIT1                                                                   
         SPACE 2                                                                
PREDATE  DC    C'ADVICE PREDATES COMPLETION PROCESS'                            
NOTCOMPL DC    C'ADVICE NOT YET COMPLETE'                                       
COMPLETE DC    C'COMPLETED ON '                                                 
BY       DC    C' BY '                                                          
         EJECT                                                                  
*              ROUTINE DISPLAYS ADVICE STATUS INFORMATION                       
         SPACE                                                                  
* ON ENTRY ... 0(R1) CONTAINS ADDRESS OF INPUT (4 BYTES)                        
*              4(R1) CONTAINS ADDRESS OF OUTPUT (4 BYTES)                       
* AT 0(R1) ... (1ST 3 BYTES = PACKED DATE) (2ND 3 BYTES = TIME)                 
*              (LAST 11 BYTES = STAFF ID)                                       
         SPACE 1                                                                
INFOUT   NTR1  BASE=*,LABEL=*                                                   
         LM    R2,R3,0(R1)         R2=A(DATA)  R3=A(OUTPUT)                     
         OC    0(L'TADVVINF,R2),0(R2)                                           
         BZ    INFX                IF NOTHING TO DISPLAY ... DONE               
         SPACE 1                                                                
         MVC   0(L'TADVVST,R3),TADVVST-TADVVINF(R2)  STAFF ID                   
         GOTO1 DATCON,DMCB,(1,TADVVDTE-TADVVINF(R2)),(8,9(R3))  DATE            
         MVC   WORK(3),TADVVTIM-TADVVINF(R2)                                    
         MVC   WORK+3(3),TADVVDTE-TADVVINF(R2)                                  
         GOTO1 TIMECON,DMCB,WORK,WORK+3,(8,18(R3))  TIME                        
INFX     XIT1                                                                   
         SPACE 2                                                                
SESN     DC    C'FINAL CAST / COMPLETION'                                       
REGU     DC    C'REGULAR USE:'                                                  
MUSU     DC    C'MUSIC USE:'                                                    
VERI     DC    C'VERIFIED:'                                                     
SEN      DC    C'SENT:'                                                         
RECE     DC    C'RECEIVED:'                                                     
PAID     DC    C'PAID:'                                                         
LCHA     DC    C'LAST CHANGED:'                                                 
ASSG     DC    C'ASSIGNED INV'                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY TELEVISION SCREEN'S INFORMATION               
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                                     
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISTV    NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS  IF CYCLE START DATE EXISTS                    
         BZ    DTV200                                                           
         CLI   TAVULEN,27                                                       
         BNE   DTV01                                                            
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,TELCYST)                             
         B     DTV02                                                            
DTV01    GOTOR DISCYC,DMCB,TELCYSTH,TELWKSH,TAVUCYCS,TAVUWKS                    
DTV02    OI    TELCYSTH+6,X'80'                                                 
         SPACE                                                                  
         GOTO1 CHAROUT,DMCB,TACMELQ,TELOSPCH,TACMTYPU                           
         BE    DTV170                                                           
         GOTO1 USEVAL,DMCB,(X'80',TAVUUSE),(X'80',TAVUTYPE)                     
         GOTO1 UNITEST,DMCB,TGUSXUNS,ALL-NON-AFM,0,0,0                          
         BNO   DTV05                                                            
         MVC   TELMUST,TELCYST                                                  
         OI    TELMUSTH+6,X'80'                                                 
         MVC   TELCYST,SPACES                                                   
         MVC   TELMWKS,TELWKS                                                   
         OI    TELMWKSH+6,X'80'                                                 
         MVC   TELWKS,SPACES                                                    
         LA    R3,TAVUUSE                                                       
         LA    R4,TAVUTYPE                                                      
         B     DTV205                                                           
         SPACE                                                                  
DTV05    CLI   TAVUUSE,UHLD       HOLDING FEE                                   
         BNE   DTV10                                                            
         LA    R2,TELHFEEH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV10    CLI   TAVUUSE,UWSP       WILDSPOT                                      
         BNE   DTV20                                                            
         LA    R2,TELWSPTH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,TELWSNYH                                                      
         GOTOR DISNLC              CHECK NY,LA, OR CHI                          
         LA    R2,TELWSUNH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,UWSPU13W                                                
         BNE   DTV200                                                           
         LA    R2,TELWSUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV20    CLI   TAVUUSE,UCBL       CABLE                                         
         BNE   DTV30                                                            
         LA    R2,TELCABLH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,TELCAUNH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,UCBLUPG                                                 
         BNE   DTV200                                                           
         LA    R2,TELCAUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV30    CLI   TAVUUSE,ULCB       LOCAL CABLE                                   
         BNE   DTV40                                                            
         LA    R2,TELLCABH                                                      
         BRAS  RE,CHECKOFF                                                      
         BAS   RE,SUBSCB          SUBSCRIBERS AND UPGRADES                      
         B     DTV200                                                           
         SPACE                                                                  
DTV40    CLI   TAVUUSE,ULOC       LOCAL PROGRAM                                 
         BNE   DTV50                                                            
         LA    R2,TELLPROH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('ULOCB',TELLPRBH),('ULOCBNY',TELLPBNH),                +        
               ('ULOCC',TELLPRCH),(X'FF',0)                                     
         B     DTV200                                                           
         SPACE                                                                  
DTV50    CLI   TAVUUSE,UDLR       DEALER                                        
         BNE   DTV60                                                            
         LA    R2,TELDEALH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UDLRA',TELDEAAH),('UDLRANY',TELDEANH),                +        
               ('UDLRB',TELLOCBH),('UDLRBNY',TELDEBNH),(X'FF',0)                
         LA    R2,TELDE6MH                                                      
         CLI   TAVUTYPE,UDLRA8-UDLRA                                            
         BNH   *+8                                                              
         LA    R2,TELDE8WH                                                      
         MVI   8(R2),C'X'          CHECK OFF MAJOR                              
         MVI   5(R2),1                                                          
         OI    6(R2),X'80'                                                      
         CLI   TAVUTYPE,UDLRA8-UDLRA                                            
         BNH   DTV200                                                           
         LA    R2,TELDEALH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UDLRA8',TELDEAAH),('UDLRANY8',TELDEANH),              +        
               ('UDLRB8',TELLOCBH),('UDLRBNY8',TELDEBNH),(X'FF',0)              
         B     DTV200                                                           
         SPACE                                                                  
DTV60    CLI   TAVUUSE,UFGR       FOREIGN                                       
         BNE   DTV70                                                            
         CLI   TAVUTYPE,UFGRMAJ                                                 
         BE    DTV65                                                            
         CLI   TAVUTYPE,UFGREXT                                                 
         BE    DTV65                                                            
         LA    R2,TELFORUH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UFGRUK',TELFOUKH),                                    +        
               ('UFGREUR',TELFOERH),('UFGRJAP',TELFOJPH),              +        
               ('UFGRAP',TELFOAPH),('UFGRJAP',TELFOJPH),               +        
               ('UFGRAP',TELFOAPH),('UFGRWOR',TELFORSH),               +        
               ('UFGRWIDE',TELFOWWH),(X'FF',0)                                  
         B     DTV200                                                           
DTV65    LA    R2,TELFORUH                                                      
         BRAS  RE,CHECKOFF                                                      
         CLI   TAVUTYPE,UFGREXT                                                 
         BNE   *+12                                                             
         LA    R2,TELFEXTH                                                      
         BRAS  RE,CHECKOFF                                                      
         CLI   TAVUMAJ,WWIDE                                                    
         BNE   DTV66                                                            
         LA    R2,TELFOWWH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
DTV66    TM    TAVUMAJ,UK                                                       
         BZ    *+12                                                             
         LA    R2,TELFOUKH                                                      
         BRAS  RE,CHECKOFF                                                      
         TM    TAVUMAJ,EUR                                                      
         BZ    *+12                                                             
         LA    R2,TELFOERH                                                      
         BRAS  RE,CHECKOFF                                                      
         TM    TAVUMAJ,JAP                                                      
         BZ    *+12                                                             
         LA    R2,TELFOJPH                                                      
         BRAS  RE,CHECKOFF                                                      
         TM    TAVUMAJ,AP                                                       
         BZ    *+12                                                             
         LA    R2,TELFOAPH                                                      
         BRAS  RE,CHECKOFF                                                      
         TM    TAVUMAJ,REST                                                     
         BZ    DTV200                                                           
         LA    R2,TELFORSH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV70    CLI   TAVUUSE,UINR        INDUSTRIAL                                   
         BNE   DTV80                                                            
         LA    R2,TELINDH                                                       
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UINR30D',TELIR30H),('UINRUNL',TELIRUNH),(X'FF',0)              
         B     DTV200                                                           
         SPACE                                                                  
DTV80    CLI   TAVUUSE,UPBS        PUBLIC SERVICE                               
         BNE   DTV110                                                           
         LA    R2,TELPBSRH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV110   CLI   TAVUUSE,UPRR        PROMO                                        
         BNE   DTV120                                                           
         LA    R2,TELPROMH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV120   CLI   TAVUUSE,UREN        REINSTATEMENT                                
         BNE   DTV130                                                           
         LA    R2,TELREINH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV130   CLI   TAVUUSE,UDWN        DOWNGRADE                                    
         BNE   DTV140                                                           
         LA    R2,TELDWGRH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV140   CLI   TAVUUSE,UCNL        CANCEL FEE                                   
         BNE   DTV150                                                           
         LA    R2,TELCNFEH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV150   CLI   TAVUUSE,UPPF        POSTPONEMENT FEE                             
         BNE   DTV160                                                           
         LA    R2,TELPPFEH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV160   CLI   TAVUUSE,UPEN        PENALTY                                      
         BNE   DTV170                                                           
         LA    R2,TELPENH                                                       
         BRAS  RE,CHECKOFF                                                      
         B     DTV200                                                           
         SPACE                                                                  
DTV170   GOTO1 CHAROUT,DMCB,TACMELQ,TELOSPCH,TACMTYPU                           
         BNE   DTV200                                                           
         LA    R2,TELOTHRH         OTHER/SPECIFY                                
         BRAS  RE,CHECKOFF                                                      
         SPACE 2                                                                
DTV200   L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DTV201                                                           
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DTV300                                                           
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
         B     DTV202                                                           
DTV201   OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DTV201A                                                          
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DTV202                                                           
DTV201A  LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DTV202   L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DTV202A                                                          
         GOTO1 DATCON,DMCB,(1,(R3)),(8,TELMUST)                                 
         B     DTV202B                                                          
DTV202A  CLI   1(RE),24                                                         
         BNE   *+16                                                             
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUCYCS                                                      
         LA    R4,TAVUWKS                                                       
         GOTOR DISCYC,DMCB,TELMUSTH,TELMWKSH,(R3),(R4)                          
DTV202B  OI    TELMUSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUUSE2                                                      
         LA    R4,TAVUTYP2                                                      
         SPACE                                                                  
DTV205   CLI   0(R3),UMUS       MUSIC                                           
         BNE   DTV210                                                           
         LA    R2,TELMUSEH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,                                +        
               ('UMUS13W',TELMREH),                                    +        
               ('UMUSNEW',TELMCONH),('UMUSDUB',TELMDUBH),              +        
               ('UMUSDSH',TELMLTSH),('UMUS2DS',TELMU2LH),(X'FF',0)              
         CLI   TELMLTS,C'X'                                                     
         BE    DTV206                                                           
         CLI   TELMU2L,C'X'                                                     
         BNE   DTV300                                                           
DTV206   LA    R2,TELMDUBH         IF LONG TO SHORT CHECK DUB ALSO              
         BRAS  RE,CHECKOFF                                                      
         B     DTV300                                                           
         SPACE                                                                  
DTV210   CLI   0(R3),UFMU       FIRST MUSIC                                     
         BNE   DTV220                                                           
         LA    R2,TEL1MUSH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV300                                                           
         SPACE                                                                  
DTV220   CLI   0(R3),UNBM       NON-BROADCAST MUSIC                             
         BNE   DTV230                                                           
         LA    R2,TELNOBMH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,('UNBM8WK',TELNBM8H),           +        
               ('UNBM1YR',TELNBM1H),('UNBM2YR',TELNBM2H),(X'FF',0)              
         B     DTV300                                                           
         SPACE                                                                  
DTV230   CLI   0(R3),URGM       REGIONAL MUSIC                                  
         BNE   DTV240                                                           
         LA    R2,TELREGMH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV300                                                           
         SPACE                                                                  
DTV240   CLI   0(R3),UFGM       FOREIGN MUSIC                                   
         BNE   DTV245                                                           
         LA    R2,TELFRMUH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,                                +        
               ('UFGMEU12',TELA12MH),                                  +        
               ('UFGMEU12',TELAUKEH),('UFGMNE12',TELA12MH),            +        
               ('UFGMNE12',TELANOEH),('UFGMWO12',TELA12MH),            +        
               ('UFGMWO12',TELAWRLH),('UFGMEU24',TELA24MH),            +        
               ('UFGMEU24',TELAUKEH),('UFGMNE24',TELA24MH),            +        
               ('UFGMNE24',TELANOEH),('UFGMWO24',TELA24MH),            +        
               ('UFGMWO24',TELAWRLH),(X'FF',0)                                  
         B     DTV300                                                           
         SPACE                                                                  
DTV245   CLI   0(R3),UMBO          ALL MEDIA BUYOUT                             
         BNE   DTV250                                                           
         LA    R2,TELMBOH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMBOI1Y',TELMBOIH),           +        
               ('UMBOR1Y',TELMBORH),(X'FF',0)                                   
         B     DTV300                                                           
         SPACE                                                                  
DTV250   CLI   0(R3),UPEM       MUSIC PENALTY                                   
         BNE   DTV260                                                           
         LA    R2,TELMPENH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DTV300                                                           
         SPACE                                                                  
DTV260   LA    R2,TELOMUSH          OTHER/SPECIFY                               
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,TELOMSPH,TACMTYPM                           
         SPACE 2                                                                
DTV300   L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DTV310                                                           
         MVC   TELAPPS,TAVUABSS                                                 
         OI    TELAPPSH+6,X'80'                                                 
         SPACE                                                                  
DTV310   CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DTV320                                                           
         MVC   TELAPPH,TAVUAHLD                                                 
         OI    TELAPPHH+6,X'80'                                                 
         SPACE                                                                  
DTV320   GOTO1 CHAROUT,DMCB,TACMELQ,TELAPPCH,TACMTYPA  APPLY COMMENT            
DTVX     XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE DISPLAYS MINORS FOR TELEVISION SCREEN'S                  
*               LOCAL CABLE FIELD                                               
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                           *         
         SPACE                                                                  
         USING TAVUD,R4                                                         
SUBSCB   NTR1                                                                   
         USING SUBTABD,RE                                                       
         LA    RE,SUBTAB                                                        
SUBSCB10 CLI   0(RE),X'FF'         POINT RF AT CURRENT ENTRY'S EQU'S            
         BNE   *+6                 COMPARE TYPE WITH ALL 10 EQU'S.              
         DC    H'00'               IF NO MATCH BUMP TO NEXT ENTRY               
         LA    R1,10                                                            
         LA    RF,SUBREG                                                        
SUBSCB20 CLC   0(1,RF),TAVUTYPE                                                 
         BE    SUBSCB30                                                         
         LA    RF,1(RF)                                                         
         BCT   R1,SUBSCB20                                                      
         LA    RE,SUBLNQ(RE)                                                    
         B     SUBSCB10                                                         
         SPACE                                                                  
SUBSCB30 MVC   TELLCSU,SUBVAL      WHEN EQU MATCHED UP MOVE VALUE               
         OI    TELLCSUH+6,X'80'    INTO SUBSCRIBER FIELD AND TRANSMIT           
         CLC   0(1,RF),SUBREG                                                   
         BE    SUBSCBX             IF AN UPGRADE EQU ... PUT Y INTO             
         MVI   TELLCUP,C'Y'        UPGRADE FIELD AND TRANSMIT                   
         OI    TELLCUPH+6,X'80'                                                 
SUBSCBX  B     DTVX                                                             
         DROP  RE,R4                                                            
         SPACE 2                                                                
*              SUBTAB - SUBSCRIBERS MINORS TABLE                                
         SPACE                                                                  
*        USE SUBTABD DSECT:                                           *         
*        1ST 5 BYTES      = SUBVAL (SUBSCRIBER VALUE TO INSERT IN     *         
*                                   SUBSCRIBER SCREEN FIELD)          *         
*        5TH BYTE         = SUBREG  (REGULAR EQUATE FOR THIS SUB-     *         
*                                    SCRIBER VALUE)                   *         
*        6TH BYTE         = SUB50   (UPGRADE FROM 50K EQUATE)         *         
*        7TH BYTE         = SUB100  (UPGRADE FROM 100K EQUATE)        *         
*        8TH BYTE         = SUB150  (UPGRADE FROM 150K EQUATE)        *         
*        9TH BYTE         = SUB200  (UPGRADE FROM 200K EQUATE)        *         
*       10TH BYTE         = SUB250  (UPGRADE FROM 250K EQUATE)        *         
*       11TH BYTE         = SUB500  (UPGRADE FROM 500K EQUATE)        *         
*       12TH BYTE         = SUB750  (UPGRADE FROM 750K EQUATE)        *         
*       13TH BYTE         = SUB1MIL (UPGRADE FROM 1MIL EQUATE)        *         
*       14TH BYTE         = SUB2MIL (UPGRADE FROM 1MIL+ EQUATE)       *         
         SPACE                                                                  
SUBTAB   DC    CL5'50K',AL1(ULCB50,ULCBU50),8X'00'                              
         DC    CL5'100K',AL1(ULCB100),AL1(ULCBU12),8X'00'                       
         DC    CL5'150K',AL1(ULCB150),AL1(ULCBU13),AL1(ULCBU23),7X'00'          
         DC    CL5'200K',AL1(ULCB200),AL1(ULCBU14),AL1(ULCBU24)                 
         DC    AL1(ULCBU34),6X'00'                                              
         DC    CL5'250K',AL1(ULCB250),AL1(ULCBU15),AL1(ULCBU25)                 
         DC    AL1(ULCBU35),AL1(ULCBU45),5X'00'                                 
         DC    CL5'500K',AL1(ULCB500),AL1(ULCBU16),AL1(ULCBU26)                 
         DC    AL1(ULCBU36),AL1(ULCBU46),AL1(ULCBU56),4X'00'                    
         DC    CL5'750K',AL1(ULCB750),AL1(ULCBU17),AL1(ULCBU27)                 
         DC    AL1(ULCBU37),AL1(ULCBU47),AL1(ULCBU57),AL1(ULCBU67)              
         DC    3X'00'                                                           
         DC    CL5'1MIL',AL1(ULCB1M),AL1(ULCBU18),AL1(ULCBU28)                  
         DC    AL1(ULCBU38),AL1(ULCBU48),AL1(ULCBU58),AL1(ULCBU68)              
         DC    AL1(ULCBU78),2X'00'                                              
         DC    CL5'1MIL+',AL1(ULCBMAX),AL1(ULCBU19),AL1(ULCBU29)                
         DC    AL1(ULCBU39),AL1(ULCBU49),AL1(ULCBU59),AL1(ULCBU69)              
         DC    AL1(ULCBU79),AL1(ULCBU89),AL1(ULCBUMAX)                          
         DC    X'FF'                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY RADIO SCREEN'S INFORMATION                    
         SPACE                                                                  
* ON ENTRY ... R4 = A(ADVICE DETAILS ELEMENT)                                   
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISRAD   NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS  IF CYCLE START DATE EXISTS                    
         BZ    DRAD200                                                          
         CLI   TAVULEN,27                                                       
         BNE   DRAD01                                                           
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,RADCCST)                             
         BE    DRAD02                                                           
DRAD01   GOTOR DISCYC,DMCB,RADCCSTH,RADWKSH,TAVUCYCS,TAVUWKS                    
DRAD02   OI    RADCCSTH+6,X'80'                                                 
         SPACE                                                                  
         GOTO1 CHAROUT,DMCB,TACMELQ,RADSPECH,TACMTYPU                           
         BE    DRAD90                                                           
         GOTO1 USEVAL,DMCB,(X'80',TAVUUSE),(X'80',TAVUTYPE)                     
         GOTO1 UNITEST,DMCB,TGUSXUNS,ALL-NON-AFM,0,0,0                          
         BNO   DRAD05                                                           
         MVC   RADMUST,RADCCST                                                  
         OI    RADMUSTH+6,X'80'                                                 
         MVC   RADCCST,SPACES                                                   
         MVC   RADMWKS,RADWKS                                                   
         OI    RADMWKSH+6,X'80'                                                 
         MVC   RADWKS,SPACES                                                    
         LA    R3,TAVUUSE                                                       
         LA    R4,TAVUTYPE                                                      
         B     DRAD205                                                          
         SPACE                                                                  
DRAD05   CLI   TAVUUSE,UWSP        WILDSPOT                                     
         BNE   DRAD10                                                           
         LA    R2,RADWSPTH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,RADWSUPH,TAVUUSE,                 +        
               ('UWSPU8W',RADWS8WH),('UWSP8W',RADWS8WH),               +        
               ('UWSPU13W',RADWS13H),('UWSP13W',RADWS13H),(X'FF',0)             
         LA    R2,RADWSNYH                                                      
         GOTOR DISNLC                                                           
         LA    R2,RADWSUNH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUWKS,C'8'                                                     
         BE    *+14                                                             
         CLC   TAVUWKS,=C'08'     IF LENGTH IS 8 WEEKS                          
         BNE   DRAD06                                                           
         MVI   RADWS13,C' '       MAY HAVE TO ADJUST BECAUSE WRONG TYPE         
         MVI   RADWS8W,C'X'                                                     
         OI    RADWS8WH+6,X'80'                                                 
DRAD06   CLI   RADWSUP,C'X'                                                     
         BNE   DRAD200                                                          
         LA    R2,RADWSUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    4(R2),X'20'                                                      
         B     DRAD200                                                          
         SPACE                                                                  
DRAD10   CLI   TAVUUSE,URNT       NETWORK                                       
         BNE   DRAD20                                                           
         LA    R2,RADNETWH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('URNT1W',RAD1WKH),                                     +        
               ('URNT4W',RAD4WKH),('URNT8W',RAD8WKH),                  +        
               ('URNT13W',RAD13WKH),('URNT26U',RAD26USH),              +        
               ('URNT39U',RAD39USH),('URNTAB',RADACBDH),(X'FF',0)               
         B     DRAD200                                                          
         SPACE                                                                  
DRAD20   CLI   TAVUUSE,URRN       REGIONAL NETWORK                              
         BNE   DRAD30                                                           
         LA    R2,RADREGNH                                                      
         BRAS  RE,CHECKOFF                                                      
         CLI   TAVUMAJ,0                                                        
         BNE   DRAD25                                                           
         LA    R2,RADNONEH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD200                                                          
DRAD25   LA    R2,RADRNNYH        NY, LA, CHI                                   
         GOTOR DISNLC                                                           
         B     DRAD200                                                          
         SPACE                                                                  
DRAD30   CLI   TAVUUSE,URLO       LOCAL REUSE                                   
         BNE   DRAD40                                                           
         LA    R2,RADLOCAH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD200                                                          
         SPACE                                                                  
DRAD40   CLI   TAVUUSE,UDLR       DEALER                                        
         BNE   DRAD50                                                           
         LA    R2,RADDEALH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD200                                                          
         SPACE                                                                  
DRAD50   CLI   TAVUUSE,UINR       INDUSTRIAL                                    
         BNE   DRAD60                                                           
         LA    R2,RADINDRH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UINR30D',RADIR30H),('UINRUNL',RADIRUNH),(X'FF',0)              
         B     DRAD200                                                          
         SPACE                                                                  
DRAD60   CLI   TAVUUSE,UFGR       FOREIGN                                       
         BNE   DRAD80                                                           
         LA    R2,RADFREUH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD200                                                          
         SPACE                                                                  
DRAD80   CLI   TAVUUSE,UPEN       PENALTY                                       
         BNE   DRAD90                                                           
         LA    R2,RADPENAH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD200                                                          
         SPACE                                                                  
DRAD90   GOTO1 CHAROUT,DMCB,TACMELQ,RADSPECH,TACMTYPU                           
         BNE   DRAD200                                                          
         LA    R2,RADOTHRH        OTHER/SPECIFY                                 
         BRAS  RE,CHECKOFF                                                      
         SPACE 2                                                                
DRAD200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DRAD201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DRAD300                                                          
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
         B     DRAD202                                                          
DRAD201  OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DRAD201A                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DRAD202                                                          
DRAD201A LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DRAD202  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DRAD202A                                                         
         GOTO1 DATCON,DMCB,(1,(R3)),(8,RADMUST)                                 
         B     DRAD202B                                                         
DRAD202A CLI   1(RE),24                                                         
         BNE   *+16                                                             
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUCYCS                                                      
         LA    R4,TAVUWKS                                                       
         GOTOR DISCYC,DMCB,RADMUSTH,RADMWKSH,(R3),(R4)                          
DRAD202B OI    RADMUSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUUSE2                                                      
         LA    R4,TAVUTYP2                                                      
         SPACE                                                                  
DRAD205  CLI   0(R3),UMUS       MUSIC                                           
         BNE   DRAD210                                                          
         LA    R2,RADMUSH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,                                +        
               ('UMUS8W',RADM8WH),('UMUS8W',RADMRUSH),                 +        
               ('UMUSNEW8',RADM8WH),('UMUSNEW8',RADMCONH),             +        
               ('UMUSDUB8',RADM8WH),('UMUSDUB8',RADMDUBH),             +        
               ('UMUSDSH8',RADM8WH),('UMUS13W',RADM13WH),              +        
               ('UMUS13W',RADMRUSH),('UMUSNEW',RADM13WH),              +        
               ('UMUSNEW',RADMCONH),('UMUSDUB',RADM13WH),              +        
               ('UMUSDUB',RADMDUBH),('UMUSDSH',RADM13WH),(X'FF',0)              
         B     DRAD300                                                          
         SPACE                                                                  
DRAD210  CLI   0(R3),UFMU       FIRST MUSIC                                     
         BNE   DRAD220                                                          
         LA    R2,RADFMUSH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,                                +        
               ('UFMU8W',RADFM8WH),('UFMU13W',RADFM13H),(X'FF',0)               
         CLI   TAVUWKS,C'8'                                                     
         BE    *+14                                                             
         CLC   TAVUWKS,=C'08'     IF LENGTH IS 8 WEEKS                          
         BNE   DRAD300                                                          
         MVI   RADFM13,C' '       MAY HAVE TO ADJUST BECAUSE WRONG TYPE         
         MVI   RADFM8W,C'X'                                                     
         OI    RADFM8WH+6,X'80'                                                 
         B     DRAD300                                                          
         SPACE                                                                  
DRAD220  CLI   0(R3),UNBM          NON-BROADCAST MUSIC                          
         BNE   DRAD230                                                          
         LA    R2,RADNBMH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UNBM8WK',RADNBM8H),           +        
               ('UNBM1YR',RADNBM1H),('UNBM2YR',RADNBM2H),(X'FF',0)              
         B     DRAD300                                                          
         SPACE                                                                  
DRAD230  CLI   0(R3),URGM          REGIONAL MUSIC                               
         BNE   DRAD240                                                          
         LA    R2,RADREGMH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD300                                                          
         SPACE                                                                  
DRAD240  CLI   0(R3),UFGM          FOREIGN MUSIC                                
         BNE   DRAD250                                                          
         LA    R2,RADFRMUH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,                                +        
               ('UFGMEU12',RADFM12H),('UFGMEU12',RADFMUKH),            +        
               ('UFGMNE12',RADFM12H),('UFGMNE12',RADFMNOH),            +        
               ('UFGMWO12',RADFM12H),('UFGMWO12',RADFMWOH),            +        
               ('UFGMEU24',RADFM24H),('UFGMEU24',RADFMUKH),            +        
               ('UFGMNE24',RADFM24H),('UFGMNE24',RADFMNOH),            +        
               ('UFGMWO24',RADFM24H),('UFGMWO24',RADFMWOH),(X'FF',0)            
         B     DRAD300                                                          
         SPACE                                                                  
DRAD250  CLI   0(R3),UMBO           ALL MEDIA BUYOUT                            
         BNE   DRAD255                                                          
         LA    R2,RADMBOH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMBOI1Y',RADMBOIH),           +        
               ('UMBOR1Y',RADMBORH),(X'FF',0)                                   
         B     DRAD300                                                          
         SPACE                                                                  
DRAD255  CLI   0(R3),UPEM           MUSIC PENALTY                               
         BNE   DRAD260                                                          
         LA    R2,RADMPENH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DRAD300                                                          
         SPACE                                                                  
DRAD260  LA    R2,RADOTHMH          OTHER MUSIC/SPECIFY                         
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,RADOMSPH,TACMTYPM                           
         SPACE 2                                                                
DRAD300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DRAD310                                                          
         MVC   RADAPPS,TAVUABSS                                                 
         OI    RADAPPSH+6,X'80'                                                 
         SPACE                                                                  
DRAD310  GOTO1 CHAROUT,DMCB,TACMELQ,RADAPPCH,TACMTYPA  APPLY HOLD               
         XIT1                                                                   
         DROP  R4                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY ADDENDUM SCREEN'S INFORMATION                 
         SPACE                                                                  
* ON ENTRY ... R4 = A(ADVICE DETAILS ELEMENT)                                   
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISADD   NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS   IF CYCLE START DATE EXISTS                   
         BZ    DADD200                                                          
         CLI   TAVULEN,27                                                       
         BNE   DADD01                                                           
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,ADDCYST)                             
         B     DADD01A                                                          
DADD01   GOTOR DISCYC,DMCB,ADDCYSTH,ADDWKSH,TAVUCYCS,TAVUWKS                    
DADD01A  OI    ADDCYSTH+6,X'80'                                                 
         SPACE                                                                  
         CLI   TAVUUSE,UADC        COMBINED SESSION/WILDSPOT                    
         BNE   DADD10                                                           
         LA    R2,ADDCSESH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UADC3D',ADDC3DYH),                                    +        
               ('UADC1W',ADDC1WKH),('UADC4W',ADDC4WKH),                +        
               ('UADC13W',ADDC13WH),('UADC31D',ADDC31DH),(X'FF',0)              
         LA    R2,ADDCSUNH                                                      
         GOTOR DISUNIT                                                          
         B     DADD200                                                          
         SPACE                                                                  
DADD10   CLI   TAVUUSE,UADH        HOLDING FEE                                  
         BNE   DADD20                                                           
         LA    R2,ADDHFEEH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DADD200                                                          
         SPACE                                                                  
DADD20   CLI   TAVUUSE,UADW        WILDSPOT                                     
         BNE   DADD30                                                           
         LA    R2,ADDWSPTH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,ADDWSUPH,TAVUUSE,                 +        
               ('UADW3D',ADDW3DYH),('UADW1W',ADDW1WKH),                +        
               ('UADW4W',ADDW4WKH),('UADW13W',ADDW13WH),               +        
               ('UADW31D',ADDW31DH),('UADWU3D',ADDW3DYH),              +        
               ('UADWU1W',ADDW1WKH),('UADWU4W',ADDW4WKH),              +        
               ('UADWU13W',ADDW13WH),('UADWU31D',ADDW31DH),(X'FF',0)            
         LA     R2,ADDWSUNH                                                     
         GOTOR  DISUNIT                                                         
         CLI    ADDWSUP,C'X'                                                    
         BNE    DADD200                                                         
         LA     R2,ADDWSUPH                                                     
         MVI    8(R2),C'Y'                                                      
         OI     4(R2),X'20'                                                     
         B      DADD200                                                         
         SPACE                                                                  
DADD30   CLI   TAVUUSE,UACB        CABLE                                        
         BNE   DADD35                                                           
         LA    R2,ADDCABLH                                                      
         BRAS  RE,CHECKOFF                                                      
         BAS   RE,ASUBSCB                                                       
         B     DADD200                                                          
         SPACE                                                                  
DADD35   CLI   TAVUUSE,UARN        REINSTATEMENT                                
         BNE   DADD40                                                           
         LA    R2,ADDREINH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DADD200                                                          
         SPACE                                                                  
DADD40   CLI   TAVUUSE,UPEN        PENALTY                                      
         BNE   DADD50                                                           
         LA    R2,ADDPENAH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DADD200                                                          
         SPACE                                                                  
DADD50   LA    R2,ADDOTHRH         OTHER/SPECIFY                                
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,ADDOTSPH,TACMTYPU                           
         SPACE 2                                                                
DADD200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DADD201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DADD300                                                          
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
         B     DADD202                                                          
DADD201  OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DADD201A                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DADD202                                                          
DADD201A LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DADD202  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DADD202A                                                         
         GOTO1 DATCON,DMCB,(1,(R3)),(8,ADDMCST)                                 
         B     DADD202B                                                         
DADD202A CLI   1(RE),24                                                         
         BNE   *+16                                                             
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUCYCS                                                      
         LA    R4,TAVUWKS                                                       
         GOTOR DISCYC,DMCB,ADDMCSTH,ADDMWKSH,(R3),(R4)                          
DADD202B OI    ADDMCSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         SPACE 1                                                                
         CLI   TAVUUSE2,UMUS       MUSIC                                        
         BNE   DADD210                                                          
         LA    R2,ADDMREUH                                                      
         GOTOR DISNORM,WORK,TAVUTYP2,NOUPG,                            +        
               ('UMUS13W',ADDMRUSH),('UMUSNEW',ADDMCONH),              +        
               ('UMUSDUB',ADDMDUBH),('UMUSDSH',ADDMLTSH),              +        
               ('UMUS2DS',ADDMU2LH),(X'FF',0)                                   
         CLI   ADDMLTS,C'X'                                                     
         BE    DADD203                                                          
         CLI   ADDMU2L,C'X'                                                     
         BNE   DADD300                                                          
DADD203  LA    R2,ADDMDUBH         IF LONG TO SHORT CHECK DUB ALSO              
         BRAS  RE,CHECKOFF                                                      
         B     DADD300                                                          
         SPACE                                                                  
DADD210  CLI  TAVUUSE2,UFMU        FIRST MUSIC                                  
         BNE  DADD220                                                           
         LA   R2,ADDFIMUH                                                       
         BRAS RE,CHECKOFF                                                       
         B    DADD300                                                           
         SPACE                                                                  
DADD220  CLI  TAVUUSE2,URGM        REGIONAL MUSIC                               
         BNE  DADD230                                                           
         LA   R2,ADDREGMH                                                       
         BRAS RE,CHECKOFF                                                       
         B    DADD300                                                           
         SPACE                                                                  
DADD230  CLI  TAVUUSE2,UPEM        MUSIC PENALTY                                
         BNE  DADD240                                                           
         LA   R2,ADDMPENH                                                       
         BRAS RE,CHECKOFF                                                       
         B    DADD300                                                           
         SPACE                                                                  
DADD240  LA    R2,ADDMUOTH          OTHER MUSIC/SPECIFY                         
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,ADDMUOSH,TACMTYPM                           
         SPACE 2                                                                
DADD300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DADD310                                                          
         MVC   ADDAPPS,TAVUABSS                                                 
         OI    ADDAPPSH+6,X'80'                                                 
         SPACE                                                                  
DADD310  CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DADD320                                                          
         MVC   ADDAPPH,TAVUAHLD                                                 
         OI    ADDAPPHH+6,X'80'                                                 
         SPACE                                                                  
DADD320  GOTO1 CHAROUT,DMCB,TACMELQ,ADDAPPCH,TACMTYPA  APPLY COMMENT            
DADDX    XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE DISPLAYS SUBSCRIBER FIELDS FOR ADDENDUM                  
*              SCREEN'S CABLE FIELD                                             
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                           *         
         SPACE                                                                  
         USING TAVUD,R4                                                         
ASUBSCB  NTR1                                                                   
         USING ASUBTABD,RE                                                      
         LA    RE,ASUBTAB                                                       
ASSCB10  CLI   0(RE),X'FF'         POINT RF AT CURRENT ENTRY'S EQU'S            
         BNE   *+6                 COMPARE TYPE WITH ALL 16 EQU'S.              
         DC    H'00'               IF NO MATCH BUMP TO NEXT ENTRY               
         LA    R1,16                                                            
         LA    RF,ASUBREG                                                       
ASSCB20  CLC   0(1,RF),TAVUTYPE                                                 
         BE    ASSCB30                                                          
         LA    RF,1(RF)                                                         
         BCT   R1,ASSCB20                                                       
         LA    RE,ASUBLNQ(RE)                                                   
         B     ASSCB10                                                          
         SPACE                                                                  
ASSCB30  MVC   ADDCSUB,ASUBVAL     WHEN EQU MATCHED UP MOVE VALUE               
         OI    ADDCSUBH+6,X'80'    INTO SUBSCRIBER FIELD AND TRANSMIT           
         CLC   0(1,RF),ASUBREG                                                  
         BE    ASSCBX              IF AN UPGRADE EQU ... PUT Y INTO             
         MVI   ADDCUPG,C'Y'        UPGRADE FIELD AND TRANSMIT                   
         OI    ADDCUPGH+6,X'80'                                                 
ASSCBX   B     DADDX                                                            
         DROP  RE,R4                                                            
         SPACE 2                                                                
*              ASUBTAB - SUBSCRIBERS MINORS TABLE                               
         SPACE                                                                  
*        USE ASUBTABD DSECT:                                          *         
*        1ST 9 BYTES      = ASUBVAL (SUBSCRIBER VALUE TO INSERT IN    *         
*                                   SUBSCRIBER SCREEN FIELD)          *         
*        10TH BYTE        = ASUBREG  (REGULAR EQUATE FOR THIS SUB-    *         
*                                    SCRIBER VALUE)                   *         
*       11TH-25TH BYTES   =         (UPGRADE EQU'S)                   *         
         SPACE                                                                  
ASUBTAB  DC    CL9'50K',AL1(UACB50),15X'00'                                     
         DC    CL9'100K',AL1(UACB100),AL1(UACBU12),14X'00'                      
         DC    CL9'150K',AL1(UACB150),AL1(UACBU13),AL1(UACBU27)                 
         DC    13X'00'                                                          
         DC    CL9'200K',AL1(UACB200),AL1(UACBU14),AL1(UACBU28)                 
         DC    AL1(UACBU41),12X'00'                                             
         DC    CL9'250K',AL1(UACB250),AL1(UACBU15),AL1(UACBU29)                 
         DC    AL1(UACBU42),AL1(UACBU54),11X'00'                                
         DC    CL9'500K',AL1(UACB500),AL1(UACBU16),AL1(UACBU30)                 
         DC    AL1(UACBU43),AL1(UACBU55),AL1(UACBU66),10X'00'                   
         DC    CL9'750K',AL1(UACB750),AL1(UACBU17),AL1(UACBU31)                 
         DC    AL1(UACBU44),AL1(UACBU56),AL1(UACBU67),AL1(UACBU77)              
         DC    9X'00'                                                           
         DC    CL9'1MIL',AL1(UACB1M),AL1(UACBU18),AL1(UACBU32)                  
         DC    AL1(UACBU45),AL1(UACBU57),AL1(UACBU68),AL1(UACBU78)              
         DC    AL1(UACBU87),8X'00'                                              
         DC    CL9'1MIL+50K',AL1(UACBM50),AL1(UACBU19),AL1(UACBU33)             
         DC    AL1(UACBU46),AL1(UACBU58),AL1(UACBU69),AL1(UACBU79)              
         DC    AL1(UACBU88),AL1(UACBU96),7X'00'                                 
         DC    CL9'1MIL+100K',AL1(UACBM100),AL1(UACBU20),AL1(UACBU34)           
         DC    AL1(UACBU47),AL1(UACBU59),AL1(UACBU70),AL1(UACBU80)              
         DC    AL1(UACBU89),AL1(UACBU97),AL1(UACBU104),6X'00'                   
         DC    CL9'1MIL+150K',AL1(UACBM150),AL1(UACBU21),AL1(UACBU35)           
         DC    AL1(UACBU48),AL1(UACBU60),AL1(UACBU71),AL1(UACBU81)              
         DC    AL1(UACBU90),AL1(UACBU98),AL1(UACBU105),AL1(UACBU111)            
         DC    5X'00'                                                           
         DC    CL9'1MIL+200K',AL1(UACBM200),AL1(UACBU22),AL1(UACBU36)           
         DC    AL1(UACBU49),AL1(UACBU61),AL1(UACBU72),AL1(UACBU82)              
         DC    AL1(UACBU91),AL1(UACBU99),AL1(UACBU106),AL1(UACBU112)            
         DC    AL1(UACBU117),4X'00'                                             
         DC    CL9'1MIL+250K',AL1(UACBM250),AL1(UACBU23),AL1(UACBU37)           
         DC    AL1(UACBU50),AL1(UACBU62),AL1(UACBU73),AL1(UACBU83)              
         DC    AL1(UACBU92),AL1(UACBU100),AL1(UACBU107),AL1(UACBU113)           
         DC    AL1(UACBU118),AL1(UACBU122),3X'00'                               
         DC    CL9'1MIL+500K',AL1(UACBM500),AL1(UACBU24),AL1(UACBU38)           
         DC    AL1(UACBU51),AL1(UACBU63),AL1(UACBU74),AL1(UACBU84)              
         DC    AL1(UACBU93),AL1(UACBU101),AL1(UACBU108),AL1(UACBU114)           
         DC    AL1(UACBU119),AL1(UACBU123),AL1(UACBU126),2X'00'                 
         DC    CL9'1MIL+750K',AL1(UACBM750),AL1(UACBU25),AL1(UACBU39)           
         DC    AL1(UACBU52),AL1(UACBU64),AL1(UACBU75),AL1(UACBU85)              
         DC    AL1(UACBU94),AL1(UACBU102),AL1(UACBU109),AL1(UACBU115)           
         DC    AL1(UACBU120),AL1(UACBU124),AL1(UACBU127),AL1(UACBU129)          
         DC    1X'00'                                                           
         DC    CL9'1MIL+1MIL',AL1(UACBM1M),AL1(UACBU26),AL1(UACBU40)            
         DC    AL1(UACBU53),AL1(UACBU65),AL1(UACBU76),AL1(UACBU86)              
         DC    AL1(UACBU95),AL1(UACBU103),AL1(UACBU110),AL1(UACBU116)           
         DC    AL1(UACBU121),AL1(UACBU125),AL1(UACBU128),AL1(UACBU130)          
         DC    AL1(UACBU131)                                                    
         DC    X'FF'                                                            
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY SPANISH SCREEN'S INFORMATION                  
         SPACE                                                                  
* ON ENTRY ... R4 = A(ADVICE DETAILS ELEMENT)                         *         
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISSPA   NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS   IF CYCLE START DATE EXISTS                   
         BZ    DSPA200                                                          
         CLI   TAVULEN,27                                                       
         BNE   DSPA01                                                           
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,SPACCST)                             
         B     DSPA01A                                                          
DSPA01   GOTOR DISCYC,DMCB,SPACCSTH,SPAWKSH,TAVUCYCS,TAVUWKS                    
DSPA01A  OI    SPACCSTH+6,X'80'                                                 
         SPACE                                                                  
         CLI   TAVUUSE,USHL        HOLDING FEE                                  
         BNE   DSPA10                                                           
         LA    R2,SPAHOLDH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA10   CLI   TAVUUSE,USNT        NETWORK                                      
         BNE   DSPA20                                                           
         LA    R2,SPANETWH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA20   CLI   TAVUUSE,USWS        WILDSPOT                                     
         BNE   DSPA30                                                           
         LA    R2,SPAWILDH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,SPAWILUH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,USWSUPG                                                 
         BNE   DSPA100                                                          
         LA    R2,SPAWUPGH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA30   CLI   TAVUUSE,USNW        NETWORK/WILDSPOT COMBINED                    
         BNE   DSPA40                                                           
         LA    R2,SPANWWSH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,SPACUPGH                                                      
         CLI   TAVUTYPE,USNWUN                                                  
         BE    DSPA35                                                           
         LA    R2,SPACSWSH                                                      
         CLI   TAVUTYPE,USNWUW                                                  
         BE    DSPA35                                                           
         LA    R2,SPACCOMH                                                      
         CLI   TAVUTYPE,USNWUC                                                  
         BNE   *+16                                                             
DSPA35   MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         LA    R2,SPACOMUH                                                      
         GOTOR DISUNIT                                                          
         B     DSPA100                                                          
         SPACE                                                                  
DSPA40   CLI   TAVUUSE,USCB        CABLE                                        
         BNE   DSPA50                                                           
         LA    R2,SPACABLH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,SPACABUH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,USCBUPG                                                 
         BNE   DSPA100                                                          
         LA    R2,SPACAUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA50   CLI   TAVUUSE,USIN        INDUSTRIAL                                   
         BNE   DSPA55                                                           
         LA    R2,SPAINDUH                                                      
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('USIN30D',SPADAYSH),('USINUNL',SPAUNLIH),(X'FF',0)              
         B     DSPA100                                                          
         SPACE                                                                  
DSPA55   CLI   TAVUUSE,USFR        FOREIGN                                      
         BNE   DSPA60                                                           
         LA    R2,SPAFORUH                                                      
         BRAS  RE,CHECKOFF                                                      
         CLI   TAVUTYPE,0                                                       
         BE    DSPA100                                                          
         GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,('USFRA',SPAFORAH),         +        
               ('USFRB',SPAFORBH),('USFRC',SPAFORCH),(X'FF',0)                  
         B     DSPA100                                                          
         SPACE                                                                  
DSPA60   CLI   TAVUUSE,USRE        REINSTATEMENT                                
         BNE   DSPA65                                                           
         LA    R2,SPAREINH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA65   CLI   TAVUUSE,USCN        CANCEL FEE                                   
         BNE   DSPA70                                                           
         LA    R2,SPACFEEH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA70   CLI   TAVUUSE,USPN        PENALTY                                      
         BNE   DSPA90                                                           
         LA    R2,SPAPENAH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA100                                                          
         SPACE                                                                  
DSPA90   LA    R2,SPAOTHRH         OTHER/SPECIFY                                
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,SPASPECH,TACMTYPU                           
         SPACE                                                                  
DSPA100  BAS   RE,DISTANUD         NUMBER OF SESSION FEES                       
         SPACE 2                                                                
DSPA200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DSPA201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DSPA300                                                          
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
DSPA201  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DSPA201A                                                         
         L     R4,ATAVUEL                                                       
         GOTO1 DATCON,DMCB,(1,TAVUMCYS),(8,SPAMUST)                             
         B     DSPA202B                                                         
DSPA201A OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DSPA201B                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DSPA202                                                          
DSPA201B LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DSPA202  GOTOR DISCYC,DMCB,SPAMUSTH,SPAMWKSH,(R3),(R4)                          
DSPA202B OI    SPACCSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         SPACE                                                                  
         CLI   TAVUUSE2,UMUS       MUSIC                                        
         BNE   DSPA210                                                          
         LA    R2,SPAMUSEH                                                      
         GOTOR DISNORM,WORK,TAVUTYP2,NOUPG,                            +        
               ('UMUS13W',SPAMRUSH),('UMUSNEW',SPAMCONH),              +        
               ('UMUSDUB',SPAMDUBH),('UMUSDSH',SPAMLTSH),              +        
               ('UMUS2DS',SPAMU2LH),(X'FF',0)                                   
         CLI   SPAMLTS,C'X'                                                     
         BE    DSPA202C                                                         
         CLI   SPAMU2L,C'X'                                                     
         BNE   DSPA300                                                          
DSPA202C LA    R2,SPAMDUBH         IF LONG TO SHORT CHECK DUB ALSO              
         BRAS  RE,CHECKOFF                                                      
         B     DSPA300                                                          
         SPACE                                                                  
DSPA210  CLI   TAVUUSE2,UFMU       FIRST MUSIC                                  
         BNE   DSPA220                                                          
         LA    R2,SPAFRMUH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA300                                                          
         SPACE                                                                  
DSPA220  CLI   TAVUUSE2,UFGM       FOREIGN MUSIC                                
         BNE   DSPA230                                                          
         LA    R2,SPAFRGNH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA300                                                          
         SPACE                                                                  
DSPA230  CLI   TAVUUSE2,UPEM       MUSIC PENALTY                                
         BNE   DSPA240                                                          
         LA    R2,SPAMPENH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DSPA300                                                          
         SPACE 2                                                                
DSPA240  CLI   TAVUUSE2,UMBO       ALL MEDIA BUYOUT                             
         BNE   DSPA240                                                          
         LA    R2,SPAMBOH                                                       
         GOTOR DISNORM,WORK,TAVUTYP2,NOUPG,('UMBOI1Y',SPAMBOIH),       +        
               ('UMBOR1Y',SPAMBORH),(X'FF',0)                                   
         SPACE                                                                  
DSPA300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DSPA310                                                          
         MVC   SPAAPPS,TAVUABSS                                                 
         OI    SPAAPPSH+6,X'80'                                                 
         SPACE                                                                  
DSPA310  CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DSPA320                                                          
         MVC   SPAAPPH,TAVUAHLD                                                 
         OI    SPAAPPHH+6,X'80'                                                 
         SPACE                                                                  
DSPA320  GOTO1 CHAROUT,DMCB,TACMELQ,SPAAPPCH,TACMTYPA  APPLY COMMENT            
         XIT1                                                                   
         DROP  R4                                                               
         SPACE 2                                                                
*              ROUTINE CALLED BY DSPA TO DISPLAY # OF SESSION FEES              
         SPACE                                                                  
DISTANUD NTR1                                                                   
         MVI   ELCODE,TANUELQ                                                   
         GOTO1 GETL,DMCB,(1,=AL1(TANUTFEE))                                     
         BNE   DTANUX                                                           
         L     R4,TGELEM                                                        
         USING TANUD,R4                                                         
         ZIC   RE,TANULEN                                                       
         SHI   RE,4                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   SPAFOSF(0),TANUMBER                                              
         OI    SPAFOSFH+6,X'80'                                                 
         DROP  R4                                                               
DTANUX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY CANADIAN SCREEN'S INFORMATION                 
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                                     
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISCAN   NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS   IF CYCLE START DATE EXISTS                   
         BZ    DCAN200                                                          
         CLI   TAVULEN,27                                                       
         BNE   DCAN01                                                           
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,CANCCST)                             
         B     DCAN02                                                           
DCAN01   GOTOR DISCYC,DMCB,CANCCSTH,CANWKSH,TAVUCYCS,TAVUWKS                    
DCAN02   OI    CANCCSTH+6,X'80'                                                 
         SPACE                                                                  
         CLI   TAVUUSE,UNET        ACTRA/UDA TV NETWORK                         
         BNE   DCAN10                                                           
         LA    R2,CANAUTNH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,CANACUNH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,UNETUPG                                                 
         BNE   DCAN200                                                          
         LA    R2,CANACUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN10   CLI   TAVUUSE,UWSC        WILDSPOT                                     
         BNE   DCAN20                                                           
         LA    R2,CANWSPTH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,CANWSUNH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,UWSCUPG                                                 
         BNE   DCAN200                                                          
         LA    R2,CANWSUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN20   CLI   TAVUUSE,UWSM        WILDSPOT COMBINED                            
         BNE   DCAN30                                                           
         LA    R2,CANWCOMH                                                      
         BRAS  RE,CHECKOFF                                                      
         LA    R2,CANWCUNH                                                      
         GOTOR DISUNIT                                                          
         CLI   TAVUTYPE,UWSMUPG                                                 
         BNE   DCAN200                                                          
         LA    R2,CANWCUPH                                                      
         MVI   8(R2),C'Y'                                                       
         OI    6(R2),X'80'                                                      
         OI    4(R2),X'20'                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN30   CLI   TAVUUSE,UPNP        PRIME/NON-PRIME TIME                         
         BNE   DCAN40                                                           
         LA    R2,CANPRIMH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN40   CLI   TAVUUSE,URAD        ACTRA RADIO REUSE                            
         BNE   DCAN50                                                           
         LA    R2,CANACRRH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN50   CLI   TAVUUSE,UDOR        ACTRA DORMANCY FEE                           
         BNE   DCAN60                                                           
         LA    R2,CANACDFH                                                      
         BRAS  RE,CHECKOFF                                                      
         MVC   CANWKS(2),=C'26'                                                 
         OI    CANWKSH+6,X'80'                                                  
         MVI   CANWKSH+5,2                                                      
         NI    CANCCSTH+4,X'FF'-X'20'                                           
         NI    CANCCSTH+4,X'FF'-X'20'                                           
         B     DCAN200                                                          
         SPACE                                                                  
DCAN60   CLI   TAVUUSE,UULM        UDA LOCAL MONTREAL                           
         BNE   DCAN70                                                           
         LA    R2,CANUDLMH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN70   CLI   TAVUUSE,UPRG        UDA PROGRAM                                  
         BNE   DCAN80                                                           
         LA    R2,CANUDPUH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN80   CLI   TAVUUSE,UPRL        UDA PROLONGATION FEE                         
         BNE   DCAN90                                                           
         LA    R2,CANUDPFH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN90   CLI   TAVUUSE,UCPN        PENALTY                                      
         BNE   DCAN100                                                          
         LA    R2,CANPENAH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN200                                                          
         SPACE                                                                  
DCAN100  LA    R2,CANOTHRH         OTHER/SPECIFY                                
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,CANSPECH,TACMTYPU                           
         SPACE 2                                                                
DCAN200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DCAN201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DCAN300                                                          
         LA    R3,TAVUMCYS                                                      
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
DCAN201  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DCAN201A                                                         
         L     R4,ATAVUEL                                                       
         GOTO1 DATCON,DMCB,(1,TAVUMCYS),(8,CANMUST)                             
         B     DCAN202B                                                         
DCAN201A OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DCAN201B                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DCAN202                                                          
DCAN201B LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DCAN202  GOTOR DISCYC,DMCB,CANMUSTH,CANMWKSH,(R3),(R4)                          
DCAN202B OI    CANMUSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         SPACE                                                                  
         CLI   TAVUUSE2,UMUS       MUSIC                                        
         BNE   DCAN210                                                          
         LA    R2,CANMUSEH                                                      
         GOTOR DISNORM,WORK,TAVUTYP2,NOUPG,                            +        
               ('UMUS8W',CANM8WH),('UMUS8W',CANMRUSH),                 +        
               ('UMUSNEW8',CANM8WH),('UMUSNEW8',CANMCONH),             +        
               ('UMUSDUB8',CANM8WH),('UMUSDUB8',CANMDUBH),             +        
               ('UMUSDSH8',CANM8WH),('UMUSDSH8',CANMLTSH),             +        
               ('UMUS13W',CANM13WH),('UMUS13W',CANMRUSH),              +        
               ('UMUSNEW',CANM13WH),('UMUSNEW',CANMCONH),              +        
               ('UMUSDUB',CANM13WH),('UMUSDUB',CANMDUBH),              +        
               ('UMUSDSH',CANM13WH),('UMUSDSH',CANMLTSH),(X'FF',0)              
         CLI   CANMLTS,C'X'                                                     
         BNE   DCAN300                                                          
         LA    R2,CANMDUBH         IF LONG TO SHORT CHECK DUB ALSO              
         BRAS  RE,CHECKOFF                                                      
         CLI   TAVUWKS,C'8'                                                     
         BE    *+14                                                             
         CLC   TAVUWKS,=C'08'     IF LENGTH IS 8 WEEKS                          
         BNE   DCAN300                                                          
         MVI   CANM13W,C' '       MAY HAVE TO ADJUST BECAUSE WRONG TYPE         
         MVI   CANM8W,C'X'                                                      
         OI    CANM8WH+6,X'80'                                                  
         B     DCAN300                                                          
         SPACE                                                                  
DCAN210  CLI   TAVUUSE2,UCMR       MUSIC REUSE (CANADIAN)                       
         BNE   DCAN220                                                          
         LA    R2,CANMREUH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN300                                                          
         SPACE                                                                  
DCAN220  CLI   TAVUUSE2,UPEM       MUSIC PENALTY                                
         BNE   DCAN230                                                          
         LA    R2,CANMPENH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCAN300                                                          
         SPACE                                                                  
DCAN230  LA    R2,CANOTHMH          OTHER MUSIC/SPECIFY                         
         BRAS  RE,CHECKOFF                                                      
         GOTO1 CHAROUT,DMCB,TACMELQ,CANOMSPH,TACMTYPM                           
         SPACE 2                                                                
DCAN300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DCAN310                                                          
         MVC   CANAPPS,TAVUABSS                                                 
         OI    CANAPPSH+6,X'80'                                                 
         SPACE                                                                  
DCAN310  CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DCAN320                                                          
         MVC   CANAPPH,TAVUAHLD                                                 
         OI    CANAPPHH+6,X'80'                                                 
         SPACE                                                                  
DCAN320  GOTO1 CHAROUT,DMCB,TACMELQ,CANAPPCH,TACMTYPA  APPLY COMMENT            
         XIT1                                                                   
         DROP  R4                                                               
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              DISPLAY CLASS A SCREEN'S INFORMATION                             
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                                     
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISCLA   NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS  IF CYCLE START DATE EXISTS                    
         BZ    DCLA200                                                          
         CLI   TAVULEN,27                                                       
         BNE   DCLA01                                                           
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,CLACCST)                             
         B     DCLA02                                                           
DCLA01   GOTOR DISCYC,DMCB,CLACCSTH,CLAWKSH,TAVUCYCS,TAVUWKS                    
DCLA02   OI    CLACCSTH+6,X'80'                                                 
         SPACE                                                                  
         LA    R2,CLACLAOH                                                      
         CLI   TAVUUSE,UCLA       CLASS A                                       
         BE    DCLA50                                                           
         SPACE                                                                  
         LA    R2,CLAABCOH                                                      
         CLI   TAVUUSE,ULNA       LATE NIGHT ABC                                
         BE    DCLA50                                                           
         SPACE                                                                  
         LA    R2,CLANBCOH                                                      
         CLI   TAVUUSE,ULNN       LATE NIGHT NBC                                
         BE    DCLA50                                                           
         SPACE                                                                  
         LA    R2,CLACBSOH                                                      
         CLI   TAVUUSE,ULNC       LATE NIGHT CBS                                
         BE    DCLA50                                                           
         SPACE                                                                  
         LA    R2,CLAFOXOH                                                      
         CLI   TAVUUSE,ULNF       LATE NIGHT FOX                                
         BE    DCLA50                                                           
         SPACE                                                                  
         LA    R2,CLAPAXOH                                                      
         CLI   TAVUUSE,UPAX       PAX                                           
         BE    DCLA50                                                           
         SPACE                                                                  
         LA    R2,CLAITNH         ITN                                           
         CLI   TAVUUSE,UITN                                                     
         BE    *+6                                                              
         DC    H'00'                                                            
         BRAS  RE,CHECKOFF                                                      
         OC    TAVUUSES,TAVUUSES                                                
         BNZ   DCLA51                                                           
         LA    R2,CLAAUTOH                                                      
DCLA50   BRAS  RE,CHECKOFF                                                      
         B     DCLA200                                                          
DCLA51   LA    R2,CLAEUSEH                                                      
         GOTOR DISUNIT                                                          
         OI    CLANUSEH+6,X'80'                                                 
         EDIT  TAVUUSES,CLANUSE,ZERO=NOBLANK,ALIGN=LEFT                         
         SPACE 2                                                                
DCLA200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DCLA201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DCLA300                                                          
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
         B     DCLA202                                                          
DCLA201  OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DCLA201A                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DCLA202                                                          
DCLA201A LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DCLA202  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DCLA202A                                                         
         GOTO1 DATCON,DMCB,(1,(R3)),(8,CLAMUST)                                 
         B     DCLA202B                                                         
DCLA202A CLI   1(RE),24                                                         
         BNE   *+16                                                             
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUCYCS                                                      
         LA    R4,TAVUWKS                                                       
         GOTOR DISCYC,DMCB,CLAMUSTH,CLAMWKSH,(R3),(R4)                          
DCLA202B OI    CLAMUSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         SPACE                                                                  
         CLI   TAVUUSE2,UMUS       MUSIC                                        
         BNE   DCLA210                                                          
         LA    R2,CLAMUSEH                                                      
         GOTOR DISNORM,WORK,TAVUTYP2,NOUPG,                            +        
               ('UMUS13W',CLAMREH),                                    +        
               ('UMUSNEW',CLAMCONH),('UMUSDUB',CLAMDUBH),              +        
               ('UMUSDSH',CLAMLTSH),('UMUS2DS',CLAMU2LH),(X'FF',0)              
         CLI   CLAMLTS,C'X'                                                     
         BE    DCLA202C                                                         
         CLI   CLAMU2L,C'X'                                                     
         BNE   DCLA210                                                          
DCLA202C LA    R2,CLAMDUBH         IF LONG TO SHORT CHECK DUB ALSO              
         BRAS  RE,CHECKOFF                                                      
         B     DCLA300                                                          
         SPACE                                                                  
DCLA210  CLI   TAVUUSE2,UFMU       FIRST MUSIC                                  
         BNE   DCLA220                                                          
         LA    R2,CLA1MUSH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCLA300                                                          
         SPACE 1                                                                
DCLA220  CLI   TAVUUSE2,UMBO       ALL MEDIA BUYOUT                             
         BNE   DCLA300                                                          
         LA    R2,CLAMBOH                                                       
         GOTOR DISNORM,WORK,TAVUTYP2,NOUPG,('UMBOI1Y',CLAMBOIH),       +        
               ('UMBOR1Y',CLAMBORH),(X'FF',0)                                   
         SPACE 2                                                                
DCLA300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DCLA310                                                          
         MVC   CLAAPPS,TAVUABSS                                                 
         OI    CLAAPPSH+6,X'80'                                                 
         SPACE                                                                  
DCLA310  CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DCLA320                                                          
         MVC   CLAAPPH,TAVUAHLD                                                 
         OI    CLAAPPHH+6,X'80'                                                 
         SPACE                                                                  
DCLA320  GOTO1 CHAROUT,DMCB,TACMELQ,CLAAPPCH,TACMTYPA  APPLY COMMENT            
         SPACE 2                                                                
*                                   DISPLAY CLASS A DETAILS                     
         MVI   ELCODE,TANPELQ       ELCODE=CLA PROGRAM DETAILS EL.              
         MVI   PAGEMAX,PMAXCLA      N'LINES/PAGE                                
         MVC   PAGELNQ,=AL2(CLALNQ) L'LINE                                      
         LA    R3,CLAFRSTH          R3=A(FIRST SET)                             
         GOTOR DISPAGE                                                          
         XIT1                                                                   
         DROP  R4                                                               
         SPACE                                                                  
         LTORG                                                                  
         EJECT                                                                  
*              DISPLAY CABLE SCREEN'S INFORMATION                               
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                                     
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISCBL   NTR1  BASE=*,LABEL=*                                                   
         OC    TAVUCYCS,TAVUCYCS  IF CYCLE START DATE EXISTS                    
         BZ    DCBL200                                                          
         CLI   TAVULEN,27                                                       
         BNE   DCBL01                                                           
         GOTO1 DATCON,DMCB,(1,TAVUCYCS),(8,CBLCCST)                             
         B     DCBL02                                                           
DCBL01   GOTOR DISCYC,DMCB,CBLCCSTH,CBLWKSH,TAVUCYCS,TAVUWKS                    
DCBL02   OI    CBLCCSTH+6,X'80'                                                 
         SPACE                                                                  
         LA    R2,CBLCABLH                                                      
         CLI   TAVUUSE,UCBL       CABLE                                         
         BNE   DCBL10                                                           
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         CLI   TAVUTYPE,UCBLUPG                                                 
         BE    DCBL180                                                          
         SPACE                                                                  
DCBL10   LA    R2,CBLSCABH                                                      
         CLI   TAVUUSE,USCB       SPANISH CABLE                                 
         BNE   DCBL20                                                           
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         CLI   TAVUTYPE,USCBUPG                                                 
         BE    DCBL180                                                          
         SPACE                                                                  
DCBL20   LA    R2,CBLWSPTH                                                      
         CLI   TAVUUSE,UWSP       WILDSPOT                                      
         BNE   DCBL30                                                           
         GOTOR DISNORM,WORK,TAVUTYPE,CBLCAUPH,TAVUUSE,                 +        
               ('UWSPU8W',CBLWS8WH),('UWSP8W',CBLWS8WH),               +        
               ('UWSPU13W',CBLWS13H),('UWSP13W',CBLWS13H),(X'FF',0)             
         CLI   TAVUTYPE,UWSPU13W                                                
         BE    DCBL180                                                          
         CLI   TAVUTYPE,UWSPU8W                                                 
         BE    DCBL180                                                          
         SPACE                                                                  
DCBL30   LA    R2,CBLSWSPH                                                      
         CLI   TAVUUSE,USWS       SPANISH WILDSPOT                              
         BNE   DCBL40                                                           
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         CLI   TAVUTYPE,USWSUPG                                                 
         BE    DCBL180                                                          
         SPACE                                                                  
DCBL40   LA    R2,CBLCWSPH                                                      
         CLI   TAVUUSE,UWSC       CANADIAN WILDSPOT                             
         BNE   DCBL50                                                           
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         CLI   TAVUTYPE,UWSCUPG                                                 
         BE    DCBL180                                                          
         SPACE                                                                  
DCBL50   LA    R2,CBLLCABH                                                      
         CLI   TAVUUSE,ULCB       LOCAL CABLE                                   
         BNE   DCBL60                                                           
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         CLI   TAVUTYPE,ULCBU50                                                 
         BNL   DCBL180                                                          
         SPACE                                                                  
DCBL60   LA    R2,CBLAWSPH                                                      
         CLI   TAVUUSE,UADW                                                     
         BNE   DCBL190                                                          
         GOTOR DISNORM,WORK,TAVUTYPE,CBLCAUPH,TAVUUSE,                 +        
               ('UADW3D',CBLA3DYH),('UADW1W',CBLA1WKH),                +        
               ('UADW4W',CBLA4WKH),('UADW13W',CBLA13WH),               +        
               ('UADW31D',CBLA31DH),('UADWU3D',CBLA3DYH),              +        
               ('UADWU1W',CBLA1WKH),('UADWU4W',CBLA4WKH),              +        
               ('UADWU13W',CBLA13WH),('UADWU31D',CBLA31DH),(X'FF',0)            
         MVI   5(R2),1                                                          
         CLI   TAVUTYPE,UADW31D                                                 
         BE    DCBL190                                                          
         CLI   TAVUTYPE,UADW2W                                                  
         BE    DCBL190                                                          
         CLI   TAVUTYPE,UADWU3D                                                 
         BL    DCBL190                                                          
         SPACE                                                                  
DCBL180  MVI   CBLCAUP,C'Y'                                                     
         NI    CBLCAUPH+4,X'FF'-X'20'                                           
         OI    CBLCAUPH+6,X'80'                                                 
         SPACE 2                                                                
DCBL190  BRAS  RE,DISHEADS                                                      
         SPACE 1                                                                
         USING TAVUD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'00'                                                            
         SPACE 1                                                                
         GOTOR CCBLUNIT,DMCB,TAVUUSE                                            
         EDIT  UNITCALC,CBLCAUN,ZERO=NOBLANK                                    
         OI    CBLCAUNH+6,X'80'                                                 
         CLC   UNITCALC,=F'1000000'                                             
         BNE   DCBL195                                                          
         MVC   CBLCAUN,=C'  1MIL'                                               
DCBL195  CLC   UNITCALC,=F'1000000'                                             
         BNH   DCBL196                                                          
         MVC   CBLCAUN,=C' >1MIL'                                               
         SPACE 1                                                                
DCBL196  CLI   RECNUM,PV                                                        
         BNE   DCBL197                                                          
         GOTO1 RECVAL,DMCB,TLPVCDQ,(X'30',0),('TLPVSCDQ',0)                     
         B     DCBL200                                                          
DCBL197  GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
         SPACE 2                                                                
DCBL200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DCBL201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DCBL300                                                          
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
         B     DCBL202                                                          
DCBL201  OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DCBL201A                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DCBL202                                                          
DCBL201A LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DCBL202  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DCBL202A                                                         
         GOTO1 DATCON,DMCB,(1,(R3)),(8,CBLMUST)                                 
         B     DCBL202B                                                         
DCBL202A CLI   1(RE),24                                                         
         BNE   *+16                                                             
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUCYCS                                                      
         LA    R4,TAVUWKS                                                       
         GOTOR DISCYC,DMCB,CBLMUSTH,CBLMWKSH,(R3),(R4)                          
DCBL202B OI    CBLMUSTH+6,X'80'                                                 
         SPACE 1                                                                
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUUSE2                                                      
         LA    R4,TAVUTYP2                                                      
         SPACE                                                                  
DCBL205  CLI   0(R3),UMUS       MUSIC                                           
         BNE   DCBL210                                                          
         LA    R2,CBLMUSEH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,                                +        
               ('UMUS13W',CBLMREH),                                    +        
               ('UMUSNEW',CBLMCONH),('UMUSDUB',CBLMDUBH),              +        
               ('UMUSDSH',CBLMLTSH),('UMUS2DS',CBLMU2LH),(X'FF',0)              
         CLI   CBLMLTS,C'X'                                                     
         BE    DCBL206                                                          
         CLI   CBLMU2L,C'X'                                                     
         BNE   DCBL300                                                          
DCBL206  LA    R2,CBLMDUBH         IF LONG TO SHORT CHECK DUB ALSO              
         BRAS  RE,CHECKOFF                                                      
         B     DCBL300                                                          
         SPACE                                                                  
DCBL210  CLI   0(R3),UFMU       FIRST MUSIC                                     
         BNE   DCBL220                                                          
         LA    R2,CBL1MUSH                                                      
         BRAS  RE,CHECKOFF                                                      
         B     DCBL300                                                          
         SPACE 2                                                                
DCBL220  CLI   0(R3),UMBO          ALL MEDIA BUYOUT                             
         BNE   DCBL300                                                          
         LA    R2,CBLMBOH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMBOI1Y',CBLMBOIH),           +        
               ('UMBOR1Y',CBLMBORH),(X'FF',0)                                   
         B     DCBL300                                                          
         SPACE 2                                                                
DCBL300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DCBL310                                                          
         MVC   CBLAPPS,TAVUABSS                                                 
         OI    CBLAPPSH+6,X'80'                                                 
         SPACE                                                                  
DCBL310  CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DCBL320                                                          
         MVC   CBLAPPH,TAVUAHLD                                                 
         OI    CBLAPPHH+6,X'80'                                                 
         SPACE                                                                  
DCBL320  GOTO1 CHAROUT,DMCB,TACMELQ,CBLAPPCH,TACMTYPA  APPLY COMMENT            
         SPACE 2                                                                
*                                   DISPLAY CABLE DETAILS                       
         MVI   ELCODE,TAMTELQ       ELCODE=CLA PROGRAM DETAILS EL.              
         MVI   PAGEMAX,PMAXCBL      N'LINES/PAGE                                
         MVC   PAGELNQ,=AL2(CBLLNQ) L'LINE                                      
         LA    R3,CBLFRSTH          R3=A(FIRST SET)                             
         GOTOR DISPAGE                                                          
         XIT1                                                                   
         DROP  R4                                                               
         SPACE                                                                  
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY CNET OR MKT COLUMN HEADERS                    
DISHEADS NTR1  BASE=*,LABEL=*                                                   
         GOTO1 FLDVAL,DMCB,(X'03',CBLUSHDH),1                                   
         GOTO1 FLDVAL,DMCB,(X'03',CBLHD1H),8                                    
         SPACE 1                                                                
         LA    R1,CNETHEAD       USE CNET HEADER                                
         LA    R2,UNITHEAD       AND TOTAL UNITS HEADER FOR                     
         CLI   CBLCABLH+5,0      CABLE                                          
         BNE   DHEAD10                                                          
         CLI   CBLSCABH+5,0      AND SPANISH CABLE                              
         BNE   DHEAD10                                                          
         SPACE 1                                                                
         LA    R1,MKTHEAD        USE MARKET HEADER                              
         LA    R2,UNITHEAD       AND TOTAL UNITS HEADER FOR                     
         CLI   CBLWSPTH+5,0      WILDSPOT                                       
         BNE   DHEAD10                                                          
         CLI   CBLSWSPH+5,0      SPANISH WILDSPOT                               
         BNE   DHEAD10                                                          
         CLI   CBLCWSPH+5,0      CANADIAN WILDSPOT                              
         BNE   DHEAD10                                                          
         CLI   CBLAWSPH+5,0                                                     
         BNE   DHEAD10                                                          
         SPACE 1                                                                
         LA    R1,CSYSHEAD       USE CSYS HEADER FOR                            
         LA    R2,SUBSHEAD       AND TOTAL SUBS HEADER FOR                      
         CLI   CBLLCABH+5,0      LOCAL CABLE                                    
         BNE   DHEAD10                                                          
         B     DHEADX                                                           
         SPACE 1                                                                
DHEAD10  MVC   CBLUSHD,0(R2)                                                    
         SPACE 1                                                                
         LA    R2,CBLHD1H                                                       
         LHI   RF,4                                                             
DHEAD20  MVC   8(L'DATEHEAD,R2),DATEHEAD                                        
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         MVC   8(L'CBLHD1,R2),0(R1)                                             
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         BCT   RF,DHEAD20                                                       
         SPACE 1                                                                
DHEADX   XIT1                                                                   
         SPACE 1                                                                
UNITHEAD DC    CL(L'CBLUSHD)'Tot Units'                                         
SUBSHEAD DC    CL(L'CBLUSHD)'Tot Subs'                                          
DATEHEAD DC    CL(L'CBLHD1)'Date'                                               
CNETHEAD DC    CL(L'CBLHD2)'CNet'                                               
MKTHEAD  DC    CL(L'CBLHD2)'Mkt'                                                
CSYSHEAD DC    CL(L'CBLHD2)'CSys'                                               
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO CALCULATE CABLE UNITS                                 
CCBLUNIT NTR1  BASE=*,LABEL=*                                                   
         L     R1,0(R1)                                                         
         MVC   USE1,0(R1)                                                       
         SPACE 1                                                                
         XC    UNITCALC,UNITCALC                                                
         XC    SUBCOUNT,SUBCOUNT                                                
         XC    FULL,FULL                                                        
         XC    TGDUB,TGDUB                                                      
         SPACE 1                                                                
         USING TAUPD,R4                                                         
         CLI   VERLIFT,C'V'                                                     
         BE    CCUNIT05                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAUPELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   CCUNIT05                                                         
         MVC   UNITCALC+2(L'TAUPICBU),TAUPICBU                                  
         CLI   USE1,ULCB                                                        
         BNE   CCUNIT05                                                         
         MVC   UNITCALC,TAUPISUB                                                
         DROP  R4                                                               
         SPACE 1                                                                
CCUNIT05 MVC   AIO,AIO2                                                         
         SPACE 1                                                                
         MVI   TGMTTYPE,TANPNET    READ CNET RECORDS                            
         CLI   USE1,UCBL           IF USE IS CABLE                              
         BE    CCUNIT10                                                         
         CLI   USE1,USCB           OR SPANISH CABLE                             
         BE    CCUNIT10                                                         
         SPACE 1                                                                
         MVI   TGMTTYPE,C'S'       READ CSYS RECORDS                            
         CLI   USE1,ULCB           IF USE IS LOCAL CABLE                        
         BE    CCUNIT10                                                         
         SPACE 1                                                                
         MVI   TGMTTYPE,C'T'       READ TMKT RECORDS                            
         CLI   TGMENAME,C'R'       IF MEDIA IS NOT RADIO                        
         BNE   CCUNIT10                                                         
         MVI   TGMTTYPE,C'R'       ELSE, READ RMKT RECORDS                      
         SPACE 1                                                                
         USING TAMTD,R4                                                         
CCUNIT10 L     R4,AIO1           READ THROUGH CABLE STATION RECORDS             
         MVI   ELCODE,TAMTELQ                                                   
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
CCUNIT20 BRAS  RE,NEXTEL                                                        
         BNE   CCUNIT30                                                         
         C     R4,FULL           IF CABLE STATION ALREADY PROCESSED             
         BNH   CCUNIT20          GET NEXT CABLE STATION ELEMENT                 
         ST    R4,FULL                                                          
         CLC   TAMTCODE,TGDUB                                                   
         BE    CCUNIT20                                                         
         MVC   TGDUB(L'TAMTCODE),TAMTCODE                                       
         LHI   RF,TLMTCDQ                                                       
         BRAS  RE,USEALPH                                                       
         BNE   *+8                                                              
         LHI   RF,TLMTALDQ                                                      
         GOTO1 RECVAL,DMCB,(RF),(X'A4',TAMTCODE)                                
         BE    CCUNIT24                                                         
         CLI   TGMTTYPE,TANPNET                                                 
         BNE   CCUNIT21                                                         
         MVI   TGMTTYPE,C'S'                                                    
         GOTO1 RECVAL,DMCB,TLMTCDQ,(X'A4',TAMTCODE)                             
         MVI   TGMTTYPE,TANPNET                                                 
         BNE   CCUNIT21                                                         
         B     CCUNIT27                                                         
         DROP  R4                                                               
         SPACE 1                                                                
CCUNIT21 CLI   ACTNUM,ACTSEND    IF CNET/CSYS/MKT IS NOT FOUND                  
         BNE   CCUNIT20          AND ACTION IS SEND                             
         B     ERRSEND           RETURN ERROR                                   
         SPACE 1                                                                
         USING TAMSD,R4                                                         
CCUNIT24 L     R4,AIO2           GET WEIGHT FOR THE PROPER YEAR                 
         MVI   ELCODE,TAMSELQ    FROM NET CABLE RECORD                          
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
CCUNIT25 BRAS  RE,NEXTEL                                                        
         BE    CCUNIT28                                                         
         CLI   USE1,USWS                                                        
         BNE   CCUNIT10                                                         
         L     RE,UNITCALC                                                      
         AHI   RE,1                                                             
         ST    RE,UNITCALC                                                      
         B     CCUNIT10                                                         
CCUNIT28 CLI   USE1,USWS                                                        
         BNE   CCUNIT26                                                         
         CLI   TAMSTYPE,C'S'                                                    
         BNE   CCUNIT25                                                         
CCUNIT26 L     RE,UNITCALC                                                      
         L     RF,TAMSWGHT                                                      
         AR    RE,RF                                                            
         ST    RE,UNITCALC                                                      
         B     CCUNIT10                                                         
         SPACE 1                                                                
CCUNIT27 L     RF,UNITCALC                                                      
         AHI   RF,1                                                             
         ST    RF,UNITCALC                                                      
         SPACE 1                                                                
         USING TAMSD,R4                                                         
         L     R4,AIO2           GET WEIGHT FOR THE PROPER YEAR                 
         MVI   ELCODE,TAMSELQ    FROM NET CABLE RECORD                          
         BRAS  RE,GETEL                                                         
         BNE   CCUNIT10                                                         
         L     RF,SUBCOUNT                                                      
         A     RF,TAMSWGHT                                                      
         ST    RF,SUBCOUNT                                                      
         B     CCUNIT10                                                         
         DROP  R4                                                               
         SPACE 1                                                                
CCUNIT30 OC    SUBCOUNT,SUBCOUNT                                                
         BZ    CCUNITX                                                          
         XR    RE,RE                                                            
         L     RF,SUBCOUNT                                                      
         D     RE,=F'350000'                                                    
         A     RF,UNITCALC                                                      
         ST    RF,UNITCALC                                                      
         SPACE 1                                                                
CCUNITX  MVC   AIO,AIO1                                                         
         XIT1                                                                   
         SPACE 2                                                                
ERRSEND  MVC   MYMSGNO,=Y(ERRNOSND)                                             
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              DISPLAY INTERNET/NEW MEDIA SCREEN'S INFORMATION                  
         SPACE                                                                  
* ON ENTRY ... R4=A(ADVICE DETAILS ELEMENT)                                     
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISINM   NTR1  BASE=*,LABEL=*                                                   
                                                                                
         OC    TAVUCYCS,TAVUCYCS  IF CYCLE START DATE EXISTS                    
         BZ    DINM200                                                          
         GOTOR DISCYC,DMCB,INMCCSTH,INMWKSH,TAVUCYCS,TAVUWKS                    
         OI    INMCCSTH+6,X'80'                                                 
                                                                                
         CLI   TAVUUSE,UIRN       INTERNET (OLD)                                
         BNE   DINM10                                                           
         LA    R2,INMIRNH                                                       
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         B     DINM200                                                          
                                                                                
DINM10   CLI   TAVUUSE,USIR       SPANISH INTERNET (OLD)                        
         BNE   DINM20                                                           
         LA    R2,INMSIRH                                                       
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         B     DINM200                                                          
                                                                                
DINM20   CLI   TAVUUSE,UNMR       NEW MEDIA (OLD)                               
         BNE   DINM30                                                           
         LA    R2,INMNMRH                                                       
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         B     DINM200                                                          
                                                                                
DINM30   CLI   TAVUUSE,USNM       SPANISH NEW MEDIA (OLD)                       
         BNE   DINM35                                                           
         LA    R2,INMSNMH                                                       
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         B     DINM200                                                          
                                                                                
DINM35   CLI   TAVUUSE,USOM       SOCIAL MEDIA USE                              
         BNE   DINM40                                                           
         LA    R2,INMSOMH                                                       
         BRAS  RE,CHECKOFF                                                      
         MVI   5(R2),1                                                          
         B     DINM200                                                          
                                                                                
DINM40   LA    R2,INMINUH         INTERNET (NEW)                                
         CLI   TAVUUSE,UINU                                                     
         BE    DINM50                                                           
                                                                                
         LA    R2,INMSIUH         SPANISH INTERNET (NEW)                        
         CLI   TAVUUSE,USIU                                                     
         BE    DINM50                                                           
                                                                                
         LA    R2,INMNMUH         NEW MEDIA (NEW)                               
         CLI   TAVUUSE,UNMU                                                     
         BE    DINM50                                                           
                                                                                
         LA    R2,INMSNUH         SPANISH NEW MEDIA (NEW)                       
         CLI   TAVUUSE,USNU                                                     
         BE    DINM50                                                           
                                                                                
         LA    R2,INMMVIH         MOVED TO INTERNET                             
         CLI   TAVUUSE,UMVI                                                     
         BE    DINM60                                                           
                                                                                
         LA    R2,INMSMIH         SPANISH MOVED TO INTERNET                     
         CLI   TAVUUSE,USMI                                                     
         BE    DINM60                                                           
                                                                                
         LA    R2,INMMVNH         MOVED TO NEW MEDIA                            
         CLI   TAVUUSE,UMVN                                                     
         BE    DINM60                                                           
                                                                                
         LA    R2,INMSMNH         SPANISH MOVED TO NEW MEDIA                    
         B     DINM60                                                           
                                                                                
DINM50   GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,                            +        
               ('UINUI4W',INM4WKH),('UINUR4W',INM4WKH),                +        
               ('UINUI8W',INM8WKH),('UINUR8W',INM8WKH),                +        
               ('UINUI1Y',INM1YRH),('UINUR1Y',INM1YRH),                +        
               ('UINUEXT',INMEXTH),('UINUREX',INMEXTH),(X'FF',0)                
         MVI   INMRADH+5,0                                                      
         OI    INMRADH+6,X'80'                                                  
         MVI   INMRAD,0                                                         
         CLI   TAVUTYPE,UINUR8W                                                 
         BL    DINM200                                                          
         CLI   TAVUTYPE,UINUI4W                                                 
         BE    DINM200                                                          
         MVI   INMRADH+5,1                                                      
         MVI   INMRAD,C'X'                                                      
         B     DINM200                                                          
                                                                                
DINM60   GOTOR DISNORM,WORK,TAVUTYPE,NOUPG,('UMVII4W',INM4WKH),        +        
               ('UMVII8W',INM8WKH),('UMVII1Y',INM1YRH),                +        
               ('UMVIEXT',INMEXTH),(X'FF',0)                                    
         MVI   INMRADH+5,0                                                      
         OI    INMRADH+6,X'80'                                                  
         MVI   INMRAD,0                                                         
                                                                                
DINM200  L     R4,ATAVUEL                                                       
         CLI   TAVUUSE2,0          IF SECOND USE NOT PRESENT                    
         BNE   DINM201                                                          
         MVI   ELCODE,TACMELQ      CHECK FOR AN OTHER COMMENT ELEMENT           
         GOTO1 GETL,DMCB,(1,=AL1(TACMTYPM))                                     
         BNE   DINM300                                                          
         LA    R3,TAVUMCYS         IF IT EXISTS                                 
         LA    R4,TAVUMWKS         USE MUSIC CYCLE AND WEEKS                    
         B     DINM202                                                          
DINM201  OC    TAVUMCYS,TAVUMCYS   IF NO MUSIC CYCLE DATES                      
         BNZ   DINM201A                                                         
         LA    R3,TAVUCYCS         USE REGULAR CYCLE                            
         LA    R4,TAVUWKS          AND WEEKS                                    
         B     DINM202                                                          
DINM201A LA    R3,TAVUMCYS         OTHERWISE USE MUSIC CYCLE AND WEEKS          
         LA    R4,TAVUMWKS                                                      
DINM202  L     RE,ATAVUEL                                                       
         CLI   1(RE),27                                                         
         BNE   DINM202A                                                         
         GOTO1 DATCON,DMCB,(1,(R3)),(8,INMMUST)                                 
         B     DINM202B                                                         
DINM202A CLI   1(RE),24                                                         
         BNE   *+16                                                             
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUCYCS                                                      
         LA    R4,TAVUWKS                                                       
         GOTOR DISCYC,DMCB,INMMUSTH,INMMWKSH,(R3),(R4)                          
DINM202B OI    INMMUSTH+6,X'80'                                                 
                                                                                
         L     R4,ATAVUEL                                                       
         LA    R3,TAVUUSE2                                                      
         LA    R4,TAVUTYP2                                                      
                                                                                
         CLI   0(R3),UMUS       MUSIC                                           
         BNE   DINM210                                                          
         LA    R2,INMMUSH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMUSDUB8',INMMU8WH),          +        
               ('UMUS8W',INMMU8WH),('UMUSNEW8',INMMU8WH),              +        
               ('UMUSDSH8',INMMU8WH),('UMUSDUB',INMMU13H),             +        
               ('UMUS13W',INMMU13H),('UMUSNEW',INMMU13H),              +        
               ('UMUSDSH',INMMU13H),('UMUSDUB6',INMMU6MH),             +        
               ('UMUSDSH6',INMMU6MH),('UMUSDUB1',INMMU1YH),            +        
               ('UMUSDSH1',INMMU1YH),('UMUS2DS',INMMU13H),(X'FF',0)             
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMUSDUB8',INMMUDBH),          +        
               ('UMUS8W',INMMUREH),('UMUSNEW8',INMMUCOH),              +        
               ('UMUSDSH8',INMMUDBH),('UMUSDUB',INMMUDBH),             +        
               ('UMUS13W',INMMUREH),('UMUSNEW',INMMUCOH),              +        
               ('UMUSDSH',INMMUDBH),('UMUSDUB6',INMMUDBH),             +        
               ('UMUSDSH6',INMMUDBH),('UMUSDUB1',INMMUDBH),            +        
               ('UMUSDSH1',INMMUDBH),('UMUS2DS',INMMUDBH),(X'FF',0)             
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMUSDSH8',INMMULSH),          +        
               ('UMUSDSH',INMMULSH),('UMUSDSH6',INMMULSH),             +        
               ('UMUSDSH1',INMMULSH),('UMUS2DS',INMMU2LH),(X'FF',0)             
         B     DINM300                                                          
                                                                                
DINM210  CLI   0(R3),UNBM       NON-BROADCAST MUSIC                             
         BNE   DINM220                                                          
         LA    R2,INMNOBMH                                                      
         GOTOR DISNORM,WORK,(R4),NOUPG,('UNBM8WK',INMNBM8H),           +        
               ('UNBM1YR',INMNBM1H),('UNBM2YR',INMNBM2H),(X'FF',0)              
         B     DINM300                                                          
                                                                                
DINM220  CLI   0(R3),UNIM       NEW MEDIA/INTERNET MUSIC                        
         BNE   DINM230                                                          
         LA    R2,INMNIMH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UNIM8WK',INMNIM8H),           +        
               ('UNIM6MO',INMNIM6H),('UNIM1YR',INMNIM1H),(X'FF',0)              
         B     DINM300                                                          
                                                                                
DINM230  CLI   0(R3),UMBO       ALL MEDIA BUYOUT                                
         BNE   DINM300                                                          
         LA    R2,INMMBOH                                                       
         GOTOR DISNORM,WORK,(R4),NOUPG,('UMBOI1Y',INMMBOIH),           +        
               ('UMBOR1Y',INMMBORH),(X'FF',0)                                   
         B     DINM300                                                          
                                                                                
DINM300  L     R4,ATAVUEL                                                       
         CLI   TAVUABSS,0          APPLY SESSION                                
         BE    DINM310                                                          
         MVC   INMAPPS,TAVUABSS                                                 
         OI    INMAPPSH+6,X'80'                                                 
                                                                                
DINM310  CLI   TAVUAHLD,0          APPLY HOLD                                   
         BE    DINM320                                                          
         MVC   INMAPPH,TAVUAHLD                                                 
         OI    INMAPPHH+6,X'80'                                                 
                                                                                
DINM320  GOTO1 CHAROUT,DMCB,TACMELQ,INMAPPCH,TACMTYPA  APPLY COMMENT            
         XIT1                                                                   
         DROP  R4                                                               
                                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE DISPLAYS SESSION SCREEN'S INFORMATION                    
         SPACE                                                                  
DISSES   NTR1  BASE=*,LABEL=*                                                   
         GOTO1 FLDVAL,DMCB,(X'01',SDSFDTEH),(X'80',SDSRCIT) CLEAR FLDS          
         SPACE 1                                                                
         MVI   BYTE,TACSTYPF                         DISPLAY FILM INFO          
         GOTO1 DISSTU,DMCB,SDSFDTE,SDSFSTU,SDSFCIT,SDSFSTA                      
         SPACE                                                                  
         MVI   BYTE,TACSTYPR                       DISPLAY RECORD INFO          
         GOTO1 DISSTU,DMCB,SDSRDTE,SDSRSTU,SDSRCIT,SDSRSTA                      
         SPACE 1                                                                
         LA    R2,SDSFRSTH          CLEAR SCREEN                                
         LA    R3,SDSLSTH                                                       
DSES04   CR    R2,R3                                                            
         BNL   DSES06                                                           
         CLC   8(4,R2),=C'Cmnt'                                                 
         BE    DSES05                                                           
         ZICM  R1,5(R2)                                                         
         BZ    DSES05                                                           
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),SPACES                                                   
         MVI   5(R2),0                                                          
         OI    6(R2),X'80'                                                      
DSES05   ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         B     DSES04                                                           
         SPACE 1                                                                
DSES06   MVC   AIO,ADCREC           GET ADVICE CAST RECORD                      
         GOTOR TADCREC,DMCB,0                                                   
         BE    DSES10                                                           
         USING TLDCD,R3                                                         
         L     R3,AIO              SET UP NEW ADVICE CAST RECORD                
         MVC   TLDCKEY,ADVKEY                                                   
         MVI   TLDCKEY,TLDCCDQ                                                  
         MVC   TLDCLEN,DATADISP                                                 
         XC    TLDCSTAT(10),TLDCSTAT                                            
         SPACE                                                                  
DSES10   MVI   ELCODE,TAVCELQ       ELCODE=CAST DETAIL EL. CODE                 
         MVI   PAGEMAX,PMAXSESS     N'LINES/PAGE FOR SESSION SCREEN             
         MVC   PAGELNQ,=AL2(LINLNQ) L'LINE                                      
         LA    R3,SDSFRSTH          R3=A(FIRST CAST LINE)                       
         GOTOR DISPAGE              DISPLAY ADVICE CAST DETAIL ELS.             
         MVC   AIO,AIO1                                                         
         OI    SDSFDTEH+6,X'C0'                                                 
DISSESX  XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE TO DISPLAY A COMMERCIAL STUDIO ELEMENT                   
         SPACE                                                                  
* ON ENTRY ... 0(R1) = A(DATE'S SCREEN FIELD)                         *         
*              4(R1) = A(STUDIO'S SCREEN FIELD)                       *         
*              8(R1) = A(CITY'S SCREEN FIELD)                         *         
*              BYTE = ELEMENT TYPE (TACSTYPF FOR FILM)                *         
*                                  (TACSTYPR FOR RECORD)              *         
         SPACE                                                                  
DISSTU   NTR1                                                                   
         LM    R2,R5,0(R1)         R2=A(DATE), R3=A(STUDIO), R4=A(CITY)         
*                                  R5=A(STATE)                                  
         MVI   ELCODE,TACSELQ                                                   
         GOTO1 GETL,DMCB,(1,BYTE)                                               
         BNE   DISSESX                                                          
*                                                                               
         USING TACSD,R1                 DESIRED TYPE)                           
         L     R1,TGELEM           R5=A(COMMERCIAL STUDIO ELEMENT OF            
         MVC   0(L'TACSSTUD,R3),TACSSTUD          STUDIO                        
         MVC   0(L'TACSCITY,R4),TACSCITY          CITY                          
         MVC   0(L'TACSSTAT,R5),TACSSTAT          STATE                         
         MVC   TGDATE,TACSDATE                                                  
         DROP  R1                                                               
                                                                                
         GOTO1 DATCON,DMCB,(1,TGDATE),(8,(R2))  DATE                            
DSTUX    B     DISSESX                                                          
         EJECT                                                                  
*              ROUTINE TO MARK A SCREEN FIELD WITH AN X                         
         SPACE                                                                  
* ON ENTRY ... R2=A(HEADER OF SCREEN FIELD TO CHECK OFF)                        
         SPACE                                                                  
CHECKOFF MVI   8(R2),C'X'                                                       
         OI    6(R2),X'80'                                                      
         BR    RE                                                               
         EJECT                                                                  
*              ROUTINE TO MOVE UNITS TO SCREEN FIELD                            
         SPACE                                                                  
* ON ENTRY ... R2=A(HEADER OF UNITS SCREEN FIELD)                     *         
*              R4=A(ADVICE DETAILS ELEMENT)                           *         
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISUNIT  NTR1  BASE=*,LABEL=*                                                   
         OI    6(R2),X'80'                                                      
         AHI   R2,8                                                             
         EDIT  TAVUUNT,(4,(R2)),ZERO=NOBLANK,ALIGN=LEFT                         
         XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE TO DISPLAY NY,LA,CHI FIELDS                              
         SPACE                                                                  
* ON ENTRY ... R2=A(HEADER OF NY FIELD)                               *         
*              R4=A(ADVICE DETAILS ELEMENT)                           *         
         SPACE                                                                  
         USING TAVUD,R4                                                         
DISNLC   NTR1  BASE=*,LABEL=*                                                   
         TM    TAVUMAJ,NY          MARK NY FIELD                                
         BZ    DNLC10                                                           
         MVI   8(R2),C'X'                                                       
         OI    6(R2),X'80'                                                      
         SPACE                                                                  
DNLC10   ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)            MARK LA FIELD                                
         AR    R2,RE                                                            
         TM    TAVUMAJ,LA                                                       
         BZ    DNLC20                                                           
         MVI   8(R2),C'X'                                                       
         OI    6(R2),X'80'                                                      
         SPACE                                                                  
DNLC20   ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)            MARK CHI FIELD                               
         AR    R2,RE                                                            
         TM    TAVUMAJ,CHI                                                      
         BZ    DNLCX                                                            
         MVI   8(R2),C'X'                                                       
         OI    6(R2),X'80'                                                      
DNLCX    XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE DISPLAYS MAJOR AND MINOR FOR MAJORS                      
*              WITH MULTIPLE MINORS                                             
         SPACE                                                                  
* 1ST PARAMETER: ADDRESS OF TYPE TO DISPLAY                           *         
* 2ND PARAMETER: EITHER ADDRESS OF UPGRADE FIELD OR NOUPG EQU (IF NO  *         
*                UPGRADE FIELD)                                       *         
* AFTER THAT: LIST OF (USE TYPE,A(FLD HDR)                            *         
         SPACE                                                                  
* ON ENTRY ... R2=A(FIELD HEADER OF MAJOR)                            *         
*          ... R3=A(TYPE1 OR TYPE2)                                   *         
         SPACE                                                                  
DISNORM  NTR1  BASE=*,LABEL=*                                                   
         MVI   8(R2),C'X'          CHECK OFF MAJOR                              
         MVI   5(R2),1                                                          
         OI    6(R2),X'80'                                                      
         SPACE                                                                  
         L     R3,0(R1)            R3=A(TYPE)                                   
         SPACE                                                                  
         SR    R4,R4               IF NO UPRGRADE FIELD R4 = 0                  
         LA    R5,4(R1)                                                         
         OC    0(4,R5),0(R5)                                                    
         BZ    DNORM5              OTHERWISE                                    
         L     R4,0(R5)            R4 = A(UPGRADE FIELD)                        
         LA    R5,4(R5)            R6 = ADVICE'S USE                            
         L     R6,0(R5)                                                         
DNORM5   LA    R5,4(R5)                                                         
         SPACE                                                                  
DNORM10  CLI   0(R5),X'FF'         TEST FOR END OF PARAMETER LIST               
         BE    DNORMX                                                           
         CLC   0(1,R3),0(R5)       IF TYPE MATCHES TYPE POINTED AT BY           
         BNE   DNORM20             R4 .. DISPLAY AN 'X'                         
         L     R2,0(R5)                                                         
         MVI   8(R2),C'X'                                                       
         OI    6(R2),X'80'                                                      
         SPACE                                                                  
         LTR   R4,R4                                                            
         BZ    DNORM20                                                          
         GOTO1 USEVAL,DMCB,(X'80',(R6)),(X'80',(R5))                            
         TM    TGUSTYST,UPGRADE                                                 
         BZ    DNORM20                                                          
         MVI   8(R4),C'X'                                                       
         OI    6(R4),X'80'                                                      
         SPACE                                                                  
DNORM20  LA    R5,4(R5)            BUMP TO NEXT PARAMETER                       
         B     DNORM10                                                          
DNORMX   XIT1                                                                   
         EJECT                                                                  
*              ROUTINE TO DISPLAY CYCLE DATES AND LENGTH                        
         SPACE 1                                                                
DISCYC   NTR1  BASE=*,LABEL=*                                                   
         L     R4,0(R1)            R4=A(CYCLE DATE SCREEN FIELD)                
         L     R5,4(R1)            R5=A(CYCLE LENGTH FIELD)                     
         L     R6,8(R1)            R6=A(WHERE CYCLE DATES STORED)               
         L     R3,12(R1)           R3=A(WHERE CYCLE LENGTH STORED)              
         SPACE 1                                                                
         OC    3(3,R6),3(R6)                                                    
         BNZ   DCYC05                                                           
         GOTO1 DATCON,DMCB,(1,0(R6)),(8,8(R4))                                  
         OI    6(R4),X'80'                                                      
         B     DCYCX                                                            
         SPACE 1                                                                
DCYC05   NI    1(R4),X'F7'         INSURE NORMAL INTENSITY                      
         OI    4(R4),X'20'         SET PREVIOUSLY VALIDATED                     
         OC    0(6,R6),0(R6)       DISPLAY CYCLE DATES                          
         BZ    DCYC10                                                           
         GOTO1 DATCON,DMCB,(X'11',0(R6)),(8,8(R4))                              
         OI    4(R4),X'20'                                                      
         SPACE 1                                                                
DCYC10   OC    0(2,R3),0(R3)                                                    
         BZ    DCYCX                                                            
         MVC   8(2,R5),0(R3)       CYCLE WEEKS                                  
         OI    4(R5),X'20'         SET PREVIOUSLY VALIDATED                     
DCYCX    XIT1                                                                   
         EJECT                                                                  
*              ROUTINE TO DISPLAY LIFT DETAILS                                  
         SPACE                                                                  
DISLIFT  NTR1  BASE=*,LABEL=*                                                   
         CLI   VERLIFT,C'V'                                                     
         BE    DLIFTX                                                           
         SPACE 1                                                                
         MVI   VERLIFT,C'N'                                                     
         L     R4,AIO              R4=A(ADVICE OR COMMERICAL RECORD)            
         MVI   ELCODE,TALFELQ                                                   
         BRAS  RE,GETEL            R4=A(LIFT DETAILS ELEMENT)                   
         BNE   DLIFTX                                                           
         SPACE 1                                                                
         USING TALFD,R4                                                         
         MVC   MENLID,TALFLID      DISPLAY LIFT ID AND LIFT LENGTH              
         MVI   MENLIDH+5,L'TALFLID                                              
         EDIT  TALFSEC,MENLSEC,ALIGN=LEFT                                       
         STC   R0,MENLSECH+5                                                    
         MVI   VERLIFT,C'L'                                                     
         DROP  R4                                                               
DLIFTX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DISPLAY A COMMERCIAL CONTRACT ELEMENT                 
         SPACE                                                                  
DISCONS  NTR1  BASE=*,LABEL=*                                                   
         L     R4,AIO                                                           
         CLI   0(R4),TLCOCDQ       R4=A(ADVICE OR COMMERICAL RECORD)            
         BNE   DCON10                                                           
         GOTOR TRN2TACC,DMCB,AIO,AIO                                            
         SPACE 1                                                                
DCON10   MVC   WORK,SPACES         INITIALIZE OUTPUT AREA                       
         SPACE 1                                                                
         MVI   ELCODE,TACCELQ                                                   
         BRAS  RE,GETEL            R4=A(CONTRACT ELEMENT)                       
         BNE   DCONX                                                            
         SPACE 1                                                                
         USING TACCD,R4                                                         
         LA    R2,MENCON1H         R2=A(FIRST CONTRACT FIELD)                   
         ZIC   R3,TACCNCON         R3=N'CONTRACTS TO DISPLAY                    
         CHI   R3,4                                                             
         BNH   *+8                                                              
         LHI   R3,4                                                             
         LA    R4,TACCCON          R4=A(1ST CONTRACT IN ELEMENT)                
         SPACE 1                                                                
DCON20   MVC   8(L'TACCCON,R2),0(R4)   MOVE ONE CONTRACT TO OUTPUT AREA         
         OI    6(R2),X'80'                                                      
         SPACE 1                                                                
         SHI   R3,1                DECREMENT # OF CONTRACTS                     
         LTR   R3,R3               IF NO MORE CONTRACTS                         
         BZ    DCONX               DONE                                         
         SPACE 1                                                                
         LA    R4,L'TACCCON(R4)    R4=A(NEXT CONTRACT IN ELEMENT)               
         SPACE 1                                                                
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)                                                         
         AR    R2,RE               R2=A(NEXT CONTRACT FIELD)                    
         B     DCON20                                                           
DCONX    XIT1                                                                   
         DROP  R4                                                               
         EJECT                                                                  
*              ROUTINE TO DISPLAY ELEMENTS FOR MULTIPLE PAGES                   
         SPACE                                                                  
* ON ENTRY ... R3=A(FIRST SCREEN LINE)                                *         
*              ELCODE=TANPELQ IF CALLED FOR CLASS A SCREEN            *         
*                     TAVCELQ IF CALLED FOR SESSION SCREEN            *         
         SPACE                                                                  
DISPAGE  NTR1  BASE=*,LABEL=*                                                   
         ZIC   R0,PAGEMAX          R0=# OF FIELDS ON SCREEN                     
         XC    FRSTCODE,FRSTCODE                                                
         BRAS  RE,STNPAGES                                                      
         SPACE 1                                                                
         CLI   PFAID,15            IF WANT TO GO TO FIRST BLANK                 
         BNE   DP20                FIELD                                        
         ST    R3,ACURFORC         SET CURSOR TO FIRST LINE                     
         SPACE 1                                                                
         CLI   LWRSCR,SCR0E        IF ON CLASS A SCREEN                         
         BNE   DP10                                                             
         L     R1,ACURFORC         SKIP FIRST >                                 
         LA    R1,CLA1STH(R1)      AND SET REST OF FIELDS AS VALID              
         ST    R1,ACURFORC                                                      
         B     DP20                                                             
         SPACE 1                                                                
DP10     CLI   LWRSCR,SCR98        IF ON CABLE SCREEN                           
         BNE   DP30                SKIP FIRST >                                 
         L     R1,ACURFORC         AND SET REST OF FIELDS AS VALID              
         LA    R1,CBL1STH(R1)                                                   
         ST    R1,ACURFORC                                                      
         SPACE 1                                                                
DP20     GOTO1 FLDVAL,DMCB,(X'20',(R3)),100  SET ALL FIELDS VALID               
         B     DP40                                                             
         SPACE 1                                                                
DP30     GOTO1 FLDVAL,DMCB,(X'20',(R3)),999 IF ON SESSION SCREEN                
         CLI   ACTNUM,XRECPUT               SET ALL PERFORMER FIELDS            
         BE    DP40                         AS VALIDATED                        
         CLI   ACTNUM,XRECADD                                                   
         BE    DP40                                                             
         GOTOR STSCR04                                                          
         SPACE 1                                                                
DP40     XR    R2,R2               CLEAR R2 (LAST SEQUENCE NUMBER)              
         SPACE 1                                                                
         L     R4,AIO              GET TANPELQ ELEMENTS FOR CLASS A             
         BRAS  RE,GETEL            GET TAMTELQ ELEMENTS FOR CABLE               
         BNE   DP160               GET TAVCELQ ELEMENTS FOR SESSION             
         SPACE 1                                                                
         CLI   PFAID,15            IF WANT TO GO TO FIRST BLANK FIELD           
         BNE   DP50                POSITION CURSOR AT FIRST EMPTY LINE          
         L     R1,ACURFORC                                                      
         AH    R1,PAGELNQ                                                       
         ST    R1,ACURFORC                                                      
         SPACE 1                                                                
DP50     LR    R5,R4               R5=A(LAST MATCHING ELEMENT)                  
         SPACE 1                                                                
         CLI   PFAID,15            IF DON'T WANT TO GO TO FIRST BLANK           
         BE    DP70                FIELD                                        
         CLI   LWRSCR,SCR98        AND NOT ON CABLE SCREEN                      
         BE    DP60                                                             
         CLC   2(1,R4),LASTSEQ     GET NEXT SEQ. ELEM                           
         BH    DP80                                                             
DP60     CLI   LWRSCR,SCR98        IF ON CABLE SCREEN                           
         BNE   DP70                                                             
         CLC   2(6,R4),LASTCODE    GET NEXT SEQ. ELEM                           
         BH    DP80                                                             
         BNE   DP70                                                             
         CLC   8(3,R4),LASTDATE                                                 
         BH    DP80                                                             
DP70     BRAS  RE,NEXTEL           IF USER WANTS TO VIEW NXT PG USE OR          
         BE    DP50                PERF ... SCAN UNTIL REACHED LAST EL.         
         SPACE 1                                                                
         LR    R4,R5               WHEN NO MORE ELEMENTS TO FIND                
         CLI   PFAID,15            AND WE WANT NEXT BLANK                       
         BE    DP80                RESET R4 TO LAST ELEMENT                     
         MVI   LASTSEQ,0           IF USER DOES NOT WANT TO VIEW NEXT           
         XC    LASTCODE,LASTCODE   PAGE OF USE OR PERFORMER ... DONE            
         XC    LASTDATE,LASTDATE                                                
         B     DP40                                                             
         SPACE 1                                                                
DP80     CLI   LWRSCR,SCR98        IF NOT ON CABLE SCREEN                       
         BE    DP100                                                            
         MVC   FRSTSEQ,2(R4)       SAVE FIRST SEQ NUMBER DISPLAYED              
         SPACE 1                                                                
DP100    BAS   RE,DISTANP          DISPLAY CLASS A USE                          
         BAS   RE,DISTAN2                                                       
         BAS   RE,DISTAMT          OR CNET/MKT/CSYS                             
         GOTOR DISTAVC             OR SESSION PERFROMER                         
         SPACE 1                                                                
         CLI   LWRSCR,SCR98        IF NOT ON CABLE SCREEN                       
         BE    DP110                                                            
         MVC   LASTSEQ,2(R4)       SAVE LAST SEQ NUMBER DISPLAYED               
         IC    R2,2(R4)            SAVE LAST SEQUENCE NUMBER                    
DP110    CLI   LWRSCR,SCR98        IF ON CABLE SCREEN                           
         BNE   DP120                                                            
         MVC   LASTCODE,2(R4)      SAVE LAST NTI CODE DISPLAYED                 
         MVC   LASTDATE,8(R4)                                                   
         MVC   FRSTCODE,CBLCD1                                                  
         SPACE 1                                                                
DP120    BRAS  RE,NEXTEL           GET NEXT ELEMENT                             
         BNE   DP160                                                            
         AH    R3,PAGELNQ          BUMP TO NEXT LINE                            
         SPACE 1                                                                
         CLI   LWRSCR,SCR0E        IF ON CLASS A SCREEN HAVE TO                 
         BNE   DP130               ADJUST LENGTH AFTER FIRST USE                
         MVC   PAGELNQ,=AL2(CLALNQ2)                                            
DP130    CLI   LWRSCR,SCR98        IF ON CABLE SCREEN HAVE TO                   
         BNE   DP140               ADJUST LENGTH AFTER FIRST USE                
         MVC   PAGELNQ,=AL2(CBLLNQ2)                                            
DP140    BCT   R0,DP100            AND LOOP                                     
         SPACE 1                                                                
         CLI   LWRSCR,SCR98        IF NOT ON CABLE SCREEN                       
         BE    DP150               SAVE LAST SEQUENCE NUMBER (IN TOTAL          
         IC    R2,2(R4)            NOT JUST DISPLAYED)                          
DP150    BRAS  RE,NEXTEL                                                        
         BNE   DP160                                                            
         CLI   LWRSCR,SCR98                                                     
         BNE   DP170                                                            
         SPACE 1                                                                
DP160    BAS   RE,PGIT             NPAGES=TOTAL NUMBER OF PAGES NEEDED          
         ZIC   R1,TGBYTE                                                        
DP170    CLI   LWRSCR,SCR0E                                                     
         JE    DP175                                                            
         STC   R1,NPAGES           TO DISPLAY ALL ELEMENTS                      
         SPACE                                                                  
DP175    IC    R2,LASTSEQ          THISPG=PAGE NUMBER ON WHICH CURRENT          
         CLI   LWRSCR,SCR98                                                     
         BNE   DP180                                                            
         ZICM  R2,LASTCODE,4                                                    
DP180    BAS   RE,PGIT             ELEMENT WOULD BE DISPLAYED                   
         MVC   THISPG,TGBYTE                                                    
DPAGX    XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE CALCULATES PAGE NUMBER                                   
         SPACE                                                                  
* ON ENTRY ... R2=LAST SEQUENCE NUMBER                                *         
* ON EXIT  ... R1=PAGE NUMBER                                         *         
         SPACE                                                                  
PGIT     NTR1                                                                   
         CLI   LWRSCR,SCR98        IF NOT CABLE SCREEN                          
         BE    PGIT10                                                           
         ZIC   R1,PAGEMAX          ADD (MAX NUMBER OF LINES PER PAGE            
         BCTR  R1,0                - 1) TO LAST SEQUENCE NUMBER                 
         AR    R1,R2                                                            
         XR    R0,R0                                                            
         IC    R2,PAGEMAX                                                       
         DR    R0,R2               DIVIDE BY N'LINES PER SCREEN                 
         LTR   R1,R1                                                            
         BNZ   *+8                                                              
         LA    R1,1                MUST HAVE AT LEAST 1 PAGE                    
         B     PGITX                                                            
         SPACE 1                                                                
PGIT10   XR    R1,R1                                                            
         L     R4,AIO                                                           
         MVI   ELCODE,TAMTELQ                                                   
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
PGIT20   BRAS  RE,NEXTEL                                                        
         BNE   PGIT40                                                           
         AHI   R1,1                                                             
         LTR   R2,R2                                                            
         BZ    PGIT20                                                           
         C     R2,2(R4)                                                         
         BNE   PGIT20                                                           
         CLC   LASTDATE,8(R4)                                                   
         BNE   PGIT20                                                           
         SPACE 1                                                                
PGIT40   XR    R0,R0                                                            
         XC    TGFULL,TGFULL                                                    
         MVI   TGFULL+3,PMAXCBL                                                 
         D     R0,TGFULL                                                        
         LTR   R0,R0                                                            
         BZ    PGIT50                                                           
         AHI   R1,1                                                             
PGIT50   LTR   R1,R1                                                            
         BNZ   PGITX                                                            
         LHI   R1,1                                                             
PGITX    STC   R1,TGBYTE                                                        
         B     DPAGX                                                            
         SPACE 2                                                                
*              ROUTINE DISPLAYS ONE USE ON CLASS A SCREEN                       
         SPACE                                                                  
* ON ENTRY ... R3 = A(SCREEN FIELD TO DISPLAY IN)                     *         
*              R4 = A(CLASS A PROGRAM DETAILS ELEMENT)                *         
         SPACE                                                                  
         USING CLAD,R3                                                          
         USING TANPD,R4                                                         
DISTANP  NTR1                                                                   
         CLI   LWRSCR,SCR0E                                                     
         BNE   DPAGX                                                            
         CLC   PAGELNQ,=AL2(CLALNQ)                                             
         BNE   DPAGX                                                            
         MVC   CLAPROG,TANPPNME                      PROGRAM NAME               
         MVC   CLALIFT,TANPLFT                       LIFT                       
         MVC   CLANWK,TANPNWK                        NETWORK                    
         MVC   CLADATE(3),TANPDATE                   USE DATE                   
         CLC   TANPDATE,=C'TBA'                                                 
         BE    DTANP10                                                          
         GOTO1 DATCON,DMCB,(1,TANPDATE),(8,CLADATE)                             
DTANP10  OC    TANPUSEN,TANPUSEN                                                
         BZ    DISTANPX                                                         
         EDIT  TANPUSEN,CLAUSEN,ALIGN=LEFT       USE NUMBER                     
DISTANPX B     DPAGX                                                            
         DROP  R3,R4                                                            
         SPACE 2                                                                
*              ROUTINE DISPLAYS ONE USE ON CLASS A SCREEN                       
         SPACE                                                                  
* ON ENTRY ... R3 = A(SCREEN FIELD TO DISPLAY IN)                     *         
*              R4 = A(CLASS A PROGRAM DETAILS ELEMENT)                *         
         SPACE                                                                  
         USING CLA2D,R3                                                         
         USING TANPD,R4                                                         
DISTAN2  NTR1                                                                   
         CLI   LWRSCR,SCR0E                                                     
         BNE   DISTAN2X                                                         
         CLC   PAGELNQ,=AL2(CLALNQ)                                             
         BE    DISTAN2X                                                         
         MVC   CLAPRO2,TANPPNME                      PROGRAM NAME               
         MVC   CLALIF2,TANPLFT                       LIFT                       
         MVC   CLANW2,TANPNWK                        NETWORK                    
         MVC   CLADAT2(3),TANPDATE                   USE DATE                   
         CLC   TANPDATE,=C'TBA'                                                 
         BE    DTAN210                                                          
         GOTO1 DATCON,DMCB,(1,TANPDATE),(8,CLADAT2)                             
DTAN210  OC    TANPUSEN,TANPUSEN                                                
         BZ    DISTAN2X                                                         
         EDIT  TANPUSEN,CLAUS2N,ALIGN=LEFT       USE NUMBER                     
DISTAN2X B     DPAGX                                                            
         DROP  R3,R4                                                            
         SPACE 2                                                                
*              ROUTINE DISPLAYS ONE USE ON CLASS A SCREEN                       
         SPACE                                                                  
* ON ENTRY ... R3 = A(SCREEN FIELD TO DISPLAY IN)                               
*              R4 = A(MARKET DETAILS ELEMENT)                                   
         SPACE                                                                  
         USING CBLD,R3                                                          
         USING TAMTD,R4                                                         
DISTAMT  NTR1                                                                   
         CLI   LWRSCR,SCR98                                                     
         BNE   DPAGX                                                            
         CLC   PAGELNQ,=AL2(CBLLNQ)                                             
         BNE   DTAMT10                                                          
         GOTO1 DATCON,DMCB,(1,TAMTCYCS),(8,CBLDATE)                             
         MVC   CBLCODE,TAMTCODE  CNET/MKT/CSYS CODE                             
         B     DPAGX                                                            
         DROP  R3                                                               
         SPACE 2                                                                
         USING CBL2D,R3                                                         
DTAMT10  GOTO1 DATCON,DMCB,(1,TAMTCYCS),(8,CBLDAT2)                             
         MVC   CBLCOD2,TAMTCODE                                                 
         B     DPAGX                                                            
         DROP  R3,R4                                                            
         SPACE 2                                                                
*              ROUTINE DISPLAYS ONE PERFORMER ON SESSION SCREEN                 
         SPACE                                                                  
* ON ENTRY ... R3  = A(SCREEN FIELD TO DISPLAY IN)                    *         
*              R4  = A(ADVICE CAST DETAILS ELEMENT)                   *         
*              AIO = A(ADCREC)                                        *         
         SPACE                                                                  
         USING LINED,R3                                                         
         USING TAVCD,R4                                                         
DISTAVC  NTR1  BASE=*,LABEL=*                                                   
         CLI   LWRSCR,SCR04                                                     
         BNE   DVCX                                                             
         OC    TAVCSSN,TAVCSSN     SOCIAL SECURITY NUMBER                       
         BZ    DVC4                                                             
         EDIT  TAVCSSN,LINSSN,FILL=0                                            
         MVI   LINSSNH+5,L'LINSSN                                               
         OI    LINSSNH+6,X'80'                                                  
         SPACE                                                                  
         TM    TGSYSTAT,TASYSPID                                                
         BZ    DVC4                                                             
         MVC   TGSSN,LINSSN                                                     
         XC    LINSSN,LINSSN                                                    
         GOTO1 SSNPACK,DMCB,TGSSN,LINSSN                                        
         OC    LINSSN,SPACES                                                    
         MVI   LINSSNH+5,6                                                      
         SPACE                                                                  
DVC4     TM    TAVCSTAT,TAVCACTL   IF ACTUAL CAST MEMBER ...                    
         BZ    DVC10               PROTECT SOCIAL SECURITY NUMBER               
         OI    LINSSNH+1,X'20'                                                  
         MVC   LINDTAG,SPACES                                                   
         MVI   LINDTAGH+5,0                                                     
         OI    LINDTAGH+6,X'80'                                                 
         TM    TAVCSTAT,TAVCDEL    IF ACTUAL CAST MEMBER DELETED                
         BZ    DVC10               ... INDICATE SO AND TRANSMIT                 
         MVC   LINDTAG,=CL9'*DELETED*'                                          
         MVI   LINDTAGH+5,9                                                     
         SPACE                                                                  
DVC10    MVC   LINNAME,TAVCNAME               PERFORMER NAME                    
         MVC   LINDBL,TAVCDBL                 DOUBLES                           
         SPACE                                                                  
         GOTO1 CATVAL,DMCB,(X'80',TAVCCAT)    CATEGORY                          
         MVC   LINCAT,TGCACDE                                                   
         SPACE                                                                  
         MVC   LINCAM,=C'OFF'                 ON/OFF CAMERA                     
         TM    TAVCSTAT,TAVCSON                                                 
         BZ    *+10                                                             
         MVC   LINCAM,=C'ON '                                                   
         SPACE                                                                  
         TM    TAVCSTAT,TAVCNEWS              IF OLD STYLE TAVC EL              
         BO    DVC15                                                            
         GOTO1 UNIVAL,DMCB,(X'80',TAVCUNI)    USE UNIVAL TO GET UNION           
         MVC   LINUNI,TGUNCDE                                                   
         B     *+10                           IF NEW STYLE TAVC EL              
DVC15    MVC   LINUNI,TAVCUNI3                JUST MOVE IT RIGHT IN             
         SPACE                                                                  
         TM    TAVCSTAT,TAVCLFT               ON LIFT                           
         BZ    *+8                                                              
         MVI   LINLFT,C'Y'                                                      
         TM    TAVCSTAT,TAVCOLFT              ONLY ON LIFT                      
         BZ    *+8                                                              
         MVI   LINLFT,C'O'                                                      
         SPACE                                                                  
         LA    R5,LINOV1                                                        
         ICM   R6,15,TAVCOV1                                                    
         BNM   DVC20                                                            
         MVI   0(R5),C'%'                                                       
         LA    R5,1(R5)                                                         
         N     R6,=X'7FFFFFFF'                                                  
         ST    R6,TAVCOV1                                                       
DVC20    EDIT  TAVCOV1,(6,0(R5)),2,ALIGN=LEFT  OVERSCALE RATE 1                 
         LR    R1,R0                                                            
         LA    R1,LINOV1-3(R1)                                                  
         CLC   0(3,R1),=C'.00'     DON'T DISPLAY FRACTION IF ZERO               
         BNE   *+10                                                             
         MVC   0(3,R1),SPACES                                                   
         SPACE                                                                  
         EDIT  TAVCOV2,LINOV2,2,ALIGN=LEFT  OVERSCALE RATE 2                    
         LR    R1,R0                                                            
         LA    R1,LINOV2-3(R1)                                                  
         CLC   0(3,R1),=C'.00'     DON'T DISPLAY FRACTION IF ZERO               
         BNE   *+10                                                             
         MVC   0(3,R1),SPACES                                                   
         SPACE                                                                  
         LHI   RE,TAVCLNQ                                                       
         LA    RF,TAVCCMT                                                       
         TM    TAVCSTAT,TAVCNEWS                                                
         BO    *+12                                                             
         SHI   RE,3                                                             
         SHI   RF,3                                                             
         SPACE                                                                  
         STC   RE,BYTE                                                          
         CLC   TAVCLEN,BYTE        COMMENT                                      
         BNH   DVCX                                                             
         ZIC   R1,TAVCLEN          SET FOR EXECUTED MOVE                        
         SR    R1,RE                                                            
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   LINCMT(0),0(RF)                                                  
DVCX     XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO ADD/WRITE BACK ADVICE CAST RECORD(S)                  
         SPACE 1                                                                
WRTCAST  NTR1  BASE=*,LABEL=*                                                   
         CLI   LWRSCR,SCR04                                                     
         BNE   WRITITX                                                          
         SPACE 1                                                                
         L     R4,ADCREC           SAVE KEY INTO DC RECORD                      
         MVC   TLDCADV-TLDCD(L'TGADV,R4),TGADV                                  
         SPACE 1                                                                
         USING TLDCD,R4                                                         
         L     R4,ADCREC           R4=A(BIG ADVICE CAST RECORD)                 
         LA    R4,TLDCELEM-TLDCD(R4)                                            
         CLI   0(R4),0             IF NO MORE CAST ELEMENTS                     
         BNE   WRITEDC5                                                         
         ZIC   R0,MODE             SAVE MODE                                    
         MVI   MODE,XRECDEL        FUDGE MODE                                   
         GOTOR DRDCREC             DELETE ALL ADVICE CAST RECORD(S)             
         STC   R0,MODE             RESTORE MODE                                 
         B     WRITEDC8                                                         
         DROP  R4                                                               
         SPACE                                                                  
WRITEDC5 MVC   ADVKEY,KEY          SAVE KEY                                     
         MVC   AIO,ADCREC          SET AIO                                      
         BAS   RE,SPLIT            SPLIT UP BIG ADVICE CAST RECORD              
         MVC   AIO,AIO1            RESTORE AIO                                  
         MVC   KEY,ADVKEY          RESTORE KEY                                  
         SPACE                                                                  
WRITEDC8 CLI   ACTNUM,ACTADD                                                    
         BE    WRITITX                                                          
         GOTO1 READ                                                             
         MVI   RDUPDATE,C'Y'                                                    
         MVC   AIO,AIO2                                                         
         GOTO1 GETREC                                                           
         MVC   AIO,AIO1                                                         
WRITITX  XIT1                                                                   
         SPACE 1                                                                
YES2     XR    RC,RC                                                            
NO2      LTR   RC,RC                                                            
         B     WRITITX                                                          
         SPACE 2                                                                
*              ROUTINE TO SPLIT UP BIG ADVICE RECORDS                           
         SPACE 1                                                                
SPLIT    NTR1                                                                   
         MVI   RDUPDATE,C'Y'       SET TO READ FOR UPDATE                       
         NI    GENSTAT1,ALL-RDUPAPPL THIS WILL KEEP IT ON UNTIL END             
         SPACE                                                                  
         LA    R6,SEQTAB           SEQUENCE TABLE                               
         L     R4,ADCREC           R4=A(NEW ADVICE RECORD)                      
         L     R3,AIO3             R3=A(RECORD TO BE WRITTEN BACK)              
         ST    R3,AIO                                                           
         USING TLDCD,R3            SET KEY,LEN, AND STATUS                      
         MVC   TLDCKEY,0(R4)                                                    
         SPACE 1                                                                
         LA    R4,TLDCELEM-TLDCD(R4) R4=A(FIRST ELEMENT)                        
         MVI   ELCODE,0            SET TO LOOP THROUGH ALL ELEMENTS             
         SPACE 1                                                                
SPL2     MVC   TLDCLEN,DATADISP    INIT. RECORD LENGTH                          
         XC    TLDCSTAT(10),TLDCSTAT STATUS, BEG OF RECORD                      
         SPACE 1                                                                
SPL4     ZIC   R1,1(R4)            R1= L'ELEMENT                                
         AH    R1,TLDCLEN            + L'RECORD                                 
         CH    R1,=H'1900'         IF RECORD WILL NOT BECOME TOO LONG           
         BH    SPL6                                                             
         MVC   ELEMENT,0(R4)                                                    
         GOTO1 ADDELEM,DMCB,,,,0   ADD TO NEW RECORD                            
         BRAS  RE,NEXTEL                                                        
         BE    SPL4                                                             
         SPACE 1                                                                
SPL6     BAS   RE,RELEASE          WRITE BACK RECORD IN IO3                     
         SPACE 1                                                                
         LA    R6,1(R6)            BUMP SEQTAB                                  
         CLI   0(R4),0             IF THERE ARE MORE ELS. TO PROCESS            
         BNE   SPL2                GO BACK                                      
         SPACE 1                                                                
         BAS   RE,DELETE           DELETE ANY REMAINING RECORDS                 
         MVI   RDUPDATE,C'N'       TURN OFF READ FOR UPDATE                     
         OI    GENSTAT1,RDUPAPPL   RESET GENCON CONTROL SWITCH                  
         B     WRITITX                                                          
         SPACE 2                                                                
*              ROUTINE RELEASES SPLIT-UP ADVICE RECORDS                         
         SPACE 1                                                                
*                                  R6=A(DISPLACEMENT INTO SEQTAB)               
         USING TLDCD,R3            R3=A(RECORD TO BE WRITTEN BACK)              
RELEASE  NTR1                                                                   
         MVC   KEY,TLDCKEY         MOVE KEY FROM RECORD TO KEY                  
         OI    DMINBTS,X'08'       READ FOR DELETED                             
         GOTO1 HIGH                SEE IF RECORD ALREADY ON FILE                
         SPACE 1                                                                
         BAS   RE,CKFIRST          IF ELS CHANGING LIVE ON THIS REC             
         BE    REL4                                                             
         BAS   RE,CKLAST                                                        
         BE    REL4                                                             
         BAS   RE,CKSEQCHG         OR IF SEQ OF 1ST EL ON THIS REC CHGD         
         BE    RELX                                                             
         SPACE 1                                                                
REL4     LA    R3,KEY              UPDATE RECORD                                
         CLC   TLDCKEY,KEYSAVE     IS RECORD ALREADY ON FILE                    
         BE    REL8                                                             
         MVC   TLDCKEY,KEYSAVE     NO, SO RESTORE SAVED KEY                     
         GOTO1 ADDREC                                                           
         B     RELX                                                             
         SPACE 1                                                                
         USING TLDRD,R3                                                         
REL8     TM    TLDRSTAT,X'80'      IF DIRECTORY MARKED DELETED                  
         BZ    REL10                                                            
         XI    TLDRSTAT,X'80'      UNMARK IT                                    
         GOTO1 WRITE               AND WRITE IT BACK                            
         SPACE 1                                                                
REL10    MVC   AIO,AIO2            RECORD EXISTS                                
         GOTO1 GETREC                                                           
         MVC   AIO,AIO3                                                         
         GOTO1 PUTREC              WRITE BACK NEW FILE RECORD                   
         SPACE 1                                                                
RELX     NI    DMINBTS,X'F7'       TURN OFF READ FOR DELETED                    
         L     R3,AIO              R3=A(RECORD WE JUST ADDED/WROTE)             
         USING TLDCD,R3                                                         
         ZIC   R1,TLDCSEQ          BUMP SEQUENCE NUMBER IN KEY OF REC           
         LA    R1,2(R1)                                                         
         STC   R1,TLDCSEQ                                                       
         B     WRITITX                                                          
         SPACE 2                                                                
*              IF FIRST SEQUENCE ON THIS RECORD                                 
*              THEN MUST WRITE IT BACK                                          
*                                  R6=A(DISPLACMENT INTO SEQTAB)                
CKFIRST  NTR1                                                                   
         MVC   BYTE,SEQFIRST                                                    
         BAS   RE,CKRANGE                                                       
         B     WRITITX                                                          
         SPACE 1                                                                
*              IF LAST SEQUENCE ON THIS RECORD                                  
*              THEN MUST WRITE IT BACK                                          
*                                  R6=A(DISPLACMENT INTO SEQTAB)                
CKLAST   NTR1                                                                   
         MVC   BYTE,SEQLAST                                                     
         BAS   RE,CKRANGE                                                       
         B     WRITITX                                                          
         SPACE 1                                                                
CKRANGE  NTR1                                                                   
         CLI   0(R6),0             IF NO ELEMENTS IN THIS RECORD                
         BE    YES2                                                             
         CLC   BYTE,0(R6)          OR IF WITHIN RANGE                           
         BL    NO2                                                              
         CLI   1(R6),0                                                          
         BE    YES2                                                             
         CLC   BYTE,1(R6)                                                       
         BH    NO2                                                              
         B     YES2                RETURN YES                                   
         SPACE 2                                                                
*              IF FIRST ELEMENTS SEQUENCE NO LONGER THE SAME                    
*              NEED TO WRITE BACK THE RECORD                                    
*                                  R6=A(DISPLACMENT INTO SEQTAB)                
CKSEQCHG NTR1                                                                   
         L     R4,AIO3                                                          
         LA    R4,TLDCELEM-TLDCD(R4)                                            
         USING TAVCD,R4                                                         
         CLI   TAVCEL,TAVCELQ                                                   
         BE    *+6                                                              
         DC    H'0'                DOESN'T MAKE SENSE                           
         CLC   TAVCSEQ,0(R6)                                                    
         XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE DELETES SUBSEQUENT RECORDS                               
         SPACE 1                                                                
DELETE   NTR1                                                                   
         L     R3,AIO              R3=A(FILE RECORD)                            
         USING TLDCD,R3                                                         
         SPACE 1                                                                
DEL2     GOTO1 HIGH                RE-READ RECORD WE JUST WROTE                 
         NI    DMINBTS,X'F7'       TURN OFF READ DLEETED                        
         MVI   RDUPDATE,C'Y'       READ FOR UPDATE                              
         GOTO1 SEQ                                                              
         SPACE 1                                                                
         CLC   KEY(TLDCSEQ-TLDCD),KEYSAVE TEST STILL SAME ADVICE                
         BNE   WRITITX                                                          
         MVI   RDUPDATE,C'Y'       READ FOR UPDATE                              
         GOTO1 GETREC              GET THE RECORD                               
         OI    TLDCSTAT,X'80'      MARK IT DELETED                              
         GOTO1 PUTREC              AND WRITE IT BACK                            
         SPACE 1                                                                
         OI    KEY+TLDRSTAT-TLDRD,X'80'  MARK DIRECTORY DELETED                 
         GOTO1 WRITE               AND WRITE IT BACK                            
         OI    DMINBTS,X'08'       SET TO READ DELETED                          
         B     DEL2                LOOK FOR MORE                                
         SPACE 2                                                                
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DELETE/RESTORE ADVICE CAST RECORDS                    
         SPACE                                                                  
DRDCREC  NTR1  BASE=*,LABEL=*                                                   
         L     R4,AIO1             R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETALS ELEMENT)                  
         BE    *+6                                                              
         DC    H'00'                                                            
         USING TADVD,R4                                                         
         CLI   TADVTYPE,TADVTYPS   IF REUSE ADVICE ... EXIT                     
         BNE   DELRESX                                                          
         SPACE 1                                                                
         MVC   ADVKEY,KEY          SAVE KEY                                     
         OI    DMINBTS,X'08'       MAY NEED TO READ DELETED                     
         MVC   AIO,AIO3            READ ADVICE CAST REC(S) INTO AIO3            
         GOTO1 RECVAL,DMCB,TLDCCDQ,0                                            
         B     DELRES5                                                          
         SPACE                                                                  
DELRES2  GOTO1 SEQ                                                              
DELRES5  CLC   KEY(TLDCSEQ-TLDCD),KEYSAVE                                       
         BNE   DELRES10                                                         
         SPACE                                                                  
         CLI   MODE,XRECDEL                                                     
         BNE   *+12                                                             
         OI    KEY+TLDRSTAT-TLDRD,X'80'                                         
         B     *+8                                                              
         NI    KEY+TLDRSTAT-TLDRD,X'FF'-X'80'                                   
         GOTO1 WRITE                                                            
         SPACE                                                                  
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
         L     R3,AIO                                                           
         USING TLDCD,R3                                                         
         MVC   TLDCSTAT(1),KEY+TLDRSTAT-TLDRD                                   
         GOTO1 PUTREC                                                           
         B     DELRES2                                                          
         SPACE                                                                  
DELRES10 MVC   AIO,AIO1                                                         
         MVC   KEY,ADVKEY                                                       
DELRESX  XIT1                                                                   
         DROP  R3,R4                                                            
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE MENU SCREEN                                  
         SPACE                                                                  
VALMEN   NTR1  BASE=*,LABEL=*                                                   
         BAS   RE,BLDTADV                                                       
         SPACE 1                                                                
*                                   ADD NAME ELEMENTS FOR CLT,PRD,COMM          
         GOTO1 NAMIN,DMCB,TAFNELQ,MENCLINH,TAFNTCLI         CLIENT NAME         
         GOTO1 NAMIN,DMCB,TAFNELQ,(X'80',MENPRDNH),TAFNTPRD  PROD NAME          
         GOTO1 NAMIN,DMCB,TAFNELQ,MENCIDNH,TAFNTTTL         COMML NAME          
         SPACE                                                                  
         BAS   RE,VALCOM            VALIDATE COMMERCIAL RELATED FIELDS          
         BAS   RE,VALAUTH           VALIDATE AUTH/PO FIELD                      
         BAS   RE,VALEST            VALIDATE ESTIMATE NUMBER FIELD              
         SPACE 1                                                                
         MVI   ELCODE,TACMELQ       DELETE ALL OLD PROGRAM MENU                 
         MVI   TGBYTE,TACMTYPG      SCREEN COMMENT ELEMENTS                     
         LA    RF,1                                                             
         GOTO1 DELL,DMCB,((RF),TGBYTE)                                          
         SPACE 1                                                                
         MVI   ELCODE,TAXCELQ       DELETE ALL NEW PROGRAM MENU                 
         GOTO1 REMELEM              SCREEN COMMENT ELEMENTS                     
         SPACE 1                                                                
         LA    R2,MENCOM1H          R2= 1ST COMMENT FIELD                       
         LA    R4,8                 R4 = # OF COMMENT FIELDS                    
         LA    R5,1                 R5 = SEQUENCE NUMBER                        
VALMEN10 CLI   5(R2),0                                                          
         BE    VALMEN20                                                         
         XC    ELEMENT,ELEMENT      BUILD ELEMENT FOR EACH                      
         LA    R3,ELEMENT           COMMENT FIELD WITH DATA                     
         USING TAXCD,R3                                                         
         MVI   TAXCEL,TAXCELQ       ELEMENT CODE                                
         ZIC   RE,5(R2)                                                         
         AHI   RE,4                                                             
         STC   RE,TAXCLEN           ELEMENT LENGTH                              
         STC   R5,TAXCSEQ           SEQUENCE NUMBER                             
         ZIC   RE,5(R2)                                                         
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   TAXCCMNT(0),8(R2)    COMMENT                                     
         GOTO1 ADDELEM                                                          
VALMEN20 ZIC   RE,0(R2)             BUMP TO NEXT COMMENT FIELD                  
         AR    R2,RE                                                            
         LA    R5,1(R5)             INCREMENT SEQUENCE NUMBER                   
         BCT   R4,VALMEN10                                                      
         SPACE 1                                                                
         GOTOR DMENBOT              LIGHT UP VALID SCREENS TO FLIP TO           
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD        IF ADDING                                   
         BNE   VMENX                                                            
         OI    MENCLINH+6,X'C0'     POSITION CURSOR AT CLIENT                   
         CLI   PFAID,0              VALID PF KEY MUST BE PRESSED                
         BE    PRESSPFK                                                         
VMENX    XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
*              ROUTINE BUILDS ADVICE DETAILS ELEMENT                            
         SPACE                                                                  
BLDTADV  NTR1                                                                   
         XC    ELEMENT,ELEMENT                                                  
         L     R4,AIO                                                           
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   BTADV10                                                          
         USING TADVD,R4                                                         
         ZIC   R1,TADVLEN          COPY EXISTING TADV ELEMENT INTO              
         BCTR  R1,0                WORKING STORAGE (ELEMENT) AND DELETE         
         EX    R1,*+8              ELEMENT FROM ACTUAL RECORD                   
         B     *+10                                                             
         MVC   ELEMENT(0),TADVEL                                                
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
BTADV10  LA    R4,ELEMENT          BUILD ELEMENT IN WORKING STORAGE             
         MVI   TADVEL,TADVELQ      MOVE IN ELEMENT CODE                         
         MVI   TADVLEN,TADVLNQ             ELEMENT LENGTH                       
         MVC   TADVOFF,TGOFF               TALENT PARTNERS OFFICE               
         SPACE 1                                                                
         MVI   TADVOFF2,0                                                       
         CLC   COCLG,=CL6'COKE'    IF CLIENT GROUP IS COCA COLA                 
         BNE   *+8                                                              
         MVI   TADVOFF2,C'1'       SET SECOND OFFICE CODE TO ATLANTA            
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ACTION IS ADD                             
         BNE   BTADV20                                                          
         MVC   TADVCLI,TGCLI       SAVE COMMERCIAL CLIENT CODE                  
         SPACE 1                                                                
BTADV20  GOTO1 ADDELEM             ADD THE ELEMENT                              
         B     VMENX                                                            
         DROP  R4                                                               
         SPACE 2                                                                
*              ROUTINE TO VALIDATE COMMERCIAL RELATED FIELDS                    
         SPACE 1                                                                
VALCOM   NTR1                                                                   
         LA    R2,MENMEDH          VALIDATE MEDIA CODE                          
         GOTO1 MEDVAL,DMCB,8(R2)                                                
         BNE   ERMENINV                                                         
         CLI   TGMEEQU,PRINT       PRINT NOT ALLOWED                            
         BE    ERMENINV                                                         
         CLI   COMEXIST,C'Y'       IF COMMERCIAL EXISTS                         
         BNE   *+14                                                             
         CLC   COMMEDIA,8(R2)      CANNOT DIFFER FROM COMMERCIAL                
         BNE   ERMENINV            MEDIA                                        
         SPACE 1                                                                
         XC    ELEMENT,ELEMENT                                                  
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TAVUELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE USE DETAILS ELEMENT)             
         BNE   VALCOM00                                                         
         USING TAVUD,R4                                                         
         CLC   TAVUMED,TGMENAME    CANNOT CHANGE MEDIA FROM ORIGINAL            
         BNE   ERMENINV            VALUE                                        
         SPACE 1                                                                
         ZIC   R1,TAVULEN                                                       
         BCTR  R1,0                COPY EXISTING TAVU ELEMENT INTO              
         EX    R1,*+8              WORKING STORAGE (ELEMENT) AND                
         B     *+10                DELETE ELEMENT FROM ACTUAL RECORD            
         MVC   ELEMENT(0),TAVUEL                                                
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
VALCOM00 LA    R4,ELEMENT          R4=A(IN CONSTRUCTION TAVU ELEMENT)           
         USING TAVUD,R4                                                         
         MVI   TAVUEL,TAVUELQ      ELEMENT TYPE                                 
         MVI   TAVULEN,TAVULNQ     ELEMENT LENGTH                               
         MVC   TAVUMED,TGMENAME    MEDIA                                        
         BAS   RE,VALPER                                                        
         MVC   TAVUESPD,ACTUAL     PERIOD                                       
         GOTO1 ADDELEM             ADD TAVU ELEMENT TO RECORD                   
         SPACE 1                                                                
         L     R4,AIO              R4=A(ADVICE RECORD)                          
         USING TADVD,R4                                                         
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE 1                                                                
         LA    R2,MENSECH          R2=A(COMMERCIAL LENGTH FIELD)                
         CLI   5(R2),0                                                          
         BNE   VALCOMA                                                          
         CLI   MENMED,TACOMEDT     INPUT REQUIRED IF TELEVISION                 
         BE    VALCOMA                                                          
         CLI   MENMED,TACOMEDI     INPUT REQUIRED IF INTERNET                   
         BE    VALCOMA                                                          
         CLI   MENMED,TACOMEDN     INPUT REQUIRED IF NEW MEDIA                  
         BNE   VALCOM1                                                          
VALCOMA  GOTO1 VALINUM             INPUT MUST BE VALID NUMERIC                  
         MVC   TADVSEC,ACTUAL      SAVE INTO ADVICE DETAILS ELEMENT             
         SPACE 1                                                                
VALCOM1  LA    R2,MENEXPH          R2=A(COMMERCIAL EXPIRATION FIELD)            
         GOTO1 DTVAL,DMCB,(X'80',TADVEXP) MUST BE VALID DATE                    
         DROP  R4                                                               
         SPACE 1                                                                
         MVI   ELCODE,TALFELQ      REMOVE LIFT ID ELEMENT                       
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
         CLI   VERLIFT,C'V'                                                     
         BE    *+8                                                              
         MVI   VERLIFT,C'N'                                                     
         LA    R2,MENLIDH                                                       
         CLI   5(R2),0             IF LIFT ID FIELD INPUTTED                    
         BE    VALCOM3                                                          
         CLI   VERLIFT,C'V'        COMMERCIAL CANNOT HAVE VERSIONS              
         BE    ERMENINV                                                         
         MVI   VERLIFT,C'L'        SET VERLIFT TO 'L'                           
         XC    ELEMENT,ELEMENT     BUILD REGULAR LIFT ELEMENT                   
         LA    R4,ELEMENT          R4=A(IN CONSTRUCTION LIFT ID ELMNT)          
         USING TALFD,R4                                                         
         MVI   TALFEL,TALFELQ      ELEMENT TYPE                                 
         MVI   TALFLEN,TALFLNQ     ELEMENT LENGTH                               
         MVC   TALFLID,MENLID      LIFT ID                                      
         OC    TALFLID,SPACES                                                   
         SPACE 1                                                                
         LA    R2,MENLSECH         R2=A(LIFT LENGTH FIELD)                      
         GOTO1 VALINUM             MUST BE VALID NUMERIC                        
         MVC   TALFSEC,ACTUAL                                                   
         GOTO1 ADDELEM             ADD LIFT DETAILS EL.                         
         B     VALCOM4                                                          
         SPACE 1                                                                
VALCOM3  LA    R2,MENLSECH         IF LIFT ID NOT INPUTTED                      
         CLI   5(R2),0             NEITHER CAN LIFT LENGTH                      
         BNE   ERMENINV                                                         
         SPACE 1                                                                
VALCOM4  BAS   RE,BLDCONS          AFM CONTRACT NUMBERS (OPTIONAL)              
         B     VMENX                                                            
         SPACE 2                                                                
*              ROUTINE TO BUILD/ADD A COMMERCIAL CONTRACTS ELEMENT              
         SPACE                                                                  
BLDCONS  NTR1                                                                   
         MVI   ELCODE,TACCELQ      REMOVE EXISTING EL. IF AROUND                
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
         LA    R2,MENCON1H                                                      
         LA    R3,MENCON4H                                                      
         SR    R0,R0                                                            
BCONS1   CLI   5(R2),0                                                          
         BE    *+8                                                              
         AHI   R0,1                                                             
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         CR    R2,R3                                                            
         BNH   BCONS1              R0=# OF CONTRACTS                            
         SPACE 1                                                                
         LTR   R0,R0                                                            
         BZ    VMENX                                                            
         SPACE 1                                                                
         XC    ELEMENT,ELEMENT                                                  
         LA    R4,ELEMENT          R4=A(CONTRACTS ELEMENT)                      
         USING TACCD,R4                                                         
         MVI   TACCEL,TACCELQ                                                   
         STC   R0,TACCNCON         SAVE NUMBER OF CONTRACTS                     
         LR    R1,R0                                                            
         MH    R1,=AL2(L'TACCCON)  CALCULATE L'ELEMENT                          
         LA    R1,TACCCON-TACCD(R1)                                             
         STC   R1,TACCLEN                                                       
         LA    R4,TACCCON          R4=A(1ST CONTRACT IN ELEMENT)                
         SPACE 1                                                                
BCON2    LA    R2,MENCON1H                                                      
BCON3    CLI   5(R2),0                                                          
         BE    BCON4                                                            
         MVC   0(L'TACCCON,R4),8(R2)    MOVE DATA TO ELEMENT                    
         OC    0(L'TACCCON,R4),SPACES                                           
         SHI   R0,1                                                             
         SPACE 1                                                                
         LA    R4,L'TACCCON(R4)    BUMP ELEMENT POINTER                         
BCON4    ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         LTR   R0,R0                                                            
         BNZ   BCON3                                                            
         SPACE 1                                                                
         GOTO1 ADDELEM             ADD THE ELEMENT                              
BCONX    B     VMENX                                                            
         SPACE 2                                                                
*              ROUTINE VALIDATES PERIOD FIELD                                   
         SPACE 1                                                                
VALPER   NTR1                                                                   
         MVI   SVESTPER,0                                                       
         LA    R2,MENESPDH         R2=A(ESTIMATE PERIOD FIELD)                  
         CLI   5(R2),0             INPUT NOT REQUIRED                           
         BE    VMENX                                                            
         GOTO1 VALINUM             INPUT MUST BE VALID NUMERIC                  
         CLI   ACTUAL,13                                                        
         BH    ERMENINV            BETWEEN 1 AND 13                             
         MVC   SVESTPER,ACTUAL     SAVE INTO WORKING STORAGE                    
         B     VMENX                                                            
         DROP  R4                                                               
         SPACE 2                                                                
*              ROUTINE VALIDATES AUTH/PO FIELD                                  
         SPACE 1                                                                
VALAUTH  NTR1                                                                   
         LA    R3,X'80'            INITIALIZE FIELD AS OPTIONAL                 
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ACTION ADD                                
         BNE   VAUTH10                                                          
         CLI   PFAID,0                                                          
         BE    VMENX                                                            
         CLI   PFAID,14            AND GOING TO REUSE SCREEN                    
         BE    VAUTH20             AND IF AGENCY REQUIRES AUTH/PO               
         B     VAUTH15             FIELD IS REQUIRED                            
         SPACE 1                                                                
VAUTH10  L     R4,AIO              IF ACTION CHANGE                             
         USING TADVD,R4            R4=A(ADVICE RECORD)                          
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'00'                                                            
         CLI   TADVTYPE,TADVTYPS   IF ADVICE IS TYPE REUSE                      
         BE    VAUTH20                                                          
VAUTH15  TM    AGYSTAT,TAAYSAPO    IF AGENCY REQUIRES AUTH/PO                   
         BZ    VAUTH20                                                          
         SR    R3,R3               FIELD IS REQUIRED                            
         SPACE 1                                                                
VAUTH20  GOTO1 NAMIN,DMCB,TANUELQ,((R3),MENAUTHH),TANUTAUT  AUTH/PO             
         B     VMENX                                                            
         DROP  R4                                                               
         SPACE 2                                                                
*              ROUTINE VALIDATES ESTIMATE NUMBER FIELD                          
         SPACE 1                                                                
VALEST   NTR1                                                                   
         LA    R2,MENESTH                                                       
         LA    R3,X'80'            INITIALIZE FIELD AS OPTIONAL                 
         SPACE 1                                                                
         CLI   ACTNUM,ACTADD       IF ACTION ADD                                
         BNE   VALEST10                                                         
         CLI   PFAID,0                                                          
         BE    VALEX                                                            
         CLI   PFAID,14            AND GOING TO REUSE SCREEN                    
         BE    VALEST40            AND AGENCY REQUIRES ESTIMATE                 
         B     VALEST30            FIELD IS REQUIRED                            
         SPACE 1                                                                
VALEST10 L     R4,AIO              IF ACTION CHANGE                             
         MVI   ELCODE,TASIELQ                                                   
         BRAS  RE,GETEL            IF SUBSIDARY INVOICE ELEMENT EXISTS          
         BNE   VALEST20                                                         
         CLI   5(R2),0             NO ESTIMATE FIELD INPUT OK                   
         BE    VALEX                                                            
         OC    8(16,R2),SPACES     ELSE 'SPLIT' IS ONLY VALID INPUT             
         CLC   8(16,R2),=CL16'SPLIT'                                            
         BE    VALEX                                                            
         MVC   8(16,R2),=CL16'SPLIT'                                            
         OI    6(R2),X'80'         TRANSMIT                                     
         B     ERMENNI             INPUT NOT ALLOWED                            
         SPACE 1                                                                
VALEST20 L     R4,AIO              IF SUBSIDARY INVOICE ELEMENT DOES            
         USING TADVD,R4            NOT EXIST                                    
         MVI   ELCODE,TADVELQ                                                   
         BRAS  RE,GETEL            R4=A(ADVICE DETAILS ELEMENT)                 
         BE    *+6                                                              
         DC    H'00'                                                            
         CLI   TADVTYPE,TADVTYPS   IF ADVICE IS TYPE REUSE                      
         BE    VALEST40                                                         
VALEST30 TM    AGYSTAT,TAAYSEST    AND AGENCY REQUIRES ESTIMATE                 
         BZ    VALEST40                                                         
         SR    R3,R3               FIELD IS REQUIRED                            
VALEST40 GOTO1 NAMIN,DMCB,TANUELQ,((R3),(R2)),TANUTEST   ESTIMATE               
VALEX    L     RE,ASVESTFD                                                      
         MVC   0(32,RE),MENESTH                                                 
         B     VMENX                                                            
         DROP  R4                                                               
         SPACE 2                                                                
*              ERROR MESSAGES                                                   
         SPACE                                                                  
PRESSPFK MVI   MYMSGNO1,57                                                      
         L     R2,EFHREC                                                        
         OI    GENSTAT2,USGETTXT                                                
         B     ERMENEND                                                         
ERMENMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+16                                                             
ERMENINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         OI    6(R2),X'81'         SET KEY MOD. TO VAL NEXT TIME TOO            
         NI    4(R2),X'DF'         SET FIELD NOT VALIDATED                      
         B     ERMENEND                                                         
ERMENNI  MVI   ERROR,ERNOINP       INPUT NOT ALLOWED                            
ERMENEND GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE TELEVISION SCREEN                            
         SPACE                                                                  
VALTV    NTR1  BASE=*,LABEL=*                                                   
         LA    R2,TELCYSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VTV05                                                            
         GOTOR WKDEF,DMCB,(1,TELWKSH)                                           
         GOTOR VALCYC,DMCB,TELCYSTH,TELWKSH,REGDATE                             
         SPACE                                                                  
VTV05    MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         CLI   TELHFEEH+5,0        HOLDING FEE                                  
         BE    VTV10                                                            
         LA    R2,TELHFEEH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UHLD                                                        
         TM    AGYSTA5,TAAYCIHR                                                 
         BO    ERTVHFCO                                                         
         TM    COMSTA3,TACOSSMW                                                 
         BO    ERTVUMED                                                         
         CLI   COMCTYPE,CTYSEAS2                                                
         BNE   VTV10                                                            
         LA    R2,TELHFEEH                                                      
         OC    COMAIR,COMAIR                                                    
         BZ    ERTVMFA                                                          
         SPACE                                                                  
VTV10    LA    R2,TELWSPTH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             WILDSPOT                                     
         BE    VTV20                                                            
         LA    R2,TELWSPTH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UWSP                                                        
         LA    R2,TELWSNYH         NY,LA,CHI                                    
         GOTOR VALNLC                                                           
         LA    R2,TELWSUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,UWSP13W                                                    
         TM    TELWSNYH+4,X'80'                                                 
         BO    VTV15                                                            
         TM    TELWSLAH+4,X'80'                                                 
         BO    VTV15                                                            
         TM    TELWSCHH+4,X'80'                                                 
         BO    VTV15                                                            
         TM    TELWSUNH+4,X'80'                                                 
         BZ    *+8                                                              
VTV15    NI    TELWSUPH+4,X'9F'                                                 
         LA    R2,TELWSUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VTV20                                                            
         MVI   TYPE1,UWSPU13W                                                   
         SPACE                                                                  
VTV20    LA    R2,TELCABLH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             CABLE                                        
         BE    VTV30                                                            
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UCBL                                                        
         LA    R2,TELCAUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,UCBLREG                                                    
         TM    TELCAUNH+4,X'80'                                                 
         BZ    *+8                                                              
         NI    TELCAUPH+4,X'9F'                                                 
         LA    R2,TELCAUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VTV30                                                            
         MVI   TYPE1,UCBLUPG                                                    
         SPACE                                                                  
VTV30    LA    R2,TELLCABH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             LOCAL CABLE                                  
         BE    VTV40                                                            
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULCB                                                        
         LA    R2,TELLCSUH                                                      
         CLI   5(R2),0                                                          
         BE    ERTVMIS                                                          
         TM    4(R2),X'80'                                                      
         BZ    *+8                                                              
         NI    TELLCUPH+4,X'9F'                                                 
         BAS   RE,VALSUB           SUBSCRIBERS                                  
         SPACE                                                                  
VTV40    LA    R2,TELLPROH                                                      
         GOTOR MINCHK,DMCB,3                                                    
         CLI   5(R2),0             LOCAL PROGRAM                                
         BE    VTV50                                                            
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULOC                                                        
         GOTOR VALNORM,WORK,TYPE1,('ULOCB',TELLPRBH),                  +        
               ('ULOCBNY',TELLPBNH),('ULOCC',TELLPRCH),(X'FF',1)                
         SPACE                                                                  
VTV50    LA    R2,TELDEALH                                                      
         GOTOR MINCHK,DMCB,4                                                    
         CLI   5(R2),0             DEALER                                       
         BE    VTV60                                                            
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UDLR                                                        
         GOTOR VALNORM,WORK,TYPE1,('UDLRA',TELDEAAH),                  +        
               ('UDLRANY',TELDEANH),('UDLRB',TELLOCBH),                +        
               ('UDLRBNY',TELDEBNH),(X'FF',1)                                   
*                                                                               
         CLI   TELDE8WH+5,0                                                     
         BE    VTV52                                                            
         CLI   TELDE6MH+5,0         IF 6 MONTHS CHECKED, 8 WEEKS CAN            
         BE    *+12                                                             
         LA    R2,TELDE8WH                                                      
         B     ERTVINV             NOT BE CHECKED                               
         ZIC   RE,TYPE1                                                         
         LA    RE,UDLRA8-UDLRA(RE)                                              
         STC   RE,TYPE1                                                         
         LA    R2,TELWKSH                                                       
         MVC   8(2,R2),=C'8 '                                                   
         MVI   4(R2),X'08'       FORECE NUMERIC INDICATOR                       
         B     VTV56                                                            
*                                                                               
VTV52    LA    R2,TELWKSH                                                       
         CLI   5(R2),0                                                          
         BE    VTV55                                                            
         CLC   8(2,R2),=C'6M'      ONLY VALID CYCLE LENGTH INPUT                
         BE    VTV55               IS 6 MONTHS                                  
         MVC   TELCYST+8(9),SPACES                                              
         OI    TELCYSTH+6,X'80'                                                 
         B     ERTVINV                                                          
VTV55    MVC   8(2,R2),=C'6M'                                                   
VTV56    MVC   TELCYST+8(9),SPACES                                              
         MVI   5(R2),2                                                          
         OI    6(R2),X'80'                                                      
         GOTOR VALCYC,DMCB,TELCYSTH,TELWKSH,REGDATE                             
         SPACE                                                                  
VTV60    LA    R2,TELFORUH                                                      
         GOTOR MINCHK,DMCB,7                                                    
         CLI   5(R2),0              FOREIGN                                     
         BE    VTV70                                                            
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UFGR                                                        
         MVI   TYPE1,UFGRMAJ                                                    
         CLI   TELFOUKH+5,0                                                     
         BE    *+8                                                              
         OI    MAJOR,UK                                                         
         CLI   TELFOERH+5,0                                                     
         BE    *+8                                                              
         OI    MAJOR,EUR                                                        
         CLI   TELFOJPH+5,0                                                     
         BE    *+8                                                              
         OI    MAJOR,JAP                                                        
         CLI   TELFOAPH+5,0                                                     
         BE    *+8                                                              
         OI    MAJOR,AP                                                         
         CLI   TELFORSH+5,0                                                     
         BE    *+8                                                              
         OI    MAJOR,REST                                                       
         LA    R2,TELFOWWH                                                      
         CLI   5(R2),0                                                          
         BE    VTV65                                                            
         CLI   MAJOR,0               IF WORLDWIDE CHECKED ... NO OTHER          
         BNE   ERTVINV               MINOR CAN BE CHECKED                       
         OI    MAJOR,WWIDE                                                      
VTV65    LA    R2,TELFEXTH                                                      
         CLI   5(R2),0                                                          
         BE    *+8                                                              
         MVI   TYPE1,UFGREXT                                                    
         LA    R2,TELFOUKH                                                      
         CLI   MAJOR,0                                                          
         BE    ERTVMIS                                                          
VTV66    LA    R2,TELWKSH                                                       
         CLI   TYPE1,UFGREXT                                                    
         BNE   VTV67                                                            
         CLI   TELWKSH+5,0                                                      
         BNE   VTV66A                                                           
         MVC   TELWKS,=C'9M'                                                    
         MVI   TELWKSH+5,2                                                      
         OI    TELWKSH+6,X'80'                                                  
VTV66A   CLC   TELWKS,=C'9M'                                                    
         BNE   ERTVINV                                                          
VTV67    CLI   COMEXIST,C'N'       IF COMMERCIAL DOES NOT EXIST                 
         BNE   VTV68                                                            
         CLI   5(R2),0             CYCLE WEEKS MUST BE INPUTTED                 
         BE    ERTVMIS                                                          
         GOTOR VALCYC,DMCB,TELCYSTH,TELWKSH,REGDATE                             
         B     VTV70                                                            
VTV68    CLI   5(R2),0             IF COMMERCIAL DOES EXIST                     
         BE    VTV68A                                                           
         CLI   TYPE1,UFGREXT       AND TYPE IS NOT EXTENSION                    
         BE    VTV68A                                                           
         MVC   TELCYST+8(9),SPACES CYCLE WEEK INPUT IS NOT ALLOWED              
         OI    TELCYSTH+6,X'80'                                                 
         B     ERTVINV                                                          
VTV68A   CLI   TYPE1,UFGREXT                                                    
         BNE   VTV68B                                                           
         LA    R2,TELCYSTH                                                      
         GOTOR VALCYC,DMCB,TELCYSTH,TELWKSH,REGDATE                             
         GOTO1 DATVAL,DMCB,(0,SVEXP),WORK                                       
         GOTO1 DATCON,DMCB,(0,WORK),(1,FULL)                                    
         CLC   REGDATE(3),FULL                                                  
         BNH   ERTVFIN                                                          
         B     VTV70                                                            
VTV68B   LA    R2,TELCYSTH         VALIDATE INPUTTED CYCLE DATES                
         LA    R3,BLOCK                                                         
         USING PERVALD,R3                                                       
         GOTO1 PDVAL,DMCB,(R3)                                                  
         GOTO1 DATCON,DMCB,(1,PVALPSTA),(8,TELCYST)                             
         LA    R2,TELCYST           IF CYCLE WEEKS NOT INPUTTED                 
         LA    RE,TELCYST+8                                                     
         OC    TELCYST,SPACES                                                   
VTV69    CLI   0(R2),C' '                                                       
         BE    VTV69A                                                           
         CLI   0(R2),C'-'                                                       
         BE    VTV69A                                                           
         CR    R2,RE                                                            
         BE    VTV69A                                                           
         LA    R2,1(R2)                                                         
         B     VTV69                                                            
VTV69A   MVI   0(R2),C'-'                                                       
         MVC   1(L'SVEXP,R2),SVEXP                                              
         LA    RE,TELCYST                                                       
         LA    RF,0                                                             
         OC    TELCYST,SPACES                                                   
VTV69B   CLI   0(RE),C' '                                                       
         BE    VTV69C                                                           
         CHI   RF,17                                                            
         BE    VTV69C                                                           
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         B     VTV69B                                                           
VTV69C   STC   RF,TELCYSTH+5                                                    
         LA    R2,TELCYSTH                                                      
         LA    R3,BLOCK                                                         
         GOTO1 PDVAL,DMCB,(R3)                                                  
         USING PERVALD,R3                                                       
         MVC   REGDATE,PVALPSTA    SAVE PWOS DATES                              
         SPACE 1                                                                
VTV70    LA    R2,TELINDH                                                       
         GOTOR MINCHK,DMCB,2                                                    
         CLI   TELINDH+5,0         INDUSTRIAL                                   
         BE    VTV80                                                            
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UINR                                                        
         LA    R2,TELIR30H                                                      
         CLI   5(R2),0                                                          
         BE    VTV75                                                            
         MVI   TYPE1,UINR30D                                                    
         CLI   TELIRUNH+5,0                                                     
         BNE   ERTVINV                                                          
         B     VTV76                                                            
VTV75    CLI   TELIRUNH+5,0                                                     
         BE    ERTVMIS                                                          
VTV76    LA    R2,TELWKSH                                                       
         CLI   TYPE1,UINR30D         IF TYPE IS 30 DAYS                         
         BNE   VTV77                                                            
         CLI   5(R2),0               ANY INPUT IN CYCLE LENGTH                  
         BNE   ERTVINV               IS INVALID                                 
         MVC   TELCYST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,TELCYSTH,TELWKSH,REGDATE                             
         B     VTV80                                                            
VTV77    CLI   COMEXIST,C'N'         IF TYPE IS UNLIMITED                       
         BNE   VTV78                 AND COMMERCIAL DOES NOT EXIST              
         CLI   5(R2),0               CYCLE WEEKS MUST BE INPUTTED               
         BE    ERTVMIS                                                          
         GOTOR VALCYC,DMCB,TELCYSTH,TELWKSH,REGDATE                             
         B     VTV80                                                            
VTV78    CLI   5(R2),0               IF TYPE IS UNLIMITED                       
         BE    VTV78A                AND IF COMMERCIAL EXISTS                   
         MVC   TELCYST+8(9),SPACES   LENGTH CANNOT BE INPUT                     
         OI    TELCYSTH+6,X'80'                                                 
         B     ERTVINV                                                          
VTV78A   LA    R2,TELCYSTH                                                      
         LA    R3,BLOCK                                                         
         USING PERVALD,R3                                                       
         GOTO1 PDVAL,DMCB,(R3)                                                  
         GOTO1 DATCON,DMCB,(1,PVALPSTA),(8,TELCYST)                             
         LA    R2,TELCYST                                                       
         LA    RE,TELCYST+8                                                     
         OC    TELCYST,SPACES                                                   
VTV79    CLI   0(R2),C' '                                                       
         BE    VTV79A                                                           
         CLI   0(R2),C'-'                                                       
         BE    VTV79A                                                           
         CR    R2,RE                                                            
         BE    VTV79A                                                           
         LA    R2,1(R2)                                                         
         B     VTV79                                                            
VTV79A   MVI   0(R2),C'-'                                                       
         MVC   1(L'SVEXP,R2),SVEXP                                              
         LA    RE,TELCYST                                                       
         LA    RF,0                                                             
         OC    TELCYST,SPACES                                                   
VTV79B   CLI   0(RE),C' '                                                       
         BE    VTV79C                                                           
         CHI   RF,17                                                            
         BE    VTV79C                                                           
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         B     VTV79B                                                           
VTV79C   STC   RF,TELCYSTH+5                                                    
         LA    R2,TELCYSTH                                                      
         LA    R3,BLOCK                                                         
         GOTO1 PDVAL,DMCB,(R3)                                                  
         USING PERVALD,R3                                                       
         MVC   REGDATE,PVALPSTA    SAVE PWOS DATES                              
         SPACE                                                                  
VTV80    CLI   TELPBSRH+5,0        PUBLIC SERVICE                               
         BE    VTV110                                                           
         LA    R2,TELPBSRH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPBS                                                        
         SPACE                                                                  
VTV110   CLI   TELPROMH+5,0        PROMO                                        
         BE    VTV120                                                           
         LA    R2,TELPROMH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPRR                                                        
         SPACE                                                                  
VTV120   CLI   TELREINH+5,0        REINSTATEMENT                                
         BE    VTV130                                                           
         LA    R2,TELREINH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UREN                                                        
         SPACE                                                                  
VTV130   CLI   TELDWGRH+5,0        DOWNGRADE                                    
         BE    VTV140                                                           
         LA    R2,TELDWGRH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UDWN                                                        
         SPACE                                                                  
VTV140   CLI   TELCNFEH+5,0        CANCEL FEE                                   
         BE    VTV150                                                           
         LA    R2,TELCNFEH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UCNL                                                        
         SPACE                                                                  
VTV150   CLI   TELPPFEH+5,0        POSTPONEMENT FEE                             
         BE    VTV160                                                           
         LA    R2,TELPPFEH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPPF                                                        
         SPACE                                                                  
VTV160   CLI   TELPENH+5,0         PENALTY                                      
         BE    VTV170                                                           
         LA    R2,TELPENH                                                       
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPEN                                                        
         SPACE                                                                  
VTV170   CLI   TELOTHRH+5,0        OTHER                                        
         BE    VTV180                                                           
         LA    R2,TELOTHRH                                                      
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,TELOSPCH,TACMTYPU                             
         SPACE                                                                  
VTV180   CLI   TELCYSTH+5,0        IF CYCLE START DATE INPUTTED ...             
         BE    VTV200                                                           
         LA    R2,TELHFEEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VTV200   CLC   TYPECHK1,=C'XXXX'                                                
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,TELMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VTV201                                                           
         GOTOR WKDEF,DMCB,(2,TELMWKSH)                                          
         GOTOR VALCYC,DMCB,TELMUSTH,TELMWKSH,MUSDATE                            
         SPACE                                                                  
VTV201   MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,TELMUSEH                                                      
         GOTOR MINCHK,DMCB,4                                                    
         CLI   5(R2),0             MUSIC REUSE                                  
         BE    VTV210                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         CLI   TELMLTSH+5,0                                                     
         BNE   VTV201A                                                          
         CLI   TELMU2LH+5,0                                                     
         BE    VTV202                                                           
VTV201A  LA    R2,TELMDUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERTVMIS                                                          
         LA    R2,TELMUSEH                                                      
VTV202   GOTOR VALNORM,WORK,TYPE2,('UMUS13W',TELMREH),                 +        
               ('UMUSNEW',TELMCONH),('UMUSDUB',TELMDUBH),(X'FF',1)              
         CLI   TELMLTSH+5,0                                                     
         BE    *+8                                                              
         MVI   TYPE2,UMUSDSH                                                    
         CLI   TELMU2LH+5,0                                                     
         BE    VTV210                                                           
         LA    R2,TELMU2LH                                                      
         CLI   TYPE2,UMUSDSH                                                    
         JE    ERTVINV                                                          
         MVI   TYPE2,UMUS2DS                                                    
         SPACE                                                                  
VTV210   CLI   TEL1MUSH+5,0        FIRST MUSIC                                  
         BE    VTV220                                                           
         LA    R2,TEL1MUSH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFMU                                                        
         MVI   TYPE2,UFMU13W                                                    
         SPACE                                                                  
VTV220   LA    R2,TELNOBMH         NON-BROADCAST MUSIC                          
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VTV230                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UNBM                                                        
         GOTOR VALNORM,WORK,TYPE2,('UNBM8WK',TELNBM8H),                +        
               ('UNBM1YR',TELNBM1H),('UNBM2YR',TELNBM2H),(X'FF',1)              
         LA    R2,TELMWKSH                                                      
         CLI   5(R2),0                                                          
         BNE   ERTVINV                                                          
         MVC   TELMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,TELMUSTH,TELMWKSH,MUSDATE                            
         SPACE                                                                  
VTV230   CLI   TELREGMH+5,0        REGIONAL MUSIC                               
         BE    VTV240                                                           
         LA    R2,TELREGMH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,URGM                                                        
         SPACE                                                                  
VTV240   LA    R2,TELFRMUH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             FOREIGN MUSIC                                
         BE    VTV247                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFGM                                                        
         LA    R2,TELA12MH         EITHER 12 OR 24 MONTH FIELD MUST             
         CLI   TELA12MH+5,0        BE CHECKED BUT NOT BOTH                      
         BE    VTV245                                                           
         CLI   TELA24MH+5,0        SAVE 12 MONTH TYPE                           
         BNE   ERTVINV                                                          
         GOTOR VALNORM,WORK,TYPE2,('UFGMEU12',TELAUKEH),               +        
               ('UFGMNE12',TELANOEH),('UFGMWO12',TELAWRLH),(X'FF',1)            
         B     VTV246                                                           
VTV245   CLI   TELA24MH+5,0        SAVE 24 MONTH TYPE                           
         BE    ERTVMIS                                                          
         GOTOR VALNORM,WORK,TYPE2,('UFGMEU24',TELAUKEH),               +        
               ('UFGMNE24',TELANOEH),('UFGMWO24',TELAWRLH),(X'FF',1)            
VTV246   LA    R2,TELMWKSH                                                      
         CLI   5(R2),0                                                          
         BNE   ERTVINV                                                          
         MVC   TELMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,TELMUSTH,TELMWKSH,MUSDATE                            
         SPACE                                                                  
VTV247   LA    R2,TELMBOH          ALL MEDIA BUYOUT                             
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VTV250                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMBO                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMBOI1Y',TELMBOIH),                +        
               ('UMBOR1Y',TELMBORH),(X'FF',1)                                   
         MVC   TELMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,TELMUSTH,TELMWKSH,MUSDATE                            
         SPACE 2                                                                
VTV250   CLI   TELMPENH+5,0        MUSIC PENALTY                                
         BE    VTV260                                                           
         LA    R2,TELMPENH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UPEM                                                        
         SPACE                                                                  
VTV260   CLI   TELOMUSH+5,0        MUSIC OTHER                                  
         BE    VTV270                                                           
         LA    R2,TELOMUSH                                                      
         CLI   TELOTHRH+5,0                                                     
         BNE   ERTVINV                                                          
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,TELOMSPH,TACMTYPM                             
         SPACE                                                                  
VTV270   CLI   TELMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VTV280                                                           
         LA    R2,TELMUSEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VTV280   LA    R2,TELCYSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VTV300              MUSIC CYCLE START DATE MUST BE               
         CLI   TELMUSTH+5,0        ENTERED                                      
         BE    ERTVMIS                                                          
         SPACE 2                                                                
VTV300   CLI   TELCYSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VTV301                                                           
         CLI   USE1,UFGR           AND USE IS NOT FOREIGN                       
         BE    VTV301                                                           
         CLI   USE1,UINR           OR INDUSTRIAL                                
         BE    VTV301                                                           
         LA    R2,TELWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VTV301   CLI   TELMUSTH+5,0        IF MUSIC CYCLE DATES PRESENT                 
         BE    VTV302                                                           
         CLI   USE2,UFGM           AND USE IS NOT FOREIGN MUSIC                 
         BE    VTV302                                                           
         CLI   USE2,UNBM           AND USE IS NOT NON-BROADCAST MUSIC           
         BE    VTV302                                                           
         CLI   USE2,UMBO           AND USE IS NOT ALL MEDIA BUYOUT              
         BE    VTV302                                                           
         LA    R2,TELMWKSH         MUSIC CYCLE WEEKS MUST BE                    
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VTV302   LA    R2,TELAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
         LA    R2,TELAPPHH                                                      
         GOTOR APPHLD                                                           
         SPACE                                                                  
VTV320   GOTO1 NAMIN,DMCB,TACMELQ,(X'80',TELAPPCH),TACMTYPA APPLY COMM          
VTVX     NI    TELCYSTH+6,X'FF'-X'40'                                           
VTVXX    XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE VALIDATES SUBSCRIBER FIELD                               
         SPACE 1                                                                
VALSUB   NTR1                                                                   
         LA    RE,VSUBTAB                                                       
VSUB10   CLI   0(RE),X'FF'                                                      
         BE    ERTVINV                                                          
         ZIC   R1,5(R2)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   8(0,R2),0(RE)                                                    
         BE    VSUB20                                                           
         LA    RE,6(RE)                                                         
         B     VSUB10                                                           
         SPACE 1                                                                
VSUB20   MVC   TYPE1,5(RE)         SAVE REGULAR TYPE                            
         GOTO1 USEVAL,DMCB,(X'80',USE1)                                         
         SPACE 1                                                                
         TM    4(R2),X'80'                                                      
         BZ    VSUB22                                                           
         NI    TELLCUPH+4,X'DF'                                                 
         SPACE 1                                                                
VSUB22   LA    R2,TELLCUPH                                                      
         CLI   5(R2),0                                                          
         BNE   VSUB25                                                           
         NI    4(R2),X'DF'                                                      
         B     VSUB60                                                           
         SPACE 1                                                                
VSUB25   TM    4(R2),X'20'                                                      
         BZ    *+14                                                             
         MVC   TYPE1,SVUPTYP                                                    
         B     VSUB60                                                           
         GOTOR VALUPG                                                           
         CLI   UPGR,C'N'                                                        
         BE    VSUB60                                                           
         SPACE 1                                                                
         CLI   8(R2),C'Y'          IF UPGRADE                                   
         BNE   *+8                                                              
         MVI   TGUPFRTY,ULCB50     SET DUMMY "FROM" TYPE FOR NOW                
         GOTO1 UPGRVAL,DMCB,(X'80',TGUSCDE),TGUPFRTY,TGUSCDE,TYPE1              
         BE    *+12                                                             
         BAS   RE,NUPGRR                                                        
         B     VSUB50                                                           
         SPACE 1                                                                
         MVC   AIO,AIO2                                                         
         LA    R3,KEY              BUILD PARTIAL KEY FOR RECORD                 
         USING TLUHD,R3                                                         
         XC    TLUHKEY,TLUHKEY                                                  
         MVI   TLUHCD,TLUHCDQ      RECORD CODE                                  
         MVC   TLUHCOM,TGCOM       INTERNAL COMMERCIAL NUMBER                   
         MVC   TLUHUSE,TGUSCDE     USE CODE                                     
         GOTO1 HIGH                GET DIRECTORY RECORD                         
         B     VSUB40                                                           
         SPACE 1                                                                
VSUB30   GOTO1 SEQ                 GET NEXT DIRECTORY RECORD                    
VSUB40   CLC   TLUHKEY(TLUHINV-TLUHD),KEYSAVE  DID WE FIND REC FOR USE          
         BE    *+12                                                             
         BAS   RE,NOPREVRR                                                      
         B     VSUB50                                                           
         GOTO1 GETREC              GET THE RECORD                               
         SPACE 1                                                                
         USING TAUHD,R4                                                         
         MVI   ELCODE,TAUHELQ      GET USAGE HISTORY ELEMENT                    
         L     R4,AIO                                                           
         BRAS  RE,GETEL                                                         
         BNE   VSUB30                                                           
         SPACE                                                                  
         CLC   REGDATE,TAUHSTRT    IF CYCLE STARTS ARE THE SAME                 
         BNE   VSUB30                                                           
         MVC   TGUPFRTY,TAUHTYPE   SET "FROM" TYPE FOR UPGRVAL                  
         GOTO1 UPGRVAL,DMCB,(X'80',TGUSCDE),TGUPFRTY,TGUSCDE,TGUPTOTY           
         BE    *+8                                                              
         BAS   RE,NUPGRR                                                        
         CLC   TAUHTYPE,TGUPTOTY   TEST RANGE OF SUBSCRIBERS                    
         BL    *+8                                                              
         BAS   RE,NUPGRR                                                        
VSUB50   MVC   TYPE1,TGUPTYP                                                    
         MVC   SVUPTYP,TYPE1                                                    
VSUB60   MVC   KEY,ADVKEY                                                       
         CLI   ACTNUM,ACTADD                                                    
         BE    VSUB70                                                           
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0) RE-READ ADVICE                     
VSUB70   MVC   AIO,AIO1                                                         
         MVI   ELCODE,TAUPELQ                                                   
         GOTO1 REMELEM                                                          
         XC    ELEMENT,ELEMENT                                                  
         USING TAUPD,R5                                                         
         LA    R5,ELEMENT                                                       
         MVI   TAUPEL,TAUPELQ                                                   
         MVI   TAUPLEN,TAUPLNQ                                                  
         MVC   TAUPILCM,TAUHTYPE                                                
         GOTO1 ADDELEM                                                          
         NI    STATUS,X'FF'-WAITUPFK                                            
         XC    UPGFLD,UPGFLD                                                    
         OI    4(R2),X'20'                                                      
         CLI   SELECT,C'Y'                                                      
         BNE   VSUB80                                                           
         CLI   THISLSEL,C'C'                                                    
         BNE   VSUB80                                                           
         MVI   PFAID,14                                                         
         TM    STATUS,WAITLPFK                                                  
         BZ    VSUBX                                                            
         MVI   PFAID,20                                                         
         B     VSUBX                                                            
VSUB80   CLI   PFAID,14                                                         
         BE    VSUBX                                                            
         CLI   STATUS,0                                                         
         BNE   VSUBX                                                            
         MVI   PFAID,0                                                          
VSUBX    B     VTVXX                                                            
         DROP  R4,R5                                                            
         SPACE 2                                                                
NUPGRR   NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    NUPGG                                                            
         CLI   PFAID,20                                                         
         BNE   NUPGG                                                            
         B     VTVXX                                                            
         SPACE 2                                                                
NOPREVRR NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    NOPREVV                                                          
         CLI   PFAID,20                                                         
         BNE   NOPREVV                                                          
         B     VTVXX                                                            
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR VALUPG                           
VSUBTAB  DC    CL5'50K',AL1(ULCB50)                                             
         DC    CL5'100K',AL1(ULCB100)                                           
         DC    CL5'150K',AL1(ULCB150)                                           
         DC    CL5'200K',AL1(ULCB200)                                           
         DC    CL5'250K',AL1(ULCB250)                                           
         DC    CL5'500K',AL1(ULCB500)                                           
         DC    CL5'750K',AL1(ULCB750)                                           
         DC    CL5'1MIL',AL1(ULCB1M)                                            
         DC    CL5'1MIL+',AL1(ULCBMAX)                                          
         DC    X'FF'                                                            
         SPACE 2                                                                
*        VALTV'S ERROR MESSAGES AND LITERALS                                    
         SPACE                                                                  
ERTVUMED MVI   ERROR,ERUSEMED      INVALID USE FOR MEDIA                        
         B     TVEND                                                            
NOPREVV  MVI   MYMSGNO1,91                                                      
         B     *+8                                                              
NUPGG    MVI   MYMSGNO1,92         THIS IS NOT AN UPGRADE                       
         OI    GENSTAT2,USGETTXT                                                
         ST    R2,UPGFLD                                                        
         OI    STATUS,WAITUPFK                                                  
         B     TVEND                                                            
ERTVHFCO MVC   MYMSGNO,=Y(ERHFCRNO)                                             
         B     *+10                                                             
ERTVMFA  MVC   MYMSGNO,=Y(ERMSSFAD)                                             
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
         B     TVEND                                                            
ERTVMIS  MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     TVEND                                                            
ERTVFIN  MVI   MYMSGNO1,105                                                     
         OI    GENSTAT2,USGETTXT                                                
         B     TVEND                                                            
ERTVINV  MVI   ERROR,INVALID       INVALID INPUT FIELD                          
TVEND    GOTO1 EXIT,DMCB,0                                                      
         SPACE                                                                  
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE RADIO SCREEN                                 
         SPACE                                                                  
VALRAD   NTR1  BASE=*,LABEL=*                                                   
         LA    R2,RADCCSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VRAD01                                                           
         GOTOR WKDEF,DMCB,(3,RADWKSH)                                           
         GOTOR VALCYC,DMCB,RADCCSTH,RADWKSH,REGDATE                             
         SPACE                                                                  
VRAD01   MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,RADWSPTH                                                      
         GOTOR MINCHK,DMCB,7                                                    
         CLI   5(R2),0             WILDSPOT                                     
         BE    VRAD10                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UWSP                                                        
         LA    R2,RADWSNYH         NY,LA,CHI                                    
         GOTOR VALNLC                                                           
         LA    R2,RADWSUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         TM    RADWS8WH+4,X'80'                                                 
         BO    VRAD03                                                           
         TM    RADWS13H+4,X'80'                                                 
         BO    VRAD03                                                           
         TM    RADWSNYH+4,X'80'                                                 
         BO    VRAD03                                                           
         TM    RADWSLAH+4,X'80'                                                 
         BO    VRAD03                                                           
         TM    RADWSCHH+4,X'80'                                                 
         BO    VRAD03                                                           
         TM    RADWSUNH+4,X'80'                                                 
         BZ    *+8                                                              
VRAD03   NI    RADWSUPH+4,X'9F'                                                 
         LA    R2,RADWS13H                                                      
         CLI   RADWS8WH+5,0        EITHER 8 WEEKS OR 13 WEEKS MUST BE           
         BE    VRAD05              CHECKED BUT NOT BOTH                         
         CLI   RADWS13H+5,0                                                     
         BNE   ERRADINV                                                         
         MVI   TYPE1,UWSP8W                                                     
         B     VRAD07                                                           
VRAD05   LA    R2,RADWS8WH                                                      
         CLI   RADWS13H+5,0                                                     
         BE    ERRADMIS                                                         
         MVI   TYPE1,UWSP13W                                                    
VRAD07   CLI   RADWKSH+5,0                                                      
         BE    VRAD08                                                           
         LA    R2,RADWKSH                                                       
         OI    RADWKS+1,X'40'                                                   
         CLI   RADWS8WH+5,0                                                     
         BE    *+14                                                             
         CLC   RADWKS,=C'8 '                                                    
         BNE   ERRADINV                                                         
         CLI   RADWS13H+5,0                                                     
         BE    VRAD08                                                           
         CLC   RADWKS,=C'13'                                                    
         BNE   ERRADINV                                                         
VRAD08   MVC   RADCCST+8(9),SPACES   CALCULATE CYCLE                            
         TM    RADCCSTH+4,X'20'                                                 
         BO    *+8                                                              
         NI    RADWSUPH+4,X'DF'                                                 
         GOTOR VALCYC,DMCB,RADCCSTH,RADWKSH,REGDATE                             
         LA    R2,RADWSUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'N'                                                        
         BE    VRAD10                                                           
         CLI   TYPE1,UWSP8W                                                     
         BNE   *+12                                                             
         MVI   TYPE1,UWSPU8W                                                    
         B     VRAD10                                                           
         MVI   TYPE1,UWSPU13W                                                   
         SPACE                                                                  
VRAD10   LA    R2,RADNETWH                                                      
         GOTOR MINCHK,DMCB,7                                                    
         CLI   5(R2),0             NETWORK                                      
         BE    VRAD20                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,URNT                                                        
         GOTOR VALNORM,WORK,TYPE1,('URNT1W',RAD1WKH),                  +        
               ('URNT4W',RAD4WKH),('URNT8W',RAD8WKH),                  +        
               ('URNT13W',RAD13WKH),('URNT26U',RAD26USH),              +        
               ('URNT39U',RAD39USH),('URNTAB',RADACBDH),(X'FF',1)               
         CLI   RADWKSH+5,0                                                      
         BE    VRAD11                                                           
         LA    R2,RADWKSH                                                       
         OI    RADWKS+1,X'40'                                                   
         CLI   TYPE1,URNT1W                                                     
         BNE   *+18                                                             
         CLC   RADWKS,=C'1 '                                                    
         BNE   ERRADINV                                                         
         B     VRAD11                                                           
         CLI   TYPE1,URNT4W                                                     
         BNE   *+18                                                             
         CLC   RADWKS,=C'4 '                                                    
         BNE   ERRADINV                                                         
         B     VRAD11                                                           
         CLI   TYPE1,URNT8W                                                     
         BNE   *+18                                                             
         CLC   RADWKS,=C'8 '                                                    
         BNE   ERRADINV                                                         
         B     VRAD11                                                           
         CLC   RADWKS,=C'13'                                                    
         BNE   ERRADINV                                                         
VRAD11   MVC   RADCCST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,RADCCSTH,RADWKSH,REGDATE                             
         SPACE                                                                  
VRAD20   LA    R2,RADREGNH                                                      
         GOTOR MINCHK,DMCB,4                                                    
         CLI   5(R2),0             REGIONAL NETWORK                             
         BE    VRAD30                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,URRN                                                        
         LA    R2,RADRNNYH         NY,LA,CHI                                    
         GOTOR VALNLC                                                           
         BNE   VRAD25                                                           
         LA    R2,RADNONEH         IF NY,LA,CHI ALL UNCHECKED ...               
         CLI   RADNONEH+5,0        NONE MUST BE CHECKED                         
         BE    ERRADMIS                                                         
         B     VRAD30                                                           
VRAD25   LA    R2,RADNONEH                                                      
         CLI   RADNONEH+5,0                                                     
         BNE   ERRADINV                                                         
         SPACE                                                                  
VRAD30   CLI   RADLOCAH+5,0        LOCAL REUSE                                  
         BE    VRAD40                                                           
         LA    R2,RADLOCAH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,URLO                                                        
         SPACE                                                                  
VRAD40   CLI   RADDEALH+5,0        DEALER                                       
         BE    VRAD50                                                           
         LA    R2,RADDEALH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UDLR                                                        
         LA    R2,RADWKSH                                                       
         CLI   5(R2),0                                                          
         BE    VRAD45                                                           
         CLC   8(2,R2),=C'6M'      ONLY VALID CYCLE LENGTH INPUT                
         BE    VRAD45              IS 6 MONTHS                                  
         MVC   RADCCST+8(9),SPACES                                              
         OI    RADCCSTH+6,X'80'                                                 
         B     ERRADINV                                                         
VRAD45   MVC   8(2,R2),=C'6M'                                                   
         MVC   RADCCST+8(9),SPACES                                              
         MVI   5(R2),2                                                          
         OI    6(R2),X'80'                                                      
         GOTOR VALCYC,DMCB,RADCCSTH,RADWKSH,REGDATE                             
         SPACE                                                                  
VRAD50   LA    R2,RADINDRH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   RADINDRH+5,0        INDUSTRIAL                                   
         BE    VRAD60                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UINR                                                        
         LA    R2,RADIR30H                                                      
         CLI   5(R2),0                                                          
         BE    VRAD55                                                           
         MVI   TYPE1,UINR30D                                                    
         CLI   RADIRUNH+5,0                                                     
         BNE   ERRADINV                                                         
         B     VRAD56                                                           
VRAD55   CLI   RADIRUNH+5,0                                                     
         BE    ERRADMIS                                                         
VRAD56   LA    R2,RADWKSH                                                       
         CLI   TYPE1,UINR30D         ANY INPUT IN CYCLE LENGTH                  
         BNE   VRAD57                IS INVALID FOR TYPE 30 DAYS                
         CLI   5(R2),0                                                          
         BNE   ERRADINV                                                         
         MVC   RADCCST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,RADCCSTH,RADWKSH,REGDATE                             
         B     VRAD60                                                           
VRAD57   LA    R2,RADWKSH            IF UNLIMITED TYPE                          
         CLI   COMEXIST,C'N'         AND COMMERCIAL DOES NOT EXIST              
         BNE   VRAD58                                                           
         CLI   5(R2),0               CYCLE WEEKS MUST BE INPUTTED               
         BE    ERRADMIS                                                         
         GOTOR VALCYC,DMCB,RADCCSTH,RADWKSH,REGDATE                             
         B     VRAD60                                                           
VRAD58   CLI   5(R2),0               IF COMMERCIAL DOES EXIST                   
         BE    VRAD58A               AND CYCLE LENGTH INPUTTED                  
         MVC   RADCCST+8(9),SPACES   EQUAL COMMERCIAL EXPIRATION                
         OI    RADCCSTH+6,X'80'                                                 
         B     ERRADINV                                                         
VRAD58A  LA    R2,RADCCSTH                                                      
         LA    R3,BLOCK                                                         
         USING PERVALD,R3                                                       
         GOTO1 PDVAL,DMCB,(R3)                                                  
         GOTO1 DATCON,DMCB,(1,PVALPSTA),(8,RADCCST)                             
         LA    R2,RADCCST                                                       
         LA    RE,RADCCST+8                                                     
         OC    RADCCST,SPACES                                                   
VRAD59   CLI   0(R2),C' '                                                       
         BE    VRAD59A                                                          
         CLI   0(R2),C'-'                                                       
         BE    VRAD59A                                                          
         CR    R2,RE                                                            
         BE    VRAD59A                                                          
         LA    R2,1(R2)                                                         
         B     VRAD59                                                           
VRAD59A  MVI   0(R2),C'-'                                                       
         MVC   1(L'SVEXP,R2),SVEXP                                              
         LA    RE,RADCCST                                                       
         LA    RF,0                                                             
VRAD59B  CLI   0(RE),C' '                                                       
         BE    VRAD59C                                                          
         CHI   RF,17                                                            
         BE    VRAD59C                                                          
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         B     VRAD59B                                                          
VRAD59C  STC   RF,RADCCSTH+5                                                    
         LA    R2,RADCCSTH                                                      
         LA    R3,BLOCK                                                         
         GOTO1 PDVAL,DMCB,(R3)                                                  
         USING PERVALD,R3                                                       
         MVC   REGDATE,PVALPSTA    SAVE PWOS DATES                              
         SPACE                                                                  
VRAD60   CLI   RADFREUH+5,0        FOREIGN                                      
         BE    VRAD80                                                           
         LA    R2,RADFREUH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UFGR                                                        
         MVI   TYPE1,UFGRRAD                                                    
         SPACE                                                                  
VRAD80   CLI   RADPENAH+5,0        PENALTY                                      
         BE    VRAD90                                                           
         LA    R2,RADPENAH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPEN                                                        
         SPACE                                                                  
VRAD90   CLI   RADOTHRH+5,0        OTHER                                        
         BE    VRAD100                                                          
         LA    R2,RADOTHRH                                                      
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,RADSPECH,TACMTYPU                             
         SPACE                                                                  
VRAD100  CLI   RADCCSTH+5,0        IF CYCLE START DATE INPUTTED                 
         BE    VRAD200                                                          
         LA    R2,RADWSPTH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST BE CHECKED                    
         SPACE 2                                                                
VRAD200  CLC   TYPECHK1(4),=C'XXXX'                                             
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,RADMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VRAD201                                                          
         GOTOR VALCYC,DMCB,RADMUSTH,RADMWKSH,MUSDATE                            
         SPACE                                                                  
VRAD201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,RADMUSH                                                       
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             MUSIC REUSE                                  
         BE    VRAD210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         LA    R2,RADM8WH          EITHER 8 WEEK OR 13 WEEK FIELD MUST          
         CLI   RADM8WH+5,0         BE CHECKED BUT NOT BOTH                      
         BE    VRAD205                                                          
         CLI   RADM13WH+5,0        SAVE 8 WEEK TYPE                             
         BNE   ERRADINV                                                         
         GOTOR VALNORM,WORK,TYPE2,('UMUS8W',RADMRUSH),                 +        
               ('UMUSNEW8',RADMCONH),('UMUSDUB8',RADMDUBH),(X'FF',1)            
         LA    R2,RADMWKSH                                                      
         MVC   RADMWKS(2),=C'8 '                                                
         OI    6(R2),X'80'                                                      
         MVI   5(R2),2                                                          
         OI    4(R2),X'08'                                                      
         MVC   RADMUST+8(9),SPACES                                              
         B     VRAD209                                                          
VRAD205  CLI   RADM13WH+5,0        SAVE 13 WEEK TYPE                            
         BE    ERRADMIS                                                         
         LA    R2,RADM13WH                                                      
         GOTOR VALNORM,WORK,TYPE2,('UMUS13W',RADMRUSH),                +        
               ('UMUSNEW',RADMCONH),('UMUSDUB',RADMDUBH),(X'FF',1)              
         LA    R2,RADMWKSH                                                      
         MVC   RADMWKS(2),=C'13'                                                
         OI    6(R2),X'80'                                                      
         MVI   5(R2),2                                                          
         OI    4(R2),X'08'                                                      
VRAD209  MVC   RADMUST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,RADMUSTH,RADMWKSH,MUSDATE                            
         SPACE                                                                  
VRAD210  LA    R2,RADFMUSH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             FIRST MUSIC                                  
         BE    VRAD220                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFMU                                                        
         GOTOR VALNORM,WORK,TYPE2,('UFMU8W',RADFM8WH),                 +        
               ('UFMU13W',RADFM13H),(X'FF',1)                                   
         LA    R2,RADMWKSH                                                      
         CLI   5(R2),0                                                          
         BE    VRAD212                                                          
         OI    RADMWKS+1,X'40'                                                  
         CLC   RADMWKS(2),=C'8 '                                                
         BNE   VRAD211                                                          
         CLI   TYPE2,UFMU8W                                                     
         BNE   ERRADINV                                                         
         B     VRAD213                                                          
VRAD211  CLC   RADMWKS(2),=C'13'                                                
         BNE   ERRADINV                                                         
         CLI   TYPE2,UFMU13W                                                    
         BNE   ERRADINV                                                         
         B     VRAD213                                                          
VRAD212  MVC   RADMWKS(2),=C'8 '                                                
         OI    6(R2),X'80'                                                      
         MVI   5(R2),1                                                          
         OI    4(R2),X'08'                                                      
         CLI   TYPE2,UFMU8W                                                     
         BE    VRAD213                                                          
         MVC   RADMWKS(2),=C'13'                                                
         MVI   5(R2),2                                                          
VRAD213  MVC   RADMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,RADMUSTH,RADMWKSH,MUSDATE                            
         SPACE                                                                  
VRAD220  LA    R2,RADNBMH          NON-BROADCAST MUSIC                          
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VRAD230                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UNBM                                                        
         GOTOR VALNORM,WORK,TYPE2,('UNBM8WK',RADNBM8H),                +        
               ('UNBM1YR',RADNBM1H),('UNBM2YR',RADNBM2H),(X'FF',1)              
         LA    R2,RADMWKSH                                                      
         CLI   5(R2),0                                                          
         BNE   ERRADINV                                                         
         MVC   RADMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,RADMUSTH,RADMWKSH,MUSDATE                            
         SPACE                                                                  
VRAD230  CLI   RADREGMH+5,0        REGIONAL MUSIC                               
         BE    VRAD240                                                          
         LA    R2,RADREGMH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,URGM                                                        
         SPACE                                                                  
VRAD240  LA    R2,RADFRMUH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             FOREIGN MUSIC                                
         BE    VRAD250                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFGM                                                        
         LA    R2,RADFM12H         EITHER 12 OR 24 MONTH FIELD MUST             
         CLI   RADFM12H+5,0        BE CHECKED BUT NOT BOTH                      
         BE    VRAD245                                                          
         CLI   RADFM24H+5,0        SAVE 12 MONTH TYPE                           
         BNE   ERRADINV                                                         
         GOTOR VALNORM,WORK,TYPE2,('UFGMEU12',RADFMUKH),               +        
               ('UFGMNE12',RADFMNOH),('UFGMWO12',RADFMWOH),(X'FF',1)            
         B     VRAD246                                                          
VRAD245  CLI   RADFM24H+5,0        SAVE 24 MONTH TYPE                           
         BE    ERRADMIS                                                         
         GOTOR VALNORM,WORK,TYPE2,('UFGMEU24',RADFMUKH),               +        
               ('UFGMNE24',RADFMNOH),('UFGMWO24',RADFMWOH),(X'FF',1)            
VRAD246  LA    R2,RADMWKSH                                                      
         CLI   5(R2),0                                                          
         BNE   ERRADINV                                                         
         MVC   RADMUST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,RADMUSTH,RADMWKS,MUSDATE                             
         SPACE                                                                  
VRAD250  LA    R2,RADMBOH          ALL MEDIA BUYOUT                             
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VRAD255                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMBO                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMBOI1Y',RADMBOIH),                +        
               ('UMBOR1Y',RADMBORH),(X'FF',1)                                   
         MVC   RADMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,RADMUSTH,RADMWKSH,MUSDATE                            
         SPACE                                                                  
VRAD255  CLI   RADMPENH+5,0        MUSIC PENALTY                                
         BE    VRAD260                                                          
         LA    R2,RADMPENH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UPEM                                                        
         SPACE                                                                  
VRAD260  CLI   RADOTHMH+5,0        MUSIC OTHER                                  
         BE    VRAD270                                                          
         LA    R2,RADOTHMH                                                      
         CLI   RADOTHRH+5,0                                                     
         BNE   ERRADINV                                                         
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,RADOMSPH,TACMTYPM                             
         SPACE                                                                  
VRAD270  CLI   RADMUSTH+5,0        IF MUSIC CYCLE START INPUTTED                
         BE    VRAD280                                                          
         LA    R2,RADMUSH                                                       
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VRAD280  LA    R2,RADCCSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VRAD300             MUSIC CYCLE START DATE MUST BE               
         CLI   RADMUSTH+5,0        ENTERED                                      
         BE    ERRADMIS                                                         
         SPACE 2                                                                
VRAD300  CLI   RADCCSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VRAD301                                                          
         CLI   USE1,UWSP           AND USE IS NOT WILDSPOT                      
         BE    VRAD301                                                          
         CLI   USE1,URNT           OR RADIO NETWORK                             
         BE    VRAD301                                                          
         CLI   USE1,UINR           OR INDUSTRIAL                                
         BE    VRAD301                                                          
         LA    R2,RADWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VRAD301  CLI   RADMUSTH+5,0        IF MUSIC CYCLE DATES PRESENT                 
         BE    VRAD302                                                          
         CLI   USE2,UFGM                                                        
         BE    VRAD302                                                          
         CLI   USE2,UNBM                                                        
         BE    VRAD302                                                          
         CLI   USE2,UMBO                                                        
         BE    VRAD302                                                          
         LA    R2,RADMWKSH         MUSIC CYCLE WEEKS MUST BE                    
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VRAD302  LA    R2,RADAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
VRAD320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',RADAPPCH),TACMTYPA APPLY COMM          
VRADX    NI    RADCCSTH+6,X'FF'-X'40'                                           
         XIT1                                                                   
         SPACE 2                                                                
*              VALRAD'S ERROR MESSAGES AND LITERALS                             
*        SPACE                                                                  
ERRADMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+8                                                              
ERRADINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE ADDENDUM SCREEN                              
         SPACE                                                                  
VALADD   NTR1  BASE=*,LABEL=*                                                   
         LA    R2,ADDCYSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VADD05                                                           
         GOTOR WKDEF,DMCB,(7,ADDWKSH)                                           
         GOTOR VALCYC,DMCB,ADDCYSTH,ADDWKSH,REGDATE                             
         SPACE                                                                  
VADD05   MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,ADDCSESH                                                      
         GOTOR MINCHK,DMCB,6                                                    
         CLI   5(R2),0             COMBINED SESSION WILDSPOT                    
         BE    VADD10                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UADC                                                        
         LA    R2,ADDCSUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         SPACE                                                                  
         CLC   COMSTATE,=C'KS'     IF COMMERCIAL STATE IS KANSAS                
         BNE   VADD3               CANNOT ALLOW 3 DAY OR 4 WEEK                 
         LA    R2,ADDC3DYH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDC4WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         B     VADD6                                                            
         SPACE                                                                  
VADD3    CLC   COMSTATE,=C'TX'     IF COMMERCIAL STATE IS TEXAS                 
         BNE   VADD5               CANNOT ALLOW 3 DAY, 1 WEEK,                  
         LA    R2,ADDC3DYH         4 WEEK, 13 WEEK OR 31 DAY                    
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDC1WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDC4WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDC31DH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         B     VADD6                                                            
         SPACE                                                                  
VADD5    CLI   COMEXIST,C'N'                                                    
         BE    VADD6                                                            
         LA    R2,ADDC31DH         ONLY KANSAS AND NON-EXISTENT                 
         CLI   5(R2),0             CAN ALLOW 31 DAYS                            
         BNE   ERADDINV                                                         
         SPACE                                                                  
VADD6    GOTOR VALNORM,WORK,TYPE1,('UADC3D',ADDC3DYH),                 +        
               ('UADC1W',ADDC1WKH),('UADC4W',ADDC4WKH),                +        
               ('UADC13W',ADDC13WH),('UADC31D',ADDC31DH),(X'FF',1)              
         LA    R2,ADDWKSH                                                       
         OC    ADDWKS,SPACES                                                    
         CLI   ADDWKSH+5,0                                                      
         BE    VADD7                                                            
         CLI   TYPE1,UADC3D                                                     
         BE    ERADDINV                                                         
         CLI   TYPE1,UADC31D                                                    
         BE    ERADDINV                                                         
         CLI   TYPE1,UADC1W                                                     
         BNE   *+14                                                             
         CLC   ADDWKS(2),=C'1 '                                                 
         BNE   ERADDINV                                                         
         CLI   TYPE1,UADC4W                                                     
         BNE   *+14                                                             
         CLC   ADDWKS(2),=C'4 '                                                 
         BNE   ERADDINV                                                         
         CLI   TYPE1,UADC13W                                                    
         BNE   *+14                                                             
         CLC   ADDWKS(2),=C'13'                                                 
         BNE   ERADDINV                                                         
VADD7    MVC   ADDCYST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,ADDCYSTH,ADDWKSH,REGDATE                             
         SPACE                                                                  
VADD10   CLI   ADDHFEEH+5,0        HOLDING FEE                                  
         BE    VADD20                                                           
         LA    R2,ADDHFEEH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UADH                                                        
         TM    AGYSTA5,TAAYCIHR                                                 
         BO    ERADHFCO                                                         
         TM    COMSTA3,TACOSSMW                                                 
         BO    ERADUMED                                                         
         CLI   COMCTYPE,CTYSEAS2                                                
         BNE   VADD20                                                           
         LA    R2,ADDHFEEH                                                      
         OC    COMAIR,COMAIR                                                    
         BZ    ERADDMFA                                                         
         SPACE                                                                  
VADD20   LA    R2,ADDWSPTH                                                      
         GOTOR MINCHK,DMCB,7                                                    
         CLI   5(R2),0             WILDSPOT                                     
         BE    VADD30                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UADW                                                        
         LA    R2,ADDWSUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         SPACE                                                                  
VADD25   CLC   COMSTATE,=C'KS'     IF COMMERCIAL STATE IS KANSAS                
         BNE   VADD26              CANNOT ALLOW 3 DAY OR 4 WEEK                 
         LA    R2,ADDW3DYH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDW4WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         B     VADD28                                                           
         SPACE                                                                  
VADD26   CLC   COMSTATE,=C'TX'     IF COMMERCIAL STATE IS TEXAS                 
         BNE   VADD27              CANNOT ALLOW 3 DAY, 1 WEEK,                  
         LA    R2,ADDW3DYH         4 WEEK, OR 31 DAY                            
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDW1WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDW4WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         LA    R2,ADDW31DH                                                      
         CLI   5(R2),0                                                          
         BNE   ERADDINV                                                         
         B     VADD28                                                           
         SPACE                                                                  
VADD27   CLI   COMEXIST,C'N'                                                    
         BE    VADD28                                                           
         LA    R2,ADDW31DH         ALL OTHER COMMERCIAL STATES                  
         CLI   5(R2),0             CANNOT ALLOW 31 DAY                          
         BNE   ERADDINV                                                         
         SPACE                                                                  
VADD28   GOTOR VALNORM,WORK,TYPE1,('UADW3D',ADDW3DYH),                 +        
               ('UADW1W',ADDW1WKH),('UADW4W',ADDW4WKH),                +        
               ('UADW13W',ADDW13WH),('UADW31D',ADDW31DH),(X'FF',1)              
         LA    R2,ADDWSUPH         UPGRADE                                      
         TM    ADDW3DYH+4,X'80'                                                 
         BO    VADD29                                                           
         TM    ADDW1WKH+4,X'80'                                                 
         BO    VADD29                                                           
         TM    ADDW4WKH+4,X'80'                                                 
         BO    VADD29                                                           
         TM    ADDW13WH+4,X'80'                                                 
         BO    VADD29                                                           
         TM    ADDW31DH+4,X'80'                                                 
         BO    VADD29                                                           
         TM    ADDWSUNH+4,X'80'                                                 
         BZ    *+8                                                              
VADD29   NI    ADDWSUPH+4,X'9F'                                                 
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VADD29A                                                          
         GOTOR VALNORM,WORK,TYPE1,('UADWU3D',ADDW3DYH),                +        
               ('UADWU1W',ADDW1WKH),('UADWU4W',ADDW4WKH),              +        
               ('UADWU13W',ADDW13WH),('UADWU31D',ADDW31DH),(X'FF',1)            
VADD29A  LA    R2,ADDWKSH                                                       
         OC    ADDWKS,SPACES                                                    
         CLI   5(R2),0                                                          
         BE    VADD29B                                                          
         CLI   ADDW3DYH+5,0                                                     
         BNE   ERADDINV                                                         
         CLI   ADDW31DH+5,0                                                     
         BNE   ERADDINV                                                         
         CLI   ADDW1WKH+5,0                                                     
         BE    *+14                                                             
         CLC   ADDWKS(2),=C'1 '                                                 
         BNE   ERADDINV                                                         
         CLI   ADDW4WKH+5,0                                                     
         BE    *+14                                                             
         CLC   ADDWKS(2),=C'4 '                                                 
         BNE   ERADDINV                                                         
         CLI   ADDW13WH+5,0                                                     
         BE    *+14                                                             
         CLC   ADDWKS(2),=C'13'                                                 
         BNE   ERADDINV                                                         
VADD29B  MVC   ADDCYST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,ADDCYSTH,ADDWKSH,REGDATE                             
         SPACE                                                                  
VADD30   LA    R2,ADDCABLH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             CABLE                                        
         BE    VADD35                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UACB                                                        
         LA    R2,ADDCSUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERADDMIS                                                         
         TM    4(R2),X'80'                                                      
         BZ    *+8                                                              
         NI    ADDCUPGH+4,X'9F'                                                 
         BAS   RE,VALASUB          SUBSCRIBERS                                  
         SPACE                                                                  
VADD35   CLI   ADDREINH+5,0        REINSTATEMENT                                
         BE    VADD40                                                           
         LA    R2,ADDREINH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UARN                                                        
         SPACE                                                                  
VADD40   CLI   ADDPENAH+5,0        PENALTY                                      
         BE    VADD50                                                           
         LA    R2,ADDPENAH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPEN                                                        
         SPACE                                                                  
VADD50   CLI   ADDOTHRH+5,0        OTHER                                        
         BE    VADD60                                                           
         LA    R2,ADDOTHRH                                                      
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,ADDOTSPH,TACMTYPU                             
         SPACE                                                                  
VADD60   CLI   ADDCYSTH+5,0        IF CYCLE START DATE INPUTTED                 
         BE    VADD200                                                          
         LA    R2,ADDCSESH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST BE CHECKED                    
         SPACE 2                                                                
VADD200  CLC   TYPECHK1(4),=C'XXXX'                                             
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,ADDMCSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VADD201                                                          
         GOTOR WKDEF,DMCB,(8,ADDMWKSH)                                          
         GOTOR VALCYC,DMCB,ADDMCSTH,ADDMWKSH,MUSDATE                            
         SPACE                                                                  
VADD201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,ADDMREUH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0              MUSIC REUSE                                 
         BE    VADD210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         CLI   ADDMLTSH+5,0                                                     
         BNE   VADD201A                                                         
         CLI   ADDMU2LH+5,0                                                     
         BE    VADD205                                                          
VADD201A LA    R2,ADDMDUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERADDMIS                                                         
         LA    R2,ADDMREUH                                                      
VADD205  GOTOR VALNORM,WORK,TYPE2,('UMUS13W',ADDMRUSH),                +        
               ('UMUSNEW',ADDMCONH),('UMUSDUB',ADDMDUBH),(X'FF',1)              
         CLI   ADDMLTSH+5,0                                                     
         BE    *+8                                                              
         MVI   TYPE2,UMUSDSH                                                    
         CLI   ADDMU2LH+5,0                                                     
         BE    VADD210                                                          
         LA    R2,ADDMU2LH                                                      
         CLI   TYPE2,UMUSDSH                                                    
         JE    ERADDINV                                                         
         MVI   TYPE2,UMUS2DS                                                    
         SPACE                                                                  
VADD210  CLI   ADDFIMUH+5,0        FIRST MUSIC                                  
         BE    VADD220                                                          
         LA    R2,ADDFIMUH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFMU                                                        
         MVI   TYPE2,UFMU13W                                                    
         SPACE                                                                  
VADD220  CLI   ADDREGMH+5,0        REGIONAL MUSIC                               
         BE    VADD230                                                          
         LA    R2,ADDREGMH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,URGM                                                        
         SPACE                                                                  
VADD230  CLI   ADDMPENH+5,0        MUSIC PENALTY                                
         BE    VADD240                                                          
         LA    R2,ADDMPENH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UPEM                                                        
         SPACE                                                                  
VADD240  CLI   ADDMUOTH+5,0        OTHER MUSIC                                  
         BE    VADD250                                                          
         LA    R2,ADDMUOTH                                                      
         CLI   ADDOTHRH+5,0                                                     
         BNE   ERADDINV                                                         
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,ADDMUOSH,TACMTYPM                             
         SPACE                                                                  
VADD250  CLI   ADDMCSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VADD260                                                          
         LA    R2,ADDMREUH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST BE CHECKED                    
         SPACE 2                                                                
VADD260  LA    R2,ADDCYSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VADD300             MUSIC CYCLE START DATE MUST BE               
         CLI   ADDMCSTH+5,0        ENTERED                                      
         BE    ERADDMIS                                                         
         SPACE 2                                                                
VADD300  CLI   ADDCYSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VADD301                                                          
         CLI   USE1,UADC           AND USE IS NOT COMBINED SESSION              
         BE    VADD301                                                          
         CLI   USE1,UADW           OR WILDSPOT                                  
         BE    VADD301                                                          
         LA    R2,ADDWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VADD301  CLI   ADDMCSTH+5,0        IF MUSIC CYCLE DATES PRESENT                 
         BE    VADD302                                                          
         LA    R2,ADDMWKSH         MUSIC CYCLE WEEKS MUST BE                    
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VADD302  LA    R2,ADDAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
         LA    R2,ADDAPPHH                                                      
         GOTOR APPHLD                                                           
         SPACE                                                                  
VADD320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',ADDAPPCH),TACMTYPA  APPLY COMM         
VADDX    XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE VALIDATES SUBSCRIBER FIELD                               
         SPACE 1                                                                
VALASUB  NTR1                                                                   
         LA    RE,VASUBTAB                                                      
VASUB10  CLI   0(RE),X'FF'         IF SUBSCRIBER FIELD INPUT                    
         BE    ERADDINV            NOT IN TABLE, RETURN ERROR                   
         ZIC   R1,5(R2)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   8(0,R2),0(RE)                                                    
         BE    VASUB20                                                          
         LA    RE,10(RE)                                                        
         B     VASUB10                                                          
         SPACE 1                                                                
VASUB20  MVC   TYPE1,9(RE)         SAVE USE TYPE AND SET USE VARIABLES          
         GOTO1 USEVAL,DMCB,(X'80',USE1)                                         
         SPACE 1                                                                
         TM    4(R2),X'80'         IF SUBSCRIBER FIELD WAS JUST INPUT           
         BZ    VASUB22             UNVALIDATE THE UPGRADE FIELD                 
         NI    TELLCUPH+4,X'DF'                                                 
         SPACE 1                                                                
VASUB22  LA    R2,ADDCUPGH         IF UPGRADE FIELD IS EMPTY                    
         CLI   5(R2),0             UNVALIDATE THE UPGRADE FIELD                 
         BNE   VASUB25                                                          
         NI    4(R2),X'DF'                                                      
         B     VASUBX                                                           
         SPACE 1                                                                
VASUB25  TM    4(R2),X'20'         IF UPGRADE FIELD ALREADY                     
         BZ    *+14                VALIDATED, MOVE LAST VALIDATED               
         MVC   TYPE1,SVUPTYP       TYPE INTO TYPE AND EXIT                      
         B     VASUBX                                                           
         SPACE 1                                                                
         GOTOR VALUPG              MAKE SURE UPGRADE FIELD INPUT                
         CLI   UPGR,C'N'           IS Y, N OR A                                 
         BE    VASUBX              IF N THEN EXIT                               
         SPACE 1                                                                
         CLI   8(R2),C'Y'          SET DUMMY FROM TYPE FOR UPGRADES             
         BNE   *+8                 THAT AREN'T REAL UPGRADES AND                
         MVI   TGUPFRTY,UACB50     REQUIRE PF KEY VALIDATION                    
         GOTO1 UPGRVAL,DMCB,(X'80',TGUSCDE),TGUPFRTY,TGUSCDE,TYPE1              
         BE    *+12                                                             
         BAS   RE,ANUPGRR                                                       
         B     VASUB50                                                          
         SPACE 1                                                                
         MVC   AIO,AIO2                                                         
         LA    R3,KEY              BUILD PARTIAL KEY FOR RECORD                 
         USING TLUHD,R3                                                         
         XC    TLUHKEY,TLUHKEY                                                  
         MVI   TLUHCD,TLUHCDQ      RECORD CODE                                  
         MVC   TLUHCOM,TGCOM       INTERNAL COMMERCIAL NUMBER                   
         MVC   TLUHUSE,TGUSCDE     USE CODE                                     
         GOTO1 HIGH                GET DIRECTORY RECORD                         
         B     VASUB40                                                          
         SPACE 1                                                                
VASUB30  GOTO1 SEQ                 GET NEXT DIRECTORY RECORD                    
VASUB40  CLC   TLUHKEY(TLUHINV-TLUHD),KEYSAVE  DID WE FIND REC FOR USE          
         BE    *+12                                                             
         BAS   RE,ANOPREV                                                       
         B     VASUB50                                                          
         GOTO1 GETREC              GET THE RECORD                               
         SPACE 1                                                                
         USING TAUHD,R4                                                         
         MVI   ELCODE,TAUHELQ      GET USAGE HISTORY ELEMENT                    
         L     R4,AIO                                                           
         BRAS  RE,GETEL                                                         
         BNE   VASUB30                                                          
         SPACE                                                                  
         CLC   REGDATE,TAUHSTRT    IF CYCLE STARTS ARE THE SAME                 
         BNE   VASUB30                                                          
         MVC   TGUPFRTY,TAUHTYPE   SET "FROM" TYPE FOR UPGRVAL                  
         GOTO1 UPGRVAL,DMCB,(X'80',TGUSCDE),TGUPFRTY,TGUSCDE,TGUPTOTY           
         BE    *+8                                                              
         BAS   RE,ANUPGRR                                                       
         CLC   TAUHTYPE,TGUPTOTY   MUST BE UPGRADE FROM THAT PAYMENT            
         BL    *+8                 OR PFKEY APPROVAL GIVEN                      
         BAS   RE,ANUPGRR                                                       
         SPACE 1                                                                
VASUB50  MVC   TYPE1,TGUPTYP       SAVE USE TYPE                                
         MVC   SVUPTYP,TYPE1                                                    
         SPACE 1                                                                
VASUBX   MVC   KEY,ADVKEY          RE-READ THE ADVICE                           
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
         MVC   AIO,AIO1                                                         
         MVI   ELCODE,TAUPELQ      REMOVE OLD UPGRADE ELEMENT                   
         GOTO1 REMELEM                                                          
         XC    ELEMENT,ELEMENT     AND ADD NEW ONE                              
         USING TAUPD,R5                                                         
         LA    R5,ELEMENT                                                       
         MVI   TAUPEL,TAUPELQ                                                   
         MVI   TAUPLEN,TAUPLNQ                                                  
         MVC   TAUPILCM,TAUHTYPE                                                
         GOTO1 ADDELEM                                                          
         SPACE 1                                                                
         NI    STATUS,X'FF'-WAITUPFK TURN OFF NEED PF KEY APPROVAL              
         XC    UPGFLD,UPGFLD                                                    
         OI    4(R2),X'20'           SET UPGRADE FIELD VALIDATED                
         SPACE 1                                                                
         CLI   SELECT,C'Y'         IF ADVICE WAS SELECTED FROM LIST             
         BNE   VASUBXX                                                          
         CLI   THISLSEL,C'C'       FOR A CHANGE                                 
         BNE   VASUBXX                                                          
         MVI   PFAID,14            SET TO FLIP SCREEN                           
         SPACE 1                                                                
         TM    STATUS,WAITLPFK     IF WAITING FOR VER/LFT APPROVAL              
         BZ    VASUBXXX                                                         
         MVI   PFAID,20            KEEP PF KEY SET                              
         B     VASUBXXX                                                         
         SPACE 1                                                                
VASUBXX  CLI   PFAID,14                                                         
         BE    VASUBXXX                                                         
         CLI   STATUS,0                                                         
         BNE   VASUBXXX                                                         
         MVI   PFAID,0                                                          
VASUBXXX B     VADDX                                                            
         DROP  R4,R5                                                            
         SPACE 2                                                                
ANUPGRR  NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    ANUPGG                                                           
         CLI   PFAID,20                                                         
         BNE   ANUPGG                                                           
         B     VASUBXXX                                                         
         SPACE 2                                                                
ANOPREV  NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    ANOPREVV                                                         
         CLI   PFAID,20                                                         
         BNE   ANOPREVV                                                         
         B     VASUBXXX                                                         
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR VALUPG                           
VASUBTAB DC    CL9'50K      ',AL1(UACB50)                                       
         DC    CL9'100K     ',AL1(UACB100)                                      
         DC    CL9'150K     ',AL1(UACB150)                                      
         DC    CL9'200K     ',AL1(UACB200)                                      
         DC    CL9'250K     ',AL1(UACB250)                                      
         DC    CL9'500K     ',AL1(UACB500)                                      
         DC    CL9'750K     ',AL1(UACB750)                                      
         DC    CL9'1MIL     ',AL1(UACB1M)                                       
         DC    CL9'1MIL+50K ',AL1(UACBM50)                                      
         DC    CL9'1MIL+100K',AL1(UACBM100)                                     
         DC    CL9'1MIL+150K',AL1(UACBM150)                                     
         DC    CL9'1MIL+200K',AL1(UACBM200)                                     
         DC    CL9'1MIL+250K',AL1(UACBM250)                                     
         DC    CL9'1MIL+500K',AL1(UACBM500)                                     
         DC    CL9'1MIL+750K',AL1(UACBM750)                                     
         DC    CL9'1MIL+1MIL',AL1(UACBM1M)                                      
         DC    X'FF'                                                            
         SPACE 2                                                                
ANOPREVV MVI   MYMSGNO1,91                                                      
         B     *+8                                                              
ANUPGG   MVI   MYMSGNO1,92         THIS IS NOT AN UPGRADE                       
         OI    GENSTAT2,USGETTXT                                                
         ST    R2,UPGFLD                                                        
         OI    STATUS,WAITUPFK                                                  
         B     ADDEND                                                           
*              VALADD'S ERROR MESSAGES AND LITERALS                             
         SPACE                                                                  
ERADUMED MVI   ERROR,ERUSEMED      INVALID USE FOR MEDIA                        
         B     ADDEND                                                           
ERADHFCO MVC   MYMSGNO,=Y(ERHFCRNO)                                             
         B     *+10                                                             
ERADDMFA MVC   MYMSGNO,=Y(ERMSSFAD)                                             
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
         B     ADDEND                                                           
ERADDMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+8                                                              
ERADDINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
ADDEND   GOTO1 EXIT,DMCB,0                                                      
         SPACE                                                                  
         LTORG                                                                  
         EJECT                                                                  
*              VALIDATE SPANISH SCREEN                                          
         SPACE                                                                  
VALSPA   NTR1  BASE=*,LABEL=*                                                   
         LA    R2,SPACCSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VSPA05                                                           
         GOTOR WKDEF,DMCB,(9,TELWKSH)                                           
         GOTOR VALCYC,DMCB,SPACCSTH,SPAWKSH,REGDATE                             
         SPACE                                                                  
VSPA05   MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         CLI   SPAHOLDH+5,0        HOLDING FEE                                  
         BE    VSPA10                                                           
         LA    R2,SPAHOLDH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USHL                                                        
         TM    AGYSTA5,TAAYCIHR                                                 
         BO    ERSPHFCO                                                         
         TM    COMSTA3,TACOSSMW                                                 
         BO    ERSPUMED                                                         
         CLI   COMCTYPE,CTYSEAS2                                                
         BNE   VSPA10                                                           
         LA    R2,SPAHOLDH                                                      
         OC    COMAIR,COMAIR                                                    
         BZ    ERSPAMFA                                                         
         SPACE                                                                  
VSPA10   CLI   SPANETWH+5,0        NETWORK                                      
         BE    VSPA20                                                           
         LA    R2,SPANETWH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USNT                                                        
         SPACE                                                                  
VSPA20   LA    R2,SPAWILDH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             WILDSPOT                                     
         BE    VSPA30                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USWS                                                        
         LA    R2,SPAWILUH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,USWSREG                                                    
         TM    SPAWILUH+4,X'80'                                                 
         BZ    *+8                                                              
         NI    SPAWUPGH+4,X'9F'                                                 
         LA    R2,SPAWUPGH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VSPA30                                                           
         MVI   TYPE1,USWSUPG                                                    
         SPACE                                                                  
VSPA30   LA    R2,SPANWWSH                                                      
         GOTOR MINCHK,DMCB,4                                                    
         CLI   5(R2),0             NETWORK WILDSPOT COMBINED                    
         BE    VSPA40                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USNW                                                        
         LA    R2,SPACOMUH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,USNWREG                                                    
         TM    SPACOMUH+4,X'80'                                                 
         BO    VSPA32                                                           
         TM    SPACUPGH+4,X'80'                                                 
         BO    VSPA32                                                           
         TM    SPACSWSH+4,X'80'                                                 
         BO    VSPA32                                                           
         TM    SPACCOMH+4,X'80'                                                 
         BZ    *+8                                                              
VSPA32   NI    SPACUPGH+4,X'9F'                                                 
         LA    R2,SPACUPGH         UPGRADE FROM SNT                             
         CLI   5(R2),0                                                          
         BE    VSPA33                                                           
         MVI   USE1,USNT                                                        
         GOTOR VALUPG                                                           
         MVI   USE1,USNW                                                        
         CLI   UPGR,C'Y'                                                        
         BNE   VSPA33                                                           
         MVI   TYPE1,USNWUN                                                     
VSPA33   LA    R2,SPACSWSH         UPGRADE FROM SWS                             
         CLI   5(R2),0                                                          
         BE    VSPA35                                                           
         CLI   TYPE1,USNWREG                                                    
         BNE   ERSPAINV                                                         
         MVI   USE1,USWS                                                        
         GOTOR VALUPG                                                           
         MVI   USE1,USNW                                                        
         CLI   UPGR,C'Y'                                                        
         BNE   VSPA35                                                           
         MVI   TYPE1,USNWUW                                                     
VSPA35   LA    R2,SPACCOMH         UPGRADE COMBINED                             
         CLI   5(R2),0                                                          
         BE    VSPA40                                                           
         CLI   TYPE1,USNWREG                                                    
         BNE   ERSPAINV                                                         
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VSPA40                                                           
         MVI   TYPE1,USNWUC                                                     
         SPACE                                                                  
VSPA40   LA    R2,SPACABLH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             CABLE                                        
         BE    VSPA50                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USCB                                                        
         LA    R2,SPACABUH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,USCBREG                                                    
         TM    SPACABUH+4,X'80'                                                 
         BZ    *+8                                                              
         NI    SPACAUPH+4,X'9F'                                                 
         LA    R2,SPACAUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VSPA50                                                           
         MVI   TYPE1,USCBUPG                                                    
         SPACE                                                                  
VSPA50   LA    R2,SPAINDUH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             INDUSTRIAL                                   
         BE    VSPA60                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USIN                                                        
         LA    R2,SPADAYSH                                                      
         CLI   5(R2),0                                                          
         BE    VSPA55                                                           
         MVI   TYPE1,UINR30D                                                    
         CLI   SPAUNLIH+5,0                                                     
         BNE   ERSPAINV                                                         
         B     VSPA56                                                           
VSPA55   CLI   SPAUNLIH+5,0                                                     
         BE    ERSPAMIS                                                         
VSPA56   LA    R2,SPAWKSH                                                       
         CLI   TYPE1,UINR30D         ANY INPUT IN CYCLE LENGTH                  
         BNE   VSPA57                IS INVALID FOR TYPE 30 DAYS                
         CLI   5(R2),0                                                          
         BNE   ERSPAINV                                                         
         MVC   SPACCST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,SPACCSTH,SPAWKSH,REGDATE                             
         B     VSPA60                                                           
VSPA57   LA    R2,SPAWKSH            IF UNLIMITED TYPE                          
         CLI   COMEXIST,C'N'         AND COMMERCIAL DOES NOT EXIST              
         BNE   VSPA58                                                           
         CLI   5(R2),0               CYCLE WEEKS MUST BE INPUTTED               
         BE    ERSPAMIS                                                         
         GOTOR VALCYC,DMCB,SPACCSTH,SPAWKSH,REGDATE                             
         B     VSPA60                                                           
VSPA58   CLI   5(R2),0               IF COMMERCIAL DOES EXIST                   
         BE    VSPA58A               AND CYCLE LENGTH INPUTTED                  
         MVC   TELCYST+8(9),SPACES   EQUAL COMMERCIAL EXPIRATION                
         OI    TELCYSTH+6,X'80'                                                 
         B     ERSPAINV                                                         
VSPA58A  LA    R2,SPACCST                                                       
         LA    RE,SPACCST+8                                                     
         OC    SPACCST,SPACES                                                   
VSPA59   CLI   0(R2),C' '                                                       
         BE    VSPA59A                                                          
         CLI   0(R2),C'-'                                                       
         BE    VSPA59A                                                          
         CR    R2,RE                                                            
         BE    VSPA59A                                                          
         LA    R2,1(R2)                                                         
         B     VSPA59                                                           
VSPA59A  MVI   0(R2),C'-'                                                       
         MVC   1(L'SVEXP,R2),SVEXP                                              
         LA    RE,SPACCST                                                       
         LA    RF,0                                                             
         OC    SPACCST,SPACES                                                   
VSPA59B  CLI   0(RE),C' '                                                       
         BE    VSPA59C                                                          
         CHI   RF,17                                                            
         BE    VSPA59C                                                          
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         B     VSPA59B                                                          
VSPA59C  STC   RF,SPACCSTH+5                                                    
         LA    R2,SPACCSTH                                                      
         LA    R3,BLOCK                                                         
         GOTO1 PDVAL,DMCB,(R3)                                                  
         USING PERVALD,R3                                                       
         MVC   REGDATE,PVALPSTA    SAVE PWOS DATES                              
         SPACE                                                                  
VSPA60   LA    R2,SPAFORUH                                                      
         GOTOR MINCHK,DMCB,3                                                    
         CLI   5(R2),0             FOREIGN                                      
         BE    VSPA64                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USFR                                                        
         GOTOR VALNORM,WORK,TYPE1,('USFRA',SPAFORAH),                  +        
               ('USFRB',SPAFORBH),('USFRC',SPAFORCH),(X'FF',1)                  
         SPACE                                                                  
VSPA64   CLI   SPAREINH+5,0        REINSTATEMENT                                
         BE    VSPA65                                                           
         LA    R2,SPAREINH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USRE                                                        
         SPACE                                                                  
VSPA65   CLI   SPACFEEH+5,0        CANCEL FEE                                   
         BE    VSPA70                                                           
         LA    R2,SPACFEEH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USCN                                                        
         SPACE                                                                  
VSPA70   CLI   SPAPENAH+5,0        PENALTY                                      
         BE    VSPA100                                                          
         LA    R2,SPAPENAH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USPN                                                        
         SPACE                                                                  
VSPA100  CLI   SPAOTHRH+5,0        OTHER                                        
         BE    VSPA110                                                          
         LA    R2,SPAOTHRH                                                      
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,SPASPECH,TACMTYPU                             
         SPACE                                                                  
VSPA110  CLI   SPACCSTH+5,0                                                     
         BE    VSPA200                                                          
         LA    R2,SPAHOLDH         IF CYCLE START DATE INPUTTED                 
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE                                                                  
         LA    R2,SPAFOSFH         VALIDATE NUMBER OF SESSION FEES              
         BAS   RE,VALTANUD                                                      
         SPACE 2                                                                
VSPA200  CLC   TYPECHK1(4),=C'XXXX'                                             
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,SPAMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VSPA201                                                          
         GOTOR WKDEF,DMCB,(10,SPAMWKSH)                                         
         GOTOR VALCYC,DMCB,SPAMUSTH,SPAMWKSH,MUSDATE                            
         SPACE                                                                  
VSPA201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,SPAMUSEH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             MUSIC                                        
         BE    VSPA210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         CLI   SPAMLTSH+5,0                                                     
         BNE   VSPA201A                                                         
         CLI   SPAMU2LH+5,0                                                     
         BE    VSPA202                                                          
VSPA201A LA    R2,SPAMDUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERSPAMIS                                                         
         LA    R2,SPAMUSEH                                                      
VSPA202  GOTOR VALNORM,WORK,TYPE2,('UMUS13W',SPAMRUSH),                +        
               ('UMUSNEW',SPAMCONH),('UMUSDUB',SPAMDUBH),(X'FF',1)              
         CLI   SPAMLTSH+5,0                                                     
         BE    *+8                 IF LONG TO SHORT CHECKED ...                 
         MVI   TYPE2,UMUSDSH       DUB MUST BE CHECKED TOO                      
         CLI   SPAMU2LH+5,0                                                     
         BE    VSPA210                                                          
         LA    R2,SPAMU2LH                                                      
         CLI   TYPE2,UMUSDSH                                                    
         JE    ERSPAINV                                                         
         MVI   TYPE2,UMUS2DS                                                    
         SPACE                                                                  
VSPA210  CLI   SPAFRMUH+5,0        FIRST MUSIC                                  
         BE    VSPA220                                                          
         LA    R2,SPAFRMUH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFMU                                                        
         MVI   TYPE2,UFMU13W                                                    
         SPACE                                                                  
VSPA220  CLI   SPAFRGNH+5,0        FOREIGN MUSIC                                
         BE    VSPA230                                                          
         LA    R2,SPAFRGNH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFGM                                                        
         SPACE                                                                  
VSPA230  CLI   SPAMPENH+5,0        MUSIC PENALTY                                
         BE    VSPA235                                                          
         LA    R2,SPAMPENH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UPEM                                                        
         SPACE                                                                  
VSPA235  LA    R2,SPAMBOH          ALL MEDIA BUYOUT                             
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VSPA240                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMBO                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMBOI1Y',SPAMBOIH),                +        
               ('UMBOR1Y',SPAMBORH),(X'FF',1)                                   
         MVC   SPAMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,SPAMUSTH,SPAMWKSH,MUSDATE                            
         SPACE                                                                  
VSPA240  CLI   SPAMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VSPA250                                                          
         LA    R2,SPAMUSEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VSPA250  LA    R2,SPACCSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VSPA300             MUSIC CYCLE START DATE MUST BE               
         CLI   SPAMUSTH+5,0        ENTERED                                      
         BE    ERSPAMIS                                                         
         SPACE 2                                                                
VSPA300  CLI   SPACCSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VSPA301                                                          
         CLI   USE1,USIN           AND USE IS NOT INDUSTRIAL                    
         BE    VSPA301                                                          
         CLI   USE1,USIR           OR INTERNET                                  
         BE    VSPA301                                                          
         LA    R2,SPAWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VSPA301  CLI   SPAMUSTH+5,0        IF MUSIC CYCLE DATES PRESENT                 
         BE    VSPA302                                                          
         CLI   USE2,UMBO                                                        
         BE    VSPA302                                                          
         LA    R2,SPAMWKSH         MUSIC CYCLE WEEKS MUST BE                    
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VSPA302  LA    R2,SPAAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
         LA    R2,SPAAPPHH                                                      
         GOTOR APPHLD                                                           
         SPACE                                                                  
VSPA320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',SPAAPPCH),TACMTYPA  APPLY COM          
VSPAX    XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE CALLED TO DISPLAY SPANISH SCREEN'S NUMBER                
*              OF SESSION FEES FIELD                                            
         SPACE                                                                  
* ON ENTRY ... R2=A(NUMBER OF SESSION FEE'S FIELD HEADER)             *         
*              AIO = A(ADVICE RECORD)                                 *         
         SPACE                                                                  
VALTANUD NTR1                                                                   
         MVI   ELCODE,TANUELQ       DELETE ALL EXISTING TANU ELEMENTS           
         GOTO1 DELL,DMCB,(1,=AL1(TANUTFEE)) (TYPE TANUFTEE)                     
         SPACE                                                                  
VTANU10  CLI   5(R2),0             NO INPUT ... EXIT                            
         BE    VTANUX                                                           
         TM    4(R2),X'08'         INPUT MUST BE NUMERIC                        
         BZ    ERSPAINV                                                         
         SPACE                                                                  
         USING TANUD,R4                                                         
         XC    ELEMENT,ELEMENT     BUILD NEW TANU ELEMENT AND                   
         LA    R4,ELEMENT          ADD TO RECORD                                
         MVI   TANUEL,TANUELQ                                                   
         MVI   TANULEN,5                                                        
         MVI   TANUTYPE,TANUTFEE                                                
         MVC   TANUMBER(2),8(R2)                                                
         GOTO1 ADDELEM                                                          
         DROP  R4                                                               
VTANUX   XIT1                                                                   
         SPACE 2                                                                
*              VALSPA'S ERROR MESSAGES AND LITERALS                             
         SPACE                                                                  
ERSPUMED MVI   ERROR,ERUSEMED      INVALID USE FOR MEDIA                        
         B     SPAEND                                                           
ERSPHFCO MVC   MYMSGNO,=Y(ERHFCRNO)                                             
         B     *+10                                                             
ERSPAMFA MVC   MYMSGNO,=Y(ERMSSFAD)                                             
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
         B     SPAEND                                                           
ERSPAMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+8                                                              
ERSPAINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
SPAEND   GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE CANADIAN SCREEN                              
         SPACE                                                                  
VALCAN   NTR1  BASE=*,LABEL=*                                                   
         LA    R2,CANCCSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VCAN05                                                           
         GOTOR WKDEF,DMCB,(11,CANWKSH)                                          
         GOTOR VALCYC,DMCB,CANCCSTH,CANWKSH,REGDATE                             
         SPACE                                                                  
VCAN05   MVI   CHKSTAT,0           NO REGULAR USES CHECKED OFF YET              
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,CANAUTNH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             ACTRA/UDA TV NETWORK                         
         BE    VCAN10                                                           
         CLI   TGMENAME,C'T'                                                    
         BNE   ERINVCAN                                                         
         MVI   USE1,UNET                                                        
         BRAS  RE,OK2CHK                                                        
         LA    R2,CANACUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,UNETREG                                                    
         TM    CANACUNH+4,X'80'                                                 
         BZ    *+8                                                              
         NI    CANACUPH+4,X'9F'                                                 
         LA    R2,CANACUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCAN10                                                           
         MVI   TYPE1,UNETUPG                                                    
         LA    R2,CANAUTNH                                                      
         SPACE                                                                  
VCAN10   LA    R2,CANWSPTH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             WILDSPOT                                     
         BE    VCAN20                                                           
         CLI   TGMENAME,C'T'                                                    
         BNE   ERINVCAN                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UWSC                                                        
         LA    R2,CANWSUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,UWSCREG                                                    
         TM    CANWSUNH+4,X'80'                                                 
         BZ    *+8                                                              
         NI    CANWSUPH+4,X'9F'                                                 
         LA    R2,CANWSUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCAN20                                                           
         MVI   TYPE1,UWSCUPG                                                    
         SPACE                                                                  
VCAN20   LA    R2,CANWCOMH                                                      
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0             WILDSPOT COMBINED                            
         BE    VCAN30                                                           
         CLI   TGMENAME,C'T'                                                    
         BNE   ERINVCAN                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UWSM                                                        
         LA    R2,CANWCUNH         UNITS                                        
         GOTOR VALUNIT                                                          
         MVI   TYPE1,UWSMREG                                                    
         TM    CANWCUNH+4,X'80'                                                 
         BZ    *+8                                                              
         NI    CANWCUPH+4,X'9F'                                                 
         LA    R2,CANWCUPH         UPGRADE                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCAN30                                                           
         MVI   TYPE1,UWSMUPG                                                    
         SPACE                                                                  
VCAN30   CLI   CANPRIMH+5,0        PRIME/NON-PRIME TIME                         
         BE    VCAN40                                                           
         LA    R2,CANPRIMH                                                      
         CLI   TGMENAME,C'T'                                                    
         BNE   ERINVCAN                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPNP                                                        
         SPACE                                                                  
VCAN40   CLI   CANACRRH+5,0        ACTRA RADIO REUSE                            
         BE    VCAN50                                                           
         LA    R2,CANACRRH                                                      
         CLI   TGMENAME,C'R'                                                    
         BNE   ERINVCAN                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,URAD                                                        
         SPACE                                                                  
VCAN50   CLI   CANACDFH+5,0        ACTRA DORMANCY FEE                           
         BE    VCAN60                                                           
         LA    R2,CANACDFH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UDOR                                                        
         LA    R2,CANWKSH          CYCLE WEEKS INPUT NOT ALLOWED                
         CLI   5(R2),0                                                          
         BE    VCAN51                                                           
         CLC   8(2,R2),=C'26'                                                   
         BE    VCAN51                                                           
         MVC   CANCCST+8(9),SPACES                                              
         OI    CANCCSTH+6,X'80'                                                 
         B     ERINVCAN                                                         
VCAN51   NI    CANCCSTH+4,X'FF'-X'20'                                           
         NI    CANCCSTH+4,X'FF'-X'20'                                           
         GOTOR VALCYC,DMCB,CANCCSTH,CANWKSH,REGDATE                             
         SPACE                                                                  
VCAN60   CLI   CANUDLMH+5,0        UDA LOCAL MONTREAL                           
         BE    VCAN70                                                           
         LA    R2,CANUDLMH                                                      
         CLI   TGMENAME,C'T'                                                    
         BNE   ERINVCAN                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UULM                                                        
         SPACE                                                                  
VCAN70   CLI   CANUDPUH+5,0        UDA PROGRAM                                  
         BE    VCAN80                                                           
         LA    R2,CANUDPUH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPRG                                                        
         SPACE                                                                  
VCAN80   CLI   CANUDPFH+5,0        UDA PROLONGATION FEE                         
         BE    VCAN90                                                           
         LA    R2,CANUDPFH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPRL                                                        
         SPACE                                                                  
VCAN90   CLI   CANPENAH+5,0        PENALTY                                      
         BE    VCAN100                                                          
         LA    R2,CANPENAH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UCPN                                                        
         SPACE                                                                  
VCAN100  CLI   CANOTHRH+5,0        OTHER                                        
         BE    VCAN110                                                          
         LA    R2,CANOTHRH                                                      
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,CANSPECH,TACMTYPU                             
         SPACE                                                                  
VCAN110  CLI   CANCCSTH+5,0                                                     
         BE    VCAN200                                                          
         LA    R2,CANAUTNH         IF CYCLE START DATE INPUTTED                 
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VCAN200  CLC   TYPECHK1(4),=C'XXXX'                                             
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,CANMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VCAN201                                                          
         GOTOR WKDEF,DMCB,(12,CANMWKSH)                                         
         GOTOR VALCYC,DMCB,CANMUSTH,CANMWKSH,MUSDATE                            
         SPACE 1                                                                
VCAN201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE 1                                                                
         LA    R2,CANMUSEH                                                      
         GOTOR MINCHK,DMCB,6                                                    
         CLI   5(R2),0             MUSIC                                        
         BE    VCAN210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         CLI   CANMLTSH+5,0                                                     
         BE    VCAN202                                                          
         LA    R2,CANMDUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERMISCAN                                                         
VCAN202  LA    R2,CANM8WH          EITHER 8 WEEK OR 13 WEEK FIELD MUST          
         CLI   CANM8WH+5,0         BE CHECKED BUT NOT BOTH                      
         BE    VCAN205                                                          
         CLI   CANM13WH+5,0        SAVE 8 WEEK TYPE                             
         BNE   ERINVCAN                                                         
         CLI   TGMENAME,C'R'                                                    
         BNE   ERINVCAN                                                         
         GOTOR VALNORM,WORK,TYPE2,('UMUS8W',CANMRUSH),                 +        
               ('UMUSNEW8',CANMCONH),('UMUSDUB8',CANMDUBH),(X'FF',1)            
         LA    R2,CANMWKSH                                                      
         CLI   5(R2),0                                                          
         BE    *+14                                                             
         CLC   CANMWKS(2),=C'8 '                                                
         BNE   ERINVCAN                                                         
         MVC   CANMWKS(2),=C'8 '                                                
         OI    6(R2),X'80'                                                      
         MVI   5(R2),2                                                          
         OI    4(R2),X'08'                                                      
         MVC   CANMUST+8(9),SPACES                                              
         B     VCAN206                                                          
VCAN205  CLI   CANM13WH+5,0        SAVE 13 WEEK TYPE                            
         BE    ERMISCAN                                                         
         LA    R2,CANM13WH                                                      
         GOTOR VALNORM,WORK,TYPE2,('UMUS13W',CANMRUSH),                +        
               ('UMUSNEW',CANMCONH),('UMUSDUB',CANMDUBH),(X'FF',1)              
         LA    R2,CANMWKSH                                                      
         CLI   5(R2),0                                                          
         BE    *+14                                                             
         CLC   CANMWKS(2),=C'13'                                                
         BNE   ERINVCAN                                                         
         MVC   CANMWKS(2),=C'13'                                                
         OI    6(R2),X'80'                                                      
         MVI   5(R2),3                                                          
         OI    4(R2),X'08'                                                      
         MVC   CANMUST+8(9),SPACES                                              
VCAN206  CLI   CANMLTSH+5,0                                                     
         BE    VCAN209            IF LONG TO SHORT CHECKED ...                  
         CLI   TYPE2,UMUSDUB8     DUB MUST BE CHECKED TOO                       
         BNE   VCAN208                                                          
         MVI   TYPE2,UMUSDSH8                                                   
         B     VCAN209                                                          
VCAN208  MVI   TYPE2,UMUSDSH                                                    
VCAN209  MVC   CANMUST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,CANMUSTH,CANMWKSH,MUSDATE                            
         SPACE                                                                  
VCAN210  CLI   CANMREUH+5,0        MUSIC REUSE (CANADIAN)                       
         BE    VCAN220                                                          
         LA    R2,CANMREUH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UCMR                                                        
         SPACE                                                                  
VCAN220  CLI   CANMPENH+5,0        MUSIC PENALTY                                
         BE    VCAN230                                                          
         LA    R2,CANMPENH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UPEM                                                        
         SPACE                                                                  
VCAN230  CLI   CANOTHMH+5,0        OTHER MUSIC                                  
         BE    VCAN240                                                          
         LA    R2,CANOTHMH                                                      
         CLI   CANOTHRH+5,0                                                     
         BNE   ERINVCAN                                                         
         BRAS  RE,OK2CHK                                                        
         GOTO1 NAMIN,DMCB,TACMELQ,CANOMSPH,TACMTYPM                             
         SPACE                                                                  
VCAN240  CLI   CANMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VCAN250                                                          
         LA    R2,CANMUSEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VCAN250  LA    R2,CANCCSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VCAN300             MUSIC CYCLE START DATE MUST BE               
         CLI   CANMUSTH+5,0        ENTERED                                      
         BE    ERMISCAN                                                         
         SPACE 2                                                                
VCAN300  CLI   CANCCSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VCAN301                                                          
         CLI   CANACDFH+5,0                                                     
         BNE   VCAN301                                                          
         LA    R2,CANWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VCAN301  CLI   CANMUSTH+5,0        IF MUSIC CYCLE DATES PRESENT                 
         BE    VCAN302                                                          
         LA    R2,CANMWKSH         MUSIC CYCLE WEEKS MUST BE                    
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VCAN302  LA    R2,CANAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
         LA    R2,CANAPPHH                                                      
         GOTOR APPHLD                                                           
         SPACE                                                                  
VCAN320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',CANAPPCH),TACMTYPA  APPLY COMM         
VCANX    XIT1                                                                   
         SPACE 2                                                                
*              VALCAN'S ERROR MESSAGES AND LITERALS                             
         SPACE                                                                  
ERMISCAN MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+8                                                              
ERINVCAN MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              VALIDATE CLASS A SCREEN                                          
         SPACE                                                                  
VALCLA   NTR1  BASE=*,LABEL=*                                                   
         LA    R2,CLACCSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VCLA05                                                           
         GOTOR WKDEF,DMCB,(5,CLAWKSH)                                           
         GOTOR VALCYC,DMCB,CLACCSTH,CLAWKSH,REGDATE                             
         SPACE                                                                  
VCLA05   MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         CLI   CLACLAOH+5,0        CLASS A                                      
         BE    VCLA10                                                           
         LA    R2,CLACLAOH                                                      
         MVI   USE1,UCLA                                                        
         BRAS  RE,OK2CHK                                                        
         MVI   TYPE1,UCLAREG                                                    
         SPACE                                                                  
VCLA10   CLI   CLAABCOH+5,0        LATE NIGHT ABC                               
         BE    VCLA20                                                           
         LA    R2,CLAABCOH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULNA                                                        
         SPACE                                                                  
VCLA20   CLI   CLANBCOH+5,0        LATE NIGHT NBC                               
         BE    VCLA30                                                           
         LA    R2,CLANBCOH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULNN                                                        
         SPACE                                                                  
VCLA30   CLI   CLACBSOH+5,0        LATE NIGHT CBS                               
         BE    VCLA33                                                           
         LA    R2,CLACBSOH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULNC                                                        
         SPACE                                                                  
VCLA33   CLI   CLAFOXOH+5,0        LATE NIGHT FOX                               
         BE    VCLA35                                                           
         LA    R2,CLAFOXOH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULNF                                                        
         SPACE                                                                  
VCLA35   CLI   CLAPAXOH+5,0        PAX                                          
         BE    VCLA36                                                           
         LA    R2,CLAPAXOH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UPAX                                                        
         SPACE                                                                  
VCLA36   LA    R2,CLAITNH          ITN                                          
         GOTOR MINCHK,DMCB,3                                                    
         CLI   5(R2),0                                                          
         BE    VCLA40                                                           
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UITN                                                        
         LA    R2,CLAAUTOH         IF ITN AUTOMATIC OPTION CHECKED              
         CLI   5(R2),0                                                          
         BE    VCLA36A                                                          
         LA    R2,CLAEUSEH         ENDING USE                                   
         CLI   5(R2),0                                                          
         BNE   ERCLAINV                                                         
         LA    R2,CLANUSEH         AND NUMBER OF USES CANNOT BE                 
         CLI   5(R2),0             CHECKED                                      
         BNE   ERCLAINV                                                         
         B     VCLA40                                                           
         SPACE 1                                                                
VCLA36A  CLI   CLAEUSEH+5,0        IF NONE ARE CHECKED                          
         BNE   VCLA36B                                                          
         CLI   CLANUSEH+5,0        GIVE MISSING INPUT MESSAGE                   
         BE    ERCLAMIS                                                         
         SPACE 1                                                                
VCLA36B  LA    R2,CLAEUSEH         IF AUTO OPTION NOT CHECKED                   
         GOTO1 ANY                 ENDING USE AND NUMBER OF USES                
         LA    R2,CLANUSEH         ARE REQUIRED                                 
         GOTO1 ANY                                                              
         SPACE 1                                                                
         GOTOR VALUNIT             SAVE # OF USES TO PAY IN SVUSES              
         MVC   SVUSES,SVUNITS                                                   
         OC    SVUSES,SVUSES                                                    
         BZ    ERCLAINV                                                         
         SPACE 1                                                                
         LA    R2,CLAEUSEH         SAVE LAST CLA USE NUMBER IN SVUNITS          
         GOTOR VALUNIT                                                          
         OC    SVUNITS,SVUNITS                                                  
         BZ    ERCLAINV                                                         
         SPACE 1                                                                
         LA    R2,CLANUSEH                                                      
         CLC   SVUNITS,SVUSES      LAST CLA USE NUMBER MUST BE =>               
         BL    ERCLAINV            # OF USES TO PAY                             
         SPACE                                                                  
VCLA40   CLI   CLACCSTH+5,0        IF CYCLE START DATE INPUTTED                 
         BE    VCLA200                                                          
         LA    R2,CLACLAOH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VCLA200  CLC   TYPECHK1(4),=C'XXXX'                                             
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,CLAMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VCLA201                                                          
         GOTOR WKDEF,DMCB,(6,CLAMWKSH)                                          
         GOTOR VALCYC,DMCB,CLAMUSTH,CLAMWKSH,MUSDATE                            
         SPACE                                                                  
VCLA201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,CLAMUSEH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             MUSIC                                        
         BE    VCLA210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         CLI   CLAMLTSH+5,0                                                     
         BNE   VCLA201A                                                         
         CLI   CLAMU2LH+5,0                                                     
         BE    VCLA202                                                          
VCLA201A LA    R2,CLAMDUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERCLAMIS                                                         
         LA    R2,CLAMUSEH                                                      
VCLA202  GOTOR VALNORM,WORK,TYPE2,('UMUS13W',CLAMREH),                 +        
               ('UMUSNEW',CLAMCONH),('UMUSDUB',CLAMDUBH),(X'FF',1)              
         CLI   CLAMLTSH+5,0                                                     
         BE    *+8                                                              
         MVI   TYPE2,UMUSDSH                                                    
         CLI   CLAMU2LH+5,0                                                     
         BE    VCLA210                                                          
         LA    R2,CLAMU2LH                                                      
         CLI   TYPE2,UMUSDSH                                                    
         JE    ERCLAINV                                                         
         MVI   TYPE2,UMUS2DS                                                    
         SPACE                                                                  
VCLA210  CLI   CLA1MUSH+5,0        FIRST MUSIC                                  
         BE    VCLA215                                                          
         LA    R2,CLA1MUSH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFMU                                                        
         MVI   TYPE2,UFMU13W                                                    
         SPACE                                                                  
VCLA215  LA    R2,CLAMBOH          ALL MEDIA BUYOUT                             
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VCLA220                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMBO                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMBOI1Y',CLAMBOIH),                +        
               ('UMBOR1Y',CLAMBORH),(X'FF',1)                                   
         MVC   CLAMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,CLAMUSTH,CLAMWKSH,MUSDATE                            
                                                                                
VCLA220  CLI   CLAMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VCLA230                                                          
         LA    R2,CLAMUSEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VCLA230  LA    R2,CLACCSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VCLA300             MUSIC CYCLE START DATE MUST BE               
         CLI   CLAMUSTH+5,0        ENTERED                                      
         BE    ERCLAMIS                                                         
         SPACE 2                                                                
VCLA300  CLI   CLACCSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VCLA301                                                          
         LA    R2,CLAWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VCLA301  CLI   CLAMUSTH+5,0                                                     
         BE    VCLA302                                                          
         CLI   USE2,UMBO                                                        
         BE    VCLA302                                                          
         LA    R2,CLAMWKSH                                                      
         GOTO1 ANY                                                              
         SPACE 1                                                                
VCLA302  LA    R2,CLAAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
         LA    R2,CLAAPPHH                                                      
         GOTOR APPHLD                                                           
         SPACE                                                                  
VCLA320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',CLAAPPCH),TACMTYPA  APPLY COMM         
         SPACE 2                                                                
         XC    ELEMENT,ELEMENT       PROCESS CLASS A PROGRAM DETAILS            
         MVI   ELCODE,TANPELQ        CLA PROGRAM DETAILS ELEMENT                
         MVI   PAGEMAX,20            N'LINES/PAGE                               
         MVC   PAGELNQ,=AL2(CLALNQ)  L'LINE                                     
         LA    R3,CLAFRSTH           A(FIRST SET)                               
         GOTOR BLDPAGE,DMCB,CLA1STH,CLALSTH  BLD CLA ELEMS                      
VCLAX    NI     CLACCSTH+6,X'FF'-X'40'                                          
         XIT1                                                                   
         SPACE 2                                                                
*              VALCLA'S ERROR MESSAGES AND LITERALS                             
         SPACE                                                                  
ERCLAMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+8                                                              
ERCLAINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              VALIDATE CABLE SCREEN                                            
         SPACE                                                                  
VALCBL   NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,DISHEADS                                                      
         OI    CBLCAUNH+6,X'80'                                                 
         SPACE                                                                  
         LA    R2,CBLCCSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VCBL05                                                           
         GOTOR WKDEF,DMCB,(13,CBLWKSH)                                          
         GOTOR VALCYC,DMCB,CBLCCSTH,CBLWKSH,REGDATE                             
         SPACE                                                                  
         XC    WORK,WORK                                                        
         GOTO1 DATCON,DMCB,(1,REGDATE),(0,TGDUB)                                
         GOTO1 DATCON,DMCB,(1,REGDATE+3),(0,TGDUB+6)                            
         SPACE 1                                                                
VCBL05   MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         CLI   CBLCABLH+5,0        CABLE                                        
         BE    VCBL10                                                           
         LA    R2,CBLCABLH                                                      
         CLI   TGMENAME,C'R'                                                    
         BE    ERCBLINV                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UCBL                                                        
         MVI   TYPE1,UCBLREG                                                    
         LA    R2,CBLCAUPH                                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCBL10                                                           
         MVI   TYPE1,UCBLUPG                                                    
         SPACE 1                                                                
VCBL10   CLI   CBLSCABH+5,0      SPANISH CABLE                                  
         BE    VCBL20                                                           
         LA    R2,CBLSCABH                                                      
         CLI   TGMENAME,C'R'                                                    
         BE    ERCBLINV                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USCB                                                        
         MVI   TYPE1,USCBREG                                                    
         LA    R2,CBLCAUPH                                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCBL20                                                           
         MVI   TYPE1,USCBUPG                                                    
         SPACE 1                                                                
VCBL20   CLI   CBLWSPTH+5,0        WILDSPOT                                     
         BE    VCBL30                                                           
         LA    R2,CBLWSPTH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UWSP                                                        
         CLI   TGMENAME,C'T'       FOR TELEVSION                                
         BNE   VCBL21                                                           
         LA    R2,CBLWS8WH         8 WEEK IS INVALID                            
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         LA    R2,CBLWS13H         13 WEEK IS REQUIRED                          
         CLI   5(R2),0                                                          
         BE    ERCBLMIS                                                         
VCBL21   CLI   CBLWS8WH+5,0        IF 8 WEEK IS CHECKED OFF                     
         BE    *+8                                                              
         MVI   TYPE1,UWSP8W        SAVE USE TYPE                                
         LA    R2,CBLWS13H         IF 13 WEEK IS CHECKED OFF                    
         CLI   5(R2),0                                                          
         BE    VCBL22                                                           
         CLI   TYPE1,0             8 WEEK CANNOT BE CHECKED OFF TOO             
         BNE   ERCBLINV                                                         
         MVI   TYPE1,UWSP13W       SAVE USE TYPE                                
VCBL22   CLI   TYPE1,0             EITHER 8 WEEK OR 13 WEEK MUST                
         BE    ERCBLMIS            BE CHECKED OFF                               
         CLI   CBLWKSH+5,0                                                      
         BE    VCBL25                                                           
         LA    R2,CBLWKSH                                                       
         OI    CBLWKS+1,X'40'                                                   
         CLI   CBLWS8WH+5,0                                                     
         BE    *+14                                                             
         CLC   CBLWKS,=C'8 '                                                    
         BNE   ERCBLINV                                                         
         CLI   CBLWS13H+5,0                                                     
         BE    VCBL25                                                           
         CLC   CBLWKS,=C'13'                                                    
         BNE   ERCBLINV                                                         
VCBL25   MVC   CBLCCST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,CBLCCSTH,CBLWKSH,REGDATE                             
         GOTO1 DATCON,DMCB,(1,REGDATE),(0,TGDUB)                                
         GOTO1 DATCON,DMCB,(1,REGDATE+3),(0,TGDUB+6)                            
         LA    R2,CBLCAUPH                                                      
         NI    CBLCAUPH+4,X'FF'-X'60'                                           
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCBL30                                                           
         ZIC   RE,TYPE1                                                         
         AHI   RE,3                                                             
         STC   RE,TYPE1                                                         
         SPACE 1                                                                
VCBL30   CLI   CBLSWSPH+5,0                                                     
         BE    VCBL40                                                           
         LA    R2,CBLSWSPH                                                      
         CLI   TGMENAME,C'R'                                                    
         BE    ERCBLINV                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USWS                                                        
         MVI   TYPE1,USWSREG                                                    
         LA    R2,CBLCAUPH                                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCBL40                                                           
         MVI   TYPE1,USWSUPG                                                    
         SPACE 1                                                                
VCBL40   CLI   CBLCWSPH+5,0                                                     
         BE    VCBL45                                                           
         LA    R2,CBLCWSPH                                                      
         CLI   TGMENAME,C'R'                                                    
         BE    ERCBLINV                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UWSC                                                        
         MVI   TYPE1,UWSCREG                                                    
         LA    R2,CBLCAUPH                                                      
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCBL45                                                           
         MVI   TYPE1,UWSCUPG                                                    
         SPACE 1                                                                
VCBL45   CLI   CBLLCABH+5,0        LOCAL CABLE                                  
         BE    VCBL50                                                           
         LA    R2,CBLLCABH                                                      
         CLI   TGMENAME,C'R'                                                    
         BE    ERCBLINV                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,ULCB                                                        
         SPACE 1                                                                
VCBL50   LA    R2,CBLAWSPH         ADDENDUM WILDSPOT                            
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0                                                          
         BE    VCBL190                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UADW                                                        
         SPACE                                                                  
         CLC   COMSTATE,=C'KS'     IF COMMERCIAL STATE IS KANSAS                
         BNE   VCBL51              CANNOT ALLOW 3 DAY OR 4 WEEK                 
         LA    R2,CBLA3DYH                                                      
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         LA    R2,CBLA4WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         B     VCBL53                                                           
         SPACE                                                                  
VCBL51   CLC   COMSTATE,=C'TX'     IF COMMERCIAL STATE IS TEXAS                 
         BNE   VCBL52              CANNOT ALLOW 3 DAY, 1 WEEK,                  
         LA    R2,CBLA3DYH         4 WEEK, OR 31 DAY                            
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         LA    R2,CBLA1WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         LA    R2,CBLA4WKH                                                      
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         LA    R2,CBLA31DH                                                      
         CLI   5(R2),0                                                          
         BNE   ERCBLINV                                                         
         B     VCBL53                                                           
         SPACE                                                                  
VCBL52   CLI   COMEXIST,C'N'                                                    
         BE    VCBL53                                                           
         LA    R2,CBLA31DH         ALL OTHER COMMERCIAL STATES                  
         CLI   5(R2),0             CANNOT ALLOW 31 DAY                          
         BNE   ERCBLINV                                                         
         SPACE                                                                  
VCBL53   GOTOR VALNORM,WORK,TYPE1,('UADW3D',CBLA3DYH),                 +        
               ('UADW1W',CBLA1WKH),('UADW4W',CBLA4WKH),                +        
               ('UADW13W',CBLA13WH),('UADW31D',CBLA31DH),(X'FF',1)              
         LA    R2,CBLCAUPH         UPGRADE                                      
         NI    CBLCAUPH+4,X'9F'                                                 
         GOTOR VALUPG                                                           
         CLI   UPGR,C'Y'                                                        
         BNE   VCBL55                                                           
         GOTOR VALNORM,WORK,TYPE1,('UADWU3D',CBLA3DYH),                +        
               ('UADWU1W',CBLA1WKH),('UADWU4W',CBLA4WKH),              +        
               ('UADWU13W',CBLA13WH),('UADWU31D',CBLA31DH),(X'FF',1)            
VCBL55   LA    R2,CBLWKSH                                                       
         OC    CBLWKS,SPACES                                                    
         CLI   5(R2),0                                                          
         BE    VCBL56                                                           
         CLI   CBLA3DYH+5,0                                                     
         BNE   ERCBLINV                                                         
         CLI   CBLA31DH+5,0                                                     
         BNE   ERCBLINV                                                         
         CLI   CBLA1WKH+5,0                                                     
         BE    *+14                                                             
         CLC   CBLWKS(2),=C'1 '                                                 
         BNE   ERCBLINV                                                         
         CLI   CBLA4WKH+5,0                                                     
         BE    *+14                                                             
         CLC   CBLWKS(2),=C'4 '                                                 
         BNE   ERCBLINV                                                         
         CLI   CBLA13WH+5,0                                                     
         BE    VCBL56                                                           
         CLC   CBLWKS(2),=C'13'                                                 
         BNE   ERCBLINV                                                         
VCBL56   MVC   CBLCCST+8(9),SPACES   CALCULATE CYCLE                            
         GOTOR VALCYC,DMCB,CBLCCSTH,CBLWKSH,REGDATE                             
         GOTO1 DATCON,DMCB,(1,REGDATE),(0,TGDUB)                                
         GOTO1 DATCON,DMCB,(1,REGDATE+3),(0,TGDUB+6)                            
         SPACE                                                                  
VCBL190  CLI   CBLCCSTH+5,0        IF CYCLE START DATE INPUTTED                 
         BE    VCBL200                                                          
         LA    R2,CBLCABLH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
         CLI   CBLMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VCBL280                                                          
         LA    R2,CBLMUSEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VCBL200  CLC   TYPECHK1,=C'XXXX'                                                
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
         SPACE 1                                                                
         LA    R2,CBLMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VCBL201                                                          
         GOTOR WKDEF,DMCB,(14,CBLMWKSH)                                         
         GOTOR VALCYC,DMCB,CBLMUSTH,CBLMWKSH,MUSDATE                            
         SPACE                                                                  
VCBL201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
         SPACE                                                                  
         LA    R2,CBLMUSEH                                                      
         GOTOR MINCHK,DMCB,5                                                    
         CLI   5(R2),0             MUSIC REUSE                                  
         BE    VCBL210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         CLI   CBLMLTSH+5,0                                                     
         BNE   VCBL201A                                                         
         CLI   CBLMU2LH+5,0                                                     
         BE    VCBL202                                                          
VCBL201A LA    R2,CBLMDUBH                                                      
         CLI   5(R2),0                                                          
         BE    ERCBLMIS                                                         
         LA    R2,CBLMUSEH                                                      
VCBL202  GOTOR VALNORM,WORK,TYPE2,('UMUS13W',CBLMREH),                 +        
               ('UMUSNEW',CBLMCONH),('UMUSDUB',CBLMDUBH),(X'FF',1)              
         CLI   CBLMLTSH+5,0                                                     
         BE    *+8                                                              
         MVI   TYPE2,UMUSDSH                                                    
         CLI   CBLMU2LH+5,0                                                     
         BE    VCBL210                                                          
         LA    R2,CBLMU2LH                                                      
         CLI   TYPE2,UMUSDSH                                                    
         JE    ERTVINV                                                          
         MVI   TYPE2,UMUS2DS                                                    
         SPACE                                                                  
VCBL210  CLI   CBL1MUSH+5,0        FIRST MUSIC                                  
         BE    VCBL220                                                          
         LA    R2,CBL1MUSH                                                      
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UFMU                                                        
         MVI   TYPE2,UFMU13W                                                    
         SPACE                                                                  
VCBL220  LA    R2,CBLMBOH          ALL MEDIA BUYOUT                             
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VCBL270                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMBO                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMBOI1Y',CBLMBOIH),                +        
               ('UMBOR1Y',CBLMBORH),(X'FF',1)                                   
         MVC   CBLMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,CBLMUSTH,CBLMWKSH,MUSDATE                            
         SPACE                                                                  
VCBL270  CLI   CBLMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VCBL280                                                          
         LA    R2,CBLMUSEH                                                      
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
         SPACE 2                                                                
VCBL280  LA    R2,CBLCCSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VCBL300             MUSIC CYCLE START DATE MUST BE               
         CLI   CBLMUSTH+5,0        ENTERED                                      
         BE    ERCBLMIS                                                         
         SPACE 2                                                                
VCBL300  CLI   CBLCCSTH+5,0        IF REGULAR CYCLE DATES PRESENT               
         BE    VCBL301                                                          
         CLI   CBLWSPTH+5,0                                                     
         BNE   VCBL301                                                          
         CLI   CBLAWSPH+5,0                                                     
         BNE   VCBL301                                                          
         LA    R2,CBLWKSH          REGULAR CYCLE WEEKS MUST BE                  
         GOTO1 ANY                 FILLED IN BY THIS POINT                      
         SPACE 1                                                                
VCBL301  CLI   CBLMUSTH+5,0                                                     
         BE    VCBL302                                                          
         CLI   USE2,UMBO           AND USE IS NOT MEDIA BUYOUT                  
         BE    VCBL302                                                          
         LA    R2,CBLMWKSH                                                      
         GOTO1 ANY                                                              
         SPACE 1                                                                
VCBL302  LA    R2,CBLAPPSH                                                      
         GOTOR APPSESS                                                          
         SPACE                                                                  
         LA    R2,CBLAPPHH                                                      
         GOTOR APPHLD                                                           
         SPACE                                                                  
VCBL320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',CBLAPPCH),TACMTYPA  APPLY COMM         
         SPACE 2                                                                
         CLI   UPGR,C'Y'                                                        
         BE    VCBL330                                                          
         CLI   USE1,0                                                           
         BE    VCBLX                                                            
         GOTOR BLDMKTS,DMCB,CBLDT1H,CBLCDLH                                     
         SPACE 1                                                                
         LA    R2,CBLDT1H                                                       
         L     R4,AIO                                                           
         MVI   ELCODE,TAMTELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   ENTNONE                                                          
         SPACE 1                                                                
VCBL330  CLI   USE1,ULCB           IF LOCAL CABLE USE                           
         BNE   VCBLX                                                            
         SPACE 1                                                                
         GOTOR CCBLUNIT,DMCB,USE1  CALCULATE NUMBER OF SUBSCRIBERS              
         SPACE 1                                                                
         LA    RE,LCBLTAB                                                       
VCBL340  MVC   TYPE1,4(RE)         AND ASSIGN THE CORRECT USE TYPE              
         CLI   0(RE),X'FF'                                                      
         BE    VCBL345                                                          
         CLC   UNITCALC,0(RE)                                                   
         BNH   VCBL345                                                          
         LA    RE,L'LCBLTAB(RE)                                                 
         B     VCBL340                                                          
         SPACE 1                                                                
VCBL345  CLI   CBLCAUP,C'Y'        IF UPGRADING                                 
         BNE   VCBL400                                                          
         MVI   UPGR,C'Y'                                                        
         MVC   TGUSCDE,=C'LCB'                                                  
         SPACE 1                                                                
         MVI   ELCODE,TAUPELQ                                                   
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
         MVC   AIO,AIO2                                                         
         LA    R3,KEY              GET USAGE HISTORY RECORDS                    
         USING TLUHD,R3            FOR THIS USE ON THIS COMMERCIAL              
         XC    TLUHKEY,TLUHKEY                                                  
         MVI   TLUHCD,TLUHCDQ                                                   
         MVC   TLUHCOM,TGCOM                                                    
         MVC   TLUHUSE,=C'LCB'                                                  
         GOTO1 HIGH                                                             
         B     VCBL360                                                          
VCBL350  GOTO1 SEQ                                                              
VCBL360  CLC   KEY(TLUHINV-TLUHD),KEYSAVE                                       
         BE    *+12                                                             
         SPACE 1                                                                
         BAS   RE,CNOPREV          USAGE HISTORY MUST BE FOUND                  
         B     VCBL370                                                          
         GOTO1 GETREC                                                           
         SPACE 1                                                                
         USING TAUHD,R4                                                         
         MVI   ELCODE,TAUHELQ                                                   
         L     R4,AIO                                                           
         BRAS  RE,GETEL                                                         
         BNE   VCBL350                                                          
         CLC   REGDATE,TAUHSTRT    WITH THE SAME CYCLE START DATE               
         BNE   VCBL350                                                          
         SPACE 1                                                                
         CLI   TAUHLEN,TAUHLNQ                                                  
         BL    VCBL364                                                          
         MVC   TGUPFRTY,TAUHTYPE                                                
         MVC   TGFULL,TAUHSUBS                                                  
         B     VCBL366A                                                         
         SPACE 1                                                                
VCBL364  LA    RE,LCBLTAB                                                       
VCBL365  CLI   0(RE),X'FF'         SET THE UPGRADE "FROM" TYPE                  
         BE    VCBL366                                                          
         CLC   TAUHTYPE,4(RE)                                                   
         BNH   VCBL366                                                          
         LA    RE,L'LCBLTAB(RE)                                                 
         B     VCBL365                                                          
         SPACE 1                                                                
VCBL366  MVC   TGUPFRTY,4(RE)                                                   
         MVC   TGFULL,0(RE)                                                     
         SPACE 1                                                                
VCBL366A L     RF,UNITCALC        ADD CURRENT INPUT TO THE "FROM" TYPE          
         A     RF,TGFULL                                                        
         ST    RF,UNITCALC                                                      
         SPACE 1                                                                
         LA    RE,LCBLTAB         AND GET THE EQUATE FOR THE "TO" TYPE          
VCBL367  CLI   0(RE),X'FF'                                                      
         BE    VCBL368                                                          
         CLC   UNITCALC,0(RE)                                                   
         BNH   VCBL368                                                          
         LA    RE,L'LCBLTAB(RE)                                                 
         B     VCBL367                                                          
         SPACE 1                                                                
VCBL368  MVC   TGUPTOTY,4(RE)                                                   
         SPACE 1                                                                
         GOTO1 UPGRVAL,DMCB,(X'80',TGUSCDE),TGUPFRTY,TGUSCDE,TGUPTOTY           
         BE    VCBL370                                                          
         BAS   RE,CNUPGR                                                        
         SPACE 1                                                                
VCBL370  MVC   TYPE1,TGUPTYP       SAVE UPGRADE TYPE                            
         MVC   SVUPTYP,TYPE1                                                    
         SPACE 1                                                                
VCBL380  MVC   AIO,AIO1                                                         
         SPACE 1                                                                
         MVI   ELCODE,TAUPELQ      DELETE OLD UPGRADE ELEMENT                   
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
         USING TAUPD,R5                                                         
         LA    R5,ELEMENT          ADD NEW UPGRADE ELEMENT                      
         XC    ELEMENT,ELEMENT                                                  
         MVI   TAUPEL,TAUPELQ                                                   
         MVI   TAUPLEN,TAUPLNQ                                                  
         MVC   TAUPILCM,TAUHTYPE                                                
         MVC   TAUPISUB,TGFULL                                                  
         CLC   TAUPISUB,=4X'FF'                                                 
         BNE   *+10                                                             
         MVC   TAUPISUB,=F'1000001'                                             
         GOTO1 ADDELEM                                                          
         DROP  R4,R5                                                            
         SPACE 1                                                                
         NI    STATUS,X'FF'-WAITUPFK                                            
         XC    UPGFLD,UPGFLD                                                    
         SPACE 1                                                                
VCBL400  MVC   AIO,AIO2                                                         
         MVC   KEY,ADVKEY          RE-READ THE ADVICE                           
         CLI   ACTNUM,ACTADD                                                    
         BE    VCBL410                                                          
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
VCBL410  MVC   AIO,AIO1                                                         
         SPACE                                                                  
VCBLX    NI    CBLCCSTH+6,X'FF'-X'40'                                           
         XC    SVUNITS,SVUNITS                                                  
         SPACE 1                                                                
         XIT1                                                                   
         SPACE 2                                                                
CNUPGR   NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    CNUPG                                                            
         CLI   PFAID,20                                                         
         BNE   CNUPG                                                            
         B     VCBLX                                                            
         SPACE 2                                                                
CNOPREVR NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    CNOPREV                                                          
         CLI   PFAID,20                                                         
         BNE   CNOPREV                                                          
         B     VCBLX                                                            
         SPACE                                                                  
*              VALCBL'S ERROR MESSAGES AND LITERALS                             
         SPACE                                                                  
CNOPREV  MVI   MYMSGNO1,91                                                      
         B     CBLINFX                                                          
CNUPG    MVI   MYMSGNO1,92         THIS IS NOT AN UPGRADE                       
         B     CBLINFX                                                          
ENTNONE  MVI   MYMSGNO1,119                                                     
         CLI   USE1,UWSP                                                        
         BNE   ERCBLMIS                                                         
         B     CBLINFX                                                          
         SPACE 1                                                                
CBLINFX  OI    GENSTAT2,USGETTXT                                                
         ST    R2,UPGFLD                                                        
         OI    STATUS,WAITUPFK                                                  
         B     ERCBLXIT                                                         
         SPACE 1                                                                
ERCBLMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     ERCBLXIT                                                         
ERCBLINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         B     ERCBLXIT                                                         
ERCBLXIT GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         DC    0F                                                               
LCBLTAB  DC    0XL8                                                             
         DC    F'50000',AL1(ULCB50)                                             
         DC    F'100000',AL1(ULCB100)                                           
         DC    F'150000',AL1(ULCB150)                                           
         DC    F'200000',AL1(ULCB200)                                           
         DC    F'250000',AL1(ULCB250)                                           
         DC    F'500000',AL1(ULCB500)                                           
         DC    F'750000',AL1(ULCB750)                                           
         DC    F'1000000',AL1(ULCB1M)                                           
         DC    4X'FF',AL1(ULCBMAX)                                              
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE INTERNET/NEWMEDIA SCREEN                     
         SPACE                                                                  
VALINM   NTR1  BASE=*,LABEL=*                                                   
         OC    INMWKS,SPACES                                                    
                                                                                
         LA    R2,INMCCSTH                                                      
         CLI   5(R2),0             IF CYCLE START DATE INPUTTED                 
         BE    VINM00                                                           
         GOTOR WKDEF,DMCB,(15,INMWKSH)                                          
         GOTOR VALCYC,DMCB,INMCCSTH,INMWKSH,REGDATE                             
                                                                                
VINM00   MVI   CHKSTAT,0           NO REGULAR USES CHECKED YET                  
         ST    R2,CHKDATE                                                       
                                                                                
         CLI   INMIRNH+5,0         INTERNET (OLD)                               
         BE    VINM10                                                           
         LA    R2,INMIRNH                                                       
         CLI   TGMENAME,C'I'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UIRN                                                        
         LA    R2,INMWKSH                                                       
         CLI   5(R2),0                                                          
         BE    VINM09                                                           
         MVC   INMCCST+8(9),SPACES                                              
         OI    INMCCSTH+6,X'80'                                                 
         B     ERINMINV                                                         
VINM09   GOTOR VALCYC,DMCB,INMCCSTH,INMWKSH,REGDATE                             
                                                                                
VINM10   CLI   INMSIRH+5,0         SPANISH INTERNET (OLD)                       
         BE    VINM20                                                           
         LA    R2,INMSIRH                                                       
         CLI   TGMENAME,C'I'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USIR                                                        
         LA    R2,INMWKSH                                                       
         CLI   5(R2),0                                                          
         BE    VINM19                                                           
         MVC   INMCCST+8(9),SPACES                                              
         OI    INMCCSTH+6,X'80'                                                 
         B     ERINMINV                                                         
VINM19   GOTOR VALCYC,DMCB,INMCCSTH,INMWKSH,REGDATE                             
                                                                                
VINM20   CLI   INMNMRH+5,0         NEW MEDIA (OLD)                              
         BE    VINM30                                                           
         LA    R2,INMNMRH                                                       
         CLI   TGMENAME,C'N'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UNMR                                                        
                                                                                
VINM30   CLI   INMSNMH+5,0         SPANISH NEW MEDIA                            
         BE    VINM40                                                           
         LA    R2,INMSNMH                                                       
         CLI   TGMENAME,C'N'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USNM                                                        
                                                                                
VINM40   CLI   INMINUH+5,0         INTERNET (NEW)                               
         BE    VINM50                                                           
         LA    R2,INMINUH                                                       
         CLI   TGMENAME,C'I'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UINU                                                        
                                                                                
VINM50   CLI   INMSIUH+5,0         SPANISH INTERNET (NEW)                       
         BE    VINM60                                                           
         LA    R2,INMSIUH                                                       
         CLI   TGMENAME,C'I'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USIU                                                        
                                                                                
VINM60   CLI   INMNMUH+5,0         NEW MEDIA (NEW)                              
         BE    VINM70                                                           
         LA    R2,INMNMUH                                                       
         CLI   TGMENAME,C'N'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UNMU                                                        
                                                                                
VINM70   CLI   INMSNUH+5,0         SPANISH NEW MEDIA (NEW)                      
         BE    VINM80                                                           
         LA    R2,INMSNUH                                                       
         CLI   TGMENAME,C'N'                                                    
         BNE   ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USNU                                                        
                                                                                
VINM80   CLI   INMMVIH+5,0         MOVED TO INTERNET                            
         BE    VINM90                                                           
         LA    R2,INMMVIH                                                       
         CLI   TGMENAME,C'I'                                                    
         BE    ERINMMED                                                         
         CLI   TGMENAME,C'N'                                                    
         BE    ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UMVI                                                        
                                                                                
VINM90   CLI   INMSMIH+5,0         SPANISH MOVED TO INTERNET                    
         BE    VINM100                                                          
         LA    R2,INMSMIH                                                       
         CLI   TGMENAME,C'I'                                                    
         BE    ERINMMED                                                         
         CLI   TGMENAME,C'N'                                                    
         BE    ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USMI                                                        
                                                                                
VINM100  CLI   INMMVNH+5,0         MOVED TO NEW MEDIA                           
         BE    VINM110                                                          
         LA    R2,INMMVNH                                                       
         CLI   TGMENAME,C'I'                                                    
         BE    ERINMMED                                                         
         CLI   TGMENAME,C'N'                                                    
         BE    ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,UMVN                                                        
                                                                                
VINM110  CLI   INMSMNH+5,0         SPANISH MOVED TO NEW MEDIA                   
         BE    VINM115                                                          
         LA    R2,INMSMNH                                                       
         CLI   TGMENAME,C'I'                                                    
         BE    ERINMMED                                                         
         CLI   TGMENAME,C'N'                                                    
         BE    ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE1,USMN                                                        
                                                                                
VINM115  CLI   INMSOMH+5,0         SOCIAL MEDIA USE                             
         BE    VINM120                                                          
         LA    R2,INMSOMH                                                       
         CLI   TGMENAME,C'I'                                                    
         BE    VINM115A                                                         
         CLI   TGMENAME,C'N'                                                    
         BNE   ERINVCOU                                                         
VINM115A CLI   COMEXIST,C'Y'                                                    
         BNE   VINM115B                                                         
         TM    COMSTA3,TACOSSMW                                                 
         BZ    ERINVCOU                                                         
VINM115B BRAS  RE,OK2CHK                                                        
         MVI   USE1,USOM                                                        
                                                                                
VINM120  CLI   INMCCSTH+5,0        IF CYCLE START DATE INPUTTED                 
         BE    VINM120A                                                         
         CLI   USE1,0              ENSURE USE HAS BEEN SELECTED                 
         BNE   VINM120A                                                         
         LA    R2,INMIRNH                                                       
         B     ERINMINV                                                         
                                                                                
VINM120A CLI   USE1,0              IF USE IS NOT SELECTED                       
         BE    VINM120B                                                         
         CLI   USE1,UIRN           OR OLD INTERNET IS SELECTED                  
         BE    VINM120B                                                         
         CLI   USE1,USIR           OR OLD SPANISH INTERNET IS SELCTED           
         BE    VINM120B                                                         
         CLI   USE1,UNMR           OR OLD NEW MEDIA IS SELECTED                 
         BE    VINM120B                                                         
         CLI   USE1,USNM           OR OLD SPANISH NEW MEDIA                     
         BE    VINM120B                                                         
         CLI   USE1,USOM           OR SOCIAL MEDIA USE                          
         BNE   VINM120C            IS SELECTED                                  
VINM120B LA    R2,INM4WKH                                                       
         CLI   5(R2),0             ENSURE THAT 4 WEEK                           
         BNE   ERINMINV                                                         
         LA    R2,INM8WKH                                                       
         CLI   5(R2),0             8 WEEK                                       
         BNE   ERINMINV                                                         
         LA    R2,INM1YRH                                                       
         CLI   5(R2),0             1 YEAR                                       
         BNE   ERINMINV                                                         
         LA    R2,INMEXTH          1 YEAR EXTENSION                             
         CLI   5(R2),0                                                          
         BNE   ERINMINV                                                         
         LA    R2,INMRADH          AND RADIO OPTIONS ARE NOT                    
         CLI   5(R2),0             SELECTED                                     
         BNE   ERINMINV                                                         
         B     VINM130                                                          
                                                                                
VINM120C CLI   INM4WKH+5,0         OTHERWISE ENSURE THAT 4 WEEK                 
         BNE   VINM120D                                                         
         CLI   INM8WKH+5,0         8 WEEK                                       
         BNE   VINM120D                                                         
         CLI   INM1YRH+5,0         1 YEAR                                       
         BNE   VINM120D                                                         
         CLI   INMEXTH+5,0         OR EXTENSION OPTION IS SELECTED              
         BNE   VINM120D                                                         
         LA    R2,INM4WKH                                                       
         B     ERINMMIS                                                         
                                                                                
VINM120D CLI   USE1,UMVI                                                        
         JE    VINM120J                                                         
         CLI   USE1,USMI                                                        
         JE    VINM120J                                                         
         CLI   USE1,UMVN                                                        
         JE    VINM120J                                                         
         CLI   USE1,USMN                                                        
         JNE   VINM120K                                                         
VINM120J LA    R2,INMRADH                                                       
         CLI   5(R2),0                                                          
         JNE   ERINMINV                                                         
         GOTOR VALNORM,WORK,TYPE1,('UMVII4W',INM4WKH),                 +        
               ('UMVII8W',INM8WKH),('UMVII1Y',INM1YRH),                +        
               ('UMVIEXT',INMEXTH),(X'FF',1)                                    
         J     VINM120E                                                         
                                                                                
VINM120K GOTOR VALNORM,WORK,TYPE1,('UINUI4W',INM4WKH),                 +        
               ('UINUI8W',INM8WKH),('UINUI1Y',INM1YRH),                +        
               ('UINUEXT',INMEXTH),(X'FF',1)                                    
         CLI   INMRADH+5,0                                                      
         BE    VINM120E                                                         
         ZIC   RE,TYPE1                                                         
         LHI   RF,1                                                             
         CLI   INM4WKH+5,0                                                      
         BNE   *+8                                                              
         LHI   RF,3                                                             
         AR    RE,RF                                                            
         STC   RE,TYPE1                                                         
                                                                                
VINM120E LA    R2,INMWKSH                                                       
         CLI   5(R2),0             VALIDATE 8 WEEK, 1 YEAR OR                   
         BE    VINM120H            EXTENSION SELECTION                          
         CLI   USE1,UINU                                                        
         BE    VINM10W                                                          
         CLI   USE1,USIU                                                        
         BE    VINM10W                                                          
         CLI   USE1,UNMU                                                        
         BE    VINM10W                                                          
         CLI   USE1,USNU                                                        
         BNE   VINM20W                                                          
VINM10W  CLI   TYPE1,UINUI4W                                                    
         BE    VINM120I                                                         
         CLI   TYPE1,UINUR4W                                                    
         BE    VINM120I                                                         
VINM20W  CLI   USE1,UMVI                                                        
         BE    VINM30W                                                          
         CLI   USE1,USMI                                                        
         BE    VINM30W                                                          
         CLI   USE1,UMVN                                                        
         BE    VINM30W                                                          
         CLI   USE1,USMN                                                        
         BNE   VINM40W                                                          
VINM30W  CLI   TYPE1,UMVII4W                                                    
         BE    VINM120I                                                         
VINM40W  CLI   TYPE1,UINUI8W                                                    
         BE    VINM120F                                                         
         CLI   TYPE1,UINUR8W                                                    
         BNE   VINM120G                                                         
VINM120I CLC   INMWKS,=C'4 '                                                    
         BE    VINM120H                                                         
VINM120F CLC   INMWKS,=C'8 '                                                    
         BE    VINM120H                                                         
VINM120G MVC   INMCCST+8(9),SPACES                                              
         OI    INMCCSTH+6,X'80'                                                 
         B     ERINMINV                                                         
VINM120H GOTOR VALCYC,DMCB,INMCCSTH,INMWKSH,REGDATE                             
                                                                                
VINM130  MVI   ELCODE,TAMDELQ      DELETE INTERNET/NEW MEDIA ELEMENTS           
         GOTO1 REMELEM                                                          
                                                                                
VINM200  CLC   TYPECHK1,=C'XXXX'                                                
         BNE   *+10                                                             
         XC    TYPECHK1,TYPECHK1                                                
                                                                                
         LA    R2,INMMUSTH         IF MUSIC CYCLE START DATE INPUTTED           
         CLI   5(R2),0                                                          
         BE    VINM201                                                          
         GOTOR WKDEF,DMCB,(16,INMMWKSH)                                         
         GOTOR VALCYC,DMCB,INMMUSTH,INMMWKSH,MUSDATE                            
                                                                                
VINM201  MVI   CHKSTAT,0           NO MUSIC USES CHECKED YET                    
         ST    R2,CHKDATE                                                       
                                                                                
         LA    R2,INMMUSH          MUSIC                                        
         GOTOR MINCHK,DMCB,9                                                    
         CLI   5(R2),0                                                          
         BE    VINM210                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMUS                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMUS13W',INMMUREH),                +        
               ('UMUSNEW',INMMUCOH),('UMUSDUB',INMMUDBH),(X'FF',1)              
                                                                                
         OI    INMMWKSH+6,X'80'                                                 
                                                                                
         CLI   INMMULSH+5,0                                                     
         BE    VINM202                                                          
         LA    R2,INMMUDBH                                                      
         CLI   5(R2),0                                                          
         BE    ERINMMIS                                                         
         MVI   TYPE2,UMUSDSH                                                    
                                                                                
VINM202  CLI   INMMU2LH+5,0                                                     
         BE    VINM202A                                                         
         LA    R2,INMMUDBH                                                      
         CLI   5(R2),0                                                          
         BE    ERINMMIS                                                         
         LA    R2,INMMU2LH                                                      
         CLI   TYPE2,UMUSDSH                                                    
         BE    ERINMINV                                                         
         MVI   TYPE2,UMUS2DS                                                    
                                                                                
VINM202A XR    R0,R0               R0=LENGTH COUNTER                            
         ZIC   R1,TYPE2            R1=TYPE                                      
                                                                                
         CLI   INMMU8WH+5,0        IF 8 WEEKS IS CHECKED                        
         BE    VINM203                                                          
         LA    R2,INMMU8WH                                                      
         CLI   TGMENAME,C'R'       ONLY VALID FOR RADIO                         
         BNE   ERINMMED                                                         
         AHI   R0,1                BUMP COUNTER                                 
         AHI   R1,1                AND BUMP TYPE                                
         MVC   INMMWKS,=C'8 '                                                   
         OI    INMMWKSH+4,X'08'                                                 
         MVI   INMMWKSH+5,1                                                     
                                                                                
VINM203  CLI   INMMU13H+5,0        IF 13 WEEKS IS CHECKED                       
         BE    VINM204                                                          
         LA    R2,INMMU13H                                                      
         LTR   R0,R0               MUST BE FIRST LENGTH CHECKED                 
         BNE   ERINMINV                                                         
         AHI   R0,1                TYPE IS OK BUT MUST BUMP COUNTER             
         MVC   INMMWKS,=C'13'                                                   
         OI    INMMWKSH+4,X'08'                                                 
         MVI   INMMWKSH+5,2                                                     
                                                                                
VINM204  CLI   INMMU6MH+5,0        IF 6 MONTHS IS CHECKED                       
         BE    VINM205                                                          
         LA    R2,INMMU6MH                                                      
         LTR   R0,R0               MUST BE FIRST LENGTH CHECKED                 
         BNE   ERINMINV                                                         
         CLI   TGMENAME,C'I'       ONLY VALID FOR INTERNET                      
         BL    ERINMMED                                                         
         CLI   TGMENAME,C'N'       AND NEWMEDIA COMMERCIALS                     
         BH    ERINMMED                                                         
         CLI   INMMUDBH+5,0        ONLY VALID FOR DUB PAYMENTS                  
         BE    ERINMINV                                                         
         CLI   TYPE2,UMUS2DS       NOT VALID FOR 2ND TO SHORT                   
         BE    ERINMINV                                                         
         AHI   R0,1                BUMP COUNTER                                 
         AHI   R1,8                AND BUMP TYPE                                
         MVC   INMMWKS,=C'26'                                                   
         NI    INMMWKSH+4,X'F7'                                                 
         MVI   INMMWKSH+5,0                                                     
                                                                                
VINM205  CLI   INMMU1YH+5,0        IF 1 YEAR IS CHECKED                         
         BE    VINM206                                                          
         LA    R2,INMMU1YH                                                      
         LTR   R0,R0               MUST BE FIRST LENGTH CHECKED                 
         BNE   ERINMINV                                                         
         CLI   TGMENAME,C'I'       TO INTERNET                                  
         BL    ERINMMED                                                         
         CLI   TGMENAME,C'N'       AND NEWMEDIA COMMERCIALS                     
         BH    ERINMMED                                                         
         CLI   INMMUDBH+5,0        ONLY VALID FOR DUB PAYMENTS                  
         BE    ERINMINV                                                         
         CLI   TYPE2,UMUS2DS       NOT VALID FOR 2ND TO SHORT                   
         BE    ERINMINV                                                         
         AHI   R0,1                BUMP COUNTER                                 
         AHI   R1,9                AND BUMP TYPE                                
         MVC   INMMWKS,=C'52'                                                   
         NI    INMMWKSH+4,X'F7'                                                 
         MVI   INMMWKSH+5,0                                                     
                                                                                
VINM206  STC   R1,TYPE2            SAVE TYPE                                    
         LTR   R0,R0               AND ENSURE AT LEAST 1 LENGTH IS              
         BNE   VINM207             CHECKED                                      
         LA    R2,INMMU8WH                                                      
         B     ERINMMIS                                                         
                                                                                
VINM207  GOTOR VALCYC,DMCB,INMMUSTH,INMMWKSH,MUSDATE                            
                                                                                
VINM210  LA    R2,INMNOBMH         NON-BROADCAST MUSIC                          
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VINM220                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UNBM                                                        
         GOTOR VALNORM,WORK,TYPE2,('UNBM8WK',INMNBM8H),                +        
               ('UNBM1YR',INMNBM1H),('UNBM2YR',INMNBM2H),(X'FF',1)              
         LA    R2,INMMWKSH                                                      
         CLI   5(R2),0                                                          
         BNE   ERINMINV                                                         
         MVC   INMMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,INMMUSTH,INMMWKSH,MUSDATE                            
                                                                                
VINM220  LA    R2,INMNIMH          INTERNET/NEW MEDIA MUSIC                     
         GOTOR MINCHK,DMCB,3                                                    
         CLI   5(R2),0                                                          
         BE    VINM225                                                          
         CLI   TGMENAME,C'I'                                                    
         BL    ERINMMED                                                         
         CLI   TGMENAME,C'N'                                                    
         BH    ERINMMED                                                         
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UNIM                                                        
         GOTOR VALNORM,WORK,TYPE2,('UNIM8WK',INMNIM8H),                +        
               ('UNIM6MO',INMNIM6H),('UNIM1YR',INMNIM1H),(X'FF',1)              
         MVC   INMMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,INMMUSTH,INMMWKSH,MUSDATE                            
                                                                                
VINM225  LA    R2,INMMBOH          ALL MEDIA BUYOUT                             
         GOTOR MINCHK,DMCB,2                                                    
         CLI   5(R2),0                                                          
         BE    VINM230                                                          
         BRAS  RE,OK2CHK                                                        
         MVI   USE2,UMBO                                                        
         GOTOR VALNORM,WORK,TYPE2,('UMBOI1Y',INMMBOIH),                +        
               ('UMBOR1Y',INMMBORH),(X'FF',1)                                   
         MVC   INMMUST+8(9),SPACES                                              
         GOTOR VALCYC,DMCB,INMMUSTH,INMMWKSH,MUSDATE                            
                                                                                
VINM230  CLI   INMMUSTH+5,0        IF MUSIC CYCLE START DATE INPUTTED           
         BE    VINM240                                                          
         LA    R2,INMMUSH                                                       
         BRAS  RE,ANYCHK           ONE MAJOR MUST HAVE BEEN CHECKED             
                                                                                
VINM240  LA    R2,INMCCSTH                                                      
         CLI   5(R2),0             EITHER REGULAR CYCLE START DATE OR           
         BNE   VINM300             MUSIC CYCLE START DATE MUST BE               
         CLI   INMMUSTH+5,0        ENTERED                                      
         BE    ERINMMIS                                                         
                                                                                
VINM300  CLI   INMMUSTH+5,0        IF MUSIC CYCLE DATES PRESENT                 
         BE    VINM302                                                          
         CLI   USE2,UNBM           AND USE IS NOT NON-BROADCAST MUSIC           
         BE    VINM302                                                          
         CLI   USE2,UNIM           OR INTERNET/NEW MEDIA MUSIC                  
         BE    VINM302                                                          
         CLI   USE2,UMBO           OR ALL MEDIA BUYOUT                          
         BE    VINM302                                                          
         CLI   INMMU6MH+5,0        OR MUSIC 6 MONTHS                            
         BNE   VINM302                                                          
         CLI   INMMU1YH+5,0        OR MUSIC 1 YEAR                              
         BNE   VINM302                                                          
         LA    R2,INMMWKSH         MUSIC CYCLE MUST BE FILLED IN                
         GOTO1 ANY                 BY THIS POINT                                
                                                                                
VINM302  LA    R2,INMAPPSH                                                      
         GOTOR APPSESS                                                          
                                                                                
         LA    R2,INMAPPHH                                                      
         GOTOR APPHLD                                                           
                                                                                
VINM320  GOTO1 NAMIN,DMCB,TACMELQ,(X'80',INMAPPCH),TACMTYPA  APPLY COMM         
VINMX    XIT1                                                                   
                                                                                
*              VALINM'S ERROR MESSAGES AND LITERALS                             
                                                                                
ERINMMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     ERINMX                                                           
ERINMINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         B     ERINMX                                                           
ERINMMED MVI   ERROR,ERUSEMED      INVALID USE FOR MEDIA                        
         B     ERINMX                                                           
ERINVCOU MVC   MYMSGNO,=Y(ERINVUCO)                                             
         MVI   BLOCK,0             INVALID USE FOR COMMERCIAL                   
         MVI   MYMTYP,GTMERR                                                    
         OI    GENSTAT2,USGETTXT                                                
ERINMX   GOTO1 EXIT,DMCB,0                                                      
                                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO VALIDATE SESSION SCREEN                               
         SPACE 1                                                                
VALSES   NTR1  BASE=*,LABEL=*                                                   
         CLI   ACTNUM,ACTADD       IF ACTION ADD                                
         BNE   VSES05                                                           
         L     R4,ADCREC           SAVE KEY INTO DC RECORD                      
         MVC   TLDCADV-TLDCD(L'TGADV,R4),TGADV                                  
         SPACE 1                                                                
VSES05   L     R4,AIO                                                           
         MVI   ELCODE,TACSELQ      REMOVE FILM AND RECORD                       
         GOTO1 REMELEM             STUDIO ELEMENTS                              
         SPACE 1                                                                
         MVI   ELCODE,TACSTYPF     REBUILD FILM STUDIO ELEMENT (OPT)            
         GOTO1 BLDSTU,DMCB,SDSFDTEH,SDSFSTUH,SDSFCITH                           
         SPACE 1                                                                
         MVI   ELCODE,TACSTYPR     REBUILD FILM RECORD ELEMENT (OPT)            
         GOTO1 BLDSTU,DMCB,SDSRDTEH,SDSRSTUH,SDSRCITH                           
         SPACE 1                                                                
         CLI   PFAID,16            IF DELETE OR RESTORE PFKEY HIT               
         BNE   *+8                                                              
         BAS   RE,DORPFK           SET SEQUENCE NUMBER FOR CAST MEMBER          
         SPACE 1                                                                
         MVC   AIO,ADCREC          IOAREA TO ADVICE CAST DETAILS                
         XC    SEQTAB,SEQTAB                                                    
         CLI   ACTNUM,ACTADD                                                    
         BE    VSES06                                                           
         GOTOR TADCREC,DMCB,SEQTAB   GET THE RECORD                             
         BE    VSES10                                                           
         USING TLDCD,R3                                                         
VSES06   L     R3,AIO              SET UP NEW ADVICE CAST RECORD                
         MVC   TLDCKEY,ADVKEY                                                   
         MVI   TLDCKEY,TLDCCDQ                                                  
         MVC   TLDCLEN,DATADISP                                                 
         XC    TLDCSTAT(10),TLDCSTAT                                            
VSES10   BAS   RE,RESTCAST         AND ADD REMAIN. COMML CAST IF NEC.           
         SPACE                                                                  
         MVI   ELCODE,TAVCELQ      ELCODE=CAST DETAIL EL. CODE                  
         MVI   PAGEMAX,PMAXSESS    N'LINES/PAGE FOR SESSION SCREEN              
         MVC   PAGELNQ,=AL2(LINLNQ)  L'LINE                                     
         LA    R3,SDSFRSTH         R3=A(FIRST CAST LINE)                        
         GOTOR BLDPAGE,DMCB,LIN1STH,LINLSTH  BLD CAST ELS.                      
         CLI   PFAID,16                                                         
         BNE   *+8                                                              
         MVI   PFAID,0                                                          
         SPACE                                                                  
         MVC   KEY,ADVKEY          RESTORE CORRECT KEY                          
         MVC   AIO,AIO1            RESTORE IOAREA                               
         OI    STATUS,REREAD       SET MAY NEED TO REREAD ADVICE REC            
VALSESX  XIT1                                                                   
         SPACE 2                                                                
*        ROUTINE TO BUILD/ADD A COMMERCIAL STUDIO ELEMENT                       
         SPACE                                                                  
* ON ENTRY ... 0(R1) = A(DATE'S SCREEN FIELD)                         *         
*              4(R1) = A(STUDIO'S SCREEN FIELD)                       *         
*              8(R1) = A(CITY'S SCREEN FIELD)                         *         
*              BYTE = ELEMENT TYPE (TACSTYPF FOR FILM)                *         
*                                  (TACSTYPR FOR RECORD)              *         
         SPACE                                                                  
BLDSTU   NTR1                                                                   
         LM    R2,R4,0(R1)         R2=A(DATE), R3=A(STUDIO), R4=A(CITY)         
         GOTO1 FLDVAL,DMCB,(X'80',(R2)),(R4)  IF ALL FIELDS EMPTY ...           
         BE    BSTUX                          DO NOTHING                        
         SPACE                                                                  
         GOTO1 DTVAL,DMCB,TGDUB    ELSE VALIDATE DATE (SAVE FOR LATER)          
         LR    R2,R3                                                            
         CLI   5(R2),0             INSURE OTHER FIELDS HAVE INPUT               
         BE    ERSESMIS                                                         
         LR    R2,R4                                                            
         CLI   5(R2),0                                                          
         BE    ERSESMIS                                                         
         SPACE                                                                  
         XC    ELEMENT,ELEMENT     BUILD ELEMENT                                
         LA    R5,ELEMENT                                                       
         USING TACSD,R5                                                         
         MVI   TACSEL,TACSELQ                                                   
         MVI   TACSLEN,TACSLNQ                                                  
         MVC   TACSTYPE,ELCODE     ELEMENT TYPE                                 
         MVC   TACSDATE,TGDUB      DATE                                         
         MVC   TACSSTUD,8(R3)      STUDIO                                       
         OC    TACSSTUD,SPACES                                                  
         MVC   TACSCITY,8(R4)      CITY                                         
         OC    TACSCITY,SPACES                                                  
         MVC   TACSSTAT,SPACES     STATE                                        
         SPACE                                                                  
         ZIC   R2,0(R4)                                                         
         AR    R2,R4                                                            
         ZIC   R4,0(R2)                                                         
         AR    R2,R4                                                            
         CLC   =C'FD',8(R2)                                                     
         BE    ERSESINV                                                         
         MVC   TACSSTAT,8(R2)                                                   
         OC    TACSSTAT,SPACES                                                  
         CLC   TACSSTAT,SPACES                                                  
         BE    BSTU10                                                           
         MVC   WORK(2),8(R2)                                                    
         MVI   WORK+2,C' '                                                      
         GOTO1 TAXVAL,DMCB,(3,WORK)                                             
         BE    BSTU10                                                           
         MVC   TGCTRY,=C'CA'                                                    
         GOTO1 TAXVAL,DMCB,(X'FF',WORK)                                         
         BNE   ERSESINV                                                         
         SPACE                                                                  
BSTU10   GOTO1 ADDELEM             ADD THE ELEMENT                              
BSTUX    B     VALSESX                                                          
         SPACE 2                                                                
*              ROUTINE TO GET SEQUENCE NUMBER FOR CAST MEMBER                   
*              BEING DELETED OR RESTORED                                        
         SPACE 1                                                                
DORPFK   NTR1                                                                   
         MVI   DORSEQ,0            PRE CLEAR SEQUENCE NUMBER                    
         LH    RF,CURDISP                                                       
         AR    RF,RA               RF=A(CURRENT CURSOR DISPLACEMENT)            
         LA    R3,SDSFRSTH         R3=A(FIRST CAST LINE)                        
         LA    R1,PMAXSESS         N'LINES/PAGE FOR SESSION SCREEN              
         SPACE 1                                                                
DORPFK5  CR    RF,R3               IF NOT WITHIN CAST LINE                      
         BL    DORPFK8                                                          
         AHI   R3,LINLNQ           BUMP TO NEXT LINE                            
         BCT   R1,DORPFK5          LOOP                                         
         SPACE 1                                                                
DORPFK8  LA    RE,PMAXSESS                                                      
         SR    RE,R1                                                            
         LTR   RE,RE                                                            
         BZ    ERSESPFK            PFKEY INVALID                                
         SPACE 1                                                                
         BCTR  RE,0                                                             
         ZIC   R1,FRSTSEQ          GET FIRST SEQUENCE NUMBER FOR SCREEN         
         AR    RE,R1               ADD RELATIVE SEQUENCE NUMBER                 
         STC   RE,DORSEQ           SET SEQUENCE NUMBER OF CAST MEMBER           
         B     VALSESX                                                          
         SPACE 2                                                                
*              ROUTINE TO PULL THE REST OF THE CAST FROM THE COMML              
         SPACE 1                                                                
RESTCAST NTR1                                                                   
         CLI   ACTNUM,ACTADD       IF ADD                                       
         BNE   RCSTX                                                            
         ZIC   R2,NCAST                                                         
         CH    R2,=Y(PMAXSESS)     AND MORE ACTUAL CAST TO ADD                  
         BNH   RCSTX                                                            
         SPACE 1                                                                
         MVC   AIO,AIO3            SET IOAREA FOR CAST RECORDS                  
         LA    R2,1                                                             
         XC    KEY,KEY             READ HIGH FOR CAST RECORDS                   
         MVI   KEY,TLCACDQ                                                      
         MVC   KEY+TLCACOM-TLCAD(L'TLCACOM),TGCOM                               
         GOTO1 HIGH                                                             
         B     RSTCST10                                                         
         SPACE 1                                                                
RSTCST5  GOTO1 SEQ                 READ SEQUENTIAL                              
RSTCST10 CLC   KEY(TLCASORT-TLCAKEY),KEYSAVE                                    
         BNE   RSTCST20                                                         
         TM    KEY+TLCASORT-TLCAKEY,X'80'                                       
         BO    RSTCST5                                                          
         TM    AGYSTA4,TAAYAEXT                                                 
         BNZ   RSTCST12                                                         
         TM    KEY+TLCASORT-TLCAKEY,X'20'                                       
         BO    RSTCST5                                                          
RSTCST12 CH    R2,=Y(PMAXSESS)     IF PAST FIRST SCREENFUL OF CAST              
         BNH   RSTCST15                                                         
         SPACE 1                                                                
         GOTO1 GETREC              GET THE CAST RECORD                          
         GOTOR CVTAVC              CONVERTS TACAD TO TAVCD                      
         GOTOR MYADDL                                                           
RSTCST15 LA    R2,1(R2)            BUMP SEQUENCE NUMBER                         
         B     RSTCST5             AND LOOK FOR MORE CAST                       
         SPACE 1                                                                
RSTCST20 LA    R2,PMAXSESS+1       START WITH FIRST SEQUENCE ADDED              
         ZIC   R5,NCAST            R5=A(TOTAL N'CAST MEMBERS)                   
         SPACE 1                                                                
RSTCST25 STC   R2,BYTE                                                          
         MVI   ELCODE,TAVCELQ                                                   
         MVC   AIO,ADCREC                                                       
         GOTO1 GETL,DMCB,(1,BYTE)                                               
         MVC   AIO,AIO3                                                         
         BNE   RSTCST30                                                         
         SPACE 1                                                                
         L     R4,TGELEM                                                        
         USING TAVCD,R4                                                         
         MVC   TAVCNAME,=CL26'** NOT FOUND **'                                  
         EDIT  TAVCSSN,TGSSN,FILL=0                                             
         GOTO1 RECVAL,DMCB,TLW4CDQ,(X'88',0),0                                  
         BNE   RSTCST30                                                         
         MVC   TAVCNAME,TGNAME                                                  
RSTCST30 LA    R2,1(R2)                                                         
         CR    R2,R5                                                            
         BNH   RSTCST25                                                         
         MVC   AIO,ADCREC          RESET IO                                     
RCSTX    B     VALSESX                                                          
         SPACE 2                                                                
*              VALSES'S ERROR MESSAGES AND LITERALS                             
         SPACE 1                                                                
ERSESINV MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         B     ERSESX                                                           
ERSESMIS MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     ERSESX                                                           
ERSESPFK MVI   ERROR,ERINVPFF                                                   
ERSESX   L     R2,ATWA             RETURN CURSOR TO SPOT WHERE IT WAS           
         AH    R2,CURDISP                                                       
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
         SPACE 2                                                                
*              ROUTINE TO CONVERT CAST DETAILS TO ADVICE CAST DETAILS           
*              NTRY (R2)=SEQ NUM/XIT ELEMENT                                    
         SPACE 1                                                                
CVTAVC   NTR1  BASE=*,LABEL=*                                                   
         L     R3,AIO              R3=A(CAST RECORD)                            
         USING TLCAD,R3                                                         
         LR    R4,R3                                                            
         MVI   ELCODE,TACAELQ                                                   
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         SPACE 1                                                                
         USING TACAD,R4            R4=A(CAST DETAILS ELEMENT)                   
         XC    ELEMENT,ELEMENT     PRE CLEAR ELEMENT TO ADD                     
         LA    R5,ELEMENT          R5=A(ADVICE DETAILS ELEMENT)                 
         USING TAVCD,R5                                                         
         MVI   TAVCEL,TAVCELQ      ELEMENT CODE                                 
         MVI   TAVCLEN,TAVCLNQ     ELEMENT LENGTH                               
         STC   R2,TAVCSEQ          SEQUENCE NUMBER                              
         SPACE 1                                                                
         PACK  DUB,TLCASSN         PACK S/S NUMBER                              
         CVB   R1,DUB                                                           
         ST    R1,TAVCSSN          SAVE AS BINARY IN EL.                        
         SPACE 1                                                                
         GOTO1 CATVAL,DMCB,TLCACAT                                              
         BNE   *+10                                                             
         MVC   TAVCCAT,TGCAEQU     SAVE CATEGORY EQUATE IN EL.                  
         SPACE 1                                                                
         GOTO1 UNIVAL,DMCB,TACAUN                                               
         BNE   *+16                                                             
         MVC   TAVCUNI,TGUNEQU     SAVE UNION EQUATE IN EL.                     
         MVC   TAVCUNI3,TACAUN                                                  
         SPACE 1                                                                
         OI    TAVCSTAT,TAVCNEWS   MARK AS A NEW STYLE TAVC ELEMENT             
         SPACE 1                                                                
         MVC   TAVCDBL,TACADBL     DOUBLES                                      
         OI    TAVCSTAT,TAVCACTL   INDICATE ACTUAL CAST MEMBER                  
         CLC   =C'ON ',TACAONOF    CAMERA (ON/OFF)                              
         BNE   *+8                                                              
         OI    TAVCSTAT,TAVCSON    SET STATUS ON CAMERA                         
         MVC   TAVCOV2,TACAOV2     OVERSCALE RATE 2                             
         TM    TACASTAT,TACASTLO   IF ONLY ON LIFT                              
         BZ    *+12                                                             
         OI    TAVCSTAT,TAVCOLFT   SET STATUS ONLY ON LIFT                      
         B     CVTAVC10                                                         
         TM    TACASTAT,TACASTLF   ELSE IF ON LIFT                              
         BZ    *+8                                                              
         OI    TAVCSTAT,TAVCLFT    THEN SET STATUS ON LIFT                      
         SPACE 1                                                                
CVTAVC10 LR    R4,R3                                                            
         MVI   ELCODE,TAOPELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   CVTAVC20                                                         
         USING TAOPD,R4            R4=A(CAST OVERSCALE PERCENT ELEMENT)         
         CLI   TAOPNUM,1           IF ONLY ONE PERCENTAGE DEFINED               
         BNE   CVTAVC20                                                         
         MVC   TAVCOV1,TAOPPCT     THEN SET OVERSCALE RATE 1                    
         SPACE 1                                                                
CVTAVC20 LR    R4,R3                                                            
         MVI   ELCODE,TAO2ELQ                                                   
         BRAS  RE,GETEL                                                         
         BNE   CVTAVCX                                                          
         USING TAO2D,R4            R4=A(CAST OVERSCALE 2ND PCT ELEMENT)         
         CLI   TAO2NUM,1           IF ONLY ONE PERCENTAGE DEFINED               
         BNE   CVTAVCX                                                          
         MVC   TAVCOV2,TAO2PCT     THEN SET OVERSCALE RATE 2                    
CVTAVCX  XIT1                                                                   
         DROP  R3,R4,R5                                                         
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE CALLED WHEN MAJOR IS CHECKED OFF                         
         SPACE                                                                  
* ON ENTRY ... R2=A(HEADER OF CHECKED OFF MAJOR FIELD)                          
         SPACE 1                                                                
OK2CHK   CLI   CHKSTAT,1           IF ANOTHER MAJOR PREVIOUSLY CHECKED          
         JE    BRASINV             ... ERROR                                    
         MVI   CHKSTAT,1           SET MAJOR PREVIOUSLY CHECKED                 
         SPACE 1                                                                
         CLI   TYPECHK1,C'X'                                                    
         JNE   *+12                                                             
         ST    R2,TYPECHK1         SAVE ADDRESS OF REGULAR USE FIELD            
         J     *+8                 IN TYPECHK - SAVE ADDRESS OF MUSIC           
         ST    R2,TYPECHK2         USE FIELD IN TYPECHK+4                       
         SPACE 1                                                                
         L     R2,CHKDATE                                                       
         CLI   5(R2),0                                                          
         JE    BRASMIS                                                          
         BR    RE                                                               
         SPACE 2                                                                
*              ROUTINE CALLED AT END OF EACH CYCLE START DATE                   
*              SECTION TO MAKE SURE 1 MAJOR HAS BEEN CHECKED OFF                
         SPACE 1                                                                
ANYCHK   CLI   CHKSTAT,0           IF CHKSTAT STILL CLEAR ... ERROR             
         JE    BRASMIS                                                          
         BR    RE                                                               
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR OK2CHK AND ANYCHK                
         SPACE 1                                                                
BRASMIS  MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         J     *+8                                                              
BRASINV  MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE VALIDATES NY,LA,CHI FIELDS                               
*              ASSUMES FIELDS APPEAR IN THAT ORDER                              
         SPACE 1                                                                
* ON ENTRY ... R2=A(NY FIELD HEADER)                                  *         
         SPACE 1                                                                
* ON EXIT ... CONDITION CODE SET TO YES IF NONE CHECKED               *         
*             CONDITION CODE SET TO NO IF ANY CHECKED                 *         
         SPACE 1                                                                
VALNLC   NTR1  BASE=*,LABEL=*                                                   
         CLI   5(R2),0             IF NY CHECKED ...                            
         BE    VNLC10              SAVE INTO MAJOR                              
         OI    MAJOR,NY                                                         
         SPACE 1                                                                
VNLC10   ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)            IF LA CHECKED ...                            
         AR    R2,RE               SAVE INTO MAJOR                              
         CLI   5(R2),0                                                          
         BE    VNLC20                                                           
         OI    MAJOR,LA                                                         
         SPACE 1                                                                
VNLC20   ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         ZIC   RE,0(R2)            IF CHI CHECKED ...                           
         AR    R2,RE               SAVE INTO MAJOR                              
         CLI   5(R2),0                                                          
         BE    VNLC30                                                           
         OI    MAJOR,CHI                                                        
VNLC30   CLI   MAJOR,0                                                          
         XIT1                                                                   
         EJECT                                                                  
*              ROUTINE TO VALIDATE UPGRADE FIELD                                
         SPACE 1                                                                
* ON ENTRY ... R2=A(UPGRADE FIELD HEADER)                             *         
         SPACE 1                                                                
* ON EXIT ... IF UPGRADE INPUT IS C'Y' OR C'F' RETURN C'Y' IN UPGR    *         
*         ... IN INPUT IS C'N' OR BLANK ... RETURN C'N' IN UPGR       *         
         SPACE 1                                                                
VALUPG   NTR1  BASE=*,LABEL=*                                                   
         CLI   8(R2),C'Y'          IF UPGRADE FIELD HAS A Y IN IT               
         BNE   *+8                                                              
         MVI   UPGR,C'Y'           MOVE Y INTO UPGR                             
         SPACE 1                                                                
         CLI   LWRSCR,SCR98                                                     
         BE    VUPG05                                                           
         TM    4(R2),X'20'         IF FIELD PREVIOUSLY VALIDATED                
         BO    VALUPGX             EXIT                                         
         SPACE 1                                                                
VUPG05   MVI   UPGR,C'N'           IF NO INPUT IN UPGRADE FIELD                 
         CLI   5(R2),0             RETURN 'N' IN UPGR                           
         BE    VALUPGX                                                          
         SPACE 1                                                                
         CLI   8(R2),C'N'          IF C'N' INPUTTED IN UPGRADE FIELD            
         BE    VALUPGX             RETURN 'N' IN UPGR                           
         SPACE 1                                                                
         MVI   UPGR,C'Y'                                                        
         CLI   8(R2),C'Y'          IF UPGRADE INPUT IS C'Y'                     
         BNE   VUPINV              RETURN 'Y' IN UPGR                           
         SPACE 1                                                                
         CLI   LWRSCR,SCR98                                                     
         BNE   VUPG06                                                           
         GOTOR BLDMKTS,DMCB,CBLDT1H,CBLCDLH                                     
         GOTOR CCBLUNIT,DMCB,USE1                                               
         EDIT  UNITCALC,CBLCAUN,ZERO=NOBLANK                                    
         MVC   SVUNITS,UNITCALC+2                                               
         SPACE 1                                                                
VUPG06   MVI   ELCODE,TAUPELQ      DELETE OLD UPGRADE ELEMENT                   
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
         CLI   USE1,ULCB           LOCAL CABLE UPGRADE                          
         BE    VALUPGX                                                          
         CLI   USE1,UACB           AND ADDENDUM CABLE UPGRADE                   
         BE    VALUPGX             VALIDATED ELSEWHERE                          
         SPACE 1                                                                
         MVC   TEMPMAJ,MAJOR       SAVE MAJORS AND UNITS                        
         MVC   TEMPUNI,SVUNITS                                                  
         SPACE 1                                                                
         CLI   USE1,USNW           ONLY ONE OF THE UPGRADE FIELDS               
         BNE   VUPG10              FOR SPANISH NETWORK/WILDSPOT                 
         CLI   TYPE1,USNWREG       COMBINED MAY BE CHECKED                      
         BNE   VUPINV                                                           
         SPACE 1                                                                
VUPG10   GOTO1 USEVAL,DMCB,(X'80',USE1),(X'80',TYPE1)                           
         XC    HALF,HALF                                                        
         GOTO1 UPGRVAL,DMCB,TGUSCDE,TGUSTYP                                     
         L     RE,0(R1)                                                         
         MVC   TGUPFRCD,0(RE)      SAVE 'UPGRADE FROM' CODE                     
         L     RE,4(R1)                                                         
         MVC   TGUPFRTY,0(RE)      AND 'UPGRADE TO' CODE                        
         SPACE 1                                                                
         MVI   TGBYTE,C'N'         SET HAVEN'T TRIED PREV AGY/COMM'L            
         SPACE 1                                                                
         MVC   AIO,AIO3                                                         
         LA    R3,KEY              BUILD PARTIAL KEY FOR RECORD                 
         USING TLUHD,R3                                                         
         XC    TLUHKEY,TLUHKEY                                                  
         MVI   TLUHCD,TLUHCDQ      RECORD CODE                                  
         MVC   TLUHCOM,TGCOM       INTERNAL COMMERCIAL NUMBER                   
         MVC   TLUHCSEQ,HALF       CAST INPUT SEQ NUMBER                        
         MVC   TLUHUSE,TGUPFRCD    "FROM" USE CODE                              
         GOTO1 HIGH                GET DIRECTORY RECORD                         
         B     VUPG30                                                           
         SPACE 1                                                                
VUPG20   GOTO1 SEQ                 GET NEXT DIRECTORY RECORD                    
VUPG30   CLC   TLUHKEY(TLUHINV-TLUHD),KEYSAVE  DID WE FIND REC FOR USE          
         BE    VUPG40                                                           
         CLI   TGBYTE,C'Y'         IF HAVEN'T TRIED PREV AGY/COMM'L YET         
         BNE   *+8                                                              
         BAS   RE,NOPREVR                                                       
         MVI   TGBYTE,C'Y'         SET HAVE TRIED PREV AGY/COMM'L               
         BAS   RE,TRYOCEL          AND GO TRY IT                                
         BE    VUPG40                                                           
         BAS   RE,NOPREVR                                                       
         MVC   UPGFLD,=4X'FF'                                                   
         B     VUPG60                                                           
         SPACE 1                                                                
VUPG40   GOTO1 GETREC              GET THE RECORD                               
         SPACE 1                                                                
         USING TAUHD,R4                                                         
         MVI   ELCODE,TAUHELQ                                                   
         L     R4,AIO                                                           
         BRAS  RE,GETEL            R4=A(USAGE HISTORY ELEMENT)                  
         BNE   VUPG20                                                           
         SPACE                                                                  
         CLC   TAUHTYPE,TGUPFRTY   IF "UPGRADE TO' TYPE MATCHES                 
         BNE   VUPG20                                                           
         CLC   REGDATE,TAUHSTRT    AND IF CYCLE STARTS ARE THE SAME             
         BNE   VUPG20              WE HAVE FOUND CORRECT RECORD                 
         SPACE 1                                                                
VUPG41   CLI   USE1,USNT           IF SPANISH NET/WSP COMB UPGRADING            
         BE    VUPG60              FROM SNT ... NO MORE VALIDATION              
         SPACE 1                                                                
         CLI   LWRSCR,SCR98                                                     
         BNE   VUPG44                                                           
         OC    MAJOR,TAUHMAJ                                                    
         CLI   VERLIFT,C'V'                                                     
         BE    VUPG44                                                           
         MVC   TEMPMAJ,MAJOR                                                    
         SPACE 1                                                                
VUPG44   CLI   VERLIFT,C'V'        IF COMMERCIAL HAS VERSIONS                   
         BNE   VUPG50                                                           
         TM    TGUSSTA3,VERSONLY   AND USE ONLY VALID FOR VERSIONS              
         BZ    VUPG50                                                           
         CLI   MENVERH+5,0         AND VERSION INPUT MISSING                    
         BNE   VUPG45                                                           
         LA    R2,MENVERH                                                       
         ZIC   R1,0(R2)                                                         
         AR    R1,R2                                                            
         ZIC   R0,0(R1)                                                         
         AR    R1,R0                                                            
         ZIC   R0,0(R1)                                                         
         AR    R1,R0                                                            
         NI    6(R1),X'BF'         RETURN ERROR AT VERSION FIELD                
         B     VUPMIS                                                           
VUPG45   OC    MAJOR,TAUHMAJ       OTHERWISE, MERGE INPUTTED MAJORS             
         LH    RE,TAUHCBUN                                                      
         CLI   USE1,UCBL                                                        
         BE    VUPG46                                                           
         CLI   USE1,USCB                                                        
         BE    VUPG46                                                           
         LH    RE,TAUHUNT                                                       
VUPG46   LH    R1,SVUNITS          WITH MAJORS OF LAST PAYMENT AND              
         AR    R1,RE               ADD INPUUTED UNITS TO LAST PAYMENT           
         STH   R1,SVUNITS                                                       
         SPACE                                                                  
VUPG50   CLI   USE1,UWSP           IF USE IS WILDSPOT                           
         BE    VUPG51                                                           
         CLI   USE1,USWS           SPANISH WILDSPOT                             
         BE    VUPG51                                                           
         CLI   USE1,USNW           SPANISH NETWORK/WILDSPOT COMB                
         BE    VUPG51                                                           
         CLI   USE1,UADW           OR ADDENDUM WILDSPOT                         
         BE    VUPG51                                                           
         CLI   USE1,UNET           ACTRA/UDA TV NETWORK                         
         BE    VUPG51                                                           
         CLI   USE1,UWSC           CANADIAN WILDSPOT                            
         BE    VUPG51                                                           
         CLI   USE1,UWSM           OR CANADIAN WILDSPOT COMBINED                
         BNE   VUPG52                                                           
VUPG51   MVC   BYTE,TAUHMAJ        UPGRADE MUST INCLUDE ALL                     
         NC    BYTE,MAJOR          ORIGINAL MAJORS                              
         CLC   BYTE,TAUHMAJ                                                     
         BE    *+8                                                              
         BAS   RE,NUPGR                                                         
         CLI   LWRSCR,SCR98                                                     
         BE    VUPG60                                                           
         CLC   SVUNITS,TAUHUNT     IF UNITS LESS ERROR                          
         BH    VUPG60                                                           
         BE    *+12                                                             
         BAS   RE,NUPGR                                                         
         B     VUPG60                                                           
         CLC   TAUHMAJ,MAJOR                                                    
         BL    VUPG60                                                           
         BAS   RE,NUPGR         IF UNITS EQUAL MAJORS MUST BE MORE              
         B     VUPG60                                                           
         SPACE 1                                                                
VUPG52   CLI   USE1,UCBL           IF USE IS CABLE                              
         BE    VUPG53                                                           
         CLI   USE1,USCB           OR SPANISH CABLE                             
         BE    VUPG53                                                           
         DC    H'00'                                                            
VUPG53   CLI   LWRSCR,SCR98                                                     
         BE    VUPG60                                                           
         CLC   SVUNITS,TAUHCBUN    IF UNITS NOT INCREASED ERROR                 
         BH    *+8                                                              
         BAS   RE,NUPGR                                                         
         SPACE 1                                                                
VUPG60   MVC   AIO,AIO2            RE-READ ADVICE FOR PUT                       
         MVC   KEY,ADVKEY                                                       
         CLI   ACTNUM,ACTADD                                                    
         BE    VUPG60A                                                          
         GOTO1 RECVAL,DMCB,TLDVCDQ,(X'30',0)                                    
VUPG60A  MVC   AIO,AIO1                                                         
         MVI   ELCODE,TAUPELQ      DELETE EXISTING UPGRADE ELEMENT              
         GOTO1 REMELEM                                                          
         XC    ELEMENT,ELEMENT     ADD NEW UPGRADE ELEMENT                      
         USING TAUPD,R5                                                         
         LA    R5,ELEMENT                                                       
         MVI   TAUPEL,TAUPELQ      ELEMENT CODE                                 
         MVI   TAUPLEN,TAUPLNQ     ELEMENT LENGTH                               
         SPACE 1                                                                
         CLI   USE1,UWSP           IF USE IS WILDSPOT                           
         BE    VUPG61                                                           
         CLI   USE1,USWS           SPANISH WILDSPOT                             
         BE    VUPG61                                                           
         CLI   USE1,USNW           SPANISH NETWORK/WILDSPOT COMB                
         BE    VUPG61                                                           
         CLI   USE1,UADW           ADDENDUM WILDSPOT                            
         BE    VUPG61                                                           
         CLI   USE1,UNET           ACTRA/UDA TV NETWORK                         
         BE    VUPG61                                                           
         CLI   USE1,UWSC           CANADIAN WILDSPOT                            
         BE    VUPG61                                                           
         CLI   USE1,UWSM           OR CANADIAN WILDSPOT COMBINED                
         BE    VUPG61                                                           
         CLI   USE1,USNT           IF SPANISH NET/WSP COMB UPGRADING            
         BE    VUPG70              FROM SNT ... ELEMENT DONE                    
         CLC   UPGFLD,=4X'FF'                                                   
         BE    VUPG70                                                           
         B     VUPG62                                                           
VUPG61   MVC   TAUPIUNT,TAUHUNT    SAVE INITIAL UNITS                           
         MVC   TAUPIMAJ,TAUHMAJ         INITIAL MAJORS                          
         B     VUPG70                                                           
         SPACE 1                                                                
VUPG62   MVC   TAUPICBU,TAUHCBUN   IF USE IS CABLE OR SPAN CABLE                
         B     VUPG70              SAVE INITIAL UNITS                           
         SPACE 1                                                                
VUPG63   MVC   TAUPICBU,TAUHUNT    SAVE INITIAL UNITS                           
         B     VUPG70                                                           
VUPG70   GOTO1 ADDELEM             ADD ELEMENT                                  
         MVC   MAJOR,TEMPMAJ       AND RESTORE MAJORS AND UNITS                 
         MVC   SVUNITS,TEMPUNI                                                  
         NI    STATUS,X'FF'-WAITUPFK                                            
         XC    UPGFLD,UPGFLD                                                    
         OI    4(R2),X'20'                                                      
         CLI   SELECT,C'Y'                                                      
         BNE   VUPG80                                                           
         CLI   THISLSEL,C'C'                                                    
         BNE   VUPG80                                                           
         MVI   PFAID,14                                                         
         TM    STATUS,WAITLPFK                                                  
         BZ    VALUPGX                                                          
         MVI   PFAID,20                                                         
         B     VALUPGX                                                          
VUPG80   CLI   PFAID,14                                                         
         BE    VALUPGX                                                          
*        MVI   PFAID,0                                                          
VALUPGX  XIT1                                                                   
         DROP  R5                                                               
         SPACE 2                                                                
*              ROUTINE TO USE TAOCEL TO GET USAGE HISTORY RECORD                
*              FOR COMML'S COPIED WITH HISTORY                                  
*              SETS CC EQUAL IF FINDS UH, ELSE CC NOT EQ                        
TRYOCEL  NTR1                                                                   
         L     R4,AELTAOC                                                       
         OC    0(TAOCLNQ,R4),0(R4)      TEST HAVE TAOCEL                        
         BZ    TRYNO                                                            
         USING TAOCD,R4                                                         
         TM    TAOCSTAT,TAOCSFRO   TEST IT'S STATUS IS FROM                     
         BZ    TRYNO                                                            
         MVC   KEY,KEYSAVE                                                      
         MVC   TLUHCOM,TAOCCOM     FROM INTERNAL COMMERCIAL NUMBER              
         GOTO1 HIGH                GET DIRECTORY RECORD                         
         SPACE 1                                                                
         CLC   TLUHKEY(TLUHINV-TLUHD),KEYSAVE  DID WE FIND REC FOR USE          
         BNE   TRYNO                                                            
         XR    RC,RC               SET CC                                       
TRYNO    LTR   RC,RC                                                            
         B     VALUPGX                                                          
         DROP  R4                                                               
         EJECT                                                                  
NUPGR    NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    NUPG                                                             
         CLI   PFAID,20                                                         
         BNE   NUPG                                                             
         B     VALUPGX                                                          
         SPACE 2                                                                
NOPREVR  NTR1                                                                   
         TM    STATUS,WAITUPFK                                                  
         BZ    NOPREV                                                           
         CLI   PFAID,20                                                         
         BNE   NOPREV                                                           
         B     VALUPGX                                                          
*              ERROR MESSAGES AND LITERALS FOR VALUPG                           
         SPACE 1                                                                
VUPMIS   MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     VUPEND                                                           
VUPINV   MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         B     VUPEND                                                           
NOPREV   MVI   MYMSGNO1,91         NO PREVIOUS PAYMENT                          
         B     *+8                                                              
NUPG     MVI   MYMSGNO1,92         NOT AN UPGRADE                               
         OI    GENSTAT2,USGETTXT                                                
         ST    R2,UPGFLD                                                        
         OI    STATUS,WAITUPFK                                                  
VUPEND   GOTO1 EXIT,DMCB,0                                                      
         SPACE 1                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE VALIDATES UNIT FIELD                                     
         SPACE 1                                                                
* ON ENTRY ... R2=A(UNITS FIELD HEADER)                               *         
         SPACE 1                                                                
VALUNIT  NTR1  BASE=*,LABEL=*                                                   
         CLI   5(R2),0             UNITS MUST BE ENTERED                        
         BE    VUMIS                                                            
         TM    4(R2),X'08'         MUST BE NUMERIC                              
         BZ    VUINV                                                            
         SPACE 1                                                                
         ZIC   RE,5(R2)            CONVERT TO BINARY AND STORE IN               
         BCTR  RE,0                SVUNITS                                      
         EX    RE,*+8                                                           
         B     *+10                                                             
         PACK  DUB,8(0,R2)                                                      
         CVB   RE,DUB                                                           
         STH   RE,SVUNITS                                                       
         XIT1                                                                   
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR VALUNIT                          
         SPACE 1                                                                
VUMIS    MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     *+8                                                              
VUINV    MVI   ERROR,INVALID       INVALID INPUT FIELD                          
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE TO ENSURE SOMETHING CHECKED OFF AFTER MAJOR              
         SPACE 1                                                                
* ON ENTRY ... R2=A(CHECKED MAJOR FIELD HEADER)                       *         
*              4(R1)=#OF MINOR FIELDS FOLLOWING CHECKED OFF MAJOR               
         SPACE 1                                                                
MINCHK   NTR1  BASE=*,LABEL=*                                                   
         CLI   5(R2),0             IF MAJOR NOT INPUTTED                        
         BNE   MINCHKX                                                          
         SPACE 1                                                                
         ZIC   R4,3(R1)            R4=# OF MINORS FOR MAJOR                     
         LR    R3,R2               KEEP R2 POINTED A MAJOR                      
         ZIC   RE,0(R3)                                                         
         AR    R3,RE                                                            
MINCHK10 ZIC   RE,0(R3)                                                         
         AR    R3,RE                                                            
         TM    1(R3),X'20'         BUMP PAST PROTECTED FIELDS                   
         BO    MINCHK10                                                         
         CLI   5(R3),0             IF ANY MINOR INPUTTED EXIT                   
         BNE   MCHKERR                                                          
         BCT   R4,MINCHK10                                                      
MINCHKX  XIT1                                                                   
         SPACE 1                                                                
MCHKERR  CLI   CHKSTAT,1                                                        
         BNE   MCHKMIS                                                          
         LR    R2,R3                                                            
         MVI   ERROR,INVALID                                                    
         B     *+8                                                              
MCHKMIS  MVI   ERROR,MISSING                                                    
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE TO VALIDAT APPLY SESSION FIELD                           
         SPACE 1                                                                
APPSESS  NTR1  BASE=*,LABEL=*                                                   
         CLI   5(R2),0               IF NO INPUT ... EXIT                       
         BE    APPSESSX                                                         
         CLI   8(R2),C'Y'            IF NOT C'Y' OR C'N' ... INVALID            
         BE    *+12                                                             
         CLI   8(R2),C'N'                                                       
         BNE   SESSINV                                                          
         MVC   APPLYS,8(R2)          SAVE INTO TEMPTAVU                         
APPSESSX XIT1                                                                   
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR APPSESS                          
         SPACE 1                                                                
SESSINV  MVI   ERROR,INVALID                                                    
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
*              ROUTINE TO VALIDATE APPLY HOLDING FEE FIELD                      
         SPACE 1                                                                
APPHLD   NTR1  BASE=*,LABEL=*                                                   
         CLI   5(R2),0               IF NO INPUT ... EXIT                       
         BE    APPHLDX                                                          
         CLI   8(R2),C'Y'            IF NOT C'Y' OR C'N' ... INVALID            
         BE    *+12                                                             
         CLI   8(R2),C'N'                                                       
         BNE   HLDINV                                                           
         MVC   APPLYH,8(R2)          SAVE INTO TEMPTAVU                         
APPHLDX  XIT1                                                                   
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR APPHLD                           
         SPACE 1                                                                
HLDINV   MVI   ERROR,INVALID                                                    
         GOTO1 EXIT,DMCB,0                                                      
         EJECT                                                                  
*              ROUTINE VALIDATES CYCLE DATES/WEEKS                              
         SPACE 1                                                                
VALCYC   NTR1  BASE=*,LABEL=*                                                   
         L     R4,0(R1)            R4=A(CYCLE DATE FIELD)                       
         L     R5,4(R1)            R5=A(CYCLE WEEKS FIELD)                      
         L     R6,8(R1)            R6=A(WHERE TO STORE CYCLE DATES)             
         SPACE 1                                                                
         MVI   BYTE,C'R'           IF CALCULATING A REGULAR CYCLE               
         LA    R3,TELCYSTH+200     SET BYTE TO R                                
         CR    R4,R3                                                            
         BL    *+8                 IF CALCULATING A MUSIC CYCLE                 
         MVI   BYTE,C'M'           SET BYTE TO M                                
         SPACE 1                                                                
         CLI   BYTE,C'R'           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0Y              AND IF REGULAR USE NOT YET SET               
         CLI   USE1,0              AND ON TELEVISION SCREEN                     
         BNE   VCYC0Z              AND DEALER                                   
         CLI   LWRSCR,SCRF0        OR FOREIGN                                   
         BNE   VCYC0A              OR INDUSTRIAL 30 DAY                         
         CLI   TELDEALH+5,0        OR INTERNET CHECKED                          
         BNE   VCYCX               DO NOT CALCULATE CYCLE DATE YET              
         CLI   TELFORUH+5,0                                                     
         BNE   VCYCX                                                            
         CLI   TELINDH+5,0                                                      
         BNE   VCYCX                                                            
         B     VCYC0Z                                                           
         SPACE 1                                                                
VCYC0A   CLI   LWRSCR,SCRF3        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0B              AND IF REGULAR USE NOT YET SET               
         CLI   SPAINDUH+5,0        AND ON SPANISH SCREEN                        
         BNE   VCYCX               AND INDUSTRIAL 30 DAY CHECKED                
         B     VCYC0Z                                                           
         SPACE 1                                                                
VCYC0B   CLI   LWRSCR,SCRF2        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0C              AND IF REGULAR USE NOT YET SET               
         CLI   ADDCSESH+5,0        AND ON ADDENDUM SCREEN                       
         BNE   VCYCX               AND COMBINED SESSION                         
         CLI   ADDWSPTH+5,0        OR WILDSPOT CHECKED OFF                      
         BNE   VCYCX               DO NOT CALCULATE CYCLE DATE YET              
         B     VCYC0Z                                                           
         SPACE 1                                                                
VCYC0C   CLI   LWRSCR,SCRF1        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0D              AND IF REGULAR USE NOT YET SET               
         CLI   RADWSPTH+5,0        AND ON RADIO SCREEN                          
         BNE   VCYCX               AND WILDSPOT                                 
         CLI   RADNETWH+5,0        OR NETWORK                                   
         BNE   VCYCX               OR INDUSTRIAL 30 DAY                         
         CLI   RADDEALH+5,0        OR INTERNET CHECKED                          
         BNE   VCYCX                                                            
         CLI   RADINDRH+5,0        DO NOT CALCULATE CYCLE DATE YET              
         BNE   VCYCX                                                            
         B     VCYC0Z                                                           
         SPACE 1                                                                
VCYC0D   CLI   LWRSCR,SCRF4        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0E              AND IF REGULAR USE NOT YET SET               
         CLI   CANACDFH+5,0        AND ON CANADIAN SCREEN                       
         BNE   VCYCX               AND DORMANCY FEE CHECKED                     
         B     VCYC0Z              DO NOT CALULATE CYCLE DATE YET               
         SPACE 1                                                                
VCYC0E   CLI   LWRSCR,SCR98        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0F              AND IF REGULAR USE NOT YET SET               
         CLI   CBLWSPTH+5,0        AND ON CABLE SCREEN                          
         BNE   VCYCX               AND WILDSPOT                                 
         CLI   CBLAWSPH+5,0                                                     
         BNE   VCYCX               OR ADDENDUM WILDSPOT CHECKED                 
         B     VCYC0Z              DO NOT CALCULATE CYCLE DATE YET              
         SPACE 1                                                                
VCYC0F   CLI   LWRSCR,SCR53        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC0Z              AND IF REGULAR USE NOT YET SET               
         CLI   INMNMRH+5,0         AND ON INTERNET/NEW MEDIA SCREEN             
         BNE   VCYC0Z              DO NOT CALCULATE CYCLE DATE YET              
         CLI   INMSNMH+5,0                                                      
         BNE   VCYC0Z                                                           
         CLI   INMSOMH+5,0                                                      
         BNE   VCYC0Z                                                           
         B     VCYCX                                                            
         SPACE 1                                                                
VCYC0Y   CLI   USE2,0              IF CALCULATING MUSIC CYCLE                   
         BNE   VCYC0Z              AND IF MUSIC USE NOT YET SET                 
         CLI   LWRSCR,SCRF0        AND ON TELEVISION SCREEN                     
         BNE   VCYC0YYY            AND FOREIGN MUSIC CHECKED                    
         CLI   TELFRMUH+5,0        OR NON-BROADCAST MUSIC CHECKED               
         BNE   VCYCX               DO NOT VALIATE CYCLE DATE YET                
         CLI   TELNOBMH+5,0                                                     
         BNE   VCYCX                                                            
         CLI   TELMBOH+5,0                                                      
         BNE   VCYCX                                                            
         B     VCYC0Z                                                           
         SPACE 1                                                                
VCYC0YYY CLI   LWRSCR,SCR98        AND ON CABLE SCREEN                          
         BNE   VCYC0YY             AND MEDIA BUYOUT CHECKED                     
         CLI   CBLMBOH+5,0                                                      
         BNE   VCYCX                                                            
         B     VCYC0Z                                                           
         SPACE 1                                                                
VCYC0YY  CLI   LWRSCR,SCRF4        IF CALCULATING MUSIC CYCLE                   
         BNE   VCYC0YA             AND IF MUSIC USE NOT YET SET                 
         CLI   CANMUSEH+5,0        AND ON CANADIAN SCREEN                       
         BNE   VCYCX               AND MUSIC CHECKED                            
         B     VCYC0Z              DO NOT VALIDATE CYCLE DATE YET               
         SPACE 1                                                                
VCYC0YA  CLI   LWRSCR,SCRF1        IF CALCULATING MUSIC CYCLE                   
         BNE   VCYC0YB             AND IF MUSIC USE NOT YET SET                 
         CLI   RADMUSH+5,0         AND ON RADIO SCREEN                          
         BNE   VCYCX               AND MUSIC                                    
         CLI   RADFMUSH+5,0        OR FIRST MUSIC                               
         BNE   VCYCX               OR FOREIGN MUSIC                             
         CLI   RADFRMUH+5,0        OR NON-BROADCAST MUSIC CHECKED               
         BNE   VCYCX               DO NOT VALIDATE CYCLE DATE YET               
         CLI   RADNBMH+5,0                                                      
         BNE   VCYCX                                                            
         CLI   RADMBOH+5,0                                                      
         BNE   VCYCX                                                            
         SPACE 1                                                                
VCYC0YB  CLI   LWRSCR,SCR53        IF CALCULATING MUSIC CYCLE                   
         BNE   VCYC0YC             AND IF MUSIC USE NOT YET SET                 
         CLI   INMMU1YH+5,0        AND ON INTERNET/NEWMEDIA SCREEN              
         BNE   VCYCX               AND MUSIC 1 YEAR                             
         CLI   INMMU6MH+5,0                                                     
         BNE   VCYCX                                                            
         CLI   INMNOBMH+5,0                                                     
         BNE   VCYCX               OR NON-BROADCAST MUSIC                       
         CLI   INMNIMH+5,0                                                      
         BNE   VCYCX               OR INTERNET/NEW MEDIA MUSIC                  
         B     VCYC0Z              DO NOT VALIDATE CYCLE DATE YET               
         SPACE 1                                                                
VCYC0YC  CLI   LWRSCR,SCRF3        IF CALCULATING MUSIC CYCLE                   
         BNE   VCYC0Z              AND IF MUSIC USE NOT YET SET                 
         CLI   SPAMBOH+5,0                                                      
         BNE   VCYCX                                                            
         B     VCYC0Z              DO NOT VALIDATE CYCLE DATE YET               
         SPACE 1                                                                
VCYC0Z   LR    R2,R4               VALIDATE INPUTTED CYCLE DATES                
         LA    R3,BLOCK                                                         
         GOTO1 PDVAL,DMCB,(R3)                                                  
         USING PERVALD,R3                                                       
         MVC   0(6,R6),PVALPSTA    AND SAVE PWOS REPRESENTATION                 
         SPACE 1                                                                
         CLI   BYTE,C'R'           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC1               AND ON TELEVISION SCREEN                     
         CLI   LWRSCR,SCRF0        AND USE IS INDUSTRIAL                        
         BNE   VCYC00              VALIDATING CYCLE LENGTH NOT NEC              
         CLI   USE1,UINR                                                        
         BNE   VCYC1A                                                           
         CLI   TYPE1,UINRUNL                                                    
         BNE   VCYC2                                                            
         CLI   COMEXIST,C'Y'                                                    
         BE    VCYC2                                                            
         B     VCYC1A                                                           
         SPACE 1                                                                
VCYC00   CLI   LWRSCR,SCRF3        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC00A             AND ON SPANISH SCREEN                        
         CLI   USE1,USIN           AND USE IS INDUSTRIAL                        
         BNE   VCYC1A              VALIDATING CYCLE LENGTH NOT NEC              
         CLI   TYPE1,USINUNL                                                    
         BNE   VCYC2                                                            
         CLI   COMEXIST,C'Y'                                                    
         BE    VCYC2                                                            
         B     VCYC1A                                                           
         SPACE 1                                                                
VCYC00A  CLI   LWRSCR,SCRF2        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC00B             AND ON ADDENDUM SCREEN                       
         CLI   USE1,UADC           AND USE IS COMBINED SESSION                  
         BE    VCYC2               OR WILDSPOT                                  
         CLI   USE1,UADW           VALIDATING CYCLE LENGTH NOT NEC              
         BE    VCYC2                                                            
         B     VCYC1A                                                           
         SPACE 1                                                                
VCYC00B  CLI   LWRSCR,SCRF1        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC00C             AND ON RADIO SCREEN                          
         CLI   USE1,UWSP           AND USE IS WILDSPOT                          
         BE    VCYC2               OR NETWORK                                   
         CLI   USE1,URNT           OR INDUSTRIAL                                
         BE    VCYC2               VALIDATING CYCLE LENGTH NOT NEC              
         CLI   USE1,UINR                                                        
         BNE   VCYC1A                                                           
         CLI   TYPE1,UINRUNL                                                    
         BNE   VCYC2                                                            
         CLI   COMEXIST,C'Y'                                                    
         BE    VCYC2                                                            
         B     VCYC1A                                                           
         SPACE 1                                                                
VCYC00C  CLI   LWRSCR,SCRF4        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC00D             AND ON CANADIAN SCREEN                       
         CLI   USE1,UADW           AND USE IS DORMANCY FEE                      
         BE    VCYC2               VALIDATING CYCLE LENGTH NOT NEC              
         B     VCYC1A                                                           
         SPACE 1                                                                
VCYC00D  CLI   LWRSCR,SCR98        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC1A              AND ON CABLE SCREEN                          
         CLI   USE1,UWSP                                                        
         BE    VCYC2                                                            
         CLI   USE1,UADW           AND USE IS ADDENDUM WILDSPOT                 
         BE    VCYC2               VALIDATING CYCLE LENGTH NOT NEC              
         B     VCYC1A                                                           
         SPACE 1                                                                
VCYC1    CLI   USE2,UMBO                                                        
         BE    VCYC2                                                            
         CLI   LWRSCR,SCRF3        IF CALCULATING MUSIC CYCLE                   
         BE    VCYC1A              AND NOT ON SPANISH SCREEN                    
         CLI   USE2,UFGM           AND USE IS FOREIGN MUSIC                     
         BE    VCYC2               OR NON-BROADCAST MUSIC                       
         CLI   USE2,UNBM           VALIDATING CYCLE LENGTH NOT NEC              
         BE    VCYC2                                                            
         CLI   USE2,UNIM                                                        
         BE    VCYC2                                                            
         CLI   USE2,UMUS                                                        
         JNE   VCYC1A                                                           
         CLI   TYPE2,UMUSDUB6                                                   
         BE    VCYC2                                                            
         CLI   TYPE2,UMUSDSH6                                                   
         BE    VCYC2                                                            
         CLI   TYPE2,UMUSDUB1                                                   
         BE    VCYC2                                                            
         CLI   TYPE2,UMUSDSH1                                                   
         BE    VCYC2                                                            
         SPACE 1                                                                
VCYC1A   CLI   BYTE,C'R'                                                        
         BNE   VCYC1B                                                           
         CLI   LWRSCR,SCR53                                                     
         BNE   VCYC1B                                                           
         CLI   INMNMRH+5,0                                                      
         BNE   VCYC1B                                                           
         CLI   INMSNMH+5,0                                                      
         BNE   VCYC1B                                                           
         B     VCYC2                                                            
         SPACE 1                                                                
VCYC1B   CLI   5(R5),0             OTHERWISE, IF CYCLE LENGTH                   
         BE    VCYCX               NOT INPUTTED EXIT                            
         LA    RE,REGDATE                                                       
         LA    RF,WEEKS1           IF R6 = A(REGDATE) THEN SAVE                 
         CR    R6,RE               CYCLE LENGTH IN WEEKS1                       
         BE    *+8                 OTHERWISE SAVE IN WEEKS2                     
         LA    RF,WEEKS2                                                        
         MVC   0(2,RF),8(R5)                                                    
         SPACE 1                                                                
VCYC2    XC    WORK,WORK           MOVE VALIDATED CYCLE START DATE              
         MVC   WORK(9),8(R4)       (MMMDD/YY-) TO WORK                          
         MVI   WORK+9,C'('                                                      
         SPACE 1                                                                
         CLI   BYTE,C'R'           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC2D                                                           
         CLI   LWRSCR,SCR53        FOR INTERNET/NEW MEDIA                       
         BNE   VCYC2AA                                                          
         CLI   INMNMRH+5,0                                                      
         BNE   VCYC2AA                                                          
         CLI   INMSNMH+5,0                                                      
         BNE   VCYC2AA                                                          
         SPACE 1                                                                
         CLI   INMSOMH+5,0         IF USE IS SOM                                
         BE    VCYC2A1                                                          
         MVC   WORK+10(4),=C'30D)' CYCLE LENGTH IS 30 DAYS                      
         LA    RF,14                                                            
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2A1  MVC   WORK+10(4),=C'12M)' CYCLE LENGTH IS 12 MONTHS                    
         LA    RF,14                                                            
         CLI   USE1,UINU                                                        
         BE    VCYC2A2                                                          
         CLI   USE1,USIU                                                        
         BE    VCYC2A2                                                          
         CLI   USE1,UNMU                                                        
         BE    VCYC2A2                                                          
         CLI   USE1,USNU                                                        
         BNE   VCYC2A3                                                          
VCYC2A2  CLI   TYPE1,UINUI4W       UNLESS TYPE IS 4 WEEKS                       
         BE    VCYC2A5                                                          
         CLI   TYPE1,UINUR4W                                                    
         BE    VCYC2A5                                                          
         B     VCYC2AAA                                                         
VCYC2A3  CLI   USE1,UMVI                                                        
         BE    VCYC2A4                                                          
         CLI   USE1,USMI                                                        
         BE    VCYC2A4                                                          
         CLI   USE1,UMVN                                                        
         BE    VCYC2A4                                                          
         CLI   USE1,USMN                                                        
         BNE   VCYC2AAA                                                         
VCYC2A4  CLI   TYPE1,UMVII4W                                                    
         BNE   VCYC2AAA                                                         
VCYC2A5  MVC   WORK+10(4),=C'4W) '                                              
         MVC   WEEKS1,=C'4 '                                                    
         LA    RF,13                                                            
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2AAA CLI   TYPE1,UINUI8W       UNLESS TYPE IS 8 WEEKS                       
         BE    *+12                                                             
         CLI   TYPE1,UINUR8W                                                    
         BNE   VCYC8                                                            
         MVC   WORK+10(4),=C'8W) '                                              
         MVC   WEEKS1,=C'8 '                                                    
         LA    RF,13                                                            
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2AA  CLI   LWRSCR,SCRF3        AND ON SPANISH SCREEN                        
         BNE   VCYC2A              AND USE IN INDUSTRIAL                        
         CLI   USE1,USIN                                                        
         BNE   VCYC2C                                                           
         CLI   TYPE1,USINUNL                                                    
         BNE   VCYC2B                                                           
         B     VCYC3                                                            
VCYC2A   CLI   LWRSCR,SCRF0        OR ON TELEVISION SCREEN                      
         BNE   VCYC2C              AND USE IS INDUSTRIAL                        
         CLI   USE1,UINR                                                        
         BNE   VCYC3                                                            
         CLI   TYPE1,UINRUNL                                                    
         BE    VCYC3                                                            
VCYC2B   MVC   WORK+10(4),=C'30D)' CYCLE LENGTH IS 30 DAYS                      
         LA    RF,14                                                            
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2C   CLI   LWRSCR,SCRF2        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC2CC1            AND ON ADDENDUM SCREEN                       
         CLI   USE1,UADC           AND USE IS COMBINED SESSION                  
         BNE   VCYC2CC                                                          
         LA    RF,13               CYCLE LENGTH IS 3 DAYS                       
         MVC   WORK+10(3),=C'3D)'  IF TYPE IS 3 DAYS                            
         CLI   TYPE1,UADC3D                                                     
         BE    VCYC8                                                            
         MVC   WORK+10(3),=C'1W)'  CYCLE LENGTH IS 1 WEEK                       
         MVC   WEEKS1,=C'1 '       IF TYPE IS 1 WEEK                            
         CLI   TYPE1,UADC1W                                                     
         BE    VCYC8                                                            
         MVC   WORK+10(3),=C'4W)'  CYCLE LENGTH IS 4 WEEKS                      
         MVC   WEEKS1,=C'4 '       IF TYPE IS 4 WEEKS                           
         CLI   TYPE1,UADC4W                                                     
         BE    VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         CLI   TYPE1,UADC13W                                                    
         BE    VCYC8                                                            
         MVC   WORK+10(4),=C'31D)' CYCLE LENGTH IS 31 DAYS                      
         XC    WEEKS1,WEEKS1       IF TYPE IS 31 DAYS                           
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2CC  CLI   USE1,UADW           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC3               AND ON ADDENDUM SCREEN                       
         LA    RF,13               AND USE IS WILDSPOT                          
         MVC   WORK+10(3),=C'3D)'  CYCLE LENGTH IS 3 DAYS                       
         CLI   ADDW3DYH+5,0        IF TYPE IS 3 DAYS                            
         BNE   VCYC8                                                            
         MVC   WORK+10(3),=C'1W)'  CYCLE LENGTH IS 1 WEEK                       
         MVC   WEEKS1,=C'1 '       IF TYPE IS 1 WEEK                            
         CLI   ADDW1WKH+5,0                                                     
         BNE   VCYC8                                                            
         MVC   WORK+10(3),=C'4W)'  CYCLE LENGTH IS 4 WEEKS                      
         MVC   WEEKS1,=C'4 '       IF TYPE IS 4 WEEKS                           
         CLI   ADDW4WKH+5,0                                                     
         BNE   VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         CLI   ADDW13WH+5,0                                                     
         BNE   VCYC7                                                            
         MVC   WORK+10(4),=C'31D)' CYCLE LENGTH IS 31 DAYS                      
         XC    WEEKS1,WEEKS1       IF TYPE IS 31 DAYS                           
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2CC1 CLI   LWRSCR,SCR98                                                     
         BNE   VCYC2CCC                                                         
         CLI   USE1,UWSP                                                        
         BNE   VCYC2CC2                                                         
         LA    RF,13                                                            
         MVC   WORK+10(3),=C'8W)'  CYCLE LENGTH IS 8 WEEKS                      
         MVC   WEEKS1,=C'8 '       IF TYPE IS 8 WEEKS                           
         CLI   CBLWS8WH+5,0                                                     
         BNE   VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         TM    AGYSTAT,TAAYS13W                                                 
         BNZ   VCYC8                                                            
         MVC   WORK+10(4),=C'3M) '                                              
         B     VCYC8                                                            
VCYC2CC2 CLI   USE1,UADW                                                        
         BNE   VCYC2CCC                                                         
         LA    RF,13               AND USE IS WILDSPOT                          
         MVC   WORK+10(3),=C'3D)'  CYCLE LENGTH IS 3 DAYS                       
         CLI   CBLA3DYH+5,0        IF TYPE IS 3 DAYS                            
         BNE   VCYC8                                                            
         MVC   WORK+10(3),=C'1W)'  CYCLE LENGTH IS 1 WEEK                       
         MVC   WEEKS1,=C'1 '       IF TYPE IS 1 WEEK                            
         CLI   CBLA1WKH+5,0                                                     
         BNE   VCYC8                                                            
         MVC   WORK+10(3),=C'4W)'  CYCLE LENGTH IS 4 WEEKS                      
         MVC   WEEKS1,=C'4 '       IF TYPE IS 4 WEEKS                           
         CLI   CBLA4WKH+5,0                                                     
         BNE   VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         TM    AGYSTAT,TAAYS13W                                                 
         BNZ   *+10                                                             
         MVC   WORK+10(4),=C'3M) '                                              
         CLI   CBLA13WH+5,0                                                     
         BNE   VCYC7                                                            
         MVC   WORK+10(4),=C'31D)' CYCLE LENGTH IS 31 DAYS                      
         XC    WEEKS1,WEEKS1       IF TYPE IS 31 DAYS                           
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2CCC CLI   LWRSCR,SCRF1        IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC2CCF            AND ON RADIO SCREEN                          
         CLI   USE1,UWSP           AND USE IS WILDSPOT                          
         BNE   VCYC2CCD                                                         
         LA    RF,13                                                            
         MVC   WORK+10(3),=C'8W)'  CYCLE LENGTH IS 8 WEEKS                      
         MVC   WEEKS1,=C'8 '       IF TYPE IS 8 WEEKS                           
         CLI   RADWS8WH+5,0                                                     
         BNE   VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         B     VCYC7                                                            
         SPACE 1                                                                
VCYC2CCD CLI   USE1,URNT           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC2CCE            AND ON RADIO SCREEN                          
         LA    RF,13               AND USE IS WILDSPOT                          
         MVC   WORK+10(3),=C'1W)'  CYCLE LENGTH IS 1 WEEK                       
         MVC   WEEKS1,=C'1 '       IF TYPE IS 1 WEEK                            
         CLI   RAD1WKH+5,0                                                      
         BNE   VCYC8                                                            
         MVC   WORK+10(3),=C'4W)'  CYCLE LENGTH IS 4 WEEKS                      
         MVC   WEEKS1,=C'4 '       IF TYPE IS 4 WEEKS                           
         CLI   RAD4WKH+5,0                                                      
         BNE   VCYC8                                                            
         MVC   WORK+10(3),=C'8W)'  CYCLE LENGTH IS 8 WEEKS                      
         MVC   WEEKS1,=C'8 '       IF TYPE IS 8 WEEKS                           
         CLI   RAD8WKH+5,0                                                      
         BNE   VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         B     VCYC7                                                            
         SPACE 1                                                                
VCYC2CCE CLI   USE1,UINR           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC3               AND ON RADIO SCREEN                          
         CLI   TYPE1,UINRUNL                                                    
         BE    VCYC3                                                            
         MVC   WORK+10(4),=C'30D)' AND USE IS INDUSTRIAL                        
         LA    RF,14               CYCLE LENGTH IS 30 DAYS                      
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2CCF CLI   LWRSCR,SCRF4        IF CALCULATING REGULAR USE                   
         BNE   VCYC2CCG            ON CANADIAN SCREEN                           
         CLI   USE1,UDOR           AND USE IS DORMANCY FEE                      
         BNE   VCYC3                                                            
         MVC   WORK+10(5),=C'183D)'                                             
         LA    RF,15                                                            
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2CCG CLI   LWRSCR,SCR98                                                     
         BNE   VCYC3                                                            
         CLI   USE1,UWSP           AND USE IS WILDSPOT                          
         BNE   VCYC3                                                            
         LA    RF,13                                                            
         MVC   WORK+10(3),=C'8W)'  CYCLE LENGTH IS 8 WEEKS                      
         MVC   WEEKS1,=C'8 '       IF TYPE IS 8 WEEKS                           
         CLI   CBLWS8WH+5,0                                                     
         BNE   VCYC8                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'13W)' CYCLE LENGTH IS 13 WEEKS                     
         MVC   WEEKS1,=C'13'       IF TYPE IS 13 WEEKS                          
         B     VCYC7                                                            
         SPACE 1                                                                
VCYC2D   CLI   LWRSCR,SCRF3        IF CALCULATING MUSIC CYCLE                   
         BE    VCYC2EEE            AND NOT ON SPANISH SCREEN                    
         CLI   USE2,UFGM           AND USE IS FOREIGN MUSIC                     
         BNE   VCYC2E                                                           
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'12M)' CYCLE LENGTH IS 12 MONTHS                    
         CLI   TYPE2,UFGMEU12      IF TYPE IS 12 MONTHS                         
         BE    VCYC8                                                            
         CLI   TYPE2,UFGMNE12                                                   
         BE    VCYC8                                                            
         CLI   TYPE2,UFGMWO12                                                   
         BE    VCYC8                                                            
         MVC   WORK+10(4),=C'24M)' CYCLE LENGTH IS 24 MONTHS                    
         B     VCYC8               IF TYPE IS 24 MONTHS                         
         SPACE 1                                                                
VCYC2E   CLI   USE2,UNBM           IF USE IS NON-BROADCAST MUSIC                
         BNE   VCYC2EE                                                          
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'12M)' CYCLE LENGTH IS 12 MONTHS                    
         CLI   TYPE2,UNBM1YR       IF TYPE IS 1 YEAR                            
         BE    VCYC8                                                            
         MVC   WORK+10(4),=C'24M)' CYCLE LENGTH IS 24 MONTHS                    
         CLI   TYPE2,UNBM2YR       IF TYPE IS 2 YEAR                            
         BE    VCYC8                                                            
         LA    RF,13                                                            
         MVC   WORK+10(4),=C'8W) ' ELSE CYCLE LENGTH IS 8 WEEKS                 
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2EE  CLI   USE2,UNIM           IF USE IS INTERNET/NEW MEDIA MUSIC           
         BNE   VCYC2EEE                                                         
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'12M)' CYCLE LENGTH IS 12 MONTHS                    
         MVC   WEEKS2,=C'52'                                                    
         CLI   TYPE2,UNIM1YR       IF TYPE IS 1 YEAR                            
         BE    VCYC8                                                            
         LA    RF,13                                                            
         MVC   WORK+10(4),=C'6M)'  CYCLE LENGTH IS 6 MONTHS                     
         MVC   WEEKS2,=C'26'                                                    
         CLI   TYPE2,UNIM6MO       IF TYPE IS 6 MONTHS                          
         BE    VCYC8                                                            
         MVC   WORK+10(4),=C'8W) ' ELSE CYCLE LENGTH IS 8 WEEKS                 
         MVC   WEEKS2,=C'8 '                                                    
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2EEE CLI   USE2,UMBO           IF USE IS ALL MEDIA BUYOUT                   
         BNE   VCYC2F                                                           
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'12M)' CYCLE LENGTH IS 12 MONTHS                    
         MVC   WEEKS2,=C'52'                                                    
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC2F   CLI   LWRSCR,SCR53        IF ON INTERNET/NEW MEDIA SCREEN              
         BNE   VCYC3                                                            
         CLI   INMMU6MH+5,0        AND USE IS MUS 26 WEEKS                      
         BE    VCYC2FF                                                          
         LA    RF,13                                                            
         MVC   WORK+10(3),=C'6M)'  CYCLE LENGTH IS 6 MONTHS                     
         MVC   WEEKS2,=C'26'                                                    
         B     VCYC8                                                            
VCYC2FF  CLI   INMMU1YH+5,0        AND USE IS MUS 1 YEAR LONG                   
         BE    VCYC3                                                            
         LA    RF,14                                                            
         MVC   WORK+10(4),=C'12M)' CYCLE LENGTH IS 12 MONTHS                    
         MVC   WEEKS2,=C'52'                                                    
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC3    MVC   WORK+10(2),8(R5)    MOVE CYCLE LENGTH INTO WORK                  
         LA    RF,13                                                            
         TM    4(R5),X'08'         IF INPUT IS NOT NUMERIC                      
         BO    VCYC4                                                            
         CLI   5(R5),2             SHOULD BE N'MONTHS                           
         BNE   INVDTE                                                           
         CLI   9(R5),C'M'                                                       
         BNE   INVDTE                                                           
         CLI   8(R5),C'1'                                                       
         BL    INVDTE                                                           
         MVI   WORK+12,C')'                                                     
         B     VCYC8                                                            
         SPACE 1                                                                
VCYC4    CLI   WORK+11,C' '        IF INPUT IS NUMERIC                          
         BH    *+14                                                             
         MVC   WORK+11(2),=C'W)'   MOVE W INTO CORRECT LOCATION OF              
         B     VCYC8               WORK                                         
         MVC   WORK+12(2),=C'W)'                                                
         LA    RF,14                                                            
VCYC7    TM    AGYSTAT,TAAYS13W    IF AGY DOESN'T USE 13W (USES 3M)             
         BO    VCYC8                                                            
         CLC   =C'13',WORK+10      AND INPUT IS 13W                             
         BNE   VCYC8                                                            
         MVC   WORK+10(4),=C'3M) ' THEN ACTUALLY USE 3M                         
         LA    RF,13                                                            
         SPACE 1                                                                
VCYC8    GOTO1 PDVAL,DMCB,(X'40',(R3)),((RF),WORK)                              
         SPACE 1                                                                
VCYC8B   CLC   0(3,R6),3(R6)       IF END/=START (USER I/P END)                 
         BE    VCYC10                                                           
         CLC   0(6,R6),PVALPSTA    SHOULD MATCH INPUT                           
         BE    VCYC10                                                           
         SPACE 1                                                                
         CLI   LWRSCR,SCR53                                                     
         BNE   VCYC8C                                                           
         CLI   BYTE,C'R'                                                        
         BNE   VCYC10                                                           
         CLI   INMIRNH+5,0                                                      
         BNE   VCYC8C                                                           
         CLI   INMSIRH+5,0                                                      
         BNE   VCYC8C                                                           
         CLI   INMNMRH+5,0                                                      
         BNE   VCYC8C                                                           
         CLI   INMSNMH+5,0                                                      
         BNE   VCYC8C                                                           
         B     VCYC10                                                           
         SPACE 1                                                                
VCYC8C   TM    4(R4),X'20'         IF FIELD HAS CHANGED SINCE LAST              
         BZ    WKSERR                 TIME GIVE ERROR AGAIN                     
         TM    4(R5),X'20'         IF CYC LENGTH HAD CHANGED SINCE              
         BZ    WKSERR                 LAST TIME GIVE ERROR AGAIN                
         TM    1(R4),X'08'                                                      
         BZ    VCYC20                                                           
         CLI   PFAID,20            IF OVERRIDE PFKEY NOT PRESSED                
         BNE   WKSERR                 GIVE ERROR                                
         B     VCYC20                                                           
         SPACE 1                                                                
VCYC10   MVC   0(L'REGDATE,R6),PVALPSTA SAVE CALC. DATES                        
         MVC   8(L'CLACCST,R4),PVALCPER DISPLAY CALC. DATES                     
         SPACE 1                                                                
         CLI   BYTE,C'R'           IF CALCULATING REGULAR CYCLE                 
         BNE   VCYC20                                                           
         CLI   LWRSCR,SCR53        ON INTERNET/NEWMEDIA SCREEN                  
         BNE   VCYC20                                                           
         OC    SVEXP2,SVEXP2       AND COMMERCIAL HAS EXPIRATION DATE           
         BZ    VCYC20                                                           
         CLC   REGDATE+3(3),SVEXP2 AND END DATE > EXPIRATION DATE               
         BNH   VCYC20                                                           
         MVC   REGDATE+3(3),SVEXP2 CHANGE TO EXPIRATION DATE                    
         MVC   17(L'SVEXP,R4),SVEXP                                             
         CLC   REGDATE(3),SVEXP2                                                
         BH    INVDTE                                                           
         SPACE 1                                                                
VCYC20   OI    4(R5),X'20'         SET CYCLE WEEKS PREVIOUSLY VALIDATED         
         OI    4(R4),X'20'         CYCLE DATES                                  
         CLI   BYTE,C'R'                                                        
         BNE   *+12                                                             
         NI    STATUS,X'FF'-WAID1PFK                                            
         B     *+8                                                              
         NI    STATUS,X'FF'-WAID2PFK                                            
         NI    1(R4),X'FF'-X'08'                                                
         CLI   STATUS,0            CLEAR PFKEY IF NOTHING ELSE IS               
         BNE   VCYCX                  PENDING                                   
         CLI   PFAID,20                                                         
         BNE   VCYCX                                                            
         MVI   PFAID,0                                                          
VCYCX    XIT1                                                                   
         SPACE 2                                                                
WKSERR   MVI   MYMSGNO1,103        CYCLE NOT IN SYNC WITH WEEKS                 
         OI    GENSTAT2,USGETTXT                                                
         CLI   BYTE,C'R'                                                        
         BNE   *+12                                                             
         OI    STATUS,WAID1PFK                                                  
         B     *+8                                                              
         OI    STATUS,WAID2PFK                                                  
         OI    4(R4),X'20'                                                      
         OI    4(R5),X'20'                                                      
         LR    R2,R4                                                            
         OI    1(R2),X'08'         CHANGE TO HIGH INTENSITY                     
         MVI   ERRDISP,9                                                        
         B     DERRX                                                            
INVDTE   MVI   ERROR,INVALID                                                    
         CLI   BYTE,C'R'                                                        
         BNE   *+12                                                             
         NI    STATUS,X'FF'-WAID1PFK                                            
         B     *+8                                                              
         NI    STATUS,X'FF'-WAID2PFK                                            
         OI    4(R4),X'FF'-X'20'                                                
DERRX    GOTO1 EXIT,DMCB,0                                                      
         SPACE 1                                                                
         EJECT                                                                  
*              ROUTINE DEAFULTS CYCLE WEEK FIELD TO A VALUE                     
         SPACE 1                                                                
WKDEF    NTR1  BASE=*,LABEL=*                                                   
         MVC   BYTE,0(R1)                                                       
         ICM   R2,7,1(R1)          R3=A(CYCLE LENGTH FIELD)                     
         SPACE 1                                                                
         CLI   5(R2),0             IF CYCLE LENGTH INPUTTED                     
         BNE   WKDEFX              EXIT                                         
         SPACE 1                                                                
         USING WKDEFD,R3           R3=A(USE DEFAULT LENGTH TABLE)               
         LA    R3,WKDEFTAB                                                      
WKDEF10  CLC   WKDSCR,BYTE         IF ON RIGHT SECTION OF RIGHT                 
         BH    WKDEFX                                                           
         BL    WKDEF20             SCREEN                                       
         ZICM  R4,WKDUSEA,2                                                     
         AR    R4,RA                                                            
         CLI   5(R4),0             CHECK IF USE IS CHECKED OFF                  
         BE    WKDEF20                                                          
         MVC   8(2,R2),WKDLEN      IF YES, FILL IN CYCLE LENGTH                 
         OI    4(R2),X'08'         FIELD                                        
         MVI   5(R2),2                                                          
         OI    6(R2),X'80'                                                      
         B     WKDEFX                                                           
         SPACE 1                                                                
WKDEF20  LA    R3,WKDLNQ(R3)                                                    
         B     WKDEF10                                                          
WKDEFX   XIT1                                                                   
         SPACE 2                                                                
WKDEFTAB DC    X'01',AL2(TELHFEEH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELWSPTH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELCABLH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELLCABH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELLPROH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELPROMH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELREINH-T702FFD),CL2'13'                              
         DC    X'01',AL2(TELPPFEH-T702FFD),CL2'13'                              
         DC    X'02',AL2(TELMUSEH-T702FFD),CL2'13'                              
         DC    X'02',AL2(TEL1MUSH-T702FFD),CL2'13'                              
         DC    X'03',AL2(RADREGNH-T702FFD),CL2'13'                              
         DC    X'03',AL2(RADLOCAH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLACLAOH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLAABCOH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLANBCOH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLACBSOH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLAFOXOH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLAPAXOH-T702FFD),CL2'13'                              
         DC    X'05',AL2(CLAITNH-T702FFD),CL2'13'                               
         DC    X'06',AL2(CLAMUSEH-T702FFD),CL2'13'                              
         DC    X'06',AL2(CLA1MUSH-T702FFD),CL2'13'                              
         DC    X'07',AL2(ADDHFEEH-T702FFD),CL2'13'                              
         DC    X'07',AL2(ADDREINH-T702FFD),CL2'13'                              
         DC    X'08',AL2(ADDMREUH-T702FFD),CL2'13'                              
         DC    X'08',AL2(ADDFIMUH-T702FFD),CL2'13'                              
         DC    X'09',AL2(SPAHOLDH-T702FFD),CL2'13'                              
         DC    X'09',AL2(SPANETWH-T702FFD),CL2'13'                              
         DC    X'09',AL2(SPAWILDH-T702FFD),CL2'13'                              
         DC    X'09',AL2(SPANWWSH-T702FFD),CL2'13'                              
         DC    X'09',AL2(SPACABLH-T702FFD),CL2'13'                              
         DC    X'09',AL2(SPAREINH-T702FFD),CL2'13'                              
         DC    X'0A',AL2(SPAMUSEH-T702FFD),CL2'13'                              
         DC    X'0B',AL2(CANAUTNH-T702FFD),CL2'13'                              
         DC    X'0B',AL2(CANWSPTH-T702FFD),CL2'13'                              
         DC    X'0B',AL2(CANWCOMH-T702FFD),CL2'13'                              
         DC    X'0B',AL2(CANPRIMH-T702FFD),CL2'13'                              
         DC    X'0B',AL2(CANACRRH-T702FFD),CL2'13'                              
         DC    X'0C',AL2(CANMREUH-T702FFD),CL2'13'                              
         DC    X'0D',AL2(CBLCABLH-T702FFD),CL2'13'                              
         DC    X'0D',AL2(CBLSCABH-T702FFD),CL2'13'                              
         DC    X'0D',AL2(CBLSWSPH-T702FFD),CL2'13'                              
         DC    X'0D',AL2(CBLCWSPH-T702FFD),CL2'13'                              
         DC    X'0D',AL2(CBLLCABH-T702FFD),CL2'13'                              
         DC    X'0E',AL2(CBLMUSEH-T702FFD),CL2'13'                              
         DC    X'0E',AL2(CBL1MUSH-T702FFD),CL2'13'                              
         DC    X'0F',AL2(INMNMRH-T702FFD),CL2'13'                               
         DC    X'0F',AL2(INMSNMH-T702FFD),CL2'13'                               
         DC    X'FF'                                                            
         SPACE 1                                                                
*              ROUTINE TO VALIDATE MULTIPLE CHOICE MINORS                       
         SPACE 1                                                                
* PARAMETER LIST FORM: (USE TYPE,A(FLD HDR))                          *         
* END PARAMTER LIST WITH (X'FF',0) IF MORE THAN 1 CAN BE CHECKED      *         
*                        (X'FF',1) IF ONLY 1 CAN BE CHECKED           *         
         SPACE 1                                                                
VALNORM  NTR1  BASE=*,LABEL=*                                                   
         L     R3,0(R1)                                                         
         LR    R5,R3               R5 = A(TYPE 1 OR TYPE 2)                     
         SPACE 1                                                                
         LA    R1,4(R1)                                                         
         L     R0,0(R1)            R0 = BEGINNING OF PARAMETER LIST             
         SPACE 1                                                                
VNORM10  CLI   0(R1),X'FF'                                                      
         BE    VNORM30             TEST FOR END OF PARAMETER LIST               
         L     R2,0(R1)                                                         
         CLI   5(R2),0             IF FIELD INPUT ... STORE TYPE                
         BE    VNORM20             INTO TYPE POINTED AT BY R3 AND               
         MVC   0(1,R3),0(R1)       BUMP R3                                      
         LA    R3,1(R3)                                                         
VNORM20  LA    R1,4(R1)            BUMP TO NEXT PARAMETER                       
         B     VNORM10                                                          
         SPACE 1                                                                
VNORM30  CLI   0(R5),0             WHEN ALL PARAMETERS CHECKED ...              
         BNE   VNORM40             AT LEAST ONE TYPE MUST BE CHECKED            
         LR    R2,R0                                                            
         MVI   ERROR,MISSING                                                    
         B     VNORM60                                                          
         SPACE 1                                                                
VNORM40  CLI   3(R1),1             IF MORE THAN 1 MINOR CAN BE CHECKED          
         BNE   VNORMX              ... EXIT                                     
         SPACE 1                                                                
         CLI   1(R5),0             IF ONLY 1 MINOR CAN BE CHECKED AND           
         BE    VNORMX              MORE THAN 1 CHECKED ... ERROR                
VNORM50  AHI   R1,-4                                                            
         L     R2,0(R1)                                                         
         CLI   5(R2),0                                                          
         BE    VNORM50                                                          
         MVI   ERROR,ERGT1SEL                                                   
VNORM60  GOTO1 EXIT,DMCB,0                                                      
VNORMX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO BUILD ELEMENTS FROM MARKET DETAILS                    
         SPACE 1                                                                
BLDMKTS  NTR1  BASE=*,LABEL=*                                                   
         LM    R2,R3,0(R1)       R2=A(FIRST FIELD) R3=A(LAST FIELD)             
         SPACE 1                                                                
         MVC   TGDATE,REGDATE    INITIALIZE LAST DATE TO CYCLE START            
         GOTO1 DATCON,DMCB,(1,REGDATE),(0,TGDUB)                                
         GOTO1 DATCON,DMCB,(1,REGDATE+3),(0,TGDUB+6)                            
         SPACE 1                                                                
         LHI   R4,1                SAVE LENGTH OF CYCLE (IN DAYS)               
BMKT01   STC   R4,CYCLEN           IN CYCLEN                                    
         GOTO1 ADDAY,DMCB,TGDUB,WORK,(R4)                                       
         CLC   WORK(6),TGDUB+6                                                  
         BE    BMKT02                                                           
         AHI   R4,1                                                             
         B     BMKT01                                                           
         SPACE 1                                                                
BMKT02   MVC   LAGEND,REGDATE+3    IF CYCLE IS 8 WEEKS                          
         LHI   RF,14               LAG END IS 2 WEEKS LATER                     
         CLI   CYCLEN,56           IF CYCLE IS 13 WEEKS                         
         BL    BMKT05              LAG END IS 4 WEEKS LATER                     
         BE    BMKT03              ELSE, LAG END IS SAME AS                     
         LHI   RF,28               CYCLE END                                    
         SPACE 1                                                                
BMKT03   GOTO1 ADDAY,DMCB,TGDUB+6,WORK,(RF)       SAVE LAG END DATE             
         GOTO1 DATCON,DMCB,(0,WORK),(1,LAGEND)    IN LAGEND                     
         SPACE 1                                                                
BMKT05   GOTO1 FLDVAL,DMCB,(X'40',(R2)),(X'80',(R3))                            
         BE    BMKT10                                                           
         XC    LASTCODE,LASTCODE IF FIELD(S) CHANGED, CLEAR LAST CODE           
         XC    LASTDATE,LASTDATE                                                
         SPACE 1                                                                
BMKT10   LHI   R5,PMAXCBL        R5=NUMBER OF CNET/MKT/CSYS FIELDS              
         SPACE 1                                                                
         USING TAMTD,R4                                                         
         L     R4,AIO            R4=A(ADVICE RECORD)                            
         MVI   ELCODE,TAMTELQ                                                   
         BRAS  RE,GETEL          READ THROUGH ALL CNET/MKT/CSYS                 
         B     BMKT40            ELEMENTS                                       
BMKT30   BRAS  RE,NEXTEL                                                        
BMKT40   BNE   BMKT90                                                           
         LHI   RE,L'CBLCODE-1                                                   
         CLI   LWRSCR,SCR98                                                     
         BE    BMKT50                                                           
         DC    H'00'             UNTIL WE FIND ONE WITH A CNET/MKT/CSYS         
BMKT50   EX    RE,*+8            THAT IS ALPHABETICALLY HIGHER OR               
         B     *+10              EQUAL TO THE FIRST ON THIS PAGE                
         CLC   FRSTCODE(0),TAMTCODE                                             
         BH    BMKT30                                                           
         B     BMKT70                                                           
         SPACE 1                                                                
BMKT60   BRAS  RE,NEXTEL         MARK THE NEXT (NUMBER OF MARKET                
         BNE   BMKT80            RECORDS ON THIS PARTICULAR SCREEN)             
BMKT70   MVI   TAMTEL,X'FF'      FOR DELETION                                   
         BCT   R5,BMKT60                                                        
         DROP  R4                                                               
         SPACE 1                                                                
BMKT80   MVI   ELCODE,X'FF'      AND DELETE THEM                                
         GOTO1 REMELEM                                                          
         SPACE 1                                                                
BMKT90   MVI   TGMTTYPE,TANPNET  SET TO READ CNET RECORDS                       
         CLI   USE1,UCBL         IF USE IS CBL                                  
         BE    BMKT100                                                          
         CLI   USE1,USCB         OR SCB                                         
         BE    BMKT100                                                          
         SPACE 1                                                                
         MVI   TGMTTYPE,C'S'     SET TO READ CSYS RECORDS                       
         CLI   USE1,ULCB         IF USE IS LCB                                  
         BE    BMKT100                                                          
         SPACE 1                                                                
         MVI   TGMTTYPE,C'T'     SET TO READ TMKT RECORDS                       
         CLI   TGMENAME,C'R'     IF MEDIA IS NOT RADIO                          
         BNE   BMKT100                                                          
         MVI   TGMTTYPE,C'R'     ELSE, READ RMKT RECORDS                        
         SPACE 1                                                                
BMKT100  CR    R2,R3             IF NOT AT THE END OF SCREEN                    
         BH    BMKTX                                                            
         SPACE 1                                                                
         CLI   5(R2),0           IF DATE IS NOT PRESENT                         
         BNE   BMKT120                                                          
         ZIC   RE,0(R2)                                                         
         AR    RE,R2                                                            
         CLI   5(RE),0           BUT CODE IS                                    
         BE    BMKT240                                                          
         MVC   8(8,R2),CBLCCST   DEFAULT DATE TO CYCLE START DATE               
         MVI   5(R2),8                                                          
         OI    6(R2),X'80'                                                      
         SPACE 1                                                                
BMKT120  BRAS  RE,VDATE          VALIDATE DATE (SAVE IN TGDATE)                 
         ST    R2,TGDUB                                                         
         SPACE 1                                                                
         ZIC   RE,0(R2)          BUMP TO CODE FIELD                             
         AR    R2,RE             AND ENSURE IT NEVER GETS MARKED                
         NI    1(R2),X'FF'-X'20' PROTECTED                                      
         OI    6(R2),X'80'                                                      
         SPACE 1                                                                
         CLI   5(R2),0           CODE FIELD IS REQUIRED                         
         BE    BMKTMIS                                                          
         SPACE 1                                                                
*&&DO                                                                           
********************************************************************            
         USING TAMTD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TAMTELQ    GIVE ERROR IF CNET/MKT/CSYS ALREADY            
         BRAS  RE,GETEL          INPUTTED                                       
         B     BMKT140                                                          
BMKT130  BRAS  RE,NEXTEL                                                        
BMKT140  BNE   BMKT150                                                          
         CLC   TAMTCODE,8(R2)                                                   
         BNE   BMKT130                                                          
         B     BMKTINV                                                          
         DROP  R4                                                               
********************************************************************            
*&&                                                                             
         SPACE 1                                                                
BMKT150  LHI   RF,TLMTCDQ        VALIDATE CNET/MKT/CSYS CODE                    
         BRAS  RE,USEALPH                                                       
         BNE   *+8                                                              
         LHI   RF,TLMTALDQ                                                      
         GOTO1 RECVAL,DMCB,(RF),(X'04',(R2))                                    
         BE    BMKT170                                                          
         SPACE                                                                  
         CLI   TGMTTYPE,TANPNET  IF NOT FOUND AND NOT READING CNETS             
         BNE   BMKTNFND          RETURN ERROR                                   
         SPACE 1                                                                
BMKT160  MVI   TGMTTYPE,C'S'     ELSE, SEE IF CSYS EXISTS                       
         GOTO1 RECVAL,DMCB,TLMTCDQ,(X'04',(R2))                                 
         BNE   BMKTNFND                                                         
         MVI   TGMTTYPE,TANPNET                                                 
         SPACE 1                                                                
BMKT170  DS    0H                                                               
*&&DO                                                                           
********************************************************************            
         CLI   COMEXIST,C'Y'     IF DEALING WITH A COMMERCIAL                   
         BNE   BMKT220           THAT EXISTS                                    
         CLI   VERLIFT,C'V'      HAVE TO CHECK HISTORY FOR                      
         BNE   BMKT180           NON-VERSIONS                                   
         CLI   UPGR,C'Y'         AND VERSION UPGRADES                           
         BNE   BMKT220                                                          
         SPACE 1                                                                
BMKT180  GOTO1 DATCON,DMCB,(1,TGDATE),(0,DUB)                                   
         SPACE 1                                                                
         ZIC   RF,CYCLEN                          CALCULATE NEW CYCLE           
         GOTO1 ADDAY,DMCB,DUB,WORK,(RF)           END                           
         GOTO1 DATCON,DMCB,(0,WORK),(1,CMCCYEND)                                
         SPACE 1                                                                
         CLC   CMCCYEND,LAGEND                    IF LATER THAN LAG             
         BNH   *+10                               END DATE                      
         MVC   CMCCYEND,LAGEND                    USE LAG END DATE              
         SPACE 1                                                                
         USING TLUHPD,R4                                                        
         LA    R4,KEY            READ ALL USAGE HISTORY KEYS                    
         XC    TLUHPKEY,TLUHPKEY FOR THIS CNET/MKT/CSYS ON THIS                 
         MVI   TLUHPCD,TLUHMTDQ  COMMERCIAL                                     
         MVC   TLUHMINM,TGMTINTC                                                
         MVC   TLUHMCOM,TGCOM                                                   
         GOTO1 HIGH                                                             
         B     BMKT200                                                          
BMKT190  GOTO1 SEQ                                                              
BMKT200  CLC   KEY(TLUHMSEQ-TLUHPCD),KEYSAVE                                    
         BNE   BMKT220                                                          
         SPACE 1                                                                
         CLC   TLUHMC1D,TGDATE   IF USE DATE FITS WITHIN A PREVIOUS             
         BNH   BMKT205           PREVIOUS CYCLE FOR THIS CNET/MKT/              
         CLC   TLUHMC1D,CMCCYEND CSYS ...                                       
         BH    BMKT190                                                          
BMKT205  CLC   TLUHMCYE,TGDATE                                                  
         BNL   BMKT207                                                          
         CLC   TLUHMCYE,CMCCYEND                                                
         BL    BMKT190                                                          
         SPACE 1                                                                
BMKT207  CLI   VERLIFT,C'V'      IF DEALING WITH A NON-VERSION                  
         BE    BMKT210                                                          
         TM    TLUHMSTA,TLUHMCRD AND FOUND ON A PREV NON-CREDIT                 
         BZ    BMKTPREV          PAYMENT, GIVE ERROR                            
         B     BMKT220                                                          
         SPACE 1                                                                
BMKT210  L     R2,TGDUB                                                         
         CLC   TGDATE,TLUHMC1D       IF DEALING WITH A VERSION UPGRADE          
         BL    BMKTINV               DATE CANNOT BE EARLIER THAN PREV           
         MVC   WORK(3),REGDATE+3     ENSURE DATE FITS WITHIN THE CNET/          
         MVC   REGDATE+3(3),TLUHMCYE MKT/CSYS'S PREVIOUSLY DEFINED              
         MVI   VERLIFT,C'N'          LAG CYCLE                                  
         MVI   UPGR,C'N'                                                        
         BRAS  RE,VDATE                                                         
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         MVC   REGDATE+3(3),WORK                                                
         MVI   VERLIFT,C'V'                                                     
         MVI   UPGR,C'Y'                                                        
         B     BMKT230                                                          
         DROP  R4                                                               
         SPACE 1                                                                
BMKT220  CLI   VERLIFT,C'V'         IF DEALING WITH A VERSION UPGRADE           
         BNE   BMKT230              AND NO HISTORY FOUND FOR CNET/              
         CLC   TGDATE,REGDATE+3     MKT/CSYS AND DATE DOES NOT FIT              
         BNH   BMKT230              WITHIN ADVICE CYCLE, ERROR                  
         L     R2,TGDUB                                                         
         B     BMKTINV                                                          
********************************************************************            
*&&                                                                             
         SPACE 1                                                                
         USING TAMTD,R4                                                         
BMKT230  LA    R4,ELEMENT        BUILD MARKET DETAILS ELEMENT                   
         XC    ELEMENT,ELEMENT                                                  
         MVI   TAMTEL,TAMTELQ                                                   
         MVI   TAMTLEN,TAMTLNQ                                                  
         MVC   TAMTCODE,TGMTCODE                                                
         BRAS  RE,USEALPH                                                       
         BNE   *+10                                                             
         MVC   TAMTCODE,TGMTALPH                                                
         MVC   TAMTCYCS,TGDATE                                                  
********************************************************************            
*        MVC   TAMTCYCE,CMCCYEND                                                
********************************************************************            
         GOTO1 ADDELEM           AND ADD IT                                     
         SPACE 1                                                                
         CLI   USE1,UWSP                                                        
         BNE   BMKT250                                                          
         CLC   TAMTCODE,=X'D5E800000000'                                        
         BNE   *+8                                                              
         OI    MAJOR,NY                                                         
         CLC   TAMTCODE,=X'D3C100000000'                                        
         BNE   *+8                                                              
         OI    MAJOR,LA                                                         
         CLC   TAMTCODE,=X'C3C8C9000000'                                        
         BNE   *+8                                                              
         OI    MAJOR,CHI                                                        
         B     BMKT250                                                          
         DROP  R4                                                               
         SPACE 1                                                                
BMKT240  ZIC   RE,0(R2)                                                         
         AR    R2,(RE)                                                          
BMKT250  ZIC   RE,0(R2)          BUMP TO NEXT DATE/CODE COMBO FIELD             
         AR    R2,RE                                                            
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         B     BMKT100           AND GO PROCESS IT                              
BMKTX    XIT1                                                                   
         SPACE 2                                                                
*              IF FIRST CNET/MKT/CSYS CODE FIELD IS NOT POPULATED               
*              FIND FIRST ONE THAT IS, AND SHIFT IT UP                          
         SPACE 1                                                                
SFTMKTS  NTR1                                                                   
         LA    R2,CBLCD1H        IF FIRST CODE FIELD IS                         
         CLI   5(R2),0           NOT POPULATED                                  
         BNE   SMKTSX                                                           
         SPACE 1                                                                
SMKTS10  ZIC   RE,0(R2)                                                         
         AR    R2,RE             BUMP TO NEXT HEADER                            
         ZIC   RE,0(R2)                                                         
         AR    R2,RE             TO NEXT DATE                                   
         LR    RF,R2             (SAVE NEXT DATE FIELD)                         
         ZIC   RE,0(R2)                                                         
         AR    R2,RE             AND FINALLY TO NEXT CODE                       
         SPACE 1                                                                
         CR    R2,R3             IF NOT PAST END OF SCREEN                      
         BH    SMKTSX                                                           
         CLI   5(R2),0           AND THIS NEXT CODE FIELD IS POPULATED          
         BE    SMKTS10                                                          
         MVC   CBLDT1,8(RF)      MOVE DATE TO FIRST DATE FIELD                  
         MVC   CBLDT1H+5(1),5(RF)                                               
         OI    CBLDT1H+6,X'80'                                                  
         XC    8(L'CBLDT1,RF),8(RF) AND DELETE WHERE YOU GOT IT FROM            
         MVI   5(RF),0                                                          
         OI    6(RF),X'80'                                                      
         MVC   CBLCD1,8(R2)      MOVE CODE TO FIRST CODE FIELD                  
         MVC   CBLCD1H+5(1),5(R4)                                               
         OI    CBLCD1H+6,X'80'                                                  
         XC    8(L'CBLCD1,R4),8(R4) AND DELETE WHERE YOU GOT IT FROM            
         MVI   5(R4),0                                                          
         OI    6(R4),X'80'                                                      
SMKTSX   B     BMKTX                                                            
         SPACE 2                                                                
BMKTINV  MVI   ERROR,INVALID                                                    
         B     BMKTEXIT                                                         
         SPACE 1                                                                
BMKTMIS  MVI   ERROR,MISSING                                                    
         B     BMKTEXIT                                                         
         SPACE 1                                                                
BMKTPREV MVC   MYMSGNO,=Y(ERONPREV)                                             
         B     BMKTSEXT                                                         
         SPACE 1                                                                
BMKTTWC  MVC   MYMSGNO,=Y(ERDTTWCE)                                             
         B     BMKTSEXT                                                         
         SPACE 1                                                                
BMKTNFND MVC   MYMSGNO,=Y(ERCNNTFD)                                             
         CLI   USE1,UCBL                                                        
         BE    BMKTSEXT                                                         
         CLI   USE1,USCB                                                        
         BE    BMKTSEXT                                                         
         MVC   MYMSGNO,=Y(ERCSNTFD)                                             
         CLI   USE1,ULCB                                                        
         BE    BMKTSEXT                                                         
         MVC   MYMSGNO,=Y(ERMKNTFD)                                             
         B     BMKTSEXT                                                         
         SPACE 1                                                                
BMKTSEXT OI    GENSTAT2,USGETTXT                                                
         MVI   BLOCK,0                                                          
         MVI   MYMTYP,GTMERR                                                    
         B     BMKTEXIT                                                         
         SPACE 1                                                                
BMKTEXIT GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO DETERMINE IF ALPHA CODE SHOULD BE USED TO             
*              READ FOR TMKT RECORDS                                            
         SPACE 1                                                                
USEALPH  NTR1  BASE=*,LABEL=*                                                   
         CLI   TGMENAME,C'T'                                                    
         BNE   UANO                                                             
         CLI   USE1,UCBL                                                        
         BE    UANO                                                             
         CLI   USE1,USCB                                                        
         BE    UANO                                                             
         CLI   USE1,ULCB                                                        
         BE    UANO                                                             
UAYES    XR    RC,RC                                                            
UANO     LTR   RC,RC                                                            
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO BUILD ELEMENTS FROM CLASS A PROGRAM DETAILS           
*              OR ADVICE CAST DETAILS ELEMENTS                                  
         SPACE 1                                                                
* ON ENTRY ... R3=A(FIRST LINE TO PROCESS)                            *         
         SPACE 1                                                                
BLDPAGE  NTR1  BASE=*,LABEL=*                                                   
         LM    R4,R5,0(R1)                                                      
         AR    R4,R3               R4=A(FIRST FIELD IN LINE)                    
         AR    R5,R3               R5=A(LAST FIELD IN LINE)                     
         SPACE 1                                                                
         MVC   SEQFIRST,FRSTSEQ    SAVE FIRST/LAST SEQ FOR WRITEDC              
         MVC   SEQLAST,LASTSEQ                                                  
         MVI   DCRECCHG,C'N'       DEFAULT DC RECORD NOT CHANGED                
         SPACE 1                                                                
         ZIC   R2,FRSTSEQ          R2=FIRST SEQ NUMBER DISPLAYED                
         LTR   R2,R2                                                            
         BZ    BPAG4                                                            
BPAG2    STC   R2,BYTE             IF FIRST SEQ NUMBER NOT 0 ...                
         GOTO1 DELL,DMCB,(1,BYTE)  DELETE EVERYTHING ON SCREEN                  
         LA    R2,1(R2)                                                         
         CLM   R2,1,LASTSEQ                                                     
         BNH   BPAG2                                                            
         IC    R2,FRSTSEQ                                                       
         BCTR  R2,0                                                             
         SPACE 1                                                                
BPAG4    MVC   SVLSEQ,LASTSEQ      SAVE LASTSEQ IN CASE OF ERROR                
         SPACE 1                                                                
         CLI   LWRSCR,SCR0E                  IF ON CLASS A SCREEN               
         BNE   BPAG5                         AND                                
         GOTO1 FLDVAL,DMCB,(X'80',(R3)),100  NOTHING INPUTTED ... EXIT          
         BE    BPAGX                                                            
         SPACE 1                                                                
         GOTO1 FLDVAL,DMCB,(X'40',(R3)),100  ANYTHING INPUTTED ON CLA?          
         B     BPAG6                                                            
BPAG5    GOTO1 FLDVAL,DMCB,(X'40',(R3)),999  ANYTHING INPUTTED ON SES?          
BPAG6    BNE   *+12                                                             
         CLI   PFAID,16                                                         
         BNE   *+12                YES -                                        
         STC   R2,LASTSEQ          SET TO RE-DISPLAY SAME PAGE                  
         MVI   DCRECCHG,C'Y'       SET DC RECORD CHANGED                        
         SPACE 1                                                                
         ZIC   R2,FRSTSEQ          R2=FIRST SEQ NUMBER DISPLAYED                
         ZIC   R0,PAGEMAX          R0=N'LINES                                   
         SPACE 1                                                                
BPAG8    GOTO1 FLDVAL,DMCB,(X'80',(R4)),(R5)  ANY I/P ON CURRENT ROW?           
         BNE   BPAG9                                                            
         CLI   PFAID,16                                                         
         BNE   BPAG10                                                           
         CLM   R2,1,DORSEQ                                                      
         BNE   BPAG10                                                           
         SPACE 1                                                                
BPAG9    CHI   R2,254              MAKE SURE DON'T EXCEED MAX FOR SEQ           
         BH    ERRCAST                                                          
         CLI   LWRSCR,SCR0E        BUILD CLASS A SCREEN ELEMENT                 
         BNE   BPAG9B              DETAILS                                      
         BAS   RE,BLDCLA                                                        
         B     BPAG9A                                                           
BPAG9B   CLI   LWRSCR,SCR04        BUILD SESSION SCREEN ELEMENT                 
         BE    *+6                 DETAILS                                      
         DC    H'00'                                                            
         BAS   RE,BLDTAVC                                                       
         SPACE 1                                                                
BPAG9A   LA    R2,1(R2)            BUMP SEQUENCE NUMBER                         
BPAG10   AH    R3,PAGELNQ          BUMP TO NEXT LINE                            
         AH    R4,PAGELNQ                                                       
         CLI   LWRSCR,SCR0E                                                     
         BNE   *+10                                                             
         MVC   PAGELNQ,=AL2(CLALNQ2)                                            
         AH    R5,PAGELNQ                                                       
         BCT   R0,BPAG8            AND LOOP                                     
         SPACE 1                                                                
         L     R4,AIO              NOW RE-SEQUENCE ALL ELEMENTS                 
         XR    R2,R2               R2=NEW SEQUENCE NUMBER                       
         BRAS  RE,GETEL                                                         
         BNE   BPAGX                                                            
         LA    R2,1(R2)            BUMP TO NEXT SEQ NUMBER                      
         STC   R2,2(R4)            AND SAVE IN EL.                              
         BRAS  RE,NEXTEL           GET NEXT ELEMENT                             
         BE    *-12                AND DO THE SAME                              
BPAGX    XIT1                                                                   
         EJECT                                                                  
*              ROUTINE BUILDS/ADDS CLA PROGRAM DETAIL ELEMENTS                  
         SPACE 1                                                                
* ON ENTRY ... R2=ELEMENT SEQUENCE NUMBER                             *         
*              R3=A(SCREEN FIELD)                                     *         
         SPACE 1                                                                
         USING CLAD,R3                                                          
BLDCLA   NTR1                                                                   
         LA    R1,CLACCSTH                                                      
         CLI   5(R1),0             IF CYCLE START DATE NOT INPUTTED             
         BE    FLDMISS4            CAN'T HAVE CLASS A DETAILS                   
         SPACE 1                                                                
         USING TANPD,R4                                                         
BLDCLA20 LA    R4,ELEMENT          R4=A(CLASS A PROGRAM DETAILS EL.)            
         MVI   TANPEL,TANPELQ      INIT. ELEMENT                                
         MVI   TANPLEN,TANPLNQ2                                                 
         STC   R2,TANPSEQ          SET SEQUENCE NUMBER                          
         SPACE 1                                                                
         ZIC   R0,LASTSEQ          SAVE LASTSEQ                                 
         MVC   LASTSEQ,SVLSEQ      SET LASTSEQ IN CASE OF ERROR                 
         SPACE 1                                                                
         MVI   COPYLAST,0                                                       
         CLC   PAGELNQ,=AL2(CLALNQ)                                             
         BNE   BLDCLA30                                                         
         BAS   RE,VALUSEN          VALIDATE USE NUMBER                          
         BAS   RE,VALDATE          VALIDATE USE DATE                            
         BAS   RE,VALPROG          VALIDATE PROGRAM NAME                        
         BAS   RE,VALLIFT          VALIDATE LIFT                                
         BAS   RE,VALNWK           VALIDATE NETWORK                             
         B     BLDCLA40                                                         
         SPACE 1                                                                
BLDCLA30 BAS   RE,VALUSE2          VALIDATE USE NUMBER                          
         BAS   RE,VALDAT2          VALIDATE USE DATE                            
         BAS   RE,VALPRO2          VALIDATE PROGRAM NAME                        
         BAS   RE,VALLIF2          VALIDATE LIFT                                
         BAS   RE,VALNW2           VALIDATE NETWORK                             
BLDCLA40 BCTR  R2,0                ADJUST TO LAST ELEMENT ADDED                 
         STC   R2,LASTSEQ          INCASE ERROR EXIT TAKEN                      
         L     RE,AIO                                                           
         USING TLDVD,RE                                                         
         CLC   TLDVLEN,=X'79E'                                                  
         BH    TOOBIG                                                           
         GOTO1 ADDELEM             ADD THE ELEMENT                              
         STC   R0,LASTSEQ          RESET LASTSEQ                                
BLDCLAX  B     BPAGX                                                            
         DROP  R3                                                               
TOOBIG   MVI   ERROR,TOOLONG       RECORD IS TOO LONG                           
         LR    R2,R3                                                            
         ZIC   RE,0(R2)                                                         
         AR    R2,RE                                                            
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA USE NUMBERS                              
         SPACE 1                                                                
         USING CLAD,R3             R3=A(THIS BLOCK OF SCREEN FIELDS)            
VALUSEN  NTR1                                                                   
         XC    TANPUSEN,TANPUSEN                                                
         LA    R2,CLAUSENH         USE NUMBER NOT REQUIRED                      
         CLI   5(R2),0                                                          
         BE    BPAGX                                                            
         SPACE 1                                                                
         TM    4(R2),X'08'         MUST BE NUMERIC                              
         BZ    FLDINV3                                                          
         SPACE 1                                                                
         ZIC   R1,5(R2)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         PACK  DUB,8(0,R2)                                                      
         CVB   R1,DUB                                                           
         LTR   R1,R1               CANNOT BE ZERO                               
         BZ    FLDINV3                                                          
         STCM  R1,3,TANPUSEN       SAVE BINARY USE NUMBER                       
         B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA USE DATES                                
         SPACE 1                                                                
         USING CLAD,R3             R3=A(THIS BLOCK OF SCREEN FIELDS)            
VALDATE  NTR1                                                                   
         LA    R2,CLADATEH         DATE REQUIRED                                
         GOTO1 ANY                                                              
         SPACE                                                                  
         CLI   8(R2),C'*'          ASTERISK MEANS SAME AS LAST                  
         BNE   VDTE8                                                            
         OC    TANPDATE,TANPDATE   LAST REQUIRED                                
         BZ    FLDINV3                                                          
         MVI   COPYLAST,C'Y'                                                    
         GOTO1 DATCON,DMCB,(1,TANPDATE),(8,8(R2))                               
         OI    6(R2),X'80'                                                      
         B     VDTEX               USE LAST                                     
         SPACE 1                                                                
VDTE8    CLC   =C'TBA',8(R2)                                                    
         BNE   *+14                TBA MEANS UNKNOWN DATE                       
         MVC   TANPDATE,8(R2)                                                   
         B     VDTEX                                                            
         SPACE 1                                                                
         BRAS  RE,VDATE            VALIDATE DATE (SAVE IN DUB)                  
         GOTO1 DATCON,DMCB,(0,DUB),(1,TANPDATE) SAVE IN ELEMENT                 
VDTEX    B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA PROGRAM NAMES                            
         USING CLAD,R3             R3=A(SCREEN ENTRY)                           
VALPROG  NTR1                                                                   
         LA    R2,CLAPROGH                                                      
         CLI   5(R2),0             IF PROGRAM NAME NOT INPUT                    
         BNE   VPRG2                                                            
         CLI   COPYLAST,C'Y'       AND COPYING LAST LINE                        
         BE    *+10                KEEP TANPNAME THE SAME                       
         XC    TANPPNME,TANPPNME   IF NOT COPYING LAST LINE CLEAR IT            
         B     VPRGX                                                            
         SPACE 1                                                                
VPRG2    CLI   8(R2),C'*'          ASTERISK MEANS SAME AS LAST                  
         BNE   VPRG4                                                            
         OC    TANPPNME,TANPPNME   LAST REQUIRED                                
         BZ    FLDINV3                                                          
         MVI   COPYLAST,C'Y'                                                    
         MVC   8(15,R2),TANPPNME   MOVE LAST TO SCREEN                          
         OI    6(R2),X'80'                                                      
         B     VPRGX                                                            
         SPACE 1                                                                
VPRG4    MVI   COPYLAST,0                                                       
         MVC   TANPPNME,8(R2)      OTHERWISE, SAVE INPUTTED PROGRAM             
         OC    TANPPNME,SPACES     NAME                                         
VPRGX    B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA NETWORK FIELD                            
         SPACE 1                                                                
VALNWK   NTR1                                                                   
         LA    R2,CLANWKH                                                       
         CLI   5(R2),0             IF NETWORK FIELD NOT INPUTTED                
         BNE   VNWK10                                                           
         CLI   COPYLAST,C'Y'       BUT COPYING LAST ... EXIT                    
         BNE   VNWK05                                                           
         MVC   8(L'TANPNWK,R2),TANPNWK                                          
         OI    6(R2),X'80'                                                      
         B     BPAGX                                                            
VNWK05   CLI   USE1,UCLA                                                        
         BE    VNWK10                                                           
**NO-OP  CLI   USE1,UPAX                                                        
**04/13  BNE   VNWK06                                                           
**       MVI   8(R2),C'X'                                                       
**       OI    6(R2),X'80'                                                      
**       MVI   5(R2),1                                                          
**NO-OP  B     VNWK10                                                           
VNWK06   CLI   NWKREQ,C'Y'         OTHERWISE IF NETWORK REQUIRED FOR            
         BE    FLDMISS3            CLA USES ... FIELD MISSING                   
         SPACE 1                                                                
VNWK10   CLI   8(R2),C'*'                                                       
         BE    FLDINV3                                                          
         MVC   TANPNWK,8(R2)                                                    
         CLI   USE1,ULNA           IF ADDING LATE NIGHT ABC ADVICE              
         BNE   *+12                                                             
         CLI   8(R2),C'A'          NETWORK MUST BE ABC                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,ULNN           IF ADDING LATE NIGHT NBC ADVICE              
         BNE   *+12                                                             
         CLI   8(R2),C'N'          NETWORK MUST BE NBC                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,ULNC           IF ADDING LATE NIGHT CBS                     
         BNE   *+12                                                             
         CLI   8(R2),C'C'          NETWORK MUST BE CBS                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,ULNF           IF ADDING LATE NIGHT FOX                     
         BNE   *+12                                                             
         CLI   8(R2),C'F'          NETWORK MUST BE FOX                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,UPAX           IF ADDING PAX                                
         BNE   BPAGX                                                            
         CLI   8(R2),C'X'          NETWORK MUST BE PAX                          
         BE    BPAGX                                                            
         CLI   8(R2),C'B'          OR BOUNCE                                    
         BE    BPAGX                                                            
         CLI   8(R2),C'E'          OR ME TV                                     
         BE    BPAGX                                                            
         CLI   8(R2),C'Y'          OR ANTENNA TV                                
         BE    BPAGX                                                            
         CLI   8(R2),C'Z'          OR COZI TV                                   
         BE    BPAGX                                                            
         CLI   8(R2),C'P'          OR ESCAPE                                    
         BE    BPAGX                                                            
         CLI   8(R2),C'G'          OR GET TV                                    
         BE    BPAGX                                                            
         CLI   8(R2),C'R'          OR GRIT                                      
         BE    BPAGX                                                            
         CLI   8(R2),C'J'          OR JUSTICE                                   
         BE    BPAGX                                                            
         CLI   8(R2),C'L'          OR LAFF                                      
         BE    BPAGX                                                            
         CLI   8(R2),C'T'          OR THIS TV                                   
         BNE   FLDINV3                                                          
         B     BPAGX                                                            
         DROP  R4                                                               
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA LIFT FIELD                               
         SPACE 1                                                                
         USING TANPD,R4                                                         
VALLIFT  NTR1                                                                   
         LA    R2,CLALIFTH                                                      
         CLI   5(R2),0                                                          
         BNE   VLIFT05                                                          
         CLI   COPYLAST,C'Y'                                                    
         BNE   VLIFT10                                                          
         MVC   8(L'TANPLFT,R2),TANPLFT                                          
         OI    6(R2),X'80'                                                      
         B     BLDCLAX                                                          
VLIFT05  CLI   8(R2),C'Y'                                                       
         BE    VLIFT10                                                          
         CLI   8(R2),C'N'                                                       
         BNE   FLDINV3                                                          
VLIFT10  MVC   TANPLFT,8(R2)                                                    
         B     BLDCLAX                                                          
         DROP  R3                                                               
         SPACE 2                                                                
         EJECT                                                                  
*              ROUTINE TO VALIDATE CLA USE NUMBERS                              
         SPACE 1                                                                
         USING CLA2D,R3            R3=A(THIS BLOCK OF SCREEN FIELDS)            
VALUSE2  NTR1                                                                   
         XC    TANPUSEN,TANPUSEN                                                
         LA    R2,CLAUSE2H         USE NUMBER NOT REQUIRED                      
         CLI   5(R2),0                                                          
         BE    BPAGX                                                            
         SPACE 1                                                                
         TM    4(R2),X'08'         MUST BE NUMERIC                              
         BZ    FLDINV3                                                          
         SPACE 1                                                                
         ZIC   R1,5(R2)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         PACK  DUB,8(0,R2)                                                      
         CVB   R1,DUB                                                           
         LTR   R1,R1               CANNOT BE ZERO                               
         BZ    FLDINV3                                                          
         STCM  R1,3,TANPUSEN       SAVE BINARY USE NUMBER                       
         B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA USE DATES                                
         SPACE 1                                                                
         USING CLA2D,R3            R3=A(THIS BLOCK OF SCREEN FIELDS)            
VALDAT2  NTR1                                                                   
         LA    R2,CLADAT2H         DATE REQUIRED                                
         GOTO1 ANY                                                              
         SPACE                                                                  
         CLI   8(R2),C'*'          ASTERISK MEANS SAME AS LAST                  
         BNE   VDTE28                                                           
         OC    TANPDATE,TANPDATE   LAST REQUIRED                                
         BZ    FLDINV3                                                          
         MVI   COPYLAST,C'Y'                                                    
         GOTO1 DATCON,DMCB,(1,TANPDATE),(8,8(R2))                               
         OI    6(R2),X'80'                                                      
         B     VDTE2X              USE LAST                                     
         SPACE 1                                                                
VDTE28   CLC   =C'TBA',8(R2)                                                    
         BNE   *+14                TBA MEANS UNKNOWN DATE                       
         MVC   TANPDATE,8(R2)                                                   
         B     VDTE2X                                                           
         SPACE 1                                                                
         CLI   5(R2),5             IF L'I/P LESS OR EQUAL TO FIVE               
         BH    VDTE212                                                          
         GOTO1 DATVAL,DMCB,(1,8(R2)),DUB   VALIDATE MONTH/DAY ONLY              
         OC    0(4,R1),0(R1)                                                    
         BZ    FLDINV3                                                          
         MVC   DUB(2),CYCSTART     CARRY YEAR FROM CYCLE START                  
         CLC   CYCSTART(2),CYCEND  IF  CYCLE START YEAR <> END                  
         BE    VDTE213                                                          
         CLC   DUB+2(4),CYCSTART+2 IF MM/DD IS LESS THAN CYCLE START            
         BNL   VDTE211              AND                                         
         CLC   DUB+2(4),CYCEND+2   MM/DD IS NOT GREATER THAN CYCLE END          
         BH    FLDINV3                                                          
         MVC   DUB(2),CYCEND       CARRY YEAR FROM CYCLE END                    
VDTE211  B     VDTE214                                                          
         SPACE 1                                                                
VDTE212  GOTO1 DATVAL,DMCB,8(R2),DUB                                            
         OC    0(4,R1),0(R1)       OTHERWISE, VALIDATE Y/M/D                    
         BZ    FLDINV3                                                          
         SPACE 1                                                                
VDTE213  CLC   DUB(6),CYCSTART     IF USE DATE NOT BEFORE CYCLE START           
         BL    FLDINV3                                                          
         CLC   DUB(6),CYCEND       AND NOT AFTER CYCLE END                      
         BH    FLDINV3                                                          
VDTE214  GOTO1 DATCON,DMCB,(0,DUB),(1,TANPDATE) SAVE IN ELEMENT                 
VDTE2X   B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA PROGRAM NAMES                            
         USING CLA2D,R3            R3=A(SCREEN ENTRY)                           
VALPRO2  NTR1                                                                   
         LA    R2,CLAPRO2H                                                      
         CLI   5(R2),0             IF PROGRAM NAME NOT INPUT                    
         BNE   VPRG22                                                           
         CLI   COPYLAST,C'Y'       AND COPYING LAST LINE                        
         BE    *+10                KEEP TANPNAME THE SAME                       
         XC    TANPPNME,TANPPNME   IF NOT COPYING LAST LINE CLEAR IT            
         B     VPRG2X                                                           
         SPACE 1                                                                
VPRG22   CLI   8(R2),C'*'          ASTERISK MEANS SAME AS LAST                  
         BNE   VPRG24                                                           
         OC    TANPPNME,TANPPNME   LAST REQUIRED                                
         BZ    FLDINV3                                                          
         MVI   COPYLAST,C'Y'                                                    
         MVC   8(15,R2),TANPPNME   MOVE LAST TO SCREEN                          
         OI    6(R2),X'80'                                                      
         B     VPRG2X                                                           
         SPACE 1                                                                
VPRG24   MVI   COPYLAST,0                                                       
         MVC   TANPPNME,8(R2)      OTHERWISE, SAVE INPUTTED PROGRAM             
         OC    TANPPNME,SPACES     NAME                                         
VPRG2X   B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA NETWORK FIELD                            
         SPACE 1                                                                
VALNW2   NTR1                                                                   
         LA    R2,CLANW2H                                                       
         CLI   5(R2),0             IF NETWORK FIELD NOT INPUTTED                
         BNE   VNWK210                                                          
         CLI   COPYLAST,C'Y'       BUT COPYING LAST ... EXIT                    
         BNE   VNWK205                                                          
         MVC   8(L'TANPNWK,R2),TANPNWK                                          
         OI    6(R2),X'80'                                                      
         B     BPAGX                                                            
VNWK205  CLI   USE1,UCLA                                                        
         BE    VNWK210                                                          
**NO-OP  CLI   USE1,UPAX                                                        
**04/13  BNE   VNWK206                                                          
**       MVI   8(R2),C'X'                                                       
**       OI    6(R2),X'80'                                                      
**       MVI   5(R2),1                                                          
**NO-OP  B     VNWK210                                                          
VNWK206  CLI   NWKREQ,C'Y'         OTHERWISE IF NETWORK REQUIRED FOR            
         BE    FLDMISS3            CLA USES ... FIELD MISSING                   
         SPACE 1                                                                
VNWK210  MVC   TANPNWK,8(R2)                                                    
         CLI   USE1,ULNA           IF ADDING LATE NIGHT ABC ADVICE              
         BNE   *+12                                                             
         CLI   8(R2),C'A'          NETWORK MUST BE ABC                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,ULNN           IF ADDING LATE NIGHT NBC ADVICE              
         BNE   *+12                                                             
         CLI   8(R2),C'N'          NETWORK MUST BE NBC                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,ULNC           IF ADDING LATE NIGHT CBS                     
         BNE   *+12                                                             
         CLI   8(R2),C'C'          NETWORK MUST BE CBS                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,ULNF           IF ADDING LATE NIGHT FOX                     
         BNE   *+12                                                             
         CLI   8(R2),C'F'          NETWORK MUST BE FOX                          
         BNE   FLDINV3                                                          
         SPACE 1                                                                
         CLI   USE1,UPAX           IF ADDING PAX                                
         BNE   BPAGX                                                            
         CLI   8(R2),C'X'          NETWORK MUST BE PAX                          
         BE    BPAGX                                                            
         CLI   8(R2),C'B'          OR BOUNCE                                    
         BE    BPAGX                                                            
         CLI   8(R2),C'E'          OR ME TV                                     
         BE    BPAGX                                                            
         CLI   8(R2),C'Y'          OR ANTENNA TV                                
         BE    BPAGX                                                            
         CLI   8(R2),C'Z'          OR COZI TV                                   
         BE    BPAGX                                                            
         CLI   8(R2),C'P'          OR ESCAPE                                    
         BE    BPAGX                                                            
         CLI   8(R2),C'G'          OR GET TV                                    
         BE    BPAGX                                                            
         CLI   8(R2),C'R'          OR GRIT                                      
         BE    BPAGX                                                            
         CLI   8(R2),C'J'          OR JUSTICE                                   
         BE    BPAGX                                                            
         CLI   8(R2),C'L'          OR LAFF                                      
         BE    BPAGX                                                            
         CLI   8(R2),C'T'          OR THIS TV                                   
         BNE   FLDINV3                                                          
         B     BPAGX                                                            
         DROP  R4                                                               
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CLA LIFT FIELD                               
         SPACE 1                                                                
         USING TANPD,R4                                                         
VALLIF2  NTR1                                                                   
         LA    R2,CLALIF2H                                                      
         CLI   5(R2),0                                                          
         BNE   VLIFT205                                                         
         CLI   COPYLAST,C'Y'                                                    
         BNE   VLIFT210                                                         
         MVC   8(L'TANPLFT,R2),TANPLFT                                          
         OI    6(R2),X'80'                                                      
         B     BLDCLAX                                                          
VLIFT205 CLI   8(R2),C'Y'                                                       
         BE    VLIFT210                                                         
         CLI   8(R2),C'N'                                                       
         BNE   FLDINV3                                                          
VLIFT210 MVC   TANPLFT,8(R2)                                                    
         B     BLDCLAX                                                          
         DROP  R3,R4                                                            
         EJECT                                                                  
*              ROUTINE TO BUILD AN ADVICE CAST DETAILS EL.                      
         SPACE 1                                                                
* R2=ELEMENT SEQUENCE NUMBER                                          *         
* R3=A(LINE)                                                          *         
* AIO=ADCREC                                                          *         
         SPACE 1                                                                
         USING LINED,R3                                                         
BLDTAVC  NTR1                                                                   
         XC    ELEMENT,ELEMENT                                                  
         USING TAVCD,R4                                                         
         LA    R4,ELEMENT          R4=A(ADVICE CAST DETAILS EL.)                
         MVI   TAVCEL,TAVCELQ      ELEMENT CODE                                 
         MVI   TAVCLEN,TAVCLNQ     ELEMENT LENGTH (MAY CHANGE IF CMNT)          
         STC   R2,TAVCSEQ          SEQUENCE NUMBER                              
         SPACE 1                                                                
         OI    TAVCSTAT,TAVCNEWS                                                
         SPACE 1                                                                
         ZIC   R0,LASTSEQ          SAVE LASTSEQ                                 
         MVC   LASTSEQ,SVLSEQ      SET LASTSEQ IN CASE OF ERROR                 
         SPACE 1                                                                
         BAS   RE,VALSSN           VALIDATE S/S NUMBER                          
         LA    R2,LINNAMEH         VALIDATE PERFORMER NAME                      
         GOTO1 ANY                                                              
         MVC   TAVCNAME,WORK                                                    
         SPACE 1                                                                
         TM    LINSSNH+1,X'20'     IF S/S NUMBER PROTECTED                      
         BZ    *+8                                                              
         OI    TAVCSTAT,TAVCACTL   SET ACTUAL CAST MEMBER                       
         SPACE 1                                                                
         TM    TAVCSTAT,TAVCACTL   IF ACTUAL CAST MEMBER                        
         BZ    BVC20                                                            
         CLC   LINDTAG(9),=CL9'*DELETED*'  IF PREVIOUSLY MARKED DELETED         
         BNE   *+8                                                              
         OI    TAVCSTAT,TAVCDEL    KEEP CAST MEMBER DELETED                     
         CLI   PFAID,16            IF DELETE/RESTORE PFKEY HIT                  
         BNE   BVC20                                                            
         CLC   TAVCSEQ,DORSEQ      FOR THIS CAST MEMBER                         
         BNE   BVC20                                                            
         TM    TAVCSTAT,TAVCDEL    TEST CAST MEMBER DELETED                     
         BO    *+12                                                             
         OI    TAVCSTAT,TAVCDEL        NOT DELETED-SET STATUS DELETED           
         B     *+8                                                              
         NI    TAVCSTAT,X'FF'-TAVCDEL  DELETED-TURN OFF DELETED                 
         SPACE 1                                                                
BVC20    BAS   RE,VALCAT           VALIDATE CATEGORY CODE                       
         BAS   RE,VALCAM           VALIDATE ON/OFF CAMERA                       
         BAS   RE,VALUN            VALIDATE UNION                               
         BAS   RE,VALDBL           VALIDATE DOUBLES                             
         BAS   RE,VALLFT           VALIDATE LIFT                                
         SPACE 1                                                                
         LA    R2,LINOV1H          OVERSCALE RATE 1                             
         BAS   RE,VALOV                                                         
         MVC   TAVCOV1,FULL                                                     
         SPACE 1                                                                
         LA    R2,LINOV2H          OVERSCALE RATE 2                             
         BAS   RE,VALOV                                                         
         MVC   TAVCOV2,FULL                                                     
         SPACE 1                                                                
         BAS   RE,VALCMT           VALIDATE COMMENT                             
         SPACE 1                                                                
         ZIC   R2,TAVCSEQ          ADJUST TO LAST ELEMENT ADDED                 
         BCTR  R2,0                INCASE ERROR EXIT TAKEN                      
         STC   R2,LASTSEQ                                                       
         GOTOR MYADDL              ADD TO ADVICE CAST RECORD                    
         STC   R0,LASTSEQ          RESET LASTSEQ                                
BLDTAVCX B     BPAGX                                                            
         SPACE 2                                                                
*              ROUTINE TO VALIDATE S/S NUMBER FIELD                             
         SPACE 1                                                                
VALSSN   NTR1                                                                   
         LA    R2,LINSSNH          SOCIAL SECURITY NUMBER                       
         CLI   5(R2),0             IF INPUT,                                    
         BE    VALSSNX                                                          
         SPACE 1                                                                
         TM    TGSYSTAT,TASYSPID   ARE WE USING PID#?                           
         BZ    VALSSN10                                                         
         CLI   LINSSNH+5,6         CONVERT TO SS# ON SCREEN                     
         BH    VALSSN10                                                         
         MVC   TGPID,LINSSN                                                     
         XC    LINSSN,LINSSN                                                    
         GOTO1 SSNUNPK,DMCB,TGPID,LINSSN                                        
         BNE   VALSSN10                                                         
         MVI   LINSSNH+5,9                                                      
         SPACE 1                                                                
VALSSN10 L     R0,AIO              SAVE IO                                      
         MVC   AIO,AIO2                                                         
         GOTO1 RECVAL,DMCB,TLW4CDQ,(X'28',(R2)),LINNAMEH  VALIDATE              
         ST    R0,AIO              RESTORE IO                                   
         SPACE 1                                                                
         TM    TGSYSTAT,TASYSPID   ARE WE USING PID#?                           
         BZ    VALSSN20                                                         
         XC    LINSSN,LINSSN                                                    
         GOTO1 SSNPACK,DMCB,TGSSN,LINSSN                                        
         MVI   LINSSNH+5,6                                                      
         OI    LINSSNH+6,X'80'                                                  
         SPACE 1                                                                
VALSSN20 MVI   LINNAMEH+5,L'LINNAME                                             
         PACK  DUB,TGSSN           PACK IT                                      
         CVB   R1,DUB                                                           
         ST    R1,TAVCSSN          SAVE AS BINARY IN EL.                        
         MVI   ELCODE,TAVCELQ      RESTORE ELCODE                               
VALSSNX  B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE TO VALIDATE CATEGORY                                     
         SPACE 1                                                                
VALCAT   NTR1                                                                   
         LA    R2,LINCATH          VALIDATE CATEGORY                            
         GOTO1 ANY                                                              
         GOTO1 CATVAL,DMCB,WORK                                                 
         BNE   FLDINV3                                                          
         MVC   TAVCCAT,TGCAEQU     SAVE EQUATE IN EL.                           
         B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE TO VALIDATE ON/OFF CAMERA FIELD                          
         SPACE 1                                                                
VALCAM   NTR1                                                                   
         LA    R2,LINCAMH          ON/OFF CAMERA                                
         GOTO1 ANY                                                              
         CLC   =C'OFF',WORK                                                     
         BE    VALCAMX                                                          
         CLC   =C'ON ',WORK                                                     
         BNE   FLDINV3                                                          
         OI    TAVCSTAT,TAVCSON    SET ON-CAMERA STATUS                         
VALCAMX  B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE TO VALIDATE UNION FIELD                                  
         SPACE 1                                                                
VALUN    NTR1                                                                   
         LA    R2,LINUNIH          UNION                                        
         GOTO1 ANY                                                              
         GOTO1 UNIVAL,DMCB,WORK                                                 
         BNE   FLDINV3                                                          
         MVC   TAVCUNI,TGUNEQU     SAVE EQUATE IN EL.                           
         MVC   TAVCUNI3,LINUNI                                                  
         B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE TO VALIDATE DOUBLES FIELD                                
         SPACE 1                                                                
VALDBL   NTR1                                                                   
         LA    R2,LINDBLH          DOUBLES                                      
         CLI   5(R2),0                                                          
         BE    VALDBLX                                                          
         GOTO1 VALINUM                                                          
         MVC   TAVCDBL,8(R2)       SAVE CHARACTER IN EL.                        
VALDBLX  B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE TO VALIDATE LIFT FIELD                                   
         SPACE 1                                                                
VALLFT   NTR1                                                                   
         LA    R2,LINLFTH          LIFT STATUS                                  
         CLI   5(R2),0                                                          
         BE    VALLFTX                                                          
         CLI   8(R2),C'N'          NOT ON LIFT                                  
         BE    VALLFTX                                                          
         SPACE 1                                                                
         CLI   8(R2),C'Y'          ON LIFT                                      
         BNE   *+12                                                             
         OI    TAVCSTAT,TAVCLFT    SET CORRES. STATUS BIT                       
         B     VALLFTX                                                          
         SPACE 1                                                                
         CLI   8(R2),C'O'          ONLY ON LIFT                                 
         BNE   FLDINV3                                                          
         OI    TAVCSTAT,TAVCOLFT   SET CORRES. STATUS BIT                       
VALLFTX  B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE VALIDATES AN OVERSCALE RATE FIELD                        
         SPACE 1                                                                
VALOV    NTR1                                                                   
         MVI   BYTE,0                                                           
         CLI   8(R2),C'%'          PERCENT SCALE WANTED                         
         BNE   VOV10                                                            
         ZIC   RF,5(R2)            GET LENGTH                                   
         BCTR  RF,0                                                             
         STC   RF,5(R2)            TAKE OFF THE %                               
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),9(R2)       SHIFT OUT THE WHOLE FIELD                    
         LA    RF,9(RF,R2)                                                      
         MVI   0(RF),C' '          SPACE OUT LAST CHAR                          
         OI    BYTE,X'80'                                                       
         SPACE 1                                                                
VOV10    XC    FULL,FULL           PRE-CLEAR RETURN AREA                        
         ZIC   RF,5(R2)                                                         
         LTR   RF,RF               TEST FOR INPUT                               
         BZ    VOVX                                                             
         GOTO1 VALIDEC             VALIDATE PERCENTAGE                          
         TM    FULL,X'80'                                                       
         BO    FLDINV3                                                          
         CLI   BYTE,0                                                           
         BE    *+8                                                              
         OI    FULL,X'80'                                                       
VOVX     B     BLDTAVCX                                                         
         SPACE 2                                                                
*              ROUTINE TO VALIDATE COMMENT FIELD                                
         SPACE                                                                  
VALCMT   NTR1                                                                   
         LA    R2,LINCMTH          COMMENT                                      
         CLI   5(R2),0                                                          
         BE    VALCMTX                                                          
         ZIC   R1,5(R2)            SET FOR EXECUTED MOVE                        
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   TAVCCMT(0),8(R2)    MOVE COMMENT TO EL.                          
         LA    R1,TAVCLNQ+1(R1)                                                 
         STC   R1,TAVCLEN          SET NEW L'ELEMENT                            
VALCMTX  B     BLDTAVCX                                                         
         DROP  R3,R4                                                            
         SPACE 2                                                                
*              ERROR MESSAGES AND LITERALS FOR BLDPAGE                          
*              AND ITS SUBROUTINES                                              
         SPACE                                                                  
ERRCAST  MVI   ERROR,ERTOOCST      CAST TOO LARGE                               
         LA    R2,MENCIDH                                                       
         B     ERRXIT                                                           
FLDMISS4 LA    R2,CLACCSTH                                                      
FLDMISS3 MVI   ERROR,MISSING       MISSING INPUT FIELD                          
         B     ERRXIT                                                           
FLDINV3  MVI   ERROR,INVALID       INVALID INPUT FIELD                          
ERRXIT   GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              VALIDATE DATE, MAKE SURE IT FITS IN CYCLE                        
*              AND SAVE IN DUB                                                  
         SPACE 1                                                                
VDATE    NTR1  BASE=*,LABEL=*                                                   
         GOTO1 DATCON,DMCB,(1,REGDATE),(0,CYCSTART)                             
         GOTO1 (RF),(R1),(1,REGDATE+3),(0,CYCEND)                               
         SPACE 1                                                                
         CLI   8(R2),C'*'                                                       
         BNE   VD10                                                             
         GOTO1 DATCON,DMCB,(1,TGDATE),(8,8(R2))                                 
         MVI   5(R2),8                                                          
         OI    6(R2),X'80'                                                      
         SPACE 1                                                                
VD10     CLI   5(R2),5             IF L'I/P LESS OR EQUAL TO FIVE               
         BH    VD30                                                             
         GOTO1 DATVAL,DMCB,(1,8(R2)),DUB   VALIDATE MONTH/DAY ONLY              
         OC    0(4,R1),0(R1)                                                    
         BZ    VDINV                                                            
         MVC   DUB(2),CYCSTART     CARRY YEAR FROM CYCLE START                  
         CLC   CYCSTART(2),CYCEND  IF  CYCLE START YEAR <> END                  
         BE    VD40                                                             
         CLC   DUB+2(4),CYCSTART+2 IF MM/DD IS LESS THAN CYCLE START            
         BNL   VD50                AND                                          
         BAS   RE,VERUPG                                                        
         BE    VD20                                                             
         CLC   DUB+2(4),CYCEND+2   MM/DD IS NOT GREATER THAN CYCLE END          
         BH    VDINV                                                            
VD20     MVC   DUB(2),CYCEND       CARRY YEAR FROM CYCLE END                    
         B     VD50                                                             
         SPACE 1                                                                
VD30     GOTO1 DATVAL,DMCB,8(R2),DUB                                            
         OC    0(4,R1),0(R1)       OTHERWISE, VALIDATE Y/M/D                    
         BZ    VDINV                                                            
         SPACE 1                                                                
VD40     CLC   DUB(6),CYCSTART     IF USE DATE NOT BEFORE CYCLE START           
         BL    VDINV                                                            
         BAS   RE,VERUPG                                                        
         BE    VD50                                                             
         CLC   DUB(6),CYCEND       AND NOT AFTER CYCLE END                      
         BH    VDINV                                                            
VD50     GOTO1 DATCON,DMCB,(0,DUB),(1,TGDATE)                                   
VDX      XIT1                                                                   
         SPACE 2                                                                
*              ROUTINE TO RETURN POSITIVE CONDITION CODE IF ADVICE              
*              IS AN UPGRADE TO A VERSION                                       
         SPACE 1                                                                
VERUPG   CLI   VERLIFT,C'V'                                                     
         BNER  RE                                                               
         CLI   UPGR,C'Y'                                                        
         BNER  RE                                                               
         BR    RE                                                               
         SPACE 1                                                                
VDINV    MVI   ERROR,INVALID                                                    
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              ROUTINE TO ADD ELEMENT TO VIRTUAL ADVICE CAST RECORD             
         SPACE                                                                  
MYADDL   NTR1  BASE=*,LABEL=*                                                   
         L     R3,ADCREC                                                        
         GOTO1 HELLO,DMCB,(C'P',SYSFIL),(R3),ELEMENT,0                          
         CLI   12(R1),5                                                         
         BE    MYADDL10                                                         
         CLI   12(R1),0                                                         
         BE    *+6                                                              
         DC    H'00'                                                            
         USING TLDCD,R3                                                         
MYADDL10 SR    RE,RE                                                            
         ICM   RE,3,=AL2(42000)    CUMULATIVE MAX RECORD SIZE                   
         CH    RE,TLDCLEN                                                       
         BL    RCTOOLNG                                                         
         XIT1                                                                   
         DROP  R3                                                               
         SPACE 2                                                                
*              MYADDL'S ERROR MESSAGES AND LITERALS                             
         SPACE                                                                  
RCTOOLNG MVI   ERROR,TOOLONG       RECORD IS TOO LONG                           
         LA    R2,MENAGYH                                                       
         GOTO1 EXIT,DMCB,0                                                      
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*              SETS S/S NUMBER FIELDS IN SESSION SCREEN UNPROTECTED             
STSCR04  NTR1  BASE=*,LABEL=*                                                   
         LA    R1,PMAXSESS         SET S/S NUMBER FIELDS UNPROTECTED            
         LA    R3,SDSFRSTH         R3=A(FIRST S/S NUMBER FIELD)                 
         USING LINED,R3                                                         
STSCR045 NI    LINSSNH+1,X'DF'     MAKE UNPROTECTED                             
         OI    LINSSNH+6,X'80'     AND TRANSMIT                                 
         CLI   MODE,PRINTREP       IF PRINT REPORT                              
         BNE   *+10                                                             
         XC    LINSSN,LINSSN       ALSO CLEAR FIELD                             
         XC    LINDTAG,LINDTAG     AND CLEAR PROTECTED TAG FIELD                
         OI    LINDTAGH+6,X'80'    AND TRANSMIT                                 
         AHI   R3,LINLNQ           BUMP TO NEXT LINE                            
         BCT   R1,STSCR045                                                      
STSCR04X XIT1                                                                   
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
*        SETS VLCOTYPE WITH TYPE OF ADVICE'S COMMERCIAL/VERSION                 
         SPACE 1                                                                
SETTYPE  NTR1  BASE=*,LABEL=*                                                   
         MVC   VLCOTYPE,TGCTEQU       DEFAULT TO COMMERCIAL TYPE                
         SPACE 1                                                                
         CLI   MENVERH+5,0            IF ADDING ADVICE FOR VERSION              
         BE    STYPEX                 2 OR HIGHER ...                           
         CLI   VERLIFT,C'V'                                                     
         BNE   STYPEX                                                           
         CLI   MENVER,0                                                         
         BE    STYPEX                                                           
         CLI   MENVER,C' '                                                      
         BE    STYPEX                                                           
         LA    R2,MENVERH                                                       
         GOTO1 VALINUM                                                          
         CLI   ACTUAL,1                                                         
         BE    STYPEX                                                           
         MVC   AIO,AIO2                                                         
         GOTO1 RECVAL,DMCB,TLVRCDQ,(X'A4',ACTUAL)                               
         BNE   STYPE10                                                          
         SPACE 1                                                                
         USING TACOD,R4                                                         
         L     R4,AIO2                READ VERSION RECORD                       
         MVI   ELCODE,TACOELQ                                                   
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'00'                                                            
         MVC   VLCOTYPE,TACOTYPE      AND SET TYPE AS VERSION TYPE              
         DROP  R4                                                               
         SPACE 1                                                                
STYPE10  CLI   ACTNUM,ACTADD                                                    
         BE    STYPE20                                                          
         L     R4,AIO1                                                          
         MVC   KEY(L'TLDVKEY),0(R4)                                             
         GOTO1 HIGH                                                             
         CLC   KEY(L'TLDVKEY),KEYSAVE                                           
         BE    *+6                                                              
         DC    H'00'                                                            
         GOTO1 GETREC                                                           
STYPE20  MVC   AIO,AIO1                                                         
STYPEX   XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        ROUTINE SETS TOTAL NUMBER OF CLASS A SCREENS NEEDED          *         
***********************************************************************         
                                                                                
STNPAGES NTR1  BASE=*,LABEL=*                                                   
         CLI   LWRSCR,SCR0E                                                     
         JNE   SNPXIT                                                           
                                                                                
         XR    R1,R1                                                            
                                                                                
         USING TANPD,R4                                                         
         L     R4,AIO                                                           
         MVI   ELCODE,TANPELQ                                                   
         BRAS  RE,GETEL                                                         
         J     *+8                                                              
SNP10    BRAS  RE,NEXTEL                                                        
         JNE   SNP20                                                            
         AHI   R1,1                                                             
         STC   R1,TANPSEQ                                                       
         J     SNP10                                                            
         DROP  R4                                                               
                                                                                
SNP20    LTR   R1,R1                                                            
         JNZ   SNP30                                                            
         MVI   NPAGES,1                                                         
         J     SNPXIT                                                           
                                                                                
SNP30    XR    R0,R0                                                            
         XC    TGFULL,TGFULL                                                    
         MVI   TGFULL+3,PMAXCLA                                                 
         D     R0,TGFULL                                                        
         LTR   R0,R0                                                            
         BZ    *+8                                                              
         AHI   R1,1                                                             
         STC   R1,NPAGES                                                        
SNPXIT   XIT1                                                                   
                                                                                
**********************************************************************          
*        CONSTANTS AND LITERALS                                                 
**********************************************************************          
                                                                                
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
*        ROUTINE TO BUILD TABLE OF VALID PF KEY SCREEN FLIPS          *         
***********************************************************************         
                                                                                
BLDPFTAB NTR1  BASE=*,LABEL=*                                                   
         XC    VPFKTAB,VPFKTAB     CLEAR VALID PF KEY TABLE                     
                                                                                
         LA    R3,VPFKTAB          R3=A(SCRN FLD TO SCRN # TABLE)               
         LA    R4,PFNUMS           R4=A(VALID PF KEY TABLE)                     
BLDPF10  CLI   0(R4),X'FF'                                                      
         JE    BLDPF30                                                          
         ZICM  R2,1(R4),2                                                       
         AR    R2,RA                                                            
         CLI   0(R2),C'P'          IF P IS FIRST CHARACTER IN FIELD             
         JNE   BLDPF20                                                          
         MVC   0(1,R3),0(R4)       MOVE PF KEY # CORRESPONDING                  
         LA    R3,1(R3)            TO FIELD INTO VALID PF KEY TABLE             
BLDPF20  LA    R4,3(R4)                                                         
         J     BLDPF10                                                          
BLDPF30  MVI   0(R3),X'FF'                                                      
         XIT1                                                                   
                                                                                
**********************************************************************          
*        CONSTANTS AND LITERALS                                                 
**********************************************************************          
                                                                                
PFNUMS   DC    X'0E',AL2(MENLIN2-T702FFD)                                       
         DC    X'0F',AL2(MENLIN3-T702FFD)                                       
         DC    X'10',AL2(MENLIN4-T702FFD)                                       
         DC    X'11',AL2(MENLIN2+18-T702FFD)                                    
         DC    X'12',AL2(MENLIN3+18-T702FFD)                                    
         DC    X'13',AL2(MENLIN4+18-T702FFD)                                    
         DC    X'14',AL2(MENLIN2+56-T702FFD)                                    
         DC    X'15',AL2(MENLIN3+56-T702FFD)                                    
         DC    X'16',AL2(MENLIN4+56-T702FFD)                                    
         DC    X'FF'                                                            
                                                                                
         LTORG                                                                  
         EJECT                                                                  
       ++INCLUDE TAT2TACC                                                       
YES      SR    RC,RC                                                            
NO       LTR   RC,RC                                                            
         XIT1                                                                   
       ++INCLUDE TADCRECA                                                       
         EJECT                                                                  
       ++INCLUDE TAGENFFD                                                       
         EJECT                                                                  
         ORG   CONTAGH                                                          
       ++INCLUDE TASCR8CD          MENU SCREEN (ORG OTHER SCREENS               
         EJECT                     OVER CLIENT)                                 
         ORG   MENTAGH                                                          
       ++INCLUDE TASCRF4D          CANADIAN                                     
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCRF2D          ADDENDUM                                     
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCRF3D          SPANISH                                      
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCR53D          INTERNET/NEWMEDIA                            
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCRF1D          RADIO                                        
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCRF0D          TELEVISION                                   
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCR04D          COMPLETION                                   
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCR98D          CABLE                                        
         EJECT                                                                  
         ORG   MENTAGH                                                          
       ++INCLUDE TASCR0ED          CLASS A                                      
         EJECT                                                                  
*              DSECT TO COVER LOCAL SAVED STORAGE AT END OF TWA                 
         SPACE 1                                                                
         DS    D                                                                
ADCREC   DS    A                   A(ADVICE CAST RECORD)                        
AELTAOC  DS    A                                                                
AFAKEREC DS    A                   A(FAKE RECORD)                               
APTRBLK  DS    A                                                                
ASVRU    DS    A                                                                
ATAVUEL  DS    A                   A(TAVU ELEMENT)                              
ASVESTFD DS    A                   A(SAVED ESTIMATE FIELD)                      
AVERSION DS    A                   A(VERSIONS)                                  
ATEMPKYF DS    A                   A(SAVED AGY,COM,ADV SCREEN FLDS)             
ACSINFO  DS    A                   A(SAVED COM FLM AND REC INFO)                
UPGFLD   DS    A                                                                
CHKDATE  DS    A                                                                
TYPECHK1 DS    A                   ADDRESSES OF CHECKED USES                    
TYPECHK2 DS    A                                                                
*                                                                               
SUBCOUNT DS    F                                                                
UNITCALC DS    F                                                                
*                                                                               
TEMPUNI  DS    H                                                                
PAGELNQ  DS    H                                                                
*                                                                               
LWRSCR   DS    XL1                 SCREEN CODE OF LOWER HALF                    
WSPSTAT  DS    XL1                 WILDSPOT SEND STATUS                         
NEEDDET  EQU   X'80'               NEED DETAILS RECORD                          
MAINEXST DS    XL1                 MAIN COMMERCIAL EXIST?                       
*                                                                               
AGYSTAT  DS    XL1                 AGENCY STATUS                                
AGYSTA3  DS    XL1                 AGENCY STATUS 3                              
AGYSTA4  DS    XL1                 AGENCY STATUS 4                              
AGYSTA5  DS    XL1                 AGENCY STATUS 5                              
AGYNWKRQ DS    CL1                 AGENCY NETWORK REQ'D (CLA USES)              
*                                                                               
COMEXIST DS    CL1                 DOES COMMERCIAL EXIST?                       
COMMEDIA DS    CL1                 COMMERCIAL MEDIA                             
COMSTAT  DS    XL1                 COMMERCIAL STATUS                            
COMSTA2  DS    XL1                 COMMERCIAL STATUS 2                          
COMSTA3  DS    XL1                 COMMERCIAL STATUS 3                          
COMSTATE DS    CL2                 COMMERCIAL STATE                             
COMFFCYC DS    XL3                 COMMERCIAL FIRST FIXED CYCLE                 
COMCTYPE DS    XL1                 COMMERCIAL TYPE                              
COMAIR   DS    XL3                 FIRST AIR DATE                               
COMSAIR  DS    XL3                 SECOND SEASON FIRST AIR DATE                 
SVEXP    DS    CL8                 COMMERCIAL EXPIRATION DATE (DISPLAY)         
COCLG    DS    CL6                 COMMERCIAL CLIENT GROUP                      
*                                                                               
ADVKEY   DS    CL(L'KEY)           ADVICE KEY (INCLUDING D/A)                   
*                                                                               
NEEDPULL DS    CL1                                                              
NWKREQ   DS    CL1                 NETWORK REQ'D FOR REQUEST                    
SVESTPER DS    XL1                 SAVED ESTIMATE PERIOD                        
VPFKTAB  DS    XL8                 VALID PF KEYS TO FLIP TO                     
*                                                                               
FRSTSEQ  DS    XL1                 1ST ELEMENT DISPLAYED THIS SCREEN            
LASTSEQ  DS    XL1                 LAST ELEMENT DISPLAYED THIS SCREEN           
LASTCODE DS    XL6                                                              
LASTDATE DS    XL3                                                              
FRSTCODE DS    XL6                                                              
*                                                                               
USESES   DS    XL1                                                              
ASSIGNED EQU   C'A'                                                             
NASSIGND EQU   C'N'                                                             
*                                                                               
CHKSTAT  DS    XL1                 CHECK STATUS                                 
*                                                                               
TEMPTAVU DS    0C                  TEMPORARY TAVU ELEMENT                       
REGDATE  DS    XL6                 REGULAR USE CYCLE START DATE                 
USE1     DS    XL1                 1ST USE EQUATE                               
TYPE1    DS    XL1                 1ST USE TYPE EQUATE                          
MUSDATE  DS    XL6                 MUSIC USE CYCLE START DATE                   
USE2     DS    XL1                 2ND USE EQUATE                               
TYPE2    DS    XL1                 2ND USE TYPE EQUATE                          
         DS    XL1                                                              
SVUNITS  DS    H                   UNITS                                        
SVUSES   DS    H                   USES                                         
MAJOR    DS    XL1                 MAJORS                                       
APPLYS   DS    CL1                 APPLY SESSION                                
APPLYH   DS    CL1                 APPLY HOLD                                   
WEEKS1   DS    CL2                                                              
WEEKS2   DS    CL2                                                              
TTAVULNQ EQU   *-TEMPTAVU          LENGTH OF TEMPTAVU                           
*                                                                               
TEMPMAJ  DS    XL1                                                              
*                                                                               
SEQTAB   DS    CL20                1 BYTE ENTRY OF FIRST SEQ IN DC RECS         
DCRECCHG DS    CL1                 CAST LINES CHANGED - RIGHT DC REC            
SEQFIRST DS    XL1                 SAVED SEQ NUMBERS JUST CHANGED               
SEQLAST  DS    XL1                 WHICH IS USED FOR WRITING RECORDS            
*                                                                               
NCAST    DS    XL1                 N' OF ACTUAL CAST MEMBERS PULLED             
VERLIFT  DS    CL1                 ADVICE IS VERSION OR LIFT?                   
SVVER    DS    CL3                                                              
VERVALUE DS    XL1                 SAVED VERSION VALUE FROM TAFN ELEM           
*                                                                               
UPGR     DS    XL1                 UPGRADE (Y/N)                                
*                                                                               
PAGEMAX  DS    XL1                 STORAGE FOR DISPAGE ROUTINE                  
PMAXCLA  EQU   20                  MAXIMUM CLASS A SCREEN LINES                 
PMAXSESS EQU   7                   MAXIMUM SESSION SCREEN LINES                 
PMAXCBL  EQU   28                                                               
*                                                                               
SVLSEQ   DS    XL1                 STORAGE FOR BLDPAGE ROUTINE                  
DORSEQ   DS    XL1                                                              
CYCEND   DS    CL6                                                              
CYCSTART DS    CL6                                                              
*                                  STORAGE FOR DISPAGE AND BLDPAGE RTNS         
NPAGES   DS    XL1                 TOTAL NUMBER OF PAGES                        
THISPG   DS    XL1                 THIS PAGE NUMBER                             
*                                                                               
SELECT   DS    CL1                                                              
SVPF     DS    CL1                                                              
SVUPTYP  DS    CL1                                                              
VSDONE   DS    CL1                                                              
*                                                                               
COPYLAST DS    CL1                                                              
COMTYPV  DS    CL1                                                              
*                                                                               
SVEXP2   DS    CL6                 COMMERCIAL EXPIRATION DATE (BIN)             
*                                                                               
CYCLEN   DS    X                                                                
LAGEND   DS    XL3                                                              
CMCCYEND DS    XL3                                                              
*                                                                               
VLCOTYPE DS    CL(L'TACOTYPE)      COMMERCIAL TYPE TO VALIDATE AGAINST          
SVVRTYPE DS    CL(L'TACOTYPE)      SAVED VERSION TYPE                           
*                                                                               
STATUS   DS    XL1                 VERIFY STATUS                                
WAITVPFK EQU   X'80'               HIT PFKEY TO VERIFY                          
WAITSPFK EQU   X'40'               HIT PFKEY TO SEND                            
REREAD   EQU   X'20'               NEED TO RE-READ ADVICE RECORD                
WAITUPFK EQU   X'10'               HIT PFKEY TO VALIDATE UPGRADE                
WAITLPFK EQU   X'08'               HIT PFKEY TO VALIDATE VERSION/LIFT           
WAID1PFK EQU   X'04'               HIT PFKEY TO OVERRIDE WRONG DATE 1           
WAID2PFK EQU   X'02'               HIT PFKEY TO OVERRIDE WRONG DATE 2           
LOSEINF  EQU   X'01'               WILL LOSE INFO - SAVE STUFF                  
STATUS2  DS    XL1                 SECOND STATUS BYTE                           
DSPNXTPG EQU   X'80'               DISPLAY NEXT PAGE                            
BEG      EQU   (*-CONHEADH)                                                     
         DS    CL(3520-BEG)        CANNOT EXCEED DDGENTWA                       
         EJECT                                                                  
* DDGENTWA  (MUST FOLLOW LAST SCREEN)                                           
* TAGENWORKD                                                                    
* TASYSDSECT                                                                    
* TASYSEQUS                                                                     
* TAGENEQUS                                                                     
* DDSPLWORKD                                                                    
* DDSPOOLD                                                                      
* TAGENFILE                                                                     
* DDPERVALD                                                                     
* FAGETTXTD                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDGENTWA                                                       
       ++INCLUDE TAGENWORKD                                                     
       ++INCLUDE TASYSDSECT                                                     
       ++INCLUDE TASYSEQUS                                                      
       ++INCLUDE TAGENEQUS                                                      
       ++INCLUDE DDSPLWORKD                                                     
       ++INCLUDE DDSPOOLD                                                       
       ++INCLUDE TAGENFILE                                                      
       ++INCLUDE DDPERVALD                                                      
       ++INCLUDE FAGETTXTD                                                      
       ++INCLUDE DDGETRETD                                                      
         PRINT ON                                                               
*                                                                               
*              DSECT TO COVER SUBSCRIBER MINOR'S TABLE                          
*                                                                               
SUBTABD  DSECT                                                                  
SUBVAL   DS    CL5                 SUB VALUE TO INSERT IN SUB SCR FLD           
SUBREG   DS    AL1                 REG EQUATE FOR SUBSCRIBER VALUE              
SUB50    DS    AL1                 EQUATE FOR UPGRADE FROM 50K                  
SUB100   DS    AL1                 EQUATE FOR UPGRADE FROM 100K                 
SUB150   DS    AL1                 EQUATE FOR UPGRADE FROM 150K                 
SUB200   DS    AL1                 EQUATE FOR UPGRADE FROM 200K                 
SUB250   DS    AL1                 EQUATE FOR UPGRADE FROM 250K                 
SUB500   DS    AL1                 EQUATE FOR UPGRADE FROM 500K                 
SUB750   DS    AL1                 EQUATE FOR UPGRADE FROM 750K                 
SUB1MIL  DS    AL1                 EQUATE FOR UPGRADE FROM 1MIL                 
SUB2MIL  DS    AL1                 EQUATE FOR UPGRADE FROM 1MIL+                
SUBLNQ   EQU   *-SUBTABD                                                        
*                                                                               
*              DSECT TO COVER SUBSCRIBER MINOR'S TABLE                          
*                                                                               
ASUBTABD DSECT                                                                  
ASUBVAL  DS    CL9                 SUB VALUE TO INSERT IN SUB SCR FLD           
ASUBREG  DS    AL1                 REG EQUATE FOR SUBSCRIBER VALUE              
         DS    XL15                15 UPGRADE EQUS                              
ASUBLNQ  EQU   *-ASUBTABD                                                       
*              DSECT TO COVER CLASS A SCREEN USE ENTRIES                        
*                                                                               
CLAD     DSECT                                                                  
         DS    CL8                                                              
         DS    CL1                 ENTRY INDICATOR                              
CLA1STH  EQU   *-CLAD                                                           
CLAUSENH DS    CL8                                                              
CLAUSEN  DS    CL4                 USE NUMBER                                   
CLADATEH DS    CL8                                                              
CLADATE  DS    CL8                 USE DATE                                     
CLAPROGH DS    CL8                                                              
CLAPROG  DS    CL15                PROGRAM NAME                                 
CLALIFTH DS    CL8                                                              
CLALIFT  DS    CL1                 LIFT                                         
CLALSTH  EQU   *-CLAD                                                           
CLANWKH  DS    CL8                                                              
CLANWK   DS    CL1                 NETWORK                                      
CLALNQ   EQU   *-CLAD                                                           
CLANEXT  EQU   *                                                                
*                                                                               
CLA2D    DSECT                                                                  
         DS    CL8                                                              
         DS    CL1                 ENTRY INDICATOR                              
CLA1S2H  EQU   *-CLAD                                                           
CLAUSE2H DS    CL8                                                              
CLAUS2N  DS    CL4                 USE NUMBER                                   
CLADAT2H DS    CL8                                                              
CLADAT2  DS    CL8                 USE DATE                                     
CLAPRO2H DS    CL8                                                              
CLAPRO2  DS    CL15                PROGRAM NAME                                 
CLALIF2H DS    CL8                                                              
CLALIF2  DS    CL1                 LIFT                                         
CLALS2H  EQU   *-CLAD                                                           
CLANW2H  DS    CL8                                                              
CLANW2   DS    CL1                 NETWORK                                      
CLALNQ2  EQU   *-CLA2D                                                          
CLANEX2  EQU   *                                                                
         EJECT                                                                  
*              DSECT TO COVER CABLE SCREEN USE ENTRIES                          
*                                                                               
CBLD     DSECT                                                                  
         DS    CL8                                                              
         DS    CL1                 ENTRY INDICATOR                              
CBL1STH  EQU   *-CBLD                                                           
CBLDATEH DS    CL8                                                              
CBLDATE  DS    CL8                 FIRST USE DATE                               
CBLCODEH DS    CL8                                                              
CBLCODE  DS    CL6                 CNET/MKT/CSYS CODE                           
CBLLSTH  EQU   *-CBLD                                                           
CBLLNQ   EQU   *-CBLD                                                           
CBLNEXT  EQU   *                                                                
*                                                                               
CBL2D    DSECT                                                                  
         DS    CL8                                                              
         DS    CL1                 ENTRY INDICATOR                              
CBL1ST2H EQU   *-CBL2D                                                          
CBLDAT2H DS    CL8                                                              
CBLDAT2  DS    CL8                 FIRST USE DATE                               
CBLCOD2H DS    CL8                                                              
CBLCOD2  DS    CL6                 CNET/MKT/CSYS CODE                           
CBLLNQ2  EQU   *-CBL2D                                                          
CBLNEXT2 EQU   *                                                                
         EJECT                                                                  
*              DSECT TO COVER CAST SCREEN LINE                                  
*                                                                               
LINED    DSECT                                                                  
LIN1STH  EQU   *-LINED                                                          
LINSSNH  DS    CL8                                                              
LINSSN   DS    CL9                 SOCIAL SECURITY NUMBER                       
LINNAMEH DS    CL8                                                              
LINNAME  DS    CL26                PERFORMER NAME                               
LINCATH  DS    CL8                                                              
LINCAT   DS    CL3                 CATEGORY                                     
LINCAMH  DS    CL8                                                              
LINCAM   DS    CL3                 ON/OFF CAMERA                                
LINUNIH  DS    CL8                                                              
LINUNI   DS    CL3                 UNION                                        
LINDBLH  DS    CL8                                                              
LINDBL   DS    CL1                 DOUBLES                                      
LINLFTH  DS    CL8                                                              
LINLFT   DS    CL1                 LIFT STATUS                                  
LINOV1H  DS    CL8                                                              
LINOV1   DS    CL6                 OVERSCALE RATE 1                             
LINOV2H  DS    CL8                                                              
LINOV2   DS    CL6                 OVERSCALE RATE 2                             
LINDTAGH DS    CL8                                                              
LINDTAG  DS    CL9                 *DELETED* TAG                                
         DS    CL8                                                              
         DS    CL4                                                              
LINLSTH  EQU   *-LINED                                                          
LINCMTH  DS    CL8                                                              
LINCMT   DS    CL60                COMMENT                                      
LINLNQ   EQU   *-LINED             L'LINE                                       
LINNEXT  EQU   *                   A(NEXT LINE)                                 
         EJECT                                                                  
*              DSECT TO COVER CYCLE LENGTH DEFAULT TABLE                        
*                                                                               
WKDEFD   DSECT                                                                  
WKDSCR   DS    CL1                 SECTION OF WHICH SCREEN                      
WKDUSEA  DS    AL2                 A(USE FIELD)                                 
WKDLEN   DS    CL2                 DEFAULT CYCLE LENGTH                         
WKDLNQ   EQU   *-WKDEFD                                                         
*                                                                               
*              DSECT TO COVER SAVED KEY FIELDS                                  
TEMPKYFD DSECT                                                                  
TEMPAGY  DS    CL14                TEMPORARY AGENCY ID                          
TEMPCID  DS    CL20                TEMPORARY COMMERCIAL ID                      
TEMPADV  DS    CL14                TEMPORARY ADVICE ID                          
*                                                                               
*              DSECT TO COVER COMMERCIAL FILM AND RECORD INFO                   
CSINFOD  DSECT                                                                  
CSINFO   DS    0CL(L'CSFINFO+L'CSRINFO)                                         
CSFINFO  DS    0CL29               COMMERCIAL STUDIO FILM INFO                  
CSFDTE   DS    XL3                                                              
CSFSTUD  DS    CL12                                                             
CSFCITY  DS    CL12                                                             
CSFSTAT  DS    CL2                                                              
CSRINFO  DS    0CL29               COMMERCIAL STUDIO RECORD INFO                
CSRDTE   DS    XL3                                                              
CSRSTUD  DS    CL12                                                             
CSRCITY  DS    CL12                                                             
CSRSTAT  DS    CL2                                                              
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'077TAGEN8C   03/09/17'                                      
         END                                                                    
